<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïß üßìüèº ‚ÅâÔ∏è Nicht alle Patches sind gleicherma√üen n√ºtzlich. üèîÔ∏è ‚õ©Ô∏è üà∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Beitrag wird die Diskussion √ºber Leistungsverbesserungen fortgesetzt, die sich ohne die verschiedenen Buts ergeben k√∂nnten. Der vorherige Te...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nicht alle Patches sind gleicherma√üen n√ºtzlich.</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433174/"><p> In diesem Beitrag wird die Diskussion √ºber Leistungsverbesserungen fortgesetzt, die sich ohne die verschiedenen Buts ergeben k√∂nnten.  Der vorherige Teil √ºber <code>StringBuilder</code> ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </p><br><p>  Hier sehen wir uns einige ‚ÄûVerbesserungen‚Äú an, die aufgrund mangelnden Verst√§ndnisses der Feinheiten der Sprachspezifikation, nicht offensichtlicher Eckf√§lle und anderer Gr√ºnde abgelehnt wurden.  Lass uns gehen! </p><a name="habracut"></a><br><h4 id="kogda-nichto-ne-predveschaet-bedy">  Wenn nichts √Ñrger bedeutet </h4><br><p>  Ich denke, jeder von uns hat mit den Methoden <code>Collections.emptySet()</code> / <code>Collections.emptyList()</code> .  Dies sind sehr n√ºtzliche Methoden, mit denen Sie eine leere unver√§nderliche Sammlung zur√ºckgeben k√∂nnen, ohne ein neues Objekt zu erstellen.  Wenn wir uns die <code>EmptyList</code> Klasse <code>EmptyList</code> wir <code>EmptyList</code> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmptyList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">E</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Iterator&lt;E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">iterator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> emptyIterator(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Object[] toArray() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } }</code> </pre> <br><p>  Starkes Verbesserungspotential sehen?  Die <code>EmptyList.iterator()</code> -Methode gibt einen leeren Iterator aus der Gegenwart zur√ºck. Warum machen Sie nicht dieselbe Finte mit Ihren Ohren f√ºr das Array, das von der <code>toArray()</code> -Methode zur√ºckgegeben wird? </p><br><div class="spoiler">  <b class="spoiler_title">Es gibt jedoch eine, die als Dokumentation bezeichnet wird</b> <div class="spoiler_text"><blockquote>  Das zur√ºckgegebene Array ist "sicher", da diese Liste keine Verweise darauf enth√§lt.  (Mit anderen Worten, diese Methode muss ein neues Array zuweisen, auch wenn diese Liste von einem Array unterst√ºtzt wird.)  Dem Aufrufer steht es somit frei, das zur√ºckgegebene Array zu √§ndern. </blockquote><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">http://mail.openjdk.java.net/pipermail/core-libs-dev/2017-September/049170.html</a> <br>  <a href="" rel="nofollow">http://hg.openjdk.java.net/jdk/jdk12/file/ffac5eabbf28/src/java.base/share/classes/java/util/List.java#l185</a> </p></div></div><br><p>  Mit anderen Worten, die Methode sollte immer ein <strong>neues</strong> Array zur√ºckgeben. </p><br><p>  Sie werden sagen: "Er ist unver√§nderlich! Was kann schief gehen !?" </p><br><p>  Nur erfahrene Experten k√∂nnen diese Frage beantworten: </p><br><blockquote>  - Wer ist verantwortlich? <br>  - Verantwortliche Experten Paul Sandoz und Tagir Valeev </blockquote><br><div class="spoiler">  <b class="spoiler_title">Die Antwort von Experten</b> <div class="spoiler_text"><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">http://mail.openjdk.java.net/pipermail/core-libs-dev/2017-September/049171.html</a> </p><br><blockquote>  Beachten Sie auch, dass dies das sichtbare Verhalten √§ndert.  Zum Beispiel.  M√∂glicherweise synchronisiert jemand das vom toArray-Aufruf zur√ºckgegebene Array-Objekt, sodass diese √Ñnderung m√∂glicherweise zu einer unerw√ºnschten <strong>Freigabe der Sperren f√ºhrt</strong> . <br><br>  Einmal schlug ich eine √§hnliche Verbesserung vor: EMPTY_LIST von Arrays.asList () zur√ºckzugeben, wenn das angegebene Array die L√§nge Null hat.  Es wurde aus dem gleichen Grund abgelehnt [1]. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">http://mail.openjdk.java.net/pipermail/core-libs-dev/2015-September/035197.html</a> <br><br>  √úbrigens ist es dann wahrscheinlich sinnvoll, dass Arrays.asList die Array-L√§nge wie folgt √ºberpr√ºft: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T... a)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(a.length == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Collections.emptyList(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(a); }</code> </pre> <br><br>  Klingt vern√ºnftig, oder?  Warum eine neue Liste f√ºr ein leeres Array erstellen, wenn Sie eine fertige kostenlos herunterladen k√∂nnen? <br>  Es gibt einen Grund, dies nicht zu tun.  Derzeit gibt Arrays.asList keine Einschr√§nkungen f√ºr die Identit√§t der zur√ºckgegebenen Liste an.  Das Hinzuf√ºgen der Mikrooptimierung wird dies √§ndern.  Es ist ein Randfall und ein fragw√ºrdiger Anwendungsfall, aber wenn man bedenkt, dass ich die Dinge konservativ so lassen w√ºrde, wie sie sind. </blockquote></div></div><br><p>  Diese Aussage wird Sie wahrscheinlich verwirren: </p><br><blockquote>  Zum Beispiel.  M√∂glicherweise synchronisiert jemand das vom toArray-Aufruf zur√ºckgegebene Array-Objekt, sodass diese √Ñnderung m√∂glicherweise zu einer unerw√ºnschten Freigabe der Sperren f√ºhrt. </blockquote><p>  Sie werden sagen: "Wer bei klarem Verstand wird auf dem Array synchronisiert (!), Das aus der Sammlung zur√ºckgegeben wurde (!!!) !?" </p><br><p>  Es klingt nicht sehr glaubw√ºrdig, aber die Sprache bietet eine solche M√∂glichkeit, was bedeutet, dass die M√∂glichkeit besteht, dass ein bestimmter Benutzer dies tut (oder es sogar bereits getan hat).  Dann wird die vorgeschlagene √Ñnderung im besten Fall das Verhalten des Codes √§ndern und im schlimmsten Fall zu einer Unterbrechung der Synchronisation f√ºhren (sp√§ter gehen, abfangen).  Das Risiko ist so ungerechtfertigt und der erwartete Gewinn so unbedeutend, dass es besser ist, alles so zu lassen, wie es ist. </p><br><p>  Im Allgemeinen war die F√§higkeit zur Synchronisierung auf jedem Objekt, kmk, der Fehler der Sprachentwickler.  Erstens enth√§lt der Header jedes Objekts eine Struktur, die f√ºr die Synchronisation verantwortlich ist, und zweitens befinden wir uns in der oben beschriebenen Situation, in der ein scheinbar unver√§nderliches Objekt nicht mehrmals zur√ºckgegeben werden kann, da es darauf synchronisiert werden kann. </p><br><p>  Die Moral dieser Fabel lautet: Spezifikation und Abw√§rtskompatibilit√§t sind heilige K√ºhe von Java.  Versuchen Sie nicht einmal, in sie einzudringen: Der Wachmann schie√üt ohne Vorwarnung. </p><br><h4 id="staraeshsya-staraeshsya">  Versuchen, versuchen ... </h4><br><p>  Es gibt mehrere Array-basierte Klassen im JDK gleichzeitig, und alle implementieren die Methoden <code>List.indexOf()</code> und <code>List.lastIndexOf()</code> : </p><br><ul><li>  java.util.ArrayList </li><li>  java.util.Arrays $ ArrayList </li><li>  java.util.Vector </li><li>  java.util.concurrent.CopyOnWriteArrayList </li></ul><br><p>  Der Code dieser Methoden in diesen Klassen wird fast eins zu eins wiederholt.  Viele Anwendungen und Frameworks bieten auch L√∂sungen f√ºr dasselbe Problem an: </p><br><ul><li>  <a href="" rel="nofollow">org.hibernate.bytecode.enhance.internal.tracker.SimpleFieldTracker</a> </li><li>  <a href="" rel="nofollow">com.intellij.util.ArrayUtil</a> </li><li>  <a href="" rel="nofollow">com.intellij.util.ArrayUtilRt</a> </li><li>  <a href="" rel="nofollow">org.springframework.oxm.jibx.JibxMarshaller</a> </li></ul><br><p>  Als Ergebnis haben wir streunenden Code, der kompiliert werden muss (manchmal mehrmals), der im ReserverCodeCache stattfindet, der getestet werden muss und der einfach fast ohne √Ñnderungen von Klasse zu Klasse wandert. </p><br><p>  Entwickler wiederum schreiben sehr gerne so etwas </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = Arrays.asList(array).indexOf(obj); <span class="hljs-comment"><span class="hljs-comment">//  boolean contains = Arrays.asList(array).contains(obj); //    boolean contains = Arrays.stream(names).anyMatch(nm -&gt; nm.equals(name));</span></span></code> </pre> <br><p>  Ich m√∂chte verallgemeinerte Dienstprogrammmethoden in das JDK einf√ºhren und sie wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">vorgeschlagen</a> √ºberall verwenden.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">Der Patch ist</a> so einfach wie zwei Cent: </p><br><p>  1) Implementierungen von <code>List.indexOf()</code> und <code>List.lastIndexOf()</code> nach <code>java.util.Arrays</code> verschoben <br>  2) Stattdessen werden <code>Arrays.indexOf()</code> und <code>Arrays.lastIndexOf()</code> aufgerufen </p><br><p>  Es scheint, dass was schief gehen k√∂nnte?  Der Gewinn aus diesem Ansatz ist [scheinbar] offensichtlich.  Aber der Artikel handelt von Fehlern. √úberlegen Sie also, was schief gehen k√∂nnte. </p><br><blockquote>  - Wer ist verantwortlich? <br>  - Verantwortliche Experten Martin Buchholz und Paul Sandoz </blockquote><br><div class="spoiler">  <b class="spoiler_title">IMHO, ein wenig angespannt, aber trotzdem</b> <div class="spoiler_text"><p>  Martin Buchholz: </p><br><blockquote>  Sergey, ich pflege sozusagen alle diese Auflistungsklassen, und gelegentlich wollte ich auch indexOf-Methoden in Array.java haben.  Aber: <br><br>  Arrays werden im Allgemeinen nicht empfohlen.  Alle neuen statischen Methoden f√ºr Arrays (oder, wo ich sie eigentlich m√∂chte, f√ºr das Array-Objekt selbst! Erfordert eine √Ñnderung der Java-Sprache!) Sto√üen auf Widerstand. <br><br>  Wir haben es bereut, Nullen in Sammlungen unterst√ºtzt zu haben, daher unterst√ºtzen neuere Sammlungsklassen wie ArrayDeque sie nicht. <br><br>  Eine andere Variante, die Benutzer m√∂glicherweise w√ºnschen, ist die Art des zu verwendenden Gleichheitsvergleichs. <br><br>  Wir haben es bereut, ArrayList mit einem auf Null basierenden Startindex zu haben - es w√§re besser gewesen, das kreisf√∂rmige Array-Verhalten von ArrayDeque vom ersten Tag an zu haben. <br><br>  Der Code zum Durchsuchen von Array-Slices ist sehr klein, sodass Sie nicht viel sparen.  Es ist einfach, einen Fehler nach dem anderen zu machen, aber das gilt auch f√ºr eine Arrays-API. </blockquote><p>  Paul Sandoz: </p><br><blockquote>  Ich w√ºrde nicht so weit gehen zu sagen, dass Arrays entmutigt sind, ich w√ºrde es positiv als "vorsichtig verwenden" bezeichnen, da sie stachelig sind, z. B. immer ver√§nderlich. Sie k√∂nnten sicherlich verbessert werden. Ich w√ºrde mich sehr freuen, wenn Arrays ein gemeinsames Array implementieren 'ish Schnittstelle, k√∂nnen wir m√∂glicherweise einige Fortschritte nach Werttypen Sediment machen. <br><br>  Alle neuen Erg√§nzungen zu Arrays w√ºrden jedoch zumindest von mir auf Widerstand sto√üen :-) Es werden nie nur ein oder zwei Methoden hinzugef√ºgt, viele andere m√∂chten ebenfalls mitfahren (alle Grundelemente plus Reichweitenvarianten).  Daher muss jede neue Funktion ausreichend n√ºtzlich sein, und in diesem Fall denke ich nicht, dass die Vorteile stark genug sind (z. B. ein m√∂glicher Reduktionscode-Cache-Druck). </blockquote><p>  Paul. </p></div></div><br><p>  Korrespondenz: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">http://mail.openjdk.java.net/pipermail/core-libs-dev/2018-March/051968.html</a> </p><br><p>  Die Moral dieser Fabel lautet: Ihr genialer Patch kann zur √úberpr√ºfung geschlachtet werden, einfach weil sie keinen besonderen Wert darin sehen.  Ja, es gibt doppelten Code, aber er st√∂rt niemanden. Lassen Sie ihn also leben. </p><br><h4 id="uluchsheniya-dlya-arraylist-a-ih-est-u-menya">  Verbesserungen f√ºr ArrayList?  Ich habe sie </h4><br><p><del>  Moped </del>  Der Patch geh√∂rt nicht mir. Ich werde ihn nur ver√∂ffentlichen, damit Sie dar√ºber nachdenken k√∂nnen.  Der Vorschlag selbst wurde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">hier</a> ge√§u√üert und sieht sehr attraktiv aus.  √úberzeugen Sie sich selbst: </p><br><div class="spoiler">  <b class="spoiler_title">Vorgeschlagene √Ñnderung</b> <div class="spoiler_text"><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">Link</a> </p></div></div><br><p>  Mit blo√üem Auge ist der Vorschlag sehr, sehr logisch.  Sie k√∂nnen die Leistung anhand eines einfachen <a href="" rel="nofollow">Benchmarks</a> messen: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@State</span></span>(Scope.Benchmark) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayListBenchmark</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@State</span></span>(Scope.Benchmark) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Data</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Param</span></span>({<span class="hljs-string"><span class="hljs-string">"10"</span></span>, <span class="hljs-string"><span class="hljs-string">"100"</span></span>, <span class="hljs-string"><span class="hljs-string">"1000"</span></span>, <span class="hljs-string"><span class="hljs-string">"10000"</span></span>}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size; ArrayList&lt;Integer&gt; arrayRandom = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;Integer&gt;(size); <span class="hljs-meta"><span class="hljs-meta">@Setup</span></span>(Level.Invocation) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initArrayList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Random rand = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random(); rand.setSeed(System.currentTimeMillis()); <span class="hljs-comment"><span class="hljs-comment">// Populate the ArrayList with size-5 elements for (int i = 0; i &lt; size - 5; i++) { Integer r = rand.nextInt() % 256; arrayRandom.add(r); } } } @Benchmark public ArrayList construct_new_array_list(Data d) { ArrayList al = new ArrayList(d.arrayRandom); // once a new ArrayList is created add a new element al.add(new Integer(900)); return al; } }</span></span></code> </pre> <br><p>  Zusammenfassung: </p><br><pre> <code class="plaintext hljs">Benchmark (size) Mode Cnt Score Error Units  construct_new_array_list 10 thrpt 25 388.212 ¬± 23.110 ops/s construct_new_array_list 100 thrpt 25 90.208 ¬± 7.995 ops/s construct_new_array_list 1000 thrpt 25 23.289 ¬± 1.687 ops/s construct_new_array_list 10000 thrpt 25 7.659 ¬± 0.560 ops/s  construct_new_array_list 10 thrpt 25 562.678 ¬± 37.370 ops/s construct_new_array_list 100 thrpt 25 119.791 ¬± 13.232 ops/s construct_new_array_list 1000 thrpt 25 33.811 ¬± 3.812 ops/s construct_new_array_list 10000 thrpt 25 10.889 ¬± 0.564 ops/s</code> </pre> <br><p>  Nicht schlecht f√ºr eine so einfache √Ñnderung.  Die Hauptsache ist, dass es keinen Haken zu geben scheint.  Erstellen Sie ehrlich ein Array, kopieren Sie die Daten ehrlich und vergessen Sie nicht die Gr√∂√üe.  Jetzt m√ºssen sie den Patch definitiv akzeptieren! </p><br><div class="spoiler">  <b class="spoiler_title">Aber da war es</b> <div class="spoiler_text"><p>  Martin Buchholz: </p><br><blockquote>  Dies ist keine Frage, dass wir den Fall von ArrayList -&gt; ArrayList optimieren k√∂nnen, aber was ist mit all den anderen Collection-Implementierungen?  ArrayDeque und CopyOnWriteArrayList fallen mir ein. <br>  ArrayList ist eine beliebte Klasse zum Erstellen von Kopien von Sammlungen.  Wo h√∂rst du auf? <br><br>  Eine pathologische Unterklasse von ArrayList k√∂nnte entscheiden, keine Elemente im Hintergrundarray zu speichern, was zu einem Bruch f√ºhrt. <br><br>  Die gesegnete L√∂sung f√ºr das Problem der Listenkopie ist wahrscheinlich List.copyOf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/List.html#copyOf(java .util.Collection</a> ), die m√∂glicherweise die von Ihnen erhoffte Optimierung durchf√ºhren. </blockquote><p>  Alan Bateman </p><br><blockquote>  ArrayList ist nicht endg√ºltig, daher ist es m√∂glich, dass jemand es erweitert hat, um etwas anderes als elementData zu verwenden.  Es ist m√∂glicherweise sicherer, die Klassenidentit√§t als die Instanz von zu verwenden. </blockquote></div></div><br><p>  Nichts verbietet mir, mich von <code>ArrayList</code> zu <code>ArrayList</code> und Daten in einer verkn√ºpften Liste zu speichern.  Dann wird eine <code>c instanceof ArrayList</code> die Wahrheit zur√ºckgeben, wir werden zum <code>c instanceof ArrayList</code> gelangen und sicher fallen. </p><br><p>  Die Moral dieser Fabel lautet: Eine <em>m√∂gliche</em> Verhaltens√§nderung kann die Ursache f√ºr das Scheitern sein.  Mit anderen Worten, man muss die Wahrscheinlichkeit selbst der absurdesten Ver√§nderung im Auge behalten, wenn dies durch die Sprache erlaubt ist.  Und ja, es h√§tte <code>ArrayList</code> , wenn <code>ArrayList</code> Anfang an f√ºr <code>final</code> erkl√§rt h√§tte. </p><br><h4 id="snova-specifikaciya">  Spezifikation erneut </h4><br><p>  Beim Debuggen meiner Anwendung bin ich versehentlich in den Bauch von Spring geraten und habe den folgenden <a href="" rel="nofollow">Code gefunden</a> : </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//      paramTypes for (Constructor&lt;?&gt; candidate : candidates) { Class&lt;?&gt;[] paramTypes = candidate.getParameterTypes(); if (constructorToUse != null &amp;&amp; argsToUse != null &amp;&amp; argsToUse.length &gt; paramTypes.length) { // Already found greedy constructor that can be satisfied -&gt; // do not look any further, there are only less greedy constructors left. break; } if (paramTypes.length &lt; minNrOfArgs) { continue; }</span></span></code> </pre> <br><p>  Gl√ºcklicherweise habe ich durch das <code>java.lang.reflect.Constructor.getParameterTypes()</code> von <code>java.lang.reflect.Constructor.getParameterTypes()</code> den Code etwas tiefer gescrollt und einen sch√∂nen gefunden: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Class&lt;?&gt;[] getParameterTypes() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parameterTypes.clone(); } <span class="hljs-comment"><span class="hljs-comment">/** * {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@inheritDoc</span></span></span><span class="hljs-comment">} * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 1.8 */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getParameterCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parameterTypes.length; }</code> </pre> <br><p>  Siehst du, ja?  Wenn wir die Anzahl der Konstruktor- / Methodenargumente herausfinden m√ºssen, rufen Sie einfach <code>java.lang.reflect.Method.getParameterCount()</code> und verzichten Sie auf das Kopieren des Arrays.  √úberpr√ºfen Sie, ob das Spiel im einfachsten Fall, in dem die Methode keine Parameter hat, die Kerze wert ist: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@State</span></span>(Scope.Thread) <span class="hljs-meta"><span class="hljs-meta">@BenchmarkMode</span></span>(Mode.AverageTime) <span class="hljs-meta"><span class="hljs-meta">@OutputTimeUnit</span></span>(TimeUnit.NANOSECONDS) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MethodToStringBenchmark</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Method method; <span class="hljs-meta"><span class="hljs-meta">@Setup</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ method = getClass().getMethod(<span class="hljs-string"><span class="hljs-string">"toString"</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Benchmark</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getParameterCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> method.getParameterCount(); } <span class="hljs-meta"><span class="hljs-meta">@Benchmark</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getParameterTypes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> method.getParameterTypes().length; } }</code> </pre> <br><p>  Auf meinem Computer und mit JDK 11 sieht es so aus: </p><br><pre> <code class="plaintext hljs">Benchmark Mode Cnt Score Error Units getParameterCount avgt 25 2,528 ¬± 0,085 ns/op getParameterCount:¬∑gc.alloc.rate avgt 25 ‚âà 10‚Åª‚Å¥ MB/sec getParameterCount:¬∑gc.alloc.rate.norm avgt 25 ‚âà 10‚Åª‚Å∑ B/op getParameterCount:¬∑gc.count avgt 25 ‚âà 0 counts getParameterTypes avgt 25 7,299 ¬± 0,410 ns/op getParameterTypes:¬∑gc.alloc.rate avgt 25 1999,454 ¬± 89,929 MB/sec getParameterTypes:¬∑gc.alloc.rate.norm avgt 25 16,000 ¬± 0,001 B/op getParameterTypes:¬∑gc.churn.G1_Eden_Space avgt 25 2003,360 ¬± 91,537 MB/sec getParameterTypes:¬∑gc.churn.G1_Eden_Space.norm avgt 25 16,030 ¬± 0,045 B/op getParameterTypes:¬∑gc.churn.G1_Old_Gen avgt 25 0,004 ¬± 0,001 MB/sec getParameterTypes:¬∑gc.churn.G1_Old_Gen.norm avgt 25 ‚âà 10‚Åª‚Åµ B/op getParameterTypes:¬∑gc.count avgt 25 2380,000 counts getParameterTypes:¬∑gc.time avgt 25 1325,000 ms</code> </pre> <br><p>  Was k√∂nnen wir dagegen tun?  Wir k√∂nnen nach der Verwendung der Antipattern- <code>Method.getParameterTypes().length</code> im JDK (zumindest in <code>java.base</code> ) und dort ersetzen, wo es Sinn macht: </p><br><p> <code>java.lang.invoke.MethodHandleProxies</code> </p> <br><p><img src="https://habrastorage.org/webt/l_/3j/h1/l_3jh1hu3swdedxqktlxboz0tu0.png"></p><br><p> <code>java.util.concurrent.ForkJoinTask</code> </p> <br><p><img src="https://habrastorage.org/webt/0o/rt/q7/0ortq71mnf3-bwsa4wyi-jmzf5y.png"></p><br><p> <code>java.lang.reflect.Executable</code> </p> <br><p><img src="https://habrastorage.org/webt/sm/_h/pm/sm_hpm8eahlmqavobjqg9gejvse.png"></p><br><p> <code>sun.reflect.annotation.AnnotationType</code> </p> <br><p><img src="https://habrastorage.org/webt/yw/bv/il/ywbvil_doi3fzy6uzkpcm42g6zu.png"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">Der Patch</a> wurde zusammen mit einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">Anschreiben</a> verschickt. </p><br><p>  Pl√∂tzlich stellte sich heraus, dass es seit einigen Jahren eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">√§hnliche Aufgabe gibt</a> und sogar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">√Ñnderungen darauf</a> vorbereitet wurden.  In den Kommentaren wurde eine recht ordentliche Leistungssteigerung f√ºr solche einfachen √Ñnderungen festgestellt.  Allerdings sind sowohl sie als auch mein Patch bisher gereinigt und liegen regungslos da.  Warum?  Wahrscheinlich, weil die Entwickler zu besch√§ftigt mit notwendigeren Dingen sind und sie es dummerweise nicht in die H√§nde bekommen. </p><br><p>  Die Moral dieser Fabel lautet: Ihre genialen Ver√§nderungen k√∂nnen einfach aufgrund eines Mangels an Arbeitern einfrieren. </p><br><p>  Aber das ist nicht das Ende!  W√§hrend der Diskussion √ºber die Rationalit√§t des beschriebenen Ersatzes in anderen Projekten haben erfahrene Kameraden einen Gegenvorschlag unterbreitet: Vielleicht sollten Sie <code>Method.getParameterTypes().length -&gt; Method.getParameterCount()</code> mit Ihren H√§nden <code>Method.getParameterTypes().length -&gt; Method.getParameterCount()</code> , sondern dem Compiler anvertrauen?  Ist das m√∂glich und wird es "legal" sein? </p><br><p>  Versuchen wir es mit dem Test zu √ºberpr√ºfen: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">arrayClone</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Object[] objects = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object[<span class="hljs-number"><span class="hljs-number">3</span></span>]; objects[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-string"><span class="hljs-string">"azaza"</span></span>; objects[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">365</span></span>; objects[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-number"><span class="hljs-number">9876L</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Object[] clone = objects.clone(); assertEquals(objects.length, clone.length); assertSame(objects[<span class="hljs-number"><span class="hljs-number">0</span></span>], clone[<span class="hljs-number"><span class="hljs-number">0</span></span>]); assertSame(objects[<span class="hljs-number"><span class="hljs-number">1</span></span>], clone[<span class="hljs-number"><span class="hljs-number">1</span></span>]); assertSame(objects[<span class="hljs-number"><span class="hljs-number">2</span></span>], clone[<span class="hljs-number"><span class="hljs-number">2</span></span>]); }</code> </pre> <br><p>  was passiert und was zeigt, dass wenn das geklonte Array den Bereich nicht verl√§sst, es gel√∂scht werden kann, weil der Zugriff auf ein Element aus seinen Zellen oder dem <code>length</code> vom Original erhalten werden kann. </p><br><p>  Kann das JDK das tun?  Wir pr√ºfen: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@State</span></span>(Scope.Thread) <span class="hljs-meta"><span class="hljs-meta">@BenchmarkMode</span></span>(Mode.AverageTime) <span class="hljs-meta"><span class="hljs-meta">@OutputTimeUnit</span></span>(TimeUnit.NANOSECONDS) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayAllocationEliminationBenchmark</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> length = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Benchmark</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">baseline</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[length].length; } <span class="hljs-meta"><span class="hljs-meta">@Benchmark</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">baselineClone</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[length].clone().length; } }</code> </pre> <br><p>  Ausgabe f√ºr JDK 13: </p><br><pre> <code class="plaintext hljs">Benchmark Mode Cnt Score Error Units baseline avgt 50 6,135 ¬± 0,140 ns/op baseline:¬∑gc.alloc.rate.norm avgt 50 56,000 ¬± 0,001 B/op clone avgt 50 18,359 ¬± 0,619 ns/op clone:¬∑gc.alloc.rate.norm avgt 50 112,000 ¬± 0,001 B/op</code> </pre> <br><p>  Es stellt sich heraus, dass openjdk im Gegensatz zum <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">Gral</a> nicht wei√ü, wie man <code>new int[length]</code> wirft, hehe: </p><br><pre> <code class="plaintext hljs">Benchmark Mode Cnt Score Error Units baseline avgt 25 2,470 ¬± 0,156 ns/op baseline:¬∑gc.alloc.rate.norm avgt 25 0,005 ¬± 0,008 B/op lone avgt 25 13,086 ¬± 1,059 ns/op lone:¬∑gc.alloc.rate.norm avgt 25 112,113 ¬± 0,115 B/op</code> </pre> <br><p>  Es stellt sich heraus, dass Sie den openjdk-Optimierungscompiler ein wenig optimieren k√∂nnen, damit er das kann, was der Gral kann.  Da nicht nur jeder eine positive Anzeige im VM-Code schalten und etwas Sinnvolles einreichen kann, beschr√§nkte ich mich auf einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">Brief,</a> in dem ich meine Beobachtungen darlegte. </p><br><p>  Es stellte sich heraus, und es gibt mehrere Feinheiten.  Vladimir Ivanov <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">gibt an,</a> dass: </p><br><blockquote>  In Anbetracht der Tatsache, dass es keine M√∂glichkeit gibt, Java-Arrays zu vergr√∂√üern oder zu verkleinern, <br>  Die Transformation "cloned_array.length =&gt; original_array.length" ist korrekt <br>  unabh√§ngig davon, ob die geklonte Variante entkommt oder nicht. <br><br>  Dar√ºber hinaus ist die Transformation bereits da: <br><br>  <a href="" rel="nofollow">http://hg.openjdk.java.net/jdk/jdk/file/tip/src/hotspot/share/opto/memnode.cpp#l2388</a> <br><br>  Ich habe mir die von Ihnen erw√§hnten Benchmarks nicht angesehen, aber es sieht so aus <br>  Der Zugriff auf cloned_array.length ist nicht der Grund, warum das geklonte Array immer noch vorhanden ist <br>  dort. <br><br>  In Bezug auf Ihre anderen Ideen k√∂nnen Sie Zugriffe von der geklonten Instanz auf umleiten <br>  Original ist problematisch (im Allgemeinen), da der Compiler beweisen muss <br>  Es gab keine √Ñnderungen in beiden Versionen und indizierte Zugriffe machen es gleichm√§√üig <br>  schwerer.  Und Sicherheitspunkte verursachen ebenfalls Probleme (f√ºr die Rematerialisierung). <br><br>  Aber ich stimme zu, dass es sch√∂n w√§re, (zumindest) einfache F√§lle von abzudecken <br>  defensives Kopieren. </blockquote><p>  Das hei√üt, ein Klon zu schlagen scheint m√∂glich und nicht besonders schwierig zu sein.  Aber mit der Umstellung </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> len = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[arrayLength].length;</code> </pre> <br><p>  -&gt; </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> len = arrayLength;</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">Schwierigkeiten</a> entstehen: </p><br><blockquote>  Wir entfernen keine Array-Zuordnungen, deren L√§nge nicht bekannt ist <br>  weil sie m√∂glicherweise eine NegativeArraySize-Ausnahme verursachen.  In diesem Fall wir <br>  sollte jedoch nachweisen k√∂nnen, dass die L√§nge positiv ist. <br><br>  Wie auch immer - ich habe einen fast fertigen Patch, der nicht verwendete Arrays ersetzt <br>  Zuweisungen mit einer angemessenen Wache. </blockquote><p>  Mit anderen Worten, Sie k√∂nnen die Erstellung eines Arrays nicht einfach wegnehmen und wegwerfen, da die Ausf√ºhrung gem√§√ü der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">Spezifikation</a> eine <code>NegativeArraySizeException</code> und wir nichts dagegen tun k√∂nnen: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">arrayWithNwgativeSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> length = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> newLen = -<span class="hljs-number"><span class="hljs-number">3</span></span>; length = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object[newLen].length; <span class="hljs-comment"><span class="hljs-comment">//  new Object[newLen]  fail(); } catch (NegativeArraySizeException e) { assert length == 0; } }</span></span></code> </pre> <br><p>  Warum konnte der Gral?  Ich denke, der Grund daf√ºr ist, dass der Wert des <code>length</code> im obigen Benchmark konstant und immer gleich 10 war, was den Profiler zu dem Schluss f√ºhrte, dass die √úberpr√ºfung eines negativen Werts nicht erforderlich ist, was bedeutet, dass er zusammen mit der Erstellung des Arrays selbst entfernt werden kann.  Korrigieren Sie in den Kommentaren, wenn ich einen Fehler gemacht habe. </p><br><p>  Das ist alles f√ºr heute :) F√ºgen Sie Ihre Beispiele in die Kommentare ein, wir werden verstehen. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de433174/">https://habr.com/ru/post/de433174/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de433158/index.html">Musikalische Parodien von SUSE √ºber Kubernetes, Linus Torvalds und andere</a></li>
<li><a href="../de433164/index.html">Schnell und w√ºtend: Forza Horizon 4 beschleunigt mit Fenstershadern</a></li>
<li><a href="../de433168/index.html">Warum hat ein Programmierer ein Praktikum in der K√ºche - ein Gespr√§ch mit Dodo Pizza √ºber gemba, .NET und Offenheit</a></li>
<li><a href="../de433170/index.html">Wie wir die Architektur des Unternehmens nicht wiederholen konnten</a></li>
<li><a href="../de433172/index.html">Wir verbinden den Multiplayer mit dem in C ++ geschriebenen Handyspiel "Machen Sie W√∂rter aus W√∂rtern" auf iOS und Android</a></li>
<li><a href="../de433176/index.html">Docker Remote-API f√ºr Zertifikatauthentifizierung mit Sperr√ºberpr√ºfung</a></li>
<li><a href="../de433178/index.html">Wie wir eine besch√§digte WAV-Datei wiederhergestellt haben</a></li>
<li><a href="../de433180/index.html">L√∂sen von Datentypproblemen in Ruby oder Machen Sie Daten wieder zuverl√§ssig</a></li>
<li><a href="../de433182/index.html">Ist es m√∂glich, einen Agenten f√ºr den Handel an der B√∂rse mit Verst√§rkung auszubilden? Implementierung der R-Sprache</a></li>
<li><a href="../de433184/index.html">ASP.NET Core 2.2 ver√∂ffentlicht. Was gibt's Neues? (2 von 3)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>