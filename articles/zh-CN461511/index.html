<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§‘ğŸ½â€ğŸ¤â€ğŸ§‘ğŸ½ ğŸ  ğŸ’” Pythonä¾èµ–ç®¡ç†ï¼šæ–¹æ³•çš„æ¯”è¾ƒ ğŸ‘©ğŸ¼â€âœˆï¸ ğŸ‘©ğŸ¿â€ğŸ« ğŸ’¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘å·²ç»ç”¨pythonç¼–å†™äº†äº”å¹´ï¼Œå…¶ä¸­æœ€è¿‘ä¸‰å¹´ä¸€ç›´åœ¨å¼€å‘è‡ªå·±çš„é¡¹ç›®ã€‚ å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘çš„å›¢é˜Ÿéƒ½ä¼šå¸®åŠ©æˆ‘ã€‚ å¯¹äºæ¯ä¸ªå‘è¡Œç‰ˆå’Œæ¯ä¸ªæ–°åŠŸèƒ½ï¼Œæˆ‘ä»¬éƒ½åœ¨ä¸æ–­åŠªåŠ›ç¡®ä¿è¯¥é¡¹ç›®ä¸ä¼šå› ä¸å—æ”¯æŒçš„ä»£ç è€Œå˜å¾—æ··ä¹±ã€‚ æˆ‘ä»¬åœ¨å¾ªç¯å¯¼å…¥ï¼Œç›¸äº’ä¾èµ–ï¼Œåˆ†é…é‡ç”¨æ¨¡å—ï¼Œé‡å»ºç»“æ„æ–¹é¢é‡åˆ°å›°éš¾ã€‚ 

 ä¸å¹¸çš„æ˜¯ï¼Œåœ¨Pythonç¤¾åŒºä¸­ï¼Œæ²¡æœ‰â€œ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pythonä¾èµ–ç®¡ç†ï¼šæ–¹æ³•çš„æ¯”è¾ƒ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461511/"><img src="http://ftcdn.pw/cd64d5e9-af9a-46cc-868b-c8873c98adb6.png" alt="å›¾ç‰‡"><br><br> æˆ‘å·²ç»ç”¨pythonç¼–å†™äº†äº”å¹´ï¼Œå…¶ä¸­æœ€è¿‘ä¸‰å¹´ä¸€ç›´åœ¨å¼€å‘è‡ªå·±çš„é¡¹ç›®ã€‚ å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘çš„å›¢é˜Ÿéƒ½ä¼šå¸®åŠ©æˆ‘ã€‚ å¯¹äºæ¯ä¸ªå‘è¡Œç‰ˆå’Œæ¯ä¸ªæ–°åŠŸèƒ½ï¼Œæˆ‘ä»¬éƒ½åœ¨ä¸æ–­åŠªåŠ›ç¡®ä¿è¯¥é¡¹ç›®ä¸ä¼šå› ä¸å—æ”¯æŒçš„ä»£ç è€Œå˜å¾—æ··ä¹±ã€‚ æˆ‘ä»¬åœ¨å¾ªç¯å¯¼å…¥ï¼Œç›¸äº’ä¾èµ–ï¼Œåˆ†é…é‡ç”¨æ¨¡å—ï¼Œé‡å»ºç»“æ„æ–¹é¢é‡åˆ°å›°éš¾ã€‚ <br><br> ä¸å¹¸çš„æ˜¯ï¼Œåœ¨Pythonç¤¾åŒºä¸­ï¼Œæ²¡æœ‰â€œå¥½çš„æ¶æ„â€çš„é€šç”¨æ¦‚å¿µï¼Œåªæœ‰â€œ Pythonicityâ€çš„æ¦‚å¿µï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»è‡ªå·±æå‡ºæ¶æ„ã€‚ åœ¨å‰Šå‡çš„åŸºç¡€ä¸Šï¼ŒLongridå¯¹ä½“ç³»ç»“æ„è¿›è¡Œäº†æ€è€ƒï¼Œé¦–å…ˆæ˜¯å¯¹ä¾èµ–å…³ç³»ç®¡ç†çš„é€‚ç”¨äºPythonã€‚ <br><a name="habracut"></a><br><h1>  django.setupï¼ˆï¼‰ </h1><br> é¦–å…ˆï¼Œæˆ‘è¦é—®ä¸›æ—é—®é¢˜ã€‚ æ‚¨ç»å¸¸å†™è¿™ä¸¤è¡Œå—ï¼Ÿ <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> django django.setup()</code> </pre> <br> å¦‚æœè¦ä½¿ç”¨djangoå¯¹è±¡è€Œä¸å¯åŠ¨django WebæœåŠ¡å™¨æœ¬èº«ï¼Œåˆ™éœ€è¦ä»æ­¤å¯åŠ¨æ–‡ä»¶ã€‚ è¿™é€‚ç”¨äºä½¿ç”¨æ—¶é—´çš„æ¨¡å‹å’Œå·¥å…·ï¼ˆ <code><b>django.utils.timezone</b></code> ï¼‰å’Œ<code><b>django.urls.reverse</b></code> ï¼ˆ <code><b>django.urls.reverse</b></code> ï¼‰ç­‰ã€‚ å¦‚æœä¸è¿™æ ·åšï¼Œé‚£ä¹ˆæ‚¨å°†å¾—åˆ°ä¸€ä¸ªé”™è¯¯ï¼š <br><br><pre> <code class="plaintext hljs">django.core.exceptions.AppRegistryNotReady: Apps aren't loaded yet.</code> </pre><br> æˆ‘ä¸€ç›´åœ¨å†™è¿™ä¸¤è¡Œã€‚ æˆ‘éå¸¸å–œæ¬¢å¼¹å‡ºä»£ç ï¼› æˆ‘å–œæ¬¢åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„<code><b>.py</b></code>æ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„å†…å®¹æ‰­æ›²ï¼Œå¼„æ¸…æ¥š-ç„¶åå°†å…¶åµŒå…¥åˆ°é¡¹ç›®ä¸­ã€‚ <br><br> è¿™ä¸ªå¸¸é‡<code><b>django.setup()</b></code>ä½¿æˆ‘éå¸¸çƒ¦æ¼ã€‚ é¦–å…ˆï¼Œæ‚¨å·²ç»åŒå€¦äº†åˆ°å¤„é‡å¤å®ƒï¼› å…¶æ¬¡ï¼Œdjangoåˆå§‹åŒ–éœ€è¦å‡ ç§’é’Ÿï¼ˆæˆ‘ä»¬æœ‰ä¸€ä¸ªåºå¤§çš„æ•´ä½“ï¼‰ï¼Œå¹¶ä¸”å½“æ‚¨é‡æ–°å¯åŠ¨åŒä¸€æ–‡ä»¶10ã€20ã€100æ¬¡æ—¶-è¿™åªä¼šå‡æ…¢å¼€å‘é€Ÿåº¦ã€‚ <br><br> å¦‚ä½•æ‘†è„±<code><b>django.setup()</b></code> ï¼Ÿ æ‚¨éœ€è¦ç¼–å†™æœ€å°‘ä¾èµ–djangoçš„ä»£ç ã€‚ <br><br> ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬ç¼–å†™å¤–éƒ¨APIçš„å®¢æˆ·ç«¯ï¼Œåˆ™å¯ä»¥ä½¿å…¶ä¾èµ–djangoï¼š <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.conf <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> settings <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">APIClient</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.api_key = settings.SOME_API_KEY <span class="hljs-comment"><span class="hljs-comment"># : client = APIClient()</span></span></code> </pre><br> æˆ–è€…å®ƒå¯ä»¥ç‹¬ç«‹äºDjangoï¼š <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">APIClient</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, api_key)</span></span></span><span class="hljs-function">:</span></span> self.api_key = api_key <span class="hljs-comment"><span class="hljs-comment"># : client = APIClient(api_key='abc')</span></span></code> </pre><br> åœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œæ„é€ å‡½æ•°æ¯”è¾ƒéº»çƒ¦ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨æ­¤ç±»è¿›è¡Œä»»ä½•æ“ä½œè€Œæ— éœ€åŠ è½½æ•´ä¸ªdzhangovskoyæœºåˆ¶ã€‚ <br><br> æµ‹è¯•ä¹Ÿå˜å¾—è¶Šæ¥è¶Šå®¹æ˜“ã€‚ å¦‚ä½•æµ‹è¯•ä¾èµ–äº<code><b>django.conf.settings</b></code>è®¾ç½®çš„ç»„ä»¶ï¼Ÿ åªéœ€ä½¿ç”¨<code><b>@override_settings</b></code>è£…é¥°å™¨å°†å…¶é”å®šã€‚ è€Œä¸”ï¼Œå¦‚æœè¯¥ç»„ä»¶ä¸ä¾èµ–ä»»ä½•ä¸œè¥¿ï¼Œé‚£ä¹ˆå°±ä¸ä¼šæœ‰ä»»ä½•ä¸œè¥¿è¢«å¼„æ¹¿ï¼šå®ƒå°†å‚æ•°ä¼ é€’ç»™æ„é€ å‡½æ•°-å¹¶å°†å…¶é©±åŠ¨ã€‚ <br><br><h1> ä¾èµ–ç®¡ç† </h1><br>  <code><b>django</b></code>ä¾èµ–å…³ç³»æ•…äº‹æ˜¯æˆ‘æ¯å¤©é¢å¯¹çš„é—®é¢˜ä¸­æœ€å¼•äººæ³¨ç›®çš„ä¾‹å­ï¼špythonä¸­çš„ä¾èµ–å…³ç³»ç®¡ç†é—®é¢˜-ä»¥åŠpythonåº”ç”¨ç¨‹åºçš„æ•´ä½“ä½“ç³»ç»“æ„ã€‚ <br><br>  Pythonç¤¾åŒºä¸­ä¸ä¾èµ–é¡¹ç®¡ç†çš„å…³ç³»æ˜¯æ··æ‚çš„ã€‚ å¯ä»¥åŒºåˆ†ä¸‰ä¸ªä¸»è¦é˜µè¥ï¼š <br><br><ul><li>  Pythonæ˜¯ä¸€ç§çµæ´»çš„è¯­è¨€ã€‚ æˆ‘ä»¬æ ¹æ®éœ€è¦ç¼–å†™è‡ªå·±æƒ³è¦çš„å†…å®¹ã€‚ æˆ‘ä»¬å¯¹å¾ªç¯ä¾èµ–å…³ç³»ï¼Œè¿è¡Œæ—¶ä¸­çš„ç±»çš„å±æ€§æ›¿æ¢ç­‰å¹¶ä¸å®³ç¾ã€‚ <br><br></li><li>  Pythonæ˜¯ä¸€ç§ç‰¹æ®Šçš„è¯­è¨€ã€‚ æœ‰ä¸€äº›æƒ¯ç”¨çš„æ–¹æ³•æ¥æ„å»ºä½“ç³»ç»“æ„å’Œä¾èµ–é¡¹ã€‚ åœ¨è°ƒç”¨å †æ ˆä¸Šä¸‹ç§»åŠ¨çš„æ•°æ®æ˜¯ç”±è¿­ä»£å™¨ï¼Œåç¨‹å’Œä¸Šä¸‹æ–‡ç®¡ç†å™¨æ‰§è¡Œçš„ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">æœ‰å…³æ­¤ä¸»é¢˜å’Œç¤ºä¾‹çš„è¯¾å ‚æŠ¥å‘Š</b> <div class="spoiler_text">  Brandon Rhodesï¼ŒDropboxï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æå‡æ‚¨çš„IO</a> ã€‚ <br><br> æŠ¥å‘Šä¸­çš„ç¤ºä¾‹ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""          """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">"/etc/hosts"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> file: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> parse_hosts(file): print(line) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_hosts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lines)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    -   """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> lines: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> line.startswith(<span class="hljs-string"><span class="hljs-string">"#"</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> line</code> </pre><br></div></div><br></li><li>  Pythonçš„çµæ´»æ€§æ˜¯è„šä¸‹å°„å‡»çš„ä¸€ç§é¢å¤–æ–¹æ³•ã€‚ æ‚¨éœ€è¦ä¸€å¥—ä¸¥æ ¼çš„è§„åˆ™æ¥ç®¡ç†ä¾èµ–æ€§ã€‚ ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯ä¿„ç½—æ–¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¹²èŸ’è›‡</a>äººã€‚ è¿˜æœ‰ä¸€ç§ä¸å¤ªé‚£ä¹ˆåˆ»æ¿çš„æ–¹æ³•<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-Djangoç»“æ„ï¼Œä»¥å®ç°è§„æ¨¡å’Œå¯¿å‘½</a> ï¼Œä½†æƒ³æ³•æ˜¯ç›¸åŒçš„ã€‚ <br></li></ul><br> å…³äºpythonä¸­çš„ä¾èµ–é¡¹ç®¡ç†ï¼Œæœ‰å‡ ç¯‡æ–‡ç« ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¤ºä¾‹1</a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¤ºä¾‹2</a> ï¼‰ï¼Œä½†æ˜¯å®ƒä»¬å…¨éƒ½å½’ç»“ä¸ºå®£ä¼ æŸäººçš„ä¾èµ–æ³¨å…¥æ¡†æ¶ã€‚ æœ¬æ–‡æ˜¯åŒä¸€ä¸»é¢˜ä¸Šçš„æ–°æ¡ç›®ï¼Œä½†è¿™ä¸€æ¬¡æ˜¯çº¯æ€æƒ³çš„å®éªŒï¼Œæ²¡æœ‰å¹¿å‘Šã€‚ è¿™æ˜¯åœ¨ä¸Šè¿°ä¸‰ç§æ–¹æ³•ä¹‹é—´å¯»æ±‚å¹³è¡¡çš„å°è¯•ï¼Œæ— éœ€é¢å¤–çš„æ¡†æ¶ï¼Œå°±å¯ä»¥ä½¿å…¶æˆä¸ºâ€œ pythonicâ€ã€‚ <br><br> æˆ‘æœ€è¿‘é˜…è¯»äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Clean Architecture-</a>æˆ‘ä¼¼ä¹äº†è§£pythonä¸­çš„ä¾èµ–æ³¨å…¥çš„ä»·å€¼ä»¥åŠå¦‚ä½•å®ç°å®ƒã€‚ æˆ‘åœ¨è‡ªå·±çš„é¡¹ç›®ç¤ºä¾‹ä¸­çœ‹åˆ°äº†è¿™ä¸€ç‚¹ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œè¿™å¯ä»¥<b>é˜²æ­¢ä»£ç åœ¨å…¶ä»–ä»£ç æ›´æ”¹æ—¶</b>è¢«<b>ç ´å</b> ã€‚ <br><br><h1> æºæ•°æ® </h1><br> æœ‰ä¸€ä¸ªAPIå®¢æˆ·ç«¯ï¼Œå®ƒå¯¹æœåŠ¡ç¼©çŸ­ç¨‹åºæ‰§è¡ŒHTTPè¯·æ±‚ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># shortener_client.py import requests class ShortenerClient: def __init__(self, api_key): self.api_key = api_key def shorten_link(self, url): response = requests.post( url='https://fstrk.cc/short', headers={'Authorization': self.api_key}, json={'url': url} ) return response.json()['url']</span></span></code> </pre><br> å¹¶ä¸”æœ‰ä¸€ä¸ªæ¨¡å—å¯ä»¥ç¼©çŸ­æ–‡æœ¬ä¸­çš„æ‰€æœ‰é“¾æ¥ã€‚ ä¸ºæ­¤ï¼Œä»–ä½¿ç”¨äº†ç¼©çŸ­å™¨APIå®¢æˆ·ç«¯ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># text_processor.py import re from shortener_client import ShortenerClient class TextProcessor: def __init__(self, text): self.text = text def process(self): changed_text = self.text links = re.findall( r'https?://[^\r\n\t") ]*', self.text, flags=re.MULTILINE ) api_client = ShortenerClient('abc') for link in links: shortened = api_client.shorten_link(link) changed_text = changed_text.replace(link, shortened) return changed_text</span></span></code> </pre><br> ä»£ç æ‰§è¡Œçš„é€»è¾‘å­˜åœ¨äºå•ç‹¬çš„æ§åˆ¶æ–‡ä»¶ä¸­ï¼ˆæˆ‘ä»¬ç§°å…¶ä¸ºæ§åˆ¶å™¨ï¼‰ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># controller.py from text_processor import TextProcessor processor = TextProcessor("""  1: https://ya.ru  2: https://google.com """) print(processor.process())</span></span></code> </pre><br> ä¸€åˆ‡æ­£å¸¸ã€‚ å¤„ç†å™¨è§£ææ–‡æœ¬ï¼Œä½¿ç”¨ç¼©çŸ­å™¨ç¼©çŸ­é“¾æ¥ï¼Œè¿”å›ç»“æœã€‚ ä¾èµ–å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><img src="http://ftcdn.pw/58d8aa1d-0024-42c6-918e-05b2d41f126d.png" alt="å›¾ç‰‡"><br><br><h1> é—®é¢˜ </h1><br> è¿™æ˜¯é—®é¢˜æ‰€åœ¨ï¼š <code><b>TextProcessor</b></code>ç±»å–å†³äº<code><b>ShortenerClient</b></code>ç±»ï¼Œå¹¶ä¸”<b>åœ¨</b> <code><b>ShortenerClient</b></code> <b>æ¥å£æ›´æ”¹æ—¶ä¸­æ–­</b> ã€‚ <br><br> æ€ä¹ˆä¼šè¿™æ · <br><br> å‡è®¾åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å†³å®šè·Ÿè¸ª<code><b>shorten_link</b></code> ï¼Œå¹¶å°†<code><b>callback_url</b></code>å‚æ•°æ·»åŠ åˆ°<code><b>shorten_link</b></code>æ–¹æ³•ä¸­ã€‚ æ­¤å‚æ•°è¡¨ç¤ºå•å‡»é“¾æ¥æ—¶é€šçŸ¥åº”åˆ°è¾¾çš„åœ°å€ã€‚ <br><br>  <code><b>ShortenerClient.shorten_link</b></code>æ–¹æ³•å¼€å§‹çœ‹èµ·æ¥åƒè¿™æ ·ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shorten_link</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, url, callback_url)</span></span></span><span class="hljs-function">:</span></span> response = requests.post( url=<span class="hljs-string"><span class="hljs-string">'https://fstrk.cc/short'</span></span>, headers={<span class="hljs-string"><span class="hljs-string">'Authorization'</span></span>: self.api_key}, json={<span class="hljs-string"><span class="hljs-string">'url'</span></span>: url, <span class="hljs-string"><span class="hljs-string">'callback_on_click'</span></span>: callback_url} ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response.json()[<span class="hljs-string"><span class="hljs-string">'url'</span></span>]</code> </pre><br> é‚£ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ ç»“æœå‘ç°ï¼Œå½“æˆ‘ä»¬å°è¯•å¯åŠ¨æ—¶ï¼Œå‡ºç°é”™è¯¯ï¼š <br><br><pre> <code class="python hljs">TypeError: shorten_link() missing <span class="hljs-number"><span class="hljs-number">1</span></span> required positional argument: <span class="hljs-string"><span class="hljs-string">'callback_url'</span></span></code> </pre><br> ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ›´æ¢äº†èµ·é…¥æ²¹ï¼Œä½†ä¸æ˜¯ä»–æ‘”åäº†ï¼Œè€Œæ˜¯ä»–çš„å®¢æˆ·ï¼š <br><br><img src="http://ftcdn.pw/13e9dcd5-7866-4c82-b1d0-e56134650b62.png" alt="å›¾ç‰‡"><br><br> é‚£åˆæ€æ · å¥½äº†ï¼Œè°ƒç”¨æ–‡ä»¶åäº†ï¼Œæˆ‘ä»¬å»ä¿®å¤äº†å®ƒã€‚ æ€ä¹ˆäº† <br><br> å¦‚æœä¸€åˆ†é’Ÿå†…è§£å†³äº†è¿™ä¸ªé—®é¢˜-ä»–ä»¬å»äº†å¹¶çº æ­£äº†-é‚£ä¹ˆï¼Œè¿™å½“ç„¶ä¸æ˜¯é—®é¢˜ã€‚ å¦‚æœè¿™äº›ç±»ä¸­çš„ä»£ç å¾ˆå°‘ï¼Œå¹¶ä¸”æ‚¨è‡ªå·±æ”¯æŒï¼ˆè¿™æ˜¯æ‚¨çš„å‰¯é¡¹ç›®ï¼Œè¿™æ˜¯åŒä¸€å­ç³»ç»Ÿçš„ä¸¤ä¸ªå°ç±»ï¼Œç­‰ç­‰ï¼‰ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥åœ¨æ­¤åœæ­¢ã€‚ <br><br> é—®é¢˜å¼€å§‹äºä»¥ä¸‹æ—¶é—´ï¼š <br><br><ul><li> è°ƒç”¨æ¨¡å—å’Œè¢«è°ƒç”¨æ¨¡å—æœ‰å¾ˆå¤šä»£ç ï¼› </li><li> ä¸åŒçš„äºº/å›¢é˜Ÿæ”¯æŒä¸åŒçš„æ¨¡å—ã€‚ </li></ul><br> å¦‚æœæ‚¨ç¼–å†™<code><b>ShortenerClient</b></code>ç±»ï¼Œè€Œæ‚¨çš„åŒäº‹ç¼–å†™<code><b>TextProcessor</b></code> ï¼Œåˆ™ä¼šå‡ºç°ä»¤äººåæ„Ÿçš„æƒ…å†µï¼š <b>æ‚¨æ›´æ”¹äº†ä»£ç ï¼Œä½†æ˜¯ä»£ç </b> <code><b>TextProcessor</b></code> <b>äº†ã€‚</b> å®ƒæ‰“ç ´äº†ä¸€ä¸ªæ‚¨åœ¨ç”Ÿæ´»ä¸­ä»æœªè§è¿‡çš„åœ°æ–¹ï¼Œç°åœ¨æ‚¨éœ€è¦åä¸‹æ¥ç†è§£åˆ«äººçš„ä»£ç ã€‚ <br><br> æ›´æœ‰æ„æ€çš„æ˜¯ï¼Œæ‚¨çš„æ¨¡å—åœ¨å¤šä¸ªåœ°æ–¹è€Œä¸æ˜¯ä¸€ä¸ªåœ°æ–¹ä½¿ç”¨ã€‚ æ‚¨çš„ç¼–è¾‘å°†ç ´åæ–‡ä»¶å †ä¸Šçš„ä»£ç ã€‚ <br><br> å› æ­¤ï¼Œé—®é¢˜å¯ä»¥è¡¨è¿°ä¸ºï¼šå¦‚ä½•ç»„ç»‡ä»£ç ï¼Œä»¥ä¾¿åœ¨æ›´æ”¹<code><b>ShortenerClient</b></code>æ¥å£æ—¶ï¼Œ <code><b>ShortenerClient</b></code> <b>æœ¬èº«<code><b>ShortenerClient</b></code> ï¼Œè€Œä¸æ˜¯å…¶ä½¿ç”¨è€…</b> ï¼ˆå¯èƒ½æœ‰å¾ˆå¤šï¼‰ <b><code><b>ShortenerClient</b></code></b> ï¼Ÿ <br><br> è§£å†³æ–¹æ¡ˆæ˜¯ï¼š <br><br><ul><li> ç±»ä½¿ç”¨è€…å’Œç±»æœ¬èº«å¿…é¡»åœ¨å…¬å…±æ¥å£ä¸Šè¾¾æˆå…±è¯†ã€‚ æ­¤æ¥å£åº”æˆä¸ºæ³•å¾‹ã€‚ </li><li> å¦‚æœè¯¥ç±»ä¸å†å¯¹åº”äºå…¶æ¥å£ï¼Œé‚£å°†æ˜¯å®ƒçš„é—®é¢˜ï¼Œè€Œä¸æ˜¯æ¶ˆè´¹è€…çš„é—®é¢˜ã€‚ </li></ul><br><img src="http://ftcdn.pw/dbb4d320-2683-4f2e-821e-dea621b54b53.png" alt="å›¾ç‰‡"><br><br><h1> å†»ç»“ç•Œé¢ </h1><br> åœ¨pythonä¸­ä¿®å¤æ¥å£æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ è¿™æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> abc <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ABC, abstractmethod <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractClient</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(ABC)</span></span></span><span class="hljs-class">:</span></span> @abstractmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, api_key)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> @abstractmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shorten_link</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, link)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre><br> å¦‚æœç°åœ¨æˆ‘ä»¬ä»æ­¤ç±»ç»§æ‰¿ï¼Œè€Œå¿˜è®°å®ç°æŸäº›æ–¹æ³•ï¼Œåˆ™ä¼šæ”¶åˆ°é”™è¯¯æ¶ˆæ¯ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ShortenerClient</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(AbstractClient)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__ini__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, api_key)</span></span></span><span class="hljs-function">:</span></span> self.api_key = api_key client = ShortenerClient(<span class="hljs-string"><span class="hljs-string">'123'</span></span>) &gt;&gt;&gt; TypeError: Can<span class="hljs-string"><span class="hljs-string">'t instantiate abstract class ShortenerClient with abstract methods __init__, shorten_link</span></span></code> </pre><br> ä½†è¿™è¿˜ä¸å¤Ÿã€‚ æŠ½è±¡ç±»ä»…æ•è·æ–¹æ³•çš„åç§°ï¼Œè€Œä¸æ•è·å…¶ç­¾åã€‚ <br><br> éœ€è¦ç¬¬äºŒä¸ªç­¾åéªŒè¯å·¥å…·ã€‚ç¬¬äºŒä¸ªå·¥å…·æ˜¯<code><b>mypy</b></code> ã€‚ è¿™å°†æœ‰åŠ©äºéªŒè¯ç»§æ‰¿æ–¹æ³•çš„ç­¾åã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æ¥å£ä¸­æ·»åŠ æ³¨é‡Šï¼š <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># shortener_client.py from abc import ABC, abstractmethod class AbstractClient(ABC): @abstractmethod def __init__(self, api_key: str) -&gt; None: pass @abstractmethod def shorten_link(self, link: str) -&gt; str: pass class ShortenerClient(AbstractClient): def __init__(self, api_key: str) -&gt; None: self.api_key = api_key def shorten_link(self, link: str, callback_url: str) -&gt; str: return 'xxx'</span></span></code> </pre><br> å¦‚æœç°åœ¨ä½¿ç”¨<code><b>mypy</b></code>æ£€æŸ¥æ­¤ä»£ç ï¼Œ <code><b>mypy</b></code>ç”±äºå­˜åœ¨é¢å¤–çš„<code><b>callback_url</b></code>å‚æ•°ï¼Œå°†å¯¼è‡´é”™è¯¯ï¼š <br><br><pre> <code class="plaintext hljs">mypy shortener_client.py &gt;&gt;&gt; error: Signature of "shorten_link" incompatible with supertype "AbstractClient"</code> </pre><br> ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ç§å¯é çš„æ–¹æ³•æ¥æäº¤ç±»æ¥å£ã€‚ <br><br><h1> ä¾èµ–å€’ç½® </h1><br> è°ƒè¯•å®Œæ¥å£åï¼Œæˆ‘ä»¬å¿…é¡»å°†å…¶ç§»è‡³å…¶ä»–ä½ç½®ï¼Œä»¥å®Œå…¨æ¶ˆé™¤ä½¿ç”¨è€…å¯¹<code><b>shortener_client.py</b></code>æ–‡ä»¶çš„ä¾èµ–ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°†ç•Œé¢ç›´æ¥æ‹–åŠ¨åˆ°ä½¿ç”¨è€…-ä½¿ç”¨<code><b>TextProcessor</b></code>å¤„ç†å™¨æ‹–åŠ¨åˆ°æ–‡ä»¶ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># text_processor.py import re from abc import ABC, abstractmethod class AbstractClient(ABC): @abstractmethod def __init__(self, api_key: str) -&gt; None: pass @abstractmethod def shorten_link(self, link: str) -&gt; str: pass class TextProcessor: def __init__(self, text, shortener_client: AbstractClient) -&gt; None: self.text = text self.shortener_client = shortener_client def process(self) -&gt; str: changed_text = self.text links = re.findall( r'https?://[^\r\n\t") ]*', self.text, flags=re.MULTILINE ) for link in links: shortened = self.shortener_client.shorten_link(link) changed_text = changed_text.replace(link, shortened) return changed_text</span></span></code> </pre><br> é‚£å°†æ”¹å˜æˆç˜¾çš„æ–¹å‘ï¼ ç°åœ¨ï¼Œ <code><b>TextProcessor</b></code>æ‹¥æœ‰äº¤äº’æ¥å£ï¼Œå› æ­¤ï¼Œ <code><b>ShortenerClient</b></code>ä¾èµ–<code><b>TextProcessor</b></code>æ¥å£ï¼Œåä¹‹åˆ™ä¸ç„¶ã€‚ <br><br><img src="http://ftcdn.pw/33f3c619-63bf-420d-99d0-67bed0dfa628.png" alt="å›¾ç‰‡"><br><br> ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å°†è½¬æ¢çš„æœ¬è´¨æè¿°å¦‚ä¸‹ï¼š <br><br><ul><li>  <code><b>TextProcessor</b></code>è¯´ï¼šæˆ‘æ˜¯å¤„ç†å™¨ï¼Œå¹¶ä¸”å‚ä¸æ–‡æœ¬è½¬æ¢ã€‚ æˆ‘ä¸æƒ³å¯¹ç¼©çŸ­æœºåˆ¶ä¸€æ— æ‰€çŸ¥ï¼šè¿™ä¸æ˜¯æˆ‘çš„äº‹ã€‚ æˆ‘æƒ³æ‹‰<code><b>shorten_link</b></code>æ–¹æ³•ï¼Œä»¥ä¾¿ä¸ºæˆ‘<code><b>shorten_link</b></code>æ‰€æœ‰å†…å®¹ã€‚ æ‰€ä»¥ï¼Œè¯·ç»™æˆ‘ä¸€ä¸ªæŒ‰ç…§æˆ‘çš„è§„åˆ™æ’­æ”¾çš„å¯¹è±¡ã€‚ å…³äºæˆ‘å¦‚ä½•äº’åŠ¨çš„å†³å®šæ˜¯æˆ‘å†³å®šçš„ï¼Œè€Œä¸æ˜¯ä»–ã€‚ </li><li>  <code><b>ShortenerClient</b></code>è¯´ï¼šçœ‹æ¥æˆ‘ä¸èƒ½çœŸç©ºå­˜åœ¨ï¼Œä»–ä»¬è¦æ±‚æˆ‘é‡‡å–æŸäº›è¡Œä¸ºã€‚ æˆ‘ä¼šé—®<code><b>TextProcessor</b></code>æˆ‘éœ€è¦åŒ¹é…ä»€ä¹ˆ<code><b>TextProcessor</b></code> ã€‚ </li></ul><br><h1> å¤šä¸ªæ¶ˆè´¹è€… </h1><br> å¦‚æœå¤šä¸ªæ¨¡å—ä½¿ç”¨ç¼©çŸ­é“¾æ¥ï¼Œåˆ™ä¸éœ€è¦å°†æ¥å£æ”¾åœ¨å…¶ä¸­ä¸€ä¸ªä¸­ï¼Œè€Œæ˜¯æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œè¯¥æ–‡ä»¶ä½äºå…¶ä»–æ–‡ä»¶çš„ä¸Šæ–¹ï¼Œå±‚æ¬¡è¾ƒé«˜ã€‚ <br><br><img src="http://ftcdn.pw/a81ef19a-45aa-4b23-b93a-e9a6b9094670.png" alt="å›¾ç‰‡"><br><br><h1> æ§åˆ¶ç»„ä»¶ </h1><br> å¦‚æœä½¿ç”¨è€…ä¸å¯¼å…¥<code><b>ShortenerClient</b></code> ï¼Œé‚£ä¹ˆè°å°†å¯¼å…¥å®ƒå¹¶åˆ›å»ºä¸€ä¸ªç±»å¯¹è±¡ï¼Ÿ å®ƒåº”è¯¥æ˜¯ä¸€ä¸ªæ§åˆ¶ç»„ä»¶-åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯<code><b>controller.py</b></code> ã€‚ <br><br> æœ€ç®€å•çš„æ–¹æ³•æ˜¯ç›´æ¥çš„ä¾èµ–æ³¨å…¥ï¼Œå³â€œé¢å¤´ä¸Šçš„ä¾èµ–æ³¨å…¥â€ã€‚ æˆ‘ä»¬åœ¨è°ƒç”¨ä»£ç ä¸­åˆ›å»ºå¯¹è±¡ï¼Œç„¶åå°†ä¸€ä¸ªå¯¹è±¡è½¬ç§»åˆ°å¦ä¸€ä¸ªå¯¹è±¡ã€‚ è·åˆ© <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># controller.py import TextProcessor import ShortenerClient processor = TextProcessor( text=' 1: https://ya.ru  2: https://google.com', shortener_client=ShortenerClient(api_key='123') ) print(processor.process())</span></span></code> </pre><br><h1>  Pythonæ–¹æ³• </h1><br> ä¸€ç§æ›´â€œ pythonicâ€çš„æ–¹æ³•è¢«è®¤ä¸ºæ˜¯é€šè¿‡ç»§æ‰¿è¿›è¡Œçš„ä¾èµ–æ³¨å…¥ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">é›·è’™å¾·Â·æµ·å»·æ ¼ï¼ˆRaymond Hettingerï¼‰åœ¨ä»–çš„ã€Šè¶…çº§è¢«è®¤ä¸ºæ˜¯è¶…çº§ã€‹æŠ¥å‘Šä¸­è¯¦ç»†è®¨è®ºäº†è¿™ä¸€ç‚¹ã€‚</b> <div class="spoiler_text"><div class="oembed">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://www.youtube.com/watch?v=EiOglTERPEo</a> </div><br></div></div><br> ä¸ºäº†ä½¿ä»£ç é€‚åº”è¿™ç§é£æ ¼ï¼Œæ‚¨éœ€è¦ç¨å¾®æ›´æ”¹<code><b>TextProcessor</b></code> ï¼Œä½¿å…¶å¯ç»§æ‰¿ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># text_processor.py class TextProcessor: def __init__(self, text: str) -&gt; None: self.text = text self.shortener_client: AbstractClient = self.get_shortener_client() def get_shortener_client(self) -&gt; AbstractClient: """      """ raise NotImplementedError</span></span></code> </pre><br> ç„¶åï¼Œåœ¨è°ƒç”¨ä»£ç ä¸­ç»§æ‰¿å®ƒï¼š <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># controller.py import TextProcessor import ShortenerClient class ProcessorWithClient(TextProcessor): """   ,    """ def get_shortener_client(self) -&gt; ShortenerClient: return ShortenerClient(api_key='abc') processor = ProcessorWithClient( text=' 1: https://ya.ru  2: https://google.com' ) print(processor.process())</span></span></code> </pre><br> ç¬¬äºŒä¸ªç¤ºä¾‹åœ¨æµè¡Œçš„æ¡†æ¶ä¸­æ— å¤„ä¸åœ¨ï¼š <br><br><ul><li> åœ¨Djangoï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨ç»§æ‰¿ã€‚ æˆ‘ä»¬é‡æ–°å®šä¹‰åŸºäºç±»çš„è§†å›¾ï¼Œæ¨¡å‹ï¼Œå½¢å¼çš„æ–¹æ³•ï¼› æ¢å¥è¯è¯´ï¼Œå°†æˆ‘ä»¬çš„ä¾èµ–é¡¹æ³¨å…¥æ¡†æ¶çš„å·²è°ƒè¯•å·¥ä½œä¸­ã€‚ </li><li> åœ¨DRFä¸­ï¼ŒåŒæ ·çš„äº‹æƒ…ã€‚ æˆ‘ä»¬æ­£åœ¨æ‰©å±•è§†å›¾ï¼Œåºåˆ—åŒ–ç¨‹åºï¼Œæƒé™ã€‚ </li><li> ä¾æ­¤ç±»æ¨ã€‚ æœ‰å¾ˆå¤šä¾‹å­ã€‚ </li></ul><br> ç¬¬äºŒä¸ªä¾‹å­çœ‹èµ·æ¥æ›´æ¼‚äº®ï¼Œæ›´ç†Ÿæ‚‰äº†ï¼Œä¸æ˜¯å—ï¼Ÿ è®©æˆ‘ä»¬å¼€å‘å®ƒï¼Œçœ‹çœ‹è¿™ç§ç¾ä¸½æ˜¯å¦å¾—ä»¥ä¿ç•™ã€‚ <br><br><h1>  Pythonå¼€å‘ </h1><br> åœ¨ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œé€šå¸¸æœ‰ä¸¤ä¸ªä»¥ä¸Šçš„ç»„ä»¶ã€‚ å‡è®¾æˆ‘ä»¬çš„<code><b>TextProcessor</b></code>ä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç±»ï¼Œè€Œæ˜¯ä»…ä¸€ä¸ªå¤„ç†æ–‡æœ¬å¹¶å°†å…¶å‘é€åˆ°é‚®ä»¶çš„<code><b>TextPipeline</b></code>å…ƒç´ ä¹‹ä¸€ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TextPipeline</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, text, email)</span></span></span><span class="hljs-function">:</span></span> self.text_processor = TextProcessor(text) self.mailer = Mailer(email) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process_and_mail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> processed_text = self.text_processor.process() self.mailer.send_text(text=processed_text)</code> </pre><br> å¦‚æœè¦ä»ä½¿ç”¨çš„ç±»ä¸­éš”ç¦»<code><b>TextPipeline</b></code> ï¼Œåˆ™å¿…é¡»éµå¾ªä¸ä¹‹å‰ç›¸åŒçš„è¿‡ç¨‹ï¼š <br><br><ul><li>  <code><b>TextPipeline</b></code>ç±»å°†å£°æ˜æ‰€ä½¿ç”¨ç»„ä»¶çš„æ¥å£ï¼› </li><li> ä½¿ç”¨è¿‡çš„ç»„ä»¶å°†è¢«è¿«éµå¾ªè¿™äº›æ¥å£ï¼› </li><li> ä¸€äº›å¤–éƒ¨ä»£ç ä¼šå°†æ‰€æœ‰å†…å®¹æ”¾åœ¨ä¸€èµ·å¹¶è¿è¡Œã€‚ </li></ul><br> ä¾èµ–å…³ç³»å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><img src="http://ftcdn.pw/35f207fa-3ad7-4779-92c3-ae8f63401b8e.png" alt="å›¾ç‰‡"><br><br> ä½†æ˜¯è¿™äº›ä¾èµ–é¡¹çš„æ±‡ç¼–ä»£ç ç°åœ¨å°†æ˜¯ä»€ä¹ˆæ ·ï¼Ÿ <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TextProcessor <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ShortenerClient <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Mailer <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TextPipeline <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProcessorWithClient</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TextProcessor)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_shortener_client</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function"> -&gt; ShortenerClient:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ShortenerClient(api_key=<span class="hljs-string"><span class="hljs-string">'123'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PipelineWithDependencies</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TextPipeline)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_text_processor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, text: str)</span></span></span><span class="hljs-function"> -&gt; ProcessorWithClient:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ProcessorWithClient(text) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_mailer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, email: str)</span></span></span><span class="hljs-function"> -&gt; Mailer:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Mailer(email) pipeline = PipelineWithDependencies( email=<span class="hljs-string"><span class="hljs-string">'abc@def.com'</span></span>, text=<span class="hljs-string"><span class="hljs-string">' 1: https://ya.ru  2: https://google.com'</span></span> ) pipeline.process_and_mail()</code> </pre><br> ä½ æ³¨æ„åˆ°äº†å—ï¼Ÿ æˆ‘ä»¬é¦–å…ˆç»§æ‰¿<code><b>TextProcessor</b></code>ç±»ï¼Œä»¥å°†<code><b>ShortenerClient</b></code>æ’å…¥å…¶ä¸­ï¼Œç„¶åç»§æ‰¿<code><b>TextPipeline</b></code>ä»¥å°†é‡æ–°å®šä¹‰çš„<code><b>TextProcessor</b></code> ï¼ˆä»¥åŠ<code><b>Mailer</b></code> ï¼‰æ’å…¥å…¶ä¸­ã€‚ æˆ‘ä»¬æœ‰å‡ ä¸ªçº§åˆ«çš„é¡ºåºé‡æ–°å®šä¹‰ã€‚ å·²ç»å¾ˆå¤æ‚äº†ã€‚ <br><br> ä¸ºä»€ä¹ˆæ‰€æœ‰æ¡†æ¶éƒ½ä»¥è¿™ç§æ–¹å¼ç»„ç»‡ï¼Ÿ  <b>æ˜¯çš„ï¼Œå› ä¸ºå®ƒä»…é€‚ç”¨äºæ¡†æ¶ã€‚</b> <br><br><ul><li> æ¡†æ¶çš„æ‰€æœ‰çº§åˆ«å‡å·²æ˜ç¡®å®šä¹‰ï¼Œå¹¶ä¸”æ•°é‡æœ‰é™ã€‚ ä¾‹å¦‚ï¼Œåœ¨Djangoä¸­ï¼Œæ‚¨å¯ä»¥è¦†ç›–<code><b>FormField</b></code>ä»¥å°†å…¶æ’å…¥åˆ°<code><b>Form</b></code>çš„è¦†ç›–ä¸­ï¼Œä»¥å°†è¡¨å•æ’å…¥åˆ°<code><b>View</b></code>çš„è¦†ç›–ä¸­ã€‚ ä»…æ­¤è€Œå·²ã€‚ ä¸‰ä¸ªçº§åˆ«ã€‚ </li><li> æ¯ä¸ªæ¡†æ¶éƒ½æœ‰ä¸€ä¸ªç›®çš„ã€‚ æ˜ç¡®å®šä¹‰äº†æ­¤ä»»åŠ¡ã€‚ </li><li> æ¯ä¸ªæ¡†æ¶éƒ½æœ‰è¯¦ç»†çš„æ–‡æ¡£ï¼Œæè¿°äº†ç»§æ‰¿æ–¹å¼å’Œç»§æ‰¿æ–¹å¼ã€‚ ä»€ä¹ˆä»¥åŠå¦‚ä½•ç»“åˆã€‚ </li></ul><br> æ‚¨èƒ½å¦æ¸…æ¥šï¼Œæ˜ç¡®åœ°è¯†åˆ«å’Œè®°å½•æ‚¨çš„ä¸šåŠ¡é€»è¾‘ï¼Ÿ å°¤å…¶æ˜¯å…¶å·¥ä½œçº§åˆ«çš„ä½“ç³»ç»“æ„ï¼Ÿ æˆ‘ä¸çŸ¥é“ ä¸å¹¸çš„æ˜¯ï¼ŒRaymond Hettingerçš„æ–¹æ³•æ— æ³•é€‚åº”ä¸šåŠ¡é€»è¾‘ã€‚ <br><br><h1> å›åˆ°é¢å¤´æ–¹æ³• </h1><br> åœ¨å‡ ä¸ªéš¾åº¦çº§åˆ«ä¸Šï¼Œä¸€ç§ç®€å•çš„æ–¹æ³•ä¼šè·èƒœã€‚ çœ‹èµ·æ¥æ›´ç®€å•-é€»è¾‘æ›´æ”¹æ—¶æ›´å®¹æ˜“æ›´æ”¹ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TextProcessor <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ShortenerClient <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Mailer <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TextPipeline pipeline = TextPipeline( text_processor=TextProcessor( text=<span class="hljs-string"><span class="hljs-string">' 1: https://ya.ru  2: https://google.com'</span></span>, shortener_client=ShortenerClient(api_key=<span class="hljs-string"><span class="hljs-string">'abc'</span></span>) ), mailer=Mailer(<span class="hljs-string"><span class="hljs-string">'abc@def.com'</span></span>) ) pipeline.process_and_mail()</code> </pre><br> ä½†æ˜¯ï¼Œå½“é€»è¾‘çº§åˆ«çš„æ•°é‡å¢åŠ æ—¶ï¼Œå³ä½¿è¿™ç§æ–¹æ³•ä¹Ÿå˜å¾—ä¸æ–¹ä¾¿ã€‚ æˆ‘ä»¬å¿…é¡»å¼ºåˆ¶å¯åŠ¨ä¸€å †ç±»ï¼Œå¹¶å°†å®ƒä»¬å½¼æ­¤ä¼ é€’ã€‚ æˆ‘æƒ³é¿å…å¾ˆå¤šå±‚æ¬¡çš„åµŒå¥—ã€‚ <br><br> è®©æˆ‘ä»¬å†æ‰“ä¸€ä¸ªç”µè¯ã€‚ <br><br><h1> å…¨å±€å®ä¾‹å­˜å‚¨ </h1><br> è®©æˆ‘ä»¬å°è¯•åˆ›å»ºä¸€ä¸ªå…¨å±€å­—å…¸ï¼Œå…¶ä¸­å°†åŒ…å«æˆ‘ä»¬æ‰€éœ€ç»„ä»¶çš„å®ä¾‹ã€‚ å¹¶è®©è¿™äº›ç»„ä»¶é€šè¿‡è®¿é—®æ­¤å­—å…¸ç›¸äº’è”ç³»ã€‚ <br><br> æˆ‘ä»¬ç§°ä¹‹ä¸º<code><b>INSTANCE_DICT</b></code> ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># text_processor.py import INSTANCE_DICT class TextProcessor(AbstractTextProcessor): def __init__(self, text) -&gt; None: self.text = text def process(self) -&gt; str: shortener_client: AbstractClient = INSTANCE_DICT['Shortener'] # ...  </span></span></code> </pre><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># text_pipeline.py import INSTANCE_DICT class TextPipeline: def __init__(self) -&gt; None: self.text_processor: AbstractTextProcessor = INSTANCE_DICT[ 'TextProcessor'] self.mailer: AbstractMailer = INSTANCE_DICT['Mailer'] def process_and_mail(self) -&gt; None: processed_text = self.text_processor.process() self.mailer.send_text(text=processed_text)</span></span></code> </pre><br> è¯€çªæ˜¯<b>åœ¨è®¿é—®å¯¹è±¡ä¹‹å‰å°†å…¶æ”¾å…¥æ­¤å­—å…¸ä¸­</b> ã€‚ è¿™å°±æ˜¯æˆ‘ä»¬å°†åœ¨<code><b>controller.py</b></code> ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># controller.py import INSTANCE_DICT import TextProcessor import ShortenerClient import Mailer import TextPipeline INSTANCE_DICT['Shortener'] = ShortenerClient('123') INSTANCE_DICT['Mailer'] = Mailer('abc@def.com') INSTANCE_DICT['TextProcessor'] = TextProcessor(text=' : https://ya.ru') pipeline = TextPipeline() pipeline.process_and_mail()</span></span></code> </pre><br> é€šè¿‡å…¨å±€è¯å…¸å·¥ä½œçš„ä¼˜ç‚¹ï¼š <br><br><ul><li> æ²¡æœ‰å¼•æ“ç›–é­”æœ¯å’Œé¢å¤–çš„DIæ¡†æ¶ï¼› </li><li> ä¸éœ€è¦ç®¡ç†åµŒå¥—çš„ä¾èµ–é¡¹çš„ç®€å•åˆ—è¡¨ï¼› </li><li> æ‰€æœ‰DIå¥–åŠ±ï¼šç®€å•çš„æµ‹è¯•ï¼Œç‹¬ç«‹æ€§ï¼Œåœ¨å…¶ä»–ç»„ä»¶å‘ç”Ÿæ›´æ”¹æ—¶ä¿æŠ¤ç»„ä»¶å…äºæ•…éšœã€‚ </li></ul><br> å½“ç„¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æŸç§DIæ¡†æ¶æ¥ä»£æ›¿<code><b>INSTANCE_DICT</b></code>åˆ›å»º<code><b>INSTANCE_DICT</b></code> ã€‚ ä½†è¿™æœ¬è´¨ä¸ä¼šæ”¹å˜ã€‚ è¯¥æ¡†æ¶å°†æä¾›æ›´çµæ´»çš„å®ä¾‹ç®¡ç†ï¼› ä»–å°†å…è®¸æ‚¨åƒå·¥å‚ä¸€æ ·ä»¥å•è°ƒæˆ–æˆæŸçš„å½¢å¼åˆ›å»ºå®ƒä»¬ï¼› ä½†æƒ³æ³•å°†ä¿æŒä¸å˜ã€‚ <br><br> ä¹Ÿè®¸åœ¨æŸäº›æ—¶å€™è¿™å¯¹æˆ‘æ¥è¯´è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»ç„¶é€‰æ‹©æŸç§æ¡†æ¶ã€‚ <br><br> è€Œä¸”ï¼Œä¹Ÿè®¸æ‰€æœ‰è¿™äº›éƒ½æ˜¯ä¸å¿…è¦çš„ï¼Œå¹¶ä¸”æ²¡æœ‰å®ƒå°±æ›´å®¹æ˜“åšåˆ°ï¼šç¼–å†™ç›´æ¥å¯¼å…¥è€Œä¸åˆ›å»ºä¸å¿…è¦çš„æŠ½è±¡æ¥å£ã€‚ <br><br> æ‚¨åœ¨pythonä¸­è¿›è¡Œä¾èµ–ç®¡ç†æœ‰ä»€ä¹ˆç»éªŒï¼Ÿ æ€»çš„æ¥è¯´-æ˜¯å¦æœ‰å¿…è¦ï¼Œè¿˜æ˜¯æˆ‘ä»ç©ºä¸­å‘æ˜äº†ä¸€ä¸ªé—®é¢˜ï¼Ÿ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN461511/">https://habr.com/ru/post/zh-CN461511/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN461501/index.html">ä¸ºä»€ä¹ˆåœ¨ç¾å›½ä»–ä»¬æ­£åœ¨è°ƒæŸ¥å¤§å‹ITå…¬å¸çš„å·¥ä½œ</a></li>
<li><a href="../zh-CN461503/index.html">ä½¿æ•°æ®åº“å¯ç”¨äºè¿œç¨‹è¿æ¥</a></li>
<li><a href="../zh-CN461505/index.html">JavaScriptæ–°æ‰‹å¼€å‘äººå‘˜çš„8ä¸ªé”™è¯¯â€‹â€‹ä½¿æ‚¨æ— æ³•æˆä¸ºä¸“ä¸šäººå£«</a></li>
<li><a href="../zh-CN461507/index.html">æˆ‘ä»¬ä¸ºä»€ä¹ˆå†³å®šå¯åŠ¨Gazprom Neftå…¬å¸åŠ é€Ÿå™¨StartupDriveï¼Œä»¥åŠè°é€šè¿‡äº†å®ƒ</a></li>
<li><a href="../zh-CN461509/index.html">æ—…è¡ŒåŠ©æ‰‹ï¼šå„ç§å°å·¥å…·å’Œé…ä»¶</a></li>
<li><a href="../zh-CN461517/index.html">é€‚ç”¨äºCå’ŒC ++çš„æœ€ä½³å¤åˆ¶ç²˜è´´ç®—æ³•ã€‚ Haiku OSé£Ÿè°±</a></li>
<li><a href="../zh-CN461519/index.html">é€‚ç”¨äºCå’ŒC ++çš„æœ€ä½³å¤åˆ¶ç²˜è´´ç®—æ³•ã€‚ Haiku OSé£Ÿè°±é›†</a></li>
<li><a href="../zh-CN461523/index.html">PostgreSQLä¸­çš„WALï¼š4.æ—¥å¿—è®¾ç½®</a></li>
<li><a href="../zh-CN461525/index.html">æˆ‘å¦‚ä½•åšä¸€ä¸ªçœŸæ­£çš„è‡ªé€‚åº”æ»‘å—ï¼ˆè½®æ’­ï¼‰</a></li>
<li><a href="../zh-CN461527/index.html">DIYå£°æ‚¬æµ®</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>