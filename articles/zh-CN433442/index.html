<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👸🏼 🛍️ 💯 实体框架核心2.2发布。 最新消息 （3之3） 🏹 😥 🤳🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="12月4日，EF Core 2.2的最终版本发布。 它与ASP.NET Core 2.2和.NET Core 2.2并行发布，是用于管理语言对象和数据库之间映射的我们的开源和跨平台技术的最新版本。 


 EF Core 2.2 RTM包含一百多个修复程序和几个新功能，我们将在本文中进行讨论。 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>实体框架核心2.2发布。 最新消息 （3之3）</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/433442/"><p>  12月4日，EF Core 2.2的最终版本发布。 它与<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ASP.NET Core 2.2</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">.NET Core 2.2</a>并行发布，是用于管理语言对象和数据库之间映射的我们的开源和跨平台技术的最新版本。 </p><br><p>  EF Core 2.2 RTM包含<strong>一百多个</strong>修复程序和几个新功能，我们将在本文中进行讨论。 </p><br><p> 链接指向哈布雷的相应文章。 这是该系列的最后第三篇文章。 下次我们将讨论新版本-它将在新的一年。 </p><br><p><img src="https://habrastorage.org/webt/ho/zs/w4/hozsw4aeeowh0gvla7g87vkzzxe.png"></p><a name="habracut"></a><br><h1 id="prostranstvennye-dannye"> 空间数据 </h1><br><p> 空间数据用于存储对象的物理位置和形状。 许多现有的数据库都有用于存储，索引和检索此类数据的内置方法。 主要的使用场景是在选定距离处搜索对象，并检查某些多边形是否包含给定点。  EF Core 2.2现在将能够使用NetTopologySuite（NTS）库中的类型来处理此类数据库和其中的地理数据。 </p><br><p> 空间数据被实现为特殊提供程序的扩展包集。 这些软件包中的每一个都添加了NTS类型和方法的新映射以及数据库中相应的空间类型和功能。 此类提供程序扩展已经为SQL Server，SQLite和PostgreSQL实现（感谢Npgsql项目）。 空间类型可以与内存提供程序EF Core一起直接使用，而无需使用任何其他扩展。 </p><br><p> 安装扩展程序后，将包括对新类型的支持。 这些类型的属性可以在其实体中使用，例如： </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> NetTopologySuite.Geometries; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyApp</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Friend</span></span> { [Key] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Required] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Point Location { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } }</code> </pre> <br><p> 当然，现在您可以保存以下数据： </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> context = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyDbContext()) { context.Add( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Friend { Name = <span class="hljs-string"><span class="hljs-string">"Bill"</span></span>, Location = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(<span class="hljs-number"><span class="hljs-number">-122.34877</span></span>, <span class="hljs-number"><span class="hljs-number">47.6233355</span></span>) {SRID = <span class="hljs-number"><span class="hljs-number">4326</span></span> } }); context.SaveChanges(); }</code> </pre> <br><p> 同样，可以对涉及空间数据和操作的数据库进行查询： </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nearestFriends = (<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> context.Friends <span class="hljs-keyword"><span class="hljs-keyword">orderby</span></span> f.Location.Distance(myLocation) <span class="hljs-keyword"><span class="hljs-keyword">descending</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> f).Take(<span class="hljs-number"><span class="hljs-number">5</span></span>).ToList();</code> </pre> <br><p> 空间数据是一个重要的话题，您应该从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">官方文档</a>开始。 </p><br><h1 id="kollekcii-zavisimyh-suschnostey"> 相关实体的集合 </h1><br><p>  EF Core 2.0引入了对一对一关系进行建模的功能。  EF Core 2.2扩展了此功能，可以直接指出在这方面谁是主要实体（所有者）以及谁是从属实体（拥有）。 这使您可以限制和阐明实体的范围。 </p><br><p> 例如，从属实体： </p><br><ul><li> 它们只能用于其他类型的实体中包含的参考属性（ <em>英文为“ navigation property”</em> ）中； </li><li> 仅在<code>DbContext</code>及其主要实体中自动加载和跟踪。 </li></ul><br><p> 在关系数据库中，相关集合不显示在主要实体的表中，而是显示在单独的表中，类似于通常的一对多关系。 在面向文档的数据库中，一切都有些不同，我们计划将相关实体（在相关集合或链接中）嵌入存储主要实体的同一文档中。 </p><br><p> 您可以通过调用新的<code>OwnsMany()</code> API来使用该功能： </p><br><pre> <code class="cs hljs">modelBuilder.Entity&lt;Customer&gt;().OwnsMany(c =&gt; c.Addresses);</code> </pre> <br><p> 有关更多信息，请参阅<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文档</a> 。 </p><br><h1 id="metki-zaprosov-query-tags"> 查询标签 </h1><br><p> 此功能旨在简化在代码中的LINQ查询与从中生成的SQL查询之间找到连接的任务，可以在日志中找到它们。 </p><br><p> 要启用标签，请使用新的<code>TagWith()</code>方法注释LINQ查询。 让我们从空间数据部分修改前面的示例： </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nearestFriends = (<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> context.Friends.TagWith(<span class="hljs-string"><span class="hljs-string">@"This is my spatial query!"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">orderby</span></span> f.Location.Distance(myLocation) <span class="hljs-keyword"><span class="hljs-keyword">descending</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> f).Take(<span class="hljs-number"><span class="hljs-number">5</span></span>).ToList();</code> </pre> <br><p> 您可以在日志中看到以下文本： </p><br><pre> <code class="cs hljs">-- This <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> my spatial query! <span class="hljs-function"><span class="hljs-function">SELECT </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TOP</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">@__p_1</span></span></span><span class="hljs-function">) [f].[Name], [f].[Location] FROM [Friends] AS [f] ORDER BY [f].[Location].</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">STDistance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">@__myLocation_0</span></span></span><span class="hljs-function">) DESC</span></span></code> </pre> <br><p> 与往常一样，有一个[文档中的章节]。 </p><br><h1 id="sovmestimost-s-ef-core-21"> 与EF Core 2.1兼容 </h1><br><p> 我们花费了大量时间和精力来确保EF Core 2.2与EF Core 2.1的现有提供程序的向后兼容性，并确保将其更新到EF Core 2.2之后就可以正确地组装应用程序。 在大多数情况下，很可能会很容易地迁移到新版本，但是尽管如此，如果您突然遇到问题，还是值得在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">我们的bugtracker中进行讨论</a> 。 </p><br><p> 目前，只有一项更改可能需要对应用程序代码进行少量更改。 您可以在以下票证的描述中了解它： </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">＃13986</a> ：既配置为常规属性又配置为从属属性的类型，要求从2.1升级到2.2后立即创建主键。 </li></ul><br><p> 我们打算继续维护和更新需要修改旧代码<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的问题列表</a> 。 </p><br><h1 id="chto-dalshe-ef-core-30"> 下一步：EF Core 3.0 </h1><br><p> 在2.2版发布之后，我们的下一个目标是EF Core 3.0。 我们尚未实现任何新功能，因此12月4日发布的<a href="">NuGet软件包</a>仅包含EF Core 2.2发行后进行的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一些小更改</a> 。 </p><br><p> 对于下一个版本，已经计划了一些广泛讨论的大创意。 我们想在以后的新闻发布中谈论它们，但是这里有一些您已经可以说出一些话的话题： </p><br><ul><li><p>  <strong>LINQ的改进</strong> 。  LINQ允许您使用类型信息显示IntelliSense并在编译时进行验证，而无需从主要语言切换为数据库语言来编写数据库查询。 但这也意味着LINQ允许您编写无限数量的复杂查询，这对于LINQ提供程序始终是一个真正的挑战。 在EF Core的第一个版本中，我们通过确定请求的哪些部分可以转换为SQL，然后允许使用该客户端的内存直接在客户端上执行其余请求，来解决此问题。 这种客户端执行有时会很有用，但在许多情况下会导致效率极低的请求，这些请求只有在代码投入生产后才能找到。  EF Core 3.0希望彻底改变LINQ内部结构以及如何对其进行测试。 有必要使它们更加耐用和可靠（例如，以便在滚动新补丁发布后请求不会中断）； 在SQL中实现大量表达式的正确翻译； 专注于生成在更多情况下更有效地工作的查询； 考虑到效率低下的请求不会被忽视。 </p><br></li><li><p>  <strong>Cosmos DB支持</strong> 。 我们将继续为EF Core提供Cosmos DB提供程序，以便熟悉EF编程模型的开发人员可以立即将Azure Cosmos DB作为主要基础。 面临的挑战是如何利用Cosmos DB中的最佳资源，例如全球分布，“始终在线”可用性，弹性可伸缩性，低延迟等。  EF Core提供程序应提供大多数可用功能。 我们早在EF Core 2.2之前就开始这样做，甚至发布了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一些初步版本</a> 。 我们将继续与EF Core 3.0并行开发提供程序。 </p><br></li><li><p>  <strong>支持C＃8.0</strong> 。  C＃8.0具有一些<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">有用的新</a>功能，例如异步流（包括<code>await foreach</code> ）和EF Core支持的可为空的引用类型。 </p><br></li><li><p>  <strong>将数据库反转为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">查询类型</a></strong> 。  EF Core 2.1增加了对查询类型的支持，这些查询类型表示可以从数据库读取但无法更新的数据。 它们非常适合在SQL数据库中为视图建模，因此EF Core 3.0希望自动化其创建。 </p><br></li><li><p>  <strong>财产袋实体</strong> 。 这会添加实体，这些实体不是在普通属性中而是在索引属性中存储数据，并且可以使用.NET中同一类的实例（例如，诸如<code>Dictionary&lt;string, object&gt;</code>类的东西）在一个实体中显示许多不同类型的实体。和相同的EF Core模型。 此功能是在不使用统一实体的情况下通往成熟的多对多关系的下一步，这是EF Core最令人期待的功能之一。 </p><br></li><li><p>  <strong>.NET Core上的EF 6.3</strong> 。 显而易见，现在有许多使用EF的应用程序，将它们移植到EF Core只是为了从使用.NET Core获得一些好处，有时需要付出很多努力。 因此，我们将适应EF 6的下一个版本，以便它也可以在.NET Core 3.0上开始工作。 这是为了鼓励开发人员移植其应用程序，以便他们必须更改尽可能少的代码。 当然，这将导致许多限制（例如，将需要新的提供程序，并且不会为SQL Server启用空间数据支持）。 此外，我们不打算向EF 6添加任何其他功能。 </p><br></li></ul><br><h1 id="zaklyuchenie"> 结论 </h1><br><p>  EF团队感谢社区的质量反馈和开发帮助，最终促成了EF Core 2.2的引入。 与往常一样，我们提醒您可以将新的水<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">直接</a>添加<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">到我们的跟踪器中</a> 。 谢谢你 </p><br><blockquote> 不要忘记，从1月1日开始的DotNext门票价格会上涨。 个人-一千，标准-两千。 有关Early Bird的详细信息<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在网站上</a> 。 </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN433442/">https://habr.com/ru/post/zh-CN433442/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN433430/index.html">新鲜的SoC Amlogic S905X2上具有4 GB RAM和Android TV 8.1的Android盒子Mecool KM9-了解并原谅</a></li>
<li><a href="../zh-CN433432/index.html">GraalVM可以做的十件事</a></li>
<li><a href="../zh-CN433434/index.html">“绝对不需要Pascal，尤其是Basic，”：对体育编程培训师的采访</a></li>
<li><a href="../zh-CN433436/index.html">绩效研究介绍</a></li>
<li><a href="../zh-CN433438/index.html">国家杜马将限制众筹</a></li>
<li><a href="../zh-CN433446/index.html">安全周51：WordPress 5.0和Logitech软件中的错误，Facebook照片漏洞</a></li>
<li><a href="../zh-CN433448/index.html">二手市场比较分析 B和C部分的德国和法国汽车</a></li>
<li><a href="../zh-CN433450/index.html">成长和教导。 我们如何与PEGA交朋友</a></li>
<li><a href="../zh-CN433456/index.html">如何说服客户或公司使用Flutter</a></li>
<li><a href="../zh-CN433462/index.html">运行状况检查和分布式系统的逐步降级</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>