<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌩️ 👘 🧛🏿 从Dribbble到Android Motion 🙅🏻 👩🏿‍🤝‍👩🏾 🤤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在Internet上，有许多有趣的动画模板，这些模板带有精美的移动应用程序用户界面，但是实现这些界面的示例并不多。 尽管Android SDK中包含各种内置的框架和工具，但对于新手开发人员来说，要实现漂亮的用户界面（包括现成的模板）通常并不容易。 

 在本文中，我们将尝试实现由设计师Ivan Pa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>从Dribbble到Android Motion</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423235/"><img src="https://habrastorage.org/webt/1f/ik/0y/1fik0y6mjvsy1x6qgcgzpaqgx8a.png"><br><br> 在Internet上，有许多有趣的动画模板，这些模板带有精美的移动应用程序用户界面，但是实现这些界面的示例并不多。 尽管Android SDK中包含各种内置的框架和工具，但对于新手开发人员来说，要实现漂亮的用户界面（包括现成的模板）通常并不容易。 <br><br> 在本文中，我们将尝试实现由设计师Ivan Parfyonov为PLATES工作室开发的用户界面。 <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mw/ue/3o/mwue3ov1hvefjixsf9uq8cfis6i.gif" width="640" height="480"></div><br> 首先，创建两个片段： <code>RecyclerFragment</code>和<code>DetailsFragment</code> 。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_-/y0/gs/_-y0gsqq2iheehhv6n6m8hllyki.png"></div><br><h3>  Android Transition框架？ </h3><br>  Android Transition框架运作良好，但有一些细微差别。 首先，我们希望一切都至少可以在API 19上为我们工作，其次，我们需要同时对多个用户元素进行动画处理，其中一些仅存在于一个片段中。 因此，我们使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>ViewPropertyAnimator</code></a>手动实现过渡元素（共享元素过渡）的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>ViewPropertyAnimator</code></a> 。 <br><br><h3> 全部按顺序 </h3><br><ol><li> 我们从列表中计算所选元素的最终坐标（其坐标在<code>DerailsFragment</code> ），列表为<code>RecyclerView</code> ； </li><li> 我们保存当前坐标（ <code>RecyclerFragment</code>坐标），并将它们传递给<code>DetailsFragment</code> （这对于API &lt;21的反向动画是必需的）； </li><li> 从列表中创建所选项目的副本； </li><li> 我们使选定的元素不可见（不是副本，而是元素本身）； </li><li> 将在第3步中创建的副本添加到父片段的根布局中，在本例中为<code>RecyclerFragment</code> ； </li><li> 我们开始其余界面元素的动画，并将创建的副本移动到步骤1中的最终坐标； </li><li> 动画结束后，创建一个事务并显示<code>DetailsFragment</code> ; </li><li> 我们开始在<code>DetailsFragment</code>中<code>DetailsFragment</code>界面元素的<code>DetailsFragment</code> 。 </li></ol><br><h3>  UI元素动画 </h3><br> 为了给<code>Toolbar</code>制作动画<code>Toolbar</code>我们将在<code>RecyclerFragment</code>创建一个附加的<code>View</code> ，并将其放置在顶部屏幕的后面。 将使用<code>ViewPropertyAnimator</code>在“详细信息<code>DetailsFragment</code> （在gif中为蓝色）中的“ <code>Toolbar</code>容器中<code>DetailsFragment</code> <code>View</code>进行动画<code>ViewPropertyAnimator</code> 。 <br><br><pre> <code class="hljs objectivec">&lt;View android:<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>=<span class="hljs-string"><span class="hljs-string">"@+id/details_toolbar_helper"</span></span> android:layout_width=<span class="hljs-string"><span class="hljs-string">"wrap_content"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"@dimen/details_toolbar_container_height"</span></span> android:background=<span class="hljs-string"><span class="hljs-string">"@color/colorPrimary"</span></span> app:layout_constraintTop_toTopOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span>/&gt; <span class="hljs-comment"><span class="hljs-comment">// In RecyclerFragment details_toolbar_helper.translationY = -details_toolbar_helper.height</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gw/sm/3z/gwsm3zijdtpledns5la0lcdzi0y.gif" alt="图片"></div><br>  <code>BottomNavigationView</code>和<code>RecyclerView</code>动画<code>BottomNavigationView</code>可以使用<code>ViewPropertyAnimator</code> <code>BottomNavigationView</code>实现，这并不复杂（更改透明度和移动）。 <br><br><h3> 过渡框架的一点点 </h3><br> 简而言之，然后当android transition框架开始对过渡元素进行动画处理时，创建该过渡元素的内容的副本（类似于打印屏幕），从该副本制作一个ImageView，然后将该图片添加到叠加层中的额外叠加层被调用的片段并开始动画。 <br><br>  android过渡框架不太适合我们，因为 当过渡元素动画开始时，该片段中的所有其他用户界面元素都将被销毁，因此我们无法为其设置动画。 即 当我们单击<code>RecyclerFragment</code>的列表项以打开<code>DetailsFragment</code>并开始过渡动画时， <code>RecyclerFragment</code>所有其他接口元素<code>RecyclerFragment</code>破坏而没有动画。 <br><br> 为了获得所需的结果，我们将手动创建一个从列表中选择的元素的副本，将其添加到叠加层，然后进行动画处理。 但是这里出现一个小问题， <code>ViewGroupOverlay add(view: View)</code>方法的文档说： <br><blockquote> 如果视图有父视图，则在将视图添加到叠加层之前，将从该父视图中删除该视图。 </blockquote><br> 但是对于<code>RecyclerView</code>此操作不起作用，将选定的项目添加到叠加层后，不会将其从<code>RecyclerView</code>删除。 <br><br> 将所选项目添加到叠加层时，会发生以下情况： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vq/ma/wb/vqmawbr_kn5wjnqkdr6-igjoouu.gif"></div><br><br> 我们需要这个： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/t4/_w/lj/t4_wljnxye_ywpwvlxlewpqezac.gif"></div><br><br> 因此，我们将不使用覆盖层，而是将副本立即添加到根布局中。 创建所选项目内容的副本，将其添加到<code>ImageView</code>并设置坐标： <br><br><pre> <code class="hljs coffeescript">fun View.copyViewImage(): View { val copy = ImageView(context) val bitmap = drawToBitmap() copy.setImageBitmap(bitmap) <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  pre-Lollipop   ,   card view  ,      card view <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) { CardView(context).apply { cardElevation = resources.getDimension(R.dimen.card_elevation) radius = resources.getDimension(R.dimen.card_corner_radius) addView(copy) } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { copy }).apply { layoutParams = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>@copyViewImage.layoutParams layoutParams.height = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>@copyViewImage.height layoutParams.width = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>@copyViewImage.width x = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>@copyViewImage.x y = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>@copyViewImage.y } }</code> </pre> <br><br>  <i>如果仅可以对列表中直接选择的项目设置动画，为什么还要创建副本？</i> <br><br> 因为<code>RecyclerView</code>本身也将被设置为动画，因此其所有元素（包括选定的元素）都将被动画化，我们希望对其进行单独的动画处理。 <br><br> 之后，将一个副本添加到根标记并开始动画。 <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> fragmentTransaction = initFragmentTransaction(view) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> copy = view.createCopyView() root.addView(copy) view.visibility = View.INVISIBLE startAnimation(copy, fragmentTransaction) }</code> </pre> <br><br> 这是我们得到的： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sq/4j/qn/sq4jqnsbpjbhkm1zi20-1bjp-f4.gif" width="320" height="530"></div><br><br><h3> 终点线 </h3><br> 上面的gif动画发生在<code>RecyclerFragment</code> ，完成后，我们需要显示<code>DetailsFragment</code> 。 <br><br><pre> <code class="hljs">.withEndAction { fragmentTransaction?.commitAllowingStateLoss() }</code> </pre> <br>  <i>为什么我们使用<code>commitAllowingStateLoss</code> ？</i> <br><br> 如果您不使用它，并且在进行动画时，例如屏幕方向会发生变化，那么我们将得到<code>IllegalStateExeption</code> 。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这里</a>写的很好。 <br><br> 接下来，我们在<code>DetailsFragment</code>启动必要的用户界面元素的<code>DetailsFragment</code> 。 <br><br><h3> 一起运行 </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kq/dj/2c/kqdj2cn8_lzsn3cc6xrllb-xlv0.gif"></div><br><br> 与原始图片不太一样，但是看起来很相似。 <br><br><h3> 例子 </h3><br> 源代码可在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHub上获得</a> ，而本文也可提供<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">英文版本</a> 。 <br><br> 感谢您的关注！ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN423235/">https://habr.com/ru/post/zh-CN423235/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN423221/index.html">BioViva首席执行官Liz Parrish访谈</a></li>
<li><a href="../zh-CN423225/index.html">杰夫·贝佐斯基金会第一天</a></li>
<li><a href="../zh-CN423229/index.html">C＃7中的模式匹配</a></li>
<li><a href="../zh-CN423231/index.html">Frango Anomaly，高潮</a></li>
<li><a href="../zh-CN423233/index.html">现实世界中的人工智能</a></li>
<li><a href="../zh-CN423237/index.html">简单但复杂的机械臂</a></li>
<li><a href="../zh-CN423239/index.html">使用Helm为Kubernetes构建软件包：图表结构和模板</a></li>
<li><a href="../zh-CN423241/index.html">Digip A20和A25 SIP电话概述</a></li>
<li><a href="../zh-CN423243/index.html">矢量平均法测量风向</a></li>
<li><a href="../zh-CN423247/index.html">什么是智力？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>