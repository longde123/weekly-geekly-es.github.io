<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСЖЁЯП╝ ЁЯМЫ ЁЯЩЕЁЯП┐ рдореБрдЭреЗ рдХреБрдмреЗрд░рдиреЗрдЯ рдХреНрд▓рд╕реНрдЯрд░ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдореИрдВ рд╕рд┐рд░реНрдл рдПрдХ рдХреЛрдб рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рд╣реВрдВред рдПрдХ рд░рд╛рд╕реНрддрд╛ рд╣реИ ЁЯПОя╕П ЁЯЧ║я╕П ЁЯМ┤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╢реБрдн рджрд┐рдиред рдореЗрд░реЗ рдЕрдиреБрднрд╡ рд╕реЗ рдПрдХ рдФрд░ рдиреЛрдЯред рдЗрд╕ рдмрд╛рд░ рдпрд╣ рдмреБрдирд┐рдпрд╛рджреА рдврд╛рдБрдЪреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕рддрд╣реА рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдореИрдВ рдХрд░рддрд╛ рд╣реВрдБ рдЕрдЧрд░ рдореБрдЭреЗ рдХреБрдЫ рдЙрддрд╛рд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рд▓реЗрдХрд┐...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдореБрдЭреЗ рдХреБрдмреЗрд░рдиреЗрдЯ рдХреНрд▓рд╕реНрдЯрд░ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдореИрдВ рд╕рд┐рд░реНрдл рдПрдХ рдХреЛрдб рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рд╣реВрдВред рдПрдХ рд░рд╛рд╕реНрддрд╛ рд╣реИ</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423481/"><img src="https://habrastorage.org/webt/j9/qc/fb/j9qcfbdq_raamw7rwyt02ci1an8.png"><br><br>  рд╢реБрдн рджрд┐рдиред  рдореЗрд░реЗ рдЕрдиреБрднрд╡ рд╕реЗ рдПрдХ рдФрд░ рдиреЛрдЯред  рдЗрд╕ рдмрд╛рд░ рдпрд╣ рдмреБрдирд┐рдпрд╛рджреА рдврд╛рдБрдЪреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕рддрд╣реА рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдореИрдВ рдХрд░рддрд╛ рд╣реВрдБ рдЕрдЧрд░ рдореБрдЭреЗ рдХреБрдЫ рдЙрддрд╛рд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рд▓реЗрдХрд┐рди <b>рдЖрд╕-рдкрд╛рд╕ рдХреЗ</b> рд▓реЛрдЧ рдирд╣реАрдВ <b>рд╣реИрдВ</b> ред  рд▓реЗрдХрд┐рди рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рдореЗрдВ рдЕрдореВрд░реНрддрддрд╛ рдХрд╛ рдореМрдЬреВрджрд╛ рд╕реНрддрд░, рдЗрдВрдЯрд░рдиреЗрдЯ рдФрд░ рддреИрдпрд╛рд░ рдЪреАрдЬреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рд░рд╛рдд рдХреЗ рджреМрд░рд╛рди рдЙрдард╛рдП рдЧрдП рдЗрд╕ рдмреБрдирд┐рдпрд╛рджреА рдврд╛рдВрдЪреЗ рдХреЗ рд╕рд╛рде рд░рд╣рдиреЗ рдХреЗ рд▓рд┐рдП рд▓рдЧрднрдЧ рдПрдХ рд╡рд░реНрд╖ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред <br><br>  рдХреАрд╡рд░реНрдб - <b>AWS</b> + <b>рдЯреЗрд░рд╛рдлрд╝реЙрд░реНрдо</b> + <b>kops</b> ред  рдЕрдЧрд░ рдпрд╣ рдореЗрд░реЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИ, рддреЛ рдпрд╣ рд╕рдВрднрд╡рддрдГ рдХрд┐рд╕реА рдФрд░ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛрдЧрд╛ред  рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдореЗрдВ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИред <br><a name="habracut"></a><br><h2>  -1ред  рд╣рдо рдХрд┐рд╕рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд░рд╣реЗ рд╣реИрдВ </h2><br>  рдХреНрд▓рд╛рд╕рд┐рдХ рд╕реНрдерд┐рддрд┐ - рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЛ рдРрд╕реЗ рдЪрд░рдг рдореЗрдВ рд▓рд┐рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрдм рдЗрд╕реЗ рдХрд╣реАрдВ рдкрд░ рдЙрддрд╛рд░рдирд╛ рдФрд░ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реЛрддрд╛ рд╣реИред  рдФрд░ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдПрдХ рд╕рд░рд▓ HTML рдкреГрд╖реНрда рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИред  рдореИрдВ рдХреНрд╖реИрддрд┐рдЬ рд╕реНрдХреЗрд▓рд┐рдВрдЧ, рд╕реНрдерд╛рдиреАрдп, рдкрд░реАрдХреНрд╖рдг, рдЙрддреНрдкрд╛рдж рдЦрдбрд╝рд╛ рдХрд░рдиреЗ рдФрд░ рдЕрдзрд┐рдХ рдпрд╛ рдХрдо рд╕рд╛рдорд╛рдиреНрдп рддреИрдирд╛рддреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкрд░ рдкрд░реНрдпрд╛рд╡рд░рдг рдХреА рдкрд╣рдЪрд╛рди рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдЪрд╛рд╣реВрдВрдЧрд╛ред <br><blockquote>  рдпрд╣ рд╢реБрд░реВ рд╕реЗ рдЕрдВрдд рддрдХ рдкреВрд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП <b>рд▓рд╛рд░рд╡реЗрд▓</b> рдкрд░ рдПрдХ рдЖрд╡реЗрджрди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣реИред  рд▓реЗрдХрд┐рди рдПрдХ рд╕рдорд╛рди рддрд░реАрдХреЗ рд╕реЗ, рдЖрдк рдЧреЛ, рдкрд╛рдЗрдерди-рдПрдкреНрд▓рд┐рдХреЗрд╢рди, WP рдкрд░ рдЫреЛрдЯреА рд╕рд╛рдЗрдЯ, html-рдкреЗрдЬ рдФрд░ рдмрд╣реБрдд рдХреБрдЫ рдкрд░ рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдкреНрд░рдХреАрд░реНрдгрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рд╕реНрддрд░ рддрдХ, рдпрд╣ рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ, рдФрд░ рдлрд┐рд░ рдЯреАрдо рдореЗрдВ рдПрдХ рдЕрд▓рдЧ рд╡реНрдпрдХреНрддрд┐ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИ, рдЬреЛ рдЗрд╕реЗ рд╕реБрдзрд╛рд░ рдФрд░ рдкреВрд░рдХ рдХрд░реЗрдЧрд╛ред </blockquote>  рд╣рд╛рд▓ рд╣реА рдореЗрдВ, рдореИрдВ рдЗрд╕ рддрдереНрдп рдкрд░ рдЖрдпрд╛ рдХрд┐ рдореИрдВ рд╕реНрдерд╛рдиреАрдп рдорд╢реАрдиреЛрдВ рдкрд░ <b>GoLand, PhpStorm, Docker, Git</b> рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддрд╛ рд╣реВрдВ рдФрд░ рдореИрдВ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреВрд░реА рддрд░рд╣ рд╕реЗ рддреИрдпрд╛рд░ рд╣реВрдВред  рд╣рд╛рдВ, рдФрд░ рдЖрдк рдереЛрдХ рд╕рдореВрд╣реЛрдВ рдореЗрдВ рдПрдХ рдорд╢реАрди рд╕реЗ рдкреНрд░рдмрдВрдзрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдореИрдВ рдУрдПрд╕ рдкрд░ рдзреНрдпрд╛рди рджреЗрдиреЗ рдХреЗ рдмрд┐рдирд╛ рдкреВрд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рд╡рд░реНрдгрди рдХрд░реВрдВрдЧрд╛, рдЬрд┐рд╕ рдкрд░ рдЖрдк рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рд╕рднреА рдЪреАрдЬреЛрдВ рдХреЛ рдПрдХ рдбреЙрдХрдЯрд░ рдХрдВрдЯреЗрдирд░ рдореЗрдВ рдкреИрдХ рдХрд░рддреЗ рд╣реИрдВред <br><br><h2>  0. рдХрд╛рдо рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реЛрдирд╛ред </h2><br>  рдЖрдЗрдП рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ рдХрд┐ рд╣рдордиреЗ рдкрд╣рд▓реЗ рд╣реА <b>AWS</b> рдкрд░ рдПрдХ рдЦрд╛рддрд╛ рдкрдВрдЬреАрдХреГрдд рдХрд░ рд▓рд┐рдпрд╛ рд╣реИ, рддрдХрдиреАрдХреА рд╕рд╣рд╛рдпрддрд╛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рд╕рд╛рде рдЪрд▓рдиреЗ рд╡рд╛рд▓реЗ рд╕рд░реНрд╡рд░ рдХреА рд╕рдВрдЦреНрдпрд╛ рджреНрд╡рд╛рд░рд╛ рдЦрд╛рддрд╛ рд╕реАрдорд╛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рд╛, рдПрдХ <b>IAM</b> рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рдпрд╛ рдФрд░ рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ <b>рдкрд╣реБрдВрдЪ рдХреБрдВрдЬреА</b> + <b>рдЧреБрдкреНрдд рдХреБрдВрдЬреА рд╣реИ</b> ред  рдЬреЛрди - <b>us-east-1</b> ред <br><br>  рд╣рдореЗрдВ рд╕реНрдерд╛рдиреАрдп рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ рдХреНрдпрд╛ рдЪрд╛рд╣рд┐рдП?  <b>AWS CLI</b> , <b>AWS</b> рдХреЗ рдШреЛрд╖рдгрд╛рддреНрдордХ рдкреНрд░рдмрдВрдзрди рдХреЗ рд▓рд┐рдП <b>рдЯреЗрд░рд╛рдлреЙрд░реНрдо</b> , рдХреБрдЫ рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рддреИрдирд╛рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд▓рд╕реНрдЯрд░ рдФрд░ <b>рд╣реЗрд▓реНрдо</b> рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <b>kopsectl</b> , <b>kops</b> ред  рд╣рдо <b>рдбреЙрдХрд░рдлрд╛рдЗрд▓ рдХреЛ</b> рдЗрдХрдЯреНрдард╛ рдХрд░рддреЗ рд╣реИрдВ (рдЬреЛ рдореБрдЭреЗ рдмрд╣реБрдд рдкрд╣рд▓реЗ <b>рдЧреАрдереВрдм</b> рдХреА рд╡рд┐рд╢рд╛рд▓рддрд╛ рдореЗрдВ рдорд┐рд▓рд╛ рдерд╛, рд▓реЗрдХрд┐рди рдореБрдЭреЗ рдирд╣реАрдВ рдорд┐рд▓рд╛ рдЬрд╣рд╛рдВ)ред  рд╣рдо рдЕрдкрдиреЗ <b>docker-compose.yml</b> рдХреЛ рдЖрд░реЛрд╣рд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдФрд░ рдЙрдкрдирд╛рдореЛрдВ рдХреЗ рд▓рд┐рдП <b>рдмрдирд╛рддреЗ рд╣реИрдВ</b> ред <br><br><div class="spoiler">  <b class="spoiler_title">Dockerfile</b> <div class="spoiler_text"><pre><code class="plaintext hljs">FROM ubuntu:16.04 ARG AWSCLI_VERSION=1.12.1 ARG HELM_VERSION=2.8.2 ARG ISTIO_VERSION=0.6.0 ARG KOPS_VERSION=1.9.0 ARG KUBECTL_VERSION=1.10.1 ARG TERRAFORM_VERSION=0.11.0 # Install generally useful things RUN apt-get update \ &amp;&amp; apt-get -y --force-yes install --no-install-recommends \ curl \ dnsutils \ git \ jq \ net-tools \ ssh \ telnet \ unzip \ vim \ wget \ &amp;&amp; apt-get clean \ &amp;&amp; apt-get autoclean \ &amp;&amp; apt-get autoremove \ &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* # Install AWS CLI RUN apt-get update \ &amp;&amp; apt-get -y --force-yes install \ python-pip \ &amp;&amp; pip install awscli==${AWSCLI_VERSION} \ &amp;&amp; apt-get clean \ &amp;&amp; apt-get autoclean \ &amp;&amp; apt-get autoremove \ &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* # Install Terraform RUN wget -O terraform.zip https://releases.hashicorp.com/terraform/${TERRAFORM_VERSION}/terraform_${TERRAFORM_VERSION}_linux_amd64.zip \ &amp;&amp; unzip terraform.zip \ &amp;&amp; mv terraform /usr/local/bin/terraform \ &amp;&amp; chmod +x /usr/local/bin/terraform \ &amp;&amp; rm terraform.zip # Install kubectl ADD https://storage.googleapis.com/kubernetes-release/release/v${KUBECTL_VERSION}/bin/linux/amd64/kubectl /usr/local/bin/kubectl RUN chmod +x /usr/local/bin/kubectl # Install Kops ADD https://github.com/kubernetes/kops/releases/download/${KOPS_VERSION}/kops-linux-amd64 /usr/local/bin/kops RUN chmod +x /usr/local/bin/kops # Install Helm RUN wget -O helm.tar.gz https://storage.googleapis.com/kubernetes-helm/helm-v${HELM_VERSION}-linux-amd64.tar.gz \ &amp;&amp; tar xfz helm.tar.gz \ &amp;&amp; mv linux-amd64/helm /usr/local/bin/helm \ &amp;&amp; chmod +x /usr/local/bin/helm \ &amp;&amp; rm -Rf linux-amd64 \ &amp;&amp; rm helm.tar.gz # Create default user "kops" RUN useradd -ms /bin/bash kops WORKDIR /home/kops USER kops # Ensure the prompt doesn't break if we don't mount the ~/.kube directory RUN mkdir /home/kops/.kube \ &amp;&amp; touch /home/kops/.kube/config</code> </pre> <br></div></div><div class="spoiler">  <b class="spoiler_title">рдбреЛрдХрд░-compose.yml</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">version: '2.1' services: cluster-main: container_name: cluster.com image: cluster.com user: root stdin_open: true volumes: - ./data:/data - ./.ssh:/root/.ssh - ./.kube:/root/.kube - ./.aws:/root/.aws cluster-proxy: container_name: cluster.com-kubectl-proxy image: cluster.com user: root entrypoint: kubectl proxy --address='0.0.0.0' --port=8001 --accept-hosts='.*' ports: - "8001:8001" stdin_open: true volumes: - ./data:/data - ./.ssh:/root/.ssh - ./.kube:/root/.kube - ./.aws:/root/.aws</code> </pre><br></div></div><div class="spoiler">  <b class="spoiler_title">makefile</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">docker.build: docker build -t cluster.com . docker.run: docker-compose up -d docker.bash: docker exec -it cluster.com bash</code> </pre> <br></div></div><br>  <b>Dockerfile</b> - рдореВрд▓ ubuntu рдЫрд╡рд┐ рд▓реЗрдВ рдФрд░ рд╕рднреА рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВред  <b>рдореЗрдХрдлрд╛рдЗрд▓</b> - рдХреЗрд╡рд▓ рд╕реБрд╡рд┐рдзрд╛ рдХреЗ рд▓рд┐рдП, рдЖрдк рдПрд▓рд┐рдпрд╛рд╕реЗрд╕ рдХреЗ рд╕рд╛рдорд╛рдиреНрдп рддрдВрддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  <b>Docker-compose.yml</b> - рд╣рдордиреЗ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдХрдВрдЯреЗрдирд░ рдЬреЛрдбрд╝рд╛ рд╣реИ рдЬреЛ рд╣рдореЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">K8S рдбреИрд╢рдмреЛрд░реНрдб</a> рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдлреЗрдВрдХ</a> рджреЗрдЧрд╛ рдпрджрд┐ рдЖрдкрдХреЛ рдХреБрдЫ рджреЗрдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br>  рд╣рдо рд░реВрдЯ рдореЗрдВ <b>рдбреЗрдЯрд╛</b> , <b>.sh</b> , <b>.kube</b> , <b>.aws рдлреЛрд▓реНрдбрд░ рдмрдирд╛рддреЗ рд╣реИрдВ</b> рдФрд░ рдЕрдкрдиреЗ рдХреЙрдиреНрдлрд┐рдЧ рдХреЛ aws, ssh рдХреАрдЬрд╝ рдХреЗ <b>рд▓рд┐рдП рд▓рдЧрд╛рддреЗ рд╣реИрдВ</b> рдФрд░ рд╣рдо <b>docker.build рдХреЗ</b> рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдкрдиреЗ рдХрдВрдЯреЗрдирд░ рдХреЛ рдПрдХрддреНрд░ рдФрд░ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ <b>docker.run рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ</b> ред <br><br>  рдареАрдХ рд╣реИ, <b>рдбреЗрдЯрд╛</b> рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ, рдПрдХ рдлрд╝реЛрд▓реНрдбрд░ рдмрдирд╛рдПрдВ рдЬрд┐рд╕рдореЗрдВ рд╣рдо <b>yaml k8s</b> рдлрд╛рдЗрд▓реЗрдВ <b>рдбрд╛рд▓рддреЗ рд╣реИрдВ</b> , рдФрд░ рджреВрд╕рд░реЗ рдХреЗ рдмрдЧрд▓ рдореЗрдВ, рдЬрд┐рд╕рдореЗрдВ рд╣рдо рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ <b>рдЯреЗрд░рд╛рдлреЙрд░реНрдо рдХреА</b> рд╕реНрдерд┐рддрд┐ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░реЗрдВрдЧреЗред  рдореИрдВрдиреЗ рдЗрд╕ рдЪрд░рдг рдХрд╛ рдЕрдиреБрдорд╛рдирд┐рдд рдкрд░рд┐рдгрд╛рдо <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><b>рдЬреАрдердм рдкрд░ рд░рдЦрд╛</b></a> ред <br><br><h2>  1. рд╣рдорд╛рд░реЗ рдХреНрд▓рд╕реНрдЯрд░ рдЙрдард╛рдПрдБред </h2><br><blockquote>  рдЕрдЧрд▓рд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЗрд╕</a> рдиреЛрдЯ рдХрд╛ рдореБрдлреНрдд рдЕрдиреБрд╡рд╛рдж рд╣реЛрдЧрд╛ред  рдореИрдВ рдХрдИ рд╕реИрджреНрдзрд╛рдВрддрд┐рдХ рдмрд┐рдВрджреБрдУрдВ рдХреЛ рдЫреЛрдбрд╝ рджреВрдВрдЧрд╛, рдПрдХ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдирд┐рдЪреЛрдбрд╝ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реВрдВрдЧрд╛ред  рд╕рднреА рд╕рдорд╛рди, рдореЗрд░реЗ рдиреЛрдЯ рдХрд╛ рдкреНрд░рд╛рд░реВрдк tldr рд╣реИред </blockquote><br>  рд╣рдорд╛рд░реЗ <b>рдбреЗрдЯрд╛ / aws-рдХреНрд▓рд╕реНрдЯрд░-init-kops-terraform рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ, рд╣рдо</b> рдХреНрд▓реЛрди рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЗрд╕</a> рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рдХреНрдпрд╛ рдирд┐рд╣рд┐рдд рд╣реИ рдФрд░ <b>docker.bash рдХреЗ</b> рдорд╛рдзреНрдпрдо рд╕реЗ рдХрдВрдЯреЗрдирд░ рдХрдВрд╕реЛрд▓ рдкрд░ <b>рдЬрд╛рдПрдВ</b> ред  рдмреЛрд░рд┐рдВрдЧ рдЯреАрдореЛрдВ рдХрд╛ рдмрд┐рдЦрд░рд╛рд╡ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИред <br><br><h4>  AWS рд╕реАрдПрд▓рдЖрдИ </h4><br>  рд╣рдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ <b>kops рдмрдирд╛рддреЗ рд╣реИрдВ</b> , рдПрдХреНрд╕реЗрд╕ рдЕрдзрд┐рдХрд╛рд░ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕ рдкрд░ <b>AWS CLI</b> рдХреЛ рдлрд┐рд░ рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ <b>рд╕реБрдкрд░рдпреБрд╕рд░</b> рд╕реЗ рдХрдорд╛рдВрдб рди рдЪрд▓рд╛рдПрдВред <br><br><pre> <code class="bash hljs">aws iam create-group --group-name kops <span class="hljs-comment"><span class="hljs-comment">#   aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AmazonEC2FullAccess --group-name kops aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AmazonRoute53FullAccess --group-name kops aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AmazonS3FullAccess --group-name kops aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/IAMFullAccess --group-name kops aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AWSCertificateManagerFullAccess --group-name kops aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AmazonVPCFullAccess --group-name kops aws iam create-user --user-name kops aws iam add-user-to-group --user-name kops --group-name kops aws iam create-access-key --user-name kops</span></span></code> </pre><br><pre> <code class="bash hljs">aws configure</code> </pre><br><h4>  рдЖрд░рдВрднрд┐рдХ рдЯреЗрд░рд╛рдлреЙрд░реНрдо </h4><br>  рдлрд╝рд╛рдЗрд▓ <b>рдбреЗрдЯрд╛ / aws-рдХреНрд▓рд╕реНрдЯрд░-init-kops-terraform / variables.tf рдореЗрдВ,</b> рдХреНрд▓рд╕реНрдЯрд░ рдХрд╛ рдирд╛рдо рд╡рд╛рдВрдЫрд┐рдд рдореЗрдВ <b>рдмрджрд▓ рджреЗрдВ</b> ред  рд╣рдорд╛рд░реЗ dns рд╕рд░реНрд╡рд░ рдХреЛ <b>update.json</b> рдлрд╝рд╛рдЗрд▓ рд╕реЗ рд▓реЗрдирд╛ рди рднреВрд▓реЗрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ рдЬрд╣рд╛рдБ рдЖрдкрдиреЗ рдЕрдкрдирд╛ рдбреЛрдореЗрди рдЦрд░реАрджрд╛ рдерд╛ред <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    cd /data/aws-cluster-init-kops-terraform #    AWS CLI export AWS_ACCESS_KEY_ID=$(aws configure get aws_access_key_id) export AWS_SECRET_ACCESS_KEY=$(aws configure get aws_secret_access_key) #  terraform terraform init terraform get terraform apply #  NS  cat update-zone.json \ | jq ".Changes[].ResourceRecordSet.Name=\"$(terraform output name).\"" \ | jq ".Changes[].ResourceRecordSet.ResourceRecords=$(terraform output -json name_servers | jq '.value|[{"Value": .[]}]')" \ &gt; update-zone.json</span></span></code> </pre><br><h4>  рдХреЛрдкреНрд╕ </h4><br>  рд╣рдо <b>kops рдХреЗ</b> рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рдХреНрд▓рд╕реНрдЯрд░ <b>рдмрдирд╛рддреЗ рд╣реИрдВ</b> , рдПрдХ <b>.tf</b> рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП <b>рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди</b> рдирд┐рд░реНрдпрд╛рдд рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> NAME=$(terraform output cluster_name) <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> KOPS_STATE_STORE=$(terraform output state_store) <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ZONES=$(terraform output -json availability_zones | jq -r <span class="hljs-string"><span class="hljs-string">'.value|join(",")'</span></span>) kops create cluster \ --master-zones <span class="hljs-variable"><span class="hljs-variable">$ZONES</span></span> \ --zones <span class="hljs-variable"><span class="hljs-variable">$ZONES</span></span> \ --topology private \ --dns-zone $(terraform output public_zone_id) \ --networking calico \ --vpc $(terraform output vpc_id) \ --target=terraform \ --out=. \ <span class="hljs-variable"><span class="hljs-variable">${NAME}</span></span></code> </pre><br><blockquote>  рдпрд╣рд╛рдВ рдереЛрдбрд╝реА рдЯрд┐рдкреНрдкрдгреА рдХреА рдЬрд░реВрд░рдд рд╣реИред  <b>Terraform</b> рдПрдХ <b>VPC</b> рдмрдирд╛рдПрдЧрд╛, рдФрд░ рд╣рдореЗрдВ рдЙрд╕ рдХреЙрдиреНрдлрд┐рдЧ рдХреЛ рдереЛрдбрд╝рд╛ рдЯреНрд╡реАрдХ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА рдЬреЛ <b>kops рд╣рдореЗрдВ рджреЗрдЧрд╛</b> ред  рдпрд╣ рдХрд╛рдлреА рд╕рд░рд▓рддрд╛ рд╕реЗ <b>рд░реЗрди / рдЧреЗрдВрд╕реБрдмрдиреЗрдЯреНрд╕</b> рд╣реЗрд▓реНрдкрд░ рдЗрдореЗрдЬ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ <b>: 0.1</b> <br></blockquote><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   terraform output -json &gt; subnets.json</span></span></code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#     echo subnets.json | docker run --rm -i ryane/gensubnets:0.1</span></span></code> </pre><br>  рдЖрдк рдорд╛рд░реНрдЧ53 рдХреЗ рд▓рд┐рдП рддрддреНрдХрд╛рд▓ рдиреАрддрд┐рдпрд╛рдВ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="plaintext hljs">additionalPolicies: master: | [ { "Effect": "Allow", "Action": ["route53:ListHostedZonesByName"], "Resource": ["*"] }, { "Effect": "Allow", "Action": ["elasticloadbalancing:DescribeLoadBalancers"], "Resource": ["*"] }, { "Effect": "Allow", "Action": ["route53:ChangeResourceRecordSets"], "Resource": ["*"] } ] node: | [ { "Effect": "Allow", "Action": ["route53:ListHostedZonesByName"], "Resource": ["*"] }, { "Effect": "Allow", "Action": ["elasticloadbalancing:DescribeLoadBalancers"], "Resource": ["*"] }, { "Effect": "Allow", "Action": ["route53:ChangeResourceRecordSets"], "Resource": ["*"] } ]</code> </pre><br>  <b>рдХреЛрдкреНрд╕ рдХреЗ</b> рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдВрдкрд╛рджрди <b>рдХреНрд▓рд╕реНрдЯрд░ $ {NAME} рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ</b> ред <br><br><img src="https://habrastorage.org/webt/yw/wg/w4/ywwgw42_afdmr__elg0og_yjruk.png"><br><br>  рдЕрдм рд╣рдо рдХреНрд▓рд╕реНрдЯрд░ рдХреЛ рд╣реА рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="bash hljs">kops update cluster \ --out=. \ --target=terraform \ <span class="hljs-variable"><span class="hljs-variable">${NAME}</span></span> terraform apply</code> </pre><br>  рд╕рдм рдХреБрдЫ рдареАрдХ рд╣реЛ рдЬрд╛рдПрдЧрд╛, <b>рдХреБрдмреЗрдЯрд▓</b> рдХрд╛ рд╕рдВрджрд░реНрдн рдмрджрд▓ рдЬрд╛рдПрдЧрд╛ред  рдлрд╝реЛрд▓реНрдбрд░ <b>рдбреЗрдЯрд╛ / aws-рдХреНрд▓рд╕реНрдЯрд░-init-kops-terraform рдореЗрдВ</b> , рд╣рдо рдХреНрд▓рд╕реНрдЯрд░ рд╕реНрдерд┐рддрд┐ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░реЗрдВрдЧреЗред  рдЖрдк рдмрд╕ рд╕рдм рдХреБрдЫ <b>рдЧрд┐рдЯ</b> рдореЗрдВ рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдПрдХ рдирд┐рдЬреА рдмрд┐рдЯрдкреИрдХ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="bash hljs">$ kubectl get nodes NAME STATUS AGE ip-10-20-101-252.ec2.internal Ready,master 7m ip-10-20-103-232.ec2.internal Ready,master 7m ip-10-20-103-75.ec2.internal Ready 5m ip-10-20-104-127.ec2.internal Ready,master 6m ip-10-20-104-6.ec2.internal Ready 5m</code> </pre><br><h2>  2. рд╣рдорд╛рд░реЗ рдЖрд╡реЗрджрди рдХреЛ рдмрдврд╝рд╛рдПрдВ </h2><br>  рдЕрдм рдЬрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреБрдЫ рд╣реИ, рд╣рдо рдЕрдкрдиреА рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдПрдХ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рддреИрдирд╛рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдореИрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдХ рд╣реА рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА</a> рдореЗрдВ рдЕрдиреБрдорд╛рдирд┐рдд рдХреЙрдиреНрдлрд┐рдЧ рд▓рдЧрд╛рдКрдВрдЧрд╛ред  рдЙрдиреНрд╣реЗрдВ <b>рдбреЗрдЯрд╛ / k8s</b> рдореЗрдВ рдПрдХ рдкреИрдХреЗрдЯ рдореЗрдВ рд░рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br><h4>  рд╕реЗрд╡рд╛ рдЪреБрдЯрдХреБрд▓реЗ </h4><br>  рд╕реЗрд╡рд╛ рдХреЗ рд╕рд╛рдорд╛рди рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред  рд╣рдореЗрдВ <b>hub.docker.com</b> <b>рдкрд░ helm</b> , <b>path53</b> , <b>рд╕реНрдЯреЛрд░реЗрдЬ-рдХреНрд▓рд╛рд╕</b> рдФрд░ рдЕрдкрдиреА рдирд┐рдЬреА <b>рд░рдЬрд┐рд╕реНрдЯреНрд░реА</b> рддрдХ рдкрд╣реБрдБрдЪ рдХреА <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ</a> ред  рдЦреИрд░, рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рдХреЗ рд▓рд┐рдП, рдЕрдЧрд░ рдРрд╕реА рдХреЛрдИ рдЗрдЪреНрдЫрд╛ рд╣реИред <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Init helm kubectl create serviceaccount --namespace kube-system tiller kubectl create clusterrolebinding tiller-cluster-rule --clusterrole=cluster-admin --serviceaccount=kube-system:tiller kubectl patch deploy --namespace kube-system tiller-deploy -p '{"spec":{"template":{"spec":{"serviceAccount":"tiller"}}}}' helm init</span></span></code> </pre><br><pre> <code class="bash hljs">kubectl apply -f default-namespace.yaml kubectl apply -f storage-classes.yaml kubectl apply -f route53.yaml kubectl apply -f docker-hub-secret.yml kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/master/src/deploy/recommended/kubernetes-dashboard.yaml</code> </pre><br><h4>  PostgreSQL + рд░реЗрдбрд┐рд╕ </h4><br>  рдореИрдВрдиреЗ рдХрдИ рдмрд╛рд░ <b>рд╕реНрдЯреИрдХреНрдб</b> рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЗ рд▓рд┐рдП рдбреЙрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЬрд▓рд╛рдпрд╛, рд▓реЗрдХрд┐рди рдЕрдВрддрд┐рдо рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЕрдм рддрдХ рд╕рдмрд╕реЗ рдЙрдкрдпреБрдХреНрдд рд╕рд╛рдмрд┐рдд рд╣реБрдЖ рд╣реИред  рдореИрдВ рд╕реНрдХреЗрд▓реЗрдмрд┐рд▓рд┐рдЯреА рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><b>рд╕реНрдЯреЛрд▓рди</b></a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><b>рд╣реВрдВ</b></a> ред  рд▓рдЧрднрдЧ рдПрдХ рд╕рд╛рд▓ рдЙрдбрд╝рд╛рди рд╕рд╛рдорд╛рдиреНрдп рд╣реИред <br><br>  рд╣рдо <b>рд╣реЗрд▓рдо-рдЪрд╛рд░реНрдЯ</b> рдФрд░ рддреНрд╡рд░рд┐рдд <b>рд░реЗрдбрд┐рд╕</b> рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рдПрдХ рдЬреЛрдбрд╝реЗ рдХреЛ рддреИрдирд╛рдд рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  etcd  stolon cd etcd-chart helm install --name global-etcd . #   stolon cd stolon-chart helm dep build helm install --name global-postgres . #  redis kubectl apply -f redis</span></span></code> </pre><br><h4>  рдирдЧрдиреЗрдХреНрд╕ + php </h4><br>  рд╕рд╛рдорд╛рдиреНрдп рдЧреБрдЪреНрдЫрд╛ред  <b>Nginx</b> рдФрд░ <b>php-fpm</b> ред  рдореИрдВрдиреЗ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рд╕рд╛рдл рдирд╣реАрдВ рдХрд┐рдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рд░ рдХреЛрдИ рдЕрдкрдиреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИред  рдЖрд╡реЗрджрди рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдЖрдкрдХреЛ рдЙрд╕ рдЫрд╡рд┐ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ рд╕реЗ рд╣рдо рдХреЛрдб рд▓реЗ рд▓реЗрдВрдЧреЗ + <b>AWS рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдкреНрд░рдмрдВрдзрдХ</b> рд╕реЗ рдПрдХ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдкрдВрдХреНрддрд┐ рдЬреЛрдбрд╝реЗрдВрдЧреЗред  Php рд╣реА - рдЖрдк рдЗрд╕реЗ рдбреЙрдХрд╣реИрдм рд╕реЗ рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдореИрдВрдиреЗ рдХреБрдЫ рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдХрд░ рдЕрдкрдирд╛ рдирд┐рдЬреА рдмрдирд╛рдпрд╛ред <br><br><pre> <code class="bash hljs">kubectl apply -f nginx kubectl apply -f php</code> </pre><br>  рдХреЛрдб рдХреЗ рд╕рд╛рде рд╣рдорд╛рд░реА рдЫрд╡рд┐ рдореЗрдВ, рд╣рдо рдЗрд╕реЗ <b>/ crm-code</b> рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреЗ рд╣реИрдВред  рд╣рдо рдЗрд╕реЗ рдЖрдкрдХреА рдЫрд╡рд┐ рд╕реЗ рдмрджрд▓ рджреЗрддреЗ рд╣реИрдВ рдФрд░ рдпрд╣ рдХрд╛рдлреА рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд╛рдо рдХрд░реЗрдЧрд╛ред  рдлрд╛рдЗрд▓ <b>nginx / dep рддреИрдирд╛рддреА .yml рд╣реИ</b> ред <br><br><img src="https://habrastorage.org/webt/xy/0k/0a/xy0k0axs4muxujs3b-dyp8ncske.png"><br><br>  рдбреЛрдореЗрди рдмрд╛рд╣рд░ рд▓рд╛рдУред  <b>рд░реВрдЯ 53</b> рд╕реЗрд╡рд╛ рдЗрд╕реЗ <b>рдЙрдард╛рдПрдЧреА</b> , рдбреАрдПрдирдПрд╕ рд░рд┐рдХреЙрд░реНрдб рдХреЛ рдмрджрд▓реЗрдЧреА / рдЬреЛрдбрд╝реЗрдЧреА, рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЛ <b>рдПрдбрдмреНрд▓реНрдпреВрдПрд╕ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдкреНрд░рдмрдВрдзрдХ</b> рд╕реЗ <b>рдИрдПрд▓рдмреА рдкрд░ рдЕрдкрд▓реЛрдб рдХрд┐рдпрд╛</b> рдЬрд╛рдПрдЧрд╛ред  рдлрд╝рд╛рдЗрд▓ <b>nginx / service.yml рд╣реИ</b> ред <br><br><img src="https://habrastorage.org/webt/aw/nl/ya/awnlyaieynoajtmb_feavw2_qke.png"><br><br>  рдЖрдЧреЗ env рдЪрд░ php рдореЗрдВ рдЙрдиреНрд╣реЗрдВ рдЕрдВрджрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░ <b>PostgreSQL / Redis рд╕реЗ</b> рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВред  рдлрд╛рдЗрд▓ <b>php / dep рддреИрдирд╛рддреА</b> . <b>yml рд╣реИ</b> ред <br><br><img src="https://habrastorage.org/webt/ry/n9/v4/ryn9v42o_jvzafh16vr3m2rcpo4.png"><br><br>  рдирддреАрдЬрддрди, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ <b>K8S</b> рдХреНрд▓рд╕реНрдЯрд░ рд╣реИ, рдЬреЛ рдПрдХ рдмреБрдирд┐рдпрд╛рджреА рд╕реНрддрд░ рдкрд░ рд╣рдо рдирдИ рд╕реЗрд╡рд╛рдУрдВ, рдирдП рд╕рд░реНрд╡рд░реЛрдВ (рдиреЛрдбреНрд╕) рдХреЛ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, <b>PostgreSQL, PHP, Nginx</b> рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рдЕрд▓рдЧ рд╡реНрдпрдХреНрддрд┐ рдХреЗ рд╕рд╛рдордиреЗ рд░рд╣рддреЗ рд╣реИрдВ рдЬреЛ рдЯреАрдо рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИ рдЬреЛ рдпрд╣ рдХрд░реЗрдЧрд╛ ред <br><br>  рдЗрд╕ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдиреЛрдЯ рдХреЗ рд╣рд┐рд╕реНрд╕реЗ рдХреЗ рд░реВрдк рдореЗрдВ, рдореИрдВ рдЗрд╕ рд╕рднреА рд╕рд╛рдордЧреНрд░реА рдХреЗ рдмреИрдХрдЕрдк / рдирд┐рдЧрд░рд╛рдиреА рдореБрджреНрджреЛрдВ рдкрд░ рдирд╣реАрдВ рдЫреВрдКрдБрдЧрд╛ред  рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдЪрд░рдг рдореЗрдВ, <b>рд▓реЛрдХрд▓рд╣реЛрд╕реНрдЯ</b> рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдЧрд╛ <b>:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">K8S рдбреИрд╢рдмреЛрд░реНрдб</a> рд╕реЗрд╡рд╛ рд╕реЗ <b>8001 / ui</b> ред  рдмрд╛рдж рдореЗрдВ <b>рдкреНрд░реЛрдореЗрдерд┐рдпрд╕</b> , <b>рдЧреНрд░реЗрдлрд╛рдирд╛</b> , <b>рдмрд░реНрдорди</b> , рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рд╕рдорд╛рди рд╕рдорд╛рдзрд╛рди рдХреЛ рдЬрдХрдбрд╝рдирд╛ рд╕рдВрднрд╡ рд╣реЛрдЧрд╛ред <br><br>  рдЯрд░реНрдорд┐рдирд▓ рдпрд╛ <b>рдЯреАрдорд╕рд┐рдЯреА</b> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдХреЛрдб рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ <b>рдЬреЗрдирдХрд┐рдВрд╕</b> рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдХрд░реЗрдВрдЧреЗред <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#     -      Teamcity docker build -t GROUP/crm-code:latest . docker push GROUP/crm-code:latest #   (  ) kubectl set image deployment/php-fpm php-fpm=GROUP/php-fpm kubectl rollout status deployment/php-fpm kubectl set image deployment/php-fpm php-fpm=GROUP/php-fpm:latest kubectl set image deployment/nginx nginx=danday74/nginx-lua kubectl rollout status deployment/nginx kubectl set image deployment/nginx nginx=danday74/nginx-lua:latest kubectl rollout status deployment/php-fpm kubectl rollout status deployment/nginx</span></span></code> </pre><br>  рдореБрдЭреЗ рдЦреБрд╢реА рд╣реЛрдЧреА рдЕрдЧрд░ рдпрд╣ рдХрд┐рд╕реА рдХреЗ рд▓рд┐рдП рджрд┐рд▓рдЪрд╕реНрдк рд╣реЛрдЧрд╛ рдФрд░ рдХрд┐рд╕реА рдХреА рдорджрдж рдХрд░рдиреЗ рдкрд░ рджреЛрдЧреБрдирд╛ рдЦреБрд╢реА рд╣реЛрдЧреАред  рдЖрдкрдХрд╛ рдзреНрдпрд╛рди рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рджред  рдПрдХ рдмрд╛рд░ рдлрд┐рд░, рдореИрдВ рднрдВрдбрд╛рд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдХ</a> рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рджреЛ рдХреЗ</a> рд▓рд┐рдП рдПрдХ рд▓рд┐рдВрдХ рд╕рдВрд▓рдЧреНрди рдХрд░рддрд╛ рд╣реВрдВред </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi423481/">https://habr.com/ru/post/hi423481/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi423467/index.html">рд░реВрд╕реА рдбреЗрд╡рд▓рдкрд░реНрд╕ рдЙрддреНрдкрд╛рдж рд╕рдВрдЧрддрддрд╛ рдХреА рдПрдХ рд╕реВрдЪреА рдЬрд╛рд░реА рдХрд░реЗрдВрдЧреЗ</a></li>
<li><a href="../hi423469/index.html">рд╕рдмрд╕реЗ рддреЗрдЬрд╝ рдЬрдВрдЧрд▓реА рдкрд╢реНрдЪрд┐рдо рдлрд╝реНрд▓реЛрдЯрд┐рдВрдЧ рдкреЙрдЗрдВрдЯ рдирдВрдмрд░</a></li>
<li><a href="../hi423475/index.html">рдЙрдореНрд░ рдмрдврд╝рдиреЗ рдХрд╛ рдХреЛрдб рд╣реИрдХ рдХрд░рдирд╛: рдЙрдореНрд░ рдмрдврд╝рдиреЗ рдкрд░ рдПрдХ рдирдпрд╛ рд╡рд┐рдЬреНрдЮрд╛рди рдФрд░ рдпреБрд╡рд╛ рд░рд╣рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕рдХрд╛ рдХреНрдпрд╛ рдЕрд░реНрде рд╣реИ</a></li>
<li><a href="../hi423477/index.html">рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рдирд┐рдВрдЬрд╛ рдмрдиреЗрдВ: рдЖрдИрдмреА рдХреА рдКрдВрдЪрд╛рдЗрдпреЛрдВ рдкрд░ рдЕрдкрдирд╛ рд░рд╛рд╕реНрддрд╛ рд╢реБрд░реВ рдХрд░реЗрдВ</a></li>
<li><a href="../hi423479/index.html">"рдкрд╣рд▓рд╛: рдордВрдЧрд▓ рдХреЗ рд▓рд┐рдП рдЙрдбрд╝рд╛рди рднрд░рдирд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВ</a></li>
<li><a href="../hi423483/index.html">рд╡реЗрдмрдкреИрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡реЗрдмрд╕рд╛рдЗрдЯ рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЕрд▓рдЧ рдХрд░рдиреЗ рдХрд╛ рд╕рд╣реА рддрд░реАрдХрд╛ рдЦреЛрдЬрдирд╛</a></li>
<li><a href="../hi423485/index.html">IntersectionObserver рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрд▓рд╕реА рд▓реЛрдбрд┐рдВрдЧ рдЫрд╡рд┐рдпрд╛рдВ</a></li>
<li><a href="../hi423487/index.html">рдиреЛрдб.рдЬреЗрдПрд╕ рдмрд┐рдирд╛ рдиреЛрдб_рдореЙрдбреНрдпреВрд▓ рдХреЗ</a></li>
<li><a href="../hi423489/index.html">рдореИрдВ рдПрдХ рдЖрдкрд╛рддрдХрд╛рд▓реАрди рдЪрд┐рдХрд┐рддреНрд╕рдХ рд╣реВрдВ рдФрд░ рдореИрдВ рдирдП Apple рд╡реЙрдЪ рдЗрд▓реЗрдХреНрдЯреНрд░реЛрдХрд╛рд░реНрдбрд┐рдпреЛрдЧреНрд░рд╛рдо рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВ</a></li>
<li><a href="../hi423491/index.html">PHP рдбрд╛рдЗрдЬреЗрд╕реНрдЯ рдирдВрдмрд░ 139 (3 рд╕рд┐рддрдВрдмрд░ - 17, 2018)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>