<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😚 🙊 ✋🏾 Encore mieux la bombe zip 👨🏼‍🏫 🌂 👨🏿‍🎤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L 'article montre comment créer une bombe zip non récursive qui fournit un degré élevé de compression en chevauchant des fichiers à l' intérieur d 'un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Encore mieux la bombe zip</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459254/"> L 'article montre comment créer une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bombe zip</a> <i>non récursive</i> qui fournit un degré élevé de compression en chevauchant des fichiers à l' intérieur d 'un conteneur zip.  «Non récursif» signifie qu'il ne dépend pas des décompresseurs décompressant les fichiers intégrés dans les archives zip: il n'y a qu'un seul tour.  La taille de sortie augmente de façon quadratique à partir de l'entrée, atteignant un taux de compression de plus de 28 millions (10 Mo → 281 To) dans le format zip.  Une extension supplémentaire est possible avec des extensions 64 bits.  La conception utilise uniquement l'algorithme de compression DEFLATE le plus courant et est compatible avec la plupart des analyseurs zip. <br><br><a name="2"></a><ul><li>  <a href="">zbsm.zip</a> 42 ko → 5,5 Go <br></li><li>  <a href="">zblg.zip</a> 10 Mo → 281 To <br></li><li>  <a href="">zbxl.zip</a> 46 Mo → 4,5 PB (Zip64, moins compatible avec les analyseurs) </li></ul><br>  Code source: <br><pre>  git clone https://www.bamsoftware.com/git/zipbomb.git </pre>  <a href="">zipbomb-20190702.zip</a> <br><br>  Données et source d'illustrations: <br><pre>  git clone https://www.bamsoftware.com/git/zipbomb-paper.git </pre><a name="habracut"></a><br><div class="scrollable-table"><table><thead><tr><td colspan="2"></td><th colspan="2">  non récursif </th><th colspan="2">  récursif </th></tr><tr><td></td><th>  taille de l'archive </th><th>  taille non compressée </th><th>  le rapport </th><th>  taille non compressée </th><th>  le rapport </th></tr></thead><tbody><tr><th>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Quine Cox</a> </th><td>  440 </td><td>  440 </td><td>  1.0 </td><td>  ∞ </td><td>  ∞ </td></tr><tr><th>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://web.archive.org/web/20160130230432/">Quine Ellingsen</a> </th><td>  28 809 </td><td>  42 569 </td><td>  1,5 </td><td>  ∞ </td><td>  ∞ </td></tr><tr><th>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">42.zip</a> </th><td>  42 374 * </td><td>  558 432 </td><td>  13,2 </td><td>  4 507 981 343 026 016 </td><td>  106 milliards </td></tr><tr><th>  cette technique </th><td>  42 374 </td><td>  5 461 307 620 </td><td>  129 mille </td><td>  5 461 307 620 </td><td>  129 mille </td></tr><tr><th>  cette technique </th><td>  9 893 525 </td><td>  281 395 456 244 934 </td><td>  28 millions </td><td>  281 395 456 244 934 </td><td>  28 millions </td></tr><tr><th>  cette technique (Zip64) </th><td>  45 876 ​​952 </td><td>  4 507 981 427 706 459 </td><td>  98 millions </td><td>  4 507 981 427 706 459 </td><td>  98 millions </td></tr></tbody></table></div><br>  <sub>* Il existe deux versions de 42.zip: les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://web.archive.org/web/20120222083624/">anciens</a> 42 374 octets et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://web.archive.org/web/20120301154142/">les nouveaux</a> 42 428 octets.</sub>  <sub>La différence est que le nouveau nécessite un mot de passe avant de déballer.</sub>  <sub>Nous ne comparons qu'avec l'ancienne version.</sub>  <sub>Voici une copie du fichier si vous en avez besoin: <a href="">42.zip</a> .</sub> <sub><br><br></sub>  <sub>** Je voudrais connaître et indiquer l'auteur de 42.zip, mais je ne l'ai pas trouvé - faites-moi savoir si vous avez des informations.</sub> <br><br>  Les bombes zip doivent surmonter le fait que l'algorithme de compression DEFLATE le plus souvent pris en charge par les analyseurs <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ne peut pas dépasser le</a> taux de compression de 1032 à 1. Pour cette raison, les bombes zip reposent généralement sur la décompression récursive en insérant des fichiers zip dans des fichiers zip pour obtenir un rapport supplémentaire 1032 avec chaque couche.  Mais l'astuce ne fonctionne que dans les implémentations qui décompressent récursivement, et la plupart ne le font pas.  La bombe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">42.zip la</a> plus célèbre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">se</a> développe à un formidable 4,5 PB si les six couches sont récursivement déballées, mais sur la couche supérieure, elle a 0,6 Mo.  Les tyroliennes, comme celles de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cox</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://web.archive.org/web/20160130230432/">Ellingsen</a> , donnent une copie d'eux-mêmes et, par conséquent, se développent indéfiniment lors du déballage récursif.  Mais ils sont également complètement sûrs lors du déballage une fois. <br><br>  Cet article montre comment créer une bombe zip non récursive, dont le taux de compression dépasse la limite DEFLATE de 1032. Il fonctionne en chevauchant les fichiers à l'intérieur d'un conteneur zip pour référencer le «noyau» de données hautement compressées dans plusieurs fichiers sans faire plusieurs copies.  La taille de sortie de la bombe zip croît de façon quadratique par rapport à la taille d'entrée;  c'est-à-dire que le taux de compression s'améliore avec l'augmentation de la taille de la bombe.  La conception dépend des fonctionnalités de zip et DEFLATE: elle ne peut pas être transférée directement vers d'autres formats de fichiers ou algorithmes de compression.  La bombe est compatible avec la plupart des analyseurs zip, à l'exception de ceux en "streaming", qui analysent les fichiers en une seule fois sans vérifier le répertoire central du fichier zip.  Nous essayons d'équilibrer deux objectifs contradictoires: <br><br><ul><li>  Augmentez le taux de compression.  Nous définissons le taux de compression comme la somme des tailles de tous les fichiers de l'archive divisée par la taille du fichier zip lui-même.  Il ne prend pas en compte les noms de fichiers ou autres métadonnées de système de fichiers, mais uniquement le contenu. <br></li><li>  Gardez la compatibilité.  Zip est un format complexe et les analyseurs diffèrent, en particulier dans les situations limites, et les fonctions supplémentaires.  N'utilisez pas de techniques qui fonctionnent uniquement avec certains analyseurs.  Nous noterons quelques façons d'augmenter l'efficacité d'une bombe zip avec une certaine perte de compatibilité. </li></ul><br><h1>  Structure du fichier Zip </h1><br>  Le fichier zip se compose d'un <i>répertoire central de</i> liens <i>de</i> fichiers. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/896/5d8/074/8965d80745e0b95831b8e3f7c68c5386.svg"><br><br>  Le répertoire central se trouve à la fin du fichier zip.  Il s'agit d'une liste d'en- <i>têtes de répertoire central</i> .  Chaque en-tête de répertoire central contient des métadonnées pour un seul fichier, comme le nom de fichier et la somme de contrôle CRC-32, ainsi qu'un pointeur vers l'en-tête de fichier local.  L'en-tête du répertoire central a une longueur de 46 octets plus la longueur du nom de fichier. <br><br>  Le fichier se compose de l'en-tête du fichier local, suivi des données du fichier compressé.  La longueur de l'en-tête de fichier local est de 30 octets plus la longueur du nom de fichier.  Il contient une copie redondante des métadonnées de l'en-tête du répertoire central, ainsi que les tailles des fichiers de données compressés et non compressés qui se trouvent derrière.  Zip est un format de conteneur, pas un algorithme de compression.  Les données de chaque fichier sont compressées à l'aide de l'algorithme spécifié dans les métadonnées - généralement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DEFLATE</a> . <br><br>  Cette description du format zip omet de nombreux détails qui ne sont pas nécessaires pour comprendre la bombe zip.  Pour des informations complètes, voir la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">section 4.3 APPNOTE.TXT</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«PKZip File Structure» par</a> Florian Buchholz, ou voir le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">code source</a> . <br><br>  Une redondance importante et de nombreuses ambiguïtés au format zip ouvrent des possibilités de méfaits de différents types.  Une bombe zip n'est que la pointe de l'iceberg.  Liens pour plus de lecture: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«Dix mille pièges de sécurité: un format ZIP», par</a> Ginwael Coldwind <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'analyse syntaxique ambiguë vous permet de masquer les fichiers complémentaires de Firefox du linter et des personnes</a> : ma vulnérabilité sur addons.mozilla.org </li></ul><br><h1>  Première découverte: chevauchement de fichiers </h1><br>  En compressant une longue chaîne d'octets répétés, nous pouvons créer un <i>noyau de</i> données hautement compressées.  Le taux de compression du noyau lui-même ne peut pas dépasser la limite DEFLATE de 1032, nous avons donc besoin d'un moyen de réutiliser le noyau dans de nombreux fichiers, sans en créer une copie séparée dans chaque fichier.  Nous pouvons le faire en chevauchant les fichiers: faites en sorte que de nombreux en-têtes du répertoire central pointent vers un seul fichier dont les données sont le cœur. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f80/675/a85/f80675a8530b8adfc1d5847eaaf813ca.svg"><br><br>  Prenons un exemple de la façon dont cette conception affecte le taux de compression.  Supposons qu'un noyau de 1000 octets soit décompressé dans 1 Mo.  Ensuite, le premier mégaoctet de sortie «coûte» 1078 octets de données d'entrée: <br><br><ul><li>  31 octets pour l'en-tête du fichier local (dont 1 nom de fichier octet) <br></li><li>  47 octets pour l'en-tête du répertoire central (y compris un nom de fichier à 1 octet) <br></li><li>  1000 octets par cœur </li></ul><br>  Mais chaque 1 Mo de sortie après le premier ne coûte que 47 octets - nous n'avons pas besoin d'un autre en-tête du fichier local ou d'une autre copie du noyau, seulement d'un en-tête supplémentaire du répertoire central.  Ainsi, alors que le premier maillon du noyau a un taux de compression de 1 000 000/1 078 ≈ 928, chaque maillon supplémentaire rapproche le coefficient de 1 000 000/47 ≈ 21 277, et un gros noyau soulève le plafond. <br><br>  Le problème avec cette idée est le manque de compatibilité.  Étant donné que de nombreux en-têtes du répertoire central pointent vers un en-tête du fichier local, les métadonnées (en particulier, le nom du fichier) ne peuvent pas être les mêmes pour chaque fichier.  Certains analyseurs ne <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">jurent que par cela</a> .  Par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Info-ZIP UnZip</a> (le programme de <code>unzip</code> standard sur Unix) récupère les fichiers, mais avec des avertissements: <br><br><pre>  $ décompressez overlap.zip
   gonflage: A
 B: incompatibilité du nom de fichier "local" (A),
          continuer avec la version "centrale" du nom de fichier
   gonflage: B
 ... </pre><br>  Le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fichier zip</a> Python <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lève</a> également <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">une exception</a> : <br><br><pre>  $ python3 -m fichier zip -e overlap.zip.
 Traceback (dernier appel le plus récent):
 ...
 __main __. BadZipFile: Le nom de fichier dans le répertoire 'B' et l'en-tête b'A 'diffèrent. </pre><br>  Ensuite, nous allons voir comment repenser la cohérence des noms de fichiers, tout en préservant la plupart des avantages des fichiers qui se chevauchent. <br><br><h1>  Deuxième découverte: citer les en-têtes des fichiers locaux </h1><br>  Nous devons séparer les en-têtes des fichiers locaux pour chaque fichier, tout en réutilisant un noyau.  La simple combinaison de tous les en-têtes ne fonctionne pas, car l'analyseur zip trouvera l'en-tête du fichier local là où il attend le début du flux DEFLATE.  Mais l'idée fonctionnera, avec des changements mineurs.  Nous utiliserons la fonction DEFLATE des blocs non compressés pour «citer» les en-têtes des fichiers locaux afin qu'ils semblent faire partie du même flux DEFLATE qui se termine dans le noyau.  Chaque en-tête du fichier local (sauf le premier) sera interprété de deux manières: en tant que code (partie de la structure du fichier zip) et en tant que données (partie du contenu du fichier). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1c1/668/e92/1c1668e92501880340aaf1651df25095.svg"><br><br>  Un flux DEFLATE est une séquence de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">blocs</a> où chaque bloc peut être compressé ou non compressé.  Nous ne pensons généralement qu'aux blocs compressés, par exemple, le noyau est un gros bloc compressé.  Mais il existe également des fichiers non compressés qui commencent par un en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">-tête de 5 octets</a> avec un champ de longueur, ce qui signifie simplement: "affiche les <i>n</i> octets suivants mot pour mot."  Décompresser un bloc non compressé signifie uniquement supprimer l'en-tête de 5 octets.  Les blocs compressés et non compressés peuvent se mélanger librement dans le flux DEFLATE.  La sortie est une concaténation des résultats du déballage de tous les blocs dans l'ordre.  Le concept de «non compressé» n'a d'importance qu'au niveau DEFLATE;  les données des fichiers sont toujours considérées comme «compressées» au niveau zip, quels que soient les blocs utilisés. <br><br>  La façon la plus simple d'imaginer cette conception est un chevauchement interne, du dernier fichier au premier.  Nous commençons par insérer un noyau qui formera la fin du fichier de données pour chaque fichier.  Ajoutez l'en-tête du fichier LFH <sub><i>N</i></sub> local et l'en-tête du répertoire central CDH <sub><i>N</i></sub> qui pointe vers celui-ci.  Définissez le champ de métadonnées «taille compressée» dans LFH <sub><i>N</i></sub> et CDH <sub><i>N</i></sub> sur la taille de noyau compressé.  Ajoutez maintenant l'en-tête de 5 octets du bloc non compressé (en vert sur le diagramme), dont le champ de longueur est égal à la taille LFH <sub><i>N.</i></sub>  Ajoutez le deuxième en-tête du fichier LFH local <sub><i>N</i> -1</sub> et le titre du répertoire central CDH <sub><i>N</i> -1</sub> , qui pointe vers lui.  Définissez le champ de métadonnées «taille compressée» comme nouvel en-tête pour la taille du noyau compressé <i>plus la</i> taille de l'en-tête de bloc non compressé (5 octets) <i>plus la</i> taille de LFH <sub><i>N.</i></sub> <br><br>  Pour le moment, le fichier zip contient deux fichiers avec les noms Y et Z. Voyons ce que l'analyseur verra lors de l'analyse.  Supposons que la taille du noyau compressé soit de 1000 octets et la taille LFH <sub><i>N de</i></sub> 31 octets.  Nous commençons par CDH <sub><i>N</i> -1</sub> et suivons le signe pour LFH <sub><i>N</i> -1</sub> .  Le nom du premier fichier est Y et la taille compressée de son fichier de données est de 1036 octets.  En interprétant les 1036 octets suivants comme un flux DEFLATE, nous rencontrons d'abord un en-tête de 5 octets d'un bloc non compressé qui dit de copier les 31 octets suivants.  Nous écrivons les 31 octets suivants, qui sont LFH <sub><i>N</i></sub> , que nous décompressons et ajoutons au fichier Y. En allant plus loin dans le flux DEFLATE, nous trouvons le bloc compressé (noyau), que nous décompressons dans le fichier Y. Nous avons maintenant atteint la fin des données compressées et terminé avec le fichier Y. <br><br>  Passant au fichier suivant, nous suivons le pointeur de CDH <sub><i>N</i></sub> à LFH <sub><i>N</i></sub> et trouvons un fichier nommé Z avec une taille compressée de 1000 octets.  Interprétant ces 1000 octets comme un flux DEFLATE, nous rencontrons immédiatement un bloc compressé (core encore) et le décompressons dans un fichier Z. Nous avons maintenant atteint la fin du fichier final et terminé.  Le fichier de sortie Z contient le noyau décompressé;  le fichier de sortie Y est le même, mais éventuellement avec un préfixe de 31 octets LFH <sub><i>N.</i></sub> <br><br>  Nous terminons la construction en répétant la procédure de citation jusqu'à ce que l'archive zip contienne le nombre de fichiers requis.  Chaque nouveau fichier ajoute un en-tête de répertoire central, un en-tête de fichier local et un bloc non compressé pour citer directement à partir de l'en-tête de fichier local suivant.  Les données de fichiers compressés sont généralement une chaîne de blocs DEFLATE non compressés (en-têtes de fichiers locaux entre guillemets) suivis d'un noyau compressé.  Chaque octet du noyau contribue à environ 1032 <i>N</i> à la taille de sortie, car chaque octet fait partie de tous les <i>N</i> fichiers.  Les fichiers de sortie sont également de tailles différentes: les premiers sont plus grands que les derniers car ils citent davantage les en-têtes des fichiers locaux.  Le contenu des fichiers de sortie n'a pas beaucoup de sens, mais personne n'a dit que cela devrait avoir du sens. <br><br>  Cette conception de citation de chevauchement a une meilleure compatibilité que la conception de chevauchement complet de la section précédente, mais la compatibilité est obtenue par compression.  Là, chaque fichier ajouté ne coûte que le titre du répertoire central, ici il en coûte le titre du répertoire central, l'en-tête du fichier local et encore 5 octets pour l'en-tête de citation. <br><br><h1>  Optimisation </h1><br>  Après avoir reçu le design de base de la bombe zip, nous allons essayer de la rendre aussi efficace que possible.  Nous voulons répondre à deux questions: <br><br><ul><li>  Quel est le taux de compression maximal pour une taille de fichier zip donnée? <br></li><li>  Quel est le taux de compression maximal compte tenu des limites du format zip? </li></ul><br><h3>  Compression du noyau </h3><br>  Il est avantageux pour nous de compresser le noyau autant que possible, car chaque octet décompressé est multiplié par <i>N.</i>  Pour cela, nous utilisons un compresseur DEFLATE personnalisé appelé bulk_deflate, spécialisé dans la compression d'une chaîne d'octets répétés. <br><br>  Tous les archiveurs DEFLATE décents se rapprochent du taux de compression de 1032 sur un flux sans fin d'octets répétés, mais nous sommes préoccupés par la taille spécifique.  Dans notre taille d'archive, bulk_deflate contient plus de données que les archiveurs à usage général: environ 26 Ko de plus que zlib et Info-ZIP, et environ 15 Ko de plus que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Zopfli</a> , ce qui sacrifie la vitesse au profit de la qualité de la compression. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8b4/cac/e5b/8b4cace5b49ef6945fd1d1ddc8fd7310.svg"><br><br>  Le prix d'un taux de compression élevé bulk_deflate - le manque de polyvalence.  Il ne peut compresser que des lignes d'octets répétitifs et seulement une certaine longueur, à savoir 517 + 258 <i>k</i> pour un entier <i>k</i> ≥ 0. En plus d'une bonne compression, bulk_deflate fonctionne rapidement, effectuant un travail presque en même temps quelle que soit la taille des données d'entrée, compter le travail d'écriture d'une chaîne compressée. <br><br><a name="1"></a><h3>  Noms de fichiers </h3><br>  Pour nos besoins, les noms de fichiers ont presque un poids mort.  Bien qu'ils contribuent à la taille de la sortie en faisant partie des en-têtes des fichiers locaux entre guillemets, les octets du nom de fichier contribuent beaucoup moins que les octets du noyau.  Nous voulons que les noms de fichiers soient aussi courts que possible, tout en étant différents, sans oublier la compatibilité. <br><br>  Chaque octet dépensé sur un nom de fichier signifie deux octets non dépensés sur le noyau (deux car chaque nom de fichier apparaît deux fois: dans l'en-tête du répertoire central et dans l'en-tête du fichier local).  Un octet de nom de fichier donne une moyenne de seulement ( <i>N</i> + 1) / 4 octets de sortie, tandis qu'un octet dans le noyau compte pour 1032 <i>N.</i>  Exemples: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">3</a> . <br><br>  La première considération de compatibilité est le codage.  La spécification du format zip indique que les noms de fichiers doivent être interprétés comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CP 437</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">UTF-8</a> si un bit indicateur spécifique est défini ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">APPNOTE.TXT, annexe D</a> ).  C'est le principal point d'incompatibilité entre les analyseurs zip, qui peuvent interpréter les noms de fichiers dans certains encodages fixes ou spécifiques aux paramètres régionaux.  Par conséquent, pour des raisons de compatibilité, il est préférable de vous limiter aux caractères ayant le même codage dans le CP 437 et l'UTF-8.  À savoir, ce sont 95 caractères US-ASCII imprimables. <br><br>  Nous sommes également liés par des restrictions de dénomination du système de fichiers.  Certains systèmes de fichiers ne sont pas sensibles à la casse, donc «a» et «A» ne sont pas considérés comme des noms différents.  Les systèmes de fichiers courants, tels que FAT32, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">interdisent certains caractères</a> , tels que «*» et «?». <br><br>  Comme compromis sûr, mais pas nécessairement optimal, notre bombe zip utilisera des noms de fichiers issus de l'alphabet à 36 caractères, qui n'inclut pas les caractères spéciaux et les caractères de casse différente: <br><br><pre>  0 1 2 3 4 5 6 7 8 9 ABCDEFGHIJKLMNOPQRSTU VWXYZ </pre><br>  Les noms de fichiers sont générés de manière évidente, toutes les positions à tour de rôle, avec l'ajout d'une position à la fin de la boucle: <br><br><pre>  "0", "1", "2", ..., "Z",
 "00", "01", "02", ..., "0Z",
 ...
 "Z0", "Z1", "Z2", ..., "ZZ",
 "000", "001", "002", ... </pre><br>  Il existe 36 noms de fichier à un caractère, 36² noms à deux caractères, etc.  Quatre octets suffisent pour 1 727 604 noms de fichiers différents. <br><br>  Étant donné que les noms de fichiers dans l'archive auront généralement des longueurs différentes, comment puis-je mieux les trier: du plus court au plus long ou vice versa?  Si vous réfléchissez un peu, il vaut mieux mettre les noms les plus longs en dernier.  Ce tri ajoute plus de 900 Mo de sortie à <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">zblg.zip</a> , par rapport à la commande la plus longue à la plus courte.  Cependant, il s'agit d'une optimisation mineure, car 900 Mo ne représentent que 0,0003% de la taille totale du problème. <br><br><h3>  Taille du noyau </h3><br>  La conception de devis qui se chevauchent vous permet de placer un noyau de données compressé, puis de le copier à plusieurs reprises à moindre coût.  Pour une taille spécifique du fichier zip <i>X</i> , combien d'espace est optimal à allouer pour stocker le noyau, et combien pour créer des copies? <br><br>  Pour trouver l'équilibre optimal, vous devez optimiser une seule variable <i>N</i> , le nombre de fichiers dans l'archive zip.  Chaque valeur <i>N</i> nécessite une certaine quantité de surcharge pour les en-têtes du répertoire central, les en-têtes des fichiers locaux, les en-têtes des blocs de citation et les noms de fichiers.  Le reste de l'espace sera occupé par le noyau.  Étant donné que <i>N</i> doit être un entier et que vous ne pouvez mettre qu'un certain nombre de fichiers avant que la taille du noyau ne tombe à zéro, il suffit de vérifier toutes les valeurs possibles de <i>N</i> et de sélectionner celle qui donne la plus grande sortie. <br><br>  L'application de la procédure d'optimisation à <i>X</i> = 42 374 pour 42.zip trouve un maximum à <i>N</i> = 250. Ces 250 fichiers nécessitent 21 195 octets de surcharge, ce qui laisse 21 179 octets pour le noyau.  Un noyau de cette taille est décompressé en 21 841 249 octets (rapport 1031,3 pour 1).  250 copies du noyau décompressé et quelques en-têtes de fichiers locaux cités donnent une sortie totale décompressée de 5 461 307 620 octets et un taux de compression de 129 000. <br><br><ul><li>  <a href="">zbsm.zip</a> 42 ko → 5,5 Go </li></ul><pre>  zipbomb --mode = quoted_overlap --num-files = 250 --compressed-size = 21179&gt; zbsm.zip </pre><br>  L'optimisation a conduit à une répartition presque uniforme de l'espace entre le noyau et les en-têtes de fichiers.  Ce n'est pas un hasard.  Considérons un modèle simplifié d'une construction de citation avec chevauchement.  Dans un modèle simplifié, nous ignorons les noms de fichiers, ainsi qu'une légère augmentation de la taille du fichier de sortie en raison de la citation des en-têtes des fichiers locaux.  L'analyse du modèle simplifié montrera que la distribution optimale entre le noyau et les en-têtes de fichier est approximativement uniforme, et la taille de sortie avec la distribution optimale croît de façon quadratique en fonction de la taille de l'entrée. <br><br>  Définition de certaines constantes et variables: <br><br><div class="scrollable-table"><table><tbody><tr><td>  X </td><td></td><td>  taille du fichier zip (considéré comme fixe) </td></tr><tr><td>  N </td><td></td><td>  nombre de fichiers dans l'archive zip (variable d'optimisation) </td></tr><tr><td>  Cdh </td><td>  = 46 </td><td>  taille d'en-tête du répertoire central (sans nom de fichier) </td></tr><tr><td>  Lfh </td><td>  = 30 </td><td>  taille de l'en-tête du fichier local (sans nom de fichier) </td></tr><tr><td>  Q </td><td>  = 5 </td><td>  DEFLATE bloc taille non compressée </td></tr><tr><td>  C </td><td>  ≈ 1032 </td><td>  taux de compression du noyau </td></tr></tbody></table></div><br>  Soit <i>H (N)</i> le volume de la surcharge pour les en-têtes de <i>N</i> fichiers.  Consultez le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tableau</a> pour comprendre l'essence de la formule. <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2">H</span><span class="MJXp-mo" id="MJXp-Span-3" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4">N</span><span class="MJXp-mo" id="MJXp-Span-5" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-6" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7">N</span><span class="MJXp-mo" id="MJXp-Span-8" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mo" id="MJXp-Span-9" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-10">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-11">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12">H</span><span class="MJXp-mo" id="MJXp-Span-13" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14">L</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15">F</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-16">H</span><span class="MJXp-mo" id="MJXp-Span-17" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-18" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-19" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20">N</span><span class="MJXp-mo" id="MJXp-Span-21" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-22">1</span><span class="MJXp-mo" id="MJXp-Span-23" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-24" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-25">Q</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="42.802ex" height="2.66ex" viewBox="0 -832 18428.8 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMATHI-48" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMAIN-28" x="888" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMATHI-4E" x="1278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMAIN-29" x="2166" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMAIN-3D" x="2833" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMATHI-4E" x="3890" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMAIN-22C5" x="5000" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMAIN-28" x="5501" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMATHI-43" x="5891" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMATHI-44" x="6651" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMATHI-48" x="7480" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMAIN-2B" x="8590" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMATHI-4C" x="9591" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMATHI-46" x="10272" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMATHI-48" x="11022" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMAIN-29" x="11910" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMAIN-2B" x="12522" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMAIN-28" x="13523" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMATHI-4E" x="13912" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMAIN-2212" x="15023" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMAIN-31" x="16024" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMAIN-29" x="16524" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMAIN-22C5" x="17136" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgUoPTXSUHqKSEMko6o-2OmwkjjZg#MJMATHI-51" x="17637" y="0"></use></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> H (N) = N ⋅ (CDH + LFH) + (N - 1) ⋅ Q </script></p><br>  Pour le noyau, il reste des emplacements <i>X - H (N)</i> .  La taille totale décompressée <i>S <sub>X</sub> (N)</i> est égale à la taille de <i>N</i> copies du noyau décompressé avec le rapport <i>C</i> (dans ce modèle simplifié, nous ignorons la légère extension supplémentaire des en-têtes de fichiers locaux mentionnés). <br><br><p><math> </math> $$ afficher $$ S_X (N) = (X - H (N)) CN \\ = (X - (N ⋅ (CDH + LFH) + (N - 1) ⋅ Q)) CN \\ = - - (CDH + LFH + Q) CN ^ 2 + (X + Q) CN $$ afficher $$ </p><br>  S <sub>X</sub> (N) est un polynôme dans la partie N, par conséquent, le maximum devrait être où la dérivée S ' <sub>X</sub> (N) est égale à zéro.  Prendre la dérivée et trouver zéro nous donne N <sub>OPT</sub> , le nombre optimal de fichiers. <br><br><p><math> </math> $$ afficher $$ S′X (N_ {OPT}) = −2 (CDH + LFH + Q) C N_ {OPT} + (X + Q) C \\ 0 = −2 (CDH + LFH + Q) C N_ {OPT} + (X + Q) C \\ N_ {OPT} = (X + Q) / (CDH + LFH + Q) / 2 $$ affichage $$ </p><br>  <i>H (N <sub>OPT</sub> )</i> donne la quantité optimale d'espace pour placer les en-têtes de fichier.  Il est indépendant de CDH, LFH et C et est proche de <i>X / 2</i> . <br><br><p><math> </math> $$ afficher $$ H (N_ {OPT}) = N_ {OPT} ⋅ (CDH + LFH) + (N_ {OPT} - 1) ⋅ Q \\ = (X - Q) / 2 $$ afficher $$ </p><br>  S <sub>X</sub> (N <sub>OPT</sub> ) - taille totale non emballée à distribution optimale.  De cela, nous voyons que la taille de la sortie augmente de façon quadratique avec l'augmentation des données d'entrée. <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-249"><span class="MJXp-msubsup" id="MJXp-Span-250"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-251" style="margin-right: 0.05em;">S</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-252" style="vertical-align: -0.4em;">X</span></span><span class="MJXp-mo" id="MJXp-Span-253" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-254"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-255" style="margin-right: 0.05em;">N</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-256" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-257">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-258">P</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-259">T</span></span></span><span class="MJXp-mo" id="MJXp-Span-260" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-261" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-262" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-263">X</span><span class="MJXp-mo" id="MJXp-Span-264" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-265">Q</span><span class="MJXp-msubsup" id="MJXp-Span-266"><span class="MJXp-mo" id="MJXp-Span-267" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-268" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-269">C</span><span class="MJXp-mrow" id="MJXp-Span-270"><span class="MJXp-mo" id="MJXp-Span-271" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mo" id="MJXp-Span-272" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-273">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-274">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-275">H</span><span class="MJXp-mo" id="MJXp-Span-276" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-277">L</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-278">F</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-279">H</span><span class="MJXp-mo" id="MJXp-Span-280" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-281">Q</span><span class="MJXp-mo" id="MJXp-Span-282" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mrow" id="MJXp-Span-283"><span class="MJXp-mo" id="MJXp-Span-284" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mn" id="MJXp-Span-285">4</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-5"> S_X (N_ {OPT}) = (X + Q) ^ 2C / (CDH + LFH + Q) / 4 </script></p><br>  En augmentant la taille du fichier zip, nous rencontrerons finalement les limites du format zip: l'archive ne peut pas avoir plus de 2 <sup>16</sup> −1 fichiers avec une taille ne dépassant pas 2 <sup>32</sup> −1 octets chacun.  Pire, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">certaines implémentations</a> prennent des valeurs maximales comme indicateur de la présence d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">extensions 64 bits</a> , donc nos limites sont en fait 2 <sup>16</sup> -2 et 2 <sup>32</sup> -2.  Il arrive que la première fois nous rencontrons une limite sur la taille d'un fichier non compressé.  Avec une taille de fichier zip de 8 319 377 octets, l'optimisation naïve nous donnera le nombre de fichiers 47 837 et un fichier maximum de 2 <sup>32</sup> +311 octets. <br><br>  (En fait, tout est un peu plus compliqué, car les limites exactes dépendent de l'implémentation. Le fichier zip Python <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ignore le</a> nombre de fichiers, archive / zip dans Go <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">permet d'</a> augmenter le nombre de fichiers jusqu'à ce qu'ils correspondent aux 16 bits inférieurs. Mais pour une compatibilité générale, nous devons respecter limites établies). <br><br>  Si nous ne pouvons pas augmenter indéfiniment <i>N</i> ou la taille du noyau, nous aimerions trouver le taux de compression maximum dans le format zip.  Vous devez rendre le noyau aussi grand que possible avec le nombre maximum de fichiers.  Malgré le fait que nous ne pouvons plus maintenir une séparation approximativement uniforme entre le noyau et les en-têtes de fichiers, chaque fichier ajouté augmente <i>toujours</i> le taux de compression - mais pas aussi vite que si nous pouvions continuer à augmenter le noyau.  En fait, à mesure que des fichiers sont ajoutés, nous devrons <i>réduire la</i> taille du noyau pour libérer de l'espace pour la taille de fichier maximale, qui augmente légèrement avec chaque fichier ajouté. <br><br>  Le plan conduit à une archive zip avec 2 <sup>16</sup> −2 fichiers et un noyau, qui est décompressé en 2 <sup>32</sup> −2 178 825 octets.  Les fichiers seront plus volumineux vers le début de l'archive zip - le premier et le plus gros fichier est décompressé en 2 <sup>32</sup> −56 octets.  C'est aussi proche que possible de l'utilisation des paramètres de sortie approximatifs de bulk_deflate - l'encodage des 54 derniers octets coûtera plus cher que leur taille (le fichier zip dans son ensemble a un taux de compression de 28 millions, et les 54 derniers octets recevront un maximum de 54 ⋅ 10 <sup>32</sup> ⋅ ( 2 <sup>16</sup> - 2) ≈ 36 - 5 millions d'octets, donc cela n'aide que si 54 octets peuvent être encodés en un octet - et je n'ai pas pu coder en moins de deux. Par conséquent, si vous ne pouvez pas encoder 54 octets en 1 octet, cela ne fait que réduire le taux de compression).  La taille de sortie de cette bombe zip est de 281 395 456 244 934 octets, 99,97% du maximum théorique (2 <sup>32</sup> - 1) × (2 <sup>16</sup> - 1).  Toute amélioration significative du taux de compression ne peut être obtenue qu'en réduisant la taille du signal d'entrée et non en augmentant la sortie. <br><br><ul><li>  <a href="">zblg.zip</a> 10 Mo → 281 To </li></ul><pre>  zipbomb --mode = quoted_overlap --num-files = 65534 --max-uncompressed-size = 4292788525&gt; zblg.zip </pre><br><h1>  Calcul CRC-32 efficace </h1><br>  Parmi les métadonnées dans l'en-tête du répertoire central et l'en-tête du fichier local se trouve une somme de contrôle des données du fichier non compressé - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CRC-32</a> .  Cela pose un problème car la quantité de calculs CRC-32 pour chaque fichier est proportionnelle à sa taille, qui est très grande par défaut (après tout, c'est une bombe zip).  Nous préférons effectuer un travail au moins proportionnel à la taille de l'archive.  Deux facteurs jouent en notre faveur: tous les fichiers ont un noyau commun et un noyau non compressé est une chaîne d'octets répétés.  Imaginez le CRC-32 comme un produit matriciel - cela nous permettra non seulement de calculer rapidement la somme de contrôle du noyau, mais également de réutiliser les calculs entre les fichiers.  La méthode décrite dans cette section est une petite extension de la fonction <a href="">crc32_combine</a> dans zlib, que Mark Adler explique <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Le CRC-32 peut être modélisé comme une machine d'état, mettant à jour un registre d'état 32 bits pour chaque bit d'entrée.  Les opérations de mise à jour de base pour les bits 0 et 1 sont les suivantes: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">uint32 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crc32_update_0</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint32 state)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Shift out the least significant bit. bit b = state &amp; 1; state = state &gt;&gt; 1; // If the shifted-out bit was 1, XOR with the CRC-32 constant. if (b == 1) state = state ^ 0xedb88320; return state; } uint32 crc32_update_1(uint32 state) { // Do as for a 0 bit, then XOR with the CRC-32 constant. return crc32_update_0(state) ^ 0xedb88320; }</span></span></code> </pre> <br>  Si vous représentez le registre d'état comme un vecteur binaire à 32 éléments et utilisez XOR pour l'addition et la multiplication, alors <code>crc32_update_0</code> est un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mappage linéaire</a> ;  c'est-à-dire qu'il peut être représenté comme une multiplication par une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">matrice de transition</a> binaire 32 × 32.  Pour comprendre pourquoi, notez que multiplier une matrice par un vecteur revient simplement à additionner les colonnes de la matrice après avoir multiplié chaque colonne par l'élément correspondant du vecteur.  L' <code>state &gt;&gt; 1</code> opération de décalage <code>state &gt;&gt; 1</code> prend simplement chaque bit <i>i</i> du vecteur d'état et le multiplie par un vecteur qui est nul partout sauf pour le bit <i>i</i> - 1 (numérotation des bits de droite à gauche).  Relativement parlant, l' <code>state ^ 0xedb88320</code> XOR final <code>state ^ 0xedb88320</code> se produit uniquement lorsque le bit <code>b</code> est égal à un.  Cela peut être représenté comme la première multiplication de b par 0xedb88320, puis XORing à cet état. <br><br>  De plus, <code>crc32_update_1</code> n'est qu'une <code>crc32_update_0</code> plus (XOR).<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela fait </font></font><code>crc32_update_1</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une transformation affine</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : multiplication matricielle suivie d'une cartographie (c'est-à-dire, addition de vecteur). Nous pouvons imaginer la multiplication et la cartographie matricielles en une seule étape, si nous augmentons la taille de la matrice de transformation à 33 × 33 et ajoutons un élément supplémentaire au vecteur d'état, qui est toujours 1 (cette représentation est appelée </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordonnées homogènes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><img src="https://habrastorage.org/webt/sg/ay/or/sgayorbdqetnkmc1y-qm42uywic.png"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les matrices de transformation sont 33 × 33 M </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et M </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui calculent le changement d'état CRC-32 effectué respectivement par les bits 0 et 1. Les vecteurs de colonne sont stockés avec le bit le plus significatif ci-dessous: en lisant la première colonne de bas en haut, vous voyez la constante polynomiale CRC-32 edb8832016 = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">111</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">111</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 000 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 00000 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 00 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 00000 </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ces deux matrices ne diffèrent que dans la dernière colonne, qui représente le vecteur de translation en coordonnées homogènes. Dans M </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0, la</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> translation est nulle et dans M </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1, c'est</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> edb88320 </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la constante polynomiale est CRC-32. Les </font><font style="vertical-align: inherit;">unités sont immédiatement au-dessus de l'état de l'opération en </font><font style="vertical-align: inherit;">diagonale</font></font><code>state &gt;&gt; 1</code></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> deux opérations</font></font><code>crc32_update_0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et</font></font><code>crc32_update_1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peuvent être représentés par la matrice de transition de 33 x 33. Les matrices M</font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et M</font><sub><font style="vertical-align: inherit;"> 1</font></sub><font style="vertical-align: inherit;"> sont représentées.</font></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">L'avantage de la représentation matricielle est que les matrices peuvent être multipliées. </font><font style="vertical-align: inherit;">Supposons que nous voulons voir un changement d'état effectué en traitant un caractère ASCII «a», dont la représentation binaire est 01100001 </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">On peut imaginer le changement cumulé de l'état du CRC-32 de ces huit bits dans une matrice de transformation:</font></font><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-286"><span class="MJXp-msubsup" id="MJXp-Span-287"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-288" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-289" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-290" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-291"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-292" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-293" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-294"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-295" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-296" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-297"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-298" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-299" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-300"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-301" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-302" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-303"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-304" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-305" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-306"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-307" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-308" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-309"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-310" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-311" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-312"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-313" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-314" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-6">M_a = M_0 M_1 M_1 M_0 M_0 M_0 M_0 M_1</script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et nous pouvons imaginer un changement dans l'état d'une rangée répétant «a» en multipliant plusieurs copies de M </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - élevant la matrice à une puissance. </font><font style="vertical-align: inherit;">Nous pouvons le </font><font style="vertical-align: inherit;">faire rapidement en </font><font style="vertical-align: inherit;">utilisant l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">algorithme d'exponentiation rapide</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ce </font><font style="vertical-align: inherit;">qui permet de calculer le M </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> connectez </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 </font></font></sub> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> étapes. </font><font style="vertical-align: inherit;">Par exemple, voici une matrice pour changer l'état d'une chaîne de 9 caractères 'a':</font></font><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-315"><span class="MJXp-mo" id="MJXp-Span-316" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-317"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-318" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-319" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-320"><span class="MJXp-mo" id="MJXp-Span-321" style="margin-left: 0em; margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-322" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-323" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-324"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-325" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-326" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-327"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-328" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-329" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-330"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-331" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-332" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-333"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-334" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-335" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-336"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-337" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-338" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-339"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-340" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-341" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-342"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-343" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-344" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-345"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-346" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-347" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span></span><font style="vertical-align: inherit;"><span class="MJXp-msubsup" id="MJXp-Span-348"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-349" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">M </font></span></span><span class="MJXp-msubsup" id="MJXp-Span-348"><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-350" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;">a </font></span></span><span class="MJXp-msubsup" id="MJXp-Span-345"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-346" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">M </font></span></span><span class="MJXp-msubsup" id="MJXp-Span-345"><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-347" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;">a </font></span></span></font><span class="MJXp-msubsup" id="MJXp-Span-348"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-349" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-350" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></span></span><span class="MJXp-mspace" id="MJXp-Span-351" style="width: 0em; height: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-352" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-353" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-354"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-355" style="margin-right: 0.05em;">M</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-356" style="vertical-align: -0.4em;">a</span></span><span class="MJXp-msubsup" id="MJXp-Span-357"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-358" style="margin-right: 0.05em;">M</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-359" style="vertical-align: -0.4em;">a</span></span><span class="MJXp-msubsup" id="MJXp-Span-360"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-361" style="margin-right: 0.05em;">M</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-362" style="vertical-align: -0.4em;">a</span></span><span class="MJXp-msubsup" id="MJXp-Span-363"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-364" style="margin-right: 0.05em;">M</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-365" style="vertical-align: -0.4em;">a</span></span><span class="MJXp-msubsup" id="MJXp-Span-366"><span class="MJXp-mo" id="MJXp-Span-367" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-368" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-369"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-370" style="margin-right: 0.05em;">M</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-371" style="vertical-align: -0.4em;">a</span></span><span class="MJXp-mspace" id="MJXp-Span-372" style="width: 0em; height: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-373" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-374" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-375" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-376"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-377" style="margin-right: 0.05em;">M</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-378" style="vertical-align: -0.4em;">a</span></span><span class="MJXp-msubsup" id="MJXp-Span-379"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-380" style="margin-right: 0.05em;">M</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-381" style="vertical-align: -0.4em;">a</span></span><span class="MJXp-msubsup" id="MJXp-Span-382"><span class="MJXp-mo" id="MJXp-Span-383" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-384" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-385"><span class="MJXp-mo" id="MJXp-Span-386" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-387" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-388"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-389" style="margin-right: 0.05em;">M</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-390" style="vertical-align: -0.4em;">a</span></span><span class="MJXp-mspace" id="MJXp-Span-391" style="width: 0em; height: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-392" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-393" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-394" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-395" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-396"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-397" style="margin-right: 0.05em;">M</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-398" style="vertical-align: -0.4em;">a</span></span><span class="MJXp-msubsup" id="MJXp-Span-399"><span class="MJXp-mo" id="MJXp-Span-400" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-401" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-402"><span class="MJXp-mo" id="MJXp-Span-403" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-404" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-405"><span class="MJXp-mo" id="MJXp-Span-406" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-407" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-408"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-409" style="margin-right: 0.05em;">M</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-410" style="vertical-align: -0.4em;">a</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-7">(M_a)^9 = M_a M_a M_a M_a M_a M_a M_a M_a M_a\\ = (M_a M_a M_a M_a)^2 M_a\\ = ((M_a M_a)^2)^2 M_a\\ = (((M_a)^2)^2)^2 M_a</script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'algorithme de multiplication rapide de matrice est utile pour calculer le </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">noyau</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> M </font><font style="vertical-align: inherit;">, une matrice pour un noyau non compressé, car le noyau est une chaîne d'octets répétés. Pour obtenir la somme de contrôle CRC-32 de la matrice, multipliez la matrice par le vecteur zéro (le vecteur zéro est en coordonnées uniformes, soit 32 zéros, puis l'unité; ici, nous omettons la légère complication du pré et post-traitement de la somme de contrôle pour vérifier la conformité). Pour calculer la somme de contrôle de chaque fichier, nous travaillons dans la direction opposée. Nous commençons par un initialisées </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M: M = </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le noyau</font></font></sub></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . La somme de contrôle du noyau est également la somme de contrôle du fichier final </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , donc nous multiplions </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un vecteur zéro et stocke la somme de </font><font style="vertical-align: inherit;">contrôle reçue dans la CDH </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et LFH </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Les données du fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N - 1 sont les</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mêmes que les données du fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais avec le préfixe LFH </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ajouté </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Par conséquent, nous calculons</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-411"><span class="MJXp-msubsup" id="MJXp-Span-412"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-413" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-414" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-415"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L </font></font></span><span class="MJXp-mrow" id="MJXp-Span-416"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-417"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-418"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-419" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-420" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></span></span></span></span></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , matrice de changement d'état pour LFH</font><sub><font style="vertical-align: inherit;">N</font></sub><font style="vertical-align: inherit;">et mise à jour</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-8">M_{L{FH_N}}</script><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-421"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-422"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mo" id="MJXp-Span-423" style="margin-left: 0.111em; margin-right: 0.167em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-424"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-425"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-426" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-427" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-428"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L </font></font></span><span class="MJXp-mrow" id="MJXp-Span-429"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-430"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-431"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-432" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-433" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></span></span></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-9">M := M M_{L{FH_N}}</script>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> représente le changement d'état cumulatif du traitement de LFH </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> derrière le noyau. </font><font style="vertical-align: inherit;">Nous calculons la somme de contrôle pour le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N - 1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , multipliant à nouveau </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> par le vecteur zéro. </font><font style="vertical-align: inherit;">Nous continuons la procédure en accumulant des matrices de changement d'état dans </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jusqu'à ce que tous les fichiers soient traités.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Extension: Zip64 </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plus tôt, nous avons été confrontés au problème de l'expansion en raison des limitations du format zip - il était impossible d'émettre plus de 281 To, quelle que soit la façon dont le fichier zip était emballé. </font><font style="vertical-align: inherit;">Vous pouvez transcender ces limites en utilisant </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zip64</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, une extension au format zip qui augmente la taille de certains champs d'en-tête à 64 bits. La prise en charge de Zip64 n'est en aucun cas universelle, mais c'est l'une des extensions les plus couramment implémentées. Quant au taux de compression, l'effet de Zip64 est d'augmenter la taille de l'en-tête du répertoire central de 46 à 58 octets, et la taille de l'en-tête du répertoire local de 30 à 50 octets. En regardant la formule du coefficient d'expansion optimal dans un modèle simplifié, nous voyons que la bombe zip au format Zip64 croît toujours de manière quadratique, mais plus lentement en raison du plus grand dénominateur - cela peut être vu dans le diagramme ci-dessous. En raison de la perte de compatibilité et du retard de croissance, nous supprimons presque toutes les restrictions sur la taille des fichiers.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supposons que nous ayons besoin d'une bombe zip qui se développe à 4,5 PB, comme 42.zip. </font><font style="vertical-align: inherit;">Quelle doit être la taille des archives? </font><font style="vertical-align: inherit;">En utilisant la recherche binaire, nous constatons que la taille minimale d'un tel fichier est de 46 Mo.</font></font><br><br><ul><li> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zbxl.zip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 46 Mo → 4,5 PB (Zip64, moins compatible)</font></font></li></ul><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zipbomb --mode = quoted_overlap --num-files = 190023 --compressed-size = 22982788 --zip64&gt; zbxl.zip </font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4,5 pétaoctets - à peu près la </font><font style="vertical-align: inherit;">même </font><font style="vertical-align: inherit;">quantité de données a été enregistrée par le télescope Event Horizon pour la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">première image d'un trou noir</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : des racks et des racks avec des disques durs dans le centre de données. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avec Zip64, il n'est presque pas intéressant de considérer le taux de compression maximal, car nous pouvons simplement continuer à augmenter la taille du fichier zip et le taux de compression avec lui, jusqu'à ce que même le fichier zip compressé devienne prohibitif. Un seuil intéressant, cependant, est de 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> octets (18 EB ou 16 EiB) - tant de données ne rentreront pas sur la plupart des systèmes de fichiers. La recherche binaire trouve la plus petite bombe zip qui produit au moins autant de sortie: elle contient 12 millions de fichiers et un noyau compressé de 1,5 Go. La taille totale du fichier zip est de 2,9 Go et il est déballé en 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+11 727 895 877 octets avec un taux de compression de plus de 6,2 milliards à un. </font><font style="vertical-align: inherit;">Je n'ai pas téléchargé ce fichier pour le télécharger, mais vous pouvez le générer vous-même en utilisant le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code source</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il a des fichiers d'une taille telle que même un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bug a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> été révélé </font><font style="vertical-align: inherit;">dans Info-ZIP UnZip 6.0.</font></font><br><br><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zipbomb --mode = quoted_overlap --num-files = 12056313 --compressed-size = 1482284040 --zip64&gt; zbxxl.zip </font></font></pre><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Extension: bzip2 </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DEFLATE est l'algorithme de compression le plus courant pour le format zip, mais ce n'est qu'une des nombreuses options. Le deuxième algorithme le plus courant est probablement </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bzip2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Bien qu'il ne soit pas aussi compatible que DEFLATE. Théoriquement, dans bzip2, le taux de compression maximal est d'environ 1,4 million pour un, ce qui permet un compactage plus dense du noyau. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bzip2 code d'abord le «codage de longueur d'exécution», réduisant de 51 fois la longueur de chaîne des octets répétés. Ensuite, les données sont divisées en blocs de 900 Ko et chaque bloc est compressé séparément. Théoriquement, un bloc peut compresser jusqu'à 32 octets. 900 000 × 51/32 = 1 434 375. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ignorant la perte de compatibilité, bzip2 fait-il une bombe plus efficace?</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oui - mais uniquement pour les petits fichiers. Le problème est que dans bzip2 il n'y a rien de tel que les blocs DEFLATE non compressés que nous avons utilisés pour citer les en-têtes des fichiers locaux. Ainsi, il est impossible de chevaucher des fichiers et de réutiliser le noyau - pour chaque fichier, vous devez écrire votre propre copie, donc le taux de compression global ne sera pas meilleur que le taux pour un seul fichier. Dans le graphique ci-dessous, nous voyons que sans chevauchement, bzip2 est supérieur à DEFLATE uniquement pour les fichiers d'environ mégaoctets. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il n'y a qu'un espoir pour un autre moyen de citer les en-têtes dans bzip2, qui est discuté dans la section suivante. De plus, si vous savez qu'un analyseur zip particulier prend en charge bzip2 </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permet des noms de fichiers incompatibles, vous pouvez utiliser la construction de chevauchement complète, qui n'a pas besoin d'être citée. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/350/bb1/aa1/350bb1aa131f71762b2ad03d4203ac66.svg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparaison du taux de compression de différentes bombes zip. Faites attention à l'axe logarithmique. Chaque design est illustré avec et sans Zip64. Les structures sans chevauchement ont un taux de croissance linéaire, qui peut être vu à partir du rapport constant des axes. Le décalage vertical du graphique bzip2 signifie que le taux de compression de bzip2 est environ mille fois supérieur à celui de DEFLATE. Les constructions DEFLATE citées ont un taux de croissance quadratique, comme en témoigne une inclinaison vers les axes 2: 1. La variante Zip64 est légèrement moins efficace, mais permet plus de 281 To. Les graphiques pour bzip2 avec des citations à travers un champ supplémentaire passent de quadratique à linéaire lorsque la taille maximale du fichier est atteinte (2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> −2 octets), ou le nombre maximal autorisé de fichiers</font></font></font></i> <br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Extension: cotation via un champ supplémentaire </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jusqu'à présent, nous avons utilisé la fonction DEFLATE pour citer les en-têtes des fichiers locaux, et nous venons de voir que cette astuce ne fonctionne pas dans bzip2. </font><font style="vertical-align: inherit;">Cependant, il existe une autre méthode de citation, un peu plus limitée, qui n'utilise que des fonctions de format zip et est indépendante de l'algorithme de compression. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">À la fin de la structure d'en-tête du fichier local, il y a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un champ supplémentaire de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> longueur variable pour stocker des informations qui ne correspondent pas aux champs d'en-tête habituels ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APPNOTE.TXT, section 4.3.7</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">Des informations supplémentaires peuvent inclure, par exemple, un horodatage ou un uid / gid d'Unix. </font><font style="vertical-align: inherit;">Les informations Zip64 sont également stockées dans un champ supplémentaire. </font><font style="vertical-align: inherit;">Un champ supplémentaire est représenté comme une structure de valeur de longueur; </font><font style="vertical-align: inherit;">si vous augmentez la longueur sans ajouter de valeur, le champ supplémentaire inclura ce qu'il y a derrière dans le fichier zip, à savoir l'en-tête suivant du fichier local. </font><font style="vertical-align: inherit;">En utilisant cette méthode, chaque en-tête du fichier local peut «citer» les en-têtes suivants, en les enfermant dans son propre champ supplémentaire. </font><font style="vertical-align: inherit;">Comparé à DEFLATE, il y a trois avantages:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Citer via un champ supplémentaire ne nécessite que 4 octets, pas 5, ce qui laisse plus d'espace pour le noyau. </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il n'augmente pas la taille du fichier, ce qui signifie un noyau plus grand, compte tenu des limites du format zip. </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il fournit des citations dans bzip2. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Malgré ces avantages, la cotation dans des champs supplémentaires est moins flexible. Ce n'est pas une chaîne, comme dans DEFLATE: chaque en-tête d'un fichier local doit contenir non seulement l'en-tête immédiatement suivant, mais aussi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tous</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> les en-têtes suivants. Les champs supplémentaires augmentent à mesure que vous approchez du début du fichier zip. Étant donné que la longueur maximale du champ est de 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> −1 octets, seuls 1808 en-têtes de fichiers locaux (ou 1170 en Zip64) peuvent être cités, en supposant que les noms sont </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">attribués comme prévu.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(dans le cas de DEFLATE, vous pouvez utiliser un champ supplémentaire pour citer les premiers en-têtes (les plus courts) des fichiers locaux, puis passer à la citation DEFLATE pour le reste). Autre problème: pour correspondre à la structure interne des données du champ supplémentaire, il est nécessaire de sélectionner une balise 16 bits pour le type ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APPNOTE.TXT, section 4.5.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) précédant les données de citation. Nous voulons sélectionner une balise de type qui obligera les analyseurs à ignorer les données entre guillemets, plutôt que d'essayer de les interpréter comme des métadonnées significatives. Les analyseurs Zip devraient ignorer les balises de type inconnu, afin que nous puissions sélectionner des balises au hasard, mais il y a un risque qu'à l'avenir certaines balises violent la compatibilité du design.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le schéma précédent illustre la possibilité d'utiliser des champs supplémentaires dans bzip2, c et sans Zip64. Sur les deux graphiques, il y a un tournant, lorsque la croissance passe du quadratique au linéaire. Sans Zip64, cela se produit lorsque la taille maximale du fichier non compressé est atteinte (2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">−2 octets); alors vous pouvez seulement augmenter le nombre de fichiers, mais pas leur taille. Le graphique se termine complètement lorsque le nombre de fichiers atteint 1809, puis nous manquons d'espace dans un champ supplémentaire pour citer des en-têtes supplémentaires. Avec Zip64, une fracture se produit sur 1171 fichiers, après quoi seule la taille du fichier peut être augmentée, mais pas leur nombre. Un champ supplémentaire aide dans le cas de DEFLATE, mais la différence est si petite qu'elle n'est pas visuellement perceptible. Il augmente le taux de compression de zbsm.zip de 1,2%; zblg.zip de 0,019%; et zbxl.zip de 0,0025%.</font></font><br><br><h1>  La discussion </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans leur travail sur ce sujet, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pletz et ses collègues</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilisent le chevauchement de fichiers pour créer une archive zip presque auto-réplicable. Le chevauchement du fichier lui-même a été </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suggéré plus tôt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (diapositive 47) par Ginvael Coldwind. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons développé une conception d'une bombe zip avec un chevauchement de devis prenant en compte la compatibilité - un certain nombre de différences dans les implémentations, dont certaines sont présentées dans le tableau ci-dessous. La conception résultante est compatible avec les analyseurs zip qui fonctionnent de la manière habituelle, c'est-à-dire en vérifiant d'abord le répertoire central et en l'utilisant comme index de fichiers. Parmi eux, un analyseur zip unique de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nail</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui est généré automatiquement à partir de la grammaire formelle. Cependant, la conception est incompatible avec les analyseurs "en streaming", qui analysent le fichier zip du début à la fin en une seule passe sans avoir d'abord lu le répertoire central. De par leur nature, les analyseurs en streaming ne permettent en aucun cas aux fichiers de se chevaucher. Très probablement, ils extrairont uniquement le premier fichier. De plus, ils peuvent même </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lancer une</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erreur, comme c'est le cas avec </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">sunzip</font></a><font style="vertical-align: inherit;"> , qui analyse le répertoire central à la fin et vérifie la cohérence avec les en-têtes des fichiers locaux qu'il a déjà vus.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous souhaitez que les fichiers extraits commencent par un préfixe spécifique différent des octets d'en-tête du fichier local, vous pouvez insérer un bloc DEFLATE avant le bloc non compressé cité par l'en-tête suivant. Tous les fichiers de l'archive zip ne doivent pas participer à la création de la bombe: vous pouvez inclure des fichiers ordinaires dans l'archive, si nécessaire, afin de correspondre à un format spécial (il y a un paramètre dans le code source </font></font><code>--template</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour ce cas d'utilisation). De nombreux formats utilisent zip comme conteneur, tels que les documents Java JAR, Android APK et LibreOffice. </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pdf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">à bien des égards similaire à zip. Il a une table de références croisées à la fin du fichier qui pointe vers les objets précédents, et il prend en charge la compression des objets via le filtre FlateDecode. Je n'ai pas essayé, mais vous pouvez utiliser l'idée de citer avec chevauchement pour fabriquer une bombe PDF. Peut-être que vous n'avez même pas à travailler dur ici: binaryhax0r </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">écrit dans un article de blog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que vous pouvez simplement spécifier plusieurs couches FlateDecode sur un objet, après quoi la création d'une bombe PDF devient triviale. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Définir une classe particulière de bombes zip décrit dans cet article est simple: il suffit de trouver les fichiers qui se chevauchent. Mark Adler a écrit un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">patch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour Unzip Info-ZIP, qui fait exactement cela. </font><font style="vertical-align: inherit;">Cependant, en général, le blocage des fichiers qui se chevauchent ne protège pas contre toutes les classes de bombes zip. </font><font style="vertical-align: inherit;">Il est difficile de prédire à l'avance si le fichier est une bombe zip ou non si vous n'avez pas une connaissance précise des composants internes des analyseurs qui seront utilisés pour l'analyser. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La consultation des en-têtes et la somme des champs «taille non compressée» de tous les fichiers ne fonctionnent pas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , car la valeur dans les en-têtes peut ne pas correspondre à la taille réelle non compressée (dans le tableau de compatibilité, voir la ligne «permet que le fichier soit trop petit»). </font><font style="vertical-align: inherit;">Une protection fiable contre les bombes zip comprend des limites de temps, de mémoire et d'espace disque dans l'analyseur zip pendant son fonctionnement. </font><font style="vertical-align: inherit;">Prenez l'analyse des fichiers zip, comme toutes les opérations complexes avec des données non fiables, avec prudence.</font></font><br><br><div class="scrollable-table"><table><thead><tr><td></td><th> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Info-zip </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UnZip 6.0</font></font></a> </th><th> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Python 3.7 <br> zipfile</a> </th><th> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Go 1.12 <br> archive/zip</a> </th><th> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">yauzl 2.10.0 <br> (Node.js)</a> </th><th> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nail <br> examples/zip</a> </th><th> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Android 9.0.0 r1 <br> libziparchive</a> </th><th> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sunzip 0.4</a> <br> (streaming) </th></tr></thead><tbody><tr><th> DEFLATE </th><td>  ✓ </td><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td></tr><tr><th> Zip64 </th><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">✓</a> </td><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="">−</a> </td><td> <a href="">−</a> </td><td> <a href="">✓</a> </td></tr><tr><th> bzip2 </th><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">✓</a> </td><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">✓</a> </td><td> <a href="">−</a> </td><td> <a href="">−</a> </td><td> <a href="">−</a> </td><td> <a href="">−</a> </td><td> <a href="">✓</a> </td></tr><tr><th>     </th><td>  </td><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">−</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="">−</a> </td><td> <a href="">✓</a> </td></tr><tr><th>   CRC-32 </th><td> <abbr title="montre le CRC attendu et réel"></abbr> </td><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">−</a> </td><td> <a href=""> </a> </td><td> <a href="">✓</a> </td><td> <a href="">−</a> </td><td> <a href="">✓</a> </td><td> <a href="">−</a> </td></tr><tr><th>      </th><td>  ✓ </td><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">−</a> </td><td> <a href="">−</a> </td><td> <a href="">−</a> </td><td> <a href="">−</a> </td><td> <a href="">−</a> </td><td> <a href="">−</a> </td></tr><tr><th>  2 <sup>32</sup> −1  </th><td>  ✓ </td><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">−</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td></tr><tr><th>  2 <sup>16</sup> −1  </th><td>  ✓ </td><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">−</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td></tr></tbody><tbody><tr><th>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">overlap.zip</a> </th><td>  </td><td> − </td><td>  ✓ </td><td>  ✓ </td><td>  ✓ </td><td> − </td><td> − </td></tr><tr><th>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">zbsm.zip  zblg.zip</a> </th><td>  ✓ </td><td>  ✓ </td><td>  ✓ </td><td>  ✓ </td><td>  ✓ </td><td>  ✓ </td><td> − </td></tr><tr><th>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">zbxl.zip</a> </th><td>  ✓ </td><td>  ✓ </td><td>  ✓ </td><td>  ✓ </td><td> − </td><td> − </td><td> − </td></tr></tbody></table></div><br> <i><font color="gray">    zip-,    ,     zip-.      DEFLATE  Zip64,          ,    CRC     32-  16- .</font></i> <br><br><h1>  Remerciements </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Merci à </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mark Adler</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Russ Cox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Brandon Enright</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Marek Maykovsky</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Josh Wolfe</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et aux critiques de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USENIX WOOT 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour leurs commentaires sur le projet de cet article. </font><font style="vertical-align: inherit;">Kaolan McNamara a évalué l'impact des bombes zip sur la sécurité de LibreOffice. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une version de cet article a été préparée pour l'atelier </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USENIX WOOT 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le code source</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est disponible. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les artefacts</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à présenter lors de l'atelier se trouvent dans le fichier </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zipbomb-woot19.zip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avez-vous trouvé un système qui largue l'une des bombes? </font><font style="vertical-align: inherit;">Les bombes vous ont-elles aidé à trouver un bug ou à gagner de l'argent dans un programme de recherche de bug? </font><font style="vertical-align: inherit;">Faites le moi savoir, je vais essayer de le mentionner ici.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> LibreOffice 6.1.5.2 </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Après avoir renommé zblg.zip en zblg.odt ou zblg.docx, LibreOffice crée et supprime une série de fichiers temporaires d'environ 4 Go, essayant de déterminer le format de fichier. </font><font style="vertical-align: inherit;">En fin de compte, il termine cette opération et supprime les fichiers temporaires à mesure qu'ils arrivent, de sorte que la bombe zip ne provoque qu'un DoS temporaire sans remplir le disque. </font><font style="vertical-align: inherit;">Kaolan McNamara a répondu à mon message d'erreur.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mozilla addons-server 2019.06.06 </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai essayé des bombes zip contre l'installation du serveur d'addons local, qui fait partie du logiciel addons.mozilla.org. </font><font style="vertical-align: inherit;">Le système gère gracieusement la bombe, imposant un délai de 110 secondes sur l'extraction des fichiers. </font><font style="vertical-align: inherit;">La bombe zip se développe rapidement, dans la mesure où le disque le permet jusqu'à cette limite de temps, mais le processus est alors tué et les fichiers décompressés sont finalement automatiquement effacés.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UnZip 6.0 </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mark Adler a écrit un patch pour UnZip pour détecter cette classe de bombes zip. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 juillet 2019: j'ai remarqué que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE-2019-13232 a été attribué à UnZip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Personnellement, je dirais que la capacité / l'incapacité d'UnZip (ou de tout analyseur zip) de traiter ce type de bombe zip est nécessairement une vulnérabilité ou même un bug. Il s'agit d'une implémentation naturelle qui ne viole pas les spécifications, que puis-je dire. Le type de bombe dans cet article n'est qu'un type, et il existe de nombreuses autres façons de résoudre un analyseur zip. Comme mentionné ci-dessus, si vous souhaitez vous protéger contre les attaques d'épuisement des ressources, vous ne devez pas essayer de répertorier, détecter et bloquer chaque attaque connue; il est plutôt nécessaire d'établir des restrictions externes sur le temps et les autres ressources afin que l'analyseur n'entre pas dans une telle situation, quel que soit le type d'attaque qu'il a rencontré. Il n'y a rien de mal à essayer de détecter et de rejeter certains modèles comme une optimisation de la première passe,mais vous ne pouvez pas vous arrêter là. À moins que vous finissiez par isoler et restreindre les opérations avec des données non fiables, votre système est probablement toujours vulnérable. Considérez l'analogie avec les scripts intersites en HTML: la bonne protection n'est pas d'essayer de filtrer des octets spécifiques qui peuvent être interprétés comme du code, mais d'éviter tout correctement.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Moteurs antivirus </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'utilisateur de Twitter @TVqQAAMAAAAEAAA </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rapporte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : "L'antivirus McAfee sur ma machine de test vient d'exploser." </font><font style="vertical-align: inherit;">Je ne l'ai pas testé moi-même et je n'ai pas de détails tels que le numéro de version. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tavis Ormandi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indique</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirusTotal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a un certain nombre de délais </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">d'expiration pour zblg.zip</font></a><font style="vertical-align: inherit;"> ( </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">capture d'écran du 6 juin 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ): AhnLab-V3, ClamAV, DrWeb, Endgame, F-Secure, GData, K7AntiVirus, K7GW, MaxSecure, McAfee, McAfee-GW -Edition, Panda, Qihoo-360, Sophos ML, VBA32. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Résultats pour zbsm.zip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">capture d'écran du 6 juin 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) sont similaires, mais avec un ensemble différent de moteurs de temporisation: Baido, Bkav, ClamAV, CMC, DrWeb, Endgame, ESET-NOD32, F-Secure, GData, Kingsoft, McAfee-GW-Edition, NANO-Antivirus, Acronis. </font><font style="vertical-align: inherit;">Fait intéressant, </font><font style="vertical-align: inherit;">il n'y a pas de délais d'attente </font><font style="vertical-align: inherit;">dans les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">résultats de zbxl.zip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">capture d'écran du 6 juin 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Peut-être que certains antivirus ne prennent pas en charge Zip64? </font><font style="vertical-align: inherit;">Plusieurs moteurs détectent les fichiers comme une sorte de «bombe de compression». </font><font style="vertical-align: inherit;">Il est intéressant de voir s'ils continueront à le faire avec des modifications mineures, telles que la modification des noms de fichiers ou l'ajout d'un préfixe ASCII à chaque fichier.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Déclaration finale </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est temps de mettre fin à Facebook. </font><font style="vertical-align: inherit;">Ce n'est pas un travail neutre pour vous: chaque jour, quand vous venez au travail, vous faites quelque chose de mal. </font><font style="vertical-align: inherit;">Si vous avez un compte Facebook, supprimez-le. </font><font style="vertical-align: inherit;">Si vous travaillez sur Facebook, licenciez-vous. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et n'oubliez pas que l'Agence de sécurité nationale doit être détruite.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr459254/">https://habr.com/ru/post/fr459254/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr459244/index.html">Gestionnaire de produits Notes: comportement des utilisateurs sur les pages de jeu de l'App Store. Combien de temps faut-il pour télécharger un jeu</a></li>
<li><a href="../fr459246/index.html">Pourquoi la conversion de sites diminue-t-elle? Exemples de 60 erreurs de conception et d'utilisation</a></li>
<li><a href="../fr459248/index.html">Événements numériques à Moscou du 09 juillet au 14 juillet</a></li>
<li><a href="../fr459250/index.html">WAL dans PostgreSQL: 2. Journal de pré-enregistrement</a></li>
<li><a href="../fr459252/index.html">Semaine de la sécurité 28: pirater une maison intelligente</a></li>
<li><a href="../fr459256/index.html">Comment nous avons optimisé notre hôpital thématique pour différentes plateformes</a></li>
<li><a href="../fr459258/index.html">14 000 milles non accrochés</a></li>
<li><a href="../fr459262/index.html">Retraité à 22 ans</a></li>
<li><a href="../fr459264/index.html">Sortir des réseaux Tarantool. Synchronisation des nœuds lors du filtrage du trafic</a></li>
<li><a href="../fr459272/index.html">Écriture d'une API pour les composants React, partie 1: ne créez pas d'accessoires conflictuels</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>