<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õìÔ∏è üëë üßñ Simplifica√ß√£o da an√°lise de despejos de mem√≥ria do Windows ou Outro ajuste no menu de contexto üêÖ üöÄ üé•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Muitos usu√°rios de sistemas operacionais Windows, mais cedo ou mais tarde, s√£o confrontados com a necessidade de descobrir por que seu sistema operaci...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Simplifica√ß√£o da an√°lise de despejos de mem√≥ria do Windows ou Outro ajuste no menu de contexto</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/409397/"> Muitos usu√°rios de sistemas operacionais Windows, mais cedo ou mais tarde, s√£o confrontados com a necessidade de descobrir por que seu sistema operacional favorito "cai no BSOD". <br><br>  Muito j√° foi escrito sobre como procurar uma causa e como corrigi-la (dependendo da situa√ß√£o) na Internet, mas o que devo fazer se precisar descobrir a causa o mais r√°pido poss√≠vel e precisar faz√™-lo regularmente, como prestadores de servi√ßos ou clientes regulares em f√≥runs de computador? <br><br><img src="https://habrastorage.org/webt/wi/jn/hp/wijnhp9o-s4sdaveb37ylkhpvbi.png"><br><br>  Os ajustes not√≥rios do menu de contexto podem simplificar a tarefa, uma vez que s√£o feitos de maneira bastante simples. <a name="habracut"></a><br><br><div class="spoiler">  <b class="spoiler_title">Prepara√ß√£o</b> <div class="spoiler_text">  Primeiro, voc√™ precisa instalar o pacote com o depurador windbg.exe, a vers√£o do console do kd.exe e outros conte√∫dos necess√°rios. <br><br>  Estes s√£o os pacotes <b>X64 Debuggers And Tools-x64_en-us.msi</b> ou <b>X86 Debuggers And Tools-x86_en-us.msi</b> para escolher, dependendo da profundidade de bits do sistema operacional usado e / ou das prefer√™ncias pessoais. <br><br>  Voc√™ n√£o encontrar√° links individuais no site da microsoft, mas esses pacotes fazem parte do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Windows Driver Kit</a> , voc√™ pode baix√°-lo sem instal√°-lo selecionando o modo de instalador apropriado; os pacotes estar√£o na pasta <b>\ Windows Kits \ 10 \ WDK \ Installers</b> quando o download for conclu√≠do. <br><br>  Se algu√©m precisar, enviei-os separadamente para I. Disco: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Depuradores X64 e ferramentas-x64_en-us.msi</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Depuradores X86 e ferramentas-x86_en-us.msi</a> <br><br>  Decidi n√£o instalar o depurador, mas apenas descompacte o msi: <br><br><pre><code class="dos hljs">msiexec /a "D:\Desktop\X64 Debuggers And Tools-x64_en-us.msi" /qb targetdir="D:\Desktop\Temp"</code> </pre> <br>  Esta op√ß√£o "port√°til" √© mais do que suficiente.  Depois, para minha pr√≥pria conveni√™ncia, mudei o conte√∫do desejado de v√°rias subpastas para <b>C: \ Portable \ Debug</b> , para que <b>ocorra</b> : <br><br> <code>C:\Portable\Debug\windbg.exe <br> C:\Portable\Debug\kd.exe</code> <br> <br>  + tudo o resto.  Vamos desenvolver esse caminho no futuro (mais eu o adicionei ao% PATH% novamente, por conveni√™ncia). <br><br>  Nesse sentido, as medidas preparat√≥rias podem ser consideradas conclu√≠das e continuar a descrever o processo de cria√ß√£o de ajustes. </div></div><br>  Como minha tarefa pressup√µe que existem muitas e muitas vezes despejos, preciso acelerar o processo o m√°ximo poss√≠vel, tornando-o informativo o suficiente para uma an√°lise r√°pida. <br><br><h4>  Lidando com chaves e comandos do depurador </h4><br>  Como base para o futuro ajuste, vamos usar um arquivo em lote, no qual basta arrastar o dump desejado. <br><br>  Para uma melhor percep√ß√£o das informa√ß√µes, no meu entendimento, inverti as cores do console e ajustei o tamanho da janela do console. <br><br><pre> <code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off <span class="hljs-built_in"><span class="hljs-built_in">title</span></span> text %<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">mode</span></span> <span class="hljs-built_in"><span class="hljs-built_in">con</span></span>: cols=<span class="hljs-number"><span class="hljs-number">170</span></span> <span class="hljs-built_in"><span class="hljs-built_in">color</span></span> F0 <span class="hljs-built_in"><span class="hljs-built_in">title</span></span> "%<span class="hljs-number"><span class="hljs-number">1</span></span>" kd.exe -nosqm -sup -z "%<span class="hljs-number"><span class="hljs-number">1</span></span>" ^ -y srv*"C:\Symbols"*http://msdl.microsoft.com/download/symbols -i srv*"C:\Symbols"*http://msdl.microsoft.com/download/symbols -c ^ "!analyze -v; !cpuid; !sysinfo cpuinfo; !sysinfo cpuspeed; !sysinfo machineid; q"" <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b</code> </pre> <br>  Aqui voc√™ pode ver os par√¢metros transmitidos pelo kd.exe, como <b>-y</b> , <b>-i</b> e, de fato, <b>-z</b> , vistos por todos que conhecem o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">kdfe.cmd,</a> amplamente conhecidos em c√≠rculos estreitos. <br><br><pre> <code class="hljs pgsql">-i !ImagePath! specifies the <span class="hljs-keyword"><span class="hljs-keyword">location</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> the executables that <span class="hljs-keyword"><span class="hljs-keyword">generated</span></span> the fault (see _NT_EXECUTABLE_IMAGE_PATH) -y !SymbolsPath! specifies the symbol <span class="hljs-keyword"><span class="hljs-keyword">search</span></span> path (see _NT_SYMBOL_PATH) -z !CrashDmpFile! specifies the <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> a crash dump file <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">debug</span></span></code> </pre> <br>  Se considerarmos por analogia as instru√ß√µes comuns, h√° pequenas diferen√ßas: <b>-nosqm</b> e <b>-sup s√£o</b> passados ‚Äã‚Äãadicionalmente como argumentos. <br><br><pre> <code class="hljs powershell"><span class="hljs-literal"><span class="hljs-literal">-nosqm</span></span> disables SQM <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> collection/upload. <span class="hljs-literal"><span class="hljs-literal">-sup</span></span> enables full public symbol searches</code> </pre> <br>  Como equipes: <br><br><pre> <code class="hljs erlang-repl">!cpuid !sysinfo cpuinfo !sysinfo cpuspeed !sysinfo machineid</code> </pre> <br>  N√£o vou pint√°-los, porque muitas c√≥pias e colas ser√£o exibidas.  Os interessados ‚Äã‚Äãpoder√£o encontrar a ajuda detalhada do <b>debugger.chm</b> em um dos dois * .msi mencionados acima ou em docs.microsoft.com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">-cpuid</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">-sysinfo</a> .  Em resumo, informa√ß√µes b√°sicas sobre a gl√¢ndula da v√≠tima. <br><br>  A sa√≠da do script usando o kd.exe ser√° quase a mesma que seria obtida ao trabalhar diretamente atrav√©s do windbg, mas o resultado √© alcan√ßado muito mais rapidamente, pois voc√™ n√£o precisa abrir nada, configurar pastas, abrir o dump no menu e inserir comandos no depurador. <br><br><h4>  Filtrando a Sa√≠da de Lixo do Console </h4><br>  Para o primeiro exemplo, vamos fazer um despejo de mem√≥ria de um usu√°rio aleat√≥rio.  H√° um pequeno problema com o lixo na sa√≠da: <br><br><div class="spoiler">  <b class="spoiler_title">Captura de tela de uma parte da sa√≠da do console</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ps/w-/kl/psw-klw_94reyoephkfeilg4k-m.png"></div></div><br>  Isso √© encontrado, por exemplo, em despejos de usu√°rios usando o ativador odin, que vemos neste exemplo. <br><br>  A sa√≠da completa √© bastante massiva, por causa do link para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pastebin</a> . <br><br>  √â necess√°rio "filtrar" linhas desnecess√°rias, deixando apenas informa√ß√µes √∫teis. <br>  Eu usei o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">findstr</a> , resultou em uma solu√ß√£o t√£o feia, mas funcional: <br><br><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">findstr</span></span> /r /v /c:"^\*\*\* .* \*\*\*" /c:"^\*\*\*\*\*\*\*\*\*\*\*\*\*\*.*"</code> </pre> <br>  Aqui, o findstr usa dois regulares: um procura por linhas come√ßando com tr√™s asteriscos, um espa√ßo e terminando com um espa√ßo e tr√™s asteriscos.  O segundo procura por linhas come√ßando com 14 estrelas.  Eu n√£o poderia fazer nada mais intelig√≠vel com o findstr. <br><br>  (Eu n√£o recomendo o uso de caracteres de termina√ß√£o de linha nas rotinas findst no escape kd.exe, pode haver problemas com o tipo de final de linha exibido pelo kd.exe. Em vez de <font color="#cc0000">\ r \ n,</font> voc√™ pode obter <font color="#cc0000">\ n</font> que o findstr n√£o considera o fim da linha. <br><br>  O c√≥digo inteiro do arquivo de lote preliminar com o "filtro" acabou sendo: <br><br><pre> <code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off <span class="hljs-built_in"><span class="hljs-built_in">title</span></span> text %<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">mode</span></span> <span class="hljs-built_in"><span class="hljs-built_in">con</span></span>: cols=<span class="hljs-number"><span class="hljs-number">170</span></span> <span class="hljs-built_in"><span class="hljs-built_in">color</span></span> F0 <span class="hljs-built_in"><span class="hljs-built_in">title</span></span> "%<span class="hljs-number"><span class="hljs-number">1</span></span>" kd.exe -nosqm -sup -z "%<span class="hljs-number"><span class="hljs-number">1</span></span>" ^ -y srv*"C:\Symbols"*http://msdl.microsoft.com/download/symbols -i srv*"C:\Symbols"*http://msdl.microsoft.com/download/symbols ^ -c "!analyze -v; !cpuid; !sysinfo cpuinfo; !sysinfo cpuspeed; !sysinfo machineid; q" | <span class="hljs-built_in"><span class="hljs-built_in">findstr</span></span> /r /v /c:"^\*\*\* .* \*\*\*" /c:"^\*\*\*\*\*\*\*\*\*\*\*\*\*\*.*" <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b</code> </pre> <br>  A sa√≠da completa da vers√£o filtrada tamb√©m est√° no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pastebin</a> . <br><br>  O resultado √© semelhante, mas sem "lixo".  290 linhas de texto versus 894.  J√° √© melhor, mas n√£o todos. <br><br><h4>  Cria√ß√£o r√°pida de log do depurador </h4><br>  O pr√≥ximo passo √© adicionar um log, que pode ser postado ou enviado em algum lugar. <br><br>  Para isso, passe ao kd.exe o argumento -loga &lt;"P: \ to the \ log.log"&gt; <br>  O c√≥digo tem o seguinte formato: <br><br><pre> <code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off <span class="hljs-built_in"><span class="hljs-built_in">title</span></span> text %<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">mode</span></span> <span class="hljs-built_in"><span class="hljs-built_in">con</span></span>: cols=<span class="hljs-number"><span class="hljs-number">170</span></span> <span class="hljs-built_in"><span class="hljs-built_in">color</span></span> F0 <span class="hljs-built_in"><span class="hljs-built_in">title</span></span> "%<span class="hljs-number"><span class="hljs-number">1</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "D=%<span class="hljs-number"><span class="hljs-number">1</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> L=<span class="hljs-variable"><span class="hljs-variable">%D:.dmp=.LOG%</span></span> kd.exe -nosqm -sup -loga "<span class="hljs-variable"><span class="hljs-variable">%L%</span></span>" -z "<span class="hljs-variable"><span class="hljs-variable">%D%</span></span>" ^ -y srv*"C:\Symbols"*http://msdl.microsoft.com/download/symbols -i srv*"C:\Symbols"*http://msdl.microsoft.com/download/symbols ^ -c "!analyze -v; !cpuid; !sysinfo cpuinfo; !sysinfo cpuspeed; !sysinfo machineid; q" | <span class="hljs-built_in"><span class="hljs-built_in">findstr</span></span> /r /v /c:"^\*\*\* .* \*\*\*" /c:"^\*\*\*\*\*\*\*\*\*\*\*\*\*\*.*" <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b</code> </pre> <br>  Um log <b>102516-21949-01.LOG</b> ser√° gerado para o arquivo <b>102516-21949-01.dmp</b> na mesma pasta que o pr√≥prio dump. <br><br>  Nesse caso, a sa√≠da de "lixo" para o log n√£o √© filtrada, apenas a sa√≠da para o console √© filtrada, mas no meu caso isso n√£o √© importante, embora voc√™ possa corrigi-lo limpando o log ap√≥s a cria√ß√£o: <br><br><pre> <code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off <span class="hljs-built_in"><span class="hljs-built_in">title</span></span> text %<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">mode</span></span> <span class="hljs-built_in"><span class="hljs-built_in">con</span></span>: cols=<span class="hljs-number"><span class="hljs-number">170</span></span> <span class="hljs-built_in"><span class="hljs-built_in">color</span></span> F0 <span class="hljs-built_in"><span class="hljs-built_in">title</span></span> "%<span class="hljs-number"><span class="hljs-number">1</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "D=%<span class="hljs-number"><span class="hljs-number">1</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> L=<span class="hljs-variable"><span class="hljs-variable">%D:.dmp=.LOG%</span></span> kd.exe -nosqm -sup -loga "<span class="hljs-variable"><span class="hljs-variable">%L%</span></span>" -z "<span class="hljs-variable"><span class="hljs-variable">%D%</span></span>" ^ -y srv*"C:\Symbols"*http://msdl.microsoft.com/download/symbols -i srv*"C:\Symbols"*http://msdl.microsoft.com/download/symbols ^ -c "!analyze -v; !cpuid; !sysinfo cpuinfo; !sysinfo cpuspeed; !sysinfo machineid; q" | <span class="hljs-built_in"><span class="hljs-built_in">findstr</span></span> /r /v /c:"^\*\*\* .* \*\*\*" /c:"^\*\*\*\*\*\*\*\*\*\*\*\*\*\*.*" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> CL=<span class="hljs-variable"><span class="hljs-variable">%L:.LOG=_CLEAN.LOG%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> "<span class="hljs-variable"><span class="hljs-variable">%L%</span></span>" | <span class="hljs-built_in"><span class="hljs-built_in">findstr</span></span> /r /v /c:"^\*\*\* .* \*\*\*" /c:"^\*\*\*\*\*\*\*\*\*\*\*\*\*\*.*" &gt;&gt; "<span class="hljs-variable"><span class="hljs-variable">%CL%</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">del</span></span> /f /q "<span class="hljs-variable"><span class="hljs-variable">%L%</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b</code> </pre> <br><h3>  Abrindo um despejo no windbg </h3><br>  Agora, o √∫ltimo passo em ordem, mas n√£o em import√¢ncia: voc√™ precisa transferir o dump diretamente para windbg.exe e passar imediatamente comandos para ele que voc√™ provavelmente precisar√° inserir.  Tudo √© feito por analogia com o kd.exe, os argumentos e comandos recebidos pelo windbg.exe s√£o quase id√™nticos ao kd.exe <br><br><pre> <code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off windbg.exe -z "%<span class="hljs-number"><span class="hljs-number">1</span></span>" -sup -y ^ "srv*C:\Symbols*http://msdl.microsoft.com/download/symbols" -i "srv*C:\Symbols*http://msdl.microsoft.com/download/symbols" -c "!analyze -v; !cpuid; !sysinfo cpuinfo; !sysinfo cpuspeed; !sysinfo machineid" <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b</code> </pre> <br>  Como resultado, o dump ser√° aberto imediatamente no depurador e os comandos listados na chave <b>-c</b> ser√£o executados automaticamente nele. <br><br>  A conclus√£o √© semelhante √† primeira op√ß√£o, com a diferen√ßa de que o dump √© aberto imediatamente no windbg; √© poss√≠vel inserir comandos para an√°lises posteriores devido √† aus√™ncia do comando <b>q</b> na lista de comandos transmitidos. <br><br>  (A prop√≥sito, se nas vers√µes anteriores do script com kd.exe voc√™ remover o comando <b>q</b> que √© passado na lista de comandos pelo argumento <b>-c</b> , a capacidade de continuar trabalhando com o dump aparecer√° l√°, incluindo a grava√ß√£o do log diretamente no processo.) <br><br><h3>  Tweak Creation </h3><br>  Agora tudo isso precisa ser modificado para que voc√™ possa vincular arquivos * .dmp ao menu de contexto.  Na verdade, pelo que estava fazendo. <br><br>  Aqui est√£o os seguintes "one-liners": <br><br>  <b>Para a op√ß√£o com filtragem de sa√≠da do console</b> <br><br><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> /d /k <span class="hljs-built_in"><span class="hljs-built_in">mode</span></span> <span class="hljs-built_in"><span class="hljs-built_in">con</span></span>: cols=<span class="hljs-number"><span class="hljs-number">170</span></span> &amp; <span class="hljs-built_in"><span class="hljs-built_in">color</span></span> F0 &amp; <span class="hljs-built_in"><span class="hljs-built_in">title</span></span> "%<span class="hljs-number"><span class="hljs-number">1</span></span>" &amp; kd.exe -nosqm -sup -z "%<span class="hljs-number"><span class="hljs-number">1</span></span>" -y srv*"C:\Symbols"*http://msdl.microsoft.com/download/symbols -i srv*"C:\Symbols"*http://msdl.microsoft.com/download/symbols -c "!analyze -v; !cpuid; !sysinfo cpuinfo; !sysinfo cpuspeed; !sysinfo machineid; q" | <span class="hljs-built_in"><span class="hljs-built_in">findstr</span></span> /r /v /c:"^\*\*\* .* \*\*\*" /c:"^\*\*\*\*\*\*\*\*\*\*\*\*\*\*.*"</code> </pre> <br>  <b>Para a op√ß√£o de filtrar a sa√≠da do console e criar um arquivo de log</b> <br>  (teve que usar uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">extens√£o vari√°vel adiada</a> ) <br><br><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> /d /v /k <span class="hljs-built_in"><span class="hljs-built_in">mode</span></span> <span class="hljs-built_in"><span class="hljs-built_in">con</span></span>: cols=<span class="hljs-number"><span class="hljs-number">170</span></span> &amp; <span class="hljs-built_in"><span class="hljs-built_in">color</span></span> F0 &amp; <span class="hljs-built_in"><span class="hljs-built_in">title</span></span> "%<span class="hljs-number"><span class="hljs-number">1</span></span>" &amp; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "D=%<span class="hljs-number"><span class="hljs-number">1</span></span>"&amp; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> L=<span class="hljs-variable"><span class="hljs-variable">!D:.dmp=.LOG!</span></span> &amp; kd.exe -nosqm -sup -loga "<span class="hljs-variable"><span class="hljs-variable">!L!</span></span>" -z "<span class="hljs-variable"><span class="hljs-variable">!D!</span></span>" -y srv*"C:\Symbols"*http://msdl.microsoft.com/download/symbols -i srv*"C:\Symbols"*http://msdl.microsoft.com/download/symbols -c "!analyze -v; !cpuid; !sysinfo cpuinfo; !sysinfo cpuspeed; !sysinfo machineid; q" | <span class="hljs-built_in"><span class="hljs-built_in">findstr</span></span> /r /v /c:"^\*\*\* .* \*\*\*" /c:"^\*\*\*\*\*\*\*\*\*\*\*\*\*\*.*"</code> </pre> <br>  <b>Para abrir um despejo diretamente no windbg.exe</b> <br><br><pre> <code class="dos hljs">"C:\Portable\Debug\windbg.exe" -z "%<span class="hljs-number"><span class="hljs-number">1</span></span>" -sup -y "srv*C:\Symbols*http://msdl.microsoft.com/download/symbols" -i "srv*C:\Symbols*http://msdl.microsoft.com/download/symbols" -c "!analyze -v; !cpuid; !sysinfo cpuinfo; !sysinfo cpuspeed; !sysinfo machineid"</code> </pre> <br>  No registro, criei a seguinte estrutura de parti√ß√£o: <br><br><img src="https://habrastorage.org/webt/ln/8e/n8/ln8en8yk3dh6h3-6fp2zdmit1qg.png"><br><br>  Um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tipo separado de arquivo</a> <b>dmp_geek</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">foi</a> <b>criado</b> nas chaves do registro cujas altera√ß√µes foram feitas.  Arquivos com a extens√£o * .dmp receberam arquivos do tipo <b>dmp_geek</b> . <br><br>  Em cada se√ß√£o de comando, a linha √∫nica + beleza correspondente na forma de √≠cones e nomes convenientes para os nomes de itens exibidos no menu de contexto foram adicionados ao par√¢metro de string por padr√£o. <br><br><img src="https://habrastorage.org/webt/et/2p/zd/et2pzduo7gx7fl0dtpsrdsppylm.png"><br><br>  O resultado foi um ajuste que adiciona a capacidade de abrir massivamente os dumps selecionados na pasta no console e no depurador, com filtragem de ‚Äúlixo‚Äù e cria√ß√£o de logs para cada dump, conforme necess√°rio.  Isso economiza muito tempo. <br><br>  Depois de vasculhar o registro, exportou tudo para o arquivo REG final, pronto para uso. <br><br><div class="spoiler">  <b class="spoiler_title">O conte√∫do do arquivo REG</b> <div class="spoiler_text"><pre> <code class="hljs powershell">Windows Registry Editor Version <span class="hljs-number"><span class="hljs-number">5.00</span></span> [<span class="hljs-type"><span class="hljs-type">HKEY_CLASSES_ROOT</span></span>\<span class="hljs-type"><span class="hljs-type">.dmp</span></span>] <span class="hljs-selector-tag"><span class="hljs-selector-tag">@</span></span>=<span class="hljs-string"><span class="hljs-string">"dmp_geek"</span></span> [<span class="hljs-type"><span class="hljs-type">HKEY_CLASSES_ROOT</span></span>\<span class="hljs-type"><span class="hljs-type">dmp_geek</span></span>] <span class="hljs-selector-tag"><span class="hljs-selector-tag">@</span></span>=<span class="hljs-string"><span class="hljs-string">"dmp_geek"</span></span> <span class="hljs-string"><span class="hljs-string">"FriendlyTypeName"</span></span>=<span class="hljs-string"><span class="hljs-string">" "</span></span> [<span class="hljs-type"><span class="hljs-type">HKEY_CLASSES_ROOT</span></span>\<span class="hljs-type"><span class="hljs-type">dmp_geek</span></span>\<span class="hljs-type"><span class="hljs-type">DefaultIcon</span></span>] <span class="hljs-selector-tag"><span class="hljs-selector-tag">@</span></span>=<span class="hljs-string"><span class="hljs-string">"imageres.dll,142"</span></span> [<span class="hljs-type"><span class="hljs-type">HKEY_CLASSES_ROOT</span></span>\<span class="hljs-type"><span class="hljs-type">dmp_geek</span></span>\<span class="hljs-type"><span class="hljs-type">shell</span></span>] [<span class="hljs-type"><span class="hljs-type">HKEY_CLASSES_ROOT</span></span>\<span class="hljs-type"><span class="hljs-type">dmp_geek</span></span>\<span class="hljs-type"><span class="hljs-type">shell</span></span>\<span class="hljs-type"><span class="hljs-type">kd.exe</span></span>] <span class="hljs-string"><span class="hljs-string">"MUIVerb"</span></span>=<span class="hljs-string"><span class="hljs-string">"Kd.exe"</span></span> <span class="hljs-string"><span class="hljs-string">"Icon"</span></span>=<span class="hljs-string"><span class="hljs-string">"C:\\Portable\\Debug\\windbg.exe,6"</span></span> [<span class="hljs-type"><span class="hljs-type">HKEY_CLASSES_ROOT</span></span>\<span class="hljs-type"><span class="hljs-type">dmp_geek</span></span>\<span class="hljs-type"><span class="hljs-type">shell</span></span>\<span class="hljs-type"><span class="hljs-type">kd.exe</span></span>\<span class="hljs-type"><span class="hljs-type">command</span></span>] <span class="hljs-selector-tag"><span class="hljs-selector-tag">@</span></span>=<span class="hljs-string"><span class="hljs-string">"cmd /d /k mode con: cols=170 &amp; color F0 &amp; title \"</span></span>%<span class="hljs-number"><span class="hljs-number">1</span></span>\<span class="hljs-string"><span class="hljs-string">" &amp; \"</span></span>C:\\Portable\\Debug\\kd.exe\<span class="hljs-string"><span class="hljs-string">" -nosqm -sup -z \"</span></span>%<span class="hljs-number"><span class="hljs-number">1</span></span>\<span class="hljs-string"><span class="hljs-string">" -y srv*\"</span></span>C:\\Symbols\<span class="hljs-string"><span class="hljs-string">"*http://msdl.microsoft.com/download/symbols -i srv*\"</span></span>C:\\Symbols\<span class="hljs-string"><span class="hljs-string">"*http://msdl.microsoft.com/download/symbols -c \"</span></span>!analyze <span class="hljs-literal"><span class="hljs-literal">-v</span></span>; !cpuid; !sysinfo cpuinfo; !sysinfo cpuspeed; !sysinfo machineid; q\<span class="hljs-string"><span class="hljs-string">" | findstr /r /v /c:\"</span></span>^\\*\\*\\* .* \\*\\*\\*\<span class="hljs-string"><span class="hljs-string">" /c:\"</span></span>^\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*.*\<span class="hljs-string"><span class="hljs-string">""</span></span> [<span class="hljs-type"><span class="hljs-type">HKEY_CLASSES_ROOT</span></span>\<span class="hljs-type"><span class="hljs-type">dmp_geek</span></span>\<span class="hljs-type"><span class="hljs-type">shell</span></span>\<span class="hljs-type"><span class="hljs-type">kd.exe_</span></span>-<span class="hljs-type"><span class="hljs-type">loga</span></span>] <span class="hljs-string"><span class="hljs-string">"MUIVerb"</span></span>=<span class="hljs-string"><span class="hljs-string">"Kd.exe -loga"</span></span> <span class="hljs-string"><span class="hljs-string">"Icon"</span></span>=<span class="hljs-string"><span class="hljs-string">"C:\\Portable\\Debug\\windbg.exe,6"</span></span> [<span class="hljs-type"><span class="hljs-type">HKEY_CLASSES_ROOT</span></span>\<span class="hljs-type"><span class="hljs-type">dmp_geek</span></span>\<span class="hljs-type"><span class="hljs-type">shell</span></span>\<span class="hljs-type"><span class="hljs-type">kd.exe_</span></span>-<span class="hljs-type"><span class="hljs-type">loga</span></span>\<span class="hljs-type"><span class="hljs-type">command</span></span>] <span class="hljs-selector-tag"><span class="hljs-selector-tag">@</span></span>=<span class="hljs-string"><span class="hljs-string">"cmd /d /v /k mode con: cols=170 &amp; color F0 &amp; title \"</span></span>%<span class="hljs-number"><span class="hljs-number">1</span></span>\<span class="hljs-string"><span class="hljs-string">" &amp; set \"</span></span>D=%<span class="hljs-number"><span class="hljs-number">1</span></span>\<span class="hljs-string"><span class="hljs-string">"&amp; set L=!D:.dmp=.LOG! &amp; \"</span></span>C:\\Portable\\Debug\\kd.exe\<span class="hljs-string"><span class="hljs-string">" -nosqm -sup -loga \"</span></span>!L!\<span class="hljs-string"><span class="hljs-string">" -z \"</span></span>!D!\<span class="hljs-string"><span class="hljs-string">" -y srv*\"</span></span>C:\\Symbols\<span class="hljs-string"><span class="hljs-string">"*http://msdl.microsoft.com/download/symbols -i srv*\"</span></span>C:\\Symbols\<span class="hljs-string"><span class="hljs-string">"*http://msdl.microsoft.com/download/symbols -c \"</span></span>!analyze <span class="hljs-literal"><span class="hljs-literal">-v</span></span>; !cpuid; !sysinfo cpuinfo; !sysinfo cpuspeed; !sysinfo machineid; q\<span class="hljs-string"><span class="hljs-string">" | findstr /r /v /c:\"</span></span>^\\*\\*\\* .* \\*\\*\\*\<span class="hljs-string"><span class="hljs-string">" /c:\"</span></span>^\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*.*\<span class="hljs-string"><span class="hljs-string">""</span></span> [<span class="hljs-type"><span class="hljs-type">HKEY_CLASSES_ROOT</span></span>\<span class="hljs-type"><span class="hljs-type">dmp_geek</span></span>\<span class="hljs-type"><span class="hljs-type">shell</span></span>\<span class="hljs-type"><span class="hljs-type">Open</span></span>] <span class="hljs-string"><span class="hljs-string">"MUIVerb"</span></span>=<span class="hljs-string"><span class="hljs-string">"Windbg"</span></span> <span class="hljs-string"><span class="hljs-string">"Icon"</span></span>=<span class="hljs-string"><span class="hljs-string">"C:\\Portable\\Debug\\windbg.exe,6"</span></span> [<span class="hljs-type"><span class="hljs-type">HKEY_CLASSES_ROOT</span></span>\<span class="hljs-type"><span class="hljs-type">dmp_geek</span></span>\<span class="hljs-type"><span class="hljs-type">shell</span></span>\<span class="hljs-type"><span class="hljs-type">Open</span></span>\<span class="hljs-type"><span class="hljs-type">command</span></span>] <span class="hljs-selector-tag"><span class="hljs-selector-tag">@</span></span>=<span class="hljs-string"><span class="hljs-string">"\"</span></span>C:\\Portable\\Debug\\windbg.exe\<span class="hljs-string"><span class="hljs-string">" -z \"</span></span>%<span class="hljs-number"><span class="hljs-number">1</span></span>\<span class="hljs-string"><span class="hljs-string">" -sup -y \"</span></span>srv*C:\\Symbols*http://msdl.microsoft.com/download/symbols\<span class="hljs-string"><span class="hljs-string">" -i \"</span></span>srv*C:\\Symbols*http://msdl.microsoft.com/download/symbols\<span class="hljs-string"><span class="hljs-string">" -c \"</span></span>!analyze <span class="hljs-literal"><span class="hljs-literal">-v</span></span>; !cpuid; !sysinfo cpuinfo; !sysinfo cpuspeed; !sysinfo machineid\<span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre></div></div><br>  ‚Üí Fa√ßa o download do Ya.Disk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GEEK_DMP.reg</a> <br><br>  Isso √© tudo.  Agora voc√™ pode rapidamente, embora superficialmente, analisar imediatamente um monte de lix√µes. <br><br><div class="spoiler">  <b class="spoiler_title">Materiais usados, fontes, links √∫teis sobre o t√≥pico:</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ferramentas de depura√ß√£o para Windows</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Oficina de inform√°tica</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Registro do Windows</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Administra√ß√£o do Windows - F√≥rum de programadores e administradores de sistema</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Folha de dicas do WinDbg para an√°lise de despejo de mem√≥ria</a> <br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt409397/">https://habr.com/ru/post/pt409397/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt409385/index.html">Qual √© a for√ßa da IoT, irm√£o? Na blockchain</a></li>
<li><a href="../pt409387/index.html">Na Alemanha, os pre√ßos da eletricidade ca√≠ram mais de 100 vezes ao ano, para valores negativos</a></li>
<li><a href="../pt409389/index.html">Como rastrear sua sa√∫de? Aplicativos mHealth √∫teis em um smartphone</a></li>
<li><a href="../pt409393/index.html">Lamptest: Milagre de Natal, atualiza√ß√£o, grandes planos</a></li>
<li><a href="../pt409395/index.html">Abordagem algor√≠tmica para o tratamento da ins√¥nia</a></li>
<li><a href="../pt409399/index.html">A verdade sobre o foguete lunar Saturn-5 (cr√≠tica √† especula√ß√£o do doutor em f√≠sica e matem√°tica Popov)</a></li>
<li><a href="../pt409401/index.html">Design usando simula√ß√£o: como funciona?</a></li>
<li><a href="../pt409403/index.html">Vis√£o geral da Exposi√ß√£o de tecnologia aditiva Formnext 2017</a></li>
<li><a href="../pt409405/index.html">A Confer√™ncia de 1970 Prevendo o Futuro do Trabalho</a></li>
<li><a href="../pt409407/index.html">Os telhados solares da Tesla come√ßaram a ser instalados nos clientes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>