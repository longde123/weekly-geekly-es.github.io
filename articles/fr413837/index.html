<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§üüèæ üëãüèº üôáüèæ Faire de Tower Defense un jeu d'unit√© - Partie 1 üë®üèø‚Äçüîß üêé üë©‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les jeux de tower defense gagnent en popularit√©, et cela n'est pas surprenant - peu de choses peuvent √™tre compar√©es au plaisir d'observer vos propres...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Faire de Tower Defense un jeu d'unit√© - Partie 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413837/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6c5/894/e67/6c5894e675d3be7fedc6bf87038b2188.png" alt="image"></div><br>  Les jeux de tower defense gagnent en popularit√©, et cela n'est pas surprenant - peu de choses peuvent √™tre compar√©es au plaisir d'observer vos propres lignes de d√©fense qui d√©truisent les ennemis mal√©fiques!  Dans ce tutoriel en deux parties, nous allons cr√©er un jeu de tower defense sur le moteur <em>Unity</em> ! <br><br>  Vous apprendrez comment proc√©der comme suit: <br><br><ul><li>  Cr√©ez des vagues d'ennemis </li><li>  Faites-leur suivre les points de l'itin√©raire </li><li>  Construisez et am√©liorez des tours et apprenez-leur √©galement √† briser les ennemis en petits pixels </li></ul><br>  En fin de compte, nous obtenons le cadre du jeu, qui peut √™tre d√©velopp√© davantage! <br><a name="habracut"></a><br><blockquote>  <em>Remarque</em> : vous avez besoin des connaissances de base d'Unity (par exemple, vous devez savoir comment les actifs et les composants sont ajout√©s, quels pr√©fabriqu√©s sont) et les bases de <em>C #</em> .  Pour tout savoir, je vous recommande de parcourir les tutoriels sur Unity de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sean Duffy</a> ou la s√©rie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Beginning C # with Unity</a> de Brian Mockley. </blockquote><br>  Je travaillerai dans Unity pour OS X, mais ce tutoriel convient √©galement pour Windows. <br><br><h2>  √Ä travers les fen√™tres de la tour d'ivoire </h2><br>  Dans ce tutoriel, nous allons cr√©er un jeu de tower defense dans lequel les ennemis (petits bugs) rampent vers un cookie vous appartenant et vos serviteurs (bien s√ªr, ce sont des monstres!).  Le joueur peut placer des monstres √† des points strat√©giques et les am√©liorer en or. <br><br>  Le joueur doit tuer tous les bugs jusqu'√† ce qu'ils arrivent au cookie.  Chaque nouvelle vague d'ennemis devient de plus en plus difficile √† vaincre.  Le jeu se termine lorsque vous survivez √† toutes les vagues (victoire!) Ou lorsque cinq ennemis rampent vers les cookies (perte!). <br><br>  Voici une capture d'√©cran du jeu termin√©: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/782/a94/fef/782a94fefd675365aba52fbfc4008ab6.png"></div><br>  <i>Monstres, unissez-vous!</i>  <i>Prot√©gez le cookie!</i> <br><br><h2>  Se rendre au travail </h2><br>  T√©l√©chargez ce <a href="">projet vierge</a> , d√©compressez-le et ouvrez le projet <em>TowerDefense-Part1-Starter</em> dans Unity. <br><br>  Le projet de projet a des atouts graphiques et sonores, des animations toutes faites et plusieurs scripts utiles.  Les scripts ne sont pas directement li√©s aux jeux de tower defense, donc je n'en parlerai pas ici.  Cependant, si vous souhaitez en savoir plus sur la cr√©ation d'animations 2D dans Unity, consultez ce <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="Tutoriel Unity 2D">didacticiel Unity 2D</a> . <br><br>  Le projet contient √©galement des pr√©fabriqu√©s, que nous ajouterons plus tard pour cr√©er des personnages.  Enfin, il y a une sc√®ne dans le projet avec un arri√®re-plan et une interface utilisateur personnalis√©e. <br><br>  Ouvrez le <em>GameScene</em> situ√© dans le dossier <em>Scenes</em> et r√©glez le mode Game sur un rapport d'aspect de <em>4: 3</em> afin que toutes les √©tiquettes correspondent correctement √† l'arri√®re-plan.  En mode Jeu, vous verrez ce qui suit: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fb7/050/bda/fb7050bda1d91c148f65e70a7c217083.png"></div><br>  <em>Paternit√©:</em> <br><br><ul><li>  Les graphismes du projet sont tir√©s du pack Wiki Wenderlich gratuit!  D'autres ≈ìuvres graphiques peuvent √™tre trouv√©es sur son site Web <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="gameartguppy">gameartguppy</a> . </li><li>  Super musique tir√©e de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="Benound">BenSound</a> , qui a d'autres bandes sonores impressionnantes! </li><li>  Je remercie √©galement Michael Jesper pour la fonction tr√®s utile de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="tremblement de l'appareil photo">boug√© de l'appareil photo.</a> </li></ul>  . <br><h2>  L'endroit est marqu√© d'une croix: l'emplacement des monstres </h2><br>  Les monstres ne peuvent √™tre plac√©s que sur des points marqu√©s d'un <em>x</em> . <br><br>  Pour les ajouter √† la sc√®ne, faites glisser <em>Images \ Objects \ Openspot</em> de <em>Project Browser</em> vers la fen√™tre <em>Scene</em> .  Alors que la position n'est pas importante pour nous. <br><br>  Une fois que vous avez s√©lectionn√© <em>Openspot</em> dans la hi√©rarchie, cliquez sur <em>Ajouter un composant</em> dans l' <em><em>inspecteur</em></em> et s√©lectionnez <em>Box Collider 2D</em> .  Dans la fen√™tre Sc√®ne, Unity affichera un collisionneur rectangulaire avec une ligne verte.  Nous utiliserons ce collisionneur pour reconna√Ætre les clics de souris √† cet endroit. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/271/6a9/3da/2716a93da69de6b5cf73a7edfc794210.png"></div><br>  Ajoutez le composant <em>Audio \ Source audio</em> √† <em>Openspot de la</em> m√™me mani√®re.  Pour le param√®tre <em>AudioClip</em> du composant Audio Source, s√©lectionnez le fichier <em>tower_place</em> situ√© dans le dossier <em>Audio</em> et d√©sactivez <em>Play On Awake</em> . <br><br>  Nous devons cr√©er 11 points suppl√©mentaires.  Bien qu'il y ait une tentation de r√©p√©ter toutes ces √©tapes, Unity a une meilleure solution: <em>Prefab</em> ! <br><br>  Faites glisser <em>Openspot</em> de la <em>hi√©rarchie</em> vers le dossier <em>Prefabs</em> dans l' <em>arborescence</em> du <em>projet</em> .  Son nom deviendra bleu dans la Hi√©rarchie, ce qui signifie qu'il est attach√© au pr√©fabriqu√©.  Quelque chose comme √ßa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad3/cb2/6a0/ad3cb26a0d51c893dd040e8f4f5dfea6.gif"></div><br>  Maintenant que nous avons le blanc pr√©fabriqu√©, nous pouvons cr√©er autant de copies que nous voulons.  <em>Faites</em> simplement glisser et d√©posez <em>Openspot</em> depuis le dossier <em>Prefabs</em> dans le <em>Navigateur du projet</em> dans la fen√™tre <em>Sc√®ne</em> .  R√©p√©tez cette op√©ration 11 fois et 12 objets Openspot appara√Ætront dans la sc√®ne. <br><br>  Utilisez maintenant l' <em>inspecteur</em> pour d√©finir ces 12 objets Openspot avec les coordonn√©es suivantes: <br><br><ul><li>  (X: -5,2, Y: 3,5, Z: 0) </li><li>  (X: -2,2, Y: 3,5, Z: 0) </li><li>  (X: 0,8, Y: 3,5, Z: 0) </li><li>  (X: 3,8, Y: 3,5, Z: 0) </li><li>  (X: -3,8, Y: 0,4, Z: 0) </li><li>  (X: -0,8, Y: 0,4, Z: 0) </li><li>  (X: 2,2, Y: 0,4, Z: 0) </li><li>  (X: 5,2, Y: 0,4, Z: 0) </li><li>  (X: -5,2, Y: -3,0, Z: 0) </li><li>  (X: -2,2, Y: -3,0, Z: 0) </li><li>  (X: 0,8, Y: -3,0, Z: 0) </li><li>  (X: 3,8, Y: -3,0, Z: 0) </li></ul><br>  Lorsque vous faites cela, la sc√®ne ressemblera √† ceci: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/69e/248/fb2/69e248fb213cfee35ce43f5f9c14baeb.png"></div><br><h2>  Nous pla√ßons des monstres </h2><br>  Pour simplifier le placement, il existe un pr√©fabriqu√© <em>Monster</em> dans le dossier <em>Prefab</em> du projet. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c65/908/80a/c6590880acbdbac94bd15ec023311235.png"></div><br>  <i>Monster Prefab pr√™t √† l'emploi</i> <br><br>  √Ä l'heure actuelle, il se compose d'un objet de jeu vide avec trois sprites diff√©rents et des animations de tir en tant qu'enfants. <br><br>  Chaque sprite est un monstre avec diff√©rents niveaux de puissance.  Le pr√©fabriqu√© contient √©galement le composant <em>Source audio</em> , qui sera lanc√© pour jouer du son lorsqu'un monstre tire un laser. <br><br>  Nous allons maintenant cr√©er un script qui <em>h√©bergera</em> <em>Monster</em> sur <em>Openspot</em> . <br><br>  Dans l' <em>arborescence du projet,</em> s√©lectionnez l'objet <em>Openspot</em> dans le dossier <em>Prefabs</em> .  Dans l' <em>inspecteur,</em> cliquez sur <em>Ajouter un composant</em> , puis s√©lectionnez <em>Nouveau script</em> et nommez le script <em>PlaceMonster</em> .  S√©lectionnez <em>C Sharp</em> comme langue et cliquez sur <em>Cr√©er et ajouter</em> .  Depuis que nous avons ajout√© le script au pr√©fabriqu√© <i>Openspot</i> , tous les objets Openspot de la sc√®ne auront d√©sormais ce script.  Super! <br><br>  Double-cliquez sur le script pour l'ouvrir dans l'EDI.  Ajoutez ensuite deux variables: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GameObject monsterPrefab; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GameObject monster;</code> </pre> <br>  Nous allons cr√©er une instance de l'objet stock√© dans <code>monsterPrefab</code> pour cr√©er le monstre, et le stocker dans <code>monster</code> afin qu'il puisse √™tre manipul√© pendant le jeu. <br><br><h3>  Un monstre par point </h3><br>  Pour qu'un seul monstre puisse √™tre plac√© sur un point, ajoutez la m√©thode suivante: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CanPlaceMonster</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> monster == <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br>  Dans <code>CanPlaceMonster()</code> nous pouvons v√©rifier si la variable <code>monster</code> est toujours <code>null</code> .  Si c'est le cas, alors il n'y a pas de monstre √† ce point, et nous pouvons le placer. <br><br>  Ajoutez maintenant le code suivant pour placer le monstre lorsque le joueur clique sur ce GameObject: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//1 void OnMouseUp() { //2 if (CanPlaceMonster()) { //3 monster = (GameObject) Instantiate(monsterPrefab, transform.position, Quaternion.identity); //4 AudioSource audioSource = gameObject.GetComponent&lt;AudioSource&gt;(); audioSource.PlayOneShot(audioSource.clip); // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">   } }</span></span></code> </pre> <br>  Ce code localise le monstre lorsque vous cliquez sur la souris ou touchez l'√©cran.  Comment fonctionne-t-il? <br><br><ol><li>  Unity appelle automatiquement <code>OnMouseUp</code> lorsqu'un joueur touche le collisionneur physique GameObject. </li><li>  Lorsqu'elle est appel√©e, cette m√©thode place un monstre si <code>CanPlaceMonster()</code> renvoie <code>true</code> . </li><li>  Nous cr√©ons un monstre √† l'aide de la m√©thode <code>Instantiate</code> , qui cr√©e une instance du pr√©fabriqu√© donn√© avec la position et la rotation sp√©cifi√©es.  Dans ce cas, nous copions <code>monsterPrefab</code> , lui donnons la position actuelle de GameObject et aucune rotation, transf√©rons le r√©sultat vers <code>GameObject</code> et l'enregistrons dans <code>monster</code> </li><li>  √Ä la fin, nous appelons <code>PlayOneShot</code> pour lire l'effet sonore attach√© au composant <code>AudioSource</code> de l'objet. </li></ol><br>  Maintenant, notre script <code>PlaceMonster</code> peut avoir un nouveau monstre, mais nous devons toujours sp√©cifier un pr√©fabriqu√©. <br><br><h3>  Utiliser le bon pr√©fabriqu√© </h3><br>  Enregistrez le fichier et revenez √† Unity. <br><br>  Pour d√©finir la variable <em>monsterPrefab</em> , s√©lectionnez d'abord l'objet <em>Openspot</em> dans le dossier <em>Prefabs</em> du navigateur du projet. <br><br>  Dans l' <em><em>inspecteur,</em></em> cliquez sur le cercle √† droite du champ <em>Monster Prefab</em> du <em>composant PlaceMonster (Script)</em> et s√©lectionnez <em>Monster</em> dans la bo√Æte de dialogue qui appara√Æt. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b87/8bc/9c7/b878bc9c77c6e7c63a54f4a87d2a7c42.gif"></div><br>  C‚Äôest tout.  Lancez la sc√®ne et cr√©ez des monstres √† diff√©rents endroits en cliquant sur la souris ou en touchant l'√©cran. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/095/f08/01d/095f0801ddbbc91ce0eca144a22d4f7b.png"></div><br>  Super!  Maintenant, nous pouvons cr√©er des monstres.  Cependant, ils ressemblent √† un √©trange g√¢chis, car tous les sprites enfants du monstre sont dessin√©s.  Maintenant, nous allons le r√©parer. <br><br><h2>  Augmentez le niveau des monstres </h2><br>  La figure ci-dessous montre qu'avec une augmentation de niveau, les monstres ont de plus en plus peur. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a92/23d/480/a9223d480dda51f941c3b0b82f9f0dd6.png"></div><br>  <i>Quelle mignonne!</i>  <i>Mais si vous essayez de voler ses cookies, ce monstre se transformera en tueur.</i> <br><br>  Le script est utilis√© comme base pour la mise en ≈ìuvre du syst√®me de niveaux de monstre.  Il suit la puissance du monstre √† chaque niveau et, bien s√ªr, le niveau actuel du monstre. <br><br>  Ajoutez ce script. <br><br>  S√©lectionnez le pr√©fabriqu√© <em>Prefab / Monster</em> dans l' <em>arborescence du projet</em> .  Ajoutez un nouveau script <em>C #</em> appel√© <em>MonsterData</em> .  Ouvrez le script dans l'EDI et ajoutez le code suivant <i>au</i> - <i>dessus de</i> la classe <code>MonsterData</code> . <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">System.Serializable</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MonsterLevel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cost; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GameObject visualization; }</code> </pre> <br>  Nous cr√©ons donc <code>MonsterLevel</code> .  Il regroupe le prix (en or, que nous soutiendrons ci-dessous) et une repr√©sentation visuelle du niveau du monstre. <br><br>  Nous ajoutons au-dessus de <code>[System.Serializable]</code> afin que les instances de classe puissent √™tre modifi√©es dans l'inspecteur.  Cela nous permet de changer rapidement toutes les valeurs de la classe Level, m√™me lorsque le jeu est en cours d'ex√©cution.  C'est incroyablement utile pour √©quilibrer le jeu. <br><br><h3>  D√©finition des niveaux de monstre </h3><br>  Dans notre cas, nous stockons le <code>MonsterLevel</code> sp√©cifi√© dans la <code>List&lt;T&gt;</code> . <br><br>  Pourquoi ne pas simplement utiliser <code>MonsterLevel[]</code> ?  Nous aurons besoin de l'index d'un objet <code>MonsterLevel</code> sp√©cifique plusieurs fois.  Bien qu'il soit facile d'√©crire du code pour cela, nous devons encore utiliser <code>IndexOf()</code> , qui impl√©mente la fonctionnalit√© <code>Lists</code> .  Cela n'a aucun sens de r√©inventer la roue. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aae/85f/785/aae85f7854f44c8f418c5fde22153a53.jpg"></div><br>  <i>R√©inventer le v√©lo est g√©n√©ralement une mauvaise id√©e.</i> <br><br>  En haut de <em>MonsterData.cs,</em> ajoutez ce qui suit √† l' <code>using</code> construction: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic;</code> </pre> <br>  Il nous donne acc√®s √† des structures de donn√©es g√©n√©ralis√©es afin que nous puissions utiliser la classe <code>List&lt;T&gt;</code> dans le script. <br><br><blockquote>  <em>Remarque</em> : les g√©n√©ralisations sont un puissant concept C #.  Ils vous permettent de sp√©cifier des structures de donn√©es de type s√©curis√© sans avoir √† adh√©rer au type.  Ceci est utile pour les classes de conteneurs telles que les listes et les ensembles.  Pour en savoir plus sur les structures g√©n√©riques, lisez le livre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="Introduction aux g√©n√©riques C #">Introduction aux g√©n√©riques C #</a> . </blockquote><br>  Ajoutez maintenant la variable suivante √† <code>MonsterData</code> pour contenir la liste <code>MonsterLevel</code> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;MonsterLevel&gt; levels;</code> </pre> <br>  Gr√¢ce aux g√©n√©ralisations, nous pouvons garantir que la <code>List</code> partir du <code>level</code> ne contiendra que des objets <code>MonsterLevel</code> . <br><br>  Enregistrez le fichier et passez √† Unity pour configurer chaque niveau. <br><br>  S√©lectionnez <em>Prefabs / Monster</em> dans le <em>navigateur de projet</em> .  L' <em><em>inspecteur</em></em> affiche d√©sormais le champ <em>Niveaux</em> du <em>composant MonsterData (Script)</em> .  D√©finissez la <em>taille</em> sur <em>3</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/660/dda/a18/660ddaa185b824721453ca1c892eedff.png"></div><br>  Ensuite, d√©finissez le <em>co√ªt</em> pour chaque niveau: <br><br><ul><li>  <em>√âl√©ment 0</em> : <em>200</em> </li><li>  <em>√âl√©ment 1</em> : <em>110</em> </li><li>  <em>√âl√©ment 2</em> : <em>120</em> </li></ul><br>  Maintenant, nous attribuons les valeurs des champs d'affichage visuel. <br><br>  D√©veloppez <em>Prefabs / Monster</em> dans le navigateur du projet pour voir ses enfants.  Faites glisser l'enfant <em>Monster0</em> dans le champ <em>El√©ment de</em> <em>visualisation</em> <em>0</em> . <br><br>  Ensuite, d√©finissez l' <em>√©l√©ment 1</em> sur <em>Monster1</em> et l' <em>√©l√©ment 2</em> sur <em>Monster2</em> .  Le GIF montre ce processus: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/662/404/e30/662404e30bd808e1cf9a9d34b47d4d61.gif"></div><br>  Lorsque vous s√©lectionnez <em>Prefabs / Monster</em> , le pr√©fabriqu√© devrait ressembler √† ceci: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/80b/e4d/17e/80be4d17e9894cf291b7be8a44152044.png"></div><br><h3>  D√©finir le niveau actuel </h3><br>  Revenez √† <em>MonsterData.cs</em> dans l'EDI et ajoutez une autre variable √† <code>MonsterData</code> . <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MonsterLevel currentLevel;</code> </pre> <br>  Dans la variable priv√©e <code>currentLevel</code> nous stockons le niveau actuel du monstre. <br><br>  <code>currentLevel</code> maintenant <code>currentLevel</code> et rendez-le visible pour les autres scripts.  Ajoutez les lignes suivantes √† <code>MonsterData</code> avec la d√©claration des variables d'instance: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//1 public MonsterLevel CurrentLevel { //2 get { return currentLevel; } //3 set { currentLevel = value; int currentLevelIndex = levels.IndexOf(currentLevel); GameObject levelVisualization = levels[currentLevelIndex].visualization; for (int i = 0; i &lt; levels.Count; i++) { if (levelVisualization != null) { if (i == currentLevelIndex) { levels[i].visualization.SetActive(true); } else { levels[i].visualization.SetActive(false); } } } } }</span></span></code> </pre> <br>  Assez gros morceau de code C #, non?  Prenons-le dans l'ordre: <br><br><ol><li>  D√©finissez la <em>propri√©t√© de la</em> variable priv√©e <code>currentLevel</code> .  En d√©finissant la propri√©t√©, nous pouvons l'appeler comme n'importe quelle autre variable: soit comme <code>CurrentLevel</code> (√† l'int√©rieur de la classe), soit comme <code>CurrentLevel</code> (√† l'ext√©rieur).  Nous pouvons d√©finir n'importe quel comportement dans la m√©thode getter ou setter d'une propri√©t√©, et en cr√©ant uniquement un getter, un setter ou les deux, vous pouvez contr√¥ler les propri√©t√©s de la propri√©t√©: lecture seule, √©criture seule et √©criture / lecture. </li><li>  Dans le getter, nous retournons la valeur de <code>currentLevel</code> . </li><li>  Dans le setter, nous attribuons √† <code>currentLevel</code> nouvelle valeur.  Ensuite, nous obtenons l'indice du niveau actuel.  Enfin, nous parcourons tous les <em>niveaux</em> et activons / d√©sactivons l'affichage visuel en fonction de <code>currentLevelIndex</code> .  C'est formidable car lorsque <code>currentLevel</code> change, le sprite se met √† jour automatiquement.  Les propri√©t√©s sont une chose tr√®s pratique! </li></ol><br>  Ajoutez l'impl√©mentation <code>OnEnable</code> suivante: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { CurrentLevel = levels[<span class="hljs-number"><span class="hljs-number">0</span></span>]; }</code> </pre> <br>  Ici, nous d√©finissons <code>CurrentLevel</code> lors du placement.  Cela garantit que seul le sprite souhait√© est affich√©. <br><br><blockquote>  <em>Remarque</em> : il est important d'initialiser la propri√©t√© dans <code>OnEnable</code> , et non dans <code>OnStart</code> , car nous appelons les m√©thodes ordinales lors de la cr√©ation d'instances pr√©fabriqu√©es. <br><br>  <code>OnEnable</code> sera appel√© imm√©diatement lorsque le pr√©fabriqu√© est cr√©√© (si le pr√©fabriqu√© a √©t√© enregistr√© dans l'√©tat activ√©), mais <code>OnStart</code> appel√© que lorsque l'objet commence √† s'ex√©cuter dans le cadre de la sc√®ne. <br><br>  Nous devons v√©rifier ces donn√©es avant de placer le monstre, nous l'initialisons donc sur <code>OnEnable</code> . </blockquote><br>  Enregistrez le fichier et revenez √† Unity.  Ex√©cutez le projet et placez les monstres;  ils affichent maintenant les sprites corrects du niveau le plus bas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/08e/16e/549/08e16e5498d12f78d106d873d34c8d1b.png"></div><br><h3>  Mise √† niveau de monstre </h3><br>  Revenez √† l'EDI et ajoutez la m√©thode suivante √† <code>MonsterData</code> : <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> MonsterLevel </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetNextLevel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> currentLevelIndex = levels.IndexOf (currentLevel); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxLevelIndex = levels.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentLevelIndex &lt; maxLevelIndex) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> levels[currentLevelIndex+<span class="hljs-number"><span class="hljs-number">1</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre> <br>  Dans <code>GetNextLevel</code> nous obtenons l'index <code>currentLevel</code> et l'index de niveau le plus √©lev√©;  si le monstre n'a pas atteint le niveau maximum, le niveau suivant revient.  Sinon, <code>null</code> renvoy√©. <br><br>  Vous pouvez utiliser cette m√©thode pour savoir si une mise √† niveau de monstre est possible. <br><br>  Pour √©lever le niveau du monstre, ajoutez la m√©thode suivante: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IncreaseLevel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> currentLevelIndex = levels.IndexOf(currentLevel); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentLevelIndex &lt; levels.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>) { CurrentLevel = levels[currentLevelIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>]; } }</code> </pre> <br>  Ici, nous obtenons l'index du niveau actuel, puis nous nous assurons que ce n'est pas le niveau maximum, en v√©rifiant qu'il est inf√©rieur aux <code>levels.Count - 1</code> .  Si tel est le cas, <code>CurrentLevel</code> au niveau suivant. <br><br><h3>  V√©rification de la fonctionnalit√© de mise √† niveau </h3><br>  Enregistrez le fichier et revenez √† <em>PlaceMonster.cs</em> dans l'IDE.  Ajoutez une nouvelle m√©thode: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CanUpgradeMonster</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (monster != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { MonsterData monsterData = monster.GetComponent&lt;MonsterData&gt;(); MonsterLevel nextLevel = monsterData.GetNextLevel(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextLevel != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  Nous v√©rifions d'abord s'il existe un monstre qui peut √™tre am√©lior√© en comparant la variable <code>monster</code> avec <code>null</code> .  Si cela est vrai, nous obtenons le niveau actuel du monstre √† partir de ses <code>MonsterData</code> . <br><br>  Ensuite, nous v√©rifions si le niveau suivant est disponible, c'est-√†-dire si <code>GetNextLevel()</code> ne retourne pas <code>null</code> .  Si une augmentation de niveau est possible, alors nous retournons <code>true</code> ;  sinon retournez <code>false</code> . <br><br><h3>  Nous mettons en ≈ìuvre des am√©liorations pour l'or </h3><br>  Pour activer l'option de mise √† niveau, ajoutez la branche <code>else if</code> √† <code>OnMouseUp</code> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CanPlaceMonster()) { <span class="hljs-comment"><span class="hljs-comment">//      } else if (CanUpgradeMonster()) { monster.GetComponent&lt;MonsterData&gt;().IncreaseLevel(); AudioSource audioSource = gameObject.GetComponent&lt;AudioSource&gt;(); audioSource.PlayOneShot(audioSource.clip); // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">   }</span></span></code> </pre> <br>  Nous v√©rifions la possibilit√© d'une mise √† niveau en utilisant <code>CanUpgradeMonster()</code> .  Si possible, nous <code>MonsterData</code> composant <code>MonsterData</code> aide de <code>GetComponent()</code> et appelons <code>IncreaseLevel()</code> , ce qui augmente le niveau du monstre.  Enfin, nous lan√ßons Monster <em>AudioSource</em> . <br><br>  Enregistrez le fichier et revenez √† Unity.  Ex√©cutez le jeu, placez et am√©liorez <i>n'importe quel nombre de</i> monstres (mais pour l'instant). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cb7/495/bed/cb7495bed8ebcd3993439de25a08a0e7.png"></div><br><h2>  Payer l'or - Game Manager </h2><br>  Bien que nous puissions imm√©diatement construire et am√©liorer des monstres, mais sera-t-il int√©ressant dans le jeu? <br><br>  Examinons la question de l'or.  Le probl√®me avec le suivi est que nous devons transf√©rer des informations entre diff√©rents objets de jeu. <br><br>  La figure ci-dessous montre tous les objets qui devraient y participer. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e35/8cd/6f4/e358cd6f461c75385f61f1c12862a16b.png"></div><br>  <i>Tous les objets de jeu s√©lectionn√©s doivent savoir combien d'or un joueur poss√®de.</i> <br><br>  Pour stocker ces donn√©es, nous utiliserons un objet commun auquel d'autres objets peuvent acc√©der. <br><br>  Cliquez avec le bouton droit sur la <em>hi√©rarchie</em> et s√©lectionnez <em>Cr√©er vide</em> .  Nommez le nouvel objet <em>GameManager</em> . <br><br>  Ajoutez un nouveau script <em>C #</em> appel√© <em>GameManagerBehavior √† GameManager</em> , puis ouvrez-le dans l'EDI.  Nous afficherons la quantit√© totale d'or du joueur dans l'√©tiquette, donc en haut du fichier, ajoutez la ligne suivante: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine.UI;</code> </pre> <br>  Cela nous permettra d'acc√©der √† des classes d'interface utilisateur comme <code>Text</code> , qui est utilis√© pour les √©tiquettes.  Ajoutez maintenant la variable suivante √† la classe: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Text goldLabel;</code> </pre> <br>  Il stockera un lien vers le composant <code>Text</code> utilis√© pour afficher la quantit√© d'or d'un joueur. <br><br>  Maintenant que le <code>GameManager</code> conna√Æt l'√©tiquette, comment synchroniser la quantit√© d'or stock√©e dans la variable et la valeur affich√©e sur l'√©tiquette?  Nous allons cr√©er une propri√©t√©. <br><br>  Ajoutez le code suivant √† <code>GameManagerBehavior</code> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> gold; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Gold { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gold; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { gold = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; goldLabel.GetComponent&lt;Text&gt;().text = <span class="hljs-string"><span class="hljs-string">"GOLD: "</span></span> + gold; } }</code> </pre> <br>  Semble-t-il familier?  Le code est similaire √† <code>CurrentLevel</code> , que nous avons d√©fini dans <code>Monster</code> .  Nous cr√©ons d'abord un <code>gold</code> variable priv√© pour contenir la quantit√© d'or actuelle.  Ensuite, nous d√©finissons la propri√©t√© <code>Gold</code> (de mani√®re inattendue, non?) Et impl√©mentons le getter et le setter. <br><br>  Le getter renvoie simplement la valeur de l' <code>gold</code> .  Le passeur est plus int√©ressant.  En plus de d√©finir la valeur de la variable, il d√©finit √©galement le champ de <code>text</code> pour <code>goldLabel</code> pour afficher la nouvelle valeur d'or. <br><br>  Sommes-nous g√©n√©reux?  Ajoutez la ligne suivante √† <code>Start()</code> pour donner au joueur <em>1000 pi√®ces d'</em> or, ou moins si vous vous sentez d√©sol√© pour l'argent: <br><br><pre> <code class="cs hljs">Gold = <span class="hljs-number"><span class="hljs-number">1000</span></span>;</code> </pre> <br><h3>  Affectation d'un objet d'√©tiquette √† un script </h3><br>  Enregistrez le fichier et revenez √† Unity.  Dans la <em>hi√©rarchie,</em> s√©lectionnez <em>GameManager</em> .  Dans l' <em><em>inspecteur,</em></em> cliquez sur le cercle √† droite du <em>Gold Label</em> .  Dans la bo√Æte de dialogue <em>S√©lectionner le texte</em> , s√©lectionnez l'onglet <em>Sc√®ne</em> et s√©lectionnez <em>GoldLabel</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/05e/82e/956/05e82e95690113e0086020a817e2718c.png"></div><br>  Ex√©cutez la sc√®ne et l'√©tiquette affichera <em>Gold: 1000</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a97/b8f/b45/a97b8fb455f50659176371e484a280e6.png"></div><br><h3>  V√©rification du "portefeuille" du joueur </h3><br>  Ouvrez le script <em>PlaceMonster.cs</em> dans l'EDI et ajoutez la variable d'instance suivante: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GameManagerBehavior gameManager;</code> </pre> <br>  Nous utiliserons <code>gameManager</code> pour acc√©der au composant <code>GameManagerBehavior</code> de l'objet <code>GameManagerBehavior</code> <em>dans la</em> sc√®ne.  Pour le sp√©cifier, ajoutez ce qui suit √† <code>Start()</code> : <br><br><pre> <code class="cs hljs">gameManager = GameObject.Find(<span class="hljs-string"><span class="hljs-string">"GameManager"</span></span>).GetComponent&lt;GameManagerBehavior&gt;();</code> </pre> <br>  Nous obtenons un GameObject appel√© GameManager √† l'aide de la fonction <code>GameObject.Find()</code> , qui renvoie le premier objet de jeu trouv√© avec ce nom.  Ensuite, nous obtenons son composant <code>GameManagerBehavior</code> et l'enregistrons pour l'avenir. <br><br><blockquote>  <em>Remarque</em> : vous pouvez le faire en d√©finissant un champ dans l'√©diteur Unity ou en ajoutant √† <code>GameManager</code> une m√©thode statique qui renvoie une instance du singleton √† partir de laquelle nous pouvons obtenir <code>GameManagerBehavior</code> . <br><br>  Cependant, dans le bloc de code ci-dessus, il y a un cheval noir: la m√©thode <code>Find</code> , qui fonctionne plus lentement pendant l'ex√©cution de l'application;  mais il est pratique et peut √™tre utilis√© avec mod√©ration. </blockquote><br><h3>  Prends mon argent! </h3><br>  Nous n'avons pas encore soustrait d'or, nous allons donc ajouter cette ligne <em>deux fois</em> √† <code>OnMouseUp()</code> , en rempla√ßant chacun des commentaires <code>// TODO:  </code> : <br><br><pre> <code class="cs hljs">gameManager.Gold -= monster.GetComponent&lt;MonsterData&gt;().CurrentLevel.cost;</code> </pre> <br>  Enregistrez le fichier et revenez √† Unity, mettez √† niveau certains monstres et regardez la mise √† jour de la valeur Gold.  Maintenant, nous d√©duisons de l'or, mais les joueurs peuvent construire des monstres tant qu'ils ont suffisamment d'espace;  ils empruntent juste de l'argent. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/581/2fe/eaf/5812feeafd4b9d316f8294db56d55789.png"></div><br>  <i>Cr√©dit infini?</i>  <i>Super!</i>  <i>Mais nous ne pouvons pas le permettre.</i>  <i>Le joueur doit pouvoir parier des monstres tant qu'il a suffisamment d'or.</i> <br><br><h3>  Ch√®que d'or pour les monstres </h3><br>  Basculez l'IDE vers <em>PlaceMonster.cs</em> et remplacez le contenu de <code>CanPlaceMonster()</code> suit: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cost = monsterPrefab.GetComponent&lt;MonsterData&gt;().levels[<span class="hljs-number"><span class="hljs-number">0</span></span>].cost; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> monster == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; gameManager.Gold &gt;= cost;</code> </pre> <br>  Nous <code>MonsterData</code> prix de placement des monstres √† partir des <code>levels</code> dans ses <code>MonsterData</code> .  Ensuite, nous v√©rifions que le <code>monster</code> pas <code>null</code> et que <code>gameManager.Gold</code> sup√©rieur √† ce prix. <br><br>  La t√¢che pour vous: ajouter ind√©pendamment √† <code>CanUpgradeMonster()</code> v√©rification si le joueur a suffisamment d'or. <br><br><div class="spoiler">  <b class="spoiler_title">Solution √† l'int√©rieur</b> <div class="spoiler_text">  Remplacez la ligne: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>;</code> </pre> <br>  √† ce sujet: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gameManager.Gold &gt;= nextLevel.cost;</code> </pre> <br>  Il v√©rifiera si le joueur a plus d' <em>or</em> que le prix de mise √† niveau. </div></div><br>  Enregistrez et ex√©cutez la sc√®ne dans Unity.  Essayez maintenant de savoir comment ajouter des monstres √† volont√©! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/24b/f58/b6a/24bf58b6a0a1d4258295902f5d05c6bd.png"></div><br>  <i>Maintenant, nous ne pouvons construire qu'un nombre limit√© de monstres.</i> <br><br><h2>  Politique de la tour: ennemis, vagues et waypoints </h2><br>  Il est temps de ¬´pr√©parer le terrain¬ª √† nos ennemis.  Les ennemis apparaissent au premier point de l'itin√©raire, passent au suivant et r√©p√®tent le processus jusqu'√† ce qu'ils atteignent le cookie. <br><br>  Vous pouvez faire bouger les ennemis comme ceci: <br><br><ol><li>  D√©finissez la route que les ennemis suivront </li><li>  D√©placez l'ennemi le long de la route </li><li>  Tournez l'ennemi pour qu'il regarde vers l'avant </li></ol><br><h3>  Cr√©ation d'une route √† partir de waypoints </h3><br>  Cliquez avec le bouton droit sur la <em>hi√©rarchie</em> et s√©lectionnez <em>Cr√©er vide</em> pour cr√©er un nouvel objet de jeu vide.  Nommez-le <em>Road</em> et placez-le √† <em>(0, 0, 0)</em> . <br><br>  Maintenant, faites un clic droit sur <em>Road</em> dans la <em>hi√©rarchie</em> et cr√©ez un autre objet de jeu vide en tant qu'enfant de Road.  Nommez-le <em>Waypoint0</em> et placez-le au point <em>(-12, 2, 0)</em> - √† partir de l√†, les ennemis commenceront leur mouvement. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/78a/21a/044/78a21a0443e9b71b4c28064196cd0f8f.png"></div><br>  De m√™me, cr√©ez cinq autres points d'itin√©raire avec les noms et positions suivants: <br><br><ul><li>  Waypoint1: (X: 7, Y: 2, Z: 0) </li><li>  Waypoint2: (X: 7, Y: -1, Z: 0) </li><li>  Waypoint3: (X: -7,3, Y: -1, Z: 0) </li><li>  Waypoint4: (X: -7,3, Y: -4,5, Z: 0) </li><li>  Point de cheminement5: (X: 7, Y: -4,5, Z: 0) </li></ul><br>  La capture d'√©cran ci-dessous montre les points de l'itin√©raire et le chemin r√©sultant. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6c5/894/e67/6c5894e675d3be7fedc6bf87038b2188.png"></div><br><h2>  Se faire des ennemis </h2><br>  Cr√©ez maintenant des ennemis pour qu'ils puissent se d√©placer le long de la route.  Il y a un pr√©fabriqu√© <em>ennemi</em> dans le dossier <em>Prefabs</em> .  Sa position est <em>(-20, 0, 0)</em> , donc de nouvelles instances seront cr√©√©es hors √©cran. <br><br>  √Ä tous les autres √©gards, il est configur√© presque de la m√™me mani√®re que le pr√©fabriqu√© Monster, a <code>AudioSource</code> et une filiale <code>Sprite</code> , et nous pouvons faire pivoter ce sprite √† l'avenir sans tourner la barre de sant√©. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d46/5c7/b09/d465c7b0950d7c718abcb8869263753c.png"></div><br><h3>  Nous d√©pla√ßons des ennemis le long de la route </h3><br>  Ajoutez un nouveau script <em>C #</em> appel√© <em>MoveEnemy</em> au <em>pr√©fabriqu√© Prefabs \ Enemy</em> .  Ouvrez le script dans l'EDI et ajoutez les variables suivantes: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">HideInInspector</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GameObject[] waypoints; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> currentWaypoint = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> lastWaypointSwitchTime; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speed = <span class="hljs-number"><span class="hljs-number">1.0f</span></span>;</code> </pre> <br>  Dans les <code>waypoints</code> , une copie des <code>waypoints</code> est stock√©e dans le tableau, et la ligne <code>[HideIn <em>inspector</em> ]</code> au-dessus des <code>waypoints</code> garantit que nous ne pouvons pas modifier accidentellement ce champ dans l' <em><em>inspecteur</em></em> , mais y aurons toujours acc√®s √† partir d'autres scripts. <br><br>  <code>currentWaypoint</code> conserve la trace de la route de l'ennemi √† l'heure actuelle et <code>lastWaypointSwitchTime</code> stocke l'heure √† laquelle l'ennemi l'a travers√©.  De plus, nous stockons la <code>speed</code> ennemi. <br><br>  Ajoutez cette ligne √† <code>Start()</code> : <br><br><pre> <code class="cs hljs">lastWaypointSwitchTime = Time.time;</code> </pre> <br>  Nous initialisons donc <code>lastWaypointSwitchTime</code> avec la valeur de l'heure actuelle. <br><br>  Pour que l'ennemi se d√©place le long de l'itin√©raire, ajoutez le code suivant √† <code>Update()</code> : <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// 1 Vector3 startPosition = waypoints [currentWaypoint].transform.position; Vector3 endPosition = waypoints [currentWaypoint + 1].transform.position; // 2 float pathLength = Vector3.Distance (startPosition, endPosition); float totalTimeForPath = pathLength / speed; float currentTimeOnPath = Time.time - lastWaypointSwitchTime; gameObject.transform.position = Vector2.Lerp (startPosition, endPosition, currentTimeOnPath / totalTimeForPath); // 3 if (gameObject.transform.position.Equals(endPosition)) { if (currentWaypoint &lt; waypoints.Length - 2) { // 3.a currentWaypoint++; lastWaypointSwitchTime = Time.time; // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">     } else { // 3.b Destroy(gameObject); AudioSource audioSource = gameObject.GetComponent&lt;AudioSource&gt;(); AudioSource.PlayClipAtPoint(audioSource.clip, transform.position); // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">   } }</span></span></code> </pre> <br>  Analysons le code √©tape par √©tape: <br><br><ol><li>  √Ä partir du tableau de points d'itin√©raire, nous obtenons les positions de d√©but et de fin du segment d'itin√©raire actuel. </li><li>  Nous calculons le temps n√©cessaire pour parcourir toute la distance en utilisant la formule <em>temps = distance / vitesse</em> , puis d√©terminons l'heure actuelle sur l'itin√©raire.  En utilisant <code>Vector2.Lerp</code> , nous interpolons la position actuelle de l'ennemi entre le segment exact de d√©but et de fin. </li><li>  V√©rifiez si l'ennemi a atteint <code>endPosition</code> .  Si oui, alors nous traitons deux sc√©narios possibles: <br><ol><li>  L'ennemi n'a pas encore atteint le dernier point de l'itin√©raire, alors augmentez la valeur de <code>currentWaypoint</code> et mettez √† jour <code>lastWaypointSwitchTime</code> .  Plus tard, nous ajouterons un code pour retourner l'ennemi afin qu'il regarde dans la direction de son mouvement. </li><li>  L'ennemi a atteint le dernier point de la route, puis nous le d√©truisons et commen√ßons l'effet sonore.  Plus tard, nous ajouterons un code qui r√©duit la <code>health</code> du joueur. </li></ol></li></ol><br>  Enregistrez le fichier et revenez √† Unity. <br><br><h3>  Nous informons les ennemis de la direction du mouvement </h3><br>  Dans leur √©tat actuel, les ennemis ne connaissent pas l'ordre des points de route. <br><br>  S√©lectionnez <em>Road</em> dans la <em>hi√©rarchie</em> et ajoutez un nouveau script <em>C #</em> appel√© <em>SpawnEnemy</em> .  Ouvrez-le dans l'EDI et ajoutez la variable suivante: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GameObject[] waypoints;</code> </pre> <br>  Nous utiliserons des <code>waypoints</code> pour stocker les r√©f√©rences au waypoint dans la sc√®ne dans l'ordre souhait√©. <br><br>  Enregistrez le fichier et revenez √† Unity.  S√©lectionnez <em>Route</em> dans la <em>hi√©rarchie</em> et d√©finissez la <em>taille du</em> tableau de <em>waypoints</em> sur <em>6</em> . <br><br>  Faites glisser chacun des enfants Road dans les champs en collant <em>Waypoint0</em> dans l' <em>√©l√©ment 0</em> , <em>Waypoint1</em> dans l' <em>√©l√©ment 1,</em> etc. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/95a/1e3/251/95a1e3251247a04f62f8a618b681c052.gif"></div><br>  Nous avons maintenant un tableau contenant les points de route dans le bon ordre - attention, les ennemis ne reculent jamais, ils s'efforcent constamment d'obtenir une douce r√©compense. <br><br><h3>  V√©rifiez comment tout cela fonctionne </h3><br>  Ouvrez <em>SpawnEnemy</em> dans l'EDI et ajoutez la variable suivante: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GameObject testEnemyPrefab;</code> </pre> <br>  Il stockera une r√©f√©rence au <code>testEnemyPrefab</code> <em>Enemy</em> dans <code>testEnemyPrefab</code> . <br><br>  Pour cr√©er un ennemi lors de l'ex√©cution du script, ajoutez le code suivant √† <code>Start()</code> : <br><br><pre> <code class="cs hljs">Instantiate(testEnemyPrefab).GetComponent&lt;MoveEnemy&gt;().waypoints = waypoints;</code> </pre> <br>  Nous allons donc cr√©er une nouvelle copie du pr√©fabriqu√© stock√© dans <code>testEnemy</code> et lui affecter un itin√©raire. <br><br>  Enregistrez le fichier et revenez √† Unity.  S√©lectionnez l'objet <em>Route</em> dans la <em>hi√©rarchie</em> et s√©lectionnez le pr√©fabriqu√© <em>ennemi</em> pour le param√®tre <em>Test Enemy</em> . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lancez le projet et voyez comment l'ennemi se d√©place le long de la route (en GIF, pour plus de clart√©, la vitesse est augment√©e de 20 fois). </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0b6/b10/384/0b6b1038491a74c27d6b42860e44365e.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous avez remarqu√© qu'il ne regarde pas toujours o√π il va? </font><font style="vertical-align: inherit;">C'est dr√¥le, mais nous essayons de cr√©er un jeu professionnel. </font><font style="vertical-align: inherit;">Par cons√©quent, dans la deuxi√®me partie du didacticiel, nous apprendrons aux ennemis √† regarder en avant.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O√π aller ensuite? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons d√©j√† beaucoup fait et nous nous dirigeons rapidement vers la cr√©ation de notre propre jeu de tower defense. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les joueurs peuvent cr√©er un nombre limit√© de monstres, et l'ennemi court le long de la route, se dirigeant vers notre cookie. </font><font style="vertical-align: inherit;">Les joueurs ont de l'or et ils peuvent am√©liorer les monstres. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T√©l√©chargez le r√©sultat final </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d'ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deuxi√®me partie,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous consid√©rerons la cr√©ation d'√©normes vagues d'ennemis et leur destruction. </font><font style="vertical-align: inherit;">A tr√®s bient√¥t!</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413837/">https://habr.com/ru/post/fr413837/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr413817/index.html">Traitement concurrentiel h√©t√©rog√®ne et en temps r√©el des donn√©es strictement une fois</a></li>
<li><a href="../fr413819/index.html">Honn√™tement sur le march√© informatique en Russie</a></li>
<li><a href="../fr413823/index.html">Le boom de l'emploi insignifiant</a></li>
<li><a href="../fr413827/index.html">Le projet Kubernetes f√™te ses 4 ans</a></li>
<li><a href="../fr413831/index.html">La nouvelle version de Tesla Autopilot sortira en ao√ªt, pour la premi√®re fois avec des ¬´fonctions de conduite enti√®rement autonomes¬ª</a></li>
<li><a href="../fr413839/index.html">AI, cours pratique. Collection et recherche d'images</a></li>
<li><a href="../fr413841/index.html">Alternatives aux produits Google</a></li>
<li><a href="../fr413843/index.html">Waymo devance les autres: les robots de la soci√©t√© ont parcouru 11 millions de kilom√®tres</a></li>
<li><a href="../fr413847/index.html">Monument d√©clencheur "vivant"</a></li>
<li><a href="../fr413849/index.html">Histoire de la marque Sennheiser: libert√© et vision</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>