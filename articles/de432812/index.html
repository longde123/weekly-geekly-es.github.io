<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🦈 🎲 🤴🏼 Wir schreiben Handelsroboter mit dem grafischen Framework von StockSharp. Teil 1 👩🏽‍🤝‍👨🏻 🕴🏾 👝</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In unserem Blog schreiben wir viel über Technologien und nützliche Tools im Zusammenhang mit dem Aktienhandel. Eine davon ist die kostenlose StockShar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wir schreiben Handelsroboter mit dem grafischen Framework von StockSharp. Teil 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/iticapital/blog/432812/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/f-/uo/a9/f-uoa9b5v33o_a22qip5tgvjg6o.png"></a> <br><br>  In unserem Blog schreiben wir viel über Technologien und nützliche Tools im Zusammenhang mit dem Aktienhandel.  Eine davon ist die kostenlose <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">StockSharp-</a> Plattform, die für die professionelle Entwicklung von Handelsterminals und Handelsrobotern in C # verwendet werden kann.  In diesem Artikel wird gezeigt, wie das in S # .API enthaltene grafische Framework verwendet wird, um ein Handelsterminal mit der Fähigkeit zum Ausführen algorithmischer Strategien zu erstellen. <a name="habracut"></a><br><br><h2>  Was wird benötigt </h2><br><ol><li>  Visual Studio 2017 (Community, kostenlose Version), darin werden wir programmieren. </li><li>  Verbindung zum Handel an der Börse, in den Beispielen in diesem Text wird die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SMARTcom-</a> Schnittstelle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">von ITI Capital verwendet</a> . </li></ol><br><h2>  Projekterstellung </h2><br>  Erstellen Sie eine neue WPF-Anwendung in Visual Studio: <br><br><img src="https://habrastorage.org/webt/nq/j3/sb/nqj3sbywjx9_xny7tjyac_kn3pc.png"><br><br>  Dann müssen Sie die S # .API-Bibliothek hinzufügen.  Wie das geht, erfahren Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in der Dokumentation</a> .  Die beste Option ist die Installation mit Nuget. <br><br>  Da alle S # .API-Grafikelemente auf DevExpress basieren und DevExpress-Bibliotheken mit S # .API geliefert werden, wäre es dumm, sie nicht zu verwenden.  Gehen wir zum Fenstereditor MainWindow.xaml: <br><br><img src="https://habrastorage.org/webt/ni/q2/zz/niq2zzalyspdk8ztdf9uatdfnps.png"><br><br>  Ersetzen Sie das Fenster durch DXWindow. Wir benötigen dies, um verschiedene Farbschemata zu verwenden: <br><br><img src="https://habrastorage.org/webt/ok/jo/h1/okjoh1ouxpadw48b2scjw8x1df4.png"><br><br>  Visual Studio selbst bietet uns an, die erforderlichen Bibliotheken einzufügen. <br><br>  Wir werden das Fenster in drei Teile teilen - oben befindet sich ein Streifen mit Schaltflächen zum Einrichten von Verbindungen und Verbindungen, unten befindet sich ein Fenster mit Protokollen und in der Mitte alle anderen Felder.  Der einfachste Weg, ein Fenster zu brechen, ist mit LayoutControl von DevExpress. <br><br>  In den resultierenden drei Teilen werden wir die Elemente hinzufügen, die wir benötigen. <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dx:DXWindow</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ShellNew.MainWindow"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:d</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:mc</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:dx</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.devexpress.com/winfx/2008/xaml/core"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:dxlc</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mc:Ignorable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"d"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MainWindow"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"450"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"800"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dxlc:LayoutControl</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Padding</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LayoutControlRoot"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Vertical"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dxlc:LayoutGroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HorizontalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Stretch"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"25"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dxlc:LayoutGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dxlc:LayoutGroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HorizontalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Stretch"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dxlc:LayoutGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dxlc:LayoutGroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HorizontalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Stretch"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dxlc:LayoutGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dxlc:LayoutControl</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dx:DXWindow</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h2>  Konfigurieren einer Verbindung zu einem Connector </h2><br>  Fügen Sie zwei Schaltflächen hinzu, eine ist die Schaltfläche für die Verbindungseinstellungen und die zweite ist die Schaltfläche für die Verbindung.  Verwenden Sie dazu die SimpleButton-Schaltfläche von DevExpress.  Die Schaltflächen befinden sich oben in der Anwendung.  In jede Schaltfläche platzieren wir die Bilder, die aus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">S # .Designer</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">S # .Data</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">S # .Terminal bekannt sind</a> . <br><br><pre> <code class="cs hljs">&lt;dx:DXWindow x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.MainWindow"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:d=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span> xmlns:mc=<span class="hljs-string"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span> xmlns:dx=<span class="hljs-string"><span class="hljs-string">"http://schemas.devexpress.com/winfx/2008/xaml/core"</span></span> xmlns:dxlc=<span class="hljs-string"><span class="hljs-string">"http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"</span></span> xmlns:xaml=<span class="hljs-string"><span class="hljs-string">"http://schemas.stocksharp.com/xaml"</span></span> mc:Ignorable=<span class="hljs-string"><span class="hljs-string">"d"</span></span> Title=<span class="hljs-string"><span class="hljs-string">"MainWindow"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"450"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"800"</span></span>&gt; &lt;dxlc:LayoutControl Padding=<span class="hljs-string"><span class="hljs-string">"0"</span></span> Name=<span class="hljs-string"><span class="hljs-string">"LayoutControlRoot"</span></span> Orientation=<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span>&gt; &lt;dxlc:LayoutGroup HorizontalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"25"</span></span>&gt; &lt;!--  --&gt; &lt;dxlc:LayoutItem Width=<span class="hljs-string"><span class="hljs-string">"40"</span></span>&gt; &lt;dx:SimpleButton x:Name=<span class="hljs-string"><span class="hljs-string">"SettingsButton"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"SettingsButton_Click"</span></span> &gt; &lt;Image Source=<span class="hljs-string"><span class="hljs-string">"{xaml:ThemedIcons Key=Settings}"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"16"</span></span> /&gt; &lt;/dx:SimpleButton&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem Width=<span class="hljs-string"><span class="hljs-string">"40"</span></span>&gt; &lt;dx:SimpleButton x:Name=<span class="hljs-string"><span class="hljs-string">"ConnectButton"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"ConnectButton_Click"</span></span> &gt; &lt;Image Source=<span class="hljs-string"><span class="hljs-string">"{xaml:ThemedIcons Key=Connect}"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"16"</span></span> /&gt; &lt;/dx:SimpleButton&gt; &lt;/dxlc:LayoutItem&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup HorizontalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> View=<span class="hljs-string"><span class="hljs-string">"Tabs"</span></span>&gt; &lt;!--  --&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup HorizontalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> &gt; &lt;!--  --&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutControl&gt; &lt;/dx:DXWindow&gt;</code> </pre> <br>  In der oberen rechten Ecke des Bildschirmformulars sehen wir das folgende Bild: <br><br><img src="https://habrastorage.org/webt/6w/yo/wd/6wyowd9ztiixrpaygfcs-v6eaj4.png"><br><br>  Doppelklicken Sie auf jede Schaltfläche, um Ereignishandler zum Klicken auf die Schaltfläche zu erstellen.  Im MainWindow-Code müssen Sie den Connector sowie den Speicherort und den Dateinamen deklarieren, in dem die Connector-Einstellungen gespeichert werden. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Connector Connector; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _dir = <span class="hljs-string"><span class="hljs-string">"Data"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _settingsFile = <span class="hljs-string"><span class="hljs-string">$@"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{_dir}</span></span></span><span class="hljs-string">\connection.xml"</span></span>;</code> </pre> <br>  Im Ereignishandler zum Klicken auf die Schaltfläche Connector-Einstellungen öffnen wir das Connector-Konfigurationsfenster und speichern es in einer Datei. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SettingsButton_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Connector.Configure(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XmlSerializer&lt;SettingsStorage&gt;().Serialize(Connector.Save(), _settingsFile); } }</code> </pre><br>  Im Konstruktor prüfen wir, ob es ein Verzeichnis und eine Datei mit den Connector-Einstellungen gibt, und wenn es eines gibt, laden wir es in den Connector: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//---------------------------------------------------------------------------------- Directory.CreateDirectory(_dir); Connector = new Connector(); if (File.Exists(_settingsFile)) { Connector.Load(new XmlSerializer&lt;SettingsStorage&gt;().Deserialize(_settingsFile)); } //----------------------------------------------------------------------------------</span></span></code> </pre> <br>  Die meisten S # .API-Objekte verfügen über Save and Load-Methoden, mit denen dieses Objekt aus einer XML-Datei gespeichert und geladen werden kann. <br><br>  Im Methodenhandler, der auf die Schaltfläche Verbinden klickt, verbinden wir den Konnektor. <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConnectButton_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { Connector.Connect(); }</code> </pre> <br>  Jetzt können Sie das Programm ausführen und überprüfen. <br><br><h2>  Ein dunkles Thema einstellen </h2><br>  Viele Händler bevorzugen dunkle Themen gegenüber Handelsanwendungen.  Deshalb machen wir das Thema des Programms sofort dunkel.  Für Sie müssen die App.xaml-Datei finden: <br><br><img src="https://habrastorage.org/webt/dc/el/xz/dcelxz29jsvbpysoimfdml5lp1m.png"><br><br>  Ersetzen Sie die Anwendung durch Diagramm: ExtendedBaseApplication, und Visual Studio selbst bietet uns an, die erforderlichen Bibliotheken einzufügen. <br><br><pre> <code class="cs hljs">&lt;charting:ExtendedBaseApplication x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.App"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:charting=<span class="hljs-string"><span class="hljs-string">"http://schemas.stocksharp.com/xaml"</span></span> StartupUri=<span class="hljs-string"><span class="hljs-string">"MainWindow.xaml"</span></span>&gt; &lt;/charting:ExtendedBaseApplication&gt;</code> </pre> <br>  Und in der Datei App.xaml.cs müssen Sie ": Application" löschen. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ShellNew</span></span> { <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Interaction logic for App.xaml </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> public partial class App { } }</span></span></code> </pre> <br>  Schreiben Sie im Konstruktor von MainWindow <code>ApplicationThemeHelper.ApplicationThemeName = Theme.VS2017DarkName;</code> <br><br>  Vollständiger Code im Moment: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MainWindow</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Connector Connector; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _dir = <span class="hljs-string"><span class="hljs-string">"Data"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _settingsFile = <span class="hljs-string"><span class="hljs-string">$@"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{_dir}</span></span></span><span class="hljs-string">\connection.xml"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainWindow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//---------------------------------------------------------------------------------- ApplicationThemeHelper.ApplicationThemeName = Theme.VS2017DarkName; //---------------------------------------------------------------------------------- Directory.CreateDirectory(_dir); Connector = new Connector(); if (File.Exists(_settingsFile)) { Connector.Load(new XmlSerializer&lt;SettingsStorage&gt;().Deserialize(_settingsFile)); } //---------------------------------------------------------------------------------- InitializeComponent(); } private void SettingsButton_Click(object sender, RoutedEventArgs e) { if (Connector.Configure(this)) { new XmlSerializer&lt;SettingsStorage&gt;().Serialize(Connector.Save(), _settingsFile); } } private void ConnectButton_Click(object sender, RoutedEventArgs e) { Connector.Connect(); } }</span></span></code> </pre> <br>  Führen Sie das dunkle Thema aus: <br><br><img src="https://habrastorage.org/webt/mk/lh/3v/mklh3vcxuf88y7zil2ub58n_js4.png"><br><br><h2>  Symbolleiste erstellen </h2><br>  Fügen Sie einen Ordner hinzu, in dem alle von uns erstellten Steuerelemente gespeichert werden, und nennen Sie ihn XAML.  Fügen Sie unseren ersten UserControll hinzu und geben Sie ihm den Namen SecurityGridControl. <br><br><img src="https://habrastorage.org/webt/y9/ye/oi/y9yeoioudundf5rke7k2vwh9wau.png"><br><br>  Wir fügen ein SecurityPicker-Element hinzu.  Es werden die verfügbaren Werkzeuge angezeigt.  In Analogie zum Hauptfenster verwenden wir das LayoutControl von DevExpress. <br><br><pre> <code class="cs hljs">&lt;UserControl x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.XAML.SecurityGridControl"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:mc=<span class="hljs-string"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span> xmlns:d=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span> xmlns:xaml=<span class="hljs-string"><span class="hljs-string">"http://schemas.stocksharp.com/xaml"</span></span> mc:Ignorable=<span class="hljs-string"><span class="hljs-string">"d"</span></span> d:DesignHeight=<span class="hljs-string"><span class="hljs-string">"450"</span></span> d:DesignWidth=<span class="hljs-string"><span class="hljs-string">"800"</span></span>&gt; &lt;xaml:SecurityPicker x:Name=<span class="hljs-string"><span class="hljs-string">"SecPicker"</span></span> /&gt; &lt;/UserControl&gt;</code> </pre> <br>  Gehen wir zum Designer des Hauptfensters und ändern den zentralen Teil in die Lesezeichenansicht.  In eines der Lesezeichen wird der mit SecurityPicker erstellte Controller eingefügt: <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutGroup HorizontalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> View=<span class="hljs-string"><span class="hljs-string">"Tabs"</span></span>&gt; &lt;!--  --&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Securities"</span></span>&gt; &lt;myxaml:SecurityGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"SecurityPanel"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutGroup&gt;</code> </pre> <br>  Nachdem wir die Symbolleiste haben, müssen wir ihr eine Datenquelle geben, in unserem Fall handelt es sich um einen Konnektor.  Sie können einfach in den <code>MainWindow  <br> SecurityPanel.SecPicker.SecurityProvider = Connector;</code> Konstruktor <code>MainWindow  <br> SecurityPanel.SecPicker.SecurityProvider = Connector;</code> <code>MainWindow  <br> SecurityPanel.SecPicker.SecurityProvider = Connector;</code>  . <br><br>  Sie sollten MainWindow jedoch nicht mit Code verstopfen, der nicht für MainWindow gilt.  Daher erstellen wir die statische Instanzvariable und weisen ihr im MainWindow-Konstruktor MainWindow zu: <br><br><pre> <code class="cs hljs">… <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> MainWindow Instance; … Instance = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; …</code> </pre> <br>  Jetzt können wir überall in unserem Programm über den Code MainWindow.Instance.XXX auf die Eigenschaften von MainWindow zugreifen. <br><br>  Im SecurityGridControl-Konstruktor geben wir auf diese Weise Connector als Datenquelle an: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SecurityGridControl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ InitializeComponent(); SecPicker.SecurityProvider = MainWindow.Instance.Connector; }</code> </pre> <br>  Führen Sie aus, um Folgendes zu überprüfen: <br><br><img src="https://habrastorage.org/webt/kv/yc/ez/kvycezcrwoqeghzdaw2puoagmmc.png"><br><br><h2>  Protokollierung hinzufügen </h2><br>  Das Programm, der Anschluss oder der Roboter müssen gesteuert werden.  Zu diesem Zweck verfügt S # .API über eine spezielle LogManager-Klasse.  Diese Klasse empfängt Nachrichten von Quellen und leitet sie an Listener weiter.  In unserem Fall sind die Quellen Connector, Strategien usw., und der Listener ist eine Datei und ein Protokollfenster. <br><br>  Im MainWindow-Code deklarieren wir das LogManager-Objekt und den Ort, an dem es gespeichert wird: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> LogManager LogManager; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _logsDir = <span class="hljs-string"><span class="hljs-string">$@"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{_dir}</span></span></span><span class="hljs-string">\Logs\"</span></span>;</code> </pre> <br>  Erstellen Sie im MainWindow-Konstruktor einen LogManager, legen Sie die Connector-Quell- und Listener-Datei dafür fest: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//---------------------------------------------------------------------------------- LogManager = new LogManager(); LogManager.Sources.Add(Connector); LogManager.Listeners.Add(new FileLogListener { SeparateByDates = SeparateByDateModes.SubDirectories, LogDirectory = _logsDir }); //----------------------------------------------------------------------------------</span></span></code> </pre> <br>  Erstellen Sie in Analogie zur Symbolleiste ein Protokollfenster im XAML-Ordner und fügen Sie ein weiteres UserControl hinzu.  Geben Sie ihm den Namen MonitorControl.  Fügen Sie das Monitor-Element hinzu. <br><br><pre> <code class="cs hljs">&lt;UserControl x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.XAML.MonitorControl"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:mc=<span class="hljs-string"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span> xmlns:d=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span> xmlns:xaml=<span class="hljs-string"><span class="hljs-string">"http://schemas.stocksharp.com/xaml"</span></span> mc:Ignorable=<span class="hljs-string"><span class="hljs-string">"d"</span></span> d:DesignHeight=<span class="hljs-string"><span class="hljs-string">"450"</span></span> d:DesignWidth=<span class="hljs-string"><span class="hljs-string">"800"</span></span>&gt; &lt;xaml:Monitor x:Name=<span class="hljs-string"><span class="hljs-string">"Monitor"</span></span> /&gt; &lt;/UserControl&gt;</code> </pre> <br>  Setzen Sie im MonitorControl-Konstruktor LogManager als Listener auf Monitor: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MonitorControl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); MainWindow.Instance.LogManager.Listeners.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GuiLogListener(Monitor)); }</code> </pre> <br>  Fügen Sie das erstellte MonitorControl unten in MainWindow hinzu: <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutGroup HorizontalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> dxlc:LayoutControl.AllowVerticalSizing=<span class="hljs-string"><span class="hljs-string">"True"</span></span>&gt; &lt;!--  --&gt; &lt;myxaml:MonitorControl x:Name=<span class="hljs-string"><span class="hljs-string">"MonitorControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt;</code> </pre> <br>  Führen Sie aus, um Folgendes zu überprüfen: <br><br><img src="https://habrastorage.org/webt/ky/xg/mw/kyxgmwzz8wd1cnl91bhpt1007be.png"><br><br><h2>  Erstellen Sie eine Glasscheibe </h2><br>  Erstellen Sie in Analogie zu den vorherigen Bedienfeldern eine Glasscheibe und fügen Sie dem XAML-Ordner ein weiteres UserControl hinzu.  Geben Sie ihm den Namen MarketDepthControl. <br><br>  In MainWindow haben wir bereits LayoutControl verwendet, in diesem Steuerelement wird auch LayoutControl verwendet.  Wir teilen die Platte horizontal in zwei Teile: <br><br><pre> <code class="cs hljs"> &lt;UserControl x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.XAML.MarketDepthControl"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:mc=<span class="hljs-string"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span> xmlns:d=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span> xmlns:dxlc=<span class="hljs-string"><span class="hljs-string">"http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"</span></span> mc:Ignorable=<span class="hljs-string"><span class="hljs-string">"d"</span></span>&gt; &lt;dxlc:LayoutControl Padding=<span class="hljs-string"><span class="hljs-string">"0"</span></span> Name=<span class="hljs-string"><span class="hljs-string">"LayoutControlRoot"</span></span> Orientation=<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span>&gt; &lt;dxlc:LayoutGroup&gt; &lt;!--Left--&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Orientation=<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span> dxlc:LayoutControl.AllowHorizontalSizing=<span class="hljs-string"><span class="hljs-string">"True"</span></span>&gt; &lt;!--Rigth--&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutControl&gt; &lt;/UserControl&gt;</code> </pre> <br>  Fügen Sie SecurityPicker auf der linken Seite hinzu - wir haben uns mit ihm getroffen, als wir die Symbolleiste erstellt haben. <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutGroup&gt; &lt;xaml:SecurityPicker x:Name=<span class="hljs-string"><span class="hljs-string">"SecPicker"</span></span> SecuritySelected=<span class="hljs-string"><span class="hljs-string">"SecPicker_SecuritySelected"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt;       .     : &lt;dxlc:LayoutGroup Orientation=<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span> dxlc:LayoutControl.AllowHorizontalSizing=<span class="hljs-string"><span class="hljs-string">"True"</span></span>&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span>&gt; &lt;xaml:MarketDepthControl x:Name=<span class="hljs-string"><span class="hljs-string">"MarketDepth"</span></span> MaxHeight=<span class="hljs-string"><span class="hljs-string">"2000"</span></span> SelectionChanged=<span class="hljs-string"><span class="hljs-string">"MarketDepth_SelectionChanged"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;/dxlc:LayoutGroup&gt;</code> </pre> <br>  MarketDepthControl muss einen MaxHeight-Wert festlegen, sonst wird die Anwendung nicht gestartet. <br><br>  Unter dem Glas platzieren wir die Elemente der Portfolioaufgabe, des Preises und des Auftragsvolumens: <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutItem Label=<span class="hljs-string"><span class="hljs-string">"Portfolio"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span>&gt; &lt;xaml:PortfolioComboBox x:Name=<span class="hljs-string"><span class="hljs-string">"PortfolioComboBox"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem Label=<span class="hljs-string"><span class="hljs-string">"Price"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span>&gt; &lt;dxe:SpinEdit MinValue=<span class="hljs-string"><span class="hljs-string">"0"</span></span> Name=<span class="hljs-string"><span class="hljs-string">"SpinEditPrice"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem Label=<span class="hljs-string"><span class="hljs-string">"Volume"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span>&gt; &lt;dxe:SpinEdit MinValue=<span class="hljs-string"><span class="hljs-string">"0"</span></span> Name=<span class="hljs-string"><span class="hljs-string">"SpinEditVolume"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt;</code> </pre> <br>  Beachten Sie die Label-Eigenschaft von LayoutItem, mit der Sie den Text vor dem Element festlegen können.  Sowie das SpinEdit-Element von DevExpress, in dem es bequem ist, numerische Werte festzulegen.  Diese Elemente sehen wie folgt aus: <br><br><img src="https://habrastorage.org/webt/gr/ix/9j/grix9jsfrxcmaftyx6bpdylnxi4.png"><br><br>  Unten platzieren wir die Kauf- und Verkaufsknöpfe: <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutGroup Orientation=<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span>&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span>&gt; &lt;dx:SimpleButton Content=<span class="hljs-string"><span class="hljs-string">"Buy"</span></span> x:Name=<span class="hljs-string"><span class="hljs-string">"BuyButton"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"BuyButton_Click"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span>&gt; &lt;dx:SimpleButton Content=<span class="hljs-string"><span class="hljs-string">"Sell"</span></span> x:Name=<span class="hljs-string"><span class="hljs-string">"SelltButton"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"SelltButton_Click"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;/dxlc:LayoutGroup&gt;</code> </pre> <br>  Vollständiger Code: <br><br><pre> <code class="cs hljs">&lt;UserControl x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.XAML.MarketDepthControl"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:mc=<span class="hljs-string"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span> xmlns:d=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span> xmlns:dxlc=<span class="hljs-string"><span class="hljs-string">"http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"</span></span> xmlns:dx=<span class="hljs-string"><span class="hljs-string">"http://schemas.devexpress.com/winfx/2008/xaml/core"</span></span> xmlns:xaml=<span class="hljs-string"><span class="hljs-string">"http://schemas.stocksharp.com/xaml"</span></span> xmlns:dxe=<span class="hljs-string"><span class="hljs-string">"http://schemas.devexpress.com/winfx/2008/xaml/editors"</span></span> mc:Ignorable=<span class="hljs-string"><span class="hljs-string">"d"</span></span>&gt; &lt;dxlc:LayoutControl Padding=<span class="hljs-string"><span class="hljs-string">"0"</span></span> Name=<span class="hljs-string"><span class="hljs-string">"LayoutControlRoot"</span></span> Orientation=<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span>&gt; &lt;dxlc:LayoutGroup&gt; &lt;xaml:SecurityPicker x:Name=<span class="hljs-string"><span class="hljs-string">"SecPicker"</span></span> SecuritySelected=<span class="hljs-string"><span class="hljs-string">"SecPicker_SecuritySelected"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Orientation=<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span> dxlc:LayoutControl.AllowHorizontalSizing=<span class="hljs-string"><span class="hljs-string">"True"</span></span>&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span>&gt; &lt;xaml:MarketDepthControl x:Name=<span class="hljs-string"><span class="hljs-string">"MarketDepth"</span></span> MaxHeight=<span class="hljs-string"><span class="hljs-string">"2000"</span></span> SelectionChanged=<span class="hljs-string"><span class="hljs-string">"MarketDepth_SelectionChanged"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem Label=<span class="hljs-string"><span class="hljs-string">"Portfolio"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span>&gt; &lt;xaml:PortfolioComboBox x:Name=<span class="hljs-string"><span class="hljs-string">"PortfolioComboBox"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem Label=<span class="hljs-string"><span class="hljs-string">"Price"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span>&gt; &lt;dxe:SpinEdit MinValue=<span class="hljs-string"><span class="hljs-string">"0"</span></span> Name=<span class="hljs-string"><span class="hljs-string">"SpinEditPrice"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem Label=<span class="hljs-string"><span class="hljs-string">"Volume"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span>&gt; &lt;dxe:SpinEdit MinValue=<span class="hljs-string"><span class="hljs-string">"0"</span></span> Name=<span class="hljs-string"><span class="hljs-string">"SpinEditVolume"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutGroup Orientation=<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span>&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span>&gt; &lt;dx:SimpleButton Content=<span class="hljs-string"><span class="hljs-string">"Buy"</span></span> x:Name=<span class="hljs-string"><span class="hljs-string">"BuyButton"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"BuyButton_Click"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span>&gt; &lt;dx:SimpleButton Content=<span class="hljs-string"><span class="hljs-string">"Sell"</span></span> x:Name=<span class="hljs-string"><span class="hljs-string">"SelltButton"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"SelltButton_Click"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutControl&gt; &lt;/UserControl&gt;</code> </pre> <br>  Legen Sie im MarketDepthControl-Konstruktor die Quelle der Tools für SecurityPicker und die Quelle der Portfolios für PortfolioComboBox fest. In unserem Fall ist dies Connector: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MarketDepthControl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); SecPicker.SecurityProvider = MainWindow.Instance.Connector; PortfolioComboBox.Portfolios = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PortfolioDataSource(MainWindow.Instance.Connector); }</code> </pre> <br>  Erstellen Sie in SecurityPicker einen Ereignishandler für die Werkzeugauswahl.  Darin prüfen wir, ob das empfangene Werkzeug ungleich Null ist.  Wenn es nicht gleich Null ist, speichern wir das empfangene Werkzeug in einer lokalen Variablen. Dies ist für uns beim Aktualisieren des Glases hilfreich.  Anschließend bereinigen und registrieren wir das empfangene Tool im Connector für den Empfang eines Glases mithilfe der RegisterMarketDepth-Methode.  Mit der GetMarketDepth-Methode erhalten wir das aktuelle Glas für das Instrument, um MarketDepthControl damit zu aktualisieren. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Security _selectedSecurity; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SecPicker_SecuritySelected</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Security security</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (security == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; _selectedSecurity = security; MainWindow.Instance.Connector.RegisterMarketDepth(_selectedSecurity); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> marketDepth = MainWindow.Instance.Connector.GetMarketDepth(_selectedSecurity); MarketDepth.UpdateDepth(marketDepth); }</code> </pre> <br>  Damit das Glas im MarketDepthControl-Konstruktor ständig aktualisiert wird, abonnieren wir das MarketDepthChanged-Glaswechselereignis auf dem Connector.  Im Handler dieses Ereignisses prüfen wir, zu welchem ​​Werkzeug das empfangene Glas gehört. Wenn es zu dem in SecurityPicker ausgewählten Werkzeug gehört, aktualisieren wir es: MarketDepthControl. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MarketDepthControl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); SecPicker.SecurityProvider = MainWindow.Instance.Connector; PortfolioComboBox.Portfolios = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PortfolioDataSource(MainWindow.Instance.Connector); MainWindow.Instance.Connector.MarketDepthChanged += Connector_MarketDepthChanged; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Connector_MarketDepthChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MarketDepth marketDepth</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_selectedSecurity == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || marketDepth.Security != _selectedSecurity) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; MarketDepth.UpdateDepth(marketDepth); }</code> </pre> <br>  Fügen Sie im zentralen Teil von MainWindow das erstellte MarketDepthControl-Bedienfeld hinzu: <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutGroup HorizontalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> View=<span class="hljs-string"><span class="hljs-string">"Tabs"</span></span>&gt; &lt;!--  --&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Securities"</span></span>&gt; &lt;myxaml:SecurityGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"SecurityPanel"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Portfolios"</span></span>&gt; &lt;myxaml:PortfolioGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"PortfolioGridControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Orders"</span></span>&gt; &lt;myxaml:OrderGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"OrderGridControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"MyTrades"</span></span>&gt; &lt;myxaml:MyTradeGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"MyTradeGridControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"MarketDepth"</span></span>&gt; &lt;myxaml:MarketDepthControl x:Name=<span class="hljs-string"><span class="hljs-string">"MarketDepthControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutGroup&gt;</code> </pre> <br>  In dieser Phase können Sie das Programm ausführen und die Funktion zum Aktualisieren der Brille überprüfen. <br>  Erstellen Sie einen Event-Handler, um auf die Schaltflächen Kaufen und Verkaufen zu klicken.  In jedem Handler erstellen wir eine Bestellung, in der wir das in SecurityPicker ausgewählte Tool, das in PortfolioComboBox ausgewählte Portfolio, das Volumen und den Preis aus dem entsprechenden SpinEdit angeben.  Registrieren Sie die Anwendung in Connector mit der RegisterOrder-Methode. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BuyButton_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { Order order = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Order() { Security = _selectedSecurity, Portfolio = PortfolioComboBox.SelectedPortfolio, Volume = SpinEditVolume.Value, Price = SpinEditPrice.Value, Direction = StockSharp.Messages.Sides.Buy, }; MainWindow.Instance.Connector.RegisterOrder(order); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SelltButton_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { Order order = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Order() { Security = _selectedSecurity, Portfolio = PortfolioComboBox.SelectedPortfolio, Volume = SpinEditVolume.Value, Price = SpinEditPrice.Value, Direction = StockSharp.Messages.Sides.Sell, }; MainWindow.Instance.Connector.RegisterOrder(order); }</code> </pre> <br>  Beide Prozessoren unterscheiden sich nur in der Richtung der Anwendung. <br><br>  Lassen Sie den SpinEditPrice-Wert um den Preis des ausgewählten Angebots ändern, wenn Sie Angebote in einem Glas auswählen.  Erstellen Sie dazu einen SelectionChanged-Ereignishandler für MarketDepthControl.  In diesem Fall aktualisieren wir den Wert von SpinEditPrice zum Preis des ausgewählten Angebots, wenn das ausgewählte Angebot nicht gleich Null ist. <br><br><pre> <code class="plaintext hljs">private void MarketDepth_SelectionChanged(object sender, GridSelectionChangedEventArgs e) { if (MarketDepth.SelectedQuote == null) return; SpinEditPrice.Value = MarketDepth.SelectedQuote.Price; }</code> </pre> <br>  Führen Sie aus, um Folgendes zu überprüfen: <br><br><img src="https://habrastorage.org/webt/p9/15/of/p915of4vabbulkuyg8zjlvxzsei.png"><br><br><h2>  Marktdaten speichern </h2><br>  Um Portfolios, Tools und Plattformen zu speichern, benötigen wir die CsvEntityRegistry-Klasse.  Es ist erforderlich, den Speicherort der Entität zu wiederholen und die Init-Methode aufzurufen, um sie zu laden. <br><br><pre> <code class="cs hljs"> _csvEntityRegistry = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CsvEntityRegistry(_csvEntityRegistryDir); _csvEntityRegistry.Init();</code> </pre> <br>  Um Kerzen, Angebote usw. zu sparen.  Wir brauchen StorageRegistry: <br><br><pre> <code class="cs hljs"> _storageRegistry = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StorageRegistry { DefaultDrive = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LocalMarketDataDrive(_storageRegistryDir), };</code> </pre> <br>  Wir benötigen auch die SnapshotRegistry-Registrierung von Snapshot-Speichern: <br><br><pre> <code class="cs hljs">_snapshotRegistry = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SnapshotRegistry(_snapshotRegistryDir);</code> </pre> <br>  All dies übergeben wir an den Connector, wenn er erstellt wird: <br><br><pre> <code class="cs hljs">Connector = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Connector(_csvEntityRegistry, _storageRegistry, _snapshotRegistry) { IsRestoreSubscriptionOnReconnect = <span class="hljs-literal"><span class="hljs-literal">true</span></span>, StorageAdapter = { DaysLoad = TimeSpan.FromDays(<span class="hljs-number"><span class="hljs-number">3</span></span>) }, }; Connector.LookupAll();</code> </pre> <br>  Hier haben wir auch angegeben, dass der Connector die Verbindung wieder herstellt, wenn die Verbindung getrennt wird, und wie viele Tage des Verlaufs heruntergeladen werden sollen.  String Connector.LookupAll ();  fordert verfügbare Daten an: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//---------------------------------------------------------------------------------- Directory.CreateDirectory(_dir); _csvEntityRegistry = new CsvEntityRegistry(_csvEntityRegistryDir); _csvEntityRegistry.Init(); _storageRegistry = new StorageRegistry { DefaultDrive = new LocalMarketDataDrive(_storageRegistryDir), }; _snapshotRegistry = new SnapshotRegistry(_snapshotRegistryDir); Connector = new Connector(_csvEntityRegistry, _storageRegistry, _snapshotRegistry) { IsRestoreSubscriptionOnReconnect = true, StorageAdapter = { DaysLoad = TimeSpan.FromDays(3) }, }; Connector.LookupAll(); if (File.Exists(_settingsFile)) { Connector.Load(new XmlSerializer&lt;SettingsStorage&gt;().Deserialize(_settingsFile)); } //----------------------------------------------------------------------------------</span></span></code> </pre> <br>  Nachdem Sie die Anwendung geladen und in den Datenordner gewechselt haben, werden neue Ordner angezeigt: <br><br><img src="https://habrastorage.org/webt/ur/5a/jx/ur5ajx_3klmkbkcfzkyrqqamuza.png"><br><br>  Beim erneuten Verbinden werden die Symbolleisten und Portfolios bereits gefüllt. <br><br>  Wir näherten uns reibungslos dem Ende des ersten Teils.  In dieser Phase können Sie mit dem Programm alle uns zur Verfügung stehenden Marktdaten anzeigen.  Der nächste Teil zeigt das Köstlichste - nämlich den Handel sowohl im manuellen als auch im automatischen Modus. <br><br>  <i>Fortsetzung folgt...</i> <br><br>  <b>Verfasser</b> : Ivan Zalutsky </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de432812/">https://habr.com/ru/post/de432812/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de432802/index.html">Sechs kostenlose Lernplattformen für die automatisierte Programmierung</a></li>
<li><a href="../de432804/index.html">Die ganze Wahrheit über RTOS. Artikel 24. Warteschlangen: Nebendienstleistungen und Datenstrukturen</a></li>
<li><a href="../de432806/index.html">Superintelligenz: eine Idee, die kluge Leute verfolgt</a></li>
<li><a href="../de432808/index.html">Gehälter in AI: Wo es mehr Geld gibt und wen sie in Russland suchen</a></li>
<li><a href="../de432810/index.html">Erste Bußgelder für die DSGVO: Wer wurde bereits bestraft?</a></li>
<li><a href="../de432814/index.html">Kuchen- und TeamCity-Integration</a></li>
<li><a href="../de432816/index.html">AXIS M3046-V gegen IDIS DC-D3212X: Vergleichen Sie CCTV-Kameras</a></li>
<li><a href="../de432818/index.html">Selbst gemachter Plotter: Tipps für Anfänger, die mit grbl-Firmware arbeiten</a></li>
<li><a href="../de432820/index.html">Dynamisches Testen von Android-Anwendungen</a></li>
<li><a href="../de432822/index.html">Ich verwöhne den Code meines Lebens für Entwickler und möchte ihn nicht mehr tun</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>