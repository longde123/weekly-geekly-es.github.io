<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‼️ 🕓 📴 Menguji PostgreSQL dengan HugePages di Linux 🧜🏾 💭 📲</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kernel Linux menyediakan berbagai opsi konfigurasi yang dapat mempengaruhi kinerja. Yang utama adalah memilih konfigurasi yang tepat untuk aplikasi da...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Menguji PostgreSQL dengan HugePages di Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/435558/"><p>  Kernel Linux menyediakan berbagai opsi konfigurasi yang dapat mempengaruhi kinerja.  Yang utama adalah memilih konfigurasi yang tepat untuk aplikasi dan beban kerja Anda.  Seperti basis data lainnya, PostgreSQL perlu penyetelan optimal kernel Linux.  Pengaturan yang salah dapat mengakibatkan kinerja yang buruk.  Penting untuk melakukan analisis komparatif terhadap kinerja basis data setelah setiap sesi penyetelan.  Dalam salah satu posting saya sebelumnya, berjudul <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">“Parameter Tune Linux Kernel Untuk Optimasi PostgreSQL,”</a> saya menjelaskan beberapa parameter kernel Linux yang paling berguna dan bagaimana mereka membantu meningkatkan kinerja database.  Sekarang saya akan membagikan hasil pengujian komparatif setelah mengkonfigurasi HugePages di Linux di bawah berbagai beban PostgreSQL.  Saya melakukan test suite lengkap di bawah banyak beban kerja PostgreSQL yang berbeda dengan sejumlah klien bersamaan. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/cc3/be2/1f8/cc3be21f802843526a6739be7b84af6e.jpg" alt="gambar"></p><a name="habracut"></a><br><h3 id="pk-na-kotorom-vypolnyalos-testirovanie">  PC tempat pengujian dilakukan </h3><br><ul><li>  Server Supermicro: <br><ol><li>  Intel® Xeon® CPU E5-2683 v3 @ 2.00 GHz </li><li>  2 soket / 28 core / 56 utas </li><li>  Memori: RAM 256 GB </li><li>  Penyimpanan: SAMSUNG SM863 1.9 TB Enterprise SSD </li><li>  Sistem File: ext4 / xfs </li></ol></li><li>  OS: Ubuntu 16.04.4, kernel 4.13.0-36-generik </li><li>  PostgreSQL: versi 11 </li></ul><br><h3 id="nastroyki-yadra-linux">  Pengaturan kernel Linux </h3><br><p> Saya menggunakan parameter kernel default tanpa optimasi / tweaker, hanya menonaktifkan HugePages Transparan.  Teknologi ini diaktifkan secara default dan mengalokasikan halaman dengan ukuran yang tidak disarankan untuk digunakan dengan database.  Secara umum, database membutuhkan HugePages dengan ukuran tetap, tetapi HugePages Transparan tidak dapat menyediakannya.  Oleh karena itu, selalu disarankan untuk menonaktifkan fitur ini dan secara default menginstal HugePages klasik. </p><br><h3 id="nastroyki-postgresql">  Pengaturan PostgreSQL </h3><br><p>  Saya menggunakan pengaturan PostgreSQL yang sama untuk semua tes untuk merekam beban kerja PostgreSQL yang berbeda dengan pengaturan Linux HugePages yang berbeda.  Untuk semua tes, pengaturan PostgreSQL berikut diterapkan: </p><br><pre><code class="plaintext hljs">shared_buffers = '64GB' work_mem = '1GB' random_page_cost = '1' maintenance_work_mem = '2GB' synchronous_commit = 'on' seq_page_cost = '1' max_wal_size = '100GB' checkpoint_timeout = '10min' synchronous_commit = 'on' checkpoint_completion_target = '0.9' autovacuum_vacuum_scale_factor = '0.4' effective_cache_size = '200GB' min_wal_size = '1GB' wal_compression = 'ON'</code> </pre> <br><h3 id="shema-testirovaniya">  Skema pengujian </h3><br><p>  Skema pengujian memainkan peran penting.  Semua tes dilakukan tiga kali, durasi setiap lari adalah 30 menit.  Berdasarkan hasil dari 3 tes ini, saya menyimpulkan nilai rata-rata.  Pengujian dilakukan dengan menggunakan alat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pgbench</a> PostgreSQL, ia bekerja dengan faktor penskalaan dalam penambahan sekitar 16 MB beban. </p><br><h3 id="hugepages">  Hugepages </h3><br><p>  Secara default, Linux menggunakan halaman memori 4K, serta teknologi HugePages.  BSD menggunakan teknologi Super Pages, dan Windows menggunakan Large Pages.  PostgreSQL hanya mendukung teknologi HugePages (Linux).  Dalam kasus di mana jumlah memori yang digunakan besar, halaman yang lebih kecil mengurangi kinerja.  Menggunakan HugePages, Anda meningkatkan memori yang dialokasikan untuk aplikasi dan, karenanya, mengurangi "overhead" yang terjadi selama proses alokasi / swapping.  Dengan demikian, HugePages meningkatkan produktivitas. </p><br><p>  Berikut adalah pengaturan untuk ukuran HugePages 1 GB.  Informasi ini tersedia kapan saja menggunakan / proc. </p><br><pre> <code class="plaintext hljs">AnonHugePages:     0 kB ShmemHugePages:    0 kB HugePages_Total:   100 HugePages_Free:    97 HugePages_Rsvd:    63 HugePages_Surp:    0 Hugepagesize:  1048576 kB</code> </pre> <br><p>  Saya menulis lebih banyak tentang HugePages di posting sebelumnya. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://www.percona.com/blog/2018/08/29/tune-linux-kernel-parameters-for-postgresql-optimization/</a> </p><br><p>  Secara umum, HugePages berukuran 2 MB dan 1 GB, jadi masuk akal untuk menggunakan 1 GB. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/performance_tuning_guide/s-memory-transhuge</a> </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://kerneltalks.com/services/what-is-huge-pages-in-linux/</a> </p><br><h3 id="rezultaty-testirovaniya">  Hasil tes </h3><br><p>  Tes ini menunjukkan efek keseluruhan menggunakan HugePages dari berbagai ukuran.  Suite tes pertama dibuat dengan ukuran halaman 4K - digunakan secara default di Linux - dan tanpa aktivasi HugePages.  Biarkan saya mengingatkan Anda: Saya menonaktifkan opsi HugePages Transparan untuk seluruh durasi tes. </p><br><p>  Kemudian serangkaian tes kedua dilakukan untuk HugePages dengan ukuran 2 MB.  Akhirnya, serangkaian tes ketiga dijalankan untuk 1GB HugePages. </p><br><p>  Untuk semua tes komparatif, PostgreSQL DBMS 11 digunakan. Kit mencakup kombinasi berbagai ukuran database dan berbagai klien.  Grafik di bawah ini menunjukkan hasil perbandingan kinerja menggunakan tes ini: TPS (jumlah transaksi per detik) - sepanjang sumbu Y, dan ukuran basis data dan jumlah klien untuk database dengan ukuran tertentu - di sepanjang sumbu X. </p><br><p> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/d72/a5e/0fa/d72a5e0fa05b8774fe82874c8832d048.png" alt="gambar"></a> </p><br><p>  Dari grafik di atas, dapat dilihat bahwa, dari penggunaan HugePages, keuntungan bertambah ketika jumlah pelanggan dan ukuran basis data meningkat, selama ukuran ini tetap dalam buffer bersama yang dialokasikan sebelumnya. </p><br><p>  Tes ini membandingkan TPS dan jumlah pelanggan.  Dalam hal ini, ukuran basis data adalah 48 GB.  Sumbu Y menunjukkan TPS, dan sumbu X menunjukkan jumlah klien yang terhubung.  Ukuran basis data cukup kecil untuk muat dalam buffer bersama dengan ukuran tetap 64 GB. </p><br><p> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/5d9/dd6/a4b/5d9dd6a4b647b25ef7edde3928276e7d.png" alt="gambar"></a> </p><br><p>  Ketika HugePages berukuran 1 GB, peningkatan kinerja komparatif meningkat dengan jumlah pelanggan. </p><br><p>  Grafik berikutnya adalah sama dengan yang sebelumnya, tetapi ukuran database adalah 96 GB.  Ini lebih besar dari ukuran buffer total tetap 64 GB. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/z8/6r/je/z86rjeljjqfr_nyaylzzpv7xf9q.png"></a> </p><br><p>  Hal utama yang perlu diperhatikan di sini: kinerja dengan HugePages sebesar 1 GB meningkat karena jumlah pelanggan meningkat dan pada akhirnya memberikan kinerja yang lebih baik daripada menggunakan HugePages sebesar 2 MB atau halaman 4 KB standar. </p><br><p>  Tes ini menunjukkan rasio TPS terhadap ukuran basis data.  Dalam hal ini, jumlah klien yang terhubung adalah 32. Pada sumbu Y, TPS ditampilkan, dan pada sumbu X, ukuran basis data. </p><br><p> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/c93/228/0c2/c932280c2a1becc89eacd56de3fefaff.png" alt="gambar"></a> </p><br><p>  Seperti yang diharapkan, ketika ukuran database melebihi ukuran HugePages yang telah dialokasikan sebelumnya, kinerja berkurang secara signifikan. </p><br><h3 id="zaklyuchenie">  Kesimpulan </h3><br><p>  Salah satu rekomendasi utama saya adalah menonaktifkan Transparent HugePages.  Anda akan mendapatkan peningkatan kinerja terbesar jika basis data ditempatkan dalam buffer bersama dengan HugePages diaktifkan.  Ukuran optimal HugePages ditentukan oleh coba-coba, tetapi berpotensi pendekatan ini dapat mengarah pada peningkatan signifikan dalam TPS, ketika ukuran basis data cukup besar, tetapi pada saat yang sama memungkinkannya untuk masuk dalam buffer umum. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id435558/">https://habr.com/ru/post/id435558/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id435546/index.html">Kiat Praktis, Contoh, dan Terowongan SSH</a></li>
<li><a href="../id435548/index.html">Meretas layanan publik - mungkin, jika benar-benar diperlukan</a></li>
<li><a href="../id435550/index.html">GitLab 11.6 dirilis dengan fitur serverless dan cluster Kubernetes untuk grup</a></li>
<li><a href="../id435552/index.html">Substitusi impor - epitaf dari digitalisasi</a></li>
<li><a href="../id435556/index.html">Pindah ke pusat data: bagaimana itu</a></li>
<li><a href="../id435560/index.html">Komputer Quantum Komersial Pertama - IBM</a></li>
<li><a href="../id435562/index.html">Jalan seorang perokok: bagaimana memasuki profesi seorang programmer, jika Anda seorang humanis</a></li>
<li><a href="../id435564/index.html">Menggunakan GtkApplication. Fitur rendering Librsvg</a></li>
<li><a href="../id435568/index.html">Router OpenSource VyOS</a></li>
<li><a href="../id435572/index.html">Anycubic i3 Mega: pembuatan ulang kualitas Prusa i3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>