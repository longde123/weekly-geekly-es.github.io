<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåö üìê üåÄ Administrar el estado con React Hooks - Sin API Redux y Context üíº üéôÔ∏è üë®üèª‚Äçüéì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! Mi nombre es Arthur, trabajo en VKontakte como un equipo web m√≥vil, estoy involucrado en el proyecto VKUI , una biblioteca de componente...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Administrar el estado con React Hooks - Sin API Redux y Context</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vk/blog/454348/">  Hola a todos!  Mi nombre es Arthur, trabajo en VKontakte como un equipo web m√≥vil, estoy involucrado en el proyecto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">VKUI</a> , una biblioteca de componentes React, con la ayuda de la cual se escriben algunas de nuestras interfaces en aplicaciones m√≥viles.  La cuesti√≥n de trabajar con un estado global todav√≠a est√° abierta para nosotros.  Existen varios enfoques bien conocidos: Redux, MobX, Context API.  Recientemente me encontr√© con un art√≠culo de Andr√© Gardi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">State Management con React Hooks - No Redux o Context API</a> , en el que el autor sugiere usar React Hooks para controlar el estado de la aplicaci√≥n. <br><br>  Los ganchos est√°n entrando r√°pidamente en la vida de los desarrolladores, ofreciendo nuevas formas de resolver o repensar diferentes tareas y enfoques.  Cambian nuestra comprensi√≥n no solo de c√≥mo describir componentes, sino tambi√©n de c√≥mo trabajar con datos.  Lea la traducci√≥n del art√≠culo y el comentario del traductor debajo del gato. <br><br><img src="https://habrastorage.org/webt/_t/kp/9x/_tkp9x7oiiowebtqtcvbhlblydo.jpeg" alt="imagen"><br><a name="habracut"></a><br><h2>  Los ganchos de reacci√≥n son m√°s poderosos de lo que piensas </h2><br>  Hoy estudiaremos React Hooks y desarrollaremos un hook personalizado para administrar el estado global de la aplicaci√≥n, que ser√° m√°s simple que la implementaci√≥n de Redux y m√°s productivo que la API Context. <br><br><h3>  Conceptos b√°sicos de React Hooks </h3><br>  Puede omitir esta parte si ya est√° familiarizado con los ganchos. <br><br><h4>  useState () </h4><br>  Antes de la aparici√≥n de los ganchos, los componentes funcionales no ten√≠an la capacidad de establecer un estado local.  La situaci√≥n ha cambiado con la llegada de <code>useState()</code> . <br><br><img src="https://habrastorage.org/webt/eh/uc/_k/ehuc_krferg3j4eccjos_rkf_fq.jpeg"><br><br>  Esta llamada devuelve una matriz.  Su primer elemento es una variable que proporciona acceso al valor de estado.  El segundo elemento es una funci√≥n que actualiza el estado y vuelve a dibujar el componente para reflejar los cambios. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { useState } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Example</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [state, setState] = useState({<span class="hljs-attr"><span class="hljs-attr">counter</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> add1ToCounter = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newCounterValue = state.counter + <span class="hljs-number"><span class="hljs-number">1</span></span>; setState({ <span class="hljs-attr"><span class="hljs-attr">counter</span></span>: newCounterValue}); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">You clicked {state.counter} times</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{add1ToCounter}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Click me </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }</code> </pre><br><h4>  useEffect () </h4><br>  Los componentes de la clase responden a los efectos secundarios utilizando m√©todos de ciclo de vida como <code>componentDidMount()</code> .  El gancho <code>useEffect()</code> permite hacer lo mismo en componentes funcionales. <br><br>  Por defecto, los efectos se activan despu√©s de cada redibujado.  Pero puede asegurarse de que se ejecuten solo despu√©s de cambiar los valores de variables espec√≠ficas, pas√°ndoles el segundo par√°metro opcional en forma de matriz. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     useEffect(() =&gt; { console.log('     '); }); //    useEffect(() =&gt; { console.log('     valueA'); }, [valueA]);</span></span></code> </pre><br>  Para lograr un resultado similar a <code>componentDidMount()</code> , pasaremos una matriz vac√≠a al segundo par√°metro.  Como el contenido de una matriz vac√≠a siempre permanece sin cambios, el efecto se ejecutar√° solo una vez. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     useEffect(() =&gt; { console.log('    '); }, []);</span></span></code> </pre><br><h3>  Estado compartido </h3><br>  Vimos que un estado de enlace funciona igual que un estado de componente de clase.  Cada instancia de componente tiene su propio estado interno. <br><br>  Para compartir el estado entre los componentes, crearemos nuestro propio gancho. <br><br><img src="https://habrastorage.org/webt/hp/lw/ke/hplwkebnp9jtdu7vywj5phhsndi.jpeg"><br><br>  La idea es crear una variedad de oyentes y un solo estado.  Cada vez que un componente cambia de estado, todos los componentes suscritos llaman a su <code>getState()</code> y se actualizan debido a esto. <br><br>  Podemos lograr esto llamando a <code>useState()</code> dentro de nuestro <code>useState()</code> personalizado.  Pero en lugar de devolver la funci√≥n <code>setState()</code> , la agregamos a la matriz de oyentes y devolvemos una funci√≥n que actualiza internamente el objeto de estado y llama a todos los oyentes. <br><br><h4>  Espera un momento  ¬øC√≥mo me facilita la vida? </h4><br>  Si tienes razon.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cre√©</a> un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">paquete NPM</a> que encapsula toda la l√≥gica descrita. <br><br>  No tiene que implementarlo en cada proyecto.  Si ya no desea pasar tiempo leyendo y desea ver el resultado final, simplemente agregue este paquete a su aplicaci√≥n. <br><br><pre> <code class="plaintext hljs">npm install -s use-global-hook</code> </pre> <br>  Para comprender c√≥mo trabajar con un paquete, estudie ejemplos en la documentaci√≥n.  Y ahora propongo centrarme en c√≥mo se organiza el paquete por dentro. <br><br><h3>  Primera versi√≥n </h3><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState, useEffect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> listeners = []; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> state = { <span class="hljs-attr"><span class="hljs-attr">counter</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> setState = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newState</span></span></span><span class="hljs-function">) =&gt;</span></span> { state = { ...state, ...newState }; listeners.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">listener</span></span></span><span class="hljs-function">) =&gt;</span></span> { listener(state); }); }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> useCustom = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newListener = useState()[<span class="hljs-number"><span class="hljs-number">1</span></span>]; useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { listeners.push(newListener); }, []); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [state, setState]; }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> useCustom;</code> </pre><br><h4>  Uso en componente </h4><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> useCustom <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./customHook'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Counter = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [globalState, setGlobalState] = useCustom(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> add1Global = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newCounterValue = globalState.counter + <span class="hljs-number"><span class="hljs-number">1</span></span>; setGlobalState({ <span class="hljs-attr"><span class="hljs-attr">counter</span></span>: newCounterValue }); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> counter: {globalState.counter} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{add1Global}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> +1 to global </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Counter;</code> </pre><br>  Esta versi√≥n ya proporciona el estado de compartir.  Puede agregar un n√∫mero arbitrario de contadores a su aplicaci√≥n, y todos tendr√°n un estado global com√∫n. <br><br><h3>  Pero podemos hacerlo mejor </h3><br>  Que quieres <br><br><ul><li>  eliminar el oyente de la matriz al desmontar el componente; </li><li>  hacer el gancho m√°s abstracto para usar en otros proyectos; </li><li>  gestionar <code>initialState</code> usando par√°metros; </li><li>  reescribe el gancho en un estilo m√°s funcional. </li></ul><br><h4>  Llamar a una funci√≥n justo antes de desmontar un componente </h4><br>  Ya descubrimos que llamar a <code>useEffect(function, [])</code> con una matriz vac√≠a funciona de la misma manera que <code>componentDidMount()</code> .  Pero si la funci√≥n pasada en el primer par√°metro devuelve otra funci√≥n, entonces se llamar√° a la segunda funci√≥n justo antes de desmontar el componente.  Exactamente igual que <code>componentWillUnmount()</code> . <br><br>  Entonces, en el c√≥digo de la segunda funci√≥n, puede escribir la l√≥gica para eliminar un componente de una matriz de oyentes. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> useCustom = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newListener = useState()[<span class="hljs-number"><span class="hljs-number">1</span></span>]; useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     listeners.push(newListener); return () =&gt; { //     listeners = listeners.filter(listener =&gt; listener !== newListener); }; }, []); return [state, setState]; };</span></span></code> </pre><br><h3>  Segunda versi√≥n </h3><br>  Adem√°s de esta actualizaci√≥n, tambi√©n planeamos: <br><br><ul><li>  pasar el par√°metro React y deshacerse de la importaci√≥n; </li><li>  export no customHook, sino una funci√≥n que devuelve customHook con el <code>initalState</code> dado; </li><li>  crear un objeto de <code>store</code> que contendr√° el valor de <code>state</code> y la funci√≥n <code>setState()</code> ; </li><li>  reemplace las funciones de flecha con las habituales en <code>setState()</code> y <code>useCustom()</code> para que pueda asociar la <code>store</code> con <code>this</code> . </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newState</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = { ...this.state, ...newState }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">listener</span></span></span><span class="hljs-function">) =&gt;</span></span> { listener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useCustom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">React</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newListener = React.useState()[<span class="hljs-number"><span class="hljs-number">1</span></span>]; React.useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     this.listeners.push(newListener); return () =&gt; { //     this.listeners = this.listeners.filter(listener =&gt; listener !== newListener); }; }, []); return [this.state, this.setState]; } const useGlobalHook = (React, initialState) =&gt; { const store = { state: initialState, listeners: [] }; store.setState = setState.bind(store); return useCustom.bind(store, React); }; export default useGlobalHook;</span></span></code> </pre><br><h3>  Separar acciones de componentes </h3><br>  Si alguna vez trabaj√≥ con bibliotecas de administraci√≥n de estado complejas, entonces sabe que manipular un estado global a partir de componentes no es una buena idea. <br><br>  Ser√≠a m√°s correcto separar la l√≥gica de negocios creando acciones para cambiar el estado.  Por lo tanto, quiero que la √∫ltima versi√≥n del paquete proporcione acceso a los componentes no a <code>setState()</code> , sino a un conjunto de acciones. <br><br>  Para hacer esto, proporcionamos nuestro <code>useGlobalHook(React, initialState, actions)</code> tercer argumento.  Solo quiero agregar un par de comentarios. <br><br><ul><li>  Las acciones tendr√°n acceso a la <code>store</code> .  De esta forma, las acciones pueden leer el contenido de <code>store.state</code> , actualizar el <code>store.setState()</code> llamando a <code>store.setState()</code> e incluso llamar a otras <code>store.actions</code> . </li><li>  Para evitar problemas, el objeto de acci√≥n puede contener subobjetos.  Por lo tanto, puede transferir <code>actions.addToCounter(amount</code> ) a un subobjeto con todas las acciones de contador: <code>actions.counter.add(amount)</code> . </li></ul><br><h3>  Versi√≥n final </h3><br>  El siguiente fragmento es la versi√≥n actual del paquete NPM <code>use-global-hook</code> . <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newState</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = { ...this.state, ...newState }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">listener</span></span></span><span class="hljs-function">) =&gt;</span></span> { listener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useCustom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">React</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newListener = React.useState()[<span class="hljs-number"><span class="hljs-number">1</span></span>]; React.useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners.push(newListener); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners.filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">listener</span></span></span><span class="hljs-function"> =&gt;</span></span> listener !== newListener); }; }, []); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.actions]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">associateActions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">store, actions</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> associatedActions = {}; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(actions).forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> actions[key] === <span class="hljs-string"><span class="hljs-string">'function'</span></span>) { associatedActions[key] = actions[key].bind(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, store); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> actions[key] === <span class="hljs-string"><span class="hljs-string">'object'</span></span>) { associatedActions[key] = associateActions(store, actions[key]); } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> associatedActions; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> useGlobalHook = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">React, initialState, actions</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = { <span class="hljs-attr"><span class="hljs-attr">state</span></span>: initialState, <span class="hljs-attr"><span class="hljs-attr">listeners</span></span>: [] }; store.setState = setState.bind(store); store.actions = associateActions(store, actions); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> useCustom.bind(store, React); }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> useGlobalHook;</code> </pre><br><h3>  Ejemplos de uso </h3><br>  Ya no tiene que lidiar con <code>useGlobalHook.js</code> .  Ahora puede concentrarse en su aplicaci√≥n.  Los siguientes son dos ejemplos de uso del paquete. <br><br><h4>  M√∫ltiples contadores, un valor </h4><br>  Agregue tantos contadores como desee: todos tendr√°n un valor global.  Cada vez que uno de los contadores incremente el estado global, todos los dem√°s ser√°n redibujados.  En este caso, el componente padre no necesita volver a dibujar. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Vivir ejemplo</a> . <br><br><h4>  Solicitudes asincr√≥nicas ajax </h4><br>  Buscar repositorios de GitHub por nombre de usuario.  Procesamos solicitudes ajax de forma asincr√≥nica usando async / await.  Actualizamos el contador de consultas con cada nueva b√∫squeda. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Vivir ejemplo</a> . <br><br><h3>  Bueno eso es todo </h3><br>  Ahora tenemos nuestra propia biblioteca de administraci√≥n de estado en React Hooks. <br><br><h3>  Comentario del traductor </h3><br>  La mayor√≠a de las soluciones existentes son esencialmente bibliotecas separadas.  En este sentido, el enfoque descrito por el autor es interesante en el sentido de que utiliza solo las funciones integradas de React.  Adem√°s, en comparaci√≥n con la misma API de contexto, que tambi√©n viene de f√°brica, este enfoque reduce el n√∫mero de redibujos innecesarios y, por lo tanto, gana en rendimiento. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/454348/">https://habr.com/ru/post/454348/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../454332/index.html">C√≥mo Telegram bot super√≥ la dilaci√≥n de los dise√±adores y ayud√≥ a aumentar los ingresos de las agencias digitales</a></li>
<li><a href="../454334/index.html">Moto Weep AWS</a></li>
<li><a href="../454336/index.html">Cliente: - ¬øCu√°nto cuesta una copia de Facebook?</a></li>
<li><a href="../454340/index.html">% tutnazvanievu% es la primera universidad del mundo donde se desarrollan oficialmente mochilas propulsoras</a></li>
<li><a href="../454346/index.html">Algoritmos de eficiencia: revisi√≥n de la c√°mara de vigilancia Nobelic 2019</a></li>
<li><a href="../454352/index.html">Incertidumbres Matem√°ticas en Python</a></li>
<li><a href="../454354/index.html">Pasant√≠a en JetBrains y c√≥mo casi pude conseguirlo</a></li>
<li><a href="../454356/index.html">Habr Weekly # 3 / Runet vs TV, ARM vs Intel, unificaci√≥n de datos estatales, sin un tel√©fono inteligente en 2019, sue√±os sovi√©ticos del futuro</a></li>
<li><a href="../454366/index.html">Victoria en PHDays 9. Compartimos hacks de vida en tres partes. Parte 2</a></li>
<li><a href="../454368/index.html">Competencia de desarrolladores de complementos de TeamCity</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>