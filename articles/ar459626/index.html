<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐บ ๐ถ๐ฟ ๐ผ ูุฑูู ุฅุนูุงู Windows: ุณุทุญ ุงููุฌูู ุงูุฃูุซุฑ ููุซูุฉ ๐คด๐ป ๐ฉ๐ปโ๐ซ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุชุญุช ุงููุตุงุตุฉ ูู ุชุฑุฌูุฉ ููุนุฑุถ ุงูุชูุฏููู "ูุฑูู ุฅุนูุงู Windows: ุณุทุญ ูุฌูู ุงูููุงุฉ ุบูุฑ ุงูููุซู" ุงูููุฏู ูู Alex Ionescu ู Gabrielle Viala ูู ูุคุชูุฑ BlackHat 2018 ....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูุฑูู ุฅุนูุงู Windows: ุณุทุญ ุงููุฌูู ุงูุฃูุซุฑ ููุซูุฉ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459626/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุชุญุช ุงููุตุงุตุฉ ูู ุชุฑุฌูุฉ <strong>ููุนุฑุถ ุงูุชูุฏููู</strong> "ูุฑูู ุฅุนูุงู Windows: ุณุทุญ ูุฌูู ุงูููุงุฉ ุบูุฑ ุงูููุซู" ุงูููุฏู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Alex Ionescu</a> ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Gabrielle Viala</a> ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุคุชูุฑ BlackHat 2018</a> . <br><img src="https://habrastorage.org/webt/ja/q7/pl/jaq7plcphybdtfljwzxxdryln8q.png"><img src="https://habrastorage.org/webt/fi/sw/fe/fiswfev1j4ndustfitqdyvruxis.jpeg"></p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">ูุง ุณูุชู ููุงูุดุชู ูู ุงูููุดูุฑ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุง ูู Windows Notification Facility (WNF)</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงุฐุง ุธูุฑุช WNF</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฃุณูุงุก ุงูุฏูู WNF</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุธุงู ูุฏุนู ููุนูู ูุน WNF</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ูุถุน ุงููุณุชุฎุฏู ุนุงูู ุงููุณุชูู (ntdll)</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุงููุณุชูู ุงูุนุงูู ููููุงุฉ (ุณุงุจููุง)</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุฑุงูู ุชุญููู WNF</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">WNF ุณุทุญ ุงููุฌูู</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฃุณูุงุก ุญุงูุฉ ูุซูุฑุฉ ููุงูุชูุงู ูุญุณุงุณุฉ WNF</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุญูู ุงูุนูููุฉ ุจุงุณุชุฎุฏุงู WNF</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชูุฌููุงุช ููุฒูุฏ ูู ุงูุจุญุซ</a> </li></ul></div></div><a name="habracut"></a><br><a name="what"></a><br><h3 id="chto-takoe-windows-notification-facility-wnf" style=";text-align:right;direction:rtl">  ูุง ูู Windows Notification Facility (WNF) </h3><br><p style=";text-align:right;direction:rtl">  Windows Notification Facility ูู ุขููุฉ ุฅุนูุงู (ูุชููุฑุฉ ูู ูุถุน kernel ููู ูุถุน ุงููุณุชุฎุฏู) ุ ููู ุชุณุชูุฏ ุฅูู ูููุฐุฌ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุงุดุฑ-ุงููุดุชุฑู</a> ( <em>pubsub</em> ุ Publisher / ุงููุดุชุฑู).  ุชูุช ุฅุถุงูุฉ ุงูุขููุฉ ูู ูุธุงู ุงูุชุดุบูู Windows 8: ุฌุฒุฆููุง ูู ุฃุฌู ุญู ุจุนุถ ูููุฏ ุงูุชุตููู ุงููุฏููุฉ ูู ูุธุงู ุงูุชุดุบูู ุ ูููู ุฃูุถูุง ูุฌุจ ุฃู ุชููู ุจูุซุงุจุฉ ุฃุณุงุณ ูุชุทุจูู ุฅุนูุงูุงุช ุงูุฏูุน ุงููุดุงุจูุฉ ููุธุงู ุงูุชุดุบูู iOS / Android. </p><br><p style=";text-align:right;direction:rtl">  ุงูููุฒุฉ ุงูุฑุฆูุณูุฉ ูู ุฃูู ูููุฐุฌ <em>ุฃุนูู</em> (ูุนุธูู ุจุฏูู ุชุณุฌูู) ูุณูุญ ุจุงูุงุดุชุฑุงู ูุงููุดุฑ ุบูุฑ ุงููุฑุชุจ.  ูุฐุง ูุนูู ุฃูู ูููู ูููุณุชููู ุงูุงุดุชุฑุงู ูู ุฅุดุนุงุฑ ุญุชู ูุจู ูุดุฑ ุงูุฅุดุนุงุฑ ุจูุงุณุทุฉ ูุตุฏุฑู.  ูุฃู ุงูุดุฎุต ุงูุฐู ูููุฏ ุงูุฃุญุฏุงุซ ููุณ ูุทููุจูุง ูู "ุชุณุฌูู" ุงูุฅุดุนุงุฑ ููุฏููุง. </p><br><p style=";text-align:right;direction:rtl">  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุชุฏุนู ุงูุขููุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅุฎุทุงุฑุงุช ุฏุงุฆูุฉ ููุคูุชุฉ </li><li style=";text-align:right;direction:rtl">  ุฒูุงุฏุฉ ุฑุชุงุจุฉ ูุนุฑูุงุช ูุฑูุฏุฉ ูู ููุนูุง </li><li style=";text-align:right;direction:rtl">  ุงููุฎุฒู ุงููุคูุช ุงูุญูููุฉ (ูุตู ุฅูู 4 ูููู ุจุงูุช) ููู ุญุฏุซ </li><li style=";text-align:right;direction:rtl">  ูููุฐุฌ ุฅุนูุงู ูุคุดุฑ ุชุฑุงุจุท - ูุฌููุนุฉ ูุน ุงูุชุณูุณู ุงููุณุชูุฏุฉ ุฅูู ุงููุฌููุนุฉ </li><li style=";text-align:right;direction:rtl">  ูููุฐุฌ ุฃูุงู ูุณุชูุฏ ุฅูู ูุทุงู ูููู ุจุชุทุจูู ูุงุตูุงุช ุงูุฃูุงู ูู ุฎูุงู ุขููุฉ <abbr title="ูุงุฆูุฉ ุงูุชุญูู ุจุงููุตูู ุงูุชูุฏูุฑูุฉ">DACL</abbr> / <abbr title="ูุงุฆูุฉ ุงูุชุญูู ูู ุงููุตูู ุฅูู ุงููุธุงู">SACL</abbr> ุงูููุงุณูุฉ </li></ul><br><a name="why"></a><br><h3 id="pochemu-poyavilsya-wnf" style=";text-align:right;direction:rtl">  ููุงุฐุง ุธูุฑุช WNF </h3><br><p style=";text-align:right;direction:rtl">  ููุฑ ูู ูุซุงู ูุงูููู: ููุฌุฏ ุจุฑูุงูุฌ ุชุดุบูู ูุฑูุฏ ุฃู ูุนุฑู ุฃูู ูุฏ ุชู ุชูุตูู ูุญุฏุฉ ุชุฎุฒูู ูุน ูุตูู ูููุฑุงุกุฉ ูุงููุชุงุจุฉ.  ูุฅุนูุงูู ุจูุฐุง ุ ูุจูุบ Autochk (ุชูุงุธุฑูุฉ <abbr title="ูุญุต ุงุชุณุงู ูุธุงู ุงููููุงุช">fsck</abbr> ุนูู Windows) ุนู ุญุฏุซ ูุณูู VolumesSafeForWriteAccess.  ูููู ูู ุฃุฌู ุงูุฅุจูุงุบ ุนู ุญุฏุซ ุ ูุฌุจ ุนููู ุฃููุงู ุฅูุดุงุก ูุงุฆู ุงูุญุฏุซ ููุณู. </p><br><p style=";text-align:right;direction:rtl">  ูุญุชุงุฌ ุฃูุถูุง ุฅูู ูุนุฑูุฉ ุฃู Autochk ูุนูู ุจุงููุนู ุนูู ูุญุฏุฉ ุงูุชุฎุฒูู ุ ูููู ูู ูุดุฑ ุจุนุฏ ุฅูู ุงูุญุฏุซ ุงูุฐู ููุชุธุฑู.  ุญู ุบูุฑ ุตุญูุญ: ุงูุฌููุณ ูู ุญููุฉ ูุน ูุถุน ุงูุณููู () ุ ูุงูุชุญูู ูู ูุฌูุฏ ุญุฏุซ ุ ูุนูุฏูุง ูุชู ุฅูุดุงุก ุงูุญุฏุซ - ุงูุชุธุฑู. </p><br><p style=";text-align:right;direction:rtl">  ูููู ุจุนุฏ ุงูุฎุฑูุฌ ูู ุชุทุจูู Windows ุ ูุชู ุฅุบูุงู ุฌููุน ุงููุงุตูุงุช ุงูุฎุงุตุฉ ุจู.  ูุนูุฏูุง ูุง ูุญุชูู ุงููุงุฆู ุนูู ูุงุตูุงุช ุ ูุชู ุชุฏููุฑู.  ููู ุงูุฐู ุณูุนูุฏ ูุฐุง ุงูุญุฏุซุ </p><br><p style=";text-align:right;direction:rtl">  ุจุฏูู WNF ุ ูููู ุงูุญู ูู ููุงู kernel OS ุจุฅูุดุงุก ุญุฏุซ ูุจู ุชุญููู ุฃู ูู ุจุฑุงูุฌ ุงูุชุดุบูู ุ ูููู ูููู Autochk ุจูุชุญู ููุง ููุนู ุงููุณุชููู ุ ูููู ุจุฏูุงู ูู ุงูุงูุชุธุงุฑ ุ ูุฌุจ ุฃู ูุดูุฑ ุฅูู ูุฐุง ุงูุญุฏุซ. </p><br><a name="state_name"></a><br><h3 id="imena-sostoyaniy-state-names-wnf" style=";text-align:right;direction:rtl">  ุฃุณูุงุก ุงูุฏูู WNF </h3><br><p style=";text-align:right;direction:rtl">  ูู ุนุงูู WNF ุ ุงุณู ุงูููุงูุฉ ูู ุฑูู 64 ุจุช.  ูููู ููุงู ุฎุฏุนุฉ - ูู ุงููุงูุน ูู ุจููุฉ ูุดูุฑุฉ.  ูุญุชูู ุงุณู ุงูุญุงูุฉ ุนูู <em>ุฅุตุฏุงุฑ</em> <em>ูุนูุฑ</em> <em>ููุทุงู</em> <em>ูุนูุงูุฉ ุซุจุงุช ุงูุจูุงูุงุช</em> <em>ูุฑูู ุชุณูุณูู ูุฑูุฏ</em> . </p><br><pre style=";text-align:right;direction:rtl"><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WNF_STATE_NAME_INTERNAL</span></span></span><span class="hljs-class"> {</span></span> ULONG64 Version:<span class="hljs-number"><span class="hljs-number">4</span></span>; ULONG64 NameLifetime:<span class="hljs-number"><span class="hljs-number">2</span></span>; ULONG64 DataScope:<span class="hljs-number"><span class="hljs-number">4</span></span>; ULONG64 PermanentData:<span class="hljs-number"><span class="hljs-number">1</span></span>; ULONG64 Unique:<span class="hljs-number"><span class="hljs-number">53</span></span>; } WNF_STATE_NAME_INTERNAL, *PWNF_STATE_NAME_INTERNAL;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููู ูุฐู ุงูุจูุงูุงุช ูู ุชููู ูุชุงุญุฉ ุฅูุง ุฅุฐุง ููุง ูุคูุฏ XOR ุฑูู 64 ุจุช ูุน ุซุงุจุช ุซุงุจุช: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> WNF_STATE_KEY 0x41C64E6DA3BC0074</span></span></code> </pre> <br><a name="lifetime"></a><br><h4 id="vremya-zhizni-lifetime-imeni-sostoyaniya" style=";text-align:right;direction:rtl">  ุนูุฑ ุงุณู ุงูููุงูุฉ </h4><br><p style=";text-align:right;direction:rtl">  ูููู ุฃู ูููู ุงุณู ุญุงูุฉ WNF (WNF_STATE_NAME_LIFETIME): </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุนุฑูู (ูุนุฑููุฉ) </li><li style=";text-align:right;direction:rtl">  ุงูุนุงุฏูุฉ (ุฏุงุฆูุฉ) </li><li style=";text-align:right;direction:rtl">  ูุณุชูุฑุฉ (ูุณุชูุฑ) </li><li style=";text-align:right;direction:rtl">  ูุคูุชุฉ (ูุคูุช) </li></ul><br><p style=";text-align:right;direction:rtl">  ุชุฑุชุจุท ุงูุซูุงุซุฉ ุงูุฃููู ุจุงูููุงุชูุญ ุงูููุงุจูุฉ ูู ุงูุณุฌู ุ ุญูุซ ุณูุชู ุชุฎุฒูู ูุนูููุงุช ุงูุญุงูุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฃุณูุงุก ูุนุฑููุฉ ุชุนูุด ูู HKLM \ SYSTEM \ CurrentControlSet \ Control \ ุงูุฅุฎุทุงุฑุงุช </li><li style=";text-align:right;direction:rtl">  ุงูุฃุณูุงุก ุงููุณุชูุฑุฉ ุชุนูุด ูู HKLM \ SOFTWARE \ Microsoft \ Windows NT \ CurrentVersion \ Notifications </li><li style=";text-align:right;direction:rtl">  ุงูุฃุณูุงุก ุงููุณุชูุฑุฉ ุชุนูุด ูู HKLM \ SOFTWARE \ Microsoft \ Windows NT \ CurrentVersion \ VolatileNotifications </li></ul><br><p style=";text-align:right;direction:rtl">  ุงูุฃุณูุงุก ุงููุนุฑููุฉ ููุง ุฎุตูุตูุฉ ุฎุงุตุฉ ุจูุง: ูุง ูููู ุชุณุฌูููุง.  ูุฌุจ ุชูุฏูู ูุฐุง ุงูุงุณู ุจุงููุนู ูู ุงูุณุฌู ููุช ุจุฏุก ุชุดุบูู ุงููุธุงู.  ุชุชุทูุจ ุงูุฃุณูุงุก ุงููุณุชูุฑุฉ ูุงูุซุงุจุชุฉ ุงูุชูุงุฒ SeCreatePermanentPrivilege ุงููุถููู (ูุซู ุงููุงุฆูุงุช ุงูุนุงูุฉ ุงูุฃุฎุฑู) ูุฅูุดุงุฆูุง.  ุงูุฃุณูุงุก ุงูุฏุงุฆูุฉ ุชุนูุด ุฎุงุฑุฌ ุนูููุฉ ุงููุณุฌู ุ ุจูููุง ุชุธู ุงูุฃุณูุงุก ุงูุฏุงุฆูุฉ ุนูููุฉ ุฅุนุงุฏุฉ ุชูููุฏ ูููุธุงู. </p><br><a name="scope"></a><br><h4 id="oblast-vidimosti-scope-dannyh" style=";text-align:right;direction:rtl">  ูุทุงู ุงูุจูุงูุงุช </h4><br><p style=";text-align:right;direction:rtl">  ูุนุฑูู ูุทุงู ุงูุจูุงูุงุช ุญุฏูุฏ ุงูุฃูุงู ุงูุฃููู ุญูู ุงุณู ุญุงูุฉ WNF ุ ููู ูุญุฏุฏ ูู ูุฑุงู ููู ูุฏูู ุญู ุงููุตูู ุฅููู.  ูููู ุฃู ูููู ูุทุงู ุงุณู ุงูููุงูุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงููุธุงู </li><li style=";text-align:right;direction:rtl">  ุงูุณูุงุฑุฉ </li><li style=";text-align:right;direction:rtl">  ุฌูุณุฉ ุงููุณุชุฎุฏู </li><li style=";text-align:right;direction:rtl">  ุงููุณุชุฎุฏู </li><li style=";text-align:right;direction:rtl">  ูุฐู ุงูุนูููุฉ </li></ul><br><p style=";text-align:right;direction:rtl">  ุจุงูุฅุถุงูุฉ ุฅูู ุชูููุฑ ุญุฏูุฏ ุงูุฃูุงู ุ ูููู ุงุณุชุฎุฏุงู ูุทุงูุงุช WNF ูุชูููุฑ ูุซููุงุช ูุฎุชููุฉ ูู ุงูุจูุงูุงุช ุจููุณ ุงูุงุณู.  ูุชุฌุงูุฒ kernel (ููุง ูู ุงูุญุงู ูุน ุขููุงุช ุงูุฃูุงู ุงูุฃุฎุฑู) ุงุฎุชุจุงุฑุงุช ุงููุตูู ุฅูู ุงูุญุงูุฉ.  ูุณูุญ ุงูุชูุงุฒ TCB ุจุงููุตูู ุนุจุฑ ุงููุทุงู ุฅูู ุฃุณูุงุก ุญุงูุฉ WNF. </p><br><p style=";text-align:right;direction:rtl">  ูุทุงู "ุงููุธุงู" ููุทุงู "ุงูุขูุฉ" ูุทุงูุงู ุนุงูููุงู.  ููุณ ูุฏููู ูุนุฑูุงุช ุฎุงุตุฉ ุจูู (ูุณุชุฎุฏููู ุญุงููุงุช ุนุงูููุฉ ูุฎุชููุฉ).  ูุณุชุฎุฏู ูุทุงู ุฌูุณุฉ ุงููุณุชุฎุฏู ูุนุฑู ุงูุฌูุณุฉ (ูุนุฑู ุงูุฌูุณุฉ) ููุนุฑูู.  ูุณุชุฎุฏู ูุทุงู ูุณุชุฎุฏู ูุนูู ูุนุฑู ุงูุฃูุงู ูุฐุง ุงููุณุชุฎุฏู ููุนุฑู.  ุนููุงู ูุงุฆู EPROCESS ูู ูุนุฑู ูุทุงู ุงูุนูููุฉ. </p><br><a name="sequence"></a><br><h4 id="poryadkovye-nomera-sequence-numbers" style=";text-align:right;direction:rtl">  ุฃุฑูุงู ุงูุชุณูุณู </h4><br><p style=";text-align:right;direction:rtl">  ูุถูุงู ุงูุชูุฑุฏ ุ ูุญุชูู ูู ุงุณู ููุงูุฉ ุนูู ุฑูู ุชุณูุณูู ูุฑูุฏ ูู 51 ุจุช.  ุชุชุถูู ุงูุฃุณูุงุก ุงููุนุฑููุฉ ุนูุงูุฉ ุนุงุฆูุฉ ููููุฉ ูู 4 ุฃุญุฑู ูู ุฑูููุง ุงูุชุณูุณูู ุ ููุชู ุงุณุชุฎุฏุงู ุงูุจุชุงุช ุงูู 21 ุงููุชุจููุฉ ููุนุฑูู ูุฑูุฏ.  ุฃุณูุงุก ุฏุงุฆูุฉ ุจุชุฎุฒูู ุนุฏุฏ ูุชุฒุงูุฏ ูุน ูููุฉ ุงูุชุณุฌูู "SequenceNumber".  ุชุณุชุฎุฏู ุงูุฃุณูุงุก ุงูุซุงุจุชุฉ ูุงููุคูุชุฉ ุนุฏุงุฏ ุฒูุงุฏุฉ ุดุงุฆุน ุ ูุงูุฐู ููุน ูู ูุชุบูุฑ ุนูููู.  ูุชู ุชุฎุฒูู ูุฐู ุงูุจูุงูุงุช ููุนุงูุฌุชูุง ุจุดูู ูููุตู ููู ุญุงููุฉ (ููู ุตููุนุฉ) ุ ูุชุชููุฑ ูู PspHostSiloGlobals-&gt; WnfSiloState. </p><br><p style=";text-align:right;direction:rtl">  ุฏุงุฎู Microsoft ุ ูุญุชูู ูู ุงุณู WNF ุนูู ูุนุฑู "ูุฃููู" ููุณุชุฎุฏู ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุ ูุฃุญูุงููุง ูุชู ุชุฎุฒููู ูู ูุณุงุญุฉ ุงูุงุณู ุงูุนุงูููุฉ ุจููุณ ุงูุงุณู.  ุนูู ุณุจูู ุงููุซุงู ุ ุงูุฑูุฒ nt! WNF_BOOT_DIRTY_SHUTDOWN ุ ูุงูุฐู ูู ุงููููุฉ 0x1589012fa3bc0875.  ุจุนุฏ XOR ูุน ุงูุซุงุจุช ุงูุณุญุฑู <abbr title="0x41C64E6DA3BC0074">WNF_STATE_KEY</abbr> ูุญุตู ุนูู ุงููููุฉ 0x544f4f4200000801 ุ ูุงูุชู ูููู ุชูุณูุฑูุง ูู ุงุชุฌุงู bitwise ุนูู ุฃููุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">BOOT1, Well-Known Lifetime, System Scope, Version 1</code> </pre> <br><a name="syscall"></a><br><h3 id="sistemnye-vyzovy-dlya-raboty-s-wnf" style=";text-align:right;direction:rtl">  ูุธุงู ูุฏุนู ููุนูู ูุน WNF </h3><br><p style=";text-align:right;direction:rtl">  ุชุชูุญ ูู ููุงููุงุช ูุธุงู Kernel ุชุณุฌูู ูุญุฐู ุฃุณูุงุก ุญุงูุงุช WNF ุ ููุดุฑ ูุงุณุชูุจุงู ุจูุงูุงุช ุงุณู ุญุงูุฉ WNF ุ ููุฐูู ุชููู ุฅุดุนุงุฑุงุช ูุชููุนุฉ ูู WNF. </p><br><a name="register"></a><br><h4 id="registraciya-imeni-sostoyaniya-wnf" style=";text-align:right;direction:rtl">  ุชุณุฌูู ุงุณู ุญุงูุฉ WNF </h4><br><p style=";text-align:right;direction:rtl">  ุจุงุณุชุซูุงุก ุงูุฃุณูุงุก ุงููุนุฑููุฉ (ููุง ุฐูุฑ ุณุงุจููุง) ุ ูููู ุชุณุฌูู ุงุณู ุญุงูุฉ WNF ุฃุซูุงุก ุชุดุบูู ูุธุงู ุงูุชุดุบูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">NTSTATUS </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ZwCreateWnfStateName</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( _Out_ PWNF_STATE_NAME StateName, _In_ WNF_STATE_NAME_LIFETIME NameLifetime, _In_ WNF_DATA_SCOPE DataScope, _In_ BOOLEAN PersistData, _In_opt_ PCWNF_TYPE_ID TypeId, </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">//      _In_ ULONG MaximumStateSize, //   4-  _In_ PSECURITY_DESCRIPTOR SecurityDescriptor // **  );</span></span></span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุฌุฏ ูุธุงู ูุชูุงุซู ูุณูู ZwDeleteWnfStateName ูุงูุฐู ููููู ูู ุฎูุงูู ุญุฐู ุงุณู ุงูุญุงูุฉ ุงููุณุฌู (ูุฑุฉ ุฃุฎุฑู ุ ุจุงุณุชุซูุงุก ุงูุฃุณูุงุก ุงููุนุฑููุฉ). </p><br><a name="publishing"></a><br><h4 id="publikaciya-dannyh-sostoyaniya-wnf" style=";text-align:right;direction:rtl">  ูุดุฑ ุจูุงูุงุช ุญุงูุฉ WNF </h4><br><p style=";text-align:right;direction:rtl">  ูุชุนููู ุฃู ุชุบููุฑ ุจูุงูุงุช ุงุณู ุญุงูุฉ WNF ุ ููููู ุงุณุชุฎุฏุงู ุงุณุชุฏุนุงุก ูุธุงู ZwUpdateWnfStateData: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">NTSTATUS </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ZwUpdateWnfStateData</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( _In_ PCWNF_STATE_NAME StateName, _In_reads_bytes_opt_(Length) </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> VOID* Buffer, _In_opt_ ULONG Length, </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">//   ,   MaximumSize,    _In_opt_ PCWNF_TYPE_ID TypeId, //      _In_opt_ const PVOID ExplicitScope, //  , SID ,  (ID)  _In_ WNF_CHANGE_STAMP MatchingChangeStamp, //     _In_ LOGICAL CheckStamp //         );</span></span></span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุงู ูุธุงู ูุชูุงุซู ุงุณุชุฏุนุงุก ZwDeleteWnfStateData ูุญุฐู (ุชูุธูู) ุจูุงูุงุช ุงุณู ุญุงูุฉ WNF. </p><br><a name="consuming"></a><br><h4 id="poluchenie-dannyh-sostoyaniya-wnf" style=";text-align:right;direction:rtl">  ุงูุญุตูู ุนูู ุจูุงูุงุช ุญุงูุฉ WNF </h4><br><p style=";text-align:right;direction:rtl">  ูุทูุจ ุจูุงูุงุช ุงุณู ุญุงูุฉ WNF ุ ูููู ุงุณุชุฎุฏุงู ุงุณุชุฏุนุงุก ุงููุธุงู ุงูุชุงูู (ุชุดุจู ูุนุธู ุงููุนููุงุช ูุธููุฉ ุงูุชุญุฏูุซ): </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">NTSTATUS </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ZwQueryWnfStateData</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( _In_ PCWNF_STATE_NAME StateName, _In_opt_ PCWNF_TYPE_ID TypeId, _In_opt_ </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> VOID* ExplicitScope, _Out_ PWNF_CHANGE_STAMP ChangeStamp, _Out_writes_bytes_to_opt_(*BufferSize, *BufferSize) PVOID Buffer, _Inout_ PULONG BufferSize </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">//   0,      );</span></span></span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชููู ุงูููุฉ ุงูุญููููุฉ ูู ุญูููุฉ ุฃู ูุธููุชู Update ู Query API ูุง ุชุชุทูุจุงู ูู ุงููุงูุน ุงุณู ุญุงูุฉ WNF <u>ูุณุฌู</u> .  ูุฅุฐุง ูู ููู ุงูุงุณู ูุคูุชูุง (ููุงู ูุฑูุฒ ุงูุงุชุตุงู ุงูุชูุงุฒุงุช ูุงููุฉ) ุ ููููู ุชุณุฌูู ูุซูู ุงูุงุณู ูู ุงูููุช ุงููุนูู! </p><br><a name="notifications"></a><br><h4 id="uvedomleniya-wnf" style=";text-align:right;direction:rtl">  ุฅุฎุทุงุฑุงุช WNF </h4><br><p style=";text-align:right;direction:rtl">  ุญุชู ุงูุขู ุ ุงูุชุฑุถูุง ุฃู ุงููุณุชููู ูุนุฑู ูุชู ูุชู ุงุณุชุฏุนุงุก ูุธููุฉ ุงูุญุตูู ุนูู ุงูุจูุงูุงุช.  ูููู ููุงู ุฃูุถูุง <em>ุญุธุฑ ูููุฑุงุกุฉ</em> ุ ูุงูุฐู ูุนูู ุจุงุณุชุฎุฏุงู ูุธุงู ุฅุนูุงู (ููู ุฃูุฑุจ ุฅูู ูููุฐุฌ ุงููุงุดุฑ ูุงููุดุชุฑู ุงูุญูููู). </p><br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ูุฌุจ ุฃู ุชุณุฌู ุงูุนูููุฉ ุงูุญุฏุซ ุนู ุทุฑูู ุงุณุชุฏุนุงุก ุฏุงูุฉ ZwSetWnfProcessNotificationEvent.  ุซู ุชุญุชุงุฌ ุฅูู ุงุณุชุฏุนุงุก ูุธููุฉ ZwSubscribeWnfStateChange ุ ูุน ุชุญุฏูุฏ ููุงุน ุญุฏุซ ููุญุตูู ุนูู ูุนุฑู ุงูุงุดุชุฑุงู ูู ุงูุฅุฎุฑุงุฌ.  ูููู ุฃู ุชููู ุงูุฃุญุฏุงุซ ูู ููุนูู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅุดุนุงุฑุงุช ุงูุจูุงูุงุช: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  0x01 - ุธููุฑ ุงูุจูุงูุงุช </li><li style=";text-align:right;direction:rtl">  0x10 - ุชุฏููุฑ ุงูุงุณู </li></ul></li><li style=";text-align:right;direction:rtl">  ููุชุง Metanotifications <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  0x02 - ุธููุฑ ูุดุชุฑู ูุชููู ุฅุดุนุงุฑุงุช ุงูุจูุงูุงุช (ูุดุชุฑู ุงูุจูุงูุงุช) </li><li style=";text-align:right;direction:rtl">  0x04 - ุธููุฑ ูุดุชุฑู ูุณุชูุจู ุฅุดุนุงุฑุงุช ุงูุชุนุฑูู (ูุดุชุฑู ุงูุชุนุฑูู) </li><li style=";text-align:right;direction:rtl">  0x08 - ุธููุฑ ูุดุชุฑู ูุณุชูุจู ุฅุดุนุงุฑุงุช ุงูุจูุงูุงุช ูุงูุฅุดุนุงุฑุงุช ุงูููููุฉ (ูุดุชุฑู ุนุงู) </li></ul></li></ul><br><p style=";text-align:right;direction:rtl">  ุซู ุชุญุชุงุฌ ุฅูู ุงูุงูุชุธุงุฑ ููุฐุง ุงูุญุฏุซ ุงูุฐู ุชู ุชุณุฌููู.  ููู ูู ูุฑุฉ ูุตุจุญ ุงูุญุฏุซ ุฅุดุงุฑุฉ ุ ุชุญุชุงุฌ ุฅูู ุงุณุชุฏุนุงุก ูุธููุฉ ZwGetCompleteWnfStateSubscription ุ ูุงูุชู ุชูุฑุฌุน WNF_DELIVERY_DESCRIPTOR. </p><br><p style=";text-align:right;direction:rtl">  ููู ูุธุงุฆู API ููุฎูุถุฉ ุงููุณุชูู ูุฐู ุชูุงุฌู ูุดููุฉ (ุจูุถู Gabi ููุชุญููู ูููุง): ูููู ุฃู ุชุญุชูู ูู ุนูููุฉ ุนูู ุญุฏุซ ูุณุฌู ูุงุญุฏ ููุท. </p><br><a name="rtl"></a><br><h3 id="vysokourovnevoe-api-polzovatelskogo-rezhima-ntdll" style=";text-align:right;direction:rtl">  ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ูุถุน ุงููุณุชุฎุฏู ุนุงูู ุงููุณุชูู (ntdll) </h3><br><p style=";text-align:right;direction:rtl">  ุนูุฏูุง ูุชุนูู ุงูุฃูุฑ ุจุงูุฅุดุนุงุฑุงุช ุ ุชุตุจุญ ุงูุฃููุฑ ูุนูุฏุฉ ุ ุจุญูุซ ุชููุฑ ุทุจูุฉ rtl ูู ntdll.dll ูุงุฌูุฉ ุฃูุซุฑ ุจุณุงุทุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">NTSTATUS </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RtlSubscribeWnfStateChangeNotification</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( _Outptr_ PWNF_USER_SUBSCRIPTION* Subscription, _In_ WNF_STATE_NAME StateName, _In_ WNF_CHANGE_STAMP ChangeStamp, _In_ PWNF_USER_CALLBACK Callback, _In_opt_ PVOID CallbackContext, _In_opt_ PCWNF_TYPE_ID TypeId, _In_opt_ ULONG SerializationGroup, _In_opt_ ULONG Unknown )</span></span></span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงููุงูุน ุ ููุณุช ููุงู ุญุงุฌุฉ ููุงุชุตุงู ูุจุงุดุฑุฉ ุจุฎุฏูุงุช ุงููุธุงู: ูุง ุนููู ุณูู ุงุณุชุฎุฏุงู ูุงุฆูุฉ ุงูุชุธุงุฑ ุญุฏุซ ูุงุญุฏุฉ ุชุณุชูุฏ ุฅูู ntdll.dll. </p><br><p style=";text-align:right;direction:rtl">  ุฎูู ุงูููุงููุณ ุ ูุชู ุชุญููู ูุญุชููุงุช WNF_DELIVERY_DESCRIPTOR ุฅูู ูุนููุงุช ุฑุฏ ุงูุงุชุตุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">typedef</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NTSTATUS</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*PWNF_USER_CALLBACK)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( _In_ WNF_STATE_NAME StateName, _In_ WNF_CHANGE_STAMP ChangeStamp, _In_opt_ PWNF_TYPE_ID TypeId, _In_opt_ PVOID CallbackContext, _In_ PVOID Buffer, _In_ ULONG BufferSize)</span></span></span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููู ุงุดุชุฑุงู ุฌุฏูุฏ ุ ูุชู ุฅุฏุฎุงู ุฅุฏุฎุงู ุ ูุชู ูุถุนู ูู ุงููุงุฆูุฉ ุงูุชู ูุดูุฑ ุฅูููุง ุงููุชุบูุฑ ุงูุนูููู RtlpWnfProcessSubscriptions.  ุชู ุจูุงุก ุงููุงุฆูุฉ ุนูู ุฃุญุฏ ุงูุญููู WNF_NAME_SUBSCRIPTION ุ ููู ูู ุงูููุน LIST_ENTRY.  ูุญุชูู ูู ูู WNF_NAME_SUBSCRIPTION ุ ุจุฏูุฑู ุ ุนูู LIST_ENTRY ุญูู ุขุฎุฑ ูุชูุธูู ูุงุฆูุฉ WNF_USER_SUBSCRIPTION ูุน ุฑุฏ ุงุชุตุงู ูุณูุงู. </p><br><a name="kernel"></a><br><h3 id="vysokourovnevoe-api-urovnya-yadra-ex" style=";text-align:right;direction:rtl">  ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุงููุณุชูู ุงูุนุงูู ููููุงุฉ (ุณุงุจููุง) </h3><br><p style=";text-align:right;direction:rtl">  ูููุฑ WNF ุฃูุถูุง ูุธุงุฆู ูุชุทุงุจูุฉ ุชูุฑูุจูุง ูุฑูุฒ ูุถุน kernel (ูุงูุฐู ูููู ุงุณุชุฎุฏุงูู ูู ุจุฑูุงูุฌ ุงูุชุดุบูู): ุณูุงุก ูู ุฎูุงู ููุงููุงุช ุงููุธุงู ุงูุชู ุชู ุชุตุฏูุฑูุง ุฃู ูู ุฎูุงู ูุธุงุฆู API ุนุงููุฉ ุงููุณุชูู ูู ููุช ุงูุชุดุบูู (ุทุจูุฉ Ex). </p><br><p style=";text-align:right;direction:rtl">  ุชูุจู ุงูุฏุงูุฉ ExSubscribeWnfStateChange ุงุณู ุงูููุงูุฉ ุ ุงูุชุจ ุงูุฃููุนุฉ ูุนููุงู ุณูุงู ูุธููุฉ ุฑุฏ ุงูุงุชุตุงู + ููุฏุฎู ุ ูุชููู ุจุฅุฑุฌุงุน ูุงุตู ุงุดุชุฑุงู.  ุชุชููู ูุธุงุฆู ุฑุฏ ุงูุงุชุตุงู ุงุณู ุงููุฏู ูููุงุน ุงูุญุฏุซ ูุชุบููุฑ ุงูุชุณููุฉ ุ ูููู ููุณ ุงููุฎุฒู ุงููุคูุช ุฃู ุญุฌูู. </p><br><p style=";text-align:right;direction:rtl">  ุชููู ุงูุฏุงูุฉ ExQueryWnfStateData ุ ุจูุงุกู ุนูู ูุงุตู ุงูุงุดุชุฑุงู ุงูุฐู ุชู ุชูุฑูุฑู ุ ุจูุฑุงุกุฉ ุจูุงูุงุช ุงูุญุงูุฉ ุงูุญุงููุฉ.  ูู ุงููุงูุน ุ ููุชูู ูู ุฑุฏ ุงุชุตุงู ุจุงุณุชุฏุนุงุก ูุธููุฉ ExQueryWnfStateData ููุญุตูู ุนูู ุงูุจูุงูุงุช ุงููุฑุชุจุทุฉ ุจุงูุฅุนูุงู. </p><br><p style=";text-align:right;direction:rtl">  ููู ูู ุงุดุชุฑุงูุงุช ูุถุน kernel ูุงูุงุดุชุฑุงูุงุช ูู ูุถุน ุงููุณุชุฎุฏู ุ ุชูุดุฆ WNF (ูุชุชุจุน ุงูุงุดุชุฑุงูุงุช) ูุซูููุง ูุจููุฉ WNF_SUBSCRIPTION.  ูููู ุจุงููุณุจุฉ ููุถุน ุงููุณุชุฎุฏู ุ ูู ูุชู ููุก ุจุนุถ ุงูุญููู ุ ุนูู ุณุจูู ุงููุซุงู ุฑุฏ ุงูุงุชุตุงู ูุงูุณูุงู ุ ูุฃูู ุจุงููุณุจุฉ ููุถุน ุงููุณุชุฎุฏู ุ ูุชู ุชุฎุฒูู ุนูุงููู ุงููุนุงูุฌุงุช ููุนุงูุฌุชูุง ุจูุงุณุทุฉ ntdll.dll. </p><br><a name="data"></a><br><h3 id="struktury-dannyh-wnf" style=";text-align:right;direction:rtl">  ููุงูู ุจูุงูุงุช WNF </h3><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/sj/wk/ne/sjwknenp1z89s3xldzz5jlvzidi.jpeg"><br>  <u><em>ูู ุงููุชุฑุฌู</em></u> : ุงูุธุฑ ุงููุณู ุงูุชุงูู. </p><br><a name="analyze"></a><br><h3 id="utility-analiza-wnf" style=";text-align:right;direction:rtl">  ุงููุฑุงูู ุชุญููู WNF </h3><br><p style=";text-align:right;direction:rtl">  <u><em>ูู ุฃุญุฏ ุงููุชุฑุฌููู</em></u> : ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ููุง ูุฑุฉ ุฃุฎุฑู ุฅูู ุฃู ุงูุนุฑุถ ุงูุชูุฏููู ูู ูุชู ุฅุฌุฑุงุคู ูู ููุจู ุฃูููุณ ููุท ุ ูููู ุฃูุถูุง ุจูุงุณุทุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุบุงุจุฑููู ููุงูุง</a> .  ุนูู ูุฌู ุงูุฎุตูุต ุ ููุชูู ุงููุคูู ุงูุฎุงุต ุจู ุฅูู ูุญุฏุฉ WnfCom ุงูููุถุญุฉ ุฃุฏูุงู.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุตู ุบุงุจุฑููู ุงูููุงูู ุงูุฏุงุฎููุฉ ูู WNF ุจุชูุงุตูู ูุงููุฉ (ุงูุธุฑ ุงูุฑุณู ุงูุชูุถูุญู ูู ุงููุณู ุงูุณุงุจู).  ูุนุธู ุงูุดุฑุงุฆุญ ุงูุฎุงุตุฉ ุจู ุ ููุฃุณู ุ ุบุงุฆุจุฉ ูู pdf ููุนุฑุถ ุงูุชูุฏููู (ูุดุงุฑ ุฅููู ุนูู ุฃูู ุงูุฃุตูู) ุฃู ูุดุงุฑ ุฅููู ุญุตุฑููุง ุจุงูุนูุงููู.  ูููู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุฐู ููุงุณุจุฉ ููุชุงุฒุฉ ููุดุงูุฏุฉ ุชุณุฌูู ูุฃุฏุงุฆูุง ุงููุดุชุฑู: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Windows Notification Facility: Peeling the Onion of the Kernel Attack Surface ุญุชู ุงูุขู</a> (ุจุฏุงูุฉ Gabrielle ~ 19: 27).  ููุงู (ุฅูู ุฌุงูุจ ุจููุงุช ุงูุจูุงูุงุช) ุณุชููู ููุงู ูุตุฉ ุญูู ููููุฉ ุฅุตูุงุญ ููุญู ุงููุตุญุญ! Wnf (ุงูููุณุฏ - ุจุงุณุชุฎุฏุงู ุงูุทุฑููุฉ ุงูููุถุญุฉ ูู The NT Insider - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Fixing Brokener Extensions</a> ) </li><li style=";text-align:right;direction:rtl">  ูุญุชูู Gabrielle ุนูู ููุงูุฉ ุฌูุฏุฉ ูููุตูุฉ (ููุตูุฉ ุ ูููุณ ูุนุฑุถ ุชูุฏููู) - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุนุจ ุจุงุณุชุฎุฏุงู Windows Notification Facility (WNF)</a> ุ ูุงูุฐู ููุตู ุจุดุฏุฉ ุฃูุถูุง ุจูุฑุงุกุชู ูุฌููุน ุงูููุชููู. </li></ul><br><p style=";text-align:right;direction:rtl">  <u><em>ููู ุงููุชุฑุฌู</em></u> : ุฅุฐุง ุฃุฑุงุฏ ุดุฎุต ูุง ุฃู ูููู ุงูุชุฑุฌูุฉ ุงูุญุงููุฉ ุจูุญุชููุงุช Gabrielle ุงูุดุฑุงุฆุญ ุฃู ุชูุณูุน ุชุฑุฌูุฉ ุงูุงุฎุชุฒุงู ูู ุฃู ุฌุฒุก ูู ููุฏูู ุงูุฎุทุงุจ - ูุฑุญุจูุง ุจู.  ูุชูููุฑ ุงูุฑุงุญุฉ ูุฅุถุงูุฉ / ุชุบููุฑ ูุฌููุนุงุช ูุจูุฑุฉ ุ ูููููู ูุดุฑ ูุตุฏุฑ ุงูุชุฑุฌูุฉ ุนูู ุฌูุซุจ (ุฃู ุฎุงุฏู ุขุฎุฑ ููุชุญูู ูู ุงูุฅุตุฏุงุฑ). </p><br><a name="wnfcom"></a><br><h4 id="wnfcom" style=";text-align:right;direction:rtl">  WnfCom </h4><br><p style=";text-align:right;direction:rtl">  WnfCom ูู ูุญุฏุฉ ุจูุซูู ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุฏ ูุตุฏุฑ github</a> ) ุชูุธูุฑ ุฅููุงููุฉ ุงูุชุดุบูู ุงููุชุฏุงุฎู ูู ุฎูุงู WNF.  ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุณูุญ ูู ุจูุฑุงุกุฉ / ูุชุงุจุฉ ุงูุจูุงูุงุช ูู ูุซููุงุช ููุฌูุฏุฉ </li><li style=";text-align:right;direction:rtl">  ูุณูุญ ูู ุจุฅูุดุงุก ุฃุณูุงุก ุญุงูุฉ ูุคูุชุฉ ( <em>ูุฎุงุฏู</em> ) </li><li style=";text-align:right;direction:rtl">  ูุชูุญ ูู ุงูุญุตูู ุนูู ูุซูู ููุงุฆู <em>ุงูุนููู</em> ุงูุฐู ุณูููู ุจูุนุงูุฌุฉ ุงูุฅุนูุงูุงุช ุญูู ุชุบููุฑ ูุซูู ูุนูู ูู ุงูุงุณู </li></ul><br><p style=";text-align:right;direction:rtl">  ูุซุงู ููุงุณุชุฎุฏุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> wnfcomimport Wnfcom &gt;&gt;&gt; wnfserver = Wnfcom() &gt;&gt;&gt; wnfserver.CreateServer() [SERVER] StateNamecreated: <span class="hljs-number"><span class="hljs-number">41</span></span>c64e6da5559945 &gt;&gt;&gt; wnfserver.Write(<span class="hljs-string"><span class="hljs-string">b"potatosoup"</span></span>) Encoded Name: <span class="hljs-number"><span class="hljs-number">41</span></span>c64e6da5559945, Clear Name: <span class="hljs-number"><span class="hljs-number">6e99931</span></span> Version: <span class="hljs-number"><span class="hljs-number">1</span></span>, Permanent: No, Scope: Machine, Lifetime: Temporary, Unique: <span class="hljs-number"><span class="hljs-number">56627</span></span> State update: <span class="hljs-number"><span class="hljs-number">11</span></span> bytes written</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> wnfcomimport Wnfcom &gt;&gt;&gt; wnfclient = Wnfcom() &gt;&gt;&gt; wnfclient.SetStateName(<span class="hljs-string"><span class="hljs-string">"41c64e6da5559945"</span></span>) &gt;&gt;&gt; wnfclient.Listen() [CLIENT] Event registered: <span class="hljs-number"><span class="hljs-number">440</span></span> [CLIENT] Timestamp: <span class="hljs-number"><span class="hljs-number">0x1</span></span> Size: <span class="hljs-number"><span class="hljs-number">0xb</span></span> Data:<span class="hljs-number"><span class="hljs-number">00000000</span></span>: <span class="hljs-number"><span class="hljs-number">70</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>F <span class="hljs-number"><span class="hljs-number">74</span></span> <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">74</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>F <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">73</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>F <span class="hljs-number"><span class="hljs-number">75</span></span> <span class="hljs-number"><span class="hljs-number">70</span></span> potato soup</code> </pre> <br><a name="wnfdump"></a><br><h4 id="wnfdump" style=";text-align:right;direction:rtl">  WnfDump </h4><br><p style=";text-align:right;direction:rtl">  WnfDump ูู ุฃุฏุงุฉ ูุณุงุนุฏุฉ ูุณุทุฑ ุงูุฃูุงูุฑ ููุชูุจุฉ ุจุงููุบุฉ C. ูููู ุงูุนุซูุฑ ุนูู ุงูููู ุงููุงุจู ููุชูููุฐ ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/ionescu007/wnfun</a> ุนู ุทุฑูู ุชุญุฏูุฏ ุงูุฏููู ุงููุฑุนู ูุนูู ุงูุจุช ุงููุทููุจ.  ูููู ุงุณุชุฎุฏุงู ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ ููุจุญุซ ุนู ูุนูููุงุช ุญูู ุฃุณูุงุก ุญุงูุงุช WNF: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  -d ( <u>D</u> ump) ุชูุฑูุบ ูุงูุฉ ุฃุณูุงุก ุญุงูุฉ WNF ุจุงุณุชุฎุฏุงู ุชุนุฏุงุฏ ูุณุชูุฏ ุฅูู ุงูุชุณุฌูู.  ูููู ุงุณุชููุงูู ุจุฎูุงุฑุงุช: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  -v ( <u>V</u> erbose) ุฅุฎุฑุงุฌ ูุทููู ูุชุถูู ุชูุฑูุบ ุณุฏุงุณู ุนุดุฑู ูุจูุงูุงุช ุญุงูุฉ WNF ุ </li><li style=";text-align:right;direction:rtl">  -s ( <u>S</u> ecurity) ูุงุตูุงุช ุงูุฃูุงู - ุณูุงุณู SDDL ูู ุฃุฐููุงุช ูุงุณู ุญุงูุฉ WNF. </li></ul></li><li style=";text-align:right;direction:rtl">  -b ( <u>B</u> rute-force) ุงูุชุนุฏุงุฏ ุงููุจุงุดุฑ ูุฃุณูุงุก ุญุงูุฉ WNF ุงููุคูุชุฉ (ุงููุฒูุฏ ุญูู ูุฐุง ุฃุฏูุงู) </li><li style=";text-align:right;direction:rtl">  -i ( <u>I</u> nformation) ุนุฑุถ ูุนูููุงุช ุญูู ุงุณู ุญุงูุฉ WNF ูุงุญุฏ ูุญุฏุฏ </li><li style=";text-align:right;direction:rtl">  -r ( <u>R</u> ead) ูุฑุงุกุฉ ุงูุจูุงูุงุช ูู ุงุณู ุญุงูุฉ WNF ุงููุญุฏุฏ </li><li style=";text-align:right;direction:rtl">  -w ( <u>W</u> rite) ุงูุชุจ ุงูุจูุงูุงุช ุฅูู ุงุณู ุญุงูุฉ WNF ุงููุญุฏุฏ </li><li style=";text-align:right;direction:rtl">  -n ( <u>N</u> otification) ุชุณุฌูู ูุดุชุฑู ูู ุงูุฅุดุนุงุฑุงุช ูุงุณู ุญุงูุฉ WNF ุงููุญุฏุฏ (ูููุง ููู ุณูููู ุญุงูุฉ ุงุณุชุฎุฏุงู ุฃูุซุฑ ุชุญุฏูุฏูุง ูุน Edge) </li></ul><br><a name="surface"></a><br><h3 id="poverhnost-ataki-na-wnf" style=";text-align:right;direction:rtl">  WNF ุณุทุญ ุงููุฌูู </h3><br><p style=";text-align:right;direction:rtl">  ุณููุงูุด ูุฐุง ุงููุณู (ุจุชุนุจูุฑ ุฃุฏู ุ ุฃูุณุงูู ุงููุฑุนูุฉ) ุงููุฌูุงุช ุงููุญุชููุฉ ูุจูุงูุงุช WNF ุงูุญุณุงุณุฉ ุงููุซูุฑุฉ ููุงูุชูุงู. </p><br><a name="disclosure"></a><br><h4 id="raskrytie-privelegirovannyh-dannyh" style=";text-align:right;direction:rtl">  ุงููุดู ุนู ุงูุจูุงูุงุช ุงููููุฒุฉ </h4><br><p style=";text-align:right;direction:rtl">  ุนูุฏ ูุฑุงุกุฉ ุงูุขูุงู ูู ุฃุณูุงุก ุญุงูุงุช WNF ุงูููุฌูุฏุฉ ูู ุงููุธุงู ุ ูููู ุงูุฅุดุงุฑุฉ ุฅูู ุงูุนุฏูุฏ ูููุง ุ ูุงูุชู ุชุจุฏู ุจูุงูุงุชูุง ูุซูุฑุฉ ุฌุฏูุง ููุงูุชูุงู.  ูู ุจูููุง ุจุนุถ ุงูุจูุงูุงุช ุงูุชู ุชุดุจู ุจุดูู ูุซูุฑ ููุฑูุจุฉ ุงููุคุดุฑุงุช ุฃู ุบูุฑูุง ูู ุงูุจูุงูุงุช ุงููููุฒุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุงููุนุจ ุนูู ุงูุนุฏูุฏ ูู ุงูุฃุฌูุฒุฉ ุ ูู ุจุนุถ ุงูุญุงูุงุช ุ ูุงู ูู ุงููููู ุงูุนุซูุฑ ุนูู ูุฌููุนุฉ ุจูุงูุงุช ููุฌููุนุงุช ูุนูููุงุช ูููุฒุฉ ุฃุฎุฑู ุชู ุงููุดู ุนููุง ุนุจุฑ ุญุฏูุฏ ุงูุงูุชูุงุฒ.  ุชู ุฅุฑุณุงู ุชูุงุฑูุฑ ุงูุฃุฎุทุงุก / ุงูุถุนู ุฅูู MSRC ูู ููููู ุ ูููู ุชู ุชุตุญูุญูุง ูู ููููุจุฑ (ุจุนุฏ ุงูุนุฑุถ ุงูุชูุฏููู).  ุนูู ุณุจูู ุงููุซุงู: 4 ูููู ุจุงูุช ูู ุงูููุฏุณ ุชุณุฑุจุช ุฎูุงู ุงูุญุฏุซ WNF_AUDC *! </p><br><p style=";text-align:right;direction:rtl">  ุงููุดุงูู ุงูุฑุฆูุณูุฉ ูู ููุณูุง ููุง ุฑุฃููุง ูู ุงูุฏุฑุงุณุงุช ุงูุณุงุจูุฉ ูู j00ro ุ taviso ุ ูุบูุฑูุง.  ุชุญุชูู ุจุนุถ ุฃุณูุงุก ุญุงูุงุช WNF ุนูู ุจููุงุช ุจูุงูุงุช ูุดูุฑุฉ ูุน ูุดุงูู ุงูุญุดู ู / ุฃู ุงููุญุงุฐุงุฉ ุงููุฎุชููุฉ.  ูู ุจุนุถ ุงูุญุงูุงุช ุ ุชุณุฑุจ ุงูุฐุงูุฑุฉ ุบูุฑ ูููุฃ. <br>  <u><em>ูู ุงููุชุฑุฌู</em></u> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุฑุฌูุฉ ุงูุฌุฒุก ุงูุชูููุฏู ูู ุงููุณุชูุฏ Detectioning Kernel Memory Disclosure ูุน x86 Emulation and Taint Tracking ูู Mateusz Jurczyk aka j00ro</a> . </p><br><a name="discovering"></a><br><h4 id="obnaruzhenie-imen-sostoyaniy-i-razresheniy" style=";text-align:right;direction:rtl">  ุงูุชุดุงู ุฃุณูุงุก ุงูุฏูู ูุงูุฃุฐููุงุช </h4><br><p style=";text-align:right;direction:rtl">  ุงูุทุฑููุฉ ุงูุฃููู ูุงูุช ุงูุชุดุงู ุฌููุน ุฃุณูุงุก ุงูุญุงูุงุช ุงูููููุฉ ุงูุชู ูููู ูุนุงูุฌุชูุง ุจุดูู ุถุงุฑ.  ุจุงููุณุจุฉ ุฅูู ุงูุฃุณูุงุก ุงููุนุฑููุฉ ูุงูุฏุงุฆูุฉ ูุงููุณุชูุฑุฉ ุ ูููู ุงูุชุนุฏุงุฏ ูููููุง ุนู ุทุฑูู ุชุนุฏุงุฏ ููุงุชูุญ ุงูุชุณุฌูู.  ุซู ูููู ููุงุฑูุฉ ุงูููู ุงูุชู ุชู ุงูุนุซูุฑ ุนูููุง ูุน ูุนุฑูุงุช ูุฏูุฉ (ููุงู ุงูุนุฏูุฏ ูู ุงูุฃูุงูู ุงูุชู ููููู ุงูุนุซูุฑ ุนูููุง :)) </p><br><p style=";text-align:right;direction:rtl">  ุซู ูููููุง ุฃูุถูุง ุงููุธุฑ ุฅูู ูุงุตู ุงูุฃูุงู ูู ุงูุณุฌู (ูุฐุง ูู ุฃูู ุดูุก ูู ูุฎุฒู ุงูุจูุงูุงุช ุงููุคูุช).  ูุงุตู ุงูุฃูุงู ููุณ ูุงูููููุง: ููุณ ุจู ูุงูู ููุฌููุนุฉ ุ ูุฐูู ููู ุบูุฑ ุตุงูุญ ุชููููุง.  ูููู ูุง ุชูุฌุฏ ูุดููุฉ ูู ุงุณุชุจุฏุงู ูุงูู ููุฌููุนุฉ ูุฒูููู <em>ูุฅุตูุงุญ</em> ูุงุตู ุงูุฃูุงู. </p><br><a name="temporary"></a><br><h4 id="obnaruzhenie-vremennyh-imen-sostoyaniy-i-ih-razresheniy" style=";text-align:right;direction:rtl">  ุงููุดู ุนู ุฃุณูุงุก ุงูุญุงูุงุช ุงููุคูุชุฉ ูุฃุฐููุงุชูุง </h4><br><p style=";text-align:right;direction:rtl">  ูููู ูุน ุงูุฃุณูุงุก ุงููุคูุชุฉ ุ ูู ุชุนูู ุงูุญูู ุงูููุถุญุฉ ุฃุนูุงู: ููู ููุณุช ูู ุงูุณุฌู.  ููุฎุฒู ุงูููุงุฉ ููุท ููุงูู ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจูู (! Wnf) ูู ุงูุฐุงูุฑุฉ.  ููู ุงูุฃุณูุงุก ุงููุคูุชุฉ ููุณุช ูู ุงููุงูุน ูู ุงูุตุนุจ ููุบุงูุฉ ุงุณุชุฎุฏุงู ุงูููุฉ ุงูุบุงุดูุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุฅุตุฏุงุฑ ููู ุฏุงุฆูุง 1 </li><li style=";text-align:right;direction:rtl">  ุฏุงุฆููุง ูุง ููู WnfTporaryStateName </li><li style=";text-align:right;direction:rtl">  ูุชู ุฏุงุฆููุง ูุณุญ ุงูุนูุงูุฉ ุงูุฏุงุฆูุฉ (ูุง ูููู ุฃู ูุญุชูู ุงุณู ุงูุญุงูุฉ ุงููุคูุชุฉ ุนูู ุจูุงูุงุช ุฏุงุฆูุฉ) </li><li style=";text-align:right;direction:rtl">  ูููู ุฃู ูุฃุฎุฐ ุงููุทุงู (ุงููุทุงู) ุฅุญุฏู ุงูููู ุงูุฃุฑุจุนุฉ </li></ul><br><p style=";text-align:right;direction:rtl">  ูุนู ุ ูููู ุงูุฑูู ุงูุชุณูุณูู ุงููุชุจูู ูู 51 ุจุช!  ูู ุงููุงูุน ... ูููู ูุง ุชูุณ ุฃู ุงูุฃุฑูุงู ุงูุชุณูุณููุฉ ุชููู ุฑุชุงุจุฉ.  ูุจุงููุณุจุฉ ููุฃุณูุงุก ุงููุคูุชุฉ ุ ุชุชู ุฅุนุงุฏุฉ ุชุนููู ุงูุชุณูุณู ุฅูู 0 ูู ูู ุนูููุฉ ุชูููุฏ.  ุจุดูู ุชูููุฏู ุ ููููู ุฃู ุชุฃุฎุฐ ูุงูุฐุฉ ุชุญุชูู ุนูู ููููู ุฑูู ุชุณูุณูู: ูู ุญููุฉ ุ ุชุญูู ูู ูุฌูุฏ ูู ุงุณู (ูุจุฏุฃ ูู 0) ุนู ุทุฑูู ุงูุงุชุตุงู ุจู ZwQueryWnfStateNameInformation ูุน ูุฆุฉ ุงููุนูููุงุช ุงููุทููุจุฉ WnfInfoStateNameExist (ุจุงููุธุฑ ุฅูู ุฃู ุฎุทุฃ ุงููุตูู ูุดูุฑ ุฃูุถูุง ุฅูู ูุฌูุฏ ุงุณู).  ุฅุฐุง ูู ููู ููุงู ููููู ุงุณู ุขุฎุฑ ุ ูููููู ุฅููุงู ุงูุจุญุซ. </p><br><p style=";text-align:right;direction:rtl">  ูุชู ุชุฎุฒูู ูุงุตูุงุช ุฃูุงู ุงูุงุณู ุงููุคูุช (ูุซู ุจูุงูุงุช ุงูุงุณู ุงููุคูุชุฉ ุงูุฃุฎุฑู) ูู kernel.  ูุฐูู ุ ูุฅู ุงูุทุฑููุฉ ุงููุญูุฏุฉ ูุทูุจูุง ูู! Wnf extension ุนูุฏ ุชุตุญูุญ ูุถุน kernel.  ููู ูููููุง: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชูุตู ุฅูู ุงุณุชูุชุงุฌ ุญูู ุฃุฐููุงุช ุงููุฑุงุกุฉ ุนูุฏ ูุญุงููุฉ ูุฑุงุกุฉ ุงูุจูุงูุงุช. </li><li style=";text-align:right;direction:rtl">  ูุงุณุชูุชุงุฌ ุฃู ุงูุชุณุฌูู ูุณููุญ ุจู ูู ุฎูุงู ูุญุงููุฉ ูุชุงุจุฉ ุงูุจูุงูุงุช.  ููู ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃู ุงููุชุงุจุฉ ุงููุงุฌุญุฉ ุญุชู 0 ุจุงูุช ุชุฏูุฑ ุงูุจูุงูุงุช ุงูุชู ูู ูุชููู ุงููุณุชููู ุงูุญูููู ูู ุงูุญุตูู ุนูููุง ุจุนุฏ.  ููุฑุฉ ุฃุฎุฑู ุ ููุงู ุฎุฏุนุฉ: ูููููุง ุชุทุจูู ุฎุชู ุงูุชุบููุฑ ุงูููุงุณุจ.  ูุญู ูุญุงูู ุงููุชุงุจุฉ ุจุงุณุชุฎุฏุงู ุงูุชุณููุฉ 0xFFFFFFFF: ูุชู ุงูุชุญูู ูู ุงูุชุณููุฉ ุจุนุฏ ุงูุชุญูู ูู ุงููุตูู ุ ูุจุงูุชุงูู ุ ูุฅู ูููุฉ ุงูุฎุทุฃ ููุชุฌ ุนููุง ุชุณุฑุจ ุฅุฐู ุงููุชุงุจุฉ. </li></ul><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูุง ูุนุทููุง ูุงุตู ุฃูุงู ูุงูู ุ ูููู ูู ุฎูุงู ุชุดุบูู ุงูููุฏ ุจุงูุชูุงุฒุงุช ูุฎุชููุฉ ุ ูููููุง ุงูุญุตูู ุนูู ููุฑุฉ ุนู ุงููููุฏ ุงูููุฑูุถุฉ ุนูู ุญุณุงุจุงุช ุงููุธุงู ุงููุฎุชููุฉ (Low IL / User / Admin / SYSTEM). </p><br><a name="subscribers"></a><br><h4 id="perechislenie-podpischikov" style=";text-align:right;direction:rtl">  ูุงุฆูุฉ ุงููุดุชุฑููู </h4><br><p style=";text-align:right;direction:rtl">  ูู ุจููุฉ WNF_PROCESS_CONTEXT ุ ูููู ุฃุญุฏ ุงูุญููู ูู ุฑุฃุณ ุงููุงุฆูุฉ (LIST_ENTRY) ูุฌููุน ุงุดุชุฑุงูุงุช ูุฐู ุงูุนูููุฉ.  ูู ุงุดุชุฑุงู ูู ูุณุฎุฉ ูููุตูุฉ ูู WNF_SUBSCRIPTION. </p><br><p style=";text-align:right;direction:rtl">  ูุดุชุฑูู ูุถุน Kernel ููููููู ุจุดูู ุฃุณุงุณู ูุนูููุฉ ุงููุธุงู.  ูููููุง ุงุณุชุฎุฏุงู ุงูุฃูุฑ! List debugger ูุชูุฑูุบ ุงููุนุงูุฌุงุช ูุงููุนููุงุช ุงูุฎุงุตุฉ ุจูุง ุงููุณุฌูุฉ ูู ุนูููุฉ ูุธุงู WNF_SUBSCRIPTION.  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃูู ูู ุจุนุถ ุงูุญุงูุงุช ุ ูุชู ุงุณุชุฎุฏุงู ุฃุฏุงุฉ ุชุฌููุน ุงูุฃุญุฏุงุซ (CEA.SYS) ุ ูุงูุชู ุชุฎูู ุนูุงููู ุฑุฏ ุงูุงุชุตุงู ุงูุญููููุฉ ูู ุจููุฉ ุงูุณูุงู ุงูุฎุงุตุฉ ุจูุง. </p><br><p style=";text-align:right;direction:rtl">  ูููููุง ุชูุฑุงุฑ ูุฐุง ุงูุฃุณููุจ ูู ุนูููุงุช ูุถุน ุงููุณุชุฎุฏู ุ ููู ุนููุงู ุฑุฏ ุงูุงุชุตุงู ุณูููู ูุงุฑุบูุง ุ ุญูุซ ุฅููู ูุดุชุฑููู ูู ูุถุน ุงููุณุชุฎุฏู.  ูุฐูู ุ ูุญุชุงุฌ ุฅูู ุงูุงูุถูุงู ุฅูู ูุณุงุญุฉ ุงููุณุชุฎุฏู ุงูุฎุงุตุฉ ุจุงูุนูููุฉ ุ ูุงูุญุตูู ุนูู ุฌุฏูู RtlpWnfProcessSubscriptions ุ ุซู ุชูุฑูุบ ูุงุฆูุฉ ูุซููุงุช WNF_USER_SUBSCRIPTION ุ ูู ูููุง ูุญุชูู ุจุงููุนู ุนูู ุนููุงู ุฑุฏ ุงูุงุชุตุงู.  ูุณูุก ุงูุญุธ ุ ูุฐู ุงูุดุฎุตูุฉ ุซุงุจุชุฉ ุ ููุง ูุนูู ุฃููุง ููุณุช ุจุฃุญุฑู ููุชูุญุฉ ุ ูููู ูููู ุงูุนุซูุฑ ุนูููุง ุนู ุทุฑูู ุงูุชูููู.  ููุฑุฉ ุฃุฎุฑู ูุฌุฏุฑ ุงูุงูุชุจุงู (ุนู ุทุฑูู ุงูููุงุณ ูุน ูุถุน kernel CEA.SYS) ุฃู ุงูุนุฏูุฏ ูู ูุนุงูุฌุงุช ูุถุน ุงููุณุชุฎุฏู ูุณุชุฎุฏู ูุฌูุน ุงูุญุฏุซ (EventAggregation.dll) ุ ุงูุฐู ูุฎุฒู ุฑุฏ ุงูุงุชุตุงู ูู ุงูุณูุงู ุงูุฎุงุต ุจู. </p><br><a name="sensitive"></a><br><h3 id="interesnye-i-chuvstvitelnye-imena-sostoyaniy-wnf" style=";text-align:right;direction:rtl">  ุฃุณูุงุก ุญุงูุฉ ูุซูุฑุฉ ููุงูุชูุงู ูุญุณุงุณุฉ WNF </h3><br><p style=";text-align:right;direction:rtl">  ููุฏู ูุฐุง ุงููุณู ุจุนุถ ุงูุฃูุซูุฉ ุงููุซูุฑุฉ ููุงูุชูุงู ุญูู ููููุฉ ูุดู ุจุนุถ ุฃุณูุงุก ุญุงูุงุช WNF ุนู ูุนูููุงุช ุงููุธุงู. </p><br><a name="system_state"></a><br><h4 id="opredelenie-sostoyaniya-sistemy-i-povedeniya-polzovatelya-s-pomoschyu-wnf" style=";text-align:right;direction:rtl">  ุชุญุฏูุฏ ุญุงูุฉ ุงููุธุงู ูุณููู ุงููุณุชุฎุฏู ุจุงุณุชุฎุฏุงู WNF </h4><br><p style=";text-align:right;direction:rtl">  ูููู ุงุณุชุฎุฏุงู ุจุนุถ ูุนุฑูุงุช WNF ููุญุตูู ุนูู ูุนูููุงุช ุญูู ุญุงูุฉ ุงูุฌูุงุฒ ุงูุชู ุชููู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  WNF_WIFI_CONNECTION_STATUS - ุงูุญุงูุฉ ุงููุงุณูููุฉ </li><li style=";text-align:right;direction:rtl">  WNF_BLTH_BLUETOOTH_STATUS - ุจุงููุซู ุ ูููู ุจุงููุณุจุฉ ุฅูู Bluetooth (ุฃูุถูุง WNF_TETH_TETHERING_STATE) </li><li style=";text-align:right;direction:rtl">  WNF_UBPM_POWER_SOURCE - ูุนุฑุถ ูุตุฏุฑ ุงูุทุงูุฉ (ุงูุจุทุงุฑูุฉ ุฃู ูุญูู ุงูุทุงูุฉ) </li><li style=";text-align:right;direction:rtl">  WNF_SEB_BATTERY_LEVEL - ูุญุชูู ุนูู ูุณุชูู ุงูุจุทุงุฑูุฉ </li><li style=";text-align:right;direction:rtl">  WNF_CELL_ * - ูุญุชูู Windows Phone ุนูู ูุนูููุงุช ุญูู: ุงูุดุจูุฉ ุฃู ุงูุฑูู ุฃู ููุฉ ุงูุฅุดุงุฑุฉ ุฃู EDGE ุฃู 3G ุ ... </li></ul><br><p style=";text-align:right;direction:rtl">   WNF         : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> WNF_AUDC_CAPTURE/RENDER โ   ( PID),   /  </li><li style=";text-align:right;direction:rtl"> WNF_TKBN_TOUCH_EVENT โ    ,       </li><li style=";text-align:right;direction:rtl"> WNF_SEB_USER_PRESENT/WNF_SEB_USER_PRESENCE_CHANGED โ    Windows </li></ul><br><a name="avoiding"></a><br><h4 id="alternativy-standartnym-api-uvedomleniy" style=";text-align:right;direction:rtl">   API  </h4><br><p style=";text-align:right;direction:rtl">   ,        API  ,  API , ,      /.     WNF     . ,  ,   WNF      . </p><br><p style=";text-align:right;direction:rtl"> : WNF_SHEL_(DESKTOP)_APPLICATION_(STARTED/TERMINATED)      modern- (   ,   )  DCOM,       Win32.      โ       ShellExecute:    Explorer,   cmd.exe, ... </p><br><p style=";text-align:right;direction:rtl">   ,  WNF    API  ,      : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> WNF_SHEL_LOCKSCREEN_ACTIVE โ     </li><li style=";text-align:right;direction:rtl"> WNF_EDGE_LAST_NAVIGATED_HOST โ   URL,    ( )  Edge </li></ul><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">   :      Edge</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/6x/mw/uh/6xmwuhsm2ngnwcg6kpp5htsoxby.gif"></p></div></div><br><a name="effect"></a><br><h4 id="vozdeystvie-na-sistemu-s-ispolzovaniem-wnf" style=";text-align:right;direction:rtl">      WNF </h4><br><p style=";text-align:right;direction:rtl">    WNF,        . : WNF_FSRL_OPLOCK_BREAK โ ,    (/),  PID'    ! </p><br><p style=";text-align:right;direction:rtl">       WNF     ,       . : WNF_SHEL_DDC_(WNS/SMS)_COMMAND โ   4 ,         . </p><br><p style=";text-align:right;direction:rtl">  ,     WNF,      . : WNF_CERT_FLUSH_CACHE_TRIGGER (  ), WNF_BOOT_MEMORY_PARTITIONS_RESTORE, WNF_RTDS_RPC_INTERFACE_TRIGGER_CHANGED, ... </p><br><a name="inject"></a><br><h3 id="vnedrenie-v-process-s-ispolzovaniem-wnf" style=";text-align:right;direction:rtl">      WNF </h3><br><p style=";text-align:right;direction:rtl">          : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> WriteProcessMemory โ    </li><li style=";text-align:right;direction:rtl">   ( ) โ               </li><li style=";text-align:right;direction:rtl">   (Atom) โ            </li><li style=";text-align:right;direction:rtl">    โ  ,   WM_COPYDATA  DDE,       </li><li style=";text-align:right;direction:rtl"> GUI  โ    (   )  ,       </li></ul><br><p style=";text-align:right;direction:rtl">  WNF         : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">       WNF,      (,        ) </li><li style=";text-align:right;direction:rtl">      Rtl/ZwQueryWnfStateData    WNF </li></ul><br><p style=";text-align:right;direction:rtl">  ,            : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <abbr title="Asynchronous Procedure Call">APC</abbr> s </li><li style=";text-align:right;direction:rtl">       (Remote Threads) </li><li style=";text-align:right;direction:rtl">         (Changing Thread Context) </li><li style=";text-align:right;direction:rtl">  " <em>window long</em> " โ  ,     ,      </li></ul><br><p style=";text-align:right;direction:rtl">        WNF_USER_SUBSCRIPTION   (     WNF_NAME_SUBSCRIPTION,    RtlpWnfProcessSubscriptions).      ( <abbr title="Control Flow Guard">CFG</abbr> ),         ( 5  6    ). </p><br><p style=";text-align:right;direction:rtl">       ,      :    , ,   ,     -. </p><br><a name="future"></a><br><h3 id="napravleniya-dlya-dalneyshih-issledovaniy" style=";text-align:right;direction:rtl">     </h3><br><p style=";text-align:right;direction:rtl">    WNF   SEB_,       ( <u>S</u> ystem <u>E</u> vents <u>B</u> roker). SystemEventsBrokerServer.dll  SystemEventsBrokerClient.dll   API  . ,      SEB     SEB,     . </p><br><p style=";text-align:right;direction:rtl">            CEA.SYS  EventAggregation.dll.    "  " (Event Aggregation Library),     ,      :     ,      ,   WNF             ,         .        WNF,     .        . </p><br><hr><br><p style=";text-align:right;direction:rtl"> <u><em> </em></u> :              . </p><br><hr><br><a name="before"></a><br><h3 id="do-prezentacii" style=";text-align:right;direction:rtl">   </h3><br><p style=";text-align:right;direction:rtl">   ,   Windows Notification Facility     Alex'  Gabrielle.    ( )    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">redp</a> . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/kv/jx/xp/kvjxxppelx9k4zjkqbweh8ukkre.jpeg"></p><br><p style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">   WNF</a> (  )   <em>    </em>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">wincheck</a> .  ,      Gabrielle Viala  ,       redp,     : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">http://redplait.blogspot.com/search/label/wnf</a> . </p><br><a name="after"></a><br><h3 id="posle-prezentacii" style=";text-align:right;direction:rtl">   </h3><br><p style=";text-align:right;direction:rtl">      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">PoC</a> (  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> github</a> )   explorer (  โ  notepad). <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">modexp</a>         :   Callback  WNF_USER_SUBSCRIPTION.      : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">    explorer.exe </li><li style=";text-align:right;direction:rtl">    WNF_USER_SUBSCRIPTION </li><li style=";text-align:right;direction:rtl">    RWX-     ,  WriteProcessMemory (,     VirtualAllocEx + WriteProcessMemory) </li><li style=";text-align:right;direction:rtl">     WNF_USER_SUBSCRIPTION (    WriteProcessMemory) </li><li style=";text-align:right;direction:rtl">  ntdll!NtUpdateWnfStateData(...)   ,        </li><li style=";text-align:right;direction:rtl">     WNF_USER_SUBSCRIPTION     </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar459626/">https://habr.com/ru/post/ar459626/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar459616/index.html">MIPT ููุชุชุญ ุฃูู ุจุฑูุงูุฌ ูุงุฌุณุชูุฑ ูุชูุฏู ูู ุฑูุณูุง ูู ุนููู ุงูููุจููุชุฑ ูููุฏุณุฉ ุงูุจุฑูุฌูุงุช</a></li>
<li><a href="../ar459618/index.html">ุจุนุถ ุงูููุฒุงุช ุบูุฑ ุงููุนุฑููุฉ ูุฑุณู ุงูุณูู</a></li>
<li><a href="../ar459620/index.html">TDDx2 ุ BDD ุ DDD ุ FDD ุ MDD ู PDD ุ ุฃู ูุง ุชุฑูุฏ ูุนุฑูุชู ุนู ุงูุชุทููุฑ ุงููุฏููุน</a></li>
<li><a href="../ar459622/index.html">ููุง ุชู ูุชุงุจุฉ ุฃูุนุงุจ Sega Saturn ูู ุนุงู 1995</a></li>
<li><a href="../ar459624/index.html">ุงูุทุงุฆุฑุงุช ุงูุนุณูุฑูุฉ ุจุฏูู ุทูุงุฑ</a></li>
<li><a href="../ar459628/index.html">ุชุถู ุดุจูุฉ Open Invention Network ุฃูุซุฑ ูู ุซูุงุซุฉ ุขูุงู ูุฑุฎูุต ููู - ูุงุฐุง ูุนูู ุฐูู ุจุงููุณุจุฉ ุฅูู ุงูุจุฑุงูุฌ ููุชูุญุฉ ุงููุตุฏุฑ</a></li>
<li><a href="../ar459630/index.html">ุชูู ุชุงู ุชู ุงูุฌุฒุก 2: ุนุฏููู ุงูุฌูุณูุฉ ุงูุชุฑุงุฌุน / ุงูุฅุนุงุฏุฉ</a></li>
<li><a href="../ar459638/index.html">ุฅูุดุงุก ูุงุนุฏุฉ ูุนุงุฑู ุนุงูููุฉ ุนูู ุงูุจุทุงุฑูุงุช</a></li>
<li><a href="../ar459640/index.html">ูุณุชูุฏุงุช ูุฑูุฒ. ุงูุฌุฒุก 1: ุฃุชูุชุฉ ุงูุชุญุฏูุซ</a></li>
<li><a href="../ar459642/index.html">ูุตูู ุขูู ูุชุณุฌูู ุงูุญููู ูู C ++ ุฏูู ุงูุชุถุญูุฉ ุจุงูููุงุกุฉ (ุจุงุณุชุฎุฏุงู CortexM ููุซุงู)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>