<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⏸️ 🔅 👆🏼 Bagaimana kami membangun penyimpanan S3 DataLine. Eksperimen, pengujian, dan sedikit tentang kuda nil 👩🏽‍🏭 ✝️ 🍞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo lagi, Alexey Pristavko berhubungan, dan ini adalah bagian kedua dari cerita saya tentang penyimpanan objek S3 DataLine berdasarkan Cloudian Hyper...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bagaimana kami membangun penyimpanan S3 DataLine. Eksperimen, pengujian, dan sedikit tentang kuda nil</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataline/blog/425973/"><img src="https://habrastorage.org/webt/0k/od/i7/0kodi796iwhoi16frktb7mytx_4.png"><br><br>  Halo lagi, Alexey Pristavko berhubungan, dan ini adalah bagian kedua dari cerita saya tentang penyimpanan objek S3 DataLine berdasarkan Cloudian HyperStore. <br><br>  Hari ini saya akan berbicara secara rinci tentang bagaimana penyimpanan S3 kami diatur dan kesulitan apa yang kami temui dalam proses pembuatannya.  Pastikan untuk menyentuh topik "besi" dan menganalisis peralatan tempat kami akhirnya tinggal. <br><br>  Ayo pergi! <br><a name="habracut"></a><br>  Jika selama membaca Anda memiliki keinginan untuk berkenalan dengan arsitektur aplikasi dari solusi Cloudian, Anda akan menemukan analisis terperinci di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel sebelumnya</a> .  Di sana kami membahas secara rinci perangkat internal Cloudian, toleransi kesalahan dan logika SDS bawaan. <br><br><h2>  Skema akhir peralatan fisik </h2><br>  Karena nanti kita akan berbicara tentang "siksaan pilihan" kita, saya akan segera memberikan daftar besi terakhir yang telah kita terima.  Penafian kecil: pilihan peralatan jaringan sebagian besar karena kehadirannya di gudang kami (yang sangat padat). <br><br>  Jadi, pada tingkat penyimpanan fisik, kami memiliki peralatan berikut: <br><table><tbody><tr><td>  <b>Nama</b> <br></td><td>  <b>Fungsi</b> <br></td><td>  <b>Konfigurasi</b> <br></td><td>  <b>Jumlah</b> <br></td></tr><tr><td>  Lenovo System x3650 M5 Server <br></td><td>  Simpul kerja <br></td><td>  1x Xeon E5-2630v4 2.2GHz, <br>  4x 16GB DDR4, <br>  14x10TB 7.2K 6Gbps SATA 3.5 ", <br>  2x 480GB SSD, <br>  Intel x520 Dual Port 10GbE SFP +, <br>  2x750W HS PSU <br></td><td>  4 <br></td></tr><tr><td>  Server HP ProLiant DL360 G9 <br></td><td>  Memuat simpul penyeimbang <br></td><td>  2 E5-2620 v3, <br>  RAM 128G, <br>  2 600GB SSD, <br>  4 SAS HDD, <br>  Intel x520 Dual Port 10GbE SFP + <br></td><td>  2 <br></td></tr><tr><td>  Cisco C4500 Switch <br></td><td>  Gerbang perbatasan <br></td><td>  Catalyst WS-C4500X-16SFP + <br></td><td>  2 <br></td></tr><tr><td>  Switch Cisco C3750 <br></td><td>  Port extender <br></td><td>  Catalyst WS-C3750X-24T dengan C3KX-NM-10G <br></td><td>  2 <br></td></tr><tr><td>  Cisco C2960 Switch <br></td><td>  kontrol pesawat <br></td><td>  Catalyst WS-C2960 + 48PST-L <br></td><td>  1 <br></td></tr></tbody></table><br>  Untuk pemahaman yang lebih baik tentang arsitektur, kita akan melihat semua elemen pada gilirannya dan berbicara tentang fitur dan tugas mereka. <br><br>  Mari kita mulai dengan server.  Server Lenovo memiliki konfigurasi khusus yang diimplementasikan bersama dan sepenuhnya sesuai dengan rekomendasi dan spesifikasi Cloudian.  Misalnya, mereka menggunakan pengontrol dengan akses disk langsung.  Karena dalam kasus kami, RAID diatur pada tingkat perangkat lunak aplikasi, mode ini meningkatkan keandalan dan mempercepat subsistem disk.  Tepatnya server yang sama dapat dibeli sebagai Peralatan Cloudian bersama dengan semua lisensi. <br><br>  Load balancing server dengan Nginx for CentOS menjamin pemerataan distribusi pada node kerja dan abstrak pengguna dari organisasi traffic internal.  Dan sebagai bonus yang menyenangkan - jika perlu, Anda dapat mengatur cache pada mereka. <br><br>  Cisco 4500X sixteen 10GB SFP + pair berfungsi sebagai inti dan batas jaringan penyimpanan kami yang kecil namun bangga.  Tentu saja, besi agak kuno, tetapi tidak kalah dengan keandalan "baru", ia memiliki redundansi internal, dan fungsinya memenuhi semua persyaratan kami.  C3750 memainkan peran sebagai pabrik-extender, tidak perlu mendorong transceiver 1G ke slot 10G.  Dan untuk beralih sepenuhnya ke tautan 10GB juga tidak masuk akal.  Seperti yang ditunjukkan oleh tes, kami mengalami prosesor dan disk sebelumnya. <br><br>  Diagram di bawah ini menggambarkan secara cukup rinci organisasi fisik yang saya jelaskan: <br><br><img src="https://habrastorage.org/webt/jj/cs/mr/jjcsmrwqvzkqrder_z9zv3pr4ca.jpeg">  <i>1. Skema organisasi penyimpanan fisik</i> <br><br>  Mari kita pergi melalui skema.  Seperti yang Anda lihat, toleransi kesalahan pada level fisik diwujudkan dengan menduplikasi dan menghubungkan setiap perangkat dengan setidaknya dua tautan optik, satu untuk setiap perangkat berpasangan.  Ini memberi kami jaminan menjaga konektivitas fisik di sirkuit selama kecelakaan perangkat jaringan apa pun atau dua perangkat dari pasangan yang berbeda secara bersamaan. <br><br>  Kami pergi di bawah skema.  Kedua pasangan Cisco (4500/4500, 3750/3750) digabungkan menjadi satu perangkat logis menggunakan tumpukan dan VSS.  Tumpukan dirakit dengan dua kabel tumpukan, VSS melalui tiga tautan optik 10G.  Ini memungkinkan Anda untuk memastikan bahwa kedua perangkat di setiap pasangan berinteraksi secara keseluruhan.  Pengelompokan seperti ini memungkinkan kami untuk bekerja dalam kerangka kerja satu segmen L2 transparan melalui kedua perangkat berpasangan dan untuk membuat agregasi tautan umum menggunakan LACP, karena teknologi ini secara asli didukung oleh server OS dan Cisco IOS.  Dari sisi server, sepertinya ia bekerja dengan satu saklar, bukan dua, dan di atas aplikasi terdapat saluran agregat kapasitas ganda. <br><br>  Semua peralihan peralatan jaringan antara dirinya dan ke saluran yang masuk dilakukan dengan menggunakan tautan optik 10G, peralatan server terhubung menggunakan kabel 10G Twinax Cisco dan tembaga 1G. <br><br>  BGP digunakan untuk toleransi kesalahan pada saluran yang masuk, dan Round Robin DNS digunakan untuk menyeimbangkan antara alamat IP eksternal.  Alamat eksternal sendiri diparkir di server penyeimbang beban dan, jika perlu, bermigrasi di antara node menggunakan bundel Pacemaker / Corosync. <br><br>  Pemantauan dan kontrol melalui IPMI dilakukan melalui tautan internal langsung.  Semua antarmuka manajemen (baik server dan Cisco) terhubung melalui sakelar kontrol yang terpisah.  Mereka, pada gilirannya, termasuk dalam jaringan kontrol pusat data.  Ini menjamin kami tidak mungkin kehilangan komunikasi dengan peralatan selama bekerja atau sebagai akibat dari kecelakaan pada jaringan eksternal.  Untuk kasus yang paling ekstrem, ada petugas dengan KVM. <br><br><h2>  Jaringan logis </h2><br>  Untuk memahami bagaimana jaringan logis S3 penyimpanan DataLine bekerja, mari kita beralih ke skema lain: <br><br><img src="https://habrastorage.org/webt/lp/zn/ub/lpznubpzqosgkhzts8tm7sp0ssi.png"><br>  <i>2. Penyimpanan diagram jaringan logis</i> <br><br>  Seperti yang Anda lihat, logika jaringan terdiri dari beberapa segmen. <br><br>  Jaringan eksternal (Q) dengan kapasitas total 20G terhubung langsung ke Provider Edge.  Ini diikuti oleh Cisco 4500 dan balancers. <br><br>  Blok logis berikutnya (X) adalah VLAN antara balancers dan node yang bekerja.  Penyeimbang menggunakan koneksi yang sama seperti untuk lalu lintas masuk.  Node yang bekerja terhubung melalui tumpukan 3750 dengan 4 tautan 1G (dua untuk masing-masing 3750).  Semua tautan fisik dirangkai menjadi satu tautan logis menggunakan LACP juga.  Jaringan ini hanya digunakan untuk memproses lalu lintas klien. <br><br>  Semua koneksi dalam cluster Cloudian (Y) melewati segmen logis ketiga yang dibangun di atas 10G.  Organisasi semacam itu membantu menghindari masalah pada saluran eksternal karena lalu lintas internal dan sebaliknya.  Ini adalah segmen yang sangat dimuat dan penting untuk operasi cluster.  Melalui data itulah metadata direplikasi, digunakan oleh prosedur penyeimbangan ulang, dll., Oleh karena itu, kami membedakan “ketidakterbatasannya” sebagai tugas terpisah. <br><br><h2>  Sedikit keindahan </h2><br>  Begini tampilannya: <br><br><img src="https://habrastorage.org/webt/_m/_1/sd/_m_1sd2pvc2h5nbt2wco5bdkl4s.png"><br>  <i>3. Peralatan jaringan dan penyeimbang wajah penuh</i> <br><br><img src="https://habrastorage.org/webt/xo/q0/e4/xoq0e4outgmbcgswdzb4uzs4bsg.png"><br>  <i>4. Sama, tampilan belakang</i> <br><br>  Perhatikan pengalihan.  Pada artikel sebelumnya, rekan-rekan saya menulis tentang pentingnya kabel penanda warna, tetapi tidak akan keluar dari tempat untuk menyentuh topik ini di sini. <br><br>  Kami menggunakan peralihan warna tidak hanya untuk jaringan, tetapi juga untuk daya.  Ini memungkinkan teknisi kami untuk bernavigasi dengan cepat di rak dan mengurangi pengaruh faktor manusia selama pergantian. <br><br><img src="https://habrastorage.org/webt/uu/8x/tw/uu8xtwvqpdcvw45xlugyfysq5is.png"><br>  <i>5. Node yang bekerja</i> <br><br><img src="https://habrastorage.org/webt/wl/gn/5g/wlgn5gc7cttpbkra7cpmnza_pdo.png"><br>  <i>6. Tampilan belakang</i> <br><br>  Dalam foto ini Anda dapat dengan jelas melihat seberapa erat server yang bekerja diisi dengan disk - praktis tidak ada slot kosong bahkan di belakang.  Ngomong-ngomong, pengorganisasian kabel seperti itu ke dalam bundel kompak tidak hanya berfungsi sebagai estetika, tetapi juga menghindari tumpang tindih kipas suplai daya, menghemat besi dari panas berlebih. <br><br><h3>  Daftar putih </h3><br>  Dalam komentar di artikel terakhir, saya berjanji untuk berbicara lebih banyak tentang perangkat yang masuk daftar putih. <br><br>  Jika karena alasan tertentu kami sepakat dengan klien untuk mengecualikan dari akun semua bekerja dengan penyimpanan dari bagian dalam pusat data atau melalui saluran langsung ke peralatannya, maka kami perlu mengatur koneksi pribadi ke penyimpanan. <br><br>  Ingat, pada diagram pertama ada cabang di DIST dan Cloud?  Selain saluran Internet 20Gb utama, kami menggunakan saluran agregat untuk beralih, yang kami hubungkan semua klien di tingkat pusat data.  Jika klien menginginkan tautan langsung ke penyimpanan, kami dapat mengonfigurasi VLAN dari klien ke 4500X kami dengan pembangunan rute terpisah (atau tanpa itu) dan mulai L3.  Setelah itu, pengikatan pada paket tarif dikonfigurasikan pada alamat klien yang sudah ada di Cloudian itu sendiri.  Kemudian, untuk semua orang yang terhubung dengan paket tarif ini, penggunaan S3 dari alamat yang masuk daftar putih tidak akan dipertimbangkan. <br><br><img src="https://habrastorage.org/webt/mr/nc/yd/mrncyda-0oquwo4kpos3snsyp2e.png"><br>  <i>7. Dan berikut adalah antarmuka khusus dalam Cloudian.</i> <br><br>  Sekarang kami tidak memiliki tarif seperti itu di jaringan, tetapi jika Anda benar-benar ingin, kami dapat menyediakannya. <br><br><h2>  Sejarah konstruksi </h2><br>  Kami secara bertahap mendekati bagian yang paling menarik dari sejarah - pembangunan fasilitas penyimpanan.  Akan ada banyak foto, sebanyak tiga upaya untuk mengatur keseimbangan lalu lintas dan beberapa tips buruk.  Saya berharap bahwa analisis masalah yang kami temui di jalan akan bermanfaat bagi mereka yang bersiap untuk bekerja dengan kecepatan 10Gb + di web. <br><br><h3>  Bereksperimen dengan 10G </h3><br>  Sebelum saya langsung menuju inti dari bagian ini, saya membiarkan diri saya membuat penafian kecil lainnya. <br><br>  Menurut tradisi yang sudah mapan, sebelum membeli peralatan bantu baru, kami pergi ke gudang dan memilih komponen yang kurang lebih cocok.  Ini memungkinkan Anda untuk dengan cepat melakukan tes dan memutuskan daftar belanja di masa depan.  Tentu saja, sementara kita tidak mencapai hasil yang dapat diandalkan 100%, tidak ada yang dihabiskan untuk yang produktif. <br><br>  Jadi kali ini.  Dan jika Cisco tidak melempar kejutan, maka dengan load balancers "keserakahan" hampir menghancurkan kita. <br><br><h4>  Pengalaman pertama.  Server Supermicro </h4><br>  Di sini kami dikecewakan oleh keinginan untuk melakukan tes cepat dengan biaya minimal.  Di gudang, kami menemukan server Supermicro yang memiliki segalanya baik-baik saja kecuali kurangnya antarmuka SFP.  Kami memutuskan untuk menginstal Intel 520DA2 tercinta kami pada mereka dan segera menghadapi masalah pertama: mesin adalah unit tunggal, tetapi tidak ada riser.  Pada saat yang sama, untuk beberapa alasan, korps kami tidak ada dalam daftar kompatibilitas, tetapi ada banyak orang yang bangkit. <br><br>  Atas saran direktur pengembangan inovatif, Misha Solovyov, kami menghubungkan semuanya dengan riser fleksibel untuk pertanian pertambangan.  Hasilnya seperti "mayat": <br><br><img src="https://habrastorage.org/webt/lf/wx/t6/lfwxt6csco5ndrm--6qzy4kqfhi.png"><br>  <i>8. Prototipe No. 1</i> <br><br>  Saya harus menggunakan pita listrik biru yang terkenal di beberapa tempat, sehingga, Tuhan melarang, melakukan sesuatu yang singkat.  Ya, pertanian kolektif.  Ya, malu.  Tetapi "konfigurasi" semacam itu cukup dapat diterima untuk periode percobaan. <br><br><img src="https://habrastorage.org/webt/sp/to/af/sptoaf-lv4w_imfhvnro9i12f1y.png"><br>  <i>9. Tampak belakang</i> <br><br>  Apa yang muncul dari ini terlihat jelas di tangkapan layar iperf: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/494/311/900/494311900ac9a09852f260ebbfb4e4b8.png"><br>  <i>10. Sebenarnya ini bukan tangkapan layar :)</i> <br><br>  Metriknya sangat menarik, bukan?  Jadi kami sedih.  Awalnya kami memikirkan mata-mata, kami membongkar dan meluruskan segalanya. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/082/bb2/6ac/082bb26ac22d6de01f22f464b778314b.png"><br>  <i>11. Sekilas, tidak ada chip mata-mata di sini</i> <br><br>  Mereka mengingat jalan fisika: interferensi elektromagnetik, sinyal frekuensi tinggi, dll ... Tentu saja, untuk melanjutkan percobaan dengan kuantitas dan kualitas "pertanian kolektif" tidak masuk akal.  Jadi kami akhirnya membongkar sistem dan mengembalikan server. <br><br><h4>  Pengalaman kedua.  Citrix Netscaler MPX8005 </h4><br>  Dalam proses mengembalikan server ke tempat itu, kami menemukan pahlawan baru: Citrix Netscaler MPX8005.  Ini adalah merek besi yang luar biasa, selain itu, hampir tidak pernah digunakan.  Mereka terlihat seperti ini: <br><br><img src="https://habrastorage.org/webt/dq/v1/va/dqv1vawcvfgpmmijwrie29ewkgy.png"><br>  <i>12. Perosotan di rak tidak sesuai panjangnya, tetapi kami visioner memutuskan untuk menundanya sampai nanti</i> <br><br>  Peralatan ditempatkan di rak, diaktifkan dan dikonfigurasi.  Ini adalah potongan besi "dewasa" yang sangat bagus, 2 slot SFP untuk masing-masing 10GB, HA, algoritme canggih, bahkan ada L7.  Benar, hingga 5 gigabit di bawah lisensi, tetapi kami masih menggunakan L3, tetapi tidak ada batasan seperti itu. <br><br>  Jari juling, tes.  Tidak ada kecepatan.  Pada antarmuka - kesalahan solid tentang transceiver yang tidak cocok, kecepatan sekitar 5 gigabit, tetesan konstan.  Mereka ingat anak tangga yang fleksibel, sedih lagi.  Bahkan di sana, kecepatannya lebih tinggi, dan lebih sedikit kesalahan.  Kami mulai mengerti: <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">show</span></span> channel LA/<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>)  Interface LA/<span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-number"><span class="hljs-number">802.3</span></span>ad Link <span class="hljs-keyword"><span class="hljs-keyword">Aggregate</span></span>) #<span class="hljs-number"><span class="hljs-number">10</span></span>  flags=<span class="hljs-number"><span class="hljs-number">0x4100c020</span></span> &lt;ENABLED, UP, <span class="hljs-keyword"><span class="hljs-keyword">AGGREGATE</span></span>, UP, HAMON, HEARTBEAT, <span class="hljs-number"><span class="hljs-number">802.1</span></span>q&gt;  MTU=<span class="hljs-number"><span class="hljs-number">9000</span></span>, native vlan=<span class="hljs-number"><span class="hljs-number">1</span></span>, MAC=XXX, uptime <span class="hljs-number"><span class="hljs-number">0</span></span>h03m23s  Requested: media <span class="hljs-keyword"><span class="hljs-keyword">NONE</span></span>, speed AUTO, duplex <span class="hljs-keyword"><span class="hljs-keyword">NONE</span></span>, fctl <span class="hljs-keyword"><span class="hljs-keyword">NONE</span></span>,        throughput <span class="hljs-number"><span class="hljs-number">160000</span></span>  Link Redundancy Throughput <span class="hljs-number"><span class="hljs-number">80000</span></span>  Actual: throughput <span class="hljs-number"><span class="hljs-number">20000</span></span>  LLDP Mode: <span class="hljs-keyword"><span class="hljs-keyword">NONE</span></span>  RX: Pkts(<span class="hljs-number"><span class="hljs-number">9388</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">557582</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">1225</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  TX: Pkts(<span class="hljs-number"><span class="hljs-number">10514</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">574232</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">0</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  NIC: InDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) OutDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) Fctls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Hangs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Muted(<span class="hljs-number"><span class="hljs-number">0</span></span>)  bandwidthHigh: <span class="hljs-number"><span class="hljs-number">160000</span></span> Mbits/sec, bandwidthNormal: <span class="hljs-number"><span class="hljs-number">160000</span></span> Mbits/sec.  LA mode: AUTO &gt; <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> interface <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>)  Interface <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-number"><span class="hljs-number">10</span></span>G Ethernet, unsupported fiber SFP+, <span class="hljs-number"><span class="hljs-number">10</span></span> Gbit) #<span class="hljs-number"><span class="hljs-number">1</span></span>  flags=<span class="hljs-number"><span class="hljs-number">0x400c020</span></span> &lt;ENABLED, UP, BOUND <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> LA/<span class="hljs-number"><span class="hljs-number">1</span></span>, UP, autoneg, <span class="hljs-number"><span class="hljs-number">802.1</span></span>q&gt;  LACP &lt;Active, Long timeout, key <span class="hljs-number"><span class="hljs-number">1</span></span>, priority <span class="hljs-number"><span class="hljs-number">32768</span></span>&gt;  MTU=<span class="hljs-number"><span class="hljs-number">9000</span></span>, MAC=XXX, uptime <span class="hljs-number"><span class="hljs-number">0</span></span>h05m44s  Requested: media AUTO, speed AUTO, duplex AUTO, fctl <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>,        throughput <span class="hljs-number"><span class="hljs-number">0</span></span>  Actual: media FIBER, speed <span class="hljs-number"><span class="hljs-number">10000</span></span>, duplex <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>, fctl <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>, throughput <span class="hljs-number"><span class="hljs-number">10000</span></span>  LLDP Mode: TRANSCEIVER,    LR Priority: <span class="hljs-number"><span class="hljs-number">1024</span></span>  RX: Pkts(<span class="hljs-number"><span class="hljs-number">8921</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">517626</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">585</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  TX: Pkts(<span class="hljs-number"><span class="hljs-number">9884</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">545408</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">3</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  NIC: InDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) OutDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) Fctls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Hangs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Muted(<span class="hljs-number"><span class="hljs-number">0</span></span>)  Bandwidth thresholds are <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>. &gt; <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> interface <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>)  Interface <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-number"><span class="hljs-number">10</span></span>G Ethernet, unsupported fiber SFP+, <span class="hljs-number"><span class="hljs-number">10</span></span> Gbit) #<span class="hljs-number"><span class="hljs-number">0</span></span>  flags=<span class="hljs-number"><span class="hljs-number">0x400c020</span></span> &lt;ENABLED, UP, BOUND <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> LA/<span class="hljs-number"><span class="hljs-number">1</span></span>, UP, autoneg, <span class="hljs-number"><span class="hljs-number">802.1</span></span>q&gt;  LACP &lt;Active, Long timeout, key <span class="hljs-number"><span class="hljs-number">1</span></span>, priority <span class="hljs-number"><span class="hljs-number">32768</span></span>&gt;  MTU=<span class="hljs-number"><span class="hljs-number">9000</span></span>, MAC=XXX, uptime <span class="hljs-number"><span class="hljs-number">0</span></span>h05m58s  Requested: media AUTO, speed AUTO, duplex AUTO, fctl <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>,        throughput <span class="hljs-number"><span class="hljs-number">0</span></span>  Actual: media FIBER, speed <span class="hljs-number"><span class="hljs-number">10000</span></span>, duplex <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>, fctl <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>, throughput <span class="hljs-number"><span class="hljs-number">10000</span></span>  LLDP Mode: TRANSCEIVER,    LR Priority: <span class="hljs-number"><span class="hljs-number">1024</span></span>  RX: Pkts(<span class="hljs-number"><span class="hljs-number">8944</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">530975</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">911</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  TX: Pkts(<span class="hljs-number"><span class="hljs-number">10819</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">785347</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">3</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  NIC: InDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) OutDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) Fctls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Hangs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Muted(<span class="hljs-number"><span class="hljs-number">0</span></span>)  Bandwidth thresholds are <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>.</code> </pre> <br><br>  Kami menggunakan transceiver asli Cisco, yang secara teori, tidak ada masalah yang muncul.  Mereka bahkan memeriksa optik dan, untuk berjaga-jaga, mengubah transceiver - gambar yang sama.  Mobil kami tidak pergi, dan hanya itu!  Kami melihat lebih dekat. <br><br>  Transceiver Cisco "Cantik": <br><br><pre> <code class="hljs vhdl">ix1: &lt;Intel(R) PRO/<span class="hljs-number"><span class="hljs-number">10</span></span>GbE PCI-Express Network Driver, Version - <span class="hljs-number"><span class="hljs-number">2.7</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>xe000-<span class="hljs-number"><span class="hljs-number">0</span></span>xe01f mem <span class="hljs-number"><span class="hljs-number">0</span></span>xf7800000-<span class="hljs-number"><span class="hljs-number">0</span></span>xf781ffff,<span class="hljs-number"><span class="hljs-number">0</span></span>xf7840000-<span class="hljs-number"><span class="hljs-number">0</span></span>xf7843fff irq <span class="hljs-number"><span class="hljs-number">17</span></span> at device <span class="hljs-number"><span class="hljs-number">0.1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> pci1 ix1: ixgbe <span class="hljs-keyword"><span class="hljs-keyword">bus</span></span> speed = <span class="hljs-number"><span class="hljs-number">5.0</span></span>Gbps <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> PCIe lane <span class="hljs-literal"><span class="hljs-literal">width</span></span> = <span class="hljs-number"><span class="hljs-number">8</span></span> SFP+/SFP, vendor CISCO-AVAGO , part number XXX , <span class="hljs-number"><span class="hljs-number">10</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x10 <span class="hljs-number"><span class="hljs-number">1</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x00 CT <span class="hljs-number"><span class="hljs-number">0</span></span>x00 *** Unsupported SFP+/SFP <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>!</code> </pre> <br><br>  Transceiver tidak terdeteksi secara normal, tidak didukung! <br><br>  Saya harus menemukan "kerabat" yang paling banyak: <br><br><img src="https://habrastorage.org/webt/wi/-i/sw/wi-iswj9672s8q0skvpw4s3s2xw.png"><br>  <i>13. Transceiver paling asli di barat liar</i> <br><br><pre> <code class="hljs powershell">ix0: &lt;Intel(R) PRO/<span class="hljs-number"><span class="hljs-number">10</span></span>GbE PCI<span class="hljs-literal"><span class="hljs-literal">-Express</span></span> Network Driver, Version - <span class="hljs-number"><span class="hljs-number">2.7</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>&gt; port <span class="hljs-number"><span class="hljs-number">0</span></span>xe020<span class="hljs-literal"><span class="hljs-literal">-0xe03f</span></span> mem <span class="hljs-number"><span class="hljs-number">0</span></span>xf7820000<span class="hljs-literal"><span class="hljs-literal">-0xf783ffff</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>xf7844000<span class="hljs-literal"><span class="hljs-literal">-0xf7847fff</span></span> irq <span class="hljs-number"><span class="hljs-number">16</span></span> at device <span class="hljs-number"><span class="hljs-number">0.0</span></span> on pci1 platform: Manufacturer Citrix Inc. platform: NSMPX<span class="hljs-literal"><span class="hljs-literal">-8000</span></span><span class="hljs-literal"><span class="hljs-literal">-10G</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>*CPU+<span class="hljs-number"><span class="hljs-number">6</span></span>*E1K+<span class="hljs-number"><span class="hljs-number">2</span></span>*IX+<span class="hljs-number"><span class="hljs-number">1</span></span>*E1K+<span class="hljs-number"><span class="hljs-number">4</span></span>*CVM <span class="hljs-number"><span class="hljs-number">1620</span></span> <span class="hljs-number"><span class="hljs-number">675320</span></span> (<span class="hljs-number"><span class="hljs-number">28</span></span>), manufactured at <span class="hljs-number"><span class="hljs-number">8</span></span>/<span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">2015</span></span> platform: serial <span class="hljs-number"><span class="hljs-number">4</span></span>NP602H7H0 platform: sysid <span class="hljs-number"><span class="hljs-number">675320</span></span> - NSMPX<span class="hljs-literal"><span class="hljs-literal">-8000</span></span><span class="hljs-literal"><span class="hljs-literal">-10G</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>*CPU+<span class="hljs-number"><span class="hljs-number">6</span></span>*E1K+<span class="hljs-number"><span class="hljs-number">2</span></span>*IX+<span class="hljs-number"><span class="hljs-number">1</span></span>*E1K+<span class="hljs-number"><span class="hljs-number">4</span></span>*CVM <span class="hljs-number"><span class="hljs-number">1620</span></span> ix0: ixgbe bus speed = <span class="hljs-number"><span class="hljs-number">5.0</span></span>Gbps and PCIe lane width = <span class="hljs-number"><span class="hljs-number">8</span></span> SFP+/SFP, vendor CITRIX           , part number XXX   , <span class="hljs-number"><span class="hljs-number">10</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x10 <span class="hljs-number"><span class="hljs-number">1</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x01 CT <span class="hljs-number"><span class="hljs-number">0</span></span>x00 ix0: [<span class="hljs-type"><span class="hljs-type">ITHREAD</span></span>] <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span>: Ethernet address: <span class="hljs-number"><span class="hljs-number">00</span></span>:e0:ed:<span class="hljs-number"><span class="hljs-number">45</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span>:f8 ix1: &lt;Intel(R) PRO/<span class="hljs-number"><span class="hljs-number">10</span></span>GbE PCI<span class="hljs-literal"><span class="hljs-literal">-Express</span></span> Network Driver, Version - <span class="hljs-number"><span class="hljs-number">2.7</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>&gt; port <span class="hljs-number"><span class="hljs-number">0</span></span>xe000<span class="hljs-literal"><span class="hljs-literal">-0xe01f</span></span> mem <span class="hljs-number"><span class="hljs-number">0</span></span>xf7800000<span class="hljs-literal"><span class="hljs-literal">-0xf781ffff</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>xf7840000<span class="hljs-literal"><span class="hljs-literal">-0xf7843fff</span></span> irq <span class="hljs-number"><span class="hljs-number">17</span></span> at device <span class="hljs-number"><span class="hljs-number">0.1</span></span> on pci1 ix1: ixgbe bus speed = <span class="hljs-number"><span class="hljs-number">5.0</span></span>Gbps and PCIe lane width = <span class="hljs-number"><span class="hljs-number">8</span></span> SFP+/SFP, vendor CITRIX           , part number XXX  , <span class="hljs-number"><span class="hljs-number">10</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x10 <span class="hljs-number"><span class="hljs-number">1</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x01 CT <span class="hljs-number"><span class="hljs-number">0</span></span>x00</code> </pre> <br><br>  Transceiver ini ditentukan tanpa masalah, tetapi ini tidak menyelamatkan situasi.  Firmware yang diperbarui - hal yang sama.  Dukungan Citrix memutuskan untuk diam diam (tidak, bukan karena silsilah transceiver). <br><br>  Kami mengambil napas dalam-dalam dan mengubur spesifikasi perangkat keras.  Ternyata jawabannya selama ini ada di depan mata kita: <i><b>kecepatan bus ixgbe = 5.0Gbps dan lebar jalur PCIe = 8.</b></i> Ini adalah masalah dengan kartu.  Dia sendiri tidak memiliki kecepatan PCIe.  Citrix kami memiliki kinerja maksimum dari slot PCI-e untuk kartu dengan transceiver <i><b>5.0Gbps,</b></i> yang ia <i><b>teriakkan</b></i> kepada kami selama ini.  Seperti halnya Citrix di MPX8015 (perangkat kerasnya persis sama!) Mereka ingin membagikan 15 gigabit, itu tidak jelas.  Tapi kami mengerti mengapa penyeimbang "keren" seperti itu selama ini berada di gudang.  Mereka tidak dapat bekerja dengan benar dengan tautan 10G pada prinsipnya. <br><br><h4>  Pengalaman terakhir.  Kami menggunakan besi yang tepat dan membuatnya indah </h4><br>  Di sini, kesabaran kami berakhir dengan keyakinan kami pada kemanusiaan, dan kami harus menggunakan teknologi "cadangan" untuk mendapatkan perangkat keras normal dalam bentuk HP ProLiant DL360 G9 dari foto di atas.  Mereka tidak mulai mengatur kejutan untuk kami, mereka mengunduh 10G dan tidak mengeluh.  :) <br><br><h2>  Uji beban </h2><br>  Karena kami tidak menerima pendekatan hujak-hujak-dan-produksi, dan kami tahu dari pengalaman bahwa sistem yang tidak diuji setelah perakitan dengan jaminan hampir 100% tidak dapat dioperasikan, kami memutuskan untuk melakukan pengujian beban.  Selain itu, dengan bantuannya Anda dapat melakukan beberapa penyetelan untuk masa depan. <br><br>  Untuk menghasilkan beban, alat yang biasa dipilih - Apache Jmetr.  Itu saja cukup bagus, karena saya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menulis</a> beberapa artikel kembali, dan ini adalah salah satu solusi yang paling fleksibel di pasar, meskipun Jawa suka makan.  Untuk bekerja dengan S3, kami menggunakan modul yang ditulis sendiri menggunakan AWS SDK, juga di Jawa.  Dalam pengujian, kami dapat mencapai kecepatan 12,5 Gbps untuk menulis file lebih dari 250 megabita dengan pemuatan paralel dengan potongan 5 megabita, dan untuk file kurang dari 5 megabita - memproses sekitar 3000 permintaan HTTP per detik.  Saat menjalankan kedua tes secara paralel, ternyata 11 Gigabits dan 2200 permintaan per detik.  Pada saat yang sama, ada kemungkinan meningkatkan pekerjaan dengan beban campuran dan dengan benda-benda kecil.  Kami "mengubur" dalam CPU, dan soket kedua gratis.  Pada generator beban, file uji diambil dari RAM untuk mengecualikan pengaruh pada hasil subsistem disk generator itu sendiri.  Untuk pengujian, mengingat kecintaan Java terhadap RAM dan kebutuhan untuk bekerja dengan sejumlah besar utas selama pemuatan paralel, kami menggunakan server HP DL980 g7 sebagai generator.  Ini adalah server delapan unit dengan 8 prosesor Intel E7-4870 dan RAM 512Gb on board. <br><br>  Di dalam tim, nama panggilan Behemoth yang penuh kasih sayang menempel padanya. <br><br><img src="https://habrastorage.org/webt/yl/ef/wb/ylefwbgvc4ypecxwot1jtcr7yrc.png"><br>  <i>14. Kuda nil kami.</i>  <i>Benar, sesuatu yang mirip?</i> <br><br><img src="https://habrastorage.org/webt/b8/ql/an/b8qlan70ud31dkucw7dt252sbxi.png"><br>  <i>15. Tampak belakang.</i>  <i>Kabel yang menakutkan di bagian tengah bawah adalah koneksi silang dari bus jembatan internal</i> <br><br><img src="https://habrastorage.org/webt/6c/xe/ni/6cxeniwbbzfcuh7e06brn-ko7pe.png"><br>  <i>16. Ini adalah salah satu dari dua tujuan server.</i>  <i>Masing-masing memiliki 4 prosesor dan 16 slot RAM 16 gigabita</i> <br><br><img src="https://habrastorage.org/webt/wx/vt/p9/wxvtp91ap3cdeu0y0kmn9komqwo.png"><br>  <i>17. Untuk menggunakan Htop dengan nyaman di konsol server seperti itu, Anda memerlukan monitor besar :)</i> <br><br>  Dalam prakteknya, tes campuran telah terlihat bahkan memuat server yang sangat kuat. <br>  Untuk mencapai hasil kinerja yang diperoleh, kami harus mentransfer jaringan internal cluster ke frame jumbo 9k dan sedikit menyetel tumpukan jaringan penyeimbang dan simpul kerja (kami menggunakan CentOS Linux), serta mengoptimalkan sejumlah parameter kernel lainnya pada simpul kerja: <br><br><pre> <code class="hljs dos">cat /etc/sysctl.conf … kernel.printk = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> read_ahead_kb = <span class="hljs-number"><span class="hljs-number">1024</span></span> write_expire = <span class="hljs-number"><span class="hljs-number">250</span></span> read_expire = <span class="hljs-number"><span class="hljs-number">250</span></span> fifo_batch = <span class="hljs-number"><span class="hljs-number">128</span></span> front_merges = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.wmem_default = <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.wmem_max = <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.rmem_default = <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.rmem_max = <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.somaxconn = <span class="hljs-number"><span class="hljs-number">5120</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.netdev_max_backlog = <span class="hljs-number"><span class="hljs-number">50000</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_tw_reuse = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_rmem = <span class="hljs-number"><span class="hljs-number">4096</span></span> <span class="hljs-number"><span class="hljs-number">87380</span></span> <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_wmem = <span class="hljs-number"><span class="hljs-number">4096</span></span> <span class="hljs-number"><span class="hljs-number">65536</span></span> <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_slow_start_after_idle = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_max_syn_backlog = <span class="hljs-number"><span class="hljs-number">30000</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_max_tw_buckets = <span class="hljs-number"><span class="hljs-number">2000000</span></span> <span class="hljs-built_in"><span class="hljs-built_in">fs</span></span>.file-max = <span class="hljs-number"><span class="hljs-number">196608</span></span> vm.overcommit_memory = <span class="hljs-number"><span class="hljs-number">1</span></span> vm.overcommit_ratio = <span class="hljs-number"><span class="hljs-number">100</span></span> vm.max_map_count = <span class="hljs-number"><span class="hljs-number">65536</span></span> vm.dirty_ratio = <span class="hljs-number"><span class="hljs-number">40</span></span> vm.dirty_background_ratio = <span class="hljs-number"><span class="hljs-number">5</span></span> vm.dirty_expire_centisecs = <span class="hljs-number"><span class="hljs-number">100</span></span> vm.dirty_writeback_centisecs = <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_fin_timeout=<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_congestion_control=htcp <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.netfilter.ip_conntrack_max=<span class="hljs-number"><span class="hljs-number">1048576</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.rmem_default=<span class="hljs-number"><span class="hljs-number">65536</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.wmem_default=<span class="hljs-number"><span class="hljs-number">65536</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.rmem_max=<span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.wmem_max=<span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.ip_local_port_range=<span class="hljs-number"><span class="hljs-number">1024</span></span> <span class="hljs-number"><span class="hljs-number">65535</span></span></code> </pre> <br><br>  Pengaturan utama yang mengalami penyetelan adalah ukuran buffer, jumlah koneksi jaringan, jumlah koneksi ke port dan koneksi yang dipantau oleh firewall, serta timeout. <br><br>  <b>Cisco C3750 + LACP = sakit</b> <br>  Perangkap lain dalam kinerja jaringan adalah penyeimbangan beban saat menggunakan LACP / LAGp.  Sayangnya, Cisco 3750 tidak dapat menyeimbangkan beban lintas port, hanya pada alamat sumber dan tujuan.  Untuk mencapai keseimbangan lalu lintas yang benar, saya harus menggantung 12 alamat IP pada ikatan-antarmuka dari node yang bekerja, "melihat" ke arah klien.  Persyaratan, 3 untuk setiap tautan fisik.  Dengan konfigurasi ini, dimungkinkan untuk melakukannya tanpa LACP pada antarmuka "eksternal" dari node yang berfungsi, karena semua alamat ditentukan dalam konfigurasi Nginx, tetapi jika tautan itu hilang, kami akan secara otomatis mengurangi bobot simpul dalam balancing.  Dengan "dump", tautan LACP memungkinkan Anda mempertahankan aksesibilitas penuh ke semua alamat. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">RX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">packets</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:2390824140</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errors</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dropped</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">overruns</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">frame</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">TX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">packets</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:947068357</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errors</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dropped</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">overruns</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">carrier</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">collisions</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">txqueuelen</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">RX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bytes</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:18794424755066</span></span> (17<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">TiB</span></span>)  <span class="hljs-selector-tag"><span class="hljs-selector-tag">TX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bytes</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:246433289523</span></span> (229<span class="hljs-selector-class"><span class="hljs-selector-class">.5</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">GiB</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:3</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:6</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:7</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:8</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XXMask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span></code> </pre> <br><br><br><h2>  Pengujian fungsional </h2><br>  Setelah selesai mengerjakan repositori, kami bertemu dengan layanan flexify.io.  Mereka membantu memfasilitasi migrasi antara penyimpanan objek yang berbeda.  Tetapi untuk menjadi mitra Flexify, Anda harus lulus tes serius.  "Kenapa tidak?"  - kami pikir.  Pengujian pihak ketiga selalu merupakan pengalaman yang bermanfaat. <br><br>  Tugas utama dari tes ini adalah untuk memverifikasi operasi metode protokol S3 melalui proksi mereka dalam kaitannya dengan berbagai konfigurasi, di antaranya dapat ada set ember yang kompatibel dengan S3 yang didukung oleh penyedia layanan. <br><br>  Pertama-tama, metode yang bekerja dengan objek dalam ember diperiksa.  Penyimpanan kami diuji menggunakan berbagai macam data uji, perilaku metode diuji untuk objek dengan berbagai ukuran dan konten, untuk kunci yang berisi semua jenis kombinasi karakter Unicode. <br><br>  Dalam tes negatif, mereka mencoba mentransfer data yang tidak valid sedapat mungkin.  Perhatian khusus diberikan pada keamanan data dalam proses. <br><br>  Metode bekerja dengan ember juga telah diuji, tetapi terutama dalam skenario positif.  Tujuan dari tes ini adalah untuk memverifikasi bahwa menggunakan metode melalui proxy tidak memerlukan masalah serius, misalnya, korupsi data atau crash. <br><br>  Luasnya cakupan dapat dinilai dengan tes yang digunakan baik melalui proksi maupun langsung.  Sebagian besar tes, terutama yang bekerja dengan objek, memiliki parameter dan menguji sejumlah besar objek yang berbeda, rentang, dll. <br><br><div class="spoiler">  <b class="spoiler_title">Tes yang diterapkan untuk objek</b> <div class="spoiler_text">  <i>DAPATKAN Permintaan objek tanpa parameter opsional</i> <i><br></i>  <i>DAPATKAN permintaan Objek multithread</i> <i><br></i>  <i>GET Permintaan objek ke objek terenkripsi dengan parameter sse yang disediakan</i> <i><br></i>  <i>GET Permintaan objek ke objek terenkripsi tanpa parameter sse yang disediakan</i> <i><br></i>  <i>GET Permintaan objek dengan rentang yang memotong rentang byte file</i> <i><br></i>  <i>DAPATKAN Permintaan Obyek dengan rentang di luar rentang rentang byte file</i> <i><br></i>  <i>GET Permintaan objek dengan parameter rentang sufiks</i> <i><br></i>  <i>GET Permintaan objek dengan parameter rentang akhiran di luar kisaran kisaran byte file</i> <i><br></i>  <i>GET Permintaan objek dengan parameter rentang tidak valid</i> <i><br></i>  <i>Head Object request ke objek yang ada</i> <i><br></i>  <i>Head Object request ke objek yang baru saja dihapus</i> <i><br></i>  <i>Permintaan Obyek Kepala dengan Kunci yang tidak pernah ada dalam Bucket</i> <i><br></i>  <i>Head Object request ke objek terenkripsi dengan parameter sse yang disediakan</i> <i><br></i>  <i>Head Object request ke objek terenkripsi tanpa parameter sse yang disediakan</i> <i><br></i>  <i>Daftar permintaan objek</i> <i><br></i>  <i>Daftar Objek v2 permintaan</i> <i><br></i>  <i>Daftar permintaan Objek dengan parameter Marker yang disediakan</i> <i><br></i>  <i>Daftar permintaan Objek dengan parameter Awalan yang disediakan</i> <i><br></i>  <i>Daftar permintaan Objek dengan parameter Marker dan Awalan yang disediakan</i> <i><br></i>  <i>Menerima semua objek pada titik akhir dengan Objek Daftar dengan parameter Marker dan Prefiks yang disediakan</i> <i><br></i>  <i>Daftar permintaan objek dengan parameter pembatas dilewati</i> <i><br></i>  <i>Daftar permintaan Objek dengan melewati parameter Marker, tetapi dengan melewati parameter Pembatas</i> <i><br></i>  <i>Daftar permintaan objek dengan lulus awalan yang tidak ada</i> <i><br></i>  <i>Daftar permintaan objek dengan melewati penanda yang tidak ada</i> <i><br></i>  <i>Unggah banyak bagian dengan metode unggahan asli ()</i> <i><br></i>  <i>Unggah banyak bagian dengan metode unggahan asli_fileobj ()</i> <i><br></i>  <i>Unggah multi bagian dengan metode khusus</i> <i><br></i>  <i>Menghentikan unggahan multi bagian dengan metode abort_multipart_upload ()</i> <i><br></i>  <i>Melakukan metode abort_multipart_upload () dengan uploadId yang salah</i> <i><br></i>  <i>Melakukan metode abort_multipart_upload () dengan Kunci salah dan uploadId</i> <i><br></i>  <i>Unggah beberapa file dengan kunci yang sama secara bersamaan.</i>  <i>File ke-2 diunggah sebelum tanggal 1</i> <i><br></i>  <i>Unggah beberapa file dengan kunci yang sama secara bersamaan.</i>  <i>File 1 diunggah sebelum tanggal 2</i> <i><br></i>  <i>Unggah beberapa file dengan kunci yang berbeda secara bersamaan.</i>  <i>File 1 diunggah sebelum tanggal 2</i> <i><br></i>  <i>Unggah multi bagian dengan ukuran bagian 512kb</i> <i><br></i>  <i>Unggahan multi bagian dengan ukuran bagian lebih besar dari ukuran maksimum yang diizinkan</i> <i><br></i>  <i>Mengunggah beberapa file dengan bagian-bagian dengan ukuran berbeda</i> <i><br></i>  <i>Daftar permintaan unggahan multi bagian</i> <i><br></i>  <i>PUT Obyek ACL meminta ke objek dengan id penerima yang disediakan</i> <i><br></i>  <i>DAPATKAN objek ACL meminta ke objek dengan diberikan izin akses tambahan</i> <i><br></i>  <i>Metode Penandaan Objek PUT</i> <i><br></i>  <i>DAPATKAN metode Penandaan Objek</i> <i><br></i>  <i>HAPUS metode Penandaan Objek</i> <i><br></i>  <i>PUT Permintaan objek tanpa parameter opsional</i> <i><br></i>  <i>PUT Object meminta multithread</i> <i><br></i>  <i>PUT Permintaan objek dengan melewati parameter enkripsi opsional</i> <i><br></i>  <i>PUT Permintaan objek dengan melewati parameter Tubuh kosong</i> <i><br></i>  <i>DAPATKAN Objek dengan metode download_file () asli</i> <i><br></i>  <i>DAPATKAN Objek dengan metode download_fileobj () asli</i> <i><br></i>  <i>DAPATKAN Objek dengan metode kustom menggunakan rentang</i> <i><br></i>  <i>DAPATKAN Objek dengan awalan dengan metode download_file asli ()</i> <i><br></i>  <i>DAPATKAN Objek dengan awalan dengan metode download_fileobj () asli</i> <i><br></i>  <i>DAPATKAN Objek dengan awalan dengan metode kustom menggunakan rentang</i> <i><br></i>  <i>HAPUS Permintaan objek ke objek yang ada</i> <i><br></i>  <i>HAPUS Permintaan objek ke objek yang tidak ada</i> <i><br></i>  <i>HAPUS Objek meminta ke grup dengan objek yang ada</i> <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Tes yang disadari untuk bucket</b> <div class="spoiler_text">  <i>Letakkan enkripsi ember</i> <i><br></i>  <i>DAPATKAN Enkripsi Ember</i> <i><br></i>  <i>HAPUS Enkripsi Ember</i> <i><br></i>  <i>Permintaan Kebijakan Bucket PUT</i> <i><br></i>  <i>DAPATKAN Permintaan Kebijakan Bucket ke ember dengan Kebijakan</i> <i><br></i>  <i>HAPUS Permintaan Kebijakan Bucket ke ember dengan Kebijakan</i> <i><br></i>  <i>DAPATKAN Permintaan Kebijakan Bucket ke ember tanpa Kebijakan</i> <i><br></i>  <i>HAPUS Permintaan Kebijakan Bucket ke ember tanpa Kebijakan</i> <i><br></i>  <i>Pasang penandaan ember</i> <i><br></i>  <i>Dapatkan pemberian tag ember</i> <i><br></i>  <i>HAPUS Tagging Ember</i> <i><br></i>  <i>Buat permintaan bucket dengan nama bucket yang ada</i> <i><br></i>  <i>Buat permintaan bucket dengan nama bucket unik</i> <i><br></i>  <i>Hapus permintaan bucket dengan nama bucket yang ada</i> <i><br></i>  <i>Hapus permintaan bucket dengan nama bucket unik</i> <i><br></i>  <i>PUT Bucket ACL meminta ke bucket dengan id penerima yang disediakan</i> <i><br></i>  <i>DAPATKAN objek ACL meminta ke objek dengan diberikan izin akses tambahan</i> <br></div></div><br><br>  Seperti yang Anda duga, ini adalah tes yang cukup sulit, tetapi kami lulus secara umum dengan positif.  Beberapa masalah muncul karena kurangnya dukungan untuk SSE dan sekolah kecil dengan dukungan Unicode pada waktu itu: <br><br>  Gagal memuat dengan kunci yang mengandung: <br><br><ul><li>  U + 0000-U + 001F - 32 karakter kontrol pertama yang tidak dapat dibaca.  Di Amazon, misalnya, hanya U + 0000 pertama yang tidak dituangkan secara langsung. <br></li></ul><br><ul><li>  Dan juga U + 18D7C, U + 18DA8, U + 18DB4, U + 18DBA, U + 18DC4, U + 18DCE.  Ini juga karakter yang tidak dapat dibaca, tetapi Amazon menerimanya sebagai kunci.  Tidak ada masalah dengan semua karakter lainnya. <br></li></ul><br>  Saat membaca isi ember, ada masalah pada kunci 66.675, yang berisi simbol U + FFFE.  Tidak mungkin mendapatkan daftar kunci lengkap dalam ember yang berisi objek dengan kunci semacam itu. <br><br>  Kalau tidak, pengujiannya berhasil, dan pada akhir September kami muncul dalam daftar pemasok yang tersedia! <br><br><h2>  Kata penutup dan bonus pendek untuk pembaca </h2><br>  Sebelumnya, saya menulis bahwa Cloudian HyperStore, meskipun memiliki banyak kelebihan, praktis tidak tercakup dalam segmen Internet berbahasa Rusia. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel pertama</a> adalah tentang dasar-dasar bekerja dengan Cloudian.  Kami membongkar struktur internal, nuansa arsitektur, dan membaca terjemahan dokumentasi resmi. <br><br>  Hari ini saya memberi tahu bagaimana kami membangun penyimpanan kami sendiri dan nuansa serta perangkap apa yang kami temui. <br><br>  Anda yang ingin menyentuh dengan pena apa yang kita bicarakan 2 artikel berturut-turut dapat menggunakan formulir umpan balik <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di halaman ini</a> dan secara pribadi mencari tahu apa garamnya.  Sebagai standar, kami memberikan 15Gb selama 2 minggu gratis, tentu saja, dengan akses pengguna.  Jika Anda memiliki keinginan untuk membagikan kesan Anda tentang bekerja dengan repositori, tuliskan kepada saya di PM.  :) <br><br>  Dan bagi mereka yang tidak cukup 15 Gb selama 2 minggu, kami memiliki <b>pencarian kecil!</b>  Dalam foto-foto di artikel itu, kami menempatkan tiga kuda nil.  50 orang pertama yang menemukannya akan menerima 30Gb selama 4 minggu.  Untuk mendapatkan tes yang diperbesar, tulis komentar di nomor gambar tempat kuda nil bersembunyi, dan ajukan tautan di atas.  Jangan lupa untuk menyertakan tautan ke komentar Anda dalam aplikasi. <br><br>  Secara tradisi, jika Anda memiliki pertanyaan, tanyakan di komentar. <br>  Saya akan dengan senang hati menjawabnya. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id425973/">https://habr.com/ru/post/id425973/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id425963/index.html">Stasiun cuaca di Arduino dari A hingga Z. Bagian 4</a></li>
<li><a href="../id425965/index.html">SAP Data Management Suite sebagai kompleks untuk bekerja dengan Big Data di perusahaan</a></li>
<li><a href="../id425967/index.html">Chainsaw Silicon Massacre</a></li>
<li><a href="../id425969/index.html">Bagaimana saya akan menjadi pengembang web ... dan akankah saya?</a></li>
<li><a href="../id425971/index.html">Ada bukti keberadaan chip mata-mata di server Supermicro</a></li>
<li><a href="../id425975/index.html">Ubah kata dan frasa menjadi anagram</a></li>
<li><a href="../id425977/index.html">Flexbox: seberapa besar kotak fleksibel ini?</a></li>
<li><a href="../id425981/index.html">Karier Pemula di LK: Melompat dan maju perlahan-lahan tumbuh maju</a></li>
<li><a href="../id425983/index.html">Keamanan penerbangan</a></li>
<li><a href="../id425985/index.html">Eksekusi Kode Kustom di GO</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>