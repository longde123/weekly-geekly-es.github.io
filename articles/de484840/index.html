<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§öüèø ‚úåüèΩ üòÖ GOTO Return üìû üí≤ üßìüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Jetzt versteht jeder, dass die Verwendung des GOTO-Operators nicht nur schlecht, sondern auch schrecklich ist. Die Debatte √ºber seine Verwendung endet...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GOTO Return</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484840/"><p> Jetzt versteht jeder, dass die Verwendung des GOTO-Operators nicht nur schlecht, sondern auch schrecklich ist.  Die Debatte √ºber seine Verwendung endete in den 80er Jahren des 20. Jahrhunderts und wurde von den meisten modernen Programmiersprachen ausgeschlossen.  Aber wie es sich f√ºr ein echtes √úbel geh√∂rt, hat er es geschafft, sich zu verkleiden und im 21. Jahrhundert unter dem Deckmantel von Ausnahmen wiederzubeleben. </p><a name="habracut"></a><br><p>  Ausnahmen sind zum einen ein recht einfaches Konzept in modernen Programmiersprachen.  Andererseits werden sie h√§ufig falsch verwendet.  Es gibt eine einfache und bekannte Regel - Ausnahmen gelten nur f√ºr den Umgang mit Sch√§den.  Und eine zu lockere Auslegung des Begriffs ‚ÄûZusammenbruch‚Äú f√ºhrt zu allen Problemen bei der Verwendung von GOTO. </p><br><h2 id="teoreticheskiy-primer">  Theoretisches Beispiel </h2><br><p>  Der Unterschied zwischen Pannen und negativen Gesch√§ftsszenarien wird im Anmeldefenster anhand eines sehr einfachen Anwendungsfalls deutlich: </p><br><ol><li>  Benutzer gibt Login / Passwort ein. </li><li>  Der Benutzer klickt auf die Schaltfl√§che "Anmelden". </li><li>  Die Clientanwendung sendet eine Anforderung an den Server. </li><li>  Der Server √ºberpr√ºft erfolgreich den Benutzernamen / das Passwort (das Vorhandensein des entsprechenden Paares wird als Erfolg gewertet). </li><li>  Der Server sendet Informationen an den Client, dass die Authentifizierung erfolgreich war, und einen Link zur √úbergangsseite. </li><li>  Der Client geht zur angegebenen Seite. </li></ol><br><p>  Und eine negative Erweiterung: </p><br><p>  4.1.  Der Server hat das entsprechende Login / Passwort-Paar nicht gefunden und sendet eine entsprechende Benachrichtigung an den Client. </p><br><p>  Zu ber√ºcksichtigen, dass Szenario 4.1 ein ‚ÄûProblem‚Äú ist und daher mit einer Ausnahme implementiert werden muss, ist ein ziemlich h√§ufiger Fehler.  Dies ist eigentlich nicht der Fall.  Nicht √ºbereinstimmende Anmeldedaten und Kennw√∂rter geh√∂ren zu unserer Standardbenutzererfahrung, die sich aus der Gesch√§ftslogik des Skripts ergibt.  Unsere Gesch√§ftskunden erwarten diese Entwicklung.  Daher handelt es sich nicht um eine Aufschl√ºsselung, und Sie k√∂nnen hier keine Ausnahmen verwenden. </p><br><p>  Pannen sind: Unterbrechung der Verbindung zwischen Client und Norden, Unzug√§nglichkeit des DBMS, fehlerhaftes Schema in der Datenbank.  Und noch eine Million Gr√ºnde, die unsere Anwendungen besch√§digen und nichts mit der Gesch√§ftslogik des Benutzers zu tun haben. </p><br><p>  In einem der Projekte, an deren Entwicklung ich beteiligt war, gab es eine komplexere Anmeldelogik.  Durch dreimaliges Eingeben des falschen Passworts wurde der Benutzer vor√ºbergehend f√ºr 15 Minuten gesperrt.  Wenn der Benutzer drei Mal hintereinander eine tempor√§re Sperre erh√§lt, erh√§lt er eine permanente Sperre.  Es gab auch zus√§tzliche Regeln je nach Benutzertyp.  Die Implementierung von Ausnahmen hat die Einf√ºhrung neuer Regeln extrem erschwert. </p><br><p>  Es w√§re interessant, dieses Beispiel zu betrachten, aber es ist zu gro√ü und nicht sehr visuell.  Wie klar und pr√§gnant es wird, Code mit Gesch√§ftslogik in Bezug auf Ausnahmen zu verwechseln, zeige ich Ihnen an einem anderen Beispiel. </p><br><h2 id="primer-zagruzka-svoystv">  Beispiel Laden von Eigenschaften </h2><br><p>  Versuchen Sie, sich diesen Code anzusehen und klar zu verstehen, was er bewirkt.  Die Prozedur ist mit einer ziemlich einfachen Logik nicht gro√ü.  Bei einem guten Programmierstil sollte das Verst√§ndnis der Essenz nicht l√§nger als 2-3 Minuten dauern (ich kann mich nicht erinnern, wie lange ich gebraucht habe, um diesen Code vollst√§ndig zu verstehen, aber definitiv l√§nger als 15 Minuten). </p><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WorkspaceProperties</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ Properties loadedProperties = readPropertiesFromFile(WORK_PROPERTIES_PATH, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-comment"><span class="hljs-comment">//These mappings will replace any mappings that this hashtable had for any of the //keys currently in the specified map. getProperties().putAll( loadedProperties ); //     loadedProperties = readPropertiesFromFile(MY_WORK_PROPERTIES_PATH, false); if (loadedProperties != null){ getProperties().putAll( loadedProperties ); } System.out.println("Loaded properties:" + getProperties()); } /** *  ,    . * @param filepath * @param throwIfNotFound -  FileNotFoundException,     * @return    null,      !throwIfNotFound * @throws FileNotFoundException throwIfNotFound        * @throws IOException     */ private Properties readPropertiesFromFile(String filepath, boolean throwIfNotExists){ Properties loadedProperties = new Properties(); System.out.println("Try loading workspace properties" + filepath); InputStream is = null; InputStreamReader isr = null; try{ int loadingTryLeft = 3; String relativePath = ""; while (loadingTryLeft &gt; 0){ try{ File file = new File(relativePath + filepath); is = new FileInputStream(file); isr = new InputStreamReader( is, "UTF-8"); loadedProperties.load(isr); loadingTryLeft = 0; } catch( FileNotFoundException e) { loadingTryLeft -= 1; if (loadingTryLeft &gt; 0) relativePath += "../"; else throw e; } finally { if (is != null) is.close(); if (isr != null) isr.close(); } } System.out.println("Found file " + filepath); } catch( FileNotFoundException e) { System.out.println("File not found " + filepath); if (throwIfNotExists) throw new RuntimeException("Can`t load workspace properties." + filepath + " not found", e ); }catch (IOException e){ throw new RuntimeException("Can`t read " + filepath, e); } return loadedProperties; }</span></span></code> </pre> <br><p>  Lassen Sie uns also das Geheimnis enth√ºllen - was hier passiert.  Die Eigenschaften aus zwei Dateien werden <code>WORK_PROPERTIES</code> - die erforderlichen <code>WORK_PROPERTIES</code> und die zus√§tzlichen <code>MY_WORK_PROPERTIES</code> , die zum allgemeinen Eigenschaftenspeicher hinzugef√ºgt werden.  Es gibt eine Nuance: Wir wissen nicht genau, wo sich die spezifische Eigenschaftendatei befindet. Sie kann sowohl im aktuellen Verzeichnis als auch in den Ahnenverzeichnissen liegen (bis zu drei Ebenen h√∂her). </p><br><p>  Mindestens zwei Dinge sind hier verwirrend: der <code>throwIfNotExists</code> Parameter und der gro√üe <code>catch FileNotFoundException</code> in <code>catch FileNotFoundException</code> .  All diese undurchsichtigen Hinweise - Ausnahmen werden zur Implementierung der Gesch√§ftslogik verwendet (aber wie l√§sst sich sonst erkl√§ren, dass das Ausl√∂sen einer Ausnahme in einem Szenario ein Fehler ist und in dem anderen nicht?). </p><br><h2 id="delaem-pravilnyy-kontrakt">  Den richtigen Vertrag schlie√üen </h2><br><p>  Zuerst besch√§ftigen <code>throwIfNotExists</code> mit <code>throwIfNotExists</code> .  Wenn Sie mit Ausnahmen arbeiten, ist es sehr wichtig zu wissen, wo genau diese in Bezug auf Anwendungsf√§lle verarbeitet werden m√ºssen.  In diesem Fall kann die Methode <code>readPropertiesFromFile</code> offensichtlich nicht selbst entscheiden, wann das Fehlen einer Datei ‚Äûschlecht‚Äú und wann sie ‚Äûgut‚Äú ist.  Eine solche Entscheidung wird zum Zeitpunkt ihres Aufrufs getroffen.  Die Kommentare zeigen, dass wir entscheiden, ob diese Datei existieren soll oder nicht.  Tats√§chlich interessiert uns aber nicht die Datei selbst, sondern die Einstellungen daraus.  Dies folgt leider nicht aus dem Code. </p><br><p>  Wir beheben diese beiden M√§ngel: </p><br><pre> <code class="java hljs">Properties loadedProperties = readPropertiesFromFile(WORK_PROPERTIES_PATH); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadedProperties.isEmpty()) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">"Can`t load workspace properties"</span></span>); } loadedProperties = readPropertiesFromFile(MY_WORK_PROPERTIES_PATH); getProperties().putAll( loadedProperties );</code> </pre> <br><p>  Jetzt wird die Semantik klar dargestellt - <br>  <code>WORK_PROPERTIES</code> muss angegeben werden, <code>MY_WORK_PROPERTIES</code> nicht angegeben werden.  Au√üerdem habe ich beim Refactoring festgestellt, dass <code>readPropertiesFromFile</code> niemals <code>null</code> und dies beim Lesen von <code>MY_WORK_PROPERTIES</code> . </p><br><h2 id="proveryaem-ne-lomaya">  Wir pr√ºfen ohne zu brechen </h2><br><p>  Vorheriges Refactoring wirkte sich ebenfalls auf die Implementierung aus, jedoch nicht wesentlich.  Ich habe gerade den <code>throwIfNotExists</code> Verarbeitungsblock gel√∂scht: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (throwIfNotExists) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(‚Ä¶);</code> </pre> <br><p>  Nachdem wir die Implementierung genauer untersucht haben, beginnen wir, die Logik des Autors des Codes f√ºr die Suche nach einer Datei zu verstehen.  Zuerst wird √ºberpr√ºft, ob sich die Datei im aktuellen Verzeichnis befindet. Wenn sie nicht gefunden wird, √ºberpr√ºfen wir sie auf einer h√∂heren Ebene usw.  Das hei√üt  Es wird deutlich, dass der Algorithmus das Fehlen einer Datei vorsieht.  In diesem Fall erfolgt die Pr√ºfung mit einer Ausnahme.  Das hei√üt  Das Prinzip wird verletzt - die Ausnahme wird nicht als ‚Äûetwas ist kaputt gegangen‚Äú, sondern als Teil der Gesch√§ftslogik wahrgenommen. </p><br><p>  Es gibt eine Funktion zum √úberpr√ºfen der Verf√ºgbarkeit einer Datei zum Lesen von <code>File.canRead()</code> .  Mit ihr k√∂nnen Sie die Gesch√§ftslogik in einem <code>catch</code> loswerden <code>catch</code> </p><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ File file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(relativePath + filepath); is = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(file); isr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader( is, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); loadedProperties.load(isr); loadingTryLeft = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>( FileNotFoundException e) { loadingTryLeft -= <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) relativePath += <span class="hljs-string"><span class="hljs-string">"../"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e; } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) is.close(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isr != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) isr.close(); } }</code> </pre> <br><p>  Wenn wir den Code √§ndern, erhalten wir Folgendes: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Properties </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readPropertiesFromFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String filepath)</span></span></span><span class="hljs-function"> </span></span>{ Properties loadedProperties = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Properties(); System.out.println(<span class="hljs-string"><span class="hljs-string">"Try loading workspace properties"</span></span> + filepath); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> loadingTryLeft = <span class="hljs-number"><span class="hljs-number">3</span></span>; String relativePath = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { File file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(relativePath + filepath); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.canRead()) { InputStream is = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; InputStreamReader isr = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { is = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(file); isr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(is, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); loadedProperties.load(isr); loadingTryLeft = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) is.close(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isr != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) isr.close(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { loadingTryLeft -= <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { relativePath += <span class="hljs-string"><span class="hljs-string">"../"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileNotFoundException(); } } } System.out.println(<span class="hljs-string"><span class="hljs-string">"Found file "</span></span> + filepath); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (FileNotFoundException e) { System.out.println(<span class="hljs-string"><span class="hljs-string">"File not found "</span></span> + filepath); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">"Can`t read "</span></span> + filepath, e); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loadedProperties; }</code> </pre> <br><p>  Ich habe auch die Ebene der Variablen ( <code>is</code> , <code>isr</code> ) auf das zul√§ssige Minimum reduziert. </p><br><p>  Ein solches einfaches Refactoring verbessert die Lesbarkeit des Codes erheblich.  Der Code zeigt den Algorithmus direkt an (wenn die Datei vorhanden ist, lesen wir sie, andernfalls reduzieren wir die Anzahl der Versuche und sehen im obigen Verzeichnis nach). </p><br><h2 id="vyyavlyaem-goto">  GOTO enth√ºllen </h2><br><p>  √úberlegen Sie im Detail, was in einer Situation passiert, in der die Datei nicht gefunden wurde: </p><br><pre> <code class="java hljs">} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { loadingTryLeft -= <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { relativePath += <span class="hljs-string"><span class="hljs-string">"../"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileNotFoundException(); } }</code> </pre> <br><p>  Es ist ersichtlich, dass hier die Ausnahme verwendet wird, um den Ausf√ºhrungszyklus zu unterbrechen und die GOTO-Funktion tats√§chlich auszuf√ºhren. </p><br><p>  F√ºr Zweifler werden wir eine weitere √Ñnderung vornehmen.  Anstatt eine kleine Kr√ºcke im Format <code>loadingTryLeft = 0</code> (Kr√ºcke, da ein erfolgreicher Versuch <code>loadingTryLeft = 0</code> Anzahl der verbleibenden Versuche nicht <code>loadingTryLeft = 0</code> ), weisen wir ausdr√ºcklich darauf hin, dass das Lesen der Datei zum Verlassen der Funktion f√ºhrt (ohne zu vergessen, eine Nachricht zu schreiben): </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { is = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(file); isr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(is, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); loadedProperties.load(isr); System.out.println(<span class="hljs-string"><span class="hljs-string">"Found file "</span></span> + filepath); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loadedProperties; } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> {</code> </pre> <br><p>  Dies erm√∂glicht es uns, die <code>while (loadingTryLeft &gt; 0)</code> Bedingung <code>while (loadingTryLeft &gt; 0)</code> durch <code>while(true)</code> zu ersetzen: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> loadingTryLeft = <span class="hljs-number"><span class="hljs-number">3</span></span>; String relativePath = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { File file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(relativePath + filepath); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.canRead()) { InputStream is = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; InputStreamReader isr = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { is = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(file); isr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(is, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); loadedProperties.load(isr); System.out.println(<span class="hljs-string"><span class="hljs-string">"Found file "</span></span> + filepath); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loadedProperties; } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) is.close(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isr != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) isr.close(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { loadingTryLeft -= <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { relativePath += <span class="hljs-string"><span class="hljs-string">"../"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileNotFoundException(); <span class="hljs-comment"><span class="hljs-comment">// GOTO: FFN } } } } catch (FileNotFoundException e) { // LABEL: FFN System.out.println("File not found " + filepath); } catch (IOException e) { throw new RuntimeException("Can`t read " + filepath, e); }</span></span></code> </pre> <br><p>  Um den offensichtlichen √ºblen <code>throw new FileNotFoundException</code> , m√ºssen Sie sich an den Funktionsvertrag erinnern.  In jedem Fall gibt die Funktion eine Reihe von Eigenschaften zur√ºck. Konnten sie die Datei nicht lesen, geben wir sie leer zur√ºck.  Daher gibt es keinen Grund, eine Ausnahme auszul√∂sen und abzufangen.  Die √ºbliche <code>while (loadingTryLeft &gt; 0)</code> Bedingung <code>while (loadingTryLeft &gt; 0)</code> reicht aus: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Properties </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readPropertiesFromFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String filepath)</span></span></span><span class="hljs-function"> </span></span>{ Properties loadedProperties = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Properties(); System.out.println(<span class="hljs-string"><span class="hljs-string">"Try loading workspace properties"</span></span> + filepath); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> loadingTryLeft = <span class="hljs-number"><span class="hljs-number">3</span></span>; String relativePath = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { File file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(relativePath + filepath); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.canRead()) { InputStream is = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; InputStreamReader isr = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { is = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(file); isr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(is, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); loadedProperties.load(isr); System.out.println(<span class="hljs-string"><span class="hljs-string">"Found file "</span></span> + filepath); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loadedProperties; } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) is.close(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isr != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) isr.close(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { loadingTryLeft -= <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) relativePath += <span class="hljs-string"><span class="hljs-string">"../"</span></span>; } } System.out.println(<span class="hljs-string"><span class="hljs-string">"file not found"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">"Can`t read "</span></span> + filepath, e); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loadedProperties; }</code> </pre> <br><p>  Im Prinzip ist vom Standpunkt der korrekten Arbeit mit Ausnahmen alles hier.  Es besteht ein Zweifel daran, dass bei IOException-Problemen eine RuntimeException ausgel√∂st werden muss, diese wird jedoch aus Gr√ºnden der Kompatibilit√§t beibehalten. </p><br><h2 id="navodim-losk">  Bringen Sie Glanz </h2><br><p>  Es gibt noch ein paar Kleinigkeiten, mit denen wir den Code noch flexibler und verst√§ndlicher machen k√∂nnen: </p><br><ul><li>  Der readPropertiesFromFile-Methodenname macht seine Implementierung verf√ºgbar (√ºbrigens und l√∂st FileNotFoundException aus).  Besser, es neutraler und pr√§gnanter zu nennen - loadProperties (...) </li><li>  Die Methode sucht und liest gleichzeitig.  F√ºr mich sind dies zwei unterschiedliche Verantwortlichkeiten, die sich in verschiedene Methoden einteilen lassen. </li><li>  Der Code wurde urspr√ºnglich unter Java 6 geschrieben, wird jetzt jedoch in Java 7 verwendet. Dies erm√∂glicht die Verwendung von schlie√übaren Ressourcen. </li><li>  Ich wei√ü aus Erfahrung, dass es beim Anzeigen von Informationen zu einer gefundenen oder nicht gefundenen Datei besser ist, den vollst√§ndigen Pfad zur Datei zu verwenden, als den relativen. </li><li> <code>if (loadingTryLeft &gt; 0) relativePath += "../";</code>  - Wenn Sie sich den Code genau ansehen, k√∂nnen Sie feststellen, dass diese Pr√ºfung nicht erforderlich ist, da  Wenn das Suchlimit ersch√∂pft ist, wird der neue Wert sowieso nicht verwendet.  Und wenn der Code etwas √úberfl√ºssiges enth√§lt, sollte dieser M√ºll entfernt werden. </li></ul><br><p>  Die endg√ºltige Version des Quellcodes: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WorkspaceProperties</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Properties()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (defaultInstance != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalStateException(); Properties loadedProperties = readPropertiesFromFile(WORK_PROPERTIES_PATH); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadedProperties.isEmpty()) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">"Can`t load workspace properties"</span></span>); } getProperties().putAll(loadedProperties); loadedProperties = readPropertiesFromFile(MY_WORK_PROPERTIES_PATH); getProperties().putAll(loadedProperties); System.out.println(<span class="hljs-string"><span class="hljs-string">"Loaded properties:"</span></span> + getProperties()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Properties </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readPropertiesFromFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String filepath)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">"Try loading workspace properties"</span></span> + filepath); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> loadingTryLeft = <span class="hljs-number"><span class="hljs-number">3</span></span>; String relativePath = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { File file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(relativePath + filepath); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.canRead()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read(file); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { relativePath += <span class="hljs-string"><span class="hljs-string">"../"</span></span>; loadingTryLeft -= <span class="hljs-number"><span class="hljs-number">1</span></span>; } } System.out.println(<span class="hljs-string"><span class="hljs-string">"file not found"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">"Can`t read "</span></span> + filepath, e); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Properties(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Properties </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(File file)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> (InputStream is = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(file); InputStreamReader isr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(is, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)) { Properties loadedProperties = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Properties(); loadedProperties.load(isr); System.out.println(<span class="hljs-string"><span class="hljs-string">"Found file "</span></span> + file.getAbsolutePath()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loadedProperties; } }</code> </pre> <br><h2 id="rezyume">  Zusammenfassung </h2><br><p>  Das analysierte Beispiel zeigt deutlich, wozu sorgloser Umgang mit dem Quellcode f√ºhrt.  Anstatt eine Ausnahme zum Behandeln der Aufschl√ºsselung zu verwenden, wurde beschlossen, sie zum Implementieren der Gesch√§ftslogik zu verwenden.  Dies f√ºhrte sofort zu einer Komplexit√§t der Unterst√ºtzung, die sich in der Weiterentwicklung zur Erf√ºllung neuer Anforderungen und damit in einer Abkehr von den Grunds√§tzen der strukturellen Programmierung niederschlug.  Die Verwendung einer einfachen Regel - Ausnahmen nur f√ºr Pannen - hilft Ihnen dabei, nicht in die GOTO-√Ñra zur√ºckzukehren und Ihren Code sauber, verst√§ndlich und erweiterbar zu halten. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de484840/">https://habr.com/ru/post/de484840/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de484824/index.html">Der Krieg um das Licht auszuschalten</a></li>
<li><a href="../de484826/index.html">K√ºnstliche Intelligenz verschlimmert die schlechte Medizin noch mehr</a></li>
<li><a href="../de484834/index.html">Wie man eine Unternehmensstrategie f√ºr Training und Entwicklung entwickelt</a></li>
<li><a href="../de484836/index.html">Berechnung der Rentabilit√§t aus dem Gr√ºnen Tarif 2020, Ukraine</a></li>
<li><a href="../de484838/index.html">13 Beispiele f√ºr das Einrichten von Regeln in Google Ads [Anleitung]</a></li>
<li><a href="../de484846/index.html">Meine Beziehung zu Open Source</a></li>
<li><a href="../de484854/index.html">F√ºhren Sie das Spiel in C # unter MS-DOS aus</a></li>
<li><a href="../de484860/index.html">Implementierungsname und Ergebnisname</a></li>
<li><a href="../de484862/index.html">Migration von AngularJS nach Angular7 √ºber eine Hybridanwendung</a></li>
<li><a href="../de484866/index.html">Verwenden von Astra Linux auf einem ARM Embedded-Computer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>