<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßñüèø üåÖ üà∏ Terraform Provider Selectel ü•õ üïäÔ∏è üå∂Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wir haben den offiziellen Terraform-Anbieter f√ºr die Zusammenarbeit mit Selectel gestartet. Mit diesem Produkt k√∂nnen Benutzer das Ressourcenmanagemen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Terraform Provider Selectel</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/445162/"><img src="https://habrastorage.org/webt/yf/si/pf/yfsipfz7j0lfweuvzxwwqzqr94a.png"><br><br>  Wir haben den offiziellen Terraform-Anbieter f√ºr die Zusammenarbeit mit Selectel gestartet.  Mit diesem Produkt k√∂nnen Benutzer das Ressourcenmanagement mithilfe der Infrastructure-as-Code-Methode vollst√§ndig implementieren. <br><a name="habracut"></a><br>  Derzeit unterst√ºtzt der Anbieter die Ressourcenverwaltung des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">Virtual Private Cloud-Dienstes</a> (im Folgenden als VPC bezeichnet).  In Zukunft planen wir, das Ressourcenmanagement anderer von Selectel bereitgestellter Dienste zu erweitern. <br><br>  Wie Sie bereits wissen, basiert der VPC-Dienst auf OpenStack.  Aufgrund der Tatsache, dass OpenStack keine nativen Tools f√ºr die Wartung der √∂ffentlichen Cloud bereitstellt, haben wir die fehlenden Funktionen in einer Reihe zus√§tzlicher APIs implementiert, die die Verwaltung komplexer zusammengesetzter Objekte vereinfachen und die Arbeit vereinfachen.  Ein Teil der in OpenStack verf√ºgbaren Funktionen ist f√ºr die direkte Verwendung gesperrt, kann jedoch √ºber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">unsere API aufgerufen werden</a> . <br><br>  Der Selectel Terraform-Anbieter bietet jetzt die M√∂glichkeit, die folgenden VPC-Ressourcen zu verwalten: <br><br><ul><li>  Projekte und ihre Quoten; </li><li>  Benutzer, ihre Rollen und Token; </li><li>  √∂ffentliche Subnetze, einschlie√ülich √ºberregionaler und VRRP; </li><li>  Softwarelizenzen. </li></ul><br>  Der Anbieter verwendet unsere √∂ffentliche Go-Bibliothek, um mit der VPC-API zu arbeiten.  Sowohl die Bibliothek als auch der Anbieter selbst sind Open Source, sie werden auf Github entwickelt: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">Go-selvpcclient</a> Bibliotheksrepository, </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">Terraform-Provider Selectel-Provider-</a> Repository. </li></ul><br>  Zum Verwalten anderer Cloud-Ressourcen wie virtueller Maschinen, Festplatten und Kubernetes-Cluster k√∂nnen Sie den OpenStack Terraform-Anbieter verwenden.  Die offizielle Dokumentation f√ºr beide Anbieter finden Sie unter folgenden Links: <br><br><ul><li>  Selectel Ressourcendokumentation: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">Terraform-Anbieter Selectel</a> , </li><li>  OpenStack-Ressourcendokumentation: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow noopener noreferrer">Terraform-Anbieter OpenStack</a> . </li></ul><br><h2>  Erste Schritte </h2><br>  Um zu beginnen, m√ºssen Sie Terraform installieren (Anweisungen und Links zu Installationspaketen finden Sie auf der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow noopener noreferrer">offiziellen Website</a> ). <br><br>  Zum Arbeiten ben√∂tigt der Anbieter den Selectel-API-Schl√ºssel, der in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">der</a> Systemsteuerung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">f√ºr das Konto erstellt wird</a> . <br><br>  Manifeste f√ºr die Arbeit mit Selectel werden mit Terraform oder mit einer Reihe vorgefertigter Beispiele erstellt, die in unserem Github-Repository verf√ºgbar sind: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">Terraform-Beispiele</a> . <br><br>  Das Repository mit Beispielen ist in zwei Verzeichnisse unterteilt: <br><br><ul><li>  <strong>Module</strong> , die kleine wiederverwendbare Module enthalten, die eine Reihe von Parametern als Eingabe verwenden und eine kleine Reihe von Ressourcen verwalten; </li><li>  <strong>Beispiele</strong> mit Beispielen eines vollst√§ndigen Satzes miteinander verbundener Module. </li></ul><br>  Nachdem Sie Terraform installiert, einen Selectel-API-Schl√ºssel erstellt und sich mit Beispielen vertraut gemacht haben, fahren wir mit praktischen Beispielen fort. <br><br><h2>  Beispiel f√ºr die Erstellung eines Servers mit einer lokalen Festplatte </h2><br>  Betrachten Sie das Beispiel zum Erstellen eines Projekts, eines Benutzers mit einer Rolle und einer virtuellen Maschine mit einer lokalen Festplatte: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">terraform-examples / examples / vpc / server_local_root_disk</a> . <br><br>  Die Datei <strong>vars.tf</strong> beschreibt alle Parameter, die beim Aufrufen der Module verwendet werden.  Einige von ihnen haben Standardwerte, z. B. wird der Server in der <strong>ru-3a-</strong> Zone mit der folgenden Konfiguration erstellt: <br><br><pre><code class="bash hljs">variable <span class="hljs-string"><span class="hljs-string">"server_vcpus"</span></span> { default = 4 } variable <span class="hljs-string"><span class="hljs-string">"server_ram_mb"</span></span> { default = 8192 } variable <span class="hljs-string"><span class="hljs-string">"server_root_disk_gb"</span></span> { default = 8 } variable <span class="hljs-string"><span class="hljs-string">"server_image_name"</span></span> { default = <span class="hljs-string"><span class="hljs-string">"Ubuntu 18.04 LTS 64-bit"</span></span> }</code> </pre> <br>  In der Datei <b>main.tf</b> wird der Selectel-Anbieter initialisiert: <br><br><pre> <code class="bash hljs">provider <span class="hljs-string"><span class="hljs-string">"selectel"</span></span> { token = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.sel_token}</span></span></span><span class="hljs-string">"</span></span> }</code> </pre><br>  Diese Datei enth√§lt auch den Standardwert f√ºr den SSH-Schl√ºssel, der auf dem Server installiert wird: <br><br><pre> <code class="bash hljs">module <span class="hljs-string"><span class="hljs-string">"server_local_root_disk"</span></span> { ... server_ssh_key = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${file("~/.ssh/id_rsa.pub")}</span></span></span><span class="hljs-string">"</span></span> }</code> </pre><br>  Bei Bedarf k√∂nnen Sie einen anderen √∂ffentlichen Schl√ºssel angeben.  Der Schl√ºssel muss nicht als Pfad zur Datei angegeben werden. Sie k√∂nnen auch einen Wert als Zeichenfolge hinzuf√ºgen. <br><br>  Weiter in dieser Datei werden die Module <strong>project_with_user</strong> und <strong>server_local_root_disk</strong> gestartet, die die erforderlichen Ressourcen verwalten. <br><br>  Wir werden diese Module genauer analysieren. <br><br><h3>  Erstellen eines Projekts und eines Benutzers mit einer Rolle </h3><br>  Das erste Modul erstellt ein Projekt und einen Benutzer mit einer Rolle in diesem Projekt: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">terraform-examples / modules / vpc / project_with_user</a> . <br><br>  Der erstellte Benutzer kann sich bei OpenStack anmelden und seine Ressourcen verwalten.  Das Modul ist einfach und verwaltet nur drei Entit√§ten: <br><br><ul><li>  selectel_vpc_project_v2, </li><li>  selectel_vpc_user_v2, </li><li>  selectel_vpc_role_v2. </li></ul><br><h3>  Erstellen eines virtuellen Servers mit einer lokalen Festplatte </h3><br>  Das zweite Modul verwaltet die OpenStack-Objekte, die zum Erstellen eines Servers mit einer lokalen Festplatte erforderlich sind. <br><br>  Sie sollten einige der Argumente beachten, die in diesem Modul f√ºr die Ressource <strong>openstack_compute_instance_v2 angegeben</strong> sind: <br><br><pre> <code class="bash hljs">resource <span class="hljs-string"><span class="hljs-string">"openstack_compute_instance_v2"</span></span> <span class="hljs-string"><span class="hljs-string">"instance_1"</span></span> { ... lifecycle { ignore_changes = [<span class="hljs-string"><span class="hljs-string">"image_id"</span></span>] } vendor_options { ignore_resize_confirmation = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre><br>  Mit <strong>dem</strong> Argument <strong>ignore_changes</strong> k√∂nnen <strong>Sie</strong> die √Ñnderung des <strong>ID-</strong> Attributs f√ºr das Image ignorieren, das zum Erstellen der virtuellen Maschine verwendet wird.  Im VPC-Dienst werden die meisten √∂ffentlichen Bilder einmal pro Woche automatisch aktualisiert, und ihre <strong>ID</strong> √§ndert sich ebenfalls.  Dies liegt an den Funktionen der OpenStack-Glance-Komponente, in der Bilder als unver√§nderliche Einheiten betrachtet werden. <br><br>  Wenn ein vorhandener Server oder eine vorhandene Festplatte erstellt oder ge√§ndert wird, wobei die <strong>ID des</strong> √∂ffentlichen Abbilds als Argument f√ºr <strong>image_id verwendet wird</strong> , wird nach dem Aktualisieren dieses Abbilds durch Neustart des Terraform-Manifests der Server oder die Festplatte neu erstellt.  Die Verwendung des Arguments <strong>ignore_changes</strong> vermeidet diese Situation. <br><br>  <em>Hinweis:</em> <strong><em>Das</em></strong> <em>Argument</em> <strong><em>ignore_changes wurde</em></strong> <em>vor langer Zeit in Terraform</em> <strong><em>angezeigt</em></strong> <em>:</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">pull # 2525</a> <em>.</em> <br><br>  Das Argument <strong>ignore_resize_confirmation wird</strong> ben√∂tigt, um die Gr√∂√üe der lokalen Festplatte, der Kerne oder des <strong>Serverspeichers</strong> erfolgreich zu √§ndern.  Solche √Ñnderungen werden √ºber die OpenStack Nova-Komponente mithilfe der <b>Gr√∂√üen√§nderungsanforderung vorgenommen</b> .  Standardm√§√üig versetzt Nova nach einer <b>Gr√∂√üen√§nderungsanforderung</b> den Server in <b>den</b> Status " <b>verify_resize</b> " und wartet auf eine zus√§tzliche Best√§tigung durch den Benutzer.  Dieses Verhalten kann jedoch ge√§ndert werden, sodass Nova nicht auf zus√§tzliche Aktionen des Benutzers wartet. <br><br>  Mit dem angegebenen Argument kann Terraform nicht auf den Status <b>verify_resize</b> f√ºr den Server warten und darauf vorbereitet sein, dass der Server nach √Ñnderung seiner Parameter im aktiven Status ist.  Das Argument ist ab Version 1.10.0 des OpenStack Terraform-Anbieters verf√ºgbar: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">Pull # 422</a> . <br><br><h3>  Ressourcenerstellung </h3><br>  Vor dem Starten von Manifesten sollte beachtet werden, dass in unserem Beispiel zwei verschiedene Anbieter gestartet werden und der OpenStack-Anbieter von den Ressourcen des Selectel-Anbieters abh√§ngt, da es unm√∂glich ist, dazugeh√∂rige Objekte zu verwalten, ohne einen Benutzer im Projekt zu erstellen.  Aus dem gleichen Grund k√∂nnen wir den <strong>Befehl terraform apply</strong> in unserem Beispiel leider nicht einfach ausf√ºhren.  Wir m√ºssen uns zuerst f√ºr das Modul <strong>project_with_user</strong> und danach f√ºr alles andere <strong>bewerben</strong> . <br><br>  <em>Hinweis: Dieses Problem wurde in Terraform noch nicht behoben. Sie k√∂nnen die Diskussion zu Github in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">Ausgabe 2430</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">Ausgabe 4149</a> verfolgen.</em> <br><br>  Um Ressourcen zu erstellen, gehen wir zum <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">Verzeichnis terraform-examples / examples / vpc / server_local_root_disk. Der</a> Inhalt sollte folgenderma√üen aussehen: <br><br><pre> <code class="bash hljs">$ ls README.md main.tf vars.tf</code> </pre><br>  Wir initialisieren die Module mit dem Befehl: <br><br><pre> <code class="bash hljs">$ terraform init</code> </pre><br>  Die Ausgabe zeigt, dass Terraform die neuesten Versionen der verwendeten Anbieter herunterl√§dt und alle im Beispiel beschriebenen Module √ºberpr√ºft. <br><br>  <strong>Wenden Sie zun√§chst das</strong> Modul <strong>project_with_user an</strong> .  In diesem Fall m√ºssen Sie die Werte f√ºr Variablen, die nicht festgelegt wurden, manuell √ºbertragen: <br><br><ul><li>  <strong>sel_account</strong> mit Ihrer Selectel-Kontonummer; </li><li>  <strong>sel_token</strong> mit Ihrem Schl√ºssel f√ºr die Selectel-API; </li><li>  <strong>user_password</strong> mit Passwort f√ºr den OpenStack-Benutzer. </li></ul><br>  Die Werte f√ºr die ersten beiden Variablen m√ºssen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">dem Bedienfeld</a> entnommen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">werden</a> . <br><br>  F√ºr die letzte Variable k√∂nnen Sie sich ein beliebiges Passwort vorstellen. <br><br>  Um das Modul zu verwenden, m√ºssen die Werte <strong>SEL_ACCOUNT</strong> , <strong>SEL_TOKEN</strong> und <strong>USER_PASSWORD durch</strong> Ausf√ºhren des folgenden Befehls ersetzt werden: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply -target=module.project_with_user</code> </pre><br>  Nach dem Ausf√ºhren des Befehls Terraform wird angezeigt, welche Ressourcen erstellt werden sollen, und es muss eine Best√§tigung erforderlich sein: <br><br><pre> <code class="bash hljs">Plan: 3 to add, 0 to change, 0 to destroy. Do you want to perform these actions? Terraform will perform the actions described above. Only <span class="hljs-string"><span class="hljs-string">'yes'</span></span> will be accepted to approve. Enter a value: yes</code> </pre><br>  Sobald das Projekt, der Benutzer und die Rolle erstellt wurden, k√∂nnen Sie mit dem Erstellen der verbleibenden Ressourcen beginnen: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply</code> </pre><br>  Achten Sie beim Erstellen von Ressourcen auf die Terraform-Ausgabe mit einer externen IP-Adresse, unter der auf den erstellten Server zugegriffen werden kann: <br><br><pre> <code class="bash hljs">module.server_local_root_disk.openstack_networking_floatingip_associate_v2.association_1: Creating... floating_ip: <span class="hljs-string"><span class="hljs-string">""</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"xxxx"</span></span></code> </pre><br>  Sie k√∂nnen mit der erstellten virtuellen Maschine √ºber SSH unter der angegebenen IP-Adresse arbeiten. <br><br><h3>  Ressourcenbearbeitung </h3><br>  Sie k√∂nnen nicht nur Ressourcen √ºber Terraform erstellen, sondern auch √§ndern. <br><br>  Erh√∂hen Sie beispielsweise die Anzahl der Kerne und den Speicher f√ºr unseren Server, indem Sie die Werte f√ºr die <strong>Parameter</strong> <strong>server_vcpus</strong> und <strong>server_ram_mb</strong> in der <strong>Datei examples / vpc / server_local_root_disk / main.tf √§ndern</strong> : <br><br><pre> <code class="bash hljs">- server_vcpus = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.server_vcpus}</span></span></span><span class="hljs-string">"</span></span> - server_ram_mb = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.server_ram_mb}</span></span></span><span class="hljs-string">"</span></span> + server_vcpus = 8 + server_ram_mb = 10240</code> </pre><br>  Danach √ºberpr√ºfen wir mit dem folgenden Befehl, zu welchen √Ñnderungen dies f√ºhren wird: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform plan</code> </pre><br>  Infolgedessen nahm Terraform √Ñnderungen an den Ressourcen <strong>openstack_compute_instance_v2</strong> und <strong>openstack_compute_flavor_v2 vor</strong> . <br><br>  <em>Bitte beachten Sie, dass dies zu einem Neustart der erstellten virtuellen Maschine f√ºhrt.</em> <br><br>  Verwenden Sie zum Anwenden der neuen Konfiguration der virtuellen Maschine den <strong>Befehl terraform apply</strong> , den wir bereits zuvor ausgef√ºhrt haben. <br><br>  Alle erstellten Objekte werden in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">der VPC-Systemsteuerung</a> angezeigt: <br><br><img src="https://habrastorage.org/webt/eq/e5/3a/eqe53anrxqpnpd6qn7hlcrnuxec.png"><br><br>  In unserem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">Beispiel-Repository sehen</a> Sie auch Manifeste zum Erstellen virtueller Maschinen mit Netzwerklaufwerken. <br><br><h2>  Beispiel f√ºr einen Kubernetes-Cluster </h2><br>  Bevor wir mit dem n√§chsten Beispiel fortfahren, werden die zuvor erstellten Ressourcen gel√∂scht.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">F√ºhren</a> Sie dazu im Projektstamm <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">terraform-examples / examples / vpc / server_local_root_disk</a> den Befehl zum L√∂schen von OpenStack-Objekten aus: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform destroy -target=module.server_local_root_disk</code> </pre><br>  F√ºhren Sie als N√§chstes den Befehl Selectel VPC API Object Cleanup aus: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform destroy -target=module.project_with_user</code> </pre><br>  In beiden F√§llen m√ºssen Sie das L√∂schen aller Objekte best√§tigen: <br><br><pre> <code class="bash hljs">Do you really want to destroy all resources? Terraform will destroy all your managed infrastructure, as shown above. There is no undo. Only <span class="hljs-string"><span class="hljs-string">'yes'</span></span> will be accepted to confirm. Enter a value: yes</code> </pre><br>  Das folgende Beispiel befindet sich im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">Verzeichnis terraform-examples / examples / vpc / kubernetes_cluster</a> . <br><br>  In diesem Beispiel wird ein Projekt erstellt, ein Benutzer mit einer Rolle im Projekt, und ein Kubernetes-Cluster wird ausgel√∂st.  In der Datei <strong>vars.tf</strong> sehen Sie die Standardwerte wie die Anzahl der Knoten, ihre Eigenschaften, die Version von Kubernetes und vieles mehr. <br><br>  Um Ressourcen zu erstellen, initialisieren wir √§hnlich wie im ersten Beispiel zun√§chst die Module und erstellen die <strong>Modulressourcen project_with_user.</strong> Anschlie√üend erstellen Sie den Rest: <br><br><pre> <code class="bash hljs">$ terraform init $ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply -target=module.project_with_user $ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply</code> </pre><br>  Wir geben die Erstellung und Verwaltung von Kubernetes-Clustern √ºber die OpenStack Magnum-Komponente weiter.  Weitere Informationen zum Arbeiten mit einem Cluster finden Sie in einem unserer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">vorherigen Artikel</a> sowie in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">der Wissensdatenbank</a> . <br><br>  W√§hrend der Clustervorbereitung werden Festplatten und virtuelle Maschinen erstellt und alle erforderlichen Komponenten installiert.  Die Vorbereitung dauert ca. 4 Minuten. Zu diesem Zeitpunkt zeigt Terraform Meldungen des Formulars an: <br><br><pre> <code class="bash hljs">module.kubernetes_cluster.openstack_containerinfra_cluster_v1.cluster_1: Still creating... (3m0s elapsed)</code> </pre><br>  Nach Abschluss der Installation informiert Terraform Sie, dass der Cluster bereit ist, und zeigt seine Kennung an: <br><br><pre> <code class="bash hljs">module.kubernetes_cluster.openstack_containerinfra_cluster_v1.cluster_1: Creation complete after 4m20s (ID: 3c8...) Apply complete! Resources: 6 added, 0 changed, 0 destroyed.</code> </pre><br>  Um den erstellten Kubernetes-Cluster √ºber das Dienstprogramm kubectl zu verwalten, m√ºssen <strong>Sie</strong> die Clusterzugriffsdatei erhalten.  Wechseln Sie dazu zu dem √ºber Terraform erstellten Projekt in der Liste der Projekte in Ihrem Konto: <br><br><img src="https://habrastorage.org/webt/pp/7y/rt/pp7yrtw_q-79pkx1j6mr5ebbsyi.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Folgen Sie als</a> N√§chstes dem Link des Formulars <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">xxxxxx.selvpc.ru</a> , das unter dem Projektnamen angezeigt wird: <br><br><img src="https://habrastorage.org/webt/yr/in/wk/yrinwkfne83cenropq9t3szxt6c.png"><br><br>  Verwenden Sie den Benutzernamen und das Kennwort, die √ºber Terraform erstellt wurden, als Anmeldeinformationen.  Wenn Sie in unserem Beispiel weder <strong>vars.tf</strong> noch <strong>main.tf ge√§ndert</strong> haben, hat der Benutzer den Namen <strong>tf_user</strong> .  Verwenden Sie als Kennwort den Wert der Variablen <strong>TF_VAR_user_password</strong> , der angegeben wurde, als <strong>terraform apply</strong> fr√ºher ausgef√ºhrt wurde. <br><br>  Innerhalb des Projekts m√ºssen Sie zur Registerkarte <strong>Kubernetes</strong> wechseln: <br><br><img src="https://habrastorage.org/webt/ft/bp/dj/ftbpdjhjrgxkgzomuxegaujj3wu.png"><br><br>  Hier ist ein Cluster, der √ºber Terraform erstellt wurde.  Sie k√∂nnen die Datei f√ºr <strong>kubectl</strong> auf der Registerkarte "Zugriff" herunterladen: <br><br><img src="https://habrastorage.org/webt/y_/pe/ov/y_peovkv0kjznzx95c_vw4wc-4e.png"><br><br>  Die gleiche Registerkarte enth√§lt Anweisungen zum Installieren von <strong>kubectl</strong> und zum Verwenden der heruntergeladenen <strong>Datei config.yaml</strong> . <br><br>  Nachdem Sie <strong>kubectl gestartet</strong> und die Umgebungsvariable <strong>KUBECONFIG festgelegt haben, k√∂nnen</strong> Sie Kubernetes verwenden: <br><br><pre> <code class="bash hljs">$ kubectl get pods --all-namespaces NAMESPACE NAME READY STATUS RESTARTS AGE kube-system coredns-9578f5c87-g6bjf 1/1 Running 0 8m kube-system coredns-9578f5c87-rvkgd 1/1 Running 0 6m kube-system heapster-866fcbc879-b6998 1/1 Running 0 8m kube-system kube-dns-autoscaler-689688988f-8cxhf 1/1 Running 0 8m kube-system kubernetes-dashboard-7bdb5d4cd7-jcjq9 1/1 Running 0 8m kube-system monitoring-grafana-84c97bb64d-tc64b 1/1 Running 0 8m kube-system monitoring-influxdb-7c8ccc75c6-dzk5f 1/1 Running 0 8m kube-system node-exporter-tf-cluster-rz6nggvs4va7-minion-0 1/1 Running 0 8m kube-system node-exporter-tf-cluster-rz6nggvs4va7-minion-1 1/1 Running 0 8m kube-system openstack-cloud-controller-manager-8vrmp 1/1 Running 3 8m prometeus-monitoring grafana-76bcb7ffb8-4tm7t 1/1 Running 0 8m prometeus-monitoring prometheus-75cdd77c5c-w29gb 1/1 Running 0 8m</code> </pre><br>  Die Anzahl der Clusterknoten kann einfach √ºber Terraform ge√§ndert werden. <br>  Der folgende Wert ist in der Datei <strong>main.tf</strong> angegeben: <br><br><pre> <code class="bash hljs">cluster_node_count = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.cluster_node_count}</span></span></span><span class="hljs-string">"</span></span></code> </pre><br><p>  Dieser Wert wird durch <strong>vars.tf ersetzt</strong> : </p><br><br><pre> <code class="bash hljs">variable <span class="hljs-string"><span class="hljs-string">"cluster_node_count"</span></span> { default = 2 }</code> </pre><br>  Sie k√∂nnen entweder den Standardwert in <strong>vars.tf √§ndern</strong> oder den erforderlichen Wert direkt in <strong>main.tf angeben</strong> : <br><br><pre> <code class="bash hljs">- cluster_node_count = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.cluster_node_count}</span></span></span><span class="hljs-string">"</span></span> + cluster_node_count = 3</code> </pre><br>  Verwenden Sie den <strong>Befehl terraform apply,</strong> um die √Ñnderungen wie im ersten Beispiel <strong>anzuwenden</strong> : <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply</code> </pre><br>  Wenn sich die Anzahl der Knoten √§ndert, bleibt der Cluster verf√ºgbar.  Nachdem Sie einen Knoten √ºber Terraform hinzugef√ºgt haben, k√∂nnen Sie ihn ohne zus√§tzliche Konfiguration verwenden: <br><br><pre> <code class="bash hljs">$ kubectl get nodes NAME STATUS ROLES AGE VERSION tf-cluster-rz6nggvs4va7-master-0 Ready,SchedulingDisabled master 8m v1.12.4 tf-cluster-rz6nggvs4va7-minion-0 Ready &lt;none&gt; 8m v1.12.4 tf-cluster-rz6nggvs4va7-minion-1 Ready &lt;none&gt; 8m v1.12.4 tf-cluster-rz6nggvs4va7-minion-2 Ready &lt;none&gt; 3m v1.12.4</code> </pre><br><h2>  Fazit </h2><br>  In diesem Artikel haben wir die grundlegenden M√∂glichkeiten f√ºr die Arbeit mit der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">"Virtual Private Cloud"</a> √ºber Terraform kennengelernt.  Wir freuen uns, wenn Sie den offiziellen Terraform-Anbieter Selectel nutzen und Feedback geben. <br><br>  Alle gefundenen Fehler des Terraform-Anbieters Selectel k√∂nnen √ºber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">Github-Probleme</a> gemeldet werden. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de445162/">https://habr.com/ru/post/de445162/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de445152/index.html">Was kann man sonst noch bei der Suche tun? Yandex-Bericht</a></li>
<li><a href="../de445154/index.html">Digitale Veranstaltungen in Moskau vom 25. bis 31. M√§rz</a></li>
<li><a href="../de445156/index.html">Glenmark Kompaktvernebler: eine n√ºtzliche Sache im Alltag</a></li>
<li><a href="../de445158/index.html">Optimale Teileorientierung und Support-Konfiguration im 3D-Drucker</a></li>
<li><a href="../de445160/index.html">Wir entwickeln eine Pedal-Firmware, um das Balalaika-Spielen zu lernen</a></li>
<li><a href="../de445164/index.html">Ausgewogene Site-Leistung. Teil 5: Benutzerfreundlichkeit</a></li>
<li><a href="../de445166/index.html">Alles, was Sie √ºber CSS Auto Silbentrennung wissen m√ºssen</a></li>
<li><a href="../de445168/index.html">Ein idealer Lebenslauf, der von einem Personalvermittler und Arbeitgeber begr√º√üt wird</a></li>
<li><a href="../de445170/index.html">Drei gro√üe L√ºgen √ºber JavaScript</a></li>
<li><a href="../de445172/index.html">Edge-Browser mit Chromium wurden auf Datei-Hosting-Diensten angezeigt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>