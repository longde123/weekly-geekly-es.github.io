<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôèüèΩ üçï ü§õüèº Java para Playstation 2 - √© poss√≠vel? üëçüèø ü§µüèæ ü§µüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Introdu√ß√£o 
 Com este projeto, eu queria responder uma pergunta: √© poss√≠vel escrever uma API Java para Playstation 2 e criar uma demonstra√ß√£o gr√°fi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Java para Playstation 2 - √© poss√≠vel?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423751/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a7/fd3/7b6/7a7fd37b645e7bd2c38240c53a9ab6a5.jpg" alt="imagem"></div><br><h2>  1. Introdu√ß√£o </h2><br>  Com este projeto, eu queria responder uma pergunta: √© poss√≠vel escrever uma API Java para Playstation 2 e criar uma demonstra√ß√£o gr√°fica nela.  Eu n√£o quero revelar os spoilers, mas a resposta √© sim. <br><br>  Alguns anos atr√°s, iniciei um projeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Java Grinder</a> que recebe arquivos .class Java compilados e realmente funciona como um desmontador.  Mas, em vez de desmontar no c√≥digo do assembler Java, ele desmonta no c√≥digo-fonte do assembler para processadores reais.  Se o arquivo de classe precisar de outros arquivos de classe, eles tamb√©m ser√£o lidos e processados.  Todas as chamadas de m√©todo da API s√£o gravadas na sa√≠da, como c√≥digo do assembler interno ou como chamadas para fun√ß√µes pr√©-gravadas que executam a tarefa pretendida. <br><a name="habracut"></a><br>  Como o <a href="">Java Grinder</a> foi escrito em C ++, orientado a objetos, abstra√≠do, polim√≥rfico e muitas outras palavras favoritas de RH de alto perfil, para expandi-lo, foi necess√°rio principalmente criar a classe Playstation2, expandindo a nova classe R5900, expandindo a classe principal Generator. <br><br>  Como resultado, o projeto acabou sendo maior do que eu esperava.  O sistema em si √© bastante simples, mas ainda tenho muito a aprender, e encontrar informa√ß√µes de qualidade n√£o √© t√£o simples.  De fato, pela primeira vez neste projeto, iniciei programa√ß√£o 3D real.  Em outro post, eu j√° falei sobre o que aprendi na minha p√°gina de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">programa√ß√£o do Playstation 2</a> . <br><br>  Abaixo est√° um v√≠deo e uma explica√ß√£o detalhada do processo de desenvolvimento. <br><br><h2>  V√≠deo </h2><br><iframe width="560" height="315" src="https://www.youtube.com/embed/AjM069oKUGs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Gravei uma demo em um PS2 slim conectando cabos de √°udio e v√≠deo a um gravador de DVD.  Fiquei um pouco preocupado que o PS2 tivesse algum tipo de prote√ß√£o Macrovision que estragaria o sinal de v√≠deo, mas foi desligado ou o gravador de DVD o ignorou.  O v√≠deo come√ßa com uma demonstra√ß√£o do Playstation 2 real, que executa uma demonstra√ß√£o.  O console est√° conectado a um sinal composto ao conversor VGA, conectado a um monitor LCD, provando que a demonstra√ß√£o est√° sendo executada em uma m√°quina real.  Ent√£o eu adicionei uma colagem com o v√≠deo real gravado diretamente do PS2 no gravador de DVD. <br><br>  YouTube: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://youtu.be/AjM069oKUGs</a> <br><br><h2>  Projetos similares em mikekohn.net </h2><br><table><tbody><tr><td>  Moedor de Java: </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Playstation 2 Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sega Genesis Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Apple IIgs Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">TI99 / 4A Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">C64 Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dsPIC Mandelbrots</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Atari 2600 Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">chipKIT Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Java Grinder</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">naken_asm</a> </td></tr></tbody></table><br><h2>  Demo </h2><br>  Lembrando da demonstra√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Java</a> da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sega Genesis</a> , lamento um pouco que n√£o tenha tornado mais interessante.  Ent√£o, foi mais interessante para mim demonstrar os recursos da API Java.  Quando iniciei este projeto, decidi fazer algo mais s√©rio.  Infelizmente, novamente fiquei t√£o esgotado no processo de estudar o sistema e criar a API que n√£o tinha for√ßa suficiente para uma grande demonstra√ß√£o. <br><br><ul><li>  Logotipo de 3 bilh√µes de dispositivos: s√£o os 3 bilh√µes de dispositivos de baixa resolu√ß√£o que executam o logotipo Java que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Joe Davisson</a> criou para sua demo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Java do Commodore 64</a> . </li><li>  Logotipos: desenhei-os com um marcador e os digitalizei (com exce√ß√£o do logotipo Java). </li><li>  Estrelas: Na verdade, copiei o c√≥digo da demonstra√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Java Sega Genesis</a> e modifiquei-o para funcionar com a API do Playstation 2.  O texto aqui tamb√©m √© escrito com um marcador e digitalizado. </li><li>  Fractais de Mandelbrot: s√£o demonstrados usando a unidade vetorial 0, que calcula fractais, e a unidade vetorial 1 executa c√°lculos 3D.  O MIPS controla o que os dois dispositivos vetoriais fazem. </li><li>  Cubos: desenhei esses cubos no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Wings3d</a> e escrevi o c√≥digo C para converter arquivos STL em matrizes que o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Java Grinder</a> poderia usar.  Eu adicionei cores manualmente. </li><li>  Anel de quadrados: apenas uma tentativa de desenhar muitos objetos em movimento na tela.  Provavelmente valia a pena adicionar mais objetos antes que o sistema come√ßasse a desacelerar. </li></ul><br><h2>  M√∫sica </h2><br>  Para a demo, compus e gravei tr√™s m√∫sicas, mas como resultado usei apenas duas.  A primeira composi√ß√£o √© na verdade uma melodia que eu escrevi para outro projeto publicado no meu site ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">projeto aceitador de moedas</a> ) cerca de um ano atr√°s ... inicialmente havia apenas uma parte.  Depois que o projeto foi conclu√≠do, pensei que seria interessante colocar um solo de guitarra e, ap√≥s a grava√ß√£o, imaginei que essa m√∫sica tocasse enquanto as estrelas voassem na demo.  S√≥ consegui us√°-lo depois de alguns meses.  O viol√£o na composi√ß√£o √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fender Strat I scalloped</a> . <br><br>  Gravei a segunda composi√ß√£o apenas um dia antes da publica√ß√£o do artigo.  O solo da guitarra soa um pouco ... b√™bado, porque √© tocado em uma guitarra que eu me <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tornei irritada</a> .  Eu n√£o sou muito bom em toc√°-lo, e as notas agudas desaparecem muito rapidamente, mas os slides soam bem legais.  A parte r√≠tmica foi tocada no meu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">kit Yngwie</a> Wanna-Be (Squier Strat barato e de vieiras, DOD YJM308 overdrive e Mini-Marshall alimentado por baterias de 9 volts). <br><br>  Programei bateria para ambas as composi√ß√µes usando o programa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Drums ++,</a> escrito h√° muito.  Ele recebe arquivos de texto de entrada gravados no meu pr√≥prio idioma e os transforma em arquivos .mid, importados para a Apple Garage Band, ap√≥s o qual voc√™ pode gravar faixas de base e de guitarra.  Os arquivos de origem <a href="">fretless.dpp</a> e <a href="">shoebox.dpp</a> est√£o na pasta de ativos do meu reposit√≥rio de demonstra√ß√£o. <br><br>  A m√∫sica √© reproduzida pelo Playstation 2 SPU2 e, gra√ßas ao R5900, ele pode fazer outros trabalhos.  Devido √† falta de boa documenta√ß√£o, quase terminei a demo sem nenhuma m√∫sica.  Mais sobre isso abaixo. <br><br>  Aqui est√£o duas faixas no formato MP3: <br><br><ul><li>  <a href="">shoebox_full.mp3</a> </li><li>  <a href="">fretless.mp3</a> </li></ul><br><h2>  Desenvolvimento </h2><br>  O projeto foi desenvolvido por um longo tempo.  Comecei a adicionar as instru√ß√µes do R5900 Emotion Engine ao assembler do MIPS em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">naken_asm e</a> , em seguida, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">procurei</a> instru√ß√µes de ponto flutuante e instru√ß√µes de unidade de macro / micro vetores.  Fazendo uma grande pausa para trabalhar em outros projetos, estudei todos os outros aspectos necess√°rios para esta demonstra√ß√£o e continuei adicionando seu suporte ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Java Grinder</a> .  Se algu√©m estiver interessado em detalhes de baixo n√≠vel, criei uma p√°gina na qual tentei documentar todas as informa√ß√µes coletadas: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">programa√ß√£o do Playstation 2</a> . <br><br>  Programei principalmente usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o emulador PCXS2</a> .  √â bastante conveniente, porque nele posso examinar registros e afins na tela.  Mas definitivamente n√£o √© t√£o flex√≠vel e simples quanto o MAME ao desenvolver o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sega Genesis</a> .  Por exemplo, em MAME, √© mais f√°cil examinar a mem√≥ria, a RAM e os registros de v√≠deo / √°udio para garantir que o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Java Grinder esteja</a> funcionando corretamente. <br><br>  Ao trabalhar com o c√≥digo da Sega, cometi um erro - n√£o o testei na m√°quina at√© a demo ser escrita.  Havia pelo menos tr√™s esquisitices no c√≥digo da Sega que o emulador ignorou, mas elas n√£o gostaram da m√°quina real.  Dessa vez, depois de escrever as partes individuais do c√≥digo, eu as testei em uma m√°quina real, para que, ap√≥s a conclus√£o da demonstra√ß√£o, ela funcione tanto no equipamento real quanto no emulador.  Mais uma vez me deparei com coisas que funcionavam no emulador, mas n√£o iniciavam em um PS2 real.  Tamb√©m descobri que funcionava em um Playstation 2 real, mas funcionava incorretamente no emulador. <br><br><h2>  Recursos da API </h2><br><ul><li>  A unidade vetorial 0 possui m√©todos para carregar / executar c√≥digo e carregar / descarregar dados. </li><li>  A Unidade 1 do vetor executa rota√ß√µes e proje√ß√£o em 3D. </li><li>  Texturas usando um formato de 16 ou 24 bits (a transpar√™ncia √© indicada em preto). </li><li>  Texturas em formato de 16 bits podem ser codificadas em RLE. </li><li>  C√≥digo para desenhar pontos, linhas, tri√¢ngulos, com e sem texturas. </li><li>  Nevoeiro e sombreamento de Guro. </li><li>  M√©todos para acessar um gerador de n√∫meros aleat√≥rios. </li><li>  Usando dois contextos (substituindo p√°ginas) </li><li>  Inserir dados bin√°rios grandes no c√≥digo do assembler compilado. </li><li>  Tocando m√∫sica. </li></ul><br><h2>  API </h2><br>  A parte principal da API √© definida na classe <a href="">Playstation2</a> .  Inicialmente, eu daria a ele um alto grau de liberdade - a capacidade de definir modos de v√≠deo e coisas do g√™nero, mas depois pensei que seria melhor esconder todas essas dificuldades.  Essencialmente, ele apenas configura uma tela entrela√ßada de 640x448.  Como em outros projetos do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Java Grinder</a> , basicamente adicionei m√©todos / recursos conforme necess√°rio. <br><br>  H√° outro conjunto de classes ao qual dei o nome chato <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Draw3D</a> .  Em ess√™ncia, eles definem todos os tipos de primitivos que o Graphics Synthesizer pode renderizar com suporte para texturas de 16, 24 e 32 bits.  Pensei em adicionar texturas de 8 bits, mas decidi n√£o faz√™-lo ainda.  Draw3D fornece rota√ß√µes 3D, proje√ß√£o, transfer√™ncia de hardware DMA, texturas, etc.  Voc√™ provavelmente perguntar√° por que n√£o o criei com base no OpenGL, mas nunca havia trabalhado com o OpenGL antes.  Era uma vez, eu estava envolvido em uma programa√ß√£o simples do ps2dev, mas n√£o havia nada s√©rio por l√° e mal me lembro desse projeto, ent√£o repito - podemos assumir que esta √© a primeira vez que fa√ßo algo s√©rio em 3D. <br><br>  Existem exemplos de como usar todas essas coisas, n√£o apenas na demonstra√ß√£o, mas tamb√©m na pasta de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">amostras</a> . <br>  Quase todas as dificuldades est√£o ocultas na API.  O desenvolvedor n√£o precisa se preocupar em limpar o cache, em computa√ß√£o 3D etc.  No entanto, o retorno disso foi uma diminui√ß√£o na universalidade.  Portanto, se, por exemplo, a textura foi alterada pelo processador, mas apenas os primeiros 64 pixels foram alterados, √© necess√°rio limpar apenas uma linha de cache de 64 bytes, mas o Java Grinder limpa a imagem inteira.  Ele marca objetos, portanto, eles s√£o limpos apenas se necess√°rio, mas limpam todo o fragmento de mem√≥ria.  Com uma alta probabilidade de alterar 64 bytes, a imagem inteira tamb√©m muda. <br><br><h2>  Unidade vetorial 0 (VU0) </h2><br>  O usu√°rio do Java Grinder √© livre para usar o VU0.  Eu usei a parte demo chamada ‚ÄúTwo Vector Units, One MIPS‚Äù para renderizar os fractais de Mandelbrot.  O c√≥digo pode ser otimizado melhor, por exemplo, a maioria das instru√ß√µes de ponto flutuante da unidade vetorial tem um tempo de execu√ß√£o de 1 e uma lat√™ncia de 4. At√© onde eu entendo, isso significa que se o registro √© o destino da instru√ß√£o, ele pode ser executado em 1 ciclo, mas para para que o resultado esteja dispon√≠vel, s√£o necess√°rios 4 ciclos.  Se esse registro for usado, a unidade vetorial permanecer√° ociosa at√© que esteja pronta.  Portanto, a id√©ia √© que voc√™ precise organizar as instru√ß√µes para poder executar cada instru√ß√£o em 1 ciclo sem tempo de inatividade.  Quando criei os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fractais de Mandelbrot no Playstation 3</a> no ano passado, otimizei esse c√≥digo enquanto calculava simultaneamente 8 pixels (2 registros SIMD), observando um grande aumento de velocidade.  No caso atual, tentei facilitar a leitura do c√≥digo, para n√£o me incomodar com sua otimiza√ß√£o. <br><br>  O VU0 cont√©m apenas 4 KB de mem√≥ria de dados e voc√™ n√£o grava a imagem fractal inteira l√°, ent√£o o MIPS envia as coordenadas de apenas 1/8 da imagem por vez. <br><br>  A estranheza que encontrei ao trabalhar com VU0: Inicialmente, executei o c√≥digo VU0 usando instru√ß√µes e usei VIF0_STAT para verificar a conclus√£o de sua execu√ß√£o.  Parece que VIF0_STAT n√£o funciona se voc√™ n√£o iniciar o VU0 com o pacote VIF.  Isso foi corrigido no emulador, mas o erro ainda est√° no hardware real.  Como resultado, descobri que vcallms e usando cfc2 no registro 29 funcionam em ambos os casos. <br><br>  Parece-me que os conjuntos de instru√ß√µes da unidade vetorial n√£o possuem as instru√ß√µes de compara√ß√£o paralela encontradas no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Intel X86_64, Playstation 3</a> e at√© no conjunto de instru√ß√µes MIPS R5900 Emotion Engine.  Os fractais de Mandelbrot devem calcular iterativamente a f√≥rmula at√© que o resultado seja superior; portanto, com um conjunto diferente de instru√ß√µes, eu faria uma compara√ß√£o paralela que criaria uma m√°scara para todos os bin√°rios 1 ou 0. A m√°scara pode ser usada para interromper o incremento dos contadores de cores.  Para o Playstation 2, eu tive que derivar uma f√≥rmula muito estranha, que √© bem pr√≥xima da f√≥rmula fractal.  Eu documentei isso no c√≥digo fonte do <a href="">mandelbrot_vu0.asm</a> em linhas com o Python comentado. <br><br>  Acho legal nos dispositivos de unidade vetorial do console Playstation 2 que √© √≥timo n√£o ter visto outros conjuntos de instru√ß√µes SIMD nas quais todas as instru√ß√µes da FPU podem ter o atributo .xyzw informando √† instru√ß√£o qual dos quatro n√∫meros de ponto flutuante possui afeta.  Ou seja, se eu precisasse que o resultado da instru√ß√£o afetasse apenas o componente x do vetor, simplesmente adicionaria .x no final da instru√ß√£o.  Outra coisa interessante √© que √© um conjunto de instru√ß√µes VLIW, ou seja, em cada ciclo, duas instru√ß√µes s√£o executadas simultaneamente.  De fato, o m√≥dulo √© mais um DSP do que um processador de uso geral. <br><br><h2>  Unidade vetorial 1 (VU1) </h2><br>  O VU1 √© reservado pelo Java Grinder para executar rota√ß√µes, movimentos e proje√ß√µes 3D.  Os objetos Draw3D s√£o transmitidos para a VU1 usando o m√©todo draw (), que usa o montador de unidade vetorial para converter os pontos e transferi-los para o sintetizador gr√°fico.  O c√≥digo do assembler na VU1 pode ser muito melhor otimizado para velocidade, mas √© adequado para meus prop√≥sitos, por isso decidi deixar o c√≥digo f√°cil de ler (n√£o otimizado). <br><br>  Para estudar as f√≥rmulas de proje√ß√µes e curvas, usei a Wikipedia: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">proje√ß√µes</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">curvas</a> . <br><br>  O c√≥digo de transforma√ß√£o 3D tamb√©m est√° no reposit√≥rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">naken_asm</a> como um arquivo .asm: <a href="">rotation_vu1.asm</a> simples. <br><br><h2>  MIPS R5900 </h2><br>  Eu realmente n√£o gostei do conjunto de instru√ß√µes do MIPS at√© come√ßar a trabalhar neste projeto.  De fato, √© muito f√°cil trabalhar com esta CPU.  A vers√£o do Emotion Engine desta CPU possui recursos muito convenientes.  Mais notavelmente, os registradores t√™m 128 bits, mas na verdade s√£o simplesmente usados ‚Äã‚Äãpara carregamento / armazenamento e SIMD.  Ou seja, na realidade, s√£o registradores de 128 bits, ALU de 64 bits e ponteiros de 32 bits. <br><br>  Tamb√©m foi poss√≠vel introduzir otimiza√ß√µes no c√≥digo MIPS principal, mas n√£o o fiz para manter a legibilidade do c√≥digo ou devido √† falta de tempo.  Por exemplo, a CPU do MIPS fica ociosa por um ciclo se o registro de instru√ß√µes de destino foi usado imediatamente ap√≥s a configura√ß√£o.  Esse comportamento pode ser melhorado. <br><br><h2>  Hacks Java </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O pr√≥prio Java Grinder</a> tamb√©m tem suas pr√≥prias ... esquisitices, mas algo est√° simplesmente faltando, principalmente porque eu visava inicialmente o MSP430 e, na maioria das vezes, era um experimento.  Um dos elementos ausentes era a incapacidade de alocar mem√≥ria para objetos.  Eu adicionei esse recurso no Playstation 2 para instanciar v√°rios objetos, principalmente usando a API Draw3D.  Como n√£o escrevi nenhum alocador de mem√≥ria ou coletor de lixo, todas as novas chamadas s√£o feitas na pilha.  Eu estava pensando em implementar algo como um alocador de mem√≥ria din√¢mico, mas no final decidi n√£o complic√°-lo.  Tamb√©m adicionei ao suporte estendido do Playstation 2 para n√∫meros de ponto flutuante (float) (parcialmente esse suporte ainda estava no c√≥digo Epiphany / Parallella).  Algumas outras coisas, como os tipos longo e duplo, ainda n√£o s√£o suportadas. <br><br>  Provavelmente, a coisa mais irritante que fiz foi relacionada √† terr√≠vel restri√ß√£o de arquivos de classe Java.  O m√©todo Java n√£o pode ser maior que 64 K se bem me lembro.  Talvez isso seja normal, mas o problema surge quando h√° uma matriz est√°tica no arquivo de classe e ele n√£o √© despejado no arquivo de classe como dados bin√°rios.  Ele √© colocado no arquivo de classe como uma instru√ß√£o Java assembler em um inicializador est√°tico para criar uma matriz.  Tentei salvar imagens em arquivos de classe como matrizes de bytes est√°ticos [], mas algumas delas n√£o se encaixavam, ent√£o adicionei um m√©todo ao arquivo de classe Memory <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Java Grinder</a> : <br><br><pre><code class="cpp hljs">byte[] Memory.preloadByteArray(String filename);</code> </pre> <br>  Ele n√£o baixa esse arquivo em tempo de execu√ß√£o, mas o baixa em tempo de compila√ß√£o usando a diretiva .binfile <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">naken_asm</a> .  As imagens s√£o copiadas para o bin√°rio de sa√≠da durante a montagem. <br><br>  Com tudo isso em mente, eu realmente espero que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">James Gosling</a> nunca tropece no meu projeto. <br><br><h2>  Imagens </h2><br>  A API Draw3D pode usar texturas de 16, 24 e 32 bits.  Os pixels de textura podem ser definidos pixel por pixel ou carregando usando matrizes de bytes [].  Tamb√©m adicionei a capacidade de compactar imagens com RLE no formato {length, lo16, hi16}, em que lo16 e hi16 s√£o as cores de 16 bits no formato little endian, que s√£o copiadas para os tempos de ‚Äúlength‚Äù da textura. <br><br><h2>  As ferramentas </h2><br>  Ao trabalhar na Sega para criar ferramentas para criar imagens, m√∫sicas e coisas do g√™nero, usei o idioma do Google Go, apenas para aprender um novo idioma.  Desta vez eu tentei Rust.  A primeira ferramenta converte bin√°rios em c√≥digo-fonte Java e a segunda converte BMP em formato bin√°rio, que pode ser carregado em texturas, inclusive no formato RLE.  Como resultado, eu os escrevi em Python, caso algu√©m queira se juntar a mim na cria√ß√£o de uma demonstra√ß√£o. <br><br><h2>  Som </h2><br>  Tendo descoberto como os dispositivos gr√°ficos e de unidade vetorial funcionam, o √∫ltimo passo foi o som.  Eu pensei que seria a parte mais f√°cil, especialmente depois de estudar o PDF com a descri√ß√£o do Sony SPU2.  Qu√£o errado eu estava.  Esta parte do sistema est√° muito mal documentada. <br><br>  A primeira coisa que descobri √© que o SPU2 (unidade de processamento de som) est√° conectado ao IOP (processador de E / S, tamb√©m conhecido como processador Playstation 1).  A CPU do Playstation 2 est√° conectada a este IOP atrav√©s de algo chamado SIF.  O PDF da Sony menciona apenas o SIF DMA, mas n√£o diz nada sobre seu uso. <br><br>  Como resultado, eu me recusei a usar o SIF, mas decidi adicionar um vinculador ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">naken_asm</a> para poder usar o kernel.a no PS2DEV SDK.  O vinculador ganhou, mas falhou. <br><br>  Nesta fase, eu j√° decidi que n√£o poderia fazer o som funcionar, e eu s√≥ queria terminar a demo sem ele.  Mas isso me atormentou, ent√£o decidi dar uma olhada no c√≥digo fonte de v√°rios emuladores do Playstation 2 para entender como o SIF funciona.  Finalmente, eu descobri como acessar diretamente a mem√≥ria do c√≥digo MIPS R3000 no IOP e execut√°-la (h√° um exemplo na pasta samples do reposit√≥rio naken_asm).  Consegui fazer o som funcionar no emulador. <br><br>  No final, descobri que a mem√≥ria da IOP (incluindo SPU2) estava localizada no espa√ßo do Emotion Engine, por isso fiz um grande esfor√ßo (a documenta√ß√£o √© extremamente pequena e em nenhum dos emuladores √© implementada completamente corretamente, mas n√£o importa que eles funcionem) ), Aprendi a trabalhar com som. <br><br><h2>  Compara√ß√£o de emulador e ferro </h2><br>  Eu encontrei algumas diferen√ßas entre a execu√ß√£o em uma m√°quina real e em um emulador. <br><br><ul><li>  Se o pacote GIF definir o PRIM registra os dois valores IIP (m√©todo de sombreamento) e os bits FIX s√£o todos 1, o emulador leva em conta o bit IIP e executa o sombreamento Gouro, enquanto o equipamento real executa sombreamento simples. </li><li>  Se o pacote GIF for transmitido atrav√©s do PATH3 (EE direto para GS) e o sinalizador EOP (fim do pacote) n√£o estiver definido, se o VU1 tentar enviar o pacote GIF pelo PATH 1 (VU1 para GS), isso causar√° um travamento no hardware real, mas funcionar√° no emulador. </li><li>  Ignorar a limpeza do cache da CPU antes da transfer√™ncia do DMA n√£o √© necess√°rio, mas em uma m√°quina real leva a um comportamento estranho. </li><li>  Ao colocar o SPU2 no espa√ßo EE, o emulador pode simplesmente gravar dados de √°udio no FIFO SPU2.  Em um Playstation 2 real, depois de gravar 32 palavras, √© necess√°rio escrever no registro para dar um comando para limpar o FIFO.  Al√©m disso, no hardware real, ao definir o endere√ßo de transmiss√£o / in√≠cio do SPU2, o modo de transmiss√£o deve ser definido como 0. Os emuladores n√£o se importam se o modo tiver um valor 0. </li><li>  A grava√ß√£o de IOPs do EE na mem√≥ria alocada registra falhas em uma m√°quina real, mesmo que esteja no modo kernel.  O emulador permite que essas opera√ß√µes funcionem independentemente do modo atual da CPU. </li><li>  O uso de canais SIF DMA funciona no emulador, mas ainda n√£o consegui faz√™-los funcionar em equipamentos reais.  Eu estava recebendo um erro de acesso √† mem√≥ria para registros SIF DMA, mesmo no modo kernel. </li><li>  O emulador √© muito lento para executar uma demonstra√ß√£o ao calcular fractais usando VU0, para que o som esteja fora de sincronia. </li></ul><br><h2>  Resumir </h2><br>  Eu queria escrever um programa para o Playstation 2 quase desde o momento da sua compra.  Na verdade, eu j√° tinha um kit Linux para PS2 h√° muito tempo (acho que foi por isso que comprei o Playstation 2) e at√© tentei trabalhar com a biblioteca PS2DEV em C, mas essa √© uma experi√™ncia completamente diferente em compara√ß√£o √† programa√ß√£o diretamente na linguagem assembly. para ferro. <br><br>  Devo agradecer ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Lukash</a> por salvar o antigo c√≥digo-fonte do assembler e os documentos PS2.  N√£o tenho certeza se eu poderia come√ßar sem a demonstra√ß√£o Duke 3 Star, o que me ajudou a inicializar o equipamento.  Tamb√©m sou grato aos desenvolvedores do emulador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PCSX2</a> , que aceleraram bastante o processo de depura√ß√£o.  Al√©m disso, eu n√£o conseguia descobrir o som se n√£o tivesse olhado o c√≥digo fonte do emulador e n√£o entendesse o que estava errado. <br><br>  E obrigado √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sony</a> por este lindo e pequeno computador.  Se algu√©m da Sony ler este artigo, aqui vai uma dica: por que n√£o reduzi-lo ao tamanho de um Rapsberry Pi e vend√™-lo como um quadro para projetos de hobby?  :). <br><br><h2>  Demonstra√ß√£o de compila√ß√£o </h2><br> <code>git clone https://github.com/mikeakohn/playstation2_demo.git <br> git clone https://github.com/mikeakohn/java_grinder.git <br> git clone https://github.com/mikeakohn/naken_asm.git <br> cd naken_asm <br> ./configure <br> make <br> cd .. <br> cd java_grinder <br> make java <br> make <br> cd .. <br> cd playstation2_demo <br> make</code> </div> </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt423751/">https://habr.com/ru/post/pt423751/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt423741/index.html">Resumo CRUD do reposit√≥rio para o controlador: o que mais voc√™ pode fazer com o Spring + Generics</a></li>
<li><a href="../pt423743/index.html">Sob controle: ferramenta de monitoramento de disco do servidor VDS</a></li>
<li><a href="../pt423745/index.html">Usando o Python para analisar habilidades relacionadas relacionadas entre desenvolvedores</a></li>
<li><a href="../pt423747/index.html">Novas ferramentas de desenvolvimento com LEGO Education - da Microsoft, MIT e mais</a></li>
<li><a href="../pt423749/index.html">8 etapas f√°ceis para falhar em um gerente de desenvolvimento iniciante</a></li>
<li><a href="../pt423753/index.html">Mantenha os tokens de autoriza√ß√£o seguros</a></li>
<li><a href="../pt423759/index.html">Fintech-digest: dados pessoais de cidad√£os da Federa√ß√£o Russa, mercado do Banco Central, um novo servi√ßo da CloudFlare</a></li>
<li><a href="../pt423763/index.html">O que o Uber Cash ensina aos inovadores</a></li>
<li><a href="../pt423765/index.html">Estamos escrevendo um pedido de controle remoto do MPV player da RetroOrangePi</a></li>
<li><a href="../pt423767/index.html">Hackers atacaram a British Airways: 380.000 cart√µes banc√°rios roubados</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>