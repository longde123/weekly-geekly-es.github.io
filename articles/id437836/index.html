<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§ğŸ¾ ğŸ ğŸŒ Di bawah tenda Screeps - virtualisasi di kotak pasir MMO untuk programmer ğŸ‘… ğŸ¤­ ğŸ–ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pada artikel ini saya akan berbicara tentang satu teknologi yang kurang dikenal yang telah menemukan aplikasi utama dalam game online kami untuk para ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Di bawah tenda Screeps - virtualisasi di kotak pasir MMO untuk programmer</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437836/"><p> Pada artikel ini saya akan berbicara tentang satu teknologi yang kurang dikenal yang telah menemukan aplikasi utama dalam game online kami untuk para programmer.  Agar tidak menarik karet untuk waktu yang lama, ada spoiler segera: tampaknya tidak ada yang melakukan perdukunan seperti itu dalam kode Node.js asli yang kami alami setelah beberapa tahun pembangunan.  Mesin mesin virtual terisolasi (open source), yang berjalan di bawah kap proyek, ditulis khusus untuk kebutuhannya, dan saat ini digunakan dalam produksi oleh kami dan startup lain.  Dan kemampuan isolasi yang ia berikan unik dan layak untuk diberitahu tentang mereka. </p><br><p>  Tapi mari kita bicara tentang semuanya secara berurutan. </p><br><h2>  Latar belakang </h2><br><p>  Apakah Anda suka pemrograman?  Bukan perusahaan rutin yang melakukan pengkodean yang banyak dari kita dipaksa untuk melakukan 40 jam seminggu, berjuang dengan penundaan, menuangkan dalam liter kopi dan secara profesional terbakar;  dan <i>pemrograman</i> adalah proses ajaib yang tak tertandingi untuk mengubah pemikiran menjadi program kerja, mendapatkan kesenangan dari fakta bahwa kode yang baru saja Anda tulis diwujudkan di layar dan mulai menjalani kehidupan yang diminta oleh pencipta.  Pada saat-saat seperti itu, saya ingin menulis kata "Pencipta" dengan huruf besar - perasaan yang muncul dalam proses itu kadang-kadang dekat dengan penghormatan. </p><br><p><img src="https://habrastorage.org/webt/mm/2a/5h/mm2a5hmu2k6s26hviyoykwd6tv8.jpeg"></p><br><p>  Sangat disayangkan bahwa sangat sedikit proyek nyata yang terkait dengan pendapatan sehari-hari dapat menawarkan perasaan seperti itu kepada pengembang mereka.  Paling sering, agar tidak kehilangan gairah untuk pemrograman, penggemar harus memulai perselingkuhan di sisi: hobi pemrograman, proyek hewan peliharaan, sumber terbuka modis, hanya skrip python untuk mengotomatisasi rumah pintar mereka ... atau perilaku karakter di beberapa online populer permainan. </p><a name="habracut"></a><br><p>  Ya, itu adalah game online yang sering menyediakan sumber inspirasi yang tidak ada habisnya untuk programmer.  Bahkan gim pertama dalam genre ini (Ultima Online, Everquest, belum lagi semua jenis MUD) menarik banyak pengrajin yang tidak begitu tertarik dalam memainkan peran dan menikmati fantasi dunia, tetapi dalam penerapan bakat mereka untuk mengotomatisasi segala sesuatu ruang game virtual.  Dan sampai hari ini, itu tetap menjadi disiplin khusus dari Olimpiade Game MMO online: sempurnakan pikiran Anda untuk menulis bot Anda agar tidak diperhatikan oleh administrasi dan dapatkan keuntungan maksimum dibandingkan dengan pemain lain.  Atau bot lain - seperti, misalnya, di EVE Online, di mana perdagangan di pasar padat penduduk sedikit kurang dari sepenuhnya dikendalikan oleh skrip perdagangan, seperti pada pertukaran nyata. </p><br><p>  Gagasan tentang game online, yang <em>awalnya dan sepenuhnya berorientasi pada programmer,</em> melayang di udara.  Seperti permainan di mana menulis bot bukanlah tindakan yang bisa dihukum, tetapi inti dari gameplay.  Di mana tugasnya bukan untuk melakukan tindakan yang sama "Bunuh monster X dan temukan item Y" dari waktu ke waktu, tetapi untuk menulis skrip yang dapat melakukan tindakan ini dengan benar atas nama Anda.  Dan karena itu menyiratkan permainan online dalam genre MMO, persaingan terjadi dengan skrip pemain lain secara real time dalam satu dunia game umum. </p><br><p>  Jadi pada tahun 2014, permainan Screeps (dari kata "Scripts" dan "creeps") muncul - kotak pasir MMO strategis real-time dengan satu <em>dunia persisten</em> besar di mana pemain tidak memiliki pengaruh pada apa yang terjadi kecuali dengan menulis skrip AI untuk unit permainan mereka .  Semua mekanisme permainan strategis biasa - ekstraksi sumber daya, unit bangunan, membangun basis, merebut wilayah, manufaktur, dan perdagangan - Anda perlu memprogram pemain sendiri melalui JavaScript API, yang disediakan oleh dunia game.  Perbedaan dari kompetisi yang berbeda dalam penulisan AI adalah bahwa dunia game, sebagaimana seharusnya dalam dunia game online, terus bekerja dan menjalani kehidupannya secara real time 24/7 selama 4 tahun terakhir, meluncurkan AI setiap pemain setiap siklus permainan. </p><br><p>  Jadi, cukup tentang permainan itu sendiri - ini harus cukup untuk lebih memahami esensi dari masalah teknis yang kami temui selama pengembangan.  Anda bisa mendapatkan lebih banyak penayangan dari video ini, tetapi ini opsional: </p><br><div class="spoiler">  <b class="spoiler_title">Cuplikan video</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/ZboTgOajnGg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><br><h2>  Masalah teknis </h2><br><p>  Inti dari mekanisme dunia game adalah sebagai berikut: seluruh dunia dibagi menjadi <strong>kamar</strong> - <strong>kamar</strong> , yang saling terhubung oleh pintu keluar pada empat titik mata angin.  Satu ruangan adalah unit atom dari proses memproses keadaan dunia game.  Ruangan itu mungkin memiliki benda-benda tertentu (misalnya, unit) yang memiliki keadaan sendiri, dan pada setiap langkah permainan mereka menerima perintah dari para pemain.  Server handler mengambil satu ruangan pada satu waktu, mengeksekusi perintah-perintah ini, mengubah keadaan objek, dan melakukan keadaan baru ruangan ke database.  Sistem ini berskala baik secara horizontal: Anda dapat menambahkan lebih banyak penangan ke kluster, dan karena kamar-kamar secara arsitektur terisolasi satu sama lain, karena banyak kamar dapat diproses secara paralel karena ada penangan yang beroperasi. </p><br><p><img src="https://habrastorage.org/webt/mp/d0/ed/mpd0ed40jp8efrihjrxkfft49fc.png"></p><br><p>  Saat ini kami memiliki <strong>42.060 kamar</strong> dalam permainan.  Sekelompok server dari 36 mesin fisik quad-core berisi 144 prosesor.  Kami menggunakan Redis untuk membuat antrian, seluruh backend ditulis dalam Node.js. </p><br><p>  Ini adalah satu tahap dari kebijaksanaan permainan.  Tapi dari mana tim pemain berasal?  Kekhasan gim ini adalah tidak ada antarmuka tempat Anda dapat mengeklik unit dan menyuruhnya pergi ke titik tertentu atau membangun struktur tertentu.  Maksimum yang dapat dilakukan dalam antarmuka adalah menempatkan bendera tidak berwujud di tempat yang tepat di ruangan.  Agar unit datang ke tempat ini dan mengambil tindakan yang diperlukan, skrip Anda perlu melakukan sesuatu seperti yang berikut untuk beberapa kutu game: </p><br><pre><code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.loop = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> creep = Game.creeps[<span class="hljs-string"><span class="hljs-string">'Creep1'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> flag = Game.flags[<span class="hljs-string"><span class="hljs-string">'Flag1'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!creep.pos.isEqualTo(flag.pos)) { creep.moveTo(flag.pos); } }</code> </pre> <br><p>  Ternyata pada setiap langkah gim Anda perlu mengambil fungsi <code>loop</code> pemain, menjalankannya di lingkungan JavaScript penuh dari pemain tertentu itu (di mana objek <code>Game</code> dibentuk untuknya ada), dapatkan satu set pesanan untuk unit, dan memberikannya ke tahap pemrosesan berikutnya.  Segalanya tampak sangat sederhana. </p><br><p><img src="https://habrastorage.org/webt/po/om/vh/poomvhcw4nhpjcsgk2df0a5hg_e.png"></p><br><p>  Permasalahan dimulai ketika sampai pada nuansa implementasi.  Saat ini kami memiliki <strong>1.600 pemain aktif</strong> di dunia.  Skrip masing-masing pemain sudah tidak dapat disebut "skrip" - beberapa di antaranya berisi hingga <strong>25 ribu baris kode</strong> , dikompilasi dari TypeScript atau bahkan dari C / C ++ / Rust melalui WebAssembly (ya, kami mendukung wasm!), Dan menerapkan konsep OS miniatur nyata, di mana para pemain telah mengembangkan kumpulan tugas-tugas permainan mereka sendiri dan manajemen mereka melalui inti, yang mengambil banyak tugas ternyata bekerja berdasarkan kebijaksanaan permainan, mengeksekusi mereka, dan menempatkan mereka kembali dalam antrian sampai langkah berikutnya.  Karena CPU dan memori pemain terbatas pada setiap siklus clock, model ini berfungsi dengan baik.  Meskipun tidak wajib - untuk memulai permainan, cukup bagi pemula untuk mengambil skrip 15 baris, yang juga sudah ditulis sebagai bagian dari tutorial. </p><br><p>  Tapi sekarang mari kita ingat bahwa skrip pemain harus bekerja di mesin JavaScript nyata.  Dan gim ini bekerja dalam waktu nyata - yaitu, mesin JavaScript setiap pemain harus selalu ada, bekerja dengan kecepatan tertentu, agar tidak memperlambat gim secara keseluruhan.  Tahap mengeksekusi skrip game dan membentuk pesanan untuk unit bekerja kira-kira berdasarkan prinsip yang sama dengan ruang pemrosesan - skrip masing-masing pemain adalah tugas yang dilakukan oleh satu pawang dari pool, banyak pawang paralel yang bekerja dalam klaster.  Tapi tidak seperti tahap ruang pemrosesan, sudah ada banyak kesulitan. </p><br><p>  Pertama, Anda tidak bisa hanya membagikan tugas oleh penangan secara acak pada setiap siklus jam, karena hal itu mungkin dilakukan dalam kasus kamar.  Mesin JavaScript pemain harus bekerja tanpa henti, setiap tindakan selanjutnya hanyalah panggilan fungsi <code>loop</code> baru, tetapi konteks global harus tetap sama.  Secara kasar, gim ini memungkinkan Anda melakukan sesuatu seperti ini: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> song = [<span class="hljs-string"><span class="hljs-string">'EX-'</span></span>, <span class="hljs-string"><span class="hljs-string">'TER-'</span></span>, <span class="hljs-string"><span class="hljs-string">'MI-'</span></span>, <span class="hljs-string"><span class="hljs-string">'NATE!'</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.loop = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ Game.creeps[<span class="hljs-string"><span class="hljs-string">'DalekSinger'</span></span>].say(song[counter]); counter++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(counter == song.length) { counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre> <br><p><img src="https://habrastorage.org/webt/sz/sk/je/szskjecusiurkgvg1apq3sxzjdw.gif"></p><br><p>  Merayap seperti itu akan bernyanyi pada satu baris lagu setiap permainan mengalahkan.  Nomor baris <code>counter</code> lagu disimpan dalam konteks global yang disimpan di antara langkah-langkah.  Jika setiap kali skrip pemain ini dieksekusi dalam proses handler baru, konteksnya akan hilang.  Ini berarti bahwa semua pemain harus dialokasikan ke penangan tertentu, dan mereka harus diubah sesedikit mungkin.  Tapi lalu bagaimana dengan load balancing?  Satu pemain dapat menghabiskan 500ms eksekusi pada node ini, dan pemain lain dapat menghabiskan 10ms, dan sangat sulit untuk memprediksi ini sebelumnya.  Jika 20 pemain masing-masing 500 ms jatuh pada satu simpul, maka operasi simpul semacam itu akan memakan waktu 10 detik, di mana semua yang lain akan menunggu sampai selesai dan berdiri diam.  Dan untuk menyeimbangkan kembali para pemain ini dan melemparkan mereka ke node lain, Anda harus kehilangan konteksnya. </p><br><p>  Kedua, lingkungan pemain harus diisolasi dengan baik dari pemain lain dan dari lingkungan server.  Dan ini tidak hanya menyangkut keamanan, tetapi juga kenyamanan bagi pengguna itu sendiri.  Jika seorang pemain tetangga berjalan pada node yang sama di cluster seperti yang saya lakukan dengan mengerikan, menghasilkan banyak sampah, dan umumnya berperilaku tidak patut, maka saya seharusnya tidak merasakannya.  Karena sumber daya CPU dalam permainan adalah waktu pelaksanaan skrip (dihitung dari awal hingga akhir metode <code>loop</code> ), pemborosan sumber daya pada tugas-tugas asing selama pelaksanaan skrip saya bisa sangat sensitif, karena dihabiskan dari anggaran sumber daya CPU saya. </p><br><p>  Dalam mencoba menangani masalah-masalah ini, kami menemukan beberapa solusi. </p><br><h2 id="pervaya-versiya">  Versi pertama </h2><br><p>  Versi pertama dari mesin permainan didasarkan pada dua hal dasar: </p><br><ul><li>  modul <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>vm</code></a> penuh waktu dalam pengiriman Node.js, </li><li>  garpu proses runtime. </li></ul><br><p>  Terlihat seperti ini.  Pada setiap mesin di cluster ada 4 (sesuai dengan jumlah core) proses penangan script game.  Ketika tugas baru diterima dari antrian skrip permainan, pawang meminta data yang diperlukan dari database dan mentransfernya ke proses anak, yang dipertahankan dalam keadaan terus berjalan, dimulai kembali jika terjadi kegagalan, dan digunakan kembali oleh pemain yang berbeda.  Proses anak, yang diisolasi dari induknya (yang berisi logika bisnis klaster), hanya dapat melakukan satu hal: membuat objek <code>Game</code> dari data yang diterima dan memulai mesin virtual pemain.  Untuk memulai, kami menggunakan modul <code>vm</code> di Node.js. </p><br><p>  Mengapa keputusan ini tidak sempurna?  Sebenarnya, dua masalah di atas tidak diselesaikan di sini. </p><br><p>  <code>vm</code> bekerja dalam mode single-threaded yang sama dengan Node.js.  Oleh karena itu, untuk memiliki empat prosesor paralel pada setiap inti pada mesin 4-inti, Anda harus memiliki 4 proses.  Memindahkan pemain "hidup" dalam satu proses ke proses lain mengarah pada penciptaan kembali konteks global yang lengkap, bahkan jika ini terjadi dalam mesin yang sama. </p><br><p><img src="https://habrastorage.org/webt/mu/pk/xl/mupkxlqzbbgh4zjnnymqjdjapm0.png"></p><br><p>  Selain itu, <code>vm</code> tidak benar-benar membuat mesin virtual yang sepenuhnya terisolasi.  Apa yang dilakukannya hanyalah membuat <em>konteks yang</em> terisolasi, atau ruang lingkup, tetapi jalankan kode dalam contoh yang sama dari mesin virtual JavaScript, di mana panggilan <code>vm.runInContext</code> .  Dan itu berarti - dalam contoh yang sama di mana pemain lain diluncurkan.  Meskipun para pemain dipisahkan oleh konteks global yang terisolasi, tetapi, sebagai bagian dari mesin virtual yang sama, mereka memiliki memori tumpukan yang sama, pengumpul sampah yang sama, dan menghasilkan sampah bersama.  Jika pemain "A" menghasilkan banyak sampah selama pelaksanaan skrip permainannya, pekerjaan yang selesai, dan kontrol diteruskan ke pemain "B", maka pada saat itu <em>semua</em> sampah dari proses tersebut dapat dikumpulkan, dan pemain "B" akan membayar waktu CPU untuk mengumpulkan sampah orang lain.  Belum lagi fakta bahwa semua konteks bekerja dalam loop peristiwa yang sama, dan secara teoritis dimungkinkan untuk mengeksekusi janji orang lain kapan saja, meskipun kami mencoba mencegahnya.  Juga, <code>vm</code> tidak memungkinkan Anda untuk mengontrol berapa banyak memori-tumpukan dialokasikan untuk eksekusi skrip, semua memori proses tersedia. </p><br><h2 id="isolated-vm">  terisolasi-vm </h2><br><p>  Hiduplah orang yang luar biasa bernama Marcel Laverde.  Bagi sebagian orang, ia pernah menjadi luar biasa karena menulis perpustakaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">simpul-serat</a> , bagi yang lain, karena <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">meretas Facebook dan dipekerjakan untuk bekerja di sana</a> .  Dan bagi kami dia luar biasa karena dia dengan murah hati berpartisipasi dalam kampanye crowdfunding pertama kami dan sampai hari ini adalah penggemar berat Screeps. </p><br><p>  Proyek kami telah open source selama beberapa tahun sekarang - server game diterbitkan di GitHub.  Meskipun klien resmi dijual dengan biaya melalui Steam, ada versi alternatifnya, dan server itu sendiri tersedia untuk studi dan modifikasi pada skala apa pun, yang sangat kami dorong. </p><br><p>  Dan begitu Marcel menulis kepada kami: â€œGuys, saya punya pengalaman bagus dalam pengembangan C / C ++ asli untuk Node.js, dan saya suka game Anda, tetapi tidak semua orang suka cara kerjanya - mari kita menulis yang baru teknologi peluncuran mesin virtual untuk Node.js khusus untuk Screeps? â€ </p><br><p>  Karena Marcel tidak meminta uang, kami tidak bisa menolak.  Setelah beberapa bulan kerja sama kami, perpustakaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>terisolasi-vm</strong></a> lahir.  Dan itu benar-benar mengubah segalanya. </p><br><p>  <code>isolated-vm</code> berbeda dari <code>vm</code> dalam hal itu tidak mengisolasi <em>konteks</em> , tetapi <em>mengisolasi</em> dalam hal <abbr title="Mesin JavaScript yang digunakan di Node.js">V8</abbr> .  Tanpa merinci, ini berarti bahwa instance terpisah penuh dari mesin JavaScript dibuat, yang tidak hanya memiliki konteks globalnya sendiri, tetapi juga memori tumpukannya, pengumpul sampah, dan bekerja sebagai bagian dari loop peristiwa terpisah.  Dari minus: untuk setiap mesin yang berjalan, diperlukan overhead RAM yang kecil (sekitar 20 MB), dan juga tidak mungkin untuk mentransfer objek atau memanggil fungsi langsung ke mesin, seluruh pertukaran harus serial.  Ini mengakhiri kontra, sisanya - itu hanya obat mujarab! </p><br><p><img src="https://habrastorage.org/webt/gh/cz/5v/ghcz5vxih2oaferse6kgv-zruvq.png"></p><br><p>  Sekarang sangat mungkin untuk menjalankan skrip masing-masing pemain di ruang mereka yang sepenuhnya terisolasi.  Pemain memiliki pinggul 500 MB sendiri, jika berakhir, itu berarti pinggul Anda sendiri yang telah berakhir, dan bukan pinggul dari keseluruhan proses.  Jika Anda menghasilkan sampah - maka ini adalah sampah Anda sendiri, Anda harus mengumpulkannya.  Janji yang menggantung akan dieksekusi hanya ketika isolat Anda mengambil alih waktu berikutnya, dan tidak lebih awal.  Baik dan keamanan - dalam keadaan apa pun tidak mungkin untuk mengakses suatu tempat di luar isolat, hanya jika Anda menemukan kerentanan di suatu tempat di tingkat V8. </p><br><p>  Tapi bagaimana dengan keseimbangan?  Kelebihan lain dari terisolasi-vm adalah bahwa ia memulai mesin dari proses yang sama, tetapi dalam utas yang terpisah (pengalaman Marcel dengan serat-serat berguna di sini).  Jika kita memiliki mesin 4-core, kita dapat membuat kumpulan 4 thread, dan memulai 4 mesin paralel pada satu waktu.  Pada saat yang sama, berada dalam proses yang sama, yang berarti memiliki memori bersama, kami dapat mentransfer pemain mana pun dari satu utas ke yang lain di dalam kumpulan ini.  Meskipun setiap pemain tetap terikat pada satu proses spesifik pada satu mesin tertentu (agar tidak kehilangan konteks global), menyeimbangkan antara 4 utas sudah cukup untuk menyelesaikan masalah pendistribusian pemain "berat" dan "ringan" antar node sehingga semua prosesor selesai bekerja pada waktu dan waktu yang bersamaan. </p><br><p>  Setelah menjalankan fungsi ini dalam mode eksperimental, kami menerima sejumlah besar umpan balik positif dari pemain yang skripnya mulai bekerja jauh lebih baik, lebih stabil dan lebih dapat diprediksi.  Dan sekarang ini adalah mesin default kami, meskipun pemain masih dapat memilih warisan runtime murni untuk kompatibilitas dengan skrip lama (beberapa pemain secara sadar berfokus pada spesifik lingkungan bersama dalam permainan). </p><br><p>  Tentu saja, masih ada ruang untuk optimasi lebih lanjut, dan juga ada bidang menarik lainnya dari proyek di mana kami memecahkan berbagai masalah teknis.  Tetapi lebih banyak tentang itu lain kali. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id437836/">https://habr.com/ru/post/id437836/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id437826/index.html">Bagaimana kami memigrasi database dari Redis dan Riak KV ke PostgreSQL. Bagian 1: proses</a></li>
<li><a href="../id437828/index.html">Buka webinar "SELECT pesanan eksekusi permintaan dan rencana permintaan di MS SQL Server"</a></li>
<li><a href="../id437830/index.html">Pemrograman yang andal berdasarkan bahasa - review noob. Bagian 1</a></li>
<li><a href="../id437832/index.html">Sumber terbuka: humor kode, trik kode, BUKAN kode</a></li>
<li><a href="../id437834/index.html">Dua cerita tentang bagaimana acara pemrograman berlangsung di Yekaterinburg</a></li>
<li><a href="../id437838/index.html">Teknologi pembelajaran mesin mempercepat proses adaptasi pasien terhadap protesa bionik</a></li>
<li><a href="../id437842/index.html">Kisah rahasia Donkey Kong: dari mesin arcade ke NES</a></li>
<li><a href="../id437844/index.html">Perselisihan pengetikan statis vs dinamis yang bertahan lama - TypeScript tidak akan membantu</a></li>
<li><a href="../id437846/index.html">bobaoskit - aksesoris, dnssd dan WebSocket</a></li>
<li><a href="../id437848/index.html">Kami membuat proses pengembangan perangkat lunak berat untuk mikrokontroler menjadi lebih mudah (tidak)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>