<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎉 ✌🏾 🦍 Android中的Kotlin DSL，装置和优雅的UI测试 🌃 🛢️ 🎵</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="当我遇到Kotlin DSL时，我想：太好了，这对产品开发很可惜，不会派上用场。 但是，我错了：他帮助我们以一种非常简洁而优雅的方式在Android中编写了端到端UI测试。 



 关于服务，测试数据以及为什么它不是那么简单 


 首先，简要介绍我们的服务，以便您了解我们为什么做出某些决定。 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Android中的Kotlin DSL，装置和优雅的UI测试</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/hh/blog/455042/"><p> 当我遇到Kotlin DSL时，我想：太好了，这对产品开发很可惜，不会派上用场。 但是，我错了：他帮助我们以一种非常简洁而优雅的方式在Android中编写了端到端UI测试。 </p><br><p><img src="https://habrastorage.org/webt/sh/f7/ej/shf7ejqt1wouqjj5vjej-vwbnzi.jpeg" alt="图片"></p><a name="habracut"></a><br><h1 id="pro-servis-testovye-dannye-i-pochemu-vse-ne-tak-prosto"> 关于服务，测试数据以及为什么它不是那么简单 </h1><br><p> 首先，简要介绍我们的服务，以便您了解我们为什么做出某些决定。 </p><br><p> 我们帮助求职者和雇主找到彼此： </p><br><ul><li> 雇主注册公司并职位空缺 </li><li> 求职者搜索职位，将其添加到收藏夹，订阅搜索结果，创建简历并发送反馈 </li></ul><br><p> 为了模拟真实的用户场景并确保应用程序在它们上正确运行，我们需要在服务器上创建所有这些测试数据。 您会说：“因此，预先创建测试雇主和求职者，然后在测试中与他们合作。” 但是有两个问题： </p><br><ol><li> 在测试期间，我们会更改数据； </li><li> 测试并行运行。 </li></ol><br><h1 id="testovoe-okruzhenie-i-fikstury"> 测试环境和固定装置 </h1><br><p> 端到端测试在测试平台上运行。 他们几乎拥有军事环境，但没有真实数据。 在这方面，当添加新数据时，索引几乎立即发生。 </p><br><p> 要将数据添加到支架，我们使用特殊的夹具方法。 他们将数据直接添加到数据库并立即对其进行索引： </p><br><pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestFixtureUserApi</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@POST(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"fx/employer/create"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createEmployerUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@Body</span></span></span></span><span class="hljs-function"><span class="hljs-params"> employer: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TestEmployer</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Call&lt;TestEmployer&gt; }</code> </pre> <br><p> 夹具仅可从本地网络获得，并且仅适用于测试台。 在开始启动Activity之前立即从测试中调用方法。 </p><br><h1 id="dsl">  DSL </h1><br><p> 因此，我们做到了多汁。 测试数据如何设置？ </p><br><pre> <code class="kotlin hljs">initialisation{ applicant { resume { title = <span class="hljs-string"><span class="hljs-string">"Resume for similar Vacancy"</span></span> isOptional = <span class="hljs-literal"><span class="hljs-literal">true</span></span> resumeStatus = ResumeStatus.APPROVED } resume { title = <span class="hljs-string"><span class="hljs-string">"Some other Resume"</span></span> } } employer { vacancy { title = <span class="hljs-string"><span class="hljs-string">"Resume for similar Vacancy"</span></span> } vacancy { title = <span class="hljs-string"><span class="hljs-string">"Resume for similar Vacancy"</span></span> description = <span class="hljs-string"><span class="hljs-string">"Working hard"</span></span> } vacancy { title = <span class="hljs-string"><span class="hljs-string">"Resume for similar Vacancy"</span></span> description = <span class="hljs-string"><span class="hljs-string">"Working very hard"</span></span> } } }</code> </pre> <br><p> 在初始化块中，我们启动测试所需的实体：在上面的示例中，我们创建了一个有两份履历的求职者，以及一名提供了多个职位空缺的雇主。 </p><br><p> 为了消除与测试数据的交集相关的错误，我们为测试和每个实体生成唯一的标识符。 </p><br><p>  <strong>实体之间的关系</strong> </p><br><p> 使用DSL时的主要限制是什么？ 由于其树结构，在树的不同分支之间建立连接非常困难。 </p><br><p> 例如，在我们的申请人申请表中，有一节“适合简历的职位空缺”。 为了使空缺出现在此列表中，我们需要以与当前用户的简历相关的方式进行设置。 </p><br><pre> <code class="kotlin hljs">initialisation { applicant { resume { title = <span class="hljs-string"><span class="hljs-string">"TEST_VACANCY_</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$uniqueTestId</span></span></span><span class="hljs-string">"</span></span> } } employer { vacancy { title = <span class="hljs-string"><span class="hljs-string">"TEST_VACANCY_</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$uniqueTestId</span></span></span><span class="hljs-string">"</span></span> } } }</code> </pre> <br><p> 为此使用唯一的测试标识符。 因此，在使用该应用程序时，建议为此简历指定指定的职位空缺。 此外，重要的是要注意，此列表中不会出现其他空缺。 </p><br><p>  <strong>初始化相同类型的数据</strong> </p><br><p> 但是，如果您需要大量空缺怎么办？ 每个块都这样复制吗？ 当然不是！ 我们用一个空缺块来制定一种方法，该方法指示出所需的空缺数，并根据唯一标识符将其多样化。 </p><br><pre> <code class="kotlin hljs">initialisation { employer { vacancyBlock { size = <span class="hljs-number"><span class="hljs-number">10</span></span> transformer = { it.also { vacancyDsl -&gt; vacancyDsl.description = <span class="hljs-string"><span class="hljs-string">"Some description with text </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${vacancyDsl.uniqueVacancyId}</span></span></span><span class="hljs-string">"</span></span> } } } } }</code> </pre> <br><p> 在vacancyBlock块中，我们指示需要创建多少个空位克隆，以及如何根据序列号转换它们。 </p><br><p>  <strong>处理测试中的数据</strong> </p><br><p> 在测试期间，处理数据变得非常简单。 我们可以使用我们创建的所有数据。 在我们的实现中，它们存储在用于集合的特殊包装中。 既可以通过作业的订单号（空缺[0]），也可以通过可以在dsl中设置的标签（空缺[“我的空缺”]）和快捷方式（vacucies.first（））从它们获取数据。 </p><br><div class="spoiler">  <b class="spoiler_title">TaggedItemContainer</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TaggedItemContainer</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> items: MutableList&lt;TaggedItem&lt;T&gt;&gt; ) { <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(index: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items[index].<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tag: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items.first { it.tag == tag }.<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plusAssign</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TaggedItem</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { items += item } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forEach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action: (</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> items) action.invoke(item.<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">first</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items[<span class="hljs-number"><span class="hljs-number">0</span></span>].<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">second</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items[<span class="hljs-number"><span class="hljs-number">1</span></span>].<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">third</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items[<span class="hljs-number"><span class="hljs-number">2</span></span>].<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">last</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items[items.size - <span class="hljs-number"><span class="hljs-number">1</span></span>].<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> } }</code> </pre> </div></div><br><p> 在几乎100％的情况下，编写测试时，我们使用first（）和second（）方法，其余的则保留灵活性。 以下是在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kakao</a>上进行初始化和测试的测试示例 </p><br><pre> <code class="kotlin hljs">initialisation { applicant { resume { title = <span class="hljs-string"><span class="hljs-string">"TEST_VACANCY_</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$uniqueTestId</span></span></span><span class="hljs-string">"</span></span> } } }.run { mainScreen { positionField { click() } jobPositionScreen { positionEntry(vacancies.first().title) } searchButton { click() } } }</code> </pre> <br><p>  <strong>DSL不适合什么</strong> </p><br><p> 所有数据都可以放入DSL吗？ 我们的目标是使DSL尽可能简洁明了。 在我们的实施中，由于申请人和雇主的工作顺序并不重要，因此不可能适应他们的关系-回应。 <br> 响应的创建已在下一个块中通过对服务器上已创建的实体的操作执行。 </p><br><h1 id="realizaciya-dsl">  DSL实施 </h1><br><p> 从本文中可以了解到，用于指定测试数据和执行测试的算法如下： </p><br><ul><li>  DSL的一部分在初始化时解析； </li><li> 根据获得的值，在服务器上创建测试数据。 </li><li> 执行可选的转换块，您可以在其中设置响应。 </li><li> 使用已经确定的数据集执行测试。 </li></ul><br><p>  <strong>解析来自初始化块的数据</strong> </p><br><p> 那里正在发生什么魔术？ 考虑如何构造顶级TestCaseDsl元素： </p><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@TestCaseDslMarker</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestCaseDsl</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> applicants = mutableListOf&lt;ApplicantDsl&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> employers = mutableListOf&lt;EmployerDsl&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> uniqueTestId = CommonUtils.unique <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applicant</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ApplicantDsl</span></span></span></span><span class="hljs-function"><span class="hljs-params">.()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> = {}) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> applicantDsl = ApplicantDsl( uniqueTestId, uniqueApplicantId = CommonUtils.unique applicantDsl.block() applicants += applicantDsl } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">employer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">EmployerDsl</span></span></span></span><span class="hljs-function"><span class="hljs-params">.()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> = {}) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> employerDsl = EmployerDsl( uniqueTestId = uniqueTestId, uniqueEmployerId = CommonUtils.unique employerDsl.block() employers += employerDsl } }</code> </pre> <br><p> 在申请人方法中，我们创建ApplicantDsl。 </p><br><div class="spoiler">  <b class="spoiler_title">申请人Dsl</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@TestCaseDslMarker</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicantDsl</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> uniqueTestId: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> uniqueApplicantId: String, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tag: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> login: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> password: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> firstName: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> middleName: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastName: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> email: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> siteId: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> areaId: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> resumeViewLimit: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isMailingSubscription: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> resumes = mutableListOf&lt;ResumeDsl&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ResumeDsl</span></span></span></span><span class="hljs-function"><span class="hljs-params">.()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> = {}) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> resumeDslBuilder = ResumeDsl( uniqueTestId = uniqueTestId, uniqueApplicantId = uniqueApplicantId, uniqueResumeId = CommonUtils.unique ) resumeDslBuilder.apply(block) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.resumes += resumeDslBuilder } }</code> </pre> </div></div><br><p> 然后，我们从以下块块对其执行操作：ApplicantDsl。（）-&gt; Unit。 正是这种设计使我们能够轻松处理DSL中的ApplicantDsl字段。 </p><br><p> 请注意，在执行该块时，已经设置了uniqueTestId和uniqueApplicantId（用于相互连接实体的唯一标识符），我们可以访问它们。 </p><br><p> 初始化块在内部具有类似的结构： </p><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initialisation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TestCaseDsl</span></span></span></span><span class="hljs-function"><span class="hljs-params">.()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>): Initialisation { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> testCaseDsl = TestCaseDsl().apply(block) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> testCase = TestCaseCreator.create(testCaseDsl) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Initialisation(testCase) }</code> </pre> <br><p> 我们创建一个测试，对其应用阻止操作，然后使用TestCaseCreator在服务器上创建数据并将其放入集合中。  TestCaseCreator.create（）函数非常简单-我们遍历数据并在服务器上创建它。 </p><br><h1 id="podvodnye-kamni-i-idei"> 陷阱和想法 </h1><br><blockquote> 某些测试非常相似，仅在输入数据和控制其显示的方式上有所不同（例如，当空缺中指示不同的货币时）。 </blockquote><p> 在我们的案例中，很少有这样的测试，因此我们决定不使用特殊语法使DSL混乱 </p><br><blockquote> 在DSL出现之前的几天里，我们为数据建立索引很长时间，为了节省时间，我们在一类中进行了很多测试，并在一个静态块中创建了所有数据。 </blockquote><p> 不要这样做-这将使您无法重新启动失败的测试。 事实是，在失败测试的启动过程中，我们可以更改服务器上的初始数据。 例如，我们可以在您的收藏夹中添加一个空缺。 然后，当您重新开始测试时，单击星号会相反地导致从“收藏夹”列表中删除空缺，这是我们所不期望的行为。 </p><br><h1 id="itogi"> 总结 </h1><br><p> 这种指定测试数据的方法大大简化了测试工作： <br> 在编写测试时，您无需考虑是否有服务器以及以什么顺序初始化数据。 <br> 可以在服务器上设置的所有实体都可以轻松显示在IDE提示中。 <br> 有一种相互初始化和通信数据的方法。 </p><br><p>  <strong>相关资料</strong> </p><br><p> 如果您对我们的UI测试方法感兴趣，那么在开始之前，建议您熟悉以下材料： </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">类型安全的构建者</a> -kotlinlang.org网站上的官方文档； </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kotlin DSL：理论与实践</a> -jPoint 2018上关于kotlin dsl及其解码的出色报告; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kakao-如何使UI测试再次出色</a> -有关Kakao UI测试框架的基本知识； </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">如何停止恐惧并开始使用Kakao编写UI测试</a> -使用AppsConf 2019谈论Kakao。到目前为止，只有幻灯片可用，然后会有视频。 </li></ul><br><p>  <strong>接下来是什么</strong> </p><br><p> 本文是有关用于编写和支持Android中的UI测试的工具和高级框架的系列文章的第一篇。 随着新零件的推出，我将它们链接到本文。 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN455042/">https://habr.com/ru/post/zh-CN455042/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN455024/index.html">创建云原生应用程序的5条常识原则</a></li>
<li><a href="../zh-CN455026/index.html">与Snom通话：适用于在家工作的人</a></li>
<li><a href="../zh-CN455030/index.html">PHP规范</a></li>
<li><a href="../zh-CN455032/index.html">不是错误，而是功能：研究多态性人的运动能力和大脑活动</a></li>
<li><a href="../zh-CN455040/index.html">改善Wi-Fi的工作。 第2部分。设备功能</a></li>
<li><a href="../zh-CN455046/index.html">N + 7本书</a></li>
<li><a href="../zh-CN455048/index.html">用于区域分析的热势方法的技术实施</a></li>
<li><a href="../zh-CN455050/index.html">使用Oracle数据库进行技术市场分析</a></li>
<li><a href="../zh-CN455052/index.html">夏季DIYorDIE聚会6月16日</a></li>
<li><a href="../zh-CN455054/index.html">苹果将​​如何（私下）离线找到丢失的设备？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>