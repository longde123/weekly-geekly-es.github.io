<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéí üë® ü§∞üèæ Um editor de texto n√£o √© a sua matem√°tica mais alta, aqui voc√™ precisa pensar üéã üßöüèø ü¶é</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Os editores de texto modernos s√£o capazes n√£o apenas de emitir um bipe e de deixar o programa. Acontece que um metabolismo muito complexo ferve dentro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Um editor de texto n√£o √© a sua matem√°tica mais alta, aqui voc√™ precisa pensar</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/424763/"> Os editores de texto modernos s√£o capazes n√£o apenas de emitir um bipe e de deixar o programa.  Acontece que um metabolismo muito complexo ferve dentro deles.  Deseja saber quais truques est√£o sendo feitos para recalcular rapidamente as coordenadas, como estilos, dobras e softwraps s√£o anexados ao texto e como tudo √© atualizado, o que a estrutura de dados funcional e a fila de prioridade t√™m a ver com ele, bem como como enganar o usu√°rio - bem-vindo ao gato! <br><br><img src="https://habrastorage.org/webt/sr/i0/vg/sri0vg3jog_-mc16jc5zz-wjxw0.jpeg"><br><br>  O artigo √© baseado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">relat√≥rio de</a> Alexei Kudryavtsev com o Joker 2017. Alexei escreve Intellij IDEA no JetBrains h√° 10 anos.  Abaixo do corte, voc√™ encontrar√° a transcri√ß√£o em v√≠deo e texto do relat√≥rio. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/YzWr9CN6cGQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h1>  Estruturas de dados dentro de editores de texto </h1><br>  Para entender como o editor funciona, vamos escrever. <br><br><img src="https://habrastorage.org/webt/q9/nb/-n/q9nb-nr675yuu19v6loydkq3nrm.png"><br><br>  √â isso a√≠, nosso editor mais simples est√° pronto. <br><br>  Dentro do editor, o texto √© mais f√°cil de armazenar em uma matriz de caracteres ou, o que √© o mesmo (em termos de organiza√ß√£o da mem√≥ria), na classe Java StringBuffer.  Para obter algum caractere por deslocamento, chamamos o m√©todo StringBuffer.charAt (i).  E para inserir nele o caractere digitado no teclado, chamamos o m√©todo StringBuffer.insert (), que insere o caractere em algum lugar no meio. <br><br>  O mais interessante, apesar de toda a simplicidade e idiotice deste editor, √© a melhor id√©ia que voc√™ pode inventar.  √â simples e quase sempre r√°pido. <br><br>  Infelizmente, um problema de escala surge com este editor.  Imagine que imprimimos muito texto e vamos inserir outra letra no meio.  O seguinte acontecer√°.  Precisamos urgentemente liberar espa√ßo para esta carta movendo todas as outras letras para um caractere.  Para fazer isso, trocamos esta carta por uma posi√ß√£o, depois a seguinte e assim por diante, at√© o final do texto. <br><br>  Aqui est√° como ficaria na mem√≥ria: <br><br><img src="https://habrastorage.org/webt/ec/uk/r4/ecukr4oxdmj0tlxojojwuf9k8i4.gif"><br><br>  Mudar todos esses megabytes n√£o √© muito bom: √© lento.  Obviamente, para um computador moderno, isso √© uma quest√£o insignificante - algum tipo de megabytes pat√©tico para se mover de um lado para o outro.  Mas para uma altera√ß√£o de texto muito ativa, isso pode ser percept√≠vel. <br><br>  Para resolver esse problema de inser√ß√£o de um caractere no meio, h√° muito tempo surgiu uma solu√ß√£o alternativa chamada "Gap Buffer". <br><br><h3>  Buffer de lacuna </h3><br>  Lacuna √© a lacuna.  Buffer √©, como voc√™ pode imaginar, um buffer.  A estrutura de dados do Gap Buffer √© um buffer t√£o vazio que mantemos no meio do nosso texto, apenas por precau√ß√£o.  Se precisarmos imprimir algo, usamos esse pequeno buffer de texto para digita√ß√£o r√°pida. <br><br><img src="https://habrastorage.org/webt/vc/ca/v4/vccav4jbt0zboaf_fuo985dzerc.png"><br><br>  A estrutura dos dados mudou um pouco - a matriz permaneceu no local, mas dois ponteiros apareceram: no in√≠cio do buffer e no final.  Para pegar um caractere do editor em algum deslocamento, precisamos entender se √© antes ou depois desse buffer e corrigir um pouco o deslocamento.  E para inserir um caractere, primeiro precisamos mover o Gap Buffer para esse local e preench√™-lo com esses caracteres.  E, √© claro, se formos al√©m do nosso buffer, de alguma forma o recrie.  √â assim que fica na imagem. <br><br><img src="https://habrastorage.org/webt/bu/4a/gs/bu4ags_jk9vobq_9rxegbww01nw.gif"><br><br>  Como voc√™ pode ver, primeiro movemos por um longo per√≠odo de tempo em um pequeno buffer de espa√ßo (ret√¢ngulo azul) para o local de edi√ß√£o (simplesmente trocando os caracteres pelas bordas esquerda e direita).  Ent√£o usamos esse buffer, digitando caracteres l√°. <br><br>  Como voc√™ pode ver, n√£o h√° movimento de megabytes de caracteres, a inser√ß√£o √© muito r√°pida, por um tempo constante, e parece que todos est√£o felizes.  Tudo parece estar bem, mas se nosso processador estiver muito lento, ser√° desperdi√ßado um tempo bastante percept√≠vel movendo o buffer de lacuna e o texto para frente e para tr√°s.  Isso foi especialmente not√°vel na √©poca de megahertz muito pequeno. <br><br><h3>  Tabela de pe√ßas </h3><br>  Naquele momento, uma empresa chamada Microsoft escreveu um editor de texto Word.  Eles decidiram aplicar outra id√©ia para acelerar a edi√ß√£o chamada "Tabela de pe√ßas", ou seja, "Tabela de pe√ßas".  E eles propuseram salvar o texto do editor na mesma matriz mais simples de caracteres, que n√£o ser√° alterada, e colocar todas as altera√ß√µes em uma tabela separada dessas mesmas partes editadas. <br><br><img src="https://habrastorage.org/webt/gf/gt/gu/gfgtgutww7ymm-bx-4v7tytyjt4.png"><br><br>  Portanto, se precisarmos encontrar algum caractere por deslocamento, precisamos encontrar essa pe√ßa que editamos e extra√≠-la e, se n√£o estiver l√°, v√° para o texto original.  Inserir um s√≠mbolo fica mais f√°cil, basta criar e adicionar esta nova pe√ßa √† tabela.  Aqui est√° como fica a figura: <br><br><img src="https://habrastorage.org/webt/94/8w/3u/948w3uylg_cuxh8mywws-owxs_i.gif"><br><br>  Aqui, desejamos remover o espa√ßo no deslocamento 5. Para fazer isso, adicionamos duas novas pe√ßas √† tabela de fatias: uma indica o primeiro fragmento ("Bummer") e a segunda indica o fragmento ap√≥s a edi√ß√£o ("ovelha").  Acontece que a lacuna desaparece, essas duas pe√ßas s√£o coladas e temos um novo texto j√° sem espa√ßo: ‚ÄúOblomovtsy‚Äù.  Em seguida, adicionamos o novo texto ("sofrendo de oblomovismo") ao final.  Use um buffer adicional e adicione uma nova fatia √† tabela de pe√ßas que aponta para esse texto mais recente adicionado. <br><br>  Como voc√™ pode ver, n√£o h√° movimento para a frente e para tr√°s, todo o texto permanece no lugar.  A m√° not√≠cia √© que est√° ficando mais dif√≠cil chegar ao s√≠mbolo, porque √© dif√≠cil classificar todas essas pe√ßas. <br><br>  Para resumir. <br><br>  O que h√° de bom na <b>Piece Table</b> : <br><br><ul><li>  Incorporar rapidamente; </li><li>  F√°cil de desfazer; </li><li>  Anexar somente. </li></ul><br>  O que √© ruim: <br><br><ul><li>  √â terrivelmente dif√≠cil acessar um documento; </li><li>  √â terrivelmente dif√≠cil de implementar. </li></ul><br>  Vamos ver quem geralmente usamos o qu√™. <br><br>  O NetBeans, Eclipse e Emacs usam o Gap Buffer - muito bem!  Vi n√£o se incomoda e usa apenas uma lista de linhas.  O Word usa a tabela de pe√ßas (eles recentemente expuseram seus tipos antigos e voc√™ pode at√© entender alguma coisa). <br><br>  Atom √© mais interessante.  At√© recentemente, eles n√£o se incomodavam e usavam uma lista de linhas JavaScript.  E ent√£o eles decidiram reescrever tudo em C ++ e montaram uma estrutura bastante complicada, que parece ser semelhante √† Tabela de Pe√ßas.  Mas essas pe√ßas n√£o s√£o armazenadas na lista, mas na √°rvore e na chamada √°rvore de reprodu√ß√£o - essa √© uma √°rvore que se ajusta automaticamente quando inserida nela, para que inser√ß√µes recentes sejam mais r√°pidas.  Eles fizeram uma coisa muito complicada. <br><br>  O que o Intellij IDEA usa? <br>  N√£o, n√£o gap gap.  N√£o, voc√™ tamb√©m est√° errado, n√£o √© uma mesa de pe√ßas. <br>  Sim, muito bem, sua pr√≥pria bicicleta. <br><br>  O fato √© que os requisitos do IDE para armazenar texto s√£o ligeiramente diferentes dos de um editor de texto comum.  O IDE precisa de suporte para v√°rias coisas complicadas, como competitividade, ou seja, acesso paralelo ao texto do editor.  Por exemplo, para que muitos produtos assados ‚Äã‚Äãdiferentes possam l√™-lo e fazer alguma coisa.  (Inspe√ß√£o √© um pequeno peda√ßo de c√≥digo que analisa o programa de uma maneira ou de outra - por exemplo, procurando locais que geram uma NullPointerException).  O IDE tamb√©m precisa de suporte √† vers√£o de texto edit√°vel.  V√°rias vers√µes est√£o simultaneamente na mem√≥ria enquanto voc√™ trabalha com um documento para que esses processos longos continuem analisando a vers√£o antiga. <br><br><h1>  Os problemas </h1><br><h3>  Competitividade / Vers√£o </h3><br>  Para manter o paralelismo, as opera√ß√µes de texto geralmente s√£o agrupadas em "sincronizadas" ou em bloqueios de leitura / grava√ß√£o.  Infelizmente, isso n√£o escala muito bem.  Outra abordagem √© o texto imut√°vel, ou seja, um reposit√≥rio de texto imut√°vel. <br><br><img src="https://habrastorage.org/webt/ov/ia/sa/oviasaeniuwmhiaebpsic_mxm88.png"><br><br>  Aqui est√° a apar√™ncia de um editor com um documento imut√°vel como uma estrutura de dados de suporte. <br><br>  Como a estrutura de dados funciona? <br><br>  Em vez de uma matriz de caracteres, teremos um novo objeto do tipo ImmutableText, que armazena texto na forma de uma √°rvore, onde pequenas substrings s√£o armazenadas nas planilhas.  Ao acessar em algum deslocamento, ele tenta alcan√ßar a folha inferior desta √°rvore e j√° lhe ser√° solicitado o s√≠mbolo ao qual est√°vamos nos referindo.  E quando voc√™ insere um texto, ele cria uma nova √°rvore e a salva no local antigo. <br><br><img src="https://habrastorage.org/webt/_2/xx/rh/_2xxrh9kohjwodn3ub-gyt2z8la.gif"><br><br>  Por exemplo, temos um documento com o texto "Sem calorias".  √â implementado como uma √°rvore com duas folhas de substitui√ß√µes "Dem√¥nio" e "alto teor cal√≥rico".  Quando queremos inserir a linha "bonita" no meio, uma nova vers√£o do nosso documento √© criada.  E, precisamente, √© criada uma nova raiz, na qual tr√™s folhas j√° est√£o anexadas: "Dem√¥nio", "suficiente" e "alto teor cal√≥rico".  Al√©m disso, duas dessas novas folhas podem se referir √† primeira vers√£o do nosso documento.  E para a planilha em que inserimos a linha ‚Äúbonita‚Äù, um novo v√©rtice √© alocado.  Aqui, a primeira e a segunda vers√£o est√£o dispon√≠veis ao mesmo tempo e s√£o todas imut√°veis, imut√°veis.  Tudo parece bom. <br><br>  Quem usa quais estruturas complicadas? <br><br><img src="https://habrastorage.org/webt/yf/mt/eh/yfmtehxbzlale_95bblpk2msh2k.jpeg"><br><br>  Por exemplo, no GNOME, alguns de seus widgets padr√£o usam uma estrutura chamada Rope.  O Xi-Editor, o novo editor brilhante de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Raf Levien</a> , usa Corda Persistente.  E a Intellij IDEA usa essa √Årvore Imut√°vel.  Por tr√°s de todos esses nomes, de fato, h√° mais ou menos a mesma estrutura de dados com uma representa√ß√£o do texto em forma de √°rvore.  Exceto que o GtkTextBuffer usa a Corda mut√°vel, ou seja, uma √°rvore com v√©rtices mut√°veis, e Intellij IDEA e Xi-Editor - Imut√°vel. <br><br>  A pr√≥xima coisa a considerar ao desenvolver um reposit√≥rio de caracteres nos IDEs modernos √© chamada multicats.  Esse recurso permite imprimir em v√°rios locais ao mesmo tempo, usando v√°rios carros. <br><br><img src="https://habrastorage.org/webt/qb/ak/9t/qbak9tqjnu7v_iiciaouw-qqeug.gif"><br><br>  Podemos imprimir algo e, ao mesmo tempo, em v√°rios locais do documento, inserimos o que imprimimos l√°.  Se observarmos como nossas estruturas de dados, que examinamos, reagem aos multicaretas, veremos algo interessante. <br><br><img src="https://habrastorage.org/webt/ty/4p/8k/ty4p8kuqs1rgeanxr9y3n9i8wz4.jpeg"><br><br>  Se inserirmos um caractere em nosso primeiro editor primitivo, naturalmente levar√° um tempo linear para mover um monte de caracteres para frente e para tr√°s.  Isso est√° escrito como O (N).  Para o editor baseado no Gap Buffer, por sua vez, √© necess√°rio tempo constante, para o qual ele foi cunhado. <br><br>  Para uma √°rvore imut√°vel, o tempo depende logaritmicamente do tamanho, porque voc√™ deve primeiro ir do topo da √°rvore at√© a folha - este √© o logaritmo e, em seguida, para todos os v√©rtices no caminho para criar novos v√©rtices para a nova √°rvore - esse √© novamente o logaritmo.  A tabela de pe√ßas tamb√©m requer uma constante. <br>  Mas tudo muda um pouco se tentarmos medir o tempo de inser√ß√£o de um personagem em um editor com v√°rias carruagens, ou seja, inserindo simultaneamente em v√°rios lugares.  √Ä primeira vista, o tempo parece aumentar proporcionalmente por um fator de C - o n√∫mero de lugares onde o s√≠mbolo √© inserido.  √â exatamente isso que acontece, com exce√ß√£o do Gap Buffer.  No caso dele, o tempo, em vez de C, aumenta inesperadamente alguns tempos C * L incompreens√≠veis, onde L √© a dist√¢ncia m√©dia entre as carruagens.  Por que isso est√° acontecendo? <br><br>  Imagine que precisamos inserir a linha ", on" em dois lugares em nosso documento. <br><br><img src="https://habrastorage.org/webt/ec/n3/jd/ecn3jdpnsvqscfbvjxivopbs5uq.gif"><br><br>  √â o que acontece no editor no momento. <br><br><ul><li>  Crie um buffer de diferen√ßa no editor (um pequeno ret√¢ngulo azul na imagem); </li><li>  Iniciamos duas carruagens (linhas verticais em negrito e pretas); </li><li>  Estamos tentando imprimir; </li><li>  Inserir uma v√≠rgula em nosso Gap Buffer; </li><li>  Agora voc√™ deve inseri-lo no lugar do segundo carro; </li><li>  Para fazer isso, precisamos mover nosso Gap Buffer para a posi√ß√£o do pr√≥ximo carro; </li><li>  Imprima uma v√≠rgula em segundo lugar; </li><li>  Agora voc√™ precisa inserir o pr√≥ximo caractere na posi√ß√£o do primeiro carro; </li><li>  E temos que empurrar nosso Gap Buffer de volta; </li><li>  Inserir a letra "n"; </li><li>  E movemos nosso amortecedor de sofrimento para o local da segunda carruagem; </li><li>  N√≥s inserimos nosso "n" l√°; </li><li>  Mova o buffer de volta para inserir o pr√≥ximo caractere. </li></ul><br>  Sente para onde est√° indo tudo? <br><br>  Sim, acontece que, devido a esses numerosos movimentos do buffer, o tempo total aumenta.  Honestamente, n√£o √© que esteja diretamente horrorizado √† medida que aumenta - mover megabytes e gigabytes pat√©ticos para um computador moderno n√£o √© um problema, mas √© interessante que essa estrutura de dados funcione radicalmente de maneira diferente no caso de multicats. <br><br><h3>  Linhas demais?  LineSet! </h3><br>  Que outros problemas existem em um editor de texto comum?  O problema mais dif√≠cil √© rolar, ou seja, redesenhar o editor enquanto move o carro para a pr√≥xima linha. <br><br><img src="https://habrastorage.org/webt/yt/0d/rn/yt0drnu1rsxyciwb4pruefmufyu.gif"><br><br>  Quando o editor rola, precisamos entender a partir de qual linha, de qual s√≠mbolo precisamos come√ßar a desenhar o texto em nossa pequena janela.  Para fazer isso, precisamos entender rapidamente qual linha corresponde a qual deslocamento. <br><br><img src="https://habrastorage.org/webt/kn/ak/gm/knakgm1aq7-wnjwbruefxeyouh0.png"><br><br>  Existe uma interface √≥bvia para isso, quando precisamos entender seu deslocamento no texto pelo n√∫mero da linha.  E vice-versa, pelo deslocamento no texto para entender em que linha est√°.  Como isso pode ser feito rapidamente? <br><br>  Por exemplo, assim: <br><br>  Organize essas linhas em uma √°rvore e marque cada v√©rtice dessa √°rvore, deslocando o in√≠cio da linha e o final da linha.  E ent√£o, para entender pelo deslocamento em que linha est√° localizada, basta executar uma pesquisa logar√≠tmica nessa √°rvore e localiz√°-la. <br><br><img src="https://habrastorage.org/webt/x1/jq/3w/x1jq3w1gwiytzsrdytznnltc_l0.png"><br><br>  Outra maneira √© ainda mais f√°cil. <br><br>  Escreva na tabela o deslocamento do in√≠cio das linhas e do final das linhas.  E ent√£o, para encontrar o deslocamento do come√ßo e do fim pelo n√∫mero da linha, voc√™ precisar√° acessar o √≠ndice. <br><br><img src="https://habrastorage.org/webt/wq/ls/wy/wqlswyl-k5brg4fsbgoxaqxkj1u.png"><br><br>  Curiosamente, no mundo real, os dois m√©todos s√£o usados. <br><br><img src="https://habrastorage.org/webt/ii/w6/qu/iiw6quo2j0clh8xnovh0mfn5ow0.jpeg"><br><br>  Por exemplo, o Eclipse usa uma estrutura de madeira que, como voc√™ pode ver, funciona em um tempo logar√≠tmico para leitura e atualiza√ß√£o.  E o IDEA usa uma estrutura de tabela, para a qual a leitura √© uma constante r√°pida, √© uma revers√£o de √≠ndice em uma tabela, mas a reconstru√ß√£o √© bastante lenta, porque voc√™ precisa reconstruir a tabela inteira ao alterar o comprimento de uma linha. <br><br><h3>  Ainda h√° muitas linhas?  Foldings! </h3><br>  O que mais h√° de ruim entre os editores de texto?  Por exemplo, dobras.  Estes s√£o peda√ßos de texto que voc√™ pode "recolher" e mostrar outra coisa. <br><br><img src="https://habrastorage.org/webt/tp/g1/fc/tpg1fcoak4ahpzd1mbf9wex_jvi.png"><br><br>  Esses pontos em um plano de fundo verde na imagem escondem muitos s√≠mbolos atr√°s de n√≥s, mas se n√£o estivermos interessados ‚Äã‚Äãem examin√°-los (como no caso, por exemplo, dos documentos Java ou listas de importa√ß√£o mais longos e chatos), os ocultamos e os reduzimos retic√™ncias. <br><br>  E aqui novamente voc√™ precisa entender quando termina e quando come√ßa a regi√£o que precisamos mostrar, e como atualizar tudo rapidamente?  Como isso est√° organizado, vou contar um pouco mais tarde. <br><br><h3>  Linhas muito longas?  Envolt√≥rio macio! </h3><br><img src="https://habrastorage.org/webt/yu/lb/hg/yulbhgos7wf3ilx0gqtxg2lrkpq.jpeg"><br><br>  Al√©m disso, os editores modernos n√£o podem viver sem o Soft wrap.  A imagem mostra que o desenvolvedor abriu o arquivo JavaScript ap√≥s a minimiza√ß√£o e se arrependeu imediatamente.  Essa enorme linha JavaScript, quando tentamos mostr√°-la no editor, n√£o cabe em nenhuma tela.  Portanto, o envolt√≥rio macio o for√ßa em v√°rias linhas e o empurra para a tela. <br>  Como √© organizado - mais tarde. <br><br><h3>  Muito pouca beleza </h3><br><img src="https://habrastorage.org/webt/md/yh/d0/mdyhd06genl8kiaehxjectze9g4.jpeg"><br><br>  E, finalmente, tamb√©m quero trazer beleza aos editores de texto.  Por exemplo, destaque algumas palavras.  Na figura acima, as palavras-chave s√£o destacadas em azul negrito, alguns m√©todos est√°ticos em it√°lico, algumas anota√ß√µes - tamb√©m em cores diferentes. <br><br>  Ent√£o, como voc√™ ainda armazena e processa dobras, envolvimentos suaves e destaques? <br>  Acontece que tudo isso, em princ√≠pio, √© uma e a mesma tarefa. <br><br><h3>  Pouca beleza?  Marcadores de gama! </h3><br><img src="https://habrastorage.org/webt/jj/rl/t7/jjrlt7sisz9curcqa5lotpzjfya.jpeg"><br><br>  Para suportar todos esses recursos, tudo o que precisamos fazer √© fixar alguns atributos de texto em um determinado deslocamento no texto, por exemplo, cor, fonte ou texto para dobrar.  Al√©m disso, esses atributos de texto devem ser atualizados o tempo todo neste local para que possam sobreviver a todos os tipos de inser√ß√µes e exclus√µes. <br><br>  Como isso geralmente √© implementado?  Naturalmente, na forma de uma √°rvore. <br><br><h3>  Problema: muita beleza?  √Årvore de intervalo! </h3><br><img src="https://habrastorage.org/webt/0e/ux/le/0euxleajuom5pdsa02kwxuudyny.jpeg"><br><br>  Por exemplo, aqui temos v√°rios destaques amarelos que queremos manter no texto.  N√≥s adicionamos os intervalos desses destaques em uma √°rvore de pesquisa, a chamada √°rvore de intervalo.  Essa √© a mesma √°rvore de pesquisa, mas um pouco mais complicada porque precisamos armazenar intervalos em vez de n√∫meros. <br><br>  E como existem intervalos saud√°veis ‚Äã‚Äãe pequenos, como classific√°-los, compar√°-los entre si e coloc√°-los em uma √°rvore √© uma tarefa n√£o trivial.  Embora muito conhecido na ci√™ncia da computa√ß√£o.  Ent√£o olhe de alguma forma para o seu lazer como funciona.  Ent√£o, pegamos e colocamos todos os nossos intervalos em uma √°rvore, e cada mudan√ßa no texto em algum lugar no meio leva a uma mudan√ßa logar√≠tmica nessa √°rvore.  Por exemplo, a inser√ß√£o de um caractere deve resultar na atualiza√ß√£o de todos os intervalos √† direita desse caractere.  Para fazer isso, encontramos todos os v√©rtices dominantes desse s√≠mbolo e indicamos que todos os seus v√©rtices devem ser movidos um s√≠mbolo para a direita. <br><br><h3>  Ainda quer beleza?  Ligaduras! </h3><br><img src="https://habrastorage.org/webt/iv/j-/tb/ivj-tb9_w2ata-tiwclrmqfjs_a.jpeg"><br><br>  Ainda existe uma coisa t√£o terr√≠vel - as ligaduras, que eu tamb√©m gostaria de apoiar.  Essas s√£o belezas diferentes, como o sinal ‚Äú! =‚Äù √â desenhado na forma de um grande glifo ‚Äúdiferente‚Äù e assim por diante.  Felizmente, aqui estamos contando com um mecanismo de giro para apoiar essas ligaduras.  E, em nossa experi√™ncia, ele aparentemente trabalha da maneira mais simples.  Dentro da fonte, √© armazenada uma lista de todos esses pares de caracteres que, quando combinados, formam algum tipo de ligadura complicada.  Ent√£o, ao desenhar a linha, o Swing simplesmente itera sobre todos esses pares, encontra os necess√°rios e os desenha de acordo.  Se voc√™ tiver muitas ligaduras na fonte, aparentemente, exibi-la diminuir√° proporcionalmente. <br><br><h3>  Freios basculantes </h3><br>  E o mais importante - outro problema encontrado nos modernos editores complexos √© a otimiza√ß√£o da gorjeta, ou seja, pressionar as teclas e exibir o resultado. <br><br><img src="https://habrastorage.org/webt/fq/yb/wi/fqybwipttxn9pvl3phzc5qts6_k.jpeg"><br><br>  Se voc√™ entrar no Intellij IDEA e ver o que acontece quando voc√™ pressiona um bot√£o, acontece o seguinte horror: <br><br><ul><li>  Com o clique de um bot√£o, devemos ver se estamos no pop-up de conclus√£o para fechar o menu para conclus√£o, se, por exemplo, digitarmos ‚ÄúEnter‚Äù. </li><li>  Voc√™ precisa ver se o arquivo est√° sob algum sistema de controle de vers√£o complicado, como o Perforce, que precisa executar alguma a√ß√£o para iniciar a edi√ß√£o. </li><li>  Verifique se h√° alguma regi√£o especial no documento que n√£o possa ser impressa, como alguns textos gerados automaticamente. </li><li>  Se o documento estiver bloqueado por uma opera√ß√£o que n√£o terminou, voc√™ precisar√° concluir a formata√ß√£o e s√≥ ent√£o continuar. </li><li>  injected-,      ,       ,   -  . </li><li>     auto popup handler,    , ,       . </li><li>   info  ,     ,    .     selection remove,    selection  ,   .    selection ,    . </li><li>     typed handler,       ,      . </li><li>    . </li><li>  undo,  virtual space'   write action. </li><li> ,     . </li></ul><br> ! <br><br> , ,   .  ,    . ,    listener  ,   ,  - .  editor view.  -   listener'. <br><br>      ,   ,  -      DocumentListener? <br><br>  Editor.documentChanged()   : <br><br><ul><li>  error stripe; </li><li>  gutter size, ; </li><li>  editor component size,    ; </li><li>      ; </li><li>  soft wrap,    ; </li><li>  repaint(). </li></ul><br>  repaint() ‚Äî     Swing,        .   ,   Repaint     Swing. <br><br>   -       ,   repaint   ,    : <br><br><img src="https://habrastorage.org/webt/je/qh/cy/jeqhcytdxkun3ft_r7azwrby2eu.jpeg"><br><br>    paint-,   ,        . <br><br>  , ,   ? <br><br><img src="https://habrastorage.org/webt/sm/mo/xq/smmoxqrmfayyfodciwe75svwdzw.jpeg"><br><br>  ,  ,  .    Intellij IDEA   . <br><br><img src="https://habrastorage.org/webt/5u/x8/as/5ux8ashfsenwboudd_u07ubtjmk.jpeg"><br><br>    ,  -   - ,    ,         ,    .  !  ,    ,    ,   -  ‚Äî !      ,  -    .    .      ¬´Zero latency typing¬ª. <br><br><h1>   </h1><br>      ‚Äî    . <br><br>   ?       ,  ‚Äî  ,        Google Docs -    -  . <br><br>  : <br><br><ul><li>  ; </li><li>  . </li></ul><br>   ,        ,          . <br><br>  -          .    ,  ,     .   .   ‚Äî   , ¬´intention preservation¬ª.  ,   -  ,          ,     ,   .    ‚Äî .  ,            -       ,   . <br><br><h3> Operation transformation </h3><br><img src="https://habrastorage.org/webt/h9/e8/pq/h9e8pqu3ljnoh4y70_759peizn0.jpeg"><br><br>  ,       ,  ¬´operation transformation¬ª.   .    , - :     ,     .  Operation transformation       .   ,    ,   ,    - . ,        .    ,    -         .  ,      ,    . <br><br>       ,   ,    ,   .     ¬´TP2 puzzle¬ª. <br><br><img src="https://habrastorage.org/webt/c1/5i/cs/c15icsdnqbjqykloe_pfbxahz-e.jpeg"><br><br>       - ,    ,     .  ,    Operation transformation       ,  ,  ,     (¬´¬ª).       (¬´¬ª).   ,   .    ,         Operation transformation,  -       . <br><br>          ,  Google Docs, Google Wave  -   Etherpad.   Operation transformation    . <br><br><h3> Conflict-free replicated data type </h3><br>      : ¬´  ,  OT!¬ª     ,      ,  . ,  ,    ,              ,      100%         .   ¬´CRDT¬ª (Conflict-free replicated data type). <br><br><img src="https://habrastorage.org/webt/kn/82/9n/kn829n91st7gpykcp905spuy_ki.jpeg"><br><br>   ,    ,          . ,     , ,   .   ,       . -            (  ),  ()      (  ). <br><br><img src="https://habrastorage.org/webt/vs/9-/i7/vs9-i7bdfpjonh_z1cgie6qj4kk.jpeg"><br><br>           ? <br><br>  Sim ,     G-counter',   ,   .      ,       .        ¬´+1¬ª  ,  ¬´+1¬ª  , ,       ‚Äî   ¬´2¬ª.  ,          ,     .      G-counter,     ,       .       G-counter,    .    ,     ,       .       .    ‚Äî   . ,       CRDT. ,   . <br><br><h3> Conflict-free replicated inserts </h3><br><img src="https://habrastorage.org/webt/pz/bg/ta/pzbgta8bteajr0embilmbnpxifc.jpeg"><br><br> ,     ,      ,    . , ,        . <br><br>   ,     ,     -  - , ,  ,  ,        .   ,      ,     ,     ,     . , ,  ,     ,     2    ¬´¬ª,    ,    ¬´¬ª   ¬´¬ª   ¬´¬ª. <br><br><h3> Conflict-free replicated deletes </h3><br><img src="https://habrastorage.org/webt/jt/w1/fb/jtw1fbphe5mjcyhbye4ua-mjf7s.jpeg"><br><br>      .        ,    ,     ,  - .   ,       ,     .  ,       ,        ,    . <br>  ,      . <br><br><h3> Conflict-free replicated edits </h3><br> ,   , CRDT  - , ,  Xi-Editor,          Fuchsia.  ,     ,    . <br><br><h1> Zipper </h1><br>      ,          ¬´Zipper¬ª.  ,      ,      . ,  ,        .    , ( ¬´¬ª ,   ,     ¬´  ¬ª). ,      -     .      ,       - ,   .        Zipper. <br><br>           ,     .    . <br><br><img src="https://habrastorage.org/webt/ap/ne/p2/apnep2miklsburr5xhtqgcwbzri.gif"><br><br>  Zipper   ,      (¬´  ¬ª).     Zipper'       .    ‚Äî     .       (),   ,          . ,    Zipper,   -        ,   .  ,     ,   ,   ( ).      ,        ( ).   ,                .    ,        . <br><br>  ,        . <br><br>       ? -,   ,    ,    ,    .  ,       ,   .  -,    ,      .     . . <br><br> ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> <br> ‚Üí <a href=""></a> <br><br><h1>  Refer√™ncias </h1><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Zipper data structure</a> <br> <a href="">  CRDT in Xi Editor</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">       </a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   </a> <br><br>     ,         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> Visual Studio Code editor  Piece Table</a> . <br>  ,   -   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> . <br><br><blockquote> Deseja relat√≥rios ainda mais poderosos, incluindo o Java 11?  Ent√£o, estamos esperando por voc√™ no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Joker 2018</a> .  Palestrantes deste ano: Josh Long, John McClean, Marcus Hirth, Robert Scholte e outros palestrantes igualmente legais.  Faltam 17 dias para a confer√™ncia.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ingressos</a> no site. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt424763/">https://habr.com/ru/post/pt424763/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt424751/index.html">Como o sistema biom√©trico unificado funciona</a></li>
<li><a href="../pt424753/index.html">O que h√° de novo no YouTrack 2018.3</a></li>
<li><a href="../pt424755/index.html">O dinheiro adora a conta: como os carros classificam as contas</a></li>
<li><a href="../pt424757/index.html">O resumo de eventos para profissionais de RH na √°rea de TI em outubro de 2018</a></li>
<li><a href="../pt424761/index.html">Introdu√ß√£o aos processos de inicializa√ß√£o e inicializa√ß√£o do kernel Linux</a></li>
<li><a href="../pt424765/index.html">Gerenciamento de estado em aplicativos Flutter</a></li>
<li><a href="../pt424767/index.html">N√≥s fazemos um bolo de Habr. Novamente</a></li>
<li><a href="../pt424771/index.html">Experi√™ncia pessoal: de uma ideia e uma folha em branco a uma vers√£o de rascunho de um site</a></li>
<li><a href="../pt424773/index.html">Biofarma e modelagem num√©rica: experi√™ncia e pr√°tica da Amgen</a></li>
<li><a href="../pt424777/index.html">Usando o c√¥nsul para dimensionar servi√ßos estatais</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>