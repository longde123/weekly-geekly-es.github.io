<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¥  â†—ï¸ ğŸ¦“ è¿·ä½ å…‰çº¿å’Œéœ‡åŠ¨ä¼ æ„Ÿå™¨| nRF52840 ğŸ‘¨ğŸ»â€ğŸ³ ğŸ› ğŸ™ğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨ä»Šå¤©çš„æ–‡ç« ä¸­ï¼Œæˆ‘æƒ³è°ˆä¸€è°ˆæ–°çš„å…‰å’ŒæŒ¯åŠ¨ä¼ æ„Ÿå™¨ã€‚ ä¼ æ„Ÿå™¨åœ¨æ¨¡å—E73-2Gâ€‹â€‹4M08S1Cï¼ˆnRF52840ï¼‰ä¸Šå·¥ä½œã€‚ ä¹‹æ‰€ä»¥å¼€å‘MKï¼Œæ˜¯å› ä¸ºåŸºäºSandeep Mistryåº“å¯¹Arduino IDEçš„æ”¯æŒç›¸å½“ç®€å•ï¼Œæˆæœ¬ä½ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œå¹¶å…·æœ‰éšåä»MySensorsæ— ç¼åˆ‡æ¢åˆ°ZigBeeçš„èƒ½åŠ›ï¼šï¼‰ 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>è¿·ä½ å…‰çº¿å’Œéœ‡åŠ¨ä¼ æ„Ÿå™¨| nRF52840</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478960/"> åœ¨ä»Šå¤©çš„æ–‡ç« ä¸­ï¼Œæˆ‘æƒ³è°ˆä¸€è°ˆæ–°çš„å…‰å’ŒæŒ¯åŠ¨ä¼ æ„Ÿå™¨ã€‚ ä¼ æ„Ÿå™¨åœ¨æ¨¡å—E73-2Gâ€‹â€‹4M08S1Cï¼ˆnRF52840ï¼‰ä¸Šå·¥ä½œã€‚ ä¹‹æ‰€ä»¥å¼€å‘MKï¼Œæ˜¯å› ä¸ºåŸºäºSandeep Mistryåº“å¯¹Arduino IDEçš„æ”¯æŒç›¸å½“ç®€å•ï¼Œæˆæœ¬ä½ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œå¹¶å…·æœ‰éšåä»MySensorsæ— ç¼åˆ‡æ¢åˆ°ZigBeeçš„èƒ½åŠ›ï¼šï¼‰ <br><br><img src="https://habrastorage.org/webt/dm/b0/dt/dmb0dtvbakfgj_pgye8k_wjlmdc.jpeg"><br><a name="habracut"></a><br> éšç€æˆ‘å®¶ç™¾å¶çª—çš„å‡ºç°ï¼Œå¯¹æ­¤ç±»é¡¹ç›®çš„éœ€æ±‚ä¹Ÿéšä¹‹å¢åŠ ã€‚ æ»šåŠ¨ç™¾å¶çª—æ§åˆ¶å™¨å¿…é¡»ç›´æ¥ä»ç”±æ§åˆ¶å™¨æ§åˆ¶çª—å¸˜çš„çª—æˆ·æ¥æ”¶ç…§æ˜æ°´å¹³çš„æ•°æ®ã€‚ <br><br> æœ€åˆï¼Œæˆ‘è®¡åˆ’ä½¿ç”¨BH1750FVIä¼ æ„Ÿå™¨ï¼Œè¯¥ä¼ æ„Ÿå™¨çš„ç‰¹æ€§å¾ˆå¥½ï¼Œåœ¨æˆ‘çš„å…¶ä»–diyé¡¹ç›®ä¸­å·²å¤šæ¬¡ä½¿ç”¨ã€‚ ä½†æ˜¯åœ¨æŸäº›æ—¶å€™ï¼Œå½“è®¨è®ºå„ç§ä¼ æ„Ÿå™¨æ—¶ï¼Œæœ‰äººå»ºè®®ä»”ç»†ç ”ç©¶ä¸€ä¸‹MAX44009ä¼ æ„Ÿå™¨ã€‚ æˆ‘ä»”ç»†è§‚å¯Ÿï¼Œä»é‚£ä¸€åˆ»èµ·ï¼Œæˆ‘å†ä¹Ÿæ²¡æœ‰æƒ³èµ·BH1750FVIã€‚ <br><br><img src="https://habrastorage.org/webt/d7/bg/a_/d7bga_4sti9_x359xlgirab0egk.jpeg"><br><br>  <b>MAX44009çš„è§„æ ¼ï¼š</b> <br><br><ul><li> ç”µæºç”µå‹èŒƒå›´1.7-3.6 V </li><li> è¶…ä½å·¥ä½œç”µæµ-0.65Î¼Aï¼ˆä½äºè®¸å¤šç±»ä¼¼äº§å“çš„æ‰ç”µæ¨¡å¼ä¸‹çš„ç”µæµï¼‰ï¼Œ </li><li>  22ä½å®½åŠ¨æ€èŒƒå›´0.045-188000ï¼Œ </li><li> ä¸­æ–­åŠŸèƒ½çš„å­˜åœ¨ï¼Œèƒ½å¤Ÿè¿ç»­ç›‘è§†ç…§æ˜æ°´å¹³å¹¶åœ¨è¶…è¿‡æŒ‡å®šé˜ˆå€¼æ—¶ä¸ºMCç”Ÿæˆä¸­æ–­ä¿¡å·çš„èƒ½åŠ›ã€‚ </li></ul><br> ç»è¿‡ä¸€ç•ªæ€è€ƒåï¼Œæˆ‘å†³å®šåœ¨é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªå¯ä»¥ç”¨ä½œæŒ¯åŠ¨ä¼ æ„Ÿå™¨çš„åŠ é€Ÿåº¦è®¡ï¼Œå› æ­¤æˆ‘å¸Œæœ›é€šç”¨æ€§æˆ–æŸç§é«˜çº§åŠŸèƒ½ã€‚ è¿™å°†ä¸ºä¼ æ„Ÿå™¨æ·»åŠ å®‰å…¨åŠŸèƒ½ã€‚ åœ¨æˆ‘çš„æƒ…å†µä¸‹ï¼Œæ ¹æ®äº‹ä»¶ï¼Œå°†é€šè¿‡ä¼ æ„Ÿå™¨è§¦å‘UDä¸­çš„è„šæœ¬ï¼Œè¯¥è„šæœ¬æ¨¡æ‹Ÿæˆ¿å±‹ä¸­çš„å­˜åœ¨ï¼ˆæ‰“å¼€æˆ¿é—´ä¸­çš„ç¯ï¼‰ï¼Œæ¿€æ´»åï¼Œæ²¡äººåœ¨å®¶ã€‚ é€šå¸¸ï¼Œè¯¥ä¼ æ„Ÿå™¨ä¹Ÿå¯ä»¥ç”¨ä½œç‹¬ç«‹çš„æŒ¯åŠ¨å’Œå†²å‡»ä¼ æ„Ÿå™¨ï¼Œåªèƒ½ç„Šæ¥å…‰ä¼ æ„Ÿå™¨æˆ–åŠ é€Ÿåº¦è®¡ã€‚ åŠ é€Ÿåº¦è®¡ä¹Ÿå¯ä»¥é‡æ–°ç¼–ç¨‹ä»¥è¯†åˆ«å°åƒï¼Œè½¬å¼¯ç­‰ã€‚ <br><br> ä½œä¸ºåŠ é€Ÿåº¦è®¡ï¼Œé€‰æ‹©äº†LIS2DW12ä¼ æ„Ÿå™¨ï¼Œè¿™æ˜¯å¸‚åœºä¸Šæœ€ç»æµçš„åŠ é€Ÿåº¦è®¡ä¹‹ä¸€ï¼Œå³ä½¿ä¸æ˜¯æœ€ç»æµçš„ã€‚ <br><br><img src="https://habrastorage.org/webt/ex/jc/op/exjcop6l77shvd-ietzkuksg5hq.jpeg"><br><br>  <b>LIS2DW12çš„åŠŸèƒ½ï¼š</b> <br><br><ul><li> ç”µæºç”µå‹èŒƒå›´1.62-3.6 Vï¼Œ </li><li> å¾…æœºæ¨¡å¼ä¸‹ä¸º50 nA </li><li> åœ¨ä½åŠŸè€—æ¨¡å¼ä¸‹ä¸º1Î¼Aï¼Œ </li><li> ä¸­æ–­åŠŸèƒ½çš„å­˜åœ¨ï¼Œä¼ æ„Ÿå™¨è¿ç»­è¿è¡Œçš„å¯èƒ½æ€§ä»¥åŠåœ¨è¶…è¿‡æŒ‡å®šé˜ˆå€¼æ—¶å½¢æˆMCçš„ä¸­æ–­ä¿¡å·ã€‚ </li></ul><br> ç”±äºå®Œå…¨ç¼ºå°‘ç°æˆçš„ç”¨äºLIS2DW12çš„Arduinoåº“ï¼Œè¯¥åŠ é€Ÿåº¦è®¡æ¨¡å‹çš„å‘å¸ƒå¯èƒ½ä¼šç»™Arduinoå…„å¼Ÿå¸¦æ¥å¯èƒ½çš„é—®é¢˜ï¼Œåæ¥åˆå¢åŠ äº†å¯¹å¦ä¸€æ¬¾å…·æœ‰ç±»ä¼¼ç‰¹æ€§çš„LIS2DH12åŠ é€Ÿåº¦è®¡æ¨¡å‹çš„æ”¯æŒï¼Œä½†åœ¨ä½åŠŸè€—æ¨¡å¼ä¸‹åŠŸè€—æ›´é«˜-2Î¼Aã€‚ å¯¹äºLIS2DH12åŠ é€Ÿåº¦è®¡ï¼Œæœ‰ç›¸å½“ä¸é”™çš„Arduinoåº“ã€‚ <br><br> å…‰çº¿ä¼ æ„Ÿå™¨ç”±CR2032ç”µæ± ä¾›ç”µã€‚ <br><br><img src="https://habrastorage.org/webt/bd/z3/lf/bdz3lfe167cepe3m-5vvg0fc5-0.jpeg"><br><br> è®¸å¤šå·²ç»ä½¿ç”¨MySensorsé¡¹ç›®æ„å»ºå…¶æ™ºèƒ½å®¶å±…çš„äººå¯èƒ½çŸ¥é“ç”µæ± è®¾å¤‡ä¸ŠMySensorsçš„éæœ€ä½³é€»è¾‘ã€‚ é‡æ–°å¯åŠ¨è®¾å¤‡æ—¶ä¸æ–­å‘é€æ¼”ç¤ºæ–‡ç¨¿ï¼Œç½‘ç»œä¸Šè®¾å¤‡è‡ªåŠ¨æ¢å¤çš„æ¬¡ä¼˜æ¨¡å¼ï¼Œç¡çœ åŠŸèƒ½è¢«æ¿€æ´»çš„ä¸­æ–­å¯¼è‡´æ¬¡ä¼˜æ¶ˆè€—ï¼Œé€šå¸¸æ¢¦ä¸­åªæœ‰ä¸¤æ¬¡ä¸­æ–­ã€‚ æ‰€æœ‰æƒ…å†µéƒ½æš—ç¤ºäº†Maysensorsé¡¹ç›®çš„åˆ›å§‹äººå¯¹ç”µæ± çš„æ€åº¦ä¸å¥½ï¼š) <br><br> åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘è¯•å›¾å°†è¿™äº›ç¼ºç‚¹æœ€å°åŒ–ã€‚ <br><br> æˆ‘æƒ³å¤„ç†çš„æœ€åŸºæœ¬çš„äº‹æƒ…æ˜¯æ‰“æ‰°ã€‚ é€šå¸¸ï¼Œå½“åœ¨ç¡çœ åŠŸèƒ½ä¸­æ¿€æ´»ä¸­æ–­æ—¶ï¼ŒnRF52 MKå¼€å§‹æ¶ˆè€—+ 10mKAåˆ°MKæœ¬èº«çš„æ¶ˆè€—ï¼ˆnRF52810-52811ä¸º1.4Î¼Aï¼ŒnRF52832-52840ä¸º4.7Î¼Aï¼‰ã€‚ å…±æœ‰2ä¸ªä¸­æ–­å¯ç”¨ã€‚ <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int8_t</span></span> sleep(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> interrupt1, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> mode1, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> interrupt2, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> mode2, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> sleepingMS = <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> smartSleep = <span class="hljs-literal"><span class="hljs-literal">false</span></span>);</code> </pre> <br> åœ¨å¯»æ±‚è§£å†³æ–¹æ¡ˆä»¥ä¼˜åŒ–æ¢¦å¢ƒä¸­çš„åŠŸè€—çš„æ—©æœŸï¼Œå®ç°äº†åœ¨å†…ç½®ä½åŠŸè€—æ¯”è¾ƒå™¨ä¸Šä½¿ç”¨ä¸­æ–­çš„å¯èƒ½æ€§ï¼Œæ¢¦å¢ƒä¸­çš„åŠŸè€—ä¸å†æ˜¯+ 10Î¼Aï¼Œè€Œæ˜¯åœ¨+1Î¼AèŒƒå›´å†…ï¼Œä½†ä»…å¯ä»¥ä½¿ç”¨ä¸€ä¸ªä¸­æ–­ã€‚ åŸåˆ™ä¸Šï¼Œé™¤äº†ä»£ç ä¸Šçš„ä¸ä¾¿ï¼ˆå¤„ç†æ¥è‡ªå…¶ä»–å¼•è„šçš„ä¿¡å·ï¼‰å’Œæ¿ä¸Šçš„å…¶ä»–å…ƒä»¶ï¼ˆäºŒæç®¡ï¼‰å¤–ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚ ä½†æ˜¯æˆ‘æƒ³è¦æ›´å¥½ã€‚ <br><br> åˆ°é‚£æ—¶ï¼Œæˆ‘å·²ç»å¯¹nRF5 SDKæœ‰ç‚¹ç†Ÿæ‚‰äº†ï¼Œæ‰€ä»¥åœ¨ç ”ç©¶äº†mysensors.orgè®ºå›ï¼ˆæç¤ºï¼ŒæŠ€å·§:)ï¼‰ä¹‹åï¼Œæˆ‘å†³å®šåœ¨nRF5 SDKä¸­å¯»æ‰¾è§£å†³æ–¹æ¡ˆâ€¦â€¦å¹¶æ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆã€‚ ç°åœ¨æœ‰æ— é™æ•°é‡çš„ä¸­æ–­å¯ä¾›ä½¿ç”¨ï¼Œè¿™äº›ä¸­æ–­å®é™…ä¸Šä¸ä¼šæ¶ˆè€—ä»»ä½•é¢å¤–çš„èµ„æºã€‚ ä¸»è¦è¦åšçš„æ˜¯å¯¹Sandeepmistry nRF5åº“çš„ä»£ç å’ŒWInterruptsæ–‡ä»¶è¿›è¡Œå°‘é‡æ›´æ”¹ï¼Œåœ¨GPIOTE_IRQHandlerï¼ˆï¼‰å‡½æ•°ä¹‹å‰æ·»åŠ å±æ€§â€œå¼±â€ï¼Œè¿™å°†å…è®¸æ‚¨åœ¨ç”¨æˆ·ä»£ç ä¸­é‡æ–°å®šä¹‰è¯¥åº“å‡½æ•°-__attribute__ï¼ˆï¼ˆweakï¼‰ï¼‰ <br><br><img src="https://habrastorage.org/webt/s5/sf/oy/s5sfoy5fdmvjiu16afhtkcrxkjg.png"><br><br> è¯¥æ–‡ä»¶ä½äºè·¯å¾„ä¸Š-Cï¼š\ Users \ COMPUTER_USER \ AppData \ Local \ Arduino15 \ packages \ sandeepmistry \ <br> ç¡¬ä»¶\ nRF5 \ 0.6.0 \å†…æ ¸\ nRF5 \ <br> éœ€è¦æ·»åŠ åˆ°é¡¹ç›®ä¸­çš„æ–‡ä»¶ä½äºæˆ‘çš„Gitaä¸Šçš„æ–‡ä»¶å¤¹EFEKTA-LIS2DW12-MAX44009-E73C /æºä»£ç / ARDUINO /ä¸­ï¼Œä½¿ç”¨ç¤ºä¾‹åœ¨è‰å›¾EFEKTA-LIS2DW12-MAX44009-E73C /æºä»£ç / ARDUINO / vibro_ambi1_ino <br><br> æˆ‘è¦å®Œæˆçš„ä¸‹ä¸€ä»¶äº‹æƒ…æ˜¯Sandeepmistry nRF5åº“æœ¬èº«ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä¸æ–°çš„MK nRF52840ï¼ŒnRF52811å’Œæ—§çš„MKä¸€èµ·ä½¿ç”¨ï¼Œä½†æ˜¯ç”±äºæŸäº›åŸå› ä¸å—æ¬¢è¿åœ°æ²¡æœ‰æ·»åŠ nRF52810ï¼ˆæ¯•ç«Ÿï¼Œæ¢¦1.4ä»¥æ±‚çš„1.4Î¼Aä¸é€‚åˆæ‚¨:)ï¼‰ã€‚ å½“ç„¶ï¼Œæ‚¨å¯ä»¥åœ¨Arduino IDEä¸­ä»¥åŠä»nRF52832ä¸‹ä½¿ç”¨nRF52840ï¼Œä½†æ˜¯â€¦â€¦æˆ‘æƒ³è®©å®ƒæ›´èˆ’é€‚ã€‚ ä¸Šé¢ï¼Œæˆ‘å†™é“ï¼Œæœ‰å…´è¶£åœ¨Nordic SDKä¸Šæ‰§è¡ŒæŸäº›æ“ä½œï¼Œå°¤å…¶æ˜¯åœ¨ä½¿ç”¨MK nRF5æ—¶ï¼ŒSegger Embedded Studioæ˜¯å…è´¹çš„ã€‚ ä»SDKå–å¾—äº†å¯¹æˆ‘æ„Ÿå…´è¶£çš„æ‰€æœ‰å¼€å‘æ¿çš„æ”¯æŒï¼Œå¹¶å°†å…¶è½¬ç§»åˆ°äº†Arduinoï¼ˆåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ²¡æœ‰è½¯ä»¶è®¾å¤‡ï¼Œè€Œmysensorsåˆ™æ²¡æœ‰å¿…è¦ï¼‰ã€‚ æ–°æ¿ä¹Ÿå·²æ·»åŠ åˆ°MySensorsåº“ä¸­ã€‚ <br><br><img src="https://habrastorage.org/webt/xc/hy/dy/xchydy8gbj0ld1tcvtyjiqbu70o.png"><br><br>  <a href="https://github.com/smartboxchannel/arduino-nRF5" rel="nofollow">github.com/smartboxchannel/arduino-nRF5</a> <br>  <a href="https://github.com/smartboxchannel/MySensors" rel="nofollow">github.com/smartboxchannel/MySensors</a> <br><br> å¦‚æœå…¶ä¸­ä¸€ä½è¯»è€…å·²ç»ç†Ÿæ‚‰æˆ‘çš„å‰å‡ ç¯‡æ–‡ç« ï¼Œé‚£ä¹ˆæ‚¨åƒæˆ‘ä»¥å‰é‚£æ ·åœ¨SLAä¸Šç”¨ä¸€ä¸ªå…‰ä¼ æ„Ÿå™¨å¤–å£³åˆ¶é€ ä¸€å°æ¶²ä½“èšåˆç‰©æ‰“å°æœºï¼Œæ‚¨å¯èƒ½ä¸ä¼šæ„Ÿåˆ°æƒŠè®¶ã€‚ ä½¿ç”¨æ­¤æŠ€æœ¯è¿›è¡Œæ‰“å°çš„ä¼˜ç‚¹æ˜¯ç²¾åº¦é«˜ã€‚ ä½†æ˜¯å½“ç„¶ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œå®¶ç”¨SLAæ‰“å°æœºå¯ä»¥ä½¿ç”¨çš„èšåˆç‰©çš„å¼ºåº¦ä»ç„¶ä¸å¦‚FDMå¡‘æ–™.3Dæ¨¡å‹çš„å¤–å£³ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œæ¯åŠéƒ¨åˆ†æ‰“å°40åˆ†é’Ÿï¼ˆå±‚åš50å¾®ç±³ï¼‰ã€‚ å°¤å…¶æ˜¯ï¼Œå¯èƒ½æ— éœ€æ­¢æ­¥äºæ­¤ï¼Œåªéœ€ä½¿ç”¨3Dç¼–è¾‘å™¨ä¸­çš„å‡ å¼ å¼€å‘è¿‡ç¨‹å›¾ç‰‡å³å¯ã€‚ <br><br><img src="https://habrastorage.org/webt/a0/x0/qt/a0x0qtl5jiglsmcidmbjibr_5wi.png"><br><br><img src="https://habrastorage.org/webt/by/cz/rk/byczrkmuesyuzijn5yyvv71uroa.png"><br><br><img src="https://habrastorage.org/webt/i4/ct/qc/i4ctqcrbeduw2p4an1a1jpkie9s.png"><br><br> ä¼ æ„Ÿå™¨ç¨‹åºåœ¨ä¸å‘é€æ¼”ç¤ºæ–‡ç¨¿çš„æƒ…å†µä¸‹å®ç°äº†è®¾å¤‡çš„é‡å¯ã€‚ å®ƒçš„å·¥ä½œåŸç†æ˜¯ï¼šåœ¨è®¾å¤‡æ˜¯æ–°è®¾å¤‡ä¸”æœªæ·»åŠ åˆ°æ‚¨çš„ç½‘ç»œä¸­æ—¶ï¼Œå½“è®¾å¤‡é¦–æ¬¡æ·»åŠ åˆ°ç½‘ç»œä¸­æ—¶ï¼Œå®ƒå°†æ³¨å†Œå¹¶å®Œæˆæ¼”ç¤ºï¼ŒæˆåŠŸæ³¨å†Œåï¼Œæ”¶åˆ°æ ‡è¯†ç¬¦çš„è®¾å¤‡å°†ä¸å†å†æ¬¡å‘é€æ¼”ç¤ºæ–‡ç¨¿ï¼Œä½†æ˜¯æ‚¨å¯ä»¥é€šè¿‡å•å‡»ä¼ æ„Ÿå™¨ä¸Šçš„æŒ‰é’®æ¥å‘é€æ¼”ç¤ºæ–‡ç¨¿ï¼ˆæ­¤æ“ä½œä¾‹å¦‚ï¼Œå¦‚æœä¸æ˜¯æ‰€æœ‰ä¼ æ„Ÿå™¨éƒ½å¯ä»¥ç«‹å³æˆåŠŸå±•ç¤ºï¼Œåˆ™å¯ä»¥ä½¿ç”¨ï¼‰ã€‚ æ­¤å¤–ï¼Œè¯¥ç¨‹åºè¿˜ç¦æ­¢æ ‡å‡†è‡ªåŠ¨æ¢å¤ç½‘ç»œæ´»åŠ¨ï¼ˆå¦‚æœä¼ æ„Ÿå™¨ä¸¢å¤±äº†ç½‘ç»œï¼‰ï¼Œå› æ­¤å‘æ˜äº†è‡ªå·±çš„éæ ‡å‡†é€‰é¡¹:)ã€‚ å®ƒçš„å·¥ä½œåŸç†æ˜¯ï¼šå¦‚æœä¼ æ„Ÿå™¨è¿ç»­æ£€æµ‹åˆ°å‘é€æ¶ˆæ¯çš„å°è¯•è¶…è¿‡5æ¬¡ï¼ˆè¿™æ˜¯å¯é…ç½®çš„ï¼‰ï¼Œè®¾å¤‡å°†åœæ­¢ä»ä¼ æ„Ÿå™¨å‘é€æ•°æ®ï¼Œå¹¶å¼€å§‹å‘é€ç½‘ç»œæœç´¢æ¶ˆæ¯ï¼Œå…¶é—´éš”æœ€åˆç­‰äºä»/ 2ä¸ªä¼ æ„Ÿå™¨å‘é€çš„é—´éš”ï¼Œå¹¶å®šæœŸå¢åŠ æ­¤é—´éš”cæ¯æ¬¡å‘é€ï¼Œä¸€æ¬¡å‘é€ä¸€ä¸ªå¥åº·çš„æ¢¦æƒ³ã€‚ æ‰€æœ‰è¿™äº›ä½¿æ‚¨å¯ä»¥å¤§å¤§èŠ‚çœç”µæ± ç”µé‡ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">æµ‹è¯•ç </b> <div class="spoiler_text"><pre> <code class="css hljs">// <span class="hljs-selector-tag"><span class="hljs-selector-tag">SDK</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">PORT</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">extern</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>" { #include "app_gpiote.h" #include "nrf_gpio.h" } <span class="hljs-selector-id"><span class="hljs-selector-id">#define</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">APP_GPIOTE_MAX_USERS</span></span> 1 <span class="hljs-selector-id"><span class="hljs-selector-id">#include</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">LIS2DW12Sensor</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.h</span></span>&gt; <span class="hljs-selector-id"><span class="hljs-selector-id">#include</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">MAX44009</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.h</span></span>&gt; //<span class="hljs-selector-id"><span class="hljs-selector-id">#define</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MY_DEBUG</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#define</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MY_RADIO_NRF5_ESB</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#define</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MY_DISABLED_SERIAL</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">int16_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mtwr</span></span>; <span class="hljs-selector-id"><span class="hljs-selector-id">#define</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MY_TRANSPORT_WAIT_READY_MS</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">mtwr</span></span>) <span class="hljs-selector-id"><span class="hljs-selector-id">#define</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MY_NRF5_ESB_PA_LEVEL</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">NRF5_PA_MAX</span></span>) <span class="hljs-selector-id"><span class="hljs-selector-id">#include</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">MySensors</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.h</span></span>&gt; <span class="hljs-selector-id"><span class="hljs-selector-id">#define</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SN</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">LUX</span></span> &amp; <span class="hljs-selector-tag"><span class="hljs-selector-tag">VIBRO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SENS</span></span>" <span class="hljs-selector-id"><span class="hljs-selector-id">#define</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SV</span></span> "1<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>" <span class="hljs-selector-id"><span class="hljs-selector-id">#define</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">V_SENS_CHILD_ID</span></span> 1 <span class="hljs-selector-id"><span class="hljs-selector-id">#define</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">LUX_SENS_CHILD_ID</span></span> 2 <span class="hljs-selector-id"><span class="hljs-selector-id">#define</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">WPM_SENS_CHILD_ID</span></span> 3 <span class="hljs-selector-id"><span class="hljs-selector-id">#define</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INTERVAL_R_LUX_CHILD_ID</span></span> 220 <span class="hljs-selector-id"><span class="hljs-selector-id">#define</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">LEVEL_SENSIV_V_SENS_CHILD_ID</span></span> 230 <span class="hljs-selector-id"><span class="hljs-selector-id">#define</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ENABLE_WPM_SENS_CHILD_ID</span></span> 240 <span class="hljs-selector-id"><span class="hljs-selector-id">#define</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SIGNAL_Q_ID</span></span> 253 <span class="hljs-selector-id"><span class="hljs-selector-id">#define</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">TEMP_CHILD_ID</span></span> 254 //<span class="hljs-selector-tag"><span class="hljs-selector-tag">for</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">any</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">tests</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#include</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">MySensors</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.h</span></span>&gt; <span class="hljs-selector-tag"><span class="hljs-selector-tag">MyMessage</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">vibroMsg</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">V_SENS_CHILD_ID</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">V_TRIPPED</span></span>); <span class="hljs-selector-tag"><span class="hljs-selector-tag">MyMessage</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">brightMsg</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">LUX_SENS_CHILD_ID</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">V_LEVEL</span></span>); <span class="hljs-selector-tag"><span class="hljs-selector-tag">MyMessage</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">wpmMsg</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">WPM_SENS_CHILD_ID</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">V_LEVEL</span></span>); <span class="hljs-selector-tag"><span class="hljs-selector-tag">MyMessage</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">conf_wpmMsg</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">ENABLE_WPM_SENS_CHILD_ID</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">V_VAR1</span></span>); <span class="hljs-selector-tag"><span class="hljs-selector-tag">MyMessage</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">conf_vsensMsg</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">LEVEL_SENSIV_V_SENS_CHILD_ID</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">V_VAR1</span></span>); <span class="hljs-selector-tag"><span class="hljs-selector-tag">MyMessage</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">conf_interv_rluxMsg</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">INTERVAL_R_LUX_CHILD_ID</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">V_VAR1</span></span>); <span class="hljs-selector-tag"><span class="hljs-selector-tag">MyMessage</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">tempMsg</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">TEMP_CHILD_ID</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">V_VAR1</span></span>); //<span class="hljs-selector-tag"><span class="hljs-selector-tag">for</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">any</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">tests</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bool</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nosleep</span></span> = 0; <span class="hljs-selector-tag"><span class="hljs-selector-tag">bool</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">button_flag</span></span> = 0; <span class="hljs-selector-tag"><span class="hljs-selector-tag">bool</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">configMode</span></span> = 0; <span class="hljs-selector-tag"><span class="hljs-selector-tag">bool</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">wpm_enable</span></span> = 0; <span class="hljs-selector-tag"><span class="hljs-selector-tag">bool</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">onoff</span></span> = 1; <span class="hljs-selector-tag"><span class="hljs-selector-tag">bool</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">flag_update_transport_param</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">bool</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">flag_sendRoute_parent</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">bool</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">flag_no_present</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">bool</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">flag_nogateway_mode</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">bool</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">flag_find_parent_process</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">bool</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">flag_fcount</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">bool</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Ack_TL</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">bool</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Ack_FP</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">bool</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">PRESENT_ACK</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">byte</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">conf_vibro_set</span></span> = 1; <span class="hljs-selector-tag"><span class="hljs-selector-tag">byte</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">interval_reading_lux</span></span> = 10; <span class="hljs-selector-tag"><span class="hljs-selector-tag">byte</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">err_delivery_beat</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">byte</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">problem_mode_count</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">uint8_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">countbatt</span></span> = 0; <span class="hljs-selector-tag"><span class="hljs-selector-tag">uint8_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">batt_cap</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">uint8_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">old_batt_cap</span></span> = 100; //<span class="hljs-selector-tag"><span class="hljs-selector-tag">unsigned</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">long</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BATT_TIME</span></span> = 43200000; //12 <span class="hljs-selector-tag"><span class="hljs-selector-tag">hours</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">uint32_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BATT_TIME</span></span> = 7200000; //12 <span class="hljs-selector-tag"><span class="hljs-selector-tag">hours</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">uint32_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SLEEP_TIME_TEMP</span></span> = 60000; //1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">minute</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">uint32_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SLEEP_TIME</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">uint32_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">C_BATT_TIME</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">uint32_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">oldmillis</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">uint32_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">newmillis</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">uint32_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">previousMillis</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">uint32_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">lightMillisR</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">uint32_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">configMillis</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">uint32_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">interrupt_time</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">uint32_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SLEEP_TIME_W</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">uint32_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">axel_time</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">int16_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">result</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">int16_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">brightness</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">int16_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">lastbrightness</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">int16_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">brightThreshold</span></span> = 25; <span class="hljs-selector-tag"><span class="hljs-selector-tag">int16_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">myid</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">int16_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mypar</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">int16_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">old_mypar</span></span> = <span class="hljs-selector-tag"><span class="hljs-selector-tag">-1</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">int16_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">master_id</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Wpm</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ODR_1Hz6_LP_ONLY</span></span> = 1<span class="hljs-selector-class"><span class="hljs-selector-class">.6f</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ODR_12Hz5</span></span> = 12<span class="hljs-selector-class"><span class="hljs-selector-class">.5f</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ODR_25Hz</span></span> = 25<span class="hljs-selector-class"><span class="hljs-selector-class">.0f</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ODR_50Hz</span></span> = 50<span class="hljs-selector-class"><span class="hljs-selector-class">.0f</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ODR_100Hz</span></span> = 100<span class="hljs-selector-class"><span class="hljs-selector-class">.0f</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ODR_200Hz</span></span> = 200<span class="hljs-selector-class"><span class="hljs-selector-class">.0f</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">bool</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">vibro</span></span> = 1; <span class="hljs-selector-tag"><span class="hljs-selector-tag">static</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">app_gpiote_user_id_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">m_gpiote_user_id</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">uint32_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">PIN_BUTTON1_MASK</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">uint32_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">AXEL_INT1_MASK</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">volatile</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">byte</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">axelInt1Status</span></span> = 0; <span class="hljs-selector-tag"><span class="hljs-selector-tag">volatile</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">byte</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">buttInt1Status</span></span> = 0; <span class="hljs-selector-tag"><span class="hljs-selector-tag">uint16_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">batteryVoltage</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">int16_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">linkQuality</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">int16_t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">old_linkQuality</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">LIS2DW12Sensor</span></span> *<span class="hljs-selector-tag"><span class="hljs-selector-tag">lis2</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">MAX44009</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">light</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">void</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">preHwInit</span></span>() { board_Init(); } <span class="hljs-selector-tag"><span class="hljs-selector-tag">void</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">before</span></span>() { blinky(1, 1, GREEN_LED); wait(1000); nRF_Init(); device_Conf(); happy_init(); } <span class="hljs-selector-tag"><span class="hljs-selector-tag">void</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">setup</span></span>() { interrupt_Init(); sensors_Init(); config_Happy_node(); } <span class="hljs-selector-tag"><span class="hljs-selector-tag">void</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">presentation</span></span>() { if (!sendSketchInfo(SN, SV)) { _transportSM.failedUplinkTransmissions = 0; sleep(1000); wait(50); if (!sendSketchInfo(SN, SV)) { _transportSM.failedUplinkTransmissions = 0; } } <span class="hljs-selector-tag"><span class="hljs-selector-tag">present</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">V_SENS_CHILD_ID</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">S_VIBRATION</span></span>, "<span class="hljs-selector-tag"><span class="hljs-selector-tag">STATUS</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">VIBRO</span></span>", 1); <span class="hljs-selector-tag"><span class="hljs-selector-tag">wait</span></span>(2500, <span class="hljs-selector-tag"><span class="hljs-selector-tag">C_PRESENTATION</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">S_VIBRATION</span></span>); <span class="hljs-selector-tag"><span class="hljs-selector-tag">CORE_DEBUG</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">PSTR</span></span>("<span class="hljs-selector-tag"><span class="hljs-selector-tag">MyS</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">TEST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">WAIT</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">AFTER</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">PRESENT</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SENSOR</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>")); <span class="hljs-selector-tag"><span class="hljs-selector-tag">if</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">PRESENT_ACK</span></span> == 0) { _transportSM.failedUplinkTransmissions = 0; sleep(1500); wait(50); present(V_SENS_CHILD_ID, S_VIBRATION, "STATUS VIBRO", 1); wait(2500, C_PRESENTATION, S_VIBRATION); CORE_DEBUG(PSTR("<span class="hljs-attribute"><span class="hljs-attribute">MyS</span></span>: TEST WAIT AFTER PRESENT SENSOR\n<span class="hljs-string"><span class="hljs-string">")); _transportSM.failedUplinkTransmissions = 0; } else { PRESENT_ACK = 0; } present(LUX_SENS_CHILD_ID, S_LIGHT_LEVEL, "</span></span>LUX<span class="hljs-string"><span class="hljs-string">", 1); wait(2500, C_PRESENTATION, S_LIGHT_LEVEL); CORE_DEBUG(PSTR("</span></span>MyS: TEST WAIT AFTER PRESENT SENSOR\n<span class="hljs-string"><span class="hljs-string">")); if (PRESENT_ACK == 0) { _transportSM.failedUplinkTransmissions = 0; sleep(1500); wait(50); present(LUX_SENS_CHILD_ID, S_LIGHT_LEVEL, "</span></span>LUX<span class="hljs-string"><span class="hljs-string">", 1); wait(2500, C_PRESENTATION, S_LIGHT_LEVEL); CORE_DEBUG(PSTR("</span></span>MyS: TEST WAIT AFTER PRESENT SENSOR\n<span class="hljs-string"><span class="hljs-string">")); _transportSM.failedUplinkTransmissions = 0; } else { PRESENT_ACK = 0; } present(WPM_SENS_CHILD_ID, S_LIGHT_LEVEL, "</span></span>W/M^<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-string"><span class="hljs-string">", 1); wait(2500, C_PRESENTATION, S_LIGHT_LEVEL); CORE_DEBUG(PSTR("</span></span>MyS: TEST WAIT AFTER PRESENT SENSOR\n<span class="hljs-string"><span class="hljs-string">")); if (PRESENT_ACK == 0) { _transportSM.failedUplinkTransmissions = 0; sleep(1500); wait(50); present(WPM_SENS_CHILD_ID, S_LIGHT_LEVEL, "</span></span>W/M^<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-string"><span class="hljs-string">", 1); wait(2500, C_PRESENTATION, S_LIGHT_LEVEL); CORE_DEBUG(PSTR("</span></span>MyS: TEST WAIT AFTER PRESENT SENSOR\n<span class="hljs-string"><span class="hljs-string">")); _transportSM.failedUplinkTransmissions = 0; } else { PRESENT_ACK = 0; } present(SIGNAL_Q_ID, S_CUSTOM, "</span></span>SIGNAL QUALITY<span class="hljs-string"><span class="hljs-string">", 1); wait(2500, C_PRESENTATION, S_CUSTOM); CORE_DEBUG(PSTR("</span></span>MyS: TEST WAIT AFTER PRESENT SENSOR\n<span class="hljs-string"><span class="hljs-string">")); if (PRESENT_ACK == 0) { _transportSM.failedUplinkTransmissions = 0; sleep(1500); wait(50); present(SIGNAL_Q_ID, S_CUSTOM, "</span></span>SIGNAL QUALITY<span class="hljs-string"><span class="hljs-string">", 1); wait(2500, C_PRESENTATION, S_CUSTOM); CORE_DEBUG(PSTR("</span></span>MyS: TEST WAIT AFTER PRESENT SENSOR\n<span class="hljs-string"><span class="hljs-string">")); _transportSM.failedUplinkTransmissions = 0; } else { PRESENT_ACK = 0; } present(ENABLE_WPM_SENS_CHILD_ID, S_CUSTOM, "</span></span>ON|OFF WPM<span class="hljs-string"><span class="hljs-string">", 1); wait(2500, C_PRESENTATION, S_CUSTOM); CORE_DEBUG(PSTR("</span></span>MyS: TEST WAIT AFTER PRESENT SENSOR\n<span class="hljs-string"><span class="hljs-string">")); if (PRESENT_ACK == 0) { _transportSM.failedUplinkTransmissions = 0; sleep(1500); wait(50); present(ENABLE_WPM_SENS_CHILD_ID, S_CUSTOM, "</span></span>ON|OFF WPM<span class="hljs-string"><span class="hljs-string">", 1); wait(2500, C_PRESENTATION, S_CUSTOM); CORE_DEBUG(PSTR("</span></span>MyS: TEST WAIT AFTER PRESENT SENSOR\n<span class="hljs-string"><span class="hljs-string">")); _transportSM.failedUplinkTransmissions = 0; } else { PRESENT_ACK = 0; } present(LEVEL_SENSIV_V_SENS_CHILD_ID, S_CUSTOM, "</span></span>SENS LEVEL VIBRO<span class="hljs-string"><span class="hljs-string">", 1); wait(2500, C_PRESENTATION, S_CUSTOM); CORE_DEBUG(PSTR("</span></span>MyS: TEST WAIT AFTER PRESENT SENSOR\n<span class="hljs-string"><span class="hljs-string">")); if (PRESENT_ACK == 0) { _transportSM.failedUplinkTransmissions = 0; sleep(1500); wait(50); present(LEVEL_SENSIV_V_SENS_CHILD_ID, S_CUSTOM, "</span></span>SENS LEVEL VIBRO<span class="hljs-string"><span class="hljs-string">", 1); wait(2500, C_PRESENTATION, S_CUSTOM); CORE_DEBUG(PSTR("</span></span>MyS: TEST WAIT AFTER PRESENT SENSOR\n<span class="hljs-string"><span class="hljs-string">")); _transportSM.failedUplinkTransmissions = 0; } else { PRESENT_ACK = 0; } present(INTERVAL_R_LUX_CHILD_ID, S_CUSTOM, "</span></span>INTERVAL RLUX|MIN<span class="hljs-string"><span class="hljs-string">", 1); wait(2500, C_PRESENTATION, S_CUSTOM); CORE_DEBUG(PSTR("</span></span>MyS: TEST WAIT AFTER PRESENT SENSOR\n<span class="hljs-string"><span class="hljs-string">")); if (PRESENT_ACK == 0) { _transportSM.failedUplinkTransmissions = 0; sleep(1500); wait(50); present(INTERVAL_R_LUX_CHILD_ID, S_CUSTOM, "</span></span>INTERVAL RLUX|MIN<span class="hljs-string"><span class="hljs-string">", 1); wait(2500, C_PRESENTATION, S_CUSTOM); CORE_DEBUG(PSTR("</span></span>MyS: TEST WAIT AFTER PRESENT SENSOR\n<span class="hljs-string"><span class="hljs-string">")); _transportSM.failedUplinkTransmissions = 0; } else { PRESENT_ACK = 0; } send(conf_wpmMsg.set(wpm_enable), 1); wait(2500, C_SET, V_VAR1); CORE_DEBUG(PSTR("</span></span>MyS: TEST WAIT AFTER SEND CONF SENSOR\n<span class="hljs-string"><span class="hljs-string">")); if (Ack_TL == 0) { _transportSM.failedUplinkTransmissions = 0; sleep(1500); wait(50); send(conf_wpmMsg.set(wpm_enable), 1); wait(2500, C_SET, V_VAR1); CORE_DEBUG(PSTR("</span></span>MyS: TEST WAIT AFTER SEND CONF SENSOR\n<span class="hljs-string"><span class="hljs-string">")); _transportSM.failedUplinkTransmissions = 0; } else { Ack_TL = 0; } send(conf_vsensMsg.set(conf_vibro_set), 1); wait(2500, C_SET, V_VAR1); CORE_DEBUG(PSTR("</span></span>MyS: TEST WAIT AFTER SEND CONF SENSOR\n<span class="hljs-string"><span class="hljs-string">")); if (Ack_TL == 0) { _transportSM.failedUplinkTransmissions = 0; sleep(1500); wait(50); send(conf_vsensMsg.set(conf_vibro_set), 1); wait(2500, C_SET, V_VAR1); CORE_DEBUG(PSTR("</span></span>MyS: TEST WAIT AFTER SEND CONF SENSOR\n<span class="hljs-string"><span class="hljs-string">")); _transportSM.failedUplinkTransmissions = 0; } else { Ack_TL = 0; } send(conf_interv_rluxMsg.set(interval_reading_lux), 1); wait(2500, C_SET, V_VAR1); CORE_DEBUG(PSTR("</span></span>MyS: TEST WAIT AFTER SEND CONF SENSOR\n<span class="hljs-string"><span class="hljs-string">")); if (Ack_TL == 0) { _transportSM.failedUplinkTransmissions = 0; sleep(1500); wait(50); send(conf_interv_rluxMsg.set(interval_reading_lux), 1); wait(2500, C_SET, V_VAR1); CORE_DEBUG(PSTR("</span></span>MyS: TEST WAIT AFTER SEND CONF SENSOR\n<span class="hljs-string"><span class="hljs-string">")); _transportSM.failedUplinkTransmissions = 0; } else { Ack_TL = 0; } } void loop() { if (flag_update_transport_param == 1) { update_Happy_transport(); } if (flag_sendRoute_parent == 1) { present_only_parent(); } if (isTransportReady() == true) { if (flag_nogateway_mode == 0) { if (flag_find_parent_process == 1) { find_parent_process(); } if (configMode == 0) { if ((axelInt1Status == AXEL_INT1) || (buttInt1Status == PIN_BUTTON1)) { if (axelInt1Status == AXEL_INT1) { nosleep = 1; send_Axel(); axelInt1Status = 0; newmillis = millis(); interrupt_time = newmillis - oldmillis; SLEEP_TIME_W = SLEEP_TIME_W - interrupt_time; if (SLEEP_TIME_W &lt; 5000) { SLEEP_TIME_W = SLEEP_TIME; send_Brigh(1); countbatt++; if (countbatt == C_BATT_TIME) { sendBatteryStatus(1); countbatt = 0; } } nosleep = 0; } if (buttInt1Status == PIN_BUTTON1) { if (digitalRead(PIN_BUTTON1) == 0 &amp;&amp; button_flag == 0) { button_flag = 1; nosleep = 1; previousMillis = millis(); ledsOff(); } if (digitalRead(PIN_BUTTON1) == 0 &amp;&amp; button_flag == 1) { if ((millis() - previousMillis &gt; 0) &amp;&amp; (millis() - previousMillis &lt;= 1750)) { if (millis() - lightMillisR &gt; 25) { lightMillisR = millis(); onoff = !onoff; digitalWrite(GREEN_LED, onoff); } } if ((millis() - previousMillis &gt; 1750) &amp;&amp; (millis() - previousMillis &lt;= 2000)) { ledsOff(); } if ((millis() - previousMillis &gt; 2000) &amp;&amp; (millis() - previousMillis &lt;= 4000)) { if (millis() - lightMillisR &gt; 25) { lightMillisR = millis(); onoff = !onoff; digitalWrite(BLUE_LED, onoff); } } if ((millis() - previousMillis &gt; 4000) &amp;&amp; (millis() - previousMillis &lt;= 4250)) { ledsOff(); } if ((millis() - previousMillis &gt; 4250) &amp;&amp; (millis() - previousMillis &lt;= 6250)) { if (millis() - lightMillisR &gt; 25) { lightMillisR = millis(); onoff = !onoff; digitalWrite(RED_LED, onoff); } } if ((millis() - previousMillis &gt; 6250) &amp;&amp; (millis() - previousMillis &lt;= 6500)) { ledsOff(); } if ((millis() - previousMillis &gt; 6500) &amp;&amp; (millis() - previousMillis &lt;= 8500)) { if (millis() - lightMillisR &gt; 50) { lightMillisR = millis(); onoff = !onoff; digitalWrite(RED_LED, onoff); } } if (millis() - previousMillis &gt; 8500) { ledsOff(); } } if (digitalRead(PIN_BUTTON1) == 1 &amp;&amp; button_flag == 1) { if (millis() - previousMillis &lt;= 2000) { ledsOff(); send_Brigh(0); nosleep = 0; button_flag = 0; buttInt1Status = 0; } if ((millis() - previousMillis &gt; 2000) &amp;&amp; (millis() - previousMillis &lt;= 4000)) { ledsOff(); configMode = 1; button_flag = 0; configMillis = millis(); } if ((millis() - previousMillis &gt; 4250) &amp;&amp; (millis() - previousMillis &lt;= 6250)) { ledsOff(); blinky(2, 2, RED_LED); button_flag = 0; buttInt1Status = 0; presentation(); nosleep = 0; } if ((millis() - previousMillis &gt; 6500) &amp;&amp; (millis() - previousMillis &lt;= 8500)) { ledsOff(); blinky(3, 3, RED_LED); new_device(); } if (((millis() - previousMillis &gt; 1750) &amp;&amp; (millis() - previousMillis &lt;= 2000)) || ((millis() - previousMillis &gt; 4000) &amp;&amp; (millis() - previousMillis &lt;= 4250)) || ((millis() - previousMillis &gt; 6250) &amp;&amp; (millis() - previousMillis &lt;= 6500)) || ((millis() - previousMillis &gt; 8500))) { ledsOff(); blinky(1, 2, GREEN_LED); nosleep = 0; button_flag = 0; buttInt1Status = 0; } } } } else { SLEEP_TIME_W = SLEEP_TIME; send_Brigh(1); countbatt++; if (countbatt == C_BATT_TIME) { sendBatteryStatus(1); countbatt = 0; } nosleep = 0; } } else { if (millis() - configMillis &gt; 30000) { blinky(3, 3, GREEN_LED); configMode = 0; nosleep = 0; button_flag = 0; buttInt1Status = 0; } } } else { if (buttInt1Status == PIN_BUTTON1) { if (digitalRead(PIN_BUTTON1) == 0 &amp;&amp; button_flag == 0) { button_flag = 1; nosleep = 1; previousMillis = millis(); ledsOff(); } if (digitalRead(PIN_BUTTON1) == 0 &amp;&amp; button_flag == 1) { if ((millis() - previousMillis &gt; 0) &amp;&amp; (millis() - previousMillis &lt;= 500)) { ledsOff(); } if ((millis() - previousMillis &gt; 500) &amp;&amp; (millis() - previousMillis &lt;= 2500)) { lightMillisR = millis(); onoff = !onoff; digitalWrite(BLUE_LED, onoff); } if ((millis() - previousMillis &gt; 2500) &amp;&amp; (millis() - previousMillis &lt;= 2750)) { ledsOff(); } if ((millis() - previousMillis &gt; 2750) &amp;&amp; (millis() - previousMillis &lt;= 4750)) { if (millis() - lightMillisR &gt; 50) { lightMillisR = millis(); onoff = !onoff; digitalWrite(RED_LED, onoff); } } if (millis() - previousMillis &gt; 4750) { ledsOff(); blinky(3, 1, GREEN_LED); button_flag = 0; nosleep = 0; buttInt1Status = 0; } } if (digitalRead(PIN_BUTTON1) == 1 &amp;&amp; button_flag == 1) { if (millis() - previousMillis &lt;= 500) { ledsOff(); button_flag = 0; nosleep = 0; buttInt1Status = 0; } if ((millis() - previousMillis &gt; 500) &amp;&amp; (millis() - previousMillis &lt;= 2500)) { ledsOff(); blinky(1, 1, BLUE_LED); check_parent(); button_flag = 0; nosleep = 0; buttInt1Status = 0; } if ((millis() - previousMillis &gt; 2500) &amp;&amp; (millis() - previousMillis &lt;= 2750)) { ledsOff(); button_flag = 0; nosleep = 0; buttInt1Status = 0; } if ((millis() - previousMillis &gt; 2750) &amp;&amp; (millis() - previousMillis &lt;= 4750)) { ledsOff(); blinky(3, 3, RED_LED); new_device(); } if (millis() - previousMillis &gt; 4750) { ledsOff(); button_flag = 0; nosleep = 0; buttInt1Status = 0; } } } else { check_parent(); } } } if (_transportSM.failureCounter &gt; 0) { _transportConfig.parentNodeId = loadState(101); _transportConfig.nodeId = myid; _transportConfig.distanceGW = loadState(103); mypar = _transportConfig.parentNodeId; nosleep = 0; flag_fcount = 1; err_delivery_beat = 5; happy_node_mode(); gateway_fail(); } if (configMode == 0) { if (nosleep == 0) { oldmillis = millis(); axelInt1Status = 0; buttInt1Status = 0; wait(100); sleep(SLEEP_TIME_W, false); wait(50); nosleep = 1; } } } float GetWpm() { float SunLuxCoef = 0.0079; float Wpm_temp = 0; Wpm_temp = (float)brightness; Wpm_temp *= SunLuxCoef; return Wpm_temp; } void blinky(uint8_t pulses, uint8_t repit, uint8_t ledColor) { for (int x = 0; x &lt; repit; x++) { if (x &gt; 0) { sleep(300); } for (int i = 0; i &lt; pulses; i++) { if (i &gt; 0) { sleep(80); } digitalWrite(ledColor, LOW); sleep(20); digitalWrite(ledColor, HIGH); } } } void ledsOff() { digitalWrite(RED_LED, HIGH); digitalWrite(GREEN_LED, HIGH); digitalWrite(BLUE_LED, HIGH); } void nRF_Init() { NRF_POWER-&gt;DCDCEN = 1; NRF_NFCT-&gt;TASKS_DISABLE = 1; NRF_NVMC-&gt;CONFIG = 1; NRF_UICR-&gt;NFCPINS = 0; NRF_NVMC-&gt;CONFIG = 0; NRF_SAADC -&gt;ENABLE = 0; NRF_PWM0 -&gt;ENABLE = 0; NRF_PWM1 -&gt;ENABLE = 0; NRF_PWM2 -&gt;ENABLE = 0; NRF_TWIM1 -&gt;ENABLE = 0; NRF_TWIS1 -&gt;ENABLE = 0; NRF_RADIO-&gt;TXPOWER = 8; } void sensors_Init() { Wire.begin(); wait(100); light.begin(); wait(100); lis2 = new LIS2DW12Sensor (&amp;Wire); vibro_Init(); if (isTransportReady() == true) { blinky(3, 1, BLUE_LED); wait(200); blinky(3, 1, GREEN_LED); wait(200); blinky(3, 1, RED_LED); SLEEP_TIME_W = SLEEP_TIME; send_Brigh(0); wait(50); sendBatteryStatus(0); axel_time = millis(); } else { blinky(5, 3, RED_LED); } } void vibro_Init() { if (conf_vibro_set == 1) { lis2-&gt;ODRTEMP = ODR_1Hz6_LP_ONLY; } if (conf_vibro_set == 2) { lis2-&gt;ODRTEMP = ODR_12Hz5; } if (conf_vibro_set == 3) { lis2-&gt;ODRTEMP = ODR_25Hz; } if (conf_vibro_set == 4) { lis2-&gt;ODRTEMP = ODR_100Hz; } if (conf_vibro_set == 5) { lis2-&gt;ODRTEMP = ODR_200Hz; } lis2-&gt;Enable_X(); wait(50); lis2-&gt;Enable_Wake_Up_Detection(); wait(50); } void board_Init() { pinMode(PIN_BUTTON1, INPUT); pinMode(AXEL_INT1, INPUT); pinMode(AXEL_INT2, INPUT); pinMode(AMBI_INT, INPUT); pinMode(RED_LED, OUTPUT); pinMode(GREEN_LED, OUTPUT); pinMode(BLUE_LED, OUTPUT); ledsOff(); } void send_Axel() { if (millis() - axel_time &gt;= 5000) { blinky(6, 1, RED_LED); lis2-&gt;Disable_Wake_Up_Detection(); wait(100); if (_transportConfig.parentNodeId == 0) { if (send(vibroMsg.set(vibro))) { wait(100); err_delivery_beat = 0; if (flag_nogateway_mode == 1) { flag_nogateway_mode = 0; CORE_DEBUG(PSTR("</span></span>MyS: NORMAL GATEWAY MODE\n<span class="hljs-string"><span class="hljs-string">")); err_delivery_beat = 0; } } else { _transportSM.failedUplinkTransmissions = 0; if (err_delivery_beat &lt; 5) { err_delivery_beat++; } if (err_delivery_beat == 4) { if (flag_nogateway_mode == 0) { gateway_fail(); CORE_DEBUG(PSTR("</span></span>MyS: LOST GATEWAY MODE\n<span class="hljs-string"><span class="hljs-string">")); } } } lis2-&gt;Enable_Wake_Up_Detection(); wait(100); axel_time = millis(); nosleep = 0; } if (_transportConfig.parentNodeId &gt; 0) { send(vibroMsg.set(vibro), 1); wait(2500, C_SET, V_TRIPPED); if (Ack_TL == 1) { Ack_TL = 0; err_delivery_beat = 0; //sleep_flag = 0; if (flag_nogateway_mode == 1) { flag_nogateway_mode = 0; CORE_DEBUG(PSTR("</span></span>MyS: NORMAL GATEWAY MODE\n<span class="hljs-string"><span class="hljs-string">")); err_delivery_beat = 0; } } else { _transportSM.failedUplinkTransmissions = 0; if (err_delivery_beat &lt; 5) { err_delivery_beat++; } if (err_delivery_beat == 4) { if (flag_nogateway_mode == 0) { gateway_fail(); CORE_DEBUG(PSTR("</span></span>MyS: LOST GATEWAY MODE\n<span class="hljs-string"><span class="hljs-string">")); } } } lis2-&gt;Enable_Wake_Up_Detection(); wait(100); axel_time = millis(); nosleep = 0; } } else { nosleep = 0; } } void send_Brigh(bool start) { brightness = light.get_lux() * 2; wait(50); if (start == 1) { if (abs(brightness - lastbrightness) &gt;= brightThreshold) { if (_transportConfig.parentNodeId == 0) { if (send(brightMsg.set(brightness, 0))) { err_delivery_beat = 0; if (flag_nogateway_mode == 1) { flag_nogateway_mode = 0; CORE_DEBUG(PSTR("</span></span>MyS: NORMAL GATEWAY MODE\n<span class="hljs-string"><span class="hljs-string">")); err_delivery_beat = 0; } lastbrightness = brightness; if (wpm_enable == 1) { Wpm = GetWpm(); wait(100); send(wpmMsg.set(Wpm, 0)); } wait(50); blinky(2, 2, BLUE_LED); } else { _transportSM.failedUplinkTransmissions = 0; if (err_delivery_beat &lt; 5) { err_delivery_beat++; } if (err_delivery_beat == 4) { if (flag_nogateway_mode == 0) { gateway_fail(); CORE_DEBUG(PSTR("</span></span>MyS: LOST GATEWAY MODE\n<span class="hljs-string"><span class="hljs-string">")); } } } } if (_transportConfig.parentNodeId &gt; 0) { send(brightMsg.set(brightness, 0), 1); wait(2500, C_SET, V_LEVEL); if (Ack_TL == 1) { Ack_TL = 0; err_delivery_beat = 0; if (flag_nogateway_mode == 1) { flag_nogateway_mode = 0; CORE_DEBUG(PSTR("</span></span>MyS: NORMAL GATEWAY MODE\n<span class="hljs-string"><span class="hljs-string">")); err_delivery_beat = 0; } lastbrightness = brightness; if (wpm_enable == 1) { Wpm = GetWpm(); wait(100); send(wpmMsg.set(Wpm, 0)); } wait(50); blinky(2, 2, BLUE_LED); } else { _transportSM.failedUplinkTransmissions = 0; if (err_delivery_beat &lt; 5) { err_delivery_beat++; } if (err_delivery_beat == 4) { if (flag_nogateway_mode == 0) { gateway_fail(); CORE_DEBUG(PSTR("</span></span>MyS: LOST GATEWAY MODE\n<span class="hljs-string"><span class="hljs-string">")); } } } } } } else { send(brightMsg.set(brightness, 0)); lastbrightness = brightness; if (wpm_enable == 1) { Wpm = GetWpm(); wait(100); send(wpmMsg.set(Wpm, 0)); } wait(50); blinky(2, 2, BLUE_LED); } } void interrupt_Init() { //*** //SET //NRF_GPIO_PIN_NOPULL //NRF_GPIO_PIN_PULLUP //NRF_GPIO_PIN_PULLDOWN //*** nrf_gpio_cfg_input(PIN_BUTTON1, NRF_GPIO_PIN_PULLUP); nrf_gpio_cfg_input(AXEL_INT1, NRF_GPIO_PIN_NOPULL); APP_GPIOTE_INIT(APP_GPIOTE_MAX_USERS); PIN_BUTTON1_MASK = 1 &lt;&lt; PIN_BUTTON1; AXEL_INT1_MASK = 1 &lt;&lt; AXEL_INT1; // app_gpiote_user_register(p_user_id, pins_low_to_high_mask, pins_high_to_low_mask, event_handler) app_gpiote_user_register(&amp;m_gpiote_user_id, AXEL_INT1_MASK, PIN_BUTTON1_MASK, gpiote_event_handler); app_gpiote_user_enable(m_gpiote_user_id); axelInt1Status = 0; buttInt1Status = 0; } void gpiote_event_handler(uint32_t event_pins_low_to_high, uint32_t event_pins_high_to_low) { MY_HW_RTC-&gt;CC[0] = (MY_HW_RTC-&gt;COUNTER + 2); if (PIN_BUTTON1_MASK &amp; event_pins_high_to_low) { if ((buttInt1Status == 0) &amp;&amp; (axelInt1Status == 0)) { buttInt1Status = PIN_BUTTON1; } } if (flag_nogateway_mode == 0) { if (configMode == 0) { if (AXEL_INT1_MASK &amp; event_pins_low_to_high) { if ((axelInt1Status == 0) &amp;&amp; (buttInt1Status == 0)) { axelInt1Status = AXEL_INT1; } } } } /*** if ((PIN_BUTTON_MASK &amp; event_pins_low_to_high) || (PIN_BUTTON1_MASK &amp; event_pins_high_to_low)) ***/ } void device_Conf() { conf_vibro_set = loadState(230); if ((conf_vibro_set &gt; 5) || (conf_vibro_set == 0)) { conf_vibro_set = 1; saveState(230, conf_vibro_set); } wpm_enable = loadState(240); if (wpm_enable &gt; 1) { wpm_enable = 0; saveState(240, wpm_enable); } interval_reading_lux = loadState(220); if (interval_reading_lux &gt; 60) { interval_reading_lux = 60; saveState(230, interval_reading_lux); } else if (interval_reading_lux &lt; 1) { interval_reading_lux = 1; saveState(230, interval_reading_lux); } SLEEP_TIME = SLEEP_TIME_TEMP * interval_reading_lux; C_BATT_TIME = BATT_TIME / SLEEP_TIME; } void sendBatteryStatus(bool start) { sleep(5000); wait(200); batteryVoltage = hwCPUVoltage(); wait(10); batt_cap = battery_level_in_percent(batteryVoltage); if (start == 1) { if (batt_cap &lt; old_batt_cap) { sendBatteryLevel(battery_level_in_percent(batteryVoltage), 1); wait(2500, C_INTERNAL, I_BATTERY_LEVEL); old_batt_cap = batt_cap; } } else { sendBatteryLevel(battery_level_in_percent(batteryVoltage), 1); wait(2500, C_INTERNAL, I_BATTERY_LEVEL); } linkQuality = calculationRxQuality(); if (linkQuality != old_linkQuality) { wait(10); sendSignalStrength(linkQuality); wait(50); old_linkQuality = linkQuality; } } bool sendSignalStrength(const int16_t level, const bool ack) { return _sendRoute(build(_msgTmp, GATEWAY_ADDRESS, SIGNAL_Q_ID, C_SET, V_VAR1, ack).set(level)); } int16_t calculationRxQuality() { int16_t nRFRSSI_temp = transportGetReceivingRSSI(); int16_t nRFRSSI = map(nRFRSSI_temp, -85, -40, 0, 100); if (nRFRSSI &lt; 0) { nRFRSSI = 0; } if (nRFRSSI &gt; 100) { nRFRSSI = 100; } return nRFRSSI; } void happy_init() { //hwWriteConfig(EEPROM_NODE_ID_ADDRESS, 255); // ******************** checking the node config reset ************************* if (hwReadConfig(EEPROM_NODE_ID_ADDRESS) == 0) { hwWriteConfig(EEPROM_NODE_ID_ADDRESS, 255); } if (loadState(100) == 0) { saveState(100, 255); } CORE_DEBUG(PSTR("</span></span>EEPROM NODE ID: %d\n<span class="hljs-string"><span class="hljs-string">"), hwReadConfig(EEPROM_NODE_ID_ADDRESS)); CORE_DEBUG(PSTR("</span></span>USER MEMORY SECTOR NODE ID: %d\n<span class="hljs-string"><span class="hljs-string">"), loadState(100)); if (hwReadConfig(EEPROM_NODE_ID_ADDRESS) == 255) { mtwr = 0; } else { mtwr = 10000; no_present(); } CORE_DEBUG(PSTR("</span></span>MY_TRANSPORT_WAIT_MS: %d\n<span class="hljs-string"><span class="hljs-string">"), mtwr); } void new_device() { hwWriteConfig(EEPROM_NODE_ID_ADDRESS, 255); saveState(100, 255); wdt_enable(WDTO_15MS); } void config_Happy_node() { if (mtwr == 0) { myid = getNodeId(); saveState(100, myid); mypar = _transportConfig.parentNodeId; old_mypar = mypar; master_id = 0; // *************************** master slave mode is not initialized in this example, ..stub ******************************* saveState(101, mypar); saveState(102, _transportConfig.distanceGW); } if (mtwr != 0) { myid = getNodeId(); if (myid != loadState(100)) { saveState(100, myid); } if (isTransportReady() == true) { mypar = _transportConfig.parentNodeId; master_id = 0; // *************************** master slave mode is not initialized in this example, ..stub ******************************* if (mypar != loadState(101)) { saveState(101, mypar); } if (_transportConfig.distanceGW != loadState(102)) { saveState(102, _transportConfig.distanceGW); } present_only_parent(); } if (isTransportReady() == false) { no_present(); flag_fcount = 1; err_delivery_beat = 5; _transportConfig.nodeId = myid; _transportConfig.parentNodeId = loadState(101); _transportConfig.distanceGW = loadState(102); mypar = _transportConfig.parentNodeId; happy_node_mode(); gateway_fail(); } } } void no_present() { _coreConfig.presentationSent = true; _coreConfig.nodeRegistered = true; } void happy_node_mode() { _transportSM.findingParentNode = false; _transportSM.transportActive = true; _transportSM.uplinkOk = true; _transportSM.pingActive = false; transportSwitchSM(stReady); _transportSM.failureCounter = 0; } void gateway_fail() { flag_nogateway_mode = 1; flag_update_transport_param = 0; SLEEP_TIME_W = SLEEP_TIME / 2; lis2-&gt;Disable_Wake_Up_Detection(); } void find_parent_process() { flag_update_transport_param = 1; flag_find_parent_process = 0; CORE_DEBUG(PSTR("</span></span>MyS: STANDART TRANSPORT MODE IS RESTORED\n<span class="hljs-string"><span class="hljs-string">")); err_delivery_beat = 0; lis2-&gt;Enable_Wake_Up_Detection(); } void update_Happy_transport() { CORE_DEBUG(PSTR("</span></span>MyS: UPDATE TRANSPORT CONFIGURATION\n<span class="hljs-string"><span class="hljs-string">")); mypar = _transportConfig.parentNodeId; master_id = 0; // *************************** master slave mode is not initialized in this example, ..stub ******************************* if (mypar != loadState(101)) { saveState(101, mypar); } if (_transportConfig.distanceGW != loadState(102)) { saveState(102, _transportConfig.distanceGW); } present_only_parent(); wait(50); nosleep = 0; flag_update_transport_param = 0; } void present_only_parent() { if (old_mypar != mypar) { CORE_DEBUG(PSTR("</span></span>MyS: SEND LITTLE PRESENT:) WITH PARENT ID\n<span class="hljs-string"><span class="hljs-string">")); if (_sendRoute(build(_msgTmp, 0, NODE_SENSOR_ID, C_INTERNAL, 6).set(mypar))) { flag_sendRoute_parent = 0; old_mypar = mypar; } else { flag_sendRoute_parent = 1; } } } void check_parent() { _transportSM.findingParentNode = true; CORE_DEBUG(PSTR("</span></span>MyS: SEND FIND PARENT REQUEST, WAIT RESPONSE\n<span class="hljs-string"><span class="hljs-string">")); _sendRoute(build(_msg, 255, NODE_SENSOR_ID, C_INTERNAL, 7).set("</span></span><span class="hljs-string"><span class="hljs-string">")); wait(1500, C_INTERNAL, 8); if (_msg.sensor == 255) { if (mGetCommand(_msg) == 3) { if (_msg.type == 8) { Ack_FP = 1; CORE_DEBUG(PSTR("</span></span>MyS: PARENT RESPONSE FOUND\n<span class="hljs-string"><span class="hljs-string">")); } } } if (Ack_FP == 1) { CORE_DEBUG(PSTR("</span></span>MyS: FIND PARENT PROCESS\n<span class="hljs-string"><span class="hljs-string">")); Ack_FP = 0; transportSwitchSM(stParent); flag_nogateway_mode = 0; flag_find_parent_process = 1; SLEEP_TIME_W = SLEEP_TIME; problem_mode_count = 0; } else { _transportSM.findingParentNode = false; CORE_DEBUG(PSTR("</span></span>MyS: PARENT RESPONSE NOT FOUND\n<span class="hljs-string"><span class="hljs-string">")); _transportSM.failedUplinkTransmissions = 0; nosleep = 0; if (problem_mode_count &lt; 24) { CORE_DEBUG(PSTR("</span></span>PROBLEM MODE COUNTER: %d\n<span class="hljs-string"><span class="hljs-string">"), problem_mode_count); problem_mode_count++; SLEEP_TIME_W = SLEEP_TIME / 100 * 120; } else if (problem_mode_count == 24) { SLEEP_TIME_W = SLEEP_TIME * 30; CORE_DEBUG(PSTR("</span></span>PROBLEM MODE COUNTER: %d\n<span class="hljs-string"><span class="hljs-string">"), problem_mode_count); } } } void receive(const MyMessage &amp; message) { if (message.sensor == ENABLE_WPM_SENS_CHILD_ID) { if (message.type == V_VAR1) { if (mGetCommand(message) == C_SET) { if (message.isEcho()) { Ack_TL = 1; } else { wpm_enable = message.getBool(); saveState(240, wpm_enable); wait(10); send(conf_wpmMsg.set(wpm_enable)); wait(50); blinky(3, 3, GREEN_LED); configMode = 0; nosleep = 0; button_flag = 0; buttInt1Status = 0; } } } } if (message.sensor == LEVEL_SENSIV_V_SENS_CHILD_ID) { if (message.type == V_VAR1) { if (mGetCommand(message) == C_SET) { if (message.isEcho()) { Ack_TL = 1; } else { conf_vibro_set = message.getByte(); vibro_Init(); saveState(230, conf_vibro_set); wait(10); send(conf_vsensMsg.set(conf_vibro_set)); wait(50); blinky(3, 3, GREEN_LED); configMode = 0; nosleep = 0; button_flag = 0; buttInt1Status = 0; } } } } if (message.sensor == INTERVAL_R_LUX_CHILD_ID) { if (message.type == V_VAR1) { if (mGetCommand(message) == C_SET) { if (message.isEcho()) { Ack_TL = 1; } else { interval_reading_lux = message.getByte(); SLEEP_TIME = SLEEP_TIME_TEMP * interval_reading_lux; C_BATT_TIME = BATT_TIME / SLEEP_TIME; saveState(220, interval_reading_lux); wait(10); send(conf_interv_rluxMsg.set(interval_reading_lux)); wait(50); blinky(3, 3, GREEN_LED); configMode = 0; nosleep = 0; button_flag = 0; buttInt1Status = 0; } } } } if (message.sensor == LUX_SENS_CHILD_ID) { if (message.type == V_LEVEL) { if (mGetCommand(message) == C_SET) { if (message.isEcho()) { Ack_TL = 1; } } } } if (message.sensor == V_SENS_CHILD_ID) { if (message.type == V_TRIPPED) { if (mGetCommand(message) == C_SET) { if (message.isEcho()) { Ack_TL = 1; } } } } if (mGetCommand(message) == 0) { PRESENT_ACK = 1; CORE_DEBUG(PSTR("</span></span>MyS: !!!ACK OF THE PRESENTATION IN THE FUNCTION RECEIVE RECEIVED!!!\n<span class="hljs-string"><span class="hljs-string">")); } }</span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">githubé¡¹ç›®ï¼ˆå…¶ä»–åº“ï¼Œé¡¹ç›®æºï¼Œæ–¹æ¡ˆï¼Œéæ´²èŠï¼ŒBOMï¼‰ï¼š</font></font><br> <a href="https://github.com/smartboxchannel/EFEKTA-LIS2DW12-MAX44009-E73C" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/smartboxchannel/EFEKTA-LIS2DW12-MAX44009-E73C </font></font></a> <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¼ æ„Ÿå™¨ç‰¹æ€§ï¼š</font></font></b> <br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å·¥ä½œç”µå‹èŒƒå›´2-3 Vï¼Œ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åœ¨ç¡çœ æ¨¡å¼ä¸‹ä¸º6.7Î¼Aï¼Œ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åœ¨ç½‘ç»œæ¨¡å¼ä¸‹ä¸º8mAï¼Œ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E73-2Gâ€‹â€‹4M08S1C nRF52840ï¼Œ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MAX44009ç¯å¢ƒå…‰ä¼ æ„Ÿå™¨ï¼Œ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> LIS2DW12 \ LIS2DH12 3è½´MEMSåŠ é€Ÿåº¦è®¡ï¼Œ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RGB LED </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç”¨æˆ·bottonï¼Œ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¼–ç¨‹ç«¯å£SWD +ä¸²è¡Œã€‚ </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä»¥ä¸‹æ˜¯Majordomo UDç³»ç»Ÿä¸­ä¼ æ„Ÿå™¨æ“ä½œçš„ç¤ºä¾‹ï¼Œå®ƒè‡ªç„¶å¯ä»¥åœ¨æ·»åŠ äº†MySensorsåè®®æ”¯æŒçš„ä»»ä½•UDä¸­å·¥ä½œï¼Œå¹¶ä¸”è¿™å‡ ä¹æ˜¯ä¼—æ‰€å‘¨çŸ¥çš„ã€‚ </font></font><br><br><img src="https://habrastorage.org/webt/bm/xj/zj/bmxjzjfpzn0wuvccte-w5xqtn3e.png"><br><br><img src="https://habrastorage.org/webt/5t/9k/xr/5t9kxrdt4agswilm1yukte51m4g.jpeg"><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸¦ç”µè·¯æ¿å†…éƒ¨çš„è§†é¢‘ï¼Œä¼ æ„Ÿå™¨ç¤ºä¾‹ï¼Œè®¾ç½®ç¤ºä¾‹</font></font></b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/I2ywIxp-RsE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¼ æ„Ÿå™¨ç…§ç‰‡</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/wc/xl/hk/wcxlhkb-zb-paorsmpqx4jwkg-4.jpeg"><br><br><img src="https://habrastorage.org/webt/mh/f-/ak/mhf-akawv5xgbnuijpdv0edgcoo.jpeg"><br><br><img src="https://habrastorage.org/webt/ie/1q/ig/ie1qign_51mb0ya5ysfiurmdgkm.jpeg"><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å¯èƒ½ä¼šå¯¹æ­¤è¿›è¡Œå››èˆäº”å…¥ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€ä¸ªæ‚¨æ€»æ˜¯ä¹äºå¸®åŠ©æƒ³è¦äº†è§£MYSENSORSçš„äººçš„åœ°æ–¹ï¼ˆå®‰è£…æ¿ï¼Œåœ¨Arduino IDEç¯å¢ƒä¸­ä½¿ç”¨nRF5å¾®æ§åˆ¶å™¨ï¼Œä½¿ç”¨mysensorsåè®®çš„æŠ€å·§ï¼Œè®¨è®ºé¡¹ç›®-ç”µæŠ¥èŠå¤©</font></font><a href="https://tgclick.com/mysensors_rus" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@mysensors_rus</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ‚¨çš„é¡¹ç›®ä¸­ç¥æ‚¨å¥½è¿ï¼</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS / Shareæœ‰äº†å³æ—¶è®¡åˆ’ï¼Œå¾ˆå¿«å°±ä¼šæœ‰ä¸€ç¯‡æ–‡ç« </font><font style="vertical-align: inherit;">ç”¨ç”µå­å¢¨æ°´å±</font></font><a href="https://habr.com/ru/post/452532/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘çš„æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨</font><font style="vertical-align: inherit;">çš„æ›´æ–°</font><a href="https://habr.com/ru/post/452532/"><font style="vertical-align: inherit;">è‰æ¡ˆä¸Š</font></a><font style="vertical-align: inherit;">å‘è¡¨</font><font style="vertical-align: inherit;">ï¼Œæœ€åç°åœ¨æ˜¯ä¸€ä¸ªå®Œæˆçš„è®¾å¤‡ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œè¿˜å°†æœ‰ä¸€ç¯‡å…³äºå¸¦ç°§ç‰‡å¼€å…³ï¼ŒåŠ é€Ÿåº¦è®¡å’Œä¼ æ„Ÿå™¨çš„å¼€/å…³ä¼ æ„Ÿå™¨çš„æ–‡ç« ã€‚</font><font style="vertical-align: inherit;">ç£åœºå’Œç¼–ç å™¨ä¸Šçš„nRF52811ã€‚ä¸‹é¢çš„ç…§ç‰‡å’Œè§†é¢‘åœ¨æ‰°æµæ¿ä¸­ã€‚</font></font><br><br><div class="spoiler">  <b class="spoiler_title">æ‰°æµæ¿</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/T66y83lF-xg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><img src="https://habrastorage.org/webt/rg/dh/u2/rgdhu2htxcazyavpoh5mgf71hfo.jpeg"><br><br><img src="https://habrastorage.org/webt/uz/mx/_n/uzmx_nvuyazh3nihtfjxgb_tkpi.jpeg"><br><br><img src="https://habrastorage.org/webt/xn/7s/a2/xn7sa2lbrn3g2jvje5mr1wbcuh8.jpeg"><br><br><img src="https://habrastorage.org/webt/4y/-s/la/4y-slajjmwr_ydmqdq0v2vcify4.jpeg"><br><br><img src="https://habrastorage.org/webt/90/ub/i7/90ubi72wfku6mlf7dshkfl2nqfo.jpeg"><br><br><img src="https://habrastorage.org/webt/p9/fe/9e/p9fe9ehr29jqggmkhutdipmqygu.jpeg"><br><br><img src="https://habrastorage.org/webt/sn/gm/ou/sngmou0381zr6ias3gbtsfez3lg.jpeg"><br><br><img src="https://habrastorage.org/webt/o5/t2/j-/o5t2j-gncldts6gsxg7kxl26dce.jpeg"><br><br><img src="https://habrastorage.org/webt/jt/vl/ro/jtvlrov-l3qclnkgilhu7aqpls4.jpeg"><br><br><img src="https://habrastorage.org/webt/be/3v/je/be3vjejo_xhuxhpc_hyg9fmz4ns.jpeg"><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN478960/">https://habr.com/ru/post/zh-CN478960/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN478950/index.html">æœ¬å‘¨ç»“æœï¼šåä¸ºé€‚åº”åˆ¶è£ï¼Œæ™®äº¬ç­¾ç½²è€¸äººå¬é—»çš„æ³•å¾‹ï¼Œåœ¨ä¿„ç½—æ–¯ï¼Œä»–ä»¬å°é”äº†ShutterStock</a></li>
<li><a href="../zh-CN478952/index.html">Onyx Boox Note Proä¸€ä¸ªæœˆ</a></li>
<li><a href="../zh-CN478954/index.html">REï¼šå¯¹ITçš„ææƒ§å’ŒåŒæ¶</a></li>
<li><a href="../zh-CN478956/index.html">é€šè¿‡Chrome VoIPå®¢æˆ·ç«¯å’Œé€‚ç”¨äºAndroidçš„è§†é¢‘åº”ç”¨ç¨‹åºå¼•å…¥3CX V16 Update 4 Beta</a></li>
<li><a href="../zh-CN478958/index.html">é€‚ç”¨äºä»»ä½•è§„æ¨¡ä¼ä¸šçš„å®Œæ•´Windows 10å‡çº§æŒ‡å—</a></li>
<li><a href="../zh-CN478962/index.html">Ilya Yakyamsevï¼šæ•ˆç‡ä¸èµ·ä½œç”¨</a></li>
<li><a href="../zh-CN478968/index.html">SpaceXå‘å°„çº³ç±³æœºæ¶åˆ›å»ºç©ºé—´ç¢ç‰‡è½¨é“ç«™</a></li>
<li><a href="../zh-CN478970/index.html">DIYå‘¼å«æŒ‰é’®ç¬¬2éƒ¨åˆ†ã€‚RaspberryPiçš„å¯è§†ç”µè¯</a></li>
<li><a href="../zh-CN478972/index.html">Miroå¹³å°ç«èµ›çš„è·èƒœè€…</a></li>
<li><a href="../zh-CN478974/index.html">ä½¿ç”¨åŠ¨æ€å¯¼å…¥è‡ªåŠ¨åŠ è½½æ¨¡å—</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>