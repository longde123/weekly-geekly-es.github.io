<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚è≥ ‚õàÔ∏è ü§π Hacer un prototipo de bot para batallas en Clash Royale ü•¶ ü§öüèº üëçüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬øTe sucedi√≥ que te aferras a alg√∫n tipo de juego simple, pensando que la inteligencia artificial podr√≠a hacer frente a √©l? Sol√≠a ‚Äã‚Äãhacerlo, y decid√≠ t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hacer un prototipo de bot para batallas en Clash Royale</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/binarydistrict/blog/439352/">  ¬øTe sucedi√≥ que te aferras a alg√∫n tipo de juego simple, pensando que la inteligencia artificial podr√≠a hacer frente a √©l?  Sol√≠a ‚Äã‚Äãhacerlo, y decid√≠ tratar de crear un reproductor bot de este tipo.  Adem√°s, ahora hay muchas herramientas para la visi√≥n por computadora y el aprendizaje autom√°tico que le permiten construir modelos sin una comprensi√≥n profunda de los detalles de implementaci√≥n.  Los mortales ordinarios pueden hacer un prototipo sin construir redes neuronales durante meses desde cero. <br><br><img src="https://habrastorage.org/webt/fs/7g/yb/fs7gyb9v-o6bessxnliwetns8u0.png"><br><br>  Debajo del corte, encontrar√° el proceso de creaci√≥n de un bot de prueba de concepto para el juego Clash Royale, en el que utilic√© las bibliotecas Scala, Python y CV.  Utilizando la visi√≥n por computadora y el aprendizaje autom√°tico, intent√© crear un bot para un juego que interact√∫a como un jugador en vivo. <br><a name="habracut"></a><br>  Mi nombre es Sergey Tolmachev, soy desarrollador principal de Scala en la plataforma Waves y ense√±o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un curso de Scala</a> en el distrito binario, y en mi tiempo libre estudio otras tecnolog√≠as, como la IA.  Y quer√≠a reforzar las habilidades adquiridas con algo de experiencia pr√°ctica.  A diferencia de las competiciones de IA, donde tu bot juega contra los bots de otros usuarios, Clash Royale puede jugar contra personas, lo que suena divertido.  ¬°Tu bot puede aprender a vencer a jugadores reales! <br><br><h2>  Mec√°nica del juego en Clash Royale </h2><br>  La mec√°nica del juego es bastante simple.  T√∫ y tu oponente tienen tres edificios: una fortaleza y dos torres.  Los jugadores antes del juego recogen mazos: 8 unidades disponibles, que luego se usan en la batalla.  Tienen diferentes niveles, y se pueden bombear, recolectando m√°s tarjetas de estas unidades y comprando actualizaciones. <br>  Despu√©s del comienzo del juego, puedes colocar las unidades disponibles a una distancia segura de las torres enemigas, mientras gastas unidades de man√°, que se restauran lentamente durante el juego.  Las unidades se env√≠an a los edificios enemigos y son distra√≠das por los enemigos que se encuentran en el camino.  El jugador solo puede controlar la posici√≥n inicial de las unidades; solo puede afectar su movimiento y da√±o adicionales configurando otras unidades. <br><br>  Todav√≠a hay hechizos que se pueden jugar en cualquier parte del campo, generalmente causan da√±o a las unidades de diferentes maneras.  Los hechizos pueden clonar, congelar o acelerar unidades en un √°rea. <br><br><img src="https://habrastorage.org/webt/bk/xs/s2/bkxss2pfmjmvheqvnex86yy2wdk.png"><br><br>  El objetivo del juego es destruir edificios enemigos.  Para una victoria completa, debes destruir la fortaleza o despu√©s de dos minutos del juego destruir m√°s edificios (las reglas dependen de los modos de juego, pero en general suenan as√≠). <br><br>  Durante el juego, debes tener en cuenta el movimiento de las unidades, el n√∫mero posible de man√° y las cartas enemigas actuales.  Tambi√©n debe considerar c√≥mo la instalaci√≥n de la unidad afecta el campo de juego. <br><br><h2>  Construyendo una soluci√≥n </h2><br>  Clash Royale es un juego m√≥vil, as√≠ que decid√≠ ejecutarlo en Android e interactuar con √©l a trav√©s de ADB.  Esto apoyar√≠a el trabajo con el simulador o con un dispositivo real. <br><br>  Decid√≠ que el bot, como muchas otras IA de juegos, deber√≠a funcionar en el algoritmo de Percepci√≥n-An√°lisis-Acci√≥n.  Todo el entorno del juego se muestra en la pantalla, y la interacci√≥n con √©l se produce al hacer clic en la pantalla.  Por lo tanto, el bot debe ser un programa cuya entrada describa el estado actual del juego: la ubicaci√≥n y caracter√≠sticas de las unidades y edificios, las posibles cartas actuales y la cantidad de man√°.  En la salida, el bot debe dar una matriz de coordenadas donde la unidad debe ser grabada. <br><br>  Pero antes de crear el bot en s√≠, era necesario resolver el problema de extraer informaci√≥n sobre el estado actual del juego de la captura de pantalla.  En general, el contenido adicional del art√≠culo est√° dedicado a esta tarea. <br><br>  Para resolver este problema, decid√≠ usar Computer Vision.  Quiz√°s esta no sea la mejor soluci√≥n: un CV sin mucha experiencia y recursos claramente tiene limitaciones y no puede reconocer todo a nivel humano. <br><br>  Ser√≠a m√°s preciso tomar datos de la memoria, pero no ten√≠a esa experiencia.  Se requiere root y, en general, esta soluci√≥n parece m√°s complicada.  Tampoco est√° claro si la velocidad en tiempo real se puede lograr aqu√≠ si busca objetos con una JVM de mont√≥n dentro del dispositivo.  Adem√°s, quer√≠a resolver el problema de CV m√°s que esto. <br>  En teor√≠a, uno podr√≠a hacer un servidor proxy y tomar informaci√≥n de all√≠.  Pero el protocolo de red del juego a menudo cambia, aparecen proxies en Internet, pero r√°pidamente se vuelven obsoletos y no son compatibles. <br><br><h2>  Recursos de juego disponibles </h2><br>  Para empezar, decid√≠ familiarizarme con los materiales disponibles del juego.  Encontr√© un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">club de artesanos</a> sacando recursos de juego repletos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">[1]</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">[2]</a> .  En primer lugar, me interesaban las im√°genes de unidades, pero en el paquete de juego desempaquetado se presentan en forma de un mapa en mosaico (partes de las cuales consta una unidad). <br><br>  Tambi√©n encontr√© guiones pegados (aunque no perfectos) de cuadros de animaci√≥n de unidad: fueron √∫tiles para entrenar el modelo de reconocimiento. <br><br><img src="https://habrastorage.org/webt/b_/bp/zm/b_bpzm14pv9snavxmruq0k5q0cm.png"><br><br>  Adem√°s, en los recursos puedes encontrar csv con varios datos del juego: la cantidad de HP, el da√±o a unidades de diferentes niveles, etc. Esto es √∫til al crear l√≥gica de bot.  Por ejemplo, a partir de los datos qued√≥ claro que el campo se dividi√≥ en 18 x 29 celdas, y las unidades solo se pueden colocar en ellas.  Tambi√©n hab√≠a todas las im√°genes de mapas de unidades, que nos ser√°n √∫tiles m√°s adelante. <br><br><h2>  Visi√≥n por computadora para los perezosos </h2><br>  Despu√©s de buscar soluciones CV disponibles, qued√≥ claro que, en cualquier caso, tendr√≠an que ser capacitados en un conjunto de datos etiquetado.  Tom√© capturas de pantalla y ya estaba listo para marcar un cierto n√∫mero de capturas de pantalla con mis manos.  Esto result√≥ ser un desaf√≠o. <br><br>  Encontrar programas de reconocimiento disponibles tom√≥ algo de tiempo.  Me <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">decid√≠</a> por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">labelImg</a> .  Todas las aplicaciones de anotaci√≥n que encontr√© eran bastante primitivas: muchas no admit√≠an atajos de teclado, la selecci√≥n de objetos y sus tipos se hizo mucho menos conveniente que en labelImg. <br><br>  Durante el marcado, result√≥ √∫til tener el c√≥digo fuente de la aplicaci√≥n.  Tom√© capturas de pantalla cada dos segundos del partido.  Hay muchos objetos en las capturas de pantalla (por ejemplo, un ej√©rcito de esqueletos), e hice una modificaci√≥n en labelImg: de forma predeterminada, al marcar la siguiente imagen, se tomaron las etiquetas de la anterior.  A menudo, simplemente ten√≠an que ser movidos a una nueva posici√≥n de las unidades, eliminar las unidades muertas y agregar algunas aparecidas, y no marcar desde cero. <br><br><img src="https://habrastorage.org/webt/cx/dh/rf/cxdhrf-uctqed-l84x2mg_9j4u8.png"><br><br>  El proceso result√≥ ser intensivo en recursos: en dos d√≠as en modo silencioso, publiqu√© unas 200 capturas de pantalla.  La muestra parece muy peque√±a, pero decid√≠ comenzar a experimentar.  Siempre puede agregar m√°s ejemplos y mejorar la calidad del modelo. <br><br>  En el momento del marcado, no sab√≠a qu√© herramienta de capacitaci√≥n usar√≠a, as√≠ que decid√≠ guardar los resultados del marcado en el formato VOC, uno de los conservadores y aparentemente universal. <br><br>  Puede surgir la pregunta: ¬øpor qu√© no buscar im√°genes de unidades p√≠xel por p√≠xel por coincidencia completa?  El problema es que para esto tendr√≠a que buscar una gran cantidad de diferentes cuadros de animaci√≥n de diferentes unidades.  Dif√≠cilmente funcionar√≠a.  Quer√≠a hacer una soluci√≥n universal que admita diferentes permisos.  Adem√°s, las unidades pueden tener un color diferente seg√∫n el efecto que se les aplique: congelaci√≥n, aceleraci√≥n. <br><br><h2>  ¬øPor qu√© eleg√≠ YOLO? </h2><br>  Comenc√© a explorar posibles soluciones de reconocimiento de im√°genes.  Mir√© la aplicaci√≥n de varios algoritmos: OpenCV, TensorFlow, Torch.  Quer√≠a hacer el reconocimiento lo m√°s r√°pido posible, incluso sacrificar la precisi√≥n, y obtener POC lo antes posible. <br><br>  Despu√©s de leer los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culos</a> , me di cuenta de que mi tarea no encaja con los clasificadores HOG / LBP / SVM / HAAR / ...  Aunque son r√°pidos, tendr√≠an que aplicarse muchas veces, seg√∫n el clasificador de cada unidad, y luego uno por uno para aplicarlos a la imagen para la b√∫squeda.  Adem√°s, su principio de funcionamiento en teor√≠a dar√≠a malos resultados: las unidades pueden tener una forma diferente, por ejemplo, cuando se mueven hacia la izquierda y hacia arriba. <br><br>  Te√≥ricamente, utilizando una red neuronal, puede aplicarla una vez a una imagen y obtener todas las unidades de diferentes tipos con su posici√≥n, por lo que comenc√© a buscar redes neuronales.  TensorFlow ha encontrado soporte para redes neuronales convolucionales (CNN).  Result√≥ que no es necesario entrenar redes neuronales desde cero: puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">volver a entrenar la poderosa red existente</a> . <br><br>  Luego encontr√© un algoritmo YOLO m√°s pr√°ctico, que promete menos complejidad y, por lo tanto, ten√≠a que proporcionar un algoritmo de b√∫squeda de alta velocidad sin sacrificar mucha precisi√≥n (y en algunos casos, superar otros modelos). <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El sitio web de YOLO</a> promete una gran diferencia de velocidad utilizando el modelo peque√±o y una red m√°s peque√±a y optimizada.  YOLO tambi√©n le permite volver a entrenar la red neuronal terminada para su tarea, y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">darknet</a> , un marco de c√≥digo abierto para usar varias neuronas cuyos creadores desarrollaron YOLO, es una aplicaci√≥n C nativa simple, y todo el trabajo con ella ocurre a trav√©s de sus llamadas de par√°metros. <br><br>  TensorFlow, escrito en Python, es de hecho una biblioteca de Python y se usa usando scripts escritos por usted mismo que necesita descifrar o refinar para satisfacer sus necesidades.  Probablemente, para algunos, la flexibilidad de TensorFlow es una ventaja, pero sin entrar en detalles, es casi imposible tomarlo r√°pidamente y usarlo.  Por lo tanto, en mi proyecto, la elecci√≥n recay√≥ en YOLO. <br><br><h2>  Edificio modelo </h2><br>  Para trabajar en la capacitaci√≥n de modelos, instal√© Ubuntu 18.10, entregu√© paquetes de ensamblaje, el paquete OpenCL de NVIDIA y otras dependencias, y constru√≠ darknet. <br><br>  Github tiene una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">secci√≥n con pasos simples para</a> volver a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">entrenar el modelo YOLO</a> : debe descargar el modelo y las configuraciones, cambiarlos y comenzar a volver a entrenar. <br><br>  Primero quer√≠a intentar volver a entrenar un modelo simple de YOLO, luego Tiny y compararlos.  Sin embargo, result√≥ que para entrenar modelos simples, necesita 4 GB de memoria de tarjeta de video, y solo tuve una tarjeta gr√°fica NVIDIA GeForce GTX 1060 de 3 GB comprada para juegos.  Por lo tanto, pude entrenar inmediatamente solo el modelo Tiny. <br><br>  El marcado de las unidades en las im√°genes que ten√≠a estaba en formato VOC, y YOLO funcionaba con su propio formato, as√≠ que utilic√© la utilidad <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">convert2Yolo</a> para convertir archivos de anotaciones. <br><br>  Despu√©s de una noche de entrenamiento en mis 200 capturas de pantalla, obtuve los primeros resultados, y me sorprendieron: ¬°el modelo realmente pudo reconocer algo correctamente!  Me di cuenta de que me estaba moviendo en la direcci√≥n correcta y decid√≠ hacer m√°s ejemplos de ense√±anza. <br><br><img src="https://habrastorage.org/webt/ek/rh/ik/ekrhikfcntuxljeawh09ikegnp0.png"><br><br>  No quer√≠a continuar dise√±ando capturas de pantalla, y recordaba los cuadros de las animaciones de la unidad.  Marqu√© todas las im√°genes peque√±as con sus clases e intent√© entrenar a la red en este set.  El resultado fue muy malo.  Supongo que el modelo no pudo seleccionar los patrones correctos de im√°genes peque√±as para usar en im√°genes grandes. <br><br>  Despu√©s de eso, decid√≠ colocarlos en fondos ya preparados de campos de batalla y crear program√°ticamente un archivo de marcado VOC.  Result√≥ una captura de pantalla sint√©tica con un dise√±o autom√°tico 100% preciso. <br><br>  Escrib√≠ un script en Scala que divide la captura de pantalla en 16 cuadrados de 4x4 y establece las unidades en su centro para que no se crucen entre s√≠.  El gui√≥n tambi√©n me permiti√≥ personalizar la creaci√≥n de ejemplos de entrenamiento: al recibir da√±o, las unidades se pintan en el color de su equipo (rojo / azul), y durante la clasificaci√≥n reconozco por separado las unidades de diferentes colores.  Adem√°s de las manchas, las unidades de diferentes equipos que recibieron da√±os tienen ligeras diferencias en la vestimenta.  Adem√°s, aument√© y disminu√≠ aleatoriamente un poco las unidades, de modo que el modelo aprendi√≥ a no depender mucho del tama√±o de la unidad.  Como resultado, aprend√≠ a crear decenas de miles de ejemplos de entrenamiento que son aproximadamente similares a las capturas de pantalla reales. <br><br><img src="https://habrastorage.org/webt/uv/zi/_u/uvzi_uwhmohzcx0a7ylmpbyjady.png"><br><br>  La generaci√≥n no fue perfecta.  A menudo, las unidades se colocaban en la parte superior de los edificios, aunque en el juego estar√≠an detr√°s de ellos;  no hubo ejemplos de partes superpuestas de la unidad, aunque esta no es una situaci√≥n rara en el juego.  Pero hasta ahora decid√≠ descuidarlo. <br><br><img src="https://habrastorage.org/webt/zo/wk/uq/zowkuqkijfqocemk7_qflhhgavg.png"><br><br>  El modelo obtenido despu√©s de varias noches de entrenamiento en una mezcla de 200 capturas de pantalla reales y 5,000 im√°genes generadas que se recrearon durante el proceso de entrenamiento una vez al d√≠a, cuando se probaron en estas capturas de pantalla, arrojaron malos resultados.  No es sorprendente, porque las im√°genes generadas tienen muchas diferencias con las reales. <br><br>  Por lo tanto, puse el modelo resultante para volver a entrenar en una muestra media, en la que solo hab√≠a 200 de mis capturas de pantalla.  Despu√©s de eso, ella comenz√≥ a trabajar mucho mejor. <br><br><div class="spoiler">  <b class="spoiler_title">Maldita verg√ºenza</b> <div class="spoiler_text">  Pido disculpas por manejar medidas tan poco cient√≠ficas como "mucho mejor", pero no s√© c√≥mo validar r√°pidamente las im√°genes, por lo que prob√© varias capturas de pantalla de un conjunto sin entrenamiento y busqu√© para ver si los resultados me satisfacen.  Esto es lo m√°s importante.  Somos perezosos y estamos haciendo un prototipo, ¬øverdad? <br><br>  Los siguientes pasos para mejorar el modelo fueron comprensibles: marque con sus manos capturas de pantalla m√°s reales y capac√≠telas en el modelo, pre-entrenadas en las capturas de pantalla generadas. <br></div></div><br><h2>  Vamos al bot </h2><br>  Decid√≠ escribir un bot en Python: tiene muchas herramientas disponibles para ML.  Decid√≠ usar mi modelo con OpenCV, que desde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">3.5 aprend√≠ a usar modelos de redes neuronales</a> , e incluso encontr√© un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ejemplo simple</a> .  Despu√©s de probar varias bibliotecas para trabajar con ADB, eleg√≠ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pure-python-adb</a> ; todo lo que necesito simplemente se implementa all√≠: la funci√≥n de captura de pantalla y la operaci√≥n en el dispositivo shell;  Toco usando el 'toque de entrada'. <br><br>  Entonces, habiendo recibido una captura de pantalla del juego, reconociendo las unidades en √©l y meti√©ndolo en la pantalla, continu√© trabajando para reconocer el estado del juego.  Adem√°s de las unidades, necesitaba reconocer el nivel de man√° actual y las cartas disponibles para el jugador. <br><br>  El nivel de man√° en el juego se muestra como una barra de progreso y n√∫meros.  Sin pensarlo dos veces, comenc√© a cortar el n√∫mero, invertir y reconocer usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pytesseract</a> . <br><br>  Para determinar las tarjetas disponibles y su posici√≥n, utilic√© el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">detector de puntos clave KAZE de OpenCV</a> .  Hasta ahora no quer√≠a volver a aprender la red neuronal nuevamente, y eleg√≠ un m√©todo que fuera m√°s r√°pido y f√°cil, aunque al final result√≥ que ten√≠a la precisi√≥n m√≠nima suficiente en el caso en que necesita buscar muchos objetos. <br><br>  Al iniciar el bot, cont√© los puntos clave para todas las im√°genes de las cartas (hay varias docenas en total), y durante el juego busqu√© coincidencias de todas las cartas con el √°rea de cartas del jugador para reducir el n√∫mero de errores y aumentar la velocidad.  Se ordenaron por precisi√≥n y por la coordenada <i>x</i> para obtener el orden de los mapas: informaci√≥n sobre c√≥mo se encuentran en la pantalla. <br><br>  Despu√©s de jugar un poco con los par√°metros, en la pr√°ctica obtuve muchos errores, aunque algunas im√°genes complejas de tarjetas, que a veces se confund√≠an con el algoritmo, se reconocieron con gran precisi√≥n.  Tuve que agregar un b√∫fer de tres elementos: si tres reconocimientos seguidos obtenemos los mismos valores, entonces condicionalmente creemos que podemos confiar en ellos. <br><br><img src="https://habrastorage.org/webt/vr/8a/mj/vr8amjw6_mpuh8kzethfk0zbkya.png"><br><br>  Despu√©s de recibir toda la informaci√≥n necesaria (unidades y su posici√≥n aproximada, man√° disponible y cartas), puedes tomar algunas decisiones. <br><br>  Para empezar, decid√≠ tomar algo simple: por ejemplo, si hay suficiente man√° en una carta accesible, ju√©galo en el campo.  Pero el bot a√∫n no sabe c√≥mo "jugar" las cartas: sabe qu√© cartas tenemos, d√≥nde est√° el campo, debe hacer clic en la carta deseada y luego en la celda deseada en el campo. <br><br>  Conociendo la resoluci√≥n de la captura de pantalla, puede comprender las coordenadas del mapa y la celda de campo deseada.  Ahora he vinculado a la resoluci√≥n de pantalla exacta, pero si es necesario, puedo ignorar esto.  La funci√≥n de decisi√≥n devolver√° una serie de toques que deben hacerse en un futuro pr√≥ximo.  En general, nuestro bot ser√° un bucle infinito (simplificado): <br><br><pre><code class="plaintext hljs">:     =        :         ( )               :         =  ()         =  ()         =  ()         += (, , , )</code> </pre> <br><br>  Hasta ahora, el bot solo puede poner unidades en un punto, pero ya tiene suficiente informaci√≥n para construir una estrategia m√°s compleja. <br><br><h3>  Primeros problemas </h3><br>  En realidad, me encontr√© con un problema inesperado y muy desagradable.  Crear una captura de pantalla a trav√©s de ADB toma alrededor de 100 ms, lo que introduce un retraso significativo: esperaba tal retraso m√°ximo, teniendo en cuenta todos los c√°lculos y la elecci√≥n de la acci√≥n, pero no en un solo paso para crear una captura de pantalla.  No se pudo encontrar una soluci√≥n simple y r√°pida.  En teor√≠a, usando el emulador de Android, puede tomar capturas de pantalla directamente desde la ventana de la aplicaci√≥n, o puede hacer una utilidad para transmitir im√°genes desde un tel√©fono con compresi√≥n a trav√©s de UDP y conectar el bot, pero tampoco encontr√© soluciones r√°pidas aqu√≠. <br><br><h2>  Entonces </h2><br>  Habiendo evaluado sobriamente el estado de mi proyecto, decid√≠ detenerme en este modelo por ahora.  Pas√© varias semanas de mi tiempo libre haciendo esto, y el reconocimiento de unidades es solo una parte del juego. <br><br>  Decid√≠ desarrollar las partes del bot gradualmente, para hacer la l√≥gica b√°sica de percepci√≥n, luego la l√≥gica simple del juego y la interacci√≥n con el juego, y luego ser√° posible mejorar las partes individuales del bot.  Cuando el nivel del modelo de reconocimiento de unidades se vuelve suficiente, agregar informaci√≥n sobre HP y el nivel de unidades puede llevar el desarrollo del bot del juego a una etapa completamente nueva.  Quiz√°s este sea el pr√≥ximo objetivo, pero en este momento definitivamente no vale la pena centrarse en esta tarea. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Repositorio de proyectos Github</a> <br><br>  Pas√© mucho tiempo en el proyecto y, francamente, estoy cansado de ello, pero no me arrepiento un poco: obtuve una nueva experiencia en ML / CV. <br><br>  Tal vez volver√© con √©l m√°s tarde; me alegrar√° si alguien se une a m√≠.  Si est√° interesado, √∫nase al grupo en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Telegram</a> y tambi√©n venga a mi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">curso de Scala</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/439352/">https://habr.com/ru/post/439352/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../439342/index.html">DIYorDIE Winter Meetup 17 de febrero</a></li>
<li><a href="../439344/index.html">Como un troll: c√≥mo los monopolistas gobiernan las patentes</a></li>
<li><a href="../439346/index.html">Laravel + Docker: nuestra experiencia exitosa</a></li>
<li><a href="../439348/index.html">La visi√≥n cae despu√©s de la correcci√≥n de la visi√≥n con l√°ser: ¬øqu√© hacer? O, doctor, hazme una mejora</a></li>
<li><a href="../439350/index.html">La inteligencia artificial como m√°quina de invenci√≥n</a></li>
<li><a href="../439354/index.html">Rust News # 5 (enero de 2019)</a></li>
<li><a href="../439356/index.html">M√©tricas no triviales de la efectividad de las campa√±as publicitarias.</a></li>
<li><a href="../439358/index.html">Metadatos de archivo de Excel</a></li>
<li><a href="../439360/index.html">Entrenamiento Cisco 200-125 CCNA v3.0. Especialista certificado en redes de Cisco (CCNA). D√≠a 3. Subredes</a></li>
<li><a href="../439362/index.html">¬øC√≥mo ense√±amos Ingenier√≠a de Software en el HSE de San Petersburgo?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>