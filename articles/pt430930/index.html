<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äçüíº ‚òùüèº üèø Sobre gr√°ficos 3D em palavras simples üëÇüèª ü•™ ü§∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Parte 1. Introdu√ß√£o 
 Ol√°, meu nome √© careca. Eu trabalho como programador de gr√°ficos h√° v√°rios anos, portanto, embora eu n√£o seja de forma alguma um...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sobre gr√°ficos 3D em palavras simples</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430930/"><h2>  Parte 1. Introdu√ß√£o </h2><br>  Ol√°, meu nome √© careca.  Eu trabalho como programador de gr√°ficos h√° v√°rios anos, portanto, embora eu n√£o seja de forma alguma um especialista, parece que eu j√° entendo muito sobre tudo relacionado ao trabalho com gr√°ficos. <br><br>  A ideia desta s√©rie de posts est√° pairando h√° muito tempo em algum lugar na periferia da minha mente e surgiu novamente depois de ler um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo interessante com uma an√°lise do mais recente Deus Ex</a> . <br><br>  Parece-me que os gr√°ficos, e especialmente a complexidade que ele atinge nos jogos modernos, s√£o um t√≥pico interessante.  Pouqu√≠ssimas pessoas t√™m curiosidade de se aprofundar em todos os detalhes, mas acredito que h√° t√≥picos que interessam a todos.  Eu acho que a maioria das pessoas que jogava jogos estava curiosa sobre como esses ou aqueles efeitos foram obtidos, ou com qual tecnologia eles conseguiram criar gr√°ficos t√£o incr√≠veis em algum novo jogo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4c8/3b9/2ad/4c83b92ad325af58966fc3742aa85a10.jpg"></div><br>  <em>Existem muitos componentes necess√°rios para criar at√© um jogo 3D simples, sem mencionar um projeto como o Watch Dogs.</em> <br><br>  Tenho apenas uma id√©ia geral do que precisa ser considerado neste artigo, mas isso depender√° de quais t√≥picos causar√£o interesse.  No entanto, a id√©ia principal √© criar uma descri√ß√£o geral do que est√° acontecendo dentro do jogo moderno sem assustar nenhum dos leitores - presumo que voc√™ n√£o tenha conhecimento de matem√°tica e programa√ß√£o.  Se voc√™ conhece a diferen√ßa entre a CPU e a placa de v√≠deo e distingue a RAM do disco r√≠gido, isso ser√° suficiente e eu explicarei o resto. <br><a name="habracut"></a><br>  Este artigo ser√° desenvolvido de acordo com o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">passo a passo de</a> v√≠deo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Let's Play of Watch Dogs da Chip &amp; Ironicus</a> , a fim de estruturar levemente a apresenta√ß√£o.  O jogo √© conhecido por seus gr√°ficos (e opini√µes sobre ele podem ser completamente opostas), e h√° muitos aspectos que podem ser considerados com exemplos separados.  Talvez eu fale sobre outros jogos. <br><br>  Come√ßarei explicando o b√°sico que √© praticamente o mesmo para todos os jogos, mas tamb√©m analisarei algumas das t√©cnicas e efeitos visuais do Watch Dogs. <br><br>  Vou usar uma ferramenta chamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RenderDoc</a> , que escrevi no meu tempo livre.  √â usado para depurar problemas com gr√°ficos - a ferramenta permite decompor um quadro gr√°fico em partes e, gra√ßas a isso, veremos como ele se junta. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed//OBaA9JD/embed?ref=https" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <em>Essa anima√ß√£o mostra parte de um quadro que est√° sendo criado gradualmente no processo de renderiza√ß√£o com uma placa gr√°fica.</em> <br><br>  A maioria das pessoas sabe que os gr√°ficos de computador (e os de qualquer outro v√≠deo) consistem em uma s√©rie de quadros est√°ticos, cada um dos quais √© exibido por uma certa fra√ß√£o de segundo.  No cinema, tradicionalmente usado 24 quadros por segundo (quadros por segundo, FPS), na televis√£o a frequ√™ncia √© quase a mesma, cerca de 24 a 30 quadros.  Nos jogos, o FPS pode ser alterado porque √© feito muito trabalho em cada quadro.  Uma queda de frequ√™ncia abaixo de 30 √© indesej√°vel, embora isso ocorra com bastante frequ√™ncia.  Geralmente, o limite superior para jogos de console √© de 60 FPS.  Os desenvolvedores procuram implementar uma frequ√™ncia de 30 ou 60, que depende dos objetivos do jogo.  Em um PC com uma tela com alta taxa de quadros, √© poss√≠vel atingir 90, 120 ou at√© mais.  A raz√£o para esses n√∫meros espec√≠ficos √© a sincroniza√ß√£o vertical (vsync), que discutiremos abaixo. <br><br>  Mentalmente, podemos olhar para essa tarefa do lado oposto - em vez de ver qu√£o <em>alta √© a</em> frequ√™ncia <em>do</em> FPS, observamos qu√£o <em>pouco</em> tempo √© alocado para cada quadro.  Se queremos que o jogo funcione com uma frequ√™ncia de 30 FPS, temos apenas 33 milissegundos para concluir todo o trabalho necess√°rio para o quadro.  A 60 FPS, o tempo √© metade - cerca de 17 milissegundos.  Mesmo para um computador, esse per√≠odo de tempo n√£o √© muito grande, dada a quantidade de trabalho que precisa ser feito.  Para se ter uma id√©ia das quantidades, ent√£o, de acordo com estimativas aproximadas, a bala se move cerca de 1 metro por milissegundo. <br><br>  Falaremos principalmente sobre PCs porque essa plataforma √© aberta e n√£o posso falar sobre consoles sem medo de violar acordos de n√£o divulga√ß√£o (NDAs).  Enfim, basicamente vou falar sobre o que n√£o √© muito diferente nos consoles, mas se algo ainda diferir, enfatizarei isso.  Para plataformas m√≥veis, a maioria das diferen√ßas entre hardware / consoles de PC e hardware m√≥vel n√£o √© relevante para o t√≥pico do meu artigo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d8a/414/db8/d8a414db8e56c45fae566b8da11316e2.jpg"></div><br>  <em>Sinceramente, coloquei esta foto aqui para que voc√™ entenda que o artigo n√£o ter√° apenas texto.</em> <br><br>  √â essa tarefa que nos interessa - n√£o nos preocuparemos com a forma como todos os seus c√°lculos de IA s√£o executados ou com a simula√ß√£o f√≠sica para mover objetos.  Os limites da disciplina chamada "programa√ß√£o gr√°fica" s√£o um pouco confusos, mas eu digo que a programa√ß√£o gr√°fica come√ßa quando temos todas as informa√ß√µes necess√°rias para construir um quadro: sabemos o que acontece, todas as texturas e modelos est√£o na mem√≥ria (n√£o no disco) ), as anima√ß√µes j√° est√£o animadas, a f√≠sica √© contada e precisamos apenas desenhar um quadro pronto para exibi√ß√£o na tela. <br><br>  Acrescento que considerarei um jogo 3D com uma renderiza√ß√£o bastante tradicional, como o Watch Dogs - muitos dos princ√≠pios b√°sicos se aplicam a jogos 2D, mas √© um pouco mais dif√≠cil demonstrar conceitos sobre eles.  Tamb√©m explicarei (especialmente para programadores gr√°ficos) que estou me esfor√ßando principalmente para entender, portanto, talvez, usarei explica√ß√µes bastante duvidosas se elas me permitirem alcan√ßar meu objetivo. <br><br><h2>  Parte 2. Em que consiste o quadro </h2><br>  Na maioria das vezes, vamos olhar apenas um quadro e falar sobre os blocos de constru√ß√£o que o jogo usa para criar um quadro acabado.  Tamb√©m nesta parte, haver√° v√°rias novas fotos bonitas. <br><br>  Existem v√°rias maneiras de montar uma estrutura a partir de blocos de constru√ß√£o.  A imagem final que o player v√™ n√£o √© renderizada instantaneamente.  Ele foi desenhado imediatamente h√° muitos anos, mas os motores gr√°ficos modernos quase sempre usam algum tipo de pr√©-processamento.  Antes de exibir o quadro final na tela, o mecanismo gr√°fico desenha muitas imagens intermedi√°rias de v√°rios tipos que ajudam no c√°lculo da imagem final. <br><br>  Essas imagens s√£o altamente dependentes do tipo de mecanismo e das t√©cnicas que o programador gr√°fico precisa aplicar.  Por exemplo, se ele deseja que a luz do sol crie as sombras corretas, um tipo de imagem ser√° necess√°rio para as sombras.  Ele tamb√©m pode precisar das reflex√µes corretas no carro dirigido pelo jogador e, para isso, tamb√©m precisa de outra imagem com reflex√µes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/874/47d/95e/87447d95ee62161dc63df6e3dd2406f5.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a3b/9ec/b69/a3b9ecb6984a5aae18fd57d8c2f4a9f2.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e6/bd2/ff7/1e6bd2ff7c49373dc337d20c0fe2a66a.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa4/5cb/65d/fa45cb65dfcb2042ecfd06ef6c463022.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d9/4ed/937/3d94ed937c68dd821ab21c4a1a1cf4fb.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a57/360/2e8/a573602e8f7b69fa3868df93eebc776f.jpg"></div><br>  <em>V√°rios exemplos de imagens intermedi√°rias usadas na constru√ß√£o do quadro Watch Dogs.</em> <br><br>  Neste artigo, n√£o considerarei cada uma das imagens usadas no quadro Watch Dogs, mas apenas as b√°sicas, para que voc√™ possa aprender alguma coisa.  Esta √© uma √°rea em que a pesquisa gr√°fica est√° constantemente ocorrendo e novas t√©cnicas est√£o surgindo.  As inova√ß√µes tamb√©m surgem em n√≠veis menores, mas quando o marketing informa sobre alguma nova fun√ß√£o gr√°fica, geralmente se refere a essas melhorias. <br><br><hr><br>  Cada uma dessas imagens intermedi√°rias tamb√©m √© constru√≠da a partir de fragmentos ainda menores.  Cada objeto na cena ou um grupo de objetos relacionados √© criado separadamente como um <em>modelo texturizado</em> .  Ao desenvolver um jogo, os artistas constroem esses modelos em um editor 3D e criam todos os recursos necess√°rios para eles.  Em seguida, esses modelos s√£o colocados no mundo usando o editor de n√≠veis e uma cidade virtual √© gradualmente constru√≠da a partir deles. <br><br>  Provavelmente, quase todo mundo sabe disso, e se voc√™ assistiu ao desenvolvimento de gr√°ficos 3D em tempo real nos √∫ltimos 20 anos, sabe como os modelos mais complexos se tornaram hoje.  Nos primeiros est√°gios da forma√ß√£o dos gr√°ficos, o mapeamento de texturas era um processo dispendioso e, se poss√≠vel, era descartado pintando objetos da mesma cor.  As texturas foram deixadas apenas para elementos como olhos ou rostos que realmente precisavam de detalhes. <br><br>  O modelo 3D consiste inteiramente em tri√¢ngulos interconectados que formam a forma do objeto.  Cada tri√¢ngulo tem tr√™s pontos chamados v√©rtices e, como os tri√¢ngulos est√£o conectados, os v√©rtices podem ser compartilhados por v√°rios tri√¢ngulos.  Voltaremos a isso mais tarde, porque os v√©rtices e tri√¢ngulos s√£o importantes o suficiente.  Tamb√©m vale lembrar que alguns objetos, por exemplo, caracteres ou √°rvores, devem ser animados antes da renderiza√ß√£o.  O modelo √© criado no formato est√°tico padr√£o e as anima√ß√µes s√£o aplicadas em cada quadro.  Voltaremos a isso tamb√©m. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/357/03d/382/35703d382d727d1e395283a4fb3aae33.jpg"></div><br>  <em>Este √© um modelo 3D da cabe√ßa de Aiden Pierce ap√≥s anima√ß√£o.</em>  <em>Os tri√¢ngulos s√£o vis√≠veis porque s√£o desenhados planos e n√£o suavizados, como √© geralmente o caso.</em> <br><br>  Para adicionar mais detalhes ao modelo 3D, as texturas s√£o sobrepostas.  As texturas s√£o arquivos regulares de imagem plana, geralmente de tamanho quadrado ou simples, como ret√¢ngulos com uma propor√ß√£o de 2: 1.  As texturas s√£o sobrepostas no modelo 3D usando um processo mais complexo, que discutirei com mais detalhes abaixo, mas conceitualmente √© semelhante ao processo de embrulhar um presente.  Em vez de um padr√£o simples e repetitivo de inv√≥lucros de papel, a imagem corresponde exatamente ao tamanho do inv√≥lucro.  Se voc√™ viu modelos de papel para montagem com cola, o princ√≠pio √© o mesmo. <br><br>  Essa analogia √© mais apropriada do que voc√™ imagina, porque essas texturas geralmente s√£o criadas ‚Äúdesenrolando‚Äù um modelo 3D em um espa√ßo em branco plano, como √© feito com um modelo de papel, ap√≥s o qual uma textura √© desenhada sobre ela.  Essa implanta√ß√£o geralmente √© realizada automaticamente, mas no caso de objetos particularmente complexos pode ser feito manualmente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b9f/1f7/cf0/b9f1f7cf0d34680c8f313ad11691656f.jpg"></div><br>  <em>Esta √© a textura correspondente ao modelo de cabe√ßa de Aiden Pierce mostrado acima.</em>  <em>Existem pe√ßas para dentes e l√≠ngua.</em>  <em>Observe que a √°rea acima da testa n√£o √© texturizada porque est√° permanentemente coberta pelo bon√© de beisebol lend√°rio Aiden Pearce ‚Ñ¢.</em> <br><br><blockquote><h4>  Nota </h4><br>  Ao desdobrar, algumas partes do objeto que requerem mais detalhes aumentam, enquanto outras diminuem. </blockquote><br>  Muitas vezes eles falam sobre v√°rias "skins" de modelos, especialmente no caso de personagens personaliz√°veis.  Hoje, o que √© chamado de ‚Äúskin‚Äù geralmente se refere a pequenas mudan√ßas no modelo - um novo cinto ou um chap√©u diferente -, mas inicialmente esse termo surgiu porque o mesmo modelo foi usado, mas a textura mudou (ou ‚Äúskin‚Äù - literalmente se traduz como "Skin") para criar um personagem com apar√™ncia diferente.  Ainda hoje, com a ajuda de tais texturas, voc√™ pode criar uma grande variabilidade de NPCs ou objetos, o que economiza tempo e dinheiro - voc√™ n√£o precisa criar muitos modelos 3D exclusivos.  As roupas diferentes que Aiden pode usar geralmente s√£o apenas texturas diferentes do mesmo modelo. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed//8ItIFRj/embed?ref=https" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <em>Aqui est√° um breve trecho da rota√ß√£o da cabe√ßa do modelo 3D.</em>  <em>Sobreposta apenas textura, e nada mais.</em> <br><br>  No quadro que estamos considerando, existem aproximadamente 1700 objetos renderizados na parte principal de renderiza√ß√£o.  Alguns deles ser√£o os mesmos modelos - objetos como flores em vasos e latas de lixo nunca s√£o realmente criados separadamente; esse √© um modelo ou v√°rios modelos colocados em lugares diferentes.  No entanto, a quantidade aproximada de objetos desenhados para completar o quadro √© pr√≥xima de <strong>4700</strong> - isso nos d√° uma id√©ia de quanto trabalho adicional precisa ser feito al√©m da renderiza√ß√£o de todos esses modelos. <br><br>  Vejamos outro exemplo de um objeto - um bon√© de beisebol usado por Aiden. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa2/1ce/636/aa21ce63666b4636b76ebe062f7536ca.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0f7/4d3/b93/0f74d3b9305c6ed4572a5bc55d178a11.jpg"></div><br>  <em>Este √© um modelo de bon√© de beisebol com textura e textura.</em>  <em>Pode-se observar que a textura √© constru√≠da com partes separadas conectadas ao modelo.</em> <br><br><blockquote><h4>  Nota </h4><br>  A viseira e a parte principal do bon√© de beisebol na textura n√£o tocam, porque a digitaliza√ß√£o pode ser bastante complicada e, se necess√°rio, pode ser realizada em v√°rias partes diferentes.  √Äs vezes, texturizar um modelo de forma complexa sem problemas vis√≠veis e costuras requer uma quantidade razo√°vel de habilidades. </blockquote><br>  Os mesmos princ√≠pios que vimos com a cabe√ßa de Aiden se aplicam ao bon√©.  De fato, se ignorarmos a textura e os n√∫meros espec√≠ficos necess√°rios para realizar o desembrulhamento, o princ√≠pio ser√° sempre o mesmo. <br><br>  Para mostrar o que pode dar errado durante o desenvolvimento e demonstrar como voc√™ pode se divertir ao programar gr√°ficos, podemos realizar um pequeno experimento.  Como a maioria das texturas tem um tamanho quadrado padr√£o e o m√©todo de agrupar e desdobrar as texturas no modelo tamb√©m √© o mesmo, por que n√£o brincar um pouco com elas?  O que acontece se aplicarmos a textura da cabe√ßa de Aiden em um modelo de bon√© de beisebol? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/212/1b1/5c7/2121b15c7f8355575864f9333c9eeab0.jpg"></div><br>  <em>J√° n√£o √© muito parecido com o bon√© de beisebol lend√°rio de Aiden Pierce.</em> <br><br>  Onde havia um logotipo na textura do bon√© de beisebol, a orelha e os dentes est√£o localizados na textura da cabe√ßa.  Onde havia uma viseira, havia apenas cabelos na textura da cabe√ßa.  A sobreposi√ß√£o √© exatamente a mesma, mas uma textura diferente √© usada.  Obviamente, este exemplo ser√° um erro no jogo, mas pense no que pode ser feito se voc√™ animar a textura ou faz√™-la tremular - nos jogos, essas coisas s√£o usadas para v√°rios efeitos que voc√™ pode notar agora.  Em particular, o jogo Saint's Row 4 usa similar para efeitos especiais de "simula√ß√£o". <br><br>  Tamb√©m ser√° √∫til pensar nas consequ√™ncias disso - os jogos combinam muito cuidadosamente pares de modelos e texturas, ou seja, os modelos mais exclusivos devem corresponder √†s suas pr√≥prias texturas √∫nicas. <br><br>  Obviamente, essa regra n√£o √© absoluta - em alguns casos, para economizar espa√ßo, a textura √© um padr√£o de repeti√ß√£o padr√£o que pode ser usado para muitos objetos.  Conjuntos de objetos vinculados - por exemplo, bancas de jornais - podem usar a mesma textura para jornais diferentes, com cada jornal ocupando uma pequena fra√ß√£o da textura. <br><br>  No entanto, isso significa que, para construir a imagem final, todos os blocos de constru√ß√£o devem estar presentes, ou seja, como resultado, muitos modelos e texturas necess√°rios podem ser obtidos.  Na pr√≥xima parte, falaremos sobre por que alguns aspectos, como a reflex√£o, s√£o muito dif√≠ceis de implementar corretamente.  Tamb√©m falarei sobre como os jogos usam pequenos truques para economizar tempo e recursos. <br><br><h2>  Parte 3. O que voc√™ n√£o precisa desenhar </h2><br>  Freq√ºentemente, programar gr√°ficos √© a tarefa de equilibrar uma d√∫zia de restri√ß√µes diferentes para obter o compromisso perfeito.  Na √∫ltima parte, vimos que toda vez que uma cena √© desenhada, ela √© montada a partir de muitos pequenos blocos de constru√ß√£o - pessoas, carros, sinais de tr√¢nsito, edif√≠cios.  Tudo o que est√° na tela √© composto de componentes individuais que precisam ser desenhados.  Existem v√°rias opera√ß√µes sutis de balanceamento que discutiremos aqui. <br><br>  O processador central e a placa gr√°fica trabalham juntos na renderiza√ß√£o do quadro.  O resto do jogo √© executado na CPU, por isso decide quais objetos devem ser desenhados no quadro atual, para onde a c√¢mera est√° olhando e quais anima√ß√µes s√£o reproduzidas.  Uma placa de v√≠deo √© um "cavalo de batalha" que executa todo o trabalho complexo envolvido na renderiza√ß√£o de pixels, e √© por isso que √© um dispositivo especializado separado. <br><br>  Acontece que tanto a CPU quanto a placa gr√°fica t√™m limita√ß√µes na velocidade ou quantidade de c√°lculos, mas esses s√£o tipos diferentes de restri√ß√µes. <br><br>  Em geral, a CPU est√° mais interessada em sua parte do trabalho: quantos objetos precisamos desenhar no total?  Qu√£o <i>diferentes s√£o</i> esses objetos - s√£o 100 luzes id√™nticas ou 100 arbustos / plantas / √°rvores?  Esses objetos s√£o animados, eles est√£o se movendo dinamicamente e quais deles s√£o est√°ticos ou im√≥veis? <br><br>  A primeira coisa que fazemos para reduzir a carga o m√°ximo poss√≠vel √© desenhar apenas o que √© vis√≠vel na tela.  Isso parece √≥bvio, mas a implementa√ß√£o requer um trabalho cuidadoso.  N√£o se esque√ßa de que constru√≠mos cada quadro a partir do zero, portanto, <i>em cada quadro</i> , precisamos olhar para cada objeto e determinar se ele √© vis√≠vel ou n√£o.  Isso significa que em todo jogo existe um vazio negro em toda parte ap√≥s o jogador, e quando ele n√£o olha para objetos e pessoas, eles deixam de existir. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed//bmSqTLe/embed?ref=https" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <em>Nesta anima√ß√£o, giramos a c√¢mera, mostrando o vazio atr√°s do player.</em>  <em>Os espectadores atentos perceber√£o que n√£o est√° completamente vazio ...</em> <br><br>  √â dif√≠cil desenvolver regras pr√°ticas nesse caso, mas, em geral, voc√™ pode desenhar cerca de 1000 objetos na cena sem se preocupar com a falta de espa√ßo.  No entanto, se voc√™ precisar renderizar 5.000 objetos, pense em usar truques.  N√£o esque√ßa que, na maioria dos jogos em que o jogador pode controlar a c√¢mera, n√£o podemos saber em que √¢ngulo ele ficar√°; portanto, voc√™ precisa economizar espa√ßo para manobra. <br><br>  Acontece que existem muitos truques que permitem usar quase completamente um recurso v√°lido, e eles s√£o especialmente importantes em jogos como o Watch Dogs.  Quanto mais perto voc√™ estiver das bordas e mais qualidade visual puder obter do mesmo n√∫mero de objetos, melhor ser√° o jogo. <br><br>  Mesmo se voc√™ olhar o que est√° √† sua frente na cena, isso n√£o significa que √© necess√°rio desenhar a cidade inteira.  Se houver um edif√≠cio enorme √† esquerda ou √† direita, tudo o que est√° por tr√°s dele ficar√° invis√≠vel, para que voc√™ n√£o possa desenh√°-lo.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Da mesma forma, alguns objetos √† dist√¢ncia se tornam muito pequenos, portanto, n√£o precisamos nos preocupar em desenhar pequenas plantas e arbustos √† dist√¢ncia. </font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed//auvvQ67/embed?ref=https" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essa anima√ß√£o mostra que se voc√™ descer a rua al√©m do que vemos, n√£o haver√° nada nas ruas laterais, mas a uma grande dist√¢ncia os detalhes ficar√£o menores. </font></font></em> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De fato, ainda existem muitos objetos nessa cena que se tornar√£o invis√≠veis como resultado. </font><font style="vertical-align: inherit;">Ainda h√° muito a ser explorado nessa √°rea e v√°rias t√©cnicas sofisticadas devem ser aplicadas. </font><font style="vertical-align: inherit;">Voc√™ sempre precisa fazer compromissos, mas se puder gastar um pouco de tempo ou apresentar uma maneira muito inteligente de evitar renderizar 100 objetos com quase nenhum esfor√ßo extra, podemos tornar a cena ainda mais complexa ou mais densa.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, h√° outro pequeno problema. Em alguns casos, precisamos desenhar um edif√≠cio que mal √© vis√≠vel na tela e vai muito al√©m. Desperdi√ßa recursos. Sempre podemos dividir esses objetos em v√°rias partes, para que cada parte possa ser desenhada ou pulada, ou seja, haver√° menos desperd√≠cio. No entanto, agora aumentamos o n√∫mero total de objetos desenhados quando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est√£o</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na tela e criamos o problema oposto! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este exemplo √© um de centenas, mas √© f√°cil explicar quais decis√µes precisam ser tomadas e quais experimentos s√£o necess√°rios para encontrar o ponto de equil√≠brio perfeito para cada jogo.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como a a√ß√£o de nosso tiro da Watch Dogs ocorre na cidade, podemos examin√°-lo de cima para entender aproximadamente o que exatamente est√° sendo desenhado. </font><font style="vertical-align: inherit;">Nesta imagem est√°tica, √© especialmente not√°vel que o Watch Dogs faz o trabalho trimestralmente.</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed//My8bi1m/embed?ref=https" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora nos afastamos para mostrar a √°rea vis√≠vel na frente da c√¢mera (desculpe pela instala√ß√£o para economizar tempo).</font></font></em> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/719/960/135/7199601359a0d421147d9f632061bfaf.jpg"></div><br> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A visibilidade aproximada da c√¢mera √© sobreposta √† imagem. </font><font style="vertical-align: inherit;">A largura deste tri√¢ngulo depende do campo de vis√£o - √†s vezes nos jogos, √© uma op√ß√£o personalizada, √†s vezes um valor constante.</font></font></em> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ccf/5ff/d45/ccf5ffd455dccf7098393602c9944139.jpg"></div><br> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui est√° uma exibi√ß√£o em wireframe da cena, o campo de vis√£o da c√¢mera √© limitado ao branco.</font></font></em> <br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alguns de voc√™s j√° poderiam pensar em um pequeno truque que permitiria contornar a restri√ß√£o de renderizar um certo n√∫mero de objetos - por que n√£o fazer dos objetos uma combina√ß√£o muito complexa de tudo em uma pequena √°rea, at√© folhas individuais? Ent√£o desenhar 1000 objetos ser√° mais que suficiente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas aqui estamos diante de um conjunto completamente diferente de restri√ß√µes - as placas gr√°ficas t√™m desempenho limitado e quanto mais complexo o objeto, mais tempo ser√° necess√°rio para desenhar. Ou seja, mesmo um objeto, se for bastante complexo, pode reduzir a taxa de quadros do jogo para 20 FPS. Incluindo foi por isso que eu disse que o limite no n√∫mero de objetos √© bastante confuso.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A quantidade de tempo gasto em um objeto depende da complexidade e detalhes dos modelos e texturas, bem como da sofistica√ß√£o da ilumina√ß√£o e das sombras. √â tamb√©m por isso que os jogos que tentam implementar gr√°ficos mais complexos ou sofisticados tendem a usar cenas menos complexas e detalhadas - o balanceamento muda as escalas em uma dire√ß√£o ou outra, para que voc√™ possa ter mais espa√ßo de manobra, sacrificando o que n√£o √© t√£o importante para o jogo. .</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/45f/2d5/233/45f2d5233fe8bd806ab2fbf18baa038d.jpg"></div><br> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esse √© um tipo de mapa de calor, mostrando em quais partes da cena existem modelos especialmente complexos. Observe quantos problemas as √°rvores e a vegeta√ß√£o podem causar.</font></font></em> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> H√° outro conjunto de t√©cnicas chamado "n√≠vel de detalhe" (LOD), projetado especificamente para resolver esses problemas. Semelhante ao fato de podermos otimizar o n√∫mero de objetos, cortando tudo o que √© desnecess√°rio, podemos aumentar a oferta de "complexidade", eliminando o desnecess√°rio. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um dos truques √© realmente bem conhecido - isso est√° mudando a resolu√ß√£o das texturas. Esse t√≥pico geralmente se cruza com muitos outros, ent√£o tentarei explic√°-lo de uma maneira acess√≠vel.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As texturas nos jogos geralmente s√£o ret√¢ngulos com tamanhos iguais √† pot√™ncia de dois - 512, 1024, 2048, 4096. H√° muitas raz√µes para isso, mas uma das vantagens disso √© que voc√™ pode pegar uma textura de tamanho 1024x1024 e criar facilmente uma vers√£o menor com tamanho de 512x512 . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pelas raz√µes que irei discutir abaixo, √© sempre necess√°rio que a textura tenha todos os tipos de vers√µes menores. Ou seja, uma textura com um tamanho de 1024x1024 ter√° vers√µes menores de 512x512, 256x256, 128x128, 64x64, 32x32, 16x16, 8x8, 4x4, 2x2 e 1x1. No entanto, uma das vantagens disso √© que, se objetos distantes tiverem um tamanho pequeno na tela, aplicar uma textura 1024x1024 a eles significa desperdi√ßar recursos. Podemos economizar usando vers√µes menores da mesma textura.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Da mesma forma, mesmo objetos pr√≥ximos podem ser considerados n√£o muito significativos e usar texturas menores para eles. </font></font><br><br><blockquote><h4>  Nota </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geralmente, quando um jogador se aproxima de um objeto, a maior textura √© usada, mas como a maioria das pessoas j√° viu em um jogo em particular, isso nem sempre acontece e as texturas parecem muito emba√ßadas antes do carregamento. </font><font style="vertical-align: inherit;">Isso geralmente acontece porque as texturas n√£o podem ser carregadas de um DVD ou disco r√≠gido diretamente na mem√≥ria da placa gr√°fica para renderiza√ß√£o. </font><font style="vertical-align: inherit;">Na maioria das vezes isso acontece quando um jogador muda abruptamente de posi√ß√£o, por exemplo, durante o reaparecimento, carregando um novo n√≠vel ou um movimento muito r√°pido. </font><font style="vertical-align: inherit;">Em todos os outros casos, as texturas geralmente s√£o carregadas gradualmente, no processo de mover o jogador ao redor do mundo.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ tamb√©m pode aplicar esse processo de simplifica√ß√£o aos modelos usados ‚Äã‚Äãno jogo, embora seja muito mais dif√≠cil de fazer. Ao criar vers√µes simplificadas de objetos complexos, voc√™ pode garantir que a uma grande dist√¢ncia eles n√£o corroem parte de um suprimento limitado de complexidade. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gra√ßas a objetos simplificados e modelos cortados, voc√™ pode economizar muito dinheiro e usar essa abordagem em qualquer jogo como o Watch Dogs. Mas, ao mesmo tempo, pode ser um enorme desperd√≠cio de recursos. √â necess√°rio tomar uma decis√£o muito ponderada e equilibrada sobre quantas vers√µes simplificadas de modelos s√£o necess√°rias. Se houver muito poucos deles, voc√™ n√£o poder√° economizar muito, ou haver√° saltos vis√≠veis na qualidade ao alter√°-los. Se houver muitos deles, voc√™ desperdi√ßar√° mem√≥ria e gastar√° as horas necess√°rias para criar objetos.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/801/f01/9ed/801f019ed8c365cfebbbeea2320bf3d7.jpg"></div><br> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â assim que objetos e personagens complexos parecem distantes quando s√£o indistingu√≠veis de suas vers√µes altamente detalhadas.</font></font></em> <br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espero que agora voc√™ tenha uma id√©ia dos problemas que programadores gr√°ficos, artistas e designers de n√≠vel est√£o tentando combinar com gr√°ficos de alta qualidade e alta velocidade. </font><font style="vertical-align: inherit;">Nos consoles, essa equa√ß√£o √© um pouco mais f√°cil de resolver do que no PC, porque o equipamento √© constante.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na parte anterior, eu disse que falarei sobre por que √© muito dif√≠cil implementar corretamente reflex√µes e outras coisas semelhantes. O motivo √© bem simples: as reservas de produtividade e recursos de que falo constantemente n√£o mudam, dependendo de voc√™ refletir ou n√£o. Se voc√™ quiser criar uma reflex√£o que possa exibir novamente toda a cena, precisar√° refazer todo o trabalho que eu falei. Al√©m disso, as reflex√µes dependem muito do √¢ngulo em que as olhamos; portanto, para obter reflex√µes precisas para cada objeto refletido, elas devem ser suas!</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso pode sair do controle muito rapidamente e, geralmente, jogos nos quais h√° reflex√µes permitem certas liberdades ou suposi√ß√µes. Os jogos raramente criam reflexos em ambientes complexos, o m√°ximo que pode ser √© um espelho no banheiro, onde n√£o h√° tantos objetos, a complexidade da cena √© pequena e, portanto, voc√™ pode arcar com despesas extras. Talvez os verdadeiros reflexos no jogo estejam apenas em superf√≠cies irregulares ou onduladas da √°gua, de modo que mesmo uma cena muito √°spera e pouco detalhada seja suficiente para criar reflexos convincentes.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geralmente √© dif√≠cil evitar completamente superf√≠cies refletivas, e √© por isso que os jogos usam imagens pr√©-renderizadas do ambiente imediato, o que resulta em um resultado "razoavelmente bom". Mas eles n√£o s√£o minuciosamente escrutinados e, se voc√™ observar atentamente as reflex√µes, ver√° que isso √© uma imita√ß√£o. Existem t√©cnicas modernas que ajudam a criar reflex√µes em determinadas condi√ß√µes, e talvez mais tarde eu fale sobre elas, mas essas imagens pr√©-renderizadas ("pr√©-renderizadas") ainda s√£o necess√°rias.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/06c/9bd/b94/06c9bdb94b41c1a83b7d574cdf90f449.jpg"></div><br> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essa imagem renderizada √© chamada de "mapa de cubo". N√£o √© totalmente preciso em rela√ß√£o ao local onde Aiden est√°, mas est√° perto o suficiente dele.</font></font></em> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Watch Dogs processa reflex√µes em tempo real. N√£o investiguei esse assunto em detalhes, mas acredito que eles sempre s√£o exibidos quando o personagem est√° na rua e s√£o usados ‚Äã‚Äãprincipalmente para obter suas reflex√µes exatas sobre o carro em que ele est√° sentado, para melhorar a imagem e dar a ele um leve senso de realidade. . Como o jogador est√° sempre focado no carro e no ambiente imediato, o fato de refletir incorretamente em outros carros √© quase impercept√≠vel.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existem muitas aproxima√ß√µes dispon√≠veis para acelerar a renderiza√ß√£o dessas reflex√µes. Por exemplo, muito menos objetos s√£o renderizados na reflex√£o do que na cena real - cerca de 350 no total - e muitos deles s√£o muito simplificados em compara√ß√£o com as vers√µes completas. Suspeito que objetos complexos, como pessoas, sejam completamente descartados, independentemente da dist√¢ncia, mas n√£o testei essa teoria. Al√©m disso, n√£o h√° sombras nesses objetos e a ilumina√ß√£o √© muito simples - apenas a que vem do sol e do c√©u. Os reflexos s√£o renderizados a partir do solo como em uma lente ‚Äúolho de peixe‚Äù, ou seja, os reflexos da pr√≥pria terra s√£o imposs√≠veis, e o que est√° ao lado tem detalhes muito baixos.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas, mesmo com todas essas simplifica√ß√µes, as reflex√µes lidam apenas com o que se pretendia. </font><font style="vertical-align: inherit;">Se voc√™ dirige por baixo dos trilhos, pode obter o reflexo certo com uma vis√£o sobre o carro, o que, na pr√°tica, n√£o funcionaria. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta decis√£o foi intencional e n√£o f√°cil de tomar. </font><font style="vertical-align: inherit;">O estoque √© um valor constante; portanto, se voc√™ deixar espa√ßo para essas reflex√µes, precisar√° sacrificar outra coisa.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ab1/cda/fcd/ab1cdafcde2ca5c15111ca30f5b6bb5f.jpg"></div><br> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui est√° uma vis√£o muito "desconfiada" da cena em torno de Aiden com uma vista inferior, feita para reflex√µes. </font><font style="vertical-align: inherit;">Voc√™ pode navegar pelas duas luzes e trilhos do trem.</font></font></em> <br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√° outra parte do trabalho que quero mencionar aqui - sombras. Mais tarde, pretendo falar sobre como as sombras funcionam, porque esse √© um t√≥pico interessante, mas agora o mais importante √© lembrar que as sombras s√£o muito semelhantes √†s reflex√µes. Cada fonte de luz que projeta uma sombra deve renderizar uma imagem de cena do seu ponto de vista. Desta vez, n√£o h√° muitas maneiras de simplificar o trabalho - para o c√°lculo correto das sombras, cada fonte de luz </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ter essa imagem.</font></font><br><br><blockquote><h4>  Nota </h4><br>      ,    .           ,      ¬´¬ª  ,             .         ,  ,        . </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A fonte mais √≥bvia e significativa de ilumina√ß√£o que d√° sombra √© o sol (ou a lua, se a coisa acontecer √† noite). </font><font style="vertical-align: inherit;">Como o sol √© imenso, geralmente s√£o renderizadas de 3 a 5 imagens, e n√£o uma, como no caso de far√≥is ou lanterna. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infelizmente, este √© um dos casos em que o Watch Dogs n√£o pode servir como um bom exemplo. </font><font style="vertical-align: inherit;">O c√°lculo das sombras no jogo √© bastante complicado e, ao que me parece, √© especialmente otimizado para o caso de projetar sombras na cidade. </font><font style="vertical-align: inherit;">Portanto, √© melhor mudar para Far Cry 4 e considerar o c√°lculo das sombras no exemplo de um quadro deste jogo.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/21c/4a4/ae6/21c4a4ae665924ba44245b8e18249f8b.jpg"></div><br> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui est√° uma cena do Far Cry 4 que estou usando como exemplo.</font></font></em> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ae/502/26c/7ae50226c3cc0c40c916c58f26ba27f3.jpg"></div><br>  <em>Aqui est√° uma imagem com informa√ß√µes sobre as sombras dessa cena - cada uma delas requer uma renderiza√ß√£o completamente nova da cena.</em> <br><br>  Portanto, quando precisarmos adicionar proje√ß√£o de sombra √† fonte de luz, teremos que renderizar a cena mais uma vez.  Aqui, voc√™ tamb√©m pode usar algumas das aproxima√ß√µes usadas no caso de reflex√µes, apenas elas s√£o muito menores.  Voc√™ pode pular objetos pequenos ou distantes, mas lembre-se de que esses objetos n√£o parecer√£o projetar sombras.  Voc√™ pode renderizar a imagem muito pequena, mas as sombras ficar√£o granuladas e com poucos detalhes.  Geralmente, n√£o √© poss√≠vel usar uma vers√£o muito simplificada do objeto, porque parece que o objeto lan√ßa uma sombra sobre si mesmo ou aparecem lacunas entre o objeto e sua sombra. <br><br>  Outra consequ√™ncia que √© muito f√°cil de perder √© a necessidade de criar imagens sombreadas para cada fonte de luz.  Em muitos casos, √© poss√≠vel simplificar as fontes de ilumina√ß√£o combinando-as - no Watch Dogs isso acontece com os far√≥is dos carros. <br><br>  Quando as duas luzes est√£o acesas, apenas uma fonte de luz √© desenhada, mas possui uma forma especial, por causa da qual se parece com dois raios.  Se os far√≥is tiverem sombras, isso n√£o √© f√°cil, e ser√° muito mais not√°vel - quando o jogador passa na frente do carro, a luz vir√° de algum lugar entre os dois far√≥is.  Talvez voc√™ precise separar os far√≥is, mas, ao mesmo tempo, n√£o apenas haver√° custos adicionais para calcular as sombras, mas tamb√©m precisar√° desenhar uma nova ilumina√ß√£o. <br><br><hr><br>  A principal coisa que eu queria enfatizar com tudo isso era compromisso.  Certamente podemos nos livrar de todas essas aproxima√ß√µes, mas teremos que gastar nossas reservas de recursos nisso, ou seja, sacrificar outra coisa.  Cada desenvolvedor de jogos deve decidir o que √© importante para ele se concentrar no jogo e o que mais impressionar√° ou incomodar√° o jogador. <br><br><h2>  Parte 4. Movendo os picos </h2><br>  Nesta parte, falarei mais sobre os detalhes t√©cnicos da anima√ß√£o de objetos na cena. <br><br>  Programadores gr√°ficos frequentemente falam sobre o "pipeline gr√°fico".  Os gr√°ficos 3D s√£o um pouco como uma linha de montagem com um movimento claramente definido de um est√°gio para outro, mas n√£o funcionam apenas com um objeto por vez. <br><br>  Todas as placas gr√°ficas modernas possuem aproximadamente a mesma correia transportadora, possuem equipamento e software especiais que s√£o diretamente ‚Äúsilicados‚Äù para maximizar a velocidade do transportador.  Obviamente, existem muitas varia√ß√µes entre diferentes fabricantes e fam√≠lias de placas gr√°ficas, mas geralmente n√£o precisamos nos preocupar com <em>como</em> elas funcionam nesse n√≠vel. <br><br><blockquote><h4>  Nota </h4><br>  Se voc√™ estiver interessado em saber como tudo funciona em um n√≠vel de hardware abstrato, recomendo uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">s√©rie de artigos de Fabian Giesen no pipeline de gr√°ficos</a> .  Esta s√©rie de artigos √© <em>muito</em> mais detalhada e requer muito mais entendimento do que meu post. </blockquote><br>  Vou pular muitos detalhes para explicar princ√≠pios interessantes e importantes.  Nesta parte, veremos a primeira parte do pipeline, chamada de <strong>Vertex Shader</strong> . <br><br>  Os shaders se espalharam h√° cerca de 16 anos, ap√≥s o lan√ßamento do DirectX 9, no qual os shaders de v√©rtice e pixel apareceram.  Para explicar o que s√£o shaders e compar√°-los com o que costumavam ser, falarei sobre o trabalho que eles fazem. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/357/03d/382/35703d382d727d1e395283a4fb3aae33.jpg"></div><br>  <em>A cabe√ßa esquel√©tica de Aiden est√° conosco novamente.</em> <br><br>  Deixe-me lembr√°-lo que, na parte 2, examinamos os modelos a partir dos quais o mundo do jogo √© criado.  Esses padr√µes s√£o compostos de pontos individuais chamados v√©rtices, conectados em tri√¢ngulos.  Eu disse que falarei mais sobre eles mais tarde e agora cumpro minha promessa. <br><br>  Como tudo no mundo do jogo consiste em v√©rtices, tudo o que precisa ser feito com esses modelos deve ser realizado com v√©rtices.  Quando se trata da placa de v√≠deo, tudo o que v√™ √© uma longa lista de v√©rtices.  Para ela, n√£o existem coisas como anima√ß√µes em execu√ß√£o, folhas balan√ßantes de √°rvores ou quaisquer outros conceitos abstratos. <br><br>  Vejamos um exemplo simples do que temos que fazer - mover e posicionar objetos no mundo.  Para come√ßar, vamos considerar um caso simples, n√£o um personagem. <br><br>  Ao criar objetos em editores 3D como Maya e 3D Studio Max, os artistas sempre constroem em seu pr√≥prio mundo separado.  Esses objetos n√£o s√£o criados imediatamente na comitiva de Chicago; seus arredores parecem uma "sala branca vazia" da Matrix.  Cada objeto est√° localizado no centro do vazio absoluto. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bd0/a55/a3c/bd0a55a3c96f5fefc237bdf22194e009.png"></div><br>  <em>Aqui est√° um sem√°foro no jogo em algum lugar sob os trilhos, e ele est√° localizado em seu pr√≥prio mundo.</em> <br><br>  Ao salvar em disco, o modelo n√£o faz ideia de onde estar√° no mundo e quando ser√° baixado e transferido para a placa gr√°fica.  Isso significa que, quando chega a hora de desenhar objetos, precisamos mov√™-lo de nosso pr√≥prio mundo para a cena que desenhamos.  Isso acontece com todos os objetos desenhados, e mesmo objetos im√≥veis como edif√≠cios e pontes tamb√©m se movem do pr√≥prio mundo para a cena em cada quadro. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d65/21d/673/d6521d67344753566d0d2b4ff3b4fbf9.png"></div><br>  <em>Aqui vemos v√°rios sem√°foros j√° colocados em uma cena final parcialmente constru√≠da.</em> <br><br>  Como mencionei acima, as √∫nicas coisas com as quais podemos trabalhar s√£o os picos.  N√£o podemos dizer apenas para a placa gr√°fica: "Voc√™ pode colocar esse sem√°foro embaixo da ponte?  E depois colocar outro um pouco mais?  √ìtimo! <br><br>  Portanto, em vez de dizer √† placa gr√°fica o que ela precisa fazer com o pr√≥prio objeto, precisamos dizer o que fazer com todos os seus v√©rtices.  Acontece que, neste caso, tudo se torna muito simples.  Se mudarmos todos os v√©rtices exatamente da mesma maneira e eles permanecerem im√≥veis em rela√ß√£o um ao outro, isso √© semelhante a mover um objeto como um todo.  Tudo o que precisamos fazer √© descobrir o que "mudan√ßa" √© chamado de transforma√ß√£o. <br><br><blockquote><h4>  Nota </h4><br>  Os c√°lculos matem√°ticos de tudo isso n√£o s√£o particularmente complicados, mas est√£o al√©m do escopo do artigo.  Se voc√™ j√° estudou √°lgebra linear, provavelmente sabe tudo o que precisa - basicamente tudo se resume √† multiplica√ß√£o matricial de vetores. </blockquote><br>  Antes do aparecimento dos shaders de v√©rtice, as op√ß√µes poss√≠veis para transformar v√©rtices na placa de v√≠deo eram muito limitadas.  Havia objetos em movimento e em rota√ß√£o, al√©m de outras opera√ß√µes, mas nada particularmente redundante ou complicado. <br><br>  Os vertex shaders s√£o pequenos programas de computador que s√£o executados em uma placa gr√°fica.  Eles pegam um v√©rtice, executam <em>as a√ß√µes necess√°rias</em> e emitem um v√©rtice de sa√≠da.  Eles podem n√£o apenas mov√™-lo, mas tamb√©m faz√™-los pular para cima e para baixo, afastar-se do pico mais pr√≥ximo, balan√ßar dependendo do vento, ser animados e muito mais. <br><br>  Peguei um dos shaders de v√©rtice usados ‚Äã‚Äãno Watch Dogs e experimentei um pouco para mostrar o que ele faz.  Este √© um trabalho minucioso, mas consegui encontrar o shader de v√©rtice usado para os personagens e alter√°-lo.  H√° outro sombreador de v√©rtice usado para a pele, por exemplo, para rostos e m√£os, mas voc√™ entender√° rapidamente o princ√≠pio. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed//Wqyv7B8/embed?ref=https" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <em>Fiz uma altera√ß√£o muito simples que adiciona uma curva ao modelo de personagem, mas todo o resto √© usado como de costume.</em> <br><br>  A anima√ß√£o acima mostra que os personagens est√£o de alguma forma estranhamente distorcidos.  Isso nos leva de volta ao princ√≠pio "se voc√™ mover cada v√©rtice, ser√° semelhante a mover o objeto inteiro".  A altera√ß√£o feita no sombreador de v√©rtice funciona apenas para um v√©rtice de cada vez, mas como todos funcionam com a mesma distor√ß√£o, o efeito √© aplicado a todo o objeto. <br><br>  Voc√™ tamb√©m pode fazer altera√ß√µes na parte da transforma√ß√£o, respons√°vel por ‚Äúsimplesmente se mudar para o lugar‚Äù, de modo que, em vez de colocar o personagem no lugar certo, ela o levante acima do solo.  Isso n√£o √© simulado com a ajuda da f√≠sica, portanto, n√£o tem nada a ver com a gravidade ou colis√µes com outros objetos - se quisermos, podemos fazer com que todos voem no ar. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed//tktCaw4/embed?ref=https" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <em>Nesta anima√ß√£o, fizemos o sombreador de v√©rtice aumentar e diminuir gradualmente o objeto.</em> <br><br>  Obviamente, tudo isso n√£o √© muito construtivo, mas nos d√° uma id√©ia geral de como os shaders de v√©rtice funcionam - se agora quis√©ssemos animar as folhas das √°rvores para que elas balan√ßassem, far√≠amos o mesmo.  Somente em vez de levantar e abaixar eles balan√ßariam na dire√ß√£o do vento.  Ent√£o podemos mudar a for√ßa do vento para que as √°rvores balan√ßem mais ou menos. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed//5Sl1uhw/embed?ref=https" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <em>Aqui vemos o que acontece quando tudo aumenta cerca de sete vezes.</em> <br><br>  Simplifico um pouco, mas basicamente a tarefa da maioria dos shaders de v√©rtice √© "mover objetos no lugar".  A exce√ß√£o s√£o todos os objetos animados - pessoas, animais e objetos como cordas balan√ßando, roupas esvoa√ßantes etc. <br><br><hr><br>  Animar as pessoas est√° ligado √† id√©ia de usar um esqueleto e uma "pele".  Um esqueleto √© uma descri√ß√£o simples de um personagem em movimento.  Nesta fase, n√£o estamos preocupados com fivelas, chap√©us ou jeans que n√£o s√£o animados - apenas movimentos importantes que s√£o mais apropriados para o esqueleto humano s√£o importantes para n√≥s. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f0f/bf2/ce7/f0fbf2ce7c1a0d3d287f8cc4b04b41f2.png"></div><br>  <em>Um esqueleto simples de uma figura humana √© mostrado aqui.</em>  <em>N√£o foi tirado do Watch Dogs, porque √© dif√≠cil visualizar o esqueleto fora do editor 3D.</em> <br><br>  <em>Imagem licenciada pela <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Atribui√ß√£o-Compartilhamento pela mesma licen√ßa CC BY-SA</a> ¬© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">equipe MakeHuman</a> 2001-2014</em> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed//nXYWZOr/embed?ref=https" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <em>Essa √© uma pose instant√¢nea ou pose em T que demonstra a apar√™ncia de um personagem sem usar anima√ß√µes.</em> <br><br>  As anima√ß√µes - correr, andar, pular - se aplicam apenas a esse esqueleto.  Isso torna todo o processo muito simples, porque precisamos considerar apenas cerca de cem ossos em vez de milhares e milhares de v√©rtices. <br><br>  Depois de criar o esqueleto, cada v√©rtice √© anexado a um ou mais ossos nessa pose est√°tica, e essa conex√£o √© chamada de "esfola".  Na √©poca do Half-Life 1, quando essa tecnologia come√ßou a ser usada, cada v√©rtice se associava a apenas um osso.  Atualmente, eles podem unir quatro ossos, enquanto cada osso recebe peso, do qual depende o grau de influ√™ncia do osso no √°pice.  Gra√ßas a isso, voc√™ pode obter uma anima√ß√£o mais suave, permitindo que os ossos se cruzem em diferentes √°reas sem criar √¢ngulos agudos ao mover bra√ßos ou pernas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7e5/af5/e31/7e5af5e314bf44d7f9098941be6eacbc.png"></div><br>  <em>Este √© o esqueleto mostrado acima com o osso da coxa virado.</em>  <em>As cores mostram o peso do osso do quadril em rela√ß√£o √†s partes superiores do modelo.</em> <br><br>  <em>Imagem licenciada pela <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Atribui√ß√£o-Compartilhamento pela mesma licen√ßa CC BY-SA</a> ¬© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">equipe MakeHuman</a> 2001-2014</em> <br><br>  Essa tecnologia tem suas limita√ß√µes, especialmente em locais onde roupas e pele s√£o comprimidas ou esticadas em dobradi√ßas, por exemplo, nos cotovelos e ombros.  Esta √© uma maneira imperfeita, mas muito eficaz de animar.  A limita√ß√£o mais s√©ria √© que √© muito dif√≠cil criar anima√ß√µes de rosto atraentes dessa maneira.  Voc√™ pode criar muitos ossos "falsos" no rosto, por exemplo, nas sobrancelhas e ao redor da boca, mas isso ser√° apenas uma aproxima√ß√£o aproximada dos m√∫sculos e da pele. <br><br>  Outra caracter√≠stica importante dessa t√©cnica √© que a compara√ß√£o de v√©rtices e ossos √© muito espec√≠fica e est√° relacionada √† forma como essa compara√ß√£o √© realizada.  √â poss√≠vel usar anima√ß√µes para v√°rios modelos diferentes, mas cada modelo individual no qual voc√™ deseja usar o esqueleto deve estar associado aos ossos.  O motivo √© que as anima√ß√µes movem os v√©rtices de sua posi√ß√£o original em rela√ß√£o aos seus esqueletos.  Se os v√©rtices n√£o estiverem nas posi√ß√µes esperadas, surgir√£o problemas. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed//JdJEwEW/embed?ref=https" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <em>Se o modelo n√£o corresponder ao esqueleto usado por ela, as anima√ß√µes estar√£o <u>completamente</u> incorretas.</em> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed//Wt5PSQY/embed?ref=https" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <em>Se tornarmos o personagem duas vezes mais largo, obteremos um efeito semelhante aos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"donuts excessivos" de Drake</a> , mas √© percept√≠vel que as anima√ß√µes mais pr√≥ximas aos pinc√©is se tornam incorretas, porque √© aqui que elas est√£o mais afastadas de suas posi√ß√µes originais.</em> <br><br>  A primeira anima√ß√£o pode parecer estranha para voc√™ - essas anima√ß√µes de falha ocorrem nos jogos com muita frequ√™ncia.  Geralmente, elas s√£o causadas pelo fato de anima√ß√µes incorretas serem aplicadas ao esqueleto ou pelo modelo usar o esqueleto errado.  Como no caso de texturas e modelos, o esqueleto, a apar√™ncia e o modelo devem ser comparados com muito cuidado, caso contr√°rio, os resultados rapidamente se tornar√£o tristes. <br><br>  Espero que voc√™ tenha uma id√©ia do objetivo dos shaders de v√©rtice e entenda como as anima√ß√µes s√£o usadas para transformar um modelo est√°tico em um personagem vivo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt430930/">https://habr.com/ru/post/pt430930/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt430918/index.html">Sobre o Flutter, em resumo: No√ß√µes b√°sicas</a></li>
<li><a href="../pt430922/index.html">Exemplo de c√°lculo para quadro de distribui√ß√£o</a></li>
<li><a href="../pt430924/index.html">Programa√ß√£o Ada</a></li>
<li><a href="../pt430926/index.html">O tempo √© fragmentado; um pouco sobre a semelhan√ßa de sistemas distribu√≠dos e um modelo de mem√≥ria fraca</a></li>
<li><a href="../pt430928/index.html">Apenas sobre a "casa inteligente": como criar uma luz de fundo "inteligente"</a></li>
<li><a href="../pt430932/index.html">Hackers roubaram mais de 21 milh√µes de rublos de um banco russo</a></li>
<li><a href="../pt430934/index.html">Asterisk dialplan extension mask generator</a></li>
<li><a href="../pt430936/index.html">DEFCON 21. A confer√™ncia DNS pode ser perigosa para sua sa√∫de. Parte 2</a></li>
<li><a href="../pt430938/index.html">Como obter os primeiros pedidos em design quando n√£o h√° portf√≥lio e experi√™ncia</a></li>
<li><a href="../pt430940/index.html">SDK para voc√™, SDK para mim, SDK para todos! Como criar um SDK e por que √© necess√°rio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>