<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò• üî° üë®üèΩ‚Äçüíª Nochmals zu Voronoi-Diagrammen üçã üé¥ üôä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wie in den letzten Blog- Beitr√§gen geschrieben , hatte ich Probleme, in meinem Dragons Abound- Spiel die richtigen Details zur K√ºste zu finden. Meine ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nochmals zu Voronoi-Diagrammen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439224/">  Wie in den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">letzten</a> Blog- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beitr√§gen geschrieben</a> , hatte ich <b>Probleme,</b> in meinem <b>Dragons Abound-</b> Spiel die richtigen Details zur K√ºste zu finden.  Meine Entt√§uschung trat bei der Umsetzung der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Barriereinseln auf</a> .  Um eine m√∂glichst schmale Insel zu schaffen, habe ich sie einen Ort breit gemacht - in der folgenden Abbildung ist jeder Ort ein Delaunay-Dreieck: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5dc/cce/739/5dccce739bdcd3372876b7cff72b4f0e.png"></div><br>  Das war ziemlich unangenehm - sowohl weil die Insel sehr kaputt war als auch weil die Teile zu gro√ü waren.  Es schien, dass mit einer starken Zunahme der Anzahl der Delaunay-Dreiecke (dh mit einer starken Abnahme ihrer Gr√∂√üe) dieses Problem gel√∂st werden w√ºrde - aber die Dichte der ben√∂tigten Dreiecke f√ºhrte zu einem Browserabsturz. <br><a name="habracut"></a><br>  Ich habe dieses Problem gel√∂st, indem ich die Konturen des Landes von der internen Darstellung der Orte getrennt habe.  Dadurch konnte ich Inseln jeder Gr√∂√üe und Form zeichnen, unabh√§ngig vom zugrunde liegenden Standortraster: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b2e/8a2/351/b2e8a235144cb7c07c9d374980be1782.png"></div><br>  Damit ist das Problem gel√∂st!  Dadurch konnte ich die Barriereinseln zeichnen, und da die K√ºstenlinie nicht mehr dem Grundraster folgen muss, konnte bei Bedarf auf die √ºbliche Weise eine detailliertere K√ºstenlinie erstellt und anschlie√üend Details hinzugef√ºgt werden. <br><br>  Aber ... wie f√ºgen wir der K√ºste Details hinzu?  Es ist nicht so einfach, wie Sie vielleicht denken.  Da ich eine fraktale K√ºste erstellen wollte, habe ich √ºberlegt, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fraktale zu verwenden,</a> um der K√ºste <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Details hinzuzuf√ºgen</a> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5b3/f94/9fd/5b3f949fd2649767029f2768d55a8185.png"></div><br>  Nachdem ich mit den Einstellungen experimentiert hatte, konnte ich der K√ºste viele Details und interessante Dinge hinzuf√ºgen.  Das System konnte jedoch keine √§hnliche Karte erstellen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ed/03d/701/0ed03d701f34074236f314574162073f.png"></div><br>  Perlin-Rauschen <i>kann</i> diese Art von Gel√§nde erzeugen, wenn ein ausreichend detailliertes Basisgitter vorhanden ist. Kann dies jedoch durchgef√ºhrt werden, <i>ohne</i> die H√∂henh√∂hen im Basisgitter mit der gew√ºnschten Aufl√∂sung <i>zu</i> speichern (schlie√ülich wei√ü ich, dass dies meinen Code besch√§digen wird)?  Bis ich herausgefunden habe, wie es geht.  Die K√ºstenlinie ist im Wesentlichen ein Pfad durch alle Punkte, an denen die Perlin-Rauschfunktion einen Nullwert hat.  Obwohl wir den Wert an einer bestimmten Stelle (X, Y) direkt von der Perlin-Rauschfunktion lernen k√∂nnen, k√∂nnen wir nicht "alle Stellen finden, an denen die Funktion einen Nullwert hat".  Das hei√üt, es ist schwierig zu erkennen, wie eine H√∂henkontur ohne ein Grundgitter gezeichnet werden kann. <br><br>  Schlimmer noch, ich fragte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Amit,</a> wie das geht, und er wusste auch nicht die Antwort.  Es ist eine Sache, wenn ich das nicht sagen kann, aber wenn selbst solch ein intelligenter Mensch keine Antwort geben kann, beginne ich zu denken, dass dies nicht m√∂glich ist.  Es ist traurig.  Ich kann der K√ºste jede Form geben, die ich brauche, aber ohne ein sehr detailliertes Grundraster kann ich nicht die Formen bekommen, die ich brauche. <br><br>  Wie erhalte ich ein hochaufl√∂sendes Raster, ohne den Code zu besch√§digen? <br><br>  Eine der L√∂sungen, die mir in den Sinn kamen, erinnert mich an das, was <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Azgaar</a> in seinem Kartengenerator <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">getan hat</a> - Voronoi-Zellen mit variabler Gr√∂√üe.  Die Hauptidee besteht darin, die Dichte (und die Gr√∂√üe) des Grundnetzes entlang der K√ºsten zu erh√∂hen und eine geringere Dichte in den Ozeanen und anderen Gebieten beizubehalten, die keine Details erfordern.  Mit dieser Option habe ich viele Netzzellen nur in Bereichen, in denen Sie Details ben√∂tigen.  Diese √Ñnderung wird in <b>Dragons Abound</b> ziemlich schwierig zu implementieren sein, aber ich m√∂chte dar√ºber nachdenken.  Auf der anderen Seite war Azgaar selbst <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">mit diesem Ansatz nicht sehr zufrieden</a> , daher muss dies ebenfalls ber√ºcksichtigt werden. <br><br>  Parallel dazu wollte ich die Ursachen eines Browserabsturzes bei der Verarbeitung eines Haufen Dreiecke untersuchen.  Die Entwicklertools in Chrome lieferten mir detaillierte Leistungsinformationen.  Ich bin kein Experte f√ºr die Verwendung dieser Tools, aber viele Funktionen sind so einfach, dass jeder sie verstehen kann.  Wenn Sie die Gesamtmenge des im Programm verwendeten Speichers ermitteln m√∂chten, enth√§lt die Registerkarte Speicher Informationen zur aktuell verwendeten Kapazit√§t: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ccd/da9/c31/ccdda9c31c29814b1ffa88b0ae5eefce.png"></div><br>  In diesem Fall habe ich die Azgaar-Webseite ge√∂ffnet und sie beansprucht bescheidene 20 MB Speicher.  Mit diesem Tool k√∂nnen Sie herausfinden, wie viel Speicher <b>Dragons Abound</b> belegt, und feststellen, wann die Registerkarte abst√ºrzt. <br><br>  Der grundlegende Parameter, der die Aufl√∂sung des zugrunde liegenden Netzes in <b>Dragons Abound</b> steuert, <b>hei√üt</b> geschickt ‚Äûnpts‚Äú (Anzahl der Punkte).  F√ºr jede Einheitsfl√§che der Karte (Karten von Regionen, die ich normalerweise als Beispiele verwende, haben eine Fl√§che von 1 Einheit) <b>Dragons Abound</b> erstellt eine bestimmte Anzahl von Positionen des Basisgitters.  Normalerweise verwende ich 16K (16384) f√ºr npts, was bedeutet, dass jede Rasterposition ungef√§hr 70 quadratischen Pixeln des Bildschirms bei einer Standard-Zoomskala entspricht. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/73d/0a7/6ca/73d0a76ca2e25bf5c5724ef2c446b25c.png"></div><br>  Nat√ºrlich h√§ngt die genaue Gr√∂√üe des verwendeten Speichers von der Karte ab, aber f√ºr die oben gezeigte Karte mit 16K-Punkten ben√∂tigen Sie ungef√§hr 92 MB: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/82e/f8f/8c2/82ef8f8c28678bfb47a7a642761fe11e.png"></div><br>  Dies ist weniger als ich erwartet hatte und, um ehrlich zu sein, eine ziemlich bescheidene Zahl. <br><br>  Wenn Sie die Anzahl der Punkte im Basisraster verdoppeln, erh√∂ht sich die Speicherkapazit√§t auf 138 MB: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/40d/beb/ad7/40dbebad7c52e1e833fef7372ac7d1d9.png"></div><br>  Die Gr√∂√üe des belegten Speichers hat sich nicht verdoppelt, da ein Teil dieses Speichers von Ressourcen und anderen Datenstrukturen belegt ist, deren Gr√∂√üe sich nicht ge√§ndert hat.  16K zus√§tzliche Punkte "wiegen" ungef√§hr 50 MB Speicher, das hei√üt, jeder Punkt belegt ungef√§hr 3 KB Speicher.  Dies ist mehr als ich erwartet hatte, aber im Allgemeinen ist die Lautst√§rke immer noch recht bescheiden.  Auf einem Computer mit 64 GB Speicher sind 150 MB kaum wahrnehmbar. <br><br>  Nachdem ich noch ein paar Doppel gemacht hatte, stellte ich fest, dass der Tab mit <b>Dragons Abound</b> normalerweise an ungef√§hr 128K Punkten abst√ºrzt.  Wenn wir es fangen, bevor es herausfliegt, und den Speicher √ºberpr√ºfen, sehen wir Folgendes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/718/c57/d27/718c57d27a1bce96fa73943e53196b9a.png"></div><br>  Ich nahm an, dass die Registerkarte aufgrund des belegten Speichers abst√ºrzt, aber normalerweise liegt das Problem nicht im Speicher.  Warum st√ºrzt die Registerkarte ab?  Der einzige Hinweis ist, dass die Registerkarte nicht abst√ºrzt, bevor die Karte fertig ist. Dies ist wahrscheinlich ein Hinweis darauf, dass beim Rendern ein Absturz auftritt. <br><br>  Es ist logisch anzunehmen, dass das von mir erstellte SVG den Browser-Renderer aufgrund seiner Gr√∂√üe oder Komplexit√§t √ºberlastet.  Zun√§chst kann ich herausfinden, wie viele SVG-Elemente ich erstelle.  In D3 kann ich die Gesamtzahl der SVG-Elemente <code>svg.selectAll('*').size()</code> die mit <code>svg.selectAll('*').size()</code> . <br><br>  Aus 16K-Punkten zu laufen und die Anzahl der SVG-Elemente zu √ºberpr√ºfen, zeigte mir Folgendes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/14a/d15/77d/14ad1577d0e1f61b29e76bc36f57961f.png"></div><br>  32K-Punkte haben 65457 Elemente und 128K-Punkte haben 258823. Jeder Punkt, der dem Basisraster hinzugef√ºgt wird, f√ºgt der Karte zwei Elemente hinzu.  Ich glaube, ich habe eine Quelle des Ungl√ºcks gefunden. <br><br>  Jeder Punkt im Basisraster f√ºgt SVG-Elemente hinzu, da <b>Dragons Abound</b> Land (und Wasser) <b>rendert</b> .  Land wird gerendert, indem jeder Basisort als gef√ºlltes Polygon gerendert und anschlie√üend alle verwischt werden.  Auf diese Weise k√∂nnen <b>Dragons Abound</b> dem Land ein sch√∂nes Muster geben oder die H√∂he des Landes verwenden, um das Land mit 3D-Schattierung zu rendern, wie hier gezeigt: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/294/b56/8c4/294b568c4939a297253b4fe4172eac0b.png"></div><br>  Sie k√∂nnen die Visualisierung von Land und Meer deaktivieren, um zu √ºberpr√ºfen, wie viele SVG-Elemente erstellt wurden.  Bei 256K Punkten: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad7/e09/1e6/ad7e091e6c4c6de42207734830d508af.png"></div><br>  Wow, die Anzahl der SVG-Elemente ist deutlich gesunken.  Wie ich gehofft habe, wird die Karte jetzt ohne Absturz gerendert!  Wenn Sie also vermeiden, ein Raster zum Rendern von Land und Wasser zu verwenden, k√∂nnen Sie ein viel dichteres Raster als zuvor erstellen. <br><br>  Jetzt, da ich ein viel dichteres Voronoi-Gitter habe, m√∂chte ich pr√ºfen, ob es mir erm√∂glicht, die ben√∂tigten Landentlastungselemente wie K√ºsteninseln zu erzeugen.  Das dichte Netz von Voronoi verursacht andere Probleme (insbesondere bei Fl√ºssen). Daher schalte ich alles au√üer den K√ºsten aus, um die Tests zu beschleunigen und mich auf sie zu konzentrieren.  Hier ist das Original-Rendering einiger K√ºstenlinien mit 256 KB Pixel und Standardrauschen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7c4/bad/0a0/7c4bad0a043f626a83d3edb071e5c77f.png"></div><br>  Es stellt sich heraus, dass die Karte gut rendert und bereits eine viel sch√∂nere K√ºste schafft. <br><br>  Auch ohne sorgf√§ltige Abstimmung ist das Ergebnis viel besser.  Der L√§rm erzeugt die Arten von fraktalen K√ºsten und K√ºsteninseln, die ich auf der Karte oben angegeben habe. <br><br>  Hier sind die Inseln mit einem Anstieg von 300%: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b70/32e/471/b7032e471d8ac9c0029781799a43af56.png"></div><br>  Mit dieser Erh√∂hung k√∂nnen Sie Artefakte von Dreiecken aus dem Basisgitter erkennen, aber dennoch k√∂nnen Inseln interessante Formen erzeugen.  Sie k√∂nnen Anti-Aliasing verwenden (wie ich es in der aktuellen Version von Karten tue), um einige der auff√§lligsten Artefakte von Dreiecken zu entfernen.  Bei Standardvergr√∂√üerung bietet dies eine weniger raue K√ºste, eliminiert jedoch auch einige kleine Details: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c6f/783/120/c6f78312049d55db06e1776250ce520a.png"></div><br>  Sie m√ºssen sich wahrscheinlich einstellen, um einen Mittelweg zu finden. <br><br>  Die meisten prozeduralen Sushi-Generatoren verwenden Perlin-Rauschen, um eine H√∂henkarte zu erstellen.  Wir m√ºssen die geeigneten Ger√§uschparameter finden, einen Startwert ausw√§hlen und dann den Ger√§uschwert an jedem Ort (x, y) verwenden, um die Landmasse festzulegen.  Ein praktischer Aspekt beim Erstellen von Land ist, dass Sie die Ger√§uschparameter einfach anpassen k√∂nnen, wenn Sie weitere Details zur K√ºste ben√∂tigen. <br><br>  <b>Dragons Abound</b> schafft jedoch kein Land auf diese Weise.  (Oder zumindest schafft es mehr als das.) <b>Dragons Abound</b> verwendet viele verschiedene Methoden, um Sushi zu kreieren.  Obwohl sie alle bis zu dem einen oder anderen Grad L√§rm verwenden, schaffen nur sehr wenige Land direkt aus L√§rm.  Das Spiel verf√ºgt beispielsweise √ºber ein Verfahren zum Erstellen einer Insel, bei dem eine Maske f√ºr die Insel erstellt wird (normalerweise eine Ellipse), Rauschen verwendet wird, um die Ellipse nat√ºrlicher zu gestalten, und dann ein anderes Rauschen angewendet wird, um die Maske ungef√§hr zu f√ºllen.  Jede bestimmte Karte wird normalerweise durch eine Kombination mehrerer verschiedener Verfahren erstellt.  Daher ist das Hinzuf√ºgen von Details durch Anpassen der Rauschparameter f√ºr <b>Dragons Abound</b> nicht sehr geeignet. <br><br>  F√ºr meine Zwecke ist es besser, das Problem aus einem etwas anderen Blickwinkel zu betrachten.  Wenn ich eine bestimmte H√∂henkarte habe, die Landmassen definiert, wie f√ºge ich dann Details zu den R√§ndern dieser Landmassen hinzu?  Dies k√∂nnte uns zu der Idee f√ºhren, dass wir die R√§nder von Landmassen erkennen und den Rest der Karte usw. maskieren m√ºssen.  Andererseits bin ich √ºberhaupt nicht dagegen, dem Rest der Karte zus√§tzliche Details hinzuzuf√ºgen.  Wenn das Land etwas unebener ist oder der Grund des Ozeans etwas rauer ist, ist dies normal. <br><br>  Was bedeutet das Hinzuf√ºgen von Details zur K√ºste?  Eine K√ºstenlinie ist einfach eine Konturlinie, in der eine H√∂henkarte den Wert Null hat.  (Der Wert ist willk√ºrlich, aber ein solches Prinzip wird in jedem prozeduralen Landgenerator verwendet.) Um diese Linie detaillierter zu gestalten, m√ºssen Sie das Land neben dieser Konturlinie leicht nach oben und unten verschieben, damit einfache K√ºsten komplexer werden und Teile des Landes in den Ozean hineinragen und werden Inseln und so weiter.  Dies sollte aber nicht zuf√§llig geschehen, ich m√∂chte, dass die √Ñnderungen nat√ºrlich erscheinen.  Wir fassen dies alles zusammen und es scheint, dass Sie der gesamten Karte ein wenig Rauschen hinzuf√ºgen m√ºssen.  Und genau das habe ich im oben gezeigten Originalbeispiel getan. <br><br>  Dies muss nat√ºrlich sorgf√§ltig geschehen, um die geschaffenen Landmassen nicht zu l√∂schen und andere Probleme zu verursachen.  Im Wesentlichen muss ich drei Parameter konfigurieren. <br><br>  Das erste ist die Skala des Rauschens.  Eine Skala ist einfach ein Werteintervall f√ºr dieses Rauschen.  In unserem Fall m√∂chte ich einige Bereiche senken und einige erh√∂hen, sodass der Wertebereich von negativ bis positiv reichen sollte.  Ich m√∂chte jedoch keine neuen Berge hinzuf√ºgen oder einen Ozean weit entfernt von der vorhandenen K√ºste schaffen, daher werde ich den maximalen (absoluten) Wert des L√§rms zu einem kleinen Bruchteil der Standardlandh√∂he machen. <br><br>  Der zweite Parameter ist die Hauptfrequenz des Rauschens.  Die Frequenz bestimmt, wie schnell sich das Rauschen innerhalb des Standorts √§ndert.  Niederfrequentes Rauschen √§ndert sich sehr langsam, sodass ein positiver Bereich mit niederfrequentem Rauschen (sagen wir) die gesamte Karte abdecken kann.  Hochfrequenzrauschen √§ndert sich schnell, so dass ein positiver Bereich mit Hochfrequenzrauschen (sagen wir) die Gr√∂√üe einer kleinen Insel haben kann.  In unserem Fall bestimmt die Hauptrauschfrequenz die gr√∂√üten Reliefelemente, die wir im Rauschen sehen werden.  Das hei√üt, wenn das Rauschen kleine Inseln (aber nichts Gr√∂√üeres als diese) zur Karte hinzuf√ºgen soll, muss ich die Hauptfrequenz in der Gr√∂√üe einer kleinen Insel ausw√§hlen. <br><br>  Sie k√∂nnten denken, dass dies einfach ist (messen Sie einfach eine kleine Insel und weisen Sie diese Gr√∂√üe der Hauptfrequenz zu).  Die Frequenz wird jedoch in den Koordinaten der Rauschfunktion gemessen, nicht in den Koordinaten der Karte!  Eine typische Rauschfunktion kann in jeder Koordinate ein Intervall von 0 bis 255 haben, und eine Karte kann in jeder Koordinate ein Intervall von -1 bis 1 haben. Schlimmer noch, die Rauschkoordinaten sind reduziert, und viele Benutzer, die Rauschen verwenden, erkennen dies nicht einmal.  Die √úbersetzung von einer Einheit in eine andere und die Bestimmung geeigneter Frequenzen ist verwirrend. Daher ist es normalerweise am einfachsten, nur mit Frequenzintervallen zu experimentieren und diejenige auszuw√§hlen, mit der die Kartenelemente mit der richtigen Gr√∂√üe erstellt werden. <br><br>  Der dritte Parameter ist die Anzahl der Oktaven des Rauschens.  Oktaven sind zus√§tzliche Rauschschichten.  Jede Schicht verdoppelt normalerweise die Frequenz und halbiert die Rauschskala.  Das hei√üt, jede neue Ebene f√ºgt Reliefelemente zweimal weniger als die vorherige Ebene hinzu, aber auch zweimal schw√§cher.  Das hei√üt, Sie m√ºssen die Anzahl der Oktaven ausw√§hlen, die die wenigsten Elemente ergeben, die wir ben√∂tigen. Dazu m√ºssen Sie m√∂glicherweise die Rauschskala anpassen, da sie in der h√∂chsten Oktave immer noch stark genug ist, um auf der Karte angezeigt zu werden.  Da ich dies absichtlich mache, um die K√ºsten sehr kompliziert zu machen, werde ich einige Oktaven L√§rm verwenden. <br><br>  Beginnen wir mit dem Setup.  Zu Beginn werde ich eine Beispielkarte ohne zus√§tzliches Rauschen erstellen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cf2/e89/ce9/cf2e89ce9f62d676f9659141be032e15.png"></div><br>  Offensichtlich ist dies eine langweilige K√ºste mit glatten Linien und nur ein paar gro√üen Inseln.  Hier ist die gleiche K√ºste mit dem urspr√ºnglichen Ger√§uschbeispiel: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/035/e88/a62/035e88a62f7f2a79fd41e573016bb3aa.png"></div><br>  Das Rauschen ver√§nderte die Form der Karte erheblich und verwandelte gro√üe Landfragmente in einen Ozean und umgekehrt.  Viele Inseln erschienen auch, auch weit ins Meer.  All dies deutet darauf hin, dass die Rauschskala zu gro√ü ist.  Die gr√∂√üten einzelnen Reliefelemente, die durch Rauschen hinzugef√ºgt werden, sollten die Gr√∂√üe der kleinen Inseln der Originalkarte sein.  Dies ist wahrscheinlich die maximale neue Gr√∂√üe der Elemente, was beweist, dass die Hauptfrequenz des Rauschens ungef√§hr richtig gew√§hlt ist.  Schlie√ülich erschienen viele kleine Details bis an die Grenzen der Anzeigegr√∂√üe, und dies zeigt, dass gen√ºgend Oktaven vorhanden sind.  (Die Anzahl der Oktaven kann jedoch h√∂her als erforderlich sein. Dies wirkt sich nicht auf das Erscheinungsbild der Karte aus, ist jedoch ineffizient.) Grunds√§tzlich m√ºssen Sie die Rauschskala anpassen. <br><br>  Das Einstellen des Ger√§usches ist eine ziemlich komplizierte Operation, da ich m√∂chte, dass dieses Ger√§usch haupts√§chlich Land und Wasser an einer Konturlinie mit einer H√∂he = 0 beeinflusst. Das hei√üt, ich ben√∂tige einen relativ kleinen Ma√üstab, aber es ist nicht klar, wie die richtige Zahl zu w√§hlen ist, weil In verschiedenen Karten variiert die H√∂henverteilung.  Die L√∂sung besteht darin, im Handumdrehen die richtige Skala zu finden.  Sie k√∂nnen alle absoluten Werte der H√∂hen auf der Karte nehmen, sie sortieren und den Grenzpunkt finden, der (sagen wir) 10% der Orte um Null ausw√§hlt.  Alle diese Stellen fallen in das Intervall (zum Beispiel) [-0,05, 0,05], und dann kann ich den Wert 0,05 verwenden, um die Skala des hinzugef√ºgten Rauschens zu bestimmen. <br><br>  (Ich schreibe "Definitionen", weil Sie aus verschiedenen Gr√ºnden nicht nur 0,05 verwenden k√∂nnen. Zuerst m√ºssen Sie Land in Wasser verwandeln und umgekehrt. Wenn Sie (sagen wir) 0,002 bis -0,05 hinzuf√ºgen, werden keine sichtbaren √Ñnderungen an der Karte vorgenommen. Das hei√üt, das Intervall sollte viel mehr als 0,05 betragen Wenn ich einen signifikanten Anteil von Orten mit einer H√∂he von -0,05 von Wasser in Land umwandeln m√∂chte, sind die Rauschfunktionen nicht <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gleichm√§√üig verteilt</a> , sodass die Rauschfunktion bei einer Skala von 0,05 niemals den Wert 0,05 zur√ºckgibt. In der Praxis besteht die Schwierigkeit darin Der Ma√üstab sollte viel gr√∂√üer sein  als die gr√∂√üten Werte, die wir oft genug sehen wollen.) <br><br>  Nachdem ich experimentiert hatte, fand ich einen Wert, der die K√ºsten komplexer macht, ohne sie wesentlich zu ver√§ndern, und auch eine kleine Anzahl von Inseln schafft: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3f9/2e5/19c/3f92e519c2370c7bbaa3338ef65a0944.png"></div><br>  Wie immer k√∂nnen diese Parameter im Spiel ein Intervall von Werten annehmen, sodass ich eine gro√üe Auswahl an Karten erhalten kann: von Karten mit ziemlich glatten K√ºsten bis zu Karten mit kaputten und komplexen Ufern.  Wenn ich das Programm die Werte ausw√§hlen lasse, erhalte ich das folgende Ergebnis: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/43f/275/649/43f2756497cf54b7f95aa6a8f9cd5618.png"></div><br>  Die K√ºsten sind glatter, aber es gibt immer noch den gr√∂√üten Teil der zus√§tzlichen Komplexit√§t des mittleren Ma√üstabs und eine ausreichende Anzahl neuer Inseln. <br><br>  Bei der Implementierung fraktaler K√ºsten erkannte ich die M√∂glichkeit, den Grad der Fraktalisierung mithilfe der Rauschfunktion zu steuern, sodass einige Gebiete glatte K√ºsten haben, w√§hrend andere komplexe haben.  Ich dachte, dass dies das Interesse der Karte stark erh√∂hen w√ºrde und weniger "generiert" aussehen w√ºrde, daher werde ich diese Funktion hier hinzuf√ºgen.  Die Idee ist ganz einfach: Bevor ich der Karte K√ºstenrauschen hinzuf√ºge, multipliziere ich es mit der Ausgabe der zweiten Rauschfunktion, die von Null bis 1 reicht. Wenn diese Funktion klein ist, werden den K√ºstenlinien kleine Details hinzugef√ºgt.  Wenn es nahe bei 1 liegt, werden zus√§tzliche Details vollst√§ndig hinzugef√ºgt.  Wenn ich den Ma√üstab der zweiten Rauschfunktion ausw√§hle, der sich langsam auf der Karte √§ndert, erhalte ich einige Gebiete mit komplexen K√ºstenlinien, einige mit einfachen und logischen √úberg√§ngen zwischen ihnen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/095/4a0/350/0954a03506ed074216606083654ceb08.png"></div><br>  Hier habe ich die K√ºstenparameter gro√ü gemacht, damit der Unterschied besser sichtbar wird.  Wir sehen wilde, zerkl√ºftete K√ºsten im Nordosten und glattere Str√§nde im Westen. <br><br>  Wir haben die Erzeugung der K√ºstenlinie erheblich verbessert, aber ich kann immer noch keine Karte mit so vielen Delaunay-Dreiecken vollst√§ndig erstellen.  Ich zeige nur Umrisskarten, weil viele andere Kartenelemente besch√§digt sind.  Es muss behoben werden. <br><br>  Der Rest des Programms funktioniert nicht so gut mit so vielen Delaunay-Dreiecken (mit aktuellen Einstellungen von 256 KB).  Das Hauptproblem ist, dass <b>Dragons Abound</b> Land und Wasser zeichnet, indem alle einzelnen Dreiecke gezeichnet werden, und so viele SVG-Elemente den Browser zum Absturz bringen.  Also musste ich das Sushi-Rendering komplett deaktivieren.  Es gibt wahrscheinlich einen Weg, um dieses Problem zu umgehen, aber so viele Dreiecke zu haben, schafft andere Probleme.  Beispielsweise m√ºssen einige Teile des Programms die gesamte Karte verarbeiten.  Jeder von ihnen wird an 256K-Standorten sechzehnmal langsamer als an 16K-Standorten.  Auch im Code gibt es Teile (zum Beispiel ein neues Niederschlagsmodell), die beim Arbeiten mit so vielen Dreiecken brechen.  Und durch die Erstellung eines so detaillierten Standortrasters gewinnen wir nichts - nach der Erstellung der K√ºste verbessert sich nichts durch die zus√§tzliche Komplexit√§t.  Obwohl ich das Programm √ºberpr√ºfen und die Bereiche reparieren konnte, in denen eine gro√üe Anzahl von Orten den Code verlangsamt oder zu stark bricht, scheint es daher einfacher zu sein, die Aufl√∂sung des Kartenrasters nach dem Erstellen von K√ºstenlinien zu verringern. <br><br>  Wie oben erw√§hnt, hat Azgaar bereits daran <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gearbeitet</a> , die Aufl√∂sung des der Karte zugrunde liegenden Voronoi-Gitters zu √§ndern.  Er erkannte die M√∂glichkeit, die Gitteraufl√∂sung im Generationsprozess im laufenden Betrieb zu √§ndern, dh er k√∂nnte (zum Beispiel) die Dichte der Standorte entlang der K√ºste erh√∂hen.  Eine lokale √Ñnderung der Dichte hat jedoch ihre Nachteile - insbesondere entstehen seltsame Dreiecke entlang der Grenze.  Azgaar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">schlug</a> sp√§ter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vor,</a> dass das System zu komplex und die M√ºhe nicht wert sei.  Azgaar wei√ü normalerweise, wovon er spricht, also werde ich sein Wort daf√ºr nehmen und nicht versuchen, das fertige Netz neu zu verpacken. <br><br>  Stattdessen habe ich ein zweites Raster mit der gew√ºnschten (niedrigeren) Aufl√∂sung erstellt und dann die H√∂henkarte in dieses neue Raster kopiert.  (Vergessen Sie nicht, dass <b>Dragons Abound die</b> K√ºsten jetzt getrennt vom Raster speichert, sodass sie nach ihrer <b>Erstellung</b> nicht mehr von der genauen Anpassung des Rasters abh√§ngen. Dies ist etwas kompliziert. Da das urspr√ºngliche Raster eine viel h√∂here Aufl√∂sung als das neue hat, befinden sich viele Stellen im Original Das Raster wird an einer Stelle im neuen Raster √ºberlagert. Jeder dieser Quellorte hat eine andere H√∂he auf der H√∂henkarte. Wie kann ich sie kopieren? Verwenden Sie den Durchschnitt oder die maximale (minimale) H√∂he. <br><br>  Zu Beginn w√§hle ich nur einen zuf√§lligen Ort aus, um zu sehen, ob das neue Raster mit dem Rest des Programms funktioniert: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d2/6c4/0d3/3d26c40d3b59d96dd54c98a550352dde.png"></div><br>  Alles lief √ºberraschend gut.  Ein kleiner Fehler tritt auf, wenn neue Standorte nicht ordnungsgem√§√ü als Land, K√ºste oder Wasser markiert sind. Nach dem L√∂sen dieses Problems funktionierte die Kartengenerierung jedoch einwandfrei.  Sie m√ºssen kleinere Fehler beseitigen (z. B. das Palmanor-Tag, das auf dem Wasser herauskam), aber insgesamt sieht es gut aus.  Sogar die winzigen Inseln waren wundersch√∂n. <br><br>  Am Ende entschied ich, dass mit einer Verringerung der Aufl√∂sung des Voronoi-Gitters jeder Standort der Durchschnitt der Basisstandorte sein w√ºrde.  Dies scheint eine kluge Entscheidung zu sein und kann bei Bedarf jederzeit ge√§ndert werden.  Dieses Bild zeigt, wie die K√ºstenlinien vom fertigen Netz getrennt wurden: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c40/859/805/c40859805e84a195276b4cbaeaaa0796.png"></div><br>  Zusammenfassend l√§sst sich <b>sagen</b> : In <b>Dragons Abound</b> wird beim Generieren der H√∂henkarte ein sehr hochaufl√∂sendes Delone-Dreiecksgitter verwendet.  Nach seiner Fertigstellung definiert <b>Dragons Abound</b> K√ºstenlinien, indem √úberg√§nge von negativen zu positiven Werten in der H√∂henkarte verfolgt werden.  Anschlie√üend kopiert das Spiel das hochaufl√∂sende Raster in ein Raster mit viel niedrigerer Aufl√∂sung und mittelt die Positionen, die in eine Position des neuen Rasters fallen.  Als n√§chstes wird das hochaufl√∂sende Raster verworfen, und der Rest der prozeduralen Generierung und Visualisierung wird auf dem niedrigaufl√∂senden Raster fortgesetzt.  Eine interessante Frage ist, ob die Verwendung des Delaunay-Netzes zu diesem Zeitpunkt von irgendeinem Wert ist.  Es k√∂nnte sich lohnen, in ein Sechseckraster oder √§hnliches zu kopieren. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de439224/">https://habr.com/ru/post/de439224/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de439210/index.html">Java nach Vulkanausbruch</a></li>
<li><a href="../de439216/index.html">Pudge 500 Zeilen einbettbare Datenbank auf Golang</a></li>
<li><a href="../de439218/index.html">VK Bot auf seinem Knie oder wie man Menschen am 14. Februar gef√§llt</a></li>
<li><a href="../de439220/index.html">Gro√üstadt f√ºr mobile Ger√§te auf Unity. Erfahrung in Entwicklung und Optimierung</a></li>
<li><a href="../de439222/index.html">Was ist API-Verwaltung?</a></li>
<li><a href="../de439226/index.html">Scala + MXNet = Microservice mit Neuron in Prod</a></li>
<li><a href="../de439232/index.html">JAMstack: So erstellen Sie Ihr eigenes Blog mit Gatsby + Contentful + Netlify</a></li>
<li><a href="../de439234/index.html">Das Leben von Open Source-Entwicklern in GIFs</a></li>
<li><a href="../de439236/index.html">xenvman: Flexible Microservice-Testumgebungen (und mehr)</a></li>
<li><a href="../de439238/index.html">Der Play Store akzeptiert jetzt progressive Webanwendungen (PWA).</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>