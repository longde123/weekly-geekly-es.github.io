<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍🔧 🤹🏻 🧙 API UI Consulo dari ide ke prototipe 👲🏽 🧔🏾 👨🏽‍🎤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya, untuk waktu yang lama saya tidak menulis artikel tentang kehidupan proyek di hub 
 Consulo adalah cabang dari IntelliJ IDEA Community E...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>API UI Consulo dari ide ke prototipe</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414497/"><p>  Halo semuanya, untuk waktu yang lama saya tidak menulis artikel tentang kehidupan proyek di hub </p><br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Consulo</a> adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">cabang</a> dari IntelliJ IDEA Community Edition yang memiliki dukungan untuk .NET (C #), Java </blockquote><a name="habracut"></a><br><h3 id="nachnem">  Mari kita mulai </h3><br><p>  <strong>T:</strong> Consulo UI API - apa itu? </p><br><p> <strong>A:</strong> Ini adalah satu set API untuk membuat UI.  Bahkan, satu set antarmuka sederhana yang mengulangi berbagai komponen - Button, RadionButton, Label, dll. </p><br><p>  <strong>T:</strong> Apa tujuan membuat set API UI lain jika sudah ada Swing (karena IDEA UI menggunakan Swing untuk menampilkan antarmuka) </p><br><p>  <strong>A:</strong> Untuk ini, mari kita menyelidiki ide yang saya ikuti saat bekerja pada API UI Consulo.  Karena saya adalah kontributor utama dan hampir satu-satunya proyek Consulo, lama kelamaan menjadi sulit bagi saya untuk mempertahankan jumlah proyek yang sekarang (sekitar <strong>156</strong> repositori).  Ada pertanyaan tentang analisis kode massal, tetapi tidak mungkin melakukannya dalam kerangka kerja satu instance IDE pada platform <strong>Desktop</strong> , dan saya tidak ingin berlatih menggunakan plug-in dari JetBrains di mana satu proyek <strong>ide-ultimate</strong> menampung semua plugin karena sejumlah alasan. </p><br><p>  Gagasan muncul analisis pada server web.  "Analisis biasa" tidak cocok untuk saya di server web, saya ingin membuat <strong>IDE Web</strong> (setidaknya hanya baca di awal) - sementara masih memiliki semua fungsi yang sama seperti di Desktop. </p><br><p>  Anda dapat mengatakan bahwa ini mengulangi sedikit <strong>Upsource</strong> , idenya sendiri serupa - tetapi pendekatannya sama sekali berbeda. </p><br><p>  Dan kemudian tibalah saat - ketika idenya ada, tetapi tidak diketahui bagaimana melakukannya.  Saya punya pengalaman menggunakan GWT, kerangka kerja Vaadin - Saya tidak ingin menggunakan kerangka kerja non-Jawa lainnya untuk menghasilkan JS (well, atau plain js). </p><br><p>  Saya membutuhkan waktu satu bulan untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">meneliti</a> hal ini.  Itu adalah ujian kemampuan saya di bagian ini.  Pada awalnya saya hanya menggunakan GWT - untuk informasi saya menggunakan RPC bawaan. </p><br><p>  Ada tujuan sederhana - proyek sudah terbuka, hanya perlu menampilkan <strong>Project Tree</strong> + <strong>Editor Tabs</strong> .  Dalam hal ini, semuanya harus mirip dengan versi Desktop. </p><br><p>  Segera ada masalah dengan backend yang baru dibuat.  Misalnya, menggunakan EventQueue untuk tindakan internal </p><br><blockquote>  Singkatnya, EventQueue, ini adalah aliran UI (AWT, Swing), hampir semua yang terkait dengan UI terjadi di dalamnya - render, memproses klik tombol, dan sebagainya. <br>  Secara historis, di IDEA, tindakan tulis harus selalu dilakukan di utas UI. <br>  Tindakan tulis adalah rekaman ke file, atau perubahan ke beberapa layanan (misalnya, mengganti nama modul) </blockquote><p>  Pada awalnya, masalah dengan EventQueue dapat diabaikan - tetapi kemudian muncul masalah lain.  Misalnya, <strong>ikon</strong> dangkal.  Bayangkan kita memiliki pohon proyek </p><br><ul><li>  [] nama proyek <br><ul><li>  [] src <br><ul><li>  [] Main.java </li></ul></li><li>  tes [] </li><li>  [] build.gradle </li></ul></li></ul><br><p>  Dan untuk setiap file kita perlu mengunggah dan menampilkan gambar.  Karena kita bekerja di dalam kode Swing, kita menggunakan kelas <strong>javax.swing.Icon</strong> .  Masalahnya adalah itu hanya antarmuka - yang memiliki banyak implementasi yang berbeda </p><br><ul><li>  ikon gambar adalah ikon yang hanya membungkus Gambar (yaitu, gambar biasa dari sistem file) </li><li>  ikon layred ikon layered yang terdiri dari dua atau lebih ikon yang ditumpuk satu sama lain </li><li>  ikon dinonaktifkan - ikon dengan filter abu-abu diterapkan </li><li>  ikon transparan - ikon dengan transparansi yang ditentukan </li><li>  dan banyak lainnya </li></ul><br><p>  Akibatnya, untuk menampilkan ikon di browser, Anda harus mendukung seluruh kebun binatang (dan hampir semuanya sekaligus). Salah satu masalah terkait adalah bahwa ikon yang sama sekali tidak Anda ketahui untuk suatu file mungkin akan datang (misalnya, simbol digambar piksel demi piksel di dalam beberapa plugin) - dan semacamnya perlu diabaikan. </p><br><p>  Dengan metode <strong>kruk</strong> (baik, di mana tanpa mereka) - keputusan dibuat.  Itu basi untuk memeriksa <strong>instanceof</strong> untuk jenis yang kita butuhkan - dan mengabaikan semua yang lain. </p><br><p>  Setelah beberapa saat, dukungan dibuat untuk menavigasi sistem file, membuka file, penyorotan sintaksis, analisis semantik, info dokumen cepat, navigasi untuk referensi kode (kombinasi seperti Ctrl + B, atau Ctrl + MouseClick1 didukung).  Intinya, Editor sangat mirip dengan platform Desktop. </p><br><p>  Seperti apa itu: </p><br><p><img src="https://habrastorage.org/webt/x4/mr/31/x4mr31gex_lj3k1jcjoqrzo6xeu.png"></p><br><p>  Jadi - untuk membuat antarmuka web dimungkinkan dengan kekuatan saya.  Tapi itu pekerjaan yang sangat kasar - yang harus diulang.  Dan kemudian Vaadin datang untuk menyelamatkan. </p><br><p>  Saya memutuskan untuk mengulang implementasi GWT saya untuk menggunakan kerangka kerja Vaadin.  Tes ini ternyata sangat buruk (kinerjanya sangat menurun) - pengalaman saya menggunakan Vaadin lebih memengaruhinya, dan saya menolak opsi ini (saya bahkan melakukan pengaturan ulang pada brunch saat ini untuk melupakannya: D). </p><br><p>  Tetapi pengalaman menggunakan Vaadin berguna bagi saya sepanjang waktu, muncul ide - untuk menyatukan UI sehingga Anda dapat menulis satu kode, tetapi mendapatkan hasil yang berbeda di output, tergantung pada platform. </p><br><p>  Alasan lain untuk menyatukan UI adalah kebun binatang lengkap komponen Swing di dalam platform IntelliJ.  Contoh dari masalah seperti itu adalah dua implementasi <strong>Tab yang</strong> sama sekali berbeda. </p><br><p><img src="https://habrastorage.org/webt/gp/fr/gt/gpfrgtuxuokw4ys9zy995caqgng.png"></p><br><p><img src="https://habrastorage.org/webt/i1/c6/0w/i1c60wdsldtk5pi1dakzszqis3e.png"></p><br><p>  Pisahkan logika UI: </p><br><ul><li>  frontend - satu set antarmuka untuk setiap elemen, misalnya consulo.ui.Tombol # create () </li><li>  backend - implementasi tergantung platform <br><ul><li>  Swing - implementasi desktop </li><li>  WGWT - implementasi web </li></ul></li></ul><br><p>  Apa itu <strong>WGWT</strong> ?  Akronim untuk Wrapper GWT.  Ini adalah kerangka kerja yang ditulis sendiri - yang menyimpan STATE komponen dan mengirimkannya melalui WebSocket ke browser (yang pada gilirannya menghasilkan html).  Dia menulis dengan mata pada Vaadin (ya ya - kruk lain). </p><br><p>  Waktu berlalu - dan saya sudah bisa meluncurkan UI uji yang berfungsi sama di Desktop dan di browser </p><br><p><img src="https://habrastorage.org/webt/di/pz/kh/dipzkhwrwphaad8eddsohpoaubc.gif"></p><br><p>  Saya juga menggunakan Vaadin yang bekerja secara paralel, karena ini adalah salah satu opsi termurah untuk membangun UI Web jika Anda menggunakan Java.  Saya semakin mempelajari Vaadin - dan saya memutuskan untuk menulis ulang WGWT menjadi Vaadin lagi, tetapi dengan beberapa koreksi. </p><br><p>  Apa yang diedit: </p><br><ul><li>  penolakan untuk menggunakan hampir semua komponen Vaadin.  Ada beberapa alasan - salah satunya adalah komponen yang terlalu terbatas (kustomisasi minimal). </li><li>  menggunakan komponen yang ada dari kerangka kerja WGWT saya; yaitu implementasi GWT mereka </li><li>  ada juga tambalan yang memungkinkan Anda untuk menulis anotasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">Connect</a> tanpa tautan langsung ke komponen server (ini dilakukan lebih untuk struktur proyek, untuk menghindari ketersediaan kelas server di dalam kode klien) </li></ul><br><p>  Hasilnya, ternyata seperti ini: </p><br><ul><li>  frontend - satu set antarmuka untuk setiap elemen, misalnya consulo.ui.Tombol # create () </li><li>  backend - implementasi saat ini tergantung pada platform <br><ul><li>  Swing - implementasi desktop </li><li>  Vaadin - implementasi web </li><li>  Android?  - agar ponsel terbakar pada awal aplikasi: D Sejauh ini, hanya pada tingkat gagasan bahwa akan mungkin untuk menggunakan kode yang ada untuk mentransfer ke Android (karena tidak akan ada ikatan dengan Swing) </li></ul></li></ul><br><p>  Dan jadi API UI Consulo saat ini lahir. </p><br><p>  Di mana Consulo UI API akan digunakan? </p><br><ul><li>  Di semua plugin.  AWT / Swing akan "diblokir" (tidak ada lagi <strong>java.awt.Color</strong> ) selama kompilasi (prosesor javac akan dibuat - nanti, mungkin tidak diperlukan sama sekali dengan kedatangan java 9).  Set komponen Anda bukan obat mujarab, saya mengerti itu.  Saat ini, Anda dapat membuat komponen UI kustom Anda sendiri, sejauh ini hanya di sisi Swing (dan dalam kasus seperti itu akan perlu untuk menambahkan ketergantungan pada plugin consulo.destop untuk menghindari masalah pada server web).  Belum ada pembuatan komponen Vaadin di sisi plugin - akan, ini adalah tugas kecil. </li><li>  Di sisi platform, ini adalah Pengaturan / Preferensi, Jalankan Konfigurasi, Editor - pada dasarnya seluruh antarmuka yang menuju JFrame. </li></ul><br><p>  Apa masalahnya? </p><br><ul><li>  Benar-benar tidak kompatibel dengan kode AWT / Swing (ada kelas kruk TargetAWT / TargetVaadin yang memiliki metode untuk mengkonversi komponen, tetapi kelas-kelas ini tidak dapat diakses untuk plugin). <br>  Semua komponen Swing tidak dapat ditampilkan di browser - sebagai akibatnya, Anda perlu menulis ulang semua kode ini. <br>  Hampir di mana-mana, API UI Consulo sudah didukung di dalam platform - ini memungkinkan Anda untuk sudah menggunakan kerangka UI baru di dalam plugin dan tidak hanya. </li><li>  Keterikatan platform IntelliJ yang sangat kuat pada Swing, itu terkubur begitu dalam sehingga tanpa kruk "selanjutnya", Anda tidak bisa menggali itu ( <img src="https://habrastorage.org/webt/cu/in/ch/cuinchsey3paqijfjqfn8ndniag.gif" height="25">  ) </li></ul><br><h3 id="spustya-nekotoroe-vremya">  Setelah beberapa waktu </h3><br><p>  <a href=""><strong>Kode</strong></a> ini berfungsi sama di kedua platform. </p><br><p>  Karyanya di Desktop: </p><br><p><img src="https://habrastorage.org/webt/ev/ev/_5/evev_5szgc6hxumf6tljcyzvp7u.png"></p><br><p>  Karyanya di browser: </p><br><p><img src="https://habrastorage.org/webt/ba/3m/pk/ba3mpkqjv3bw90ugi8uy_c1iime.png"></p><br><p>  Mengenai masalah di atas: </p><br><ul><li>  Ikon.  Kelas consulo.ui.image.Image diperkenalkan, yang merupakan gambar dari sistem file (dan tidak hanya).  Anda dapat menggunakan metode consulo.ui.image.Image # create (java.net.URL) untuk mengunggah gambar. </li></ul><br><p>  Pada platform Desktop - ikon dimuat seperti yang dimuat sebelumnya, hanya sekarang jenis kembali adalah SwingImageRef (nama kelas warisan - sebelumnya consulo.ui.image.Image disebut consulo.ui.ImageRef) - antarmuka yang mewarisi javax.swing.Icon dan consulo.ui Gambar. Gambar.  Nanti antarmuka ini akan dihapus (keberadaannya disebabkan oleh migrasi yang disederhanakan ke tipe baru) </p><br><p>  Pada platform Web - URL disimpan di dalam objek, dan merupakan pengidentifikasi untuk tampilan di antarmuka (melalui URL - / app / uiImage = <em>URLhashCode</em> ) </p><br><p>  Kelas ImageEffects telah diperkenalkan.  Dalam dirinya sendiri terdapat metode yang diperlukan untuk membuat ikon turunan.  Misalnya, #grayed (Gambar) akan mengembalikan ikon dengan filter abu-abu, #transparent (Gambar) ikon tembus. </p><br><p>  Artinya, seluruh seluruh kebun binatang yang dijelaskan di atas didorong ke bingkai sempit. </p><br><p>  Dukungan untuk rendering elemen secara manual (yah, di mana tanpa ini) juga akan diperkenalkan.  Metode <em>ImageEffects # canvas (int height, int int, Consumer &lt;Canvas2D&gt; painterConsumer)</em> akan mengembalikan ikon yang akan ditarik melalui Canvas2D </p><br><p>  Di Desktop - bungkus akan digunakan di atas Graphics2D biasa dari Swing </p><br><p>  Di Web - setiap panggilan ke metode Canvas2D akan disimpan, dan kemudian akan ditransfer ke browser tempat kanvas internal dari browser akan digunakan </p><br><ul><li>  Tulis Aksi di Thread UI.  Oooo  Belum ada solusi untuk masalah ini.  Saat ini - ada prototipe <strong>Write Action di Own Thread</strong> tetapi sejauh ini hanya pada platform Web, terlalu banyak yang perlu diubah di dalam platform untuk "roll it out" di Desktop. </li><li>  UI telah disatukan - tidak ada kebun binatang untuk elemen sederhana </li></ul><br><p>  Masalah baru juga muncul - Dialog dialog memblokir utas eksekusi selama pertunjukan.  Akibatnya, IDEA suka menulis kode dalam formulir ini: </p><br><pre><code class="java hljs">DialogWrapper wrapper = ...; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value = wrapper.showAndGet(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(value == DialogWrapper.OK) { ... }</code> </pre> <br><p>  Pada saat yang sama, menampilkan dialog di Vaadin tidak memblokir utas eksekusi. </p><br><p>  Untuk menghindari kebingungan dengan tampilan dialog yang sinkron dan tidak sinkron, opsi asinkron dipilih (kode di atas harus dipikirkan ulang dan diulang). </p><br><h3 id="itog">  Ringkasan </h3><br><p>  Setelah beberapa saat, saya memiliki prototipe aplikasi Web yang berfungsi. </p><br><p><img src="https://habrastorage.org/webt/pu/op/wf/puopwftlitlwgca5idhdgwyvw80.gif"></p><br><p>  Sejauh ini ini adalah prototipe yang bergerak menuju rilis - tetapi tidak akan cepat (sayangnya). </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id414497/">https://habr.com/ru/post/id414497/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id414485/index.html">GNMT, kegagalan epik atau seluk-beluk terjemahan mesin</a></li>
<li><a href="../id414487/index.html">Perwakilan tipe brute-force yang langka: sejarah satu serangan</a></li>
<li><a href="../id414489/index.html">AS berencana untuk secara serius mengatasi masalah puing-puing luar angkasa</a></li>
<li><a href="../id414493/index.html">Cara menulis kontrak pintar untuk ICO dalam 5 menit</a></li>
<li><a href="../id414495/index.html">toString: Hebat dan Mengerikan</a></li>
<li><a href="../id414499/index.html">Laporan Club of Rome 2018, Bab 1.1.3: “Dunia yang Kosong versus Perdamaian Penuh”</a></li>
<li><a href="../id414501/index.html">Laporan Club of Rome 2018, Bab 3.11: “Reformasi Sektor Keuangan”</a></li>
<li><a href="../id414503/index.html">Intel NUC Hades Canyon dengan AMD Vega Graphics - VR or Not VR?</a></li>
<li><a href="../id414505/index.html">Kursus MIT "Keamanan Sistem Komputer". Kuliah 2: "Kontrol serangan hacker", bagian 1</a></li>
<li><a href="../id414507/index.html">Bagaimana keyboard terprogram paling populer untuk perdagangan telah berubah: kisah keyboard Bloomberg</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>