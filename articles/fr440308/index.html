<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßòüèæ üö∑ üõï Diviser et conqu√©rir, ou √©crire lentement - lire rapidement üë®üèº‚Äçüöí üõ§Ô∏è üññüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans l'un de mes projets, il √©tait n√©cessaire d'enregistrer s√©quentiellement des ensembles de donn√©es num√©ris√©s √† partir de 3 canaux de l'ADC. Les r√©s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Diviser et conqu√©rir, ou √©crire lentement - lire rapidement</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440308/"><p><img src="https://habrastorage.org/webt/pu/um/_f/puum_foe8kyeiv5ksbwofdsgvb0.jpeg"></p><br><p>  Dans l'un de mes projets, il √©tait n√©cessaire d'enregistrer s√©quentiellement des ensembles de donn√©es num√©ris√©s √† partir de 3 canaux de l'ADC.  Les r√©sultats des mesures devaient √™tre stock√©s √† une vitesse de 6 Ko / s, tandis que la dur√©e du cycle de collecte des donn√©es pouvait √™tre d'un jour ou plus.  Ainsi, la quantit√© totale d'informations devant √™tre stock√©es √©tait de 500 Mo ou plus.  En tant que p√©riph√©rique de stockage, il a √©t√© d√©cid√© de choisir une carte SD. </p><a name="habracut"></a><br><p>  La t√¢che √©tait compliqu√©e par le fait que les caract√©ristiques de conception de l'appareil cr√©√© ne permettaient pas d'extraire une carte pour lire les donn√©es.  Le contr√¥leur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">XMega128A4U</a> , sur lequel la t√¢che √©tait impl√©ment√©e √† ce moment-l√†, n'avait pas de support mat√©riel SDIO, mais permettait de travailler avec la carte via l'interface SPI, dont la bande passante √©tait tout √† fait possible d'√©crire √† la vitesse requise, mais en lisant une quantit√© de donn√©es dans l'ordinateur via la cha√Æne de carte SD via SPI -&gt; contr√¥leur -&gt; Le convertisseur USB-Com √©tait plut√¥t morne et a pris un temps consid√©rable. </p><br><p>  Apr√®s r√©flexion (et tentatives infructueuses d'overclocker l√©g√®rement l'ensemble ci-dessus), il a √©t√© d√©cid√© d'utiliser un contr√¥leur de lecteur de carte SD mat√©riel, pour lequel la puce <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GL823</a> prenant en charge USB 2.0 a √©t√© choisie.  Il √©tait maintenant n√©cessaire de fournir un acc√®s s√©par√© √† la carte SD depuis le contr√¥leur via SPI pendant la collecte des donn√©es et depuis l'ordinateur via SDIO, via <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GL823</a> pendant la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lecture</a> √† haute vitesse.  Cette s√©paration a √©t√© r√©alis√©e √† l'aide de deux multiplexeurs 2x1 4 canaux. </p><br><p><img src="https://habrastorage.org/webt/7u/52/xh/7u52xhuv-7zk7siz735v-izcjxi.jpeg"></p><br><p>  Les lignes des commutateurs U2, U3 avec le pr√©fixe STM sont connect√©es au contr√¥leur, les lignes avec le pr√©fixe SD sont connect√©es √† la carte SD.  Pour contr√¥ler le circuit, des signaux SD2MCU sont utilis√©s, commutant la carte SD entre le MCU et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GL823</a> et GL823_PWR, commutant l'alimentation GL823 via le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mosfet</a> . </p><br><p>  Au d√©part, je consid√©rais cette approche comme une sorte de ¬´b√©quille¬ª, mais, √† ma grande surprise, elle s'est av√©r√©e tr√®s fonctionnelle pour moi et a √©t√© confirm√©e par la pratique de l'utilisation r√©ussie de l'appareil pendant plusieurs ann√©es. </p><br><p>  De plus, dans les d√©veloppements suivants bas√©s sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">STM32F407</a> , qui prend en charge SDIO pour acc√©der √† la carte, et la possibilit√© d'augmenter USB MS HS MSD (bien que via une interface ULPI parall√®le), la possibilit√© d'utiliser une solution <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GL823</a> bas√©e sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bus</a> est consid√©r√©e. </p><br><p>  En utilisant un bundle de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">STM32F407</a> avec un PHY USB3300 externe, il √©tait possible d'atteindre une vitesse de lecture de carte de ~ 41 Mbit / s, tandis que lorsque vous utilisez un lecteur de carte mat√©riel, la vitesse atteint ~ 150 Mbit / s, toutes choses √©gales par ailleurs.  Les mesures ont √©t√© effectu√©es en lisant un fichier de 128 Mo √† partir d'une carte SD format√©e en FAT32.  Les deux approches ont leurs propres nuances d'utilisation, mais, il me semble, les deux ont un ¬´droit √† la vie¬ª.  Quant aux nuances: dans mon cas, √† la prochaine it√©ration du d√©veloppement de cet appareil, le mat√©riel devait √™tre plac√© sur une planche de 26 mm de large. </p><br><p>  La disposition du <abbr title="carte de circuit imprim√©">PCB</abbr> pour le LQFP100 du bo√Ætier STM32F407 dans ce cas est quelque peu difficile, mais son "fr√®re cadet" <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">STM32F405</a> dans le bo√Ætier LQFP64 √©tait m√™me localis√©.  Mais le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">STM32F405</a> manque d'ULPI, donc USB 2.0 HS n'est pas disponible pour cela, et l'impl√©mentation MSD FS perd beaucoup dans la vitesse de lecture des donn√©es de la carte.  En utilisant la m√™me solution d√©crite ci-dessus, vous pouvez obtenir une vitesse d'acc√®s suffisante √† SD depuis l'ordinateur tout en lisant les donn√©es de l'appareil. </p><br><p>  Je serais heureux si mon exp√©rience est utile √† quelqu'un. </p><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr440308/">https://habr.com/ru/post/fr440308/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr440298/index.html">Application de la Saint-Valentin sur Libgdx</a></li>
<li><a href="../fr440300/index.html">10 commandes de console pour aider √† d√©battre du code JavaScript comme un PRO</a></li>
<li><a href="../fr440302/index.html">CRM - co√ªt du succ√®s, co√ªt de l'erreur, co√ªt de possession</a></li>
<li><a href="../fr440304/index.html">Interruptions √† partir de p√©riph√©riques externes dans un syst√®me x86. Partie 3. Configuration du routage d'interruption dans le chipset en utilisant l'exemple coreboot</a></li>
<li><a href="../fr440306/index.html">Mise √† l'√©chelle de la base de donn√©es dans des syst√®mes tr√®s charg√©s</a></li>
<li><a href="../fr440310/index.html">Comment apprendre √† une machine √† comprendre les factures et √† en extraire des donn√©es</a></li>
<li><a href="../fr440312/index.html">Hackquest 2018. R√©sultats et √©critures. Jour 4-7</a></li>
<li><a href="../fr440314/index.html">Candidat √† la sortie de JDK 12: Shenandoah, G1, JMH, Arm64. Les bugs dans Swing ripostent</a></li>
<li><a href="../fr440316/index.html">R√©partition uniforme des points dans un triangle</a></li>
<li><a href="../fr440318/index.html">GDPR: comment travailler avec les donn√©es personnelles de vos employ√©s, ind√©pendants et employ√©s de contrepartie europ√©ens</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>