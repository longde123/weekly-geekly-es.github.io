<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üß¢ ‚úçüèΩ üë©üèª‚Äç‚öïÔ∏è Helm Security üéÖüèª üêâ üöµüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A ess√™ncia da hist√≥ria sobre o gerenciador de pacotes mais popular do Kubernetes pode ser representada com a ajuda de emoji: 



- a caixa √© Helm (√© a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Helm Security</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/462665/">  A ess√™ncia da hist√≥ria sobre o gerenciador de pacotes mais popular do Kubernetes pode ser representada com a ajuda de emoji: <br><br><ul><li>  a caixa √© Helm (√© a mais adequada na vers√£o mais recente do Emoji); </li><li>  fechadura - seguran√ßa; </li><li>  o homem √© a solu√ß√£o para o problema. </li></ul><br><img src="https://habrastorage.org/webt/7f/e6/f2/7fe6f2dsslbuogltyajqyhcm3x4.jpeg"><br><br>  De fato, tudo ser√° um pouco mais complicado, e a hist√≥ria est√° cheia de detalhes t√©cnicos sobre <b>como tornar o Helm seguro</b> . <br><br><ul><li>  Resumidamente, o que √© Helm se voc√™ n√£o sabia ou esqueceu.  Quais problemas ele resolve e onde est√° localizado no ecossistema. </li><li>  Considere a arquitetura do Helm.  Nem uma √∫nica conversa sobre seguran√ßa e como tornar uma ferramenta ou solu√ß√£o mais segura pode ocorrer sem entender a arquitetura do componente. </li><li>  Vamos discutir os componentes do Helm. </li><li>  O problema mais grave √© o futuro - a nova vers√£o do Helm 3. </li></ul><br>  Tudo neste artigo est√° relacionado ao Helm 2. Esta vers√£o est√° em produ√ß√£o e provavelmente √© voc√™ quem est√° usando agora, e √© a√≠ que h√° riscos de seguran√ßa. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/_8zNTJ1_R5I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <strong>Sobre o palestrante:</strong> Alexander Khayorov ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">allexx</a> ) desenvolve h√° 10 anos, ajuda a melhorar o conte√∫do do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Moscow Python Conf ++</a> e ingressou no comit√™ da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Helm Summit</a> .  Atualmente trabalhando na Chainstack na posi√ß√£o de l√≠der de desenvolvimento - este √© um h√≠brido entre o gerente de desenvolvimento e a pessoa respons√°vel pela entrega dos releases finais.  Ou seja, est√° localizado no local das hostilidades, onde tudo acontece desde a cria√ß√£o do produto at√© sua opera√ß√£o. <br><br>  O Chainstack √© uma startup pequena, em crescimento ativo, cuja tarefa √© oferecer aos clientes a oportunidade de esquecer a infraestrutura e as dificuldades de opera√ß√£o de aplicativos descentralizados. A equipe de desenvolvimento est√° localizada em Cingapura.  N√£o pe√ßa ao Chainstack para vender ou comprar criptomoedas, mas ofere√ßa-se para falar sobre estruturas de blockchain corporativas, e elas ter√£o prazer em responder. <br><br><h2>  Elmo </h2><br>  Este √© o gerenciador de pacotes (gr√°ficos) do Kubernetes.  A maneira mais intuitiva e vers√°til de levar aplicativos ao cluster Kubernetes. <br><br><img src="https://habrastorage.org/webt/0h/4j/np/0h4jnpvzc7hlncvlzprx9hfkz9s.jpeg"><br><br>  Naturalmente, trata-se de uma abordagem mais estrutural e industrial do que criar seus pr√≥prios manifestos YAML e escrever pequenos utilit√°rios. <br><br><blockquote>  Helm √© o melhor dispon√≠vel e popular no momento. </blockquote><br>  Por que leme?  Principalmente porque √© suportado pelo CNCF.  Cloud Native - uma grande organiza√ß√£o, √© a empresa controladora dos projetos Kubernetes, etcd, Fluentd e outros. <br><br>  Outro fato importante, Helm √© um projeto muito popular.  Quando, em janeiro de 2019, eu estava planejando falar sobre como tornar o Helm seguro, o projeto tinha mil estrelas no GitHub.  Em maio, havia 12 mil deles. <br><br>  Muitas pessoas est√£o interessadas no Helm, portanto, mesmo que voc√™ ainda n√£o o use, voc√™ precisar√° conhecer sua seguran√ßa.  <strong>A seguran√ßa √© importante.</strong> <br><br>  A equipe principal do Helm √© suportada pelo Microsoft Azure e, portanto, este √© um projeto bastante est√°vel, diferente de muitos outros.  O lan√ßamento do Helm 3 Alpha 2 em meados de julho indica que muitas pessoas est√£o trabalhando no projeto e t√™m desejo e for√ßa para desenvolver e melhorar o Helm. <br><br><img src="https://habrastorage.org/webt/c8/m1/ex/c8m1exaajnjbhme9yh_gjqw_y00.jpeg"><br><br>  O Helm resolve v√°rios problemas de gerenciamento de aplicativos raiz no Kubernetes. <br><br><ul><li>  Embalagem de aplica√ß√£o.  At√© um aplicativo como ‚ÄúHello, World‚Äù no WordPress j√° consiste em v√°rios servi√ßos, e eu quero agrup√°-los. </li><li>  Gerenciamento da complexidade que surge com o gerenciamento desses aplicativos. </li><li>  Um ciclo de vida que n√£o termina ap√≥s a instala√ß√£o ou implanta√ß√£o do aplicativo.  Ele continua vivo, precisa ser atualizado, e Helm ajuda nisso e est√° tentando trazer as medidas e pol√≠ticas certas para isso. </li></ul><br>  <strong>A embalagem</strong> √© organizada de maneira compreens√≠vel: existem metadados em total conformidade com o trabalho de um gerenciador de pacotes regular para Linux, Windows ou MacOS.  Ou seja, o reposit√≥rio, dependendo de v√°rios pacotes, metainforma√ß√µes para aplicativos, configura√ß√µes, recursos de configura√ß√£o, indexa√ß√£o de informa√ß√µes etc. O Helm permite que voc√™ o obtenha e use para aplicativos. <br><br>  <strong>Gerenciamento de complexidade</strong> .  Se voc√™ tiver muitos aplicativos semelhantes, precisar√° de parametriza√ß√£o.  Os modelos seguem isso, mas, para n√£o criar sua pr√≥pria maneira de criar modelos, voc√™ pode usar o que o Helm oferece imediatamente. <br><br>  <strong>Gerenciamento do ciclo de vida de aplicativos</strong> - na minha opini√£o, esse √© o problema mais interessante e n√£o resolvido.  Foi por isso que vim para Helm no devido tempo.  Precis√°vamos monitorar o ciclo de vida do aplicativo, quer√≠amos transferir nossos ciclos de CI / CD e aplicativo para esse paradigma. <br><br>  Helm permite que voc√™: <br><br><ul><li>  gerenciar implanta√ß√£o, apresenta o conceito de configura√ß√£o e revis√£o; </li><li>  revers√£o com sucesso; </li><li>  use ganchos para diferentes eventos; </li><li>  Adicione verifica√ß√µes adicionais de aplicativos e responda a seus resultados. </li></ul><br>  Al√©m disso <strong>, Helm possui ‚Äúbaterias‚Äù</strong> - um grande n√∫mero de coisas saborosas que podem ser inclu√≠das na forma de plug-ins, simplificando sua vida.  Os plugins podem ser escritos de forma independente, s√£o bastante isolados e n√£o requerem uma arquitetura esbelta.  Se voc√™ deseja implementar algo, recomendo faz√™-lo como um plug-in e, em seguida, √© poss√≠vel inclu√≠-lo no upstream. <br><br>  O Helm √© baseado em tr√™s conceitos principais: <br><br><ul><li>  <strong>Repo do gr√°fico</strong> - descri√ß√£o e matriz de parametriza√ß√£o poss√≠vel para o seu manifesto. </li><li>  <strong>Config - ou</strong> seja, os valores que ser√£o aplicados (texto, valores num√©ricos, etc.). </li><li>  <strong>O Release</strong> re√∫ne os dois principais componentes e, juntos, se transformam no Release.  As vers√µes podem ser versionadas, alcan√ßando assim a organiza√ß√£o do ciclo de vida: pequena no momento da instala√ß√£o e grande no momento da atualiza√ß√£o, downgrade ou revers√£o. </li></ul><br><h2>  Arquitetura do leme </h2><br>  O diagrama reflete conceitualmente a arquitetura de alto n√≠vel do Helm. <br><br><img src="https://habrastorage.org/webt/ih/dk/fs/ihdkfsbvonqupbrs-tvbmspdnpm.jpeg"><br><br>  Deixe-me lembr√°-lo de que Helm √© algo conectado ao Kubernetes.  Portanto, n√£o podemos prescindir do Kubernetes-cluster (ret√¢ngulo).  O componente kube-apiserver est√° no assistente.  Sem Helm, temos o Kubeconfig.  O Helm traz um pequeno bin√°rio, por assim dizer, o utilit√°rio Helm CLI, instalado em um computador, laptop ou mainframe - para qualquer coisa. <br><br>  Mas isso n√£o √© suficiente.  Helm possui um componente de servidor Tiller.  Ele representa os interesses do Helm dentro de um cluster, √© o mesmo aplicativo dentro de um cluster Kubernetes, como qualquer outro. <br><br>  O pr√≥ximo componente do reposit√≥rio de gr√°ficos √© o reposit√≥rio de gr√°ficos.  Existe um reposit√≥rio oficial e pode haver um reposit√≥rio privado de uma empresa ou projeto. <br><br><h3>  Intera√ß√£o </h3><br>  Vamos ver como os componentes da arquitetura interagem quando queremos instalar um aplicativo usando o Helm. <br><br><ul><li> Dizemos que o <code>Helm install</code> , v√° para o reposit√≥rio (Chart Repo) e obtenha um gr√°fico do Helm. </li></ul><br><ul><li>  O Helm Utility (Helm CLI) interage com o Kubeconfig para descobrir qual cluster entrar em contato. </li><li>  Ap√≥s receber essas informa√ß√µes, o utilit√°rio se volta para o Tiller, que est√° em nosso cluster, j√° como um aplicativo. </li><li>  O Tiller recorre ao Kube-apiserver para executar a√ß√µes no Kubernetes, para criar alguns objetos (servi√ßos, pods, r√©plicas, segredos etc.). </li></ul><br>  Al√©m disso, complicaremos o esquema para ver o vetor de ataques aos quais toda a arquitetura Helm como um todo pode ser submetida.  E ent√£o tentaremos proteg√™-la. <br><br><h3>  Vetor de ataque </h3><br>  O primeiro ponto potencialmente fraco √© a <strong>API do</strong> <strong>usu√°rio</strong> <strong>privilegiada</strong> .  Como parte do esquema, este √© um hacker que obteve acesso de administrador ao Helm CLI. <br><br>  <strong>Um usu√°rio de API n√£o privilegiado</strong> tamb√©m pode ser perigoso se estiver localizado em algum lugar pr√≥ximo.  Esse usu√°rio ter√° um contexto diferente, por exemplo, ele pode ser corrigido em um espa√ßo para nome do cluster nas configura√ß√µes do Kubeconfig. <br><br>  O vetor de ataque mais interessante pode ser o processo localizado dentro do cluster em algum lugar perto de Tiller e pode acess√°-lo.  Pode ser um servidor da web ou um microsservi√ßo que visualiza o ambiente de rede do cluster. <br><br>  Uma op√ß√£o de ataque ex√≥tica, mas que est√° ganhando popularidade, est√° associada ao Chart Repo.  Um gr√°fico criado por um autor inescrupuloso pode conter um recurso inseguro, e voc√™ o executar√°, assumindo f√©.  Ou pode substituir o gr√°fico que voc√™ baixa do reposit√≥rio oficial e, por exemplo, criar um recurso na forma de pol√≠ticas e aumentar seu acesso. <br><br><img src="https://habrastorage.org/webt/jv/mc/86/jvmc86oowz_haxtc6jwb3gac9me.jpeg"><br><br>  Vamos tentar combater os ataques de todos esses quatro lados e descobrir onde h√° problemas na arquitetura Helm e onde, possivelmente, eles n√£o est√£o. <br><br>  Vamos ampliar o esquema, adicionar mais elementos, mas manter todos os componentes b√°sicos. <br><br><img src="https://habrastorage.org/webt/j3/1d/ci/j31dciie_cbem-dvnilww29iksc.jpeg"><br><br>  O Helm CLI se comunica com o Chart Repo, interage com o Kubeconfig, o trabalho √© transferido para o cluster no componente Tiller. <br><br>  O tim√£o √© representado por dois objetos: <br><br><ul><li>  Tiller-deploy svc, que exp√µe um determinado servi√ßo; </li><li>  Pod de implanta√ß√£o do leme (no diagrama em uma √∫nica c√≥pia em uma r√©plica), que executa toda a carga que acessa o cluster. </li></ul><br>  Para intera√ß√£o, diferentes protocolos e esquemas s√£o usados.  Do ponto de vista da seguran√ßa, estamos mais interessados ‚Äã‚Äãem: <br><br><ul><li>  O mecanismo pelo qual o Helm CLI acessa o reposit√≥rio de gr√°ficos: qual protocolo, se h√° autentica√ß√£o e o que pode ser feito sobre isso. </li><li>  O protocolo pelo qual o Helm CLI, usando o kubectl, se comunica com o Tiller.  Este √© um servidor RPC instalado dentro do cluster. </li><li>  O pr√≥prio Leme est√° dispon√≠vel para microsservi√ßos que est√£o em um cluster e interagem com o Kube-apiserver. </li></ul><br><img src="https://habrastorage.org/webt/qm/49/cw/qm49cwtid16t8lz5lrn7ngzjahi.jpeg"><br><br>  Discutiremos todas essas instru√ß√µes em ordem. <br><br><h2>  RBAC </h2><br><blockquote>  √â in√∫til falar sobre qualquer seguran√ßa do Helm ou outro servi√ßo dentro do cluster se o RBAC n√£o estiver ativado. </blockquote><br>  Parece que essa n√£o √© uma recomenda√ß√£o nova, mas tenho certeza de que at√© agora muitos n√£o inclu√≠ram o RBAC nem na produ√ß√£o, porque isso √© muito barulhento e h√° muito a ser configurado.  No entanto, pe√ßo que isso seja feito. <br><br><img src="https://habrastorage.org/webt/h-/6q/j6/h-6qj6oj9otudmbpt_qdx3rzfcs.jpeg"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://rbac.dev/</a> √© um site de advogados da RBAC.  Ele coletou uma enorme quantidade de materiais interessantes que ajudar√£o a configurar o RBAC, mostrar por que √© bom e como conviver com ele em princ√≠pio na produ√ß√£o. <br><br>  Vou tentar explicar como Tiller e RBAC funcionam.  O Leme trabalha dentro de um cluster em uma determinada conta de servi√ßo.  Normalmente, se o RBAC n√£o estiver configurado, este ser√° o superusu√°rio.  Na configura√ß√£o b√°sica, o Tiller ser√° o administrador.  √â por isso que se costuma dizer que o Tiller √© um t√∫nel SSH para o seu cluster.  Esse √© realmente o caso, portanto, voc√™ pode usar uma conta de servi√ßo dedicada separada em vez da conta de servi√ßo padr√£o no diagrama acima. <br><br>  Ao inicializar o Helm, instale-o primeiro no servidor, voc√™ pode definir a conta de servi√ßo usando <code>--service-account</code> .  Isso permitir√° que voc√™ use o usu√°rio com o conjunto m√≠nimo de direitos necess√°rio.  √â verdade que voc√™ precisa criar uma "guirlanda": Role e RoleBinding. <br><br><img src="https://habrastorage.org/webt/wh/rv/-6/whrv-6tklftmsb0_fw3h0uumk5g.jpeg"><br><br>  Infelizmente, Helm n√£o far√° isso por voc√™.  Voc√™ ou o administrador do cluster Kubernetes precisa preparar um conjunto de Fun√ß√£o, RoleBinding para a conta de servi√ßo com anteced√™ncia para transferir o Helm. <br><br>  A quest√£o √©: qual √© a diferen√ßa entre Role e ClusterRole?  A diferen√ßa √© que ClusterRole √© v√°lido para todos os namespaces, ao contr√°rio de Role e RoleBinding regulares, que funcionam apenas para namespaces especializados.  Voc√™ pode configurar pol√≠ticas para todo o cluster e todos os espa√ßos para nome, bem como personalizado para cada espa√ßo para nome separadamente. <br><br>  Vale ressaltar que o RBAC resolve outro grande problema.  Muitos reclamam que o Helm, infelizmente, n√£o √© multiloca√ß√£o (n√£o oferece suporte √† multiloca√ß√£o).  Se v√°rias equipes consomem um cluster e usam o Helm, √© imposs√≠vel, em princ√≠pio, configurar pol√≠ticas e diferenciar seu acesso nesse cluster, porque existe uma conta de servi√ßo sob a qual o Helm funciona e cria todos os recursos no cluster a partir dele. √†s vezes muito desconfort√°vel.  Isso √© verdade - como o pr√≥prio bin√°rio, como um processo, <strong>Helm Tiller n√£o tem id√©ia sobre a multiloca√ß√£o</strong> . <br><br>  No entanto, existe uma √≥tima maneira de executar o Tiller em um cluster v√°rias vezes.  N√£o h√° problema com isso; o Tiller pode ser executado em todos os namespace.  Assim, voc√™ pode usar RBAC, Kubeconfig como contexto e restringir o acesso ao Helm especial. <br><br>  Ele ter√° a seguinte apar√™ncia. <br><br><img src="https://habrastorage.org/webt/rr/hh/kv/rrhhkvmholhz5monyp3o7vxc9nk.jpeg"><br><br>  Por exemplo, existem dois Kubeconfig com contexto para equipes diferentes (dois namespace): X Team para a equipe de desenvolvimento e o cluster de administradores.  O cluster do administrador possui seu pr√≥prio Tiller amplo, localizado no namespace do sistema Kube, respectivamente, uma conta de servi√ßo avan√ßada.  E um espa√ßo de nome separado para a equipe de desenvolvimento, eles poder√£o implantar seus servi√ßos em um espa√ßo de nome especial. <br><br>  Essa √© uma abordagem funcional, o Tiller n√£o √© t√£o guloso que pode afetar muito o seu or√ßamento.  Essa √© uma das corre√ß√µes r√°pidas. <br><br><blockquote>  Sinta-se √† vontade para configurar o Tiller separadamente e fornecer ao Kubeconfig o contexto para a equipe, para um desenvolvedor espec√≠fico ou para o ambiente: desenvolvedor, teste, produ√ß√£o (√© duvidoso que tudo esteja no mesmo cluster, no entanto, isso pode ser feito). </blockquote><br>  Continuando nossa hist√≥ria, mude do RBAC e fale sobre o ConfigMaps. <br><br><h3>  Configmaps </h3><br>  O Helm usa o ConfigMaps como um data warehouse.  Quando falamos sobre arquitetura, n√£o havia nenhum banco de dados em que informa√ß√µes sobre releases, configura√ß√µes, revers√µes etc. eram armazenadas, e por isso o ConfigMaps √© usado. <br><br>  O principal problema do ConfigMaps √© conhecido - eles s√£o inseguros em princ√≠pio, √© <strong>imposs√≠vel armazenar dados confidenciais</strong> neles.  Estamos falando de tudo que n√£o deve ir al√©m do servi√ßo, por exemplo, senhas.  A maneira mais nativa para o Helm agora √© passar do ConfigMaps para os segredos. <br><br>  Isso √© feito de maneira muito simples.  Redefina a configura√ß√£o do Leme e especifique que o armazenamento ser√° um segredo.  Ent√£o, para cada implanta√ß√£o, voc√™ n√£o receber√° o ConfigMap, mas um segredo. <br><br><img src="https://habrastorage.org/webt/da/a2/e-/daa2e-a00de_nuo_crbeqtaz6qu.jpeg"><br><br>  Voc√™ pode argumentar que os segredos em si s√£o um conceito estranho e n√£o √© muito seguro.  No entanto, vale a pena entender que os desenvolvedores do Kubernetes est√£o fazendo isso.  A partir da vers√£o 1.10, ou seja,  H√° muito tempo, existe a possibilidade, pelo menos em nuvens p√∫blicas, de conectar o armazenamento correto para armazenar segredos.  Agora, a equipe est√° trabalhando para melhorar ainda mais o acesso a segredos, envios individuais ou outras entidades. <br><br><blockquote>  O Storage Helm √© melhor para traduzir em segredos, e eles, por sua vez, protegem centralmente. </blockquote><br>  Obviamente, haver√° um <strong>limite para armazenamento de dados de 1 MB</strong> .  O Helm aqui usa o etcd como um reposit√≥rio distribu√≠do para o ConfigMaps.  E l√° eles pensaram que era um bloco de dados adequado para replica√ß√µes, etc.  H√° uma discuss√£o interessante no Reddit sobre isso, eu recomendo encontrar esse assunto divertido de leitura para o fim de semana ou ler o aperto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br><h3>  Relat√≥rios de gr√°fico </h3><br>  Os gr√°ficos s√£o os mais vulner√°veis ‚Äã‚Äãsocialmente e podem se tornar a fonte do "homem do meio", especialmente se voc√™ usar a solu√ß√£o de estoque.  Primeiro, estamos falando de reposit√≥rios que s√£o expostos via HTTP. <br><br><blockquote>  Definitivamente, voc√™ precisa expor o Helm Repo via HTTPS - essa √© a melhor op√ß√£o e √© barata. </blockquote><br>  Preste aten√ß√£o ao <strong>mecanismo de assinaturas de gr√°ficos</strong> .  A tecnologia √© simples de desonrar.  √â a mesma coisa que voc√™ usa no GitHub, a m√°quina PGP usual com chaves p√∫blicas e privadas.  Configure e tenha certeza, com as chaves necess√°rias e assinando tudo, esse √© realmente o seu gr√°fico. <br><br>  Al√©m disso, o <strong>cliente Helm suporta TLS</strong> (n√£o no sentido de HTTP do lado do servidor, mas TLS m√∫tuo).  Voc√™ pode usar chaves de servidor e cliente para se comunicar.  Francamente, eu n√£o uso esse mecanismo por causa de avers√£o a certificados m√∫tuos.  Em princ√≠pio, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">chartmuseum</a> - a principal ferramenta de exposi√ß√£o do Helm Repo para o Helm 2 - tamb√©m suporta autentica√ß√£o b√°sica.  Voc√™ pode usar a autentica√ß√£o b√°sica se for mais conveniente e mais calmo. <br><br>  H√° tamb√©m um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">plug-in helm-gcs</a> que permite hospedar reposit√≥rios de gr√°ficos no Google Cloud Storage.  Isso √© bastante conveniente, funciona muito bem e √© bastante seguro, porque todos os mecanismos descritos s√£o utilizados. <br><br><img src="https://habrastorage.org/webt/zo/e9/io/zoe9iooiuwjc6ccwy3lcghxlsyo.jpeg"><br><br>  Se voc√™ ativar o HTTPS ou TLS, usar o mTLS, conectar a autentica√ß√£o b√°sica para reduzir ainda mais os riscos, obter√° um canal de comunica√ß√£o seguro Helm CLI e Chart Repo. <br><br><h3>  API do gRPC </h3><br>  O pr√≥ximo passo √© muito respons√°vel - proteger o Tiller, que est√° no cluster e, por um lado, o servidor, por outro, acessa os outros componentes e tenta se apresentar como algu√©m. <br><br>  Como eu disse, o Tiller √© um servi√ßo que exp√µe o gRPC, um cliente Helm chega a ele via gRPC.  Por padr√£o, √© claro, o TLS est√° desativado.  Por que isso √© feito √© uma pergunta discut√≠vel, parece-me simplificar a configura√ß√£o no in√≠cio. <br><br><blockquote>  Para produ√ß√£o e mesmo para prepara√ß√£o, recomendo ativar o TLS no gRPC. </blockquote><br>  Na minha opini√£o, diferentemente do mTLS para gr√°ficos, isso √© apropriado aqui e √© feito com muita simplicidade - gere uma infraestrutura PQI, crie um certificado, inicie o Tiller, transfira o certificado durante a inicializa√ß√£o.  Depois disso, voc√™ pode executar todos os comandos do Helm, parecendo ser um certificado e uma chave privada gerados. <br><br><img src="https://habrastorage.org/webt/tg/rp/lt/tgrpltlna0hqfdviwfffe4is9ym.jpeg"><br><br>  Assim, voc√™ se proteger√° de todos os pedidos ao Tiller de fora do cluster. <br><br>  Assim, protegemos o canal de conex√£o com o Tiller, j√° discutimos o RBAC e ajustamos os direitos do Kubernetes apiserver, reduzimos o dom√≠nio com o qual ele pode interagir. <br><br><h2>  Elmo Protegido </h2><br>  Vejamos o diagrama final.  Essa √© a mesma arquitetura com as mesmas setas. <br><br><img src="https://habrastorage.org/webt/4h/j2/_7/4hj2_7hltplw1nsfktdw11dly4i.jpeg"><br><br>  Todas as conex√µes agora podem ser pintadas com seguran√ßa em verde: <br><br><ul><li>  para o Chart Repo, usamos TLS ou mTLS e autentica√ß√£o b√°sica; </li><li>  mTLS para Tiller, e √© exposto como um servi√ßo de gRPC com TLS, usamos certificados; </li><li>  o cluster usa uma conta de servi√ßo especial com Role e RoleBinding. </li></ul><br>  Protegemos marcadamente o cluster, mas algu√©m inteligente disse: <br><br><blockquote>  "S√≥ pode haver uma solu√ß√£o absolutamente segura - o computador est√° desligado, que est√° em uma caixa de concreto e √© guardado por soldados". </blockquote><br>  Existem diferentes maneiras de manipular dados e encontrar novos vetores de ataque.  No entanto, estou confiante de que essas recomenda√ß√µes permitir√£o a implementa√ß√£o de um padr√£o b√°sico de seguran√ßa da ind√∫stria. <br><br><h2>  B√¥nus </h2><br>  Esta parte n√£o est√° diretamente relacionada √† seguran√ßa, mas tamb√©m ser√° √∫til.  Vou mostrar algumas coisas interessantes que poucas pessoas conhecem.  Por exemplo, como procurar gr√°ficos - oficiais e n√£o oficiais. <br><br>  O reposit√≥rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github.com/helm/charts</a> agora possui cerca de 300 gr√°ficos e dois fluxos: est√°vel e incubadora.  O colaborador sabe o qu√£o dif√≠cil √© passar da incubadora para a est√°vel e como √© f√°cil sair da est√°vel.  No entanto, essa n√£o √© a melhor ferramenta para procurar gr√°ficos para o Prometheus e tudo o que voc√™ gosta por um motivo simples n√£o √© um portal no qual √© conveniente pesquisar pacotes. <br><br>  Mas h√° um servi√ßo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hub.helm.sh</a> com o qual √© muito mais conveniente encontrar gr√°ficos.  Mais importante ainda, existem muitos mais reposit√≥rios externos e quase 800 charots est√£o dispon√≠veis.  Al√©m disso, voc√™ pode conectar seu reposit√≥rio se, por algum motivo, n√£o desejar enviar seus gr√°ficos para est√°veis. <br><br>  Experimente o hub.helm.sh e vamos desenvolv√™-lo juntos.  Esse servi√ßo est√° no projeto Helm, e voc√™ pode at√© contribuir com sua interface do usu√°rio se for um fornecedor front-end e quiser simplesmente melhorar a apar√™ncia. <br><br>  Tamb√©m quero chamar sua aten√ß√£o para a <strong>integra√ß√£o da API</strong> do <strong>Open Service Broker</strong> .  Parece complicado e incompreens√≠vel, mas resolve os problemas que todos enfrentam.  Vou explicar com um exemplo simples. <br><br><img src="https://habrastorage.org/webt/sv/ry/gq/svrygqjzgdcxc_sf5rrrdc2b70g.jpeg"><br><br>  H√° um cluster Kubernetes no qual queremos executar o aplicativo cl√°ssico - WordPress.  Como regra, √© necess√°rio um banco de dados para funcionalidade completa.  Existem muitas solu√ß√µes diferentes, por exemplo, voc√™ pode iniciar seu servi√ßo completo.  Isso n√£o √© muito conveniente, mas muitos o fazem. <br><br>  Outros, como n√≥s no Chainstack, usam bancos de dados gerenciados, como MySQL ou PostgreSQL, para servidores.  Portanto, nossos bancos de dados est√£o localizados em algum lugar da nuvem. <br><br>  Mas surge um problema: voc√™ precisa conectar nosso servi√ßo ao banco de dados, criar um banco de dados de sabor, passar credenciais e de alguma forma gerenci√°-lo.  Tudo isso geralmente √© feito manualmente pelo administrador ou desenvolvedor do sistema.  E n√£o h√° problema quando existem poucos aplicativos.  Quando h√° muitos, voc√™ precisa de uma combina√ß√£o.  Existe essa combina√ß√£o - este √© o Service Broker.  Ele permite que voc√™ use um plug-in especial no cluster de nuvem p√∫blica e solicite recursos do provedor por meio do Broker, como se fosse uma API.  Voc√™ pode usar as ferramentas nativas do Kubernetes para isso. <br><br>  √â muito simples  Voc√™ pode consultar, por exemplo, o MySQL gerenciado no Azure com uma camada base (isso pode ser personalizado).  Usando a API do Azure, a base ser√° criada e preparada para uso.  Voc√™ n√£o precisa interferir nisso, o plugin √© respons√°vel por isso.  Por exemplo, o OSBA (plug-in do Azure) retornar√° credenciais ao servi√ßo e passar√° para o Helm.  Voc√™ pode usar o WordPress com MySQL nublado, n√£o lida com bancos de dados gerenciados e n√£o se preocupe com servi√ßos estatais internos. <br><br><blockquote>  Podemos dizer que o Helm atua como uma cola, que por um lado permite implantar servi√ßos e, por outro lado, consome os recursos dos provedores de nuvem. </blockquote><br>  Voc√™ pode escrever seu pr√≥prio plug-in e usar toda essa hist√≥ria local.  Ent√£o voc√™ s√≥ tem seu pr√≥prio plug-in para o provedor corporativo de nuvem.  Eu recomendo que voc√™ tente essa abordagem, especialmente se voc√™ tiver uma grande escala e quiser implantar rapidamente um desenvolvedor, teste ou toda a infraestrutura de um recurso.  Isso facilitar√° a vida de suas opera√ß√µes ou DevOps. <br><br>  Outra descoberta que eu j√° mencionei √© o <strong>plug-in helm-gcs</strong> , que permite usar os buckets do Google (armazenamento de objetos) para armazenar gr√°ficos Helm. <br><br><img src="https://habrastorage.org/webt/gp/id/ln/gpidlnzmqfrnh4kswxi9obliphk.jpeg"><br><br>  S√£o necess√°rios apenas quatro comandos para come√ßar a us√°-lo: <br><br><ol><li>  instale o plugin; </li><li>  inicie-o; </li><li>  defina o caminho para bucket, localizado no gcp; </li><li>  publicar gr√°ficos de maneira padr√£o. </li></ol><br>  A vantagem √© que o m√©todo gcp nativo para autoriza√ß√£o ser√° usado.  Voc√™ pode usar uma conta de servi√ßo, uma conta de desenvolvedor - qualquer coisa.  √â muito conveniente e n√£o custa nada para operar.  Se voc√™, como eu, defende a filosofia opsless, isso ser√° muito conveniente, especialmente para equipes pequenas. <br><br><h2>  Alternativas </h2><br>  Helm n√£o √© a √∫nica solu√ß√£o de gerenciamento de servi√ßos.  H√° muitas perguntas para ele, e √© provavelmente por isso que a terceira vers√£o apareceu t√£o rapidamente.  Claro que existem alternativas. <br><br>  Pode ser como solu√ß√µes especializadas, por exemplo, Ksonnet ou Metaparticle.  Voc√™ pode usar suas ferramentas cl√°ssicas de gerenciamento de infraestrutura (Ansible, Terraform, Chef, etc.) para os mesmos fins que falei. <br><br>  Por fim, existe a solu√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Operator Framework</a> , cuja popularidade est√° crescendo. <br><br><blockquote>  A Estrutura do Operador √© a principal alternativa do Helm √† qual voc√™ deve prestar aten√ß√£o. </blockquote><br>  √â mais nativo para CNCF e Kubernetes, <strong>mas o limite de entrada √© muito maior</strong> , voc√™ precisa programar mais e descrever menos manifestos. <br><br>  Existem v√°rios addons, como Draft, Scaffold.  Eles simplificam bastante a vida, por exemplo, os desenvolvedores simplificam o ciclo de envio e lan√ßamento do Helm para implantar um ambiente de teste.  Eu os chamaria de extensores de oportunidades. <br><br>  Aqui est√° um gr√°fico visual de onde est√° localizado. <br><br><img src="https://habrastorage.org/webt/x8/jl/f3/x8jlf3pejoqjp5b-lj9y2l9r6q0.jpeg"><br><br>  No eixo x, o n√≠vel de seu controle pessoal sobre o que est√° acontecendo, no eixo y, o n√≠vel de natividade dos Kubernetes.  A vers√£o 2 do leme est√° em algum lugar no meio.  Na vers√£o 3, n√£o √© colossal, mas o controle e o n√≠vel de natividade s√£o aprimorados.  As solu√ß√µes no n√≠vel Ksonnet ainda s√£o inferiores at√© ao Helm 2. No entanto, vale a pena dar uma olhada para saber o que mais h√° neste mundo.  Obviamente, seu gerenciador de configura√ß√£o estar√° sob seu controle, mas absolutamente n√£o √© nativo do Kubernetes. <br><br>  A Estrutura do Operador √© absolutamente nativa do Kubernetes e permite que voc√™ gerencie-a de maneira muito mais elegante e meticulosa (mas lembre-se do n√≠vel de entrada).  Em vez disso, √© adequado para um aplicativo especializado e cria um gerenciamento para ele, em vez de um coletor de massa para embalar um grande n√∫mero de aplicativos usando o Helm. <br><br>  Os extensores simplesmente melhoram um pouco o controle, complementam o fluxo de trabalho ou cortam os cantos dos pipelines de CI / CD. <br><br><h2>  O futuro do Helm </h2><br>  A boa not√≠cia √© que o Helm 3. est√° aparecendo. A vers√£o alfa do Helm 3.0.0-alpha.2 j√° foi lan√ßada, voc√™ pode tentar.  √â bastante est√°vel, mas a funcionalidade ainda √© limitada. <br><br>  Por que voc√™ precisa do Helm 3?  Primeiro de tudo, esta √© a hist√≥ria do <strong>desaparecimento de Tiller</strong> , como um componente.  Isso, como voc√™ j√° entende, √© um grande passo √† frente, porque tudo √© simplificado do ponto de vista da seguran√ßa arquitetural. <br><br>  Quando o Helm 2 foi criado, durante o Kubernetes 1.8 ou mesmo anterior, muitos conceitos eram imaturos.  Por exemplo, o conceito de CRD est√° sendo implementado ativamente e o Helm <strong>usar√° o CRD</strong> para armazenar estruturas.  Ser√° poss√≠vel usar apenas o cliente e n√£o manter o lado do servidor.  Portanto, use comandos nativos do Kubernetes para trabalhar com estruturas e recursos.  Este √© um grande passo em frente. <br><br>  <strong>O suporte para reposit√≥rios OCI nativos</strong> (Open Container Initiative) ser√° exibido.  Essa √© uma iniciativa enorme, e Helm √© interessante principalmente para publicar seus gr√°ficos.  Chega ao ponto que, por exemplo, o Docker Hub suporta muitos padr√µes OCI.  N√£o me pergunto, mas talvez os fornecedores cl√°ssicos de reposit√≥rios do Docker comecem a lhe dar a oportunidade de colocar seus gr√°ficos Helm para voc√™. <br><br>  Uma hist√≥ria controversa para mim √© <strong>o suporte de Lua</strong> como um mecanismo de modelagem para escrever scripts.  Eu n√£o sou um grande f√£ de Lua, mas ser√° um recurso completamente opcional.  Eu verifiquei 3 vezes - usar Lua n√£o ser√° necess√°rio.  Portanto, qualquer pessoa que queira usar Lua, algu√©m que goste de Go, entre no nosso enorme acampamento e use o go-tmpl para isso. <br><br>  ,      ‚Äî  <strong>     </strong> .      int  string,        .  JSONS-,       values. <br><br>     <strong>event-driven model</strong> .    .    Helm 3,  ,         ,    ,   ,         . <br><br> Helm 3  ,     ,     Helm 2,    Kubernetes   . , Helm    Kubernetes        Kubernetes. <br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outra boa not√≠cia √© que no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DevOpsConf,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alexander Khayorov </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lhe</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dir√° </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">se os cont√™ineres podem ser seguros? </font></a><font style="vertical-align: inherit;">Lembre-se, uma confer√™ncia sobre a integra√ß√£o dos processos de desenvolvimento, teste e opera√ß√£o ser√° realizada em Moscou, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em 30 de setembro e 1¬∫ de outubro</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">At√© 20 de agosto, voc√™ ainda pode </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enviar um relat√≥rio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e falar sobre sua experi√™ncia na solu√ß√£o de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uma das muitas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tarefas da abordagem do DevOps. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Siga os pontos de verifica√ß√£o e not√≠cias da confer√™ncia no </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">canal de </font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">boletim</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">telegrama</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt462665/">https://habr.com/ru/post/pt462665/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt462655/index.html">Digite seu c√≥digo finalmente</a></li>
<li><a href="../pt462657/index.html">SkyRC B6 Nano Carregador revis√£o e teste</a></li>
<li><a href="../pt462659/index.html">Introdu√ß√£o ao Analisador Est√°tico PVS-Studio para Desenvolvimento C ++ no Linux</a></li>
<li><a href="../pt462661/index.html">Familiaridade com o analisador est√°tico PVS-Studio ao desenvolver programas C ++ no Linux</a></li>
<li><a href="../pt462663/index.html">Nadar, dan√ßar (!) E balan√ßar: que atividades eu quero</a></li>
<li><a href="../pt462667/index.html">Galaxy Guide DevOpsConf 2019</a></li>
<li><a href="../pt462671/index.html">Infraestrutura da empresa como produto</a></li>
<li><a href="../pt462673/index.html">Pedra, tesoura, papel, entrevistas de emprego, Spock</a></li>
<li><a href="../pt462675/index.html">Decep√ß√£o da informa√ß√£o</a></li>
<li><a href="../pt462677/index.html">Vepp - novo painel de controle de servidor e site do ISPsystem</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>