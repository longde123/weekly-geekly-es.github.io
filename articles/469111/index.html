<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëº üíÖüèº ü¶ï Reemplazar objeto con var: ¬øqu√© podr√≠a salir mal? üôãüèº üïØÔ∏è üßõüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recientemente me encontr√© con una situaci√≥n en la que reemplazar Object por var en un programa Java 10 arroja una excepci√≥n en tiempo de ejecuci√≥n. Me...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Reemplazar objeto con var: ¬øqu√© podr√≠a salir mal?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469111/"><p> Recientemente me encontr√© con una situaci√≥n en la que reemplazar Object por var en un programa Java 10 arroja una excepci√≥n en tiempo de ejecuci√≥n.  Me preguntaba cu√°ntas formas diferentes de lograr este efecto, y abord√© este problema a la comunidad: </p><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1174191219620089856"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br><p>  Result√≥ que puedes lograr el efecto de diferentes maneras.  Aunque todos son un poco complicados, es interesante recordar las diversas sutilezas del lenguaje con el ejemplo de tal tarea.  Veamos qu√© m√©todos se encontraron. </p><a name="habracut"></a><br><h2 id="uchastniki">  Miembros </h2><br><p>  Entre los encuestados hab√≠a muchas personas famosas y no muy personas.  Este es Sergey <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">bsideup</a> Egorov, empleado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">fundamental</a> , orador, uno de los creadores de Testcontainers.  Este es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Victor Polishchuk</a> , famoso por los informes sobre la sangrienta empresa.  Tambi√©n se√±al√≥ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Nikita Artyushov</a> de Google;  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Dmitry Mikhailov</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Maccimo</a> .  Pero estuve especialmente encantado con la llegada de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Wouter Coekaerts</a> .  Es conocido por su <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo el a√±o pasado</a> , donde camin√≥ a trav√©s del sistema de tipos Java y cont√≥ cu√°n irremediablemente estaba roto.  Parte de este art√≠culo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">jbaruch</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">yo</a> incluso lo utilizamos en la cuarta versi√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Java Puzzlers</a> . </p><br><h2 id="zadacha-i-resheniya">  Tarea y soluciones </h2><br><p> Entonces, la esencia de nuestra tarea es esta: hay un programa Java en el que hay una declaraci√≥n de una variable de la forma <code>Object x = ...</code> (honesto est√°ndar <code>java.lang.Object</code> , sin sustituciones de tipo).  El programa compila, ejecuta e imprime algo como "Ok".  Reemplazamos <code>Object</code> con <code>var</code> , lo que requiere inferencia de tipo autom√°tica, despu√©s de lo cual el programa contin√∫a compilando, pero se bloquea al iniciarse con una excepci√≥n. </p><br><p>  Las soluciones se pueden dividir aproximadamente en dos grupos.  En el primero, despu√©s de reemplazar con var, la variable se vuelve primitiva (es decir, originalmente era autoboxing).  El segundo tipo sigue siendo objeto, pero m√°s espec√≠fico que <code>Object</code> .  Aqu√≠ puede resaltar un subgrupo interesante que usa gen√©ricos. </p><br><h3 id="boksing">  Boxeo </h3><br><p>  ¬øC√≥mo distinguir un objeto de un primitivo?  Hay muchas formas diferentes.  Lo m√°s f√°cil es verificar la identidad.  Esta soluci√≥n fue propuesta por Nikita: </p><br><pre> <code class="java hljs">Object x = <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x == <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Integer(<span class="hljs-number"><span class="hljs-number">1000</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Error(); System.out.println(<span class="hljs-string"><span class="hljs-string">"Ok"</span></span>);</code> </pre> <br><p>  Cuando <code>x</code> es un objeto, ciertamente no puede ser igual en referencia al nuevo objeto <code>new Integer(1000)</code> .  Y si es un primitivo, de acuerdo con las reglas del lenguaje, el <code>new Integer(1000)</code> se despliega inmediatamente en un primitivo tambi√©n, y los n√∫meros se comparan como primitivos. </p><br><p>  Otra forma son los m√©todos sobrecargados.  Puede escribir el suyo, pero Sergey ide√≥ una opci√≥n m√°s elegante: usar la biblioteca est√°ndar.  El m√©todo <code>List.remove</code> es <code>List.remove</code> , que est√° sobrecargado y puede eliminar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un elemento por √≠ndice</a> si se pasa una primitiva o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un elemento por valor</a> si se pasa un objeto.  Esto ha llevado repetidamente a errores en programas reales si usa <code>List&lt;Integer&gt;</code> .  Para nuestra tarea, la soluci√≥n puede verse as√≠: </p><br><pre> <code class="java hljs">Object x = <span class="hljs-number"><span class="hljs-number">1000</span></span>; List&lt;?&gt; list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); list.remove(x); System.out.println(<span class="hljs-string"><span class="hljs-string">"Ok"</span></span>);</code> </pre> <br><p>  Ahora estamos tratando de eliminar el elemento inexistente 1000 de la lista vac√≠a, esto es solo una acci√≥n in√∫til.  Pero si reemplazamos <code>Object</code> por <code>var</code> , llamaremos a otro m√©todo que elimine el elemento con el √≠ndice 1000. Y esto ya conduce a <code>IndexOutOfBoundsException</code> . </p><br><p>  El tercer m√©todo es el operador de conversi√≥n de tipo.  Podemos convertir con √©xito otro primitivo en un tipo primitivo, pero un objeto se convierte solo si hay un contenedor sobre el mismo tipo al que convertiremos (entonces ocurrir√° un encajonamiento).  En realidad, necesitamos el efecto contrario: una excepci√≥n es en el caso de un primitivo, y no en el caso de un objeto, pero usando try-catch esto es f√°cil de lograr, lo que Viktor us√≥: </p><br><pre> <code class="java hljs">Object x = <span class="hljs-number"><span class="hljs-number">40</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Error(<span class="hljs-string"><span class="hljs-string">"Oops :"</span></span> + (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>)x); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ClassCastException e) { System.out.println(<span class="hljs-string"><span class="hljs-string">"Ok"</span></span>); }</code> </pre> <br><p>  Aqu√≠, <code>ClassCastException</code> es el comportamiento esperado, luego el programa sale normalmente.  Pero despu√©s de usar <code>var</code> esta excepci√≥n desaparece y arrojamos algo m√°s.  Me pregunto si esto est√° inspirado en el c√≥digo real de la empresa sangrienta? .. </p><br><p>  Wouter propuso otra opci√≥n de conversi√≥n de tipo.  Puedes usar la extra√±a l√≥gica del operador <code>?:</code> .  Es cierto que su c√≥digo solo da resultados diferentes, por lo que debe modificarlo de alguna manera para que haya una excepci√≥n.  Entonces, me parece, con bastante elegancia: </p><br><pre> <code class="java hljs">Object x = <span class="hljs-number"><span class="hljs-number">1.0</span></span>; System.out.println(String.valueOf(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span> ? x : <span class="hljs-number"><span class="hljs-number">100000000000L</span></span>).substring(<span class="hljs-number"><span class="hljs-number">12</span></span>) + <span class="hljs-string"><span class="hljs-string">"Ok"</span></span>);</code> </pre> <br><p>  La diferencia entre este m√©todo es que no usamos el valor de <code>x</code> directamente, pero ¬øel tipo <code>x</code> afecta el tipo de expresi√≥n <code>false ? x : 100000000000L</code>  <code>false ? x : 100000000000L</code> .  Si <code>x</code> es un <code>Object</code> , entonces el tipo de la expresi√≥n completa es <code>Object</code> , y luego solo tenemos el boxeo, <code>String.valueOf()</code> cadena de <code>100000000000</code> , para la cual la <code>substring(12)</code> es una cadena vac√≠a.  Si usa <code>var</code> , entonces el tipo <code>x</code> convierte en <code>double</code> y, por lo tanto, el tipo <code>false ? x : 100000000000L</code>  <code>false ? x : 100000000000L</code> tambi√©n <code>false ? x : 100000000000L</code> <code>double</code> , es decir, <code>100000000000L</code> se convertir√° en <code>1.0E11</code> , donde tiene mucho menos de 12 caracteres, por lo que llamar a la <code>substring</code> conduce a una <code>StringIndexOutOfBoundsException</code> . </p><br><p>  Finalmente, aprovechamos el hecho de que una variable se puede cambiar despu√©s de la creaci√≥n.  Y en la variable de objeto, a diferencia de la primitiva, puede poner <code>null</code> .  Poner <code>null</code> en una variable es f√°cil; hay muchas formas.  Pero aqu√≠, Wouter tambi√©n adopt√≥ un enfoque creativo utilizando el rid√≠culo m√©todo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>Integer.getInteger</code></a> : </p><br><pre> <code class="java hljs">Object x = <span class="hljs-number"><span class="hljs-number">1</span></span>; x = Integer.getInteger(<span class="hljs-string"><span class="hljs-string">"moo"</span></span>); System.out.println(<span class="hljs-string"><span class="hljs-string">"Ok"</span></span>);</code> </pre> <br><p>  No todos saben que este m√©todo lee una propiedad del sistema llamada <code>moo</code> y, si hay una, intenta convertirla en un n√∫mero, de lo contrario, devuelve <code>null</code> .  Si no hay ninguna propiedad, asignamos silenciosamente <code>null</code> al objeto, pero caemos de <code>NullPointerException</code> cuando intentamos asignarlo a una primitiva (el anboxing autom√°tico ocurre all√≠).  Podr√≠a haber sido m√°s f√°cil, por supuesto.  Versi√≥n aproximada <code>x = null;</code>  no se arrastra, no se compila, pero el compilador lo tragar√° ahora: </p><br><pre> <code class="java hljs">Object x = <span class="hljs-number"><span class="hljs-number">1</span></span>; x = (Integer)<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; System.out.println(<span class="hljs-string"><span class="hljs-string">"Ok"</span></span>);</code> </pre> <br><h3 id="obektnyy-tip">  Tipo de objeto </h3><br><p>  Supongamos que ya no puedes jugar con primitivos.  ¬øQu√© m√°s se te ocurre? </p><br><p>  Bueno, en primer lugar, el m√©todo de sobrecarga de m√©todo m√°s simple propuesto por Dmitry: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Object x = <span class="hljs-string"><span class="hljs-string">"Ok"</span></span>; sayWhat(x); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sayWhat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object x)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(x); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sayWhat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String x)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Error(); }</code> </pre> <br><p>  La vinculaci√≥n de m√©todos sobrecargados en Java ocurre est√°ticamente, en la etapa de compilaci√≥n.  El m√©todo sayWhat <code>sayWhat(Object)</code> se <code>sayWhat(Object)</code> , pero si inferimos el tipo <code>x</code> autom√°ticamente, <code>String</code> <code>sayWhat(String)</code> la <code>String</code> y, por lo tanto, se vincular√° el m√©todo <code>sayWhat(String)</code> m√°s espec√≠fico. </p><br><p>  Otra forma de hacer una llamada ambigua en Java es utilizando argumentos variables (varargs).  Wouter record√≥ esto nuevamente: </p><br><pre> <code class="java hljs">Object x = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object[] {}; Arrays.asList(x).get(<span class="hljs-number"><span class="hljs-number">0</span></span>); System.out.println(<span class="hljs-string"><span class="hljs-string">"Ok"</span></span>);</code> </pre> <br><p>  Cuando el tipo de variable es <code>Object</code> , el compilador piensa que es un argumento variable y envuelve la matriz en otra matriz de un elemento, por lo que <code>get()</code> cumple con √©xito.  Si usa <code>var</code> , <code>Object[]</code> muestra el tipo <code>Object[]</code> y no habr√° ajuste adicional.  De esta manera obtenemos una lista vac√≠a, y la llamada <code>get()</code> fallar√°. </p><br><p>  Maccimo eligi√≥ hardcore: decidi√≥ llamar a <code>println</code> trav√©s de la API MethodHandle: </p><br><pre> <code class="java hljs">Object x = <span class="hljs-string"><span class="hljs-string">"Ok"</span></span>; MethodHandles.Lookup lookup = MethodHandles.lookup(); MethodHandle mh = lookup.findVirtual( PrintStream.class, <span class="hljs-string"><span class="hljs-string">"println"</span></span>, MethodType.methodType(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>.class, Object.class)); mh.invokeExact(System.out, x);</code> </pre> <br><p>  El m√©todo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>invokeExact</code></a> y varios otros m√©todos del <code>java.lang.invoke</code> tienen la llamada "firma polim√≥rfica".  Aunque se declara como el m√©todo habitual vararg <code>invokeExact(Object... args)</code> , no ocurre en el empaquetado de matriz est√°ndar.  En cambio, se genera una firma en el c√≥digo de bytes que coincide con los tipos de argumentos realmente pasados.  El m√©todo <code>invokeExact</code> dise√±ado para la invocaci√≥n s√∫per r√°pida de identificadores de m√©todos, por lo que no realiza transformaciones de argumentos est√°ndar como la conversi√≥n o el boxeo.  Se espera que el tipo de m√©todo de manejo coincida exactamente con la firma de la llamada.  Esto se verifica en tiempo de ejecuci√≥n y, como en el caso de <code>var</code> coincidencia se rompe, obtenemos una <code>WrongMethodTypeException</code> . </p><br><h3 id="dzheneriki">  Gen√©ricos </h3><br><p>  Por supuesto, la parametrizaci√≥n de tipos puede agregar un brillo a cualquier tarea en Java.  Dmitry trajo una soluci√≥n similar al c√≥digo que encontr√© inicialmente.  La decisi√≥n de Dmitry es detallada, por lo que mostrar√© mi: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Object x = foo(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder()); System.out.println(x); } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T x)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T)<span class="hljs-string"><span class="hljs-string">"Ok"</span></span>; }</code> </pre> <br><p>  El tipo <code>T</code> se emite como <code>StringBuilder</code> , pero en este c√≥digo no se requiere que el compilador inserte una verificaci√≥n de tipo en el dial-peer en el c√≥digo de bytes.  Es suficiente para √©l que <code>StringBuilder</code> se pueda asignar a <code>Object</code> , lo que significa que todo est√° bien.  Nadie est√° en contra del hecho de que el m√©todo con el valor de retorno <code>StringBuilder</code> realidad devolvi√≥ la cadena si de todos modos asign√≥ el resultado a una variable de tipo <code>Object</code> .  El compilador honestamente advierte que tienes un elenco sin control, lo que significa que se lava las manos.  Sin embargo, cuando se reemplaza <code>x</code> con <code>var</code> tipo <code>x</code> tambi√©n se muestra como <code>StringBuilder</code> , y ya no es posible sin la verificaci√≥n de tipo, porque asignar algo m√°s a la variable de tipo <code>StringBuilder</code> tiene valor.  Como resultado, despu√©s de cambiar a <code>var</code> programa se bloquea de forma segura con una <code>ClassCastException</code> . </p><br><p>  Wouter sugiri√≥ una variante de esta soluci√≥n utilizando m√©todos est√°ndar: </p><br><pre> <code class="java hljs">Object o = ((List&lt;String&gt;)(List)List.of(<span class="hljs-number"><span class="hljs-number">1</span></span>)).get(<span class="hljs-number"><span class="hljs-number">0</span></span>); System.out.println(<span class="hljs-string"><span class="hljs-string">"Ok"</span></span>);</code> </pre> <br><p>  Finalmente, otra opci√≥n de Wouter: </p><br><pre> <code class="java hljs">Object x = <span class="hljs-string"><span class="hljs-string">""</span></span>; TreeSet&lt;?&gt; set = Stream.of(x) .collect(toCollection(() -&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TreeSet&lt;&gt;((a, b) -&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>))); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (set.contains(<span class="hljs-number"><span class="hljs-number">1</span></span>)) { System.out.println(<span class="hljs-string"><span class="hljs-string">"Ok"</span></span>); }</code> </pre> <br><p>  Aqu√≠, dependiendo del uso de <code>var</code> u <code>Object</code> el tipo de flujo se muestra como <code>Stream&lt;Object&gt;</code> o como <code>Stream&lt;String&gt;</code> .  En consecuencia, se <code>TreeSet</code> tipo <code>TreeSet</code> y el tipo lambda comparador.  En el caso de <code>var</code> , las cadenas deben llegar al lambda, por lo que al generar una representaci√≥n de tiempo de ejecuci√≥n lambda, se inserta autom√°ticamente una conversi√≥n de tipo, lo que da una <code>ClassCastException</code> al intentar convertir una unidad en una cadena. </p><br><p>  En general, el resultado fue muy aburrido.  Si puede encontrar m√©todos fundamentalmente diferentes para romper <code>var</code> , entonces escriba los comentarios. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/469111/">https://habr.com/ru/post/469111/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../469095/index.html">Lanzamiento de las actualizaciones de ML.NET y Model Builder: novedades</a></li>
<li><a href="../469097/index.html">Servidor web CentOS 8 con php7, node.js y redis</a></li>
<li><a href="../469099/index.html">Tareas de prueba en la entrevista del desarrollador: ¬øtiene sentido?</a></li>
<li><a href="../469101/index.html">Aprender ingl√©s: c√≥mo aprender a hablar como hablante nativo</a></li>
<li><a href="../469109/index.html">Juguetes de madera, tercera parte - 1989</a></li>
<li><a href="../469115/index.html">Gu√≠a Discovery.js: Inicio r√°pido</a></li>
<li><a href="../469117/index.html">Programaci√≥n bajo BC 0010 en 2019</a></li>
<li><a href="../469119/index.html">Las direcciones IPv4 en RIPE han terminado. Completamente terminado ...</a></li>
<li><a href="../469125/index.html">Tema oscuro de Thunderbird como raz√≥n para ejecutar un analizador de c√≥digo</a></li>
<li><a href="../469127/index.html">Optimizaci√≥n o c√≥mo no dispararte en el pie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>