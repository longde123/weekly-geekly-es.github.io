<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôéüèø ‚è∏Ô∏è üêá Actions sur Google: √©crire une application simple pour Google Assistant sur Dialogflow et les fonctions cloud pour Firebase üèáüèæ üö≥ üè¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√Ä la fin du mois dernier, l'assistant Google a officiellement √©t√© publi√© en russe, il est donc temps de comprendre comment cr√©er vos propres applicati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Actions sur Google: √©crire une application simple pour Google Assistant sur Dialogflow et les fonctions cloud pour Firebase</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/419261/">  √Ä la fin du mois dernier, l'assistant Google a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">officiellement √©t√© publi√©</a> en russe, il est donc temps de comprendre comment cr√©er vos propres applications ( <i>actions</i> ) pour l'assistant sur la pile technologique Google standard.  Dans cet article, nous envisagerons de cr√©er une action dans <b>Actions sur Google</b> , d'analyser le processus d'extraction d'entit√©s et d'intentions √† partir de phrases dans <b>Dialogflow</b> , d'apprendre √† √©crire des gestionnaires pour les informations extraites et de travailler avec un r√©seau dans <b>Cloud Functions for Firebase</b> . <br><br><img src="https://habrastorage.org/webt/a0/fj/yq/a0fjyq-er-evhhgkrr8hgbjxqhi.png"><br>  <i>Fig.</i>  <i>1. Architecture d'application pour l'assistant.</i> <br><a name="habracut"></a><br>  Le d√©veloppement de l'Assistant a commenc√© √† se d√©velopper relativement r√©cemment, de sorte que le r√©seau dispose de peu de mat√©riel et le nombre d'outils et de technologies utilis√©s augmente consid√©rablement le seuil d'entr√©e.  Cet article, bien qu'il ne r√©sout pas, mais contribue au moins √† la solution de ces probl√®mes.  Commen√ßons par l'architecture d'application de l'Assistant (Fig.1), impl√©ment√©e sur la pile technologique Google standard: <br><br><ul><li>  <b>Actions sur Google</b> est une plateforme de cr√©ation d'applications pour Google Assistant. </li><li>  <b>Dialogflow</b> - moteur NLU (Natural Language Understanding), responsable du traitement des langues naturelles et des dialogues de conception. </li><li>  <b>Fonctions cloud pour Firebase</b> (pour plus de commodit√©, nous utiliserons l'abr√©viation Firebase Functions) - fonctions cloud pour traiter la logique complexe de l'interaction utilisateur et pour travailler avec des services tiers.  Les fonctions Firebase et Dialogflow interagissent via webhook, donc techniquement toute autre solution serveur peut √™tre utilis√©e.  Cependant, Firebase Functions est une bonne alternative, et parfois un remplacement pour son propre backend.  Il vous permet de cr√©er et d'ex√©cuter des services sur l'infrastructure de Google, sans vous soucier de l'allocation, de la mise √† l'√©chelle ou de la gestion des serveurs.  D'une part, cela vous permet de vous concentrer sur la composante produit du d√©veloppement et des fonctionnalit√©s du service, sans perdre de temps sur les t√¢ches d'infrastructure et l'administration.  Mais d'un autre c√¥t√©, en r√®gle g√©n√©rale, la d√©l√©gation entra√Æne un affaiblissement du contr√¥le de la situation. </li></ul><br>  L'article se concentre sur l'aspect technique du d√©veloppement; le co√ªt d'utilisation des services list√©s ne sera pas analys√©. <br><br><img src="https://habrastorage.org/webt/mb/xq/lu/mbxqlufyd-0svj25q81mlwbzkmk.png"><br>  <i>Fig.</i>  <i>2. Interaction des composants de Google Assistant (Bas√© sur le mat√©riel: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Google Home et Google Assistant Workshop</a> ).</i> <br><br>  Dans la pile d√©crite, la logique d'action ressemble √† ceci (Fig.2): <br><br><ul><li>  L'utilisateur acc√®de √† l'application Google Assistant et initie une conversation avec une action sp√©cifique. </li><li>  L'Assistant Google via des actions sur Google proc√®de √† chaque expression d'utilisateur dans un format texte dans Dialogflow, fournissant √©galement des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">informations sur l'utilisateur lui-m√™me</a> (sur demande pr√©alable et avec le consentement de l'utilisateur) et la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">conversation en cours</a> . </li><li>  Dialogflow traite la phrase re√ßue, en extrait les informations n√©cessaires et, sur la base du ML, prend les d√©cisions concernant la r√©ponse qui sera g√©n√©r√©e. </li><li>  Dans certains cas, Dialogflow peut d√©l√©guer la formation d'une r√©ponse au serveur sur les fonctions Firebase, qui, √† son tour, peuvent utiliser des services tiers pour obtenir les informations n√©cessaires √† la r√©ponse. </li><li>  Une fois la r√©ponse form√©e, Dialogflow la renvoie √† Actions sur Google, d'o√π elle entre dans l'application Google Assistant. </li></ul><br><h2>  Id√©e </h2><br>  Notre action d√©terminera par phrase quel type de gifs l'utilisateur veut voir, puis il les recherchera via l'API GIPHY et les retournera √† l'utilisateur sous forme de cartes.  Lors de la mise en ≈ìuvre de l'action, nous analyserons la solution des t√¢ches suivantes: <br><br><ol><li>  Configurez et liez des actions sur Google, Dialogflow et Firebase Functions. </li><li>  Extraire des mots cl√©s √† partir de phrases utilisateur (Dialogflow) </li><li>  Bo√Æte de dialogue de script (Dialogflow). </li><li>  Travailler avec un contexte de dialogue (Dialogflow). </li><li>  Cr√©ation et connexion d'un webhook pour g√©n√©rer une r√©ponse √† une phrase utilisateur (Dialogflow, Firebase Function). </li><li>  Afficher le carrousel de cartes dans l'interface (Firebase Functions). </li><li>  T√©l√©chargement d'informations √† partir d'un service tiers (fonctions Firebase). </li></ol><br><h2>  Configuration initiale </h2><br><img src="https://habrastorage.org/webt/qz/ib/k6/qzibk6lsuxemwmfzt2bmkpitzoa.png"><br>  <i>Fig.</i>  <i>3. Cr√©ation d'un agent Dialogflow.</i> <br><br>  Tout d'abord, nous avons besoin d'un compte Google.  Commen√ßons par cr√©er un projet dans Dialogflow, pour cela, dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">console,</a> cliquez sur le bouton Cr√©er un agent et remplissez les champs obligatoires (Fig.3): <br><br><ul><li>  La langue par d√©faut est ¬´russe - ru¬ª. </li><li>  Fuseau horaire: "(GMT + 3: 00) Europe / Moscou". </li><li>  Google Cloud Project: un nouveau GCP pour votre agent Dialogflow sera cr√©√© automatiquement, ou vous pouvez choisir l'un des projets GCP existants, le cas √©ch√©ant. </li></ul><br>  Cliquez ensuite sur le bouton Cr√©er dans le coin sup√©rieur droit et attendez que la console configure un nouveau projet. <br><br><img src="https://habrastorage.org/webt/il/wd/gd/ilwdgd0j4u6f9ghzfd6k9dmwtfq.png"><br>  <i>Fig.</i>  <i>4. Intentions standard.</i> <br><br>  Par d√©faut, lors de la cr√©ation d'un agent Dialogflow, deux intentions sont cr√©√©es (Fig.4): <br><br><ul><li>  ¬´Intention de bienvenue par d√©faut¬ª - est responsable de saluer l'utilisateur; </li><li>  ¬´Intention de repli par d√©faut¬ª - traite des phrases inconnues que Dialogflow ne peut attribuer √† aucune autre intention. </li></ul><br>  La cr√©ation de dialogues dans Dialogflow a d√©j√† √©t√© d√©crite en d√©tail dans les articles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> , donc je ne me concentrerai pas sur son principe de fonctionnement. <br><br><img src="https://habrastorage.org/webt/jj/if/sp/jjifspt3awd3uoyao-nxlhdnaco.png"><br>  <i>Fig.</i>  <i>5. R√©ponses pour ¬´Intention de bienvenue par d√©faut¬ª.</i> <br><br>  Nous ajouterons quelques r√©ponses de bienvenue √† l '¬´intention de bienvenue par d√©faut¬ª qui aideront l'utilisateur √† comprendre √† quoi sert l'action et quelles fonctions il peut ex√©cuter.  Dans la section "R√©ponses", s√©lectionnez l'onglet "Assistant Google" et dans les "Suggestions de navires", nous √©crirons des exemples de phrases pour dire √† l'utilisateur comment communiquer avec l'action (Fig. 5). <br><br>  L'action peut √™tre d√©bogu√©e dans Google Assistant √† la fois sur le t√©l√©phone et dans l'√©mulateur officiel.  Pour ouvrir l'√©mulateur, vous devez vous rendre dans la section ¬´Int√©grations¬ª, dans la carte ¬´Assistant Google¬ª, cliquer sur le bouton ¬´Param√®tres d'int√©gration¬ª et cliquer sur ¬´G√©rer l'application Assistant¬ª.  Dans le t√©l√©phone et l'√©mulateur, l'action peut √™tre d√©clench√©e avec la phrase de code "Ok Google, je veux parler avec mon application de test". <br><br><h2>  Sc√©nario de base: recherche GIF </h2><br>  Cr√©ez une nouvelle intention de recherche, qui extraira des mots cl√©s de la phrase de l'utilisateur et les enverra via le serveur de webhook √† Firebase Functions.  Le serveur, √† son tour, utilisant l'API GIPHY trouvera les gifs correspondants et retournera le r√©sultat √† l'utilisateur sous forme de cartes. <br><br><img src="https://habrastorage.org/webt/dc/ig/68/dcig68-xcdbzx8ygmuy83-4xibk.png"><br>  <i>Fig.</i>  <i>6. Ajout de phrases d'entra√Ænement.</i> <br><br>  Pour commencer, nous ajouterons des phrases typiques pour la formation dans la section Phrases de formation (Fig. 6): <br><br><ul><li>  "Je veux voir des girafes danser." </li><li>  "Trouvez l'animashki." </li><li>  "Montrez les sceaux." </li><li>  Montrez-moi les gifs. </li><li>  "Trouvez-moi des √©l√©phants anim√©s." </li><li>  "Afficher les gifs de panda." </li><li>  "Gifs √† rayures de ratons laveurs." </li><li>  "Vous avez des sceaux." </li><li>  "Trouvez les chutes dr√¥les." </li></ul><br><img src="https://habrastorage.org/webt/az/_s/e0/az_se0faydig_odzqvgvh4c0twu.png"><br>  <i>Fig.</i>  <i>7. Extraction des param√®tres du texte.</i> <br><br>  Pour les phrases ajout√©es, notez le param√®tre de recherche que Dialogflow doit s√©lectionner dans le texte.  Dans ce cas, le type de param√®tre le plus appropri√© est <code>@sys.any</code> , car presque toutes les constructions de langage peuvent √™tre utilis√©es comme param√®tre de requ√™te de recherche.  Nous appelons cette <code>query</code> param√®tre et la marquons comme requise (Fig. 7). <br><br><img src="https://habrastorage.org/webt/xt/c_/cy/xtc_cyzai21tbnfysovpupedakg.png"><br>  <i>Fig.</i>  <i>8. La liste des questions directrices.</i> <br><br>  Dans la sous-section ¬´Invites¬ª, nous noterons les questions de clarification que Dialogflow posera s'il ne peut pas extraire des mots cl√©s de la phrase (Fig. 8). <br><br>  Ensuite, descendez dans la section ¬´Ex√©cution¬ª tout en bas de la page (√† ne pas confondre avec la section du m√™me nom dans le menu de gauche).  cliquez sur le bouton "Activer le filtrage complet", puis activez le param√®tre "Activer l'appel de webhook √† cette fin".  Cela permettra √† Dialogflow de d√©l√©guer la formation d'une r√©ponse Firebase Functions lorsqu'elle atteint l'intention. <br><br>  Maintenant, allez dans l'onglet ¬´Ex√©cution¬ª dans le menu de gauche et activez ¬´√âditeur en ligne¬ª, o√π nous √©crirons la logique de la ¬´intention de recherche¬ª nouvellement cr√©√©e.  Pour rechercher des GIF par mots cl√©s, nous utiliserons la demande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://api.giphy.com/v1/gifs/search</a> , qui renvoie une liste des objets trouv√©s au format JSON selon la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sp√©cification</a> .  La r√©ponse re√ßue de GIPHY sera affich√©e sous la forme d'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">carrousel de navigation</a> - un carrousel de cartes avec des images, lorsque vous cliquez dessus, une page Web s'ouvre.  Dans notre cas, lorsque vous cliquez sur la carte, l'utilisateur acc√®de √† la page du service GIPHY avec cette animation et une liste de similaires. <br><br>  Le code qui impl√©mente les fonctionnalit√©s d√©crites ci-dessus est pr√©sent√© ci-dessous. <br><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> GIPHY_API_KEY = <span class="hljs-string"><span class="hljs-string">'API_KEY'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SEARCH_RESULTS = [ <span class="hljs-string"><span class="hljs-string">'-,    .'</span></span>, <span class="hljs-string"><span class="hljs-string">',   .'</span></span>, <span class="hljs-string"><span class="hljs-string">',   !'</span></span> ]; <span class="hljs-comment"><span class="hljs-comment">// Import the Dialogflow module from the Actions on Google client library. const { dialogflow, BrowseCarouselItem, BrowseCarousel, Suggestions, Image } = require('actions-on-google'); // Import the firebase-functions package for deployment. const functions = require('firebase-functions'); // Import the request-promise package for network requests. const request = require('request-promise'); // Instantiate the Dialogflow client. const app = dialogflow({ debug: true }); function getCarouselItems(data) { var carouselItems = []; data.slice(0, 10).forEach(function (gif) { carouselItems.push(new BrowseCarouselItem({ title: gif.title || gif.id, url: gif.url, image: new Image({ url: gif.images.downsized_medium.url, alt: gif.title || gif.id }), })); }); return carouselItems; } function search(conv, query) { // Send the GET request to GIPHY API. return request({ method: 'GET', uri: 'https://api.giphy.com/v1/gifs/search', qs: { 'api_key': GIPHY_API_KEY, 'q': query, 'limit': 10, 'offset': 0, 'lang': 'ru' }, json: true, resolveWithFullResponse: true, }).then(function (responce) { // Handle the API call success. console.log(responce.statusCode + ': ' + responce.statusMessage); console.log(JSON.stringify(responce.body)); // Obtain carousel items from the API call response. var carouselItems = getCarouselItems(responce.body.data); // Validate items count. if (carouselItems.length &lt;= 10 &amp;&amp; carouselItems.length &gt;= 2) { conv.data.query = query; conv.data.searchCount = conv.data.searchCount || 0; conv.ask(SEARCH_RESULTS[conv.data.searchCount % SEARCH_RESULTS.length]); conv.data.searchCount++; conv.ask(new BrowseCarousel({ items: carouselItems })); } else { // Show alternative response. conv.ask('      ,   - ?)'); } }).catch(function (error) { // Handle the API call failure. console.log(error); conv.ask(',     .'); }); } // Handle the Dialogflow intent named 'Search Intent'. // The intent collects a parameter named 'query'. app.intent('Search Intent', (conv, { query }) =&gt; { return search(conv, query); }); // Set the DialogflowApp object to handle the HTTPS POST request. exports.dialogflowFirebaseFulfillment = functions.https.onRequest(app);</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">D√©pendances</b> <div class="spoiler_text"><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"dialogflowFirebaseFulfillment"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"This is the default fulfillment for a Dialogflow agents using Cloud Functions for Firebase"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.0.1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"private"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"license"</span></span>: <span class="hljs-string"><span class="hljs-string">"Apache Version 2.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: <span class="hljs-string"><span class="hljs-string">"Google Inc."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"engines"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"node"</span></span>: <span class="hljs-string"><span class="hljs-string">"~6.0"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"scripts"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: <span class="hljs-string"><span class="hljs-string">"firebase serve --only functions:dialogflowFirebaseFulfillment"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"deploy"</span></span>: <span class="hljs-string"><span class="hljs-string">"firebase deploy --only functions:dialogflowFirebaseFulfillment"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"dependencies"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"actions-on-google"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.0.0-alpha.4"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"firebase-admin"</span></span>: <span class="hljs-string"><span class="hljs-string">"^4.2.1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"firebase-functions"</span></span>: <span class="hljs-string"><span class="hljs-string">"^0.5.7"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"dialogflow"</span></span>: <span class="hljs-string"><span class="hljs-string">"^0.1.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"dialogflow-fulfillment"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.3.0-beta.3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"request"</span></span>: <span class="hljs-string"><span class="hljs-string">"^2.81.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"request-promise"</span></span>: <span class="hljs-string"><span class="hljs-string">"^4.2.1"</span></span> } }</code> </pre> </div></div><br>  √âtant donn√© que l'utilisateur peut acc√©der plusieurs fois √† la m√™me intention, il est recommand√© de lui renvoyer diverses r√©ponses.  Pour ce faire, nous avons utilis√© l'objet JSON <code>Conversation.data</code> , qui conserve sa valeur √† la fois lors de l'acc√®s √† l'intention et lors de la r√©f√©rence √† d'autres scripts de conversation. <br><br><img src="https://habrastorage.org/webt/0m/lo/tp/0mlotpjfiboyxj_qgs5yselugxa.jpeg"><br>  <i>Fig.</i>  <i>9. Initialisation de la conversation (√† gauche), affinement des param√®tres de recherche et affichage ult√©rieur des r√©sultats (au centre), affichage des r√©sultats de recherche pour une nouvelle requ√™te (√† droite)</i> <br><br>  <i>Remarque: pour travailler avec l'API de services tiers via les fonctions Firebase, vous devez activer la facturation, sinon, lorsque vous essayez de travailler avec le r√©seau, une erreur se produit:</i> <blockquote>  <i>"Compte de facturation non configur√©.</i>  <i>Le r√©seau externe n'est pas accessible et les quotas sont s√©v√®rement limit√©s.</i>  <i>Configurez le compte de facturation pour supprimer ces restrictions. "</i> </blockquote>  <i>Pour ce faire, cliquez sur ¬´Compte payant¬ª dans le menu de gauche et s√©lectionnez Flame (25 $ par mois) ou Blaze (payez selon votre utilisation) parmi les plans tarifaires propos√©s.</i>  <i>J'ai choisi la derni√®re option, car dans le cadre du d√©veloppement d'une application de test, elle m'a paru plus rentable.</i> <br><br><h2>  Sc√©nario avanc√©: pagination </h2><br>  Dans la plupart des cas, pour une requ√™te de recherche, GIPHY trouvera beaucoup plus de dix GIF, il sera donc correct de permettre √† l'utilisateur de voir l'int√©gralit√© du r√©sultat de la recherche, c'est-√†-dire  ajouter la pagination. <br><br>  Dans la console Dialogflow, survolez la cellule Intention de recherche.  Plusieurs boutons appara√Ætront √† droite, cliquez sur ¬´Ajouter une intention de suivi¬ª.  Cela nous permettra de cr√©er une branche de conversation suivant l'intention de recherche.  Parmi les √©l√©ments de la liste d√©roulante, nous s√©lectionnons ¬´plus¬ª - un ignent standard pour lancer l'affichage d'informations suppl√©mentaires. <br><br><img src="https://habrastorage.org/webt/zb/26/0_/zb260_tehdtnrqgup4np6aqmjva.png"><br>  <i>Fig.</i>  <i>10. Le contexte de l'intention est ¬´Intention de recherche - plus¬ª.</i> <br><br>  Passons √† l'intention nouvellement cr√©√©e et apportons des modifications √† la section "Contexte".  √âtant donn√© que l'utilisateur peut demander √† afficher plusieurs GIF plusieurs fois de suite, cette intention doit pouvoir √™tre appel√©e de mani√®re r√©cursive.  Pour cela, dans le contexte sortant, il est n√©cessaire d'enregistrer la m√™me ligne que celle indiqu√©e √† l'entr√©e (Fig. 10).  Dans la section ¬´Fullfilment¬ª, vous devez √©galement activer le param√®tre ¬´Activer l'appel de webhook √† cette fin¬ª. <br><br>  Revenons maintenant √† la ¬´Fillfulment¬ª dans le menu lat√©ral, o√π nous initialisons le gestionnaire pour ¬´Search Intent - more¬ª.  Nous ajoutons √©galement le param√®tre <code>offset</code> √† la fonction de <code>search</code> , qui sera utilis√© pour la pagination dans l'API GIPHY. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SEARCH_RESULTS_MORE = [ <span class="hljs-string"><span class="hljs-string">'   !'</span></span>, <span class="hljs-string"><span class="hljs-string">',    .'</span></span>, <span class="hljs-string"><span class="hljs-string">',   .  ,    .'</span></span> ]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">search</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">conv, query, offset</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Send the GET request to GIPHY API. return request({ method: 'GET', uri: 'https://api.giphy.com/v1/gifs/search', qs: { 'api_key': GIPHY_API_KEY, 'q': query, 'limit': 10, 'offset': offset, 'lang': 'ru' }, json: true, resolveWithFullResponse: true, }).then(function (responce) { // Handle the API call success. console.log(responce.statusCode + ': ' + responce.statusMessage); console.log(JSON.stringify(responce.body)); // Obtain carousel items from the API call response. var carouselItems = getCarouselItems(responce.body.data); // Validate items count. if (carouselItems.length &lt;= 10 &amp;&amp; carouselItems.length &gt;= 2) { conv.data.query = query; conv.data.offset = responce.body.pagination.count + responce.body.pagination.offset; conv.data.paginationCount = conv.data.paginationCount || 0; conv.data.searchCount = conv.data.searchCount || 0; // Show successful response. if (offset == 0) { conv.ask(SEARCH_RESULTS[conv.data.searchCount % SEARCH_RESULTS.length]); conv.data.searchCount++; } else { conv.ask(SEARCH_RESULTS_MORE[conv.data.paginationCount % SEARCH_RESULTS_MORE.length]); conv.data.paginationCount++; } conv.ask(new BrowseCarousel({ items: carouselItems })); conv.ask(new Suggestions('')); } else { // Show alternative response. conv.ask('      ,   - ?)'); } }).catch(function (error) { // Handle the API call failure. console.log(error); conv.ask(',     .'); }); } // Handle the Dialogflow intent named 'Search Intent - more'. app.intent('Search Intent - more', (conv) =&gt; { // Load more gifs from the privious search query return search(conv, conv.data.query, conv.data.offset); });</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/rm/t1/fq/rmt1fqdvnbvywl1bsgmmjegxceu.jpeg"><br>  <i>Fig.</i>  <i>11. Pagination lors de la recherche de gifs.</i> <br><br><h2>  R√©sultat </h2><br>  La vid√©o de l'action est pr√©sent√©e ci-dessous. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/FsJu8CQODu8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Code de projet et vidage assistant disponibles sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Github</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Instructions pour installer le projet et importer le vidage</b> <div class="spoiler_text"><ol><li>  Acc√©dez √† la console Dialogflow et cr√©ez un nouvel agent ou s√©lectionnez-en un existant. </li><li>  Cliquez sur l'ic√¥ne des param√®tres, acc√©dez √† la section ¬´Exporter et importer¬ª et cliquez sur le bouton ¬´Restaurer √† partir de ZIP¬ª.  S√©lectionnez le fichier ZIP dans le r√©pertoire racine du r√©f√©rentiel. </li><li>  S√©lectionnez ¬´Ex√©cution¬ª dans le menu de navigation de gauche. </li><li>  Activez le param√®tre ¬´√âditeur en ligne¬ª. </li><li>  Copiez le contenu des fichiers du r√©pertoire des <code>functions</code> dans les onglets appropri√©s de la ¬´R√©alisation¬ª. </li><li>  Saisissez votre cl√© d'acc√®s √† l'API GIPHY dans l'onglet <i>index.js</i> . </li><li>  Acc√©dez √† la console Firebase et changez votre plan en Flame ou Blaze.  Le travail avec des services tiers sur le r√©seau n'est pas disponible avec un plan tarifaire gratuit. </li></ol><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr419261/">https://habr.com/ru/post/fr419261/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr419251/index.html">Diffusion du troisi√®me jour de Slurm: intense sur Kubernetes</a></li>
<li><a href="../fr419253/index.html">Rapport du Club de Rome 2018, Chapitre 3.6: Urbanisme r√©g√©n√©ratif: Ecopolis</a></li>
<li><a href="../fr419255/index.html">Bases de la s√©curit√© IoT</a></li>
<li><a href="../fr419257/index.html">L'Inde pr√©sente un nouveau projet de loi sur la protection des PD - un autre analogue au RGPD?</a></li>
<li><a href="../fr419259/index.html">Rust 1.28 Release</a></li>
<li><a href="../fr419265/index.html">Utiliser un r√©seau neuronal multicouche pour √©viter les obstacles dans les jeux</a></li>
<li><a href="../fr419267/index.html">Visite de Coworking SOK</a></li>
<li><a href="../fr419269/index.html">R√©bus dans le code et comment les d√©crypter. Le pouvoir secret des identifiants</a></li>
<li><a href="../fr419271/index.html">Analogues en Python et JavaScript. Quatri√®me partie</a></li>
<li><a href="../fr419273/index.html">√âcriture d'un module du noyau Linux: GPIO avec prise en charge IRQ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>