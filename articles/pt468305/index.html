<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëàüèª üë∞üèø üéì Fabrica√ß√£o de lua procedural üë¥üèø ü§úüèΩ üí∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="N√£o faz muito tempo, criamos um sistema de cria√ß√£o da lua. Nosso objetivo era criar luas de tamanho e composi√ß√£o semelhantes √†s existentes em nosso si...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fabrica√ß√£o de lua procedural</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468305/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/008/121/e0d/008121e0d8197c4d9d6f6708e536d9ad.png" alt="imagem"></div><br>  N√£o faz muito tempo, criamos um sistema de cria√ß√£o da lua.  Nosso objetivo era criar luas de tamanho e composi√ß√£o semelhantes √†s existentes em nosso sistema solar.  A principal dificuldade era obter as vastas superf√≠cies de tais luas e seu interior, para que, enquanto permanecessem interessantes.  Al√©m disso, precis√°vamos que as luas fossem renderizadas com detalhes claros, independentemente da dist√¢ncia at√© elas. <br><br>  O sistema assume que as luas tenham uma base esf√©rica.  A cria√ß√£o de uma malha geod√©sica √© aplicada √† esfera base, o que garante a mesma √°rea de todas as partes da superf√≠cie.  O sistema aplica essa estrutura apenas como uma grade computacional para gera√ß√£o procedural; a superf√≠cie real da lua ser√° muito mais suave que a grade de gera√ß√£o. <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b16/ef1/c39/b16ef1c39e3002d49b6d30ecb2a36a5e.png"></div><br>  <i>Esfera geod√©sica</i> <br><br>  Para obter pequenas luas irregulares, as formas geom√©tricas b√°sicas s√£o distorcidas pelo ru√≠do 3D de baixa frequ√™ncia. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/39e/971/5de/39e9715de990094a4c155425d6dd9d0f.jpg"></div><br>  <i>Esfera de Inspe√ß√£o distorcida por ru√≠do</i> <br><br>  Come√ßando com essa base, o sistema utiliza uma s√©rie de inv√≥lucros conc√™ntricos.  Cada c√©lula determina as caracter√≠sticas volum√©tricas da casca conc√™ntrica subsequente.  A concha mais externa define as propriedades da superf√≠cie da lua. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ff/e29/a6c/1ffe29a6cb9f66fbcda22b4f1e6d7ac4.jpg"></div><br>  <i>Concha conc√™ntrica</i> <br><br>  Cada revestimento pode ser distorcido pelo ru√≠do 3D de baixa frequ√™ncia exclusivo desse revestimento.  Se voc√™ escolher esta op√ß√£o de gera√ß√£o, o shell interno poder√° ser maior que o externo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/064/56f/4ab/06456f4aba57b3eeab4ebbd25a47978a.png"></div><br>  <i>Distor√ß√£o do casco</i> <br><br>  Nos diagramas acima, a dist√¢ncia entre as conchas e a quantidade de distor√ß√£o √© exagerada para mostrar mais claramente o processo de constru√ß√£o.  Na pr√°tica, as conchas estar√£o muito mais pr√≥ximas umas das outras e a magnitude de sua distor√ß√£o ser√° proporcionalmente menor. <br><br>  Abaixo, falaremos sobre como criar o shell mais externo.  Os mesmos princ√≠pios se aplicam ao criar shells internos, portanto, n√£o os consideraremos em detalhes. <br><br>  Um sistema lua processual requer um componente em tempo real e um componente offline.  O componente em tempo real √© executado no computador do jogador.  O componente offline √© executado nos computadores dos desenvolvedores de jogos.  O componente de gera√ß√£o offline cria informa√ß√µes que podem ser rapidamente complementadas com um componente em tempo real. <br><br>  Cada v√©rtice de uma concha esf√©rica √© classificado como pertencente a um bioma separado.  Um bioma √© um conjunto de propriedades da superf√≠cie, incluindo: altura, distribui√ß√£o de materiais, coloca√ß√£o de amostras e colora√ß√£o de materiais. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/292/18d/4d3/29218d4d3fb1e588fc742ccf46d94e61.jpg"></div><br>  <i>Exemplo de bioma</i> <br><br>  As informa√ß√µes do bioma cont√™m propriedades ricas em entropia, como crateras, mares secos, rachaduras na superf√≠cie causadas por mar√©s gravitacionais. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a10/4cd/a32/a104cda328cc7e51e19a3c321321d64a.jpg"></div><br>  <i>Grande cratera registrada em informa√ß√µes do bioma</i> <br><br>  A defini√ß√£o do bioma tamb√©m cont√©m regras para a coloca√ß√£o de objetos que determinam a localiza√ß√£o, frequ√™ncia e randomiza√ß√£o de pequenas pe√ßas - pedras, paralelep√≠pedos, bordas, etc. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9a8/3bb/76a/9a83bb76a7843923d8774f2e0d2e3754.jpg"></div><br>  <i>Inst√¢ncias de rock</i> <br><br>  Cada bioma √© criado a partir de elementos colocados por ladrilhos (ladrilhos) para que o componente em tempo real possa aplicar as mesmas informa√ß√µes em diferentes partes da lua e em outras luas.  As informa√ß√µes do bioma devem ser geradas de forma que seja poss√≠vel uma r√°pida distor√ß√£o e rearranjo, reduzindo assim o n√∫mero de padr√µes ambientais repetitivos e previs√≠veis. <br><br>  O sistema utiliza dois tipos de blocos de bioma: transit√≥rio e isolado. <br><br>  Informa√ß√µes transit√≥rias dos biomas ocorrem em √°reas onde o bioma passa para o bioma vizinho.  Informa√ß√µes isoladas de biomas ocorrem em √°reas onde o sistema garante a aus√™ncia de biomas vizinhos. <br><br>  Esses dois modos separados s√£o necess√°rios porque alguns elementos dos biomas, por exemplo, crateras, s√≥ podem ser localizados em √°reas onde o bioma n√£o se transfere para outro bioma, porque as transi√ß√µes entre os biomas podem afetar o perfil de altura e a apar√™ncia dos elementos de al√≠vio. <br><br>  Abaixo est√° um exemplo simplificado da lua, que usa tr√™s biomas diferentes: polar, tropical e equatorial, coloridos, respectivamente, em vermelho, azul e verde. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f5d/d51/35f/f5dd5135fa458abddc2384468f770b11.png"></div><br>  <i>Lua com tr√™s biomas</i> <br><br>  √Åreas com um bioma isolado t√™m uma cor uniforme; em √°reas com biomas de transi√ß√£o, as cores se misturam. <br><br>  O sistema utiliza um conjunto de ru√≠do pr√©-calculado para introduzir variabilidade nas zonas de transi√ß√£o entre os biomas, criando transi√ß√µes interessantes e √∫nicas de um bioma para outro. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/abb/a7c/d18/abba7cd18459dccae567bbb832a843fe.png"></div><br>  <i>Ru√≠do processual aplicado √†s transi√ß√µes entre biomas</i> <br><br>  Nas imagens acima, o tamanho de cada por√ß√£o do bioma √© exagerado em rela√ß√£o ao tamanho da lua, para mostrar mais claramente a t√©cnica de cria√ß√£o de biomas.  Um site de bioma separado cobrir√° uma √°rea de aproximadamente 10 por 10 km.  Uma lua com um raio de 1.500 km ter√° uma superf√≠cie de 30.000.000 km <sup>2</sup> .  Para cobrir essa superf√≠cie, seriam necess√°rias quase 300.000 dessas √°reas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/707/9d2/f98/7079d2f982a17f506ab76405a96a14c6.png"></div><br>  <i>Resolu√ß√£o da grade do bioma para a lua com um raio de 1.500 km</i> <br><br>  A resolu√ß√£o da grade do bioma pode levar a um n√∫mero muito grande de sites de biomas.  O sistema n√£o rastrear√° cada um deles individualmente, porque o local de cada site pode ser calculado analiticamente.  Um bioma para a maioria dos sites pode ser atribu√≠do a partir de um mapa de bioma de alto n√≠vel. <br><br>  Os mapas de bioma de alto n√≠vel determinam as principais caracter√≠sticas das luas quando vistas a uma grande dist√¢ncia.  O sistema usa esses mapas para gerar detalhes adicionais de formas mais pr√≥ximas, preservando a uniformidade da defini√ß√£o da lua ao visualizar de diferentes dist√¢ncias. <br><br>  Os mapas de bioma de alto n√≠vel s√£o imagens 2D que podem ser colocadas na superf√≠cie da lua usando a parametriza√ß√£o 2D.  Cada ponto do mapa cont√©m um identificador num√©rico do bioma predominante no local correspondente da superf√≠cie ou concha interna. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/214/4a5/682/2144a56825fc99a706f7498ddddf4c54.png"></div><br>  <i>Mapa bioma 2D</i> <br><br>  A imagem acima mostra um mapa com quatro tipos diferentes de biomas (azul, vermelho, amarelo e branco).  A imagem √© sobreposta √† esfera usando a parametriza√ß√£o 2D.  Uma poss√≠vel parametriza√ß√£o √© mostrada abaixo: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97c/b14/da1/97cb14da1a178f0e11e5925bc6997c40.png"></div><br>  <i>Parametriza√ß√£o 2D para mapa de identifica√ß√£o de biomas</i> <br><br>  Al√©m do mapa identificador do bioma, o sistema permite o uso de outros mapas, por exemplo, contendo alturas e cores da superf√≠cie. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a9/3b5/012/7a93b5012ca67394a4ac79ebbcb6a5e1.png"></div><br>  <i>Longa dist√¢ncia lua sombra e renderiza√ß√£o</i> <br><br>  Um pixel em cada imagem pode cobrir 4 km <sup>2</sup> , tornando sua cria√ß√£o econ√¥mica.  Esses mapas de altura e cor podem ser gerados proceduralmente ou desenhados por artistas.  Em um projeto que usa apenas uma d√∫zia de luas e onde cada lua deve ter propriedades naturais ricas e √∫nicas, √© melhor usar o trabalho de artistas nesta fase. <br><br>  A imagem abaixo mostra o processo de gera√ß√£o da altura da superf√≠cie da bainha e outras propriedades: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/008/121/e0d/008121e0d8197c4d9d6f6708e536d9ad.png"></div><br>  <i>Tr√™s escalas usadas para construir a lua</i> <br><br>  A lua consistir√° em pelo menos uma concha esf√©rica.  Se houver v√°rias cascas, o sistema extrudar√° as cascas internas com base em seu raio m√°ximo e na fun√ß√£o da altura da casca, que √© obtida executando o processo com diferentes escalas descritas acima. <br><br>  Para cada concha, o projetista da lua cria um mapa de alto n√≠vel da distribui√ß√£o dos biomas, defini√ß√µes de biomas para os biomas encontrados neste mapa e identifica√ß√£o dos materiais encontrados nesse bioma. <br><br>  O sistema considera o ar um material aceit√°vel, portanto pode ser usado para criar cavidades em qualquer inv√≥lucro. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/069/94f/db9/06994fdb95020a907fa281bc0e0baf0b.png"></div><br>  <i>Se√ß√£o transversal do relevo da lua, na qual v√°rias conchas s√£o vis√≠veis</i> <br><br>  Um inv√≥lucro separado tamb√©m pode ser um objeto volum√©trico, cuja profundidade √© definida por uma pilha de materiais.  As informa√ß√µes da pilha s√£o armazenadas em um bioma. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d5b/308/002/d5b30800245d119f324fb378ff56d35e.png"></div><br>  <i>Uma pilha de materiais composta por seis materiais</i> <br><br>  Como os materiais subterr√¢neos raramente chegam √† superf√≠cie, eles podem ser descritos com uma resolu√ß√£o muito mais baixa do que os materiais da superf√≠cie dos biomas, e o uso de ru√≠do de procedimento local permanecer√° invis√≠vel para o jogador. <br><br>  A funcionalidade da pilha de materiais pode ser suficiente para o layout, porque alguns materiais na pilha podem ser bastante raros.  O designer do bioma pode personalizar a preval√™ncia e o padr√£o de qualquer material na pilha. <br><br>  A gera√ß√£o de procedimentos √© realizada por shaders de GPU e algoritmos de CPU voxel. <br><br>  O sombreador calcula a cor do fragmento para cada uma das tr√™s escalas e mistura essas amostras, dependendo da dist√¢ncia entre a c√¢mera e o fragmento. <br><br>  Todas as pe√ßas que s√£o pequenas demais para serem registradas na geometria.  mas ainda afetando a complexidade percebida das superf√≠cies, elas s√£o registradas em mapas normais gerados em tempo real, com base na determina√ß√£o processual de materiais, biomas ou mapas de alto n√≠vel para determinar a lua.  Devido a isso, um baixo n√∫mero de pol√≠gonos √© mantido em cena. <br><br>  Voc√™ deve pagar o pre√ßo por isso, desde que a lua esteja vis√≠vel na c√¢mera, o bioma e os mapas de defini√ß√£o de alto n√≠vel devem ser armazenados na GPU.  Voc√™ pode usar o carregamento seletivo apenas das texturas mip necess√°rias para renderizar a escala atual da lua.  A quantidade total de mem√≥ria da GPU necess√°ria √© reduzida ao m√≠nimo devido ao carregamento e descarregamento de streaming da GPU ao alterar a posi√ß√£o do observador. <br><br>  Quando, devido √† proximidade da c√¢mera, elementos individuais se tornam grandes o suficiente, eles come√ßam a aparecer na sa√≠da da geometria usando a gera√ß√£o de voxel em tempo real.  O mesmo se aplica a todas as partes da lua que s√£o formadas ou escavadas pelos jogadores.  Se as mudan√ßas forem grandes o suficiente e puderem ser observadas da √≥rbita, o gerente de cena adapt√°vel Voxel Farm aumentar√° o n√≠vel de detalhe (LOD) de todas as √°reas, cuja mudan√ßa a aplica√ß√£o considera importante. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt468305/">https://habr.com/ru/post/pt468305/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt468289/index.html">AM</a></li>
<li><a href="../pt468291/index.html">Sinopse do livro de Mark Gaulston, "Eu posso ouvi-lo atrav√©s"</a></li>
<li><a href="../pt468293/index.html">Vive Cosmos - revis√£o do novo conjunto VR da HTC</a></li>
<li><a href="../pt468295/index.html">50 tons de matplotlib - os gr√°ficos principais (com c√≥digo Python completo)</a></li>
<li><a href="../pt468299/index.html">O que desenvolver Oracle para um desenvolvedor em 2019 (e depois)</a></li>
<li><a href="../pt468307/index.html">Dicas e truques para forense digital: RAT baseado em IM de telegrama - parte I</a></li>
<li><a href="../pt468309/index.html">Apresentando a fonte do c√≥digo Cascadia</a></li>
<li><a href="../pt468311/index.html">Limpando a pasta de downloads usando um programa Python</a></li>
<li><a href="../pt468313/index.html">Apresentando a fonte Cascadia Code</a></li>
<li><a href="../pt468315/index.html">Como gerar a assinatura correta (SIG) na API OK.RU. Trabalhamos com um erro 104</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>