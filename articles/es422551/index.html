<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòó üóíÔ∏è üèûÔ∏è C√≥mo robar dinero de una tarjeta sin contacto y Apple Pay ‚¨úÔ∏è üçΩÔ∏è üòº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El art√≠culo examina mitos y escenarios populares de fraude de pagos sin contacto utilizando el ejemplo de un terminal POS real, tarjetas PayPass / pay...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo robar dinero de una tarjeta sin contacto y Apple Pay</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422551/"><img alt="¬øC√≥mo robar dinero de una tarjeta sin contacto de su bolsillo? ¬øQu√© tan seguros son PayPass y Apple Pay?" src="https://habrastorage.org/webt/gb/2f/ry/gb2frybl-08fyn1a0w1xxjap9f0.jpeg"><br><br>  El art√≠culo examina mitos y escenarios populares de fraude de pagos sin contacto utilizando el ejemplo de un terminal POS real, tarjetas PayPass / payWave y tel√©fonos con la funci√≥n Google Pay / Apple Pay. <br><br>  Temas cubiertos: <br><br><ul><li>  <b>¬øEs realmente posible robar dinero inclinando mi terminal POS en mi bolsillo?</b>  - Intentaremos reproducir completamente este escenario de fraude de principio a fin, utilizando un terminal POS real y tarjetas de pago en condiciones reales. </li><li>  <b>¬øCu√°l es la diferencia entre las tarjetas f√≠sicas y virtuales de Apple Pay?</b>  - c√≥mo se vinculan la tarjeta f√≠sica y el token de Apple Pay y por qu√© Apple Pay es mucho m√°s seguro que una tarjeta normal. </li><li>  <b>Utilizamos un rastreador NFC de hardware (ISO 14443A)</b> : utilizaremos un dispositivo HydraNFC para interceptar datos entre el terminal POS y la tarjeta.  Considere qu√© datos confidenciales se pueden extraer del tr√°fico interceptado. </li><li>  <b>Analizamos el protocolo EMV</b> : qu√© datos intercambia la tarjeta con el terminal POS, el formato de solicitud utilizado, los mecanismos de protecci√≥n contra el fraude y los ataques de repetici√≥n. </li><li>  <b>Estudiamos operaciones sin una tarjeta (CNP, MO / TO)</b> , en qu√© casos, de hecho (!) Puede robar dinero de la tarjeta, solo leer los detalles sin contacto y en los que es imposible. </li></ul><br>  <font color="red"><b>Atencion</b></font> <br><br>  El art√≠culo describe en detalle el esquema hipot√©tico de fraude, de principio a fin, a trav√©s de los ojos de un estafador, para cubrir todos los aspectos en los que se cultivan mitos y errores.  A pesar del t√≠tulo provocativo, la conclusi√≥n principal del art√≠culo es que los <b>pagos sin contacto son bastante seguros, y los ataques contra ellos requieren mucho tiempo y no son rentables</b> . <br><br>  <font color="red">Los materiales en el art√≠culo se presentan solo con fines informativos.</font>  <font color="red">Todas las escenas de fraude se organizan y ejecutan con el consentimiento de las partes involucradas.</font>  <font color="red">Todo el dinero deducido de las tarjetas fue devuelto a sus due√±os.</font>  <font color="red">El robo del dinero de la tarjeta es un delito penal y es punible por ley.</font> <a name="habracut"></a><br><h1>  Como funciona </h1><br>  Para comenzar, considere los conceptos b√°sicos: cualquier movimiento de dinero usando tarjetas de pago solo es posible a trav√©s de intermediarios conectados al sistema de pago, como VISA o MasterCard.  A diferencia de las transferencias entre individuos, el d√©bito de dinero de la tarjeta est√° disponible solo para una entidad legal (comerciante) con un acuerdo de adquisici√≥n con un banco. <br><br><img src="https://habrastorage.org/webt/d5/1w/ce/d51wcetyqo_5ppr5467wwknaaus.png"><br>  <i><font color="99999">Etapas de la transacci√≥n al pagar a trav√©s de un terminal POS</font></i> <br><br>  La ilustraci√≥n de arriba muestra el esquema de pago cl√°sico a trav√©s de un terminal POS.  Es esta secuencia de acciones que ocurre cuando despu√©s del pago en la caja est√° esperando la confirmaci√≥n en la terminal. <br><br><ol><li>  El comprador aplica / retiene / inserta la tarjeta en el terminal POS; </li><li>  Un terminal POS transmite datos a un banco adquirente a trav√©s de Internet; </li><li>  El banco adquirente a trav√©s del sistema de pago internacional (MPS) se comunica con el banco emisor y le pregunta si un titular de tarjeta en particular puede pagar la compra; </li><li>  El banco emisor confirma o rechaza la compra, despu√©s de lo cual se imprime un recibo (segundo cheque). </li></ol><br>  Hay excepciones a este esquema, por ejemplo, transacciones fuera de l√≠nea, las consideraremos m√°s a fondo.  Adem√°s, si el banco adquirente y el banco emisor son el mismo banco, los pasos 2 y 4 se realizan dentro del mismo banco. <br><br>  <b>Vendedor</b> (comerciante): una persona u organizaci√≥n que proporciona bienes o servicios <br><br>  El banco adquirente es un banco que brinda al vendedor servicios de aceptaci√≥n de pagos a trav√©s de tarjetas bancarias.  En este banco, por lo general, hay una cuenta bancaria del vendedor donde se acredita el dinero debitado de la tarjeta. <br><br>  Banco <b>emisor</b> : el banco que emiti√≥ la tarjeta.  Contiene la cuenta del titular de la tarjeta, de la cual se carga el dinero. <br><br>  <b>El Sistema de pago internacional</b> (MPS) es un sistema intermediario internacional entre bancos de todo el mundo que permite a los bancos realizar acuerdos entre ellos sin llegar a un acuerdo con cada banco por separado.  Todos los bancos conectados al Ministerio de Ferrocarriles aceptan trabajar de acuerdo con las mismas reglas, lo que simplifica enormemente la interacci√≥n.  Por ejemplo, Visa, MasterCard, UnionPay, American Express, <s>MIR</s> (no, MIR no funciona en el extranjero). <br><br>  <b>Titular de la tarjeta</b> : una persona que ha firmado un acuerdo de servicio de tarjeta con el banco emisor. <br><br><h1>  ¬øCu√°l es la diferencia entre una tarjeta regular de Apple Pay o Google Pay? </h1><br>  El procedimiento para vincular una tarjeta bancaria al sistema Apple Pay o Google Pay debido a la incomprensibilidad del proceso a menudo genera ideas err√≥neas incluso entre los profesionales de TI.  He escuchado muchos mitos diferentes sobre esta tecnolog√≠a. <br><br><h4>  Mitos populares de Apple Pay </h4><br><ul><li>  <b><font color="D13CB8">La tarjeta se copia al tel√©fono.</font></b> <br>  Esto no es as√≠, la tarjeta del microprocesador contiene un √°rea de memoria protegida con informaci√≥n criptogr√°fica que no se puede extraer despu√©s de la emisi√≥n de la tarjeta.  Debido a esto, una tarjeta con chip no se puede copiar, de ninguna manera, en absoluto.  <i><font color="99999">Para ser justos, debe decirse que tales ataques son posibles, pero su costo excede la cantidad total de dinero que la mayor√≠a de los lectores de este art√≠culo gastar√°n en toda su vida.</font></i> </li><li>  <b><font color="D13CB8">Cada vez que el tel√©fono se conecta a Internet durante el pago</font></b> <br>  Google Pay / Apple Pay no se conectan a Internet durante el pago a trav√©s de un terminal POS.  Toda la informaci√≥n necesaria se almacena localmente en el tel√©fono. </li><li>  <b><font color="D13CB8">Se genera un nuevo n√∫mero de tarjeta (PAN) para cada pago</font></b> <br>  Puede parecerlo si lees los comunicados de prensa de Apple sobre la tecnolog√≠a Apple Pay.  Pero esta es una interpretaci√≥n err√≥nea del concepto de token.  De hecho, los detalles de la tarjeta virtual permanecen sin cambios durante mucho tiempo, puede verificar esto con los √∫ltimos d√≠gitos del n√∫mero de tarjeta en el recibo (cheque bancario) al pagar las compras. </li><li>  <b><font color="D13CB8">Al pagar a trav√©s de Apple Pay / Google Pay, se cobra una tarifa adicional</font></b> <br>  Esto no es as√≠, pagar√° exactamente lo que se indica en la etiqueta de precio y de acuerdo con los t√©rminos de su acuerdo con el banco emisor cuya tarjeta ha vinculado. </li><li>  <b><font color="D13CB8">El dinero puede ser cargado dos veces</font></b> <br>  Este mito se aplica no solo a Google Pay / Apple Pay, sino tambi√©n a las tarjetas bancarias comunes.  Creo que apareci√≥ debido a los sistemas de pago de transporte p√∫blico, en los que la terminal deduce dinero del boleto cada vez que se presenta, por lo que puede debitar dos o m√°s veces si trae la tarjeta de manera incorrecta.  En el caso de los terminales POS, este riesgo no existe, ya que el terminal deja de intercambiarse con la tarjeta tan pronto como recibe los datos necesarios. </li></ul><br><br><img src="https://habrastorage.org/webt/z5/mt/og/z5mtogccxmh5picpde0ng_nmnnk.png"><br>  <i><font color="99999">Asociar una tarjeta f√≠sica con un token en el tel√©fono</font></i> <br><br>  Los sistemas como Apple Pay funcionan con la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Especificaci√≥n de tokenizaci√≥n de pago de EMV</a> .  El procedimiento para asociar una tarjeta f√≠sica y un tel√©fono con Apple Pay no se ha descrito p√∫blicamente, por lo que analizaremos el proceso en funci√≥n de los datos conocidos: <br><br><ol><li>  El proveedor (Google, Apple, Samsung) recibe informaci√≥n del mapa; </li><li>  A trav√©s de MPS, el proveedor solicita si esta tarjeta (este banco emisor) admite tokenizaci√≥n EMV; </li><li>  En el lado de MPS, se genera una tarjeta virtual (token), que se descarga al almacenamiento seguro en el tel√©fono.  <i><font color="99999">No s√© d√≥nde se genera exactamente la clave privada de la tarjeta virtual, si se transmite a trav√©s de Internet o se genera localmente en el tel√©fono, en este caso no importa.</font></i> </li><li>  Aparece una tarjeta de token virtual generada en el tel√©fono, las operaciones en las que el banco emisor interpreta como operaciones en la primera tarjeta f√≠sica.  En caso de bloquear la tarjeta f√≠sica, el token tambi√©n se bloquea. </li></ol><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Su navegador no admite video HTML5. <source src="https://zhovner.com/forever/applepay_different_pan.mp4" type="video/mp4"></video></div></div></div><br>  <i><font color="99999">Apple Pay le permite leer los detalles de una tarjeta virtual.</font></i>  <i><font color="99999">El n√∫mero de PAN y la fecha de caducidad difieren de la tarjeta vinculada del Alfa-Bank ruso.</font></i>  <i><font color="99999">El BIN de la tarjeta virtual (480099) est√° determinado por MBNA AMERICA BANK.</font></i> <br><br>  Cuando paga por tel√©fono, el terminal POS ve una tarjeta VISA o MasterCard regular y se comunica con ella de la misma manera que con una tarjeta f√≠sica.  Una tarjeta de token virtual contiene todos los atributos de una tarjeta normal: n√∫mero de PAN, fecha de vencimiento, etc.  Al mismo tiempo, el n√∫mero de tarjeta virtual y el per√≠odo de validez difieren de la tarjeta original adjunta. <br><br><h2>  Escenario 1 - terminal POS normal </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fw/jz/mj/fwjzmjgmj7beldkf8bh4hdwmlay.jpeg"></div><br>  <i><font color="99999">Estafador de terminal de punto de venta</font></i> <br><br>  La trama de fraude m√°s popular en la mente de la gente com√∫n: un estafador con un terminal encendido se presiona contra ellos en la multitud y da de baja el dinero.  Intentaremos reproducir este escenario en la realidad. <br><br>  <b>Las condiciones son las siguientes</b> : <br><br><ul><li>  El estafador tiene un <b>terminal POS ordinario</b> totalmente funcional conectado a un banco adquirente, igual que en las tiendas y los correos.  El firmware del terminal no se modifica.  En nuestro caso - Ingenico iWL250.  Este es un terminal POS port√°til con un m√≥dem GPRS que admite pagos sin contacto, funciona con bater√≠a y es completamente m√≥vil. </li><li>  El estafador no utiliza medios t√©cnicos adicionales, solo un terminal POS </li><li>  Los fondos debitados se acreditan a la cuenta corriente del estafador, de acuerdo con todas las reglas de los sistemas bancarios. </li></ul><br><h3>  Persona jur√≠dica </h3><br><img src="https://habrastorage.org/webt/do/f_/qs/dof_qscba68g-7za5caz02pszqi.jpeg"><br><br>  Primero, necesitamos una entidad legal con una cuenta corriente y una adquisici√≥n conectada.  Nosotros, como verdaderos estafadores, no distinguiremos nada a nuestro nombre, sino que trataremos de comprar una entidad legal preparada.  la persona en el sitio por los mismos estafadores.  Para hacer esto, mire los anuncios en la primera p√°gina de Google para "comprar ip" y "comprar ooo". <br><br> <a href=""><img src="https://habrastorage.org/webt/lu/7v/yc/lu7vycgengac_zvziy7cltrjl-k.png"></a> <br>  <i><font color="99999">Ofertas para vender compa√±√≠as preparadas de estafadores (clicables)</font></i> <br><br>  El precio de una empresa en el mercado negro con una cuenta corriente oscila entre 20 y 300 mil rublos.  Logr√© encontrar varias ofertas de LLC con un terminal POS de 200 mil rublos.  Dichas compa√±√≠as est√°n enmarcadas por dummies, y el comprador recibe el paquete completo de documentos, junto con una "tarjeta de cach√©": esta es una tarjeta bancaria vinculada a la cuenta de liquidaci√≥n de la empresa ficticia.  Con dicha tarjeta, un estafador puede retirar dinero en un cajero autom√°tico. <br><br><blockquote>  Para simplificar, asumimos que LLC + cuenta bancaria + adquisici√≥n y un terminal POS le costar√°n al estafador <b>100,000 rublos</b> .  En realidad, m√°s, pero simplificaremos la vida de nuestro hipot√©tico estafador, reduciendo el costo del ataque.  Despu√©s de todo, cuanto menor es el costo del ataque, m√°s f√°cil es implementarlo. </blockquote><br><h2>  Robemos dinero </h2><br>  Entonces, el estafador tiene una terminal POS y est√° listo para ir a un lugar lleno de gente para apoyarse en las v√≠ctimas y robar dinero de sus bolsillos.  En nuestro experimento, todas las v√≠ctimas recibieron instrucciones previas sobre nuestras intenciones, y todos los intentos de cancelar el dinero se hicieron con su consentimiento.  En los casos en que los sujetos no ten√≠an sus propias tarjetas bancarias sin contacto, se les pidi√≥ que pusieran nuestra tarjeta en su billetera.  Anteriormente, los sujetos descubrieron exactamente d√≥nde y c√≥mo almacenan sus tarjetas, por lo que el estafador sab√≠a de antemano d√≥nde est√° la tarjeta sin contacto en la bolsa / bolsillo. <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Su navegador no admite video HTML5. <source src="https://zhovner.com/forever/nfc_fraud_in_public.mp4" type="video/mp4"></video></div></div></div><br>  <i><font color="99999">Video: un estafador furioso en un centro comercial</font></i> <br><br>  En caso de una cancelaci√≥n exitosa, la transacci√≥n se cancel√≥ a trav√©s del men√∫ del terminal y el dinero se devolvi√≥ a la cuenta de los sujetos.  Durante todo el experimento, intentamos "robar" dinero de 20 sujetos en el edificio del centro comercial y en la calle.  El resultado de la prueba se describe a continuaci√≥n. <br><br><h1>  Problema: l√≠mite de transacci√≥n sin PIN </h1><br>  El l√≠mite en el monto m√°ximo de la transacci√≥n sin confirmar con un c√≥digo PIN se puede establecer tanto en el terminal POS (l√≠mite requerido de CVM) como en el lado del banco.  En Rusia, esta restricci√≥n es igual a 1000 rublos. <br><br><hr><br>  <font color="99999"><i><b>UPD</b> En la configuraci√≥n de la tarjeta, el tipo de autorizaci√≥n M√©todos de verificaci√≥n del titular de la tarjeta (CVM) se puede establecer como una firma en el cheque.</i></font>  <font color="99999"><i>En este caso, se realizar√° una transacci√≥n sin contacto por cualquier cantidad sin un c√≥digo PIN.</i></font> <br><br><hr><br>  Nuestro estafador decide cancelar 999.99 rublos a la vez.  Si se le solicita que intente cancelar el monto por debajo del l√≠mite en un corto per√≠odo de tiempo, tambi√©n se le pedir√° que ingrese el c√≥digo PIN y, en la mayor√≠a de los casos, no ser√° posible cancelar 999.99 rublos varias veces seguidas.  Por lo tanto, la estrategia m√°s √≥ptima ser√° no m√°s de un cargo de una tarjeta. <br><br><div style="text-align:center;"><img width="300" alt="Terminal POS con la cantidad de 999.99" src="https://habrastorage.org/webt/at/kg/lt/atkgltocfv4dmqiutgb-8rbcej8.png"></div><br>  <i><font color="99999">En Rusia, la cantidad m√°xima debitada sin un c√≥digo PIN es de 1000 rublos.</font></i> <br><br>  De hecho, muchas cancelaciones con la cantidad de 999,99 rublos en un corto per√≠odo de tiempo pueden desencadenar un sistema antifraude en el lado del banco adquirente, por lo que esta estrategia no es √≥ptima para un estafador.  Entonces, en la vida real, tendr√≠a que elegir cantidades m√°s diversas, reduciendo as√≠ los ingresos potenciales. <br><br>  Por cierto, muchos art√≠culos sobre este tema en ruso dicen que puede establecer manualmente su propio l√≠mite en transacciones sin contacto sin un c√≥digo PIN.  No pude encontrar esa opci√≥n en los principales bancos rusos.  ¬øQuiz√°s conoces esta posibilidad?  Se trata de pagos sin contacto, y no de ninguna transacci√≥n de chip y pin. <br><br><h2>  Problema: varias tarjetas en la billetera </h2><br>  Este es un punto importante en este escenario de ataque, porque en realidad casi nadie lleva <b>una sola carta</b> en su bolsillo.  En la mayor√≠a de los casos, la tarjeta se almacena en la billetera junto con otras tarjetas sin contacto, como boletos de viaje u otras tarjetas bancarias. <br><br><div style="text-align:center;"><img width="300" src="https://habrastorage.org/webt/im/x5/j1/imx5j1sci8ml-89qidz1_w8tdow.png" alt="Billetera hinchada"></div><br>  Espec√≠ficamente, mi terminal Igenico iWL250, cuando detecta m√°s de una tarjeta en el campo de acci√≥n con un SAK que denota soporte para el protocolo 14443-4, devuelve un error: "presentar una tarjeta". <br><br>  Pero no todas las terminales hacen esto.  Por ejemplo, los terminales POS de VeriFone Sberbank eligen una tarjeta aleatoria de varias.  Algunas terminales simplemente ignoran todas las tarjetas si hay m√°s de una, sin mostrar mensajes de error. <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Su navegador no admite video HTML5. <source src="https://zhovner.com/forever/pos_terminal_declines_few_cards.mp4" type="video/mp4"></video></div></div></div><br>  <i><font color="99999">Tratando de leer varias tarjetas en una billetera.</font></i>  <i><font color="99999">El terminal POS devuelve un error.</font></i> <br><br><h3>  Anticolisi√≥n ISO 14443-3 </h3><br>  Leer una tarjeta espec√≠fica de varias no es una tarea f√°cil a nivel f√≠sico.  Para resolver este problema, existe un mecanismo de anticolisi√≥n.  Le permite seleccionar una tarjeta si se recibi√≥ una respuesta de varias tarjetas a la vez.  Este es el primer paso para establecer contacto con una tarjeta sin contacto en el protocolo ISO-14443A.  En esta etapa, el lector no puede determinar cu√°l de las tarjetas presentadas es bancaria.  La √∫nica opci√≥n es elegir una tarjeta bancaria m√°s o menos similar, en funci√≥n de la respuesta de SAK (Seleccionar reconocimiento). <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/_k/ie/yz/_kieyz-qmexulctjyhmfnjyvff8.png"></div>  <i><font color="99999">Valor de bit en respuesta SAK</font></i> <br><br>  Entonces, por ejemplo, la tarjeta Troika (est√°ndar Mifare) utilizada en el transporte p√∫blico de Mosc√∫ tiene un valor de <b>SAK = 0x08 (b00001000)</b> , en el que el sexto bit es cero.  Mientras que para todas las tarjetas bancarias en las respuestas SAK, el sexto bit es 1, lo que significa que es compatible con el protocolo ISO 14443-4. <br><br>  Por lo tanto, todo lo que el terminal puede hacer cuando se detectan varias tarjetas al mismo tiempo es excluir las tarjetas que no son compatibles con ISO 14443-4 y elegir una similar a la banca.  La compatibilidad con el protocolo ISO 14443-4, por cierto, no garantiza que esta tarjeta sea una tarjeta bancaria, pero lo m√°s probable es que en la billetera de una persona com√∫n no haya otro tipo de tarjetas que admitan ISO 14443-4. <br><br><div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/4l/q0/e_/4lq0e_bzubjholfmtdiu29fmlxe.png"></div><br>  <i><font color="99999">Diagrama de flujo del protocolo anticolisi√≥n</font></i> <br><br>  Por experiencia personal: a pesar de la existencia de un protocolo de anticolisi√≥n, si hay al menos tres tarjetas sin contacto en su billetera, es <b><font color="red">EXTREMADAMENTE</font></b> dif√≠cil leer con <b><font color="red">√©xito la</font></b> tarjeta deseada.  La mayor√≠a de los intentos resultan en errores de lectura.  Es a√∫n m√°s dif√≠cil hacer esto en la carrera, aferr√°ndose a los bolsillos y bolsos de otra persona. <br><br>  Sin embargo, consideraremos que nuestro estafador tiene mucha suerte, y esta restricci√≥n no le molesta. <br><br><h2>  Transacciones fuera de l√≠nea vs en l√≠nea </h2><br>  En las noticias aterradoras, hablan de estafadores con terminales de punto de venta en vagones del metro, que escriben dinero de sus bolsillos en el camino.  Estas historias no mencionan de d√≥nde obtuvo el estafador Internet m√≥vil en el vag√≥n del metro.  ¬øQuiz√°s su terminal admite transacciones fuera de l√≠nea? <br><br>  Las especificaciones EMV permiten transacciones fuera de l√≠nea.  En este modo, el d√©bito ocurre sin la confirmaci√≥n en l√≠nea del banco emisor.  Esto funciona, por ejemplo, en el transporte p√∫blico en Mosc√∫ y San Petersburgo.  Para no hacer cola en la entrada del autob√∫s, mientras la terminal completa la confirmaci√≥n en l√≠nea, le permiten ingresar de inmediato sin verificar si tiene suficiente dinero en su cuenta para pagar la tarifa.  Al final del d√≠a, cuando aparece Internet en el terminal, las transacciones firmadas se env√≠an al banco emisor.  Si resulta que en este momento no tiene dinero para pagar la tarifa, la tarjeta se agregar√° a la lista de paradas en todas las terminales de la ciudad.  Puede pagar la deuda a trav√©s de su cuenta personal por n√∫mero de tarjeta.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Lea m√°s</a> sobre pagar el autob√∫s en San Petersburgo. <br><br>  Personalmente, no pude obtener un terminal POS que admita esta funci√≥n, por lo que en el escenario con el terminal POS "civil" habitual, no consideraremos la posibilidad de d√©bito fuera de l√≠nea.  Esto no cambia nada, excepto que el atacante necesitar√° Internet en la terminal, por lo que el ataque, por ejemplo, en el metro, es mucho m√°s complicado. <br>  Hay modelos de terminales que admiten WiFi, y en teor√≠a, nuestro estafador podr√≠a usar WiFi en el metro, ya que se hab√≠a encargado previamente de comprar acceso sin publicidad para la direcci√≥n MAC de su terminal POS para que la autenticaci√≥n no fuera necesaria a trav√©s del portal cautivo, ya que en POS El terminal no puede hacer esto. <br><br><h2>  Calcular el beneficio </h2><br>  En nuestro escenario, el costo del ataque fue de 100,000 rublos.  Esto significa que, al menos para devolver las inversiones, nuestro h√©roe debe completar al menos 100 transacciones de 1 mil rublos cada una.  Imagine que fue lo suficientemente √°gil y corri√≥ por la ciudad todo el d√≠a, aferr√°ndose a todos en una fila, de modo que al final del d√≠a hizo 120 cancelaciones exitosas.  No tomaremos en cuenta la comisi√≥n de adquisici√≥n (en promedio 2%), la comisi√≥n de cobro (4-10%) y otras comisiones. <br><br>  ¬øPuede retirar dinero con √©xito usando una tarjeta vinculada a una cuenta corriente? <br><br>  En realidad, no todo es tan simple.  <b>¬°El dinero se acreditar√° a la cuenta del estafador solo en unos d√≠as!</b>  Durante este tiempo, nuestro estafador debe esperar que ninguna de las ciento veinte v√≠ctimas desaf√≠e la transacci√≥n, lo cual es extremadamente improbable.  Por lo tanto, en realidad, la cuenta del estafador se bloquear√° incluso antes de que se le acredite dinero. <br><br><blockquote>  <i>Si una persona not√≥ que se realiz√≥ una compra en su tarjeta que no realiz√≥, debe comunicarse con el banco emisor y presentar un reclamo.</i> <i>         30 ,   ,    ‚Äî  60 .    -   -,   -     ,          .</i> <br><br> <b> ,           ()</b> <br></blockquote><br><h2>  Conclusi√≥n </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El costo de un ataque en nuestro escenario es de 100,000 rublos. De hecho, ser√° varias veces mayor, por lo que el estafador necesitar√° mucho m√°s esfuerzo para obtener ganancias. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En nuestro escenario, el estafador siempre cancela 999.99 rublos, lo que, muy probablemente, implicar√° la operaci√≥n del sistema antifraude del lado del banco adquirente. En realidad, el estafador deber√° cancelar peque√±as cantidades. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para recuperar al menos las inversiones, el estafador deber√° procesar varios cientos de v√≠ctimas. Si incluso una docena de ellos se contactan con el banco emisor y disputan la transacci√≥n, la cuenta del estafador probablemente se bloquear√°. El escenario en el que el banco adquirente est√° en colusi√≥n con el estafador es poco probable, porque la licencia para trabajar con el MPS cuesta mucho m√°s que cualquier beneficio potencial de este tipo de fraude.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De los 20 sujetos, solo tres lograron cancelar el dinero de la tarjeta, que es el 15% del √©xito de todos los intentos. Estos fueron esos casos artificiales cuando hab√≠a una sola tarjeta en su bolsillo. En casos con una billetera y varias tarjetas, el terminal devolvi√≥ un error. En un escenario con una terminal que usa firmware modificado e implementa un mecanismo anticolisi√≥n, el porcentaje de cargas exitosas puede ser mayor. Sin embargo, incluso en el caso de usar anticolisi√≥n, en condiciones reales en la carrera, es tan dif√≠cil contar una carta de varias para que el d√©bito exitoso en tales condiciones pueda considerarse suerte. En realidad, la proporci√≥n de cancelaciones exitosas apenas superar√° el 10% del n√∫mero de intentos.</font></font><br><br><blockquote> ,   ,      ,         .    -   ,     . <br></blockquote><br><h2>  2 ‚Äî  POS- </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Digamos que nuestro estafador trabaja en la caja en una tienda o un servicio de mensajer√≠a con un terminal de punto de venta m√≥vil. </font><font style="vertical-align: inherit;">En este caso, tiene la oportunidad de capturar datos de tarjetas, que, en algunos casos, pueden ser suficientes para pagar en Internet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primero, descubramos c√≥mo se ve exactamente una transacci√≥n sin contacto y qu√© tipo de datos intercambia la tarjeta con un terminal POS. </font><font style="vertical-align: inherit;">Como somos demasiado vagos para leer miles de p√°ginas de la documentaci√≥n de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">especificaciones sin contacto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">EMV</font></a><font style="vertical-align: inherit;"> , simplemente interceptamos el intercambio a nivel f√≠sico utilizando el sniffer HydraNFC. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hay alguna diferencia entre la especificaci√≥n EMV para MasterCard PayPass y Visa payWave. </font><font style="vertical-align: inherit;">Esta es la diferencia en el formato de firma y algunos datos. </font><font style="vertical-align: inherit;">Pero para nosotros esto no es esencial.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sniffer NFC </font></font></h2><br><img src="https://habrastorage.org/webt/bs/sx/oy/bssxoy5b-wmgyab33hakrihmfyc.png"><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HydraNFC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es un sniffer independiente de c√≥digo abierto ISO-14443A que guarda los comandos APDU interceptados en una tarjeta SD. </font><font style="vertical-align: inherit;">La antena rastreadora se encuentra entre el terminal y la tarjeta, y captura pasivamente toda la informaci√≥n transmitida. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sitio web sobre HydraBus y el escudo HydraNFC</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fuentes de firmware</font></font></a> <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Su navegador no admite video HTML5. <source src="https://zhovner.com/forever/hydranfc_pos_terminal_sniff.mp4" type="video/mp4"></video></div></div></div><br> <i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demostraci√≥n de la intercepci√≥n del intercambio entre el terminal POS y el tel√©fono con Apple Pay</font></font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mirando hacia el futuro, debo decir que a este nivel el pago por tel√©fono y una tarjeta de pl√°stico normal no es diferente. </font><font style="vertical-align: inherit;">Para una terminal POS, esta es una tarjeta VISA normal. </font><font style="vertical-align: inherit;">Sin embargo, pagar por tel√©fono es mucho m√°s seguro que usar una tarjeta f√≠sica, y luego analizaremos por qu√©.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> An√°lisis del protocolo EMV </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As√≠ es como se ve el vertedero registrado cuando se paga chocolate y una botella de agua por un valor total de 142.98 rublos con Apple Pay: </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datos sin procesar recibidos del sniffer (spoiler abierto)</font></font></b> <div class="spoiler_text"><a href=""><img width="200" src="https://habrastorage.org/webt/ia/by/xg/iabyxg1ocokwqruiq9ew3qmwqws.png"></a><br>
<i><font color="99999">      ()</font></i><br>
<br>
<b>R (READER)</b> ‚Äî POS-<br>
<b>T (TAG)</b> ‚Äî  (   )<br>
<code>R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
T&lt;&lt; 04 00<br>
R&gt;&gt; 93 20 <br>
T&lt;&lt; 08 fe e4 ec fe <br>
R&gt;&gt; 93 70 08 fe e4 ec fe dd 6e <br>
T&lt;&lt; 20 fc 70 <br>
R&gt;&gt; 50 00 57 cd <br>
R&gt;&gt; 26 <br>
R&gt;&gt; 52 <br>
T&lt;&lt; 04 00 <br>
R&gt;&gt; 93 70 08 fe e4 ec fe dd 6e <br>
T&lt;&lt; 20 fc 70 <br>
R&gt;&gt; e0 80 31 73 <br>
T&lt;&lt; 05 78 80 70 02 a5 46 <br>
R&gt;&gt; 02 00 a4 04 00 0e 32 50 41 59 2e 53 59 53 2e 44 44 46 30 31 00 e0 42 <br>
T&lt;&lt; 02 6f 23 84 0e 32 50 41 59 2e 53 59 53 2e 44 44 46 30 31 a5 11 bf 0c 0e 61 0c 4f 07 a0 00 00 00 03 10 10 87 01 01 90 00 4b b3 <br>
R&gt;&gt; 03 00 a4 04 00 07 a0 00 00 00 03 10 10 00 bc 41 <br>
T&lt;&lt; 03 6f 31 84 07 a0 00 00 00 03 10 10 a5 26 9f 38 18 9f 66 04 9f 02 06 9f 03 06 9f 1a 02 95 05 5f 2a 02 9a 03 9c 01 9f 37 04 bf 0c 08 9f 5a 05 60 08 40 06 43 90 00 1d 66 <br>
R&gt;&gt; 02 80 a8 00 00 23 83 21 36 a0 40 00 00 00 00 01 42 98 00 00 00 00 00 00 06 43 00 00 00 00 00 06 43 18 09 18 00 e0 11 01 03 00 f9 14 <br>
T&lt;&lt; 02 77 62 82 02 00 40 94 04 18 01 01 00 9f 36 02 02 06 9f 26 08 d6 f5 6b 8a be d7 8f 23 9f 10 20 1f 4a ff 32 a0 00 00 00 00 10 03 02 73 00 00 00 00 40 00 00 00 00 00 00 00 00 00 00 00 00 00 00 9f 6c 02 00 80 57 13 48 00 99 72 50 51 17 56 d2 31 22 01 00 00 05 20 99 99 5f 9f 6e 04 23 88 00 00 9f 27 01 80 90 00 af c8 <br>
R&gt;&gt; 03 00 b2 01 1c 00 c9 05 <br>
T&lt;&lt; 03 70 37 5f 28 02 06 43 9f 07 02 c0 00 9f 19 06 04 00 10 03 02 73 5f 34 01 00 9f 24 1d 56 30 30 31 30 30 31 34 36 31 38 30 34 30 31 37 37 31 30 31 33 39 36 31 36 37 36 32 35 90 00 a7 7b <br>
</code><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analicemos cada fila del volcado interceptado por separado. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R &gt;&gt; - datos transmitidos por el terminal POS </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T &gt;&gt; - datos transmitidos por la tarjeta (en nuestro caso, un tel√©fono con Apple Pay)</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14443-A Seleccionar</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al comienzo del intercambio, el terminal establece una conexi√≥n con la tarjeta en el nivel del canal. </font><font style="vertical-align: inherit;">Para aquellos que est√©n familiarizados con las redes y el modelo OSI, ser√° conveniente presentar esto como el nivel L2 y el UID (Identificador √∫nico) de la tarjeta como la direcci√≥n MAC del host.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En la terminolog√≠a est√°ndar ISO-14443: </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (dispositivo de acoplamiento de proximidad) es el nombre del lector, en nuestro caso es un PIC-terminal </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PICC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (tarjeta de circuito integrado de proximidad) es una tarjeta, en nuestro caso el tel√©fono desempe√±a este papel</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una diferencia importante entre una tarjeta de pago regular de Apple Pay es que la tarjeta siempre es legible y no le permite controlar el proceso de lectura. Puede leerse sin control a trav√©s de la ropa, mientras que el tel√©fono, que cae en el campo de acci√≥n del lector, solicita al usuario que active una tarjeta virtual. Hasta que el usuario confirme, el tel√©fono no transmite ning√∫n dato y el lector ni siquiera sabe que hay una tarjeta virtual cerca.</font></font><br>
<br>
<pre><code class="plaintext">R&gt;&gt; 52 // WUPA (wake up)<font></font>
R&gt;&gt; 52 // WUPA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
T&lt;&lt; 04 00 // ATQA (Answer To Request type A) <font></font>
R&gt;&gt; 93 20 // Select cascade 1 (Anti Collision CL1 SEL)<font></font>
T&lt;&lt; 08 fe e4 ec fe // UID (4 bytes) + BCC (Bit Count Check)<font></font>
R&gt;&gt; 93 70 08 fe e4 ec fe dd 6e // SEL (select tag 0x9370) + UID + CRC16<font></font>
T&lt;&lt; 20 fc 70  // SAK (Select Acknowledge 0x20) + CRC16 <font></font>
R&gt;&gt; 50 00 57 cd // HALT (Disable communocaion 0x5000) + CRC16<font></font>
R&gt;&gt; 26 // REQA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
T&lt;&lt; 04 00 // ATQA<font></font>
R&gt;&gt; 93 70 08 fe e4 ec fe dd 6e // SELECT<font></font>
T&lt;&lt; 20 fc 70 // SAK<font></font>
R&gt;&gt; e0 80 31 73 // RATS (Request Answer to Select 0xE080) + CRC16<font></font>
T&lt;&lt; 05 78 80 70 02 a5 46 // ATS (Answer to select response)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El terminal env√≠a constantemente el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comando 0x52</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wake-up (WUPA), y tan pronto como la tarjeta aparece en el campo de acci√≥n, responde con el comando Responder a la solicitud tipo A (ATQA), en nuestro caso es </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x04 0x00</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . La respuesta ATQA puede variar seg√∫n los fabricantes de chips. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de recibir una respuesta ATQA, el terminal comienza un procedimiento de detecci√≥n de colisi√≥n para determinar si hay m√°s de una tarjeta en el campo de acci√≥n. El </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comando 0x93 0x20</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Seleccionar cascada nivel 1 (SEL CL1) pide a todas las tarjetas en el campo de acci√≥n que informen la primera parte de sus UID. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tarjeta responde con </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x08 0xFE 0xE4 0xEC 0xFE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , los primeros cuatro bytes son el UID de la tarjeta virtual Apple Pay y el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xFE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bit Count Check (BCC) al final.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de recibir los identificadores de la tarjeta, el lector accede a la tarjeta espec√≠fica con el comando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x93 0x70</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (SELECCIONAR). Para que un equipo sea tarjeta de UID </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x08 0xfe 0xe4 0xec</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xfe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la BCC + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xdd 0x6e</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CRC16. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tarjeta responde con </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x20</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Select Acknowledge (SAK) + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xfc 0x70</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CRC16. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si se reciben m√∫ltiples respuestas SAK en este paso, el lector puede reducir la longitud del UID en el comando SELECT hasta que responda una sola tarjeta. Sin embargo, como se muestra arriba, algunos terminales POS se niegan a continuar si se detectan colisiones en esta etapa, es decir, la presencia de varias tarjetas al mismo tiempo.</font></font><br>
<br>
<blockquote> UID   4, 7  10 .    ,   ,      Apple Pay, UID   4 . ,  Apple Pay   UID   ,     ,  UID  . ,     ,         ,       UID     . <br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El lector env√≠a el comando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x50 0x00</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HALT + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x57 0xcd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CRC16. Este es un comando de terminaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego, el procedimiento se repite nuevamente, el lector vuelve a activar la tarjeta (WUPA), pero sin verificar las colisiones, SELECT se ejecuta inmediatamente. Por qu√© se hace esto: no s√©, tal vez esta sea una forma m√°s confiable de determinar colisiones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La segunda vez, el lector ya env√≠a el comando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xE0 0x80</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Solicitar respuesta para seleccionar (RATS) + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x31 0x73</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CRC16. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tarjeta responde </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x05 0x78 0x80 0x70 0x02</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Respuesta para seleccionar respuesta (ATS) + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xA5 0x46</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CRC16. </font></font><br>
<br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Respuesta para seleccionar</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- La respuesta es similar a Respuesta para restablecer (ATR) para tarjetas de contacto. </font><font style="vertical-align: inherit;">Contiene informaci√≥n sobre el tama√±o m√°ximo de trama y los par√°metros de la capa de enlace. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esta etapa, se completa el nivel de "canal", luego el intercambio comienza en un protocolo de nivel superior, dependiendo de la aplicaci√≥n contenida en la tarjeta. </font><font style="vertical-align: inherit;">La operaci√≥n SELECT es la misma para todas las tarjetas sin contacto del est√°ndar ISO 14443A, incluidas las etiquetas NFC, los boletos de transporte p√∫blico, etc.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solicitud de aplicaciones disponibles - SELECCIONAR PPSE</font></font></h4><br>
<font color="grey"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descripci√≥n oficial: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Especificaciones sin contacto de EMV: PPSE y gesti√≥n de aplicaciones para elementos seguros</font></font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
El comienzo de la comunicaci√≥n con una tarjeta EMV siempre se produce leyendo el PPSE (entorno del sistema de pago). </font><font style="vertical-align: inherit;">El terminal le pregunta a la tarjeta qu√© aplicaciones de pago tiene. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muy a menudo, esta es una aplicaci√≥n, como en nuestro ejemplo: VISA. </font><font style="vertical-align: inherit;">Sin embargo, hay tarjetas con varias aplicaciones de pago, por ejemplo, hay tarjetas MIR nacionales especiales con dos aplicaciones de pago en su interior. </font><font style="vertical-align: inherit;">Dado que el sistema de pago MIR no funciona en el extranjero, una segunda aplicaci√≥n de pago est√° integrada en la tarjeta, de hecho, una segunda tarjeta. </font><font style="vertical-align: inherit;">Esta puede ser una aplicaci√≥n de sistema de pago JCB o UnionPay. </font><font style="vertical-align: inherit;">Estas tarjetas se llaman cobaging. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comando APDU SELECT PPSE</font></font></b><br>
<br>
<pre><code class="cpp">'00 A4 04 00 0E 32 50 41 59 2E 53 59 53 2E 44 44 46 30 31 00'<font></font>
  00 A4 04 00 //  select <font></font>
   0E //  command data (14 )<font></font>
    32 50 41 59 2E 53 59 53 2E 44 44 46 30 31 // command data 2PAY.SYS.DDF01<font></font>
    00 //  <font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Responder a SELECCIONAR PPSE</font></font></b><br>
<br>
<pre><code class="cpp">'6F 23 84 0E 32 50 41 59 2E 53 59 53 2E 44 44 46 30 31 A5 11 BF 0C 0E 61 0C 4F 07 A0 00 00 00 03 10 10 87 01 01 90 00'</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para mayor comodidad, analizaremos la respuesta utilizando el analizador en l√≠nea del formato TVL </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iso8583.info/lib/EMV/TLVs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . La misma respuesta procesada por el analizador: </font></font><br>
<br>
<img width="900" alt="EMV SELECT PPSE VISA RESPONE parsed" src="https://habrastorage.org/webt/yi/x_/_y/yix__y6me7kqdg9inwi05eyk1yq.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De todo esto, solo estamos interesados ‚Äã‚Äãen el identificador de la aplicaci√≥n de pago (AID). En este caso, este valor es </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A0000000031010</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que significa Visa International. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AID est√° marcado con un marcador </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4F</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . El segundo bit despu√©s del token es la longitud de los datos que contiene. Aunque la longitud del AID puede variar de 5 a 16 bytes, en la mayor√≠a de los casos es de 7 bytes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lista grande de AID: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eftlab.co.uk/knowledge-base/211-emv-aid-rid-pix</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Algunos </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">AID</font></a><font style="vertical-align: inherit;"> populares</font></font><br>
<br>
<pre><code class="plaintext">A0000000031010 Visa International<font></font>
A0000000032020 Visa International<font></font>
A0000000041010 Mastercard International<font></font>
A0000000043060 Mastercard International United States Maestro (Debit)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Indicador de prioridad de la aplicaci√≥n: indica la prioridad de las aplicaciones de pago. </font><font style="vertical-align: inherit;">Por ejemplo, en tarjetas combinadas de MIR que tienen varias aplicaciones de pago en el interior, este campo indica cu√°l de las dos aplicaciones tiene prioridad. </font><font style="vertical-align: inherit;">Como solo tenemos una solicitud de Visa International, apunta a ella y no hay prioridad. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iniciar aplicaci√≥n de pago - SELECCIONAR AYUDA</font></font></b><br>
<br>
<pre><code class="cpp">'00 A4 04 00 07 A0 00 00 00 03 10 10'<font></font>
  00 A4 04 00 //  select <font></font>
   07 //  command data (7 )<font></font>
    A0 00 00 00 03 10 10 // AID Visa International<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una vez seleccionada la aplicaci√≥n de pago necesaria, el terminal la inicia. </font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PDOL (Lista de objetos de datos de opciones de procesamiento)</font></font></h4><br>
<pre><code class="cpp">'6f 31 84 07 a0 00 00 00 03 10 10 a5 26 9f 38 18 9f 66 04 9f 02 06 9f 03 06 9f 1a 02 95 05 5f 2a 02 9a 03 9c 01 9f 37 04 bf 0c 08 9f 5a 05 60 08 40 06 43 90 00'
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analicemos la respuesta con el analizador </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lo/jr/dh/lojrdhsptl6kkauc02a5c0qwnme.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En respuesta al lanzamiento de la aplicaci√≥n de pago, la tarjeta informa un conjunto de par√°metros que espera recibir del terminal: PDOL (Lista de objetos de datos de opciones de procesamiento). </font><font style="vertical-align: inherit;">El terminal debe responder estrictamente de acuerdo con esta secuencia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los PDOL para diferentes tarjetas pueden variar. </font><font style="vertical-align: inherit;">El n√∫mero total de par√°metros PDOL es de varias decenas. </font><font style="vertical-align: inherit;">Puede encontrar una lista completa de los par√°metros PDOL </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Echemos un vistazo m√°s de cerca a PDOL. </font><font style="vertical-align: inherit;">La longitud indicada despu√©s del marcador es la longitud estrictamente esperada de la respuesta del terminal a esta solicitud. </font><font style="vertical-align: inherit;">Una respuesta vac√≠a se llena con ceros a la longitud deseada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An√°lisis de solicitud PDOL:</font></font><br>
<br>
<pre><code class="cpp">9F 38 18 //   PDOL.  18 (24 ) <font></font>
 9F 66 ( 04) // Terminal Transaction Qualifiers (TTQ).    . <font></font>
  9F 02 ( 06) //  <font></font>
   9F 03 ( 06) //  <font></font>
   9F 1A ( 02) //     ISO3166-1<font></font>
   95 ( 05) // Terminal Verification Results<font></font>
    5F 2A ( 02) //  ,    ,   ISO4217<font></font>
     9A ( 03) //    YYMMDD<font></font>
      9C ( 01) //   <font></font>
       9F 37 ( 04) //   <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasta este punto, todos los datos transmitidos son id√©nticos para cualquier transacci√≥n en esta tarjeta.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Solicitud de cargo - OBTENGA OPCIONES DE PROCESAMIENTO </font></font></h4><br>
<pre><code class="cpp">'80A8000023832136A0400000000001429800000000000006430000000000064318091800E011010300'<font></font>
 80 A8 00 00 //  GET PROCESSING OPTIONS (GPO)<font></font>
  23 //    (35 )<font></font>
   83 //  PDOL-<font></font>
    21 //  PDOL- (33 )<font></font>
     36 A0 40 00 // Terminal Transaction Qualifiers (TTQ)<font></font>
      00 00 00 01 42 98 //   (142,98 )<font></font>
       00 00 00 00 00 00 //   <font></font>
        06 43 //    (643 - )<font></font>
         00 00 00 00 00 // Terminal Verification Results (TVR)<font></font>
          06 43 //  (643 - russian ruble) <font></font>
           18 09 18 //  (18  2018 )<font></font>
            00 //  <font></font>
             E0 11 01 03 //   <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta respuesta muestra claramente c√≥mo el terminal, que se encuentra en Rusia, solicita que se debite de la tarjeta por un monto de 142,98 rublos. </font><font style="vertical-align: inherit;">Llamamos la atenci√≥n sobre el n√∫mero aleatorio al final (E0110103). </font><font style="vertical-align: inherit;">Este es el par√°metro </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9F37 N√∫mero impredecible</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esta es la primera menci√≥n de la criptograf√≠a. </font><font style="vertical-align: inherit;">En el futuro, este n√∫mero, junto con los datos de la transacci√≥n, deber√° firmar con una firma criptogr√°fica. </font><font style="vertical-align: inherit;">Esto le da al terminal control sobre la relevancia de la firma de la tarjeta y protege contra ataques de repetici√≥n.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Respuesta de la tarjeta para OBTENER OPCIONES DE PROCESAMIENTO </font></font></h4><br>
<pre><code class="cpp">'7762820200409404180101009F360202069F2608D6F56B8ABED78F239F10201F4AFF32A00000000010030273000000004000000000000000000000000000009F6C02008057134800997250511756D23122010000052099995F9F6E04238800009F2701809000'
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta respuesta contiene campos de datos espec√≠ficos de VISA, por lo que utilic√© un analizador compatible con la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">especificaci√≥n de pago sin contacto VISA (VCSP)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img width="600" src="https://habrastorage.org/webt/n-/b0/la/n-b0laaskytjo0ahyyvlo6e7js0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perfil de intercambio de aplicaciones (AIP): contiene informaci√≥n sobre los par√°metros de la aplicaci√≥n de pago. En nuestro caso, AIP es </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00 40</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Considere los valores de este par√°metro del </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EMV 4.3 Libro 3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/rp/tc/ya/rptcyalvdwd6oaycintkbt02krq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En nuestro caso, se establece un bit en el segundo byte, que, seg√∫n esta tabla, est√° reservado para uso futuro (RFU). ¬øQu√© significa esto y cu√°l es el punto de invertir en Apple Pay? No lo s√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AIP contiene informaci√≥n importante sobre los m√©todos de autenticaci√≥n admitidos (SDA, CDA, DDA) de pago. ¬øPor qu√© en mi caso todas estas banderas son iguales a cero? No entiendo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Localizador de archivos de aplicaci√≥n (AFL): contiene informaci√≥n de rango de registros SFI en un AID espec√≠fico. En base a esta respuesta, el terminal generar√° una solicitud de LECTURA DE REGISTRO. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analicemos la respuesta AFL con m√°s detalle: el </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Identificador de archivo corto (SFI) es 0x18. Este par√°metro est√° codificado con cinco bits en lugar de ocho. En consecuencia, el valor 0x18 (b00011000) se convierte a b00000011, y obtenemos 0x3. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primer registro = 1</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√öltimo registro = 1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
es decir en la "carpeta" No. 3 hay entradas del 1 al 1, es decir, una entrada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El contador de transacciones de aplicaciones (ATC) es un contador de transacciones incremental que se incrementa en uno cada vez que se solicitan OPCIONES DE PROCESAMIENTO. Al alcanzar el valor 0xFFFF o 0x7FFF, la aplicaci√≥n de pago se bloquear√° permanentemente. Creo que esto se hace para proteger contra la fuerza bruta de la clave privada de la tarjeta. En nuestro caso, se puede ver que este iPhone con Apple Pay ya se usaba para pagar 518 (0x206) veces.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Application Cryptogram (AC): una firma criptogr√°fica que la tarjeta calcula con su clave privada. Esta firma se transmite junto con el resto de los datos al banco emisor, y la autenticidad de la transacci√≥n se verifica sobre la base. Dado que la clave privada de la tarjeta no puede extraerse (medios accesibles) de la tarjeta, esto elimina la posibilidad de copiar la tarjeta. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Datos de la aplicaci√≥n del emisor (IAD): contiene datos de propiedad espec√≠ficos de VISA. </font></font><i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No domine el an√°lisis de esta estructura, ayuda.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Calificadores de transacciones de tarjetas (CTQ): lista espec√≠fica de VISA de especificaciones de tarjetas compatibles. Por ejemplo, ¬øes posible usar esta tarjeta sin contacto para transacciones en un cajero autom√°tico o no, y qu√© tipo de confirmaci√≥n se requerir√°? </font></font><br>
<br>
<img align="right" width="200" src="https://habrastorage.org/webt/vd/aw/ny/vdawnyz0tkkjbs-rradkbk0loiy.png"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seguimiento de datos equivalentes 2 - </font></font><font color="red"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oppa!</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este campo contiene el n√∫mero de tarjeta y la fecha de vencimiento, m√°s detalles sobre esta informaci√≥n se discutir√°n m√°s adelante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Indicador de facto de formulario (FFI): campo espec√≠fico de VISA. </font><font style="vertical-align: inherit;">Describe el factor de forma y las caracter√≠sticas de un dispositivo de pago. </font><font style="vertical-align: inherit;">En nuestro caso, est√° claro que este es un tel√©fono m√≥vil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Datos de informaci√≥n de criptograma (CID): </font></font><i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no he dominado el an√°lisis de esta estructura, ayuda.</font></font></font></i><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consulta LEER REGISTRO DE DATOS</font></font></h4><br>
<pre><code class="cpp">'00 b2 01 1c 00'
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El terminal env√≠a una solicitud para leer los registros recibidos de la AFL: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/od/jw/mv/odjwmvemclc5gd4q6dhvlcmqfjy.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
en este caso, comenzando desde el byte </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x1C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lea como dos valores, donde los primeros cinco bits son 0x18 (b000011) y son SFI, y los siguientes tres bits son 0x04 (d100), y inventa el n√∫mero de registro.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Responder a LEER REGISTRO</font></font></h2><br>
<pre><code class="cpp">'70375F280206439F0702C0009F19060400100302735F3401009F241D5630303130303134363138303430313737313031333936313637363235'
</code></pre><br>
<img src="https://habrastorage.org/webt/x9/ke/vv/x9kevvho_se85wg6vlgkwrd4jtw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Control de uso de aplicaciones (AUC): determina si est√° permitido pagar con una tarjeta en el extranjero y los tipos de operaciones permitidos. </font></font><br>
<br>
<i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al parecer, el 9F19 es algo incomprensible: el tokenizaci√≥n</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
EMV, la referencia de cuenta de pago (PAR) </font><i><font color="99999"><font style="vertical-align: inherit;">anticuada de la lista de objetos de datos de autenticaci√≥n din√°mica de datos (DDOL</font></font></i><font style="vertical-align: inherit;"> ) es un par√°metro espec√≠fico para las tarjetas tokenizadas (virtuales). </font></font><i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No domine el an√°lisis de esta estructura, ayuda.</font></font></font></i><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© se puede extraer de una transacci√≥n interceptada?</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analizamos un ejemplo espec√≠fico del tr√°fico interceptado de una transacci√≥n sin contacto de Apple Pay con una tarjeta VISA vinculada. El protocolo MasterCard es ligeramente diferente, pero en general similar. Del an√°lisis se puede ver que la transacci√≥n est√° protegida por la firma de cifrado, y el protocolo est√° protegido de un ataque de repetici√≥n. </font></font><i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hay un protocolo de pago sin contacto desactualizado en modo de banda magn√©tica (MSD), que est√° mucho menos protegido contra ataques de repetici√≥n, pero en este art√≠culo no lo desarmar√©, porque, por lo que s√©, casi no es compatible con el CIS, tal vez me equivoque. </font></font></font><br>
</i><br>
<img src="https://habrastorage.org/webt/ys/kk/8_/yskk8_eztdatvwiziqusnqsa2ee.png"><br>
<i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De los datos interceptados, puede extraer el n√∫mero de tarjeta (PAN) y la fecha de vencimiento</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver, del tr√°fico interceptado puede extraer el n√∫mero completo de la tarjeta y la fecha de vencimiento. </font><font style="vertical-align: inherit;">Aunque CVV no est√° en este basurero, estos datos ya son suficientes para pagar en algunas tiendas en l√≠nea. </font><font style="vertical-align: inherit;">¬°En el caso de una tarjeta de pl√°stico f√≠sica normal, los datos interceptados contendr√°n </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el mismo PAN y la fecha de vencimiento que est√° estampada en la tarjeta!</font></font></b><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pago por Internet sin CVV (CNP, MO / TO)</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En mi art√≠culo anterior </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Usamos Apple Pay y la tarjeta Troika como un pase para trabajar"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre ACS basado en Apple Pay, fui criticado en los comentarios, diciendo que con solo los √∫ltimos 10 d√≠gitos de la tarjeta puedes robar dinero. En el volcado anterior, no solo se indica el n√∫mero completo de mi tarjeta, sino tambi√©n la fecha de vencimiento. Estos datos son suficientes para pagar en algunas tiendas en Internet. Bueno, intenta hacerlo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ue/-q/wt/ue-qwtah0au0uftojwdu8qsrs3m.png"><br>
<i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El formulario de agregar tarjeta de Amazon no requiere CVV</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si se tratara de un n√∫mero de tarjeta f√≠sica, el dinero podr√≠a ser robado, pero los datos del token de Apple Pay se pueden usar SOLO para operaciones de Cliente Presente (CP) cuando la tarjeta firma la transacci√≥n con una firma criptogr√°fica. </font><font style="vertical-align: inherit;">Estos datos no se pueden utilizar para el pago en Internet y otras operaciones como Tarjeta no presente (CNP), es decir, por tel√©fono o correo electr√≥nico. </font><font style="vertical-align: inherit;">Eso es todo! </font></font><br>
<br>
<font color="r"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A todos los que quieran verificar esto, les informo que los detalles del volcado de Apple Pay interceptados anteriormente son actualmente relevantes y est√°n vinculados a una tarjeta v√°lida que tiene dinero. </font><font style="vertical-align: inherit;">Al momento de escribir, esto es 5 mil rublos. </font><font style="vertical-align: inherit;">Sugiero tratar de robarlos :)</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øPor qu√© Apple Pay es m√°s seguro que una tarjeta normal?</font></font></h2><br>
<div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/jz/cn/2n/jzcn2ndu1pfw-znat4mxtab6k8k.png"></div><br>
<i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apple Pay vs tarjeta sin contacto normal</font></font></font></i><br>
<br>
<ul>
<li> <b>Apple Pay   (  )    .</b>            POS-.  , ¬´¬ª        ,       ,   ,     ,   ,   .  Apple Pay  ,            ,       .</li>
<li><b>     </b> ‚Äî    Apple Pay      (13,56 ),   ,           .       .     Apple Pay     ,     .</li>
<li><b>       </b> ‚Äî         Card not present (CNP),      ,    ..     Apple Pay    . </li>
<li><b>   </b> ‚Äî        (Cardholder name)    .   ,   ,    .  Apple Pay    . </li>
</ul><br>
<h2></h2><br>
     .     ,         .         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">   </a>.<br>
<br>
  , Apple Pay     .      CNP- (  )    ,         .<br>
<br>
<hr><br>
 :<br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Empresas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tehpos.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para el hardware.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Banco Ural de Reconstrucci√≥n y Desarrollo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , y personalmente a Alexander Paderin (Director Gerente del Centro de Seguridad de la Informaci√≥n) para consultas.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Almacenar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aj.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para proporcionar iPhones para probar.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valeria </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aquamine</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para las ilustraciones del art√≠culo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gleb </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JRun</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de Digital Security para asesoramiento t√©cnico.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexander </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AlexGre</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para consultas sobre el protocolo EMV.</font></font></li>
<li><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Forma de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> habit√°culo </font><font style="vertical-align: inherit;">para un excelente analizador EMV: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iso8583.info</font></font></a></li>
</ul></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es422551/">https://habr.com/ru/post/es422551/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es422541/index.html">El drama de los agujeros en la Uni√≥n se convirti√≥ en una fantasmagor√≠a</a></li>
<li><a href="../es422543/index.html">Piensa como un programador. Tutorial de resoluci√≥n de problemas</a></li>
<li><a href="../es422545/index.html">Formas de sincronizar las pesta√±as del navegador</a></li>
<li><a href="../es422547/index.html">Para eliminar Spectre y Meltdown, es posible que deba crear un tipo de procesador completamente nuevo.</a></li>
<li><a href="../es422549/index.html">Corda: Kotlin</a></li>
<li><a href="../es422553/index.html">La extensi√≥n oficial del navegador Mega roba datos de intercambio de archivos y criptomonedas</a></li>
<li><a href="../es422555/index.html">Arquitectura de m√∫ltiples m√≥dulos de Android. De la A a la Z</a></li>
<li><a href="../es422561/index.html">C√≥mo Yandex aplic√≥ la visi√≥n por computadora para mejorar la calidad de las transmisiones de video. Tecnolog√≠a DeepHD</a></li>
<li><a href="../es422565/index.html">Seminarios web de Skillbox Friday: todo para programadores y dise√±adores</a></li>
<li><a href="../es422569/index.html">Aplicaci√≥n de seguimiento horario</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>