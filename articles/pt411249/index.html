<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòØ ‚û°Ô∏è üé∫ Como fiz meu Yandex.Transporte com hor√°rios e √¥nibus üö¥üèæ üë®üèª‚Äçüíª üë©üèæ‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Publicado por Mikhail Aksenov, Desenvolvedor .NET, DataArt 



- Site do projeto Vrnbus (Voronezh Buses); 
- Bot de telegrama: @vrnbusbot ; 
- Projeto...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como fiz meu Yandex.Transporte com hor√°rios e √¥nibus</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataart/blog/411249/"><img src="https://habrastorage.org/webt/a0/8u/mi/a08umi6_8yn4eobkvs63zv_s9tq.jpeg"><br><br>  <i>Publicado por Mikhail Aksenov, Desenvolvedor .NET, DataArt</i> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Site do projeto Vrnbus</a> (Voronezh Buses); </li><li>  Bot de telegrama: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@vrnbusbot</a> ; </li><li>  Projeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Github</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">vrntrans / vrnbus</a> . </li></ul><br><h2>  Como tudo come√ßou </h2><br>  No outono de 2014, houve boas not√≠cias sobre o lan√ßamento do Yandex.Transport em Voronezh, que mostra o movimento de √¥nibus e tr√≥lebus.  Foi muito legal no ponto de √¥nibus abrir um hor√°rio e descobrir que seu √¥nibus funcionar√° em 5 minutos. <br><br>  Mas, depois de alguns meses, tudo correu de acordo com um cen√°rio completamente previs√≠vel.  Como todo o transporte em Voronezh, do carrinho at√© o micro√¥nibus, funciona em dinheiro, cada motorista est√° interessado em transportar o maior n√∫mero poss√≠vel de passageiros.  Como resultado, eles organizam corridas entre si. <br><br>  Os motoristas usavam o novo servi√ßo para se seguir no mapa, ultrapassando e cortando concorrentes na estrada.  Alguns come√ßaram a perder receita, come√ßaram a reclamar com os propriet√°rios das rotas e foram a pessoas que vendiam equipamentos com GLONASS e GPS e enviavam dados sobre os movimentos de carros para a Yandex.  A pedido dos propriet√°rios da frota, eles pararam de enviar informa√ß√µes e os √¥nibus come√ßaram imediatamente a desaparecer do mapa.  Agora h√° um pouco mais deles, mas isso ainda √© muito menor do que na realidade. <a name="habracut"></a><br><br><img src="https://habrastorage.org/webt/hy/2p/d9/hy2pd9kotq6w2jrb__n5gm8nzx0.jpeg"><br><br>  Para quem tem pregui√ßa de ler mais, proponho um relat√≥rio em v√≠deo sobre este t√≥pico: <iframe width="560" height="315" src="https://www.youtube.com/embed/1OtHwGqSL04" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Quanto ao resto, descreverei o projeto na forma de texto. <br><br><h2>  Onde obter os dados? </h2><br>  Ao mesmo tempo, em Voronezh, h√° um local onde todos os dados s√£o coletados - o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Centro de Organiza√ß√£o do Tr√°fego Rodovi√°rio</a> (DPC).  Eles t√™m um aplicativo Web grande e pesado em seu site com JavaScript insustent√°vel e outros artefatos, enquanto tudo nele √© fornecido com solicita√ß√µes POST e nada √© armazenado em cache.  Usando este site em si, voc√™ pode facilmente colocar um servi√ßo que coleta dados sobre a movimenta√ß√£o de √¥nibus. <br><br>  Havia uma op√ß√£o que permite que voc√™ cutuque o mapa e descubra quando o √¥nibus chegar√° e qual ser√°.  Desde que voc√™ aproximadamente pare (¬± 50 metros).  No menu, voc√™ pode abrir uma lista de rotas e ver exatamente para onde os √¥nibus v√£o, mas havia um problema - eles dirigiam estranhamente.  Por exemplo, ao longo de Koltsovskaya, uma rua no centro onde voc√™ n√£o pode acelerar especialmente, o √¥nibus avan√ßava e recuava a uma velocidade de cerca de 200 km / h. <br><br><br><h2>  Por que Python? </h2><br>  Eu escolhi o Python porque √© legal, as baterias est√£o empacotadas e assim por diante .. E 3.6 porque existe formata√ß√£o para literais de string, digita√ß√£o, s√≥ isso.  Vejamos o que eu basicamente usei: <br><br><ul><li>  Muitos reclamaram que dirigir o nome exato de uma parada com todos os tipos de sinais de pontua√ß√£o √© muito dif√≠cil.  Ent√£o percebi a possibilidade de busca difusa e criei o primeiro teste de unidade para ela. </li><li>  Todo o sistema est√° hospedado no Heroku.  √â gr√°tis, porque n√£o tenho um banco de dados - espero me dar bem com o banco de dados do data center.  Concordei em us√°-lo com o Centro quando percebi que os dados que eu coleciono atrav√©s da interface da web n√£o s√£o suficientes. </li><li>  Na verdade, a hospedagem passa pelo servidor da web Tornado.  Eu acho que √© familiar para quem j√° encontrou solicita√ß√µes da Web em Python. </li><li>  Eu precisava do pacote Pytz porque o servidor Heroku est√° em um fuso hor√°rio diferente e os dados chegam at√© mim sem especificar um fuso hor√°rio.  Portanto, eu mesmo cuidei da localiza√ß√£o. </li><li>  Para criar o bot, usei a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Python-telegram-bot recomendada</a> .  A documenta√ß√£o aqui √© bastante adequada e, em geral, a biblioteca atende aos requisitos m√≠nimos vi√°veis ‚Äã‚Äãdo produto.  Inicialmente, todo o projeto era um bot do Telegram, que em resposta ao envio da sua localiza√ß√£o enviou uma programa√ß√£o de √¥nibus. </li><li>  O Firebird, um antigo Interbase, √© um banco de dados de c√≥digo aberto com o qual acho que muitos de voc√™s j√° trabalharam.  Obviamente, n√£o √© t√£o legal quanto o mesmo PostgreSQL, mas para um n√∫mero muito grande de consultas √© suficiente.  No nosso caso, n√£o √© mais necess√°rio. </li><li>  Cachetools √© um m√≥dulo muito simples que permite armazenar em cache c√°lculos.  Obviamente, n√£o se trata de cache de mem√≥rias ou cache de p√°ginas da Web, mas de casos em que voc√™ precisa de memoriza√ß√£o para consultas longas.  Basta lev√°-lo, adicione o decorador apropriado - e tudo funciona.  O cache tem op√ß√µes diferentes, eu uso a vers√£o TTL, que salva os dados pelo tempo especificado, porque sei que os dados n√£o ser√£o atualizados com mais frequ√™ncia do que em determinados intervalos (no meu caso - 30 segundos). </li></ul><br><br><h2>  Funcionalidade de bot </h2><br><ul><li>  / nome do ponto de √¥nibus pr√≥ximo - hora prevista de chegada; </li><li>  / n√∫meros da √∫ltima rota separados por espa√ßos - √∫ltimas paradas; </li><li>  Envio da localiza√ß√£o - a hora prevista de chegada para as pr√≥ximas tr√™s paradas; </li><li>  Entrada gratuita - n√∫meros de rota e dist√¢ncia dos √¥nibus (ao enviar o local). </li></ul><br><br>  Tentei descrever os comandos completamente o suficiente para que as pessoas n√£o perguntassem como us√°-los.  Existem basicamente dois comandos b√°sicos: nextbus, quando voc√™ escreve o nome da parada e envia o local. <br><br><h2>  Funcionalidade do site </h2><br>  Eu fiz o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site o</a> mais minimalista poss√≠vel.  Das bibliotecas de terceiros, usei apenas duas para oferecer suporte √† busca e promessa, porque as vers√µes mais antigas dos navegadores pr√©-instalados nos telefones n√£o podem ficar sem elas.  Se voc√™ n√£o suportar esses m√©todos, obter√° um macarr√£o de retorno de chamada bastante pesado para as pr√≥prias solicita√ß√µes.  Com a busca, tudo parece mais elegante. <br><br><img src="https://habrastorage.org/webt/vn/sd/gu/vnsdgutglxminl8j6wi07w4nkp0.jpeg"><br><br>  Na verdade, o funcional aqui consiste em 4 pontos: <br><br><ol><li>  <b>Chegada</b>  Voc√™ pode apenas assistir a parada.  Ao clicar no bot√£o (a prop√≥sito, pode valer a pena fazer um pouco mais - vou pensar nisso!), Voc√™ envia sua localiza√ß√£o, o sistema procura as tr√™s paradas mais pr√≥ximas a voc√™ e exibe informa√ß√µes sobre elas.  Voc√™ pode inserir o nome da parada e obter informa√ß√µes sobre ela.  Como voc√™ dificilmente precisa de todos os 20 a 30 √¥nibus que podem chegar ao ponto, √© poss√≠vel filtr√°-los por rota. </li><li>  <b>√înibus</b>  A segunda p√°gina cont√©m informa√ß√µes sobre √¥nibus.  Isso se deve a outra hist√≥ria que me levou a esse projeto.  Um belo dia, esqueci o chap√©u no √¥nibus, liguei para a sala de controle e expliquei onde aconteceu.  O despachante sugeriu que eu pegasse meu √¥nibus no centro, onde ele retornaria, dando a volta no terminal.  Lembrei-me de que tinha um login e senha do sistema Center for Traffic Management, mas verificou-se que ainda n√£o conseguia rastrear a localiza√ß√£o do carro de que precisava atrav√©s da interface da web.  Devolvi o chap√©u, mas com grande dificuldade. <br>  Eu pensei que encontrar um √¥nibus poderia ser muito mais f√°cil.  Escrevi o n√∫mero da rota e o sistema mostra os carros na linha, a localiza√ß√£o atual e a hora em que eles passaram para no caminho.  E mesmo se voc√™ souber o n√∫mero da rota, mas o n√∫mero do √¥nibus (isso tamb√©m acontece), ainda poder√° encontr√°-lo. </li><li>  <b>Mapa.</b>  Mapa no site sem anima√ß√£o.  Aqui voc√™ pode selecionar √¥nibus da lista ou inserir n√∫meros manualmente, pode filtr√°-los.  At√© 600 √¥nibus podem ser mostrados no mapa, embora depois dos 20 se torne dif√≠cil encontrar algo no centro, simplesmente porque as rotas est√£o todas concentradas aqui.  Portanto, √© melhor limitar a pesquisa a par√¢metros mais rigorosos. </li><li>  <b>Sobre o projeto.</b>  Agora o projeto tem um site, existe um bot do Telegram, grupos nas redes sociais. </li></ol><br><br>  *** <br>  Felizmente, Python √© uma linguagem com baterias prontas para uso.  Para coisas simples, voc√™ nem precisa baixar nada, basta ler a documenta√ß√£o com cuidado. <br><br>  Certamente, esses servi√ßos podem ser feitos para outras cidades, al√©m disso, em algumas delas j√° funcionam.  Depende muito do data center local; em alguns lugares, por exemplo, em S√£o Petersburgo, existe at√© uma API para desenvolvedores.  Mas o mais importante s√£o as pessoas da cidade que querem mudar de cidade para melhor. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt411249/">https://habr.com/ru/post/pt411249/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt411239/index.html">DIY-criatividade desde a inf√¢ncia: instilar o amor por produtos caseiros</a></li>
<li><a href="../pt411241/index.html">"Kepler" descobriu uma supernova estranha: pegou fogo rapidamente, saiu rapidamente</a></li>
<li><a href="../pt411243/index.html">Res√≠duos - para o forno</a></li>
<li><a href="../pt411245/index.html">Vamos nos mostrar o Universo: os far√≥is que permanecer√£o depois da nossa civiliza√ß√£o</a></li>
<li><a href="../pt411247/index.html">As crian√ßas mais ‚Äúinteligentes‚Äù assistem ao VTech Kidizoom. Como as coisas realmente s√£o</a></li>
<li><a href="../pt411251/index.html">Os usu√°rios reenviam os arquivos de verifica√ß√£o do Chrome na unidade local</a></li>
<li><a href="../pt411253/index.html">A fus√£o de estrelas de n√™utrons p√¥s fim √†s alternativas de mat√©ria escura e energia escura</a></li>
<li><a href="../pt411255/index.html">Aplicativos descentralizados para milh√µes de usu√°rios no Ethereum</a></li>
<li><a href="../pt411257/index.html">Nos EUA, eles criam um sistema de laser que assusta o inimigo com som</a></li>
<li><a href="../pt411259/index.html">Conectamos um medidor de √°gua a uma casa inteligente</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>