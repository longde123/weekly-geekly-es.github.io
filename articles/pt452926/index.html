<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë© üßùüèΩ üõÄüèΩ Teste est√°tico ou salve o soldado Ryan üìÉ üë¶üèª üëêüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Uma vers√£o geralmente passa despercebida. E qualquer erro que de repente foi descoberto na sua frente nos amea√ßa com uma mudan√ßa de prazos, hotfixes, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Teste est√°tico ou salve o soldado Ryan</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/playrix/blog/452926/">  Uma vers√£o geralmente passa despercebida.  E qualquer erro que de repente foi descoberto na sua frente nos amea√ßa com uma mudan√ßa de prazos, hotfixes, trabalho at√© a manh√£ seguinte e irrita√ß√£o.  Quando essa pressa come√ßou a ocorrer sistematicamente, percebemos que voc√™ n√£o pode mais viver assim.  Decidiu-se desenvolver um sistema de valida√ß√£o abrangente para salvar <s>o</s> desenvolvedor <s>comum do Ryan</s> Artyom, que voltava para casa antes do lan√ßamento √†s 21h, √†s 10 ou √†s 11 ... bem, voc√™ entende.  A id√©ia era que o desenvolvedor descobrisse o erro, enquanto as mudan√ßas ainda n√£o haviam chegado ao reposit√≥rio e ele pr√≥prio n√£o havia perdido o contexto da tarefa. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e0c/050/6ad/e0c0506adfa607df0102904b82c0d96a.png"></div><br>  Hoje, as altera√ß√µes feitas s√£o cuidadosamente verificadas primeiro localmente e depois com uma s√©rie de testes de integra√ß√£o no farm de montagem.  Neste artigo, falaremos sobre o primeiro est√°gio da verifica√ß√£o - teste est√°tico, que monitora a corre√ß√£o dos recursos e analisa o c√≥digo.  Este √© o primeiro subsistema da cadeia e √© respons√°vel pela maior parte dos erros encontrados. <br><a name="habracut"></a><br><h2>  Como tudo come√ßou </h2><br>  O processo manual de verifica√ß√£o do jogo antes do lan√ßamento come√ßou no controle de qualidade uma semana e meia antes do lan√ßamento.  Naturalmente, os bugs que est√£o nesse est√°gio precisam ser corrigidos o mais r√°pido poss√≠vel. <br><br>  Devido √† falta de tempo para uma boa solu√ß√£o, √© adicionada uma "muleta" tempor√°ria, que se enra√≠za por um longo tempo e √© cercada por outras solu√ß√µes n√£o muito populares. <br><br>  Primeiro, decidimos automatizar a descoberta de erros evidentes: falhas, incapacidade de concluir o conjunto principal de a√ß√µes do jogo (abrir uma loja, fazer uma compra, jogar um n√≠vel).  Para fazer isso, o jogo come√ßa em um modo especial de jogo autom√°tico e, se algo der errado, saberemos sobre isso logo ap√≥s passar no teste em nossa fazenda. <br><br>  Mas a maioria dos erros encontrados pelos testadores e pelo nosso teste automatizado de fuma√ßa foi a falta de um recurso ou configura√ß√µes incorretas de diferentes sistemas.  Portanto, o pr√≥ximo passo foi o <i>teste est√°tico</i> - verificando a disponibilidade de recursos, seus relacionamentos e configura√ß√µes sem iniciar o aplicativo.  Esse sistema foi lan√ßado por uma etapa adicional no farm de montagem e simplificou bastante a localiza√ß√£o e a corre√ß√£o de erros.  Mas por que desperdi√ßar os recursos do farm de montagem se voc√™ pode detectar um erro antes mesmo de confirmar e colocar o c√≥digo do problema no reposit√≥rio?  Isso pode ser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">feito com ganchos de pr√©-confirma√ß√£o</a> , que s√£o iniciados apenas antes da cria√ß√£o e envio do commit ao reposit√≥rio. <br><br>  E sim, somos t√£o legais que o teste est√°tico antes de confirmar e no conjunto de montagem √© realizado por um c√≥digo, o que simplifica bastante o suporte. <br><br>  Nossos esfor√ßos podem ser divididos em tr√™s √°reas: <br><br><ul><li>  cria√ß√£o de uma fazenda de montagem - o pr√≥prio local onde tudo o que foi coletado e verificado ser√° coletado; </li><li>  desenvolvimento de testes est√°ticos - checando a corre√ß√£o dos recursos, seus relacionamentos, lan√ßando analisadores de c√≥digo; </li><li>  desenvolvimento de testes em tempo de execu√ß√£o - iniciando o aplicativo no modo de reprodu√ß√£o autom√°tica. </li></ul><br>  Uma tarefa separada era organizar o lan√ßamento de testes na m√°quina pelo desenvolvedor.  Era necess√°rio minimizar o tempo de execu√ß√£o localmente (o desenvolvedor n√£o precisa esperar 10 minutos para confirmar uma linha) e garantir que todos os sistemas que fazem as altera√ß√µes tenham nosso sistema instalado. <br><br><h2>  Muitos requisitos - um sistema </h2><br>  Durante o desenvolvimento, h√° todo um conjunto de montagens que podem ser √∫teis: com e sem truques, beta ou alfa, iOS ou Android.  Em cada caso, podem ser necess√°rios recursos, configura√ß√µes ou mesmo c√≥digos diferentes.  Escrever scripts para testes est√°ticos para cada montagem poss√≠vel resulta em um sistema complexo com muitos par√¢metros.  Al√©m de ser dif√≠cil de manter e modificar, cada projeto tamb√©m possui seu pr√≥prio conjunto de bicicletas para muletas. <br><br>  Por tentativa e erro, chegamos a um sistema, em cada teste que pode levar em conta o contexto de inicializa√ß√£o e decidir se deve ou n√£o execut√°-lo, o que exatamente e como verificar.  No in√≠cio dos testes, identificamos tr√™s propriedades principais: <br><br><ul><li>  tipo de montagem: para recursos de libera√ß√£o e depura√ß√£o, as verifica√ß√µes diferem em termos de rigor, integridade da cobertura, al√©m de configura√ß√µes para identificadores e verifica√ß√£o da funcionalidade dispon√≠vel; </li><li>  plataforma: o que √© v√°lido para o Android pode estar incorreto para o iOS, os recursos tamb√©m s√£o coletados de maneira diferente e nem todos os recursos da vers√£o para Android estar√£o no iOS e vice-versa; </li><li>  local de inicializa√ß√£o: onde exatamente estamos iniciando - no agente de compila√ß√£o, onde todos os testes dispon√≠veis s√£o necess√°rios ou no computador do usu√°rio, onde a lista de inicializa√ß√µes precisa ser minimizada. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e86/9b4/a61/e869b4a61b7f46ba9d545058baa4af5a.png"></div><br><h2>  Sistema de teste est√°tico </h2><br>  O n√∫cleo do sistema e o conjunto b√°sico de testes est√°ticos s√£o implementados em python.  A base s√£o apenas algumas entidades: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d09/e44/1fd/d09e441fd62385fb616c3875cdc67a4d.png"></div><br>  <i>O contexto de teste</i> √© um conceito extenso.  Ele armazena os par√¢metros de compila√ß√£o e inicializa√ß√£o, sobre os quais falamos acima, bem como as meta-informa√ß√µes que os testes preenchem e usam. <br><br>  Primeiro, voc√™ precisa entender quais testes executar.  Para isso, as meta-informa√ß√µes cont√™m os tipos de recursos nos quais estamos interessados ‚Äã‚Äãespecificamente neste lan√ßamento.  Os tipos de recursos s√£o determinados por testes registrados no sistema.  Um teste pode ser "associado" a um √∫nico tipo ou v√°rios, e se no momento da confirma√ß√£o for constatado que os arquivos que esse teste verifica foram alterados, o recurso associado foi alterado.  Isso se encaixa convenientemente em nossa ideologia - executar localmente o menor n√∫mero poss√≠vel de verifica√ß√µes: se os arquivos pelos quais o teste √© respons√°vel n√£o foram alterados, n√£o √© necess√°rio execut√°-lo. <br><br>  Por exemplo, h√° uma descri√ß√£o do peixe, na qual o modelo 3D e a textura s√£o indicados.Se o arquivo de descri√ß√£o foi alterado, √© verificado se o modelo e a textura indicados nele existem.  Em outros casos, n√£o h√° necessidade de executar uma verifica√ß√£o de peixes. <br><br>  Por outro lado, alterar um recurso pode exigir altera√ß√µes e entidades, dependendo dele: se o conjunto de texturas que armazenamos em arquivos xml mudou, √© necess√°rio verificar modelos 3D adicionais, pois pode ser que a textura necess√°ria seja removida.  As otimiza√ß√µes descritas acima s√£o aplicadas apenas localmente na m√°quina do usu√°rio no momento da confirma√ß√£o e, quando iniciadas no farm de montagem, sup√µe-se que todos os arquivos foram alterados e executamos todos os testes. <br><br>  O pr√≥ximo problema √© a depend√™ncia de alguns testes de outros: √© imposs√≠vel verificar o peixe antes de encontrar todas as texturas e modelos.  Portanto, dividimos toda a execu√ß√£o em dois est√°gios: <br><br><ul><li>  prepara√ß√£o do contexto </li><li>  verifica√ß√£o </li></ul><br>  Na primeira etapa, o contexto √© preenchido com informa√ß√µes sobre os recursos encontrados (no caso dos peixes, com identificadores de padr√µes e texturas).  No segundo est√°gio, usando as informa√ß√µes armazenadas, basta verificar se o recurso desejado existe.  Um contexto simplificado √© apresentado abaixo. <br><br><pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VerificationContext</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, app_path, build_type, platform, changed_files=None)</span></span></span><span class="hljs-function">:</span></span>       self.__app_path = app_path       self.__build_type = build_type       self.__platform = platform       <span class="hljs-comment"><span class="hljs-comment">#          self.__modified_resources = set()       self.__expected_resources = set()       #      ,              self.__changed_files = changed_files       # -  ,          self.__resources = {} def expect_resources(self, resources):   self.__expected_resources.update(resources) def is_resource_expected(self, resource):   return resource in self.__expected_resources def register_resource(self, resource_type, resource_id, resource_data=None):   self.__resources.setdefault(resource_type, {})[resource_id] = resource_data def get_resource(self, resource_type, resource_id):   if resource_type not in self.__resources or resource_id not in self.__resources[resource_type]:       return None, None   return resource_id, self.__resources[resource_type][resource_id]</span></span></code> </pre> <br>  Tendo determinado todos os par√¢metros que afetam o in√≠cio do teste, conseguimos ocultar toda a l√≥gica dentro da classe base.  Em um teste espec√≠fico, resta escrever apenas o pr√≥prio teste e os valores necess√°rios para os par√¢metros. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestCase</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, name, context, build_types=None, platforms=None, predicate=None,               expected_resources=None, modified_resources=None)</span></span></span><span class="hljs-function">:</span></span>      self.__name = name      self.__context = context      self.__build_types = build_types      self.__platforms = platforms      self.__predicate = predicate      self.__expected_resources = expected_resources      self.__modified_resources = modified_resources      <span class="hljs-comment"><span class="hljs-comment">#               #   ,          self.__need_run = self.__check_run()      self.__need_resource_run = False  @property  def context(self):      return self.__context  def fail(self, message):      print('Fail: {}'.format(message))  def __check_run(self):      build_success = self.__build_types is None or self.__context.build_type in self.__build_types      platform_success = self.__platforms is None or self.__context.platform in self.__platforms      hook_success = build_success      if build_success and self.__context.is_build('hook') and self.__predicate:          hook_success = any(self.__predicate(changed_file) for changed_file in self.__context.changed_files)      return build_success and platform_success and hook_success  def __set_context_resources(self):      if not self.__need_run:          return      if self.__modified_resources:          self.__context.modify_resources(self.__modified_resources)      if self.__expected_resources:          self.__context.expect_resources(self.__expected_resources)   def init(self):      """        ,                    ,          """      self.__need_resource_run = self.__modified_resources and any(self.__context.is_resource_expected(resource) for resource in self.__modified_resources)  def _prepare_impl(self):      pass  def prepare(self):      if not self.__need_run and not self.__need_resource_run:          return      self._prepare_impl()  def _run_impl(self):      pass  def run(self):      if self.__need_run:          self._run_impl()</span></span></code> </pre> <br>  Voltando ao exemplo do peixe, precisamos de dois testes, um dos quais encontra texturas e as registra em contexto, o outro procura texturas para os modelos encontrados. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VerifyTexture</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TestCase)</span></span></span><span class="hljs-class">:</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, context)</span></span></span><span class="hljs-function">:</span></span>      super(VerifyTexture, self).__init__(<span class="hljs-string"><span class="hljs-string">'VerifyTexture'</span></span>, context,                                          build_types=[<span class="hljs-string"><span class="hljs-string">'production'</span></span>, <span class="hljs-string"><span class="hljs-string">'hook'</span></span>],                                          platforms=[<span class="hljs-string"><span class="hljs-string">'windows'</span></span>, <span class="hljs-string"><span class="hljs-string">'ios'</span></span>],                                          expected_resources=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>,                                          modified_resources=[<span class="hljs-string"><span class="hljs-string">'Texture'</span></span>],                                          predicate=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> file_path: os.path.splitext(file_path)[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-string"><span class="hljs-string">'.png'</span></span>)  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepare_impl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span>      texture_dir = os.path.join(self.context.app_path, <span class="hljs-string"><span class="hljs-string">'resources'</span></span>, <span class="hljs-string"><span class="hljs-string">'textures'</span></span>)      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> root, dirs, files <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.walk(texture_dir):          <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> tex_file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files:              self.context.register_resource(<span class="hljs-string"><span class="hljs-string">'Texture'</span></span>, tex_file) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VerifyModels</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TestCase)</span></span></span><span class="hljs-class">:</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, context)</span></span></span><span class="hljs-function">:</span></span>      super(VerifyModels, self).__init__(<span class="hljs-string"><span class="hljs-string">'VerifyModels'</span></span>, context,                                         expected_resources=[<span class="hljs-string"><span class="hljs-string">'Texture'</span></span>],                                         predicate=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> file_path: os.path.splitext(file_path)[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-string"><span class="hljs-string">'.obj'</span></span>)  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_run_impl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span>      models_descriptions = etree.parse(os.path.join(self.context.app_path, <span class="hljs-string"><span class="hljs-string">'resources'</span></span>, <span class="hljs-string"><span class="hljs-string">'models.xml'</span></span>))      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> model_xml <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> models_descriptions.findall(<span class="hljs-string"><span class="hljs-string">'.//Model'</span></span>):          texture_id = model_xml.get(<span class="hljs-string"><span class="hljs-string">'texture'</span></span>)          texture = self.context.get_resource(<span class="hljs-string"><span class="hljs-string">'Texture'</span></span>, texture_id)          <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> texture <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>:              self.fail(<span class="hljs-string"><span class="hljs-string">'Texture for model {} was not found: {}'</span></span>.format(model_xml.get(<span class="hljs-string"><span class="hljs-string">'id'</span></span>), texture_id))</code> </pre> <br><h2>  Propaga√ß√£o do Projeto </h2><br>  O desenvolvimento de jogos no Playrix ocorre em seu pr√≥prio mecanismo e, portanto, todos os projetos t√™m uma estrutura de arquivo e c√≥digo similares, usando as mesmas regras.  Portanto, existem muitos testes gerais que s√£o escritos uma vez e est√£o no c√≥digo geral.  √â suficiente para os projetos atualizarem a vers√£o do sistema de teste e conectar um novo teste a eles mesmos. <br><br>  Para simplificar a integra√ß√£o, escrevemos um corredor que recebe o arquivo de configura√ß√£o e os testes de design (sobre eles posteriormente).  O arquivo de configura√ß√£o cont√©m informa√ß√µes b√°sicas sobre as quais escrevemos acima: tipo de montagem, plataforma, caminho para o projeto. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Runner</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config_str, setup_function)</span></span></span><span class="hljs-function">:</span></span>      self.__tests = []      config_parser = RawConfigParser()      config_parser.read_string(config_str)      app_path = config_parser.get(<span class="hljs-string"><span class="hljs-string">'main'</span></span>, <span class="hljs-string"><span class="hljs-string">'app_path'</span></span>)      build_type = config_parser.get(<span class="hljs-string"><span class="hljs-string">'main'</span></span>, <span class="hljs-string"><span class="hljs-string">'build_type'</span></span>)      platform = config_parser.get(<span class="hljs-string"><span class="hljs-string">'main'</span></span>, <span class="hljs-string"><span class="hljs-string">'platform'</span></span>)      <span class="hljs-string"><span class="hljs-string">'''      get_changed_files         CVS      '''</span></span>      changed_files = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> build_type != <span class="hljs-string"><span class="hljs-string">'hook'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> get_changed_files()      self.__context = VerificationContext(app_path, build_type, platform, changed_files)      setup_function(self)  @property  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">context</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span>      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.__context  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add_test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, test)</span></span></span><span class="hljs-function">:</span></span>      self.__tests.append(test)  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span>      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> test <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.__tests:          test.init()      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> test <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.__tests:          test.prepare()      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> test <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.__tests:          test.run()</code> </pre> <br>  A beleza do arquivo de configura√ß√£o √© que ele pode ser gerado no farm de assemblies para diferentes assemblies no modo autom√°tico.  Mas passar as configura√ß√µes para todos os testes nesse arquivo pode n√£o ser muito conveniente.  Para fazer isso, h√° um xml de configura√ß√£o especial que √© armazenado no reposit√≥rio do projeto e as listas de arquivos ignorados, m√°scaras para pesquisa no c√≥digo e assim por diante s√£o gravadas nele. <br><br><div class="spoiler">  <b class="spoiler_title">Exemplo de arquivo de configura√ß√£o</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">[main] app_path = {app_path} build_type = production platform = ios</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Exemplo de ajuste de xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">root</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VerifySourceCodepage</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">allow_utf8</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">allow_utf8Bom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autofix_path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ci/autofix"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">IgnoreFiles</span></span></span><span class="hljs-tag">&gt;</span></span>*android/tmp/*<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">IgnoreFiles</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VerifySourceCodepage</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VerifyCodeStructures</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Checker</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"NsStringConversion"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Checker</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LogConstructions"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VerifyCodeStructures</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">root</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div></div><br>  Al√©m da parte geral, os projetos t√™m peculiaridades e diferen√ßas pr√≥prias; portanto, existem conjuntos de testes de projeto que s√£o conectados ao sistema atrav√©s da configura√ß√£o do corredor.  Para o c√≥digo nos exemplos, algumas linhas ser√£o suficientes para executar: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(runner)</span></span></span><span class="hljs-function">:</span></span>  runner.add_test(VerifyTexture(runner.context))  runner.add_test(VerifyModels(runner.context)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>  raw_config = <span class="hljs-string"><span class="hljs-string">'''  [main]  app_path = {app_path}  build_type = production  platform = ios  '''</span></span>  runner = Runner(raw_config, setup)  runner.run()</code> </pre> <br><h2>  Ancinho coletado </h2><br>  Embora o pr√≥prio python seja multiplataforma, tivemos problemas regularmente com o fato de os usu√°rios terem seu pr√≥prio ambiente exclusivo, no qual eles podem n√£o ter a vers√£o que esperamos, v√°rias vers√µes ou nenhum int√©rprete.  Como resultado, ele n√£o funciona como esperamos ou nem funciona.  Havia v√°rias itera√ß√µes para resolver esse problema: <br><br><ol><li>  Python e todos os pacotes s√£o instalados pelo usu√°rio.  Mas existem dois "buts": nem todos os usu√°rios s√£o programadores e a instala√ß√£o via pip install para designers, e tamb√©m para programadores, pode ser um problema. </li><li>  H√° um script que instala todos os pacotes necess√°rios.  Isso j√° √© melhor, mas se o usu√°rio tiver o python errado instalado, poder√£o ocorrer conflitos no trabalho. </li><li>  Fornecendo a vers√£o correta do interpretador e depend√™ncias do armazenamento de artefato (Nexus) e executando testes em um ambiente virtual. </li></ol><br>  Outra quest√£o √© o desempenho.  Quanto mais testes, mais longa a altera√ß√£o √© verificada no computador do usu√°rio.  A cada poucos meses, h√° um perfil e otimiza√ß√£o de gargalos.  Portanto, o contexto foi aprimorado, um cache para arquivos de texto apareceu e os mecanismos de predicado foram aprimorados (determinando que esse arquivo √© interessante para o teste). <br><br>  E resta apenas resolver o problema de como implementar o sistema em todos os projetos e for√ßar todos os desenvolvedores a incluir ganchos usados, mas essa √© uma hist√≥ria completamente diferente ... <br><br><h2>  Conclus√£o </h2><br>  Durante o processo de desenvolvimento, dan√ßamos no rake, lutamos muito, mas ainda temos um sistema que nos permite encontrar erros durante a confirma√ß√£o, reduzimos o trabalho dos testadores e as tarefas antes do lan√ßamento sobre a textura que faltava eram coisa do passado.  Para uma felicidade completa, uma configura√ß√£o simples do ambiente e a otimiza√ß√£o de testes individuais n√£o s√£o suficientes, mas os golens do departamento de ci trabalham duro nisso. <br><br>  Um exemplo completo do c√≥digo usado como exemplos no artigo pode ser encontrado em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nosso reposit√≥rio</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt452926/">https://habr.com/ru/post/pt452926/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt452910/index.html">Ol√° Habr! Ol√° Tercon</a></li>
<li><a href="../pt452914/index.html">ML em Scala com um sorriso, para aqueles que n√£o t√™m medo de experimenta√ß√£o</a></li>
<li><a href="../pt452916/index.html">Levante-se e v√° embora. Cirurgia da coluna vertebral: quando fazer, o que √© perigoso</a></li>
<li><a href="../pt452922/index.html">Tabelas de grade CSS flex√≠veis</a></li>
<li><a href="../pt452924/index.html">O que voc√™ precisa fazer para impedir que sua conta do Google seja roubada</a></li>
<li><a href="../pt452928/index.html">Restauramos m√°quinas virtuais do armazenamento de dados inicializado incorretamente. A hist√≥ria de um absurdo com um final feliz</a></li>
<li><a href="../pt452938/index.html">As armas da impressora 3D est√£o de volta e agora n√£o podem mais ser paradas</a></li>
<li><a href="../pt452942/index.html">GeekBrains realiza 12 reuni√µes on-line gratuitas com especialistas em programa√ß√£o</a></li>
<li><a href="../pt452944/index.html">Qual ser√° o "Di√°logo" de linguistas e especialistas em an√°lise de dados</a></li>
<li><a href="../pt452946/index.html">Relendo a filosofia de programa√ß√£o do Windows 95 / NT de Lou Greenaw</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>