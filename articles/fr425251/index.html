<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêº üéå üç£ LoJax: le premier rootkit UEFI connu utilis√© dans une campagne malveillante ü§í üßñüèº üë∏üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sednit Cybergroup, √©galement connu sous le nom de ART28, Strontium et Fancy Bear, fonctionne depuis au moins 2004. On pense que le groupe est √† l'orig...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>LoJax: le premier rootkit UEFI connu utilis√© dans une campagne malveillante</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/425251/">  Sednit Cybergroup, √©galement connu sous le nom de ART28, Strontium et Fancy Bear, fonctionne depuis au moins 2004.  On pense que le groupe est √† l'origine d'une s√©rie de cyberattaques r√©sonnantes.  Certaines <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">entreprises de l'IB</a> et le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">minist√®re am√©ricain de la Justice ont</a> appel√© Sednit responsable du piratage du Comit√© national d√©mocrate avant les √©lections am√©ricaines de 2016.  On attribue au groupe le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">piratage du</a> r√©seau mondial de t√©l√©vision TV5Monde, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fuite de</a> courriels de l'Agence mondiale antidopage (AMA) et d'autres incidents.  Sednit a de nombreux objectifs et une large gamme d'outils, dont certains que nous avons d√©j√† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">document√©s</a> pr√©c√©demment, mais pour la premi√®re fois dans ce travail, nous d√©crirons en d√©tail l'utilisation du rootkit UEFI. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ai/yf/nq/aiyfnqxa7dzic4myqh6eircpapo.jpeg"></div><br><a name="habracut"></a><h2>  Br√®ve revue </h2><br>  Nous avons constat√© qu'au moins depuis le d√©but de 2017, Sednit utilise une version trojanis√©e de l'ancien agent utilisateur du programme pour prot√©ger les appareils contre le vol par le d√©veloppeur d'Absolute Software - LoJack.  L'outil a attir√© l'attention des professionnels de la s√©curit√© de l'information en raison de l'utilisation du module UEFI / BIOS comme m√©canisme pour assurer la persistance.  Nous avons appel√© la version trojanis√©e de ce programme <b>LoJax</b> . <br><br>  La pr√©sence d'outils Sednit bien connus dans les syst√®mes infect√©s ainsi que des √©chantillons LoJax, ainsi que le fait que certains serveurs de commandes utilis√©s par des agents de Troie faisaient auparavant partie de l'infrastructure Sednit, nous permettent d'associer de mani√®re fiable un rootkit UEFI √† ce groupe. <br><br>  En collaboration avec les agents LoJax, des outils de lecture du micrologiciel du syst√®me UEFI ont √©t√© d√©couverts et, dans l'un des cas, cet outil pouvait vider, patcher et r√©√©crire une partie de la m√©moire flash SPI du syst√®me.  L'objectif ultime de l'outil est d'installer un module UEFI malveillant dans un syst√®me dont la protection SPI flash est vuln√©rable ou mal configur√©e. <br><br>  Le module UEFI est responsable de l'impl√©mentation de l'agent LoJax dans le syst√®me; il s'agit du premier rootkit UEFI identifi√© du groupe Sednit.  Comme il se trouve dans le micrologiciel du syst√®me, il peut survivre √† la r√©installation de Windows et au remplacement du disque dur. <br><br>  Il y a eu au moins un cas o√π ce rootkit a √©t√© install√© avec succ√®s dans la m√©moire flash SPI du syst√®me.  Selon nos informations, il s'agit du premier rootkit UEFI d√©couvert dans la nature. <br><br><h2>  Pr√©sentation </h2><br>  Sednit utilise un certain nombre de familles de logiciels malveillants.  Une description d√©taill√©e des outils de groupe fr√©quemment utilis√©s que nous avons fournis dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rapport</a> . <br><br>  Nous suivons l'activit√© de Sednit depuis plusieurs ann√©es et avons publi√© de nombreux rapports sur le travail du groupe - des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">descriptions des</a> vuln√©rabilit√©s zero-day aux programmes personnalis√©s tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Zebrocy</a> .  Les composants d√©crits dans ce rapport forment un groupe distinct. <br><br>  Les rootkits UEFI ont d√©j√† √©t√© d√©crits dans des rapports de soci√©t√©s de s√©curit√© de l'information.  Par exemple, rkloader, qui figurait dans une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pr√©sentation</a> sur la fuite de donn√©es dans l'√©quipe de piratage, et DerStarke, un implant en t√©l√©chargement macOS EFI / UEFI, √† partir de documents <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vault7</a> , sont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">connus</a> .  Nous sommes conscients de l'existence de ces outils, cependant, aucun rapport de compromis UEFI n'a √©t√© √©mis par les rootkits. <br><br>  Maintenant, nous avons non seulement prouv√© l'utilisation d'un micrologiciel dans la nature avec le module UEFI LoJax malveillant, mais nous avons √©galement trouv√© toute la gamme d'outils qui √©taient probablement utilis√©s pour l'installer.  Il est int√©ressant de noter que Sednit utilise le kit de d√©marrage DownDelph, qui a √©t√© utilis√© en 2013 et 2014 pour maintenir Downdelph, l'une des portes d√©rob√©es Sednit de premi√®re √©tape.  L'id√©e est similaire, mais dans la nouvelle version d'UEFI, l'utilisation de bootkits n'est plus possible.  Ainsi, ces deux composants diff√®rent consid√©rablement dans leur comportement. <br><br>  Ce travail est divis√© en trois sections.  Dans la premi√®re, nous analyserons les premi√®res √©tudes sur la s√©curit√© LoJack / Computrace et le potentiel d'utilisation malveillante du programme.  La deuxi√®me section est consacr√©e au processus de recherche, qui nous a finalement conduit au rootkit UEFI.  Enfin, dans la troisi√®me section, nous d√©crivons en d√©tail les diff√©rents composants LoJax et comment ils assurent la persistance dans le syst√®me m√™me apr√®s la r√©installation de Windows et le remplacement du disque dur. <br><br><h4>  Attribution </h4><br>  Alors que de nombreux fournisseurs ont d√©j√† fait des d√©clarations concernant le groupe Sednit dans le pass√©, ESET ne d√©termine en aucun cas son appartenance g√©opolitique.  Depuis la publication <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de l'√©tude</a> 2016, notre position n'a pas chang√©.  D√©terminer la source d'une cyberattaque sur la base d'une approche scientifique est une t√¢che complexe qui d√©passe le cadre des comp√©tences des sp√©cialistes ESET.  Ce que nous appelons le ¬´groupe Sednit¬ª n'est qu'un ensemble de logiciels et une infrastructure r√©seau associ√©e que nous ne pouvons pas associer avec autorit√© √† une organisation particuli√®re. <br><br><h4>  Buts </h4><br>  Au cours de l'√©tude, nous avons trouv√© un petit nombre d'images LoJax diff√©rentes.  Sur la base de nos donn√©es de t√©l√©m√©trie et d'une √©tude d'autres programmes Sednit d√©couverts dans la nature, nous sommes convaincus que ce module particulier a √©t√© rarement utilis√© en comparaison avec d'autres outils.  Les objectifs √©taient principalement des organisations √©tatiques situ√©es dans les Balkans, en Europe centrale et orientale. <br><br><h2>  Premi√®res recherches sur l'informatique / LoJack </h2><br>  LoJack - logiciel pour prot√©ger les ordinateurs contre le vol et la perte, d√©velopp√© par Absolute Software Corporation.  Les premi√®res versions de l'agent sont appel√©es Computrace.  Comme le nom pr√©c√©dent l'indique, apr√®s avoir activ√© le service, l'ordinateur peut acc√©der √† son serveur de commande - le propri√©taire sera inform√© de l'emplacement de l'appareil en cas de perte ou de vol. <br><br>  La section ci-dessous d√©crit l'ancienne architecture LoJack.  Seule l'ancienne version du logiciel a √©t√© pirat√©e par des cybercriminels, nous allons donc nous concentrer sur elle.  De plus, Absolute Software a publi√© en mai 2018 une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©claration</a> indiquant que les vuln√©rabilit√©s d√©crites ci-dessous n'affectent pas le fonctionnement des derni√®res versions de leurs agents. <br><br>  Le programme Computrace a attir√© l'attention des professionnels de la s√©curit√© de l'information car il a utilis√© une m√©thode inhabituelle pour assurer la persistance.  Son but est de se prot√©ger contre le vol, donc la r√©sistance √† la r√©installation du syst√®me d'exploitation et au remplacement du disque dur est importante pour lui - tout cela est impl√©ment√© dans le module UEFI / BIOS qui peut survivre apr√®s ces actions.  La solution est pr√©install√©e dans le firmware d'une partie importante des ordinateurs portables de diff√©rents fabricants, l'utilisateur n'a qu'√† activer cette fonction.  L'activation peut √™tre effectu√©e dans le BIOS, comme indiqu√© dans la figure ci-dessous. <br><br><img src="https://habrastorage.org/webt/rf/vx/i_/rfvxi_hexr1f29e0hqddhak97ag.png"><br>  <i>Figure 1. Activation de Computrace dans le BIOS</i> <br><br>  L'un des premiers rapports de mise en ≈ìuvre de LoJack / Computrace a √©t√© publi√© en 2009.  L'architecture globale du produit, le vidage du module UEFI / BIOS de l'agent utilisateur sur le disque et la fa√ßon dont l'agent communique avec un serveur Web contr√¥l√© par Absolute Software ont √©t√© d√©crits.  Le diagramme peut √™tre compris √† partir de la figure ci-dessous. <br><br><img src="https://habrastorage.org/webt/mh/5a/u2/mh5au2bhmrriy8sn8dtsd1g1avw.png"><br>  <i>Figure 2. M√©canisme de persistance LoJack (environ 2008)</i> <br><br>  Voici une description des √©tapes r√©pertori√©es ci-dessus: <br><br>  1. S'il est activ√©, le module UEFI / BIOS est ex√©cut√© au d√©marrage.  Il essaie de trouver la partition FAT / FAT32 / NTFS.  Ensuite, √† l'aide du pilote NTFS, il cr√©e une sauvegarde du fichier <code>autochk.exe</code> et √©crase son contenu avec le dropper, qui est responsable de l'installation du composant agent utilisateur.  Le fichier <code>autochk.exe</code> est un fichier ex√©cutable Windows qui est lanc√© √† un stade pr√©coce du d√©marrage du syst√®me pour v√©rifier les dommages possibles sur le disque dur. <br><br>  2. Lorsque le <code>autochk.exe</code> modifi√© d√©marre, son objectif principal est d'impl√©menter le mini-agent <code>rpcnetp.exe</code> et de l'ajouter en tant que service afin qu'il d√©marre √† chaque red√©marrage.  La derni√®re √©tape de ce composant consiste √† restaurer la version d'origine de <code>autochk.exe</code> . <br><br>  3. Mini-agent <code>rpcnetp.exe</code> - un petit fichier ex√©cutable dont le but est d'assurer le fonctionnement de l'agent principal.  Si l'agent principal ne fonctionne pas, <code>rpcnetp.exe</code> essaie de se connecter au serveur de commandes Absolute Software C&amp;C pour le t√©l√©charger et l'ex√©cuter.  Tout d'abord, le mini-agent fera une copie de lui-m√™me, puis apportera des modifications √† l'en-t√™te PE pour le convertir en DLL.  Cette biblioth√®que est ensuite charg√©e en m√©moire, appelle le processus <code>svchost.exe</code> et y injecte la DLL.  Ensuite, le processus Internet Explorer <code>iexplore.exe</code> d√©marre et la DLL y est inject√©e.  Ce dernier processus sera ensuite utilis√© pour la communication sur Internet.  L'injection de mini-agents Computrace dans des processus tiers se trouve souvent dans les logiciels malveillants et est rarement associ√©e √† des logiciels l√©gitimes. <br><br>  4. Un agent enti√®rement fonctionnel est maintenant en cours d'ex√©cution sur le syst√®me et peut utiliser les fonctions Computrace pour le suivi et la r√©cup√©ration. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Une description de</a> ce processus et du protocole r√©seau impliqu√© entre le mini-agent et le serveur C&amp;C a √©t√© publi√©e en 2014.  En raison de l'absence d'un m√©canisme d'authentification, si les attaquants contr√¥lent le serveur avec lequel le mini-agent communique, ils peuvent le forcer √† t√©l√©charger du code arbitraire.  Il existe plusieurs m√©canismes qui permettent aux attaquants de contacter directement le mini-agent.  Le plus important pour nous utilise la m√©thode d'obtention de l'adresse du serveur C&amp;C par le mini-agent.  En fait, ces informations sont stock√©es dans le fichier de configuration dans le fichier ex√©cutable lui-m√™me. <br><br><img src="https://habrastorage.org/webt/qc/ww/es/qcwwesoicwoyw1aghae1smpgnao.png"><br>  <i>Figure 3. Fichier de configuration de d√©chiffrement partiel LoJack chiffr√© √† droite</i> <br><br>  La figure montre le fichier de configuration du mini-agent LoJack.  La m√©thode de ¬´chiffrement¬ª utilis√©e est un XOR simple avec une cl√© √† un octet.  La cl√© 0xB5 est la m√™me pour tous les mini-agents √©tudi√©s.  Comme le montre la figure, le domaine C&amp;C est sp√©cifi√© dans le fichier.  Les quatre octets pr√©c√©dents contiennent l'adresse IP du serveur C&amp;C.  En l'absence de validation sur le contenu du fichier de configuration, les attaquants disposant d'autorisations d'√©criture dans <code>%WINDIR%</code> peuvent modifier son contenu afin que le mini-agent communique avec leur serveur de commandes, au lieu d'√™tre l√©gitime.  En comprenant le protocole r√©seau, vous pouvez effectuer le t√©l√©chargement du mini-agent et ex√©cuter du code arbitraire.  Ces risques sont connus depuis longtemps, mais jusqu'√† r√©cemment, le m√©canisme n'√©tait pas utilis√© dans la pratique. <br><br><h4>  LoJack se transforme en LoJax </h4><br>  En mai 2018, les √©chantillons Trobor du mini-agent LoJack, rpcnetp.exe, ont √©t√© d√©crits <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur le blog</a> Arbor Network.  Leurs param√®tres r√©seau cod√©s en dur ont √©t√© modifi√©s de sorte que des √©chantillons malveillants √©tablissent une connexion avec le serveur C&amp;C de l'attaquant au lieu du serveur l√©gitime Absolute Software.  Certains des domaines trouv√©s dans les exemples cheval de Troie ont √©t√© rencontr√©s plus t√¥t - ils ont √©t√© utilis√©s fin 2017 comme domaines de serveur C &amp; C pour SedUploader, la porte d√©rob√©e de la premi√®re √©tape du cybergroupe Sednit.  La figure ci-dessous montre un exemple de configuration modifi√©e dans l'un des mini-agents LoJax. <br><br><img src="https://habrastorage.org/webt/om/ts/md/omtsmdgqzbkn-fbqrpjd59abp7a.png"><br>  <i>Figure 4. A gauche, un fichier de configuration l√©gitime, √† droite, un fichier modifi√©</i> <br><br>  Les diff√©rences entre les agents l√©gitimes et les agents de Troie sont extr√™mement faibles, presque toutes sont donn√©es ci-dessus.  Les exemples de mini-agents LoJax que nous avons pu trouver sont des versions trojanis√©es du m√™me exemple de mini-agent Computrace, <code>rpcnetp.exe</code> .  Ils ont tous des horodatages de compilation identiques et seulement quelques dizaines d'octets diff√®rent de l'original.  Outre les modifications apport√©es au fichier de configuration, il existe des diff√©rences dans les variables de temporisation qui d√©terminent les intervalles entre les connexions au serveur C&amp;C. <br><br>  Au moment de la publication, nous avons trouv√© divers mini-agents LoJax utilis√©s dans des attaques contre diverses organisations dans les Balkans, en Europe centrale et orientale, mais nous n'avions aucune id√©e de la fa√ßon de les installer.  Une explication √©vidente serait d'installer en utilisant l'une des c√©l√®bres portes d√©rob√©es Sednit.  N'oubliez pas que LoJack, en tant qu'outil bien √©tabli, a √©t√© ajout√© √† la liste blanche par de nombreux fournisseurs d'antivirus.  Ainsi, m√™me si dans cette campagne, seul un mini-agent a √©t√© utilis√© qui n'a pas surv√©cu apr√®s la r√©installation de Windows, il avait quand m√™me un avantage - il √©tait moins susceptible d'√™tre d√©tect√© comme malware.  Mais que faire si le compromis √©tait encore plus profond et que les attaquants tentaient de copier LoJack pour acc√©der au firmware du syst√®me? <br><br><h2>  Chasser le composant de niveau inf√©rieur </h2><br>  Nous avons enregistr√© des attaques LoJax visant plusieurs organisations dans les Balkans, en Europe centrale et orientale.  Dans chacun d'eux, nous avons r√©ussi √† trouver des traces de logiciels malveillants Sednit, notamment: <br><br><ul><li>  SedUploader, porte d√©rob√©e du premier √©tage </li><li>  XAgent, la porte d√©rob√©e phare de Sednit </li><li>  Xtunnel, un outil proxy r√©seau qui peut transf√©rer tout trafic r√©seau entre un serveur C&amp;C sur Internet et un ordinateur de destination sur un r√©seau local </li></ul><br>  Nous avons trouv√© des traces d'outils Sednit dans la plupart des syst√®mes √©tudi√©s qui sont devenus des cibles LoJax, ainsi que dans quelques syst√®mes o√π seul LoJax √©tait pr√©sent.  On peut supposer que dans certains cas, LoJax a √©t√© utilis√© comme un outil s√©par√©, probablement comme porte d√©rob√©e suppl√©mentaire pour restaurer l'acc√®s des op√©rateurs Sednit au r√©seau. <br><br>  La porte d√©rob√©e XAgent d√©pose g√©n√©ralement des modules suppl√©mentaires dans un syst√®me compromis, il vient donc imm√©diatement √† l'esprit que les √©chantillons LoJax ont √©t√© livr√©s de la m√™me mani√®re, sans aucun autre m√©canisme.  On pourrait supposer que Sednit n'a emprunt√© qu'un mini-agent √† la solution LoJack.  Cependant, peu de temps apr√®s le d√©but de l'analyse, nous avons trouv√© plusieurs preuves indiquant que la source d'inspiration √©tait un peu plus √©tendue. <br><br><h4>  Pilote RWEverything (RwDrv) et info_efi.exe </h4><br>  Les premi√®res preuves ont √©t√© trouv√©es gr√¢ce √† un outil personnalis√© de cybercriminels qui, une fois ex√©cut√©s, ont d√©charg√© des informations sur les param√®tres du syst√®me de niveau inf√©rieur dans un fichier texte.  L'outil a √©t√© d√©couvert avec quelques √©chantillons LoJax.  La figure suivante montre un fragment du fichier <code>info_efi.exe</code> de cet outil sous le nom logique <code>info_efi.exe</code> . <br><br><img src="https://habrastorage.org/webt/8j/9x/kc/8j9xkcnbmste_xynugnkenaar6g.png"><br>  <i>Figure 5. Extrait des journaux de fichiers g√©n√©r√©s par info_efi .exe</i> <br><br>  Pour lire ce type d'informations, l'outil inclut un pilote appel√© <code>RwDrv.sys</code> .  Le pilote du noyau est livr√© avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RWEverything</a> , un utilitaire gratuit disponible sur le r√©seau qui peut √™tre utilis√© pour lire des informations sur presque tous les param√®tres de niveau inf√©rieur, y compris l'interface PCI Express, la m√©moire, les ROM optionnelles PCI, etc.  Le pilote du noyau est un logiciel l√©gitime et est sign√© avec un certificat valide. <br><br><img src="https://habrastorage.org/webt/2u/o-/mb/2uo-mbk6so15sdz9iusnxzl15qq.png"><br>  <i>Figure 6. Certificat de signature de code RwDrv.sys</i> <br><br>  RWEverything est livr√© avec une interface utilisateur graphique qui vous permet d'acc√©der √† toutes ces informations. <br><br><img src="https://habrastorage.org/webt/if/yp/dp/ifypdpu-hnounvupxelxhcp5el4.png"><br>  <i>Figure 7. Capture d'√©cran de l'interface RWEverything</i> <br><br>  La d√©couverte de l'outil <code>info_efi</code> √©t√© le premier signe qu'un module UEFI LoJax pouvait exister.  Lorsque vous essayez de mettre √† jour le micrologiciel du syst√®me, il est important d'avoir des informations sur son fournisseur, sa version, etc.  Compte tenu des vuln√©rabilit√©s qui permettent aux processus utilisateur d'acc√©der et de modifier le contenu de la m√©moire flash SPI o√π les modules UEFI sont stock√©s, l'obtention des donn√©es du microprogramme du syst√®me est la premi√®re √©tape d'une attaque r√©ussie. <br><br>  Le dernier indice qui nous a permis de trouver le premier rootkit UEFI du groupe Sednit √©tait deux outils - pour vider la m√©moire flash SPI et pour y √©crire. <br><br><h4>  Dump SPI Flash </h4><br>  La premi√®re pi√®ce du puzzle √©tait un fichier appel√© <code>ReWriter_read.exe</code> .  Il contenait tout le code n√©cessaire pour vider le flash SPI du syst√®me √† l'aide du pilote <code>RwDrv.sys</code> , <code>RwDrv.sys</code> .  Pour que le pilote de p√©riph√©rique effectue les op√©rations n√©cessaires, l'outil de vidage doit envoyer les codes de contr√¥le d'E / S corrects (IOCTL).  Alors que <code>RwDrv.sys</code> prend en charge de nombreux codes IOCTL diff√©rents, l'outil de vidage et l'outil d'√©criture d√©crits dans cette section et la section suivante n'en utilisent que quatre. <br><br>  RwDrv.sys: codes IOCTL pris en charge: <br><br>  <i>0x22280c</i> - √©crit dans la zone m√©moire allou√©e aux E / S <br>  <i>0x222808</i> - lit la zone de m√©moire allou√©e pour l'entr√©e-sortie <br>  <i>0x222840</i> - lit dword dans le registre de configuration PCI sp√©cifi√© <br>  <i>0x222834</i> - √©crit un octet dans le registre de configuration PCI sp√©cifi√© <br><br>  <code>ReWriter_read</code> cr√©e d'abord un service avec le <code>RwDrv.sys</code> noyau <code>RwDrv.sys</code> et √©crit les informations de configuration UEFI / BIOS, les valeurs correspondantes des trois champs contenus dans le registre de gestion du BIOS (BIOS_CNTL): BIOS Lock Enable (BLE), BIOS Write Enable (BIOSWE) et SMM BIOS D√©sactiver la protection en √©criture (SMM_BWP).  Bien que <code>ReWrite_read</code> n'utilise pas ces valeurs, dans les sections suivantes, nous expliquerons pourquoi ces champs pr√©sentent un int√©r√™t pour cet outil. <br><br>  La t√¢che suivante de l'outil consiste √† obtenir l'adresse de base de la zone de m√©moire du BIOS dans SPI et sa taille.  Ces informations sont contenues dans le registre de l'interface SPI principale en tant que r√©gion primaire du BIOS Flash.  Tous les registres sont affich√©s en m√©moire dans le bloc de registre complexe racine (RCRB), dont l'adresse de base peut √™tre obtenue en lisant le registre de configuration PCI souhait√©.  <code>ReWriter_read</code> obtient cette adresse en utilisant RwDrv IOCTL 0x22840 et en lisant le retrait correct (dans notre cas, 0xF0).  D√®s que l'adresse de base de la zone BIOS et sa taille sont connues, l'outil de vidage lit le contenu correspondant de la m√©moire flash SPI et l'√©crit dans un fichier sur le disque.  Le processus de lecture de la m√©moire flash SPI est illustr√© dans la figure suivante.  Les d√©finitions des abr√©viations sont donn√©es dans le glossaire ci-dessous. <br><br><img src="https://habrastorage.org/webt/mw/wm/tb/mwwmtbzbrwmm18l1w7-2iugvpxc.png"><br>  <i>Figure 8. La s√©quence de lecture de la m√©moire flash SPI</i> <br><br>  En plus des deux premi√®res √©tapes, ex√©cut√©es une seule fois, les op√©rations sont r√©p√©t√©es dans un cycle jusqu'√† ce que toutes les donn√©es de la m√©moire flash SPI aient √©t√© lues.  Le processus est √©galement bien d√©crit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  <code>ReWriter_read</code> valide ensuite la taille de l'image fusionn√©e.  Il analyse le descripteur de m√©moire d'image pour obtenir une gamme de zones BIOS, Gigabit Ethernet (GbE) et Management Engine (ME).  L'ajout des dimensions de ces trois zones permet √† l'outil de vidage de calculer l'int√©gralit√© du contenu du flash SPI.  Si la taille correspond √† la taille obtenue en lisant la zone de registre Flash du BIOS principal, l'image est consid√©r√©e comme correcte. <br><br><h4>  Patch du firmware UEFI </h4><br>  La deuxi√®me pi√®ce du puzzle √©tait un fichier appel√© <code>ReWriter_binary.exe</code> .  Ce fichier contient des preuves que Sednit est arriv√© au firmware.  Le fichier contient le code pour appliquer le correctif de l'image UEFI t√©l√©charg√©e et r√©√©crire la version trojanis√©e dans la m√©moire flash SPI.  Dans cette section, nous d√©crivons la structure de ce fichier binaire. <br><br>  Une fois le contenu de la m√©moire flash d√©charg√© et v√©rifi√© par l'outil ci-dessus, un module UEFI malveillant est ajout√© √† l'image.  Pour ce faire, l'image UEFI doit √™tre analys√©e pour mettre en √©vidence les informations n√©cessaires. <br><br>  Les donn√©es stock√©es dans l'image UEFI sont d√©compos√©es en volumes via le syst√®me de fichiers (FFS).  Comme son nom l'indique, il s'agit d'un syst√®me de fichiers sp√©cial pour stocker les images du micrologiciel.  Les volumes contiennent des fichiers avec des GUID.  Chaque fichier se compose g√©n√©ralement de nombreuses sections, dont l'une contient le PE / COFF ex√©cutable r√©el, qui est une image UEFI.  Ci-dessous, une capture d'√©cran de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">UEFITool</a> , un projet open source pour travailler avec des images de firmware UEFI, pour une compr√©hension plus simple du circuit. <br><br><img src="https://habrastorage.org/webt/s6/th/mp/s6thmpgjnornwankifoul8d9zlk.png"><br>  <i>Figure 9. Exemple d'une image de micrologiciel UEFI charg√©e dans UEFITool</i> <br><br>  ReWriter_binary analyse tous les volumes de micrologiciel trouv√©s dans la zone BIOS SPI de la m√©moire flash et recherche des fichiers sp√©cifiques: <br><br><ul><li>  IP4Dxe (8f92960f-2880-4659-b857-915a8901bdc8) </li><li>  NtfsDxe (768bedfd-7b4b-4c9f-b2ff-6377e3387243) </li><li>  SmiFlash (bc327dbd-b982-4f55-9f79-056ad7e987c5) </li><li>  Noyau DXE </li></ul><br><img src="https://habrastorage.org/webt/zt/ou/kc/ztoukch8w0mdyv-whzpkaibpc9u.png"><br>  <i>Figure 10. R√©sultat de l'utilisation du d√©compilateur Hex-Rays dans les volumes du micrologiciel</i> <br><br>  Ip4Dxe et NtfsDxe sont des pilotes DXE.  Dans le micrologiciel UEFI, les pilotes DXE sont des images PE / COFF cr√©√©es soit pour l'abstraction mat√©rielle, soit pour organiser les services √† utiliser par d'autres pilotes DXE ou applications UEFI.  Ces pilotes sont d√©tect√©s et t√©l√©charg√©s par la Fondation DXE via DXE Manager (noyau DXE) √† un stade pr√©coce du processus de d√©marrage.  Une fois cette phase termin√©e, tous les services, tels que le chargeur de syst√®me d'exploitation, sont disponibles pour travailler avec les applications UEFI.  En r√®gle g√©n√©rale, les pilotes DXE sont stock√©s dans le m√™me volume.  Cependant, le r√©partiteur DXE peut √™tre s√©par√©. <br><br>  <code>ReWriter_binary</code> recherche Ip4Dxe uniquement pour d√©terminer si un volume donn√© contient des pilotes DXE.  Comme nous le d√©crirons plus loin, ce volume devient un candidat pour l'installation du pilote DXE malveillant.  Il recherche √©galement le noyau DXE et ajoute le volume dans lequel il se trouve comme un autre candidat pour un endroit pour enregistrer un rootkit.  L'espace libre disponible dans chacun de ces volumes est stock√© et utilis√© ult√©rieurement pour v√©rifier la suffisance de l'ajout d'un pilote malveillant. <br><br>  NtfsDxe - pilote AMI NTFS DXE.  S'il est pr√©sent dans le volume du micrologiciel, son emplacement est enregistr√© et utilis√© ult√©rieurement pour supprimer ce fichier du volume.  Dans la section rootkit UEFI, nous verrons pourquoi il supprime ce fichier. <br><br>  Quant √† l'image SmiFlash, les informations qui s'y rapportent sont stock√©es, mais ne sont utilis√©es nulle part √† Malvari.  Fait int√©ressant, l'image <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">est vuln√©rable</a> .  Par cons√©quent, nous pensons que les op√©rateurs Sednit peuvent travailler pour exploiter ces vuln√©rabilit√©s.  Cela peut leur permettre d'√©crire m√™me des syst√®mes correctement configur√©s dans la m√©moire flash SPI.  Comme nous le dirons plus loin, dans sa forme actuelle, l'outil ne peut √©crire que dans la zone BIOS de syst√®mes mal configur√©s ou assez anciens (sur des cartes m√®res avec des chipsets plus anciens que le Platform Controller Hub, introduit vers 2008). <br><br>  Une fois les m√©tadonn√©es n√©cessaires allou√©es, <code>ReWriter_binary</code> le vidage de l'image UEFI et ajoute le pilote DXE malveillant.  Tout d'abord, il cr√©e l'en-t√™te du fichier (EFI_FFS_FILE_HEADER).  Il s√©lectionne ensuite le volume de destination en fonction de l'emplacement d'Ip4Dxe et du noyau DXE, ainsi que de l'espace libre disponible sur ces volumes.  <code>ReWriter_binary</code> int√®gre une section compress√©e contenant une image PE et une section d'interface utilisateur qui d√©finit un nom de fichier lisible par l'homme: SecDxe.  La section compress√©e est ajout√©e √† l'en-t√™te du fichier et √©crite √† la fin du volume, dans l'espace libre.  La figure ci-dessous montre la structure - son affichage dans UEFITool. <br><br><img src="https://habrastorage.org/webt/g6/9-/-a/g69--aub7xrb5b1iinzwrtpxyo8.png"><br>  <i>Figure 11. Vue du fichier SecDxe dans UEFITool</i> <br><br>  Enfin, si le pilote NtfsDxe est pr√©sent dans l'image, il sera supprim√©.  Le syst√®me de fichiers du micrologiciel stocke les fichiers et leur contenu de mani√®re s√©quentielle, le processus est donc assez simple: <br><br><ul><li>  retrait vers un espace libre √† la fin du volume </li><li>  0xFF octets √©crits au-dessus de l'image NtfsDxe </li><li>  la partie suivante du volume du micrologiciel est copi√©e, en commen√ßant par l'indentation o√π se trouvait NtfsDxe </li><li>  le reste du syst√®me de fichiers est rempli avec des octets 0xFF, c'est-√†-dire de l'espace libre </li></ul><br><h4>  R√©√©criture du micrologiciel patch√© dans la m√©moire flash SPI </h4><br>  Apr√®s avoir correctement modifi√© l'image du micrologiciel, l'√©tape suivante consiste √† la r√©√©crire dans la m√©moire flash SPI.  Avant de plonger dans ce processus, nous devons caract√©riser une partie de la protection en √©criture du BIOS qui est importante dans ce cas.  Les autres m√©canismes existants, tels que le BIOS de protection en √©criture de gamme, restent √† l'√©cart car ReWriter_binary ne les v√©rifie pas. <br><br>  La plateforme utilise plusieurs m√©canismes de s√©curit√© pour bloquer les tentatives d'√©criture non autoris√©es dans la zone du BIOS.  Je dois dire que ces m√©canismes ne sont pas activ√©s par d√©faut.  Le firmware est responsable de leur configuration correcte.  Ces configurations sont pr√©sent√©es dans le registre de contr√¥le du BIOS (BIOS_CNTL).  Il contient le bit BIOS Write Enable (BIOSWE), qui doit √™tre r√©gl√© sur ¬´1¬ª afin d'√©crire dans la zone BIOS de la m√©moire flash SPI.  √âtant donn√© que la plate-forme ne doit permettre aucune tentative d'√©criture dans la zone du BIOS, il y a un bit de plus dans BIOS_CNTL pour prot√©ger BIOSWE - c'est le BIOS Lock Enable (BLE).  Lorsqu'il est d√©fini, le m√©canisme doit bloquer le bit BIOSWE et laisser la valeur √©gale √† "0".  Cependant, la solution pr√©sente une vuln√©rabilit√©.  Lorsqu'une demande vient de changer le bit BIOSWE √† ¬´1¬ª, le bit BIOSWE √† ¬´1¬ª, et seulement apr√®s que la plate-forme interrompt la t√¢che √† l'aide de System Management Interrupt (SMI), le code de ce SMI remet le bit BIOSWE √† ¬´0¬ª. <br><br>  Il existe de nombreux probl√®mes dans cette version de la solution.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Premi√®rement, le processeur SMI est laiss√© aux d√©veloppeurs de firmware. Par cons√©quent, si ce code n'est pas impl√©ment√© dans le firmware, le bit BLE est inutile, car le bit BIOSWE ne sera pas remis √† "0". Deuxi√®mement, dans ce cas, nous avons une ¬´ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuln√©rabilit√© de condition de concurrence</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª qui nous permet de contourner compl√®tement ce m√©canisme, m√™me si le gestionnaire SMI est correctement impl√©ment√©. Pour exploiter cette vuln√©rabilit√©, un attaquant doit ex√©cuter un thread qui d√©finit en continu le BIOSWE sur ¬´1¬ª, tandis qu'un autre thread doit √©crire des donn√©es dans la m√©moire flash SPI. Selon les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">travaux de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kallenberg et Wojtchuk, cette attaque fonctionne sur des processeurs multic≈ìurs et peut √©galement √™tre utilis√©e avec succ√®s sur des processeurs monoc≈ìur avec la technologie Hyper-Threading activ√©e.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour r√©soudre ce probl√®me, un nouveau m√©canisme de protection configur√© via BIOS_CNTL a √©t√© ajout√© √† la plateforme. Il est introduit dans la famille des chipsets du Intel Platform Controller Hub (PCH). Si le bit de configuration est d√©fini, la d√©sactivation de la protection en √©criture du BIOS SMM (SMM_BWP) autorisera l'√©criture dans la zone du BIOS uniquement si tous les c≈ìurs sont en mode de gestion du syst√®me (SMM) et que le BIOSWE est d√©fini sur "1". Cela prot√®ge efficacement le syst√®me de la ¬´vuln√©rabilit√© de condition de concurrence¬ª d√©crite ci-dessus. Cependant, comme dans le cas de BLE, SMM_BWP doit √™tre activ√© du c√¥t√© du firmware. Par cons√©quent, le micrologiciel dans lequel ces m√©canismes sont mal configur√©s laisse le syst√®me √† risque d'accorder des droits d'√©criture non autoris√©s √† la zone du BIOS. </font></font><br><br> <code>ReWriter_binary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lit le contenu du registre de contr√¥le du BIOS pour s√©lectionner le chemin correct.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il v√©rifie d'abord si BIOSWE est d√©fini. Si c'est le cas, il entre dans la phase d'enregistrement. Si BIOSWE est d√©sactiv√©, il v√©rifie la valeur du bit BLE. S'il n'est pas install√©, il modifie la valeur du bit BIOSWE et commence √† enregistrer le firmware corrig√©. Si le bit BLE est d√©fini, il v√©rifie l'√©tat d√©sactiv√© SMM_BWP et applique la "vuln√©rabilit√© de condition de concurrence critique" d√©crite ci-dessus. Si le bit SMM_BWP est d√©fini, l'op√©ration √©choue. La figure ci-dessous illustre le processus. </font></font><br><br><img src="https://habrastorage.org/webt/db/3t/n5/db3tn5tpff0bgjciq9ciiy3a6p4.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 12. L'arbre de d√©cision pendant le processus d'enregistrement</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> En supposant que le fichier analys√© particulier a √©t√© </font></font><code>ReWriter_binary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilis√© pour d√©ployer le rootkit UEFI, nous pouvons conclure que le micrologiciel a mal configur√© la protection en √©criture du BIOS ou que le chipset de la machine victime est plus ancien que le Platform Controller Hub.</font></font><br><br> <code>ReWriter_binary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je n'ai pas pu remplacer le firmware UEFI sur un syst√®me moderne bien r√©gl√©. Cependant, lors de la recherche d'une image UEFI SmiFlash vuln√©rable, l'analyse des volumes de micrologiciel UEFI sugg√®re que les attaquants pourraient √©galement travailler avec </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> techniques de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">protection de contournement d'√©criture du BIOS</font></a><font style="vertical-align: inherit;"> plus avanc√©es </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De mani√®re tr√®s similaire √† la proc√©dure de lecture, l'√©criture dans la m√©moire flash SPI se produit: </font></font><br><br><img src="https://habrastorage.org/webt/ct/wi/v3/ctwiv38relsl9rpveltd8imrpjy.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 13. S√©quence d'√©criture dans la m√©moire flash SPI</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> En plus des deux premi√®res √©tapes, qui ne sont effectu√©es qu'une seule fois, ces op√©rations sont r√©p√©t√©es dans un cycle jusqu'√† ce que toutes les informations soient √©crites dans la m√©moire flash SPI . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une fois le processus d'enregistrement termin√©, le contenu de la m√©moire flash SPI est d√©charg√© √† nouveau dans un fichier </font></font><code>image.bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Le m√™me contr√¥le d'int√©grit√© qui a √©t√© effectu√©</font></font><code>ReWriter_read</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, s'ex√©cute sur une nouvelle image fusionn√©e. </font><font style="vertical-align: inherit;">Ensuite, l'image lue dans la m√©moire flash SPI est compar√©e √† l'image corrig√©e en m√©moire. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si des octets sont diff√©rents, leur adresse est √©crite dans le journal. </font><font style="vertical-align: inherit;">La pr√©sence ou l'absence de diff√©rences n'affecte pas la progression du malware. </font><font style="vertical-align: inherit;">Ces informations ne sont enregistr√©es que pour que les op√©rateurs comprennent ce qui se passe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä l'√©tape finale, la cl√© de Registre est d√©finie sur: </font></font><br><br> <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\BootExecute = ‚Äúautocheck autochk *‚Äù</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensuite, le service RwDrv est arr√™t√© et supprim√©. </font><font style="vertical-align: inherit;">Il est important que la valeur de cette ligne soit affect√©e √† la cl√© de registre Windows, car le rootkit UEFI recherche exactement cette ligne pour la modifier et ex√©cuter son composant au d√©marrage de Windows. </font><font style="vertical-align: inherit;">Nous en parlerons plus en d√©tail lorsque nous d√©crirons le rootkit UEFI et ses composants.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Analyse technique LoJax </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'outil de vidage, de correction et d'√©criture sur la m√©moire flash SPI est personnalis√© pour une image de micrologiciel sp√©cifique et ne peut √™tre utilis√© sur aucun syst√®me. Dans ce cas, le module UEFI complet peut √™tre distingu√©. La premi√®re chose que nous avons faite apr√®s avoir re√ßu ce module a √©t√© d'√©tudier les donn√©es de t√©l√©m√©trie pour savoir si elles avaient √©t√© vues auparavant. Pour cela, nous avons d√ª compter sur le nouveau scanner UEFI, qui peut scanner le firmware du syst√®me. Nous avons constat√© que le module UEFI du groupe Sednit a √©t√© install√© au moins une fois dans le syst√®me, ce qui signifie que ce rootkit est r√©ellement utilis√© dans la nature.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il n'est pas encore √©tabli comment les outils malveillants ont √©t√© livr√©s aux syst√®mes compromis. Tr√®s probablement, d'autres programmes ont √©t√© utilis√©s pour cela - par exemple, XAgent. Les outils de vidage et d'enregistrement ont √©t√© trouv√©s dans le m√™me syst√®me, mais √† des moments diff√©rents - probablement, les op√©rateurs ont travaill√© en plusieurs √©tapes. Tout d'abord, ils ont d√©charg√© le micrologiciel sur la machine cible, se sont assur√©s que l'outil pour effectuer des ajustements au programme fonctionnait sans √©checs, puis l'ont recharg√© et ont corrig√© le micrologiciel. Nous n'avons trouv√© qu'une seule version de l'outil pour le vidage et l'enregistrement, mais il est possible qu'il existe d'autres versions pour d'autres micrologiciels avec des vuln√©rabilit√©s qu'ils pourraient trouver.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La figure ci-dessous donne un aper√ßu du fonctionnement du rootkit UEFI jusqu'au d√©marrage du syst√®me d'exploitation. </font><font style="vertical-align: inherit;">Tout d'abord, le pilote SecDxe DXE est charg√© par le gestionnaire DXE. </font><font style="vertical-align: inherit;">De cette fa√ßon, la fonction de notification pour le groupe d'√©v√©nements est configur√©e </font></font><code>EFI_EVENT_GROUP_READY_TO_BOOT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Lorsque le micrologiciel est pr√™t √† s√©lectionner le p√©riph√©rique de d√©marrage et √† d√©marrer le chargeur de d√©marrage, la fonction de notification est appel√©e. </font><font style="vertical-align: inherit;">Elle effectue trois actions:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> charge le pilote NTFS DXE int√©gr√© pour fournir l'acc√®s et la capacit√© d'√©criture aux partitions NTFS </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √©crit deux fichiers sur la partition Windows NTFS: rpcnetp.exe et autoche.exe </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modifie la cl√© de registre ¬´HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Control \ Session Manager \ BootExecute¬ª: en: ¬´autocheck autochk *¬ª; </font><font style="vertical-align: inherit;">apr√®s: ¬´autocheck autoche *¬ª.</font></font></li></ul><br><img src="https://habrastorage.org/webt/at/qy/ec/atqyecti3adwerrfljy0ccirxgy.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 14. Processus de d√©marrage d'un syst√®me infect√© par un rootkit UEFI</font></font></i> <br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SecDxe: pilote DXE malveillant </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans cette section, nous allons r√©v√©ler la s√©quence d'√©v√©nements se produisant dans un syst√®me compromis. Nous commen√ßons par une description du rootkit, puis suivons la cha√Æne d'√©v√©nements jusqu'√† ce que les composants finaux soient d√©ploy√©s au niveau du syst√®me d'exploitation. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le rootkit UEFI de Sednit est un pilote DXE avec un GUID </font></font><code>682894B5-6B70-4EBA-9E90-A607E5676297</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il n'est pas sign√©, il ne peut donc pas √™tre ex√©cut√© sur un syst√®me avec la protection Secure Boot activ√©e. Apr√®s le d√©ploiement sur l'un des volumes de micrologiciel, DXE Foundation le t√©l√©charge √† chaque d√©marrage du syst√®me. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SecDxe est un petit pilote DXE qui fait essentiellement deux choses. Il met en place un protocole sp√©cifique au GUID.</font></font><code>832d9b4d-d8d5-425f-bd52-5c5afb2c85dc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui n'est jamais utilis√©. Il cr√©e ensuite un √©v√©nement associ√© √† la fonction de notification. La fonction de notification est configur√©e pour appeler un signal par groupe </font></font><code>EFI_EVENT_GROUP_READY_TO_BOOT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Le signal de ce groupe d'√©v√©nements provient du gestionnaire de d√©marrage lorsqu'il est pr√™t √† s√©lectionner le p√©riph√©rique √† d√©marrer. </font></font><br><br><img src="https://habrastorage.org/webt/sj/ff/6o/sjff6ohskqe2ewtsv8xnyis3oss.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 15. R√©sultat du d√©compilateur Hex-Rays passant par le processus de cr√©ation d'√©v√©nement</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La fonction de notification exploite le comportement malveillant du rootkit UEFI Sednit. Elle √©crit des composants dans le syst√®me de fichiers Windows NTFS. En r√®gle g√©n√©rale, le micrologiciel UEFI seul fonctionne avec la partition syst√®me EFI, de sorte que le pilote NTFS n'est g√©n√©ralement pas inclus. Seuls les syst√®mes de fichiers FAT sont pris en charge en tant que partitions √† t√©l√©charger. Par cons√©quent, le micrologiciel UEFI n'est pas n√©cessairement fourni avec des pilotes NTFS. Pour cette raison, SecDxe poss√®de son propre pilote NTFS int√©gr√©. Ce pilote d√©marre en premier et se connecte au p√©riph√©rique de disque. Autrement dit, il s'installe </font></font><code>EFI_SIMPLE_FILE_SYSTEM_PROTOCOL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur des p√©riph√©riques de disque avec des partitions NTFS, y compris ainsi l'acc√®s aux fichiers. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant que tout est pr√™t pour l'√©criture de fichiers sur les partitions Windows, SecDxe r√©initialise </font></font><code>rpcnetp.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>autoche.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Il est ensuite </font></font><code>rpcnetp.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">install√© </font></font><code>%WINDIR%\SysWOW64</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur les versions 64 bits de Windows ou</font></font><code>%WINDIR%\System32</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur les versions 32 bits. </font><font style="vertical-align: inherit;">A est </font></font><code>autoche.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©fini sur </font></font><code>%WINDIR%\SysWOW64</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">La figure suivante montre le processus responsable de l'√©criture de ces fichiers sur le disque. </font></font><br><br><img src="https://habrastorage.org/webt/si/jo/pn/sijopnar5xrablwh02xdrv5e37a.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 16. R√©sultat du d√©compilateur Hex-Rays passant par le processus d'√©criture de fichiers sur le disque,</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> puis SecDxe ouvre un </font></font><code>%WINDIR%\System32\config\SYSTEM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fichier avec une sauvegarde d'un ensemble de cl√©s de registre </font></font><code>HKLM\SYSTEM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il analyse le fichier jusqu'√† ce qu'il trouve </font></font><code>'autocheck autochk *'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et remplace </font></font><code>'k'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans </font></font><code>'autochk'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le </font></font><code>'e'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Par cons√©quent, il </font></font><code>'HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\ BootExecute'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devient </font></font><code>'autocheck autoche *'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Au prochain d√©marrage de Windows, autoche.exe sera lanc√© √† la place </font></font><code>autochk.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hacking Team NTFS Driver </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme indiqu√© pr√©c√©demment, le pilote NTFS est int√©gr√© au module SecDxe. Il existe des preuves solides que les op√©rateurs Sednit n'ont pas √©crit leur propre pilote, mais ont compil√© une copie du pilote NTFS DXE annonc√© de l'√©quipe de piratage. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leur pilote NTFS utilise le projet ntfs-3g comme noyau. Il s'agit simplement d'un wrapper pour le faire fonctionner en tant que pilote UEFI DXE. Le fichier INF de l'assembly du pilote Hacking Team r√©pertorie lui-m√™me les noms des fichiers de projet ntfs-3g. Les lignes de code du pilote SecDxe NTFS r√©pertorient √©galement bon nombre de ces noms de fichiers: </font><font style="vertical-align: inherit;">Il est int√©ressant de noter que le chemin d'acc√®s au projet est le m√™me que celui trouv√© dans vector-edk, le projet de d√©veloppement Hacking Team EFI. Il y a un sous-projet dans vector-edk</font></font><br><br> <code>- c:\edk2\NtfsPkg\NtfsDxe\ntfs\inode.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\volume.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\bootsect.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\unistr.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\attrib.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\mft.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\index.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\cache.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\misc.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\dir.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\runlist.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\logfile.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\uefi_io.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\ntfsinternal.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\mst.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\lcnalloc.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\compress.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\bitmap.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\collate.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\security.c</code> <br> <br><font style="vertical-align: inherit;"></font><code>NtfsPkg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec une disposition de r√©pertoire absolument identique. Les fichiers source du projet ntfs-3g sont situ√©s sur le m√™me chemin d'adresse. Et bien que les chemins eux-m√™mes soient banals, nous pensons que ce n'est pas une simple co√Øncidence. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En comparant le code source divulgu√© au r√©seau avec ce que nous avons obtenu √† la sortie du d√©compilateur Hex-Rays, il devient √©vident que c'est le m√™me projet. La figure ci-dessous montre un exemple de comparaison d'une fonction </font></font><code>NtfsDriverBindingStart</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tir√©e de </font></font><code>vector-edk/NtfsPkg/NtfsDxe/Ntfs.c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Les commentaires du code HT d'origine sont supprim√©s pour une meilleure perception. La logique et la s√©quence des appels de fonction sont identiques. Les deux projets utilisent m√™me une variable (LockedByMe) pour enregistrer un √©tat verrouill√©. </font></font><br><br><img src="https://habrastorage.org/webt/qn/-k/ut/qn-kutvxgtnyuqkcvvo8zwfglya.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 17. Comparaison des r√©sultats en sortie du pilote Sednit du d√©compilateur Hex-Rays NTFS (√† gauche) et du pilote NTFS HT (√† droite)</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le code ci-dessus montre les d√©veloppeurs de l'√©quipe de piratage, qui n'est pas dans l'open source ntfs-3g. Comme mentionn√© dans la section </font></font><code>ReWriter_binary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, lors de l'analyse du syst√®me de fichiers du micrologiciel, le fichier ex√©cutable essaie de supprimer le pilote AMI NTFS. Nous voulions comprendre pourquoi il est supprim√© au lieu d'√™tre utilis√©.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons analys√© le pilote et constat√© qu'il ne peut effectuer que des op√©rations de lecture. √âtant donn√© que l'√©criture dans le syst√®me de fichiers n'est pas disponible, les d√©veloppeurs ne pouvaient pas l'utiliser √† leurs propres fins. Il est √©galement probable que les op√©rateurs Sednit aient rencontr√© des difficult√©s en raison du fait qu'il existe d√©j√† un autre pilote NTFS dans le firmware, ils ont donc d√©cid√© de simplement le supprimer. En plus d'impl√©menter des capacit√©s de lecture et d'√©criture, le pilote Hacking Team ne respecte pas les autorisations de fichier. Par exemple, il peut remplacer un fichier en lecture seule sans provoquer d'erreur.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä ce stade, nous avons d√©j√† d√©crit diverses op√©rations de compromis du syst√®me effectu√©es par le rootkit UEFI. </font><font style="vertical-align: inherit;">Nous avons √©galement discut√© des raisons pour lesquelles les op√©rateurs Sednit ont utilis√© le code source vector-edk de la Hacking Team pour d√©velopper leur pilote NTFS pour √©crire des fichiers sur des partitions NTFS sous Windows. </font><font style="vertical-align: inherit;">Plus loin dans cet article, nous pr√©senterons une analyse des composants fournis par SecDxe.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">autoche.exe vs. </font><font style="vertical-align: inherit;">autochk.exe</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Malicieux est </font></font><code>autoche.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilis√© pour assurer la persistance du mini-agent </font></font><code>rpcnetp.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Comme vous pouvez le voir sur la figure suivante, il utilise des appels natifs √† l'API Windows pour cr√©er un service. </font></font><br><br><img src="https://habrastorage.org/webt/wc/dk/fv/wcdkfvfmcoog14t1orjmryouwd4.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 18. Malicious autoche .exe configure la persistance de rpcnetp.exe</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il convient de noter que le nom du service est le m√™me que celui utilis√© par l'agent Computrace l√©gitime. Apr√®s avoir cr√©√© le service, il restaure la valeur de cl√© de registre pr√©c√©dente </font></font><code>BootExecute</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><img src="https://habrastorage.org/webt/yz/wc/lj/yzwclj1loxeconb728wvsxqvyse.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 19. Le fichier autoche.exe malveillant restaure la valeur d'origine de la cl√© de registre BootExecute.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Comme le processus se produit au d√©marrage de Windows, il est peu probable que l'utilisateur remarque une modification de la valeur de la cl√©.</font></font><code>BootExecute</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il convient de noter que dans autoche .exe, certaines similitudes avec le module autochk.exe de Computrace sont visibles, par exemple, les appels d'API appliqu√©s et l'enregistrement des services, mais le reste est assez diff√©rent. </font><font style="vertical-align: inherit;">Le module Computrace est plus grand et il restaure le fichier ex√©cutable d'origine </font></font><code>autochk.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">au lieu de modifier la cl√© de Registre. </font><font style="vertical-align: inherit;">Il est √©galement responsable du d√©ploiement du mini-agent sur le disque, tandis que LoJax le fait avec le rootkit UEFI.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rpcnetp.exe </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bien que le mini-agent </font></font><code>rpcnetp.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puisse √™tre impl√©ment√© par le rootkit UEFI, il est probable que dans la plupart des cas, lorsque nous avons trouv√© une version trojanis√©e de LoJack, le mini-agent n'ait pas utilis√© ce composant. Il est probable qu'ils sont partis de consid√©rations opportunistes et n'ont install√© le rootkit UEFI que lorsqu'ils en ont eu l'occasion et dans les organisations les plus int√©ressantes pour eux. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au cours de l'enqu√™te, nous avons d√©couvert diff√©rentes versions du mini-agent LoJax. La liste des indicateurs de compromis montre leurs hachages et les domaines / adresses IP correspondants. Comme nous l'avons d√©j√† dit, tous les √©chantillons trouv√©s √©taient une version trojanis√©e du m√™me vieil agent Computrace, compil√© en 2008.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous n'avons jamais vu un agent LoJax t√©l√©charger et installer des modules suppl√©mentaires, mais nous savons qu'une telle fonctionnalit√© existe. </font><font style="vertical-align: inherit;">√âtant donn√© que les meilleures qualit√©s de LoJax sont la furtivit√© et la persistance, il peut certainement √™tre utilis√© pour fournir un acc√®s aux ressources cl√©s.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pr√©vention et r√©cup√©ration des attaques </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour pr√©venir une attaque, un √©cosyst√®me complexe compos√© de nombreux composants actifs est n√©cessaire. </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le premier m√©canisme de s√©curit√© qui pourrait bloquer une telle attaque est Secure Boot. Lorsque Secure Boot est activ√©, chaque composant du firmware t√©l√©charg√© √† la demande du firmware doit √™tre correctement sign√©, garantissant ainsi son int√©grit√©.</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous vous recommandons </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d'activer la fonction</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Secure Boot, c'est la protection de base contre les attaques sur le firmware UEFI. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme pour les logiciels, le firmware UEFI doit toujours √™tre mis √† jour en temps opportun. Visitez le site Web du fabricant de la carte m√®re pour vous assurer que vous disposez de la derni√®re version disponible.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous devez √©galement vous assurer que tous vos syst√®mes sont √©quip√©s de chipsets modernes avec le Platform Controller Hub (√† partir des chipsets Intel Series 5 et au-del√†). Cela garantira que les m√©canismes de s√©curit√© fonctionnent contre la ¬´vuln√©rabilit√© aux conditions de concurrence¬ª, qui, comme nous l'avons </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indiqu√©</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , est pr√©sente dans la plate-forme. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une autre partie de la s√©curit√© du micrologiciel est entre les mains des fournisseurs UEFI / BIOS. Les m√©canismes de s√©curit√© fournis par la plateforme doivent √™tre correctement configur√©s par le firmware du syst√®me afin d'assurer v√©ritablement sa protection. Par cons√©quent, le firmware doit √™tre initialement construit avec une compr√©hension des mesures de s√©curit√©. Heureusement, de plus en plus de chercheurs en s√©curit√© pr√™tent attention √† la s√©curit√© du firmware, attirant l'attention des fournisseurs. √Ä noter √©galement </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CHIPSEC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, un framework open source qui effectue une √©valuation de s√©curit√© de bas niveau pour d√©terminer si la plateforme est correctement configur√©e. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'√©limination des cons√©quences des compromis via le firmware UEFI est une t√¢che difficile. Il n'existe aucun moyen simple de nettoyer le syst√®me contre de telles menaces, et il n'y a pas de produits de s√©curit√© sp√©ciaux qui pourraient tout r√©parer. Dans le cas d√©crit ici, pour supprimer le rootkit, il est n√©cessaire de reflasher la m√©moire flash SPI. Cette t√¢che n'est pas anodine, elle ne convient pas √† l'utilisateur moyen. La mise √† jour du micrologiciel UEFI peut supprimer le rootkit si toute la zone SPI de la m√©moire flash est r√©√©crite. Si le flashage UEFI n'est pas possible, la seule solution est de remplacer la carte m√®re du syst√®me infect√©.</font></font><br><br><h2>  Conclusions </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le rootkit UEFI est l'un des outils les plus dangereux et les plus puissants des cybercriminels en raison de sa persistance et de son immunit√© √©lev√©es √† r√©installer le syst√®me d'exploitation et √† remplacer le disque dur, ainsi qu'√† la difficult√© exceptionnelle de d√©tection et de suppression. Bien que l'image UEFI du syst√®me soit difficile √† modifier, peu de solutions vous permettent d'analyser les modules UEFI et d'identifier parmi eux les modules malveillants. De plus, nettoyer le firmware UEFI signifie le flasher, ce qui n'est pas tout √† fait une op√©ration ordinaire qu'un utilisateur normal ne pourra pas effectuer. Ces avantages expliquent pourquoi les cybergroupes aux ressources illimit√©es continueront d'attaquer les syst√®mes UEFI. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour toute question concernant ce travail, veuillez contacter menaceintel@eset.com </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous tenons √† remercier ceux qui travaillent sur le projet opensecuritytraining.info. Cours</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'introduction au BIOS et au SMM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous a vraiment aid√©s lorsque nous avons analys√© les interactions avec la puce flash SPI.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Glossaire </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sp√©cifications </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">Intel</font></a><font style="vertical-align: inherit;"> pour une description plus d√©taill√©e des abr√©viations. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- BIOS_CNTL: Registre de contr√¥le du BIOS </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- BIOSWE: √âcriture du BIOS activ√©e </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- BLE: Verrouillage du BIOS activ√© </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- FADDR: Adresse Flash </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- FDATAX: Donn√©es Flash de FDATA0 √† FDATAN </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- FDBC: Nombre d'octets de donn√©es Flash </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- FGO: Cycle Flash Go </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- HSFC: S√©quen√ßage mat√©riel Contr√¥le Flash </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- HSFS: √âtat Flash du s√©quen√ßage mat√©riel </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- IOCTL: Contr√¥le d'entr√©e / sortie </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- PCH: Plateforme de contr√¥leur de plate-forme </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- RCBA: Registre d'adresse de base complexe racine </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- RCRB: Bloc de registre complexe racine </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- SCIP: Cycle SPI en cours </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- SMI: Interruption de la gestion du syst√®me </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- SMM: Mode de gestion du syst√®me</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- SMM_BWP: SMM BIOS Write Protect Disable </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- SPI: interface p√©riph√©rique s√©rie</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Indicateurs de compromis </font></font></h2><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ReWriter_read.exe </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©tection ESET </font></font><br> <code>Win32/SPIFlash.A</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-1</font></font><br> <code>ea728abe26bac161e110970051e1561fd51db93b</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ReWriter_binary.exe </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©tection ESET </font></font><br> <code>Win32/SPIFlash.A</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-1</font></font><br> <code>cc217342373967d1916cb20eca5ccb29caaf7c1b</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Secdexe </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©tection ESET </font></font><br> <code>EFI/LoJax.A</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-1</font></font><br> <code>f2be778971ad9df2082a266bd04ab657bd287413</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> info_efi.exe </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©tection ESET </font></font><br> <code>Win32/Agent.ZXZ</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-1</font></font><br> <code>4b9e71615b37aea1eaeb5b1cfa0eee048118ff72</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> autoche.exe </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©tection ESET </font></font><br> <code>Win32/LoJax.A</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-1</font></font><br> <code>700d7e763f59e706b4f05c69911319690f85432e</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> EXE Mini Agent </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©tection ESET </font><font style="vertical-align: inherit;">SHA-1</font></font><br> <code>Win32/Agent.ZQE <br> Win32/Agent.ZTU</code> <br><font style="vertical-align: inherit;"></font><br> <code>1771e435ba25f9cdfa77168899490d87681f2029 <br> ddaa06a4021baf980a08caea899f2904609410b9 <br> 10d571d66d3ab7b9ddf6a850cb9b8e38b07623c0 <br> 2529f6eda28d54490119d2123d22da56783c704f <br> e923ac79046ffa06f67d3f4c567e84a82dd7ff1b <br> 8e138eecea8e9937a83bffe100d842d6381b6bb1 <br> ef860dca7d7c928b68c4218007fb9069c6e654e9 <br> e8f07caafb23eff83020406c21645d8ed0005ca6 <br> 09d2e2c26247a4a908952fee36b56b360561984f <br> f90ccf57e75923812c2c1da9f56166b36d1482be</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Noms de domaine du serveur de commandes </font></font></h4><br> <code>secao[.]org <br> ikmtrust[.]com <br> sysanalyticweb[.]com <br> lxwo[.]org <br> jflynci[.]com <br> remotepx[.]net <br> rdsnets[.]com <br> rpcnetconnect[.]com <br> webstp[.]com <br> elaxo[.]org</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adresses IP du serveur de commandes </font></font></h4><br> <code>185.77.129[.]106 <br> 185.144.82[.]239 <br> 93.113.131[.]103 <br> 185.86.149[.]54 <br> 185.86.151[.]104 <br> 103.41.177[.]43 <br> 185.86.148[.]184 <br> 185.94.191[.]65 <br> 86.106.131[.]54</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mini agent DLL </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESET </font></font><br> <code>Win32/Agent.ZQE</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-1 </font><font style="vertical-align: inherit;">D√©tection </font></font><br> <code>397d97e278110a48bd2cb11bb5632b99a9100dbd</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serveur de commande Noms de domaine </font></font><br> <code>elaxo.org</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adresses IP du </font><font style="vertical-align: inherit;">serveur de commande</font></font><br> <code>86.106.131[.]54</code> </div> </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr425251/">https://habr.com/ru/post/fr425251/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr425241/index.html">D√©veloppeur 20 ans plus tard: Vasily Lebedev sur ICRE, l'√©ducation, son livre et sa programmation</a></li>
<li><a href="../fr425243/index.html">Le manuel de John Willis</a></li>
<li><a href="../fr425245/index.html">Annonce de RamblerFront & # 6</a></li>
<li><a href="../fr425247/index.html">Crowdsourcing dans les tests</a></li>
<li><a href="../fr425249/index.html">Comment est la connaissance du LLP √† l'Universit√© ITMO: le cours "Programmation de bas niveau"</a></li>
<li><a href="../fr425253/index.html">Nous faisons un projet d'apprentissage automatique en Python. Partie 1</a></li>
<li><a href="../fr425255/index.html">Algorithme de compression sans perte Broo et codage delta, comparaison avec Xdelta3. D√©veloppement de projets √† domicile</a></li>
<li><a href="../fr425259/index.html">Sauvegarder votre site en utilisant git et Makefile</a></li>
<li><a href="../fr425261/index.html">Les certificats EV sont morts</a></li>
<li><a href="../fr425263/index.html">Le festival iFEST se tiendra √† Nijni Novgorod</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>