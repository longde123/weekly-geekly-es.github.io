<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåª üîö üçª Desentra√±ar una mara√±a de vulnerabilidades en los sitios üîí üôçüèº üì™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Despu√©s de mi primer art√≠culo publicado en codeby, que ingres√≥ en las 3 principales publicaciones de la semana, estaba muy motivado para escribir el s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Desentra√±ar una mara√±a de vulnerabilidades en los sitios</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445112/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/op/nt/zy/opntzyfa45ep4f6dphmuztga1am.jpeg"></div><br>  Despu√©s de mi primer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> publicado en codeby, que ingres√≥ en las 3 principales publicaciones de la semana, estaba muy motivado para escribir el siguiente.  Pero el 11¬∫ grado impone restricciones en el tiempo libre que se prepara para el examen y las olimpiadas.  Por lo tanto, escribo el segundo solo despu√©s de unos meses despu√©s de <s>volar de todas las Olimpiadas</s> . <br><br>  Esta publicaci√≥n hablar√° de un caso interesante cuando una vulnerabilidad encontrada en un recurso implica una cadena de encontrarlos en varios otros sitios. <br><a name="habracut"></a><br><h3>  Comenzando </h3><br>  Todo comenz√≥ con la comprobaci√≥n del sitio de un importante fabricante de productos falsificados.  La cuenta personal del usuario no estaba all√≠ y el √°rea de b√∫squeda de vulnerabilidades no era demasiado extensa. <br><br>  Al probar el formulario de env√≠o de pedidos, se descubrieron varias vulnerabilidades en √©l. <br>  En primer lugar, este es un XSS almacenado bastante est√°ndar en los datos del comprador, con el que se extendi√≥ esta mara√±a.  XSS es est√°ndar, y la falta de una marca "httponly" en una cookie claramente no era est√°ndar.  Muchas veces recib√≠ cookies de varios sitios, pero nunca recib√≠ autorizaci√≥n, y comenc√© a dudar de que en la naturaleza hab√≠a sitios que no usaban la bandera "httponly", porque su uso reduce significativamente el riesgo de ataques XSS.  Fue a√∫n m√°s sorprendente encontrar un evento de este tipo en el sitio de una gran empresa.  Pero, como result√≥, el servicio que permiti√≥ esta supervisi√≥n fue mucho mayor de lo que esperaba.  Pero m√°s sobre eso despu√©s. <br><br>  Sustitu√≠ las cookies recibidas e inici√© sesi√≥n en la cuenta CRM del sistema del sitio (no pude resistirme, por primera vez tuve tanta suerte).  Los derechos no eran administrativos, pero eran suficientes para acceder a cualquier estad√≠stica sobre pedidos, incluidos  y datos del cliente. <br><br><img src="https://habrastorage.org/webt/sq/wx/wx/sqwxwxuqyvlrpkdnoscc0pbv4ds.png"><br><br>  Hice capturas de pantalla para demostrar la existencia de una vulnerabilidad y envi√© un informe.  Pas√≥ m√°s de una semana y ya no estaba esperando una respuesta.  Seg√∫n las estad√≠sticas, si no recibe respuesta dentro de los tres d√≠as, puede olvidarse de ellos.  Pero despu√©s de 8 d√≠as, lleg√≥ una respuesta inesperada.  Y a√∫n m√°s, fueron los primeros en pagarme por la vulnerabilidad encontrada. <br><br><img src="https://habrastorage.org/webt/ob/rh/xh/obrhxhj_o-hjay2gz1unykm8-im.png"><br><br>  Volviendo a probar el formulario de env√≠o de pedidos, tambi√©n encontr√© una vulnerabilidad de iDOR que le permite cambiar el precio del pedido editando los par√°metros "json_order [0] [precio]" y "json_order [0] [total]" en la solicitud POST domain.ru/shop.php .  La sustituci√≥n del enlace de orden en la misma solicitud en el campo json_order [0] [href] condujo a una RFI. <br><br>  No se recibi√≥ respuesta al mensaje sobre nuevos hallazgos ... <br><br><h3>  Continuaci√≥n </h3><br>  En ese sitio de crm, el sistema result√≥ no estar escrito por s√≠ mismo, sino que fue proporcionado para el pago por un servicio conocido.  Despu√©s de su error con la cookie, era l√≥gico suponer que habr√≠a otras vulnerabilidades. <br><br>  Si el script enviado por m√≠ a trav√©s del formulario de pedido funcion√≥, entonces no hubo validaci√≥n de campo tanto en el sitio deseado como en el sistema CRM.  x2.  Por lo tanto, despu√©s de recibir una cuenta de prueba, comenc√© buscando campos vulnerables a xss. <br><br>  Despu√©s de largos viajes a trav√©s del extenso sistema de crm, se identificaron m√°s de una docena de campos con validaci√≥n insuficiente.  En alg√∫n lugar, puede insertar directamente la etiqueta del script, en alg√∫n lugar debe usar scripts en l√≠nea del tipo "onmouseover = alert ()".  Adem√°s, en algunos lugares fue posible incrustar un gui√≥n, pero en algunos lugares, me pregunto qu√© l√≥gica fueron guiados, agregando filtros en algunos lugares y no en otros.  Desde el punto de vista del prop√≥sito l√≥gico de los campos, no vi un patr√≥n.  En algunos lugares, donde casi no todos ir√°n, todo funcion√≥ bien, pero, por ejemplo, no se molestaron en agregar filtros al nombre de la contraparte. <br><br>  Los campos m√°s vulnerables no pueden ser influenciados externamente.  Solo podr√≠an ser utilizados por los empleados para mejorar sus derechos en el sistema, lo que tambi√©n es importante. <br><br>  Con xss se acab√≥, fue posible pasar a cosas m√°s interesantes. <br><br>  Nunca he buscado vulnerabilidades CSRF antes, los sitios que he probado no estaban en la clase contra la cual usar√≠an phishing.  Por lo tanto, no quer√≠a molestarme a m√≠ mismo ni a los propietarios de sitios con vulnerabilidades que nunca se usar√≠an contra ellos.  Fue un caso radicalmente diferente.  Este sistema de crm era popular, tambi√©n lo usaban las grandes tiendas en l√≠nea, adem√°s, exist√≠a la posibilidad de conectar cajas de efectivo de puntos de venta minoristas, lo que hac√≠a que el problema de seguridad fuera a√∫n m√°s importante. <br><br>  Sorprendentemente, no hab√≠a protecci√≥n contra CSRF.  Fue posible enviar cualquier solicitud, los controles no se llevaron a cabo en ning√∫n lado. <br>  - ¬øCambiar la informaci√≥n de la cuenta?  por favor <br>  - Cambiar el nombre y el precio de los bienes?  - no hay duda <br><br>  Al mismo tiempo, las cookies conten√≠an algo llamado "csrftoken". <br><br>  Entonces a√∫n pens√©, ¬øcu√°l es el punto de poner el token csrf en las cookies?  Buscando en Google, descubr√≠ que hay una forma bastante conveniente de protegerse contra csrf con un token en cookies y duplicarlo en una solicitud posterior, en la que no es necesario almacenar el token en el servidor.  M√°s detalles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br>  Pero en nuestro caso, solo se realiz√≥ la mitad del trabajo, el token se coloc√≥ en cookies y estuvo ausente en las solicitudes al servidor.  Y a√∫n m√°s, su eliminaci√≥n completa de las cookies no cambi√≥ nada.  ¬øPor qu√© fue agregado? <br><br>  En conjunci√≥n con el csrf descubierto, nuestro xss, que no era accesible previamente desde el exterior, obtiene una segunda vida.  Despu√©s de todo, no necesitamos ingresar a nuestra cuenta para editar campos vulnerables. <br><br>  Adem√°s, mediante la sustituci√≥n del tipo mime del archivo, se pueden cargar archivos arbitrarios en el servidor.  Pero el servidor se configur√≥ correctamente y los scripts php no se ejecutaron all√≠. <br><br>  Adem√°s m√°s interesante.  Todos los datos sobre bienes que la tienda en l√≠nea tom√≥ de crm.  Es decir  nombre, descripci√≥n, foto.  El enlace a la imagen del producto era "aaaa.domain.ru/file/get/id=xxx".  Para que la tienda en l√≠nea pueda tomar im√°genes, deben tener derechos de lectura para todos.  122) <br><br>  Despu√©s de comprobar las rutas a lo largo de las cuales se almacenan otros archivos m√°s privados, vi la misma URL.  No parece nada sorprendente, probablemente tengan otros derechos de acceso.  No inferior a 022 definitivamente.  Pero, la realidad result√≥ ser ligeramente diferente, tambi√©n ten√≠an acceso gratuito para usuarios no autorizados. <br><br>  - ¬øHa solicitado importar datos de pedido en un archivo exel?  - Genial, ahora cualquiera puede descargarlo. <br><br>  ¬øQuiz√°s la identificaci√≥n parec√≠a "yt5bjFb54hb # HJ% $ p" y no cedi√≥ ante la fuerza bruta?  No tampoco.  Todos los archivos de identificaci√≥n ten√≠an un formato num√©rico y estaban en el rango de varios miles.  Protecci√≥n contra brutus, tampoco me di cuenta.  Habiendo escaneado todas las identificaciones de 1 a 10000 obst√°culos no se encontraron.  Repetido varias veces m√°s, nadie estaba interesado en tal actividad. <br><br>  Respondieron mi informe en 3 d√≠as. <br><br>  Con respecto a la falta de una bandera, httponly dijo que faltaba "Aparentemente hace mucho tiempo, desde que se actualiz√≥ la versi√≥n de php".  Encendido el mismo d√≠a. <br><br>  Seg√∫n xss, dijeron que todo el mundo sabe que el filtro se apag√≥ a principios de verano (en ese momento ya era agosto), por supuesto, esto no explica por qu√© se estaba filtrando en alg√∫n lugar, pero no en alg√∫n lugar, pero supongamos que no nos dimos cuenta de esto. inconsistencia  Tambi√©n aseguraron que el filtro se lanzar√° en un par de d√≠as.  De hecho, result√≥ que en un par de meses.  Pero, aqu√≠ los entiendo perfectamente: tambi√©n plane√© comenzar a prepararme para los ex√°menes en un par de d√≠as ... <br><br>  Subir archivos arbitrarios al servidor les preocupaba poco, ya que no se ejecutan en el servidor, lo que significa que no hay nada de qu√© preocuparse.  Solo al momento de escribir el art√≠culo tuve una idea de si un sitio que ya se encuentra en un hosting que no sea CRM est√° tratando de tomar una imagen del producto para el escaparate, pero recibe un script php, ¬ølo ejecutar√°?  O debido al hecho de que est√° destinado a la etiqueta img, ¬øse procesar√° solo como una imagen?  ¬øO depende de la configuraci√≥n del servidor?  Por favor responda a personas con conocimiento. <br><br>  La respuesta al informe csrf result√≥ ser bastante interesante.  Respondieron con una pregunta: "¬øQu√© consideras un token para protecci√≥n contra ataques csrf?"  Realmente, ¬øde qu√© estoy hablando? <br><br><img src="https://habrastorage.org/webt/yb/i9/kd/ybi9kdjzr9bkmx7hxozvmsup5ta.png"><br><br>  Dijeron sobre el libre acceso a cualquier archivo que no tuvieron en cuenta este momento.  Cerrado de inmediato. <br><br>  Debo decir que este fue el √∫nico momento en que realmente esperaba recibir una recompensa en efectivo.  El sitio es grande, excepto que a√∫n no hay un proyecto pagado.  Revista popular en l√≠nea.  Pero solo recibi√≥ gratitud verbal. <br>  Debo agradecerles, me tranquilic√© a√∫n m√°s sobre el tema del pago.  Trabajar por el bien de la gratitud en cualquier forma finalmente no conducir√° a nada.  Te acostumbrar√°s a cualquier elogio y otros honores, y dejar√°n de brindar satisfacci√≥n.  Y si hiciste todo por ellos, entonces se perder√° el significado de hacer algo.  Y no puede perder el placer del proceso de su actividad, resolver nuevos problemas, crear algo nuevo.  Trabaja por el bien del trabajo, no importa lo trivial que pueda sonar.  El trabajo durante el cual no te das cuenta de c√≥mo pasan las horas, c√≥mo el sol logr√≥ no solo ir m√°s all√° del horizonte, sino tambi√©n salir nuevamente a causa de √©l. <br><br>  '' ' <br>  Estamos satisfechos con lo peque√±o, la felicidad no est√° en mucho dinero <br>  "Haz lo que amas" - apreciado en nuestros c√≠rculos <br>  '' '¬© Kolya Manyu - Todos los d√≠as <br><br><h3>  Final </h3><br>  En el soporte t√©cnico del sitio anterior, se utiliz√≥ el sistema de recepci√≥n de tickets de terceros UserEcho.  No fall√© en comprobarlo.  En sue√±os, por supuesto, era posible tener la oportunidad de leer cualquier boleto privado.  Naturalmente, no tuve √©xito.  Ten√≠a que contentarme con poco. <br><br><img src="https://habrastorage.org/webt/hv/p3/ws/hvp3wsbj374dcubvzwlma57tyas.png"><br><br>  Al probar la API que funcionaba con tickets, inicialmente no se notaron anomal√≠as, el derecho de no mirar a alguien m√°s, de no suscribirse no era posible.  Pero, al seguir estudiando el sitio, result√≥ que los desarrolladores hicieron una peque√±a falla. <br>  En el perfil, puede encontrar una secci√≥n sobre la administraci√≥n de sus boletos, indicando aquellos a los que se suscribi√≥ o a los que se suscribi√≥ anteriormente. <br><br><img src="https://habrastorage.org/webt/sb/qb/fo/sbqbfojkn8xdxdjc-pgm76w68g8.png"><br><br>  Si enviamos una solicitud para cancelar la suscripci√≥n del boleto de otra persona, se nos informa, como se esperaba, que no tenemos derechos para esta acci√≥n.  Pero al mismo tiempo, est√° incluido en nuestra lista de boletos, como uno de los que nos suscribimos anteriormente.  Por lo tanto, tenemos la oportunidad de averiguar su nombre y url con el formato "ticket_name_name_in_translate".  Este da√±o, por supuesto, no llev√≥ a ninguno.  En casos muy raros, ser√° posible aprender algo importante y valioso del nombre.  Pero era mejor que quedarse sin nada en absoluto. <br><br>  Despu√©s de un par de semanas, se solucion√≥ el error. <br><br>  ¬°Agradezco a todos los que leyeron hasta el final! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/445112/">https://habr.com/ru/post/445112/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445102/index.html">Animaci√≥n flash en Unity3D desde cero. Primera parte, l√≠rica</a></li>
<li><a href="../445104/index.html">Una breve historia de la marca de audio Klipsch</a></li>
<li><a href="../445106/index.html">Mesa redonda: tecnolog√≠a aditiva como alternativa a la fabricaci√≥n tradicional</a></li>
<li><a href="../445108/index.html">Ni un halc√≥n: proyectos reutilizables de ESA y ULA fundamentalmente diferentes</a></li>
<li><a href="../445110/index.html">Una computadora con una unidad de terminal de estilo Fallout</a></li>
<li><a href="../445114/index.html">Sandboxing mejorado para scripts geniales</a></li>
<li><a href="../445116/index.html">La Fuerza A√©rea de EE. UU. Est√° trabajando en un dron de inteligencia artificial llamado Skyborg</a></li>
<li><a href="../445118/index.html">En un chat privado de Telegram, puede eliminar cualquier mensaje, incluso extra√±os (se ha agregado un resultado de votaci√≥n)</a></li>
<li><a href="../445120/index.html">Frontend Weekly Digest (18-24 de marzo de 2019)</a></li>
<li><a href="../445122/index.html">El resumen de materiales frescos del mundo del front-end para la √∫ltima semana No. 357 (18 al 24 de marzo de 2019)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>