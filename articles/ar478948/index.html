<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ง๐ผ ๐จ๐ฟโ๐ โ๏ธ ุงุจุญุซ ุนู ููุงุท ุงูุถุนู ูู Samsung TrustZone ุฃู AFL ๐ป โ๐ผ ๐ฏ๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุน ูุฑูุฑ ุงูููุช ุ ุชุธูุฑ ุงููุฒูุฏ ูู ุงูุชูููุงุช ุงูููุงุฆูุฉ ุ ูุงูุชู ุจุณุจุจูุง ูุฌุจ ุนูู ุงููุชุณูููู ุชุดุฏูุฏ ุณููุฑูู ุจุฅุญูุงู. ููุน ุฐูู ุ ุชุญุชูู ูุฐู ุงูุนููุฉ ุนูู ูุฌููู: ุชูููุงุช ุงู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุงุจุญุซ ุนู ููุงุท ุงูุถุนู ูู Samsung TrustZone ุฃู AFL</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/478948/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/uk/fw/rl/ukfwrlxwv9vr1rrwahfzdidi9na.jpeg"></p><br><p style=";text-align:right;direction:rtl">  ูุน ูุฑูุฑ ุงูููุช ุ ุชุธูุฑ ุงููุฒูุฏ ูู ุงูุชูููุงุช ุงูููุงุฆูุฉ ุ ูุงูุชู ุจุณุจุจูุง ูุฌุจ ุนูู ุงููุชุณูููู ุชุดุฏูุฏ ุณููุฑูู ุจุฅุญูุงู.  ููุน ุฐูู ุ ุชุญุชูู ูุฐู ุงูุนููุฉ ุนูู ูุฌููู: ุชูููุงุช ุงูุฏูุงุน ุชูุดุฆ ุฃูุถูุง ุณุทุญ ูุฌูู ุฅุถุงูู ุ ูููุงูุชูุงู ุญูููุง ุ ูุง ุนููู ุณูู ุงุณุชุฎุฏุงู ููุงุท ุงูุถุนู ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุฎุงุตุฉ ุจูู. </p><br><p style=";text-align:right;direction:rtl"> ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ูุงุญุฏุฉ ูู ูุฐู ุงูุชูููุงุช - ARM TrustZone.  ุชุญุชูู ุชุทุจููุงุชู ุนูู ูุฏุฑ ูุจูุฑ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุ ูููุจุญุซ ุนู ููุงุท ุงูุถุนู ูููุง ุ ุชุญุชุงุฌ ุฅูู ุทุฑููุฉ ุชููุงุฆูุฉ.  ูุณุชุฎุฏู ุงูุทุฑููุฉ ุงููุฏููุฉ ุงููุซุจุชุฉ - ุงูุบูุบูุฉ.  ููู ุฐูู! </p><br><p style=";text-align:right;direction:rtl">  ุณูุฎูู ุงูุชุทุจููุงุช ุงูุฎุงุตุฉ ุงูุชู ุธูุฑุช ูุน ุฅุฏุฎุงู ุชูููุฉ TrustZone - Trustlets.  ููุตู ุจุงูุชูุตูู ุทุฑููุฉ ุงูุฏูุฌ ุงูุชู ุงุฎุชุฑูุงูุง ุ ููุชูู ุฃููุงู ุฅูู ูุธุฑูุฉ TrustZone ูุฃูุธูุฉ ุงูุชุดุบูู ุงูููุซููุฉ ูุงูุชูุงุนู ูุน ูุธุงู ุงูุชุดุบูู ุงูุชูููุฏู.  ูุฐุง ููุณ ููุชุฑุฉ ุทูููุฉ.  ุฏุนูุง ูุฐูุจ! </p><a name="habracut"></a><br><h2 id="arm-trustzone" style=";text-align:right;direction:rtl">  ARM TrustZone </h2><br><p style=";text-align:right;direction:rtl">  ุชุณูุญ ูู ุชูููุฉ TrustZone ูู ูุนุงูุฌุงุช ARM ุจููู ูุนุงูุฌุฉ ุงููุนูููุงุช ุงูุณุฑูุฉ ุฅูู ุจูุฆุฉ ุขููุฉ ูุนุฒููุฉ.  ูุชู ุชูููุฐ ูุฐู ุงููุนุงูุฌุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุจูุงุณุทุฉ Keystore ุ ูุฎุฏูุงุช Fingerprint ูู ูุธุงู ุงูุชุดุบูู Android OS ุ ูุชูููุงุช ุญูุงูุฉ ุญููู ุงููุดุฑ ูู DRM ุ ุฅูุฎ. </p><br><p style=";text-align:right;direction:rtl">  <a href="https://habr.com/ru/post/309618/">ููุฏ ุชู ุจุงููุนู</a> <a href="https://habr.com/ru/company/aladdinrd/blog/342924/">ูุชุงุจุฉ</a> <a href="https://developer.arm.com/ip-products/security-ip/trustzone">ุงููุซูุฑ</a> ุนู ุฌูุงุฒ TrustZone ุ ูุฐูู ุณูู ูุชุฐูุฑ ููุชุฑุฉ ูุฌูุฒุฉ ููุท. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/eu/ny/dg/eunydg_xqmclgf_f47vvwrsdplw.png"></p><br><p style=";text-align:right;direction:rtl">  ุชููู TrustZone ุจุชูุณูู "ุงูุนุงูู" (ูู ุญูุซ TrustZone - ุงูุนุงูู) ุฅูู ูุณููู - ุนุงูู ุนุงุฏู ูุนุงูู ุขูู - ูุชุถูู ุฃุฑุจุนุฉ ุฃูุถุงุน ููุชูููุฐ ุฅูู ุงููุนุงูุฌ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  EL3 - ูุถุน ุงูุดุงุดุฉ - ุงููุถุน ุงูุฐู ูุจุฏุฃ ุจู ุงููุธุงู ุ ููู ูุถุน ุงูุชูููุฐ ุงูููุถู ุ </li><li style=";text-align:right;direction:rtl">  S-EL2 - ูุถุน ุจุฑูุงูุฌ ูุฑุงูุจุฉ ููุซูู ุจู ุ </li><li style=";text-align:right;direction:rtl">  S-EL1 - ูุถุน ูุธุงู ุงูุชุดุบูู ุงูููุซูู ุจู ุ </li><li style=";text-align:right;direction:rtl">  S-EL0 - ูุถุน ุงูุชุทุจููุงุช ุงูููุซููุฉ (ุงูุชุทุจููุงุช ุงูููุซูู ุจูุง ุ TAs ุ Trustlets) ุ ุฃู Trustlets. </li></ul><br><p style=";text-align:right;direction:rtl">  ูู SoC ุจุงุณุชุฎุฏุงู ุชูููุฉ TrustZone ุ ูููู ุฃู ูุนูู ูุธุงูุงู ุชุดุบูู ูู ููุช ูุงุญุฏ.  ูุงุญุฏ ูุนูู ูู Normal World ูุณูู Rich OS ุ ูุงูุซุงูู ูู Secure World ูู TEE (ุจูุฆุฉ ุงูุชูููุฐ ุงูููุซูู) OS.  ููุฌุฏ ุจุงููุนู ุฃูุซุฑ ูู ุนุดุฑุฉ ูู ุฃูุธูุฉ ุงูุชุดุบูู ุงูููุซููุฉ ูุฐู.  ุณูู ูุฑูุฒ ุนูู ูุงุญุฏ ูุญุฏุฏ - Trustonic Kinibi.  ูุชู ุงุณุชุฎุฏุงูู ุ ุนูู ูุฌู ุงูุฎุตูุต ุ ุนูู ููุงุชู Samsung ูุน SoC Exynos ุดุงููุฉ ุญุชู Galaxy S9. </p><br><h2 id="trustonic-kinibi" style=";text-align:right;direction:rtl">  ูููููู Trustonic </h2><br><p style=";text-align:right;direction:rtl">  <a href="https://www.nfcworld.com/2012/12/18/321625/arm-gemalto-and-gd-introduce-alternative-to-nfc-secure-elements/">ุชู ุฅูุดุงุก</a> Trustonic <a href="https://www.nfcworld.com/2012/12/18/321625/arm-gemalto-and-gd-introduce-alternative-to-nfc-secure-elements/">ุจูุงุณุทุฉ ARM ู Gemalto ู Giesecke &amp; Devrient (G&amp;D)</a> ูุงุณุชูุฑ ูู ุชุทููุฑ ูุธุงู ุงูุชุดุบูู Giesecke &amp; Devrient (G&amp;D) Mobicore ุชุญุช ุงุณู Kinibi. </p><br><p style=";text-align:right;direction:rtl">  ูุฏุนู ูุธุงู ุงูุชุดุบูู Kinibi <a href="https://globalplatform.org/technical-committees/trusted-execution-environment-tee-committee/">ูุนุงููุฑ ุจูุฆุฉ ุงูุชูููุฐ ุงูููุซูู ุจูุง ูููุธุงู ุงูุฃุณุงุณู ุงูุนุงููู</a> .  ูุธูุฑ ุงููุฎุทุท ุงูููููู ูู ุงูุดูู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/rn/uj/ff/rnujffhmytxef_pzu99cje21fa4.jpeg"></p><br><p style=";text-align:right;direction:rtl">  ููุง ุชุฑูู ุ ูุฅู ุชุทุจูู TrustZone ูุชุถูู ููููุงุช ููุณ ููุท ูู "ุงูุนุงูู ุงููุญูู" ุ ูููู ุฃูุถูุง ููููุงุช ูู "ุงูุนุงูู ุงูุทุจูุนู".  ูููู ุงูุนูุงุตุฑ ุงูุฑุฆูุณูุฉ ุ ูู ุงูุฃูุถู ุฃู ููุธุฑ ุฅูู ูุฎุทุท ูุฐุง ุงููุธุงู ูู ูุฌูุฉ ูุธุฑ ุงููุทูุฑ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/jf/lr/ok/jflrokza7l-sn8mh84m1a29smjs.jpeg"></p><br><p style=";text-align:right;direction:rtl">  ุนูู ูุณุชูู ููุฎูุถ ุ ูู ุนุงูู ูุญูู ุ ุจุงูุฅุถุงูุฉ ุฅูู microkernel ุ ูุนูู ุงูุณุงุฆููู ููุฏูุฑ ููุช ุงูุชุดุบูู.  ููู ุงูุนุงูู ุงูุทุจูุนู ุ ูุนูู ุจุฑูุงูุฌ ุชุดุบูู ุฎุงุต ุ ููุง ูุถูู ุงูุชูุงู ุงููุนุงูุฌ ุฅูู ุงูุนุงูู ุงููุญูู ุจูุงุกู ุนูู ุทูุจ ุงูุชุทุจููุงุช.  ุนูู ูุณุชูู ุงููุณุชุฎุฏููู ุ ุชุนูู ุงูุชุทุจููุงุช ูุงูููููุงุช ุงูุชู ุชููุฑ ูุงุฌูุงุช ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ูุฑุจุท ุงูุชุทุจููุงุช ุจูู ุงูุนุงูููู ุงูุนุงุฏู ูุงูุขูู.  ููุงู ุฃูุถูุง ุจุฑูุงูุฌ ุฎูู ุฎุงุต ูู ุงูุนุงูู ุงูุทุจูุนู ูููุฑ ุจุฏุก ุงูุชุดุบูู ุงูุฃููู ูุจุนุถ ุงูุตูุงุฏูู ุงูุงุฆุชูุงููุฉ ุ ูุงูุชู ุชูุฑ ุนุจุฑูุง ุฌููุน ุทูุจุงุช ุงูุญุตูู ุนูู ุงุฆุชูุงูุงุช ูู ุชุทุจููุงุช ุงูุนููู. </p><br><p style=";text-align:right;direction:rtl">  ููุงู ูุฌููุนุชุงู ูู ูุงุฌูุงุช ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ูู Kinibi: ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช Global Platform (ุงููุดุงุฑ ุฅูููุง ุจุงูููู ุงูุฃุฎุถุฑ) ู Legacy API (ุฃุญูุฑ).  ุชููุฑ ููุชุง ุงููุฌููุนุชูู ููุณ ูุฌููุนุฉ ุงููุธุงุฆู ุชูุฑูุจูุง ุ ุชู ุฅูุดุงุก ุงููุฌููุนุฉ ุงูุฃููู ููุท ููููุง ููุนุงููุฑ Global Platform ุ ูุงูุซุงููุฉ ุ ููุง ูุจุฏู ุ ูุงูุช ูุจู ุงููุนูุงุฑ ุ ูุจุงูุชุงูู ุชุณูู Legacy.  ุนูู ุงูุฑุบู ูู ุญูููุฉ ุฃูู ุจูุงุกู ุนูู ุงูุงุณู ุ ูุฌุจ ุนููู ุงูุงุจุชุนุงุฏ ุนู ุงุณุชุฎุฏุงูู ุ ูุชู ุงุณุชุฎุฏุงู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช Legacy ููุท ูู ุญุณุงุจุงุช Samsung ุงูููุซููุฉ. </p><br><h2 id="vzaimodeystvie-mezhdu-mirami" style=";text-align:right;direction:rtl">  ุงูุชูุงุนู ุจูู ุงูุนุงูููู </h2><br><p style=";text-align:right;direction:rtl">  ููุงุณุชูุงุฏุฉ ูู ุงููุฑุต ุงูุชู ุชููุฑูุง ุชูููุฉ TrustZone ุ ุงูุชุทุจููุงุช ูู ุงูุนุงูู ุงูุทุจูุนู ุ ูุชุณูู ุชุทุจููุงุช ุงูุนููู ุ ูุงูุชูุงุตู ูุน ุงูุชุทุจููุงุช ุงูููุซูู ุจูุง - Trustlets  ุชููู Trustlets ุจุชูููุฐ ูุธุงุฆู ูุฎุชููุฉ: ุงููุตุงุฏูุฉ ุ ูุฅุฏุงุฑุฉ ุงูููุงุชูุญ ุ ูุงูุนูู ูุน ููููุงุช ุงูุฃุฌูุฒุฉ ุงูุชู ุชููุฐ ูุธุงุฆู ุงูุฃูุงู ุ ุฅูุฎ. </p><br><p style=";text-align:right;direction:rtl">  ูุชู ุฅุฑุณุงู ุงูุทูุจุงุช ุฅูู Trustlets ุจุงุณุชุฎุฏุงู ุฐุงูุฑุฉ ูุดุชุฑูุฉ ุฎุงุตุฉ.  ูุชู ุนุฒู ุงูุนุงูู ุงูุนุงุฏู ูุงูุนุงูู ุงููุญูู ุ ุจุงุณุชุฎุฏุงู ุชูููุฉ TrustZone ุ ุนู ุจุนุถููุง ุงูุจุนุถ ูู ุงููุณุชููุงุช ุงูุนููุง (EL0 ู S-EL0) ูู ุงูุฐุงูุฑุฉ ุ ูุฅูุดุงุก ูุซู ูุฐู ุงูููุทูุฉ ูู ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ ุจููููุง ุ ุชุณูู World Shared Memory (WSM) ุ ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูุชู ุชููุฑูุง ุงูุนุงูู. </p><br><p style=";text-align:right;direction:rtl">  ูุจุฏู ุงููุฎุทุท ุงูุนุงู ููุชูุงุนู ุจูู ุชุทุจูู ุงูุนููู ู Trustlet ูุซู ูุฐุง: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/6x/91/jb/6x91jbisi920sjwv_vmjch1ltqo.jpeg"></p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุตู ุชุทุจูู ุงูุนููู ุฅูู ุงูุจุฑูุงูุฌ ุงูุฎูู ุจุงุณุชุฎุฏุงู ูุนุฑู ุงููุณุชุฎุฏู ุงูุฎุงุต ุจุงููุซููุฉ ุงูุชู ูุฑูุฏ ุฅูุดุงุก ุฌูุณุฉ ุจูุง ุ </li><li style=";text-align:right;direction:rtl">  ูุณุชุฎุฏู ุงูุจุฑูุงูุฌ ุงูุฎูู ุจุฑูุงูุฌ ุงูุชุดุบูู ููุงุชุตุงู ุจูุธุงู ุงูุชุดุบูู ุงูููุซูู ุจู ูุน ุทูุจ ูุชูุฒูู Trustlet ุ </li><li style=";text-align:right;direction:rtl">  ูููู ูุธุงู ุงูุชุดุบูู ุงูููุซูู ุจุชุญููู ุงูุฃุญูุงู ูู ูุณุงุญุฉ ุงูุนููุงู ูู ุงูุนุงูู ุงููุญูู ุ </li><li style=";text-align:right;direction:rtl">  ููุดุฆ ุชุทุจูู ุงูุนููู ูุฑุฉ ุฃุฎุฑู ูุฎุฒููุง ูุคูุชูุง ูู WSM ูู ุฎูุงู ุทูุจ ุฅูู ุงูุจุฑูุงูุฌ ุงูุฎูู ูููุชุจ ุงูุจูุงูุงุช ููู ูุทูุจ ุงูุซูุฉ ุ </li><li style=";text-align:right;direction:rtl">  ูุฎุทุฑ ุชุทุจูู ุงูุนููู ุงูุนุงูู ุงููุญูู ุจุงุณุชุนุฏุงุฏ ุงูุทูุจ ุ </li><li style=";text-align:right;direction:rtl">  ูู ุนุงูู ุขูู ุ ูุชู ุฅุฑุณุงู ุงูุทูุจ ุฅูู Trustlet ุงููุทููุจ ูููุนุงูุฌุฉ ุ ูุงููุชุงุจุงุช ููุชุจ ูุชูุฌุฉ ุนููู ุฅูู ุงููุฎุฒู ุงููุคูุช WSM ุ </li><li style=";text-align:right;direction:rtl">  ูุฏ ุชุชูุฑุฑ ุฏูุฑุฉ ุงูุทูุจ ูุงูุงุณุชุฌุงุจุฉ ุ </li><li style=";text-align:right;direction:rtl">  ุชุทุจูู ุงูุนููู ูููู ุงูุฌูุณุฉ ุจุซูุฉ. </li></ol><br><p style=";text-align:right;direction:rtl">  ุชุจุฏู ุงูุฑููุฒ ุงูุฒุงุฆูุฉ ูุฌูุณุฉ ุงูุชูุงุนู ูุชุทุจูู ุงูุนููู ููุบุฉ ุงููุซูู ุฌูููุฉ ุฌุฏุงู.  ูุชุทุจูู ุนููู: </p><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">void main() { uint8_t* tciBuffer; uint32_t tciLength; uint8_t* mem; uint32_t mem_size; mcOpenDevice(MC_DEVICE_ID_DEFAULT); mcMallocWsm(MC_DEVICE_ID_DEFAULT, 0, tciLength, &amp;tciBuffer, 0); session.deviceId = MC_DEVICE_ID_DEFAULT; mcOpenSession(&amp;session, &amp;uuid, tciBuffer, tciLength); mcMap(&amp;session, mem, mem_size, &amp;mapInfo); mcNotify(&amp;session); mcWaitNotification(&amp;session, -1); mcUnmap(&amp;session, mem1, &amp;mapInfo1); mcCloseSession(&amp;session); mcFreeWsm(MC_DEVICE_ID_DEFAULT, tciBuffer); mcCloseDevice(MC_DEVICE_ID_DEFAULT); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุญุตูู ุนูู trustlet: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">void tlMain(uint8_t *tciData, uint32_t tciLen) { // Check TCI size if (sizeof(tci_t) &gt; tciLen) { // TCI too small -&gt; end Trusted Application tlApiExit(EXIT_ERROR); } // Trusted Application main loop for (;;) { // Wait for a notification to arrive tlApiWaitNotification(INFINITE_TIMEOUT); // Process command // Notify the TLC tlApiNotify(); } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>mcNotify</code> / <code>tlApiNotify</code> ู <code>mcWaitNotification</code> / <code>tlApiWaitNotification</code> - ูุฐู ูู ูุธุงุฆู ุงูุฅุดุนุงุฑ ุฐุงุชูุง ุงูุชู ูููู ูููุง ุงูุทูุจ / ุงูุงุณุชุฌุงุจุฉ ุฌุงูุฒูุง ูุงุณุชูุงูู ูู ุนุงูู ุขุฎุฑ ุ ููุธููุฉ ุงูุชุธุงุฑ ูุนุงูุฌุฉ ุงูุทูุจ.  ุฃูุถุง ุ ุชุทุจูู ุงูุนููู ูุฏูู ุงููุฏุฑุฉ ุนูู ุงุณุชุฎุฏุงู ูุธููุฉ mcMap.  ูุณูุญ ูู ุจุฅูุดุงุก ูุฎุฒู ูุคูุช WSM ุขุฎุฑ ุ ุฅุฐุง ูุฒู ุงูุฃูุฑ.  ูู ุงููุฌููุน ุ ุจุงุณุชุฎุฏุงู ูุฐู ุงููุธููุฉ ุ ููููู ุฅูุดุงุก ุฃุฑุจุนุฉ ููุท ูู ูุฐู ุงููุฎุงุฒู ุงููุคูุชุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุน ุชุทุจููุงุช ุงูุนููู ุ ูู ุงููุงุถุญ - ุจุงููุณุจุฉ ูููุงุชู Samsung ุ ูุฐู ูู ุชุทุจููุงุช Android ุงูุนุงุฏูุฉ.  ูููู ูุง ูู ุงูุซุบุฑุงุชุ </p><br><h2 id="trastlety-kinibi" style=";text-align:right;direction:rtl">  ูููุจู Trustlets </h2><br><p style=";text-align:right;direction:rtl">  ุชูุฌุฏ Trustlets ูู ูุธุงู ุงููููุงุช ุงูุนุงุฏู ููุฌูุงุฒ ููู ูููุงุช ุชุญุชูู ุนูู ุชุนูููุงุช ุจุฑูุฌูุฉ ูุงุจูุฉ ููุชูููุฐ.  ููุณ ูุฐุง ูู ุงูุชูุณูู ุงููุนุชุงุฏ ELF ุฃู APK ููุธุงู Android.  ุชูุชูู Trastlets ูู ูุธุงู ุงูุชุดุบูู Kinibi ูุณู MobiCore Load ุงูุฎุงุต ุจูุง (MCLF).  ุชู ูุตูู ูู ููููุงุช ูุณุชูู <a href="">ุงููุณุชุฎุฏู ููุชูุญุฉ ุงููุตุฏุฑ</a> ุงูุชู ูุดุฑุชูุง Trustonic ุนูู Github.  ูููู ุชุตููุฑ ูููู ููู trustlet ุจุดูู ุชุฎุทูุทู ูู ูุซู ูุฐู ุงูุตูุฑุฉ (ุงูุฑูุฒ ุงูููุฌูุฏ ุนูู ุงููุณุงุฑ). </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/6n/wl/3w/6nwl3wam_zcbljj0qalgybotnsw.jpeg"></p><br><p style=";text-align:right;direction:rtl">  ูููู ุชูููุฒ ุงูููุฒุงุช ุงูุชุงููุฉ ูู Trustlets: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุชู ุชูููุฐูุง ูู ูุณุงุญุฉ ุนููุงู ูุนุฒููุฉ ุ ููุฐุง ูุนูู ุฃู Trustlet ูุงุญุฏ ูุง ูุฑู ุขุฎุฑ ุ </li><li style=";text-align:right;direction:rtl">  ููุณ ูุฏูู ุฅููุงููุฉ ุงููุตูู ุฅูู ุฐุงูุฑุฉ ุงูุนุงูู ุงูุนุงุฏู ุ ุจุงุณุชุซูุงุก ูุฎุงุฒู WSM ุงููุคูุชุฉ ุ ุฅูู ุฐุงูุฑุฉ ูุธุงู ุงูุชุดุบูู TEE ูุงูุฐุงูุฑุฉ ุงููุนููุฉ ุ </li><li style=";text-align:right;direction:rtl">  ุชูุฌุฏ ูู ุงูุฐุงูุฑุฉ ูู ุฃูุณุงู ููุง ุญููู ูุฎุชููุฉ ูู ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ ูุงูุชูููุฐ ุ </li><li style=";text-align:right;direction:rtl">  ุงููุฎุงุฒู ุงููุคูุชุฉ WSM ุงูููุฌูุฏุฉ ูู ุงูุฐุงูุฑุฉ ุบูุฑ ุงููุงุจูุฉ ููุชูููุฐุ </li><li style=";text-align:right;direction:rtl">  ุงูุชูููุฏ ุฏูู ASLR </li><li style=";text-align:right;direction:rtl">  ูุณุชุฎุฏููู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูุชู ุชููุฑูุง mclib ุ ููู ููุชุจุฉ ุชููุฐ ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช Global Platform ู Legacy API ููุนุงูู ุงููุญูู ุ </li><li style=";text-align:right;direction:rtl">  ูููู ุงููุตูู ุฅูู ุจุฑุงูุฌ ุงูุชุดุบูู ุงููุญููุฉ ุจุงุณุชุฎุฏุงู ูุธููุฉ <code>tlApi_callDriver</code> . </li></ul><br><p style=";text-align:right;direction:rtl">  ููุง ุชุฑูู ุ ูุฅู ุงููุญุฏุงุช ุงูุชูุธูููุฉ ูุญุฏูุฏุฉ ููุบุงูุฉ ูู ุงููุฏุฑุงุช.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุณุชุฎุฏููู ุจุนุถ ุขููุงุช ุงูุฏูุงุน ุ ูุซู ุงูุนุฏูุฏ ูู ุณูุงุช ุงูุฐุงูุฑุฉ ุ ููุง ุชุณุชุฎุฏู ูุนุธู ููุงุฆู ุงูุซูุฉ ุงูููุงุฑู ุงูููุฏุณ ููุญูุงูุฉ ูู ุงููุชุงุจุฉ ููู ุงูููุฏุณ.  ููู Kinibi ููุณ ูุฏูู ASLR ุ ุนูู ุงูุฑุบู ูู ุฃูู <a href="https://www.trustonic.com/news/research/providing-random-numbers-without-kernel-rng/">ุชู ุงูุชุฎุทูุท ูู</a> ูู ุฅุตุฏุงุฑุงุช ุฌุฏูุฏุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุนูู ุงูุฑุบู ูู ุฌููุน ุงููููุฏ ุ ุชุนุชุจุฑ ููุงุท ุงูุงุณุชูุฏุงู ูุฏููุง ูุซูุฑูุง ููุงูุชูุงู ููููุงุฌููู ููุฃุณุจุงุจ ุงูุชุงููุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุฐู ูุงูุฐุฉ ูู TrustZone ูู ูุณุชูู ูุณุงุญุฉ ุงููุณุชุฎุฏููู ูู Android ุ </li><li style=";text-align:right;direction:rtl">  ูููู ุฃู ุชููู ุจูุซุงุจุฉ ููุทุฉ ุงูุทูุงู ูุชุตุนูุฏ ุงูุงูุชูุงุฒุงุช ุฅูู ุฌููุฑ ูุธุงู ุงูุชุดุบูู TEE ุ </li><li style=";text-align:right;direction:rtl">  ุชุชูุชุน Trustlets ุจุงููุตูู ุฅูู ุงููุนูููุงุช ุงููุญููุฉ ุ ุญูุซ ูุง ูููู ุญุชู ููููุงุฉ Android ุงููุตูู. </li></ul><br><p style=";text-align:right;direction:rtl">  ูุฌูุงุฒ ุงุฎุชุจุงุฑ ุ ุงุณุชุฎุฏููุง Samsung Galaxy S8.  ุฅุฐุง ููุช ุชุจุญุซ ุนู ูุตุงุตุงุช ูู ุฐูู ุ ููุฏ ุชุจูู ุฃู ููุงู ุงููุซูุฑ ูููุง. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/oi/-2/uw/oi-2uwkk_mdvw7dpyqb1k0_2ubc.png"></p><br><p style=";text-align:right;direction:rtl">  ููุฐุง ูู ุ ููุงู ุงููุซูุฑ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ.  ูุจุฏู ุฃู ุงุณุชุฎุฏุงู ุงูุชุญููู ุงูุซุงุจุช ููุฑูุฒ ุงูุซูุงุฆู ููุจุญุซ ุนู ุงูุซุบุฑุงุช ุงูุฃูููุฉ ููุฑุฉ ุณูุฆุฉ.  ูู ููุฌุญ ุงูุงูุฎุฑุงุท ูู ุงูุชุญููู ุงูุฏููุงูููู ุจูู ุจุณุงุทุฉ ุ ุฅุฐุง ูุงู ููููููุฌ ุชูุณููุงุช ุฎุงุตุฉ ุจูุง ุ ุชุฎุชูู ุนู ูุง ูููู ุชุดุบููู ุนูู ุฃูุธูุฉ ุงูุชุดุบูู ุงูุชูููุฏูุฉ.  ุณูููู ูู ุงูุฌูุฏ ุงุณุชุฎุฏุงู ุทุฑููุฉ ุงูุฏูุฌ ุงูุชู ุฃุซุจุชุช ุฌุฏูุงูุง ูู ุฑุฏูุฏ ุงููุนู ุ ูุงูุชูุงุท ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู ูุชุญุทู ุงูุตูุงุฏูู ุงูุงุฆุชูุงููุฉ ุนูุฏ ุญุฏูุซูุง.  ุฏุนููุง ูุญุงูู ุญู ูุฐู ุงููุดููุฉ ุงููุซูุฑุฉ ููุงูุชูุงู. </p><br><h2 id="kak-zhe-eto-fazzit" style=";text-align:right;direction:rtl">  ููู ูุฐุง ุฒุบุจุ </h2><br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ูุฃููุฆู ุงูุฐูู ูู ููุชููุง ุจุนุฏ ุจุฃุฏุงุฉ AFL ุงูุฑุงุฆุนุฉ ูุงูุนุฏูุฏ ูู ุงููุธุงุฆู ุงูุฅุถุงููุฉ ุ ููุตู ุจูุฑุงุกุฉ <a href="https://habr.com/ru/company/dsec/blog/435644/">ูุฐู ุงูููุงูุฉ ุงูุฌูุฏุฉ</a> .  ูุฑุจูุง ูุนูู ุงูุฌููุน ุฃู AFL ูููู ุฃู ุชูุณุฏ ูููุงุช ELF.  ูุนูุงูุฉ ุนูู ุฐูู ุ ุญุชู ุงููููุงุช ุงูุซูุงุฆูุฉ ุงูุชู ุชู ุชุฌููุนูุง ูู ุงูุจุฏุงูุฉ ุฏูู ุฃุฌูุฒุฉ AFL.  ููุชุญูู ุฐูู ูู ุฎูุงู ูุถุน qemu.  ูุณุชุฎุฏู AFL ุจููุฉ ุฎุงุตุฉ ููุญุงูู qemu ุ ุญูุซ ุชุชู ุฅุถุงูุฉ ูุธููุฉ ุงูุฃุฌูุฒุฉ ุงูุซูุงุฆูุฉ ูุชุนูููุงุช ุงููุฑุน ุฅูู ูุถุน ูุณุชุฎุฏู qemu.  ูุฐุง ูุณูุญ ูู ุจุงูุชุดููุด ูุน ุงูุชุญูู ูู ุชุบุทูุฉ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุญุชู ุจุงููุณุจุฉ ูููููุงุช ุงูุซูุงุฆูุฉ.  ูููุงูุฃุฉ ูุฐุง ูู ุงููุฏุฑุฉ ุนูู ุฏูุฌ ุงููููุงุช ุงููุงุจูุฉ ููุชูููุฐ ุ ููุณ ููุท ูู ุงูููุฏุณุฉ ุงููุนูุงุฑูุฉ ุงูุฃุตููุฉ ุ ูููู ุฃูุถูุง ูุฌููุน ุงูููุงูู ุงูุชู ูุฏุนููุง qemu.  ูููู ูู ุฃุฌู ุงุณุชุฎุฏุงู ูุฐุง ุงููุถุน ูู ูููุชูุง ุ ูุญุชุงุฌ ุฅูู ุชุญููู ุฃุดูุงู ุงูุซูุฉ ุฅูู ุชูุณูู ELF ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนููุง ูููู ูุธุฑุฉ ูุงุญุตุฉ ุนูู ูููุงุช trustlet.  ุจูุถู ุงูุชูุณูู ุงูููุชูุญ ุ <a href="https://github.com/ghassani/mclf-ida-loader">ููุฌุฏ</a> ูุญูู ูู IDA Pro ูู.  ุฅุฐุง ููุช ุจูุชุญ ุฃู ุฑุงุจุท ุ ุจุงุณุชุซูุงุก ุ ูู ุงููุงูุน ุ ุงูููุฏ ุงูุฎุงุต ุจู ุ ููููู ุฃู ุชุฑู ุฃูู ูุณุชุฎุฏู ูุธุงุฆู ููุชุจุฉ mclib.  ูู ุงููุซูุฑ ููุงูุชูุงู ุฃู ุฌููุน ุงูููุงููุงุช ุฅูู ูุฐู ุงููุธุงุฆู ุชูุฑ ุจูุธููุฉ ูุงุญุฏุฉ ุนูู ุงูุนููุงู ุงููุณุฌู ูู ุฑุฃุณ ุงูุฑุณุงูุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ุชุจุฏู ุจูุง ูุธููุฉ tlApiLogvPrintf ูู ุฑูุฒ ุงููุซูู ุงูุฐู ูุชุนุงูู ุจูุถูุญ ูุน ุฅุฎุฑุงุฌ ุงูุณูุงุณู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/lh/tx/zb/lhtxzbfra6o6pmp_urykpw8lq9w.png"></p><br><p style=";text-align:right;direction:rtl">  ูููู ุฃู ูุฑู ุฃูู ูุนูุฏ ุชูุฌูู ุฌููุน ุงููุนููุงุช ุฃุจุนุฏ ูู ูุธููุฉ ุฃุฎุฑู.  ูุฐู ูู ูุธููุฉ ุฌุฏููุฉ mclib ุ ุงูุชู ุชุชู ูุชุงุจุฉ ุนููุงููุง ูู ุฑุฃุณ MCLF ูู ุญูู ูุณูู <code>tlApiLibEntry</code> .  ุจูุนูู ุฃู ูุธุงุฆู ุงูููุชุจุฉ ุงูุชู ุชูุฏุนู ุจูุฐู ุงูุทุฑููุฉ ูู ุงูุชุจุนูุงุช ุงููุญูุฏุฉ ูููููุงุก ุงูููุซูููู ุ ูููุณ ููุฑุงุจุทุงุช ุฃู ุฑูุงุจุท ุฃุฎุฑู ุจุงูุฎุงุฑุฌ.  ูุฐุง ูุนูู ุฃูู ุฅุฐุง ูููุง ุจุชุทุจูู ุนูุงุตุฑ ุชุญูู ููุธุงุฆู API ุ ููููููุง ุชูููุฐ ุฑูุฒ trustlet ูู ุจูุฆุฉ Linux ุนุงุฏูุฉ ุ ุจุงูุทุจุน ุ ุฃููุงู ุชุญูููู ุฅูู ููู ELF ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู.  ููุฐุง ูุนูู ุฃููุง ูููู ุฃู ุชุตุญูุญ ุงูุฃุฎุทุงุก ูุฒุบุจ. </p><br><p style=";text-align:right;direction:rtl">  ูุชุญููู ููู Trustlet ุฅูู ููู ELF ุ ููููู ุฃุฎุฐ ููู ุฌุงูุฒ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุชุฑุฌูุฉ ุชุทุจูู ูุงุฑุบ ูุน ุงููุธููุฉ ุงูุฑุฆูุณูุฉ ุ ูุฅุถุงูุฉ ุฃูุณุงู ูู Trustlet ูุน ุฑุฃุณู.  ูู ุงูุณูู!  ูู ุงูุถุฑูุฑู ุฃูุถูุง ููู ุงูุชุญูู ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู ุฅูู ุฑูุฒ Trustlet.  ูุง ุชูุฌุฏ ูุดููุฉ ูู ูุฐุง ุฃูุถูุง ุ ูุญุชูู ุฑุฃุณ trastlet ุนูู ุนููุงู ููุทุฉ ุงูุฏุฎูู ุงูุฎุงุตุฉ ุจู.  ูุญุฏุฏ ูุฐุง ุงูุนููุงู ูู ูุธููุชูุง <code>main</code> ูุนููุงู ูููุธููุฉ ููุทูู ุนูููุง.  ุจุนุฏ ุงูุชูููุฑ ูุงูุชุฌุฑูุจ ุ ูููููุง ุชุญุฏูุฏ ุงูุฎุทุฉ ุงูุชุงููุฉ ูุญู ูุดููุชูุง: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชูููุฐ ููู ุงูุชูููุฐ ุฅูู ููุทุฉ ุงูุฏุฎูู ููุตูุฏูู ุ </li><li style=";text-align:right;direction:rtl">  ุชูููุฐ ูุธุงุฆู ุงูููุชุจุฉ ุฃู ุงูุฏุนุงุฆู ููู ุ </li><li style=";text-align:right;direction:rtl">  ุชูููุฐ ูุธููุฉ ุงูุฅุฑุณุงู ููุชุงุจุฉ ุนููุงููุง ูู ุฑุฃุณ tralet ุ </li><li style=";text-align:right;direction:rtl">  ุชุฑุชูุจ ุฃูุณุงู ูู Trustlet ุฅูู ุงูุนูุงููู ุงููุทููุจุฉ. </li></ol><br><p style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุฃููุง ูุญุชุงุฌ ุฅูู ุชุญููู ุงูุนุฏูุฏ ูู ุงูุตูุงุฏูู ุฅูู ุงูุฌุงู ูู ููุช ูุงุญุฏ ุ ููุญู ุจุญุงุฌุฉ ุฅูู ุงูุชูููุฑ ูู ุฃุชูุชุฉ ูุฐู ุงูููุงู.  ููู ูุญุฏุฉ ุชุญูู ุ ูุฌุจ ุชุญุฏูุฏ ุงููุนููุงุช ุงูุชุงููุฉ ุชููุงุฆููุง: ููุทุฉ ุงูุฏุฎูู ุ ูุนูุงููู ุฃูุณุงู ุงูุตูุฏูู ุงูุงุณุชุฆูุงูู ูุญุฌู ุงููุฎุฒู ุงููุคูุช ูุฅุฏุฎุงู WSM.  ุฃุถู ูุฐุง ุฅูู ุงูุฎุทุฉ. </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุญุฏุฏ ููุทุฉ ุงูุฏุฎูู ูุนูุงููู ุงูุฃูุณุงู ูุญุฌู ุงููุฎุฒู ุงููุคูุช ูู WSM. </li></ol><br><h2 id="sobiraem-elfa" style=";text-align:right;direction:rtl">  ุฌูุน ูุฒู </h2><br><p style=";text-align:right;direction:rtl">  1) <strong>ููุทุฉ ุงูุฏุฎูู</strong> </p><br><p style=";text-align:right;direction:rtl">  ุงูุนูุตุฑ ุงูุฃูู ูู ุงูุฎุทุฉ ุณูู ุงูุชูููุฐ ูุน ุงูููุฏ ุงูุชุงูู.  ูููู ุฅุถุงูุชู ุฅูู ุงููุธููุฉ <code>main</code> ูููู ELF ุงููุตุฏุฑ ุงูุฎุงุต ุจูุง. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">typedef void (*tlMain_t)(const void* tciBuffer, const uint32_t tciBufferLen); tlMain_t tlMain = sym_tlMain; tlMain(tciBuffer, tciBufferLen);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญู ุชุฌููุน ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูุฏููุง ูู ููู ูุงุฆู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$(CC) $(INCLUDE) -g -c tlrun.c</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฅุถุงูุฉ <code>sym_tlMain</code> ุฅูู ููู ุงููุงุฆู.  ููููู ุงูููุงู ุจุฐูู ุจุงุณุชุฎุฏุงู objcopy. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">arm-linux-gnueabi-objcopy --add-symbol sym_tlMain=$(TLMAIN) tlrun.o tlrun.o.1</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชูุฌุฉ ูุฐูู ุ ุญุตููุง ุนูู <code>tlrun.o.1</code> - ูุตุฏุฑ <code>tlrun.o.1</code> ูุน ุงููุธููุฉ <code>main</code> ุงูุชู ุชููู ุงูุชุญูู ุฅูู ุฑูุฒ Trustlet. </p><br><p style=";text-align:right;direction:rtl">  2) <strong>ูุธุงุฆู ุงูููุชุจุฉ</strong> </p><br><p style=";text-align:right;direction:rtl">  ูุชูููุฐ ูุธุงุฆู ุงูููุชุจุฉ ุ ูุญุชุงุฌ ุฃููุงู ุฅูู ูุงุฆูุฉ ุจุฌููุน ูุฐู ุงููุธุงุฆู.  ุฐุงุช ูุฑุฉ ูุงู ููุงู ุชุณุฑุจ ูู ููุงูููู ูุน ูุฌููุนุฉ ูู ุงูููุงุฏ ููุฃุฌูุฒุฉ ุงููุญูููุฉ ุจูุงุกู ุนูู ูุนุงูุฌุงุชูุง.  ููู ุจูู ูุฐู ุงูููุงุฏ ุฃูุถูุง ุจุนุถ ุงูุตูุฑ ููููุงุช ุงูุฑุฃุณ ูุตูุฑ ุชุตุญูุญ ุงูุฃุฎุทุงุก ูุจุนุถ ุงูููููุงุช ููุธุงู ุชุดุบูู mobicore.  ูู ููุงู ุฃุฎุฐูุง ููุงุฐุฌ ุฃูููุฉ ููุธุงุฆู ุงูููุชุจุฉ ุจุฃุฑูุงููุง ุ ูุชู ุชูุฑูุฑูุง ููุนููุฉ ุฅูู ูุธููุฉ ุงูุฅุฑุณุงู.  ุจุงููุณุจุฉ ูููุธุงุฆู ุฐุงุช ุงูุฃุบุฑุงุถ ุงููุนุฑููุฉ ูุซู <code>tlApiMalloc</code> ุฃู <code>tlApiLogvPrintf</code> ูููุง ุจุชูููุฐ ุงูุชุทุจููุงุช ุงูููุงุจูุฉ ุจุงุณุชุฎุฏุงู ูุธุงุฆู ููุงุซูุฉ ูู libc.  ูุงููุธุงุฆู ููุณุช ูุงุถุญุฉ ุชูุงููุง ุ ุนูู ุณุจูู ุงููุซุงู ุ <code>tlApiSecSPICmd</code> ุจุณูุท ูุนุฑุถ ุงุณููู ููุนูุฏ ุจุญุงูุฉ ููุงูู.  ูุชู ุชุฌููุน ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช (API) ุจุงููุงูู ุฅูู <code>tllib.o</code> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$(CC) $(INCLUDE) -g -c tllib.c</code> </pre> <br><p style=";text-align:right;direction:rtl">  3) <strong>ูุธููุฉ ุงูุฅุฑุณุงู</strong> </p><br><p style=";text-align:right;direction:rtl">  ุนูู ุบุฑุงุฑ ุนููุงู ููุทุฉ ุงูุฏุฎูู ุ ุฃุถู ุงูุฑูุฒ ุ ูุนููุงูู ูู ููุณู ููู ููุงุท ุงูุซูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">arm-linux-gnueabi-objcopy --add-symbol sym_tlApiLibEntry=0x108c tlrun.o tlrun.o.1</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชูููุฐ ูุธููุฉ ุงูุฌุฏููุฉ ุชุงููุฉ.  ูู ุงูุถุฑูุฑู ููุท ูุฑุงุนุงุฉ ุฃูู ูุฌุจ ูุชุงุจุฉ ุนููุงูู ูู ุงูุฑุฃุณ.  ูุธุฑูุง ูุฃููุง ูุง ูุนุฑู ููุฏููุง ุงูุนููุงู ุงูุฐู ุณูุชู ุชุญุฏูุฏ ูููุน ูุธููุฉ ุงูุฅุฑุณุงู ุงูุฎุงุตุฉ ุจูุง ุจุนุฏ ุงูุงุฑุชุจุงุท ูุงูุจุฏุก ุ ููุฌุจ ุฃู ููุชุจ ุนููุงูู ูู ุฑุฃุณ ุงููุซูู ุจุงููุนู ูู ููุช ุงูุชุดุบูู.  ุนูู ุณุจูู ุงููุซุงู ุ ุนูุฏ ุจุฏุก ุชุดุบูู ููู ูุจู ุฃู ุชุจุฏุฃ ุงููุธููุฉ <code>main</code> ุงูุชูููุฐ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">void (*sym_tlApiLibEntry)(int num) __attribute__((weak)); void tlApiLibEntry(int num) __attribute__((noplt)); __attribute__((constructor)) void init() { sym_tlApiLibEntry = tlApiLibEntry; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  4) <strong>ุงูุฃูุณุงู</strong> </p><br><p style=";text-align:right;direction:rtl">  ุฅุถุงูุฉ ุฃูุณุงู ุฅูู ููู ุงููุงุฆู ุ ูุณุชุฎุฏู ุฃูุถูุง <code>objcopy</code> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">arm-linux-gnueabi-objcopy --add-section .tlbin_text=.text.bin \ --set-section-flags .tlbin_text=code,contents,alloc,load \ --add-section .tlbin_data=.data.bin \ --set-section-flags .tlbin_data=contents,alloc,load \ --add-section .tlbin_bss=.bss.bin \ --set-section-flags .tlbin_bss=contents,alloc,load \ tlrun.o.1 tlrun.o.2</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง <code>.tlbin_text</code> ูู ุงุณู ูุณู ุงููุซูู ุ ู <code>.text.bin</code> ูู ุงุณู ุงูููู ูุน ุชูุฑูุบ ููุฐุง ุงููุณู.  ููููู ุชูุฑูุบ ุงูููู ุจุงุณุชุฎุฏุงู ููุณ ุงููุคุณุณุฉ ุงูุฏูููุฉ ููุชูููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุชูุฌุฉ ููุฐุง ุงูุชุญููู ุ ุณุชุชู ุฅุถุงูุฉ Trustt ุงูุซูุงุฆูุฉ ุฅูู ููู ELF ุงููุตุฏุฑ. </p><br><p style=";text-align:right;direction:rtl">  5) <strong>ุงูุฃุชูุชุฉ</strong> </p><br><p style=";text-align:right;direction:rtl">  ููุชุฌููุน ุจุฃูููู ุ ูุฑุฑูุง ุงุณุชุฎุฏุงู Makefile ูุจูุฑ ูุงุญุฏ ูุดุชุฑู ูุฌููุน Trustlets ููุงุญุฏ ุตุบูุฑ ุ ูุชุตูุงู ุจู ููู Trustlet ุงููุฑุฏูุฉ ูุน ุงููุนููุงุช ุงูุฎุงุตุฉ ุจู.  ููู ูุญุฏุฉ ุชุญูู ุ ุชุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ููุทุฉ ุฅุฏุฎุงู ูุนูุงููู ุฃูุณุงู ูุญุฌู ุงููุฎุฒู ุงููุคูุช ูู WSM.  ูุณูู ุงูุญุตูู ุนูู ุงููุนููุชูู ุงูุฃููููู ุจุงุณุชุฎุฏุงู ุจุฑูุงูุฌ ูุตู ุจุณูุท ูููุคุณุณุฉ ุ ููุง ุฃู ุชุญุฏูุฏ ุญุฌู ุงููุฎุฒู ุงููุคูุช ููุณ ุณููุงู ูู ุจุนุถ ุงูุฃุญูุงู ุนูู ุงูุชูููุฐ ุงูุชููุงุฆู.  ููููู ุฃุชูุชุฉ ูุฐู ุงููููุฉ ุฃูุถูุง ุ ุฃู ููููู ูุถุงุก 10 ุฏูุงุฆู ูุชุญุฏูุฏูุง ูุฌููุน ุงููุญุฏุงุช ุงูููุซููุฉ ูู ุฎูุงู ุชุญููู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุฎุงุตุฉ ุจูู ูุฏูููุง.  ูููู ุชุนููู ูุฐู ุงููุนููุงุช ููุชุบูุฑุงุช ูู Makefile ุงูุตุบูุฑุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">TLMAIN := 0x98F5D TLTEXT := 1000 TLDATA := c0000 TLBSS := c10e0 TLTCI_LEN := 4096</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููู Makefile ูุจูุฑ ุ ุงุณุชุฎุฏู ูุฐู ุงููุนููุงุช ุจูุฐู ุงูุทุฑููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$(CC) $(INCLUDE) -g -DTCILEN=$(TLTCI_LEN) -c tlrun.c # ... $(CC) -g tlrun.o.2 tllib.o --section-start=.tlbin_text=$(TLTEXT),--section-start=.tlbin_data=$(TLDATA),--section-start=.tlbin_bss=$(TLBSS) -o tlrun</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ุญูููุง ุงููุซูู ุฅูู ููู ELF ูุน ุงููููุน ุงูุตุญูุญ ูุฃูุณุงู ุงูุตูุฏูู ูู ุงูุฐุงูุฑุฉ ูุงูุนูุงููู ุงูุตุญูุญุฉ ูู ุงูุฑุฃุณ.  ูู ุงููุงุญูุฉ ุงููุธุฑูุฉ ุ ูููู ุชูููุฐู ุจุดูู ุตุญูุญ ูุฅุญุจุงุทู ุฃูุซุฑ.  ุญุณููุง ุ ุฏุนูุง ูุชุญูู ูููุง! </p><br><h2 id="fazzing" style=";text-align:right;direction:rtl">  ุงูุชุถุจูุจ </h2><br><p style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุฃู AFL ูุณุชุฎุฏู qemu ูุชูููุฐ ููุฏ ููุฏุณุฉ ุบูุฑ ุฃุตููุฉ ุ ุณูููู ูู ุงูุฌูุฏ ูู ุงูุจุฏุงูุฉ ุงูุชุญูู ููุง ุฅุฐุง ูุงู ูุฒููุง ูุนูู ุชุญุช ุงููุญุงูู ุนูู ุงูุฅุทูุงู.  ุซู ุจุฏุฃุช ุงููุดุงูู ุนูู ุงูููุฑ. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงููุดููุฉ ุฑูู 1: toolchain</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูุชุฌููุน ุงูุดูุฑุฉ ูุจูุงุก ุงูููู ุ ุงุณุชุฎุฏููุง ุณูุณูุฉ ุงูุฃุฏูุงุช arm-linux-gnueabihf.  "hf" ูู ุงูููุงูุฉ ุชุนูู ุฃู ุงููุชุฑุฌู ูุณุชุฎุฏู ุฏุนู ุฃุฌูุฒุฉ Hard Float ูู ูุนุงูุฌุงุช ARM.  ุนูุฏูุง ุญุงููุช ุชุดุบูู ููููุง ุชุญุช ูุญุงูู qemu ุ ุชุนุทู ุนูู ุงูููุฑ ุ ูุฃุตุฏุฑ "ุฎุทุฃ ุชุฌุฒุฆุฉ".  ุจุงููุธุฑ ุฅูู ุฃูู ูู ูุธุงููุง ุ ูู ููู ููุงู ุนูู ุจุฃุฑูุงู ุงููุงุตูุฉ ุงูุนุงุฆูุฉ ูู ุฃู ููุงู ุ ูุงูุณุจุจ ูู ูุฐุง ุงูุชุนุทู ูุงู ุบูุฑ ููููู ุนูู ุงูุฅุทูุงู.  ุจุนุฏ ูููู ูู ุงูุชูููุฑ ุ ูุฑุฑูุง ุฃู ูุฌุฑุจ ุงุณุชุฎุฏุงู toolchain ุจุฏูู Hard-arm-linux-gnueabi.  ููุญู ูุญุธูุธูู!  ุนูู ุงูููู ุ ูุจุฏุฃ ุงูุฅุฎุฑุงุฌ ููู ูู ุงูุธููุฑ ูู ูุญุฏุฉ ุงูุชุญูู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/vu/t1/he/vut1hesxzshpmwvirmmvilzpoaw.png"></p><br><p style=";text-align:right;direction:rtl">  ุญุชู ุชุชููู ูู ุฒุบุจ.  ูุทูู AFL ูููุง ... </p></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงููุดููุฉ ุฑูู 2: ุงูุฃุฌูุฒุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/s-/c_/zr/s-c_zrsukymj9mugaex_hpzt5e4.png"></p><br><p style=";text-align:right;direction:rtl">  ูุณุจุจ ูุง ุ AFL ูุง ูุฑู ุงูุฃุฌูุฒุฉ.  ูู ุงูุจุฏุงูุฉ ุ ูู ุชูู ุงููุดููุฉ ูุงุถุญุฉ.  ุจููุช qemu ุจุดูู ุตุญูุญ ุ ูุชู ุชุนููู ุงูุฎูุงุฑ -Q (ูุถุน qemu).  ุดุชู ุ ูุงุถุทุฑุฑุช ููุฏุฎูู ูู ุดูุฑุฉ ุงููุตุฏุฑ ูุจูุน AFL ู qemu.  ุงุชุถุญ ุฃูู ูู ุชุตุญูุญุงุช AFL ุ ุนูุฏ ุชูุฒูู ููู ELF ุ ูุจุญุซ qemu ุนู ูุณู ุงูููุฏ ููุญุฏุฏ ุญุฏูุฏ ุงูุนูุงููู ุงูุชู ุณููุชุฌ ุนููุง ุฃุฌูุฒุฉ.  ุงููุดููุฉ ูู ุฃูู ุฅุฐุง ูุงู ููุงู ุงูุนุฏูุฏ ูู ููุงุทุน ุงูููุฏ ุ ูุณุจุจ ูุง ุ ูุณูุชู ููุงุณ ุงููุณู ุงูุฃูู ูููุง ููุท.  ูุฐุง ุฎุทุฃ ุฃู ููุฒุฉ ุ ููู ูุฏููุง ูุณููู ููุฑูุฒ ุ ูููุทุฉ ุงูุฅุฏุฎุงู - ุงูุฑุฆูุณูุฉ - ูู ุงูุฌุฒุก ุงูุซุงูู.  ูู ุงููุงุถุญ ุฃูู ูุง ูุฑู ุงูุฃุฌูุฒุฉ ุนูุฏ ุจุฏุก ุงูุชุดุบูู ุ ูุฃููุง ููุณุช ูู ุงููุณู ุงูุซุงูู!  ูู ุงูุตูู ุฅูู ุฃุจุนุฏ ูู ุงููุตุฏุฑ ุ ููููู ุฃู ุชุฑู ุฃูู ุนูุฏ ุชุดุบูู ูุชุบูุฑ ุงูุจูุฆุฉ AFL_INST_LIBS ุ ุชุตุจุญ ุญุฏูุฏ ุงูุฃุฌูุฒุฉ ุบูุฑ ูุญุฏูุฏุฉ.  ูู ุจุชุดุบููู ูุงุจุฏุฃ ุชุดุบููู. </p></div></div><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/6l/8d/qt/6l8dqtepbkflj0lutrcb_af4nl4.png"></p><br><p style=";text-align:right;direction:rtl">  ุฃุนูุงู ูุฏูุฌุฉ! </p><br><p style=";text-align:right;direction:rtl">  ุชู ุชุฃููุฏ ุงูููุฑุฉ!  ุฃุทูููุง ุงูุฏูุฌ ูุน ุฑุฏูุฏ ุงููุนู ุนูู ูููุงุช ุซูุงุฆูุฉ ุงูุชูุณูู ุงููุฎุตุต.  ููุง ุชุฑูู ุ ููู ูุฌุฏ ููุนูุง ูู ุงูุงูููุงุฑ.  ูุจุงูุชุงูู ุ ุญุตููุง ุนูู ุทุฑููุฉ ููุซููุฉ ูุชุฒููู ูุซู ูุฐู ุงูุซูุงุฆูุงุช ุ ูุงูุชูุงุท ุงูุฃุฎุทุงุก ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุฎุงุตุฉ ุจูู ููุฐูู ุชุดุบูููุง ูู ูุธุงู Linux ุงูุนุงุฏู ูุชุตุญูุญ ุงูุฃุฎุทุงุก ุจุณูููุฉ ูุน ุงูุฃุฏูุงุช ุงูููุฌูุฏุฉ.  ุงูุฏุฑุฌุฉ! </p><br><p style=";text-align:right;direction:rtl">  ูุนุฏุฉ ุฃูุงู ุ ููุฐูุง ุงูุบูุบูุฉ ุจูู ุซูุฉ.  ูุชูุฌุฉู ูุฐูู ุ ูุงู ูุฏููุง ุงููุซูุฑ ูู ุจูุงูุงุช ุงูุฅุฏุฎุงู ุงูุชู ุชููุฏ ุงูุฃุนุทุงู ุ ููููุฉ ุชุญููู ูู ูุฐู ุงูุฃุนุทุงู. </p><br><h2 id="analiziruem-krashi" style=";text-align:right;direction:rtl">  ุชุญููู ุชุญุทู </h2><br><p style=";text-align:right;direction:rtl">  ูู ุงููุฌููุน ููุฏุฉ 23 ุซูุฉ ูุฌุฏุช AFL 477 ุญุงูุงุช ุงุฎุชุจุงุฑ ุชูููุฏ ุชุญุทู.  ูููุฉ ูุจูุฑุฉ ูุง ุฃุฑูุฏ ูุนุงูุฌุชูุง ูุฏูููุง.  ูู ุจูู ูุฐู ุงููุฌููุนุฉ ูู ุญุงูุงุช ุงูุงุฎุชุจุงุฑ ุ ููุงู ุญุงูุงุช ูุชุทุงุจูุฉ ุชูุฑูุจูุง ุชุคุฏู ุฅูู ุชุนุทู ูู ููุณ ุงูููุงู.  ูุฅุฒุงูุฉ ุงูุชูุฑุงุฑ ูุญุงูุงุช ุงูุงุฎุชุจุงุฑ ุ ููููู ุงุณุชุฎุฏุงู ุฃุฏุงุฉ afl-cmin.  ุจุนุฏ ูุฑูุฑ ุฌููุน ุงููุตุงุฆุฏ ุ ุจููุช 225 ุญุงูุฉ ุจุญุงุฌุฉ ุฅูู ุชุญููู.  ุนูู ุฃู ุญุงู ุ ุงููุซูุฑ!  ูู ุฃุฌู ุชุฎููู ูููุชูุง ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู ุ ูุฑุฑูุง ุงุณุชุฎุฏุงู ุฃุฏูุงุช ุงูุชุญููู ุงูุฏููุงูููู ุงูุชู ุณุชุณุงุนุฏ ุนูู ุชุญุฏูุฏ ุฎุทุฃ ุงูุจุฑูุงูุฌ ูุฃู ูู ุฎุตุงุฆุตู ุจุดูู ุฃูุซุฑ ุฏูุฉ.  ุณูุณุงุนุฏ ูุฐุง ูู ุชูููู ูุงุจููุฉ ุงุณุชุฎุฏุงู ุงูุฃุฎุทุงุก ูุชุนููุฏ ุชุดุบูููุง. </p><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ูู ุฃุฌู ุงุณุชุฎุฏุงู ููุน ูู ุฃุฏูุงุช ุงูุชุญููู ุงูุฏููุงูููู ุ ูุญุชุงุฌ ุนูู ุงูุฃูู ุฅูู ุชุดุบูู ุฃุฏูุงุชูุง ุงูููุซููุฉ ุงููุญููุฉ ุนูู ูุธุงู ARM ุงูุฃุตูู ุ ูููุณ ุชุญุช ุชูููุฉ qemu ุงูุงูุชุฑุงุถูุฉ.  ูุฏ ูููู Linux ุฃู Android ููุงุณุจูุง ูุฐูู. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงูุนุฏุฏ 3: ุงูุฃูุณุงู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูุฑุฑูุง ุงุชุฎุงุฐ ูุธุงู 32 ุจุช ูุน ููููุณ ุ ูุฃู  ุญุณุงุจุงุช Trust-32-bit ู Linux ุฃูุซุฑ ููุงุกูุฉ ููุฏููุง ุฃุฏูุงุช ุชุญููู ุฃูุซุฑ ุฏููุงููููุฉ ูู Android.  ูููุง ุงุชุถุญ ุฃูู ุนูุฏ ุฅุทูุงูู ุ ูุฅู ุงูุฌุงู ูุฏููุง ูุตุฏุฑูู ุนูู ุงูููุฑ ุฎุทุฃ ุชุฌุฒุฆุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุงุชุถุญ ุฃู ุงููุดููุฉ ูู ุบุฑุงุจุฉ ุงูุซูุงุฆูุงุช ูุฏููุง.  ุนูุฏ ุฅูุดุงุฆูุง ุ ุณุชุญุชุงุฌ ุฅูู ูุถุน ุฃูุณุงู ุงููุซูู ุนูู ุงูุนูุงููู ุงููุฑุบูุจุฉ ุ ุญูุซ ูููู ุนููุงู ูุณู ุงูููุฏ ุงูุฎุงุต ุจุงููุซููุฉ ุฏุงุฆููุง 0x1000.  ูุฐุง ูู ุงููุณู ุงูุฃูู ูู ุงูููู ุ ููุง ุฒุงู ุฃูุงูู ุฑุฃุณ ELF ุนูุฏ 0x0.  ูุนูู ูุธุงู Linux ุ ูุชู ุญุฌุฒ ุฃูู ุตูุญุชูู ูู ูุณุงุญุฉ ุงูุนููุงู ุ ุญุชู ุงูุนููุงู 0x2000 ุ ูููุงู ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ ุ ูุฐูู ุนูุฏูุง ูุญุงูู ุงูููุญูู ุนุฑุถ ูุณู ููุงู ุ ูุญุฏุซ ุฎุทุฃ. </p><br><p style=";text-align:right;direction:rtl">  ููุง ุงุชุถุญ ุ ููุงู ุทุฑููุฉ ููุฎุฑูุฌ ูู ูุฐุง ุงููุถุน.  ุนูู ููุงุฉ 64 ุจุช ุ ูุง ูุญุฏุซ ูุซู ูุฐุง ุงูุญุฌุฒ ููุตูุญุงุช ุงูุฃููู ูู ุงูุฐุงูุฑุฉ ุ ููุตุจุญ ุชุฑุชูุจ ุงูุฃูุณุงู ูุฐุง ูููููุง.  ูุธุฑูุง ูุฃู ูููุงุชูุง 32 ุจุช ุ ููู ุงูููุงุฆู ุฃููุงู ุฅูุดุงุก ุจูุฆุฉ 32 ุจุช ุนูู ูุธุงู 64 ุจุช.  ุญุฒูุฉ <code>debootstrap</code> ุฑุงุฆุนุฉ ููุฐู ุงูุฃุบุฑุงุถ. </p></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงููุดููุฉ ุฑูู 4: ูุง ุชูุฌุฏ ุฃุฏูุงุช</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุงูุขู ูุจุนุฏ ุฃู ุชุนูู ูุญุฏุงุชูุง ุงูููุซููุฉ ุงููุนุงุฏ ุชุตููููุง ุนูู ูุธุงู ARM ุงูุฃุตูู ุ ูุญุชุงุฌ ุฅูู ุชุฌุฑุจุฉ ุฃุฏูุงุช ุงูุชุญููู ุงูุฏููุงูููู ุนูููุง.  ูู ุจูู ุฃุณุงููุจ ุงูุชุญููู ุงูุฏููุงูููู ูููููุงุช ุงูุซูุงุฆูุฉ ูู ุชุตุญูุญ ุงูุฃุฎุทุงุก ูุงูุฃุฌูุฒุฉ ุงูุฏููุงููููุฉ ุงูุซูุงุฆูุฉ (DBI).  Gdb ุนุธูู ููุฃูู.  ูููุซุงูู ุ ูุง ููุฌุฏ ุงูุนุฏูุฏ ูู ุงูุฎูุงุฑุงุช: ุชุญุช ARM ุ ูุง ููุฌุฏ ุณูู ุซูุงุซุฉ ุฃุทุฑ ุนูู DBI ุซุงุจุชุฉ - DynamoRIO ู Valgrind ู Frida.  ูุญุชูู ุงูุฃูู ุนูู ุงูุนุฏูุฏ ูู ุงูุฃุฏูุงุช ุงูุฌูุฏุฉ ูุชุชุจุน ุงูุฃุฎุทุงุก ูุงูุชูุงุทูุง ุ ููู ูุญูู ูููุงุช ELF ุ ุงูุฐู ุชู ุชูููุฐู ููู ุ ูู ูุชููู ูู ุงูุชุนุงูู ูุน ุชุญููู ูููุงุชูุง.  Valgrind ูู ุฅุทุงุฑ ููู ุฅูู ุญุฏ ูุง ุ ููุฏูู ุฃุฏูุงุช callgrind ููุงุณุจุฉ ููุง ูุชุชุจุน ู memcheck ููุฑุงูุจุฉ ุนูููุงุช ุงูุฐุงูุฑุฉ.  ุงุชุถุญ ุฃููุง ุชูุชุฌ ูุชุงุฆุฌ ุบูุฑ ููุงุฆูุฉ ููุชุญููู ุ ูุฐุง ููู ุบูุฑ ููุงุณุจุฉ ููุงุณุชุฎุฏุงู ูู ุงููุถุน ุงูุชููุงุฆู ุนูู ุงูุนุฏูุฏ ูู ุงููููุงุช.  ููู ููู ูุฏููุง ููุช ูุชุฌุฑุจุฉ ูุฑูุฏุง.  ุฅุฐุง ูุงู ุฃู ุดุฎุต ูุฏูู ุฎุจุฑุฉ ูู ุงุณุชุฎุฏุงู Linux ุนูู ARM ุ ูุงูุชุจ ุงูุทุจุงุนุงุชู ูู ุงูุชุนูููุงุช. </p></div></div><br><p style=";text-align:right;direction:rtl">  ููุง ุชุฑูู ุ ูููููุง ููุท ุฃู ูููู ุฑุงุถูู ุนู ุทุฑูู ูุตุญุญ ุงูุฃุฎุทุงุก.  ููู ุงุณุชุฎุฏุงู ุงูุจุฑุงูุฌ ุงููุตูุฉ ู gdb ุญุชู ูุฐุง ุจุงููุนู ูุจุณุท ุนูููุง ุฅูู ุญุฏ ูุจูุฑ. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงููุดููุฉ ุฑูู 5: ูุธุงุฆู ุงูููุชุจุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ููุงู ูุดููุฉ ุฃุฎุฑู ูุงูุช ูุงุถุญุฉ ููุฐ ุงูุจุฏุงูุฉ ููู ูุธุงุฆู ุงูููุชุจุฉ ุงูุชู ูุณุชุฎุฏููุง trastlet.  ููุฏ ุงุณุชุจุฏููุงูุง ุจุฐุฑุฉ ุ ุจุงุณุชุซูุงุก ุงููุธุงุฆู ุงูุชู ูููู ุงุณุชุจุฏุงููุง ุจูุธุงุฆู ููุงุซูุฉ ูู libc.  ูู ุงููุงุถุญ ุ ุฃูู ูู ููุทู trastlet ุ ุชููู ุจุนุถ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุจูุนุงูุฌุฉ ูุชูุฌุฉ ุฅุญุฏู ูุธุงุฆู ูุนุจ ุงูุฑูุชูู ูุฐู ุ ููู ุงููุญุชูู ุฌุฏูุง ุฃู ุชุชุนุทู ุจุณุจุจ ุญูููุฉ ุฃููุง ุชุชููุน ุจูุงูุงุช ูุฎุชููุฉ ุชูุงููุง ุ ููุฐุง ูุง ูุนูู ุจุงูุถุฑูุฑุฉ ูุฌูุฏ ุฎุทุฃ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ููุงู ุนุฏุฏ ูููู ูู ุงููุธุงุฆู ุงูุชู ููุณ ูู ุงูุณูู ูุญุงูุงุฉ ุณููู ูุธููุฉ ุญููููุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  tlApiSecSPICmd. </li><li style=";text-align:right;direction:rtl">  tlApi_callDriver. </li><li style=";text-align:right;direction:rtl">  tlApiWrapObjectExt. </li><li style=";text-align:right;direction:rtl">  tlApiUnWrapObjectExt. </li><li style=";text-align:right;direction:rtl">  tlApiCipherDoFinal. </li><li style=";text-align:right;direction:rtl">  tlApiSignatureSign. </li><li style=";text-align:right;direction:rtl">  ... </li></ul><br><p style=";text-align:right;direction:rtl">  ูู ุฃุฌู ุนุฏู ุฅุถุงุนุฉ ุงูููุช ูู ุฏุฑุงุณุฉ ูุซู ูุฐู ุงูุญุงูุงุช ุงููุดููู ูููุง ุ ูุฑุฑูุง ุจุจุณุงุทุฉ ุนุฏู ุงููุธุฑ ูู ุญุงูุงุช ุงูุงุฎุชุจุงุฑ ุงูุชู ุชุณุชุฎุฏู ูุฐู ุงููุธุงุฆู. </p></div></div><br><h2 id="rezultaty-fazzinga" style=";text-align:right;direction:rtl">  ูุชุงุฆุฌ ุบุงูุถุฉ </h2><br><p style=";text-align:right;direction:rtl">  ูู ุงููุถุน ุงูุชููุงุฆู ุ ุจุงุณุชุฎุฏุงู ุงูุจุฑุงูุฌ ุงููุตูุฉ ุ ูููุง ุจุฌูุน ุงููุนูููุงุช ุงูุชุงููุฉ ุนูู ุฌููุน ููุงุฆู ุงูุงุนุชูุงุฏ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  Traidlet UID </li><li style=";text-align:right;direction:rtl">  ูุนุฑู ุงูุญุงุฏุซ ุ </li><li style=";text-align:right;direction:rtl">  ููุน ุงูุฎุทุฃ (ููุน ุงูุฅุดุงุฑุฉ ุฃุซูุงุก ุงูุชุนุทู) ุ </li><li style=";text-align:right;direction:rtl">  ุงูุนููุงู ุงูุฐู ูุญุฏุซ ููู ุงูุฎุทุฃ </li><li style=";text-align:right;direction:rtl">  ูุธุงุฆู API ุงููุณุชุฎุฏูุฉ ูู ูุจู trastlet. </li></ul><br><p style=";text-align:right;direction:rtl">  ููุง ุงุชุถุญ ุ ูู ุงููุฑูุญ ุฌุฏูุง ูุถุน ูู ูุฐู ุงููุนูููุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ุซู ุชุญุฏูุฏ ุงูุญุงูุงุช ุงูุฃูุซุฑ ุฅุซุงุฑุฉ ููุชุญููู ุจูุงุณุทุฉ ุงุณุชุนูุงูุงุช SQL ูุฅุถุงูุฉ ูุนูููุงุช ุจูุงุกู ุนูู ูุชุงุฆุฌ ุงูุชุญููู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/k_/uk/mm/k_ukmmhlewkiem_fvzwfms-eiai.png"></p><br><p style=";text-align:right;direction:rtl">  ุนูู ุณุจูู ุงููุซุงู ุ ูุน ูุฐุง ุงูุงุณุชุนูุงู ุ ููููู ุฅุธูุงุฑ ุฌููุน ุญุงูุงุช ุงูุงุฎุชุจุงุฑ ุงูุชู ูุญุฏุซ ูููุง ุฎุทุฃ ุฎุทุฃ ุงูุชุตููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">select * from main where type = "SIGSEGV";</code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>tlApiSecSPICmd</code> ุญุงูุงุช ุงูุงุฎุชุจุงุฑ ุงูุชู ุชุณุชุฎุฏู ุฏุงูุฉ <code>tlApiSecSPICmd</code> ุ ูุงูุชู ูููุง ุจุชูููุฐูุง ูุฃุฏุงุฉ ูุนุจ ุฑูุชูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">select * from main where api not like "tlApiSecSPICmd";</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุจุงูุชุงูู ุ ุชู ุงูุนุซูุฑ ุนูู ุฃุฎุทุงุก ูู ุฃููุงุน ูุฎุชููุฉ ูู ุฌููุน Trustlets.  ุงูุจุนุถ ูููู ูู ูุคุฏู ุฅูู ููุงุท ุงูุถุนู ุ ูููู ูุงูุช ููุงู ููุงุท ุงูุถุนู ุชูู ูุงูุชู ูููู ุงุณุชุฎุฏุงููุง ูู ูุจู ุงูููุงุฌู.  ุงููุธุฑ ูู ุงูุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู ูู ุงูุซุบุฑุงุช ุงูููุฌูุฏุฉ. </p><br><h2 id="sve-2019-14126" style=";text-align:right;direction:rtl">  SVE-2019-14126 </h2><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ji/zy/hr/jizyhrbu1vcna9da47r_s0dmjdy.png"></p><br><p style=";text-align:right;direction:rtl">  ุชู ุงูุนุซูุฑ ุนูู ูุดููุฉ ุนุฏู ุงูุญุตุงูุฉ ูู Trustmaster ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ููุนุงูุฌุฉ ูุญุชููุงุช ุงููุฎุฒู ุงููุคูุช TCI ุฃุซูุงุก ุชุญููู ุจููุฉ ASN.1 ุงููุดูุฑุฉ ููููุง ูููุงุนุฏ DER.  ูุชู ุงุณุชุฎุฏุงู ุญูููู ูู ูุฐุง ุงููููู ูุฃุจุนุงุฏ: ุฃุญุฏููุง ุนูุฏ ุชุฎุตูุต ุฐุงูุฑุฉ ุฏููุงููููุฉ ูุงูุขุฎุฑ ุนูุฏ ูุณุฎู.  ูู ุงููุงุถุญ ุ ุฅุฐุง ูุงู ุงูุญุฌู ุงูุซุงูู ุฃูุจุฑ ูู ุงูุฃูู ุ ูุญุฏุซ ุชุฌุงูุฒ ุณุนุฉ ุงููููุฉ.  ุชุคุฏู ููุงุท ุงูุถุนู ูุฐู ุนุงุฏุฉู ุฅูู ุฅููุงููุฉ ุชูููุฐ ุชุนูููุงุช ุจุฑูุฌูุฉ ูู ูุจู ุงูููุงุฌููู ุ ูุฐูู ุญุงูููุง ุฅุฌุฑุงุก ุงุณุชุบูุงู ูุงูู ููุฐู ุงูุซุบุฑุฉ ุงูุฃูููุฉ.  ุนูุฏ ุชูููู ุฅููุงููุฉ ุงูุงุณุชุบูุงู ุ ูุฌุจ ุนูู ุงููุฑุก ุฃูุถูุง ูุฑุงุนุงุฉ ุฌููุน ูููุฏ ุงูุตูุงุฏูู ุงููุฐููุฑุฉ ุฃุนูุงู. </p><br><p style=";text-align:right;direction:rtl">  ูุฌูุฏ ููุถ ููุถ ูููุฉ ูุจูุงุกู ุนูู ูุฐู ุงููููุฏ ุ ูููู ูููุฑุก ุฃู ูุชุฎูู ุงุณุชุฑุงุชูุฌูุฉ ุงูุชุดุบูู ุงูุชุงููุฉ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงุจุญุซ ุนู ูุคุดุฑ ูุธููุฉ ูู ููุงู ูุณูู ุงููุตูู ุฅููู ูุฅุนุงุฏุฉ ุงููุชุงุจุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูู ูุณู .bss ุ </li><li style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู ุงููุงุฆุถ ุงูููุฌูุฏ ุ ูู ุจุฅูุดุงุก ูุชูุฉ ุฐุงูุฑุฉ ูููุฉ ุงูุฐุงูุฑุฉ ุงููุคูุชุฉ ูู ูุฐุง ุงูููุงู ุ </li><li style=";text-align:right;direction:rtl">           ; </li><li style=";text-align:right;direction:rtl">      . </li></ol><br><p style=";text-align:right;direction:rtl">   , ,    ,       Kinibi.      -      mclib,          <a href="https://downloads.immunityinc.com/infiltrate2019-slidepacks/eloi-sanfelix-exploiting-trusted-apps-in-samsung-tee/TEE.pdf"> </a>   ZeroCon,   . </p><br><p style=";text-align:right;direction:rtl">     โ        .bss.            ,   .bss       .               , ,  ,    ,       . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/l8/ng/jb/l8ngjbgjfox8nubn0ipgjmay70s.jpeg"></p><br><p style=";text-align:right;direction:rtl">  ,       .bss,      . </p><br><p style=";text-align:right;direction:rtl">        ,      . ,       ,    ,    ,       .bss,   .     <em></em>     code-reuse. </p><br><p style=";text-align:right;direction:rtl">     ROP. ,    ROP,            .bss.      ,      ,          .   ,     ,             .     , , ,   . </p><br><p style=";text-align:right;direction:rtl">  ROP,    JOP. JOP โ  Jump Oriented Programming.  JOP            . </p><br><p style=";text-align:right;direction:rtl">     JOP ,    ROPGadget.     ,     JOP,      : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">ROPgadget --binary tlrun --thumb --range 0x1000-0xbeb44 | grep -E "; b.+ r[0-9]+$"</code> </pre> <br><p style=";text-align:right;direction:rtl">  !       . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ti/oz/96/tioz96g4dhzaugtxtlr0d4sq4cc.png"></p><br><p style=";text-align:right;direction:rtl">       .  ROP             .  ,  ROP-   <a href="https://en.wikipedia.org/wiki/Weird_machine">weird machine</a> ,    .   JOP     ,          .   ARM,      ,  ,     โ LDMIA (Load Memory Increment Address). </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/i6/vm/pu/i6vmpufz2lpz6aoeapmujzc7xa0.png"></p><br><p style=";text-align:right;direction:rtl">      ,  ,         ,   ,   .         ,            .        JOP! </p><br><p style=";text-align:right;direction:rtl">       LDMIA   . - capstone,    ROPGadget,     LDMLO. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/hm/5l/vi/hm5lvigl8qx96w_xtjasd2ngeie.png"></p><br><p style=";text-align:right;direction:rtl">    !   .         ,         ,  .   stack cookie  ,    . </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">*(int*)&amp;mem1[offset] = SUPER_GADGET; // r2 *(int*)&amp;mem1[offset + 4] = 0; // r3 *(int*)&amp;mem1[offset + 8] = 0; // r4 *(int*)&amp;mem1[offset + 12] = SUPER_GADGET; // r5 *(int*)&amp;mem1[offset + 16] = 0x9560b; // r7 offset += 0x14; *(int*)&amp;mem1[offset] = 0; // r2 *(int*)&amp;mem1[offset + 4] = 0; // r3 *(int*)&amp;mem1[offset + 8] = 0; // r4 *(int*)&amp;mem1[offset + 12] = 0; // r5 *(int*)&amp;mem1[offset + 16] = 0x96829; // r7 offset += 0x14; *(int*)&amp;mem1[offset] = SUPER_GADGET; // r2 *(int*)&amp;mem1[offset + 4] = 0; // r3 *(int*)&amp;mem1[offset + 8] = 0x3d5f4; // r4 *(int*)&amp;mem1[offset + 12] = mapInfo3.sVirtualAddr; // r5 *(int*)&amp;mem1[offset + 16] = 0x218c7; // r7</code> </pre> <br><p style=";text-align:right;direction:rtl"> Hello, world       . </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">strcpy(mem3 + 0x100, "Hello world from TEE!\n"); *(int*)&amp;mem1[offset] = 0x7d081b1; // r2 *(int*)&amp;mem1[offset + 4] = 0; // r3 *(int*)&amp;mem1[offset + 8] = mapInfo3.sVirtualAddr + 0x100; // r4 *(int*)&amp;mem1[offset + 12] = 0; // r5 *(int*)&amp;mem1[offset + 16] = 0x9545b; // r7</code> </pre> <br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/qt/ay/jo/qtayjouk0l2xu35tl2v2faovzlw.png"></p><br><p style=";text-align:right;direction:rtl">  "Hello, world!"   , , ,   keymaster, ,   .        ,     . ,  <a href="http://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html"> </a> Gal Beniamini  TEE Qualcomm         ,  ,  offline-     Android.          TEE OS     EL-3,         . </p><br><h2 id="zaklyuchenie" style=";text-align:right;direction:rtl">  ุงุณุชูุชุงุฌ </h2><br><p style=";text-align:right;direction:rtl"> ARM TrustZone             ,            .     Secure World         Android,              .  , , Samsung   <a href="">bug bounty</a>      TrustZone,     . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ai/rq/ii/airqiifvmexik-gscxzzpu1ohbo.png"></p><br><p style=";text-align:right;direction:rtl">      AFL  qemu,         ""  .            .              ,        .     ! </p><br><h2 id="poleznye-ssylki" style=";text-align:right;direction:rtl">  ุฑูุงุจุท ูููุฏุฉ </h2><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <a href="https://blog.quarkslab.com/reverse-engineering-samsung-s6-sboot-part-i.html">Reverse Engineering Samsung S6 SBOOT</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://medium.com/taszksec/unbox-your-phone-part-i-331bbf44c30c">Unbox Your Phone</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://googleprojectzero.blogspot.com/2017/07/trust-issues-exploiting-trustzone-tees.html">Trust Issues: Exploiting TrustZone TEEs</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://downloads.immunityinc.com/infiltrate2019-slidepacks/eloi-sanfelix-exploiting-trusted-apps-in-samsung-tee/TEE.pdf">TEE Exploitation: Exploiting Trusted Apps on Samsung's TEE at Zer0con 2019</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://i.blackhat.com/USA-19/Thursday/us-19-Peterlin-Breaking-Samsungs-ARM-TrustZone.pdf">BREAKING SAMSUNG'S ARM TRUSTZONE at BlackHat USA 2019</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://cfp.recon.cx/reconmtl2019/talk/DYGNJQ/">The road to Qualcomm TrustZone apps fuzzing</a> </li><li style=";text-align:right;direction:rtl"> <a href="http://allsoftwaresucks.blogspot.com/2019/05/reverse-engineering-samsung-exynos-9820.html">Reverse-engineering Samsung Exynos 9820 bootloader and TZ</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar478948/">https://habr.com/ru/post/ar478948/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar478930/index.html">ููููุฉ ุงุณุชุฎุฏุงู MySQL ุจุฏูู ูููุฉ ูุฑูุฑ (ููุฎุงุทุฑ ุงูุฃูุงู)</a></li>
<li><a href="../ar478932/index.html">ุนุงูู ุงููููุงุก ูููุงุฌูุฉ ุงูุฃูุงููุฉ. ุงูุฌุฒุก 1. ููุงุฐุงุ</a></li>
<li><a href="../ar478934/index.html">ูุญุฏุฉ ููุชุจุฉ ุจูุซูู ุงูููุงุณูุฉ ุงูุฃูุซุฑ ูุงุฆุฏุฉ ูุงูุชู ููุณู ุงูุฌููุน ุจุงุณุชูุฑุงุฑ</a></li>
<li><a href="../ar478938/index.html">ูุชุนูู ุงููุนูุฏ ุจูุงุกู ุนูู ููุงุตูุงุช Ecmascript. ูุนุฑูุฉ</a></li>
<li><a href="../ar478942/index.html">ุชุฌุฑุจุฉ ุงูุฅุจุงุญูุฉ ุฑุงุฆุนุฉ: ุชุงุฑูุฎ ุงูุฅูุชุฑูุช ููุจุงูุบูู</a></li>
<li><a href="../ar478950/index.html">ูุชุงุฆุฌ ุงูุฃุณุจูุน: ููุงูู ุชุชููู ูุน ุงูุนููุจุงุช ุ ูุจูุชูู ูููุน ููุงููู ูุซูุฑุฉ ุ ููู ุฑูุณูุง ูุญุธุฑูู ShutterStock</a></li>
<li><a href="../ar478952/index.html">ุดูุฑ ูุน Onyx Boox Note Pro</a></li>
<li><a href="../ar478954/index.html">ุฅุนุงุฏุฉ: ุงูุฎูู ูุงูุจุบุถ ูู ุชูููููุฌูุง ุงููุนูููุงุช</a></li>
<li><a href="../ar478956/index.html">ุชูุฏูู 3CX V16 Update 4 Beta ูุน ุชุทุจูู Chrome VoIP Client ูุชุทุจูู ุงูููุฏูู ููุธุงู Android</a></li>
<li><a href="../ar478958/index.html">ุงุณุชููุงู ูููุฏูุฒ 10 ุฏููู ุงูุชุฑููุฉ ูููุคุณุณุงุช ูู ุฃู ุญุฌู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>