<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçè üëãüèª üëî R√©duisez le temps de construction de vos projets Android üë®üèΩ‚Äçüè≠ üëÑ üëçüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour Nous commen√ßons lundi avec du mat√©riel, dont la traduction a √©t√© pr√©par√©e sp√©cialement pour les √©tudiants du cours "d√©veloppeur Android". Cour...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>R√©duisez le temps de construction de vos projets Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/457374/">  Bonjour  Nous commen√ßons lundi avec du mat√©riel, dont la traduction a √©t√© pr√©par√©e sp√©cialement pour les √©tudiants du cours <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"d√©veloppeur Android".</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cours avanc√©</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"</a> <br><br><img src="https://habrastorage.org/webt/cq/gh/9u/cqgh9uzb-qlhdgfjiv_ayajrqde.png"><br><br>  J'ai r√©cemment migr√© la base de code Android vers <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kure</a> sur AndroidX.  Il m'a sembl√© que c'√©tait une belle opportunit√© de travailler sur la vitesse du projet.  Gradle a toujours eu une mauvaise r√©putation en raison de la lenteur et de la consommation de ressources, mais j'ai √©t√© tr√®s surpris que des modifications mineures de la configuration de l'assemblage puissent augmenter sa vitesse de mani√®re si significative. <br><a name="habracut"></a><br>  Regardez les m√©triques de scan d'assemblage avant / apr√®s l'optimisation <br><br><img src="https://habrastorage.org/webt/2k/yw/2w/2kyw2wlroiairpx8iiriwjdbejq.jpeg"><br>  <i>avant optimisation</i> <br><br><img src="https://habrastorage.org/webt/ef/ss/u6/efssu62faz4yoi92zvmssa1pf0m.jpeg"><br>  <i>apr√®s optimisation Ô∏èÔ∏è</i> <br><br>  Diminu√© de 5,5 minutes √† <b>17 secondes ??</b>  <b>Deviens fou!</b> <br><br>  Il n'est pas si difficile d'en faire trop avec l'optimisation pour r√©duire davantage le temps d'assemblage.  Mais afin de rendre le post compr√©hensible pour les d√©butants, je me concentrerai d√©lib√©r√©ment sur les mesures mineures et indolores que j'ai prises pour me rapprocher de cet indicateur. <br><br><h2>  Tout d'abord! </h2><br>  Avant de commencer l'optimisation, il est important de tester notre projet pour savoir combien de temps il faut pour le construire.  Gradle dispose d'une option d'analyse pratique que vous pouvez utiliser pour analyser les performances de votre t√¢che.  Lancez le terminal dans Android Studio et ex√©cutez la commande suivante: <br><br><pre><code class="kotlin hljs">./gradlew assembleDebug --scan</code> </pre> <br>  Une fois l'assemblage termin√©, il vous sera demand√© d'accepter les conditions de service pour t√©l√©charger les r√©sultats de l'analyse.  Entrez <b>oui</b> pour continuer.  Une fois la publication termin√©e, vous recevrez un lien vers le terminal pour v√©rifier le scan.  Ouvrez-le. <br><br>  <i>Il y a plusieurs options sur le site, mais par souci de concision, nous ne consid√©rerons que ce qui est le plus important.</i> <br><br>  R√©sum√© affiche des informations r√©capitulatives sur les t√¢ches termin√©es et leur dur√©e.  Mais ce qui nous int√©resse ici, c'est la section <b>Performance</b> .  Il fait une ventilation plus d√©taill√©e du temps de construction total, comme indiqu√© ci-dessous. <br><br><img src="https://habrastorage.org/webt/on/n_/he/onn_he0w_k-i5nkwr7jagda9mx4.jpeg"><br><br>  Dans la section Performances, il y a un onglet <b>Param√®tres et suggestions</b> qui fournit des recommandations pour am√©liorer la vitesse de construction.  Regardons-les. <br><br><img src="https://habrastorage.org/webt/g0/l0/bu/g0l0buxdn5wy1pfkxnuc0f9i0gc.jpeg"><br><br>  Dans cette section, nous pouvons trouver quelques correctifs simples pour am√©liorer la vitesse.  Continuons donc et appliquons ces corrections dans notre projet. <br><br><h2>  √âtape # 1: Mettre √† niveau les outils </h2><br>  L'√©quipe Android am√©liore et d√©veloppe constamment le syst√®me de construction.  Ainsi, dans la plupart des cas, vous pouvez obtenir une am√©lioration significative en installant simplement la derni√®re version de la bo√Æte √† outils. <br><br>  Lors de ce refactoring, notre projet √©tait sur la <b>version 3.2.1 du</b> plugin Gradle pour Android Studio ( <i>plusieurs versions plus anciennes que la derni√®re version</i> ). <br><br>  Vous pouvez suivre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ce lien</a> pour obtenir la derni√®re version du plugin Gradle.  Au moment d'√©crire ces lignes, la derni√®re <b>version</b> √©tait la <b>version 3.4.0.</b> <br><br>  Mais il y a un hic ici que nous devons nous rappeler: <br><br><img src="https://habrastorage.org/webt/v0/b9/j9/v0b9j9xfqws0eknr0khchb4aoi0.jpeg"><br><br>  <i>( <b>Remarque:</b> lorsque vous utilisez Gradle version 5.0 ou sup√©rieure, la taille par d√©faut du d√©mon Gradle est r√©duite de 1 Go √† 512 Mo. Cela peut entra√Æner de mauvaises performances de g√©n√©ration. Pour remplacer ce param√®tre par d√©faut, sp√©cifiez la taille de la m√©moire du d√©mon Gradle dans gradle.properties votre projet.)</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://developer.android.com/studio/releases/gradle-plugin</a> <br><br>  <i>Lors de l'utilisation de <b>Gradle 5.0 et sup√©rieur,</b> nous devrons augmenter explicitement la taille de la m√©moire afin que notre vitesse de construction ne se d√©t√©riore pas.</i>  <i>Nous y reviendrons dans une minute.</i> <br><br>  Ouvrez le fichier <b>build.gradle de</b> niveau <b>sup√©rieur</b> , que vous trouverez √† la racine de votre projet, et ajoutez la ligne suivante √† <b>la section des d√©pendances</b> : <br><br> <code>classpath 'com.android.tools.build:gradle:3.4.0'</code> <br> <br>  Vous devez √©galement mettre √† jour l' <b>URL de distribution</b> dans le fichier de propri√©t√©s de Gradle Wrapper situ√© dans <code><b>gradle/wrapper/gradle-wrapper.properties</b></code> .  Mettez √† jour l'URL comme suit. <br><br>  ( <i>Ce lien sera disponible sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la page du plugin Android Gradle</a> .</i> ) <br><br> <code>distributionUrl=https\://services.gradle.org/distributions/gradle-5.1.1-all.zip</code> <br> <br>  Vous rencontrerez une erreur lors de l'utilisation de Kotlin si la version du plugin Kotlin Gradle est inf√©rieure √† <b>1.3.0.</b>  Si c'est le cas, utilisez l'info-bulle IDE pour mettre √† jour le plugin Gradle pour Kotlin vers la derni√®re version (au moment de la r√©daction de ce document, il s'agit de la <b>version 1.3.31</b> ). <br><br>  Ok, ex√©cutons √† nouveau la construction √† partir du terminal pour voir si nous avons apport√© des am√©liorations. <br><br><img src="https://habrastorage.org/webt/gg/lg/kf/gglgkfxrbccatt7ygkyswjrky28.jpeg"><br><br><h2>  √âtape # 2: Mettre √† jour les configurations </h2><br>  Nous avons donc pu r√©duire d'environ 2,5 minutes le temps de g√©n√©ration, mais ce n'est toujours pas suffisant.  Apr√®s avoir √©tudi√© les journaux de construction dans le terminal, je suis tomb√© sur une ligne qui nous int√©ressera: <br><br><img src="https://habrastorage.org/webt/gr/fo/pv/grfopv6dg9wjtertgdxun5danku.jpeg"><br><br>  <i>(&gt; T√¢che: app: compileDevelopDebugJavawithJavac</i> <i><br><br></i>  <i>Gradle peut d√©sactiver la compilation incr√©mentielle car les processeurs d'annotation suivants ne sont pas incr√©mentiels: butterknife-compiler-10.1.0.jar (com.jakewharton: butterknife-compiler: 10.1.0), dagger-compiler-2.9.jar (com.google. dague: dague-compilateur: 2.9).</i> <i><br><br></i>  <i>Envisagez de d√©finir l'indicateur exp√©rimental android.enableSeparateAnnotationProcessing-true dans le fichier gradle.properties pour d√©marrer le traitement des annotations dans une t√¢che distincte et effectuer une compilation incr√©mentielle.)</i> <br><br>  La compilation incr√©mentielle emp√™che essentiellement la compilation inutile de l'ensemble des fichiers source et ne compile √† la place que les fichiers qui ont √©t√© modifi√©s.  D'apr√®s les journaux, il est clair que nous n'utilisons pas cette fonction.  Il sugg√®re que nous utilisons <code><b>android.enableSeparateAnnotationProcessing=true</b></code> , mais, dans tous les cas, nous ne devons pas utiliser la configuration <i>¬´annotationProcessor¬ª</i> puisque Kotlin est utilis√© dans notre projet. <br><br>  Heureusement, la <b>version 1.3.30 de</b> Kotlin ajoute la prise en charge du traitement √©tape par √©tape des annotations. <br><br><img src="https://habrastorage.org/webt/hq/ud/_r/hqud_rdvrv8fzj2z4fadmqbqtqc.jpeg"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://kotlinlang.org/docs/reference/kapt.html</a> <br><br><h4>  (Traitement incr√©mentiel des annotations (√† partir du 1.3.30) </h4><br>  Depuis la version 1.3.30, <code>kapt</code> prend en charge le traitement d'annotations incr√©mentielles comme fonction exp√©rimentale.  Actuellement, le traitement d'annotation ne peut √™tre effectu√© de mani√®re incr√©mentielle que si tous les processeurs d'annotation utilis√©s sont incr√©mentiels. <br>  Pour activer le traitement d'annotations incr√©mentielles, ajoutez cette ligne au fichier <code>gradle.properties</code> : <br><br> <code>kapt.incremental.apt=true</code> <br> <br>  Notez que le traitement d'annotations incr√©mentielles n√©cessite que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la compilation incr√©mentielle soit</a> √©galement activ√©e.) <br><br>  Commen√ßons donc: <br><br><ol><li>  1. Changez la configuration de l' <b>annotationProcessor</b> en <b>kapt</b> </li><li>  2. Activez l'indicateur de <b>traitement d'annotation incr√©mentiel</b> exp√©rimental </li></ol><br>  Ouvrez le fichier <code><b>build.gradle</b></code> votre module et ajoutez la ligne suivante en haut du fichier: <br><br> <code>apply plugin: 'kotlin-kapt'</code> <br> <br>  Modifiez ensuite toutes les configurations d'annotationProcessor dans la section des d√©pendances pour utiliser kapt.  Par exemple: <br><br> <code>// <br> annotationProcessor 'com.google.dagger:dagger-compiler:2.9' <br> // <br> kapt 'com.google.dagger:dagger-compiler:2.9'</code> <br> <br>  Ouvrez maintenant le fichier <b>gradle.properties</b> situ√© √† la racine de votre projet et ajoutez la ligne suivante: <br><br> <code>kapt.incremental.apt=true</code> <br> <br>  Lan√ßons √† nouveau la construction. <br><br><img src="https://habrastorage.org/webt/wl/bg/xk/wlbgxkwt2nlgrhbf6a-nxj5_jkw.jpeg"><br><br>  Eh bien, il semble que nous ayons fait des progr√®s. <br><br><h2>  √âtape # 3: Propri√©t√©s Gradle </h2><br>  Nous sommes √† la derni√®re √©tape.  Vous vous souvenez de l'astuce que nous avons rencontr√©e lors de la mise √† jour de la version du plugin Gradle?  Il s'av√®re que les nouvelles versions de Gradle r√©duisent la taille de la m√©moire utilis√©e √† 512 Mo.  C'est pour s'assurer que les machines faibles ne consomment pas trop de m√©moire.  J'ai un ordinateur avec 16 gigaoctets de RAM, donc je peux me permettre d'alimenter environ 2-3 Go au d√©mon Gradle, mais vos chiffres peuvent varier. <br><br>  Ouvrez le fichier <b>gradle.properties</b> situ√© √† la racine de votre projet et ajoutez la ligne suivante.  Assurez-vous de choisir la taille qui correspond √† vos besoins et aux sp√©cifications de l'ordinateur. <br><br> <code>org.gradle.jvmargs=-Xmx3072m -XX:MaxPermSize=512m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8</code> <br> <br>  Pendant ce temps, activons √©galement les assemblys parall√®les et le r√©glage √† la demande dans les propri√©t√©s. <br><br>  Voici √† quoi ressemble ma version finale du fichier <code><b>gradle.properties</b></code> : <br><br><pre> <code class="kotlin hljs">org.gradle.jvmargs=-Xmx3072m -XX:MaxPermSize=<span class="hljs-number"><span class="hljs-number">512</span></span>m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-<span class="hljs-number"><span class="hljs-number">8</span></span> org.gradle.parallel=<span class="hljs-literal"><span class="hljs-literal">true</span></span> org.gradle.configureondemand=<span class="hljs-literal"><span class="hljs-literal">true</span></span> kapt.incremental.apt=<span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br><br><ul><li>  <code>org.gradle.parallel</code> - cet indicateur permet √† Gradle d'assembler des modules dans un projet en parall√®le, plut√¥t que s√©quentiellement.  Ceci n'est utile que pour les projets multi-modules. </li><li>  <code>org.gradle.configureondemand</code> - cet indicateur configure uniquement les modules n√©cessaires au projet et ne les collecte pas tous. </li></ul><br>  Cela fait, voyons ce que nous avons maintenant les indicateurs de vitesse d'assemblage: <br><br><img src="https://habrastorage.org/webt/42/g0/mu/42g0mugmqkhqo2ok7ynl-pqcf3e.jpeg"><br><img src="https://habrastorage.org/webt/3h/rb/p8/3hrbp8uyadmxzrzxioj6u6ghob4.jpeg"><br><br>  Et voil√†! <br><br><h2>  Observations finales </h2><br>  Il ne s'agit en aucun cas d'une couverture √©tendue de toutes les fa√ßons d'optimiser la vitesse d'assemblage.  Il y a beaucoup d'autres choses que je n'ai pas couvert dans cet article, comme l'utilisation de minSdk 21 lors de l'utilisation de MultiDex, la pr√©-indexation des biblioth√®ques, la d√©sactivation de la compression PNG, etc., ne sont que quelques-unes d'entre elles. <br><br>  Mais la plupart de ces configurations n√©cessitent une compr√©hension plus approfondie du syst√®me de construction Android et une exp√©rience de travail avec de grands projets multi-modules (o√π les avantages sont les plus √©vidents).  Les √©tapes que j'ai mentionn√©es ci-dessus sont facilement mises en ≈ìuvre par m√™me les d√©veloppeurs juniors et pr√©sentent des avantages significatifs.  J'esp√®re que cela vous aide √† augmenter la vitesse de construction! <br><br>  A la prochaine fois, la paix soit sur vous! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr457374/">https://habr.com/ru/post/fr457374/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr457350/index.html">Pourquoi l'oscilloscope a-t-il besoin d'un support de cryptographie?</a></li>
<li><a href="../fr457352/index.html">Conclusion des informations sur l'affichage de l'acheteur</a></li>
<li><a href="../fr457354/index.html">Obfuscation des donn√©es pour les tests de performances</a></li>
<li><a href="../fr457362/index.html">Promotion de RUVDS: pr√©parer le serveur en √©t√©</a></li>
<li><a href="../fr457366/index.html">Un fanatique, un morceau de fer ou un spectateur - quel genre de joueur √™tes-vous?</a></li>
<li><a href="../fr457378/index.html">Comment id Software a cr√©√© Wolfenstein 3D bas√© sur la technologie du commandant Keen</a></li>
<li><a href="../fr457380/index.html">OpenGL ultramoderne. 2e partie</a></li>
<li><a href="../fr457382/index.html">7 habitudes des programmeurs performants</a></li>
<li><a href="../fr457386/index.html">Pr√©sentation des interfaces virtuelles Linux: tunnels</a></li>
<li><a href="../fr457390/index.html">Madagascar - √Æle des contrastes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>