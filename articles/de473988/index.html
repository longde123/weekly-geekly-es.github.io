<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👂🏿 🦓 👏🏼 Optimierung der Serververteilung über die Racks 🤳🏾 👩‍👧‍👦 👩🏽‍🏭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kürzlich hat mich ein Kollege in einem Chat gefragt: 

 - Gibt es einen Artikel darüber, wie Server richtig in die Racks gepackt werden? 

 Mir wurde ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Optimierung der Serververteilung über die Racks</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473988/"> Kürzlich hat mich ein Kollege in einem Chat gefragt: <br><br>  - Gibt es einen Artikel darüber, wie Server richtig in die Racks gepackt werden? <br><br>  Mir wurde klar, dass ich mir dessen nicht bewusst bin.  Also habe ich beschlossen, meinen Text zu schreiben. <br><br>  Erstens ist dies ein Artikel über Bare-Metal-Server in Rechenzentrumsanlagen.  Zweitens schätzen wir, dass es viele Server gibt (Hunderte oder Tausende);  Der Artikel macht für weniger Mengen keinen Sinn.  Drittens gehen wir davon aus, dass die Racks drei Einschränkungen aufweisen: physischer Platz, elektrische Leistung pro Schrank und Schränke bleiben in den nebeneinander liegenden Reihen, sodass wir einen einzelnen ToR-Switch verwenden können, um Server in ihnen zu verbinden. <br><a name="habracut"></a><br>  Die Antwort auf die ursprüngliche Frage hängt wesentlich von dem Parameter ab, den wir optimieren, und davon, was wir ändern können, um ein besseres Ergebnis zu erzielen.  Zum Beispiel müssen wir weniger Platz benötigen, um mehr Platz für zukünftiges Wachstum zu schaffen.  Oder wir haben die Freiheit bei der Auswahl der Schrankhöhe, der Leistung pro Rack, der Anzahl der Sockel pro PDU, der Anzahl der Schränke pro Switch-Gruppe (ein Switch pro 1, 2 oder 3 Racks), der Kabellängen und der Verkabelungsarbeiten.  Die letzte Komponente ist entscheidend für das Ende von Rack-Reihen, bei denen Kabel in die andere Reihe gezogen werden müssen oder nicht ausgelastete Ports im Switch verbleiben müssen.  Ganz andere Geschichten sind die Serverauswahl und die Auswahl des Rechenzentrums.  Wir sollten bedenken, dass wir sie bereits ausgewählt haben. <br><br>  Es ist gut, einige Nuancen und Details zu verstehen, insbesondere den durchschnittlichen / maximalen Stromverbrauch des Servers und die Art und Weise, wie unser Anbieter Strom liefert.  Wenn wir also eine Stromversorgung von 230 V 1 Phase haben, kann ein 32-Ampere-Leistungsschalter bis zu ~ 7 kW halten.  Nehmen wir an, wir zahlen offiziell für 6 kW pro Rack.  Wenn ein Anbieter unseren Stromverbrauch pro Reihe von 10 Schränken misst, nicht pro einzelnen, und wenn Leistungsschalter die Leistung auf 7 kW begrenzen, können wir 6,9 kW in einem Rack und 5,1 kW in einem anderen verwenden.  Es wird in Ordnung und nicht strafbar sein. <br><br>  Normalerweise besteht unser Hauptziel darin, die Ausgaben zu minimieren.  Das beste Messkriterium ist die Reduzierung der Gesamtbetriebskosten (TCO).  Es besteht aus folgenden Teilen: <br><br><ul><li>  CAPEX: Kauf von Rechenzentrumsinfrastruktur, Servern, Netzwerkgeräten, Verkabelung </li><li>  OPEX: Gleichstrommiete, Stromverbrauch, Wartung.  OPEX hängt von der Lebensdauer ab.  Es ist vernünftig anzunehmen, dass eine Lebensdauer 3 Jahren entspricht. </li></ul><br><img src="https://habrastorage.org/webt/ub/ur/zi/uburzia_hkzpiosfd3k6i2agrwq.jpeg" alt="TCO-Diagramm"><br><br>  Wir sollten die teuersten Teile des Kuchens optimieren.  Alles andere sollte die verbleibenden Ressourcen so effektiv wie möglich nutzen. <br><br>  Angeblich haben wir einen vorhandenen Gleichstrom, eine Rackhöhe von H-Einheiten (zum Beispiel H = 47), eine Leistung pro Rack-P- <sub>Rack</sub> (P- <sub>Rack</sub> = 6 kW), und wir haben uns für die Verwendung von Servern mit zwei Einheiten von h = 2U entschieden.  Nehmen wir 2 bis 4 Einheiten für Switches, Patchfelder und Kabelmanager aus dem Rack.  Dann können wir S <sub>h</sub> = Rounddown ((H-2..4) / h) -Server in ein Rack einpassen (d. H. S <sub>h</sub> = Rounddown ((47-4) / 2) = 21 Server pro Rack).  Lassen Sie uns S <sub>h</sub> auswendig lernen. <br><br>  In einem einfachen Fall sind alle Server gleich.  Wenn wir also ein Rack mit Servern füllen, können wir pro Server eine durchschnittliche Leistung von P <sub>serv</sub> = P <sub>Rack</sub> / S <sub>h</sub> (P <sub>serv</sub> = 6000 W / 21 = 287 W) ausgeben.  Wir ignorieren hier den Stromverbrauch des Schalters. <br><br>  Lassen Sie uns beiseite treten und definieren, wie hoch der maximale Serverstromverbrauch P <sub>max</sub> ist.  Die einfache, absolut sichere und äußerst ineffiziente Methode besteht darin, die Angaben auf dem Etikett auf dem Server-Netzteil zu lesen.  Hier ist P <sub>max</sub> . <br><br>  Ein komplizierterer und effizienterer Ansatz besteht darin, die TDP aller Komponenten zu erfassen und zusammenzufassen.  Es ist nicht genau, aber wir können es so machen. <br><br>  Normalerweise kennen wir die TDP von Komponenten außer der CPU nicht.  Der korrekteste und komplizierteste Ansatz besteht also darin, einen experimentellen, ausreichend konfigurierten Server zu verwenden, ihn beispielsweise über / Linpack / (CPU und Speicher) und / fio / (Festplatten) zu laden und den Stromverbrauch zu messen.  In diesem Fall brauchen wir ein Labor.  Wenn wir die Dinge ernst nehmen, sollten wir im kalten Gang eine warme Umgebung schaffen, da höhere Temperaturen sowohl die Lüfter als auch den CPU-Stromverbrauch beeinflussen.  Somit erhalten wir den maximalen Stromverbrauch des Beispielservers mit dieser speziellen Konfiguration in der aktuellen Umgebung unter der spezifischen Last.  Denken Sie daran, dass eine neue Firmware, Softwareversion und andere Bedingungen das Ergebnis beeinflussen können. <br><br>  <sub>Kehren</sub> wir nun zu P <sub>serv zurück</sub> und wie sollen wir es mit P <sub>max</sub> vergleichen <sub>?</sub>  Es geht darum zu verstehen, wie die Dienste funktionieren und wie stark die Nerven unseres CTO sind. <br><br>  Wenn wir kein Risiko eingehen, sollten wir davon ausgehen, dass alle Server gleichzeitig ihr potenzielles Maximum verbrauchen.  Gleichzeitig kann auch eine der DC-Einspeisungen ausfallen.  Die Infrastruktur sollte den Dienst weiterhin bereitstellen.  Also, P <sub>serv</sub> ≡ P <sub>max</sub> .  Dies ist der Ansatz, bei dem Zuverlässigkeit sehr wichtig ist. <br><br>  Wenn der CIO nicht nur die ideale Sicherheit, sondern auch das Unternehmensgeld berücksichtigt, wenn er mutig genug ist, kann er das entscheiden <br><br><ul><li>  Wir beginnen mit der Verwaltung unserer Lieferanten, insbesondere verbieten wir jede geplante Wartung in den Zeiträumen unserer erwarteten hohen Last, um Stromausfälle zu minimieren </li><li>  und oder unsere Architektur ermöglicht es uns, ein Rack / eine Reihe / einen DC zu verlieren, während die Dienste den Betrieb fortsetzen </li><li>  und oder wir verteilen die Last horizontal so gut auf die Racks, dass unsere Server in einem einzigen Schrank niemals ihr theoretisches Maximum zusammen verbrauchen. </li></ul><br>  Es ist vorteilhaft, hier nicht nur zu raten, sondern auch den Stromverbrauch zu überwachen und zu verstehen, wie Server bei normalen und Spitzenlasten Strom verbrauchen.  So und so nach einiger Analyse bemüht sich der CIO und sagt: <br>  "Ich befehle, dass der maximal erreichbare Durchschnitt des gesamten maximalen Stromverbrauchs des Servers <b>so viel</b> geringer ist als der maximale Stromverbrauch eines einzelnen Servers."  Sei es P <sub>serv</sub> = 0,8 * P <sub>max</sub> <br><br>  Und dann kann ein Rack mit 6 kW nicht 16 Server mit P <sub>max</sub> = 375 W aufnehmen, sondern 20 Server mit P <sub>serv</sub> = 375 W * 0,8 = 300 W.  Dh 25% mehr Server.  Es ist eine Realwirtschaft, weil wir 25% weniger Racks benötigen.  Und wir können Rack-PDUs, Switches und Kabel sparen.  Ein schwerwiegender Nachteil der Lösung ist die Notwendigkeit, kontinuierlich zu überprüfen, ob unsere Annahmen noch gültig sind.  Wir sollten sicherstellen, dass eine neue Firmware den Lüfterbetrieb und den Stromverbrauch nicht wesentlich verändert und dass das Entwicklungsteam die Server nicht wesentlich effizienter nutzt (dies bedeutet, dass es ihnen gelungen ist, die Auslastung und den Stromverbrauch zu erhöhen).  Dann werden sowohl anfängliche Annahmen als auch Schlussfolgerungen falsch.  Es ist also das Risiko, verantwortungsbewusst akzeptiert zu werden.  Oder das Risiko kann vermieden werden und das Unternehmen zahlt für offensichtlich unterlastete Racks. <br><br>  Ein wichtiger Hinweis: Es lohnt sich, wenn möglich zu versuchen, verschiedene Serviceserver horizontal auf die Racks zu verteilen.  Es ist erforderlich, Fälle zu vermeiden, in denen eine Reihe von Servern für den Service eintrifft und vertikal in Schränke installiert wird, um die "Dichte" zu verbessern (nur weil dies auf diese Weise einfacher ist).  Dies führt in der Tat dazu, dass ein Rack mit denselben Servern mit geringer Last gefüllt ist, während sich alle hoch belasteten Server in einem anderen befinden.  Wenn das Lastprofil das gleiche ist und alle Server aufgrund der hohen Last gleichzeitig gleich viel verbrauchen, ist die Wahrscheinlichkeit, das zweite Rack zu verlieren, viel höher. <br><br>  Kommen wir zurück zur Serververteilung in den Racks.  Wir haben physische Einschränkungen in den Schränken und Leistungsbeschränkungen berücksichtigt.  Betrachten wir nun das Netzwerk.  Man kann N = 24/32/48-Port-Switches verwenden (vorausgesetzt, 48-Port-ToR-Switches).  Glücklicherweise gibt es nicht so viele Optionen, wenn wir Breakout-Kabel ignorieren.  Wir betrachten Optionen eines Schalters in jedem einzelnen Rack, eines Schalters pro zwei oder pro drei Schränke pro Gruppe (R- <sub>Netz</sub> ).  Ich glaube, dass die Gruppe nicht drei sein sollte.  Andernfalls kommt es zu Verkabelungsproblemen. <br><br>  Daher verteilen wir Server für jedes Netzwerkszenario auf die Racks (1, 2 oder 3 Racks pro Gruppe): <br><br>  S <sub>Rack</sub> = min (S <sub>h</sub> , Abrundung (P <sub>Rack</sub> / P <sub>Serv</sub> ), Abrundung (N / R <sub>netto</sub> )) <br><br>  Somit ist eine Gruppe von zwei Racks Szenario <br><br>  S <sub>Rack</sub> <sup>2</sup> = min (21, Rounddown (6000/300), Rounddown (48/2)) = min (21, 20, 24) = 20 Server pro Rack <br><br>  Ebenso zählen wir die anderen Szenarien: <br><br>  S <sub>Rack</sub> <sup>1</sup> = 20 <br><br>  S <sub>Rack</sub> <sup>3</sup> = 16 <br><br>  Wir sind fast fertig.  Wir sollten die Gesamtanzahl der Racks zählen, um alle Server S zu verteilen (es sollen 1000 Server vorhanden sein): <br><br>  R = Aufrundung (S / (S- <sub>Rack</sub> * R- <sub>Netz</sub> )) * R- <sub>Netz</sub> <br><br>  R <sub>1</sub> = Aufrundung (1000 / (20 * 1)) * 1 = 50 * 1 = 50 Racks <br><br>  R <sub>2</sub> = Aufrundung (1000 / (20 * 2)) * 2 = 25 * 2 = 50 Racks <br><br>  R <sub>2</sub> = Aufrundung (1000 / (16 * 3)) * 3 = 21 * 3 = 63 Racks <br><br>  Dann sollten wir die Gesamtbetriebskosten für jede Option basierend auf der Anzahl der Racks, der erforderlichen Switches, der Verkabelung usw. zählen.  Wir wählen das Szenario mit den niedrigsten Gesamtbetriebskosten.  Gewinn! <br><br>  Bitte beachten Sie, dass die Anzahl der Racks für Szenario 1 und 2 zwar gleich ist, die Gesamtbetriebskosten jedoch aufgrund der doppelt so geringen Anzahl von Schaltern und längeren Kabeln für das zweite Szenario unterschiedlich sind. <br><br>  PS Wenn die Leistung pro Rack oder Rackhöhe variieren kann, steigt die Variabilität.  Die Auswahl kann jedoch durch Brute-Force-Optionen auf die oben beschriebene Methode reduziert werden.  Es wird mehr Szenarien geben, aber ihre Anzahl wird begrenzt sein.  Wir können die Leistung pro Rack in Schritten von 1 kW erhöhen, und es gibt eine begrenzte Anzahl von Standard-Rack-Typen: 42U, 45U, 47U, 48U.  Es kann hilfreich sein, die Was-wäre-wenn-Analyse von Excel im Datentabellenmodus zu verwenden.  Wir sollten uns die resultierende Tabelle ansehen und die beste Option auswählen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de473988/">https://habr.com/ru/post/de473988/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de473978/index.html">Solche Schmerzen, solche Schmerzen, Registrierkasse als Dienstleistung 2: 0</a></li>
<li><a href="../de473980/index.html">Technologie und die reale Welt: 4 Start-ups, die die Zukunft der Innenarchitektur verändern</a></li>
<li><a href="../de473982/index.html">NB-IoT: Wie funktioniert es? Teil 3: SCEF - ein einziges Zugriffsfenster auf Betreiberdienste</a></li>
<li><a href="../de473984/index.html">Data Science Digest (Oktober 2019)</a></li>
<li><a href="../de473986/index.html">„Mein Traum ist es, eine Person durch die Bäume zu sehen“ - Gründerin von Lisa Alert über moderne Suchtechnologien</a></li>
<li><a href="../de473990/index.html">Lerne OpenGL. Lektion 7.2 - Zeichnen von Text</a></li>
<li><a href="../de473992/index.html">Überblick über moderne Protokolle in industriellen Automatisierungssystemen</a></li>
<li><a href="../de473994/index.html">Modernes Skriptladen</a></li>
<li><a href="../de473998/index.html">Niederlande oder hin und zurück</a></li>
<li><a href="../de474000/index.html">IQBX - elektromechanischer Designer für Kreise und Heimwerker [Konzeptidee]</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>