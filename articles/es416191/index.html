<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>游딭 游끦游낖 游뱜游낖 Implementaci칩n de bajo nivel del 치rbol de prefijos trie en PHP 游뱞游낕 游빁游낖 游붆</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr칩logo 
 La implementaci칩n de PHP trie descrita aqu칤 hace que el diccionario sea demasiado pesado hasta ahora, lo que en consecuencia lleva bastante ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Implementaci칩n de bajo nivel del 치rbol de prefijos trie en PHP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416191/"><h2>  Pr칩logo </h2><br>  La implementaci칩n de PHP trie descrita aqu칤 hace que el diccionario sea demasiado pesado hasta ahora, lo que en consecuencia lleva bastante tiempo cargarlo en la memoria, lo que nivela la bastante buena velocidad de su trabajo.  La velocidad de b칰squeda es de ~ 80 mil palabras por segundo.  El diccionario est치 hecho de la lista de lemas del diccionario opencorpora.org e incluye 389844 palabras.  En forma no comprimida, el diccionario pesa ~ 150mb, y gzip comprimido ~ 6mb.  Sin embargo, los resultados de rendimiento bastante buenos demuestran que en PHP puro puedes hacer un 치rbol de prefijos trie completamente funcional. <br><a name="habracut"></a><br>  Les pido a los programadores con anticipaci칩n que hagan cr칤ticas literarias que no escriban comentarios maliciosos.  Este art칤culo deber칤a ser interesante para principiantes, como yo mismo.  Demasiado perezoso para leer, puede ver inmediatamente el c칩digo en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github</a> . <br><br><h2>  Como empez칩 todo </h2><br>  Durante bastante tiempo, he estado tramando la idea de escribir un analizador morfol칩gico para mis proyectos PHP, que podr치 realizar r치pidamente un an치lisis morfol칩gico de palabras dadas, as칤 como transformar palabras en la forma morfol칩gica deseada. <br><br>  PHP ya tiene una biblioteca similar llamada phpmorhy.  Funciona bastante r치pido y lo usar칤a y no inventar칤a nada, pero el compilador del diccionario est치 hecho como una aplicaci칩n separada que no es PHP, lo que me hace imposible usar esta biblioteca.  La biblioteca en s칤 est치 construida sobre la base del tan esperado diccionario AOT, lo que reduce a칰n m치s su utilidad. <br><br>  Pasaron semanas y meses, le칤 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un art칤culo de</a> Khabrovchanin, luego <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un art칤culo de</a> I. Segalovich sobre un algoritmo morfol칩gico r치pido para un motor de b칰squeda, y luego un mont칩n de art칤culos diferentes. <br><br>  Poco a poco, he madurado para escribir mi propio <s>lunapark con blackjack y los huesos de un</s> analizador morfol칩gico.  Pienso: " <i>Bueno, el progreso ha avanzado, 춰en PHP ya puedes analizar el genoma humano!</i> " <br><br>  Tom칠 el diccionario opencorpora.org, lo puse en mysql y obtuve una velocidad de b칰squeda de 2 mil palabras por segundo.  Creo que es necesario cargar el diccionario en la memoria.  Y aqu칤 resulta que para tener estructuras de datos regulares disponibles en PHP, como una matriz o un objeto, debe almacenar aproximadamente 3 GB de RAM para un diccionario de 3 millones.  Todas las implementaciones de php trie que se me ocurrieron solo eran adecuadas como un tutorial para demostrar la l칩gica del trabajo, ya que ellas mismas se construyeron sobre estructuras de almacenamiento de datos PHP nativas. <br><br><h2>  Dispositivo de almacenamiento de diccionario y principio de funcionamiento </h2><br>  Siempre que pude leer, escuchar o mirar sobre el 치rbol de prefijos de trie, no se explica exactamente c칩mo se almacenar치n los datos en la memoria.  Aqu칤 tenemos el nodo, y aqu칤 est치n sus herederos, y aqu칤 est치 la bandera del final de la palabra, que no se muestra debajo del cap칩.  Por lo tanto, tuve que inventar un m칠todo de almacenamiento yo mismo. <br><br>  Como sabes, el 치rbol de prefijos trie consta de nodos.  Un nodo almacena un prefijo, enlaces a nodos posteriores (descendientes) y un puntero al hecho de que este prefijo es el 칰ltimo en la cadena.  El indio dice bastante inteligiblemente sobre trie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu칤</a> . <br><br>  Los nodos en mi implementaci칩n de trie son bloques de datos de una longitud fija de 154 bytes.  Los primeros 6 bytes (48 bits) contienen la m치scara de bits de los herederos.  Los primeros 46 bits son el alfabeto ruso, los n칰meros, las comillas, el gui칩n y el ap칩strofe.  El ap칩strofe se agreg칩 porque en el diccionario opencorpora.org existe la palabra "cote d'ivoire", que usa el signo del ap칩strofe.  El bit 47 se usa para almacenar el indicador de fin de palabra.  Los 148 bytes que siguen a la m치scara de bits se utilizan para almacenar referencias a los herederos del nodo.  3 bytes por car치cter (46 * 3 = 148). <br><br>  Los nodos se almacenan como datos binarios en una cadena.  El acceso a la secci칩n deseada se lleva a cabo utilizando la funci칩n substr () y el posterior desempaquetado desempaquetado (). <br><br>  El uso de nodos de longitud fija simplifica el proceso de direccionamiento.  Para cambiar al nodo deseado, es suficiente saber su n칰mero de serie (id) y la longitud del nodo.  Multiplicamos el n칰mero de serie por la longitud y descubrimos el desplazamiento relativo al comienzo de la l칤nea; todo es muy simple. <br><br><h4>  fig.  1 esquema de almacenamiento </h4><br><img src="https://habrastorage.org/webt/z_/m8/yg/z_m8yg9qtvtn5niwisxq_tjehsa.png"><br><br><h2>  Desventajas </h2><br>  El esquema de almacenamiento utilizado simplifica el direccionamiento, pero consume espacio.  El almacenamiento de 380 mil palabras requiere poco m치s de un mill칩n de nodos.  154 bytes * 1,000,000 nodos = 146.86 megabytes.  Es decir  aproximadamente 400 bytes por palabra.  Si escribe palabras en un archivo de texto simple codificado en utf8, estas mismas 380 mil palabras pueden caber en 16 megabytes. <br><br><h2>  Planes </h2><br>  Para usar la memoria de manera m치s racional, quiero cambiar a una longitud variable de nodos, luego, como enlace, tendr칠 que registrar no la identificaci칩n del nodo, sino su ubicaci칩n en bytes.  La ubicaci칩n del enlace al nodo deseado se determinar치 de la siguiente manera.  En el ejemplo de la palabra "abv". <br><br>  La letra "a" es la primera en el alfabeto, por lo tanto, su nodo tambi칠n es el primer, respectivamente, desplazamiento 0. Lea 6 bytes, comenzando desde 0. <br><br><pre><code class="php hljs">$str = substr($dic, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>);</code> </pre> <br>  Descomprima la l칤nea: <br><br><pre> <code class="php hljs">$mask = (ord($str[<span class="hljs-number"><span class="hljs-number">5</span></span>]) &lt;&lt; <span class="hljs-number"><span class="hljs-number">40</span></span>) + (ord($str[<span class="hljs-number"><span class="hljs-number">4</span></span>]) &lt;&lt; <span class="hljs-number"><span class="hljs-number">32</span></span>) + (ord($str[<span class="hljs-number"><span class="hljs-number">3</span></span>]) &lt;&lt; <span class="hljs-number"><span class="hljs-number">24</span></span>) + (ord($str[<span class="hljs-number"><span class="hljs-number">2</span></span>]) &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span>) + (ord($str[<span class="hljs-number"><span class="hljs-number">1</span></span>]) &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) + ord($str[<span class="hljs-number"><span class="hljs-number">0</span></span>]);</code> </pre> <br>  Nos fijamos en la m치scara del segundo bit (letra "b") <br><br><pre> <code class="php hljs">bit_get($mask, <span class="hljs-number"><span class="hljs-number">2</span></span>);</code> </pre> <br>  El bit est치 configurado, ahora contamos el n칰mero de bits elevados en la m치scara a 2. Digamos que el bit de la letra "a" tambi칠n se eleva en nuestro nodo, por lo que nuestro bit de la letra "b" ser치 el segundo bit elevado.  Cuenta el desplazamiento para leer el enlace <br><br><pre> <code class="php hljs">$offset = <span class="hljs-number"><span class="hljs-number">6</span></span> + <span class="hljs-number"><span class="hljs-number">3</span></span>;</code> </pre> <br>  M치scara de 6 bytes + 3 bytes, que ocupa el primer enlace, resulta 9 bytes.  Leemos el trozo de cuerda deseado. <br><br><pre> <code class="php hljs">$str = substr($dic, $offset, <span class="hljs-number"><span class="hljs-number">3</span></span>);</code> </pre> <br>  Descomprima el enlace: <br><br><pre> <code class="php hljs">$ref = (ord($str[<span class="hljs-number"><span class="hljs-number">2</span></span>]) &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span>) + (ord($str[<span class="hljs-number"><span class="hljs-number">1</span></span>]) &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) + ord($str[<span class="hljs-number"><span class="hljs-number">0</span></span>]);</code> </pre> <br>  Vaya al siguiente nodo y repita todo nuevamente.  En la 칰ltima carta, verificamos la presencia de 47 bits en la m치scara, si est치 configurada, hay una palabra de b칰squeda en nuestro trie. <br><br>  Espero que sea posible mantener una velocidad de al menos 50 mil palabras por segundo. <br><br><h2>  Agradecimientos </h2><br>  Quiero agradecer a los participantes del foro nulled.cc y php.ru por su ayuda con las funciones bit a bit. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es416191/">https://habr.com/ru/post/es416191/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es416177/index.html">F칩rmula Tupper e implementaci칩n del algoritmo en Python</a></li>
<li><a href="../es416179/index.html">Una puerta que nos saluda por nombre y se abre solo para los empleados del departamento.</a></li>
<li><a href="../es416183/index.html">Prueba de datos: requisitos y niveles</a></li>
<li><a href="../es416187/index.html">Despu칠s de la reuni칩n "Nuevas caracter칤sticas de PostgreSQL 11" (Parte 2)</a></li>
<li><a href="../es416189/index.html">El tratamiento de Scrum "mec치nico". Parte 3. Trabaja SM</a></li>
<li><a href="../es416193/index.html">C칩mo los robots pueden trabajar juntos con humanos (y no en su lugar)</a></li>
<li><a href="../es416195/index.html">Dijkstra para tiempo lineal</a></li>
<li><a href="../es416197/index.html">Los motores para el nuevo programa DARPA pasan con 칠xito las pruebas</a></li>
<li><a href="../es416199/index.html">La sonda Dawn envi칩 tomas detalladas de las manchas blancas de Ceres: esto es refresco ordinario</a></li>
<li><a href="../es416201/index.html">3 geniales juegos de mesa de ciencia ficci칩n en ingl칠s</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>