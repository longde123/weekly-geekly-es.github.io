<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>„Ä∞Ô∏è üè¶ üîª Dos Z80 por m√°quina: ¬øen qu√© se diferencian las m√°quinas recreativas de 8 bits de las computadoras dom√©sticas? üéµ üë∂üèª üß£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lo que aprend√≠ sobre la m√°quina arcade Bomb Jack en el proceso de creaci√≥n de su emulador 


 Recientemente escrib√≠ un peque√±o emulador para una m√°qui...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dos Z80 por m√°quina: ¬øen qu√© se diferencian las m√°quinas recreativas de 8 bits de las computadoras dom√©sticas?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/426291/"><h2>  Lo que aprend√≠ sobre la m√°quina arcade Bomb Jack en el proceso de creaci√≥n de su emulador </h2><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ea/be5/eae/7eabe5eaeb49a7c8a77b543628df89bf.png"></div><br>  Recientemente escrib√≠ un peque√±o emulador para una m√°quina Bomb Jack, principalmente para descubrir c√≥mo estas primeras m√°quinas recreativas de 8 bits difer√≠an en dise√±o de las computadoras dom√©sticas de 8 bits. <br><br>  Como supe mucho m√°s tarde, una reuni√≥n en una feria de verano en mi ciudad natal con m√°quinas recreativas como Bomb Jack fue uno de esos momentos que cambi√≥ mi destino.  En un d√≠a normal de verano, despu√©s de haber gastado todo mi suministro de monedas en m√°quinas recreativas, regres√© a casa y mi cabeza estaba llena de flores y efectos de sonido.  Trat√© de entender c√≥mo funcionaban estos juegos.  Y luego, hasta el final del a√±o, pas√© todo el tiempo despu√©s de la escuela creando copias bastante desva√≠das de estos juegos de arcade en la computadora de mi casa.  Era como un fan√°tico del culto a la carga de las islas del Oc√©ano Pac√≠fico, que quer√≠a crear una estaci√≥n de radio militar estadounidense a partir de palos. <br><br>  Al principio pens√© en la idea de crear un emulador <em>Pengo</em> , porque mi cerebro adolescente estaba mucho m√°s impresionado con este juego que Bomb Jack (por cierto, aqu√≠ est√° mi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">versi√≥n de culto de Pengo</a> ).  Pero el equipo arcade de Pengo requerir√≠a la creaci√≥n de nuevos emuladores de chips para audio y video, y para Bomb Jack hab√≠a suficientes partes que ya ten√≠a (Z80 como CPU y AY-3-8910 para sonido), as√≠ que fui el primero en enfrentarme a Bomb Jack. <br><a name="habracut"></a><br>  Adem√°s, Bomb Jack fue una gran oportunidad para finalmente agregar soporte NMI (interrupci√≥n no enmascarable) a mi emulador Z80.  Ninguna de las m√°quinas basadas en Z80 que emul√© anteriormente usaba NMI y, por lo tanto, no ten√≠a mucho sentido recrear esta funci√≥n. Todav√≠a no pod√≠a verificar su funcionamiento. <br><br>  Si no sabes qu√© es Bomb Jack, entonces este juego se ve√≠a as√≠ (no estoy seguro si eleg√≠ la relaci√≥n de aspecto correcta): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/af7/79a/9ae/af779a9ae761839ee041300bc817c7f6.png" alt="Captura de pantalla de Bomb Jack"></div><br><iframe width="560" height="315" src="https://www.youtube.com/embed/_jJzasm63DE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  La versi√≥n del emulador en WebAssembly se puede encontrar aqu√≠: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://floooh.github.io/tiny8bit/bombjack.html</a> <br><br>  Despu√©s de que se complete el procedimiento de carga y aparezca la tabla de puntaje alto, presione <strong>1</strong> para soltar una moneda y luego <strong>Enter</strong> (o cualquier otra tecla excepto las flechas y la barra espaciadora) para comenzar el juego. <br><br>  Dentro del juego, usa las <strong>teclas de flecha</strong> para cambiar de direcci√≥n y la <strong>barra espaciadora</strong> para saltar.  Mientras est√° en el aire, presione la <strong>barra espaciadora</strong> para frenar la ca√≠da. <br><br>  El c√≥digo fuente est√° aqu√≠: <br><br>  <a href="">https://github.com/floooh/chips-test/blob/master/examples/sokol/bombjack.c</a> <br><br>  Utiliza <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">encabezados de chip</a> para proporcionar la emulaci√≥n de Z80 y AY-3-8910, as√≠ como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">encabezados de sokol</a> como envoltorio multiplataforma (para ingresar a la aplicaci√≥n, renderizado, entrada y sonido). <br><br><h2>  Paso 1: investigaci√≥n </h2><br>  "Investigaci√≥n" es una palabra demasiado grande: acabo de cumplir con las "especificaciones de hardware de la sala de juegos Bombjack" de Google. <br><br>  En comparaci√≥n con las populares computadoras hogare√±as de los 80 (o incluso las misteriosas computadoras de Europa del Este, que a menudo todav√≠a tienen comunidades activas), hay muy poca informaci√≥n sobre Bomb Jack en Internet. <br><br>  Encontr√© dos datos muy importantes: el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">diagrama de circuito de la</a> m√°quina y, por supuesto, el <a href="">c√≥digo fuente del emulador MAME</a> . <br><br>  Tambi√©n hay un proyecto que implementa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Bomb Jack en FGPA</a> , a partir de las fuentes VHDL de las cuales logr√© encontrar detalles que no est√°n en el diagrama del circuito. <br><br>  Comprender el c√≥digo fuente MAME ser√≠a complicado, porque los emuladores de m√°quinas recreativas generalmente son solo un mont√≥n de macros que describen c√≥mo interact√∫an varios equipos, pero no <em>hay</em> mucho <em>c√≥digo fuente</em> . <br><br>  Sin embargo, las descripciones macro del equipo, y especialmente los comentarios, a√∫n resultaron ser muy √∫tiles para comprender el funcionamiento del hardware, y cuando se volvieron demasiado cr√≠pticos (por ejemplo, la <a href="">parte de decodificaci√≥n de video</a> ), la prueba y el error fueron suficientes, as√≠ como Estudio detallado del concepto. <br><br><h2>  Descripci√≥n del hardware </h2><br>  Lo m√°s interesante del hardware de Bomb Jack es que en realidad son <strong>dos computadoras</strong> conectadas entre s√≠ por una cinta el√©ctrica: hay una <strong>placa principal</strong> con CPU Z80 y equipo de decodificaci√≥n de video y una <strong>tarjeta de sonido</strong> separada con su propia CPU Z80 y tres (s√≠, tres!) chips de sonido AY-3-8910. <br><br>  El equipo de decodificaci√≥n de video no se implementa como un circuito integrado: son solo muchos peque√±os chips de prop√≥sito general (su circuito toma 6 de 10 p√°ginas del diagrama del circuito del dispositivo).  Al crear un emulador, decid√≠ tomar un camino corto: en lugar de emular ciertas partes del equipo de decodificaci√≥n de video, emul√© solo su comportamiento, creando la salida correspondiente a partir de los datos de entrada y sin preocuparme realmente por c√≥mo funciona el equipo en el medio. <br><br>  Tal soluci√≥n simplificada es bastante adecuada para una m√°quina arcade separada, que est√° dise√±ada para ejecutar solo un programa.  Si el juego comienza y funciona correctamente, entonces la emulaci√≥n puede considerarse "suficientemente buena". <br><br>  Adem√°s, este enfoque simplificado es una diferencia importante de la emulaci√≥n de la mayor√≠a de las computadoras dom√©sticas: algunos juegos requieren una emulaci√≥n m√°s precisa que otros, por ejemplo, m√°quinas como C64 o Amstrad CPC necesitan una emulaci√≥n muy precisa hasta ciclos de reloj, de modo que los sistemas de video de algunos juegos y gr√°ficos demos funcion√≥ correctamente. <br><br>  Tambi√©n significa que mis emuladores de chip de sonido y CPU ya hechos son en realidad un trabajo superfluo para Bomb Jack, por ejemplo, trabajar con CPU Z80 con la implementaci√≥n de la fraccionalidad del ciclo de la m√°quina es excesivo, ser√≠a suficiente una fragmentaci√≥n m√°s simple y m√°s r√°pida en el nivel de instrucci√≥n. <br><br><h2>  Tablero principal </h2><br>  Por lo general, lo primero que trato de descubrir al escribir un nuevo emulador es el esquema de asignaci√≥n de memoria (donde est√°n las √°reas de ROM y RAM, memoria de video y direcciones especiales o puertos de entrada / salida). <br><br>  Solo hay un chip "interesante" en la placa principal de Bomb Jack: la CPU Z80 que funciona a 4 MHz.  Todo el espacio restante en la placa principal est√° ocupado por un equipo de decodificaci√≥n de video (con la excepci√≥n de un par de chips RAM y ROM). <br><br>  El espacio de direcciones de 16 bits es el siguiente: <br><br><ul><li>  <strong>0000..7FFF</strong> : 32 KB ROM </li><li>  <strong>8000..8FFF</strong> : 4 KB de RAM de uso general </li><li>  <strong>9000..93FF</strong> : 1 KB de memoria de video </li><li>  <strong>9400..97FF</strong> : 1 KB de RAM de color </li><li>  <strong>9820..987F</strong> : 96 bytes de sprite RAM </li><li>  <strong>9C00..9CFF</strong> : 256 bytes de paleta de colores RAM </li><li>  <strong>9E00, B000..B005, B800</strong> : puertos de entrada-salida </li><li>  <strong>C000..DFFF</strong> : ROM de 8 <strong>KB</strong> </li></ul><br>  El √°rea del puerto de E / S es la siguiente.  Algunos puertos son de solo escritura, algunos son de solo lectura y algunos tienen diferentes funciones al leer y escribir en ellos: <br><br><ul><li>  <strong>9E00</strong> : escribir: n√∫mero de imagen de fondo actual, leer: - </li><li>  <strong>B000</strong> : lectura: estado del joystick del jugador 1, escritura: activar / desactivar m√°scara NMI </li><li>  <strong>B001</strong> : leer: estado del joystick del jugador 2, escribir: - </li><li>  <strong>B002</strong> : leer: monedas y botones de Inicio, escribir: - </li><li>  <strong>B003</strong> : leer: CPU watchdog, escribir: ??? </li><li>  <strong>B004</strong> : lectura: interruptores DIP 1, escritura: pantalla de interruptores </li><li>  <strong>B005</strong> : lectura: interruptores DIP 2, escritura: - </li><li>  <strong>B800</strong> : escribir: tarjeta de sonido de comando, leer: - </li></ul><br>  Vale la pena mencionar lo siguiente: <br><br><ul><li>  El dispositivo tiene MUCHA ROM (40 Kbytes) y muy poca RAM (aproximadamente 7 Kbytes, y solo 4 Kbytes de ellos son "RAM de uso general") </li><li>  Solo se asignan 2 Kbytes para la RAM de la pantalla, divididos en dos fragmentos de 1 Kbyte, lo que parece muy peque√±o para una pantalla a todo color de 256x256, en la que, al parecer, los colores se configuran p√≠xel por p√≠xel </li><li>  ¬°Este es un sistema de E / S en un esquema de asignaci√≥n de memoria! </li></ul><br>  La E / S en el esquema de asignaci√≥n de memoria es un poco inusual para una m√°quina Z80, porque una de las caracter√≠sticas del Z80 es su espacio separado de direcciones de 16 bits para E / S.  Esto se hace para ahorrar valioso espacio de direcciones de memoria.  La E / S en un esquema de asignaci√≥n de memoria generalmente se encuentra en computadoras con un procesador 6502. <br><br>  Una mirada al diagrama de circuito confirma esto: el pin IORQ no se detecta en la CPU de la placa principal, solo el pin MREQ est√° conectado (que se usa para inicializar la lectura o escritura en la memoria): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a58/99e/3d8/a5899e3d8384702517d0c7fe6c0de436.png" alt="Bomb Jack IORQ"></div><br>  Esto significa que no tenemos que preocuparnos por las solicitudes de E / S para la funci√≥n del temporizador de la CPU de la placa principal en el emulador, sino que solo nos ocupamos de las solicitudes de memoria. <br><br>  Despu√©s de estudiar el diagrama del circuito, encontr√© otro detalle interesante sobre la CPU de la placa principal: <br><br>  Solo el pin NMI est√° conectado, mientras que el pin INT siempre mantiene un alto nivel de se√±al de reloj / permanece inactivo (esto significa que las interrupciones enmascaradas "habituales" no se ejecutan y solo se producen interrupciones sin enmascarar): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/393/acf/cb8/393acfcb88d846cc868e2fa0e490fbbd.png" alt="Bomb Jack IORQ"></div><br>  Esto tambi√©n es bastante inusual para un autom√≥vil con el Z80.  En todas las computadoras hogare√±as basadas en Z80 con las que sol√≠a lidiar, suced√≠a lo contrario: solo usaban interrupciones enmascarables y nunca usaban no enmascarables.  La interrupci√≥n enmascarada Z80 es una mejora muy flexible y seria en comparaci√≥n con el sistema de interrupci√≥n primitivo de su "padre ileg√≠timo" - Intel 8080, o su competidor - MOS 6502. Pero esta mayor flexibilidad tambi√©n es m√°s dif√≠cil de implementar en el equipo (a menos que sea una fuente de interrupciones se utilizan otros chips de la familia Z80, en los que ya hay un protocolo de interrupci√≥n complejo incorporado cuando se conecta por bus). <br><br>  Bueno, suficientes detalles sobre el equipo, ¬°pasemos al emulador! <br><br><h2>  Procedimiento de arranque </h2><br>  El siguiente paso despu√©s de determinar la configuraci√≥n de la memoria es conectar la CPU emulada al esquema de asignaci√≥n de memoria emulada, registrar alg√∫n tipo de visualizaci√≥n del contenido de la memoria de video e iniciar los ciclos de la CPU. <br><br>  Sorprendentemente, un enfoque tan tosco a menudo es suficiente para pasar por el procedimiento de carga y mostrar <em>algo</em> en la pantalla.  Al dise√±ar el emulador Bomb Jack, tom√© el contenido de la memoria de video de 1 KB en el rango de 0x9000 a 0x93FF como una matriz de bytes de 32x32.  Cuando el byte era 0, renderic√© un bloque de p√≠xeles negros de 8x8 y, de lo contrario, un bloque de p√≠xeles blancos. <br><br>  Luego simplemente ejecut√© la CPU emulada y esper√© lo mejor.  He aqu√≠!  Apareci√≥ una especie de imagen legible: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/17d/7c2/198/17d7c2198881dbfd40978e26d832aaca.png" alt="Bota jack bomba 1"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d3b/e04/b97/d3be04b970ff2c8b5905ed3f7f757a51.png" alt="Bota jack bomba 2"></div><br>  La imagen superior se ve como una pantalla de prueba de hardware en el arranque, y la inferior se ve como una pantalla de registro de puntaje que aparece despu√©s de completar el procedimiento de arranque: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0f6/5ae/4b9/0f65ae4b9d00fa43e2da7582b9ceb5f3.png" alt="Bomba jack boot 3"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/649/5c8/db1/6495c8db1d035484ef03e32902f28cdf.png" alt="Bota jack bomba 4"></div><br>  ... pero rot√≥ 90 grados (lo cual es l√≥gico, porque la pantalla de las m√°quinas recreativas a menudo ten√≠a una orientaci√≥n vertical "vertical"). <br><br>  ¬°Genial, el comienzo es prometedor! <br><br>  El siguiente paso es descubrir c√≥mo convertir estos bloques blancos en p√≠xeles de color ... (y este es un gran paso, los detalles se describen a continuaci√≥n en la secci√≥n sobre decodificaci√≥n de video). <br><br>  Al principio, todo fue bastante r√°pido, en la pantalla de prueba, se mostraron p√≠xeles y colores durante la carga (luego not√© que la decodificaci√≥n del color era completamente incorrecta, y sin embargo ...) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2c3/ecd/757/2c3ecd757e603194698f6f93b71e3127.png" alt="Bota bomba jack 5"></div><br>  Pero cuando apareci√≥ la pantalla de grabaci√≥n, obtuve una pantalla negra.  Al piratear el color de fondo para que "no sea negro", descubr√≠ que los p√≠xeles se representan, pero toda la paleta de colores es negra.  Hmm ... <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e81/dac/2e4/e81dac2e4796b7bf90d43a711a52f37e.png" alt="Bota bomba jack 5"></div><br>  Despu√©s de mirar esta pantalla durante un par de minutos, record√© que algunos de los colores en la pantalla de puntuaci√≥n m√°s alta est√°n animados, y cuando hay animaci√≥n, deber√≠a haber alg√∫n tipo de temporizador.  La fuente l√≥gica de tiempo en la configuraci√≥n de este equipo es la se√±al de visualizaci√≥n VSYNC, y VSYNC est√° conectado al pin NMI de la CPU (o m√°s bien, no VSYNC, sino VBLANK, que es el breve momento entre la se√±al VSYNC y el haz de rayos cat√≥dicos que se mueve hacia la esquina superior izquierda). <br><br>  Y todav√≠a no he implementado todo esto ... <br><br>  La noche siguiente, cuando agregu√© la primera versi√≥n del procesamiento NMI a la emulaci√≥n Z80 y la conect√© al primer contador vsync / vblank en la funci√≥n de temporizador de la CPU de la placa principal, ¬°de repente comenzaron a suceder muchas cosas! <br><br>  En primer lugar, aparecieron colores en la pantalla de registros, y algunos de ellos estaban animados: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/163/661/72d/16366172d4eb6b8e2342acbbd74a64ac.png" alt="Bomb Jack NMI 1"></div><br>  ¬°Despu√©s de unos segundos, comenz√≥ algo a√∫n m√°s emocionante!  La puntuaci√≥n m√°s alta desapareci√≥ y se mostr√≥ una extra√±a visualizaci√≥n del primer mapa.  Estaba claro que este es un modo de demostraci√≥n de una m√°quina arcade para llamar la atenci√≥n: vi varias bombas con animaciones en color que desaparecieron cuando una bomba Jack imaginaria salt√≥ sobre un mapa recogiendo estas bombas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d60/cd6/81d/d60cd681dedbdfbf4329410e0014f9f0.png" alt="Bomb Jack NMI 2"></div><br>  Los colores todav√≠a estaban completamente equivocados, ¬°y sin embargo es PROGRESO! <br><br>  Es el momento adecuado para hacer el resto de la decodificaci√≥n de video: <br><br><h2>  Plancha de video </h2><br>  A primera vista, el equipo de procesamiento de video en Bomb Jack parec√≠a muy potente para una m√°quina de 8 bits de 1984: a pesar de la resoluci√≥n de solo 256x256 p√≠xeles, pod√≠a mostrar simult√°neamente 128 (de 4096) colores y renderizar hasta 24 sprites de hardware (tama√±o 16x16) o 32x32) con p√≠xel por p√≠xel de color. <br><br>  Las computadoras dom√©sticas de 8 bits de la √©poca ten√≠an aproximadamente la misma resoluci√≥n de pantalla, pero ten√≠an muchas restricciones de color.  Estas restricciones son claramente visibles cuando se comparan las versiones de Bomb Jack para ZX Spectrum y Amstrad CPC con la versi√≥n para la m√°quina arcade: <br><br>  La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">versi√≥n para el ZX Spectrum</a> ten√≠a una resoluci√≥n de p√≠xeles bastante buena (256x192), pero muy pocos colores, y sufr√≠a el t√≠pico efecto de "conflicto de color" de Spectrum (aunque los desarrolladores hicieron todo lo posible para que esto no fuera tan notable): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/46d/176/fff/46d176fffb8404ad696883849dd880d1.png" alt="Bomba jack zx"></div><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">La versi√≥n para Amstrad CPC es</a> m√°s a todo color, pero para obtener m√°s colores, los desarrolladores tuvieron que cambiar al modo de visualizaci√≥n de baja resoluci√≥n (160x200).  Como resultado de esto, Jack y los monstruos se convirtieron en un mont√≥n ilegible de p√≠xeles: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bbd/f33/3d8/bbdf333d8e4d8d44735047f99e53b49c.png" alt="Bomba jack cpc"></div><br>  Compare esto con la versi√≥n para la m√°quina arcade, que ten√≠a la misma resoluci√≥n de p√≠xeles que el ZX Spectrum, pero con muchos m√°s colores <em>y</em> mayor resoluci√≥n de color de p√≠xel a p√≠xel: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/112/ac5/69f/112ac569f11f32d6c1ed4836bb8c2b51.png" alt="Arcade de bomba jack"></div><br>  Lo interesante aqu√≠ es que la versi√≥n arcade tiene mejores gr√°ficos, no porque funcione en hardware m√°s potente (tiene m√°s ROM para almacenar m√°s datos gr√°ficos, pero la "potencia inform√°tica" es casi la misma), sino porque los desarrolladores del dispositivo podr√≠an enfocarse en la fabricaci√≥n de una m√°quina especializada para un tipo espec√≠fico de juego y no necesitaban crear una computadora dom√©stica universal para uso general. <br><br>  As√≠ es como funciona el hardware de la pantalla (al menos en mi interpretaci√≥n de alto nivel): <br><br><h2>  Tres capas de pantalla </h2><br>  La se√±al de video final de Bomb Jack se combina a partir de tres capas: una capa de fondo, una capa frontal y una capa de sprite. <br><br>  Tal sistema de capas tiene dos ventajas principales: <br><br><ul><li>  Implementa una compresi√≥n de imagen de hardware bastante complicada para generar una imagen a todo color de "alta resoluci√≥n" a partir de una cantidad muy peque√±a de datos. </li><li>  Reduce significativamente la cantidad de trabajo de la CPU necesaria para actualizar los elementos din√°micos de la pantalla (incluso a una frecuencia de 4 MHz, una CPU de 8 bits no tiene suficiente potencia para mover tantos objetos en una pantalla de 256x256 con una frecuencia de 60 Hz) </li></ul><br>  La plancha de video es bastante diferente de lo que vi en las computadoras hogare√±as de 8 bits, pero en MAME se implementan clases auxiliares generalizadas para este tipo de equipo, por lo que puedo suponer que es bastante com√∫n en las m√°quinas recreativas. <br><br><h3>  Capa de fondo </h3><br>  La capa de fondo puede representar 1 de 5 im√°genes de fondo incrustadas en ROM.  La imagen de fondo se selecciona escribiendo un valor del 1 al 5 en la direcci√≥n 0x9E00 (parece que el valor 0 es especial y muestra un fondo completamente negro). <br><br>  De hecho, parece que el equipo es capaz de reproducir 7 im√°genes diferentes, pero solo se usan 5 en el juego. Secretamente, esperaba encontrar datos de im√°genes previamente no detectados en la ROM.  Pero, por desgracia, no est√°n all√≠ (s√≠, probablemente no soy el primero en buscarlos all√≠). <br><br>  As√≠ es como se ve la capa de fondo del primer mapa sin las otras dos capas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/afe/75a/2c7/afe75a2c7386bb48fb3e90e2a24a655e.png" alt="Fondo de gato bomba"></div><br>  La capa de fondo se ensambla a partir de mosaicos de <strong>16x16</strong> p√≠xeles. <br><br>  La ventaja de crear im√°genes de fondo a partir de mosaicos es que los mismos mosaicos se pueden usar varias veces, por lo que se pueden almacenar menos datos en la ROM.  Tenga en cuenta que el cielo azul, partes de la pir√°mide y la arena debajo de la pir√°mide usan los mismos mosaicos: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/422/613/0ee/4226130ee4b597ccbeccebbce664dbdf.png" alt="Azulejos de fondo de jack de bomba"></div><br>  Para ahorrar memoria, el equipo de la capa de fondo implementa otro truco: los mosaicos se pueden girar horizontalmente.  Casi me perd√≠ esto en mi implementaci√≥n porque supuse que el software no usa esta funci√≥n de hardware, pero not√© un peque√±o error en el fondo de la tercera tarjeta: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/22d/397/d5c/22d397d5c5b984b8a7b1e7c53e5abd34.png" alt="Bomba jack fondo 3"></div><br>  Utilic√© el mismo truco en el quinto mapa, pero aqu√≠ es un poco m√°s dif√≠cil de notar si no sabes qu√© buscar: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4af/82d/430/4af82d430deab8804a795ac9fb142b87.png" alt="Bomba jack fondo 5"></div><br><br><h3>  Capa frontal: </h3><br>  Sobre la capa de fondo se encuentra la "capa frontal", que representa todas las partes fijas de la pantalla, que sin embargo deben ser actualizadas por la CPU (principalmente texto, plataformas y bombas).  El dise√±o se lee desde la RAM (a partir de fragmentos de RAM de 1 KB y RAM de color de 1 KB). <br><br>  As√≠ es como se ve la capa frontal aislada del primer mapa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/874/5ac/fa8/8745acfa89c446ba9b5a9d9e719c8d31.png" alt="Primer plano de jack de bomba"></div><br>  La capa frontal tambi√©n consta de mosaicos (as√≠ como el fondo), pero utiliza mosaicos m√°s peque√±os de 8x8: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a9/e26/f94/5a9e26f94d1d9e0df0f50f4f1d1beb78.png" alt="Azulejos de fondo de jack de bomba"></div><br>  La principal ventaja de dividir el fondo y el frente en capas separadas es que la CPU no necesita preocuparse por almacenar y restaurar p√≠xeles de fondo al crear o eliminar elementos frontales. <br><br><h3>  Capa de sprite </h3><br>  Finalmente, los sprites de hardware se representan sobre la capa frontal.  Todo lo que se mueve por la pantalla se implementa en sprites.  El equipo de Bomb Jack puede generar hasta 24 sprites, y cada sprite puede tener un tama√±o de 16x16 o 32x32 p√≠xeles.  En este caso, los sprites se pueden colocar con precisi√≥n de p√≠xel a p√≠xel: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/276/66e/5a0/27666e5a0a266d28babf72dafe2e66bc.png" alt="Sprites de bomba jack"></div><br><br><h2>  Decodificador de azulejos 8x8 </h2><br>  En el coraz√≥n del equipo de decodificaci√≥n de video hay una paleta de colores con 128 elementos y un decodificador de mosaico de 8x8 p√≠xeles.  La tarea del decodificador de mosaico es generar un √≠ndice de paleta de colores de 7 bits para cada uno de los 64 p√≠xeles del mosaico. <br><br>    8x8        ‚Äî   16x16,    8x8    16x16  32x32. <br><br>  -    8x8     (,    ): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e79/d6e/5d9/e79d6e5d9b5019923a37bc14658e8ec4.jpg" alt="Bomb Jack Tile Decoding"></div><br>  -  : <br><br><ul><li>          ¬´ ¬ª   (   32x32  )       (  32x32).            ,    ,      .    8x8        . </li><li>             .         (         ).         ,       ,    (       ). </li><li>       8   ,     8  (   ).            ,  ,       8x8  24    (3   ). </li><li>    64    7- .  3         ,   4  ‚Äî    .  ,  ,           16 ¬´¬ª,     8 .        8     . </li><li>  7- ,        ,    12-  RGB-    (4    ).            (  ,  ,       ;   ,          ). </li></ul><br>     ,       ,      : <br><br><ul><li>        512   8x8.    9-  ,     8   .   ¬´¬ª      (         4   ,   4    ).   3      8x8  ,     ,    ¬´¬ª  . </li><li>      16x16,     16x16=256     256           (512   ).    ,     16x16      8x8,        .   ,      ;      ¬´¬ª   :   7   ,    . </li><li>       16x16   32x32 ,       4  16   8x8    .  ,    16x16  96 ,    32x32 ‚Äî    384    .       ,   3      ,    . </li></ul><br>   ,     ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  C</a> ,      PNG (3      8   ). <br><br>      .       ,  ,  ( ),     Bomb Jack,    ,       (,    90 ,      ): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/681/ca4/fec/681ca4fec37418dffeb4d601b9e787cf.png" alt="Bomb Jack Foreground Tile ROM"></div><br>     .     ,           16x16   8x8.   16x16      8x8.         2,    3     4. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ebc/fa9/86d/ebcfa986da9add0a45acc02b54bcb69e.png" alt="Bomb Jack Background Tile ROM"></div><br> , ,   .  16x16   ,   32x32 ‚Äî . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/444/974/01e/44497401e4d25c7915f1c15c9fb9f4ac.png" alt="Bomb Jack Sprite Tile ROM"></div><br>     Bomb Jack   ,        . ,       ,       : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/939/bd5/b69/939bd5b6999622ee26e337f033087234.png" alt="Bomb Jack Splash 1"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d9/fef/f2a/6d9feff2acdd4ee2aaa63b8dc4226692.png" alt="Bomb Jack Splash 2"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/819/bb9/072/819bb90727322463b2c8a9196f6f74c2.png" alt="Bomb Jack Splash 3"></div><br><h2>   </h2><br>   Bomb Jack      ,       : <br><br><ul><li>     24  . ,          . </li><li>     16x16   32x32  </li><li>       16   8      </li><li>     . </li><li>          </li><li>       128     . </li></ul><br>             8x8,       . <br><br>        0x9820  0x987F ‚Äî 96 ,  4   .   ,     ;   ,          . <br><br>    4 : <br><br><ul><li> <strong> 0</strong> : <br><ul><li> <strong> 7</strong> :  ,     32x32,     16x16 </li><li> <strong> 6..0</strong> : 7      ,          . </li></ul></li><li> <strong> 1</strong> : <br><ul><li> <strong> 7</strong> :  ,      </li><li> <strong> 6</strong> :  ,     </li><li> <strong> 3..0</strong> : 4         </li></ul><br></li><li> <strong> 2</strong> :       X </li><li> <strong>Byte 3</strong> :       Y </li></ul><br>  No est√° claro qu√© hacen los bits 4 y 5 del byte 1, el comentario en MAME dice esto: <br><br> <code>e ? (,    ) <br> f ? (,     (B)?)</code> <br> <br><h2>  Puertos de E / S de memoria </h2><br>  Algunas notas sobre los puertos de entrada / salida de la placa principal.  Como se indic√≥ anteriormente, los puertos de E / S se ven as√≠: <br><br><ul><li>  <strong>9E00</strong> : escribir: n√∫mero de imagen de fondo actual, leer: - </li><li>  <strong>B000</strong> : lectura: estado del joystick del jugador 1, escritura: activar / desactivar m√°scara NMI </li><li>  <strong>B001</strong> : leer: estado del joystick del jugador 2, escribir: - </li><li>  <strong>B002</strong> : leer: monedas y botones de Inicio, escribir: - </li><li>  <strong>B003</strong> : leer: CPU watchdog, escribir: ??? </li><li>  <strong>B004</strong> : lectura: interruptores DIP 1, escritura: pantalla de interruptores </li><li>  <strong>B005</strong> : lectura: interruptores DIP 2, escritura: - </li><li>  <strong>B800</strong> : escribir: tarjeta de sonido de comando, leer: - </li></ul><br>  La direcci√≥n 0x9E00 (selecci√≥n de la imagen de fondo) que ya hemos considerado anteriormente, y la direcci√≥n 0xB800 (tarjeta de sonido de comando) que consideraremos en la siguiente secci√≥n.  Sigue siendo las direcciones de 0xB000 a 0xB005: <br><br>  La lectura de las direcciones 0xB000 y 0xB001 devuelve el estado actual de los dos joysticks.  Los bytes establecidos indican interruptores de joystick cerrados: <br><br><ul><li>  <strong>bit 0</strong> : direcci√≥n correcta </li><li>  <strong>bit 1</strong> : direcci√≥n izquierda </li><li>  <strong>bit 2</strong> : hacia arriba </li><li>  <strong>bit 3</strong> : direcci√≥n hacia abajo </li><li>  <strong>bit 4</strong> : bot√≥n de salto presionado </li></ul><br>  Los 3 bits restantes se ignoran. <br><br>  La lectura de 0xB002 devuelve el estado del aceptador de monedas y los botones de Inicio: <br><br><ul><li>  <strong>bit 0</strong> : se lanza la moneda del jugador 1 </li><li>  <strong>bit 1</strong> : se lanza la moneda del jugador 2 </li><li>  <strong>bit 2</strong> : bot√≥n de inicio del jugador 1 </li><li>  <strong>bit 3</strong> : bot√≥n de inicio del jugador 2 </li></ul><br>  La lectura de las direcciones 0xB004 y 0xB005 devuelve el estado de los interruptores DIP que se utilizan para configurar el comportamiento de la m√°quina arcade: <br><br><ul><li>  <strong>B004</strong> : <br><ul><li>  <strong>bits 0,1</strong> : cu√°ntos "juegos" se dan para una moneda (1, 2, 3 o 5) </li><li>  <strong>bits 2,3</strong> : lo mismo para el jugador 2 </li><li>  <strong>bits 4,5</strong> : cu√°ntas vidas por juego (3, 4, 5 o 2) </li><li>  <strong>bit 6</strong> : la ubicaci√≥n de la m√°quina arcade: "mesa de c√≥ctel" o "vertical". </li><li>  <strong>bit 7</strong> : si reproducir sonido en modo de espera </li></ul></li><li>  <strong>B005</strong> : <br><ul><li>  <strong>bits 3.4</strong> : dificultad 1 (velocidad del p√°jaro) </li><li>  <strong>bits 5,6</strong> : dificultad 2 (n√∫mero y velocidad de enemigos) </li><li>  <strong>bit 7</strong> : frecuencia de ocurrencia de una moneda en particular </li></ul></li></ul><br>  Finalmente, la lectura de la direcci√≥n <strong>B003</strong> implementa un perro guardi√°n de software.  La CPU a menudo debe leer desde esta direcci√≥n, de lo contrario, la m√°quina arcade realizar√° un reinicio de hardware.  Si por alguna raz√≥n el juego falla, el equipo se reiniciar√° autom√°ticamente. <br><br>  Puede escribir en algunas direcciones de puerto de E / S: <br><br><ul><li>  <strong>B000</strong> : si generar NMI durante vblank;  parece estar desactivado solo durante el procedimiento de arranque </li><li>  <strong>B004</strong> : <strong>voltea</strong> toda la pantalla;  Nunca conoc√≠ el uso de esta funci√≥n, pero tengo una teor√≠a al respecto (ver m√°s abajo) </li></ul><br>  La funcionalidad de cambio de pantalla es un poco confusa, porque cuando jugaba, nunca vi su uso.  Sin embargo, tengo un presentimiento sobre lo que est√° haciendo, pero para confirmarlo, debes escribir el c√≥digo.  Cuando la m√°quina arcade est√° en la configuraci√≥n de "mesa de c√≥ctel", dos jugadores se sientan uno frente al otro.  Por lo tanto, suger√≠ que cuando un juego cambia del jugador 1 al jugador 2, esta funci√≥n voltea la pantalla.  Sin embargo, todav√≠a no he implementado el modo de dos jugadores en el emulador. <br><br><h2>  Tablero de sonido </h2><br>  La tarjeta de sonido en s√≠ es una computadora con todas las funciones con una CPU Z80 (que funciona a una frecuencia de 3 MHz), tres chips de sonido (AY-38910 que funcionan a una frecuencia de 1.5 MHz), as√≠ como RAM y ROM.  El esquema de asignaci√≥n de memoria de la tarjeta de sonido parece bastante simple: <br><br><ul><li>  <strong>0000..2000</strong> : 8 Kbytes de ROM </li><li>  <strong>4000..4400</strong> : 1 KB de RAM </li><li>  <strong>6000</strong> : comando de sonido desde la placa principal </li></ul><br>  Como no hay nada interesante en el esquema de asignaci√≥n de memoria por encima de la direcci√≥n 0x8000, el contacto de direcci√≥n m√°s alto de la CPU ni siquiera est√° conectado: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b2f/4ea/35e/b2f4ea35ee4d2861ea1baa502da10837.png" alt="Bomb Jack Sound A15"></div><br>  La direcci√≥n especial 0x6000 es el puerto de E / S (bloqueo de 8 bits) ubicado en la memoria, que no corresponde a la RAM real.  Este es el mismo puerto que se encuentra en la placa principal en 0xB800.  Es un canal de comunicaci√≥n entre la tarjeta principal y la tarjeta de sonido. <br><br>  Los tres chips de sonido est√°n controlados por estas instrucciones de salida Z80, no a trav√©s de los puertos de memoria.  AY-3-8910 tiene solo dos puertos de E / S abiertos, el primero se usa para almacenar el n√∫mero de registro y el segundo se usa para escribir o leer el contenido del registro especificado por el primer puerto. <br><br>  El circuito de E / S es el siguiente: <br><br><ul><li>  <strong>0x00</strong> : primer chip de sonido: selecci√≥n de registro </li><li>  <strong>0x01</strong> : primer chip de sonido: acceso al registro seleccionado </li><li>  <strong>0x10</strong> : segundo chip de sonido: selecci√≥n de registro </li><li>  <strong>0x11</strong> : segundo chip de sonido: acceso al registro seleccionado </li><li>  <strong>0x80</strong> : tercer chip de sonido: selecci√≥n de registro </li><li>  <strong>0x81</strong> : tercer chip de sonido: acceso al registro seleccionado </li></ul><br>  Algunas palabras sobre el chip de sonido AY-3-8910: <br><br>  Este es un dispositivo bastante est√°ndar, muy popular en las computadoras dom√©sticas de esa √©poca (por ejemplo, en Amstrad CPC, ZX Spectrum 128, en computadoras MSX y muchas otras).  AY-3-8910 gener√≥ muchas variaciones y clones (por ejemplo, Yamaha YM2149, que en s√≠ mismo se convirti√≥ en la base de toda una familia de chips de sonido m√°s potentes). <br><br>  AY-3-8910 tiene 3 canales de se√±ales rectangulares, un generador de ruido que se puede mezclar con tres canales y un generador de envolvente.  Como solo hab√≠a un generador de envolvente para los tres canales, no era particularmente √∫til, y la mayor√≠a de los juegos usaban una CPU para modular el tono y el volumen. <br><br>  Esto significa que el chip AY-3-8910 requiere m√°s intervenci√≥n de la CPU para crear un sonido de alta calidad (a diferencia de los chips SID m√°s independientes, por ejemplo, en una computadora C64). <br><br>  Es sorprendente ver qu√© se puede hacer con tres chips de sonido bastante simples y la CPU que los controla.  La m√∫sica y los efectos de sonido de Bomb Jack son mucho m√°s ricos de lo que he escuchado en la mayor√≠a de los juegos de computadora en casa. <br><br>  Lo √∫nico que es realmente interesante en esta tarjeta de sonido es la forma en que recibe sus comandos de la placa principal. <br><br><h2>  Comando de sonido pestillo </h2><br>  El "pestillo de sonido" es un almacenamiento de un solo byte (pestillo de 8 bits) com√∫n a las tarjetas de sonido y principal.  El pestillo est√° vinculado a la direcci√≥n 0xB800 en la placa principal y a la direcci√≥n 0x6000 en la tarjeta de sonido. <br><br>  Cuando se activa la interrupci√≥n NMI usando VSYNC, la tarjeta de sonido realiza una rutina de servicio de interrupci√≥n muy simple, que lee el pestillo del hardware, lo escribe en la direcci√≥n de memoria normal y establece el "bit de se√±al", que le dice al "bucle principal" que se ha recibido un nuevo comando de sonido: <br><br><pre> <code class="plaintext hljs"> ex af,af' ;0066 exx ;0067 ld hl,04390h ;0068 set 0,(hl) ;006b ld a,(06000h) ;006d ld (04391h),a ;0070 exx ;0073 ex af,af' ;0074 retn ;0075</code> </pre> <br>  El m√©todo de activaci√≥n de contacto NMI es ligeramente diferente del m√©todo de la placa principal: <br><br>  En la placa principal, el pin NMI se activa durante la ejecuci√≥n de VBLANK. <br><br>  Sin embargo, en la tarjeta de sonido, NMI se activa cuando se activa VSYNC, y permanece activo no durante VBLANK, sino hasta que el procedimiento de servicio de interrupci√≥n lea los datos del pestillo a 0x6000. <br><br>  Cuando el equipo reconoce la lectura de la direcci√≥n 0x6000, realiza dos operaciones codificadas: <br><br><ul><li>  el contenido del clip de sonido se restablece a 0 </li><li>  El contacto de NMI se vuelve inactivo </li></ul><br>  De hecho, esta es una simple eliminaci√≥n del rebote de contacto, que no permite que un comando de sonido se ejecute dos veces. <br><br>  La √∫nica pregunta sigue siendo: con qu√© frecuencia la placa principal escribe un nuevo comando (porque la forma de implementar la emulaci√≥n de dos placas depende de esto). <br><br>  Despu√©s de la depuraci√≥n con printf, descubr√≠ que la placa principal registra como m√°ximo un comando de sonido por cuadro de 60 Hz.  Esto simplific√≥ enormemente la estructura del "ciclo principal" del emulador. <br><br>  El problema del trabajo conjunto de dos computadoras emuladas separadas que deben intercambiar datos entre s√≠ es que la emulaci√≥n de una computadora es efectiva solo si puede realizar muchos ciclos a la vez sin interferencia. <br><br>  Por ejemplo, el peor de los casos ser√≠a: <br><br><ul><li>  ejecutamos una instrucci√≥n en computadora 1 </li><li>  ejecutamos una instrucci√≥n en la computadora 2 </li><li>  repetir ... </li></ul><br>  Mi emulador Z80 no est√° optimizado para salir y entrar en la emulaci√≥n para cada instrucci√≥n, porque en este caso deber√≠a descargarse en la memoria y cargar desde la memoria el estado de la CPU al principio y al final de cada instrucci√≥n.  Si la CPU puede procesar muchas instrucciones sin interferencia, entonces puede almacenar (la mayor√≠a de) el estado de la CPU en los registros y restablecer el estado a la memoria en la √∫ltima instrucci√≥n. <br><br>  Es decir, una situaci√≥n ideal ser√≠a esta: realizamos un sistema emulado sin interferencia en todo el marco del sistema host (para una CPU con una frecuencia de 4 MHz y a 60 Hz, esto significa aproximadamente 67 mil ciclos por marco, o entre 3 mil y 16 mil instrucciones Z80). <br><br>  Cuando trabajaba con Bomb Jack, necesitaba asegurarme de que la placa principal no grabe un nuevo comando antes de que la tarjeta de sonido pueda leer el √∫ltimo comando.  Antes de descubrir que la placa principal no registra m√°s de un comando por cuadro, consider√© la necesidad de crear una cola compleja de comandos que interceptara las grabaciones en el pestillo de sonido de la placa principal y almacenara el n√∫mero de ciclo y el byte de comando en la cola. <br><br>  Luego, en el momento en que la tarjeta de sonido ejecutaba su cuadro, tomar√≠a un nuevo comando de la cola de comandos cuando se alcanzara el n√∫mero del ciclo de comando. <br><br>  Tal sistema funcionar√≠a y ser√≠a "correcto", pero aumentar√≠a enormemente la complejidad del c√≥digo. <br><br>  Al final, decid√≠ usar una soluci√≥n mucho m√°s simple sin colas.  Como la placa principal registra solo un comando por cuadro, altern√© la ejecuci√≥n en dos computadoras para que cada una de ellas realizara dos segmentos de tiempo por cuadro: <br><br><ul><li>  realizar la primera mitad del marco en el tablero principal </li><li>  realizar la primera mitad del cuadro en la tarjeta de sonido </li><li>  realizar la segunda mitad del marco en el tablero principal </li><li>  realizar la segunda mitad del cuadro en la tarjeta de sonido </li></ul><br>  Esto garantiza que la tarjeta de sonido vea correctamente todos los comandos grabados por la placa principal y, al mismo tiempo, pueda ejecutar cada emulaci√≥n durante miles de ciclos. <br><br>  Por supuesto, el hecho de que el sistema host funcione a una velocidad de cuadro de 60 Hz es una suposici√≥n muy audaz :) <br><br><h2>  Y el ultimo ... </h2><br>  El √∫ltimo hecho interesante sobre la versi√≥n del emulador en WebAssembly: <br><br>  Tama√±o comprimido de todos los archivos descargados cuando se ejecuta el emulador en WebAssembly <br>  aproximadamente igual a 113 Kbytes: <br><br><ul><li>  aproximadamente 2.5 Kbytes para HTML, CSS y JS "manuscrito" </li><li>  26.8 kb por archivo JS de tiempo de ejecuci√≥n emscripten </li><li>  83,7 KB por archivo .wasm </li></ul><br>  El archivo WASM contiene las ROM integradas de la m√°quina arcade. <br><br>  Sin comprimir, estas ROM ocupan 112 Kbytes. <br><br>  Es decir, <strong>todo</strong> el emulador comprimido con ROM integradas ocupa casi el mismo volumen que las ROM sin comprimir :) <br><br>  Las ROM de 112 kilobytes se comprimen a aproximadamente 57 KB, es decir, el tama√±o real del c√≥digo comprimido en WASM sin datos de ROM es inferior a 30 KB (84-57). <br><br>  Me parece bastante bueno para un emulador completo de un sistema de 8 bits;) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es426291/">https://habr.com/ru/post/es426291/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es426281/index.html">Los fundadores de Amazon, Google, Microsoft y Facebook perdieron m√°s de $ 30 mil millones durante un colapso del mercado de valores</a></li>
<li><a href="../es426283/index.html">WeChat en India: de un lanzamiento poderoso a una p√©rdida total de inter√©s</a></li>
<li><a href="../es426285/index.html">En uno de los talleres de AvtoVAZ encontramos una granja para miner√≠a</a></li>
<li><a href="../es426287/index.html">Enviando a la luna</a></li>
<li><a href="../es426289/index.html">Autenticaci√≥n asp .net core a trav√©s de IdentityServer4</a></li>
<li><a href="../es426293/index.html">Qu√© bicicleta elegir para la ciudad, el pa√≠s y los viajes extremos: una descripci√≥n general de los modelos Airwheel y Twitter</a></li>
<li><a href="../es426295/index.html">Como veo el navegador perfecto</a></li>
<li><a href="../es426297/index.html">¬øPor qu√© no me gusta la web moderna?</a></li>
<li><a href="../es426299/index.html">[Psicolog√≠a del dise√±o] - La psicolog√≠a del dise√±o</a></li>
<li><a href="../es426301/index.html">¬øEs as√≠ en Europa, mientras escriben sobre eso?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>