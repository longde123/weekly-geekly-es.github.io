<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸï¸ âš’ï¸ ğŸ›µ Tentang cermin repositori Centos dan memilih yang terbaik ğŸ… ğŸ—‚ï¸ ğŸ‘©ğŸ»â€ğŸ’¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tahun lalu, kami menyelenggarakan mirror online untuk beberapa distribusi Linux. Ini bukan proses yang rumit dan untuk proyek-proyek besar seperti Ubu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tentang cermin repositori Centos dan memilih yang terbaik</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476262/">  Tahun lalu, kami menyelenggarakan mirror online untuk beberapa distribusi Linux.  Ini bukan proses yang rumit dan untuk proyek-proyek besar seperti Ubuntu, ini hampir sepenuhnya otomatis.  Dalam kasus lain, Anda perlu menghubungi proyek dengan satu atau lain cara, misalnya, di milis dan menyatakan keinginan Anda secara eksplisit. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i5/vh/_l/i5vh_lmncsc_yjc6woir34ypw8o.png" alt="yum repolist"></div><br>  Secara teknis, ini <code>rsync</code> , biasanya sesuai jadwal.  Seseorang untuk ini menyediakan satu set skrip yang sudah jadi, seperti Fedora, dan seseorang hanya mengatakan bahwa Anda perlu melakukan sinkronisasi di sini dari server ini dan set parameter yang direkomendasikan.  Sumber daya yang paling mahal adalah tempatnya, kami baru-baru ini mencapai 4 terabyte dan ini mahal untuk kami karena itu tidak menghasilkan laba apa pun.  Sebagai imbalannya, kami menerima ketersediaan lokal dari distribusi yang kami gunakan, ini memungkinkan untuk menyederhanakan konfigurasi awal server dengan menghilangkan akses Internet wajib dari itu.  Dan tentu saja, kami senang bahwa kami bergabung dengan sesuatu yang besar, bahkan jika partisipasi kami dalam hal ini tidak terlalu terlihat. <br><br>  Cermin kami bersifat publik, semua orang dapat menerima pembaruan darinya, yang sebenarnya terjadi jika dinilai oleh statistik banding.  Ini terutama Rusia, tetapi tidak hanya.  Tentang bagaimana ternyata dan bagaimana server umum dipilih untuk pembaruan pada contoh versi ketujuh Centos dari posting ini. <a name="habracut"></a><br><br>  Kami akan berbicara tentang pengelola paket <code>yum</code> dengan plugin yang paling cepat diinstal secara default dan kami hanya akan tertarik pada proses memilih mirror tertentu. <br><br><h2>  Daftar Cermin </h2><br>  Diketahui bahwa daftar repositori ditentukan dalam file di direktori <code>/etc/yum.repos.d/</code> kecuali ditentukan lain.  Ini adalah apa yang tampak seperti pengaturan repositori <code>Base</code> di file <code>/etc/yum.repos.d/Centos-Base.repo</code> : <br><br><pre> <code class="bash hljs">[base] name=CentOS-<span class="hljs-variable"><span class="hljs-variable">$releasever</span></span> - Base mirrorlist=http://mirrorlist.centos.org/?release=<span class="hljs-variable"><span class="hljs-variable">$releasever</span></span>&amp;arch=<span class="hljs-variable"><span class="hljs-variable">$basearch</span></span>&amp;repo=os&amp;infra=<span class="hljs-variable"><span class="hljs-variable">$infra</span></span> <span class="hljs-comment"><span class="hljs-comment">#baseurl=http://mirror.centos.org/centos/$releasever/os/$basearch/ gpgcheck=1 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span></span></code> </pre> <br>  Di sini Anda dapat melihat dua opsi yang menentukan tempat Anda dapat memperoleh data.  <b>Baseurl</b> pertama langsung menunjuk ke cermin, tidak ada pilihan yang diperlukan di sini.  Daftar <b>mirror</b> kedua menunjukkan sebuah tautan di mana daftar 10 mirror akan dikembalikan dari mana pilihan akan dibuat, itu adalah opsi ini yang aktif.  Kami juga melihat beberapa variabel di dalam tautan, semuanya akhirnya mencerminkan tempat tertentu di pohon direktori repositori: <br><br><ul><li>  <b>rilis</b> - versi: <code>6</code> , <code>7</code> , <code>8</code> , <code>8-stream</code> .  Versi lama ditarik dari infrastruktur yang ada, tetapi snapshot dari repositori mereka dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://vault.centos.org/</a> </li><li>  <b>arch</b> adalah arsitektur seperti <code>i386</code> atau <code>x86_64</code> .  Untuk beberapa versi, beberapa arsitektur akan merujuk ke repositori alternatif dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sistem mirror lain</a> , tetapi pada saat yang sama, infrastruktur pemilihan mirror tetap umum.  Untuk versi 7, satu-satunya mirror dasar yang didukung adalah <code>x86_64</code> , sebuah alternatif untuk <code>i386</code> .  Untuk yang pertama, daftar akan dibentuk dalam struktur dasar cermin, untuk yang kedua dari alternatif </li><li>  <b>repo</b> - dalam kasus kami, <code>os</code> , tetapi bisa berupa <code>updates</code> atau lainnya, sebenarnya jenis repositori mencerminkan data apa yang kami butuhkan.  Untuk versi 8, setara dengan <code>os</code> akan menjadi <code>baseos</code> </li><li>  <b>infra</b> - Saya dapat dengan hati-hati berasumsi bahwa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">itu masih belum digunakan</a> , setidaknya saya tidak dapat menemukan pemrosesan ketika membentuk daftar mirror.  Itu sama dengan <code>stock</code> , tetapi jika Anda menghilangkan parameter ini, tidak ada perubahan yang terlihat akan mengikuti </li><li>  <b>cc</b> adalah kode negara, untuk Amerika Serikat dan Kanada juga kode negara.  Itu tidak ada dalam contoh dari file di atas, karena negara dihitung ketika diminta oleh alamat IP yang diminta.  Variabel ini dapat digunakan untuk menghilangkan kesalahan geolokasi.  Untuk Rusia, <code>cc=ru</code> </li></ul><br>  Untuk Centos versi ke-7, kita mendapatkan baris berikut: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://mirrorlist.centos.org/?release=7&amp;arch=x86_64&amp;repo=os&amp;infra=stock</a> , yang akan menghasilkan daftar 10 cermin dari jenis berikut: <br><br><pre> <code class="bash hljs">http://&lt;   1&gt;/7.xxx/os/x86_64/ http://&lt;   2&gt;/7.xxx/os/x86_64/ ... http://&lt;   10&gt;/7.xxx/os/x86_64/</code> </pre> <br>  Perhatikan bahwa jalur spesifik untuk setiap cermin sama persis dengan variabel dalam kueri.  Versi lengkapnya ditunjukkan bukan versi yang lebih lama, meskipun Anda juga dapat menggunakannya: <code>http://&lt;  &gt;/7/os/x86_64/</code> juga ada, diimplementasikan menggunakan tautan simbolis ke versi terbaru. <br><br><div class="spoiler">  <b class="spoiler_title">Dan semua ini bersama-sama sesuai dengan hierarki direktori langsung di server.</b> <div class="spoiler_text"><pre>  ./centos
 â”œâ”€â”€ 6
 â”‚ â”œâ”€â”€ centosplus
 â”‚ â”‚ â”œâ”€â”€ i386
 ... â”‚ â””â”€â”€ x86_64
     ...
 â”‚
 â”œâ”€â”€ 7
 â”‚ â”œâ”€â”€ atomik
 â”‚ â”‚ â””â”€â”€ x86_64
 â”‚ â”œâ”€â”€ centosplus
 â”‚ â”‚ â””â”€â”€ x86_64
 â”‚ â”œâ”€â”€ cr
 â”‚ â”‚ â””â”€â”€ x86_64
 â”‚ â”œâ”€â”€ dotnet
 â”‚ â”‚ â””â”€â”€ x86_64
 â”‚ â”œâ”€â”€ ekstra
 â”‚ â”‚ â””â”€â”€ x86_64
 â”‚ â”œâ”€â”€ opstools
 â”‚ â”‚ â””â”€â”€ x86_64
 â”‚ â”œâ”€â”€ os
 â”‚ â”‚ â””â”€â”€ x86_64
 â”‚ â”‚ â””â”€â”€ repodata
 â”‚ â”‚ â””â”€â”€ [repomd.xml]
 â”‚ â”œâ”€â”€ rt
 â”‚ â”‚ â””â”€â”€ x86_64
 â”‚ â”œâ”€â”€ pembaruan
 â”‚ â”‚ â””â”€â”€ x86_64
 â”‚ ...
 â”‚
 â”œâ”€â”€ 7.0.1406
 â”œâ”€â”€ 7.1.1503
 â”œâ”€â”€ 7.2.1511
 â”œâ”€â”€ 7.3.1611
 â”œâ”€â”€ 7.4.1708
 â”œâ”€â”€ 7.5.1804
 â”œâ”€â”€ 7.6.1810
 â”œâ”€â”€ 7.7.1908
 â”œâ”€â”€ 8
 â”œâ”€â”€ 8-stream
 â”œâ”€â”€ 8.0.1905 
 ... </pre></div></div><br><h3>  Implementasi </h3><br>  Sekarang untuk implementasinya, yang dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://github.com/CentOS/mirrorlists-code</a> , kami tertarik pada bagaimana daftar mirror dibentuk.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Makemirrorlists</a> script <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mutiara-combined.pl melakukan ini</a> .  Tugas utamanya adalah untuk memeriksa vitalitas cermin dengan membandingkan hash dari file <code>repodata/repomd.xml</code> dengan referensi untuk versi dan arsitektur yang diberikan.  Karenanya, file tersebut harus ada untuk semua kombinasi versi, tipe repositori, dan arsitektur yang tersedia. <br><br>  Verifikasi dilakukan sesuai dengan daftar dalam urutan berikut (saya kutip dari kode): <br><br><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment"># phase 1 -- this US state or Canada province # phase 2 -- this country # phase 3 -- other nearby countries # phase 4 -- mirrors from the same continent # phase 5 -- a random mirror from each continent (for fallback only) # note: phase 5 will be executed once for each continent (with "redo") # phase 6 -- random mirrors from any continent (for fallback only) # phase 7 -- centos servers from the same continent # phase 8 -- centos servers from other continents (used also for fallback)</span></span></code> </pre><br>  Klausa 1 dan 2 berfungsi baik atau untuk memeriksa tidak hanya kode negara, tetapi juga kode negara.  Intinya, upaya dilakukan untuk memilih server geografis terdekat.  Untuk setiap langkah, kueri dibuat dari database, misalnya: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">columns</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> mirrors <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-string"><span class="hljs-string">'Direct'</span></span>, <span class="hljs-string"><span class="hljs-string">'Indirect'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> = <span class="hljs-string"><span class="hljs-string">'Active'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> cc = <span class="hljs-string"><span class="hljs-string">'$cc'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> $commonqueryparams $skipregion $altarch_where <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RAND</span></span>();</code> </pre><br>  Lalu ada pemeriksaan untuk vitalitas cermin pada daftar ini dengan membandingkan hash, seperti dijelaskan di atas.  Jika 10 orang direkrut, maka tugas yang diperlukan telah selesai, pekerjaan selesai.  Jika Anda tidak mengetik, maka lanjutkan ke langkah berikutnya untuk mendapatkan daftar umum hingga 10 atau sampai kami kehabisan semua opsi.  Hasilnya disimpan dalam file dan ditransfer ke ujung depan bagian yang disajikan oleh Python dengan skrip <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ml.py</a> , tugasnya adalah memilih dan memberikan file yang diinginkan, setelah terlebih dahulu mengetahui negara sumber permintaan dengan alamat IP.  Jenis protokol IPv4 atau IPv6, di mana daftar yang berbeda dibentuk, juga diperhitungkan. <br><br>  Kembali ke kueri yang menggunakan <code>ORDER BY RAND()</code> , apakah ini berarti bahwa daftar akan acak?  Ya, seberapa acak implementasi dalam DBMS, tetapi ini hanya berlaku untuk urutan dalam setiap langkah.  Artinya, jika untuk negara tertentu lebih dari 10 cermin dari jenis repositori dan arsitektur yang diperlukan diketik (untuk Rusia hanya ada 17), maka pada akhirnya, setiap kali kita akan mendapatkan daftar 10 cermin berbeda yang diacak di satu negara.  Jika jumlahnya lebih sedikit, maka di bagian atas daftar akan <b>selalu</b> ada repositori yang diacak dari satu negara, repositori yang dikocok lebih jauh dari negara-negara terdekat, dan seterusnya dalam langkah-langkah.  Hasilnya, kami mendapatkan daftar yang tidak sepenuhnya acak yang terdiri dari beberapa bagian acak.  Itu penting ketika tidak ada banyak cermin yang bekerja di satu negara, misalnya, cermin IPv6 di Rusia hanya 7 dan mereka akan selalu berada di urutan teratas daftar: <br><br><div class="spoiler">  <b class="spoiler_title">http://mirrorlist.centos.org/?release=7&amp;arch=x86_64&amp;repo=os&amp;infra=stock&amp;cc=en (permintaan harus dibuat dari alamat IPv6)</b> <div class="spoiler_text"> <code>http://mirror.corbina.net/pub/Linux/centos/7.7.1908/os/x86_64/ <br> http://mirror.yandex.ru/centos/7.7.1908/os/x86_64/ <br> http://mirrors.powernet.com.ru/centos/7.7.1908/os/x86_64/ <br> http://mirror.reconn.ru/centos/7.7.1908/os/x86_64/ <br> http://mirror.sale-dedic.com/centos/7.7.1908/os/x86_64/ <br> http://ftp.nsc.ru/pub/centos/7.7.1908/os/x86_64/ <br> http://dedic.sh/centos/7.7.1908/os/x86_64/ <br> <br> http://ftp.funet.fi/pub/mirrors/centos.org/7.7.1908/os/x86_64/ <br> http://centos.mirror.far.fi/7.7.1908/os/x86_64/ <br> http://mirrors.glesys.net/CentOS/7.7.1908/os/x86_64/ <br></code> </div></div><br>  Lebih buruk lagi, arsitektur <code>i386</code> adalah arsitektur alternatif untuk Centos 7 dan sistem cermin terpisah.  Di Rusia, hanya ada satu server yang mendukung arsitektur alternatif, yang akan selalu ada di tempat pertama: <br><br><div class="spoiler">  <b class="spoiler_title">http://mirrorlist.centos.org/?release=7&amp;arch=i386&amp;repo=os&amp;infra=stock&amp;cc=en</b> <div class="spoiler_text"> <code>http://mirrors.powernet.com.ru/centos-altarch/7.7.1908/os/i386/ <br> <br> http://mirror.vpsnet.com/centos-altarch/7.7.1908/os/i386/ <br> http://mirrors.huaweicloud.com/centos-altarch/7.7.1908/os/i386/ <br> http://linux.darkpenguin.net/distros/CentOS-AltArch/7.7.1908/os/i386/ <br> http://ftp.agdsn.de/pub/mirrors/centos-altarch/7.7.1908/os/i386/ <br> http://mirror1.hs-esslingen.de/pub/Mirrors/centos-altarch/7.7.1908/os/i386/ <br> http://mirror.infonline.de/centos-altarch/7.7.1908/os/i386/ <br> http://ftp.rz.uni-frankfurt.de/pub/mirrors/centos-altarch/7.7.1908/os/i386/ <br> http://ftp.yz.yamagata-u.ac.jp/pub/linux/centos-altarch/7.7.1908/os/i386/ <br> http://mirrors.daticum.com/centos-altarch/7.7.1908/os/i386/ <br></code> </div></div><br>  Daftar ini tidak lagi acak, jika Anda fokus pada baris pertama, pilihannya sudah ditentukan sebelumnya.  Dukungan untuk repositori untuk arsitektur Centos alternatif adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">masalah</a> prinsip, tetapi bagi banyak orang, altruisme murni ada di sini. <br><br>  Repositori dipindai terus menerus dan tanpa mempertimbangkan mekanisme caching, hasilnya diperbarui sekitar setiap 3 jam.  Kutipan dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mirrorlist_crawler_deployment_notes.txt</a> : <br><blockquote> <code>- A full scan of all repos and all versions without any cached data is going to take close to 3 hours, but typically altarch is &lt;10min, C6 &lt;25min, C7 &lt;25min with all the repos enabled</code> </blockquote> <br>  Dalam praktiknya, saya mulai mendapatkan opsi daftar cermin di Rusia untuk IPv4 dan IPv6 satu menit sekali untuk repositori Base Centos 7 - <code>http://mirrorlist.centos.org/?release=7&amp;arch=x86_64&amp;repo=os&amp;infra=stock&amp;cc=ru</code> dan ternyata seperti ini selama beberapa hari pengamatan: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fx/qh/sn/fxqhsn08lhen5mke-jlprhlgjxa.png" alt="jumlah pembaruan daftar mirror"></div><br>  daftar IPv4 biru, IPv6 merah.  Perubahan tidak terjadi setiap 25 menit, tetapi tidak setiap 3 jam - semuanya sesuai dalam interval dari setengah jam menjadi dua.  Gambar dengan arsitektur <code>i386</code> dan cermin alternatif berbeda secara radikal - <code>http://mirrorlist.centos.org/?release=7&amp;arch=i386&amp;repo=os&amp;infra=stock&amp;cc=ru</code> sekitar satu minggu pengamatan: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/os/xy/wb/osxywbdutbktiud6-scyrul_lok.png" alt="jumlah pembaruan daftar altmirrors"></div><br>  Kita dapat berharap bahwa setiap 15 menit kita akan memiliki daftar baru, dalam 30 menit beberapa perubahan akan terjadi.  Tapi!  Ingatlah bahwa cermin yang kurang aktif semakin acak urutannya dan di tempat pertama sekarang di Rusia selalu cermin yang sama. <br><br><h2>  Kekaguman tercepat </h2><br>  Secara keseluruhan, daftar mirror dibentuk secara kebetulan, yang mungkin tidak buruk untuk load balancing.  Paling buruk, kita dapat berharap bahwa hanya dengan memilih mirror pertama dari daftar, kita tidak akan memiliki pilihan seperti itu.  Selain itu, pembagian wilayah negara-negara dalam kasus negara besar seperti kita dapat memainkan trik dengan meletakkan cermin dari Petropavlovsk-Kamchatsky <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://mirror.vilkam.ru</a> untuk klien dari Sochi di bagian atas daftar.  Oleh karena itu, alangkah baiknya untuk mengevaluasi ketersediaan cermin dari daftar ini.  Ini <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dilakukan oleh</a> plugin <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tercepat</a> .  Esensi yang direduksi menjadi tindakan sederhana: <br><br><pre> <code class="python hljs">time_before = time.time() sock.connect((self.host, self.port)) result = time.time() - time_before</code> </pre><br>  Tidak ada <code>HTTP</code> atau <code>ICMP</code> , buka soket untuk node, pertimbangkan berapa banyak waktu yang diperlukan, terapkan <code>sort()</code> ke hasilnya.  Semua 10 mirror yang diperoleh pada langkah sebelumnya dikirim sebagai parameter, dalam bentuk <code>URL</code> lengkap yang hanya menggunakan nama host.  Plugin ini mudah digunakan secara terpisah dari <code>yum</code> , Anda hanya perlu mengomentari baris 52 dan 55: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># from yum.plugins import TYPE_CORE requires_api_version = '2.5' # plugin_type = (TYPE_CORE,)</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">dan bisa digunakan.</b> <div class="spoiler_text"><pre> <code class="bash hljs">$ ./fastestmirror.py http://mirror.sale-dedic.com/centos/7.7.1908/os/x86_64/ http://mirror.corbina.net/pub/Linux/centos/7.7.1908/os/x86_64/ http://mirrors.powernet.com.ru/centos/7.7.1908/os/x86_64/ http://ftp.nsc.ru/pub/centos/7.7.1908/os/x86_64/ http://mirror.reconn.ru/centos/7.7.1908/os/x86_64/ http://mirror.yandex.ru/centos/7.7.1908/os/x86_64/ http://dedic.sh/centos/7.7.1908/os/x86_64/ http://mirror.tversu.ru/centos/7.7.1908/os/x86_64/ http://mirror.awanti.com/centos/7.7.1908/os/x86_64/ http://mirror.linux-ia64.org/centos/7.7.1908/os/x86_64/repodata/repodm.xml http://mirrors.datahouse.ru/centos/7.7.1908/os/x86_64/ http://mirror.docker.ru/centos/7.7.1908/os/x86_64/ http://mirror.logol.ru/centos/7.7.1908/os/x86_64/ http://centos-mirror.rbc.ru/centos/7.7.1908/os/x86_64/ http://mirror.truenetwork.ru/centos/7.7.1908/os/x86_64/ http://mirror.vilkam.ru/centos/7.7.1908/os/x86_64/ http://mirror.axelname.ru/centos/7.7.1908/os/x86_64/ * mirror.corbina.net : 0.085000 secs * mirrors.powernet.com.ru : 0.097000 secs * mirror.sale-dedic.com : 0.117000 secs * ftp.nsc.ru : 0.181000 secs * mirror.reconn.ru : 0.184000 secs * mirror.yandex.ru : 0.222000 secs * dedic.sh : 0.261000 secs * mirror.tversu.ru : 0.295000 secs * mirror.awanti.com : 0.345000 secs * mirror.linux-ia64.org : 0.386000 secs * mirrors.datahouse.ru : 0.403000 secs * mirror.docker.ru : 0.435000 secs * mirror.logol.ru : 0.474000 secs * centos-mirror.rbc.ru : 0.519000 secs * mirror.truenetwork.ru : 0.587000 secs * mirror.axelname.ru : 0.528000 secs * mirror.vilkam.ru : 0.709000 secs Result: [<span class="hljs-string"><span class="hljs-string">'http://mirror.corbina.net/pub/Linux/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirrors.powernet.com.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.sale-dedic.com/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://ftp.nsc.ru/pub/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.reconn.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.yandex.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://dedic.sh/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.tversu.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.awanti.com/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.linux-ia64.org/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirrors.datahouse.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.docker.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.logol.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://centos-mirror.rbc.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.axelname.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.truenetwork.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.vilkam.ru/centos/7.7.1908/os/x86_64/'</span></span>]</code> </pre></div></div><br>  Pemrosesan berlangsung dalam beberapa utas, sehingga Anda tidak perlu menunggu lama, bahkan untuk semua 17 cermin yang terdaftar di Rusia.  Hasil kerja dalam bentuk dua daftar, yang pertama di mana waktu eksekusi diindikasikan, adalah debugging dan tidak diurutkan, meskipun sepertinya begitu.  Yang kedua setelah kata <code>Result</code> diurutkan dari respons yang lebih kecil ke yang lebih besar, dialah yang digunakan untuk pekerjaan lebih lanjut dalam urutan yang diterima. <br><br>  <code>dnf</code> juga menggunakanmirror <code>dnf</code> dari himpunan perpustakaan RPM, tetapi di sana diselesaikan melalui <code>libcurl</code> dan secara umum semuanya lebih rumit. <br><br>  Pada akhirnya, itu semua tergantung pada seberapa cepat respons dari cermin diterima, sementara caching harus diperhitungkan, yaitu, perhitungan langsung dari penundaan tidak selalu dilakukan.  Interval waktu sangat dipengaruhi oleh kinerja in-house dari mesin lokal dan beban kerjanya.  Tutup node yang menunjukkan hasil yang serupa mungkin akan sering berganti tempat.  Tapi di sini tercapai, menurut saya tujuan utama bukan untuk mengirim simpul dari Sochi untuk pembaruan ke Petropavlovsk-Kamchatsky, untuk pergi ke Moskow atau Volgograd cukup dapat diterima.  Apa lagi yang perlu kita perhatikan, pilihan dibuat dari daftar yang diterima pada langkah pertama sebelum <code>fastestmirror</code> , jika data ini belum ada dalam cache, maka mirror terdekat pada percobaan pertama mungkin bukan yang terbaik, hanya karena itu bahkan tidak akan dianalisis tanpa masuk ke dalam sepuluh besar. <br><br>  Dalam praktiknya, hasil tempat pertama berikut diperoleh pada survei mingguan setiap 10 menit.  Digit - berapa kali jumlah node dimenangkan selama perbandingan, untuk <code>fastestmirror</code> dan <code>fastestmirror</code> : <br><blockquote> <code>1422,1013 mirror.logol.ru <br> 534,986 mirror.docker.ru <br> 28,8 mirrors.datahouse.ru <br> 16 centos-mirror.rbc.ru <br> 6 mirror.sale-dedic.com <br> 5,7 mirror.reconn.ru <br> 2 dedic.sh <br> 1 mirror.corbina.net</code> </blockquote> <br>  Dan daftar versi IPv6: <br><blockquote> <code>1989,1980 mirror.reconn.ru <br> 18,34 mirror.sale-dedic.com <br> 7 dedic.sh <br></code> </blockquote><br>  Dapat dilihat bahwa pilihannya tidak langsung tidak ambigu, tetapi di sini kedekatan titik di mana saya melakukan survei kemungkinan besar memainkan peran - hingga beberapa cermin, perbedaannya kurang dari satu milidetik.  Poin kedua, daftar IPv6 berbeda dan lebih buruk - host IPv6 terdekat lebih jauh dari IPv4 terdekat dan pilihannya lebih sedikit.  Mengingat prioritas IPv6 tidak terlalu baik.  Hasil dari <code>fping</code> ringkas, lebih sedikit node yang menang, tetapi umumnya sama dengan <code>fastestmirror</code> . <br><br><h2>  Atlas matang </h2><br>  Dengan pilihan lokal, semuanya kurang lebih jelas, sekarang mari kita lihat bagaimana keadaan di seluruh negeri.  Mengapa kami menggunakan layanan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://atlas.ripe.net/</a> - satu set probe (probe) dan alat untuk bekerja dengan mereka di bawah naungan RIPE NCC, saya akan segera memperingatkan Anda, ini bukan situs tercepat dan paling gesit.  Siapa pun bisa mendapatkan penyelidikan, serta menggunakan jaringan ini.  Tetapi untuk menjalankan tes, Anda memerlukan mata uang internal yang terakumulasi dari perangkat yang terdaftar dan aktif setelah Anda.  Saya memilih semua perangkat di Rusia yang mendukung IPv6 dan IPv4 pada saat yang sama, 82 diantaranya ternyata. Menurut hasil pengukuran, sebagian harus disingkirkan, jadi 67 dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">lebih dari 400 yang</a> tersisa. <br><br>  Ada beberapa opsi tes yang dapat Anda jalankan, tentu saja tidak ada yang digunakan dalam <code>fastestmirror</code> , tetapi ada <code>ping</code> biasa.  Untuk semua mirror, dengan pengecualian <code>mirror.linux-ia64.org</code> mana <code>ICMP</code> difilter dan <code>mirror.axelname.ru</code> yang muncul setelah pengujian dilakukan, dari semua perangkat yang dipilih, secara terpisah untuk IPv6 dan IPv4, setiap 3 jam selama seminggu Masing-masing 10 permintaan.  Waktu respons rata-rata dicatat.  Dari seluruh rangkaian pengukuran, sekitar 50 untuk setiap cermin, median diambil dan dibandingkan dengan cermin lain pada probe ini.  Cermin dengan waktu respons terpendek menang. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cg/ap/gf/cgapgfond47sh3phyalhc30s0na.jpeg" alt="mirror dan probe map"></div><br>  Probe (spidol biru) dan mirror (spidol merah) didistribusikan terlalu tidak merata dan condong ke arah ibukota, sehingga hasilnya tidak boleh dianggap sebagai sesuatu yang signifikan.  Data mentah tersedia mulai dari angka pengukuran <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">23159879</a> hingga <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">23159901</a> , jika diinginkan, mereka dapat dianalisis lebih ketat.  Ringkas jumlah total tempat pertama untuk IPv4: <br><blockquote> <code>22 mirror.docker.ru <br> 12 mirror.awanti.com <br> 10 centos-mirror.rbc.ru <br> 6 dedic.sh <br> 4 mirror.truenetwork.ru <br> 3 mirror.corbina.net <br> 3 mirrors.powernet.com.ru <br> 2 ftp.nsc.ru <br> 2 mirrors.datahouse.ru <br> 1 mirror.reconn.ru <br> 1 mirror.vilkam.ru <br> 1 mirror.yandex.ru <br></code> </blockquote><br>  dan IPv6: <br><blockquote> <code>20 dedic.sh <br> 20 mirror.reconn.ru <br> 10 mirror.yandex.ru <br> 8 mirror.sale-dedic.com <br> 5 ftp.nsc.ru <br> 3 mirror.corbina.net <br> 1 mirrors.powernet.com.ru <br></code> </blockquote><br>  Kita dapat mengatakan bahwa untuk hampir semua mirror, saya ingatkan pada 17, ada konsumen.  Sangat menarik bahwa <code>mirror.yandex.ru</code> di tempat terakhir bersama dengan <code>mirror.vilkam.ru</code> dari Petropavlovsk-Kamchatsky.  Pada saat yang sama, Yandex tersedia dengan baik hampir dari mana-mana, itu hanya kehilangan sedikit lebih responsif setiap kali, tetapi <code>mirror.vilkam.ru</code> menang sekali, tetapi lebih dari jujur â€‹â€‹dibandingkan dengan yang lain pada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">penyelidikan 6606</a> dari Khabarovsk (RTT dalam milidetik): <br><blockquote> <code>centos-mirror.rbc.ru,105.4163369 <br> dedic.sh,109.2160474 <br> ftp.nsc.ru,106.4012836 <br> mirror.awanti.com,107.0802782 <br> mirror.corbina.net,98.5339837 <br> mirror.docker.ru,102.7883347 <br> mirror.logol.ru,105.9588192 <br> mirror.reconn.ru,106.5717624 <br> mirror.sale-dedic.com,106.1676841 <br> mirror.truenetwork.ru,110.9780753 <br> mirror.tversu.ru,107.9966083 <br> mirror.vilkam.ru,25.1486164 <br> mirror.yandex.ru,99.7320257 <br> mirrors.datahouse.ru,103.6546383 <br> mirrors.powernet.com.ru,116.4087614 <br></code> </blockquote><br>  Hasil terbaik di wilayah satu atau beberapa milidetik, dan hasil terburuk dalam respons di Salekhard, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menyelidiki 22767</a> : <br><blockquote> <code>centos-mirror.rbc.ru,59.9632155 <br> dedic.sh,63.765421 <br> ftp.nsc.ru,59.349309 <br> mirror.awanti.com,75.8998928571 <br> mirror.corbina.net,59.906047 <br> mirror.docker.ru,65.8720585 <br> mirror.logol.ru,63.2041255 <br> mirror.reconn.ru,63.7120505 <br> mirror.sale-dedic.com,63.052342 <br> mirror.truenetwork.ru,61.2567465 <br> mirror.tversu.ru,66.2593372222 <br> mirror.vilkam.ru,138.3730595 <br> mirror.yandex.ru,63.4150445 <br> mirrors.datahouse.ru,59.304435 <br> mirrors.powernet.com.ru,78.7411795 <br></code> </blockquote><br><h2>  Kata penutup </h2><br>  Bagi mereka yang sampai di tempat ini saya akan menjawab pertanyaan yang akan ditanyakan - mirror kami <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://mirrors.powernet.com.ru</a> dan berikut ini cara penggunaannya: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nl/rm/nb/nlrmnbe9g8tnuvym2u6jlyurnzc.png" alt="lalu lintas data mirrors.powernet.com.ru"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tk/99/rn/tk99rnmoigycgl4ataoygkhs100.png" alt="lalu lintas bandwidth mirrors.powernet.com.ru"></div><br>  Selain itu, pangsa lalu lintas ini dari dalam jaringan kami dapat diabaikan. <br><br>  Beginilah tempat tempat itu berakhir: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ap/qk/zc/apqkzcw2htintu4idmjk5sixyfk.png" alt="Disk mirror.powernet.com.ru"></div><br>  Langkah yang dapat dibedakan dengan baik adalah saat-saat ketika kita menambahkan distribusi baru.  Ketika semuanya dimulai, VirtualBox berjalan pada Windows di komputer kantor tempat arsip video departemen periklanan kami disimpan.  Kemudian kami pindah ke sistem virtualisasi tempur dan itu menjadi sedikit lebih mudah: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/po/nl/hq/ponlhqp1327wrr6hmvpczednm8q.png" alt="gambar"></div><br>  Sebagai perbandingan, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mirror.truenetwork.ru</a> mengembalikan lalu lintas 3 Gb / s dari dua server.  Semuanya jauh lebih sederhana dengan kami dan, secara umum, itu lebih dari cukup bagi kami untuk menikmati prosesnya, serta ulasan antusiasme yang mengejutkan dari teman dan pelanggan ketika seseorang melihat garis yang tiba-tiba akrab saat memperbarui sistem mereka.  Dan juga, kadang-kadang berkedip-kedip di latar belakang dalam berbagai artikel dan manual, di mana tautan ke cermin kita terlihat di log atau tangkapan layar. <br><br>  Anda dapat melihat status semua mirror yang dikenal di Centos di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> , dan membaca tentang cara bergabung dengan proyek di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> , itu sederhana dan bertanggung jawab pada saat yang sama, tetapi tentu saja tidak sia-sia. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id476262/">https://habr.com/ru/post/id476262/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id476252/index.html">Migrasi email: cara mudah berpindah dari satu server dan pergi ke yang lain</a></li>
<li><a href="../id476254/index.html">Dari siswa hingga kejadian atau cara masuk ke perusahaan TI tanpa pengetahuan dan pengalaman</a></li>
<li><a href="../id476256/index.html">Mengikuti jejak gerakan Scala Rusia. Bagian 3</a></li>
<li><a href="../id476258/index.html">Migrasi basis data GitLab ke PostgreSQL eksternal</a></li>
<li><a href="../id476260/index.html">Kami mengumpulkan dalam rpm WireMock - utilitas untuk membuat bertopik atas layanan web di Fedora COPR analog dari PPA di Ubuntu</a></li>
<li><a href="../id476264/index.html">Bot Telegram untuk belajar bahasa asing: dari menjejalkan kata-kata hingga berbicara</a></li>
<li><a href="../id476266/index.html">Magang di Mars Digital Technologies. Bagaimana kami menerapkan pembelajaran mendalam di M&M</a></li>
<li><a href="../id476268/index.html">Solusi untuk Tantangan Penemuan Bug yang Ditawarkan oleh Tim PVS-Studio di Konferensi pada 2018-2019</a></li>
<li><a href="../id476270/index.html">Kemenangan kami: TopCoder Open 2019</a></li>
<li><a href="../id476272/index.html">Jawaban untuk tugas-tugas dari stan PVS-Studio di konferensi 2018-2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>