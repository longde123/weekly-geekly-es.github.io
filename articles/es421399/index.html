<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎧 😤 👩🏿‍🚀 Análisis de puerta trasera de Turla Cybergroup Outlook 🤟🏾 👈🏼 🙋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Turla (Snake, Uroboros) es un grupo de espionaje cibernético que ganó fama en 2008 después de piratear objetos protegidos, incluida la red del Comando...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Análisis de puerta trasera de Turla Cybergroup Outlook</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/421399/"><p>  Turla (Snake, Uroboros) es un grupo de espionaje cibernético que ganó fama en 2008 después de piratear objetos protegidos, incluida la red del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Comando Central de las Fuerzas Armadas de EE</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">UU</a> .  Desde entonces, se especializa en ataques contra instalaciones militares y agencias diplomáticas en todo el mundo.  Las víctimas famosas incluyen el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ministerio de Asuntos Exteriores de Finlandia</a> en 2013, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">corporación de defensa suiza RUAG</a> de 2014 a 2016.  y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el gobierno alemán</a> a fines de 2017 - principios de 2018. </p><br><p>  Después del último incidente, varios medios de comunicación publicaron información sobre los métodos de los atacantes, utilizando archivos adjuntos de correo electrónico para controlar el malware y transferir datos robados del sistema.  Sin embargo, no se proporcionó información técnica sobre la puerta trasera.  En este informe, publicamos el análisis de la puerta trasera de Turla, que se administró utilizando archivos adjuntos PDF en el correo electrónico. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/l_/db/ws/l_dbws8skuoavwqn1vorwdhobgo.jpeg"></div><a name="habracut"></a><br><p>  Según <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">los informes de los medios</a> , varias computadoras del Ministerio de Relaciones Exteriores de Alemania estaban infectadas con una puerta trasera.  Aparentemente, el ataque comenzó en 2016 y fue descubierto por los servicios de seguridad a fines de 2017. Inicialmente, los atacantes comprometieron a la Escuela Secundaria Federal de Administración Pública (Hochschule des Bundes), luego de lo cual se trasladaron dentro de su red hasta que obtuvieron acceso a la red del Ministerio de Relaciones Exteriores en marzo de 2017. .  Los operadores de Turla tuvieron acceso a algunos datos confidenciales (por ejemplo, el correo electrónico de los empleados del Ministerio de Relaciones Exteriores alemán) durante aproximadamente un año. </p><br><p>  Nuestra investigación también revela que este malware dirigido a Microsoft Outlook se usó contra varios departamentos políticos y militares.  Nos aseguramos de que los ministerios de asuntos exteriores de los otros dos países europeos y el principal contratista de defensa también estuvieran comprometidos.  Nuestra investigación nos permitió establecer docenas de direcciones de correo electrónico registradas por los operadores de Turla para esta campaña y utilizadas para obtener datos de víctimas extraídas. </p><br><h2>  1. Puntos clave </h2><br><p>  La puerta trasera de Outlook de Turla Group tiene dos funciones. </p><br><p>  En primer lugar, es el robo de cartas salientes que se envían al atacante.  Afecta principalmente a Microsoft Outlook, pero también es relevante para The Bat !, popular en Europa del Este. </p><br><p>  En segundo lugar, el uso de letras como capa de transporte de su protocolo C&amp;C.  Los archivos solicitados a través del comando de puerta trasera se extraen en documentos PDF especialmente creados como un archivo adjunto a las letras.  Los comandos de puerta trasera también se envían en archivos PDF adjuntos.  Esto permite el secreto.  Es importante tener en cuenta que los atacantes no explotan ninguna vulnerabilidad en los lectores de PDF o Microsoft Outlook.  El software malicioso puede decodificar datos de documentos PDF e interpretarlos como comandos. </p><br><p>  Los objetivos de la campaña son típicos de Turla.  Hemos identificado varias agencias gubernamentales europeas y compañías de defensa comprometidas por esta puerta trasera.  Es probable que los atacantes lo usen para garantizar la persistencia en redes de acceso restringido, donde los firewalls bien configurados u otras herramientas de seguridad de red bloquean efectivamente las comunicaciones tradicionales con servidores C&amp;C a través de HTTP (S).  La figura a continuación enumera las líneas de código de puerta trasera que mencionan algunos dominios de nivel superior del gobierno.  mfa es el dominio del Ministerio de Asuntos Exteriores, .gouv es un subdominio del gobierno francés (.gouv.fr), ocse es la Organización para la Seguridad y la Cooperación en Europa. </p><br><img src="https://habrastorage.org/webt/xt/ix/e9/xtixe9vxop-os9ktobaea5qqdbu.png"><br><p>  <i>Figura 1. Dominios asociados con los servicios públicos encontrados en el código Malvari</i> </p><br><p>  Con base en el análisis y los datos de telemetría, encontramos que esta puerta trasera se ha distribuido en la naturaleza desde al menos 2013.  Como siempre con Turla, no podemos centrarnos en las marcas de tiempo de compilación, ya que generalmente son falsas.  Sin embargo, creemos que las primeras versiones se compilaron antes de 2013, ya que la versión de este año ya estaba bastante avanzada.  Después de eso, encontramos una versión más similar a la base, cuya compilación fue fechada en 2009.  Aún no es posible determinar la fecha exacta de lanzamiento.  La línea de tiempo a continuación se basa en nuestra telemetría y datos de fuentes abiertas: </p><br><p>  <b>2009</b> : Marca de tiempo de compilación (puede ser falsa) de la versión base de la puerta trasera de Outlook.  Solo una instantánea del contenido del correo electrónico. <br>  <b>2013</b> : Mejorado: la puerta trasera puede ejecutar comandos.  Se envían por correo electrónico en formato XML. <br>  <b>2013</b> : ¡La última versión conocida dirigida a The Bat! .. <br>  <b>2016</b> : Mejorado: los equipos se envían como archivos adjuntos en documentos PDF especialmente creados. <br>  <b>2017</b> : Mejorado: una puerta trasera puede crear documentos PDF para extraer datos de un atacante. <br>  <b>Marzo de 2018</b> : informe de compromiso de la red del gobierno alemán. <br>  <b>Abril de 2018</b> : Mejorado: Backdoor puede ejecutar comandos de PowerShell usando Empire PSInject. </p><br><h2>  2. Arquitectura global </h2><br><p>  En versiones recientes, la puerta trasera es una DLL independiente, en la que hay código para la autoinstalación y la interacción con Outlook y The Bat !, clientes de correo electrónico, incluso si solo se implementa la instalación para Outlook.  Puede ser eliminado fácilmente por cualquier componente de Turla que le permita realizar procesos adicionales. </p><br><p>  En esta sección, nuestro análisis se basa en una muestra publicada en el primer semestre de 2017.  Se puede incluir información sobre muestras más antiguas o más nuevas. </p><br><h3>  2.1.  Instalación </h3><br><p>  Para establecer una puerta trasera, los atacantes exportan una DLL llamada Instalar o la registran con regsvr32.exe.  El argumento es el cliente de correo electrónico de destino.  La siguiente figura muestra los posibles valores.  En las últimas versiones, solo se implementa la instalación de Outlook. </p><br><img src="https://habrastorage.org/webt/9g/8r/qm/9g8rqm3z7keq_phkhvlztwzwtyo.png"><br><p>  <i>Figura 2. Posibles argumentos de instalación</i> </p><br><p>  Como no hay una ruta codificada, el archivo DLL se puede ubicar en cualquier parte del disco. </p><br><h4>  2.1.1  Microsoft Outlook </h4><br><p>  Los desarrolladores de Turla confían en el secuestro de objetos COM para garantizar la persistencia del malware.  Este es un método bien conocido utilizado en la naturaleza durante muchos años, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">incluido el grupo Turla</a> .  La esencia del método es redirigir el objeto COM utilizado por la aplicación de destino modificando la entrada CLSID correspondiente en el registro de Windows. </p><br><p>  En nuestro caso, se han realizado los siguientes cambios en el registro de Windows: </p><br><pre><code class="hljs powershell">HKCU\Software\Classes\CLSID\{<span class="hljs-number"><span class="hljs-number">49</span></span>CBB1C7<span class="hljs-literal"><span class="hljs-literal">-97D1</span></span><span class="hljs-literal"><span class="hljs-literal">-485A</span></span><span class="hljs-literal"><span class="hljs-literal">-9EC1</span></span><span class="hljs-literal"><span class="hljs-literal">-A26065633066</span></span>} = Mail Plugin HKCU\Software\Classes\CLSID\{<span class="hljs-number"><span class="hljs-number">49</span></span>CBB1C7<span class="hljs-literal"><span class="hljs-literal">-97D1</span></span><span class="hljs-literal"><span class="hljs-literal">-485A</span></span><span class="hljs-literal"><span class="hljs-literal">-9EC1</span></span><span class="hljs-literal"><span class="hljs-literal">-A26065633066</span></span>}\InprocServer32 = [<span class="hljs-type"><span class="hljs-type">Path</span></span> <span class="hljs-type"><span class="hljs-type">to</span></span> <span class="hljs-type"><span class="hljs-type">the</span></span> <span class="hljs-type"><span class="hljs-type">backdoor</span></span> <span class="hljs-type"><span class="hljs-type">DLL</span></span>] HKCU\Software\Classes\CLSID\{<span class="hljs-number"><span class="hljs-number">49</span></span>CBB1C7<span class="hljs-literal"><span class="hljs-literal">-97D1</span></span><span class="hljs-literal"><span class="hljs-literal">-485A</span></span><span class="hljs-literal"><span class="hljs-literal">-9EC1</span></span><span class="hljs-literal"><span class="hljs-literal">-A26065633066</span></span>}\InprocServer32\ThreadingModel = Apartment HKCU\Software\Classes\CLSID\{<span class="hljs-number"><span class="hljs-number">84</span></span>DA0A92<span class="hljs-literal"><span class="hljs-literal">-25E0</span></span><span class="hljs-literal"><span class="hljs-literal">-11D3</span></span><span class="hljs-literal"><span class="hljs-literal">-B9F7</span></span><span class="hljs-literal"><span class="hljs-literal">-00C04F4C8F5D</span></span>}\TreatAs = {<span class="hljs-number"><span class="hljs-number">49</span></span>CBB1C7<span class="hljs-literal"><span class="hljs-literal">-97D1</span></span><span class="hljs-literal"><span class="hljs-literal">-485A</span></span><span class="hljs-literal"><span class="hljs-literal">-9EC1</span></span><span class="hljs-literal"><span class="hljs-literal">-A26065633066</span></span>}</code> </pre> <br><p>  <code>{84DA0A92-25E0-11D3-B9F7-00C04F4C8F5D}</code> - CLSID capturado.  Corresponde al Administrador de protocolos de Outlook y, en teoría, carga el archivo <code>OLMAPI32.DLL</code> legítimo de Outlook.  <code>{49CBB1C7-97D1-485A-9EC1-A26065633066}</code> no <code>{49CBB1C7-97D1-485A-9EC1-A26065633066}</code> asociado con ningún software conocido.  Este CLSID es arbitrario y se usa solo como marcador de posición para la redirección COM. </p><br><p>  Cuando se completa la modificación, la DLL de puerta trasera se cargará cada vez que Outlook cargue su objeto COM.  Según nuestras observaciones, esto sucede durante el inicio de Outlook. </p><br><p>  La redirección de COM no requiere derechos de administrador, ya que solo se aplica al usuario actual.  Existen medidas de protección para evitar tales redireccionamientos maliciosos.  Según <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MSDN</a> : "Con Windows Vista y Windows Server 2008, si el nivel de integridad del proceso es superior al promedio, el tiempo de ejecución COM ignora la configuración COM del usuario y solo accede a la configuración COM para cada máquina". </p><br><p>  El proceso de Outlook se ejecuta con una integridad media, como se muestra en la imagen a continuación.  Por lo tanto, no está protegido del reenvío de COM para cada usuario. </p><br><img src="https://habrastorage.org/webt/q4/uq/zt/q4uqzt_g3c6vgonoluf_7ttrqpw.png"><br><p>  <i>Figura 3. Nivel de integridad del proceso de Outlook</i> </p><br><p>  Finalmente, el uso de la captura de objetos COM permite que la puerta trasera evite la detección, ya que la ruta a la puerta trasera ( <code>C:\Users\User\Documents\mapid.tlb</code> en nuestro ejemplo) no aparece en la lista de complementos, como se muestra en la siguiente figura. </p><br><img src="https://habrastorage.org/webt/4l/cj/s3/4lcjs3tai1gd5gopfekwd7skjra.png"><br><p>  <i>Figura 4. Lista de complementos de Outlook: mapid.tlb no aparece</i> </p><br><p>  Incluso si el programa malicioso no aparece en la lista de complementos, la API estándar de Microsoft - MAPI (interfaz de programación de aplicaciones de mensajería) se usa para interactuar con Outlook. </p><br><h4>  2.1.2.  El murciélago! </h4><br><p>  Como se especifica en la cronología, las últimas versiones de la puerta trasera ya no incluyen el código de registro para el complemento The Bat! .. Sin embargo, todavía existe todo el código para administrar los buzones y los mensajes.  Si es necesario, se puede configurar manualmente. </p><br><p>  Para registrarse como un complemento para The Bat!  el malware modificó el <code>%appdata%\The Bat!\Mail\TBPlugin.INI</code> .  Esta es una forma legítima de registrar un complemento para The Bat !, algunos complementos (por ejemplo, antispam) también lo usan. </p><br><p>  ¡Después de registrarte cada vez que inicias The Bat!  Se llama a la DLL de puerta trasera.  La siguiente figura muestra cómo la DLL implementa la exportación requerida para los complementos. </p><br><img src="https://habrastorage.org/webt/xq/x7/zs/xqx7zsv5pwjjmhonegcsmpmnwx0.png"><br><p>  <i>Figura 5. Exportación estándar para el complemento Bat!</i> </p><br><h3>  2.2.  Interacción con el cliente de correo. </h3><br><p>  La interacción con el cliente de correo depende del objetivo. </p><br><h4>  2.2.1.  Microsoft Outlook </h4><br><p>  Microsoft admite la interfaz de programación de aplicaciones de mensajería (MAPI), que permite que las aplicaciones <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">interactúen con Outlook</a> .  La puerta trasera de Turla usa esta API para acceder y administrar los buzones de un usuario / usuarios de un sistema comprometido. </p><br><p>  Primero, la puerta trasera se conecta al sistema de mensajería usando MAPILogonEx, como se muestra en la figura. </p><br><img src="https://habrastorage.org/webt/nf/fp/u1/nffpu1duhw9u7rmxytdm1chwpey.png"><br><p>  <i>Figura 6. Inicio de sesión MAPI</i> </p><br><p>  El segundo parámetro (lpszProfileName) está vacío, se establece el indicador <code>MAPI_USE_DEFAULT</code> .  De acuerdo con la documentación: "El subsistema de mensajería debe anular el nombre de perfil predeterminado para el parámetro lpszProfileName. El indicador <code>MAPI_EXPLICIT_PROFILE</code> ignora a menos que lpszProfileName esté NULL o vacío". </p><br><p>  Por el contrario, el indicador <code>MAPI_NEW_SESSION</code> no <code>MAPI_NEW_SESSION</code> establecido.  Según la documentación: "El parámetro <code>lpszProfileName</code> ignora si hay una sesión anterior llamada MapiLogonEx con el indicador <code>MAPI_ALLOW_OTHERS</code> y si el indicador <code>MAPI_NEW_SESSION</code> no <code>MAPI_NEW_SESSION</code> establecido". </p><br><p>  En nuestra opinión, Outlook abre una sesión predeterminada con el indicador <code>MAPI_ALLOW_OTHERS</code> .  Por lo tanto, la puerta trasera utilizará una sesión abierta previamente para obtener acceso al perfil predeterminado del buzón.  Esto explica la falta de una solicitud de nombre de usuario y contraseña al inicializar el complemento de puerta trasera. </p><br><p>  Una vez hecho esto, la puerta trasera tendrá acceso al buzón y podrá administrarlo fácilmente utilizando otras funciones MAPI.  Recorrerá varios almacenes de mensajes, analizará letras y agregará devoluciones de llamada a los mensajes entrantes y salientes.  El archivo de registro muestra este proceso (nombre de usuario y dirección cambiados): </p><br><pre> <code class="hljs pgsql">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; ========= Analyzing msg store ( <span class="hljs-number"><span class="hljs-number">1</span></span> / <span class="hljs-number"><span class="hljs-number">1</span></span> ) ========= Service <span class="hljs-type"><span class="hljs-type">name</span></span>:MSUPST MS Pst <span class="hljs-type"><span class="hljs-type">path</span></span>:C:\Users\[username]\Documents\Outlook Files\[email address].pst Wait main <span class="hljs-keyword"><span class="hljs-keyword">window</span></span> <span class="hljs-keyword"><span class="hljs-keyword">before</span></span> <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-keyword"><span class="hljs-keyword">current</span></span> store <span class="hljs-keyword"><span class="hljs-keyword">Loop</span></span> count = <span class="hljs-number"><span class="hljs-number">46</span></span> This <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> message store PUSH store <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> list &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; _____________ FOLDERS _____________ Setting sink <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> folders <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> stores. ========Process msg store ( <span class="hljs-number"><span class="hljs-number">1</span></span> / <span class="hljs-number"><span class="hljs-number">1</span></span> ) ========= Account: [email address] Successfull <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> sink <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Outbox folder <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">current</span></span> store. Successfull <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> sink <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Inbox folder <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">current</span></span> store.</code> </pre> <br><p>  <code>HrAllocAdviseSink</code> una devolución de llamada en cada bandeja de entrada y <code>HrAllocAdviseSink</code> utilizando la función <code>HrAllocAdviseSink</code> , como se muestra. </p><br><img src="https://habrastorage.org/webt/ud/df/js/uddfjs5ub7qj9n3gxlxslirppcq.png"><br><p>  <i>Figura 7. Registro de una devolución de llamada en la Bandeja de salida</i> </p><br><p>  <b>2.2.1.1.</b>  <b>Bandeja de entrada de devolución de llamada</b> </p><br><p>  La devolución de llamada en la bandeja de entrada registra los metadatos del mensaje entrante, incluidas las direcciones de remitente y destinatario, el asunto y los nombres de los archivos adjuntos.  Ejemplo a continuación (ortografía del desarrollador guardada): </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">RECIVE</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>&gt;{ <span class="hljs-attribute"><span class="hljs-attribute">From</span></span>: sender@example.com To: receiver@example.net Cc: Bcc: Subj: Mail subject Att: an_attachment.pdf }</code> </pre> <br><p>  Luego analiza la carta y los archivos adjuntos sobre el tema de los equipos de los atacantes.  Esta función se describe en la sección 2.3. </p><br><p>  Finalmente, intercepta los NDR al verificar los mensajes entrantes con la dirección de correo electrónico del operador.  Cualquier carta que contenga la dirección del operador será rechazada.  Esto puede causar problemas si la víctima sospecha que algo está mal y se pone en contacto con el servicio de soporte sin ver las respuestas. </p><br><p>  <b>2.2.1.2.</b>  <b>Devolución de llamada en la bandeja de salida</b> </p><br><p>  Al igual que en la bandeja de entrada, la bandeja de salida registra los metadatos de todos los correos electrónicos enviados.  Se genera el siguiente registro (se cambia la dirección del operador): </p><br><pre> <code class="hljs css">21<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:57</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:56</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SEND</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>{ <span class="hljs-attribute"><span class="hljs-attribute">From</span></span>: To: recipient@example.com Cc: Bcc: Subj: My title Att: [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-string"><span class="hljs-string">"last_presentation.pdf"</span></span> } 21<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:57</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:56</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Sending</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">data</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">message</span></span> 21<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:57</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:56</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Message</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ENTRYID</span></span>: <span class="hljs-selector-attr"><span class="hljs-selector-attr">[Message ENTRYID]</span></span> 21<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:57</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:56</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Data</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">message</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">was</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">send</span></span>. <span class="hljs-selector-tag"><span class="hljs-selector-tag">To</span></span>: <span class="hljs-selector-attr"><span class="hljs-selector-attr">[redacted]</span></span>@<span class="hljs-keyword"><span class="hljs-keyword">gmx</span></span>[.]<span class="hljs-keyword"><span class="hljs-keyword">com</span></span> From: Subj: My title <span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">57</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span> Set last time. <span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">57</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span> Spawned thread for cleaning up outgoing messages (id <span class="hljs-number"><span class="hljs-number">2848</span></span>) <span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span> Ending work, client: Outlook <span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span> Number of messages to remove: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span> Message ENTRYID: [Message ENTRYID] <span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span> DeleteMessages executed successfully. <span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span> Number of not removed messages: <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p>  Puede notar que reenvía todos los mensajes salientes a la dirección de los atacantes, <code>[…]@gmx[.]com</code> .  GMX: un popular servicio de correo electrónico gratuito;  los atacantes probablemente lo eligieron, porque las organizaciones generalmente no bloquean el dominio gmx.com. </p><br><p>  Esta dirección de correo electrónico está codificada en la muestra que estudiamos, como se muestra en la imagen a continuación.  Sin embargo, se puede actualizar utilizando una de las funciones de puerta trasera.  Los atacantes parecen estar registrando al menos una dirección de correo electrónico para cada objetivo <br>  organizaciones que usan el formato <code>firstname.lastname@gmx[.]com</code> con el nombre del empleado real.  Esto evita la detección, ya que a menudo es difícil distinguir dicha dirección del buzón personal de un empleado real.  En el momento del análisis de la muestra en junio de 2018, la dirección no estaba disponible. </p><br><img src="https://habrastorage.org/webt/9c/tr/-d/9ctr-dcusp0p35kcuhiqw4pypns.png"><br><p>  <i>Figura 8. Dirección codificada de los operadores</i> </p><br><p>  La puerta trasera envía informes a la dirección de los operadores a ciertos intervalos.  El informe incluye identificadores únicos, incluida la dirección MAC, el archivo de registro completo y los resultados del comando, si los hay.  Luego, encripta los datos usando MISTY1, como se describe más adelante en la sección 2.3.2.2, y crea un archivo PDF válido con contenido encriptado.  Antes de este blob de datos cifrados, el documento contiene una imagen blanca 1x1 en formato jpeg, codificada en un programa malicioso.  Esto le permite crear un PDF válido que, cuando se abre, muestra solo una página en blanco. </p><br><p>  Finalmente, la puerta trasera adjunta el PDF y envía un correo electrónico a los atacantes.  La siguiente figura es un ejemplo de un archivo PDF creado por una puerta trasera. </p><br><img src="https://habrastorage.org/webt/d4/6f/yx/d46fyxd9n7e-ziu9jwjxdtedqke.png"><br><p>  <i>Figura 9. Comienzo de un documento PDF creado por una puerta trasera para filtrar datos</i> </p><br><p>  El informe se envía utilizando la función de devolución de llamada en la bandeja de salida.  Esto significa que la carta se irá al mismo tiempo que envía mensajes de usuario legítimos.  La puerta trasera no puede enviar cartas con datos robados en un momento inusual para el usuario y, por lo tanto, evita la detección.  Gracias al sigilo, este mecanismo de control y control es muy difícil de detectar en la naturaleza. </p><br><h4>  2.2.2.  Disfrazar el comportamiento malicioso del usuario </h4><br><p>  Dado que la puerta trasera actúa cuando el usuario trabaja con la computadora y Outlook, el malware intenta ocultar la actividad maliciosa, por ejemplo, los mensajes entrantes de los operadores. </p><br><p>  En primer lugar, una puerta trasera siempre elimina el correo enviado o recibido de los operadores.  Como se muestra en la figura siguiente, durante unos segundos puede ver que ha aparecido un nuevo mensaje que, sin embargo, no aparece en el buzón. </p><br><img src="https://habrastorage.org/webt/o7/pc/wh/o7pcwhrtwemk2qfqrfdtgjb6p0o.png"><br><p>  <i>Figura 10. Mensaje no leído</i> </p><br><p>  En segundo lugar, la puerta trasera intercepta la <code>CreateWindowsEx</code> , como se muestra en las siguientes figuras.  Esto evita la creación de ventanas como NetUIHWND que Outlook usa para las notificaciones que aparecen en la esquina inferior derecha de la pantalla. </p><br><img src="https://habrastorage.org/webt/7y/wn/xq/7ywnxqshbevin9-ncsw8lhprkvo.png"><br><p>  <i>Figura 11. Configuración de la captura de la función CreateWindowsEx</i> </p><br><img src="https://habrastorage.org/webt/ki/1_/zr/ki1_zrks5vaspkm-bpz2j-z9asu.png"><br><p>  <i>Figura 12. Intercepción de CreateWindowsEx</i> </p><br><p>  La siguiente figura muestra un ejemplo de la ventana NetUIHWND, que generalmente se muestra en el escritorio cuando se recibe un nuevo mensaje.  Como resultado de la intercepción de <code>CreateWindowEx</code> , no se muestra una notificación cuando los atacantes envían una carta a la puerta trasera. </p><br><img src="https://habrastorage.org/webt/bd/5n/3b/bd5n3bq_pijmhlosvf6muvjcyjq.png"><br><p>  <i>Figura 13. Notificación de mensaje nuevo</i> </p><br><h4>  2.2.3.  El murciélago! </h4><br><p>  A pesar de que la función de registro del complemento para The Bat!  ya no existe, hay un código heredado que realiza las mismas funciones que para Outlook usando la API The Bat! </p><br><p>  Como se muestra en la figura siguiente, la puerta trasera utiliza el canal de comunicación con The Bat! Para recibir información del usuario, leer y enviar cartas.  Sin embargo, todas las demás funciones, por ejemplo, utilizadas para registrar mensajes o ejecutar comandos, son idénticas a Outlook. </p><br><img src="https://habrastorage.org/webt/iy/qb/ub/iyqbubrelp4uwudy8n4gby7n6lq.png"><br><p>  <i>Figura 14. El canal Bat!</i> </p><br><h3>  2.3.  Puerta trasera </h3><br><p>  Como se muestra en la sección anterior, el malware puede procesar y filtrar mensajes.  Al mismo tiempo, es una puerta trasera completamente funcional impulsada por correo electrónico que puede funcionar independientemente de cualquier otro componente de Turla.  La puerta trasera no necesita una conexión permanente a Internet y puede funcionar en cualquier computadora que envíe mensajes a direcciones externas.  Esto es útil en redes estrictamente controladas, por ejemplo, mediante el filtrado del tráfico de Internet.  Además, incluso si la dirección de correo electrónico de los atacantes está inactiva, pueden recuperar el control enviando un comando desde una dirección diferente.  En este caso, la carta también estará oculta para el usuario, ya que contendrá comandos interpretados por la puerta trasera.  Por lo tanto, una puerta trasera es tan tolerante a fallas como un rootkit que verifica el tráfico de red entrante. </p><br><h4>  2.3.1.  Formato pdf </h4><br><p>  A principios de 2018, varios medios de comunicación declararon que los operadores de Turla usan archivos adjuntos de correo electrónico para administrar computadoras infectadas.  Los medios tenían razón.  Un análisis de la puerta trasera de Turla Outlook reveló cómo envía e interpreta comandos. </p><br><p>  Los comandos se envían por correo electrónico utilizando archivos PDF especialmente creados.  No pudimos encontrar un PDF de muestra real con comandos, pero estos son probablemente documentos PDF válidos, así como archivos PDF creados por la puerta trasera para exfiltración. </p><br><p>  A partir de documentos PDF, una puerta trasera puede restaurar lo que los operadores llaman un contenedor en revistas.  Este es un blob con un formato especial que contiene comandos cifrados para la puerta trasera.  La siguiente figura muestra el procedimiento para extraer este contenedor.  Técnicamente, la aplicación no tiene que ser un documento PDF válido.  El único requisito es que incluya el contenedor en el formato correcto. </p><br><img src="https://habrastorage.org/webt/hb/r_/yf/hbr_yfy47qewou5f_tqbrpdn5ck.png"><br><p>  <i>Figura 15. Extracción del contenedor de comandos del PDF</i> </p><br><p>  El contenedor tiene una estructura compleja con muchos controles diferentes.  Podría diseñarse para evitar errores de comunicación, pero creemos que la estructura se creó principalmente para contrarrestar la ingeniería inversa.  La estructura del contenedor se muestra en la figura a continuación. </p><br><img src="https://habrastorage.org/webt/ud/aa/6w/udaa6wvubnjskhmfrgsoalfke70.png"><br><p>  <i>Figura 16. Estructura del contenedor de comandos</i> </p><br><p>  Inmediatamente antes del vector de inicialización, hay una lista de descriptores de comandos.  Se presentan diferentes valores de ID en la tabla: </p><br><img src="https://habrastorage.org/webt/jy/sg/5o/jysg5opuoyhwir5hre-xi9quhxq.png"><br><p><br>  Los descriptores de ID 2 y 4 se utilizan para extraer las funciones de cifrado y descompresión, como se muestra en la siguiente figura.  Sin embargo, el programa malicioso implementa solo un algoritmo de cifrado y un algoritmo de compresión.  Por lo tanto, el único propósito de estos campos es complicar el análisis de la puerta trasera. </p><br><img src="https://habrastorage.org/webt/h8/sh/gu/h8shgunmwafcbx6h1shccn9-ndo.png"><br><p>  <i>Figura 17. Funciones de descompresión y descifrado compensadas</i> </p><br><p>  Los equipos están en la última parte de la estructura.  Se cifran con MISTY1 y se comprimen con bzip2.  Puede haber muchos comandos diferentes en el mismo archivo PDF, y cada uno puede tener varios argumentos. </p><br><h4>  2.3.2.  Criptografía </h4><br><p>  Aquí describimos los algoritmos de cifrado utilizados. </p><br><p>  <b>2.3.2.1.</b>  <b>Cifrado XOR</b> </p><br><p>  Parte del contenedor (comenzando con el primer CRC32) se cifra con XOR con el flujo de bytes generado por la función definida por el usuario.  Se necesita una semilla, que se pasa a <code>srand</code> para generar un segundo número llamando a rand.  La segunda semilla se usa en la función que se muestra a continuación como argumento para los datos en XOR. </p><br><pre> <code class="hljs powershell">int __usercall F_bytestream_xor<span class="hljs-selector-tag"><span class="hljs-selector-tag">@</span></span>&lt;eax&gt;(unsigned int len<span class="hljs-selector-tag"><span class="hljs-selector-tag">@</span></span>&lt;edx&gt;, int ciphertext<span class="hljs-selector-tag"><span class="hljs-selector-tag">@</span></span>&lt;ecx&gt;, unsigned int seed) { unsigned int v3; // ebx int v4; // esi unsigned int v5; // edi int result; // eax unsigned int v7; // ecx char *v8; // edx unsigned int v9; // esi byte key[<span class="hljs-number"><span class="hljs-number">512</span></span>]; // [<span class="hljs-type"><span class="hljs-type">esp</span></span>+<span class="hljs-type"><span class="hljs-type">Ch</span></span>] [<span class="hljs-type"><span class="hljs-type">ebp</span></span>-<span class="hljs-number"><span class="hljs-number">204</span></span><span class="hljs-type"><span class="hljs-type">h</span></span>] char *v11; // [<span class="hljs-type"><span class="hljs-type">esp</span></span>+<span class="hljs-number"><span class="hljs-number">20</span></span><span class="hljs-type"><span class="hljs-type">Ch</span></span>] [<span class="hljs-type"><span class="hljs-type">ebp</span></span>-<span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-type"><span class="hljs-type">h</span></span>] v3 = len; v11 = (char *)ciphertext; srand(seed); v4 = <span class="hljs-number"><span class="hljs-number">0</span></span>; v5 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { result = rand(); *(_DWORD *)&amp;key[<span class="hljs-number"><span class="hljs-number">4</span></span> * <span class="hljs-type"><span class="hljs-type">v5</span></span>++] = result; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ( v5 &lt; <span class="hljs-number"><span class="hljs-number">128</span></span> ); v7 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !v3 ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; v8 = v11; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { v8[<span class="hljs-type"><span class="hljs-type">v7</span></span>] ^= key[<span class="hljs-type"><span class="hljs-type">v4</span></span>]; v9 = v4 + <span class="hljs-number"><span class="hljs-number">1</span></span>; result = -(v9 &lt; <span class="hljs-number"><span class="hljs-number">512</span></span>); v4 = result &amp; v9; ++v7; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ( v7 &lt; v3 ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p>  <strong>2.3.2.2.</strong>  <strong>MISTY1</strong> </p><br><p>  Los desarrolladores de Turla prefieren usar algoritmos de cifrado menos comunes o modificados en sus puertas traseras: </p><br><ul><li>  en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">carbono y serpiente</a> - CAST-128 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Gazer</a> - implementación personalizada de RSA </li><li>  en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mosquito</a> - Blum Blum Shub como generador de números aleatorios para el flujo de bytes XOR </li><li>  en rootkit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Uroburos</a> - una versión modificada de ThreeFish </li></ul><br><p>  En la puerta trasera de Outlook, implementaron MISTY1, un algoritmo de cifrado simétrico desarrollado por los criptógrafos de Mitsubishi Electric en 1995.  Tiene las siguientes propiedades: </p><br><ul><li>  es simétrico </li><li>  tiene una clave de 128 bits </li><li>  utiliza dos tablas precalculadas: s7 (128 bytes) y s9 (2048 bytes) </li><li>  utiliza tres funciones: FL, FO, FI <br>  o FL realiza algunas operaciones XOR entre la escritura de bytes y la clave extendida <br>  o FO realiza operaciones XOR entre el registro y la clave extendida, y también usa FI <br>  o FI realiza una expansión no lineal utilizando s7 y s9 </li><li>  opera con bloques de 64 bits </li><li>  realiza ocho ciclos (ciclo - llamar a la función FO) </li><li>  utiliza el cifrado Feistel </li></ul><br><img src="https://habrastorage.org/webt/jf/d4/_i/jfd4_iplej2iexnsc2pkxkeracy.png"><br><p>  <em>Figura 18. MISTY1</em> </p><br><img src="https://habrastorage.org/webt/08/qc/_h/08qc_hxb2xju1yxbfsqmizuocwy.png"><br><p>  <em>Figura 19. Ocho ciclos para el cifrado en bloque</em> </p><br><p>  Los desarrolladores de Turla modificaron ligeramente el algoritmo: </p><br><ul><li>  agregó dos operaciones XOR a la función FI como se muestra en la figura a continuación </li><li>  Se genera una clave de 128 bits a partir de dos claves codificadas de 1024 bits más un vector de inicialización de 2048 bits </li><li>  cambiaron las tablas s7 y s9.  Esto interrumpe el funcionamiento de todas las herramientas que reconocen algoritmos criptográficos basados ​​en valores de tabla s.  Tanto las tablas S modificadas como las originales contienen los mismos valores, simplemente se barajan </li></ul><br><img src="https://habrastorage.org/webt/74/ge/qg/74geqg_tqugk_mgizdhn07hrcp0.png"><br><p>  <em>Figura 20. Comparación de funciones FI (original a la izquierda, desarrollo de Turla a la derecha)</em> </p><br><h4 id="233-funkcii">  2.3.3.  Las funciones </h4><br><p>  La puerta trasera tiene muchas funciones, desde exfiltrar archivos hasta ejecutar comandos.  La descripción de varias funciones se encuentra en la tabla a continuación. </p><br><img src="https://habrastorage.org/webt/zk/ij/od/zkijodwltfd9en0cxuya189_758.png"><br><p><br>  Para la función 0x29, los desarrolladores de Turla copiaron el código del proyecto Empire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PSInject</a> .  Esto le permite ejecutar código de PowerShell en un archivo ejecutable especial llamado PowerShell Runner sin llamar a <code>powershell.exe</code> .  La principal ventaja es que el malware aún puede ejecutar comandos de PowerShell incluso si el archivo <code>powershell.exe</code> está bloqueado en una computadora comprometida. </p><br><p>  Después de analizar la puerta trasera, pudimos crear un documento PDF que puede ser interpretado con éxito por un programa malicioso.  La siguiente figura muestra la ejecución de MessageBox y el lanzamiento de la calculadora ( <code>calc.exe</code> ) después de que Outlook haya recibido un correo electrónico con este PDF.  Esto demuestra que la puerta trasera, probablemente destinada a recibir comandos en archivos adjuntos PDF, es funcional y puede ser controlada por cualquiera que comprenda este formato personalizado. </p><br><img src="https://habrastorage.org/webt/-t/xc/lr/-txclr3f050ahxdxykqgnimnr5g.png"><br><p>  <em>Figura 21. Ejecución de los comandos especificados en el documento PDF</em> </p><br><h3 id="24-dopolnitelnye-funkcii">  2.4.  Funciones adicionales </h3><br><p>  Además de las capacidades de puerta trasera implementadas como un complemento para el cliente de correo electrónico, el malware tiene otras funciones. </p><br><h4 id="241-virtualnaya-faylovaya-sistema">  2.4.1  Sistema de archivos virtual </h4><br><p>  El programa malicioso no utiliza ningún archivo de configuración, pero admite un pequeño sistema de archivos virtual en la <code>HKCU\Software\Microsoft\Windows\CurrentVersion\Settings\ZonePolicy\</code> registro de Windows <code>HKCU\Software\Microsoft\Windows\CurrentVersion\Settings\ZonePolicy\</code> .  Otras puertas traseras de Turla, como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Gazer</a> , también almacenan el sistema de archivos virtual en el registro de Windows.  Pudimos determinar algunos valores de registro, como se muestra en la siguiente tabla. </p><br><img src="https://habrastorage.org/webt/gi/g-/wt/gig-wt39jwfeznw0kpe7qjzvhpm.png"><br><h4 id="242-zhurnaly">  2.4.2  Revistas </h4><br><p>  Como se mencionó anteriormente, el programa guarda un diario, que se envía regularmente al operador por correo electrónico en un documento PDF creado especialmente.  Se almacena en <code>%appdata%/Microsoft/Windows/scawrdot.db</code> y se cifra con una clave XOR de 512 bytes codificada.  El archivo de registro se borra después de cada exfiltración a los operadores.  Por lo tanto, durante el examen forense sería imposible ver todas las acciones pasadas de la puerta trasera, solo la última. </p><br><p>  Los registros son bastante informativos, permiten a los operadores de Turla rastrear acciones de puerta trasera.  La siguiente figura muestra un ejemplo de un registro descifrado. </p><br><img src="https://habrastorage.org/webt/yo/q_/z6/yoq_z6lfqy5b3ozw3f4lh6reqr4.png"><br><p>  <em>Figura 22. Archivo de registro descifrado</em> </p><br><h2 id="3-vyvody">  3. Conclusiones </h2><br><p>  El informe mostró que los desarrolladores de Turla tienen suficientes ideas cuando desarrollan puertas traseras.  Hasta donde sabemos, Turla es el único grupo de ciberespionaje que actualmente utiliza una puerta trasera que se gestiona completamente por correo electrónico, o más bien, archivos adjuntos en PDF. </p><br><p>  La puerta trasera de Turla no es la primera en utilizar el buzón real de la víctima para recibir comandos y extraer datos.  Sin embargo, esta es la primera puerta trasera que se aprende utilizando la API estándar (MAPI) para interactuar con Microsoft Outlook.  Esta es una mejora significativa en comparación con la versión anterior que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">estudiamos</a> , que utilizaba Outlook Express.  Por el contrario, la nueva puerta trasera de Turla funciona incluso con las últimas versiones de Outlook. </p><br><p>   ,  ,     ,         ,  Turla   .      ,   Uroburos,      . </p><br><p>   ,         Turla,  ,    .     ,  ,     .  ,      -   ,        . </p><br><p>    ,     PDF-,     Turla,      ,     . </p><br><p>  ESET     Turla,        . </p><br><p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GitHub</a> . </p><br><h2 id="4-indikatory-komprometacii"> 4.   </h2><br><h3 id="41-heshi">  4.1.  Hashes </h3><br><p> 8A7E2399A61EC025C15D06ECDD9B7B37D6245EC2 —  Win32/Turla.N;   (GMT) 2013-06-28 14:15:54 <br> F992ABE8A67120667A01B88CD5BF11CA39D491A0 —  Win32/Turla.AW; GMT 2014-12-03 20:50:08 <br> CF943895684C6FF8D1E922A76B71A188CFB371D7 —  Win32/Turla.R; GMT 2014-12-03 20:44:27 <br> 851DFFA6CD611DC70C9A0D5B487FF00BC3853F30 —  Win32/Turla.DA; GMT 2016-09-15 08:14:47 </p><br><h3 id="42-imena-faylov">  4.2.   </h3><br><p> %appdata%/Microsoft/Windows/scawrdot.db <br> %appdata%/Microsoft/Windows/flobcsnd.dat <br> mapid.tlb </p><br><h3 id="43-klyuchi-reestra"> 4.3.   </h3><br><p> HKCU\Software\Microsoft\Windows\CurrentVersion\Settings\ZonePolicy\ <br> HKCU\Software\Classes\CLSID{49CBB1C7-97D1-485A-9EC1-A26065633066} <br> HKCU\Software\Classes\CLSID{84DA0A92-25E0-11D3-B9F7-00C04F4C8F5D} </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es421399/">https://habr.com/ru/post/es421399/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es421389/index.html">Separación de poderes administrativos en Zimbra</a></li>
<li><a href="../es421391/index.html">HackThings: un gran hackathon en Internet de las cosas del 7 al 9 de septiembre en Skoltech</a></li>
<li><a href="../es421393/index.html">Abandoned Mailchimp Basket: A Guide for the Lazy</a></li>
<li><a href="../es421395/index.html">Informe del Club de Roma 2018, Capítulo 3.7: "Clima: buenas noticias, pero grandes problemas"</a></li>
<li><a href="../es421397/index.html">Lanza la Mini AI Cup # 3. Batalla de máquinas en espacios reducidos</a></li>
<li><a href="../es421401/index.html">Anatomía de los sistemas de recomendación. Parte dos</a></li>
<li><a href="../es421403/index.html">Semana de la seguridad 32: drama de Fortnite-Android</a></li>
<li><a href="../es421407/index.html">Reunión técnica en San Petersburgo el 13 de septiembre: cómo hacer grandes cambios en el backend</a></li>
<li><a href="../es421409/index.html">Espiar cosas: guardar un secreto</a></li>
<li><a href="../es421411/index.html">Introducción a los módulos Go</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>