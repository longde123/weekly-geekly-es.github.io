<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📰 🌩️ 🏴󠁧󠁢󠁷󠁬󠁳󠁿 ShIoTiny：湿室通风（示例项目） 📶 🦐 🔂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="要点或本文的主题 
 我们将继续介绍关于ShIoTiny的系列文章， 这是一种基于ESP8266芯片的可视可编程控制器。 

 本文介绍了一个浴室或其他潮湿房间中的通风控制项目的示例，该示例关于如何为ShIoTiny构建程序。 

 该系列中的先前文章。 
 ShIoTiny：小型自动化，物联网或“...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ShIoTiny：湿室通风（示例项目）</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464485/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ue/so/ox/uesoox7zwrguyei6o5m_ndp2ufw.jpeg"></div><br><h4> 要点或本文的主题 </h4><br> 我们将继续介绍关于<b>ShIoTiny</b>的系列文章， <b>这</b>是一种基于<b>ESP8266</b>芯片的可视可编程控制器。 <br><br> 本文介绍了一个浴室或其他潮湿房间中的通风控制项目的示例，该示例关于如何为<b>ShIoTiny</b>构建程序。 <br><br><h4> 该系列中的先前文章。 </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ShIoTiny：小型自动化，物联网或“假期前六个月”</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ShIoTiny：绘图程序的节点，链接和事件或功能</a> <br><br><h4> 参考文献 </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b>ShIoTiny</b>项目<b>现场</b></a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">二进制固件，控制器电路和文档</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">节点说明和描述</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">设置MQTT经纪人cloudmqtt.com</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">适用于Android的MQTT仪表板控制面板</a> <br><a name="habracut"></a><br><h4> 引言 </h4><br> 经验之外没有理解。 这是经世世代代检验的真理。 因此，学习实践技能没有比尝试自己做某事更好的了。 举例说明可以做什么和不值得尝试的示例，这里会派上用场。 当然，其他人的错误并不能阻止他们自己的错误的发生，但是可以帮助减少后者的数量。 <br><br> 前几篇文章读者的提问和来信促使我做一个小项目，作为通风控制的一个例子，以展示ShIoTiny节点如何工作。 <br><br>  <b>ShIoTiny</b>控制器<b>出现</b>的最初想法- <b>抽水</b>和灌溉站-远非适合所有人，并且会很有趣。 因此，我以每个人都可以理解且有用的通风控制系统为例。 <br><br> 我<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">会</a>说这个项目的想法不是我的，但<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">我是从这里得到的</a> ，然后将其改编为<b>ShIoTiny</b> 。 <br><br><h4> 首先了解你想要什么 </h4><br> 耕种过程是无止境的。 正是这个财产毁了许多好主意和项目。 开发人员并没有继续改善它，而是发布了一个理想的东西，而不是一个理想的东西。 然后他完善了它，直到竞争对手绕开它，发布了一个即使不是理想的（而且经常是坦率地说）的但可行的解决方案。 <br><br> 因此，知道在何处结束该项目非常重要。 或者换句话说，有必要从一开始就确定我们想要在项目结束时得到什么。 在俄语中，为草拟一份仅用于描述创建方式的文档，有一个美丽而简短的“计划”一词，由于某些原因，弱智的翻译和有缺陷的经理最近开始称其为“路线图”。 好吧，上帝保佑他们。 <br><br> 我们的计划将是这样。 假设存在一个湿度有时会急剧增加的房间。 例如，例如浴室或厨房。 湿度是一件令人不愉快的事情，应对它的方法与世界一样古老：为房间通风。 有很多播出方法。 但是，也许我们会拒绝异国情调和老式的方式，例如用网布遮住黑人，并停止通常的拥护者。 风扇价格便宜，在我们的地区更容易找到它们。 <br><br> 简而言之，我们要控制风扇：分别打开和关闭风扇。 更确切地说，我们希望它在必要时打开和关闭。 <br><br> 还需要确定：在什么条件下风扇应该打开，在什么条件下风扇应该关闭。 <br><br> 这里的一切都很明显：如果湿度高于预定极限，则风扇打开并吸入空气； 湿度已恢复正常-风扇关闭。 <br><br> 细心的读者会立即注意到“给予”一词。 谁给的？ 如何预设？ <br><br> 有几种设置阈值湿度的方法。 我们将考虑其中两个：第一个-在可变电阻的帮助下，第二个-通过MQTT协议通过网络。 这些方法中的每一种都有优点和缺点，将在后面讨论。 <br><br> 对于那些不了解的人，我将解释“阈值湿度”是指湿度水平，如果超过该水平，则需要安装风扇。 <br><br> 下一个问题是是否赋予用户直接打开风扇的权利？ 也就是说，无论湿度高低，只需按一下按钮？ 我们将提供这样的机会。 毕竟，不仅需要具有高湿度的风扇，而且还需要风扇以将例如难闻的气味从房间中移除，这种气味通常被称为“臭味”。 <br><br> 因此，我们了解了我们想要什么，甚至了解了它如何工作。 我们简要列出了通风控制系统的所有功能： <br><br><ul><li> 设置湿度阈值（两个选项）； </li><li> 湿度测量； </li><li> 自动包含风扇； </li><li> 自动关闭风扇； </li><li> 手动安装风扇（按一下按钮）。 </li></ul><br> 因此，计划很明确。 有必要在我们的程序中实现上述所有功能。 根据该“计划”，我们将采取行动。 首先，绘制设备的框图。 <br><br><h4> 设备框图 </h4><br> 一般来说，我们将有两个这样的方案。 第一种是通过可变电阻设置阈值水分含量的选项。 第二种方案是通过MQTT协议通过网络设置阈值湿度水平的选项。 <br><br> 但是，由于这些电路仅相差一个元素-可变电阻器“设定阈值湿度水平”，因此我们将仅绘制一个结构图。 当然，根据GOST的结构方案看起来有所不同。 但我们的重点不是野牛工程师，而是年轻的一代。 因此，可见性更为重要。 <br><br><img src="https://habrastorage.org/webt/ut/qh/db/utqhdblfgdlmsv0rkcgqxaztvo8.jpeg"><br><br> 那么我们在图片中看到了什么？ 风扇连接到<b>ShIoTiny</b>控制器的<b>Relay1</b>继电器。 我提请您注意以下事实：风扇是生活在高压下的装置。 因此，如果有人自己做，请小心。 也就是说，至少在将手指或测量仪器伸入电路之前，至少断开风扇的连接。 第二点。 如果您的风扇的功率超过<b>250W</b> ，则不要仅通过启动器将其直接连接到<b>ShIoTiny</b> 。 <br><br> 我们弄清楚了风扇。 现在，风扇的“手动打开”按钮。 它连接到输入<b>Input1</b> 。 没有更多要解释的了。 <br><br> 温湿度传感器<b>DHT-11</b> （或<b>DHT-22</b>或其类似物）。 要连接它， <b>ShIoTiny</b>控制器上提供了一个特殊的输入。 如图所示，连接这种传感器也不会出现问题。 <br><br> 最后，可变电阻设置阈值湿度水平。 更准确地说，是一个由可变电阻和恒定电阻组成的分压器。 它的连接没有问题，但我将向您说明<b>ESP8266</b>的内置ADC的最大电压为1伏。 因此，需要约5倍的分压器。 <br><br> 再次提醒您，如果使用MQTT协议通过网络设置阈值湿度水平，则不需要此分隔器。 <br><br> 我们将开始在ElDraw ShIoTiny编辑器中草拟设备的算法。 如何到达那里，在此编辑器中，您可以阅读本文前面的内容或说明中的链接，该链接位于文章的开头。 <br><br><h4> 选项一，最简单 </h4><br> 让我们从一个简单的<b>例子</b>开始：在给定时间内超过湿度阈值<b>时</b> ，打开<b>Relay1</b>继电器。 <br><br><img src="https://habrastorage.org/webt/un/8e/kd/un8ekdrb8cy8zvbc6e_ae2ygwyw.png"><br><br> 如您所见，没有什么复杂的：只有四个节点，不包括注释节点。  <b>DHT11</b>实际上是一个温度和湿度传感器（可以更改为<b>DHT22</b> ）。 <br><br>  <b>CONST常数</b>是阈值水分含量，以百分比为单位。 <br><br> 比较器-一个节点，比较两个数字，如果满足指定条件，则将输出设置为1，如果不满足条件，则将输出设置为0。 <br><br> 在我们的情况下，此条件将为<b>A&gt; B</b> ，其中<b>A</b>是传感器测得的湿度水平，而<b>B</b>是相同湿度的阈值水平。 <br><br> 一旦测得的湿度水平（ <b>A</b> ）超过阈值湿度水平（ <b>B</b> ），比较器<b>A&gt; B</b>的输出将立即出现1，并且继电器将打开。 相反，一旦湿度水平恢复正常（即<b>A &lt;= B</b> ），则立即在比较器<b>A&gt; B</b>的输出端出现0，并且继电器将关闭。 <br><br> 一切都清楚了吗？ 对于不是这样的人-请重新阅读或查看说明中节点的操作说明。 <br><br> 我注意到， <b>DHT11</b>传感器的数据大约每10秒更新一次。 因此，继电器打开和关闭的频率不会超过每10秒一次。 <br><br> 一切都很好，但是我们想使用可变电阻器来设置阈值湿度水平。 没有比这容易的事了！ <br><br><img src="https://habrastorage.org/webt/ez/qe/oi/ezqeoioucwwf0nm90o2sibwizj0.png"><br><br> 只需将常数节点替换为ADC节点即可。 毕竟，我们将分压器与可变电阻器连接到了ADC。 <br><br>  ADC输入端的电压在0至1伏之间变化。 但是传感器输出处的湿度从0到100％不等。 我们如何比较它们？ 一切都很简单。  <b>ShIoTiny中</b>的ADC节点不仅可以测量输入电压，而且还知道如何<i><b>缩放和移动它</b></i> 。 <br><br> 也就是说，在ADC1节点（ADC）的输出处，将存在一个由以下公式计算的<b>X</b>值： <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>X</mi><mo>=</mo><mi>k</mi><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>n</mi></mrow></msub><mo>+</mo><mi>b</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.014ex" height="2.419ex" viewBox="0 -780.1 7755.9 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgV8X47FFDPLRUV37iBaSRRlLWBjw#MJMATHI-58" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgV8X47FFDPLRUV37iBaSRRlLWBjw#MJMAIN-3D" x="1130" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgV8X47FFDPLRUV37iBaSRRlLWBjw#MJMATHI-6B" x="2186" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgV8X47FFDPLRUV37iBaSRRlLWBjw#MJMATHI-63" x="2958" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgV8X47FFDPLRUV37iBaSRRlLWBjw#MJMATHI-64" x="3391" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgV8X47FFDPLRUV37iBaSRRlLWBjw#MJMATHI-6F" x="3915" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgV8X47FFDPLRUV37iBaSRRlLWBjw#MJMATHI-74" x="4400" y="0"></use><g transform="translate(4762,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgV8X47FFDPLRUV37iBaSRRlLWBjw#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgV8X47FFDPLRUV37iBaSRRlLWBjw#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgV8X47FFDPLRUV37iBaSRRlLWBjw#MJMATHI-6E" x="345" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgV8X47FFDPLRUV37iBaSRRlLWBjw#MJMAIN-2B" x="6325" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgV8X47FFDPLRUV37iBaSRRlLWBjw#MJMATHI-62" x="7326" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>X</mi><mo>=</mo><mi>k</mi><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>n</mi></mrow></msub><mo>+</mo><mi>b</mi></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> X = k \ cdot u_ {in} + b </script></p> 在哪里 <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>n</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.116ex" height="1.817ex" viewBox="0 -520.7 1341.4 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgV8X47FFDPLRUV37iBaSRRlLWBjw#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgV8X47FFDPLRUV37iBaSRRlLWBjw#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgV8X47FFDPLRUV37iBaSRRlLWBjw#MJMATHI-6E" x="345" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>n</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-2"> u_ {in} </script>  -ADC输入端的电压（从0到1V）；  <b>k-</b>范围（ADC范围）和<b>b-</b>偏移（ADC偏移）。 因此，如果设置<b>k = 100</b>且<b>b = 0</b> ，则在更改时 <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>n</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.116ex" height="1.817ex" viewBox="0 -520.7 1341.4 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgV8X47FFDPLRUV37iBaSRRlLWBjw#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgV8X47FFDPLRUV37iBaSRRlLWBjw#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgV8X47FFDPLRUV37iBaSRRlLWBjw#MJMATHI-6E" x="345" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>n</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-3"> u_ {in} </script> 在0到1的范围内，ADC单元的输出<b>X</b>的值将在0到100的范围内变化。也就是说，数值等于湿度从0到100％的变化范围。 <br><br> 或者，只需转动可变电阻引擎，就可以将阈值湿度级别从0设置为100。唯一的麻烦是没有显示设备。 但是实际上，如果可变电阻发动机将6个分区设为0％，20％，40％，60％，80％，100％，则足以设置阈值湿度水平。 <br><br> 我们如何设置系数<b>k-</b>范围（ADC范围）和<b>b-</b>偏移（ADC偏移）？ 是的，比蒸萝卜要容易！ 在<b>ADC1</b>节点中单击鼠标指针，您将立即看到设置窗口。 您可以在其中设置所需的一切。 对于我们的情况，将是如图所示的窗口。 <br><br><img src="https://habrastorage.org/webt/cn/so/ub/cnsoubc9q_rhu-2p6hlffcd_1ig.png"><br><br> 因此，我们拥有最简单的工作解决方案。 让我们开始改进它。 <br> 顺便说一句，最简单的解决方案具有一个优势-它不需要Internet。 它是完全自主的。 <br><br><h4> 选项二，连接按钮 </h4><br> 一切正常，每个人都很高兴。 但不幸的是，我们无法强制打开通风装置。 我们已经同意将一个按钮连接到输入<b>Input1</b> ，该按钮将强制打开和关闭风扇，而无需注意湿度传感器。 <br> 现在该在我们的电路程序中处理此按钮了。 <br><br><img src="https://habrastorage.org/webt/rn/9h/p8/rn9hp8-41uqwkms65uqiwynd_-k.png"><br><br> 按钮单击处理单元以橙色线突出显示。 它是一个按钮单击计数器，当其输出的值超过1（绿线， <b>CT</b>节点输出）时，它将重置为零。 <br><br> 这里的一切都像以前一样简单： <b>CT</b>计数器计算连接到<b>Input1</b>的按钮的点击次数。 即，每次单击按钮，此计数器输出的值将增加1。 <br><br> 一旦该值等于2（即大于1），比较器<b>A&gt; B</b>的输出就会立即出现1。并且此1将使计数器<b>CT</b>重置为零。 这意味着比较器，根据方案是较低的！ <br><br> 因此，我们的按钮有两个状态-0和1。如果我们需要更多的状态（3或4或什至更多）-将<b>CONST</b>常数从一个值更改为另一个值就足够了。 <br><br> 因此，打开风扇有两个条件：超过设定的湿度水平并按一下按钮。 如果满足任何条件，则风扇将打开。 并且它将一直起作用，直到再次按下该按钮并且湿度水平恢复正常为止。 <br><br> 您当然可以使算法更加复杂，但是我们不会这样做-我们将为有希望的人留出创造空间。 <br><br><h4> 选项三，连接到互联网 </h4><br> 我们描述的所有内容都很实用。 但是炫耀呢？ 毕竟，任何粉刺的时髦黑客骇客都会嘲笑某个人，他们扭曲了笔并按下了按钮，却无法通过智能手机来控制它！ 扭转手柄“不是很时尚”。 但是要在智能手机上抓手指，将手指擦入血液-这就是时髦黑客骇客渴望的最高峰（​​我永远无法分辨所有这些-因此，如果我做错了，对不起）。 <br><br> 但是我们会屈服于这些人。 互联网治理具有真正的优势。 首先，它是视觉的。 所有平台上都有许多应用程序，可以通过几次戳操作为我们的卡尔森控制器创建一个完全可用的控制面板。 其次，这是一个远程监控房间湿度状态的机会。 第三，您不仅可以看到风扇的功能（是否旋转），还可以看到设定的阈值湿度水平。 然后-风扇自动或手动打开。 总的来说，无论您想要什么。 <br><br> 当然，对于某些粉丝来说，荣誉是很多的-非常关注。 但这只是一个例子。 <br><br> 因此，为了连接到Internet，我们将使用<b>MQTT</b>技术和相同名称的协议。 <br> 要使用此技术，我们需要一个<b>MQTT代理</b> 。 这是一个为<b>MQTT客户端</b>提供服务的特殊服务器，例如<b>ShIoTIny</b>和您的智能手机。 <br><br>  <b>MQTT</b>技术的本质是任何客户端都可以在MQTT代理（服务器）上以特定名称（在<b>MQTT</b>术语中称为<b>主题</b> ）发布任意数据。 其他客户可以按其姓名（ <b>主题</b> ）订阅任意数据，并接收新发布的数据。 也就是说，整个数据交换都是基于客户端-代理-客户端的原则。 <br><br> 我<i><b>不会</b></i>关注细节。 互联网上有大量的文章和教程，介绍<b>MQTT的</b>工作原理以及用于创建控制面板的程序。 我将仅向您展示如何使用<b>ShIoTiny</b>接收和发布数据。 <br><br> 作为经纪人，我使用了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">www.cloudmqtt.com</a> ，但是原理到处都是一样的。 <br><br> 因此，我们将假定您已经在<b>MQTT经纪人处</b>注册。 通常，代理将为您提供（或要求发明）用户名和密码（用于授权），以及用于连接的端口。 将<b>ShIoTiny</b>连接到<b>MQTT代理</b> <b>有</b>两种方法：常规连接和<b>TLS</b> （ <b>SSL</b> ）。 <br><br>  <b>ShIoTiny</b>中的所有这些参数都在“ <b>网络”</b>选项卡的“ <b>与服务器</b>的<b>MQTT连接”</b>部分中输入。 <br><br><img src="https://habrastorage.org/webt/97/6j/kb/976jkbemm294uso3-pjdcb4wx_4.png"><br><br> 如果您的<b>MQTT经纪人</b>不需要授权，请不要输入您的登录名和密码（将这些字段保留为空）。 <br><br>  <b>MQTT主题前缀</b>参数需要单独的说明。 <br><br>  MQTT参数的前缀是发布和订阅MQTT代理时添加到主题标题的行。 要为您的控制器设置<b>MQTT前缀</b> ，您只需要在输入字段“ <b>MQTT topic prefix</b> ”（“ <b>MQTT topic prefix</b> ”）中输入即可。 前缀始终以斜杠（ <b>“ /”</b> ）开头！ 如果未在输入字段中输入斜杠，它将自动添加。 前缀中不能使用<b>“＃”</b>和<b>“ +”</b>字符。 没有其他限制。 <br><br> 例如，如果您发布参数“ <b>status</b> ”（或订阅它），并且您的前缀设置为“ <b>/ shiotiny /</b> ”，那么在代理上，此参数将以名称“ <b>/ shiotiny / status</b> ”发布。 如果设置了空前缀，则代理上的所有参数都将以斜杠（ <b>“ /”</b> ）开头：“ <b>status</b> ”将发布为“ <b>/ status</b> ”。 <br><br> 因此，我们认为您已经在<b>MQTT经纪人处</b>注册并收到了您的登录名，密码和端口。 然后<b>，在ShIoTiny</b>控制器的“ <b>网络”</b>选项卡的“ <b>与服务器</b>的<b>MQTT连接”</b> <b>部分中</b>设置这些参数。 <br><br> 我们认为前缀设置为“ <b>/ room /</b> ”。 <br><br> 首先，我们将发布所有关键参数的状态： <b>Realay1</b>继电器，手动开启状态，自动开启状态，最后是阈值和当前湿度水平。 好吧，还有一个好处-房间的温度。 如何做到这一点，见图。 <br><br><img src="https://habrastorage.org/webt/tq/xj/la/tqxjla44g3klhb_apkinf7yudka.png"><br><br> 如您所见，与先前版本的区别仅在于<b>MQTT Publish</b>节点。 给定前缀，将发布以下参数： <br><img src="https://habrastorage.org/webt/hr/9c/wd/hr9cwdccjlb3tnpkgm2g7grdyhe.jpeg"><br><br> 如您所见，系统的整体状态是完整的！ <br><br> 但是我们不仅要看，而且要控制。 如何成为 很简单 我们将拒绝使用<b>ADC</b>和可变电阻器来设置阈值湿度水平，而我们将直接通过智能手机通过<b>MQTT</b>来设置此阈值湿度水平！ <br><br><img src="https://habrastorage.org/webt/dr/e3/yw/dre3ywd0uyw_cjtw8tnzr-doicq.png"><br><br> 我们从电路中删除ADC节点，并在其中包括三个新节点： <b>FLASH存储</b> ， <b>FLASH恢复</b>和<b>MQTT describe</b> 。 <br><br>  <b>MQTT describe</b>节点的功能很明显：它从<b>MQTT代理</b>接收<b>/ room / trigHset参数</b> （阈值湿度水平）。 但是他接下来如何处理数据？ 它只是将它们提供给<b>FLASH存储</b>节点，该节点进而将该数据存储在非易失性存储器中，名称为<b>trigH</b> 。 之后， <b>FLASH恢复</b>节点从非易失性存储器读取名称为<b>trigH的</b>数据，我们已经知道接下来会发生什么。 <br><br> 为什么会有这样的困难？ 为什么我不能立即将接收到的数据发送到比较器的输入？ <br><br> 正如福尔摩斯同志所说， <i>这是基本的</i> ！ 没有人保证打开您的设备后，它将加入<b>MQTT代理</b> 。 并且必须测量湿度。 并且必须打开风扇。 但是，如果没有有关阈值湿度水平的信息，这是不可能的！ 因此，打开设备后，我们的设备将从非易失性存储器中提取先前存储的阈值水分含量，并将其用于决策。 并且当与<b>MQTT代理建立</b>连接并有人发布新值<b>/ room / trigHset时</b> ，将使用该新值。 <br><br> 然后，您可以发明任何您想要的东西。 例如，除湿度外，还要输入温度记录。 或添加“智能”照明控制（我们仍未使用两个继电器和两个输入）。 一切都在您手中！ <br><br><h4> 结论 </h4><br> 因此，我们看了几个基于ShIoTiny实现最简单本质控制器的示例。 也许对某人有用。 <br><br> 与往常一样，通过电子邮件发送建议，希望，问题，错别字等： <b>shiotiny@yandex.ru</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN464485/">https://habr.com/ru/post/zh-CN464485/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN464465/index.html">我们如何以及为什么将Preply迁移到Kubernetes</a></li>
<li><a href="../zh-CN464467/index.html">从头开始学习网络分析。 大选择</a></li>
<li><a href="../zh-CN464471/index.html">The Dude中的snmp打印机监视</a></li>
<li><a href="../zh-CN464479/index.html">“相关专业的新手程序员宣言”或我如何过上这样的生活</a></li>
<li><a href="../zh-CN464481/index.html">我们如何在工作室中建立培训和激励系统</a></li>
<li><a href="../zh-CN464487/index.html">我们正在建立一个界面，用于通过选择输入文档</a></li>
<li><a href="../zh-CN464489/index.html">示例中的Buildbot</a></li>
<li><a href="../zh-CN464491/index.html">Vivaldi 2.7-沉默中的强烈生活</a></li>
<li><a href="../zh-CN464495/index.html">团队发展和反思作为团队领导者的管理沟通</a></li>
<li><a href="../zh-CN464497/index.html">JIRA是失眠和神经衰弱的一种补救方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>