<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçü§ù‚Äçüë©üèº üôèüèæ üë®üèæ‚Äçü§ù‚Äçüë®üèº Automa√ß√£o de rede com Ansible: m√≥dulo de comando üòê üé≠ üèùÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Falando em cen√°rios t√≠picos de automa√ß√£o de rede, n√£o se pode prescindir de um conjunto de m√≥dulos de comando. Gra√ßas a esses m√≥dulos, o Ansible permi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Automa√ß√£o de rede com Ansible: m√≥dulo de comando</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/redhatrussia/blog/438312/">  Falando em cen√°rios t√≠picos de automa√ß√£o de rede, n√£o se pode prescindir de um conjunto de m√≥dulos de comando.  Gra√ßas a esses m√≥dulos, o Ansible permite executar comandos em equipamentos de rede como se voc√™ os estivesse inserindo diretamente no console.  Ao mesmo tempo, a sa√≠da dos comandos n√£o apenas desliza na janela do terminal para afundar no esquecimento, mas pode ser salva e usada no futuro.  Ele pode ser gravado em vari√°veis, analisado para uso em tarefas subseq√ºentes ou salvo para o futuro em vari√°veis ‚Äã‚Äãde host. <br><br><img src="https://habrastorage.org/webt/ga/bs/bh/gabsbhxuxhvjzjvvizswbdkkq2o.png" width="100%"><br><br>  O objetivo desta publica√ß√£o √© mostrar que qualquer tarefa repetitiva de gerenciamento de rede pode ser automatizada e que o Ansible n√£o apenas permite gerenciar configura√ß√µes, mas tamb√©m ajuda a se livrar da rotina e economizar tempo. <br><a name="habracut"></a><br>  Vamos analisar as maneiras b√°sicas de usar os m√≥dulos de comando de rede, incluindo salvar a sa√≠da de comandos usando o par√¢metro register.  Tamb√©m consideraremos como dimensionar para v√°rios dispositivos de rede usando hostvars e como organizar a execu√ß√£o condicional usando o par√¢metro wait_for e tr√™s outros par√¢metros relacionados: intervalo, novas tentativas e correspond√™ncia. <br><br>  Diferentes plataformas de rede t√™m seus pr√≥prios m√≥dulos de comando, todos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">suportados</a> no n√≠vel de extens√£o do Red Hat Ansible Engine Networking Add-on: <br><br><table><tbody><tr><td>  <b>Plataformas de rede</b> </td><td>  <b>M√≥dulos * os_command</b> </td></tr><tr><td>  Arista eos </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">eos_command</a> </td></tr><tr><td>  Cisco IOS / IOS-XE </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ios_command</a> </td></tr><tr><td>  Cisco IOS-XR </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">iosxr_command</a> </td></tr><tr><td>  Cisco NX-OS </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nxos_command</a> </td></tr><tr><td>  Juniper Junos </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">junos_command</a> </td></tr><tr><td>  Vyos </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">vyos_command</a> </td></tr></tbody></table><br><h3>  No√ß√µes b√°sicas do m√≥dulo de comando </h3><br>  Considere um manual que simplesmente execute o comando show version usando o m√≥dulo eos_command: <br><br><pre><code class="plaintext hljs">--- - name: COMMAND MODULE PLAYBOOK hosts: eos connection: network_cli tasks: - name: EXECUTE ARISTA EOS COMMAND eos_command: commands: show version register: output - name: PRINT OUT THE OUTPUT VARIABLE debug: var: output</code> </pre> <br>  Aqui temos duas tarefas e a primeira usa o m√≥dulo eos_command com um √∫nico par√¢metro de comandos.  Como executamos apenas um comando - show version - ele pode ser especificado na mesma linha que o pr√≥prio par√¢metro de comandos.  Se houver duas ou mais equipes, cada uma delas dever√° ser colocada em uma linha separada ap√≥s os comandos:.  Neste exemplo, usamos a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">palavra</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">chave register</a> para salvar a sa√≠da do comando show version.  O par√¢metro register (pode ser usado em qualquer tarefa Ansible) define a vari√°vel em que a sa√≠da da nossa tarefa ser√° salva, para que possa ser usada posteriormente.  No nosso exemplo, essa vari√°vel √© chamada de sa√≠da. <br><br>  A segunda tarefa em nosso exemplo usa o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">m√≥dulo de depura√ß√£o</a> para exibir o conte√∫do da vari√°vel de sa√≠da rec√©m-criada.  Ou seja, s√£o os mesmos dados que voc√™ veria na interface da linha de comandos no dispositivo EOS se voc√™ inserisse "show version" l√°.  A diferen√ßa √© que nosso manual ir√° mostr√°-los na janela do terminal em que voc√™ o inicia.  Como voc√™ pode ver, o m√≥dulo de depura√ß√£o facilita a verifica√ß√£o de vari√°veis ‚Äã‚ÄãAnsible. <br><br>  Aqui est√° o resultado do nosso manual: <br><br><pre> <code class="plaintext hljs">PLAY [eos] ************************************************************************* TASK [execute Arista eos command] ************************************************** ok: [eos] TASK [print out the output variable] *********************************************** ok: [eos] =&gt; { "output": { "changed": false, "failed": false, "stdout": [ "Arista vEOS\nHardware version: \nSerial number: \nSystem MAC address: 0800.27ec.005e\n\nSoftware image version: 4.20.1F\nArchitecture: i386\nInternal build version: 4.20.1F-6820520.4201F\nInternal build ID: 790a11e8-5aaf-4be7-a11a-e61795d05b91\n\nUptime: 1 day, 3 hours and 23 minutes\nTotal memory: 2017324 kB\nFree memory: 1111848 kB" ], "stdout_lines": [ [ "Arista vEOS", "Hardware version: ", "Serial number: ", "System MAC address: 0800.27ec.005e", "", "Software image version: 4.20.1F", "Architecture: i386", "Internal build version: 4.20.1F-6820520.4201F", "Internal build ID: 790a11e8-5aaf-4be7-a11a-e61795d05b91", "", "Uptime: 1 day, 3 hours and 23 minutes", "Total memory: 2017324 kB", "Free memory: 1111848 kB" ] ] } } PLAY RECAP ************************************************************************* eos : ok=2 changed=0 unreachable=0 failed=0</code> </pre><br>  Como pode ser visto na captura de tela, nossas tarefas foram bem-sucedidas.  Como a primeira tarefa usa o n√≠vel de detalhe padr√£o das mensagens, simplesmente diz que o host eos concluiu a tarefa com o resultado ok, destacando o sucesso da execu√ß√£o em verde.  A segunda tarefa, com o m√≥dulo debug, retorna a sa√≠da do comando executado, exibindo as mesmas informa√ß√µes em dois formatos: <br><br><ul><li>  stdout </li><li>  stdout_lines </li></ul><br>  A se√ß√£o stdout mostra a mesma coisa que voc√™ veria na interface da linha de comandos do dispositivo, mas na forma de uma linha longa.  E a se√ß√£o stdout_lines divide essa sa√≠da em linhas para facilitar a leitura.  Cada item desta lista √© uma linha separada na sa√≠da do comando. <br><br>  Compare a sa√≠da do comando no dispositivo e no Ansible: <br><br><table><tbody><tr><td>  <b>Sa√≠da da equipe no Arista EOS</b> </td><td>  <b>stdout_lines no Ansible</b> </td></tr><tr><td>  eos&gt; show vers <br>  Arista vEOS <br>  Vers√£o do hardware: <br>  N√∫mero de s√©rie: <br>  Endere√ßo MAC do sistema: 0800.27ec.005e <br><br>  Vers√£o da imagem do software: 4.20.1F <br>  Arquitetura: i386 <br>  Vers√£o de compila√ß√£o interna: 4.20.1F-6820520.4201F <br>  ID da compila√ß√£o interna: 790a11e8-5aaf-4be7-a11a-e61795d05b91 <br><br>  Tempo de atividade: 1 dia, 3 horas e 56 minutos <br>  Mem√≥ria total: 2017324 kB <br>  Mem√≥ria livre: 1116624 kB </td><td>  "Stdout_lines": [ <br>  [ <br>  "Arista vEOS", <br>  "Vers√£o do hardware:", <br>  "N√∫mero de s√©rie:", <br>  "Endere√ßo MAC do sistema: 0800.27ec.005e", <br>  "", <br>  "Vers√£o da imagem do software: 4.20.1F", <br>  "Arquitetura: i386", <br>  "Vers√£o de compila√ß√£o interna: <br>  4.20.1F-6820520.4201F ", <br>  "ID da vers√£o interna: <br>  790a11e8-5aaf-4be7-a11a-e61795d05b91 ", <br>  "", <br>  "Tempo de atividade: 1 dia, 3 horas e 23 minutos", <br>  "Mem√≥ria total: 2017324 kB", <br>  "Mem√≥ria livre: 1111848 kB" <br>  ] </td></tr></tbody></table><br>  Se voc√™ conhece JSON e YAML, provavelmente j√° prestou aten√ß√£o em uma singularidade: stdout_lines come√ßa com dois colchetes de abertura: <br><br><pre> <code class="plaintext hljs">"stdout_lines": [ [</code> </pre><br>  Dois colchetes de abertura indicam que stdout_lines realmente retorna uma lista de listas de linhas.  Se voc√™ modificar ligeiramente nossa tarefa de depura√ß√£o, esse chip poder√° ser usado para exibir seletivamente os resultados do comando.  Como existe apenas uma lista de linhas em nossa lista, essa lista √© chamada zero (na verdade, √© a primeira, mas a contagem vai do zero).  Agora vamos ver como extrair uma linha separada dela, por exemplo, Endere√ßo MAC do Sistema.  Na sa√≠da do comando, essa linha √© a quarta de uma linha, mas, como contamos do zero, precisamos da linha 3 da lista 0, ou seja: output.stdout_lines [0] [3]. <br><br><pre> <code class="plaintext hljs"> - name: print out a single line of the output variable debug: var: output.stdout_lines[0][3]   debug-   : TASK [print out a single line of the output variable] ****************************** ok: [eos] =&gt; { "output.stdout_lines[0][3]": "System MAC address: 0800.27ec.005e" }</code> </pre><br>  Qual √© o objetivo da numera√ß√£o da lista e por que √© necess√°rio?  O fato √© que, dentro da mesma tarefa, voc√™ pode executar v√°rias equipes, por exemplo, assim (aqui temos tr√™s equipes): <br><br><pre> <code class="plaintext hljs">--- - hosts: eos connection: network_cli tasks: - name: execute Arista eos command eos_command: commands: - show version - show ip int br - show int status register: output - name: print out command debug: var: output.stdout_lines</code> </pre><br>  Aqui est√° a apar√™ncia da sa√≠da: <br><br><pre> <code class="plaintext hljs"> "output.stdout_lines": [ [ "Arista vEOS", "Hardware version: ", "Serial number: ", "System MAC address: 0800.27ec.005e", "", "Software image version: 4.20.1F", "Architecture: i386", "Internal build version: 4.20.1F-6820520.4201F", "Internal build ID: 790a11e8-5aaf-4be7-a11a-e61795d05b91", "", "Uptime: 1 day, 4 hours and 20 minutes", "Total memory: 2017324 kB", "Free memory: 1111104 kB" ], [ "Interface IP Address Status Protocol MTU", "Ethernet1 172.16.1.1/24 up up 1500", "Management1 192.168.2.10/24 up up 1500" ], [ "Port Name Status Vlan Duplex Speed Type Flags", "Et1 connected routed full unconf EbraTestPhyPort ", "Et2 connected 1 full unconf EbraTestPhyPort ", "Et3 connected 1 full unconf EbraTestPhyPort ", "Ma1 connected routed a-full a-1G 10/100/1000" ] ]</code> </pre><br>  Aqui, o n√∫mero da lista zero √© a sa√≠da do comando show version, a lista n√∫mero um √© a sa√≠da show ip int br, a lista n√∫mero dois √© a sa√≠da show int status.  Ou seja, o n√∫mero da lista √© determinado pela ordem em que os comandos s√£o executados. <br><br><table><tbody><tr><td>  <b>Equipes Arista EOS</b> </td><td>  <b>Listas de sa√≠da correspondentes</b> </td></tr><tr><td>  mostrar vers√£o </td><td>  output.stdout_lines [0] </td></tr><tr><td>  mostre o IP int br </td><td>  output.stdout_lines [1] </td></tr><tr><td>  mostre o status int </td><td>  output.stdout_lines [2] </td></tr></tbody></table><br><h3>  Escala do m√≥dulo de comando: vari√°veis ‚Äã‚Äãdo host </h3><br>  E o que acontece se voc√™ executar o manual em v√°rios dispositivos ao mesmo tempo? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9g/e0/ap/9ge0apzkt1vioj3gtttw2eivili.png"></div><br><br>  Para ser exclusiva, a vari√°vel de sa√≠da √© armazenada como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">uma vari√°vel de host</a> para cada host no invent√°rio.  Se tivermos tr√™s switches e executarmos nosso manual sobre eles, obteremos a vari√°vel de sa√≠da para cada host √∫nico.  Suponha que precisamos do endere√ßo IP do comando show ip int br para a porta Ethernet1 no switch03.  Como show ip int br √© o segundo comando executado como parte da tarefa e os dados Ethernet1 est√£o contidos na segunda linha de sua sa√≠da, precisaremos escrever stdout_lines [1] [1].  Para acessar as vari√°veis ‚Äã‚Äãde um host espec√≠fico, usamos a palavra-chave hostvars e pesquisamos o host que precisamos pelo nome. <br><br>  Veja como faz√™-lo: <br><br><pre> <code class="plaintext hljs"> - name: debug hostvar debug: var: hostvars["switch03"].output.stdout_lines[1][1]</code> </pre><br>  Como resultado, a sa√≠da cont√©m exatamente o que precisamos: <br><br><pre> <code class="plaintext hljs">TASK [debug hostvar] *************************************************************** ok: [switch03] =&gt; { "hostvars[\"switch03\"].output.stdout_lines[1][1]": "Ethernet1 172.16.1.3/24 up up 1500" }</code> </pre><br>  Por padr√£o, a tarefa usa as vari√°veis ‚Äã‚Äãdo host atual, mas o hostvars permite acessar diretamente as vari√°veis ‚Äã‚Äãde outro host. <br><br><h3>  Condi√ß√µes em tarefas com m√≥dulos de comando: par√¢metro wait_for </h3><br>  O par√¢metro wait_for permite implementar uma verifica√ß√£o de condi√ß√£o imediatamente ap√≥s a execu√ß√£o do comando.  Por exemplo, para que a tarefa seja considerada conclu√≠da com √™xito apenas se a sa√≠da do comando de verifica√ß√£o de status contiver determinado texto.  Por padr√£o, o par√¢metro wait_for n√£o √© usado, portanto, a tarefa √© executada apenas uma vez, como nos exemplos acima.  Por√©m, se voc√™ a definir explicitamente, a tarefa ser√° reiniciada at√© que a condi√ß√£o seja atendida ou o limite de tentativas seja excedido (h√° 10 por padr√£o).  Se voc√™ habilitar o log de comandos, poder√° ver que, no manual abaixo (especialmente escrito para que a condi√ß√£o nunca ocorra), tudo acontece exatamente assim. <br><br><pre> <code class="plaintext hljs">--- - hosts: eos connection: network_cli tasks: - name: execute Arista eos command eos_command: commands: - show int status wait_for: - result[0] contains DURHAM</code> </pre><br>  Este manual executar√° o comando show int status 10 vezes, porque sua sa√≠da nunca conter√° uma linha DURHAM. <br><br>  Voc√™ pode verificar isso usando o comando show logging: <br><br><pre> <code class="plaintext hljs">Mar 24 20:33:52 eos Aaa: %ACCOUNTING-6-CMD: admin vty6 192.168.2.1 stop task_id=17 start_time=1521923632.5 timezone=UTC service=shell priv-lvl=15 cmd=show interfaces status Mar 24 20:33:53 eos Aaa: %ACCOUNTING-6-CMD: admin vty6 192.168.2.1 stop task_id=18 start_time=1521923633.71 timezone=UTC service=shell priv-lvl=15 cmd=show interfaces status Mar 24 20:33:54 eos Aaa: %ACCOUNTING-6-CMD: admin vty6 192.168.2.1 stop task_id=19 start_time=1521923634.81 timezone=UTC service=shell priv-lvl=15 cmd=show interfaces status Mar 24 20:33:55 eos Aaa: %ACCOUNTING-6-CMD: admin vty6 192.168.2.1 stop task_id=20 start_time=1521923635.92 timezone=UTC service=shell priv-lvl=15 cmd=show interfaces status Mar 24 20:33:56 eos Aaa: %ACCOUNTING-6-CMD: admin vty6 192.168.2.1 stop task_id=21 start_time=1521923636.99 timezone=UTC service=shell priv-lvl=15 cmd=show interfaces status Mar 24 20:33:58 eos Aaa: %ACCOUNTING-6-CMD: admin vty6 192.168.2.1 stop task_id=22 start_time=1521923638.07 timezone=UTC service=shell priv-lvl=15 cmd=show interfaces status Mar 24 20:33:59 eos Aaa: %ACCOUNTING-6-CMD: admin vty6 192.168.2.1 stop task_id=23 start_time=1521923639.22 timezone=UTC service=shell priv-lvl=15 cmd=show interfaces status Mar 24 20:34:00 eos Aaa: %ACCOUNTING-6-CMD: admin vty6 192.168.2.1 stop task_id=24 start_time=1521923640.32 timezone=UTC service=shell priv-lvl=15 cmd=show interfaces status Mar 24 20:34:01 eos Aaa: %ACCOUNTING-6-CMD: admin vty6 192.168.2.1 stop task_id=25 start_time=1521923641.4 timezone=UTC service=shell priv-lvl=15 cmd=show interfaces status Mar 24 20:34:02 eos Aaa: %ACCOUNTING-6-CMD: admin vty6 192.168.2.1 stop task_id=26 start_time=1521923642.47 timezone=UTC service=shell priv-lvl=15 cmd=show interfaces status</code> </pre><br>  Agora, vejamos um exemplo de um manual real, no qual tudo est√° configurado para estabelecer uma vizinhan√ßa OSPF (adjac√™ncia) com um dispositivo que n√£o seja o comando ip ospf area.  Aplicamos esse comando e, em seguida, usamos o par√¢metro wait_for para verificar a presen√ßa da palavra FULL na sa√≠da: se estiver l√°, a vizinhan√ßa foi estabelecida com sucesso.  Se CHEIO n√£o aparecer em 10 tentativas, a tarefa falhar√°. <br><br><pre> <code class="plaintext hljs">--- - hosts: eos connection: network_cli tasks: - name: turn on OSPF for interface Ethernet1 eos_config: lines: - ip ospf area 0.0.0.0 parents: interface Ethernet1 - name: execute Arista eos command eos_command: commands: - show ip ospf neigh wait_for: - result[0] contains FULL</code> </pre><br>  Execute este manual usando o comando ansible-playbook: <br><br><pre> <code class="plaintext hljs">‚ûú ansible-playbook ospf.yml PLAY [eos] ********************************************************************************************* TASK [turn on OSPF for interface Ethernet1] ******************************************************* changed: [eos] TASK [execute Arista eos command] **************************************************************** ok: [eos] PLAY RECAP ****************************************************************************************** eos : ok=2 changed=1 unreachable=0 failed=0</code> </pre><br>  Observamos a linha de comando e vemos que o manual foi bem-sucedido: <br><br><pre> <code class="plaintext hljs">eos#show ip ospf neigh Neighbor ID VRF Pri State Dead Time Address Interface 2.2.2.2 default 1 FULL/DR 00:00:33 172.16.1.2 Ethernet1</code> </pre><br>  Al√©m de cont√©m, voc√™ pode usar os seguintes operadores de compara√ß√£o: <br><br><ul><li>  eq: - √© igual </li><li>  neq: - n√£o √© igual </li><li>  gt: - mais </li><li>  ge: - maior ou igual a </li><li>  lt: - menos </li><li>  le: - menor ou igual a </li></ul><br>  Al√©m disso, junto com wait_for, voc√™ pode usar tr√™s par√¢metros adicionais (descritos em detalhes na documenta√ß√£o dos m√≥dulos): <br><br><table><tbody><tr><td>  <b>Par√¢metro</b> </td><td>  <b>Descri√ß√£o do produto</b> </td></tr><tr><td>  intervalo </td><td>  Tempo entre repeti√ß√µes de uma equipe. </td></tr><tr><td>  tentativas </td><td>  M√°x.  o n√∫mero de repeti√ß√µes antes que a tarefa seja conclu√≠da com um erro ou a condi√ß√£o seja atendida. </td></tr><tr><td>  combinar </td><td>  A coincid√™ncia de todas as condi√ß√µes ou pelo menos uma. </td></tr></tbody></table><br>  Vamos nos aprofundar mais detalhadamente no par√¢metro match: <br><br><pre> <code class="plaintext hljs"> - name: execute Arista eos command eos_command: commands: - show ip ospf neigh match: any wait_for: - result[0] contains FULL - result[0] contains 172.16.1.2</code> </pre><br>  Quando match: any for especificado, a tarefa ser√° considerada bem-sucedida se o resultado contiver FULL ou 172.16.1.2.  Se match: all for especificado, o resultado dever√° conter FULL e 172.16.1.2.  Por padr√£o, match: all √© usado, porque se voc√™ prescreve v√°rias condi√ß√µes, provavelmente deseja que elas sejam executadas todas, e n√£o pelo menos uma. <br><br>  Quando pode corresponder: algum √© √∫til?  Suponha que voc√™ precise verificar se o centro de dados possui uma conex√£o bidirecional com a Internet.  E o data center est√° conectado a cinco provedores de Internet diferentes, cada um com sua pr√≥pria conex√£o BGP.  Um manual pode verificar todas essas cinco conex√µes e, se pelo menos uma delas funcionar, e n√£o as cinco, informar que tudo est√° em ordem.  Lembre-se de que any √© um OR l√≥gico e tudo √© um AND l√≥gico. <br><br><table><tbody><tr><td>  <b>Par√¢metro</b> </td><td>  <b>Descri√ß√£o do produto</b> </td></tr><tr><td>  match: any </td><td>  "OR" l√≥gico <br>  √â necess√°ria pelo menos uma condi√ß√£o </td></tr><tr><td>  match: all </td><td>  "E" l√≥gico <br>  Todas as condi√ß√µes necess√°rias </td></tr></tbody></table><br><h3>  Condi√ß√µes negativas: construindo a l√≥gica inversa </h3><br>  √Äs vezes, √© importante n√£o o que est√° na conclus√£o, mas o que n√£o est√° l√°.  Aqui, √© claro, √© sempre tentador usar o operador de compara√ß√£o neq, mas para alguns cen√°rios com condi√ß√µes negativas, existem op√ß√µes melhores.  Por exemplo, se voc√™ precisar inverter a instru√ß√£o contains (do tipo "a sa√≠da do comando n√£o deve conter tal e tal"), voc√™ pode usar a palavra-chave register para salvar a sa√≠da e process√°-la na pr√≥xima tarefa usando a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">express√£o when</a> .  Ou, por exemplo, quando precisar interromper o manual, se as condi√ß√µes n√£o forem atendidas, basta usar os m√≥dulos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">falha</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">declara√ß√£o</a> para sair especificamente com o erro.  Quanto ao operador de compara√ß√£o neq, √© √∫til apenas quando voc√™ pode extrair o valor exato da sa√≠da (por exemplo, de um par de valores-chave ou de JSON), e n√£o apenas uma sequ√™ncia ou uma lista de sequ√™ncias.  Caso contr√°rio, ser√° realizada a compara√ß√£o caractere por seq√º√™ncia de caracteres. <br><br><h3>  O que vem a seguir </h3><br>  Leia a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> sobre como trabalhar com a sa√≠da de comandos nos m√≥dulos de rede.  Ele fornece exemplos √∫teis do uso de ge, le e outras condi√ß√µes ao trabalhar com sa√≠da no formato JSON em plataformas de rede espec√≠ficas. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt438312/">https://habr.com/ru/post/pt438312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt438298/index.html">Por que ensinar se o desenvolvimento √© mais rent√°vel? Conversa com GeekBrains</a></li>
<li><a href="../pt438302/index.html">A incr√≠vel criatividade da evolu√ß√£o digital</a></li>
<li><a href="../pt438304/index.html">Subcontrata√ß√£o? Legal, voc√™ bate</a></li>
<li><a href="../pt438306/index.html">Radia√ß√£o: Laborat√≥rio radioqu√≠mico durante a semana</a></li>
<li><a href="../pt438310/index.html">Instagram usa aprendizado de m√°quina para remover seguidores falsos</a></li>
<li><a href="../pt438314/index.html">1. Check Point Maestro Hyperscale Network Security - uma nova plataforma de seguran√ßa escal√°vel</a></li>
<li><a href="../pt438316/index.html">No√ß√µes b√°sicas de campo de dist√¢ncia assinado em 2D</a></li>
<li><a href="../pt438318/index.html">Como dominar a sintaxe ass√≠ncrona / aguardar: um exemplo real</a></li>
<li><a href="../pt438320/index.html">Ensinar as crian√ßas a programar</a></li>
<li><a href="../pt438322/index.html">VSaaS 2025: tecnologia de CFTV do futuro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>