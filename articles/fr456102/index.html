<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚öõÔ∏è ‚Ñ¢Ô∏è üßëüèø‚Äçü§ù‚Äçüßëüèº Rapports faciles en C / C ++ üßúüèª üöÜ üê®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Si vous d√©veloppez en C / C ++ un logiciel pour les op√©rateurs (administrateurs) d'h√¥pitaux, de magasins, de services de location de scooters gyroscop...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Rapports faciles en C / C ++</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456102/"> Si vous d√©veloppez en C / C ++ un logiciel pour les op√©rateurs (administrateurs) d'h√¥pitaux, de magasins, de services de location de scooters gyroscopiques, de services de r√©paration de t√©l√©phones portables, vous avez probablement d√ª faire face √† la t√¢che de cr√©er des rapports afin de les imprimer sur une imprimante, ou au moins en PDF.  Il existe de nombreux packages tiers pour Embarcadero RAD Studio qui vous permettent de le faire.  Tels que FastReport, QuickReport, Crystal Reports, etc.  Mais √† mon avis, tous ces packages n√©cessitent une compr√©hension approfondie de leur m√©canisme et de leur interface.  Il faut beaucoup de temps pour les √©tudier et, surtout, le code pour g√©n√©rer le rapport le plus simple comprendra un grand nombre de lignes.  Lorsque j'ai rencontr√© pour la premi√®re fois la t√¢che de g√©n√©rer des rapports sous C / C ++, j'ai commenc√© avec FastReport et j'ai r√©alis√© que je n'aimais absolument pas cet outil. <br><br>  En ce moment m√™me, une merveilleuse pens√©e m'est venue √† l'esprit: √† quel point ce serait cool de prendre un simple fichier EXCEL, d'y ajouter des informations statiques et de le formater selon vos besoins.  Le programme n'ouvrira que ce fichier, le remplira de donn√©es dynamiques et l'enregistrera ou l'enverra pour l'imprimer!  Cela a servi de point de d√©part √† mon √©tude du m√©canisme OLE pour travailler avec des fichiers MS Office √† partir de programmes d√©velopp√©s dans Embarcadero RAD Studio. <br><a name="habracut"></a><br>  Au cours de mon activit√©, j'ai r√©ussi √† approfondir le sujet et je peux maintenant affirmer avec confiance que tous les outils fournis par MS Office et OLE couvrent tous mes besoins en mati√®re de rapports.  Eh bien, si c'est le cas, alors probablement pour d'autres d√©veloppeurs, ce serait un outil autonome, simple et pratique.  Par cons√©quent, il a √©t√© d√©cid√© d'√©crire une DLL et d'y inclure une liste de toutes les fonctions MS Excel couramment utilis√©es que vous rencontrez lors de la cr√©ation de documents Excel.  C'est tr√®s pratique, car pour cr√©er un rapport, vous n'avez pas besoin d'√©tudier un tas de manuels ou OLE.  Il suffit de charger la DLL et ses fonctions.  Eh bien, beaucoup sont capables de travailler avec des DLL. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Voici le site du projet lui-m√™me</a> . <br><br>  Sur le site du projet, le m√©canisme de travail avec les DLL est d√©crit de mani√®re suffisamment d√©taill√©e; il existe un exemple et une description de toutes les fonctions. <br><br>  La DLL est fournie sans fichier d'en-t√™te et sans biblioth√®que LIB statique.  Ainsi, la DLL doit √™tre connect√©e dynamiquement √† l'aide de la fonction LoadLibrary.  L'archive ZIP avec la biblioth√®que comprend les fichiers suivants: <br><br><ul><li>  " <i>light_report.dll</i> " - la biblioth√®que DLL elle-m√™me; </li><li>  " <i>DLLTest.cpp</i> " - un exemple d'utilisation de la biblioth√®que; </li><li>  " <i>LPDLL.h</i> " - le fichier d'en-t√™te pour un exemple d'utilisation de la biblioth√®que (ce n'est pas le fichier d'en-t√™te de la DLL); </li><li>  " <i>Report.xlsx</i> " - document MS EXCEL pour un exemple d'utilisation de la biblioth√®que. </li></ul><br>  Le fichier d'en-t√™te de l'exemple d'utilisation de la biblioth√®que <i>LPDLL.h</i> contient les d√©clarations suivantes: <br><br><ul><li>  √©num√©rations utilis√©es comme arguments pour les fonctions DLL; </li><li>  types de fonctions DLL; </li><li>  Instances de fonction DLL </li><li>  Descripteur de t√©l√©chargement de DLL (" <i>HINSTANCE DLL_Handle;</i> "); </li><li>  la fonction <i>LoadLightReportDLL</i> , qui charge dynamiquement la DLL et toutes ses fonctions; </li><li>  Fonction <i>FreeLightReportDLL</i> qui d√©charge la DLL. </li></ul><br>  Le fichier <i>LPDLL.h</i> contient d√©j√† tout ce dont vous avez besoin pour travailler avec la DLL et ses fonctions.  Mais vous pouvez aussi l'√©diter ou n'en prendre que le plus n√©cessaire √† votre projet. <br><br>  Imaginez que vous venez de connecter le fichier d'en-t√™te <i>¬´LPDLL.h¬ª</i> √† votre projet. <br><br>  Ensuite, dans le projet lui-m√™me, il vous suffit de: <br><br>  1) D√©clarez un descripteur variable √† votre rapport: <br><br><pre><code class="cpp hljs">Variant report;</code> </pre> <br>  2) Chargez dynamiquement la DLL et toutes ses fonctions: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!LoadLightReportDLL(<span class="hljs-string"><span class="hljs-string">"C:\\LightReport\\light_report.dll"</span></span>))<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br>  3) Ensuite, dans la construction try-catch, ouvrez le mod√®le de rapport pr√©par√© (fichier MS Excel): <br><br><pre> <code class="cpp hljs">report=OpenReport(<span class="hljs-string"><span class="hljs-string">"C:\\LightReport\\Report.xlsx"</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre> <br>  4) Ajoutez des donn√©es au rapport: <br><br><pre> <code class="cpp hljs">WriteCell(report, <span class="hljs-string"><span class="hljs-string">"Sheet1"</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"Hello world!"</span></span>);</code> </pre> <br>  ... <br>  5) Enregistrez le fichier ou imprimez: <br><br><pre> <code class="cpp hljs">Save(report); SaveAs(report, <span class="hljs-string"><span class="hljs-string">"C:\\LightReport\\Report copy.xlsx"</span></span>); ExportToPDF(report, <span class="hljs-string"><span class="hljs-string">"C:\\LightReport\\Report.pdf"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); PrintOut(report);</code> </pre> <br>  6) Fermez le fichier: <br><br><pre> <code class="cpp hljs">CloseReport(report);</code> </pre> <br>  7) D√©chargez la biblioth√®que DLL: <br><br><pre> <code class="cpp hljs">FreeLightReportDLL();</code> </pre> <br>  Et c'est tout!  Rien de plus!  Il n'y a qu'une seule mise en garde, mais m√™me cela, il n'appara√Æt que lors du d√©bogage.  Dans une application qui fonctionne, tout fonctionnera bien.  Je veux dire une situation dans laquelle il y a une sorte d'erreur lors de l'utilisation d'un rapport.  Le fait est que le m√©canisme OLE pour travailler avec des documents implique uniquement de lever des exceptions lorsque des erreurs se produisent.  C'est pourquoi lorsque vous travaillez avec des fonctions DLL, vous devez utiliser la construction try-catch.  Dans le bloc catch, vous devez fermer le rapport sans enregistrer: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(...){CloseReport(report);}</code> </pre>  . <br>  Lors du d√©bogage, lorsqu'une erreur se produit, vous pouvez arr√™ter le programme.  Dans ce cas, le processus MS Excel restera en cours d'ex√©cution et il sera possible de le fermer uniquement via le gestionnaire de t√¢ches.  Par cons√©quent, lors du d√©bogage de l'application plusieurs fois, plusieurs instances du processus MS Excel peuvent √™tre lanc√©es, selon la fr√©quence √† laquelle vous suspendez le programme lorsqu'une erreur se produit, sans attendre que le code s'ex√©cute dans catch.  Cela doit √™tre surveill√©. <br><br>  Dans la version, si une erreur se produit, le code sp√©cifi√© dans le bloc catch fonctionnera certainement, le rapport se fermera et le processus MS Excel sera termin√©.  Aucun processus MS Excel suspendu dans le syst√®me ne sera observ√©.  Mais ils essaient toujours d'√©crire du code sans erreur, donc j'esp√®re que vous n'avez pas cette situation dans une application en cours d'ex√©cution. <br><br>  Enfin, vous devez ajouter: <br><br><ol><li>  La DLL utilise des types de donn√©es ind√©pendants de la plate-forme, tels que <i>non sign√© court</i> , <i>non sign√© long</i> et <i>char</i> .  C'est compr√©hensible pourquoi. </li><li>  L'exemple est √©crit dans l'environnement Embarcadero Builder C ++ 10. Par cons√©quent, tout le code correspond √† cet environnement et, peut-√™tre, vous devrez apporter quelques modifications √† l'exemple de code pour que tout fonctionne dans votre environnement. </li><li>  Le goulot d'√©tranglement de cette DLL est l'utilisation du descripteur de fichier de rapport au format <i>Variant</i> .  Il s'agit d'un format assez sp√©cifique et je pense qu'il peut √™tre difficile d'utiliser la biblioth√®que en dehors d'Embarcadero RAD Studio.  Honn√™tement, je n'ai pas v√©rifi√©. </li></ol><br>  Par cons√©quent, pour l'avenir, il est pr√©vu de regrouper toutes les fonctionnalit√©s dans une classe et de masquer ce format <i>Variant</i> √† l'int√©rieur de la classe afin que seuls les formats C / C ++ g√©n√©ralement accept√©s soient fournis √† l'utilisateur.  Je n'ai jamais essay√© d'emballer des classes dans des DLL, j'ai lu que des difficult√©s surgiraient n√©cessairement avec cela.  N√©anmoins, nous comprendrons!  En attendant, merci de votre attention, je serai tr√®s heureux si cet article et la DLL aident quelqu'un. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien vers le projet</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr456102/">https://habr.com/ru/post/fr456102/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr456090/index.html">Introduction aux tests unitaires dans Unity</a></li>
<li><a href="../fr456092/index.html">Sept signes troublants que vous d√©pendez des conditions m√©t√©orologiques, m√™me si vous ne le pensez pas</a></li>
<li><a href="../fr456094/index.html">Nous lisons les fiches techniques 2: SPI sur STM32; Temporisateurs et interruptions PWM sur le STM8</a></li>
<li><a href="../fr456096/index.html">Ce que fait le lecteur de geektimes moyen en planant dans les nuages</a></li>
<li><a href="../fr456100/index.html">Maintenant dans le nouvel emballage - Kingston A400 au format M.2 se pr√©cipite sur le march√©</a></li>
<li><a href="../fr456104/index.html">Ezblock Pi - programmation sans programmation, cette fois pour les fans de Raspberry Pi</a></li>
<li><a href="../fr456108/index.html">Habr Weekly # 5 / Les sujets sombres sont partout, les usines chinoises de la F√©d√©ration de Russie, o√π les banques ont coul√©, Pixel 4, ML pollue l'atmosph√®re</a></li>
<li><a href="../fr456110/index.html">√Ä quoi ressemble votre texte?</a></li>
<li><a href="../fr456112/index.html">Surmonter la loi de Moore: comment remplacer les transistors planaires traditionnels</a></li>
<li><a href="../fr456114/index.html">Nouveaut√©s du d√©veloppement Mamba</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>