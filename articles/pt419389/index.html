<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö® üë©‚Äçüë¶ üçê Mecanismo de renderiza√ß√£o Angular 6 e Ivy üë∞ üöú üëºüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Boa tarde, colegas. Estamos pensando em atualizar o livro de Jacob Fine e Anton Moiseev " Angular e TypeScript. Constru√ß√£o de sites para profissionais...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mecanismo de renderiza√ß√£o Angular 6 e Ivy</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/419389/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/wl/x_/u9/wlx_u9fwbjqm0in1o-f790lshsg.jpeg" align="left" alt="imagem"></a>  Boa tarde, colegas.  Estamos pensando em atualizar o livro de Jacob Fine e Anton Moiseev " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Angular e TypeScript. Constru√ß√£o de sites para profissionais</a> ".  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Uma nova edi√ß√£o</a> sai neste outono e inclui material sobre Angular 5 e 6. <br><br>  Inicialmente, pensamos em publicar material sobre o mecanismo Ivy, que provavelmente √© a inova√ß√£o mais interessante no Angular 6, mas paramos em uma publica√ß√£o mais geral do Cedric Exbright (o original foi lan√ßado em maio). <br><br>  No Angular 6, houve muitas inova√ß√µes s√©rias; al√©m disso, as mais importantes delas n√£o podem ser citadas como caracter√≠sticas: este √© Ivy, um novo mecanismo de renderiza√ß√£o.  Como o mecanismo ainda √© experimental, falaremos sobre isso no final deste artigo e come√ßaremos com outros novos recursos e mudan√ßas revolucion√°rias. <br><a name="habracut"></a><br>  <b>Fornecedores inst√°veis ‚Äã‚Äãem √°rvores</b> <br><br>  Agora, existe uma maneira nova e recomendada de registrar o provedor diretamente no decorador <code>@Injectable()</code> , usando o novo atributo <code>providedIn</code> .  Leva <code>'root'</code> como o valor de qualquer m√≥dulo em seu aplicativo.  Ao usar <code>'root'</code> objeto implementado ser√° registrado no aplicativo como um solit√°rio e voc√™ n√£o precisar√° adicion√°-lo aos provedores no m√≥dulo raiz.  Da mesma forma, ao usar o m√©todo <code>providedIn: UsersModule</code> objeto implementado √© registrado como o provedor <code>UsersModule</code> e n√£o √© adicionado aos provedores do m√≥dulo. <br><br><pre> <code class="javascript hljs">@Injectable({ <span class="hljs-attr"><span class="hljs-attr">providedIn</span></span>: <span class="hljs-string"><span class="hljs-string">'root'</span></span> }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserService</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre> <br>  Um novo m√©todo foi introduzido para remover melhor o c√≥digo n√£o funcional do aplicativo (trepida√ß√£o de √°rvores).  Atualmente, a situa√ß√£o √© tal que o servi√ßo que est√° sendo adicionado aos provedores do m√≥dulo terminar√° no conjunto final, mesmo que n√£o seja usado no aplicativo - e permitir isso √© um pouco triste.  Se voc√™ usar carregamento lento, poder√° cair em v√°rias armadilhas ao mesmo tempo ou encontrar-se em uma situa√ß√£o em que o servi√ßo ser√° inserido no conjunto errado. <br><br>  √â improv√°vel que essa situa√ß√£o nos aplicativos ocorra com frequ√™ncia (se voc√™ escreve um servi√ßo e depois o usa), mas os m√≥dulos de terceiros √†s vezes oferecem servi√ßos que n√£o precisamos - como resultado, temos um monte de JavaScript in√∫til. <br><br>  Portanto, esse recurso ser√° especialmente √∫til para desenvolvedores de bibliotecas, mas agora √© recomend√°vel registrar objetos implementados dessa maneira - isso tamb√©m se aplica aos desenvolvedores de aplicativos.  Agora, a nova CLI ainda usa o andaime <code>providedIn: 'root'</code> por padr√£o ao trabalhar com servi√ßos. <br><br>  Na mesma linha, agora voc√™ pode declarar um <code>InjectionToken</code> , registr√°-lo diretamente com o <code>providedIn</code> e adicionar uma <code>factory</code> aqui: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> baseUrl = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InjectionToken&lt;string&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'baseUrl'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, { providedIn: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'root'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, factory: (</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">'http://localhost:8080/'</span></span> });</code> </pre> <br>  Observe: isso tamb√©m simplifica o teste de unidade.  Para os fins de tais testes, eles s√£o usados ‚Äã‚Äãpara registrar o servi√ßo com os provedores do m√≥dulo de teste.  Aqui est√° o que fizemos antes: <br><br><pre> <code class="javascript hljs">beforeEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> TestBed.configureTestingModule({ <span class="hljs-attr"><span class="hljs-attr">providers</span></span>: [UserService] }));</code> </pre><br>  Agora, se o UserService usar a <code>providedIn: 'root'</code> : <br><br><pre> <code class="javascript hljs">beforeEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> TestBed.configureTestingModule({}));</code> </pre> <br>  Apenas n√£o se preocupe: todos os servi√ßos registrados com o <code>providedIn</code> n√£o s√£o carregados no teste, mas s√£o instanciados com pregui√ßa, apenas nos casos em que s√£o realmente necess√°rios. <br><br>  <b>Rxjs 6</b> <br><br>  O Angular 6 agora usa o RxJS 6 internamente, portanto, voc√™ precisa atualizar o aplicativo com isso em mente. <br><br>  E ... O RxJS 6 est√° mudando a abordagem de importa√ß√£o! <br><br>  No RxJS 5, voc√™ poderia escrever: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Observable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs/Observable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs/add/observable/of'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs/add/operator/map'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> squares$: Observable&lt;number&gt; = Observable.of(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) .map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">n</span></span></span><span class="hljs-function"> =&gt;</span></span> n * n);</code> </pre> <br>  No RxJS 5.5, apareceram instru√ß√µes pipeable: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Observable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs/Observable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs/observable/of'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { map } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs/operators'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> squares$: Observable&lt;number&gt; = <span class="hljs-keyword"><span class="hljs-keyword">of</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>).pipe( map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">n</span></span></span><span class="hljs-function"> =&gt;</span></span> n * n) );</code> </pre><br>  E no RxJS 6.0, as importa√ß√µes foram alteradas: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Observable, <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { map } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs/operators'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> squares$: Observable&lt;number&gt; = <span class="hljs-keyword"><span class="hljs-keyword">of</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>).pipe( map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">n</span></span></span><span class="hljs-function"> =&gt;</span></span> n * n) );</code> </pre> <br>  Portanto, um dia voc√™ ter√° que alterar as importa√ß√µes em todo o aplicativo.  Escrevo ‚Äúuma vez‚Äù e n√£o ‚Äúagora‚Äù, porque a biblioteca compat√≠vel com rxJs foi lan√ßada no RxJS, que permite fazer o download do RxJS para a vers√£o 6.0, mesmo que as vers√µes antigas ainda sejam usadas em todo o aplicativo ou em uma das bibliotecas usadas sintaxe. <br><br>  A equipe do Angular escreveu um <a href="">documento inteiro</a> sobre esse assunto e √© absolutamente necess√°rio l√™-lo antes de migrar para o Angular 6.0. <br><br>  Observe: aqui est√° um conjunto de regras tslint muito legal chamado <code>rxjs-tslint</code> .  Existem apenas quatro regras e, se voc√™ as adicionar ao projeto, o sistema migrar√° automaticamente todas as suas importa√ß√µes e c√≥digos RxJS, e isso √© feito com o <code>tslint --fix</code> !  Afinal, se voc√™ ainda n√£o sabe, no <code>tslint</code> existe uma op√ß√£o de <code>fix</code> que corrige automaticamente todos os erros que encontrar!  Ele pode ser usado de maneira ainda mais simples: instale globalmente o <code>rxjs-tslint</code> e execute <code>rxjs-5-to-6-migrate -p src/tsconfig.app.json</code> .  Tentei o <code>rxjs-tslint</code> em um de nossos projetos e funcionou muito bem (execute-o pelo menos duas vezes para recolher tamb√©m todas as importa√ß√µes).  Confira o README deste projeto para obter mais detalhes: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github.com/ReactiveX/rxjs-tslint</a> . <br><br>  Se voc√™ estiver interessado em aprender mais sobre o RxJS 6.0, recomendo o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pr√≥ximo relat√≥rio de</a> Ben Lesch sobre ng-conf. <br><br>  <b>i18n</b> <br><br>  A perspectiva mais importante associada ao i18n √© a capacidade de criar ‚Äúi18n em tempo de execu√ß√£o‚Äù, sem a necessidade de criar o aplicativo separadamente para cada ponto local.  Esse recurso ainda n√£o est√° dispon√≠vel (existem apenas prot√≥tipos) e o mecanismo Ivy ser√° necess√°rio para sua opera√ß√£o (mais sobre ele abaixo). <br><br>  Outra mudan√ßa relacionada ao i18n j√° ocorreu e est√° dispon√≠vel.  O canal de moeda √© otimizado da maneira mais eficiente: agora ele arredonda todas as moedas n√£o para 2 d√≠gitos, como antes, mas para o n√∫mero desejado de d√≠gitos (por exemplo, para 3 no caso do dinar do Bahrein ou 0 para o peso chileno). <br><br>  Se necess√°rio, esse valor pode ser recuperado programaticamente usando a nova fun√ß√£o i18n <code>getNumberOfCurrencyDigits</code> . <br><br>  Outras fun√ß√µes de formata√ß√£o convenientes, como <code>formatDate</code> , <code>formatCurrency</code> , <code>formatPercent</code> e <code>formatNumber</code> tamb√©m apareceram no <code>formatNumber</code> <code>formatPercent</code> . <br><br>  Convenientemente, se voc√™ deseja aplicar as mesmas transforma√ß√µes feitas nos canais, fa√ßa-o a partir do c√≥digo TypeScript. <br><br>  <b>Anima√ß√µes</b> <br><br>  No Angular 6.0, as anima√ß√µes j√° s√£o poss√≠veis sem o polyfill <code>web-animations-js</code> , a menos que voc√™ use o <code>AnimationBuilder</code> .  Seu aplicativo pode ganhar alguns bytes preciosos!  Caso o navegador n√£o suporte a API <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>element.animate</code></a> , o Angular 6.0 reverter√° para o uso de quadros-chave CSS. <br><br>  <b>Elementos angulares</b> <br><br>  Angular Elements √© um projeto que permite agrupar componentes Angular como componentes da Web e incorpor√°-los em um aplicativo que n√£o usa Angular.  A princ√≠pio, esse projeto existia apenas no ‚ÄúLaborat√≥rio Angular‚Äù (ou seja, ainda √© experimental).  Com a v6, ela chega √† vanguarda e √© oficialmente inclu√≠da na estrutura.  Este √© um grande t√≥pico que merece um artigo separado. <br><br>  <b>ElementRef &lt;T&gt;</b> <br><br>  Se voc√™ deseja obter um link de elemento em seu modelo, pode usar <code>@ViewChild</code> ou <code>@ViewChildren</code> , ou mesmo implementar diretamente <code>ElementRef</code> .  A desvantagem nesse caso √© a seguinte: no Angular 5.0 ou inferior, o <code>ElementRef</code> especificado obter√° o tipo <code>any</code> para a propriedade <code>nativeElement</code> . <br><br>  No Angular 6.0, voc√™ pode digitar ElementRef mais rigorosamente, se desejar: <br><br><pre> <code class="javascript hljs">@ViewChild(<span class="hljs-string"><span class="hljs-string">'loginInput'</span></span>) loginInput: ElementRef&lt;HTMLInputElement&gt;; ngAfterViewInit() { <span class="hljs-comment"><span class="hljs-comment">// nativeElement  `HTMLInputElement` this.loginInput.nativeElement.focus(); }</span></span></code> </pre> <br>  <b>O que √© reconhecido como indesej√°vel e o que est√° mudando fundamentalmente</b> <br><br>  Vamos falar sobre o que voc√™ precisa ter em mente ao iniciar a migra√ß√£o! <br><br>  <i><b><code>preserveWhitespaces</code> : padr√£o <code>false</code></b></i> <br><br>  Na se√ß√£o ‚ÄúProblemas que podem ocorrer durante a atualiza√ß√£o‚Äù, observamos que preserveWhitespaces agora √© <code>false</code> por padr√£o.  Essa op√ß√£o apareceu no Angular 4.4 e se voc√™ est√° se perguntando o que esperar ao mesmo tempo - aqui est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">uma publica√ß√£o completa</a> sobre esse t√≥pico.  Desmancha prazeres: tudo pode fazer, ou pode quebrar completamente seus modelos. <br><br>  <i><b><code>ngModel</code> e formas reativas</b></i> <br><br>  Anteriormente, era poss√≠vel fornecer o mesmo campo de formul√°rio com <code>ngModel</code> e <code>formControl</code> , mas hoje essa pr√°tica √© considerada indesej√°vel e n√£o ser√° mais suportada no Angular 7.0. <br><br>  Um pouco de confus√£o surge aqui, e todo o mecanismo, talvez, n√£o funcionou como o esperado ( <code>ngModel</code> era uma diretiva h√° pouco tempo familiar a voc√™, mas a entrada / sa√≠da da diretiva <code>formControl</code> , que executa quase a mesma tarefa, mas n√£o id√™ntica). <br><br>  Ent√£o agora, se aplicarmos o c√≥digo: <br><br><pre> <code class="javascript hljs">&lt;input [(ngModel)]=<span class="hljs-string"><span class="hljs-string">"user.name"</span></span> [formControl]=<span class="hljs-string"><span class="hljs-string">"nameCtrl"</span></span>&gt;</code> </pre> <br>  ent√£o recebemos um aviso. <br><br>  Voc√™ pode configurar o aplicativo para exibir um aviso de <code>always</code> ( <code>once</code> ), <code>once</code> (uma vez) ou <code>never</code> (nunca).  O padr√£o √© <code>always</code> . <br><br><pre> <code class="javascript hljs">imports: [ ReactiveFormsModule.withConfig({ <span class="hljs-attr"><span class="hljs-attr">warnOnNgModelWithFormControl</span></span>: <span class="hljs-string"><span class="hljs-string">'never'</span></span> }); ]</code> </pre> <br>  De uma forma ou de outra, preparando a transi√ß√£o para o Angular 7, voc√™ precisa adaptar o c√≥digo para usar formul√°rios orientados a modelos ou reativos. <br><br>  <b>Projeto Ivy: novo (novo) mecanismo de renderiza√ß√£o no Angular</b> <br><br>  T√£√£√£o ...  Esta √© a quarta vers√£o principal do Angular (2, 4, 5, 6) e o mecanismo de renderiza√ß√£o est√° sendo reescrito pela terceira vez! <br><br>  Lembre-se: Angular compila seus modelos em c√≥digo TypeScript equivalente.  Ent√£o este TypeScript √© compilado com o TypeScript que voc√™ escreveu em JavaScript, e o resultado est√° √† disposi√ß√£o do usu√°rio.  E antes de n√≥s j√° √© a terceira vers√£o desse mecanismo de renderiza√ß√£o no Angular (a primeira foi no lan√ßamento inicial do Angular 2.0 e a segunda no Angular 4.0). <br><br>  Nesta nova vers√£o do mecanismo de renderiza√ß√£o, a abordagem para escrever modelos n√£o muda, no entanto, otimiza v√°rios indicadores, em particular: <br><br><ul><li>  Tempo de constru√ß√£o </li><li>  Tamanho de discagem </li></ul><br>  Tudo isso ainda √© profundamente experimental, e o novo mecanismo de renderiza√ß√£o Ivy √© ativado por uma caixa de sele√ß√£o, que voc√™ deve colocar nas op√ß√µes do compilador (no arquivo <code>tsconfig.json</code> ), se quiser experiment√°-lo. <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">"angularCompilerOptions"</span></span>: { <span class="hljs-string"><span class="hljs-string">"enableIvy"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre><br>  Observe que esse mecanismo talvez n√£o seja muito confi√°vel, portanto, n√£o o use ainda na produ√ß√£o.  Talvez ele ainda n√£o funcione.  Por√©m, em um futuro pr√≥ximo, ela ser√° aceita como op√ß√£o padr√£o, portanto, tente uma vez, veja se funciona no seu aplicativo e quais os benef√≠cios dele. <br><br>  Vamos discutir com mais detalhes como o Ivy difere do mecanismo de renderiza√ß√£o mais antigo. <br><br>  <b>C√≥digo gerado pelo mecanismo antigo</b> <br><br>  Vejamos um pequeno exemplo: vamos ter um componente <code>PonyComponent</code> que usa o modelo <code>PonyModel</code> (com os par√¢metros de <code>name</code> e <code>color</code> ) e exibe a imagem do p√¥nei (dependendo do terno), bem como o nome do p√¥nei. <br><br>  √â assim: <br><br><pre> <code class="javascript hljs">@Component({ <span class="hljs-attr"><span class="hljs-attr">selector</span></span>: <span class="hljs-string"><span class="hljs-string">'ns-pony'</span></span>, <span class="hljs-attr"><span class="hljs-attr">template</span></span>: <span class="hljs-string"><span class="hljs-string">`&lt;div&gt; &lt;ns-image [src]="getPonyImageUrl()"&gt;&lt;/ns-image&gt; &lt;div&gt;&lt;/div&gt; &lt;/div&gt;`</span></span> }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PonyComponent</span></span></span><span class="hljs-class"> </span></span>{ @Input() ponyModel: PonyModel; getPonyImageUrl() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">`images/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.ponyModel.color}</span></span></span><span class="hljs-string">.png`</span></span>; } }</code> </pre> <br>  O mecanismo de renderiza√ß√£o introduzido no Angular 4 gerou uma classe chamada <code>ngfactory</code> para cada modelo.  A classe geralmente continha (c√≥digo simplificado): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">View_PonyComponent_0</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> viewDef(<span class="hljs-number"><span class="hljs-number">0</span></span>, [ elementDef(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">"div"</span></span>), elementDef(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"ns-image"</span></span>, View_ImageComponent_0), directiveDef(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">49152</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, i2.ImageComponent, { <span class="hljs-attr"><span class="hljs-attr">src</span></span>: [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"src"</span></span>] }), elementDef(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"div"</span></span>), elementDef(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, [<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>]) ], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">check, view</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> component = view.component; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currVal_0 = component.getPonyImageUrl(); check(view, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, currVal_0); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">check, view</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> component = view.component; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currVal_1 = component.ponyModel.name; check(view, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, currVal_1); }); }</code> </pre> <br>  √â dif√≠cil de ler, mas as principais partes deste c√≥digo s√£o descritas a seguir: <br><br><ul><li>  A estrutura do DOM criado, que cont√©m as defini√ß√µes dos elementos ( <code>figure</code> , <code>img</code> , <code>figcaption</code> ), seus atributos e defini√ß√µes dos n√≥s de texto.  Cada elemento da estrutura DOM na defini√ß√£o de matriz de visualiza√ß√µes √© representado por seu pr√≥prio √≠ndice. </li><li>  Fun√ß√µes de detec√ß√£o de altera√ß√µes;  o c√≥digo contido neles verifica se as express√µes usadas no modelo resultam nos mesmos valores de antes.  Aqui, o resultado do m√©todo <code>getPonyImageUrl</code> √© <code>getPonyImageUrl</code> e, se for alterado, o valor de entrada para o componente de imagem √© atualizado.  O mesmo se aplica ao apelido do p√¥nei: se ele mudar, o n√≥ de texto que cont√©m esse apelido ser√° atualizado. </li></ul><br>  <b>C√≥digo gerado por Ivy</b> <br><br>  Se trabalharmos com o Angular 6 e o ‚Äã‚Äãsinalizador <code>enableIvy</code> definido como <code>true</code> , um <code>ngfactory</code> separado n√£o ser√° gerado no mesmo exemplo;  As informa√ß√µes ser√£o incorporadas diretamente no campo est√°tico do pr√≥prio componente (c√≥digo simplificado): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PonyComponent</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> ngComponentDef = defineComponent({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: PonyComponent, <span class="hljs-attr"><span class="hljs-attr">selector</span></span>: [[<span class="hljs-string"><span class="hljs-string">'ns-pony'</span></span>]], <span class="hljs-attr"><span class="hljs-attr">factory</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PonyComponent(), <span class="hljs-attr"><span class="hljs-attr">template</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">renderFlag, component</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">if</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">renderFlag &amp; RenderFlags.Create</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">elementStart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'figure'</span></span></span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">elementStart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'ns-image'</span></span></span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">elementEnd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">elementStart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'div'</span></span></span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">3</span></span></span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">elementEnd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">elementEnd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">if</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">renderFlag &amp; RenderFlags.Update</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">property</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'src'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, component.getPonyImageUrl(</span></span></span><span class="hljs-function">)); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">3</span></span></span></span><span class="hljs-function"><span class="hljs-params">, interpolate(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">, component.ponyModel.name, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span></span><span class="hljs-function">)); } }, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">inputs</span></span></span><span class="hljs-function">: { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ponyModel</span></span></span><span class="hljs-function">: '</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ponyModel</span></span></span><span class="hljs-function">' }, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">directives</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> [ImageComponent]; }); <span class="hljs-comment"><span class="hljs-comment">// ...   }</span></span></code> </pre> <br>  Agora tudo est√° contido neste campo est√°tico.  O atributo <code>template</code> cont√©m o equivalente ao familiar <code>ngfactory</code> , com uma estrutura ligeiramente diferente.  A fun√ß√£o de <code>template</code> , como antes, ser√° iniciada em qualquer altera√ß√£o, mas agora tem dois modos: <br><br><ul><li>  Modo de cria√ß√£o: o componente est√° sendo criado, cont√©m os n√≥s est√°ticos do DOM que precisam ser criados </li><li>  O restante da fun√ß√£o √© executado a cada altera√ß√£o (se necess√°rio, atualiza a fonte da imagem e o n√≥ de texto). </li></ul><br>  <b>O que isso muda?</b> <br><br>  Agora todos os decoradores s√£o criados diretamente em suas classes (o mesmo para <code>@Injectable</code> , <code>@Pipe</code> , <code>@Directive</code> ) e, para ger√°-los, voc√™ s√≥ precisa saber sobre o decorador atual.  Esse fen√¥meno √© chamado pela equipe Angular de ‚Äúprinc√≠pio da localidade‚Äù: para recompilar um componente, voc√™ n√£o precisa re-analisar o aplicativo. <br><br>  O c√≥digo gerado √© um pouco reduzido, mas, mais importante, √© poss√≠vel eliminar v√°rias depend√™ncias, acelerando a recompila√ß√£o se uma das partes do aplicativo for alterada.  Al√©m disso, com os coletores modernos, por exemplo, o Webpack, tudo se torna muito mais bonito: o c√≥digo n√£o funcional √© cortado com seguran√ßa, as partes da estrutura que voc√™ n√£o usa.  Por exemplo, se voc√™ n√£o possui canais no aplicativo, a estrutura necess√°ria para sua interpreta√ß√£o nem sequer √© inclu√≠da no conjunto final. <br><br>  Estamos acostumados a tornar pesado o c√≥digo angular.  √Äs vezes, n√£o √© assustador, mas o Hello World pesando 37 kb ap√≥s minifica√ß√£o e compacta√ß√£o √© demais.  Quando Ivy √© respons√°vel por gerar o c√≥digo, o c√≥digo n√£o funcional √© cortado com muito mais efici√™ncia.  Agora, o Hello World ap√≥s a minifica√ß√£o √© compactado para 7,3 kb e ap√≥s a compacta√ß√£o - apenas para 2,7 kb, e essa √© uma grande diferen√ßa.  Aplicativo TodoMVC ap√≥s compacta√ß√£o - apenas 12,2 kb.  Trata-se de dados da equipe Angular, e outras pessoas n√£o conseguiram resolver o problema, pois para que Ivy funcione como descrito aqui, voc√™ ainda precisar√° corrigi-lo manualmente. <br><br>  Para mais detalhes, confira esta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">palestra</a> com ng-conf. <br><br>  <b>Compatibilidade com bibliotecas existentes</b> <br><br>  Voc√™ pode estar interessado em: o que acontecer√° com as bibliotecas que j√° s√£o publicadas no formato antigo se o Ivy for usado em seu projeto?  N√£o se preocupe: o mecanismo criar√° uma vers√£o compat√≠vel com Ivy das depend√™ncias do seu projeto, mesmo se elas forem compiladas sem o Ivy.  N√£o vou expor o interior agora, mas todos os detalhes devem ser transparentes. <br><br>  <i><b>Novos recursos</b></i> <br><br>  Vamos considerar quais novas oportunidades teremos ao trabalhar com esse mecanismo de exibi√ß√£o. <br><br>  <i>Propriedades particulares em modelos</i> <br><br>  Um novo mecanismo adiciona um novo recurso ou altera√ß√£o potencial. <br>  Essa situa√ß√£o est√° diretamente relacionada ao fato de que a fun√ß√£o de modelo est√° incorporada no campo est√°tico do componente: agora podemos usar as propriedades particulares de nossos componentes nos modelos.  Isso era imposs√≠vel anteriormente, por causa do qual fomos for√ßados a manter p√∫blicos todos os campos e m√©todos do componente usado no modelo, e eles ca√≠ram em uma classe separada ( <code>ngfactory</code> ).  Ao acessar uma propriedade privada de outra classe, a compila√ß√£o do TypeScript falha.  Agora est√° no passado: como a fun√ß√£o de modelo est√° em um campo est√°tico, ela tem acesso √†s propriedades particulares do componente. <br><br>  Vi um coment√°rio dos membros da equipe Angular sobre o fato de que n√£o √© recomendado o uso de propriedades particulares em modelos, embora isso agora seja poss√≠vel - j√° que isso pode ser proibido novamente no futuro ... portanto, provavelmente √© mais prudente continuar usando apenas campos p√∫blicos em modelos!  De qualquer forma, agora √© mais f√°cil escrever testes de unidade, porque o teste pode verificar o estado de um componente sem gerar nem verificar o DOM para isso. <br><br>  <i>i18n em tempo de execu√ß√£o</i> <br><br>  Observe: o novo mecanismo de renderiza√ß√£o finalmente abre uma oportunidade muito esperada para n√≥s e fornece "i18n em tempo de execu√ß√£o".  No momento da reda√ß√£o, ela ainda n√£o estava pronta, mas vimos v√°rios commits ao mesmo tempo, e este √© um bom sinal! <br>  O legal √© que voc√™ n√£o precisa alterar muito seu aplicativo se j√° estiver trabalhando com o i18n.  Mas agora voc√™ n√£o precisa recriar o aplicativo para cada localidade que planeja oferecer suporte - basta fazer o upload do JSON com tradu√ß√µes para cada localidade, e a Angular cuidar√° do resto! <br><br>  <i>Bibliotecas AoT</i> <br><br>  Atualmente, uma biblioteca lan√ßada no NPM deve publicar o arquivo metadata.json e n√£o pode publicar o c√≥digo AoT de seus componentes.  Isso √© triste, pois os custos associados a essa montagem s√£o repassados ‚Äã‚Äãpara o nosso aplicativo.  Com o Ivy, n√£o h√° necessidade de um arquivo de metadados, e os autores da biblioteca agora poder√£o publicar seu c√≥digo AoT diretamente no NPM! <br><br>  <i>Faixas de pilha aprimoradas</i> <br><br>  Agora, o c√≥digo gerado deve fornecer rastreamentos aprimorados de pilha, se voc√™ tiver um problema com seus modelos - resultar em um erro puro indicando a linha do modelo em que ocorreu.  Voc√™ pode at√© definir pontos de interrup√ß√£o nos modelos e acompanhar o que realmente est√° acontecendo no Angular. <br><br>  <i><code>NgModule</code> desaparecer√°?</i> <br><br>  Essa ainda √© uma perspectiva distante, mas talvez no futuro seja poss√≠vel ficar sem o NgModules.  Os primeiros sinais de tais mudan√ßas s√£o provedores que podem tremer em √°rvore e √© l√≥gico supor que Ivy tenha todos os blocos b√°sicos necess√°rios para aqueles que est√£o prontos para abandonar gradualmente os NgModules (ou, pelo menos, torn√°-los menos responsivos).  √â verdade que tudo isso ainda est√° no futuro, seremos pacientes. <br><br>  N√£o haver√° muitos recursos novos nesta vers√£o, mas Ivy √© definitivamente interessante para o futuro.  Experimente - eu me pergunto como voc√™ vai gostar! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt419389/">https://habr.com/ru/post/pt419389/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt419379/index.html">Por que Tesla e Deutsche Bank recusam contratos de papel</a></li>
<li><a href="../pt419381/index.html">Como os caras do Storyline retornaram do Vale do Sil√≠cio para Minsk com US $ 770 mil para uma startup</a></li>
<li><a href="../pt419383/index.html">Nova t√©cnica de ataque WPA2 que n√£o requer um cliente no AP</a></li>
<li><a href="../pt419385/index.html">Cirurgia card√≠aca: como reescrevemos o principal componente de um sistema DLP</a></li>
<li><a href="../pt419387/index.html">Vulnerabilidades do OWASP Top 10. A1: 2017 - Inje√ß√µes (Parte 1)</a></li>
<li><a href="../pt419391/index.html">Poder, dinheiro e c√≥digo aberto. Contando como a comunidade trabalha com o Apache Ignite</a></li>
<li><a href="../pt419393/index.html">Crie um gateway de API simples no ASP.NET Core</a></li>
<li><a href="../pt419395/index.html">Explica√ß√£o das express√µes lambda</a></li>
<li><a href="../pt419397/index.html">Como criamos um aplicativo m√≥vel para seis pa√≠ses</a></li>
<li><a href="../pt419399/index.html">OpenAI Five derrota uma equipe de pessoas em um show Dota 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>