<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍🤝‍👨🏽 👨🏿‍🎤 👇🏽 Vulnérabilité liée à l'algorithme de hachage MIGS 🧘🏿 🆘 🎤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avec l'avènement des cartes de crédit et d'Internet, les achats sont devenus beaucoup plus faciles et, comme on dit, plus sûrs. En quelques clics, le ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Vulnérabilité liée à l'algorithme de hachage MIGS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/406949/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/cb/6a/59cb6abc2e97c467874554.jpeg"></div><br>  Avec l'avènement des cartes de crédit et d'Internet, les achats sont devenus beaucoup plus faciles et, comme on dit, plus sûrs.  En quelques clics, le produit dont vous avez besoin est déjà en route vers votre domicile.  Cependant, tous les systèmes ne sont pas idéaux, ou plutôt il n'y en a pas.  Vous pouvez toujours trouver une sorte d'erreur, un écart qui permet aux attaquants de faire leur sale boulot.  Aujourd'hui, je voudrais attirer votre attention sur l'étude d'un programmeur très talentueux, Yohanes Nugroho, qui a parlé des vulnérabilités du système MIGS. <a name="habracut"></a><br><br>  Ce texte est une traduction des mots du chercheur en vulnérabilité Yohanes Nugroho lui-même.  Passez un bon moment. <br><br>  <b>Vulnérabilité liée à l'algorithme de hachage MIGS</b> <br><br>  L'année dernière, j'ai découvert une erreur dans l'algorithme de hachage basé sur MD5 utilisé par MIGS (Mastercard Internet Gateway Service).  Il vous a permis de modifier la taille de la transaction.  L'entreprise m'a récompensé pour avoir découvert ce problème.  La même année, le MIGS est passé à l'utilisation du HMAC-SHA256, mais il y avait quelques vulnérabilités. <br><br>  <b>Qu'est-ce que le MIGS?</b> <br><br>  Lorsque vous payez sur un site Web, ses propriétaires connectent généralement leur système à une passerelle de paiement intermédiaire (il y a une transition vers une autre page).  Cette passerelle de paiement est ensuite connectée à plusieurs systèmes de paiement disponibles dans un pays particulier.  Pour les cartes de crédit, de nombreuses passerelles se connectent à d'autres passerelles (dont l'une est MIGS), qui fonctionnent avec de nombreuses banques pour fournir 3DSecure. <br><br>  <b>Comment ça marche?</b> <br><br>  La séquence de paiement, si vous utilisez MIGS, ressemble généralement à ceci: <br><br><ol><li>  Vous sélectionnez un produit sur le site. </li><li>  Entrez votre numéro de carte de crédit. </li><li> Le numéro de carte, la taille du paiement et d'autres paramètres sont signés et renvoyés au navigateur, qui génère automatiquement une demande POST à ​​la passerelle de paiement intermédiaire. </li><li>  Cette passerelle convertit les informations dans un format pris en charge par MIGS, signe avec une clé MIGS et les renvoie au navigateur.  Après quoi, le navigateur génère une autre requête POST au serveur MIGS lui-même. </li><li>  Si 3DSecure n'est pas activé, cette étape est ignorée.  Sinon, le MIGS transfère la demande à la banque qui a émis la carte.  La banque demande OTP et génère du HTML, qui génère une requête POST pour le serveur MIGS. </li><li>  MIGS renvoie les données signées au navigateur et crée une demande POST pour la passerelle de paiement intermédiaire. </li><li>  Validation des données et signature par une passerelle de paiement intermédiaire.  Si les données sont incorrectes, une page d'erreur est générée. </li><li>  Sur la base de la réponse MIGS, la passerelle de paiement transmet l'état du paiement au vendeur. </li></ol><br>  <b>Vulnérabilité dans l'algorithme de hachage MD5</b> <br><br>  Cette erreur est très simple.  La méthode de hachage utilise la formule suivante: <br><br>  <i>MD5 (secret + données)</i> <br><br>  Mais il n'y a aucune vulnérabilité à l'extension de hachage (certaines vérifications ont été effectuées pour éviter cela).  Les données sont formées de cette manière: tous les paramètres de requête commençant par vpc_ sont triés, après quoi les valeurs sont connectées sans séparation.  Par exemple, nous avons les données suivantes: <br><br>  Nom: Joe <br>  Montant: 10000 <br>  Carte: 1234567890123456 <br><br>  vpc_Name = Joe &amp; Vpc_Amount = 10000 &amp; vpc_Card = 1234567890123456 <br><br>  Appliquer le tri: <br><br>  vpc_Amount = 10000 <br>  vpc_Card = 1234567890123456 <br>  vpc_Name = Joe <br><br>  Nous connectons les valeurs: <br><br>  100001234567890123456Joe <br><br>  Remarquez si je modifie les paramètres: <br><br>  vpc_Name = Joe &amp; Vpc_Amount = 1 &amp; vpc_Card = 1234567890123456 &amp; vpc_B = 0000 <br><br>  Appliquer le tri: <br><br>  vpc_Amount = 1 <br>  vpc_B = 0000 <br>  vpc_Card = 1234567890123456 <br>  vpc_Name = Joe <br><br>  Nous connectons les valeurs: <br><br>  100001234567890123456Joe <br><br>  Cette valeur MD5 sera la même.  En effet, lorsque les données sont transférées au MIGS, nous pouvons ajouter un paramètre supplémentaire après la taille du paiement pour supprimer le dernier chiffre, ou avant - pour supprimer le premier.  Et vous pouvez payer 2 $ au lieu de 2000 pour un MacBook. <br><br>  Les passerelles intermédiaires et les commerçants peuvent éviter cette vulnérabilité en vérifiant toujours si le montant du paiement retourné par MIGS correspond à ce qui a été demandé. <br><br>  MasterCard m'a récompensé pour avoir identifié cette erreur avec une prime de 8500 $. <br><br>  <b>Vulnérabilité de hachage dans HMAC-SHA256</b> <br><br>  Le nouveau HMAC-SHA256 présente une vulnérabilité qui pourrait être exploitée si nous injections des valeurs incorrectes dans la passerelle de paiement intermédiaire.  J'ai vérifié cette erreur sur l'une des passerelles de paiement (Fusion Payments).  Ils m'ont payé un bonus de 500 $ pour cela.  Cette vulnérabilité pourrait également affecter d'autres passerelles de paiement connectées au MIGS. <br><br>  Dans la nouvelle version, des délimiteurs (&amp;) entre les champs, des noms de champ (pas seulement des valeurs) ont été ajoutés et, bien sûr, HMAC-SHA256.  Pour les mêmes données que précédemment, la ligne hachée ressemble à ceci: <br><br>  Vpc_Amount = 10000 &amp; vpc_Card = 1234567890123456 &amp; vpc_Name = Joe <br><br>  Nous ne pouvons rien déplacer, tout dans ce plan est en ordre.  Mais que faire si la valeur contient les caractères &amp; ou = ou un autre? <br><br>  Après avoir lu le document de référence d'intégration du client de paiement virtuel MiGS, j'ai trouvé: <br><br>  <i>"Remarque: La valeur dans toutes les paires nom / valeur, à des fins de hachage, ne doit PAS contenir de caractères URL"</i> <br><br>  Je me concentre sur <b>PAS</b> .  Cela signifie que si nous avons les champs suivants: <br><br>  Montant = 100 <br>  Carte = 1234 <br>  CVV = 555 <br><br>  Le hachage sera comme ceci: HMAC (Montant = 100 &amp; Carte = 1234 &amp; CVV = 555) <br><br>  Et si les champs sont comme ça (en utilisant &amp; et =): <br><br>  Montant = 100 et carte = 1234 <br>  CVV = 555 <br><br>  Ce hachage ressemble à ceci: HMAC (Amount = 100 &amp; Card = 1234 &amp; CVV = 555) <br><br>  De la même manière.  Mais jusqu'à présent, pas un tel problème. <br><br>  Bien sûr, je pensais qu'il pourrait y avoir un problème dans la documentation officielle, peut-être que les caractères URL devraient toujours être utilisés.  Mais j'ai vérifié le comportement du serveur MIGS, tout était comme dans le document.  Peut-être qu'ils ne veulent pas travailler avec un encodage différent (comme + au lieu de% 20). <br><br>  Il semble qu'il ne devrait pas y avoir de problème, des valeurs incorrectes seront vérifiées par le MIGS et donneront une erreur (par exemple, la mauvaise taille de paiement sera rejetée). <br><br>  Mais j'ai remarqué que dans certaines passerelles de paiement, au lieu de vérifier les données saisies côté serveur, elles signent et redirigent tout vers MIGS.  Il est beaucoup plus facile de tester JavaScript côté client, de signer les données côté serveur, puis de laisser le MIGS décider si le numéro de carte est correct, si CVV doit être composé de 3 ou 4 chiffres, si la carte expire correctement, etc.  La logique est la suivante: MIGS revérifiera les données et les améliorera. <br><br>  Chez Fusion Payments, j'ai découvert que c'est ce qui se passe: ils vous permettent d'entrer n'importe quelle longueur de code CVV (la vérification a lieu uniquement en JavaScript), puis de signer la demande et de l'envoyer au MIGS. <br><br>  <b>Exploiter</b> <br><br>  Pour exploiter cette vulnérabilité, nous devons créer une chaîne qui sera la bonne requête et obtenir la bonne réponse du serveur MIGS.  Nous n'avons pas besoin de communiquer avec le serveur MIGS, nous faisons simplement signer au client les données correctes. <br><br>  Demande de base: <br><br>  vpc_AccessCode = 9E33F6D7 &amp; vpc_Amount = 25 &amp; vpc_Card = Visa &amp; vpc_CardExp = 1717 &amp; vpc_CardNum = 4599777788889999 &amp; vpc_CardSecurityCode = 999 &amp; vpc_OrderInfo = vdchecfurecurecurecurecurur <br><br>  Et la réponse de base du serveur sera comme ceci: <br><br>  vpc_Message = Approuvé &amp; vpc_OrderInfo = ORDERINFO &amp; vpc_ReceiptNo = 722819658213 &amp; vpc_TransactionNo = 2000834062 &amp; vpc_TxnResponseCode = 0 &amp; vpc_SecureHash = THEHASH &amp; vpc_Secure25Shec2525 <br><br>  Dans le cas de Fusion Payment, l'exploit est implémenté en implémentant vpc_CardSecurityCode (CVV) <br><br>  vpc_AccessCode = 9E33F6D7 &amp; vpc_Amount = 25 &amp; vpc_Card = Visa &amp; vpc_CardExp = 1717 &amp; vpc_CardNum = 4599777788889999 &amp; vpc_CardSecurityCode = 999% 26vpc_Message% 3DApproved% 26vpc_OrderInfo% 3DORDERINFO% 26vpc_ReceiptNo% 3D722819658213% 26vpc_TransactionNo% 3D2000834062% 26vpc_TxnResponseCode% 3D0% 26vpc_Z% 3DA &amp; vpc_OrderInfo = COMMANDER Se &amp; vpc_SecureHash = THEHASH &amp; vpc_SecureHashType = SHA256 <br><br>  La passerelle client / paiement génère le hachage correct pour cette ligne. <br><br>  Maintenant, nous pouvons entrer ces données dans le client lui-même (sans interagir avec le serveur MIGS de quelque manière que ce soit), mais nous allons les modifier un peu pour que le client reconnaisse les variables nécessaires (la plupart des clients vérifient uniquement vpc_TxnResponseCode et vpc_TransactionNo): <br><br>  vpc_AccessCode = 9E33F6D7% 26vpc_Amount% 3D25% 26vpc_Card% 3DVisa% 26vpc_CardExp% 3D1717% 26vpc_CardNum% 3D4599777788889999% 26vpc_CardSecurityCode% 3D999 &amp; vpc_Message = Approuvé &amp; vpc_OrderInfo = COMMANDER Se &amp; vpc_ReceiptNo = 722819658213 &amp; vpc_TransactionNo = 2000834062 &amp; vpc_TxnResponseCode = 0 &amp; vpc_Z = a% 26vpc_OrderInfo% 3DORDERINFO &amp; vpc_SecureHash = THEHASH &amp; vpc_SecureHashType = SHA256 <br><br>  Remarque: <br><br>  Le hachage sera le même que pour les données précédentes. <br>  Le client ignorera vpc_AccessCode et sa valeur. <br>  Le client gérera vpc_TxnResponseCode, etc., en supposant que la transaction est correcte. <br><br>  On peut dire qu'il s'agit d'une erreur client MIGS, mais la méthode de hachage utilisée par MasterCard permet à cette erreur d'exister.  Si les valeurs étaient codées, cette vulnérabilité n'existerait pas. <br><br>  <b>Réponse du MIGS</b> <br><br>  MasterCard n'a pas répondu à ce bogue dans le HMAC-SHA256.  J'ai contacté plusieurs personnes que j'avais précédemment contactées à propos d'une vulnérabilité antérieure.  Il n'y a pas de réponse.  Même se désinscrire dans le style de "nous le testons".  Ils ont mon Facebook s'ils veulent me contacter (depuis la correspondance sur MD5). <br><br>  Certains prétendent apparemment ne pas avoir vu mon rapport, mais j'ai mis un mot de passe sur la lettre.  Il y avait au moins 3 vues de l'adresse IP MasterCard.  Dans le même temps, ce ne sont pas des clics aléatoires sans lecture, car vous devez entrer consciemment le mot de passe.  Je leur écris chaque semaine. <br><br>  Je m'attendais à ce qu'ils avertissent tous ceux qui se connectent à leur système de vérifier et de filtrer les données intégrées. <br><br>  <b>Lacunes dans les passerelles de paiement</b> <br><br>  En outre, je tiens à dire: malgré le fait que les passerelles de paiement traitent de l'argent, elles ne sont pas aussi sécurisées qu'il n'y paraît.  Lors de mes pentests (tests de pénétration), j'ai découvert plusieurs vulnérabilités dans les protocoles de paiement dans plusieurs passerelles intermédiaires.  Malheureusement, je ne peux pas en dire les détails (si je dis "pentest", alors c'est quelque chose qui relève de l'accord de non-divulgation). <br><br>  J'ai également trouvé des erreurs de mise en œuvre.  Par exemple, les attaques par extension de hachage, XML, les erreurs de vérification de signature, etc.  L'un des bogues les plus simples que j'ai trouvés dans Fusion Payments.  Le premier bug que j'ai trouvé était: ils ne vérifient même pas les signatures du MIGS.  Cela signifie que nous pouvons simplement modifier les données renvoyées par MIGS et marquer la transaction comme réussie.  Cela signifie seulement changer un caractère: de F (échoué) à 0 (réussi). <br><br>  Autrement dit, nous pouvons entrer n'importe quel numéro de carte, recevoir une réponse incorrecte du MIGS, la changer et soudain, le paiement devient un succès.  Il s'agit d'une entreprise avec un budget de 20 millions d'euros et j'ai reçu 400 dollars de leur part.  Ce n'est pas la seule passerelle de paiement avec une telle vulnérabilité, lors de mon pentest, j'ai trouvé cela dans d'autres passerelles.  Malgré la petite récompense, Fusion Payments est actuellement la seule passerelle de paiement que j'ai contactée, ce qui est très clair dans son programme de récompense pour les bugs trouvés.  Ils ont répondu très rapidement à mes messages et ont rapidement corrigé leurs bugs. <br><br>  <b>Conclusion</b> <br><br>  Les passerelles de paiement ne sont pas aussi sécurisées que vous le pensez.  Avec des récompenses aussi faibles (et dans certains cas, j'ai reçu 0 $), je me demande combien de personnes ont déjà exploité ces vulnérabilités dans les passerelles de paiement. <br><br>  <b>Remarque du traducteur</b> <br><br>  De ma part, je voudrais ajouter quelques mots aux conclusions de l'auteur de l'étude.  Tout d'abord, cette étude est un avertissement et un appel à la prudence pour les vendeurs, car les vulnérabilités constatées en font les victimes des intrus.  Mais il existe de nombreux autres bugs qui peuvent nuire aux clients (titulaires de carte, utilisateurs de systèmes de paiement, etc.).  Soyez prudent lorsque vous saisissez vos informations de facturation personnelles sur un site non vérifié.  Mieux encore, ayez à votre disposition une carte bancaire distincte, sur laquelle il y aura exactement le montant dont vous avez besoin pour effectuer un achat sur Internet. <br><br>  Avez-vous rencontré des bugs dans les systèmes de paiement, ou peut-être avez-vous même été victime de ces bugs?  Partagez vos expériences, opinions et conseils sur la façon de vous protéger dans les commentaires.  Passez une bonne journée et faites du shopping en toute sécurité. <br><br>  <b>Comme une publicité.</b>  Promotion!  Obtenez maintenant <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">jusqu'à 4 mois d'utilisation gratuite de VPS (KVM) avec des disques dédiés aux Pays-Bas et aux États-Unis</a> (configurations de VPS (KVM) - E5-2650v4 (6 cœurs) / 10 Go DDR4 / 240 Go SSD ou 4 To HDD / 1 Gbit / s 10 To - 29 $ / mois et au-dessus, des options avec RAID1 et RAID10 sont disponibles)</b> , un analogue à part entière de serveurs dédiés, lors d'une commande pour une période de 1 à 12 mois, les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">conditions de l'action sont ici,</a> les abonnés existants peuvent obtenir 2 mois en bonus! <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment construire l'infrastructure du bâtiment.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">classe utilisant des serveurs Dell R730xd E5-2650 v4 coûtant 9 000 euros pour un sou?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr406949/">https://habr.com/ru/post/fr406949/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr406937/index.html">Ce n'est pas miné: dans quels pays du monde les crypto-monnaies sont-elles interdites</a></li>
<li><a href="../fr406939/index.html">Ce que les auditeurs et les animateurs de radio détestent</a></li>
<li><a href="../fr406941/index.html">Wynd - l'air frais personnel, où que vous soyez</a></li>
<li><a href="../fr406943/index.html">Richard Stallman s'inquiète de l'amour de Microsoft pour Linux</a></li>
<li><a href="../fr406947/index.html">À New York, mise en vente du test de mise en page "Sputnik-1" avec un module radio à l'intérieur</a></li>
<li><a href="../fr406951/index.html">Marea: achèvement du câble transatlantique de Microsoft et Facebook</a></li>
<li><a href="../fr406953/index.html">Phare Meta</a></li>
<li><a href="../fr406955/index.html">La gestion de la liquidité et l'automatisation des créances et dettes sont des innovations importantes pour les petites entreprises</a></li>
<li><a href="../fr406957/index.html">Dell aide Pixomondo à créer de superbes effets visuels à succès</a></li>
<li><a href="../fr406959/index.html">Écosystème sonore: qu'est-ce que c'est et comment travailler avec lui</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>