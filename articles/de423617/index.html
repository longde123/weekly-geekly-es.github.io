<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüë©‚Äçüëß üï∏Ô∏è üëéüèΩ Verwenden eines iPhone-Akkus zum Entwerfen tragbarer Elektronik üë®üèª‚Äçüíº üë®‚Äçüç≥ ü§î</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Gr√º√üe, Leser. 

 Sehr oft habe ich die Aufgabe, tragbare Ger√§te zu entwickeln, die mit einem Einzelzellen-Li-Ionen-Akku betrieben werden. Und wenn die...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Verwenden eines iPhone-Akkus zum Entwerfen tragbarer Elektronik</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423617/">  Gr√º√üe, Leser. <br><br>  Sehr oft habe ich die Aufgabe, tragbare Ger√§te zu entwickeln, die mit einem Einzelzellen-Li-Ionen-Akku betrieben werden.  Und wenn dies normalerweise kein Problem f√ºr den Kunden ist, l√§uft mir als erfahrener Ingenieur ein Schauer durch den R√ºcken, wenn ich eine solche TK sehe.  Dies liegt an der Tatsache, dass die Beurteilung des Batteriestands sowie der verbleibenden Batterielebensdauer eine sehr schwierige Aufgabe ist, obwohl dies auf den ersten Blick anders erscheinen mag. <br><br><img src="https://habrastorage.org/webt/ws/kh/og/wskhog7wo9xnqs6b3-perfg2zpe.png"><br><br>  In diesem Fall gibt es mehrere Handlungsoptionen, auf die wir weiter unten eingehen werden. <br><a name="habracut"></a><br>  <b>-</b> Am einfachsten ist es, nichts zu tun, um den Ladezustand des Akkus zu bestimmen.  Die Ladeschaltung auf einem einfachen linearen Speicher (z. B. auf TP4054) und einem Spannungswandler zur Stromversorgung des Ger√§ts.  Schaltet sich ohne Vorwarnung und im ung√ºnstigsten Moment aus. <br><br>  <b>-</b> Batteriespannung messen.  Das Ergebnis ist ungef√§hr das gleiche wie im vorherigen Absatz, erfordert jedoch mehr Aufwand.  Typisches Messschema: <br><br><img src="https://habrastorage.org/webt/0g/ff/3y/0gff3ybn_7u0r95qrs7zinzrhr4.png"><br><br>  Tats√§chlich ist dies ein Spannungsteiler f√ºr die Widerst√§nde R19 und R21, die √ºber einen VT6-Schl√ºssel verbunden sind.  Der VT7-Transistor wird ben√∂tigt, um die parasit√§re Stromversorgung des MK √ºber den EN-Anschluss zu eliminieren. <br>  VBAT - Batteriespannung <br>  VBAT_mes - Spannung, die zum ADC kommt <br>  DE - Teilersteuersignal (0-aus, 1-ein) <br><br>  Jetzt kennen wir die Batteriespannung, wir sind tolle Leute.  ABER es gibt fast nichts !!!  Tatsache ist, dass eine typische Entladungskurve eines Li-Ionen-Akkus, gelinde gesagt, nicht linear ist und vom Stromverbrauch und der Temperatur des Akkus selbst abh√§ngt: <br><br><img src="https://habrastorage.org/webt/i7/gz/d1/i7gzd1gllelpirlcxygnosgkody.gif"><br><br>  K√∂nnen Sie anhand dieser Grafiken feststellen, wie hoch die verbleibende Batteriekapazit√§t bei einer Spannung von 3,5 V ist?  Ich denke nicht ... <br><br>  Diese Methode kann leicht verbessert werden, indem der im MC integrierte W√§rmesensor verwendet wird, um die Temperatur der Batterie zu approximieren, oder Sie k√∂nnen entweder einen Sensor zum Messen des Stroms einsetzen oder (wenn der Stromverbrauch ungef√§hr konstant ist) eine Entladungskurve f√ºr einen typischen Stromverbrauch erstellen.  Dies wird zumindest eine kleine Rechtfertigung der Arbeitskosten erm√∂glichen, aber von Genauigkeit kann nicht die Rede sein.  Um die Ladung auf 3 LEDs anzuzeigen - ja, wird es. <br><br>  Bei konstantem Stromverbrauch k√∂nnen Sie die Batterielebensdauer nutzen und die verbrauchte Ladung sowie die zum Laden aufgewendete Zeit zur Beurteilung der akkumulierten Ladung sch√§tzen.  Diese Methode ergibt einen kumulativen Fehler, da die Kalibrierung nur an zwei Punkten (Vollladung oder Vollentladung) erfolgen kann und diese nicht immer erreicht werden.  Wenn sich die Batterie verschlechtert, sollte au√üerdem die maximale Betriebszeit angepasst werden. Im Allgemeinen hat die Methode jedoch das Recht auf Lebensdauer. <br><br>  <b>-</b> Erstellen Sie Ihr eigenes Batterielade√ºberwachungssystem (BMS).  F√ºr die Implementierung ben√∂tigen wir Sensoren f√ºr Strom, Temperatur und Batteriespannung.  Wir glauben, dass MK bereits im Ger√§t vorhanden ist und es ‚Äûnur‚Äú bleibt, Software daf√ºr zu schreiben, was mich einmal etwas weniger als ein Jahr gekostet hat. <br><br>  <b>-</b> Nehmen Sie den fertigen Gasanzeige-Chip (z. B. von TI oder Maxim Integrated), konfigurieren Sie ihn, kalibrieren Sie und arbeiten Sie.  Zum Beispiel das Diagramm f√ºr bq27220: <br><br><img src="https://habrastorage.org/webt/ob/c6/sk/obc6skpnnbt-w_ikd611wqplbhc.png"><br><br>  Bei der Auswahl dieses Konzepts gibt es mehrere Nuancen: <br><br><ol><li>  Wenn der Akku herausnehmbar ist, m√ºssen Sie entweder den Stromkreis zur Ermittlung der Ladung auf den Akku selbst setzen (andernfalls wird er beim Trennen auf Null zur√ºckgesetzt) ‚Äã‚Äãoder spezielle Versionen der Gasanzeige verwenden, mit denen der Akku getrennt werden kann.  Im ersten Fall wird der Akku Ihres Ger√§ts einzigartig und kann nur mit Ihrer Teilnahme ausgetauscht werden, was nicht immer bequem ist.  Im zweiten Fall besteht das Problem, den Temperatursensor an der Batterie anzubringen. </li><li>  Kosteng√ºnstige L√∂sung.  Hauptkomponenten: Gasanzeigechip, Schutzchip, Transistoren, Thermistor, Stromsensorwiderstand. </li></ol><br>  <b>-</b> Verwenden Sie einfachere Optionen f√ºr schl√ºsselfertige L√∂sungen wie CW2015: <br><br><img src="https://habrastorage.org/webt/qa/wh/fp/qawhfpgzcdscvtnrgh4jcgw0evq.png"><br><br>  Dies ist das chinesische Analogon des MAX17048-Chips.  Ein absolut einfacher Chip ohne Temperatur- und Stromsensoren, mit entsprechend geringer Genauigkeit, aber gleichzeitig billig, einfach zu bedienen und zu programmieren.  Es kann an der Seite des Ger√§ts arbeiten, wodurch der Akku selbst nicht ver√§ndert werden kann.  Die Mikroschaltung wurde beim Schreiben von Material auf den Freifl√§chen des Netzwerks gefunden, es gibt keine Erfahrung damit, aber es besteht der Wunsch, es zu versuchen, da die Option wirklich interessant ist.  Vielleicht werde ich im n√§chsten Artikel ausf√ºhrlicher √ºber diesen Chip sprechen. <br><br>  <b>-</b> Und schlie√ülich die letzte Methode, die ich kenne und die ich dem heutigen Artikel widmen m√∂chte.  Meiner Meinung nach ist diese Methode die einfachste, liefert aber das beste Ergebnis.  Es besteht darin, dass wir den Akku mit integrierter Gasanzeige und Schutz vom iPhone nehmen, √ºber HDQ oder I2C verbinden, abfragen und arbeiten.  In diesem Fall ist die Batterie bereits zusammengebaut und kalibriert.  Unten finden Sie eine Tabelle mit mir bekannten Batterieoptionen: <br><br><img src="https://habrastorage.org/webt/rg/v-/ug/rgv-uggse_y-oethz2ppdzrtb_a.png"><br><br>  Die Tabelle stammt teilweise von den Websites <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ripitapart.com</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.macplus.ru</a> .  Bitte achten Sie besonders auf den unbekannten Controller mit der Bezeichnung A1141.  Dieser Chip wird von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PowerFlash hergestellt</a> und dies sind alle Informationen, die gefunden werden konnten.  Der Autor des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Blogs,</a> aus dem ich den Tisch nahm, war sich nicht sicher, ob er den Originalakku vom iPhone SE erhalten hatte.  Dank des R√ºckrufs von <b>asterix_tyumen</b> , mit dem die Originalbatterie von SE zerlegt wurde, wurde festgestellt, dass sie sn27545 kostet.  Im Folgenden werden wir gezwungen sein, den A1141 genauer zu betrachten.  Aber jetzt schauen wir uns die Batterien an: <br><br><img src="https://habrastorage.org/webt/fc/lc/4l/fclc4lpb7ypo6w4vudjrg79zqko.png"><br><br>  Wie Sie sehen k√∂nnen, ist der Akku f√ºr jeden Geschmack und jede Farbe mit und ohne Apfel geeignet.  Sie k√∂nnen auch parallel geschaltet werden, um die Kapazit√§t durch separate Abfrage zu erh√∂hen.  Von den M√§ngeln ist anzumerken, dass das Verh√§ltnis von L√§nge zu Breite etwa 3: 1 betr√§gt, was nicht immer praktisch ist, sowie ein einzigartiger Anschluss zum Anschlie√üen.  Aufgrund der Beliebtheit von Apple-Handys k√∂nnen diese Akkus an vielen Orten und in gro√üen Mengen sicher gekauft werden (wie sich herausstellte, ist dies nicht ganz richtig). <br><br>  Bei der Entwicklung eines <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">drahtlosen eigenst√§ndigen RFID-Leseger√§ts sind</a> wir diesen Weg gegangen. <br><br><img src="https://habrastorage.org/webt/cp/hq/vh/cphqvhsqgrbt586x74tk4q3-xty.jpeg"><br><br>  Der Akku des iPhone 6 wurde ausgew√§hlt, der uns in Bezug auf Kapazit√§t und Gr√∂√üe entsprach.  Zur √úberpr√ºfung wurden mehrere Exemplare an verschiedenen Orten gekauft: <br><br><img src="https://habrastorage.org/webt/fk/vu/fj/fkvufjecvn19x89jigbrv776zfu.jpeg"><br><br>  Der richtige wurde in China gekauft, der Rest in Moskau.  Die Kosten betragen $ 6-11.  Wenn sie √ºberpr√ºft werden, werden ziemlich interessante Ergebnisse erhalten.  Achten Sie besonders auf die Box mit der Aufschrift "Orig", sp√§ter werden wir darauf zur√ºckkommen.  Die √úberpr√ºfung wurde mit dem RFID-Leseger√§t selbst, dem Programmierer TI EV2300 und Battery Management Studio durchgef√ºhrt. <br><br>  Die Stromversorgungsschaltung des RFID-Leseger√§ts ist in der Abbildung dargestellt: <br><br><img src="https://habrastorage.org/webt/qo/6x/sx/qo6xsxtbahocxjy_psg6ufypuxk.png"><br><br>  Linearer Speicher basierend auf STC4054 (TP4054), Ladestrom 500 mA, selbst w√§hlender Leistungsschalter basierend auf Reedschalter SF1, Kondensator C19, Diode VD4 und Widerstand R15 sowie ein Impulswandler basierend auf NCP1529. <br><br>  Das erste Mal habe ich eine Kopie aus China f√ºr 6 Dollar angeschlossen: <br><br><img src="https://habrastorage.org/webt/nb/qx/pj/nbqxpjz_o9zlq-p6w5vbsafunvo.png"><br><br>  Die Batterie reagiert, ABER der Strom wurde weder w√§hrend des Ladens noch w√§hrend des Entladens angezeigt, die Spannung entsprach nicht dem, was tats√§chlich gemessen wurde, und der Ladungsgrad √§nderte sich nicht.  Der Akku reagierte nicht auf Befehle.  Es wurde angenommen, dass es sich bei dieser Instanz um eine F√§lschung handelt, daher habe ich ein Schutzband entfernt, um auf die Tafel zu schauen: <br><br><img src="https://habrastorage.org/webt/d7/u1/bt/d7u1btz9c2lmev89z_meth6c1li.jpeg"><br><br>  Dies ist eine Wende ... Ich habe die Schaltung nicht einmal neu gezeichnet - hier ist klar, dass es einen bq27545-Emulator und eine Schutzschaltung vor √úberentladung / √úberladung gibt.  Sofort kam die Idee, sich Zeit zu sparen und alle Batterien zu √∂ffnen. <br><br><img src="https://habrastorage.org/webt/nw/es/uv/nwesuvggds1wjz4xkcp-hix4n1s.jpeg"><br><br>  Der Nachbar links vom chinesischen Kollegen f√ºr 8 US-Dollar √§hnelt dem Unterschied in der Markierung auf den Chips.  Der Rest verh√§lt sich genauso.  Diese 2 Kopien sind sofort im Papierkorb.  Leider hatte ich das iPhone 6 nicht zur Hand, um diese Batterien im Zielger√§t zu √ºberpr√ºfen. Es war sehr interessant zu sehen, wie sich das Telefon verhalten w√ºrde, wenn mit diesen Batterien gearbeitet wird. <br><br><img src="https://habrastorage.org/webt/ft/c5/v9/ftc5v9rgjn6dgcrau78bdndqccg.jpeg"><br><br>  Und dies ist eine zentrale Batterie, die 8 US-Dollar kostet.  Es hat sogar einen Stromsensor und eine Art 8-poligen Mikroschaltkreis mit einer bescheidenen Markierung 6G3.  In Battery Management Studio gibt diese Batterie vor, die bq27545 geschickter zu sein.  Der Ladezustand, die korrekte Spannung und der Batteriestrom werden angezeigt.  Aber wenn all dies real w√§re, w√§re die F√§lschung keine F√§lschung.  In der Realit√§t wurde die Temperatur durch eine Konstante eingestellt, der Strom wurde sehr schlecht gemessen.  Das Bild zeigt den Stromverbrauch des RFID-Leseger√§ts, der von der Batterie bei konstantem Ablesen der Karte gemessen wird. <br><br><img src="https://habrastorage.org/webt/ze/tf/tl/zetftlpv8pt7ajm0rzslb9kn-tq.png"><br><br>  In der Realit√§t betr√§gt sie f√ºr einen solchen Betriebsmodus ~ 55 mA, und da das Leserfeld immer eingeschaltet ist, kann es nicht Null sein.  Beim Laden (wenn der Strom √ºber einen langen Zeitraum konstant ist) funktioniert der Stromsensor einwandfrei.  Nat√ºrlich werden alle anderen Parameter falsch berechnet (Ladezustand, Betriebszeit bis zur vollst√§ndigen Entladung usw.).  Das FC-Flag (Full Charge) ist auf 4,4 V gesetzt. <br><br><img src="https://habrastorage.org/webt/j7/g_/dw/j7g_dwkhejdguxcchvr-schljyu.png"><br><br>  Die Batterie reagiert nicht auf Befehle, die Flags QEN und RUP_DIS sind nicht gesetzt.  Im Allgemeinen ist dies ein erfolgloser Versuch der Chinesen, den Trick bq27545 auf MK zu schreiben (auf jeden Fall denke ich, dass dies der Fall ist).  Auch im M√ºll. <br><br>  Denken Sie daran, ich habe darum gebeten, der Kopie in der Schachtel mit der Aufschrift "Orig" besondere Aufmerksamkeit zu schenken.  Es war er, der sich als so nah wie m√∂glich an dem herausstellte, wonach wir suchten (und wie man der Werbung jetzt nicht glauben kann?): <br><br><img src="https://habrastorage.org/webt/hg/oj/3d/hgoj3d1hpv0omsd1n427kc-wjl0.jpeg"><br><br>  Die Kosten betrugen 9 US-Dollar.  In der Mitte sehen Sie deutlich den Chip mit der Bezeichnung SN27545 - genau das haben wir gesucht.  Mit dieser Instanz begann ich enger zu arbeiten.  W√§hrend des Lade-Entlade-Testzyklus traten Probleme auf.  Ich konnte das FC-Flag (Full Charge) nicht setzen, was das Ende des Ladevorgangs bedeutete.  Der Ladestrom bei einer Batteriespannung nahe 4,2 V wurde extrem klein (ca. 20 mA) und der Ladevorgang drohte niemals zu enden.  Einer der m√∂glichen Gr√ºnde war ein USB-Kabel mit einem gro√üen Spannungsabfall (4,5 V erreichten den Speicherchip). Wir haben es durch ein besseres mit einem geringeren Spannungsabfall ersetzt.  Die Anzeigen verbesserten sich, die Batterie wurde auf 4,2 V aufgeladen, der Strom fiel auf 0 ab, aber der Ladezustand (Ladezustand - Ladezustand) erreichte nur 85, sodass das FC-Flag nicht gesetzt wurde. <br><br><img src="https://habrastorage.org/webt/wi/yj/vk/wiyjvks7vaannnb1-rsbribojxm.png"><br><br>  Ich fuhr mehrere Tage lang Fahrr√§der mit der Erwartung, dass die Batterie lernen w√ºrde, aber das half nicht.  Das Problem stellte sich als allt√§glich heraus, aber die Suche dauerte 2 Tage.  Irgendwann bemerkte ich, dass die Batterie 4,35 V hat und dies war die Antwort auf alle Fragen.  Der Speicher ist Standard bei 4,2 V und ich habe √ºberhaupt nicht bemerkt, dass der Akku bei 4,35 V ist und eine unvollst√§ndige Ladung vorliegt.  Da die Platinen bereits hergestellt wurden, bestand die einzige M√∂glichkeit, aus der Situation herauszukommen, darin, nach einem Ersatz f√ºr den STC4054 mit einer Spannung von 4,35 V zu suchen.  Es stellte sich heraus, dass solche Mikroschaltungen existieren, aber Sie k√∂nnen sie in unserem gro√üartigen Land nicht kaufen (anscheinend sind sie vom Wort her v√∂llig unbeliebt).  Daher wurde die MCP73832T-3-Version mit ein paar Wochen Wartezeit bestellt. <br><br>  In der Zwischenzeit, die bestellten Fahrten, werden wir einen kollektiven Farm-Patch erstellen, um das Konzept zu √ºberpr√ºfen.  Erstellen Sie dazu mit einer Diode ein "Backup" von 0,15 V f√ºr den Speicherchip: <br><br><img src="https://habrastorage.org/webt/8s/ft/mi/8sftmi64vw_xtce2htduhh_gt44.png"><br><br>  Ich muss zugeben, dass die Kollektivfarm funktioniert hat, das FC-Flag gesetzt wurde, alles funktioniert, aber die endg√ºltige Batteriespannung betr√§gt 4,4 V (der Abfall der Diode ist gr√∂√üer als die erforderlichen 0,15 V). <br><br><img src="https://habrastorage.org/webt/wx/hb/aa/wxhbaaplpa9gagt0vpls28kzirk.png"><br><br>  Es ist wichtig zu beachten, dass es m√∂glich ist, bis zu 4,2 V mit einem entsprechenden Verlust von ~ 15% der Kapazit√§t aufzuladen, gleichzeitig aber die Lebensdauer des Akkus erheblich zu verl√§ngern.  Wir haben die Kopie von Orig fertiggestellt - sie kann sicher in die Entwicklung √ºbernommen werden. <br><br>  Die letzte Kopie bleibt √ºbrig.  Am teuersten (11 US-Dollar), in der coolsten Verpackung und mit der h√∂chsten Zeit f√ºr sich.  Wir schauen hinein: <br><br><img src="https://habrastorage.org/webt/ex/r-/kz/exr-kzemael4n2lpvhewzuq4-hm.jpeg"><br><br>  Hier handelt es sich um einen unbekannten A1141-Chip, f√ºr den es keine andere Dokumentation als die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Herstellerseite gibt</a> .  Bei erzwungener Verbindung zu bq27545 in Battery Management Studio wird das folgende Bild angezeigt: <br><br><img src="https://habrastorage.org/webt/cv/eq/fb/cveqfbcfpdguby-7cawqy06sivg.png"><br><br>  Voller M√ºll.  Beim Versuch, mit einem Strom von ~ 500 mA zu laden, werden 125 mA angezeigt, w√§hrend beim Entladen mit einem Strom von ~ 25 mA 214 mA angezeigt werden.  Es ist klar, dass, wenn der A1141 andere Parameteradressen oder ein anderes Format zum Speichern von Daten als bq27545 hat, nichts ohne Dokumentation mit dieser Batterie leuchtet.  Daher wurde es beiseite gelegt, aber am Ende des Schreibens des Materials entschied ich mich, es wieder anzuschlie√üen.  Ich habe die Chipbefehlstabelle bq27545 genommen: <br><br><img src="https://habrastorage.org/webt/le/d2/bk/led2bk_-eatwxsizt2gdrnd8sly.png"><br><br>  Und ich habe die Spannungsregister (0x08 und 0x09) √ºber das Men√º Advanced Comm gelesen: <br><br><img src="https://habrastorage.org/webt/kc/cl/9o/kccl9oh1im7n8upg5i9im3y8hoi.png"><br><br>  Holen Sie sich 0x10 &lt;&lt; 8 |  0x38 = 4152 oder 4,152 V, was einer mit einem Multimeter gemessenen Spannung von 4,15 V entspricht.  Wenn die Daten korrekt sind, warum werden im Programm 57 mV angezeigt?  Wir stellen fest, dass 57 mV genau 0x38 ist, dh der Wert ist 0x08 Register.  Mit einer Spannung von 4,152 V an der Batterie sieht der Ladezustand von 96% ganz richtig aus. Sie k√∂nnen ihn erhalten, indem Sie die Register 0x2c und 0x2d lesen.  Lesen Sie 0x2c = 0x60, 0x2d = 0 (im Fall des SOC-Parameters ist das h√∂chste Register immer Null).  Es wurde angenommen, dass das Programm oder der EV2300 weder das High-Byte in der Anforderung noch ein Byte mit einer ungeraden Adresse lesen kann (oder die Batterie nicht reagiert).  Um diese Theorie zu testen, wurde die Batterie direkt an den RFID-Leser angeschlossen und die Batterie wurde √ºber den MK abgefragt.  Die HDQ-Schnittstelle wurde gem√§√ü einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokument von TI</a> implementiert.  Der bq27545-Chip verwendet das Single-Wire-HDQ-Protokoll zur Kommunikation mit dem Steuercontroller, der auf STM32 dank der Unterst√ºtzung des Halbduplex-Modus auf der Basis eines Single-Wire-UART recht bequem implementiert wird. <br><br>  Weil  Unser RFID-Leseger√§t funktioniert mit MicroPython. Wir haben die Arbeit mit HDQ in einer Klasse zusammengefasst und die Arbeit mit dem Laderegler in der folgenden Form erhalten: <br><br>  von hdq HDQ importieren <br>  bat = HDQ (pyb.UART (1)) <br>  bat.charge () # Geb√ºhr <br>  bat.read_u16 (0x14) # beliebiges Register <br><br>  Tats√§chlich stellte sich heraus, dass A1141 nicht auf eine Anforderung zum Lesen von Bytes mit ungeraden Adressen reagiert. <br><img src="https://habrastorage.org/webt/wa/lo/jr/walojrft1ezmjmrguuotfjfjl5i.png"><br>  Die Wellenform zeigt an, dass eine Anforderung vorliegt, jedoch keine Antwort.  Als sie vor jeder Anforderung einen Neustart der Logik des Datenaustauschs (Pause) hinzuf√ºgten - jedes zweite Mal, aber die Mikroschaltung begann korrekt zu reagieren. <br><br><img src="https://habrastorage.org/webt/t6/ht/oi/t6htoivlgn1nng-zodal_-hqbl4.png"><br><br>  Dann haben wir den Wechselkurs des EV2300 und die RFID des Leseger√§ts verglichen und es stellte sich heraus, dass der EV2300 eine Geschwindigkeit verwendet, die 10-15% niedriger ist als die TI-S√§tze: <br><br><img src="https://habrastorage.org/webt/22/je/07/22je07teuaf7b5t0ppbkjf5zroy.png"><br><br>  Nachdem der HDQ verlangsamt und Break abgeschlossen wurde, funktionierte der Akku bei jeder Anfrage normal!  Die Hauptparameter der Batterie wurden gelesen: <br><br><img src="https://habrastorage.org/webt/jg/fu/r5/jgfur5j37kq31_df2x5oyci0lxe.png"><br><br>  Kompletter Sieg!  Tats√§chlich stellte sich heraus, dass A1141 ein hochwertiger Klon von bq27545 mit geringf√ºgigen Fehlern ist.  Es bleibt noch √ºber die Nuancen der Arbeit mit dem Akku von der Softwareseite aus zu sprechen (unter Verwendung von Schlafmodi, Weckstrom usw.), aber dies wird die Menge der Aufnahme verdoppeln und ich werde es vielleicht ein anderes Mal schreiben. <br><br><h4>  Schlussfolgerungen </h4><br>  Wie Sie sehen, gibt es viele M√∂glichkeiten, Ger√§te mit Li-Ionen-Batterien zu entwickeln.  Ehrlich gesagt war urspr√ºnglich geplant, Material im Stil von Come, Saw, Won zu schreiben, aber dabei kamen viele Nuancen heraus (der Kampf mit A1141 ist besonders gut), und das Material erwies sich als sehr interessant und umfangreich.  Von den 5 Batterien k√∂nnen tats√§chlich nur 2 normal verwendet werden.  Daher ist die Wahl des Lieferanten in diesem Fall sehr relevant.  Wenn Sie den Akku von anderen Ger√§ten gesehen haben, die BMS enthalten, schreiben Sie das Modell in die Kommentare.  Vielen Dank f√ºr Ihre Aufmerksamkeit! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de423617/">https://habr.com/ru/post/de423617/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de423603/index.html">RxSwift Teil 1</a></li>
<li><a href="../de423607/index.html">Linus Torvalds gibt seinen harten Stil auf und nimmt sich eine Auszeit</a></li>
<li><a href="../de423609/index.html">Wohin gehen Websites nach dem Tod? Pers√∂nliche Erfahrung</a></li>
<li><a href="../de423611/index.html">Ein-Klick-Zahlung - gut oder b√∂se?</a></li>
<li><a href="../de423615/index.html">Von UX-Spezialisten geforderte Fachkenntnisse (Slice 2018)</a></li>
<li><a href="../de423619/index.html">"Ich beabsichtige zu kaufen" oder der einfachste Weg, um die Qualit√§t einer Lebensmittelsuche zu bewerten</a></li>
<li><a href="../de423621/index.html">Wie sind die ersten Jahre der Roboterrevolution?</a></li>
<li><a href="../de423623/index.html">Management f√ºr einen Geek: Warum sie z√§hlen?</a></li>
<li><a href="../de423625/index.html">Treffen Sie den ersten Mondtouristen</a></li>
<li><a href="../de423627/index.html">Lernen Sie die klassische Administration: Vorschriften, Tools, Southbridge-Skripte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>