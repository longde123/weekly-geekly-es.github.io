<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî≤ üê∂ üí´ Aturan iptables khusus untuk buruh pelabuhan menggunakan zabbix sebagai contoh üå∫ ‚úäüèº üíö</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tugas: Tutup semua koneksi yang masuk kecuali untuk alamat ip tertentu. 

 Ada lingkungan pengujian yang terdiri dari linux dan tiga jendela dengan al...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aturan iptables khusus untuk buruh pelabuhan menggunakan zabbix sebagai contoh</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473222/"> <b>Tugas:</b> Tutup semua koneksi yang masuk kecuali untuk alamat ip tertentu. <br><br>  <b>Ada lingkungan pengujian yang</b> terdiri dari linux dan tiga jendela dengan alamat ip statis.  Di linux, buruh pelabuhan diinstal dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">zabbix</a> , redmine gambar.  Dan pada dua mesin windows agen dari zabbix diinstal dan dikonfigurasi, pada ketiga Anda perlu mengatur kemampuan untuk melihat zabbix.  Penting untuk membatasi pengguna lain dari server zabbix, tetapi tidak membatasi dari redmine. <br><a name="habracut"></a><br>  Semua perintah dieksekusi sebagai root. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dokumentasi resmi</a> mengatakan aturan iptables DOCKER-USER.  Hanya perlu mengubah aturan ini.  Pertama, kita melihat aturan apa, kita fokus hanya pada beberapa aturan. <br><br>  Dapat dilihat bahwa aturan dengan target DOCKER-USER adalah yang pertama dalam aturan FORWARD.  Karena itu, Anda hanya perlu mengubahnya. <br><br><pre><code class="bash hljs">iptables -L FORWARD -n -v Chain FORWARD (policy DROP 0 packets, 0 bytes) pkts bytes target prot opt <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> out <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> destination 421K 169M DOCKER-USER all -- * * 0.0.0.0/0 0.0.0.0/0 419K 167M DOCKER-ISOLATION-STAGE-1 all -- * * 0.0.0.0/0 0.0.0.0/0</code> </pre> <br>  Dari tabel aturan DOCKER, Anda dapat melihat port mana yang terbuka dan alamat ip internal kontainer. <br><br><pre> <code class="bash hljs">iptables -L DOCKER -n -v Chain DOCKER (4 references) pkts bytes target prot opt <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> out <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> destination 0 0 ACCEPT tcp -- !docker_redmine docker_redmine 0.0.0.0/0 172.16.237.2 tcp dpt:3000 0 0 ACCEPT udp -- !br-c56432fe07cc br-c56432fe07cc 0.0.0.0/0 172.16.238.2 udp dpt:162 0 0 ACCEPT tcp -- !br-c56432fe07cc br-c56432fe07cc 0.0.0.0/0 172.16.238.3 tcp dpt:10051 0 0 ACCEPT tcp -- !br-c56432fe07cc br-c56432fe07cc 0.0.0.0/0 172.16.238.4 tcp dpt:443 5 248 ACCEPT tcp -- !br-c56432fe07cc br-c56432fe07cc 0.0.0.0/0 172.16.238.4 tcp dpt:80</code> </pre><br>  Tidak ada aturan khusus dalam aturan DOCKER-USER, seluruh koneksi melewati dirinya sendiri. <br><br><pre> <code class="bash hljs">iptables -L DOCKER-USER -n -v Chain DOCKER-USER (1 references) pkts bytes target prot opt <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> out <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> destination 4180 1634K RETURN all -- * * 0.0.0.0/0 0.0.0.0/0</code> </pre><br>  Pertama-tama, kita akan berurusan dengan jaringan zabbix, yaitu, kita akan membuat nama jaringan yang konstan.  Sehingga saat Anda membuat ulang docker-compose, nama jaringan tidak berubah.  Dari kondisi jaringan saat ini, zabbix memiliki jaringan yang disebut br-c56432fe07cc, yang tidak terlalu baik.  Dalam file * .yaml, tambahkan satu baris yang bertanggung jawab untuk nama jaringan zbx_net_frontend: "com.docker.network.bridge.name:" docker_zabbix ". <br><br>  Bagian dari konfigurasi: <br><br><pre> <code class="bash hljs">networks: zbx_net_frontend: driver: bridge driver_opts: com.docker.network.enable_ipv6: <span class="hljs-string"><span class="hljs-string">"false"</span></span> com.docker.network.bridge.name: <span class="hljs-string"><span class="hljs-string">"docker_zabbix"</span></span></code> </pre> <br>  Setelah kami membuat ulang jaringan.  Harus diganti dengan * .yaml Anda. <br><br><pre> <code class="bash hljs">docker-compose -f docker-compose_v3_ubuntu_mysql_latest.yaml down docker-compose -f docker-compose_v3_ubuntu_mysql_latest.yaml up -d</code> </pre><br>  Kami melihat aturan DOCKER. <br><br><pre> <code class="bash hljs">iptables -L DOCKER -n -v Chain DOCKER (4 references) pkts bytes target prot opt <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> out <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> destination 0 0 ACCEPT tcp -- !docker_redmine docker_redmine 0.0.0.0/0 172.16.237.2 tcp dpt:3000 0 0 ACCEPT udp -- !docker_zabbix docker_zabbix 0.0.0.0/0 172.16.238.2 udp dpt:162 0 0 ACCEPT tcp -- !docker_zabbix docker_zabbix 0.0.0.0/0 172.16.238.3 tcp dpt:10051 0 0 ACCEPT tcp -- !docker_zabbix docker_zabbix 0.0.0.0/0 172.16.238.4 tcp dpt:443 5 252 ACCEPT tcp -- !docker_zabbix docker_zabbix 0.0.0.0/0 172.16.238.4 tcp dpt:80</code> </pre><br>  Tetap menambahkan aturan ke tabel DOCKER-USER.  Pertama-tama, kami memperkenalkan aturan DROP untuk semua koneksi ke jaringan docker_zabbix dari antarmuka eksternal (saya punya <b>eth0</b> ). <br><br><pre> <code class="bash hljs">iptables -I DOCKER-USER -i eth0 -o docker_zabbix -j DROP</code> </pre> <br>  Sekarang semua koneksi ditolak ke jaringan docker_zabbix.  Mari kita aktifkan koneksi untuk satu alamat ip, lebih tepatnya, paket dapat melanjutkan lebih jauh ke depan. <br><br><pre> <code class="bash hljs">iptables -I DOCKER-USER -i eth0 -s 192.168.43.55 -j RETURN</code> </pre> <br>  Jaringan docker_zabbix tidak ditentukan secara eksplisit di sini.  Kami memeriksa ketersediaan zabbix dari host 192.168.43.55 menggunakan powershell. <br><br><pre> <code class="bash hljs">tnc 192.168.43.136 -port 8081 ComputerName : 192.168.43.136 RemoteAddress : 192.168.43.136 RemotePort : 8081 InterfaceAlias : vEthernet (Swich_in) SourceAddress : 192.168.43.55 TcpTestSucceeded : True</code> </pre><br>  Port 8081 terbuka untuk zabbix docker.  Untuk memastikan bahwa zabbix adalah milik port 8081. <br><br><pre> <code class="bash hljs">docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES c047f18a4445 zabbix/zabbix-web-nginx-mysql:ubuntu-4.2-latest <span class="hljs-string"><span class="hljs-string">"docker-entrypoint.sh"</span></span> About an hour ago Up About an hour (healthy) 0.0.0.0:8081-&gt;80/tcp, 127.0.0.1:8443-&gt;443/tcp zabbix_zabbix-web-nginx-mysql_1</code> </pre><br>  Tetapi harus dicatat bahwa aturan harus menentukan port 80, bukan 8081. Jika Anda menentukan port 8081, maka akses ke zabbix tidak akan dibuka.  Untuk tuan rumah kedua, perintahnya. <br><br><pre> <code class="bash hljs">iptables -I DOCKER-USER -i eth0 -p tcp --dport 80 -s 192.168.43.10 -j RETURN</code> </pre> <br>  Untuk host ketiga, buka hanya port 10051, agen aktif digunakan pada host ini. <br><br><pre> <code class="bash hljs">iptables -I DOCKER-USER -i eth0 -p tcp --dport 10051 -s 192.168.43.13 -j RETURN</code> </pre> <br>  Masalah lain, kita tidak bisa keluar dari kontainer ke dunia luar.  Skrip pemberitahuan tidak berfungsi dan tidak dapat memeriksa ketersediaan situs.  Ada satu perintah lagi untuk menyelesaikan koneksi yang sudah ada. <br><br><pre> <code class="bash hljs">iptables -I DOCKER-USER -i eth0 -o docker_zabbix -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT</code> </pre> <br>  Jangan lupa bahwa setelah me-reboot server, aturan yang dibuat dihapus. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id473222/">https://habr.com/ru/post/id473222/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id473202/index.html">Menguji lokalisasi game mobile untuk boneka dari teko</a></li>
<li><a href="../id473206/index.html">Diskusi: bagaimana layanan streaming mengubah budaya musik dan pendekatan penulisan lagu</a></li>
<li><a href="../id473208/index.html">Bagaimana saya menyederhanakan proses pengerjaan proyek sumber terbuka</a></li>
<li><a href="../id473214/index.html">Yaga - Kisah Slavia dalam pengaturan seluler</a></li>
<li><a href="../id473220/index.html">Landasan penghancuran kode lambat dalam Bahasa Wolfram: mempercepat kode puluhan, ratusan dan ribuan kali</a></li>
<li><a href="../id473224/index.html">Pendidikan tinggi vs kompetensi. Pendapat terpisah dari hakim Mahkamah Konstitusi Federasi Rusia tentang keadaan pendidikan tinggi</a></li>
<li><a href="../id473228/index.html">Meluruskan Perl dari tahun 1987</a></li>
<li><a href="../id473230/index.html">Apakah Internet Satelit sebuah Ruang Angkasa Baru?</a></li>
<li><a href="../id473232/index.html">Sistem kontrol versi apa yang Anda gunakan (dalam pekerjaan nyata, sebagian besar)?</a></li>
<li><a href="../id473234/index.html">Membuat API REST dengan Node.js dan Oracle Database</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>