<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤵🏽 📽️ 💆 Die Geschichte einer kleinen Legacy-Code-Studie 🚴🏽 📙 👩🏽‍✈️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Es ist gut, wenn jemand mit mehr Erfahrung im Team zeigt, was und wie zu tun ist, auf welchen Rechen und auf welchen Winkel sie warten und wo die best...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Die Geschichte einer kleinen Legacy-Code-Studie</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450384/">  Es ist gut, wenn jemand mit mehr Erfahrung im Team zeigt, was und wie zu tun ist, auf welchen Rechen und auf welchen Winkel sie warten und wo die besten Zeichnungen von Fahrrädern für 2007 auf DVD heruntergeladen werden können.  In dieser Geschichte geht es darum, wie der Wunsch als gültig ausgesprochen wurde, was das Ergebnis war und wie die Krise überwunden wurde. <br><br>  Dies geschah zu einer Zeit, als ich nach mittelmäßiger Erfahrung in der Entwicklung nach einem Ort suchte, an dem man sich von einem Nicht-Junior zu einem selbstbewussten Junior entwickeln (oder mutieren) kann.  Auf mysteriöse Weise des Herrn wurde ein solcher Ort gefunden, ein Projekt an den Ort angehängt und der Programmierer der "alten Schule", der über seine Karriere in Systemen mehr als nur Mädchen schrieb.  „Großartig!  Das Projekt, und deshalb gibt es Geld für das RFP, der Mentor ist angeschlossen, wir leben! “  Ich dachte, aber dann, wie in der Beschreibung eines typischen Horrors, sahen sich die Helden in dunkler Dunkelheit einem schrecklichen Horror ausgesetzt ... <br><a name="habracut"></a><br>  Das Wichtigste zuerst: <br><br><h4>  1. Größe ist wichtig </h4><br>  Wir haben mit der Entwicklung einer einst proprietären PHP-Engine begonnen, die zum Speichern von Daten verwendet wird (hier könnte man meinen, MySQL \ PostgreSQL \ SQLite \ MongoDB \ Etwas anderes, aber notwendigerweise mit dem Suffix DB-sonst) Jungs - nicht verstehen, aber sie haben nicht geraten) api-Gateway. <br><br>  „Haha, schließen Sie mit PHP ein anderes API-Gateway an und speichern Sie Daten darauf?  Ist es nicht einfacher, mit API direkt aus js-code heraus zu arbeiten?  Oder DBMS + PHP verwenden? "  - Fragen Sie den erfahrenen Leser.  Und er wird recht haben.  Aber zu dieser Zeit dachte ich, der die Spezies noch nicht gesehen hatte, nicht, na ja, wer weiß, coole Leute machen das wahrscheinlich, und die Programmierer der „alten Schule“ wissen es besser. <br><br>  Wie mir weiter erklärt wurde: <br><br><ol><li>  Gateway = Sicherheit, niemand wird einfach so ein- und aussteigen </li><li>  Gateway = sicherer Datenspeicher, Sie können einfach nicht darauf zugreifen, + Backups </li><li>  Gateway = Geschwindigkeit, arbeitet schnell und fehlerfrei, erprobt </li><li>  Die maßgebliche Sichtweise von "Old-School" -Programmierern ist, dass Ihr PHP voller Lücken ist, jede Webanwendung standardmäßig gehackt wird, so dass nichts zum Speichern von Daten daneben vorhanden ist </li></ol><br>  Ein charakteristisches Merkmal des API-Gateways war, dass JSON-Daten in einer Get-Anfrage übertragen wurden.  Ja, ja, diese sehr schönen JSON-Objekte wurden einer URL-Codierung unterzogen und in die Abfragezeichenfolge eingefügt.  Und alles wäre in Ordnung, wenn eines Tages plötzlich ... die Länge der Get-Anfrage nicht mehr ausreicht.  Dummerweise passte der URL-codierte JSON Kanalya nicht hinein!  Der Programmierer der „alten Schule“, der sich am Kopf kratzte, fragte: <br>  „Was machen wir jetzt?  Unser json ist gewachsen, aber wir haben es nicht bemerkt ... " <br>  "Nun, vielleicht posten wir sie dann in der Post?"  Ich schlug vor, also scheint es korrekter zu sein. <br>  "Ok, pass zum Posten." <br>  Es war atas Nummer eins. <br><br><h4>  2. Zeit- und Sicherungsverwaltung </h4><br>  Um neue Funktionen in das Projekt einzubinden, musste es implementiert werden <br>  entsprechende CRUD-Anfragen auf dem Gateway, genau das hat unser Kamerad der „alten Schule“ tatsächlich getan.  Das Problem war, dass er dies einmal alle 3 Tage tat und „Fertig, check“ ausgab.  Überprüfungen haben manchmal gezeigt, dass nicht alles funktioniert hat. Zum Beispiel ist es in Ordnung, die Liste abzurufen, und das Hinzufügen eines neuen Elements ist nicht in Ordnung.  Das Reparieren und Verfeinern dauerte einige Zeit. Danach war es möglich, die Funktionalität im Massenzugriff freizugeben.  Der Vorschlag, die Implementierung von Abfragen auf dem Gateway selbst durchzuführen, weil es zumindest schneller ist, wurde abgelehnt, weil "es dort schwierig ist, Sie werden es nicht herausfinden".  Das Ergebnis dieses Ansatzes war der Abschluss der Arbeit „an mir selbst“.  Wenn es zum Beispiel notwendig war, etwas in der Datenbank massenhaft zu reparieren, entschied ich mich für die zweite Option, indem ich zwischen 3-tägigem Warten und der Durchführung von Korrekturen selbst durch Abfragen wählte.  Die Kunden warteten nicht besonders gern, die neue Einführung flog stabil.  Eine solche Einführung, nämlich das massenhafte Anbringen eines Zeichens an den Benutzern eines Zeichens, wurde mir anvertraut, um es umzusetzen. Es gab eine Stunde für alles über alles, die Behörden warteten auf einen schönen Bericht.  Hier erwartet uns atas Nummer zwei. <br><br>  Tatsache ist, dass das Format der in Anfragen übertragenen JSON-Daten nur wenige erforderliche Felder implizierte, alle anderen waren willkürlich, eine klare und endgültige Struktur existierte nicht.  Um beispielsweise einen Benutzer hinzuzufügen, habe ich einen JSON des Formulars übergeben: <br><br><pre><code class="json hljs">POST /api/users { <span class="hljs-attr"><span class="hljs-attr">"email"</span></span>:<span class="hljs-string"><span class="hljs-string">"ivanov@mail.ru"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"password"</span></span>:<span class="hljs-string"><span class="hljs-string">"myEmailIsVeryBig"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name_last"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name_first"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name_middle"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"birth"</span></span>:<span class="hljs-string"><span class="hljs-string">"01.01.1961"</span></span>, //     ,    -    <span class="hljs-attr"><span class="hljs-attr">"living_at"</span></span>:<span class="hljs-string"><span class="hljs-string">"., .3 .4 .24"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"phone_num"</span></span>:<span class="hljs-string"><span class="hljs-string">"+70000000000"</span></span> }</code> </pre> <br>  Der optionale Teil, der in den Add / Update-Anforderungen übertragen wurde, wurde gespeichert und vollständig angegeben (ich werde weiter unten erläutern, wie dies implementiert wurde).  Das Fazit ist, die Zeit steht nicht still, es wäre notwendig, das Problem zu lösen - um Benutzer zu aktualisieren, ihre Etiketten aufzuschreiben.  Aber nicht jedes Mal die ganze Struktur fahren?  Muss überprüfen!  Ich habe es selbst getestet - ich habe nur ein Feld in der Aktualisierungsanforderung übertragen, überprüft, das Feld wurde angezeigt, der Rest der Daten ist vorhanden.  Der Punkt ist klein - Schleife und aktualisieren Sie den Rest. <br><br>  Das Skript paffte leise, empfing und sendete Daten, und alles schien gut zu laufen ... als plötzlich - ein Anruf.  "Wir sehen den Namen der Benutzer im System nicht!"  - Von diesem Ende des Kabels berichten.  „Komm schon!  Nun, es hat geklappt! “  - Eine unangenehme Kälte lief mir über den Rücken.  Weitere Untersuchungen ergaben, dass der Name tatsächlich im Namen angegeben war, obwohl alle anderen Daten vorhanden waren.  Was tun in einer solchen Situation?  Backup bereitstellen! <br><br>  "Genosse" Old-School "Programmierer, mit Problemen hir!  Benötigen Sie ein Backup!  Wann ist die letzte relevante fertig? “  - Ich frage. <br><br>  "Ähh ... ich werde jetzt sehen ...  Nein, es gibt kein Bakapa. " <br><br>  Die Situation wurde durch die Tatsache gerettet, dass ich ein paar Stunden zuvor das Modul mit Berichten fertiggestellt und getestet hatte, eine CSV-Box mit allen erforderlichen Daten hatte und die Bestellung innerhalb einer weiteren Stunde wiederhergestellt wurde. <br><br>  Mangel an verständlicher Dokumentation, Beschreibungen von Arbeitsalgorithmen, Überprüfung der Eingabevalidierung und vor allem - Datenbanksicherungen - als Nummer zwei. <br><br>  Seitdem wurden täglich Backups entfernt. <br><br><h4>  3. Tief auffällig </h4><br>  Wackelig, aber die Arbeit bewegte sich, Probleme wurden gelöst, einige schneller, andere langsamer, als plötzlich ... Kunden erkannten, dass das System von den Servern anderer nicht verstanden wurde, und für eine solche Haltung gegenüber PD und der Organisation von ZI-Aktivitäten in ISPD Sie werden den Kopf nicht streicheln.  Es ist notwendig, den Server auf sich selbst zu übertragen. <br><br>  Warum wurde das System ursprünglich nicht übertragen?  Die Führung hatte eine Leidenschaft - Zentralisierung.  Das Management träumte von einem System, das alles kann!  Müssen Sie ein Kind an die Schule binden?  Sie gehen in das System, in einem speziellen Büro, dort reichen Sie einen Antrag ein.  Sie müssen zum Beispiel Pizza bestellen - Sie gehen in das System, in ein anderes spezielles Büro, beantragen Pizza.  Vielleicht wollten Sie mit schönen Damen / Herren kommunizieren?  Zu Ihren Diensten steht ein dritter Spezialschrank - Sie reichen dort auch einen Antrag ein und so weiter bis ins Unendliche. <br><br>  Vorteile - ein Login und ein Passwort für alles, Daten werden sicher und sicher auf dem Gateway gespeichert.  Es gibt sogar Backups.  Und wohlgemerkt, niemand wird uns dieses System nehmen!  Und selbst wenn es wegnimmt - wie geht es weiter?  Trotzdem werden sie das Schutzsystem gegen "Old-School" -Programmierer nicht verstehen - dort ist alles kompliziert. <br><br>  VDS mit dem System wurde entladen, Kunden zugeschrieben, sie stellten es bereit, jeder tanzt und singt, Schönheit! <br><br>  Und dann bedeckte mich eine Welle der Neugier und des Misstrauens. <br><br>  Wenn unsere Webanwendung voller Lücken ist, wo sind dann die Daten?  Bist du wirklich auf anderen Servern geblieben?  Und wenn sie beschließen, das System von außen zu schließen, wird alles zusammenbrechen? <br><br>  Eine einfache Überprüfung ergab, dass sich die Daten sowie die Gateway-Prozessoren selbst auf demselben Server befanden.  Und nein, sie wurden wegen der Übertragung des Servers nicht dorthin übertragen, sie waren immer da. <br>  Jetzt verfügte ich über die sehr geheime „Old-School“ -Entwicklung, die ich erforschte.  Natürlich hat cooles Reverse Engineering im Stil der Artikel des Hacker-Magazins mit ollydbg, Offsets und anderen coolen Dingen nicht funktioniert, also teile ich, was ich habe. <br>  Die Entwicklung selbst wurde in Python implementiert, es gab nur .pyc-Dateien, die leicht wieder in lesbaren Code dekompiliert werden konnten.  Ehrlich gesagt hat es viel Zeit gekostet, bis zu 25 Minuten, um herauszufinden, wie es funktioniert. <br><br>  Das komplexe System, das vom Programmierer der „alten Schule“ entwickelt wurde und das nur wenige verstehen können, besteht aus: <br><br><ol><li>  Das vom Apache verarbeitete Skript, das die Anfrage tatsächlich erhalten hat.  Was hat dieses Skript gemacht?  Es wurde eine Verbindung zu einem bestimmten lokalen Host-Port hergestellt und dort eine Anforderung mit allen Daten übergeben.  Das ist alles.  Die Interessen gehen weiter. </li><li>  Der Serverteil, der Anforderungen aus dem Skript verarbeitet hat.  Die Logik seiner Handlungen war sehr interessant.  Erstens gab es keine Datenmanipulation im Code und keine Abfragen in der Datenbank, stattdessen wurden die Datenbankfunktionen in PL \ SQL aufgerufen.  Alle Logik, Prüfungen usw. wurde in der Datenbankfunktion festgelegt.  50% des Skripts waren ein Wörterbuch, das den Namen der Anforderung, die damit verbundene Funktion und die Namen der Parameter der Funktion enthielt, die den in der Zeile get-request übergebenen Daten entsprechen sollten.  JSON-Daten wurden bei Bedarf als separater Parameter übergeben.  Ein Merkmal der Organisation des Serverteils war die Sicherungsverbindung während der Benutzerauthentifizierung.  Wenn das Login und das Passwort in der Datenbank gefunden wurden, die Sitzungs-ID generiert und die offene Verbindungsinstanz in das Wörterbuch gefaltet wurde (und nach einer Zeitüberschreitung von 10 Minuten beendet wurde, damit sie nicht beendet wurde - es gab eine spezielle Methode, um die Lebensdauer der Sitzung zu verlängern), war der Schlüssel die Sitzungs-ID, die sich direkt in der Datenbank befindet nicht gespeichert.  Wie genau ist die Sitzungs-ID mit Benutzerdaten verknüpft?  Gibt es schließlich eine Datenanforderung, bei der die Benutzer-ID nicht übertragen wird?  Es funktioniert, was bedeutet, dass hier etwas nicht stimmt. </li></ol><br>  Das Bewusstsein wurde nur sehr schwer entwickelt und hatte es nicht eilig, die längst verlorenen Geheimnisse der Meister der Vergangenheit zu enthüllen. <br><br>  Unglaublich (Gehe zu&gt; Definition, danke PhpStorm für das Verständnis von PL \ SQL), unverständlich für den Laien, der unter wahrem Wissen über die verlorene Zivilisation der Programmierer der alten Schule leidet.  Im Allgemeinen wurde beim Verbinden eine temporäre Tabelle in der Authentifizierungsdatenüberprüfungsfunktion generiert, in der die Benutzer-ID gespeichert wurde. <br><br>  Dies war nur der Anfang, eine indikative Liste schwerwiegender Sicherheitslücken: <br><br><ul><li>  DDoS unter Verwendung der Massenauthentifizierung (Verbindungen wurden reserviert und beruhten daher auf dem DBMS-Verbindungslimit, das es angesichts der Möglichkeit, die Sitzungslebensdauer zu verlängern, ermöglichte, den Speicher vollständig mit Verbindungen zu füllen, und die Arbeit neuer Benutzer im System wäre unmöglich); </li><li>  mangelnder Schutz gegen Brute Force (die Anzahl der fehlgeschlagenen Anmeldeversuche wird nicht erkannt, nicht gespeichert, nicht überprüft; </li><li>  mangelnde Kontrolle über Aktionen mit Entitäten (z. B. wurde die Liste der vom Benutzer angeforderten Dokumente unter Berücksichtigung der Organisation ausgestellt, an die der Benutzer angehängt ist. Wenn Sie die ID des Dokuments kennen, können Sie die Anforderung zum Aktualisieren / Löschen des Dokuments erfolgreich abschließen, und die Liste der Benutzer ist auch ohne gut Passwörter, die übrigens ohne Hashing im Klartext in der Datenbank gespeichert waren, konnten von niemandem empfangen werden. </li></ul><br>  Ein weiteres ernstes Problem ist kein formalisiertes Datenspeicherungsschema.  Wie bereits versprochen, spreche ich über das Speichern von "beliebigen Feldern" aus JSON.  Nein, sie wurden nicht als Zeile in der Tabelle gespeichert.  Sie wurden in Schlüssel-Wert-Paare unterteilt und in einer separaten Tabelle gespeichert.  Für Benutzer gab es beispielsweise zwei Tabellen - Benutzer und Benutzerdaten (Zeichenfolgenschlüssel, Zeichenfolgenwert) -, in denen die Daten tatsächlich gespeichert wurden.  Das Ergebnis dieses Ansatzes war eine Verlängerung der Zeit mit komplexen Stichproben aus der Datenbank. <br><br>  Tatsächlich reichte dies aus, um die Entscheidung zu treffen und umzusetzen, das System auf eine neue API zu übertragen, die verständlich, dokumentiert und unterstützt ist. <br><br><h4>  Moral </h4><br>  Vielleicht ist dieses System ein „Vermächtnis“, und der Programmierer der „alten Schule“, der es geschaffen hat, ist der Hüter des Vermächtnisses. <br><br>  Die Schlussfolgerungen lauten jedoch wie folgt: <br><br><ol><li>  Wenn Ihnen gesagt wird, dass es schwierig ist, werden Sie es nicht verstehen, bedeutet dies, dass es einen vollständigen Atas gibt </li><li>  Wenn sie von Autorität niedergeschlagen werden, ist etwas unrein </li><li>  Vertrauen, aber überprüfen - Sicherheit ist kein Zustand, Sicherheit ist ein Prozess, der darüber hinaus kontinuierlich ist. Daher ist es besser, sicherzustellen, dass die deklarierten Eigenschaften wahr sind, als später herauszufinden, dass alle Benutzer plötzlich zu „Ivanov Ivanov Ivanitch“ werden, aber es gibt keine Rückschläge. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de450384/">https://habr.com/ru/post/de450384/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de450368/index.html">Erhalten Sie absolute Kurse aus gepaarten Wechselkursen</a></li>
<li><a href="../de450372/index.html">Wie Amazon-Algorithmen bestimmen, wer es ist, zu verwerfen</a></li>
<li><a href="../de450374/index.html">RAM-Erweiterungskarte für Apple IIgs</a></li>
<li><a href="../de450376/index.html">Wie Yandex.Taxi nach Autos sucht, wenn sie es nicht sind</a></li>
<li><a href="../de450378/index.html">GitLab 11.10</a></li>
<li><a href="../de450386/index.html">Schnittstellen als abstrakte Datentypen in Go</a></li>
<li><a href="../de450394/index.html">Untersuchung eines unbekannten Archivs</a></li>
<li><a href="../de450396/index.html">So verbessern Sie Ihr schriftliches Englisch: praktische Tipps und nützliche Tools</a></li>
<li><a href="../de450398/index.html">Die furchtlosesten Gifte</a></li>
<li><a href="../de450410/index.html">Terraformer - Infrastruktur zum Codieren</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>