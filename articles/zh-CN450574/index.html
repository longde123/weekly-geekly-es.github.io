<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ© ğŸ–¼ï¸ ğŸ““ åˆ›å»ºä¸€ä¸ªå¤šäºº.ioç½‘ç»œæ¸¸æˆ ğŸ³ ğŸ‘©ğŸ½â€ğŸ¤ ğŸ•‘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Agar.ioäº2015å¹´å‘å¸ƒï¼Œæˆä¸º.ioè¿™ç±»æ–°æ¸¸æˆçš„å‰èº« ï¼Œæ­¤åå…¶å—æ¬¢è¿ç¨‹åº¦å·²å¤§å¤§æé«˜ã€‚ æˆ‘ç»å†äº†.ioæ¸¸æˆçš„æ™®åŠåº¦çš„å¢é•¿ï¼šåœ¨è¿‡å»ä¸‰å¹´ä¸­ï¼Œæˆ‘åˆ›ä½œå¹¶å‡ºå”®äº†ä¸¤ç§æ­¤ç±»æ¸¸æˆã€‚ ã€‚ 

 å¦‚æœæ‚¨ä»¥å‰ä»æœªå¬è¯´è¿‡æ­¤ç±»æ¸¸æˆï¼šè¿™äº›æ˜¯æ˜“äºå‚ä¸çš„å…è´¹å¤šäººç½‘ç»œæ¸¸æˆï¼ˆæ— éœ€å¸æˆ·ï¼‰ã€‚ é€šå¸¸ä»–ä»¬ä¼šåœ¨åŒä¸€ä¸ªç«æŠ€åœºä¸Šæ¨åŠ¨è®¸å¤šå¯¹ç«‹çš„çƒ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åˆ›å»ºä¸€ä¸ªå¤šäºº.ioç½‘ç»œæ¸¸æˆ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450574/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c7c/405/7a7/c7c4057a7ab7333ee3cb9aba5ecc8c37.jpg" alt="å›¾ç‰‡"></div><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">Agar.io</a>äº2015å¹´å‘å¸ƒï¼Œæˆä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer"><strong>.io</strong></a>è¿™ç±»æ–°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer"><strong>æ¸¸æˆçš„å‰èº«</strong></a> ï¼Œæ­¤åå…¶å—æ¬¢è¿ç¨‹åº¦å·²å¤§å¤§æé«˜ã€‚ æˆ‘ç»å†äº†.ioæ¸¸æˆçš„æ™®åŠåº¦çš„å¢é•¿ï¼šåœ¨è¿‡å»ä¸‰å¹´ä¸­ï¼Œæˆ‘<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ›ä½œå¹¶å‡ºå”®äº†ä¸¤ç§æ­¤ç±»æ¸¸æˆã€‚</a>  ã€‚ <br><br> å¦‚æœæ‚¨ä»¥å‰ä»æœªå¬è¯´è¿‡æ­¤ç±»æ¸¸æˆï¼šè¿™äº›æ˜¯æ˜“äºå‚ä¸çš„å…è´¹å¤šäººç½‘ç»œæ¸¸æˆï¼ˆæ— éœ€å¸æˆ·ï¼‰ã€‚ é€šå¸¸ä»–ä»¬ä¼šåœ¨åŒä¸€ä¸ªç«æŠ€åœºä¸Šæ¨åŠ¨è®¸å¤šå¯¹ç«‹çš„çƒå‘˜ã€‚  .ioæµæ´¾çš„å…¶ä»–è‘—åæ¸¸æˆæ˜¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">Slither.io</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">Diep.ioã€‚</a> <br><br> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•<strong>ä»å¤´å¼€å§‹åˆ›å»º.ioæ¸¸æˆ</strong> ã€‚ ä¸ºæ­¤ï¼Œä»…å¯¹Javascriptçš„çŸ¥è¯†å°±è¶³å¤Ÿäº†ï¼šæ‚¨éœ€è¦äº†è§£è¯¸å¦‚<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">ES6</a>è¯­æ³•ï¼Œ <code>this</code>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">Promisesä¹‹ç±»çš„çŸ¥è¯†</a> ã€‚ å³ä½¿æ‚¨ä¸å¤ªäº†è§£Javascriptï¼Œä¹Ÿä»ç„¶å¯ä»¥å¼„æ¸…æ¥šå¤§éƒ¨åˆ†æ–‡ç« ã€‚ <br><a name="habracut"></a><br><h2> æ¸¸æˆç¤ºä¾‹.io </h2><br> ä¸ºäº†å¸®åŠ©æ‚¨å­¦ä¹ ï¼Œæˆ‘ä»¬å°†å‚è€ƒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸€ä¸ªç¤ºä¾‹.ioæ¸¸æˆ</a> ã€‚ å°è¯•æ’­æ”¾ï¼ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/um/yq/qj/umyqqjon22wmshrz8o8wtyeaxl0.png"></div><br> æ¸¸æˆéå¸¸ç®€å•ï¼šæ‚¨å¯ä»¥åœ¨æœ‰å…¶ä»–ç©å®¶çš„ç«æŠ€åœºä¸Šæ§åˆ¶é£èˆ¹ã€‚ æ‚¨çš„é£èˆ¹ä¼šè‡ªåŠ¨å‘å°„ç‚®å¼¹ï¼Œå¹¶å°è¯•å‡»ä¸­å…¶ä»–ç©å®¶ï¼ŒåŒæ—¶é¿å¼€å…¶ç‚®å¼¹ã€‚ <br><br><h2>  1.æ¦‚è¿°/é¡¹ç›®ç»“æ„ </h2><br><blockquote> æˆ‘å»ºè®®<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer"><strong>ä¸‹è½½</strong></a>ç¤ºä¾‹æ¸¸æˆ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer"><strong>çš„æºä»£ç ï¼Œ</strong></a>ä»¥ä¾¿æ‚¨å…³æ³¨æˆ‘ã€‚ </blockquote><br> è¯¥ç¤ºä¾‹ä½¿ç”¨ä»¥ä¸‹å†…å®¹ï¼š <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">Express</a>æ˜¯æœ€æµè¡Œçš„Node.jsç½‘ç»œæ¡†æ¶ï¼Œç”¨äºç®¡ç†æ¸¸æˆçš„ç½‘ç»œæœåŠ¡å™¨ã€‚ </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">socket.io-</a>ä¸€ä¸ªç”¨äºåœ¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´äº¤æ¢æ•°æ®çš„websocketåº“ã€‚ </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Webpack</a>æ˜¯ä¸€ä¸ªæ¨¡å—ç®¡ç†å™¨ã€‚ æ‚¨å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨æ­¤å¤„</a>é˜…è¯»æœ‰å…³ä¸ºä»€ä¹ˆä½¿ç”¨Webpackçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¿¡æ¯</a> ã€‚ </li></ul><br> è¿™æ˜¯é¡¹ç›®ç›®å½•ç»“æ„çš„æ ·å­ï¼š <br><br><pre> <code class="hljs axapta"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span>/ assets/ ... src/ <span class="hljs-keyword"><span class="hljs-keyword">client</span></span>/ css/ ... html/ <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.html <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.js ... <span class="hljs-keyword"><span class="hljs-keyword">server</span></span>/ <span class="hljs-keyword"><span class="hljs-keyword">server</span></span>.js ... shared/ constants.js</code> </pre> <br><h3> å…¬å¼€/ </h3><br> æœåŠ¡å™¨å°†é™æ€ä¼ è¾“<code>public/</code>æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰å†…å®¹ã€‚  <code>public/assets/</code>åŒ…å«æˆ‘ä»¬é¡¹ç›®ä½¿ç”¨çš„å›¾åƒã€‚ <br><br><h3>  src / </h3><br> æ‰€æœ‰æºä»£ç éƒ½åœ¨<code>src/</code>æ–‡ä»¶å¤¹ä¸­ã€‚  <code>client/</code> <code>server/</code>çš„åç§°ä¸è¨€è‡ªæ˜ï¼Œè€Œ<code>shared/</code>åŒ…å«ä¸€ä¸ªç”±å®¢æˆ·å’ŒæœåŠ¡å™¨å¯¼å…¥çš„å¸¸é‡æ–‡ä»¶ã€‚ <br><br><h2>  2.ç»„ä»¶/é¡¹ç›®å‚æ•° </h2><br> å¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Webpack</a>æ¨¡å—ç®¡ç†å™¨æ¥æ„å»ºé¡¹ç›®ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„Webpacké…ç½®ï¼š <br><br><h5>  webpack.common.jsï¼š </h5><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = require(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MiniCssExtractPlugin = require(<span class="hljs-string"><span class="hljs-string">'mini-css-extract-plugin'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>.exports = { entry: { game: <span class="hljs-string"><span class="hljs-string">'./src/client/index.js'</span></span>, }, output: { filename: <span class="hljs-string"><span class="hljs-string">'[name].[contenthash].js'</span></span>, path: path.resolve(__dirname, <span class="hljs-string"><span class="hljs-string">'dist'</span></span>), }, <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>: { rules: [ { test: /\.js$/, exclude: /node_modules/, use: { loader: <span class="hljs-string"><span class="hljs-string">"babel-loader"</span></span>, options: { presets: [<span class="hljs-string"><span class="hljs-string">'@babel/preset-env'</span></span>], }, }, }, { test: /\.css$/, use: [ { loader: MiniCssExtractPlugin.loader, }, <span class="hljs-string"><span class="hljs-string">'css-loader'</span></span>, ], }, ], }, plugins: [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MiniCssExtractPlugin({ filename: <span class="hljs-string"><span class="hljs-string">'[name].[contenthash].css'</span></span>, }), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HtmlWebpackPlugin({ filename: <span class="hljs-string"><span class="hljs-string">'index.html'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>: <span class="hljs-string"><span class="hljs-string">'src/client/html/index.html'</span></span>, }), ], };</code> </pre> <br> æœ€é‡è¦çš„æ˜¯ä»¥ä¸‹å‡ è¡Œï¼š <br><br><ul><li>  <code>src/client/index.js</code>æ˜¯Javascriptå®¢æˆ·ç«¯ï¼ˆJSï¼‰çš„è¾“å…¥ç‚¹ã€‚  Webpackå°†ä»æ­¤å¤„å¼€å§‹ï¼Œç„¶åé€’å½’æœç´¢å…¶ä»–å¯¼å…¥çš„æ–‡ä»¶ã€‚ </li><li>  Webpackç¨‹åºé›†çš„è¾“å‡ºJSå°†ä½äº<code>dist/</code>ç›®å½•ä¸­ã€‚ æˆ‘å°†æ­¤æ–‡ä»¶ç§°ä¸º<strong>JSåŒ…</strong> ã€‚ </li><li> æˆ‘ä»¬ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">Babel</a> ï¼Œç‰¹åˆ«æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">@ babel / preset-env</a>é…ç½®æ¥ä¸ºè¾ƒæ—§çš„æµè§ˆå™¨è½¬æ¢æˆ‘ä»¬çš„JSä»£ç ã€‚ </li><li> æˆ‘ä»¬ä½¿ç”¨è¯¥æ’ä»¶æå–JSæ–‡ä»¶å¼•ç”¨çš„æ‰€æœ‰CSSï¼Œå¹¶å°†å®ƒä»¬åˆå¹¶åˆ°ä¸€ä¸ªä½ç½®ã€‚ æˆ‘å°†å…¶ç§°ä¸º<strong>CSSåŒ…</strong> ã€‚ </li></ul><br> æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°å¥‡æ€ªçš„è½¯ä»¶åŒ…æ–‡ä»¶å<code>'[name].[contenthash].ext'</code> ã€‚ å®ƒä»¬åŒ…å«Webpack <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">æ–‡ä»¶</a> <code>[name]</code>æ›¿æ¢ï¼š <code>[name]</code>å°†è¢«è¾“å…¥ç‚¹çš„åç§°æ›¿æ¢ï¼ˆåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ª<code>game</code> ï¼‰ï¼Œ <code>[contenthash]</code>å°†è¢«æ–‡ä»¶å†…å®¹çš„å“ˆå¸Œæ›¿æ¢ã€‚ æˆ‘ä»¬è¿™æ ·åšæ˜¯ä¸ºäº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">ä¼˜åŒ–ç”¨äºå“ˆå¸Œçš„é¡¹ç›®</a> -æ‚¨å¯ä»¥å‘Šè¯‰æµè§ˆå™¨æ— é™æœŸåœ°ç¼“å­˜æˆ‘ä»¬çš„JSåŒ…ï¼Œå› ä¸º<strong>å¦‚æœåŒ…æ›´æ”¹ï¼Œåˆ™å…¶æ–‡ä»¶å</strong>ä¹Ÿä¼šæ›´æ”¹ï¼ˆ <code>contenthash</code>æ›´æ”¹ï¼‰ã€‚ å®Œæˆçš„ç»“æœæ˜¯<code>game.dbeee76e91a97d0c7207.js</code>æ ¼å¼çš„æ–‡ä»¶åã€‚ <br><br>  <code>webpack.common.js</code>æ–‡ä»¶æ˜¯æˆ‘ä»¬åœ¨å¼€å‘å’Œå®Œæˆçš„é¡¹ç›®é…ç½®ä¸­å¯¼å…¥çš„åŸºæœ¬é…ç½®æ–‡ä»¶ã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªå¼€å‘é…ç½®ï¼š <br><br><h5>  webpack.dev.js </h5><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> merge = require(<span class="hljs-string"><span class="hljs-string">'webpack-merge'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> common = require(<span class="hljs-string"><span class="hljs-string">'./webpack.common.js'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>.exports = merge(common, { mode: <span class="hljs-string"><span class="hljs-string">'development'</span></span>, });</code> </pre> <br> ä¸ºäº†æé«˜æ•ˆç‡ï¼Œæˆ‘ä»¬åœ¨å¼€å‘<code>webpack.dev.js</code>ä½¿ç”¨äº†<code>webpack.dev.js</code> ï¼Œå¹¶åˆ‡æ¢åˆ°<code>webpack.prod.js</code>æ¥ä¼˜åŒ–åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²æ—¶çš„åŒ…è£…å°ºå¯¸ã€‚ <br><br><h3> æœ¬åœ°è®¾ç½® </h3><br> æˆ‘å»ºè®®å°†é¡¹ç›®å®‰è£…åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šï¼Œä»¥ä¾¿æ‚¨å¯ä»¥æŒ‰ç…§æœ¬æ–‡ä¸­åˆ—å‡ºçš„æ­¥éª¤è¿›è¡Œæ“ä½œã€‚ è®¾ç½®å¾ˆç®€å•ï¼šé¦–å…ˆï¼Œå¿…é¡»åœ¨ç³»ç»Ÿä¸Šå®‰è£…<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Node</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">NPM</a> ã€‚ æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦æ‰§è¡Œ <br><br><pre> <code class="cpp hljs">$ git clone https:<span class="hljs-comment"><span class="hljs-comment">//github.com/vzhou842/example-.io-game.git $ cd example-.io-game $ npm install</span></span></code> </pre> <br> æ‚¨å°±å¯ä»¥å‡ºå‘äº†ï¼ è¦å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œåªéœ€è¿è¡Œ <br><br><pre> <code class="cpp hljs">$ npm run develop</code> </pre> <br> å¹¶åœ¨ç½‘ç»œæµè§ˆå™¨ä¸­è®¿é—®<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">localhostï¼š3000</a> ã€‚ å½“ä»£ç æ›´æ”¹æ—¶ï¼Œå¼€å‘æœåŠ¡å™¨å°†è‡ªåŠ¨é‡å»ºJSå’ŒCSSåŒ…-åªéœ€åˆ·æ–°é¡µé¢å³å¯æŸ¥çœ‹æ‰€æœ‰æ›´æ”¹ï¼ <br><br><h2>  3.å®¢æˆ·è¿›å…¥ç‚¹ </h2><br> è®©æˆ‘ä»¬å¼€å§‹ç ”ç©¶æ¸¸æˆä»£ç æœ¬èº«ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦<code>index.html</code>é¡µé¢ï¼Œå½“æ‚¨è®¿é—®è¯¥ç«™ç‚¹æ—¶ï¼Œæµè§ˆå™¨å°†é¦–å…ˆåŠ è½½å®ƒã€‚ æˆ‘ä»¬çš„é¡µé¢å°†éå¸¸ç®€å•ï¼š <br><br><h5>  index.html </h5><br><pre>  &lt;ï¼DOCTYPE html&gt;
 &lt;html&gt;
 &lt;å¤´&gt;
   &lt;title&gt; .ioæ¸¸æˆç¤ºä¾‹&lt;/ title&gt;
   &lt;link type =â€œ text / cssâ€ rel =â€œ stylesheetâ€ href =â€œ / game.bundle.cssâ€&gt;
 &lt;/ head&gt;
 &lt;èº«ä½“&gt;
   &lt;canvas id =â€œ game-canvasâ€&gt; &lt;/ canvas&gt;
   &lt;scriptå¼‚æ­¥src =â€œ / game.bundle.jsâ€&gt; &lt;/ script&gt;
   &lt;div id =â€œæ’­æ”¾èœå•â€ class =â€œéšè—â€&gt;
     &lt;input type =â€œæ–‡æœ¬â€ id =â€œç”¨æˆ·å-è¾“å…¥â€å ä½ç¬¦=â€œç”¨æˆ·åâ€ /&gt;
     &lt;button id =â€œ play-buttonâ€&gt;æ’­æ”¾&lt;/ button&gt;
   &lt;/ div&gt;
 &lt;/ body&gt;
 &lt;/ html&gt; </pre><br>  <i>ä¸ºäº†æ¸…æ¥šèµ·è§ï¼Œæ­¤ä»£ç ç¤ºä¾‹ç•¥æœ‰ç®€åŒ–ï¼Œæˆ‘å°†åœ¨å¸–å­çš„è®¸å¤šå…¶ä»–ç¤ºä¾‹ä¸­è¿›è¡Œç›¸åŒçš„æ“ä½œã€‚</i>  <i>å®Œæ•´çš„ä»£ç å§‹ç»ˆå¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Github</a>ä¸ŠæŸ¥çœ‹ã€‚</i> <br><br> æˆ‘ä»¬æœ‰ï¼š <br><br><ul><li> æˆ‘ä»¬å°†ç”¨æ¥æ¸²æŸ“æ¸¸æˆçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">HTML5 Canvas</a> ï¼ˆ <code>&lt;canvas&gt;</code> ï¼‰ <code>&lt;canvas&gt;</code> ã€‚ </li><li>  <code>&lt;link&gt;</code>æ·»åŠ æˆ‘ä»¬çš„CSSåŒ…ã€‚ </li><li>  <code>&lt;script&gt;</code>æ·»åŠ æˆ‘ä»¬çš„JavascriptåŒ…ã€‚ </li><li> ä¸»èœå•å¸¦æœ‰ç”¨æˆ·å<code>&lt;input&gt;</code>å’Œâ€œ PLAYâ€ï¼ˆ <code>&lt;button&gt;</code> ï¼‰ <code>&lt;button&gt;</code> ã€‚ </li></ul><br> åŠ è½½ä¸»é¡µåï¼Œå°†ä»å…¥å£ç‚¹çš„JSæ–‡ä»¶<code>src/client/index.js</code>å¼€å§‹ï¼Œåœ¨æµè§ˆå™¨ä¸­å¼€å§‹æ‰§è¡ŒJavascriptä»£ç ã€‚ <br><br><h5>  index.js </h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { connect, play } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./networking'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { startRendering, stopRendering } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./render'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { startCapturingInput, stopCapturingInput } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./input'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { downloadAssets } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./assets'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { initState } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./state'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { setLeaderboardHidden } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./leaderboard'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./css/main.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> playMenu = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'play-menu'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> playButton = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'play-button'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> usernameInput = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'username-input'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.all([ connect(), downloadAssets(), ]).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { playMenu.classList.remove(<span class="hljs-string"><span class="hljs-string">'hidden'</span></span>); usernameInput.focus(); playButton.onclick = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Play! play(usernameInput.value); playMenu.classList.add('hidden'); initState(); startCapturingInput(); startRendering(); setLeaderboardHidden(false); }; });</span></span></code> </pre> <br> è¿™å¯èƒ½çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†å®é™…ä¸Šè¿™é‡Œæ²¡æœ‰å‘ç”Ÿå¾ˆå¤šåŠ¨ä½œï¼š <br><br><ol><li> å¯¼å…¥å…¶ä»–å‡ ä¸ªJSæ–‡ä»¶ã€‚ </li><li> å¯¼å…¥CSSï¼ˆå› æ­¤WebpackçŸ¥é“å°†å®ƒä»¬åŒ…å«åœ¨æˆ‘ä»¬çš„CSSåŒ…ä¸­ï¼‰ã€‚ </li><li> è¿è¡Œ<code>connect()</code>å»ºç«‹ä¸æœåŠ¡å™¨çš„è¿æ¥ï¼Œå¹¶è¿è¡Œ<code>downloadAssets()</code>ä¸‹è½½æ¸²æŸ“æ¸¸æˆæ‰€éœ€çš„å›¾åƒã€‚ </li><li>  <em>å®Œæˆç¬¬3æ­¥å</em> ï¼Œå°†æ˜¾ç¤ºä¸»èœå•ï¼ˆ <code>playMenu</code> ï¼‰ã€‚ </li><li> é…ç½®ç”¨äºæŒ‰PLAYæŒ‰é’®çš„å¤„ç†ç¨‹åºã€‚ å½“æŒ‰ä¸‹æŒ‰é’®æ—¶ï¼Œä»£ç å°†åˆå§‹åŒ–æ¸¸æˆå¹¶å‘Šè¯‰æœåŠ¡å™¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½ç©ã€‚ </li></ol><br> å®¢æˆ·ç«¯-æœåŠ¡å™¨é€»è¾‘çš„ä¸»è¦â€œå†…å®¹â€æ˜¯ç”±<code>index.js</code>æ–‡ä»¶å¯¼å…¥çš„é‚£äº›æ–‡ä»¶ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬å°†æŒ‰é¡ºåºè€ƒè™‘å®ƒä»¬ã€‚ <br><br><h2>  4.äº¤æ¢å®¢æˆ·æ•°æ® </h2><br> åœ¨è¿™ä¸ªæ¸¸æˆä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¼—æ‰€å‘¨çŸ¥çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">socket.io</a>åº“ä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚  Socket.ioå…·æœ‰å¯¹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">WebSocketçš„</a>å†…ç½®æ”¯æŒï¼Œéå¸¸é€‚åˆåŒå‘é€šä¿¡ï¼šæˆ‘ä»¬å¯ä»¥å°†æ¶ˆæ¯å‘é€åˆ°æœåŠ¡å™¨<em>ï¼Œè€Œ</em>æœåŠ¡å™¨å¯ä»¥é€šè¿‡åŒä¸€è¿æ¥å‘æˆ‘ä»¬å‘é€æ¶ˆæ¯ã€‚ <br><br> æˆ‘ä»¬å°†æ‹¥æœ‰ä¸€ä¸ª<code>src/client/networking.js</code>æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°†å¤„ç†ä¸æœåŠ¡å™¨çš„<strong>æ‰€æœ‰</strong>é€šä¿¡ï¼š <br><br><h5> ç½‘ç»œ.js </h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'socket.io-client'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { processGameUpdate } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./state'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Constants = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../shared/constants'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> socket = io(<span class="hljs-string"><span class="hljs-string">`ws://</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">window</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.location.host}</span></span></span><span class="hljs-string">`</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> connectedPromise = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve</span></span></span><span class="hljs-function"> =&gt;</span></span> { socket.on(<span class="hljs-string"><span class="hljs-string">'connect'</span></span>, () =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Connected to server!'</span></span>); resolve(); }); }); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> connect = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">onGameOver</span></span></span><span class="hljs-function"> =&gt;</span></span> ( connectedPromise.then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Register callbacks socket.on(Constants.MSG_TYPES.GAME_UPDATE, processGameUpdate); socket.on(Constants.MSG_TYPES.GAME_OVER, onGameOver); }) ); export const play = username =&gt; { socket.emit(Constants.MSG_TYPES.JOIN_GAME, username); }; export const updateDirection = dir =&gt; { socket.emit(Constants.MSG_TYPES.INPUT, dir); };</span></span></code> </pre> <br>  <i>ä¸ºäº†æ¸…æ¥šèµ·è§ï¼Œæ­¤ä»£ç ä¹Ÿç•¥æœ‰å‡å°‘ã€‚</i> <br><br> æ­¤æ–‡ä»¶ä¸­æœ‰ä¸‰ä¸ªä¸»è¦æ“ä½œï¼š <br><br><ul><li> æˆ‘ä»¬æ­£åœ¨å°è¯•è¿æ¥åˆ°æœåŠ¡å™¨ã€‚ ä»…åœ¨æˆ‘ä»¬å»ºç«‹è¿æ¥åæ‰å…è®¸<code>connectedPromise</code> ã€‚ </li><li> å¦‚æœæˆåŠŸå»ºç«‹è¿æ¥ï¼Œæˆ‘ä»¬å°†æ³¨å†Œå›è°ƒå‡½æ•°ï¼ˆ <code>processGameUpdate()</code>å’Œ<code>onGameOver()</code> ï¼‰ï¼Œä»¥æ¥æ”¶å¯ä»¥ä»æœåŠ¡å™¨æ¥æ”¶çš„æ¶ˆæ¯ã€‚ </li><li> æˆ‘ä»¬å¯¼å‡º<code>play()</code>å’Œ<code>updateDirection()</code>ä»¥ä¾¿å…¶ä»–æ–‡ä»¶å¯ä»¥ä½¿ç”¨å®ƒä»¬ã€‚ </li></ul><br><h2>  5.å®¢æˆ·ç«¯æ¸²æŸ“ </h2><br> ç°åœ¨è¯¥åœ¨å±å¹•ä¸Šæ˜¾ç¤ºå›¾ç‰‡äº†ï¼ <br><br>  ...ä½†æ˜¯åœ¨æˆ‘ä»¬æ‰§è¡Œæ­¤æ“ä½œä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸‹è½½ä¸ºæ­¤æ‰€éœ€çš„æ‰€æœ‰å›¾åƒï¼ˆèµ„æºï¼‰ã€‚ è®©æˆ‘ä»¬å†™ä¸€ä¸ªèµ„æºç®¡ç†å™¨ï¼š <br><br><h5>  asset.js </h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ASSET_NAMES = [<span class="hljs-string"><span class="hljs-string">'ship.svg'</span></span>, <span class="hljs-string"><span class="hljs-string">'bullet.svg'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> assets = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> downloadPromise = <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.all(ASSET_NAMES.map(downloadAsset)); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">downloadAsset</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">assetName</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> asset = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Image(); asset.onload = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`Downloaded </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${assetName}</span></span></span><span class="hljs-string">`</span></span>); assets[assetName] = asset; resolve(); }; asset.src = <span class="hljs-string"><span class="hljs-string">`/assets/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${assetName}</span></span></span><span class="hljs-string">`</span></span>; }); } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> downloadAssets = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> downloadPromise; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getAsset = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">assetName</span></span></span><span class="hljs-function"> =&gt;</span></span> assets[assetName];</code> </pre> <br> èµ„æºç®¡ç†ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“å®ç°ï¼ è¦ç‚¹æ˜¯å­˜å‚¨<code>assets</code>å¯¹è±¡ï¼Œå®ƒå°†æŠŠæ–‡ä»¶åé”®ç»‘å®šåˆ°<code>Image</code>å¯¹è±¡çš„å€¼ã€‚ åŠ è½½èµ„æºåï¼Œæˆ‘ä»¬å°†å…¶ä¿å­˜åœ¨<code>assets</code>å¯¹è±¡ä¸­ï¼Œä»¥ä¾¿å°†æ¥å¿«é€Ÿæ£€ç´¢ã€‚ å½“å…è®¸ä¸ºæ¯ä¸ªå•ç‹¬çš„èµ„æºè¿›è¡Œä¸‹è½½ï¼ˆå³ï¼Œå°†ä¸‹è½½<strong>æ‰€æœ‰</strong>èµ„æºï¼‰æ—¶ï¼Œæˆ‘ä»¬å¯ç”¨<code>downloadPromise</code> ã€‚ <br><br> ä¸‹è½½èµ„æºåï¼Œå¯ä»¥å¼€å§‹æ¸²æŸ“ã€‚ å¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä»¬ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">HTML5 Canvas</a> ï¼ˆ <code>&lt;canvas&gt;</code> ï¼‰åœ¨ç½‘é¡µä¸Šç»˜åˆ¶ã€‚ æˆ‘ä»¬çš„æ¸¸æˆéå¸¸ç®€å•ï¼Œå› æ­¤ä»…ç»˜åˆ¶ä»¥ä¸‹å†…å®¹å°±è¶³å¤Ÿäº†ï¼š <br><br><ol><li> èƒŒæ™¯çŸ¥è¯† </li><li> ç©å®¶é£èˆ¹ </li><li> æ¸¸æˆä¸­çš„å…¶ä»–ç©å®¶ </li><li> ç‚®å¼¹ </li></ol><br> ä»¥ä¸‹æ˜¯<code>src/client/render.js</code>çš„é‡è¦ç‰‡æ®µï¼Œå®ƒä»¬ç²¾ç¡®å‘ˆç°äº†ä¸Šé¢åˆ—å‡ºçš„å››ä¸ªç‚¹ï¼š <br><br><h5>  render.js </h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { getAsset } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./assets'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { getCurrentState } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./state'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Constants = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../shared/constants'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { PLAYER_RADIUS, PLAYER_MAX_HP, BULLET_RADIUS, MAP_SIZE } = Constants; <span class="hljs-comment"><span class="hljs-comment">// Get the canvas graphics context const canvas = document.getElementById('game-canvas'); const context = canvas.getContext('2d'); // Make the canvas fullscreen canvas.width = window.innerWidth; canvas.height = window.innerHeight; function render() { const { me, others, bullets } = getCurrentState(); if (!me) { return; } // Draw background renderBackground(me.x, me.y); // Draw all bullets bullets.forEach(renderBullet.bind(null, me)); // Draw all players renderPlayer(me, me); others.forEach(renderPlayer.bind(null, me)); } // ... Helper functions here excluded let renderInterval = null; export function startRendering() { renderInterval = setInterval(render, 1000 / 60); } export function stopRendering() { clearInterval(renderInterval); }</span></span></code> </pre> <br>  <i>ä¸ºäº†æ¸…æ¥šèµ·è§ï¼Œè¯¥ä»£ç ä¹Ÿè¢«ç¼©çŸ­ã€‚</i> <br><br>  <code>render()</code>æ˜¯æ­¤æ–‡ä»¶çš„ä¸»è¦åŠŸèƒ½ã€‚  <code>startRendering()</code>å’Œ<code>stopRendering()</code>ä»¥60 FPSæ§åˆ¶æ¸²æŸ“å‘¨æœŸçš„æ¿€æ´»ã€‚ <br><br> å„ä¸ªè¾…åŠ©æ¸²æŸ“å‡½æ•°ï¼ˆä¾‹å¦‚<code>renderBullet()</code> ï¼‰çš„å…·ä½“å®ç°å¹¶ä¸é‚£ä¹ˆé‡è¦ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š <br><br><h5>  render.js </h5><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">renderBullet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">me, bullet</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { x, y } = bullet; context.drawImage( getAsset(<span class="hljs-string"><span class="hljs-string">'bullet.svg'</span></span>), canvas.width / <span class="hljs-number"><span class="hljs-number">2</span></span> + x - me.x - BULLET_RADIUS, canvas.height / <span class="hljs-number"><span class="hljs-number">2</span></span> + y - me.y - BULLET_RADIUS, BULLET_RADIUS * <span class="hljs-number"><span class="hljs-number">2</span></span>, BULLET_RADIUS * <span class="hljs-number"><span class="hljs-number">2</span></span>, ); }</code> </pre> <br> æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨å…ˆå‰åœ¨<code>asset.js</code>çœ‹åˆ°çš„<code>getAsset()</code>æ–¹æ³•ï¼ <br><br><blockquote> å¦‚æœæ‚¨æœ‰å…´è¶£æ¢ç´¢å…¶ä»–è¾…åŠ©æ¸²æŸ“åŠŸèƒ½ï¼Œè¯·é˜…è¯»<a href="">src / client / render.js</a>çš„å…¶ä½™éƒ¨åˆ†ã€‚ </blockquote><br><h2>  6.å®¢æˆ·è¾“å…¥ </h2><br> ç°åœ¨è¯¥ä½¿æ¸¸æˆå˜å¾—<em>å¯ç©äº†</em> ï¼ æ§åˆ¶æ–¹æ¡ˆå°†éå¸¸ç®€å•ï¼šæ‚¨å¯ä»¥ä½¿ç”¨é¼ æ ‡ï¼ˆåœ¨è®¡ç®—æœºä¸Šï¼‰æˆ–è§¦æ‘¸å±å¹•ï¼ˆåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šï¼‰æ¥æ›´æ”¹ç§»åŠ¨æ–¹å‘ã€‚ ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†ä¸ºMouseå’ŒTouchäº‹ä»¶æ³¨å†Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äº‹ä»¶ç›‘å¬å™¨</a> ã€‚ <br>  <code>src/client/input.js</code>å°†å®Œæˆæ‰€æœ‰è¿™äº›æ“ä½œï¼š <br><br><h5>  input.js </h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { updateDirection } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./networking'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMouseInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ handleInput(e.clientX, e.clientY); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTouchInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> touch = e.touches[<span class="hljs-number"><span class="hljs-number">0</span></span>]; handleInput(touch.clientX, touch.clientY); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x, y</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dir = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.atan2(x - <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.innerWidth / <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.innerHeight / <span class="hljs-number"><span class="hljs-number">2</span></span> - y); updateDirection(dir); } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startCapturingInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'mousemove'</span></span>, onMouseInput); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'touchmove'</span></span>, onTouchInput); } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopCapturingInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.removeEventListener(<span class="hljs-string"><span class="hljs-string">'mousemove'</span></span>, onMouseInput); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.removeEventListener(<span class="hljs-string"><span class="hljs-string">'touchmove'</span></span>, onTouchInput); }</code> </pre> <br>  <code>onMouseInput()</code>å’Œ<code>onTouchInput()</code>æ˜¯äº‹ä»¶ä¾¦å¬å™¨ï¼Œå®ƒä»¬åœ¨å‘ç”Ÿè¾“å…¥äº‹ä»¶ï¼ˆä¾‹å¦‚ï¼Œç§»åŠ¨é¼ æ ‡ï¼‰æ—¶è°ƒç”¨<code>updateDirection()</code> ï¼ˆæ¥è‡ª<code>networking.js</code> ï¼‰ã€‚  <code>updateDirection()</code>ä¸æœåŠ¡å™¨è¿›è¡Œæ¶ˆæ¯ä¼ é€’ï¼Œè¯¥æœåŠ¡å™¨å¤„ç†è¾“å…¥äº‹ä»¶å¹¶ç›¸åº”åœ°æ›´æ–°æ¸¸æˆçŠ¶æ€ã€‚ <br><br><h2>  7.å®¢æˆ·æ¡ä»¶ </h2><br><blockquote> è¿™éƒ¨åˆ†æ˜¯æ–‡ç« ç¬¬ä¸€éƒ¨åˆ†ä¸­æœ€å›°éš¾çš„éƒ¨åˆ†ã€‚ å¦‚æœæ‚¨ä¸è¯»ä¸€è¯»å°±ä¸è¦ç°å¿ƒï¼ æ‚¨ç”šè‡³å¯ä»¥è·³è¿‡å®ƒï¼Œç¨åå†è¿”å›ã€‚ </blockquote><br> å®Œæˆå®¢æˆ·ç«¯-æœåŠ¡å™¨ä»£ç æ‰€éœ€çš„æœ€åä¸€ä¸ªéš¾é¢˜æ˜¯<strong>state</strong> ã€‚ è¿˜è®°å¾—â€œå®¢æˆ·ç«¯æ¸²æŸ“â€éƒ¨åˆ†çš„ä»£ç ç‰‡æ®µå—ï¼Ÿ <br><br><h5>  render.js </h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { getCurrentState } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./state'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { me, others, bullets } = getCurrentState(); <span class="hljs-comment"><span class="hljs-comment">// Do the rendering // ... }</span></span></code> </pre> <br> æ ¹æ®ä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ›´æ–°ï¼Œ <code>getCurrentState()</code>åº”è¯¥èƒ½å¤Ÿ<strong>åœ¨ä»»ä½•ç»™å®šæ—¶é—´</strong>ä¸ºæˆ‘ä»¬æä¾›å®¢æˆ·ç«¯<strong>ä¸­</strong>æ¸¸æˆçš„å½“å‰çŠ¶æ€ã€‚ è¿™æ˜¯æœåŠ¡å™¨å¯ä»¥å‘é€çš„æ¸¸æˆæ›´æ–°ç¤ºä¾‹ï¼š <br><br><pre> <code class="cpp hljs">{ <span class="hljs-string"><span class="hljs-string">"t"</span></span>: <span class="hljs-number"><span class="hljs-number">1555960373725</span></span>, <span class="hljs-string"><span class="hljs-string">"me"</span></span>: { <span class="hljs-string"><span class="hljs-string">"x"</span></span>: <span class="hljs-number"><span class="hljs-number">2213.8050880413657</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span>: <span class="hljs-number"><span class="hljs-number">1469.370893425012</span></span>, <span class="hljs-string"><span class="hljs-string">"direction"</span></span>: <span class="hljs-number"><span class="hljs-number">1.3082443894581433</span></span>, <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"AhzgAtklgo2FJvwWAADO"</span></span>, <span class="hljs-string"><span class="hljs-string">"hp"</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> }, <span class="hljs-string"><span class="hljs-string">"others"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"bullets"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"RUJfJ8Y18n"</span></span>, <span class="hljs-string"><span class="hljs-string">"x"</span></span>: <span class="hljs-number"><span class="hljs-number">2354.029197099604</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span>: <span class="hljs-number"><span class="hljs-number">1431.6848318262666</span></span> }, { <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"ctg5rht5s"</span></span>, <span class="hljs-string"><span class="hljs-string">"x"</span></span>: <span class="hljs-number"><span class="hljs-number">2260.546457727445</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span>: <span class="hljs-number"><span class="hljs-number">1456.8088728920968</span></span> } ], <span class="hljs-string"><span class="hljs-string">"leaderboard"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"username"</span></span>: <span class="hljs-string"><span class="hljs-string">"Player"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span> } ] }</code> </pre> <br> æ¯ä¸ªæ¸¸æˆæ›´æ–°å‡åŒ…å«äº”ä¸ªç›¸åŒçš„å­—æ®µï¼š <br><br><ul><li>  <strong>t</strong> ï¼šåˆ›å»ºæ­¤æ›´æ–°çš„æ—¶é—´çš„æœåŠ¡å™¨æ—¶é—´æˆ³ã€‚ </li><li>  <strong>æˆ‘</strong> ï¼šæœ‰å…³æ’­æ”¾å™¨æ”¶åˆ°æ­¤æ›´æ–°çš„ä¿¡æ¯ã€‚ </li><li>  <strong>å…¶ä»–</strong> ï¼šæœ‰å…³å‚ä¸åŒä¸€æ¸¸æˆçš„å…¶ä»–ç©å®¶çš„ä¸€ç³»åˆ—ä¿¡æ¯ã€‚ </li><li>  <strong>bullets</strong> ï¼šæœ‰å…³æ¸¸æˆä¸­çš„ç‚®å¼¹çš„ä¸€ç³»åˆ—ä¿¡æ¯ã€‚ </li><li>  <strong>é¡µé¦–æ¨ªå¹…</strong> ï¼šå½“å‰çš„é¡µé¦–æ¨ªå¹…æ•°æ®ã€‚ åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¸è€ƒè™‘å®ƒä»¬ã€‚ </li></ul><br><h3>  7.1å®¢æˆ·çš„å¤©çœŸçŠ¶æ€ </h3><br>  <code>getCurrentState()</code>å®ç°åªèƒ½ç›´æ¥ä»æ”¶åˆ°çš„æœ€æ–°æ¸¸æˆæ›´æ–°ä¸­è¿”å›æ•°æ®ã€‚ <br><br><h5>  naive-state.js </h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> lastGameUpdate = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Handle a newly received game update. export function processGameUpdate(update) { lastGameUpdate = update; } export function getCurrentState() { return lastGameUpdate; }</span></span></code> </pre> <br> ç¾ä¸½è€Œæ¸…æ™°ï¼ ä½†æ˜¯ï¼Œå¦‚æœä¸€åˆ‡éƒ½è¿™ä¹ˆç®€å•ã€‚ æ­¤å®ç°å­˜åœ¨é—®é¢˜çš„åŸå› ä¹‹ä¸€ï¼š <strong>å®ƒå°†æ¸²æŸ“çš„å¸§é€Ÿç‡é™åˆ¶ä¸ºæœåŠ¡å™¨æ—¶é’Ÿçš„é¢‘ç‡</strong> ã€‚ <br><br><blockquote>  <strong>å¸§ç‡</strong> ï¼šæ¯ç§’çš„å¸§æ•°ï¼ˆå³ï¼Œ <code>render()</code>è°ƒç”¨ï¼‰æˆ–FPSã€‚ æ¸¸æˆé€šå¸¸é€šå¸¸è‡³å°‘è¾¾åˆ°60 FPSã€‚ </blockquote><br><blockquote>  <strong>æŠ¥ä»·é€Ÿåº¦</strong> ï¼šæœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€æ¸¸æˆæ›´æ–°çš„é¢‘ç‡ã€‚  <strong>é€šå¸¸å®ƒä½äºå¸§é€Ÿç‡</strong> ã€‚ åœ¨æˆ‘ä»¬çš„æ¸¸æˆä¸­ï¼ŒæœåŠ¡å™¨ä»¥æ¯ç§’30ä¸ªå‘¨æœŸçš„é¢‘ç‡è¿è¡Œã€‚ </blockquote><br> å¦‚æœæˆ‘ä»¬ä»…æ¸²æŸ“æ¸¸æˆçš„æœ€æ–°æ›´æ–°ï¼Œé‚£ä¹ˆFPSå®é™…ä¸Šå°†æ°¸è¿œä¸ä¼šè¶…è¿‡30ï¼Œå› ä¸º<em>æˆ‘ä»¬æ¯ç§’ä»æœåŠ¡å™¨æ¥æ”¶çš„æ›´æ–°æ°¸è¿œä¸ä¼šè¶…è¿‡30</em> ã€‚ å³ä½¿æˆ‘ä»¬æ¯ç§’è°ƒç”¨<code>render()</code> 60æ¬¡ï¼Œè¿™äº›è°ƒç”¨ä¸­çš„ä¸€åŠä¹Ÿåªä¼šé‡ç»˜åŒä¸€ä»¶äº‹ï¼Œå®é™…ä¸Šä»€ä¹ˆä¹Ÿæ²¡åšã€‚ å¤©çœŸçš„å®ç°çš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯å®ƒ<strong>å®¹æ˜“å‡ºç°å»¶è¿Ÿ</strong> ã€‚ ä»¥ç†æƒ³çš„Interneté€Ÿåº¦ï¼Œå®¢æˆ·ç«¯å°†æ¯éš”33æ¯«ç§’ï¼ˆæ¯ç§’30ä¸ªï¼‰å‡†ç¡®åœ°æ”¶åˆ°ä¸€æ¬¡æ¸¸æˆæ›´æ–°ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc3/815/7c9/bc38157c91d436b5fedf948b60c8a213.svg"></div><br> ä¸å¹¸çš„æ˜¯ï¼Œæ²¡æœ‰ä»€ä¹ˆæ˜¯å®Œç¾çš„ã€‚ æ›´ä¸ºç°å®çš„æƒ…å†µæ˜¯ï¼š <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/836/45f/75e/83645f75e556bc5c1c38111a69510734.svg"></div><br> å½“æ¶‰åŠåˆ°å»¶è¿Ÿæ—¶ï¼Œå¹¼ç¨šçš„å®ç°å®é™…ä¸Šæ˜¯æœ€åçš„æƒ…å†µã€‚ å¦‚æœæ”¶åˆ°æ¸¸æˆæ›´æ–°çš„å»¶è¿Ÿä¸º50æ¯«ç§’ï¼Œåˆ™<strong>å®¢æˆ·ç«¯ä¼š</strong>é¢å¤–é™ä½50æ¯«ç§’çš„é€Ÿåº¦ï¼Œå› ä¸ºå®ƒä»ä¼šå‘ˆç°å‰ä¸€æ¬¡æ›´æ–°çš„æ¸¸æˆçŠ¶æ€ã€‚ æ‚¨å¯ä»¥æƒ³è±¡è¿™å¯¹ç©å®¶æ¥è¯´æ˜¯å¤šä¹ˆçš„ä¸æ–¹ä¾¿ï¼šç”±äºä»»æ„åˆ¶åŠ¨ï¼Œæ¸¸æˆä¼¼ä¹ä¼šæŠ½æä¸”ä¸ç¨³å®šã€‚ <br><br><h3>  7.2æ”¹å–„å®¢æˆ·çŠ¶æ€ </h3><br> æˆ‘ä»¬å°†å¯¹å¤©çœŸçš„å®ç°è¿›è¡Œä¸€äº›æ”¹è¿›ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨100 msçš„<strong>æ¸²æŸ“å»¶è¿Ÿ</strong> ã€‚ è¿™æ„å‘³ç€å®¢æˆ·ç«¯çš„â€œå½“å‰â€çŠ¶æ€å°†å§‹ç»ˆè½åäºæœåŠ¡å™¨ä¸Šçš„æ¸¸æˆçŠ¶æ€100æ¯«ç§’ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæœåŠ¡å™¨ä¸Šçš„æ—¶é—´ä¸º<strong>150</strong> ï¼Œåˆ™æœåŠ¡å™¨åœ¨æ—¶é—´<strong>50</strong>å¤„çš„çŠ¶æ€å°†åœ¨å®¢æˆ·ç«¯ä¸Šå‘ˆç°ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/788/1b5/c78/7881b5c789321648ff1ff70d15b881d4.svg"></div><br> è¿™ä¸ºæˆ‘ä»¬æä¾›äº†100æ¯«ç§’çš„ç¼“å†²åŒºï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨æ— æ³•é¢„æµ‹çš„æ—¶é—´å†…åº¦è¿‡ä»¥æ¥æ”¶æ¸¸æˆæ›´æ–°ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c1e/494/615/c1e4946159c599c7a2a9196968755e4b.svg"></div><br> ä¸ºæ­¤ä»˜å‡ºçš„ä»£ä»·<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">æ˜¯</a> 100 msçš„æ’å®š<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">è¾“å…¥å»¶è¿Ÿï¼ˆè¾“å…¥æ»åï¼‰</a> ã€‚ è¿™æ˜¯å¹³ç¨³æ¸¸æˆçš„ä¸€ä¸ªå°ç‰ºç‰²-å¤§å¤šæ•°ç©å®¶ï¼ˆå°¤å…¶æ˜¯ä¼‘é—²ç©å®¶ï¼‰ç”šè‡³éƒ½ä¸ä¼šæ³¨æ„åˆ°è¿™ç§å»¶è¿Ÿã€‚ äººä»¬é€‚åº”100æ¯«ç§’çš„æ’å®šå»¶è¿Ÿæ¯”ç©ä¸å¯é¢„æµ‹çš„å»¶è¿Ÿè¦å®¹æ˜“å¾—å¤šã€‚ <br><br><blockquote> æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦ä¸€ç§ç§°ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">â€œå®¢æˆ·ç«¯é¢„æµ‹â€çš„</a>æŠ€æœ¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">ï¼Œ</a>è¯¥æŠ€æœ¯å¯ä»¥å¾ˆå¥½åœ°å‡å°‘æ„ŸçŸ¥åˆ°çš„å»¶è¿Ÿï¼Œä½†æ˜¯æœ¬æ–‡ä¸­å°†ä¸äºˆè€ƒè™‘ã€‚ </blockquote><br> æˆ‘ä»¬ä½¿ç”¨çš„å¦ä¸€ä¸ªæ”¹è¿›æ˜¯<strong>çº¿æ€§æ’å€¼</strong> ã€‚ ç”±äºæ¸²æŸ“å»¶è¿Ÿï¼Œæˆ‘ä»¬é€šå¸¸ä¼šè‡³å°‘æ›´æ–°ä¸€æ¬¡å®¢æˆ·ç«¯ä¸­çš„å½“å‰æ—¶é—´ã€‚ è°ƒç”¨<code>getCurrentState()</code> ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®¢æˆ·ç«¯ä¸­å½“å‰æ—¶é—´å‰åç«‹å³åœ¨æ¸¸æˆæ›´æ–°ä¹‹é—´æ‰§è¡Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">çº¿æ€§æ’å€¼</a> ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ca/1c8/91c/2ca1c891ce7db0341dc78c2f88e16ce4.svg"></div><br> è¿™å°±è§£å†³äº†å¸§é€Ÿç‡é—®é¢˜ï¼šç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥æ‰€éœ€çš„ä»»ä½•é¢‘ç‡æ¸²æŸ“å”¯ä¸€çš„å¸§ï¼ <br><br><h3>  7.3å®æ–½å¢å¼ºçš„å®¢æˆ·ç«¯çŠ¶æ€ </h3><br>  <code>src/client/state.js</code>çš„ç¤ºä¾‹å®ç°<code>src/client/state.js</code>ä½¿ç”¨äº†æ¸²æŸ“å»¶è¿Ÿå’Œçº¿æ€§æ’å€¼ï¼Œä½†è¿™å¹¶ä¸é•¿ä¹…ã€‚ è®©æˆ‘ä»¬å°†ä»£ç åˆ†ä¸ºä¸¤éƒ¨åˆ†ã€‚ è¿™æ˜¯ç¬¬ä¸€ä¸ªï¼š <br><br><h5>  state.jsç¬¬1éƒ¨åˆ† </h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> RENDER_DELAY = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> gameUpdates = []; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> gameStart = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> firstServerTimestamp = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ gameStart = <span class="hljs-number"><span class="hljs-number">0</span></span>; firstServerTimestamp = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processGameUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">update</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!firstServerTimestamp) { firstServerTimestamp = update.t; gameStart = <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.now(); } gameUpdates.push(update); <span class="hljs-comment"><span class="hljs-comment">// Keep only one game update before the current server time const base = getBaseUpdate(); if (base &gt; 0) { gameUpdates.splice(0, base); } } function currentServerTime() { return firstServerTimestamp + (Date.now() - gameStart) - RENDER_DELAY; } // Returns the index of the base update, the first game update before // current server time, or -1 if N/A. function getBaseUpdate() { const serverTime = currentServerTime(); for (let i = gameUpdates.length - 1; i &gt;= 0; i--) { if (gameUpdates[i].t &lt;= serverTime) { return i; } } return -1; }</span></span></code> </pre> <br> ç¬¬ä¸€æ­¥æ˜¯å¼„æ¸…æ¥š<code>currentServerTime()</code>ä½œç”¨ã€‚ æ­£å¦‚æˆ‘ä»¬å‰é¢æ‰€çœ‹åˆ°çš„ï¼Œæ¯ä¸ªæ¸¸æˆæ›´æ–°ä¸­éƒ½åŒ…å«ä¸€ä¸ªæœåŠ¡å™¨æ—¶é—´æˆ³ã€‚ æˆ‘ä»¬æƒ³ä½¿ç”¨æ¸²æŸ“å»¶è¿Ÿåœ¨æœåŠ¡å™¨å100 mså¤„æ¸²æŸ“å›¾åƒï¼Œä½†æ˜¯<strong>æˆ‘ä»¬æ°¸è¿œä¸ä¼šçŸ¥é“æœåŠ¡å™¨ä¸Šçš„å½“å‰æ—¶é—´</strong> ï¼Œå› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“æœ‰å¤šé•¿æ—¶é—´æ‰èƒ½è·å¾—æ›´æ–°ã€‚ äº’è”ç½‘æ˜¯æ— æ³•é¢„æµ‹çš„ï¼Œå…¶é€Ÿåº¦å¯èƒ½ç›¸å·®å¾ˆå¤§ï¼ <br><br> ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåˆç†çš„è¿‘ä¼¼å€¼ï¼šæˆ‘ä»¬å°†<strong>å‡å®šç¬¬ä¸€ä¸ªæ›´æ–°æ˜¯å³æ—¶åˆ°è¾¾çš„</strong> ã€‚ å¦‚æœè¿™æ˜¯çœŸçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†çŸ¥é“ç‰¹å®šæ—¶é—´çš„æœåŠ¡å™¨æ—¶é—´ï¼ æˆ‘ä»¬å°†æœåŠ¡å™¨æ—¶é—´æˆ³ä¿å­˜åœ¨<code>firstServerTimestamp</code>åŒæ—¶å°†<strong>æœ¬åœ°</strong> ï¼ˆå®¢æˆ·ç«¯ï¼‰æ—¶é—´æˆ³ä¿å­˜åœ¨<code>gameStart</code> ã€‚ <br><br> ç­‰ç­‰  <b>æœåŠ¡å™¨ä¸Šæ˜¯å¦åº”è¯¥æ²¡æœ‰æ—¶é—´=å®¢æˆ·ç«¯ä¸­çš„æ—¶é—´ï¼Ÿ</b> ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦åŒºåˆ†â€œæœåŠ¡å™¨æ—¶é—´æˆ³â€å’Œâ€œå®¢æˆ·ç«¯æ—¶é—´æˆ³â€ï¼Ÿ è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ï¼ äº‹å®è¯æ˜ï¼Œè¿™ä¸æ˜¯åŒä¸€å›äº‹ã€‚  <code>Date.now()</code>å°†åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸­è¿”å›ä¸åŒçš„æ—¶é—´æˆ³ï¼Œè¿™å–å†³äºè¿™äº›è®¡ç®—æœºçš„æœ¬åœ°å› ç´ ã€‚  <strong>æ°¸è¿œä¸è¦å‡è®¾æ‰€æœ‰æœºå™¨ä¸Šçš„æ—¶é—´æˆ³éƒ½ç›¸åŒã€‚</strong> <br><br> ç°åœ¨æˆ‘ä»¬äº†è§£äº†<code>currentServerTime()</code>ä½œç”¨ï¼šå®ƒè¿”å›<strong>å½“å‰æ¸²æŸ“æ—¶é—´çš„æœåŠ¡å™¨æ—¶é—´æˆ³</strong> ã€‚<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¢å¥è¯è¯´ï¼Œè¿™æ˜¯å½“å‰æœåŠ¡å™¨æ—¶é—´ï¼ˆ</font></font><code>firstServerTimestamp &lt;+ (Date.now() - gameStart)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰å‡å»æ¸²æŸ“å»¶è¿Ÿï¼ˆ</font></font><code>RENDER_DELAY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬å¦‚ä½•å¤„ç†æ¸¸æˆæ›´æ–°ã€‚ä»æœåŠ¡å™¨æ¥æ”¶åˆ°æ›´æ–°æ—¶ï¼Œå°†ç§°ä¸º</font></font><code>processGameUpdate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå¹¶å°†æ–°æ›´æ–°ä¿å­˜åˆ°array </font></font><code>gameUpdates</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚ç„¶åï¼Œè¦æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œæˆ‘ä»¬å°†æ‰€æœ‰æ—§çš„æ›´æ–°åˆ é™¤åˆ°</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŸºæœ¬æ›´æ–°</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å†éœ€è¦å®ƒä»¬ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»€ä¹ˆæ˜¯â€œåŸºæœ¬æ›´æ–°â€ï¼Ÿè¿™æ˜¯</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å‘ç°ä»å½“å‰æœåŠ¡å™¨æ—¶é—´å¼€å§‹å‘åç§»åŠ¨</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„</font><strong><font style="vertical-align: inherit;">ç¬¬ä¸€ä¸ªæ›´æ–°</font></strong><font style="vertical-align: inherit;">ã€‚è¿˜è®°å¾—è¿™æ¡ç”µè·¯å—ï¼Ÿ</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ca/1c8/91c/2ca1c891ce7db0341dc78c2f88e16ce4.svg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›´æ¥åœ¨â€œå®¢æˆ·ç«¯æ¸²æŸ“æ—¶é—´â€å·¦ä¾§è¿›è¡Œçš„æ¸¸æˆæ›´æ–°æ˜¯ä¸€é¡¹åŸºæœ¬æ›´æ–°ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŸºæœ¬æ›´æ–°ç”¨äºä»€ä¹ˆï¼Ÿ</font><font style="vertical-align: inherit;">ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦æ”¾å¼ƒå¯¹åŸºç¡€çš„æ›´æ–°ï¼Ÿ</font><font style="vertical-align: inherit;">ä¸ºäº†ç†è§£è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€å</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çœ‹ä¸€ä¸‹å®ç°</font></font><code>getCurrentState()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> state.jsç¬¬2éƒ¨åˆ† </font></font></h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCurrentState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!firstServerTimestamp) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {}; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> base = getBaseUpdate(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> serverTime = currentServerTime(); <span class="hljs-comment"><span class="hljs-comment">// If base is the most recent update we have, use its state. // Else, interpolate between its state and the state of (base + 1). if (base &lt; 0) { return gameUpdates[gameUpdates.length - 1]; } else if (base === gameUpdates.length - 1) { return gameUpdates[base]; } else { const baseUpdate = gameUpdates[base]; const next = gameUpdates[base + 1]; const r = (serverTime - baseUpdate.t) / (next.t - baseUpdate.t); return { me: interpolateObject(baseUpdate.me, next.me, r), others: interpolateObjectArray(baseUpdate.others, next.others, r), bullets: interpolateObjectArray(baseUpdate.bullets, next.bullets, r), }; } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬å¤„ç†ä¸‰ç§æƒ…å†µï¼š </font></font><br><br><ol><li> <code>base &lt; 0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¡¨ç¤ºå½“å‰æ¸²æŸ“æ—¶é—´æ²¡æœ‰æ›´æ–°ï¼ˆè¯·å‚è§ä¸Šè¿°å®ç°</font></font><code>getBaseUpdate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã€‚</font><font style="vertical-align: inherit;">ç”±äºæ¸²æŸ“å»¶è¿Ÿï¼Œè¿™ç§æƒ…å†µå¯èƒ½åœ¨æ¸¸æˆå¼€å§‹æ—¶å°±å‘ç”Ÿã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨æœ€æ–°æ›´æ–°ã€‚</font></font></li><li> <code>base</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ˜¯æˆ‘ä»¬çš„æœ€æ–°æ›´æ–°ã€‚</font><font style="vertical-align: inherit;">è¿™å¯èƒ½æ˜¯ç”±äºç½‘ç»œå»¶è¿Ÿæˆ–äº’è”ç½‘è¿æ¥ä¸ä½³ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿˜å°†ä½¿ç”¨æˆ‘ä»¬æ‹¥æœ‰çš„æœ€æ–°æ›´æ–°ã€‚</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬åœ¨å½“å‰æ¸²æŸ“æ—¶é—´ä¹‹å‰å’Œä¹‹åéƒ½æœ‰æ›´æ–°ï¼Œå› æ­¤æ‚¨å¯ä»¥è¿›è¡Œ</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ’å€¼</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‰©ä¸‹çš„</font></font><code>state.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°±æ˜¯çº¿æ€§æ’å€¼çš„å®ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•ï¼ˆä½†å¾ˆæ— èŠï¼‰çš„æ•°å­¦è¿ç®—ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‚¨æƒ³è‡ªå·±å­¦ä¹ å®ƒï¼Œè¯·</font></font><code>state.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨</font></font><a href="" rel="noopener noreferrer"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸Š</font><font style="vertical-align: inherit;">æ‰“å¼€å®ƒ</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¬¬2éƒ¨åˆ†ã€‚åç«¯æœåŠ¡å™¨ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶è¿è¡Œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.ioæ¸¸æˆç¤ºä¾‹</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„Node.jsåç«¯</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.æœåŠ¡å™¨å…¥å£ç‚¹ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†æ§åˆ¶WebæœåŠ¡å™¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æµè¡Œçš„Node.js Webæ¡†æ¶</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Express</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å®ƒå°†ç”±æˆ‘ä»¬çš„æœåŠ¡å™¨å…¥å£ç‚¹æ–‡ä»¶é…ç½®</font></font><code>src/server/server.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> server.jsï¼Œç¬¬1éƒ¨åˆ† </font></font></h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> webpack = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> webpackDevMiddleware = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack-dev-middleware'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> webpackConfig = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../../webpack.dev.js'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Setup an Express server const app = express(); app.use(express.static('public')); if (process.env.NODE_ENV === 'development') { // Setup Webpack for development const compiler = webpack(webpackConfig); app.use(webpackDevMiddleware(compiler)); } else { // Static serve the dist/ folder in production app.use(express.static('dist')); } // Listen on port const port = process.env.PORT || 3000; const server = app.listen(port); console.log(`Server listening on port ${port}`);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿˜è®°å¾—æˆ‘ä»¬åœ¨ç¬¬ä¸€éƒ¨åˆ†ä¸­è®¨è®ºè¿‡Webpackå—ï¼Ÿ</font><font style="vertical-align: inherit;">è¿™æ˜¯æˆ‘ä»¬å°†ä½¿ç”¨Webpacké…ç½®çš„åœ°æ–¹ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä»¥ä¸¤ç§æ–¹å¼åº”ç”¨å®ƒä»¬ï¼š</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">webpack-dev-middleware</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‡ªåŠ¨é‡å»ºæˆ‘ä»¬çš„å¼€å‘åŒ…ï¼Œæˆ–è€…</font></font></li><li><font style="vertical-align: inherit;"></font><code>dist/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ç»„è£…ç”Ÿäº§åï¼Œå°†Webpack </font><font style="vertical-align: inherit;">é™æ€åœ°å°†å…¶</font><font style="vertical-align: inherit;">å†™å…¥æ–‡ä»¶</font><font style="vertical-align: inherit;">çš„æ–‡ä»¶å¤¹ä¼ è¾“åˆ°è¯¥æ–‡ä»¶å¤¹</font><font style="vertical-align: inherit;">ã€‚</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦ä¸€ä¸ªé‡è¦ä»»åŠ¡</font></font><code>server.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯é…ç½®</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket.io</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœåŠ¡å™¨</font><font style="vertical-align: inherit;">ï¼Œè¯¥</font><font style="vertical-align: inherit;">æœåŠ¡å™¨</font><font style="vertical-align: inherit;">ä»…è¿æ¥åˆ°ExpressæœåŠ¡å™¨ï¼š</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> server.jsï¼Œç¬¬2éƒ¨åˆ† </font></font></h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> socketio = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'socket.io'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Constants = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../shared/constants'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Setup Express // ... const server = app.listen(port); console.log(`Server listening on port ${port}`); // Setup socket.io const io = socketio(server); // Listen for socket.io connections io.on('connection', socket =&gt; { console.log('Player connected!', socket.id); socket.on(Constants.MSG_TYPES.JOIN_GAME, joinGame); socket.on(Constants.MSG_TYPES.INPUT, handleInput); socket.on('disconnect', onDisconnect); });</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸æœåŠ¡å™¨æˆåŠŸå»ºç«‹socket.ioè¿æ¥åï¼Œæˆ‘ä»¬ä¸ºæ–°å¥—æ¥å­—é…ç½®äº‹ä»¶å¤„ç†ç¨‹åºã€‚</font><font style="vertical-align: inherit;">äº‹ä»¶å¤„ç†ç¨‹åºé€šè¿‡å§”æ´¾ç»™singletonå¯¹è±¡æ¥å¤„ç†ä»å®¢æˆ·ç«¯æ”¶åˆ°çš„æ¶ˆæ¯</font></font><code>game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> server.jsï¼Œç¬¬3éƒ¨åˆ† </font></font></h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Game = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./game'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// ... // Setup the Game const game = new Game(); function joinGame(username) { game.addPlayer(this, username); } function handleInput(dir) { game.handleInput(this, dir); } function onDisconnect() { game.removePlayer(this); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª.ioé£æ ¼çš„æ¸¸æˆï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªå®ä¾‹</font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆâ€œæ¸¸æˆâ€ï¼‰-æ‰€æœ‰ç©å®¶éƒ½åœ¨åŒä¸€ä¸ªç«æŠ€åœºä¸Šç©ï¼</font><font style="vertical-align: inherit;">åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°æ­¤ç±»çš„å·¥ä½œåŸç†</font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.æ¸¸æˆæœåŠ¡å™¨ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¥ç±»</font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒ…å«æœ€é‡è¦çš„æœåŠ¡å™¨ç«¯é€»è¾‘ã€‚</font><font style="vertical-align: inherit;">å®ƒæœ‰ä¸¤ä¸ªä¸»è¦ä»»åŠ¡ï¼š</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç©å®¶ç®¡ç†</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¸¸æˆæ¨¡æ‹Ÿ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä»ç¬¬ä¸€ä¸ªä»»åŠ¡å¼€å§‹-æ’­æ”¾å™¨ç®¡ç†ã€‚</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> game.jsï¼Œç¬¬1éƒ¨åˆ† </font></font></h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Constants = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../shared/constants'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Player = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./player'</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.sockets = {}; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.players = {}; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bullets = []; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.lastUpdateTime = <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.now(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shouldSendUpdate = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; setInterval(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.update.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>), <span class="hljs-number"><span class="hljs-number">1000</span></span> / <span class="hljs-number"><span class="hljs-number">60</span></span>); } addPlayer(socket, username) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.sockets[socket.id] = socket; <span class="hljs-comment"><span class="hljs-comment">// Generate a position to start this player at. const x = Constants.MAP_SIZE * (0.25 + Math.random() * 0.5); const y = Constants.MAP_SIZE * (0.25 + Math.random() * 0.5); this.players[socket.id] = new Player(socket.id, username, x, y); } removePlayer(socket) { delete this.sockets[socket.id]; delete this.players[socket.id]; } handleInput(socket, dir) { if (this.players[socket.id]) { this.players[socket.id].setDirection(dir); } } // ... }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ­¤æ¸¸æˆä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡</font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ’åº§socket.io </font><font style="vertical-align: inherit;">çš„å­—æ®µæ¥è¯†åˆ«ç©å®¶</font><font style="vertical-align: inherit;">ï¼ˆå¦‚æœæ‚¨æ„Ÿåˆ°å›°æƒ‘ï¼Œè¯·è¿”å›</font></font><code>server.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã€‚</font><font style="vertical-align: inherit;">Socket.ioæœ¬èº«ä¸ºæ¯ä¸ªå¥—æ¥å­—åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„å¥—æ¥å­—</font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¿…ä¸ºæ­¤æ‹…å¿ƒã€‚</font><font style="vertical-align: inherit;">æˆ‘å°†å‘¼å«ä»–çš„</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç©å®¶ID</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬æ£€æŸ¥ç±»ä¸­çš„å®ä¾‹å˜é‡</font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br><br><ul><li> <code>sockets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯å°†æ’­æ”¾å™¨IDç»‘å®šåˆ°ä¸æ’­æ”¾å™¨å…³è”çš„å¥—æ¥å­—çš„å¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">å®ƒä½¿æˆ‘ä»¬å¯ä»¥åœ¨ä¸€å®šæ—¶é—´å†…é€šè¿‡å…¶æ’­æ”¾å™¨IDè®¿é—®å¥—æ¥å­—ã€‚</font></font></li><li> <code>players</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ˜¯å°†ç©å®¶IDç»‘å®šåˆ°ä»£ç &gt;ç©å®¶å¯¹è±¡çš„å¯¹è±¡ </font></font></li></ul><br> <code>bullets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯</font></font><code>Bullet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²¡æœ‰ç‰¹å®šé¡ºåº</font><font style="vertical-align: inherit;">çš„å¯¹è±¡æ•°ç»„</font><font style="vertical-align: inherit;">ã€‚</font></font><br> <code>lastUpdateTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-è¿™æ˜¯æ¸¸æˆä¸Šæ¬¡æ›´æ–°æ—¶é—´çš„æ—¶é—´æˆ³ã€‚</font><font style="vertical-align: inherit;">å¾ˆå¿«æˆ‘ä»¬å°†çœ‹åˆ°å®ƒçš„ç”¨æ³•ã€‚</font></font><br> <code>shouldSendUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯è¾…åŠ©å˜é‡ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä¹Ÿå°†å¾ˆå¿«çœ‹åˆ°å®ƒçš„ä½¿ç”¨ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–¹æ³•</font></font><code>addPlayer()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>removePlayer()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶ä¸”</font></font><code>handleInput()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸éœ€è¦è§£é‡Šï¼Œä»–ä»¬åœ¨ä½¿ç”¨</font></font><code>server.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‚¨éœ€è¦åˆ·æ–°å†…å­˜ï¼Œè¯·è¿”å›æ›´é«˜ä¸€ç‚¹ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åä¸€è¡Œ</font></font><code>constructor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¼€å§‹</font><font style="vertical-align: inherit;">æ¸¸æˆ</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´æ–°å‘¨æœŸ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆé¢‘ç‡ä¸º60æ¬¡æ›´æ–°/ç§’ï¼‰ï¼š</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> game.jsï¼Œç¬¬2éƒ¨åˆ† </font></font></h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Constants = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../shared/constants'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> applyCollisions = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./collisions'</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... update() { // Calculate time elapsed const now = Date.now(); const dt = (now - this.lastUpdateTime) / 1000; this.lastUpdateTime = now; // Update each bullet const bulletsToRemove = []; this.bullets.forEach(bullet =&gt; { if (bullet.update(dt)) { // Destroy this bullet bulletsToRemove.push(bullet); } }); this.bullets = this.bullets.filter( bullet =&gt; !bulletsToRemove.includes(bullet), ); // Update each player Object.keys(this.sockets).forEach(playerID =&gt; { const player = this.players[playerID]; const newBullet = player.update(dt); if (newBullet) { this.bullets.push(newBullet); } }); // Apply collisions, give players score for hitting bullets const destroyedBullets = applyCollisions( Object.values(this.players), this.bullets, ); destroyedBullets.forEach(b =&gt; { if (this.players[b.parentID]) { this.players[b.parentID].onDealtDamage(); } }); this.bullets = this.bullets.filter( bullet =&gt; !destroyedBullets.includes(bullet), ); // Check if any players are dead Object.keys(this.sockets).forEach(playerID =&gt; { const socket = this.sockets[playerID]; const player = this.players[playerID]; if (player.hp &lt;= 0) { socket.emit(Constants.MSG_TYPES.GAME_OVER); this.removePlayer(socket); } }); // Send a game update to each player every other time if (this.shouldSendUpdate) { const leaderboard = this.getLeaderboard(); Object.keys(this.sockets).forEach(playerID =&gt; { const socket = this.sockets[playerID]; const player = this.players[playerID]; socket.emit( Constants.MSG_TYPES.GAME_UPDATE, this.createUpdate(player, leaderboard), ); }); this.shouldSendUpdate = false; } else { this.shouldSendUpdate = true; } } // ... }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¥æ–¹æ³•</font></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯èƒ½åŒ…å«æœåŠ¡å™¨ç«¯é€»è¾‘ä¸­æœ€é‡è¦çš„éƒ¨åˆ†ã€‚</font><font style="vertical-align: inherit;">æŒ‰ç…§é¡ºåºï¼Œæˆ‘ä»¬åˆ—å‡ºäº†ä»–æ‰€åšçš„ä¸€åˆ‡ï¼š</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®¡ç®—</font></font><code>dt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‡ªä¸Šæ¬¡ä»¥æ¥ç»è¿‡</font><font style="vertical-align: inherit;">äº†å¤šå°‘æ—¶é—´</font></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></li><li>        .      .    ,  <code>bullet.update()</code> <strong> <code>true</code> ,     </strong> (    ). </li><li>        .       â€” <code>player.update()</code> <strong>   <code>Bullet</code></strong> . </li><li>         <code>applyCollisions()</code> ,    ,    .        ,    (  <code>player.onDealtDamage()</code> ),       <code>bullets</code> . </li><li>      . </li><li>      <strong> </strong>    <code>update()</code> .         <code>shouldSendUpdate</code> .   <code>update()</code>  60 /,     30 /.  , <strong> </strong>   30 / (       ). </li></ol><br><blockquote> <strong>     <em> </em> ?</strong>   . 30     â€“   ! </blockquote><br><blockquote> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºä»€ä¹ˆç„¶åä¸</font></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯ç§’</font><font style="vertical-align: inherit;">å‘¼å«</font><font style="vertical-align: inherit;">30æ¬¡å‘¢ï¼Ÿ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ”¹å–„äº†æ¸¸æˆçš„ä»¿çœŸæ€§ã€‚</font><font style="vertical-align: inherit;">è°ƒç”¨</font></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¾—è¶Šå¤šï¼Œæ¸¸æˆçš„æ¨¡æ‹Ÿå°±è¶Šå‡†ç¡®ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ä¸è¦</font></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› ä¸º</font><font style="vertical-align: inherit;">è°ƒç”¨æ•°é‡è€Œå¤ªè´¹åŠ²</font><font style="vertical-align: inherit;">ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªè®¡ç®—é‡å¾ˆå¤§çš„ä»»åŠ¡-æ¯ç§’60ä¸ªå°±è¶³å¤Ÿäº†ã€‚</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¥ç±»çš„å…¶ä½™éƒ¨åˆ†</font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±ç”¨äºä»¥ä¸‹æ–¹é¢çš„è¾…åŠ©æ–¹æ³•ç»„æˆ</font></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> game.jsï¼Œç¬¬3éƒ¨åˆ† </font></font></h5><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... getLeaderboard() { return Object.values(this.players) .sort((p1, p2) =&gt; p2.score - p1.score) .slice(0, 5) .map(p =&gt; ({ username: p.username, score: Math.round(p.score) })); } createUpdate(player, leaderboard) { const nearbyPlayers = Object.values(this.players).filter( p =&gt; p !== player &amp;&amp; p.distanceTo(player) &lt;= Constants.MAP_SIZE / 2, ); const nearbyBullets = this.bullets.filter( b =&gt; b.distanceTo(player) &lt;= Constants.MAP_SIZE / 2, ); return { t: Date.now(), me: player.serializeForUpdate(), others: nearbyPlayers.map(p =&gt; p.serializeForUpdate()), bullets: nearbyBullets.map(b =&gt; b.serializeForUpdate()), leaderboard, }; } }</span></span></code> </pre> <br> <code>getLeaderboard()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éå¸¸ç®€å•-æŒ‰å¾—åˆ†æ•°å¯¹ç©å®¶è¿›è¡Œæ’åºï¼Œè·å¾—5ä¸ªæœ€ä½³æˆç»©ï¼Œç„¶åä¸ºæ¯ä¸ªç”¨æˆ·åå’Œå¾—åˆ†è¿”å›ã€‚</font></font><br><br> <code>createUpdate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”¨äº</font></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»ºä¼ é€’ç»™ç©å®¶çš„æ¸¸æˆæ›´æ–°ã€‚</font><font style="vertical-align: inherit;">å®ƒçš„ä¸»è¦ä»»åŠ¡æ˜¯è°ƒç”¨</font></font><code>serializeForUpdate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸º</font></font><code>Player</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font><font style="vertical-align: inherit;">ç±»å®ç°çš„</font><font style="vertical-align: inherit;">æ–¹æ³•</font></font><code>Bullet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¯·æ³¨æ„ï¼Œä»–ä»…å‘æ¯ä¸ªç©å®¶ä¼ é€æœ‰å…³</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€è¿‘çš„</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç©å®¶å’Œç‚®å¼¹çš„ä¿¡æ¯-æ— éœ€ä¼ é€ä¸ç©å®¶è·ç¦»è¾ƒè¿œçš„æ¸¸æˆå¯¹è±¡çš„ä¿¡æ¯ï¼</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3.æœåŠ¡å™¨ä¸Šçš„æ¸¸æˆå¯¹è±¡ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æˆ‘ä»¬çš„æ¸¸æˆä¸­ï¼Œç‚®å¼¹å’Œç©å®¶å®é™…ä¸Šéå¸¸ç›¸ä¼¼ï¼šå®ƒä»¬æ˜¯æŠ½è±¡çš„åœ†å½¢ç§»åŠ¨æ¸¸æˆå¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†åˆ©ç”¨æ’­æ”¾å™¨å’Œå¤–å£³çš„è¿™ç§ç›¸ä¼¼æ€§ï¼Œè®©æˆ‘ä»¬ä»å®ç°åŸºç±»å¼€å§‹</font></font><code>Object</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> object.js </font></font></h5><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Object</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(id, x, y, dir, speed) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = id; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x = x; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.y = y; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.direction = dir; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.speed = speed; } update(dt) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x += dt * <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.speed * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.sin(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.direction); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.y -= dt * <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.speed * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.cos(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.direction); } distanceTo(object) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dx = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x - object.x; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dy = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.y - object.y; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.sqrt(dx * dx + dy * dy); } setDirection(dir) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.direction = dir; } serializeForUpdate() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id, <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.y, }; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™é‡Œæ²¡æœ‰å¤æ‚çš„äº‹æƒ…å‘ç”Ÿã€‚</font><font style="vertical-align: inherit;">æ­¤ç±»å°†æ˜¯æ‰©å±•çš„è‰¯å¥½å‚è€ƒç‚¹ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬çœ‹çœ‹è¯¥ç±»å¦‚ä½•</font></font><code>Bullet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨</font></font><code>Object</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bullet.js </font></font></h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> shortid = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'shortid'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ObjectClass = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./object'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Constants = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../shared/constants'</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bullet</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ObjectClass</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(parentID, x, y, dir) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(shortid(), x, y, dir, Constants.BULLET_SPEED); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.parentID = parentID; } <span class="hljs-comment"><span class="hljs-comment">// Returns true if the bullet should be destroyed update(dt) { super.update(dt); return this.x &lt; 0 || this.x &gt; Constants.MAP_SIZE || this.y &lt; 0 || this.y &gt; Constants.MAP_SIZE; } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®ç°</font></font><code>Bullet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¾ˆçŸ­ï¼</font><font style="vertical-align: inherit;">æˆ‘ä»¬</font></font><code>Object</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»…</font><font style="vertical-align: inherit;">æ·»åŠ </font><font style="vertical-align: inherit;">äº†ä»¥ä¸‹æ‰©å±•åï¼š</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shortid</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒ…</font><font style="vertical-align: inherit;">éšæœºç”Ÿæˆ</font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¼¹ä¸¸ã€‚</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ ä¸€ä¸ªå­—æ®µï¼Œ</font></font><code>parentID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä¾¿æ‚¨å¯ä»¥è·Ÿè¸ªåˆ›å»ºæ­¤å°„å¼¹çš„ç©å®¶ã€‚</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘åŠ ä¸Šè¿”å›å€¼</font></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœå°„å¼¹ä¸åœ¨ç«æŠ€åœºä¹‹å¤–</font><font style="vertical-align: inherit;">ï¼Œåˆ™</font><font style="vertical-align: inherit;">è¿”å›å€¼</font><font style="vertical-align: inherit;">ç›¸ç­‰</font><font style="vertical-align: inherit;">ï¼ˆè¿˜è®°å¾—ï¼Œæˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­è®¨è®ºäº†è¿™ä¸€ç‚¹å—ï¼Ÿï¼‰ã€‚</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ç»§ç»­</font></font><code>Player</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> player.js </font></font></h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ObjectClass = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./object'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Bullet = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./bullet'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Constants = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../shared/constants'</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Player</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ObjectClass</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(id, username, x, y) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(id, x, y, <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() * <span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI, Constants.PLAYER_SPEED); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.username = username; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hp = Constants.PLAYER_MAX_HP; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fireCooldown = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.score = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// Returns a newly created bullet, or null. update(dt) { super.update(dt); // Update score this.score += dt * Constants.SCORE_PER_SECOND; // Make sure the player stays in bounds this.x = Math.max(0, Math.min(Constants.MAP_SIZE, this.x)); this.y = Math.max(0, Math.min(Constants.MAP_SIZE, this.y)); // Fire a bullet, if needed this.fireCooldown -= dt; if (this.fireCooldown &lt;= 0) { this.fireCooldown += Constants.PLAYER_FIRE_COOLDOWN; return new Bullet(this.id, this.x, this.y, this.direction); } return null; } takeBulletDamage() { this.hp -= Constants.BULLET_DAMAGE; } onDealtDamage() { this.score += Constants.SCORE_BULLET_HIT; } serializeForUpdate() { return { ...(super.serializeForUpdate()), direction: this.direction, hp: this.hp, }; } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ’­æ”¾å™¨æ¯”shellå¤æ‚ï¼Œå› æ­¤åº”åœ¨æ­¤ç±»ä¸­å­˜å‚¨æ›´å¤šå­—æ®µã€‚ä»–çš„æ–¹æ³•éœ€è¦</font></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åšå¾ˆå¤šå·¥ä½œï¼Œç‰¹åˆ«æ˜¯å¦‚æœä¸ç•™ä¸‹æ–°åˆ›å»ºçš„å¤–å£³ï¼Œåˆ™è¿”å›å®ƒ</font></font><code>fireCooldown</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆè¯·è®°ä½ï¼Œæˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­å·²ç»è®¨è®ºè¿‡äº†å—ï¼Ÿï¼‰ã€‚ä»–è¿˜æ‰©å±•äº†æ–¹æ³•</font></font><code>serializeForUpdate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨æ¸¸æˆæ›´æ–°ä¸­åŒ…æ‹¬ç©å®¶çš„å…¶ä»–å­—æ®µã€‚</font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‹¥æœ‰åŸºç±»</font></font><code>Object</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯é¿å…ä»£ç å¯é‡å¤æ€§çš„é‡è¦æ­¥éª¤</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ²¡æœ‰ç±»ï¼Œåˆ™</font></font><code>Object</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯ä¸ªæ¸¸æˆå¯¹è±¡éƒ½åº”å…·æœ‰ç›¸åŒçš„å®ç°</font></font><code>distanceTo()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå¹¶ä¸”å°†æ‰€æœ‰è¿™äº›å®ç°çš„å¤åˆ¶ç²˜è´´åŒæ­¥åˆ°å‡ ä¸ªæ–‡ä»¶ä¸­å°†æ˜¯ä¸€åœºå™©æ¢¦ã€‚</font><font style="vertical-align: inherit;">å½“æ‰©å±•</font><font style="vertical-align: inherit;">ç±»</font><font style="vertical-align: inherit;">çš„æ•°é‡</font><font style="vertical-align: inherit;">å¢åŠ </font><font style="vertical-align: inherit;">æ—¶ï¼Œ</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™å¯¹äºå¤§å‹é¡¹ç›®å°¤ä¸ºé‡è¦</font></font></strong><font style="vertical-align: inherit;"></font><code>Object</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.å†²çªè¯†åˆ« </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»™æˆ‘ä»¬ç•™ä¸‹çš„å”¯ä¸€ä¸€ä»¶äº‹å°±æ˜¯è®¤è¯†ç‚®å¼¹ä½•æ—¶å‡»ä¸­äº†ç©å®¶ï¼</font><font style="vertical-align: inherit;">è¯·è®°ä½</font></font><code>update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç±»ä¸­</font><font style="vertical-align: inherit;">æŸä¸ªæ–¹æ³•çš„è¿™æ®µä»£ç </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> game.js </font></font></h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> applyCollisions = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./collisions'</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... update() { // ... // Apply collisions, give players score for hitting bullets const destroyedBullets = applyCollisions( Object.values(this.players), this.bullets, ); destroyedBullets.forEach(b =&gt; { if (this.players[b.parentID]) { this.players[b.parentID].onDealtDamage(); } }); this.bullets = this.bullets.filter( bullet =&gt; !destroyedBullets.includes(bullet), ); // ... } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦å®ç°ä¸€ç§æ–¹æ³•</font></font><code>applyCollisions()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font><font style="vertical-align: inherit;">è¯¥æ–¹æ³•</font><font style="vertical-align: inherit;">è¿”å›å‡»ä¸­ç©å®¶çš„æ‰€æœ‰ç‚®å¼¹ã€‚</font><font style="vertical-align: inherit;">å¹¸è¿çš„æ˜¯ï¼Œè¿™å¹¶ä¸æ˜¯é‚£ä¹ˆå›°éš¾ï¼Œå› ä¸º</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ‰€æœ‰ç¢°æ’å¯¹è±¡éƒ½æ˜¯åœ†ï¼Œè¿™æ˜¯å®ç°ç¢°æ’è¯†åˆ«çš„æœ€ç®€å•å›¾å½¢ã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å·²ç»</font></font><code>distanceTo()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ç±»çš„ä¸Šä¸€èŠ‚ä¸­å®ç°äº†</font><font style="vertical-align: inherit;">ä¸€ç§æ–¹æ³•</font></font><code>Object</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¿™æ˜¯æˆ‘ä»¬çš„ç¢°æ’è¯†åˆ«å®ç°çš„æ ·å­ï¼š </font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> crashs.js </font></font></h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Constants = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../shared/constants'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Returns an array of bullets to be destroyed. function applyCollisions(players, bullets) { const destroyedBullets = []; for (let i = 0; i &lt; bullets.length; i++) { // Look for a player (who didn't create the bullet) to collide each bullet with. // As soon as we find one, break out of the loop to prevent double counting a bullet. for (let j = 0; j &lt; players.length; j++) { const bullet = bullets[i]; const player = players[j]; if ( bullet.parentID !== player.id &amp;&amp; player.distanceTo(bullet) &lt;= Constants.PLAYER_RADIUS + Constants.BULLET_RADIUS ) { destroyedBullets.push(bullet); player.takeBulletDamage(); break; } } } return destroyedBullets; }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™ç§ç®€å•çš„ç¢°æ’è¯†åˆ«åŸºäºä»¥ä¸‹äº‹å®ï¼š</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœä¸¤ä¸ªåœ†çš„ä¸­å¿ƒä¹‹é—´çš„è·ç¦»å°äºå…¶åŠå¾„ä¹‹å’Œï¼Œåˆ™ä¸¤ä¸ªåœ†ä¼šå‘ç”Ÿç¢°æ’</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯ä¸¤ä¸ªåœ†å¿ƒä¹‹é—´çš„è·ç¦»å®Œå…¨ç­‰äºå…¶åŠå¾„ä¹‹å’Œæ—¶çš„æƒ…å†µï¼š</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/63f/e73/2c8/63fe732c87ed1872522787e3cc4d5ab2.svg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åœ¨è¿™é‡Œï¼Œæ‚¨éœ€è¦ä»”ç»†è€ƒè™‘ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢ï¼š </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°„å¼¹ä¸åº”è½å…¥åˆ›å»ºå®ƒçš„ç©å®¶æ‰‹ä¸­ã€‚</font><font style="vertical-align: inherit;">è¿™å¯ä»¥é€šè¿‡æ¯”è¾ƒå¯ä»¥å®ç°</font></font><code>bullet.parentID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”¨</font></font><code>player.id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ä¸å¤šä¸ªç©å®¶åŒæ—¶ç¢°æ’çš„æç«¯æƒ…å†µä¸‹ï¼Œå­å¼¹åªèƒ½å‘½ä¸­ä¸€æ¬¡ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†åœ¨æ“ä½œå‘˜çš„å¸®åŠ©ä¸‹è§£å†³æ­¤é—®é¢˜</font></font><code>break</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šä¸€æ—¦å‘ç°ç©å®¶ä¸å¼¹ä¸¸ç›¸æ’ï¼Œæˆ‘ä»¬å°†åœæ­¢æœç´¢å¹¶ç»§ç»­å‰è¿›è‡³ä¸‹ä¸€ä¸ªå¼¹ä¸¸ã€‚</font></font></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç»“æŸ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»…æ­¤è€Œå·²ï¼</font><font style="vertical-align: inherit;">æˆ‘ä»¬å·²ç»ä»‹ç»äº†åˆ›å»º.ioç½‘ç»œæ¸¸æˆæ‰€éœ€çš„æ‰€æœ‰çŸ¥è¯†ã€‚</font></font>æ¥ä¸‹æ¥æ˜¯ä»€ä¹ˆï¼Ÿ <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å»ºç«‹è‡ªå·±çš„.ioæ¸¸æˆï¼</font></font></strong> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰€æœ‰çš„ç¤ºä¾‹ä»£ç éƒ½æ˜¯å¼€æºçš„ï¼Œå¹¶å‘å¸ƒåœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Githubä¸Š</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN450574/">https://habr.com/ru/post/zh-CN450574/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN450556/index.html">é˜€é—¨æŒ‡æ•°-å®¡æŸ¥æ–°çš„VRè£…ç½®</a></li>
<li><a href="../zh-CN450564/index.html">é—ªå…‰ä¸è´«ç©·ï¼šæ•°å­—é©å‘½å¦‚ä½•ä½¿éŸ³ä¹å®¶æ›´è´«ç©·</a></li>
<li><a href="../zh-CN450566/index.html">å†…å­˜ä¸è¶³å¹¶åœ¨Android Studioä¸­ä½¿ç”¨çŸ¢é‡å›¾åƒ</a></li>
<li><a href="../zh-CN450568/index.html">æ¯ç§æ¯’è¯éƒ½æœ‰å…¶è‡ªå·±çš„è§£æ¯’å‰‚ã€‚ å¦‚ä½•ä¿å­˜æˆ–è‡³å°‘å°è¯•ï¼ˆæ›´æ–°ï¼šå…³äºå®¶åº­ä¸­æ¯’çš„è§£æ¯’å‰‚ï¼‰</a></li>
<li><a href="../zh-CN450572/index.html">Samba DCä½œä¸ºWindows 2012R2 ADåŸŸä¸­çš„ç¬¬äºŒä¸ªæ§åˆ¶å™¨ä»¥åŠWindowså’ŒLinuxä¸Šå®¢æˆ·ç«¯çš„æ¼«æ¸¸æ–‡ä»¶å¤¹</a></li>
<li><a href="../zh-CN450576/index.html">MessengeråŒ¿åçš„æ–°è§„åˆ™</a></li>
<li><a href="../zh-CN450578/index.html">å¹¿æ’­ä¸­å¬åˆ°äº†ä»€ä¹ˆï¼Ÿ æˆ‘ä»¬æ¥æ”¶å¹¶è§£ç æœ€æœ‰è¶£çš„ä¿¡å·ã€‚ ç¬¬2éƒ¨åˆ†ï¼Œç”šé«˜é¢‘</a></li>
<li><a href="../zh-CN450582/index.html">PIMåŸåˆ™</a></li>
<li><a href="../zh-CN450586/index.html">Fish Redux-ç”¨äºFlutterçš„æ–°Reduxåº“</a></li>
<li><a href="../zh-CN450592/index.html">åœ¨å¾·å›½ï¼Œç”µåŠ¨æ±½è½¦çš„æ—…è¡Œè´¹ç”¨å¯èƒ½ä¼šæ¯”æŸ´æ²¹æ±½è½¦çš„æ—…è¡Œè´¹ç”¨æ›´é«˜</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>