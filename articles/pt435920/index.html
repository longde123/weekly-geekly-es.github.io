<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéÖüèΩ üëµüèº üë©üèΩ‚Äçüî¨ Livro de receitas do desenvolvedor: Receitas DDD (parte 4, estruturas) üîº üñ±Ô∏è üßóüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Introdu√ß√£o 


 Ent√£o, n√≥s j√° decidimos sobre o escopo , metodologia e arquitetura . Vamos passar da teoria para a pr√°tica, para escrever c√≥digo. Go...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Livro de receitas do desenvolvedor: Receitas DDD (parte 4, estruturas)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435920/"><h1 id="vvedenie">  1. Introdu√ß√£o </h1><br><p> Ent√£o, n√≥s j√° decidimos sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o escopo</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">metodologia</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">arquitetura</a> .  Vamos passar da teoria para a pr√°tica, para escrever c√≥digo.  Gostaria de come√ßar com padr√µes de design que descrevam a l√≥gica de neg√≥cios - <em>Service</em> and <em>Interactor</em> .  Mas antes de embarcar neles, examinaremos os padr√µes estruturais - <em>ValueObject</em> e <em>Entity</em> .  Vamos desenvolver na linguagem <em>ruby</em> .  Em outros artigos, analisaremos todos os padr√µes necess√°rios para o desenvolvimento usando a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Arquitetura Vari√°vel</a> .  Todos os desenvolvimentos que s√£o aplicativos para esta s√©rie de artigos ser√£o coletados em uma estrutura separada. </p><br><p><img src="https://habrastorage.org/webt/uc/iz/ea/ucizea6-xkpivfyv18q9fvds9wm.jpeg" alt="Blacjack &amp; hockers"></p><br><p>  E j√° escolhemos um nome adequado - <strong>LunaPark</strong> . <br>  Desenvolvimentos atuais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">publicados no Github</a> . <br>  Depois de examinar todos os modelos, montaremos um microsservi√ßo completo. </p><a name="habracut"></a><br><h1 id="tak-istoricheski-slozhilos">  T√£o historicamente </h1><br><p>  Havia uma necessidade de refatorar um aplicativo corporativo complexo escrito em Ruby on Rails.  Havia uma equipe pronta de desenvolvedores de ruby.  A metodologia de desenvolvimento orientado a dom√≠nio foi perfeita para essas tarefas, mas n√£o havia solu√ß√£o pronta na linguagem usada.  Apesar do fato de a escolha do idioma ter sido determinada principalmente por nossa especializa√ß√£o, ela se mostrou bastante bem-sucedida.  Entre todos os idiomas que s√£o comumente usados ‚Äã‚Äãpara aplicativos da web, o ruby ‚Äã‚Äã√©, na minha opini√£o, o mais expressivo.  E, portanto, mais do que outros adequados para modelar objetos reais.  Esta n√£o √© apenas a minha opini√£o. </p><br><blockquote>  Esse √© o mundo Java.  Ent√£o voc√™ tem os novatos como Ruby.  O Ruby tem uma sintaxe muito expressiva e, nesse n√≠vel b√°sico, deve ser uma linguagem muito boa para o DDD (embora eu ainda n√£o tenha ouvido falar de muito uso real nesse tipo de aplicativo).  O Rails gerou muita empolga√ß√£o, porque finalmente parece facilitar a cria√ß√£o de UIs da Web, como eram no in√≠cio dos anos 90, antes da Web.  No momento, esse recurso foi aplicado principalmente para a constru√ß√£o de um grande n√∫mero de aplicativos da Web que n√£o possuem muita riqueza de dom√≠nio, uma vez que mesmo esses eram dolorosamente dif√≠ceis no passado.  Mas minha esperan√ßa √© que, √† medida que a parte do problema de implementa√ß√£o da interface do usu√°rio seja reduzida, as pessoas vejam isso como uma oportunidade de concentrar mais sua aten√ß√£o no dom√≠nio.  Se o uso do Ruby come√ßar a seguir nessa dire√ß√£o, acho que poderia fornecer uma excelente plataforma para DDD.  (Algumas pe√ßas de infraestrutura provavelmente teriam que ser preenchidas.) <br><br>  Eric Evans 2006 </blockquote><p>  Infelizmente, nos √∫ltimos 13 anos, nada mudou muito.  Na Internet, voc√™ pode encontrar tentativas de adaptar o Rails para isso, mas todas parecem terr√≠veis.  A estrutura do Rails √© pesada, lenta e n√£o s√≥lida.  √â muito dif√≠cil assistir sem l√°grimas como algu√©m est√° tentando descrever a implementa√ß√£o do padr√£o de <em>reposit√≥rio</em> com base no <em>ActiveRecord</em> .  Decidimos adotar um microframework e modific√°-lo de acordo com nossas necessidades.  Tentamos o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Grape</a> , a ideia com a documenta√ß√£o autom√°tica parecia bem-sucedida, mas, caso contr√°rio, foi abandonada e rapidamente abandonamos a ideia de us√°-la.  E quase imediatamente eles come√ßaram a usar outra solu√ß√£o - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sinatra</a> .  Ainda continuamos a us√°-lo para <em>controladores</em> e <em>pontos</em> finais REST. </p><br><div class="spoiler">  <b class="spoiler_title">REST?</b> <div class="spoiler_text"><p>  Se voc√™ desenvolveu aplicativos da web, j√° tem uma id√©ia sobre a tecnologia.  Ele tem seus pr√≥s e contras, cuja lista completa est√° al√©m do escopo deste artigo.  Mas para n√≥s, como desenvolvedores de aplicativos corporativos, a desvantagem mais importante ser√° que o REST (isso fica claro at√© pelo nome) reflete n√£o o processo, mas seu estado.  E a vantagem √© sua compreens√£o - a tecnologia √© clara para desenvolvedores de back-end e desenvolvedores de front-end. <br>  Mas talvez n√£o se concentre no REST, mas implemente sua solu√ß√£o http + json?  Mesmo que voc√™ consiga desenvolver sua API de servi√ßo, fornecendo sua descri√ß√£o a terceiros, voc√™ receber√° muitas perguntas.  Muito mais do que se voc√™ fornecer o REST familiar. <br>  Consideraremos o uso do REST como uma solu√ß√£o de compromisso.  Usamos o JSON para concis√£o e o padr√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">jsonapi</a> para n√£o desperdi√ßar o tempo dos desenvolvedores em guerras sagradas em rela√ß√£o ao formato da solicita√ß√£o. <br>  No futuro, quando analisarmos o <em>Endpoint</em> , veremos que, para se livrar do descanso, basta reescrever apenas uma classe.  Portanto, o REST n√£o deve incomodar se houver d√∫vidas. </p></div></div><br><p>  Ao escrever v√°rios microsservi√ßos, ganhamos bases - um conjunto de classes abstratas.  Cada classe pode ser escrita em meia hora; seu c√≥digo √© f√°cil de entender se voc√™ souber para que serve esse c√≥digo. </p><br><p>  Aqui surgiram as principais dificuldades.  Novos funcion√°rios que n√£o lidaram com pr√°ticas de DDD e arquitetura limpa n√£o conseguiram entender o c√≥digo e sua finalidade.  Se eu mesmo visse esse c√≥digo pela primeira vez antes de ler Evans, consideraria o legado como um excesso de engenharia. </p><br><p>  Para superar esse obst√°culo, decidiu-se escrever uma documenta√ß√£o (diretriz) que descreve a filosofia das abordagens utilizadas.  Os contornos desta documenta√ß√£o pareciam bem-sucedidos e foi decidido public√°-los em Habr√©.  Nas aulas abstratas repetidas de um projeto para outro, foi decidido colocar uma gema separada. </p><br><h1 id="filosofiya">  Filosofia </h1><br><p><img src="https://habrastorage.org/webt/eg/zm/c8/egzmc89jktbwuobb67mh-stoijc.png" alt="maneira legada"><br>  Se voc√™ se lembra de algum filme cl√°ssico sobre artes marciais, haver√° um cara legal que est√° habilmente lidando com um poste.  Um sexto √© essencialmente um graveto, uma ferramenta muito primitiva, uma das primeiras que caiu em m√£os humanas.  Mas nas m√£os do mestre, ele se torna uma arma formid√°vel. <br>  Voc√™ pode gastar tempo criando uma pistola que n√£o atira em sua perna ou pode aprender a t√©cnica de tiro.  Identificamos 4 princ√≠pios b√°sicos: </p><br><ul><li>  Voc√™ precisa simplificar as coisas complexas. </li><li>  O conhecimento √© mais importante que a tecnologia.  A documenta√ß√£o √© mais compreens√≠vel para uma pessoa do que o c√≥digo; um n√£o deve substituir um pelo outro. </li><li>  O pragmatismo √© mais importante que o dogmatismo.  Os padr√µes devem orientar o caminho, n√£o definir uma caixa delimitadora. </li><li>  Estruturalidade na arquitetura, flexibilidade na escolha das solu√ß√µes. </li></ul><br><p>  Uma filosofia semelhante pode ser rastreada, por exemplo, no ArchLinux OS - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">The Arch Way</a> .  No meu laptop, o Linux n√£o foi criado por muito tempo, mais cedo ou mais tarde ele quebrou e eu constantemente tive que reinstal√°-lo.  Isso causou v√°rios problemas, √†s vezes graves, como interrup√ß√£o do prazo para o trabalho.  Mas, depois de passar 2-3 dias depois de instalar o Arch, descobri como meu sistema operacional funciona.  Depois disso, ela come√ßou a trabalhar mais est√°vel, sem falhas.  Minhas anota√ß√µes me ajudaram a instal√°-lo em novos PCs em algumas horas.  Uma documenta√ß√£o abundante me ajudou a resolver novos problemas. </p><br><p>  A estrutura tem um car√°ter absolutamente de alto n√≠vel.  As classes que o descrevem s√£o respons√°veis ‚Äã‚Äãpela estrutura do aplicativo.  Solu√ß√µes de terceiros s√£o usadas para interagir com bancos de dados, implementar o protocolo http e outras coisas de baixo n√≠vel.  Gostar√≠amos que o programador espiasse o c√≥digo e entendesse como uma classe espec√≠fica funciona, e a documenta√ß√£o nos permitiria entender como gerenci√°-los.  Compreender o design do motor n√£o permitir√° que voc√™ dirija um carro. </p><br><h1 id="freymvork">  Enquadramento </h1><br><p>  √â dif√≠cil chamar o LunaPark de estrutura no sentido usual.  Quadro - quadro, Trabalho - trabalho.  Pedimos que n√£o nos limitemos ao escopo.  O √∫nico quadro que declaramos √© aquele que diz √† classe na qual essa ou aquela l√≥gica deve ser descrita.  √â um conjunto de ferramentas com instru√ß√µes abrangentes para eles. <br>  Cada classe √© abstrata e possui tr√™s n√≠veis: </p><br><pre><code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LunaPark</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#  module Forms #  class Single # / end end end</span></span></span></span></code> </pre> <br><p>  Se voc√™ deseja implementar um formul√°rio que cria um √∫nico elemento, voc√™ herda desta classe: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Forms</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Create</span></span></span><span class="hljs-class"> &lt; LunaPark::Forms::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Single</span></span></span></span></code> </pre> <br><p>  Se houver v√°rios elementos, usaremos outra <em>Implementa√ß√£o</em> . </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Forms</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Create</span></span></span><span class="hljs-class"> &lt; LunaPark::Forms::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Multiple</span></span></span></span></code> </pre> <br><p>  No momento, nem todos os desenvolvimentos foram colocados em perfeita ordem e a gema est√° em estado alfa.  O citaremos em etapas, de acordo com a publica√ß√£o dos artigos.  I.e.  se voc√™ <code>ValueObject</code> um artigo sobre <code>ValueObject</code> e <code>Entity</code> , esses dois modelos j√° est√£o implementados.  At√© o final do ciclo, todos eles ser√£o adequados para uso no projeto.  Como o pr√≥prio framework √© de pouca utilidade sem um link para sinatra \ roda, ser√° criado um reposit√≥rio separado que mostra como "estragar tudo" para iniciar rapidamente seu projeto. </p><br><p>  A estrutura √© principalmente um aplicativo para a documenta√ß√£o.  N√£o perceba esses artigos como documenta√ß√£o para a estrutura. </p><br><p>  Ent√£o, vamos ao que interessa. </p><br><h1 id="obekt-znachenie-value">  Objeto Valor </h1><br><blockquote>  - Qual a altura da sua namorada? <br>  - 151 <br>  - Voc√™ come√ßou a se encontrar com a est√°tua da liberdade? </blockquote><p>  Algo assim poderia ter acontecido em Indiana.  O crescimento humano n√£o √© apenas um n√∫mero, mas tamb√©m uma unidade de medida.  Nem sempre os atributos de um objeto podem ser descritos apenas por primitivas (Inteiro, String, Booleano etc.), √†s vezes s√£o necess√°rias combina√ß√µes deles: </p><br><ul><li>  Dinheiro n√£o √© apenas um n√∫mero, √© um n√∫mero (valor) + moeda. </li><li>  Uma data consiste em um dia, um m√™s e um ano. </li><li>  Para medir o peso, um √∫nico n√∫mero n√£o √© suficiente para n√≥s, tamb√©m requer uma unidade de medida. </li><li>  O n√∫mero do passaporte consiste em uma s√©rie e, de fato, no n√∫mero. </li></ul><br><p>  Por outro lado, isso nem sempre √© uma combina√ß√£o, talvez seja um tipo de extens√£o do primitivo. <br>  Um n√∫mero de telefone geralmente √© considerado um n√∫mero.  Por outro lado, √© improv√°vel que ele tenha um m√©todo de adi√ß√£o ou divis√£o.  Talvez exista um m√©todo que emita um c√≥digo de pa√≠s e um m√©todo que defina um c√≥digo de cidade.  Talvez haja um certo m√©todo decorativo que o apresentar√° n√£o apenas como uma sequ√™ncia de n√∫meros <code>79001231212</code> , mas como uma sequ√™ncia leg√≠vel: <code>7-900-123-12-12</code> . </p><br><div class="spoiler">  <b class="spoiler_title">talvez um decorador?</b> <div class="spoiler_text"><p>  Baseado no dogma, √© indiscut√≠vel - sim.  Se abordarmos esse dilema por parte do senso comum, quando decidirmos ligar para esse n√∫mero, transferiremos o pr√≥prio objeto para o telefone: </p><br><pre> <code class="ruby hljs">phone.call Values::PhoneNumber.new(<span class="hljs-number"><span class="hljs-number">79001231212</span></span>)</code> </pre> <br><p>  E se decidimos apresent√°-lo como uma sequ√™ncia, isso √© claramente feito para uma pessoa.  Ent√£o, por que n√£o tornamos essa linha leg√≠vel para uma pessoa imediatamente? </p><br><pre> <code class="ruby hljs">Values::PhoneNumber.new(<span class="hljs-number"><span class="hljs-number">79001231212</span></span>).to_s</code> </pre> </div></div><br><p>  Imagine que estamos criando o site de cassino online dos Tr√™s Machados e vendendo jogos de cartas.  Vamos precisar da classe 'baralho'. </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlayingCard</span></span></span><span class="hljs-class"> &lt; Lunapark::Values::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Compound</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_reader</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">suit</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rank</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  Portanto, nossa classe possui dois atributos somente leitura: </p><br><ul><li>  naipe - naipe de cart√£o </li><li>  rank - dignidade do cart√£o </li></ul><br><p>  Esses atributos s√£o definidos apenas ao criar um mapa e n√£o podem ser alterados ao us√°-lo.  Claro que voc√™ pode pegar uma carta de baralho e riscar <s>8</s> , escrever Q, mas isso √© inaceit√°vel.  Em uma sociedade decente, voc√™ provavelmente ser√° baleado.  A incapacidade de alterar atributos ap√≥s a cria√ß√£o do objeto determina a primeira propriedade do <em>objeto de valor</em> - imutabilidade. <br>  A segunda propriedade importante do <em>objeto de valor</em> ser√° como os comparamos. </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RSpec</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">describe</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlayingCard</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class">(:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">card</span></span></span><span class="hljs-class">) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">described_class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">suit</span></span></span><span class="hljs-class">: :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clubs</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rank</span></span></span><span class="hljs-class">: 10 } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class">(:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">other</span></span></span><span class="hljs-class">) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">described_class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">suit</span></span></span><span class="hljs-class">: :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clubs</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rank</span></span></span><span class="hljs-class">: 10 } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">it</span></span></span><span class="hljs-class"> '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">should</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">be</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">eql</span></span></span><span class="hljs-class">' </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">expect</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">card</span></span></span><span class="hljs-class">).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">eq</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">other</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  Esse teste falhar√°, pois eles ser√£o comparados no endere√ßo.  Para que o teste seja aprovado, precisamos comparar o <em>valor-objeto</em> por valor; para isso, adicionaremos um m√©todo de compara√ß√£o: </p><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">==</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(other)</span></span></span></span> suit == other.suit &amp;&amp; rank == other.rank <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Agora nosso teste passar√°.  Tamb√©m podemos adicionar m√©todos respons√°veis ‚Äã‚Äãpela compara√ß√£o, mas como comparamos 10 e K?  Como voc√™ provavelmente j√° adivinhou, tamb√©m os apresentaremos na forma <em>de Objetos de Valor</em> .  Ok, agora teremos que iniciar os dez melhores clubes como este: </p><br><pre> <code class="ruby hljs">ten = Values::Rank.new(<span class="hljs-string"><span class="hljs-string">'10'</span></span>) clubs = Values::Suits.new(<span class="hljs-symbol"><span class="hljs-symbol">:clubs</span></span>) ten_clubs = Values::PlayingCards.new(<span class="hljs-symbol"><span class="hljs-symbol">rank:</span></span> ten, <span class="hljs-symbol"><span class="hljs-symbol">clubs:</span></span> clubs)</code> </pre> <br><p>  Tr√™s linhas s√£o suficientes para rubi.  Para contornar essa limita√ß√£o, introduzimos a terceira propriedade do <em>Objeto-Valor</em> - rotatividade.  Vamos <code>.wrap</code> um m√©todo especial da classe <code>.wrap</code> , que pode pegar valores de v√°rios tipos e convert√™-los para o correto. </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlayingCard</span></span></span><span class="hljs-class"> &lt; Lunapark::Values::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Compound</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">obj</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">obj</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_a?</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#      PlayingCard obj #      case obj.is_a? Hash #    ,      new(obj) #    case obj.is_a String #    ,     new rank: obj[0..-2], suit:[-1] # ,  -  . else #       raise ArgumentError #  . end end def initialize(suit:, rank:) #     </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@suit</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = Suit.wrap(suit) #      </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@rank</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = Rank.wrap(rank) end end</span></span></span></span></code> </pre> <br><p>  Essa abordagem oferece uma grande vantagem: </p><br><pre> <code class="ruby hljs">ten = Values::Rank.new(<span class="hljs-string"><span class="hljs-string">'10'</span></span>) clubs = Values::Suits.new(<span class="hljs-symbol"><span class="hljs-symbol">:clubs</span></span>) from_values = Values::PlayingCard.wrap <span class="hljs-symbol"><span class="hljs-symbol">rank:</span></span> ten, <span class="hljs-symbol"><span class="hljs-symbol">suit:</span></span> clubs from_hash = Values::PlayingCard.wrap <span class="hljs-symbol"><span class="hljs-symbol">rank:</span></span> <span class="hljs-string"><span class="hljs-string">'10'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">suit:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:clubs</span></span> from_obj = Values::PlayingCard.wrap from_values from_str = Values::PlayingCard.wrap <span class="hljs-string"><span class="hljs-string">'10C'</span></span> <span class="hljs-comment"><span class="hljs-comment">#        utf ,  ,  .</span></span></code> </pre> <br><p>  Todos esses cart√µes ser√£o iguais um ao outro.  Se o m√©todo <code>wrap</code> expandir em boas pr√°ticas, coloc√°-lo em uma classe separada ser√°.  Do ponto de vista da abordagem dogm√°tica, uma classe separada tamb√©m ser√° obrigat√≥ria. <br>  Hmm, e o espa√ßo no conv√©s?  Como descobrir se este cart√£o √© um trunfo?  Este n√£o √© um cart√£o de jogo.  Este √© o <em>valor da</em> carta de baralho.  Esta √© exatamente a inscri√ß√£o 10 que voc√™ lidera no canto do papel√£o. <br>  √â necess√°rio relacionar-se com o <em>valor-objeto</em> , bem como com o primitivo, que por algum motivo n√£o foi implementado em ruby.  A partir daqui, a √∫ltima propriedade surge - o <em>Object-Value</em> n√£o <em>est√°</em> vinculado a nenhum dom√≠nio. </p><br><h2 id="rekomendacii">  Recomenda√ß√µes </h2><br><blockquote>  Entre toda a variedade de m√©todos e ferramentas usadas em todos os momentos de cada processo, h√° sempre um m√©todo e ferramenta que funciona mais r√°pido e melhor que outros. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Frederick Taylor</a> 1914 </blockquote><br><h5 id="arifmeticheskie-operacii-dolzhny-vozvraschat-novyy-obekt">  Opera√ß√µes aritm√©ticas devem retornar um novo objeto </h5><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># GOOD class Money &lt; LunaPark::Values::Compound def +(other) other = self.class.wrap(other) raise ArgumentError unless same_currency? other self.class.new( amount: amount + other.amount, currency: currency ) end end</span></span></code> </pre> <br><h5 id="atributy-_obekta-znacheniya_-mogu-byt-tolko-primitivami-ili-drugimi-_obektami-znacheniya_">  Os atributos <em>de um objeto de valor</em> podem ser apenas primitivos ou outros <em>objetos de valor</em> </h5><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># GOOD class Weight &lt; LunaPark::Values::Compound def intialize(value:, unit:) </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@value</span></span></span><span class="hljs-comment"> = value </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@unit</span></span></span><span class="hljs-comment"> = Unit.wrap(unit) end end # BAD class PlaingCard &lt; LunaPark::Value def initialize(rank:, suit:, deck:) ... </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@deck</span></span></span><span class="hljs-comment"> = Entity::Deck.wrap(deck) #    end end</span></span></code> </pre> <br><h5 id="prostye-operacii-derzhite-vnutri-metodov-klassa">  Mantenha opera√ß√µes simples dentro dos m√©todos de classe </h5><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># GOOD class Weight &lt; LunaPark::Values::Compound def &gt;(other) value &gt; other.convert_to(unit).value end end</span></span></code> </pre> <br><h5 id="esli-operaciya-konvertaciya-bolshaya-to-vozmozhno-est-smysl-vynesti-ee-v-otdelnyy-klass">  Se a opera√ß√£o de "convers√£o" for grande, talvez fa√ßa sentido mov√™-la para uma classe separada </h5><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># UGLY class Weight &lt; LunaPark::Values::Compound def convert_to(unit) unit = Unit.wrap(unit) case { self.unit.to_sym =&gt; unit.to_sym } when { :kg =&gt; :ft } Weight.new(value: 2.2046 * value, unit.to_sym) when # ... end end end # GOOD #./lib/values/weight/converter.rb class Weight class Converter &lt; LunaPark::Services::Simple def initialize(weight, to:) ... end end end #./lib/values/weight.rb class Weight &lt; LunaPark::Values::Compound def convert_to(unit) Converter.call! self, to: unit end end</span></span></code> </pre> <br><p>  Essa remo√ß√£o da l√≥gica em um <em>Servi√ßo</em> separado <em>√©</em> poss√≠vel <strong>apenas</strong> com a condi√ß√£o de que o <em>Servi√ßo seja</em> isolado: ele n√£o usa dados de fontes externas.  Este servi√ßo deve ser limitado pelo contexto do pr√≥prio <em>objeto Value</em> . </p><br><h5 id="obekt-znachenie-ne-mozhet-nichego-znat-o-domennoy-logike">  O valor do objeto n√£o pode saber nada sobre l√≥gica de dom√≠nio </h5><br><p>  Suponha que estamos escrevendo uma loja on-line e que tenhamos uma classifica√ß√£o de mercadorias.  Para obt√™-lo, voc√™ precisa fazer uma solicita√ß√£o ao banco de dados atrav√©s do <em>Reposit√≥rio</em> . </p><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># DEADLY BAD class Rate &lt; LunaPark::Values::Single def top?(10) Repository::Rates.top(first: 10).include? self end end</span></span></code> </pre> <br><h1 id="suschnost-entity">  Entidade </h1><br><p>  A classe <em>Entity</em> √© respons√°vel por algum objeto real.  Pode ser um contrato, uma cadeira, um agente imobili√°rio, uma torta, um ferro, um gato, uma geladeira - qualquer coisa.  Qualquer objeto que voc√™ precise modelar seus processos de neg√≥cios √© uma <em>Entidade</em> . <br>  O conceito de <em>Entidade √©</em> diferente para Evans e Martin.  Do ponto de vista de Evans, uma entidade √© um objeto caracterizado por algo que enfatiza sua individualidade. </p><br><div class="spoiler">  <b class="spoiler_title">Essence by Zvans</b> <div class="spoiler_text"><blockquote>  Se um objeto √© determinado por uma exist√™ncia individual √∫nica, e n√£o por um conjunto de atributos, essa propriedade deve ser lida como a principal ao definir um objeto em um modelo.  A defini√ß√£o da classe deve ser simples e constru√≠da em torno da continuidade e singularidade do ciclo de exist√™ncia do objeto.  Encontre uma maneira de distinguir cada objeto, independentemente de sua forma ou hist√≥ria de exist√™ncia.  Preste aten√ß√£o especial aos requisitos t√©cnicos associados √† compara√ß√£o de objetos de acordo com seus atributos.  Defina uma opera√ß√£o que necessariamente daria um resultado √∫nico para cada objeto - talvez seja necess√°rio associar um determinado s√≠mbolo √† exclusividade garantida para isso.  Esse meio de identifica√ß√£o pode ter uma origem externa, mas tamb√©m pode ser um identificador arbitr√°rio gerado pelo sistema para sua pr√≥pria conveni√™ncia.  No entanto, essa ferramenta deve obedecer √†s regras para distinguir entre objetos no modelo.  O modelo deve fornecer uma defini√ß√£o exata do que s√£o objetos id√™nticos. </blockquote></div></div><br><p>  Do ponto de vista de Martin, <em>Entidade</em> n√£o √© um objeto, mas uma camada.  Essa camada combinar√° o objeto e a l√≥gica de neg√≥cios para alter√°-lo. </p><br><div class="spoiler">  <b class="spoiler_title">Desola√ß√£o de Martin</b> <div class="spoiler_text"><blockquote>  Minha opini√£o sobre as entidades √© que elas cont√™m regras de neg√≥cios independentes de aplicativos.  Eles n√£o s√£o simplesmente objetos de dados.  Eles podem conter refer√™ncias a objetos de dados;  mas seu objetivo √© implementar m√©todos de regras de neg√≥cios que possam ser usados ‚Äã‚Äãpor muitos aplicativos diferentes. <br><br>  Gateways retornam Entidades.  A implementa√ß√£o (abaixo da linha) busca os dados do banco de dados e os utiliza para construir estruturas de dados que s√£o passadas √†s Entidades.  Isso pode ser feito com conten√ß√£o ou heran√ßa. <br><br>  Por exemplo: <br><br>  classe p√∫blica MyEntity {private MyDataStructure data;} <br><br>  ou <br><br>  classe p√∫blica MyEntity estende MyDataStructure {...} <br><br>  E lembre-se, somos todos piratas por natureza;  e as regras que estou falando aqui s√£o realmente mais como diretrizes ... </blockquote></div></div><br><p>  Por <em>ess√™ncia,</em> queremos dizer apenas estrutura.  Na sua forma mais simples, a classe <em>Entity</em> ficar√° assim: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MeatBag</span></span></span><span class="hljs-class"> &lt; LunaPark::Entities::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Simple</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_accessor</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hegiht</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">weight</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">birthday</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  Um objeto mut√°vel que descreve a estrutura de um modelo de neg√≥cios pode conter tipos e <em>valores</em> primitivos. <br>  A <code>LunaPark::Entites::Simple</code> √© incrivelmente simples, voc√™ pode ver o seu c√≥digo, isso nos d√° apenas uma coisa - f√°cil inicializa√ß√£o. </p><br><div class="spoiler">  <b class="spoiler_title">LunaPark :: Entites :: Simples</b> <div class="spoiler_text"><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LunaPark</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Simple</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">params</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">set_attributes</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">params</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">set_attributes</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hash</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hash</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">each</span></span></span><span class="hljs-class"> { |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">k</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">v</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">send</span></span></span><span class="hljs-class">(:"</span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#{k}=", v) } end end end end</span></span></span></span></code> </pre> </div></div><br><p>  Voc√™ pode escrever: </p><br><pre> <code class="ruby hljs">john_doe = Entity::MeatBag.new( <span class="hljs-symbol"><span class="hljs-symbol">id:</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">name:</span></span> <span class="hljs-string"><span class="hljs-string">'John Doe'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">height:</span></span> <span class="hljs-string"><span class="hljs-string">'180cm'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">weight:</span></span> <span class="hljs-string"><span class="hljs-string">'80kg'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">birthday:</span></span> <span class="hljs-string"><span class="hljs-string">'01-01-1970'</span></span> )</code> </pre> <br><p>  Como voc√™ provavelmente j√° adivinhou, queremos incluir o peso, a altura e a data de nascimento nos <em>objetos de valor</em> . </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MeatBag</span></span></span><span class="hljs-class"> &lt; LunaPark::Entites::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Simple</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_accessor</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_reader</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">heiht</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wight</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">birthday</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">height</span></span></span><span class="hljs-class">=(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">height</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">height</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values::Height</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">height</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">weight</span></span></span><span class="hljs-class">=(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">height</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">height</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values::Weight</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">weight</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">birthday</span></span></span><span class="hljs-class">=(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">day</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">birthday</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Date</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">parse</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">day</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  Para n√£o perder tempo com esses construtores, preparamos uma <em>implementa√ß√£o</em> mais complexa <em>do</em> <a href=""><code>LunaPark::Entites::Nested</code></a> : </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MeatBag</span></span></span><span class="hljs-class"> &lt; LunaPark::Entities::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Nested</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">heiht</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values::Height</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">weight</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values::Weight</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">birthday</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values::Date</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">parse</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  Como o nome sugere, esta <em>Implementa√ß√£o</em> permite criar estruturas em √°rvore. </p><br><p>  Vamos satisfazer minha paix√£o por eletrodom√©sticos volumosos.  Em um artigo anterior, tra√ßamos uma analogia entre o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"toque" de uma m√°quina de lavar e a arquitetura</a> .  E agora descreveremos um objeto de neg√≥cios t√£o importante como uma geladeira: </p><br><p><img src="https://habrastorage.org/webt/xl/65/pj/xl65pjsr5ou5a4nurhdm9qxbo50.png" alt="Refregerator"></p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Refregerator</span></span></span><span class="hljs-class"> &lt; LunaPark::Entites::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Nested</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">brand</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">namespace</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">namespace</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">door</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">upper</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lower</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">upper</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lower</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">namespace</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">main</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">namespace</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">door</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">first</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">second</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">third</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">namespace</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">boxes</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">left</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Box</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">right</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Box</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">first</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">second</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">third</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fourth</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">last_open_at</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comparable</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">false</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  Essa abordagem evita a cria√ß√£o de <em>entidades</em> desnecess√°rias, como a porta da geladeira.  Sem uma geladeira, ela deve fazer parte da geladeira.  Essa abordagem √© conveniente para a compila√ß√£o de documentos relativamente grandes, por exemplo, um aplicativo para a compra de seguros. </p><br><p>  A <code>LunaPark::Entites::Nested</code> possui mais 2 propriedades importantes: </p><br><p>  Comparabilidade: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entites</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> &lt; LunaPark::Entites::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Nested</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">email</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">registred_at</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">u1</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entites::User</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">email</span></span></span><span class="hljs-class">: '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">john</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">doe</span></span></span><span class="hljs-class">@</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mail</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">', </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">registred_at</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Time</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">now</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">u2</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entites::User</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">email</span></span></span><span class="hljs-class">: '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">john</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">doe</span></span></span><span class="hljs-class">@</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mail</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">', </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">registred_at</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Time</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">now</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">u1</span></span></span><span class="hljs-class"> == </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">u2</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># =&gt; false</span></span></span></span></code> </pre> <br><p>  Os dois usu√°rios especificados n√£o s√£o equivalentes, porque  eles foram criados em momentos diferentes e, portanto, o valor do atributo <code>registred_at</code> ser√° diferente.  Mas se cruzarmos o atributo da lista de comparados: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entites</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> &lt; LunaPark::Entites::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Nested</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">email</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">registred_at</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comparable</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">false</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  ent√£o temos dois objetos compar√°veis. </p><br><p>  Essa <em>implementa√ß√£o</em> tamb√©m tem a propriedade de rotatividade - podemos usar o m√©todo de classe </p><br><pre> <code class="ruby hljs">Entites::User.wrap(<span class="hljs-symbol"><span class="hljs-symbol">email:</span></span> <span class="hljs-string"><span class="hljs-string">'john.doe@mail.com'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">registred_at:</span></span> Time.now)</code> </pre> <br><p>  Voc√™ pode usar o Hash, o OpenStruct ou qualquer outra j√≥ia que desejar como <em>Entidade</em> , o que o ajudar√° a realizar a estrutura da sua entidade. </p><br><p>  <em>Uma entidade</em> √© um modelo de um objeto de neg√≥cios, deixe simples.  Se alguma propriedade n√£o for usada pela sua empresa, n√£o a descreva. </p><br><h1 id="izmeneniya-suschnosti">  Altera√ß√µes de entidade </h1><br><p>  Como voc√™ notou, a classe <em>Entity</em> n√£o possui m√©todos de sua pr√≥pria altera√ß√£o.  Todas as altera√ß√µes s√£o feitas de fora.  <em>O objeto de valor</em> tamb√©m <em>√©</em> imut√°vel.  Todas as fun√ß√µes que nela est√£o presentes, em geral, decoram a ess√™ncia ou criam novos objetos.  A pr√≥pria ess√™ncia permanece inalterada.  Para um desenvolvedor Ruby on Rails, essa abordagem ser√° incomum.  Do lado de fora, pode parecer que geralmente usamos a linguagem OOP para outra coisa.  Mas se voc√™ olhar um pouco mais fundo - n√£o √© assim.  Uma janela pode abrir sozinha?  Consiga um carro para trabalhar, reserve um hotel, gato fofo, consiga um novo assinante?  Todas essas s√£o influ√™ncias externas.  Algo acontece no mundo real, e n√≥s refletimos isso em n√≥s mesmos.  Para cada solicita√ß√£o, fazemos altera√ß√µes em nosso modelo.  E, assim, mantemo-lo atualizado, suficiente para nossas tarefas comerciais.  √â necess√°rio separar o estado do modelo e os processos que causam altera√ß√µes nesse estado.  Como fazer isso, consideraremos no pr√≥ximo artigo. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt435920/">https://habr.com/ru/post/pt435920/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt435908/index.html">Ascetic web: prot√≥tipos de mercados de pulgas em movimento e js</a></li>
<li><a href="../pt435910/index.html">Por que o BSD perdeu a batalha com o GNU / Linux?</a></li>
<li><a href="../pt435912/index.html">Os principais problemas do desenvolvimento de interfaces modernas</a></li>
<li><a href="../pt435914/index.html">Empacotando aplicativos principais do ASP.NET usando o Docker</a></li>
<li><a href="../pt435916/index.html">Ao invadir a VK, a autentica√ß√£o de dois fatores n√£o salvar√°</a></li>
<li><a href="../pt435922/index.html">Java, Spring, Kurento e servi√ßos de m√≠dia. Parte 2</a></li>
<li><a href="../pt435924/index.html">A rede neural gera imagens de pratos de acordo com as receitas para sua prepara√ß√£o</a></li>
<li><a href="../pt435926/index.html">Rede neural coleta fragmentos de achados arqueol√≥gicos</a></li>
<li><a href="../pt435928/index.html">Geladeira em vez de Bruce Willis: a Terra atinge primeiro</a></li>
<li><a href="../pt435930/index.html">A origem da termoac√∫stica. A chama do Higgins. Tubo de Rijke</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>