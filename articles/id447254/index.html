<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤·ğŸ» ğŸ§œ ğŸ›ƒ Cara memasukkan parameter ke dalam metode tanpa parameter dalam kode aman ğŸ‘¨ğŸ½â€ğŸ”¬ ğŸ‘©ğŸ¾â€ğŸš’ ğŸŒ«ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo Kali ini kami terus menertawakan panggilan metode biasa. Saya mengusulkan untuk berkenalan dengan pemanggilan metode dengan parameter tanpa melew...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cara memasukkan parameter ke dalam metode tanpa parameter dalam kode aman</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447254/">  Halo  Kali ini kami terus menertawakan panggilan metode biasa.  Saya mengusulkan untuk berkenalan dengan pemanggilan metode dengan parameter tanpa melewati parameter.  Kami juga akan mencoba mengubah tipe referensi ke nomor - alamatnya, tanpa menggunakan pointer dan <i>kode yang tidak aman</i> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ua/80/z6/ua80z6gqkrpmrvr-y2-5k2u_h8a.jpeg" width="400"></div><a name="habracut"></a><br><h3>  Penafian </h3><br>  Sebelum melanjutkan cerita, saya sangat menyarankan Anda membaca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">posting</a> sebelumnya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tentang StructLayout</a> .  Di sini saya akan menggunakan beberapa fitur, yang dijelaskan di sana. <br><br>  Saya juga ingin memperingatkan bahwa artikel ini tidak mengandung bahan yang harus digunakan dalam proyek nyata. <br><br><h3>  Beberapa informasi awal </h3><br>  Sebelum kita mulai berlatih, mari kita ingat bagaimana kode C # dikonversi menjadi kode assembler. <br>  Mari kita periksa contoh sederhana. <br><br><pre><code class="plaintext hljs">public class Helper { public virtual void Foo(int param) { } } public class Program { public void Main() { Helper helper = new Helper(); var param = 5; helper.Foo(param); } }</code> </pre> <br>  Kode ini tidak mengandung sesuatu yang sulit, tetapi instruksi yang dihasilkan oleh JiT berisi beberapa poin kunci.  Saya mengusulkan untuk melihat hanya sebagian kecil dari kode yang dihasilkan.  dalam contoh saya, saya akan menggunakan kode assembler untuk mesin 32 bit. <br><br><pre> <code class="plaintext hljs">1: mov dword [ebp-0x8], 0x5 2: mov ecx, [ebp-0xc] 3: mov edx, [ebp-0x8] 4: mov eax, [ecx] 5: mov eax, [eax+0x28] 6: call dword [eax+0x10]</code> </pre><br>  Dalam contoh kecil ini, Anda dapat mengamati konvensi pemanggilan cepat yang menggunakan register untuk melewatkan parameter (dua parameter pertama dari kiri ke kanan di register ecx dan edx), dan parameter yang tersisa dilewatkan melalui tumpukan dari kanan ke kiri.  Parameter pertama (implisit) adalah alamat instance dari kelas di mana metode ini dipanggil (untuk metode non-statis). <br><br>  Dalam kasus kami, parameter pertama adalah alamat instance, yang kedua adalah nilai <b>int</b> kami. <br><br>  Jadi int baris <b>pertama</b> kita melihat variabel lokal 5, tidak ada yang menarik di sini. <br>  Di baris <b>kedua</b> , kami menyalin alamat instance Helper ke register ecx.  Ini adalah alamat penunjuk ke tabel metode. <br>  Pada baris <b>ketiga</b> ada penyalinan variabel lokal 5 ke dalam register edx <br>  Pada baris <b>keempat</b> kita bisa melihat menyalin alamat tabel metode ke dalam register eax <br>  Baris <b>kelima</b> berisi memuat nilai dari memori pada alamat 40 byte lebih besar dari alamat tabel metode: awal alamat metode dalam tabel metode.  (Tabel metode berisi berbagai informasi yang disimpan sebelumnya. Misalnya alamat tabel metode kelas dasar, alamat EEClass, berbagai bendera, termasuk bendera pengumpul sampah, dan sebagainya).  Dengan demikian, alamat metode pertama dari tabel metode sekarang disimpan dalam register eax. <br>  <i>Catatan: Di .NET Core, tata letak tabel metode diubah.</i>  <i>Sekarang ada bidang (masing-masing pada 32/64 bit offset untuk sistem 32 dan 64 bit) yang berisi alamat awal daftar metode.</i> <br>  Pada baris <b>keenam</b> , metode ini disebut pada offset 16 dari awal, yaitu yang kelima pada tabel metode.  Mengapa hanya metode kami yang kelima?  Saya mengingatkan Anda bahwa <b>objek</b> memiliki 4 metode virtual ( <i>ToString (), Equals (), GetHashCode () dan Finalize ()</i> ), yang dimiliki oleh semua kelas. <br><br><h3>  Praktek Goto; </h3><br>  Praktif: <br>  Sudah waktunya untuk memulai demonstrasi kecil.  Saya sarankan kosong kecil seperti itu (sangat mirip dengan kosong dari artikel sebelumnya). <br><br><pre> <code class="plaintext hljs"> [StructLayout(LayoutKind.Explicit)] public class CustomStructWithLayout { [FieldOffset(0)] public Test1 Test1; [FieldOffset(0)] public Test2 Test2; } public class Test1 { public virtual int Useless(int param) { Console.WriteLine(param); return param; } } public class Test2 { public virtual int Useless() { return 888; } } public class Stub { public void Foo(int stub) { } }</code> </pre><br>  Dan mari kita gunakan hal-hal seperti itu: <br><br><pre> <code class="plaintext hljs"> class Program { static void Main(string[] args) { Test2 fake = new CustomStructWithLayout { Test2 = new Test2(), Test1 = new Test1() }.Test2; Stub bar = new Stub(); int param = 55555; bar.Foo(param); fake.Useless(); Console.Read(); } }</code> </pre><br>  Seperti yang Anda duga, dari pengalaman artikel sebelumnya, metode <i>U1ess (int j)</i> tipe <b>Test1</b> akan dipanggil. <br><br>  Tapi apa yang akan ditampilkan?  Pembaca yang penuh perhatian, saya percaya, telah menjawab pertanyaan ini.  "55555" ditampilkan di konsol. <br><br>  Tapi mari kita lihat fragmen kode yang dihasilkan. <br><br><pre> <code class="plaintext hljs"> mov ecx, [ebp-0x20] mov edx, [ebp-0x10] cmp [ecx], ecx call Stub.Foo(Int32) mov ecx, [ebp-0x1c] mov eax, [ecx] mov eax, [eax+0x28] call dword [eax+0x10]</code> </pre><br>  Saya pikir Anda mengenali pola panggilan metode virtual, itu dimulai setelah <i>panggilan Stub.Foo (Int32)</i> .  Seperti yang bisa kita lihat, seperti yang diharapkan, ecx diisi dengan alamat instance di mana metode dipanggil.  Tetapi karena kompiler berpikir bahwa kita memanggil metode tipe Test2, yang tidak memiliki parameter, tidak ada yang ditulis ke edx.  Namun, kami memiliki panggilan metode lain sebelumnya.  Dan di sana kami telah menggunakan edx untuk melewatkan parameter.  Dan tentu saja kami tidak memiliki instruksi, itu jelas edx.  Jadi, seperti yang Anda lihat di output konsol, nilai edx sebelumnya digunakan. <br><br>  Ada nuansa menarik lainnya.  Saya secara khusus menggunakan tipe yang bermakna.  Saya sarankan mencoba mengganti tipe parameter dari metode Foo tipe Stub dengan tipe referensi apa pun, misalnya string.  Tetapi tipe parameter dari metode <i>Useless ()</i> tidak berubah.  Di bawah ini Anda dapat melihat hasilnya di komputer saya dengan beberapa informasi klarifikasi: WinDBG dan Kalkulator :) <br><br> <a href=""><img src="https://habrastorage.org/webt/lj/pt/5i/ljpt5isxjzejz0_kxhu0yyovyhw.jpeg"></a> <br>  <i>Gambar yang dapat diklik</i> <br><br>  Jendela output menampilkan alamat tipe referensi dalam notasi desimal. <br><br><h3>  Total </h3><br>  Kami menyegarkan pengetahuan tentang metode panggilan menggunakan konvensi panggilan cepat dan segera menggunakan register edx yang bagus untuk melewatkan parameter dalam 2 metode sekaligus.  Kami juga meludahi semua jenis dan dengan pengetahuan bahwa semuanya hanya byte dengan mudah memperoleh alamat objek tanpa menggunakan pointer dan kode tidak aman.  Lebih lanjut saya berencana untuk menggunakan alamat yang diterima untuk tujuan yang bahkan lebih tidak berlaku! <br><br>  Terima kasih atas perhatiannya! <br><br>  Kode PS C # dapat ditemukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di sini</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id447254/">https://habr.com/ru/post/id447254/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id447244/index.html">C301 dan miniOTP-3, token baru yang dapat diprogram dari Token2</a></li>
<li><a href="../id447246/index.html">Prototipe dalam 1 hari, bukan 2-3 minggu: Pencetakan 3D dalam masalah Okeanpribor</a></li>
<li><a href="../id447248/index.html">Apa yang sedang dieksplorasi di stratosfer?</a></li>
<li><a href="../id447250/index.html">Belajar berkomunikasi antar microservices di Node.js melalui RabbitMQ</a></li>
<li><a href="../id447252/index.html">Bantu Duke menemukan jalan keluar</a></li>
<li><a href="../id447256/index.html">The Miracle of Materialize Magics: Nissan menghabiskan beberapa detik, bukannya berbulan-bulan bekerja</a></li>
<li><a href="../id447258/index.html">Security Week 15: serangan pada router dengan DNS spoofing</a></li>
<li><a href="../id447260/index.html">Live Share di Visual Studio 2019</a></li>
<li><a href="../id447262/index.html">Mempercepat situs dengan JivoSite. Unduh konsultan online tangguhan</a></li>
<li><a href="../id447264/index.html">Ignite Service Grid - Reboot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>