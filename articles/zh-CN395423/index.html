<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙅🏼 👴🏻 🔎 刺猬-会说话的鸟[如果有MP3播放器] 😅 🏴‍☠️ 🐑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="很久以前，似乎已经不真实了， masterkit谈到了一个很棒的内置MP3播放器，它可以配备任何东西，甚至MP3播放器，如果您先从中取出自己的东西，然后再戴上它。简而言之，是一件有用的事情。尤其是如果您要制作儿童玩具，首先要用自己的双手，其次要正确，而不是像那些以工业规模制造玩具的人那样思考。
 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>刺猬-会说话的鸟[如果有MP3播放器]</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/395423/"><img src="https://habrastorage.org/files/dd1/444/264/dd1444264dca4f489dd7f23d7cd5e9e4.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
很久以前，似乎已经不真实了，   </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">masterkit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">谈到了一个很棒的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置MP3播放器</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它可以配备任何东西，甚至MP3播放器，如果您先从中取出自己的东西，然后再戴上它。</font><font style="vertical-align: inherit;">简而言之，是一件有用的事情。</font><font style="vertical-align: inherit;">尤其是如果您要制作儿童玩具，首先要用自己的双手，其次要正确，而不是像那些以工业规模制造玩具的人那样思考。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，在展示的产品中，我不仅对所有内容都感到满意，所以我想：这不可能使具有中国特色的东西不在Aliexpress上。</font><font style="vertical-align: inherit;">确实，有一定数量的此类参与者，对模型范围的熟悉表明，存在比具有固定内存量的模型更具吸引力的选择。</font><font style="vertical-align: inherit;">即-具有用于可移动microSD卡的插槽。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
走开了。</font></font><br>
<br>
<a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了弄清楚它的去向和去向，以各种方式进行了刺猬演示。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
等待时有趣的短语：</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://www.youtube.com/embed/1366DoGJP6A%3Ffeature%3Doembed&amp;usg=ALkJrhiBZHi1jplEx1P0ShAcPrnpjxUpTA" frameborder="0" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过卡片切换和切换故事，音量和摇动：</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://www.youtube.com/embed/SS5_vjFK_TI%3Ffeature%3Doembed&amp;usg=ALkJrhh3o4dlNwdLZjEFJTrqrx0DCf-NdA" frameborder="0" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
无线充电：</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://www.youtube.com/embed/Za0hYTwOwkk%3Ffeature%3Doembed&amp;usg=ALkJrhitibCG_9gMB213ECHqKezgG8QIcQ" frameborder="0" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在继续讲故事之前，我很抱歉在描述和电路方面可能会出现一些错误，因为在此过程中我没有直觉地记录任何东西。请使用常识和实用材料，以免日后痛苦不堪。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，经过简短的搜索和比较之后，我转到了Ebay，在那里我得到了想要的东西- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有JQ6500解码器芯片，4 MB内部存储器和microSD插槽</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">播放器</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/files/923/8cc/760/9238cc7604aa45fbb5ba4a76de92480c.JPG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为什么是这个玩家？因为在我看来，这是自制工作的理想选择。因为一切都在他身上。如果需要，请单独使用它：为此，有播放/暂停引脚，切换音轨，音量，五个音轨的快速播放以及用于将扬声器直接连接到板的单声道放大器（也有立体声输出，但已经需要一个外部放大器）。也就是说，至少要有足够的电池，扬声器，几个按钮和带有音乐的存储卡。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/2ca/379/9f7/2ca3799f706c4076ce19752a3f16bad3.jpg" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是更有趣的是，通过类似串口的方式来完全控制播放器。在这里，您可以做任何事情-播放，停止，更改音量，切换均衡器和播放模式，以“通过”顺序和从某些文件夹开始播放任意歌曲。而且，就我而言，重要的是，已经有一个</font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现成的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Arduino </font><a href=""><font style="vertical-align: inherit;">库</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，已知两个组件：播放器和Arduino。但就我个人而言，我不想停在这里，因为愚蠢地模仿整个微控制器的按钮是愚蠢的。需要一些特殊的东西，以便可以说和Emely一起长矛。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，在这里我们添加了最简单的振动传感器</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SW-18010P</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和著名的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RC522读卡器</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/150/d3c/e96/150d3ce963b480b1fbec1ec4b268ce99.jpg" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
只是为了完全摆脱按钮，我发现在娱乐性玩具中这些按钮是不必要的。自己判断：如果有按钮，则孩子会以某种方式按一下按钮，并且按频率更高-偶然而不是有意识地。但是，童话故事的超频繁转换还是不太正确的。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/b9c/02e/0a2/b9c02e0a23baf7608a221f9f4414597d.jpg" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事实证明：振动传感器可在孩子拿起玩具时打开玩具。在儿童将其戴上足够长的时间之前，相同的传感器将不允许关闭玩具。至于Mifare读卡器，我认为这对于切换童话故事非常方便。例如，可以将卡贴在书上，然后孩子可以通过将玩具拿到书上来听童话故事。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
卡片还可以贴在各个主题上，然后孩子将能够听取他们的描述和使用规则。例如，这个白色的小雕像是冰箱，我们将食物存放在那里，以免食物变质，因此，不值得打开它。或者这是烤箱，它可能很热，因此您无需挂在其把手上，也无需将手放在玻璃上。可以发明很多东西，特别是因为这些卡是地铁票（是的，我很幸运，我在莫斯科），可以轻松地以适当的数量收取这些票。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，在我思考的同时，我从库存中取出了</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ATmega328p</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制器</font><font style="vertical-align: inherit;">，将其焊接到</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">面包板上，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并通过Arduino Mega 2560刷新了Adruino引导程序。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/7a1/8e1/1f2/7a18e11f2ab1d2216152487c55228bc4.jpg" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为方便起见，我将串行端口，重置和接地连接到单独的连接器以进行快速编程。然后我知道了自己-我将填写草图，然后一个不正确，另一个不正确。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
近焊接又和稳定3.3V为RC522误吃正是这种张力，而其余的成分普遍5V，我预计将从采取茁壮成长</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">朴实无华pauerbanka</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">电池类型18650 </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/1f6/16e/7f6/1f616e7f61cff02dbe2dee78f2676ce1.jpg" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用这样pauerbank代替的决定典型的扁平电池似乎违反直觉。但我认为，由于玩具会消耗相当大的电流（仅待机模式下的控制器和播放器会消耗约40 mA电流），因此能够用一块充满的电池快速更换空电池的功能非常有帮助。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
而且我还必须添加一个压电陶瓷高音扬声器，以指示某些事件（例如读卡）。您说的这通常很有趣-有位发言人，对吗？好吧，不是。毕竟，扬声器已连接到播放器，而不是控制器。他还添加了一个晶体管作为按键，可以在睡眠期间关闭MP3播放器，以减少能耗。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
细心的读者可能会注意到，播放器可以由数字控制器引脚供电，此引脚在打开和关闭时都表现出色。我自己想要，但仅在待机模式下播放器才会消耗16 mA电流。音乐播放时，轻松消耗100 mA以上的电流，这已经是ATmega容量的至少两倍。因此，我采用集电极电流为300 mA的“任何” npn晶体管，并通过一个约200欧姆的电阻将其带到控制器的数字引脚。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是读卡器消耗的电流在40 mA以内，因此为它供电的稳定器可以连接到控制器的数字引脚。他这样做了，但还是没用，最后还是没用。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
另一个这样的观点：玩家需要一个动态头，其电阻至少为8欧姆。我有一个（系统单元中的扬声器），但是她的声音不是很好。也有一个电阻为4欧姆的扬声器（来自典型的中国扬声器）。总的来说，我将两者串联：一个给出更高的电平，另一个给出低电平，它们在一起听起来很酷。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仍然是一件小事灵魂的镜子。这是最容易由串联连接的一对LED制成的。我没有采取残酷的红色-这非常可怕。但是眼睛是琥珀色的-就是这样。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，玩具的模型被组装和调试。现在最重要的是：您需要一个供体。其实我真的很想</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">说话的鸟</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是从邻近玩具的价格来看，这种乐趣并不完全是预算。特别是当您认为孩子的兴趣是不可预测的事情时。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，首先，我开始寻找负担得起的移植对象。其中一个被发现：</font><font style="vertical-align: inherit;">在儿童世界出售</font><font style="vertical-align: inherit;">的迷人的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">刺猬伊芙琳</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/0b5/e51/e8f/0b5e51e8f536d2fbb1b1316a8a452973.jpg" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，我不得不几乎完全摆脱了刺猬的丰富内心世界。并用装在普通肥皂盒中的自制肥皂代替。但是，不是很普通。事实是，与许多肥皂盒不同的是，该肥皂盒的背面很平整，因此在其中放置读卡器很方便-您的距离很小。另一方面，肥皂盒带有按摩刷之类的东西，甚至有孔，即扬声器放置在理想​​的位置：声音会通过开口散发出来，而不会被按摩钉堵塞。但是，这些孔还不够，但这并不重要-我仍然在钻。</font></font><br>
<br>
<img src="https://habrastorage.org/files/bcd/a1c/4a8/bcda1c4a8ad44044821c32d684ff0458.JPG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我必须承认，最困难的事情是刺猬的手术。首先，我不喜欢缝制。而且我必须得体：首先将它撕开，然后系紧边缘，然后缝制六个纽扣。然后他松开了六个纽扣，缝了四个纽扣。为何全部？因为起初我缝的是小错误的，所以刺猬被解开了。</font></font><br>
<br>
<img src="https://habrastorage.org/files/e04/0f1/091/e040f109159d4759b34e6c92aea4fe98.JPG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其次，眼睛。当然，我谨慎地购买了直径为3 mm的LED，以便可以保证它们能够描绘瞳孔。但是，在刺猬伊芙琳的眼睛上钻洞并不是那么容易。似乎：您拿着一个雕刻机，在其中放上正确的钻头-然后继续。但是事实证明，在钻孔过程中，塑料变成了粘性物质，弱雕刻机的钻头被卡紧了。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
而且，我必须说，刺猬从他的眼睛里伸出来的刺猬是一副地狱般的奇观。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
顺便说一句，我什至不知道该如何建议。我以某种方式扭曲并仍然打孔，在其中插入LED并填充环氧树脂，并在顶部覆盖无色指甲油。眼睛也被环氧树脂粘在了刺猬身上，因为原始的坐骑在钻孔过程中死亡了。结果并不完美，但可以忍受。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您已经看到了刺猬的工作方式。因此，我只能复制其当前逻辑的文本。最初，刺猬处于睡眠模式。如果捡起它（或只是移动它，或移动它所在的表面等），它将被中断唤醒，并产生振动传感器。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
之后，在预定的时间间隔内，刺猬会说出预定义的短语，如果您一段时间未触摸刺猬，他将再次入睡。而且，如果您触摸它，它也不会入睡。如果将其摇晃一会儿，它将开始讲述一个童话故事，是随机选择的。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您将卡片带到刺猬（当他不睡觉时），那么刺猬将开始讲述与此卡片相关的故事。没有固定的约束，替换童话时顺序会改变。仅固定了两个服务卡：用于调节音量和强行安抚刺猬。顺便说一下，音量是通过依次切换三个步骤（安静-中等-大声）来调节的。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
至于琥珀色的眼睛，当刺猬醒来时它们眨眼两次（一个周期），但是当刺猬讲述童话故事时它们保持沉默并改变亮度。在我看来，这是最好的选择。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在组装过程中，我尝试了另一项创新：由于移动电源具有两个连接器（输入和输出），因此将现有的Qi无线充电适配器连接至输入。因此，事实证明，要给刺猬充电，根本不需要解开它-只需将其放在无线充电器上过夜即可。但是，仅此功能仍处于测试模式。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
总的来说，尽管表面上看起来很简单，但仍有一些事情使我感到困惑。例如，从代码中，您可以注意到我连续几次向播放器发送一些命令，甚至在最后放置一个超时。所有这些都是因为实际上在我的配置中，这是唯一可行的方法。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
还可以看到，由于某种原因，我是通过播放器的硬件信号控制播放结束的，而不是通过简单的命令仅打开一个文件的播放模式。这也不只是这样：出于某种原因，此模式对我不起作用，因此当一首歌曲结束时，播放器将开始播放下一首歌曲。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
似乎更奇怪的是，用于播放随机乐曲的随机函数不断循环，而不是仅在确实需要时才调用。但这就是问题：如果仅在需要时才调用它，则由于某种原因，在大多数情况下，它会返回相同的值。但是，如果放入循环，则会生成真正的伪随机值。实际上，当我试图了解刺猬的不当行为时，我也在实践中发现了。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最后，令我完全困惑的是无法应对使用控制器的数字引脚关闭读卡器的工作，而读卡器由控制器的数字引脚供电。出于某种原因，事实证明，如果将引脚设置为LOW，然后设置为INPUT，则读取器不会关闭。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同时，如果您仅将LOW设置为低，则读卡器的LED完全“点亮”，为读卡器供电的稳定器输出端的电压约为1伏。如果然后在控制器引脚上进行INPUT，则该电压将上升到大约3V。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
更有趣的是，如果您首先将连接到阅读器的SS和RST的控制器引脚设置为LOW和INPUT，然后将控制器的电源引脚切换到相同位置，则阅读器将关闭。而且即使电源引脚转移到OUTPUT和HIGH位置，睡眠后它也会打开。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，定时器会发生无法弥补的事情。也就是说，我认为是这样，因为经过这样的假想（关闭读者的睡眠）后，眼睛和摇动计数器无法正常工作，并且这两个过程都与millis（）有关。我不知道发生了什么以及如何恢复计时器，因此我将其保持原状-读卡器即使在睡眠期间也可以继续吃饭。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果资深同志们帮助我们找到一条出路，我将不胜感激。尽管我几乎不相信老同志会读到这个地方。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
鉴于上述情况，Evelyn的刺猬代码完全不完善，但是您可以随时对其进行梳理（代码或刺猬-自行选择），优化，补充，减少或以其他方式适应您的需求。</font><font style="vertical-align: inherit;">这就是为什么我要附加它。</font><font style="vertical-align: inherit;">为了更容易使用，设置的最大值（我尝试了所有方法，但照常进行）不是在代码中，而是在变量定义部分。</font><font style="vertical-align: inherit;">有一个引脚配置，时间延迟和磁道数量。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在描述卡号的部分中，应该理解，最后两张卡始终“保留”用于内部功能-切换音量和睡眠模式。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行动方案</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*  A0 -   MP3 (  )
 *  pin 0, 1 -   ()
 *  pin 2 -   
 *  pin 4 -   MP3 ( )
 *  pin 5 - 
 *  pin 6 -  
 *  pin 7, 8 -  MP3
 *  pin 9 -  
 *  pin 10 -  
 *  pin 11, 12, 13 - SPI 
 */</span></span> <font></font>
<font></font>
<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Arduino.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SoftwareSerial.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;JQ6500_Serial.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;avr/pgmspace.h&gt; //  PROGMEM</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SPI.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;MFRC522.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;avr/sleep.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;avr/power.h&gt;</span></span></span></span><font></font>
<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> adc_disable() (ADCSRA &amp;= ~(1&lt;&lt;ADEN)) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// disable ADC (before power-off) </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> adc_enable() (ADCSRA |= (1&lt;&lt;ADEN)) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// re-enable ADC</span></span></span></span><font></font>
<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> RST_PIN 9</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> SS_PIN 10</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> mp3Pin 4</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> mp3Busy A0</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> readerPin 6</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> tonePin 5</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ledPin 3</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> offDelay 70000 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//  </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> winkStep 1500 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//   </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> on 150 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//  ""</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> off 80 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//  ""</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> tOut1 0 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//         (x - / x1 -  )</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> tOut11 500</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> tOut2 14000</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> tOut21 15000</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> tOut3 29000</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> tOut31 30000</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> tOut4 44000</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> tOut41 45000</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> tOut5 60000</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> tOut51 65000</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> tShake 2000 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//     </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> nShakeQ 10 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//     </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> introQ 5 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//  -</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> minVol 18 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//  </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> midVol  22 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//  </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> maxVol 25 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//  </span></span></span></span><font></font>
<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> dimDelay, winkStepDelay, onDelay, ledOffDelay, tShakeDelay;<font></font>
boolean ledOn, ledOff, eyes, pwm;<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> wink;
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pwmVal;<font></font>
<font></font>
boolean playON = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;<font></font>
boolean pwmUp = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;<font></font>
byte pwmStep = <span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> playFile;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-function">MFRC522 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mfrc522</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SS_PIN, RST_PIN)</span></span></span></span>;       <span class="hljs-comment"><span class="hljs-comment">//  MFRC522</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> uidDec, uidDecTemp; <span class="hljs-comment"><span class="hljs-comment">//       </span></span><font></font>
byte bCounter, readBit, nShake, rnd;<font></font>
byte vol = midVol; <span class="hljs-comment"><span class="hljs-comment">//     </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ticketNumber;
<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> offTimeOut = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
boolean mp3ON = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
boolean isInt = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
<font></font>
byte ticketQ = <span class="hljs-number"><span class="hljs-number">32</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     (  -  )</span></span>
byte fileQ = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  MP3-</span></span><font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//    (  ,    ),         .   ,    </span></span>
PROGMEM <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> ticketSet[]  = {<span class="hljs-number"><span class="hljs-number">2515217196</span></span>, <span class="hljs-number"><span class="hljs-number">2540548337</span></span>, <span class="hljs-number"><span class="hljs-number">2490970856</span></span>, <span class="hljs-number"><span class="hljs-number">2486466332</span></span>, <span class="hljs-number"><span class="hljs-number">2485920633</span></span>, <span class="hljs-number"><span class="hljs-number">35870611</span></span>, <span class="hljs-number"><span class="hljs-number">37836807</span></span>, <span class="hljs-number"><span class="hljs-number">37836806</span></span>, <span class="hljs-number"><span class="hljs-number">2377004330</span></span>, <span class="hljs-number"><span class="hljs-number">2522873668</span></span>, <span class="hljs-number"><span class="hljs-number">2514304566</span></span>, <span class="hljs-number"><span class="hljs-number">23472725</span></span>, <span class="hljs-number"><span class="hljs-number">2485702426</span></span>, <span class="hljs-number"><span class="hljs-number">2374853555</span></span>, <span class="hljs-number"><span class="hljs-number">2374391583</span></span>, <span class="hljs-number"><span class="hljs-number">2492957469</span></span>, <span class="hljs-number"><span class="hljs-number">2486467162</span></span>, <span class="hljs-number"><span class="hljs-number">2489280075</span></span>, <span class="hljs-number"><span class="hljs-number">2488031661</span></span>, <span class="hljs-number"><span class="hljs-number">2491726641</span></span>, <span class="hljs-number"><span class="hljs-number">2491720188</span></span>, <span class="hljs-number"><span class="hljs-number">2490968782</span></span>, <span class="hljs-number"><span class="hljs-number">2490968783</span></span>, <span class="hljs-number"><span class="hljs-number">2488900952</span></span>, <span class="hljs-number"><span class="hljs-number">2489969016</span></span>, <span class="hljs-number"><span class="hljs-number">2506562651</span></span>, <span class="hljs-number"><span class="hljs-number">2375447052</span></span>, <span class="hljs-number"><span class="hljs-number">2375449579</span></span>, <span class="hljs-number"><span class="hljs-number">2489276180</span></span>, <span class="hljs-number"><span class="hljs-number">2483389692</span></span>, <span class="hljs-number"><span class="hljs-number">2486466331</span></span>, <span class="hljs-number"><span class="hljs-number">2484789326</span></span>};<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-function">JQ6500_Serial </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mp3</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">8</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">7</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//  </span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">enterSleep</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
</span></span>{<font></font>
 mp3.playFileNumberInFolderNumber(<span class="hljs-number"><span class="hljs-number">01</span></span>, <span class="hljs-number"><span class="hljs-number">005</span></span>); <span class="hljs-comment"><span class="hljs-comment">// -</span></span>
 mp3.playFileNumberInFolderNumber(<span class="hljs-number"><span class="hljs-number">01</span></span>, <span class="hljs-number"><span class="hljs-number">005</span></span>); <span class="hljs-comment"><span class="hljs-comment">// -</span></span>
 delay(<span class="hljs-number"><span class="hljs-number">2500</span></span>);<font></font>
 tone(tonePin, <span class="hljs-number"><span class="hljs-number">800</span></span>, <span class="hljs-number"><span class="hljs-number">500</span></span>);<font></font>
 delay(<span class="hljs-number"><span class="hljs-number">500</span></span>); <font></font>
 digitalWrite(readerPin, LOW); <font></font>
 digitalWrite(mp3Pin, LOW);<font></font>
 digitalWrite(ledPin, LOW);<font></font>
 pinMode(ledPin, INPUT);<font></font>
 pinMode(readerPin, INPUT);<font></font>
 pinMode(mp3Pin, INPUT);<font></font>
 <font></font>
  adc_disable();<font></font>
<font></font>
  set_sleep_mode(SLEEP_MODE_PWR_DOWN);<font></font>
  <font></font>
  sleep_enable();<font></font>
  <font></font>
  sleep_mode();<font></font>
  <font></font>
 sleep_disable();<font></font>
 power_all_enable();<font></font>
<font></font>
 adc_enable();<font></font>
 tone(tonePin, <span class="hljs-number"><span class="hljs-number">450</span></span>, <span class="hljs-number"><span class="hljs-number">500</span></span>);<font></font>
 pinMode(ledPin, OUTPUT);<font></font>
 pinMode(readerPin, OUTPUT);<font></font>
 pinMode(mp3Pin, OUTPUT);<font></font>
 digitalWrite(ledPin, LOW);<font></font>
 digitalWrite(readerPin, HIGH); <font></font>
 digitalWrite(mp3Pin, HIGH);<font></font>
 SPI.begin();            <span class="hljs-comment"><span class="hljs-comment">//  SPI</span></span>
 mfrc522.PCD_Init();     <span class="hljs-comment"><span class="hljs-comment">//  MFRC522</span></span><font></font>
 mp3Init();<font></font>
 offTimeOut = millis();<font></font>
 ledOffDelay = millis();<font></font>
 mp3.playFileNumberInFolderNumber(<span class="hljs-number"><span class="hljs-number">01</span></span>, <span class="hljs-number"><span class="hljs-number">001</span></span>); <span class="hljs-comment"><span class="hljs-comment">// -</span></span>
 mp3.playFileNumberInFolderNumber(<span class="hljs-number"><span class="hljs-number">01</span></span>, <span class="hljs-number"><span class="hljs-number">001</span></span>); <span class="hljs-comment"><span class="hljs-comment">// -</span></span>
 delay(<span class="hljs-number"><span class="hljs-number">500</span></span>);<font></font>
 playON = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <font></font>
 mp3ON = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wakeUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
   detachInterrupt(<span class="hljs-number"><span class="hljs-number">0</span></span>);<font></font>
   ledOffDelay = millis();<font></font>
   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isInt == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
    isInt = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;<font></font>
   }<font></font>
   attachInterrupt(<span class="hljs-number"><span class="hljs-number">0</span></span>, wakeUp, LOW); <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
  pinMode(<span class="hljs-number"><span class="hljs-number">2</span></span>, INPUT_PULLUP);<font></font>
  attachInterrupt(<span class="hljs-number"><span class="hljs-number">0</span></span>, wakeUp, LOW);<font></font>
  pinMode(readerPin, OUTPUT);  <font></font>
  digitalWrite(readerPin, HIGH);<font></font>
  SPI.begin();            <span class="hljs-comment"><span class="hljs-comment">//  SPI</span></span>
  mfrc522.PCD_Init();     <span class="hljs-comment"><span class="hljs-comment">//  MFRC522</span></span><font></font>
  pinMode(mp3Pin, OUTPUT);<font></font>
  mp3Init();<font></font>
  pinMode(ledPin, OUTPUT);<font></font>
  digitalWrite(ledPin, LOW);<font></font>
  eyes = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;<font></font>
  ledOn = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;<font></font>
  ledOff = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;<font></font>
  dimDelay = millis();<font></font>
  winkStepDelay = millis();<font></font>
  wink = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
  pwmUp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    </span></span>
  pwmVal = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
  ledOffDelay = millis();<font></font>
  offTimeOut = millis();  <font></font>
  mp3.playFileNumberInFolderNumber(<span class="hljs-number"><span class="hljs-number">01</span></span>, <span class="hljs-number"><span class="hljs-number">001</span></span>); <span class="hljs-comment"><span class="hljs-comment">// -</span></span>
  mp3.playFileNumberInFolderNumber(<span class="hljs-number"><span class="hljs-number">01</span></span>, <span class="hljs-number"><span class="hljs-number">001</span></span>); <span class="hljs-comment"><span class="hljs-comment">// -</span></span>
  delay(<span class="hljs-number"><span class="hljs-number">500</span></span>);<font></font>
  playON = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <font></font>
  mp3ON = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
<font></font>
rnd = random(<span class="hljs-number"><span class="hljs-number">1</span></span>, fileQ<span class="hljs-number"><span class="hljs-number">-1</span></span>);<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((millis() - offTimeOut) &gt; offDelay) { <span class="hljs-comment"><span class="hljs-comment">//  </span></span><font></font>
<font></font>
     enterSleep();<font></font>
<font></font>
 } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <font></font>
<font></font>
 ledWink(); <span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
<font></font>
<font></font>
 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isInt == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) {<font></font>
  <font></font>
  offTimeOut = millis(); <span class="hljs-comment"><span class="hljs-comment">//    -  ,    </span></span><font></font>
<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nShake == <span class="hljs-number"><span class="hljs-number">0</span></span>) {<font></font>
    tShakeDelay = millis();<font></font>
  }<font></font>
  <font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((millis() - tShakeDelay) &lt; tShake){<font></font>
    nShake = nShake + <span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
  } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<font></font>
    tShakeDelay = millis();<font></font>
    nShake = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
  }<font></font>
<font></font>
   isInt = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;<font></font>
 }<font></font>
<font></font>
 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nShake &gt; nShakeQ) {<font></font>
  playRandom();<font></font>
  nShake = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
 }<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//    </span></span><font></font>
<font></font>
playPreset(); <span class="hljs-comment"><span class="hljs-comment">//     </span></span><font></font>
<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mp3ON == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) {<font></font>
   <font></font>
   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (playON == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//  ,   </span></span>
    offTimeOut = millis(); <span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
   }<font></font>
<font></font>
   nShake = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
<font></font>
   eyesPWM(); <span class="hljs-comment"><span class="hljs-comment">//  </span></span><font></font>
   <font></font>
<font></font>
    <span class="hljs-comment"><span class="hljs-comment">//  MP3</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(analogRead(mp3Busy) &lt; <span class="hljs-number"><span class="hljs-number">250</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//    -  ,  </span></span>
     mp3ON = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <font></font>
     playON = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;<font></font>
     digitalWrite(ledPin, LOW);<font></font>
    }<font></font>
  }<font></font>
  <font></font>
 scanPlay(); <span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
 <font></font>
 }<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setBitsForGood</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(byte daBeat)</span></span></span><span class="hljs-function"> </span></span>{<font></font>
<font></font>
<font></font>
  <font></font>
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (daBeat == <span class="hljs-number"><span class="hljs-number">1</span></span>) {<font></font>
                bitSet(ticketNumber, bCounter);<font></font>
                bCounter=bCounter+<span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
                }<font></font>
        <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<font></font>
                bitClear(ticketNumber, bCounter);<font></font>
                bCounter=bCounter+<span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
        }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//    MP3</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mp3Init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
  digitalWrite(mp3Pin, HIGH);<font></font>
  delay(<span class="hljs-number"><span class="hljs-number">100</span></span>);<font></font>
  mp3.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>);<font></font>
  mp3.reset();<font></font>
  mp3.setVolume(vol);<font></font>
  mp3.setLoopMode(MP3_LOOP_NONE);<font></font>
<font></font>
  fileQ = mp3.countFiles(MP3_SRC_SDCARD); <span class="hljs-comment"><span class="hljs-comment">//    </span></span>
  fileQ = fileQ - introQ; <span class="hljs-comment"><span class="hljs-comment">//  </span></span><font></font>
<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">playRandom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
   tone(tonePin, <span class="hljs-number"><span class="hljs-number">450</span></span>, <span class="hljs-number"><span class="hljs-number">500</span></span>);<font></font>
   delay(<span class="hljs-number"><span class="hljs-number">500</span></span>);  <font></font>
   playFile = rnd;<font></font>
   mp3ON = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;<font></font>
   playON = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;<font></font>
   mp3.playFileByIndexNumber(playFile);<font></font>
   mp3.playFileByIndexNumber(playFile);<font></font>
   mp3.playFileByIndexNumber(playFile);  <font></font>
   delay(<span class="hljs-number"><span class="hljs-number">500</span></span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">// </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ledWink</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
<font></font>
 <span class="hljs-comment"><span class="hljs-comment">//     </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((millis() - winkStepDelay) &gt; winkStep) { <span class="hljs-comment"><span class="hljs-comment">//  </span></span><font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">// </span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eyes == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ledOn == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) {<font></font>
      onDelay = millis(); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
        ledOn = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ,   </span></span><font></font>
    }<font></font>
 <font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((millis() - onDelay) &gt; on) { <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
      digitalWrite(ledPin, LOW); <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
      eyes = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
    }<font></font>
<font></font>
  }<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">// </span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eyes == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
    <font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ledOff == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) {<font></font>
      ledOffDelay = millis(); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
        ledOff = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ,   </span></span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((millis() - ledOffDelay) &gt; off) { <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
      digitalWrite(ledPin, HIGH); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
      eyes = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ledOn == <span class="hljs-literal"><span class="hljs-literal">true</span></span> &amp;&amp; ledOff == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//    (  /)</span></span>
    wink = wink+<span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
    ledOn = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;<font></font>
    ledOff = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;    <font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (wink == <span class="hljs-number"><span class="hljs-number">4</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//   /</span></span><font></font>
     winkStepDelay = millis();<font></font>
     wink = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
 }<font></font>
<font></font>
 }<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//     </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">playPreset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
<font></font>
 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mp3ON == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) {<font></font>
  <font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((millis() - offTimeOut) &gt; tOut2 &amp;&amp; (millis() - offTimeOut) &lt; tOut21) {<font></font>
    mp3.playFileNumberInFolderNumber(<span class="hljs-number"><span class="hljs-number">01</span></span>, <span class="hljs-number"><span class="hljs-number">002</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   /001/002.mp3      tOut21 .</span></span>
    mp3ON = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <font></font>
    delay(<span class="hljs-number"><span class="hljs-number">500</span></span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((millis() - offTimeOut) &gt; tOut3 &amp;&amp; (millis() - offTimeOut) &lt; tOut31) {<font></font>
    mp3.playFileNumberInFolderNumber(<span class="hljs-number"><span class="hljs-number">01</span></span>, <span class="hljs-number"><span class="hljs-number">003</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   /001/003.mp3      tOut31 .</span></span>
    mp3ON = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;<font></font>
    delay(<span class="hljs-number"><span class="hljs-number">500</span></span>);<font></font>
   }  <font></font>
<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((millis() - offTimeOut) &gt; tOut4 &amp;&amp; (millis() - offTimeOut) &lt; tOut41) {<font></font>
    mp3.playFileNumberInFolderNumber(<span class="hljs-number"><span class="hljs-number">01</span></span>, <span class="hljs-number"><span class="hljs-number">004</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   /001/004.mp3      tOut41 .</span></span>
    mp3ON = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;  <font></font>
    delay(<span class="hljs-number"><span class="hljs-number">500</span></span>); <font></font>
  }    <font></font>
<font></font>
    <font></font>
 }<font></font>
  <font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">// </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eyesPWM</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{<font></font>
<font></font>
 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((millis() - winkStepDelay) &gt; (pwmStep)/<span class="hljs-number"><span class="hljs-number">4</span></span>) {
   <span class="hljs-comment"><span class="hljs-comment">//     MP3 </span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pwmUp == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) {
      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pwmVal &lt; <span class="hljs-number"><span class="hljs-number">128</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//   254 -    (    255,      )</span></span><font></font>
        analogWrite(ledPin, pwmVal);<font></font>
        pwmVal = pwmVal + <span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
        pwmStep = pwmStep - <span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
        winkStepDelay = millis();<font></font>
      } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<font></font>
            pwmUp = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;<font></font>
            pwmStep = <span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
            pwmVal = <span class="hljs-number"><span class="hljs-number">128</span></span>;<font></font>
      } <font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pwmUp == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) {
      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pwmVal &gt; pwmStep) {<font></font>
        analogWrite(ledPin, pwmVal);<font></font>
        pwmVal = pwmVal - <span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
        pwmStep = pwmStep +<span class="hljs-number"><span class="hljs-number">1</span></span> ;<font></font>
        winkStepDelay = millis();<font></font>
      } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<font></font>
            pwmUp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;<font></font>
            pwmStep = <span class="hljs-number"><span class="hljs-number">128</span></span>;<font></font>
            pwmVal = <span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
      } <font></font>
    }<font></font>
    }<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scanPlay</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
<font></font>
 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fileQ &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) {
          <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ! mfrc522.PICC_IsNewCardPresent()) {
                <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ! mfrc522.PICC_ReadCardSerial()) {
                <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;<font></font>
        }<font></font>
<font></font>
        uidDec = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   ,   </span></span><font></font>
<font></font>
        byte status;<font></font>
        byte byteCount;<font></font>
        byte buffer[<span class="hljs-number"><span class="hljs-number">18</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//   (16  + 2   ) </span></span>
        byte pages[<span class="hljs-number"><span class="hljs-number">2</span></span>]={<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>}; <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
        byte pageByte; <span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
        <font></font>
        byteCount = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(buffer);<font></font>
        byte bCount=<span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
                <font></font>
<font></font>
        mfrc522.MIFARE_Read(<span class="hljs-number"><span class="hljs-number">4</span></span>, buffer, &amp;byteCount);<font></font>
        <font></font>
          <font></font>
                                bCounter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// 32-   </span></span><font></font>
                                <font></font>
                                <span class="hljs-comment"><span class="hljs-comment">//  0-3</span></span>
                                <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (bCount=<span class="hljs-number"><span class="hljs-number">0</span></span>; bCount&lt;<span class="hljs-number"><span class="hljs-number">4</span></span>; bCount++) {<font></font>
                                        readBit = bitRead(buffer[<span class="hljs-number"><span class="hljs-number">6</span></span>], (bCount+<span class="hljs-number"><span class="hljs-number">4</span></span>));<font></font>
                                        setBitsForGood(readBit);<font></font>
                                }<font></font>
<font></font>
                                <span class="hljs-comment"><span class="hljs-comment">//  4 - 27</span></span>
                                <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (pageByte=<span class="hljs-number"><span class="hljs-number">5</span></span>; pageByte &gt; <span class="hljs-number"><span class="hljs-number">2</span></span>; pageByte--) {
                                        <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (bCount=<span class="hljs-number"><span class="hljs-number">0</span></span>; bCount&lt;<span class="hljs-number"><span class="hljs-number">8</span></span>; bCount++) {<font></font>
                                                readBit = bitRead(buffer[pageByte], bCount);<font></font>
                                                setBitsForGood(readBit);<font></font>
                                        }<font></font>
                                }<font></font>
<font></font>
                                <span class="hljs-comment"><span class="hljs-comment">//  28-31</span></span>
                                <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (bCount=<span class="hljs-number"><span class="hljs-number">0</span></span>; bCount&lt;<span class="hljs-number"><span class="hljs-number">4</span></span>; bCount++) {<font></font>
                                        readBit = bitRead(buffer[<span class="hljs-number"><span class="hljs-number">2</span></span>], bCount);<font></font>
                                        setBitsForGood(readBit);<font></font>
                                }<font></font>
<font></font>
                               <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (byte ticketNum = <span class="hljs-number"><span class="hljs-number">0</span></span>; ticketNum &lt; ticketQ; ticketNum++) {
                                <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ticketTemp = pgm_read_dword_near(ticketSet + ticketNum);
                                <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ticketTemp == ticketNumber) {<font></font>
                                  tone(tonePin, <span class="hljs-number"><span class="hljs-number">450</span></span>, <span class="hljs-number"><span class="hljs-number">500</span></span>);<font></font>
                                  delay(<span class="hljs-number"><span class="hljs-number">500</span></span>); 
                                  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ticketNum &lt; (ticketQ - <span class="hljs-number"><span class="hljs-number">2</span></span>)) {
                                    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((ticketNum+<span class="hljs-number"><span class="hljs-number">1</span></span>) &lt; fileQ) {<font></font>
                                      digitalWrite(ledPin, HIGH);<font></font>
                                       playFile = ticketNum+<span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
                                      mp3ON = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;<font></font>
                                      playON = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;<font></font>
                                      mp3.playFileByIndexNumber(playFile);<font></font>
                                      mp3.playFileByIndexNumber(playFile);<font></font>
                                      mp3.playFileByIndexNumber(playFile);<font></font>
                                      delay(<span class="hljs-number"><span class="hljs-number">500</span></span>);<font></font>
                                      }<font></font>
                                      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;<font></font>
                                  } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {
                                    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ticketNum == ticketQ<span class="hljs-number"><span class="hljs-number">-1</span></span>) {<font></font>
                                      enterSleep(); <span class="hljs-comment"><span class="hljs-comment">// </span></span><font></font>
                                    }<font></font>
                                    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ticketNum == ticketQ<span class="hljs-number"><span class="hljs-number">-2</span></span>) {<font></font>
                                      setVol(); <span class="hljs-comment"><span class="hljs-comment">//  </span></span><font></font>
                                    }<font></font>
                                  }<font></font>
                                  <font></font>
                                }<font></font>
                               }<font></font>
                        <span class="hljs-comment"><span class="hljs-comment">// }</span></span><font></font>
                <font></font>
        <span class="hljs-comment"><span class="hljs-comment">// Halt PICC</span></span><font></font>
    mfrc522.PICC_HaltA();    <font></font>
<font></font>
<font></font>
  }<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//    </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setVol</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (vol) {
    <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> maxVol:<font></font>
      vol = minVol;<font></font>
      <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;
    <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> midVol:<font></font>
      vol = maxVol;<font></font>
      <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;
    <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> minVol:<font></font>
      vol = midVol;<font></font>
      <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;<font></font>
  } <font></font>
<font></font>
  mp3.setVolume(vol);<font></font>
  <font></font>
}<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
由代码大致还原的图应如下所示（如果错误仍然存​​在，我深表歉意）：</font></font><br>
<br>
<img src="https://habrastorage.org/files/edd/eb1/edf/eddeb1edff2442ee96801a317da303a8.jpg"><br>
<br>
<img src="https://habrastorage.org/files/d7f/314/529/d7f314529f8642af8e48e8ef38b20693.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这里：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">U1 = ATmega328p</font></font></li>
<li>UHT7333 = HT7333</li>
<li> C1 = 0,1 </li>
<li> R2 = ~50 </li>
<li> R3 = 220 </li>
<li> R4 = 1 </li>
<li>M1 = </li>
<li> R4 = 1 </li>
<li>SP1 =  8 </li>
<li>Piezo =  </li>
<li>T1 =  NPN-      0,3</li>
<li>U2 = JQ6500   : 1 — TX, 2 — RX, 3 — GND, 4 — VCC, 5 — BUSY, 6 — SPK+, 7 — SPK -</li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
哈伯斯·希</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">金</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font><font style="vertical-align: inherit;">Habrauser </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link"><font style="vertical-align: inherit;">Chigin）</font></a><font style="vertical-align: inherit;">对此   </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link"><font style="vertical-align: inherit;">深表感谢</font></a><font style="vertical-align: inherit;">，他的</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link"><font style="vertical-align: inherit;">成就</font></a><font style="vertical-align: inherit;">显着改善，使所有经济状况井然有序。</font><font style="vertical-align: inherit;">但是请注意，PNP晶体管已经在这里，并且播放器的电源管理必须反转（即，通过此连接，播放器将控制器引脚的低电平打开，然后关闭-高电平）：</font></font><br>
<br>
<img src="https://habrastorage.org/files/6dc/277/fea/6dc277fea79e4e0cb7da519abd15519b.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在当前配置下，容量约为2500 mAh的电池可持续使用一天用刺猬。</font><font style="vertical-align: inherit;">不必多说，但是您需要了解时间表总是不同的，我希望大部分精力都花在主动模式下。</font><font style="vertical-align: inherit;">在某种程度上，这使我们可以忽略所有刺猬电子产品完全无法进入睡眠的失败。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您在计算近似预算时遇到麻烦，则会得到以下信息（以美元为单位）：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">球员：8.9</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ATmega328p：1.1</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发板：0.28</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读者RC522：2.21</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态头：0.99</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">压电陶瓷发射器：0.77</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LED：0.12</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">晶体管：0.14</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">稳定剂：0.13</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">震动感应器：0.13</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">肥皂盘：0.99</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行动电源：0.75</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18650电池：3.9</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qi充电适配器：1.65</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储卡：3</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">刺猬伊芙琳：6</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
总计31.06，但实际上更多，因为您仍然需要使用电线进行连接以及诸如热熔胶，双面胶带和蓝色电工胶带之类的其他小物件。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可能必须有某种特别重要的最后一句话，但我绝对不知道。</font><font style="vertical-align: inherit;">可以说孩子对玩具很满意，这肯定比打开笔记本电脑更好（通常更快）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ps。</font><font style="vertical-align: inherit;">我知道蓝牙扬声器，即使您放了一只如此可爱的刺猬，也有所不同。</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN395423/">https://habr.com/ru/post/zh-CN395423/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt486150/index.html">Desenvolvimento da esfera de TI na Eslováquia. Benefícios de trabalho para jovens profissionais</a></li>
<li><a href="../pt486156/index.html">Como eu ensinei, e depois escrevi um manual de treinamento em Python</a></li>
<li><a href="../pt486158/index.html">Visualização da tradução automática neural (modelos seq2seq com mecanismo de atenção)</a></li>
<li><a href="../pt486164/index.html">Coronavírus 2019-nCoV. Perguntas frequentes sobre proteção respiratória e desinfecção</a></li>
<li><a href="../pt486174/index.html">Tenho rotatividade zero</a></li>
<li><a href="../zh-CN395425/index.html">美国宇航局宣布X-57麦克斯韦电动飞机</a></li>
<li><a href="../zh-CN395429/index.html">《文明五》将用于学校教学</a></li>
<li><a href="../zh-CN395431/index.html">6月联发科实验室免费网络研讨会</a></li>
<li><a href="../zh-CN395433/index.html">2015年，移民进行的国际转移金额创下了历史新高</a></li>
<li><a href="../zh-CN395435/index.html">Twitter购买了Magic Pony神经网络以增强图像和视频</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>