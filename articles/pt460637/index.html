<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôÜ ‚öñÔ∏è ‚ÜïÔ∏è Controle de luz no ZigBee üë®üèª‚Äçüè´ üôçüèª üôèüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° amigos! Hoje, quero falar sobre um desenvolvimento interessante de um sistema de controle remoto de ilumina√ß√£o. 



 Uma casa moderna √© um grande ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Controle de luz no ZigBee</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460637/">  Ol√° amigos!  Hoje, quero falar sobre um desenvolvimento interessante de um sistema de controle remoto de ilumina√ß√£o. <br><br><img src="https://habrastorage.org/webt/ro/yx/l6/royxl62-z2oqpfn6hwt5izou3_y.jpeg" alt="imagem"><br><br>  Uma casa moderna √© um grande n√∫mero de fios para, pelo menos de alguma forma, reduzir e agilizar seu n√∫mero de r√°dios em socorro.  Na realidade, esse sistema n√£o √© novo, mas, no contexto de um or√ßamento limitado, foi totalmente recompensado. <br><br>  No futuro, quero mostrar imediatamente o diagrama funcional do sistema de controle. <br><br><img src="https://habrastorage.org/webt/fh/ey/gj/fheygj8s-fn_phg3oqnva6ajrye.jpeg" alt="imagem"><br>  <i>Fig.</i>  <i>1</i> <br><br>  Estou interessado em algu√©m sob gato. <br><a name="habracut"></a><br>  A quest√£o l√≥gica √© por que tudo isso √© necess√°rio?  O uso de um sistema de controle de luz sem fio fornece: <br><br><ul><li>  Reduzindo o n√∫mero de fios que v√£o de cada comutador para a caixa de jun√ß√£o na sala. </li><li>  Possibilidade de implementar switches walk-through. </li><li>  A flexibilidade de controlar qualquer carga de qualquer chave, bem como o uso de bot√µes normalmente abertos normalmente fechados. </li><li>  A capacidade de implementar qualquer atraso de tempo para opera√ß√£o on / off. </li></ul><br>  A tarefa t√©cnica, no come√ßo, era apenas em palavras e parecia muito enlameada e incompreens√≠vel.  O ponto √© que, em uma casa de dois andares com uma √°rea de 208 m¬≤, √© necess√°rio controlar a ilumina√ß√£o interna de ligar / desligar, o sistema deve ser alimentado por 220v e alternar 21-23pcs.  cargas (l√¢mpadas) com uma capacidade n√£o superior a 200W.  No momento da primeira inspe√ß√£o do objeto, tudo parecia assim <br><br><img src="https://habrastorage.org/webt/cz/bi/_b/czbi_bdenvipzshelqjbmh0himq.jpeg"><br>  <i>Fig.</i>  <i>2. A parte principal das comunica√ß√µes √© colocada no ch√£o, depois √© derramada com betonilha</i> <br><br><img src="https://habrastorage.org/webt/sh/h-/7m/shh-7mxsspyefbi-nlti3wisn8m.jpeg"><br>  <i>Fig.</i>  <i>3. Local para instala√ß√£o de um arm√°rio de distribui√ß√£o no segundo andar</i> <br><br>  A forte recomenda√ß√£o era usar o menor n√∫mero poss√≠vel de fios.  Idealmente, apenas aqueles que j√° est√£o assentados no piso, paredes e teto, eles v√£o do local de instala√ß√£o do painel de distribui√ß√£o para cada l√¢mpada.  Devido √† compatibilidade eletromagn√©tica de todos os dispositivos da casa, n√£o foi recomendado o uso de wi-fi comum, porque  Existem in√∫meros dispositivos e o cliente, nesta conta, tem uma moda passageira: os dispositivos da casa come√ßar√£o a viver suas pr√≥prias vidas e o fog√£o lento inclu√≠do afetar√° a luz no banheiro ou no banheiro.  A primeira coisa que fiz foi esbo√ßar o diagrama de blocos, enquanto imagino a solu√ß√£o para esse problema.  Na fig_4 esta op√ß√£o. <br><br><img src="https://habrastorage.org/webt/80/wk/x2/80wkx2kcoelxunryvcivzi8n7e8.jpeg"><br>  <i>Fig.</i>  <i>4. Diagrama funcional do controle de ilumina√ß√£o.</i> <br><br>  A base foi tomada pelo m√≥dulo de r√°dio Texas Instruments CC2530, que suporta a tecnologia ZiegBee e √© simplesmente programado em C ++ usando o IAR-studio 5.5.  A comuta√ß√£o direta de cargas √© realizada usando os m√≥dulos de rel√© WB-MR6 (placa de arame); escolhi esse elemento porque, em um caso compacto em um trilho din, seis rel√©s com canais independentes s√£o instalados no controle 16A, todos os recursos de comuta√ß√£o de cargas de pot√™ncia de uso geral s√£o levados em considera√ß√£o em t. h  com altas correntes de partida: controle de l√¢mpadas LED, l√¢mpadas incandescentes, fontes de alimenta√ß√£o comutadas.  Al√©m disso, cada contato do rel√© √© protegido contra sobretens√£o por um varistor.  Seis desses m√≥dulos tiveram que ser instalados para gerenciar com calma um determinado n√∫mero de cargas.  Todos os WB-MR6 s√£o conectados via interface ModBus em uma √∫nica rede.  Cada m√≥dulo de rel√© √© definido como um endere√ßo correspondente ao diagrama de conex√£o, e todo o sistema com blocos de entrada, fus√≠veis e disjuntores √© bem montado em dois quadros de distribui√ß√£o SHCHMP2-1 500x400x450.  Para o posicionamento compacto dos cabos de entrada 46 3x1,5 (cobre de n√∫cleo √∫nico), era necess√°rio alterar a posi√ß√£o tradicional dos trilhos din√¢micos para vertical. <br><br><img src="https://habrastorage.org/webt/xv/fx/mn/xvfxmnadqjpt8l0wy8jtzxmaopo.jpeg"><br>  <i>Fig.</i>  <i>5. Quadro de distribui√ß√£o com coloca√ß√£o de dispositivos de controle de ilumina√ß√£o.</i> <br><br>  Deve-se notar que a fun√ß√£o incrivelmente √∫til do WB-MR6 era a capacidade de controlar sa√≠das de rel√© simplesmente conectando bot√µes normalmente abertos ao bloco de terminais inferior; √© isso que voc√™ precisa para um diagrama de fia√ß√£o tempor√°rio.  T.K.  O controle ModBus apareceu cinco meses depois, ap√≥s a montagem e instala√ß√£o dos quadros de distribui√ß√£o.  Durante esse per√≠odo, todos os cabos de cada carga foram totalmente testados e numerados.  E um esquema de comuta√ß√£o detalhado foi elaborado, com a l√≥gica de controle do comutador - a l√¢mpada na Fig_6. <br><br><img src="https://habrastorage.org/webt/59/ca/lj/59caljsa6bx9fv1bkzm6x9cgz2g.jpeg"><br>  <i>Fig.</i>  <i>6. Esquema de controle de ilumina√ß√£o e coloca√ß√£o de carga e m√≥dulos de vota√ß√£o</i> <br><br>  Quanto aos m√≥dulos de pesquisa, posso dizer o seguinte, o diagrama funcional mostrado na Fig_7 mostrou-se bastante funcional.  Praticamente n√£o havia necessidade de refazer nada, o m√≥dulo RF ss2530 permite atribuir entradas a quaisquer sa√≠das.  A √∫nica exce√ß√£o √© o UART (pin20-Tx, pin21-Rx). A maior parte da lista de elementos foi comprada em todos. Placas de circuito impresso foram encomendadas em resson√¢ncia. Soldei todas as vinte pe√ßas com as m√£os, √© dif√≠cil, demorou uma semana, n√£o deu certo imediatamente preciso.  Mas ganhou uma experi√™ncia inestim√°vel na instala√ß√£o de componentes SMD. <br><br><img src="https://habrastorage.org/webt/vv/a3/d6/vva3d686ixu6dxa3rh-fxmemqig.jpeg"><br>  <i>Fig.</i>  <i>7. Diagrama funcional do m√≥dulo de polling de bot√µes</i> <br><br>  O processo de depura√ß√£o do sistema e traz√™-lo para um estado totalmente operacional levou pouco mais de tr√™s meses.  Os primeiros passos ap√≥s a montagem das placas Rice_8, verifica√ß√£o de energia e conex√£o com o programador, foram escrever um programa de busca de bot√µes e gerar comandos de controle para os m√≥dulos de rel√© WB-MR6 atrav√©s do barramento ModBus. <br><br><img src="https://habrastorage.org/webt/zj/qq/cg/zjqqcgo-dewjpy6dpqvydmmjpu4.jpeg"><br>  <i>Fig.</i>  <i>8. M√≥dulo de pesquisa de bot√µes</i> <br><br>  Acabou bem r√°pido e f√°cil.  At√© agora, um m√≥dulo de polling de bot√£o est√° conectado a um m√≥dulo de rel√© via RS485 sem uma interface de rede.  Conseguiu imediatamente aplicar o sucesso obtido no objeto pic_9, o par tran√ßado UTP, a partir dos bot√µes localizados no quarto, foi colocado com anteced√™ncia.  Com a fixa√ß√£o dos m√≥dulos, n√£o me tornei muito inteligente, almofadas autoadesivas e grampos de pl√°stico ajudam muito. <br><br><img src="https://habrastorage.org/webt/qq/2m/f2/qq2mf2-bsvhphquu_bb_bikcajw.jpeg"><br>  <i>Fig.</i>  <i>9. Conectando m√≥dulos de polling de bot√£o.</i> <br><br>  Em seguida, ele adicionou programaticamente o endere√ßo de cada m√≥dulo, que foi configurado usando o comutador DIP e a placa de comuta√ß√£o correspondente, o modo de opera√ß√£o mestre / escravo e a transmiss√£o de comandos por r√°dio.  Um passo √† frente foi s√©rio e, portanto, houve muitas dificuldades na depura√ß√£o.  O mais grave √© a transfer√™ncia de informa√ß√µes sobre o bot√£o pressionado para o m√≥dulo mestre conectado ao barramento Modbus, logo que o protocolo de transfer√™ncia de dados em zig-bee foi ativado, tudo ficou muitas vezes mais complicado.  Para aqueles que leram at√© aqui, posso dizer que o problema era que os temporizadores no n√∫cleo do processador funcionam imprevisivelmente, mais precisamente no compilador IAR, √© necess√°rio especificar constantemente suas configura√ß√µes ao chamar o procedimento de contagem de tempo.  Para encontrar uma maneira de resolver esse problema, foram adicionadas fun√ß√µes de monitoramento e controle de dados enviados por r√°dio.  O controle de pressionar um bot√£o no modo de servi√ßo foi exibido instantaneamente no hiper-terminal do computador, que √© conectado atrav√©s do adaptador RS485-USB ao m√≥dulo de polling.  Outro problema s√©rio na organiza√ß√£o da rede de controle de ilumina√ß√£o foi o alcance inadequado da interface de r√°dio.  Mais ou menos, com confian√ßa, tudo mudou apenas dentro dos limites da tabela em que o layout foi montado.  Isso √© uma consequ√™ncia do recurso do modo de economia de energia SS2530, que assumiu a fun√ß√£o de reduzir a pot√™ncia de radia√ß√£o. Ap√≥s a forma√ß√£o do link, n√£o sei por que isso foi feito, mas foi descoberto via jtag no modo de depura√ß√£o passo a passo.  Depois de desativar esse modo, a rede come√ßou a trabalhar em apenas um andar da cabana; de fato, os comandos de ligar / desligar a luz foram processados ‚Äã‚Äãpelo servidor, somente a partir dos m√≥dulos de polling localizados em um raio de 12 a 14 m.  Desde que n√£o houvesse paredes.  Para resolver esse problema, escolhemos a maneira de substituir o m√≥dulo CC2530 por uma antena plana por um m√≥dulo por uma antena externa (com conector IPEX), ainda mais porque foi muito bem-sucedido comprar tr√™s m√≥dulos na vers√£o E18-MSI-IPX mais uma antena e cabo em uma de S√£o Petersburgo lojas online.  Tudo isso foi rapidamente soldado, os cantos para montagem das antenas foram feitos e aparafusados ‚Äã‚Äã√†s placas adaptadoras Fig_10. <br><br><img src="https://habrastorage.org/webt/es/20/je/es20jewxb7gxff5iefdsr9uzmbu.jpeg"><br>  <i>Fig.</i>  <i>10. Uso de antena externa</i> <br><br>  O resultado dessa atualiza√ß√£o foi muito intrigante para mim - porque o intervalo n√£o mudou muito, diria at√© que diminuiu um pouco.  Comecei a procurar uma maneira de sair dessa situa√ß√£o ao otimizar os algoritmos do programa. As configura√ß√µes iniciais do SS2530 precisavam reler o carro e os f√≥runs da folha de dados sobre este t√≥pico.  O objetivo era fazer com que cada m√≥dulo da rede funcionasse como repetidor, especialmente porque essa fun√ß√£o √© ativada por padr√£o e √© suportada por qualquer dispositivo executando o protocolo Zig-Bee.  Mas no meu caso n√£o era √≥bvio.  Como resultado, decidi introduzir um m√≥dulo adicional no sistema, que teria um firmware exclusivo ativado, aumentando apenas o pin_6 no dip-switch.  Ele precisava, estava no teto do primeiro andar e apenas transmitia os comandos recebidos, ou seja,  ser um refor√ßo de sinal. <br><br>  Direi imediatamente que esse era um beco sem sa√≠da.  Mas, durante a implementa√ß√£o dessa id√©ia, medi acidentalmente os par√¢metros da antena "preta", que vendi em uma loja online, juntamente com o CC2530 e o cabo.  O analisador de rede mostrou um SWR 1,9 na frequ√™ncia de 2,4 GHz - os coment√°rios s√£o desnecess√°rios, voc√™ precisa criar sua pr√≥pria antena.  Uma solicita√ß√£o ao mecanismo de pesquisa fornece imediatamente a resposta correta, a antena Clover e instru√ß√µes detalhadas de fabrica√ß√£o. <br><br><img src="https://habrastorage.org/webt/8f/fo/2s/8ffo2soyaf4iikrhcw75ymoxwwi.jpeg"><br>  <i>Fig.</i>  <i>11. Antena e dispositivo para sua fabrica√ß√£o.</i> <br><br>  Literalmente, √† noite, fiz tr√™s pe√ßas dessas antenas, verifiquei a sua SWR por nada menos que 1,2.  N√£o posso dizer sobre as outras caracter√≠sticas, padr√£o de radia√ß√£o e ganho.  Mas o fato √© que o alcance da recep√ß√£o e envio confi√°veis ‚Äã‚Äãde comandos dobrou.  Fig_12 <br><br><img src="https://habrastorage.org/webt/ye/ba/bd/yebabdzcf80hy4yoaoilnapxxz4.jpeg"><br>  <i>Fig.</i>  <i>12. Medi√ß√£o de antena</i> <br><br>  Como resultado, conseguimos obter uma recep√ß√£o normal do sinal do servidor em todos os 12 m√≥dulos de polling instalados no chal√©.  T.O.  o requisito de TK √© totalmente cumprido dentro do prazo; eu praticamente cumpri os prazos.  O cliente est√° satisfeito. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt460637/">https://habr.com/ru/post/pt460637/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt460627/index.html">vGPU - o uso n√£o pode ser ignorado</a></li>
<li><a href="../pt460629/index.html">A probabilidade de 2 mineiros terem o mesmo mundo</a></li>
<li><a href="../pt460631/index.html">Em torno do crach√° em 80 dias: do outro lado OFFZONE</a></li>
<li><a href="../pt460633/index.html">Detalhes de implementa√ß√£o para RSTP e redund√¢ncia de anel estendida propriet√°ria</a></li>
<li><a href="../pt460635/index.html">CLRium # 6: Simultaneidade e Paralelismo. Dois dias: do processador ao ass√≠ncrono / aguardar</a></li>
<li><a href="../pt460641/index.html">YouTokenToMe: uma ferramenta para tokeniza√ß√£o r√°pida de texto da equipe VKontakte</a></li>
<li><a href="../pt460643/index.html">Distribui√ß√£o uniforme de pontos em uma esfera</a></li>
<li><a href="../pt460645/index.html">Fazendo o bem fazendo o mal: escrevendo c√≥digo mal com Go, Parte 1</a></li>
<li><a href="../pt460647/index.html">Solu√ß√£o de um trabalho com pwnable.kr 05 - c√≥digo de acesso. Reescreva a tabela de links de procedimentos atrav√©s da vulnerabilidade de cadeia de formato</a></li>
<li><a href="../pt460651/index.html">Reuni√£o da Sociedade de Testadores An√¥nimos: TMS, monitoramento, monitoramento, avalia√ß√£o da qualidade da pesquisa e testes iOS nativos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>