<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙄 🚵🏾 🎅🏻 开发人员手册：DDD食谱（第5部分，过程） 😓 🦓 😤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="引言 


在前面的文章中，我们描述了： 范围 ， 方法论基础 ， 架构和结构 的示例 。 在本文中，我想告诉您如何描述流程，收集需求的原理，业务需求与功能需求之间的区别以及如何从需求转换为代码。 讨论使用用例的原理以及它们如何为我们提供帮助。 探索Interactor和Service Layer设...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>开发人员手册：DDD食谱（第5部分，过程）</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454668/"><h1 id="vvedenie"> 引言 </h1><br><p>在前面的文章中，我们描述了： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">范围</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">方法论基础</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">架构</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">结构</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的示例</a> 。 在本文中，我想告诉您如何描述流程，收集需求的原理，业务需求与功能需求之间的区别以及如何从需求转换为代码。 讨论使用用例的原理以及它们如何为我们提供帮助。 探索Interactor和Service Layer设计模式的实现选项示例。 </p><br><p><img src="https://habrastorage.org/webt/wo/je/ct/woject0sgeuwc_4xnnzugty-5jg.png" alt="likeyourgrandmom"></p><br><p> 本文提供的示例是使用我们的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">LunaPark</a>解决方案提供的，它将帮助您完成所描述方法的第一步。 </p><br><h1 id="otdelyaem-funkcionalnye-trebovaniya-ot-biznes-trebovaniy"> 将功能需求与业务需求分开。 </h1><br><p> 一次又一次地发生了这样的情况，许多商业想法并没有真正变成最终的预期产品。 这通常是由于无法理解业务需求和功能需求之间的差异而导致的，最终导致需求收集不足，不必要的文档，项目延迟和重大项目失败。 </p><br><p> 有时我们会面临这样的情况，尽管最终的解决方案可以满足客户的需求，但是却无法实现业务目标。 </p><br><p> 因此，在开始定义它们之前，必须将业务需求与功能需求分开。 让我们举个例子。 </p><a name="habracut"></a><br><p> 假设我们正在为一家披萨外卖公司编写一个应用程序，并且我们决定创建一个快递跟踪系统。 业务要求如下： </p><br><p>  <em>“引入一个基于Web的系统和一个基于移动员工的员工跟踪系统，该系统可以捕获快递员的路线并通过监视快递员的活动，他们的缺勤和劳动生产率来提高效率。”</em> </p><br><p> 在这里，我们可以区分许多特征，这些特征将表明这些是企业的要求： </p><br><ul><li> 业务需求总是从客户的角度来编写的； </li><li> 这些是广泛的高层需求，但仍然是面向部分的； </li><li> 它们不是公司目标，而是帮助公司实现目标； </li><li> 回答问题“ <strong>为什么</strong> ”和“ <strong>什么</strong> ”。 公司想收到什么？ 她为什么需要它。 </li></ul><br><p> 功能需求是系统为实现业务需求而必须执行的<em>操作</em> 。 因此，功能要求与开发的解决方案或软件有关。 我们为以上示例制定功能要求： </p><br><ul><li> 系统应通过GPS / GLONASS显示员工的经度和纬度； </li><li> 系统应在地图上显示员工的位置； </li><li> 该系统应允许经理将通知发送给他们的现场下属。 </li></ul><br><p> 我们重点介绍以下功能： </p><br><ul><li> 功能要求总是从系统的角度来编写的； </li><li> 它们更加具体和详细； </li><li> 得益于功能需求的满足，开发出了满足业务需求和客户目标的有效解决方案； </li><li> 回答“ <strong>如何</strong> ”的问题。 系统如何解决业务需求。 </li></ul><br><p> 关于对设计或实现施加限制的非功能性要求（也称为“质量要求”），应该说几句话（例如，对性能，安全性，可用性，可靠性的要求）。 这些要求回答了系统应为“ <strong>什么</strong> ”的问题。 </p><br><p> 发展是将业务需求转换为功能需求。 应用编程是功能需求的实现，而系统是非功能性的。 </p><br><h1 id="varianty-ispolzovaniya-use-cases"> 用例 </h1><br><p> 在商业系统中，实现功能需求通常是最复杂的。 在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">纯体系结构中，</a>功能需求是通过<em>用例</em>层实现的。 </p><br><p> 但是对于初学者来说，我想转向源头。  Ivar Jacobson- <em>用例</em>的定义的作者，UML的作者之一和RUP方法，在他的文章<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Use-Case 2.0中。软件开发中心</a>确定了使用用<em>例的</em> 6条原则： </p><br><ol><li> 通过讲故事使它们变得简单； </li><li> 制定战略计划，了解整体情况； </li><li> 专注于意义； </li><li> 将系统分层排列； </li><li> 逐步交付系统； </li><li> 满足团队的需求。 </li></ol><br><p> 我们简要地考虑了每个原则，它们对于我们进一步理解很有用。 以下是我的免费翻译，带有缩写和插入词，强烈建议您熟悉原始译文。 </p><br><h3 id="prostota-cherez-povestvovanie"> 讲故事简单 </h3><br><p>  <em>叙事是我们文化的一部分；</em>  <em>这是将知识，信息从一个人转移到另一个人的最简单，最有效的方法。</em>  <em>这是传达系统应该做什么并帮助团队专注于共同目标的最佳方法。</em> </p><br><p>  <em>用例反映了系统目标。</em>  <em>要了解用例，我们要讲一个故事。</em>  <em>故事讲述了如何实现目标以及如何解决在此过程中出现的问题。</em>  <em>用例（如故事书）提供了一种以简单，全面的方式识别和覆盖所有不同但相关的故事的方法。</em>  <em>这使得收集，分发和理解系统需求变得容易。</em> </p><br><p> 该原理与DDD方法中的Ubiques语言相关。 </p><br><h3 id="ponimanie-kartiny-v-celom"> 了解整体情况 </h3><br><p>  <em>无论您开发的系统是大型，小型，软件，硬件还是业务，了解全局都是非常重要的。</em>  <em>如果不了解整个系统，就无法做出正确的决定，包括要包含在系统中的内容，要排除的内容，花费的成本以及带来的好处。</em> </p><br><p>  Ivar Jacobson建议使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">用例图</a> ，这对于收集需求非常方便。 如果需求已被编译并且明确，那么Eric Evans的Context map是最佳选择。 通常，对Scrum方法进行解释是为了使人们不必花时间在战略计划上，而是在两个多星期后考虑规划过去的遗迹。 杰夫·萨瑟兰（Jeff Sutherland）的宣传工作落在了水流上，那些完成了为期两周的Scrum Master培训课程的人们得以完成工作。 但是常识承认战略计划的重要性。 无需制定详细的战略计划，但应该这样做。 </p><br><h3 id="fokus-na-znachenii"> 注重价值 </h3><br><p>  <em>当试图了解系统的使用方式时，始终着重于将其提供给用户和其他相关方的价值始终很重要。</em>  <em>只有在使用系统时才形成值。</em>  <em>因此，将重点放在系统将如何应用上比将其提供的功能或功能列表长得多。</em> </p><br><p>  <em>用例提供了这一重点，可帮助您专注于特定用户将如何使用该系统来实现其目标。</em>  <em>用例涵盖了许多使用系统的方法：成功实现目标的方法和解决出现的任何困难的方法。</em> </p><br><p> 此外，作者提出了一个很棒的方案，应该密切注意： </p><br><p><img src="https://habrastorage.org/webt/5g/nk/ma/5gnkmae4chv6_azevvzhg2euglc.png"></p><br><p> 该图显示了一个用例“在ATM上提取现金”。  <em>基本方向</em> （基本流程）中描述了实现目标的最简单方法。 其他情况称为替代流程。 这些指导有助于讲故事，构建系统并帮助编写测试。 </p><br><h3 id="posloynoe-postroenie"> 分层 </h3><br><p>  <em>大多数系统在准备使用之前需要进行大量工作。</em>  <em>他们有许多要求，其中大多数取决于其他要求，必须在满足和评估要求之前先实施它们。</em> </p><br><p>  <em>一次创建一个这样的系统是一个很大的错误。</em>  <em>该系统应该由各个部分组成，每个部分都对用户具有明确的价值。</em> </p><br><p> 这些想法与敏捷方法和<em>领域</em>想法共鸣。 </p><br><h3 id="poshagovyy-vyvod-produkta-na-rynok"> 分步产品发布 </h3><br><p>  <em>大多数软件系统已经发展了许多代。</em>  <em>它们不是一次生产的。</em>  <em>它们是作为一系列发行版本构建的，每个发行版本都是在先前发行版本的基础上构建的。</em>  <em>即使是发行版本身也常常不会一次发布，而是通过一系列中间版本进行开发。</em>  <em>每个步骤都提供了系统的清晰，可用版本。</em>  <em>这是应该创建所有系统的方式。</em> </p><br><h3 id="udovletvoryat-potrebnosti-komandy"> 满足团队需求 </h3><br><p>  <em>不幸的是，没有通用的解决方案可以解决软件开发问题。</em>  <em>不同的团队和不同的情况需要使用不同的样式和不同的详细程度。</em>  <em>无论选择哪种方法和技术，都必须确保它们具有足够的适应性，可以满足团队的当前需求。</em> </p><br><p> 埃里克·埃文斯（Eric Evans）在他的书中敦促您不要花费大量时间描述通过UML进行的所有过程。 使用任何视觉方案就足够了。 正如UML作者自己所说的那样，不同的团队，不同的项目需要不同的详细程度。 </p><br><h1 id="realizaciya"> 实作 </h1><br><p> 在纯架构中，Robert Martin定义了以下<em>用例</em> ： </p><br><blockquote> 这些用例协调了与实体之间的数据流，并指示这些实体使用其关键业务规则来实现用例的目标。 </blockquote><p> 让我们尝试将这些想法转化为代码。 让我们从使用用<em>例</em>的第三原则中回顾该方案，并将其作为基础。 考虑一个非常复杂的业务流程：“烹饪白菜派”。 </p><br><p> 让我们尝试分解它： </p><br><ul><li> 检查产品可用性； </li><li> 从库存中取出它们； </li><li> 揉面团； </li><li> 让面团上升； </li><li> 准备馅料； </li><li> 做馅饼 </li><li> 烤馅饼。 </li></ul><br><p> 我们通过<em>Interactor来</em>实现整个序列，并且每个步骤都将通过服务层上的功能或功能对象来实现。 </p><br><h1 id="posledovatelnost-deystviy-interactor"> 动作顺序（交互者） </h1><br><p><img src="https://habrastorage.org/webt/6b/vk/ra/6bvkra2chr3b8d43dmtxebpjaj4.png" alt="循序渐进"></p><br><p> 我强烈建议您通过《 <em>行动序列》</em>开始开发复杂的业务流程。 更确切地说，不是这样，您必须确定业务流程所属的<em>域域</em> 。 阐明所有业务需求。 识别过程中涉及的所有<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><em>实体</em></a> 。 在知识库中记录每个<em>实体</em>的要求和定义。 </p><br><p> 逐步将所有内容画在纸上。 有时您需要一个序列图。 它的作者与发明用例的人相同-Ivar Jacobson。 该图是他在基于中继电路为Erickson开发电话网络维护系统时发明的。 我真的很喜欢这张图，我认为术语“ <em>序列”</em>比术语“ <em>交互器”</em>更具表达力。 但是鉴于后者的普遍性，我们将使用熟悉的术语<em>-Interactor</em> 。 </p><br><p> 当您描述业务流程时，有一点提示对您有帮助，文档管理的主要规则可能变成：“由于任何业务活动，都应草拟文档”。 例如，我们正在开发折扣系统。 提供折扣，实际上，从业务的角度来看，我们达成了公司与客户之间的协议。 所有条件必须在本合同中阐明。 也就是说，在DiscountSystem域中，您将拥有Entites :: Contract。 不要将折扣与客户绑定，而是创建一个<em>实体</em>合同，该合同描述了其提供的规则。 </p><br><p> 在业务流程对所有参与其开发的人员都变得透明并且您的所有知识都已固定之后，让我们返回对业务流程的描述。 我建议您从<em>“动作序列”</em>开始编写代码。 </p><br><p>  <em>序列</em>设计模板负责： </p><br><ul><li>  <em>行动</em>顺序; </li><li>  <em>动作</em>之间传输数据的协调; </li><li> 处理<em>动作</em>在执行期间犯下的错误； </li><li> 返回一组已完成的<em>动作</em>的结果; </li><li>  <strong>重要说明</strong> ：此设计模式最重要的职责是实现业务逻辑。 </li></ul><br><p> 如果我们有某种复杂的流程，我想更详细地说明最后的责任-我们必须以一种清晰的方式描述它，而无需深入技术细节。  <strong>您应该在编程技能允许的情况下，将其描述为富有表现力的</strong> 。 将此课程委托给团队中经验最丰富的成员。 </p><br><p> 让我们回到馅饼：让我们尝试通过<em>Interactor</em>描述其准备过程。 </p><br><h2 id="realizaciya-1"> 实作 </h2><br><p> 我在上一篇文章中介绍了我们的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">LunaPark</a>解决方案的示例实现。 </p><br><pre><code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Kitchen</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sequences</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CookingPieWith</span></span></span><span class="hljs-class"></span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">abbage</span></span></span><span class="hljs-class"> &lt; LunaPark::Interactors::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sequence</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TEMPERATURE</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values::Temperature</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">(180, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">unit</span></span></span><span class="hljs-class">: :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cel</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call!</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::CheckProductsAvailability</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ingredients</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dough</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::BeatDough</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">from</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Repository::Products</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">beat_ingredients</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filler</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::Make</span></span></span><span class="hljs-class"></span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">abbageFiller</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">from</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Repository::Products</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filler_ingredients</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pie</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::MakePie</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dough</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filler</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bake</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::BakePie</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pie</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">temp</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TEMPERATURE</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sleep</span></span></span><span class="hljs-class"> 5.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">min</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">until</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bake</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pie</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_accessor</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">beat_ingredients</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filler_ingredients</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_accessor</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pie</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ingredients_list</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">beat_ingredients_list</span></span></span><span class="hljs-class"> + </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filler_ingredients_list</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p> 如我们所见， <code>call!</code> 描述了蛋糕烘焙过程的整个业务逻辑。 而且使用它来了解应用程序的逻辑很方便。 </p><br><p> 另外，我们可以通过用<code>MakeabbageFiller</code>代替<code>MakeabbageFiller</code>轻松描述烤鱼饼的过程。 因此，我们无需更改大量代码即可快速更改业务流程。 而且，我们可以同时保留两个<em>序列</em> ，以扩展业务案例。 </p><br><h3 id="dogovorennosti"> 安排 </h3><br><ul><li>  <code>call!</code>方法<code>call!</code> 是必需的方法；它描述了<em>Actions</em>的顺序。 </li><li> 每个初始化参数都可以通过setter或<code>attr_acessor</code>描述： </li></ul><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class"> &lt; LunaPark::Interactors::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sequence</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... private attr_accessor :bar end Foo.call(bar: 42)</span></span></span></span></code> </pre> <br><ul><li> 其余方法应该是私有的。 </li></ul><br><h2 id="primer-ispolzovaniya"> 使用范例 </h2><br><pre> <code class="ruby hljs">beat_ingredients = [ Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:flour</span></span>, <span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:gr</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:oil</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:gr</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:salt</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:spoon</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:milk</span></span>, <span class="hljs-number"><span class="hljs-number">150</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:ml</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:egg</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:unit</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:yeast</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:spoon</span></span> ] filler_ingredients = [ Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:cabbage</span></span>, <span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:gr</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:salt</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:spoon</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:pepper</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:spoon</span></span> ] cooking = CookingPieWithabbage.call( <span class="hljs-symbol"><span class="hljs-symbol">beat_ingredients:</span></span> beat_ingredients, <span class="hljs-symbol"><span class="hljs-symbol">filler_ingredients:</span></span> filler_ingredients ) <span class="hljs-comment"><span class="hljs-comment">#   : cooking.success? # =&gt; true cooking.fail # =&gt; false cooking.fail_message # =&gt; '' cooking.data # =&gt; Entity::Pie #   : cooking.success? # =&gt; false cooking.fail # =&gt; true cooking.fail_message # =&gt; 'The pie burned out' cooking.data # =&gt; nil</span></span></code> </pre> <br><p> 该过程通过该对象表示，并且我们具有调用该对象的所有必要方法-调用是否成功，调用期间是否发生任何错误，如果是，则选择哪个？ </p><br><h2 id="obrabotka-oshibok"> 错误处理 </h2><br><p> 如果现在我们回想起用例应用程序的第三项原则，那么请注意以下事实：除<em>主线外</em> ，我们还有<em>替代</em>指导。 这些是我们必须处理的错误。 举一个例子：我们当然不希望事件发生那样的事情，但是我们对此无能为力，严酷的现实是馅饼会定期燃烧。 </p><br><p>  <em>Interactor</em>拦截从<code>LunaPark::Errors::Processing</code>类继承的所有错误。 </p><br><p> 我们如何跟踪蛋糕？ 为此，请在<code>BakePie</code> <em>Action中</em>定义<code>Burned</code>错误。 </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Kitchen</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Errors</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Burned</span></span></span><span class="hljs-class"> &lt; LunaPark::Errors::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Processing</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p> 并在烘烤过程中，检查我们的馅饼是否未燃尽： </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Kitchen</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BakePie</span></span></span><span class="hljs-class"> &lt; LunaPark::Callable </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... rescue Errors::Burned, 'The pie burned out' if pie.burned? # ... end end end end</span></span></span></span></code> </pre> <br><p> 在这种情况下，错误陷阱将起作用，并且我们将能够在<code></code>处理它们。 <br> 未从<code>Processing</code>继承的错误被视为系统错误，并将在服务器级别被拦截。 除非另有说明，否则用户将收到500 ServerError。 </p><br><h2 id="praktika-ispolzovaniya"> 练习使用 </h2><br><h3 id="1-staraytes-opisyvat-vse-vyzovy-v-metode-call">  1.尝试在call方法中描述所有调用！ </h3><br><p> 您不应该<em>在</em>单独的方法中实现每个<em>Action</em> ，这会使代码更加膨胀。 您必须多次看全班才能理解它的工作原理。 破坏烤馅饼的配方： </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CookingPieWith</span></span></span><span class="hljs-class"></span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">abbage</span></span></span><span class="hljs-class"> &lt; LunaPark::Interactors::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sequence</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call!</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">check_products_availability</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">make_cabbage_filler</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">make_pie</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bake</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">check_products_availability</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::CheckProductsAvailability</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ingredients</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end</span></span></span></span></code> </pre> <br><p> 直接在教室中使用动作通话。 从红宝石的角度来看，这种方法可能看起来很不寻常，因此看起来更具可读性： </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DrivingStart</span></span></span><span class="hljs-class"> &lt; LunaPark::Interactors::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sequence</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call!</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service::CheckEngine</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service::StartUpTheIgnition</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">car</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service::ChangeGear</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">car</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gear_box</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to</span></span></span><span class="hljs-class">: :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">drive</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service::StepOnTheGas</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">car</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pedals</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">right</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><h3 id="2-po-vozmozhnosti-ispolzuyte-metod-klassa-call">  2.如果可能，使用调用类方法 </h3><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># good - ,   ,  . #    . Sequence::RingingToPerson.call(params) # good -   ,      e, #    ,     , #    . ring = Sequence::RingingToPerson.new(person) unless ring.success? ring.call sleep 5.min end</span></span></code> </pre><br><h3 id="3-ne-sozdavayte-_funkcionalnye-obekty_-radi-tipizacii-koda-smotrite-po-situacii">  3.不要为了键入代码而创建<em>Functional对象</em> ；请根据情况进行查看 </h3><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># bad -        ,  #     . module Services class BuildUser &lt; LunaPark::Callable def initialize(first_name:, last_name:, phone:) </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@first</span></span></span><span class="hljs-comment">_name = first_name </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@last</span></span></span><span class="hljs-comment">_name = last_name </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@phone</span></span></span><span class="hljs-comment"> = phone end def call Entity::User.new( first_name: first_name, last_name: last_name, phone: phone ) end private attr_reader :first_name, :last_name, :phone end end module Sequences class RegisteringUser &lt; LunaPark::Interactors::Sequence attr_accessor :first_name, :last_name, :phone def call! user = Service::BuildUser.call(first_name: first_name, last_name: last_name, phone: phone) end end end # good -     ,  . #        , #       . module Sequences class RegisteringUser &lt; LunaPark::Interactors::Sequence attr_accessor :first_name, :last_name, :phone def call! user #... end private def user </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@user</span></span></span><span class="hljs-comment"> = Entity::User.new( first_name: first_name, last_name: last_name, phone: phone ) end end end</span></span></code> </pre> <br><h1 id="servisnyy-sloy-service-layer"> 服务层 </h1><br><p><img src="https://habrastorage.org/webt/1-/qv/ip/1-qvipbbxxz2i0cveslcf02b7c0.png" alt="数码相机"></p><br><p> 正如我们所说，Interactor在最高层次上描述了业务逻辑。  <em>服务层</em> （Service layer）已经揭示了功能需求实施的细节。 如果我们正在谈论做馅饼，那么在Interactor的层面上，我们只是说“揉面团”，而没有涉及如何揉面团的细节。 捏合过程在“ <em>服务”级别进行</em>描述。 让我们回到原始的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">蓝皮书</a> ： </p><br><p>  <em>在应用域中，有些操作无法在Entity或Value Object类型的对象中找到自然位置。</em>  <em>它们本质上不是对象，而是活动。</em>  <em>但是，由于建模范例的基础是对象方法，因此我们将尝试将它们变成对象。</em> </p><br><p>  <em>在这一点上，很容易犯一个常见的错误：放弃将操作放在适合它的合适对象中的尝试，从而进行过程编程。</em>  <em>但是，如果将操作强行置于定义与其无关的对象中，则会使该对象本身失去其纯度，从而使其难以理解和重构。</em>  <em>如果在一个简单的对象中实现许多复杂的操作，它可能会变成难以理解的内容，您正在做的事情不清楚。</em>  <em>这样的操作通常涉及主题区域的其他对象，并且它们之间的协调被执行以执行联合任务。</em>  <em>附加责任在对象之间创建了依赖链，混合了可以独立考虑的概念。</em> </p><br><p> 选择功能的实现位置时，请始终使用常识。 您的任务是使模型更具表现力。 让我们看一个例子，“我们需要砍木头”： </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Wood</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">chop</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end end</span></span></span></span></code> </pre> <br><p> 此方法将是一个错误。 木柴不会自己砍，我们需要一把斧头： </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Axe</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">chop</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sacrifice</span></span></span><span class="hljs-class">) </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end end</span></span></span></span></code> </pre> <br><p> 如果我们使用简化的业务模型，那就足够了。 但是，如果需要对流程进行更详细的建模，我们将需要一个人将这些柴砍掉，也许还需要一些原木作为流程的架子。 </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Human</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">chop_firewood</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wood</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">axe</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">chock</span></span></span><span class="hljs-class">) </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end end</span></span></span></span></code> </pre><br><p> 您可能已经猜到了，这不是一个好主意。 并非我们所有人都从事砍伐木材，这不是一个人的直接职责。 我们经常看到Ruby on Rails中的模型有多超载，其中包含相似的逻辑：获得折扣，向购物篮中添加商品，向余额中取钱。 此逻辑不适用于实体，但适用于该实体所涉及的过程。 </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChopFirewood</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end</span></span></span></span></code> </pre> <br><p> 在弄清楚我们存储在<em>服务</em>中的逻辑之后<em>，</em>我们将尝试实现其中一种。 通常，服务是通过方法或功能对象实现的。 </p><br><h2 id="funkcionalnye-obekty"> 功能对象 </h2><br><p> 功能对象满足一个功能要求。 功能对象以其最原始的形式具有一个单一的公共方法<code>call</code> 。 </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serivices</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class"> + </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class">).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_reader</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p> 这样的对象有几个优点：简洁，易于测试。 有一个缺点，这种对象可能会变成很多。 有几种方法可以对相似的对象进行分组；在我们的项目的一部分中，我们按类型对它们进行划分： </p><br><ul><li>  <em>服务对象</em> （Service）-一个对象，创建一个新的对象； </li><li>  <em>Command</em> （命令）-更改当前对象； </li><li>  <em>监护人</em> （Guard）-如果出现问题，则返回错误。 </li></ul><br><h2 id="servisnyy-obekt-service"> 服务对象 </h2><br><p> 在我们的实现中， <em>服务</em> -实现功能要求并始终返回值。 </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KorovaMilkBar</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FindMilk</span></span></span><span class="hljs-class"> &lt; LunaPark::Callable </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GLASS_SIZE</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values::Unit</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> '200</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">g</span></span></span><span class="hljs-class">' </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class">:) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shelfs</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">find</span></span></span><span class="hljs-class"> { |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shelf</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shelf</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">has?</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GLASS_SIZE</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">of</span></span></span><span class="hljs-class">: :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">milk</span></span></span><span class="hljs-class">) } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_reader</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FindMilk</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">the_red_one</span></span></span><span class="hljs-class">) </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># =&gt; #&lt;Glass: ... &gt;</span></span></span></span></code> </pre> <br><h2 id="komanda-command"> 指挥部 </h2><br><p> 在我们的实现中， <em>Command-</em>执行一个<em>Action</em> ，如果true返回true，则修改该对象。 实际上， <em>团队</em>不会创建对象，而是修改现有对象。 </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KorovaMilkBar</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Commands</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FillGlass</span></span></span><span class="hljs-class"> &lt; LunaPark::Callable </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class">:) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">content</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class"> &lt;&lt; content </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_reader</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Glass</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">empty</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">milk</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Milk</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">(200, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gr</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">empty?</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># =&gt; true FillGlass.call glass, with: milk # =&gt; true glass.empty? # =&gt; false</span></span></span></span></code> </pre> <br><h2 id="vahter-guard"> 守护者（Guard） </h2><br><p>  <em>值班人员</em>执行逻辑检查，如果出现故障，则给出处理错误。 这种类型的对象不会以任何方式影响<em>主方向</em> ，但是如果出现问题，则会将我们切换到<em>替代方向</em> 。 </p><br><p> 提供牛奶时，重要的是要确保牛奶新鲜： </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KorovaMilkBar</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Guards</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IsFresh</span></span></span><span class="hljs-class"> &lt; LunaPark::Callable </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">product</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">products</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">products</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">products</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">each</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">product</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">raise</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Errors::Rotten</span></span></span><span class="hljs-class">, "</span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#{product.title} is not fresh" if product.expiration_date &gt; Date.today end nil end private attr_reader :products end end end</span></span></span></span></code> </pre> <br><p> 您可能会发现按类型分隔功能对象很方便。 您可以添加自己的工具，例如<em>Builder-</em>基于参数创建对象。 </p><br><h3 id="dogovorennosti-1"> 安排 </h3><br><ul><li>  <code>call</code>方法是唯一的强制公共方法。 </li><li>  <code>initialize</code>方法是唯一的可选public方法。 </li><li> 其余方法应该是私有的。 </li><li> 逻辑错误必须从<code>LunaPark::Errors::Processing</code>类继承。 </li></ul><br><h2 id="obrabotka-oshibok-1"> 错误处理 </h2><br><p> 操作操作期间可能发生两种错误。 </p><br><h5 id="oshibki-processa-vypolneniya"> 运行时错误 </h5><br><p> 由于违反处理逻辑，可能会发生此类错误。 </p><br><p> 例如： </p><br><ul><li> 创建用户电子邮件时保留； </li><li> 当您尝试喝牛奶时，牛奶就结束了； </li><li> 另一个微服务拒绝了该操作（出于逻辑原因，而不是因为该服务不可用）。 </li></ul><br><p> 用户极有可能希望了解这些错误。 另外，这些可能是错误 <br> 我们可以预见。 </p><br><p> 此类错误应继承自<code>LunaPark::Errors::Processing</code> </p><br><h5 id="sistemnyy-oshibki"> 系统错误 </h5><br><p> 由于系统崩溃而发生的错误。 </p><br><p> 例如： </p><br><ul><li> 数据库不起作用； </li><li> 东西除以零。 </li></ul><br><p> 我们很可能无法预见这些错误，也不能对用户说任何话，除非一切都非常糟糕，并向开发人员发送报告以要求采取行动。 此类错误应继承自<code>SystemError</code> </p><br><p> 还有<strong>验证错误</strong> ，我们将在下一篇文章中更详细地讨论。 </p><br><h2 id="praktika-ispolzovaniya-1"> 练习使用 </h2><br><h3 id="1-ispolzuyte-peremennye-chtoby-povysit-chitaemost">  1.使用变量提高可读性 </h3><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Fishing</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># bad -   Serivices::Catch.call(fish, rod) # bad -  Serivices::Catch.call(fish: fish, rod: rod) # good -   Serivices::Catch.call(fish, with: rod) module Serivices class Catch def initialize(fish, with:) </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@fish</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = fish </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@rod</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = with #      #   . end # ... private attr_reader :fish, :rod end end end</span></span></span></span></code> </pre> <br><h3 id="2-peredavayte-obekty-a-ne-parametry">  2.传递对象，而不传递参数 </h3><br><p> 如果不是参数处理的目的，请尝试简化初始化程序。 <br> 传递对象，而不传递参数。 </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># bad -        -.  #      ,   . class Foo def initialize(foo_params:, bar_params:) </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@foo</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = Values::Foo.new(*foo_params) </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@bar</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = Values::Bar.new(*bar_params) end # ... end Services::Foo.call(foo: {a: 1, b: 2}, bar: 34) # good -   -. class Bar def initialize(foo:, bar:) </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@foo</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = foo </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@bar</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = bar # ... end end foo = Values::Foo.new(a: 1, b: 2) bar = Values::Bar.new(34) Services::Bar.call(foo: foo, bar: bar) # good -       - Builder. class BuildFoo def initialize(param_1:, param_2:) </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span></span><span class="hljs-class"><span class="hljs-comment">_1 = param_1 </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span></span><span class="hljs-class"><span class="hljs-comment">_1 = param_1 end def call Foo.new( param_1: param_1.foo, param_2: param_2.bar, param_3: some_magick ) end # ... end end</span></span></span></span></code> </pre> <br><h3 id="3-ispolzuyte-v-nazvanie-deystviya---glagol-deystviya-i-obekt-vozdeystviya">  3.使用名称Actions-动作的动词和影响的对象。 </h3><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># bad module Services class Milk; end class Work; end class FooBuild; end class PasswordGenerator; end end # good module Services class GetMilk; end class WorkOnTable; end class BuildFoo; end class GeneratePassword; end end</span></span></code> </pre> <br><h3 id="4-po-vozmozhnosti-ispolzuyte-metod-klassa-call">  4.如果可能，使用调用类方法 </h3><br><p> 通常是<em>Actions</em>类的实例，除了编写调用之外很少使用。 </p><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># good -    . Services::BuildFoo.call(params) # good -     Services::BuildFoo.(params) # good -   ,      , #    ,     ,   #  . ring = Services::RingToPhone.new(phone: neighbour) 10.times do ring.call end</span></span></code> </pre> <br><h3 id="5-obrabotka-oshibok-ne-yavlyaetsya-zadachey-servisa">  5.错误处理不是服务任务 </h3><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># bad -    ,   . def call #... rescue SystemError =&gt; e return false end</span></span></code> </pre> <br><h2 id="moduli"> 模组 </h2><br><p> 在此之前，我们将<em>服务层</em>的实现视为一组功能对象。 但是我们可以轻松地将方法放置在这一层上： </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sum</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">b</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class"> + </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">b</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p> 我们面临的另一个问题是大量的服务设施。 取而代之的是“服务胖文件夹”，而不是“边缘胖模型”。 有几种方法来组织结构以减少悲剧的规模。 埃里克·埃文斯（Eric Evans）通过将多个功能组合到一个类中来解决此问题。 想象一下，我们需要对保姆Arina Rodionovna的业务流程进行建模，她可以喂养普希金并将其卧床不起： </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NoonService</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">arina_radionovna</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pushkin</span></span></span><span class="hljs-class">) </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end def to_feed # ... end def to_sleep # ... end end</span></span></span></span></code> </pre> <br><p> 从OOP的角度来看，这种方法更为正确。 但是我们建议至少在初始阶段就放弃它。 经验不足的程序员开始在此类中编写大量代码，最终导致连接性增加。 相反，您可以使用将活动表示为某种抽象的模块： </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Noon</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToFeed</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call!</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end class &lt;&lt; self #    ,   #    def to_feed(arina_radionovna, pushkin) ToFeed.new(arina_radionovna, pushkin).call end #    ,    def to_sleep(arina_radionovna, pushkin) arina_radionovna.tell_story pushkin pushkin.state = :sleep end end end end</span></span></span></span></code> </pre> <br><p> 当划分为模块时，应观察到较低的外部耦合（低耦合）和较高的内部凝聚力（高凝聚力），但是我们使用诸如服务或交互器之类的模块，这也与纯体系结构的思想背道而驰。 这是有意识的选择，有助于感知。 通过文件的名称，我们了解该类或该类实现的设计模式，如果对于有经验的程序员而言，这是显而易见的，那么对于初学者而言，并非总是如此。 团队准备就绪后，请丢弃多余的部分。 </p><br><p> 引用另一本大蓝皮书的小摘录： </p><br><p>  <em>选择能说明系统历史并包含一致概念集的模块。</em>  <em>因此，模块之间相互之间的依赖性很低。</em>  <em>但是，如果不是这样，请找到一种方法来更改模型，以使概念彼此分离，或者寻找模型中缺少的概念，这可能成为模块的基础，从而以一种自然，有意义的方式将模型的元素整合在一起。</em>  <em>从某种意义上说，可以相互独立地分析和感知不同模块中的概念，从而实现模块之间的低依赖性。</em>  <em>优化模型，直到根据主题区域的高级概念在其中出现自然边界，并且相应的代码未作相应划分。</em> </p><br><p>  <em>为模块名称指定将包含在UNIFIED LANGUAGE中的名称。</em>  <em>模块本身及其名称都应反映出对主题领域的了解和理解。</em> </p><br><p> 这些模块的主题很大且很有趣，但是显然它超出了本文的主题范围。 下次我们将与您讨论<em>存储库</em>和<em>适配器</em> 。 我们打开了一个<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">舒适的电报频道</a> ，我们希望在此共享有关DDD的资料。 我们欢迎您的问题和反馈。 </p><br><hr><br><div class="spoiler">  <b class="spoiler_title">灵感来源</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://www.netsolutions.com/insights/business-and-functional-requirements-what-is-the-difference-and-why-should-you-care/</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http://magazines.russ.ru/nz/2007/54/gi3.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://www.microtool.de/zh/knowledge-base/how-use-case-2-0-works/</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://www.researchgate.net/publication/220059381_Use_cases_-_Yesterday_today_and_tomorrow</a> </li><li> 面向问题的设计，Eric J. Evans </li></ul></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN454668/">https://habr.com/ru/post/zh-CN454668/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN454652/index.html">家用3D打印机上的Jet引擎</a></li>
<li><a href="../zh-CN454658/index.html">美容小工具-认真的生意</a></li>
<li><a href="../zh-CN454662/index.html">带着妻子和抵押贷款小心地搬到荷兰。 第1部分：求职</a></li>
<li><a href="../zh-CN454664/index.html">在AR中玩俄罗斯方块</a></li>
<li><a href="../zh-CN454666/index.html">软件无线电-它如何工作？ 第7部分</a></li>
<li><a href="../zh-CN454670/index.html">系列“切尔诺贝利”：观察和思考</a></li>
<li><a href="../zh-CN454672/index.html">开始的关键：适用于计算机取证的最佳软件和硬件</a></li>
<li><a href="../zh-CN454674/index.html">控制台中的可怜人监视或服务器监视</a></li>
<li><a href="../zh-CN454676/index.html">Arduino上的GPS手表</a></li>
<li><a href="../zh-CN454678/index.html">Rust中的惯用GPU编程：E库</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>