<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëª üîì üí™üèΩ Guide d'architecture d'application Android üôãüèº üí∏ ‚öúÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! Je vous pr√©sente la traduction gratuite du ¬´Guide de l'architecture des applications¬ª de JetPack . Je vous demande de laisser tous les ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guide d'architecture d'application Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456256/">  Bonjour, Habr!  Je vous pr√©sente la traduction gratuite du ¬´Guide de l'architecture des applications¬ª de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JetPack</a> .  Je vous demande de laisser tous les commentaires sur la traduction dans les commentaires, et ils seront corrig√©s.  De plus, les commentaires de ceux qui ont utilis√© l'architecture pr√©sent√©e avec des recommandations pour son utilisation seront utiles √† tous. <br><br>  Ce guide couvre les meilleures pratiques et l'architecture recommand√©e pour cr√©er des applications robustes.  Cette page suppose une introduction de base √† Android Framework.  Si vous √™tes nouveau dans le d√©veloppement d'applications Android, consultez nos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">guides de d√©veloppement</a> pour commencer et en savoir plus sur les concepts mentionn√©s dans ce guide.  Si vous √™tes int√©ress√© par l'architecture des applications et souhaitez vous familiariser avec les mat√©riaux de ce guide en termes de programmation sur Kotlin, consultez le cours Udacity, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´D√©veloppement d'applications pour Android avec Kotlin¬ª</a> . <br><br><h2>  Exp√©rience utilisateur de l'application mobile </h2><br>  Dans la plupart des cas, les applications de bureau ont un point d'entr√©e unique √† partir du bureau ou du lanceur, puis s'ex√©cutent comme un processus monolithique unique.  Les applications Android ont une structure beaucoup plus complexe.  Une application Android typique contient plusieurs <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">composants d'application</a> , notamment des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">activit√©s</a> , des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fragments</a> , des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">services</a> , des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fournisseurs de contenu</a> et des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©cepteurs de</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">diffusion</a> . <br><br>  Vous d√©clarez tout ou partie de ces composants d'application dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">manifeste d'</a> application.  Android utilise ensuite ce fichier pour d√©cider comment int√©grer votre application dans l'interface utilisateur commune de l'appareil.  √âtant donn√© qu'une application Android bien √©crite contient plusieurs composants et que les utilisateurs interagissent souvent avec plusieurs applications dans un court laps de temps, les applications doivent s'adapter √† diff√©rents types de flux de travail et de t√¢ches pilot√©es par l'utilisateur. <br><a name="habracut"></a><br>  Par exemple, consid√©rez ce qui se passe lorsque vous partagez une photo dans votre application de m√©dias sociaux pr√©f√©r√©e: <br><br><ol><li>  L'application d√©clenche l'intention de la cam√©ra.  Android lance une application appareil photo pour traiter la demande.  Pour le moment, l'utilisateur a quitt√© l'application pour les r√©seaux sociaux, et son exp√©rience en tant qu'utilisateur est impeccable. </li><li>  Une application de cam√©ra peut d√©clencher d'autres intentions, comme le lancement d'un s√©lecteur de fichiers, qui peut lancer une autre application. </li><li>  √Ä la fin, l'utilisateur revient √† l'application de r√©seau social et partage la photo. </li></ol><br>  √Ä tout moment du processus, l'utilisateur peut √™tre interrompu par un appel t√©l√©phonique ou une notification.  Apr√®s l'action associ√©e √† cette interruption, l'utilisateur s'attend √† pouvoir revenir et reprendre ce processus de partage de photos.  Ce comportement de changement d'application est courant sur les appareils mobiles, votre application doit donc g√©rer correctement ces points (t√¢ches). <br><br>  N'oubliez pas que les appareils mobiles sont √©galement limit√©s en ressources, donc √† tout moment le syst√®me d'exploitation peut d√©truire certains processus d'application afin de lib√©rer de l'espace pour de nouveaux. <br><br>  Compte tenu des conditions de cet environnement, les composants de votre application peuvent √™tre lanc√©s individuellement et non dans l'ordre, et le syst√®me d'exploitation ou l'utilisateur peut les d√©truire √† tout moment.  √âtant donn√© que ces √©v√©nements ne sont pas sous votre contr√¥le, <b>vous ne devez pas stocker de donn√©es ou d'√©tats dans vos composants d'application</b> et vos composants d'application ne doivent pas d√©pendre les uns des autres. <br><br><h2>  Principes architecturaux g√©n√©raux </h2><br>  Si vous ne devez pas utiliser de composants d'application pour stocker des donn√©es et l'√©tat de l'application, comment devez-vous d√©velopper votre application? <br><br><h3>  R√©partition des responsabilit√©s </h3><br>  Le principe le plus important √† suivre est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le partage des responsabilit√©s</a> .  Une erreur courante est lorsque vous √©crivez tout votre code dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Activity</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fragment</a> .  Ce sont des classes d'interface utilisateur qui doivent contenir uniquement une logique traitant l'interaction de l'interface utilisateur et du syst√®me d'exploitation.  En partageant autant que possible la responsabilit√© dans ces classes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">(SRP)</a> , vous pouvez √©viter bon nombre des probl√®mes associ√©s au cycle de vie de l'application. <br><br><h3>  Contr√¥le de l'interface utilisateur √† partir du mod√®le </h3><br>  Un autre principe important est que vous devez <b>contr√¥ler votre interface utilisateur √† partir d'un mod√®le</b> , de pr√©f√©rence √† partir d'un mod√®le permanent.  Les mod√®les sont les composants qui sont responsables du traitement des donn√©es pour l'application.  Ils sont ind√©pendants des objets <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">View</a> et des composants d'application, par cons√©quent, ils ne sont pas affect√©s par le cycle de vie de l'application et les probl√®mes associ√©s. <br><br>  Un mod√®le permanent est id√©al pour les raisons suivantes: <br><br><ul><li>  Vos utilisateurs ne perdront pas de donn√©es si le syst√®me d'exploitation Android d√©truit votre application pour lib√©rer des ressources. </li><li>  Votre application continue de fonctionner lorsque la connexion r√©seau est instable ou indisponible. </li></ul><br>  En organisant la fondation de votre application en classes de mod√®le avec une responsabilit√© clairement d√©finie pour la gestion des donn√©es, votre application devient plus testable et prise en charge. <br><br><h2>  Architecture d'application recommand√©e </h2><br>  Cette section montre comment structurer une application √† l'aide de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">composants architecturaux</a> , en travaillant dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sc√©nario d'utilisation de bout en bout</a> . <br><br>  <i><b>Remarque</b></i>  <i>Il n'est pas possible d'avoir une fa√ßon d'√©crire des applications qui fonctionne le mieux pour chaque sc√©nario.</i>  <i>Cependant, l'architecture recommand√©e est un bon point de d√©part pour la plupart des situations et des workflows.</i>  <i>Si vous avez d√©j√† un bon moyen d'√©crire des applications Android qui r√©pondent aux principes architecturaux g√©n√©raux, vous ne devriez pas le changer.</i> <br><br>  Imaginez que nous cr√©ons une interface utilisateur qui affiche un profil utilisateur.  Nous utilisons une API priv√©e et une API REST pour r√©cup√©rer les donn√©es de profil. <br><br><h3>  Revue </h3><br>  Pour commencer, consid√©rons le sch√©ma d'interaction des modules de l'architecture de l'application finie: <br><br><img src="https://habrastorage.org/webt/lb/xq/cx/lbxqcxyjtoauqkif9hte7srpnm8.png"><br><br>  Veuillez noter que chaque composant d√©pend uniquement du composant un niveau en dessous.  Par exemple, l'activit√© et les fragments d√©pendent uniquement du mod√®le de vue.  Le r√©f√©rentiel est la seule classe qui d√©pend de nombreuses autres classes;  dans cet exemple, le stockage d√©pend d'un mod√®le de donn√©es persistant et d'une source de donn√©es interne distante. <br><br>  Ce mod√®le de conception cr√©e une exp√©rience utilisateur coh√©rente et agr√©able.  Que l'utilisateur revienne √† l'application quelques minutes apr√®s sa fermeture ou quelques jours plus tard, il verra instantan√©ment les informations utilisateur indiquant que l'application est enregistr√©e localement.  Si ces donn√©es sont obsol√®tes, le module de stockage d'application commence √† mettre √† jour les donn√©es en arri√®re-plan. <br><br><h3>  Cr√©er une interface utilisateur </h3><br>  L'interface utilisateur se compose du fragment <code>UserProfileFragment</code> et du <code>user_profile_layout.xml</code> disposition <code>user_profile_layout.xml</code> correspondant. <br><br>  Pour g√©rer l'interface utilisateur, notre mod√®le de donn√©es doit contenir les √©l√©ments de donn√©es suivants: <br><br><ul><li>  <b>ID</b> utilisateur <b>:</b> ID utilisateur.  La meilleure solution consiste √† transmettre ces informations au fragment √† l'aide des arguments du fragment.  Si le syst√®me d'exploitation Android d√©truit notre processus, ces informations sont enregistr√©es, de sorte que l'identifiant sera disponible la prochaine fois que nous lancerons notre application. </li><li>  <b>Objet utilisateur:</b> une classe de donn√©es qui contient des informations utilisateur. </li></ul><br>  Nous utilisons un <code>UserProfileViewModel</code> bas√© sur un composant de l'architecture ViewModel pour stocker ces informations. <br><br>  <i><u>L'objet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ViewModel</a> fournit des donn√©es pour un composant d'interface utilisateur sp√©cifique, tel qu'un fragment ou une activit√©, et contient une logique de traitement des donn√©es m√©tier pour interagir avec le mod√®le.</u></i>  <i><u>Par exemple, le <b>ViewModel</b> peut appeler d'autres composants pour charger des donn√©es et peut transmettre des demandes d'utilisateurs pour des modifications de donn√©es.</u></i>  <i><u><b>ViewModel</b> ne conna√Æt pas les composants de l'interface utilisateur, il n'est donc pas affect√© par les modifications de configuration, telles que la recr√©ation de l'activit√© lorsque le p√©riph√©rique est tourn√©.</u></i> <br><br>  Nous avons maintenant identifi√© les fichiers suivants: <br><br><ul><li>  <code>user_profile.xml</code> : disposition d'interface utilisateur d√©finie. </li><li>  <code>UserProfileFragment</code> : d√©crit un contr√¥leur d'interface utilisateur qui est responsable de l'affichage des informations √† l'utilisateur. </li><li>  <code>UserProfileViewModel</code> : une classe charg√©e de pr√©parer les donn√©es pour les afficher dans <code>UserProfileFragment</code> et r√©pondre √† l'interaction de l'utilisateur. </li></ul><br>  Les extraits de code suivants montrent le contenu initial de ces fichiers.  (Le fichier de mise en page est omis pour plus de simplicit√©.) <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserProfileViewModel</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ViewModel</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> userId : String = TODO() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> user : User = TODO() } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserProfileFragment</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Fragment</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> viewModel: UserProfileViewModel <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> viewModels() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( inflater: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">LayoutInflater</span></span></span></span><span class="hljs-function"><span class="hljs-params">, container: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewGroup</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">? )</span></span></span></span>: View { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> inflater.inflate(R.layout.main_fragment, container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) } }</code> </pre> <br>  Maintenant que nous avons ces modules de code, comment les connecter?  Une fois le champ utilisateur d√©fini dans la classe UserProfileViewModel, nous avons besoin d'un moyen d'informer l'interface utilisateur. <br><br>  <i><b>Remarque</b></i>  <i>SavedStateHandle permet au ViewModel d'acc√©der √† l'√©tat enregistr√© et aux arguments du fragment ou de l'action associ√©.</i> <br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// UserProfileViewModel class UserProfileViewModel( savedStateHandle: SavedStateHandle ) : ViewModel() { val userId : String = savedStateHandle["uid"] ?: throw IllegalArgumentException("missing user id") val user : User = TODO() } // UserProfileFragment private val viewModel: UserProfileViewModel by viewModels( factoryProducer = { SavedStateVMFactory(this) } ... )</span></span></code> </pre> <br>  Nous devons maintenant informer notre Fragment lorsque l'objet utilisateur est re√ßu.  C'est l√† que le composant de l'architecture LiveData appara√Æt. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LiveData</a> est un d√©tenteur de donn√©es observable.  D'autres composants de votre application peuvent suivre les modifications apport√©es aux objets √† l'aide de ce support, sans cr√©er de chemins de d√©pendance explicites et mat√©riels entre eux.  Le composant LiveData prend √©galement en compte l'√©tat du cycle de vie des composants de votre application, tels que les activit√©s, les fragments et les services, et inclut une logique de nettoyage pour √©viter les fuites d'objets et la consommation excessive de m√©moire. <br><br>  <i>Remarque</i>  <i>Si vous utilisez d√©j√† des biblioth√®ques comme RxJava ou Agera, vous pouvez continuer √† les utiliser √† la place de LiveData.</i>  <i>Cependant, lorsque vous utilisez des biblioth√®ques et des approches similaires, assurez-vous de g√©rer correctement le cycle de vie de votre application.</i>  <i>En particulier, assurez-vous de suspendre vos flux de donn√©es lorsque le LifecycleOwner associ√© est arr√™t√© et de d√©truire ces flux lorsque le LifecycleOwner associ√© a √©t√© d√©truit.</i>  <i>Vous pouvez √©galement ajouter l'artefact android.arch.lifecycle: jet streams pour utiliser LiveData avec une autre biblioth√®que de jet stream telle que RxJava2.</i> <br><br>  Pour inclure le composant LiveData dans notre application, nous changeons le type de champ dans <code>UserProfileViewModel</code> en LiveData.  <code>UserProfileFragment</code> d√©sormais inform√© des mises √† jour des donn√©es.  De plus, puisque ce champ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LiveData</a> prend en charge le cycle de vie, il efface automatiquement les liens lorsqu'ils ne sont plus n√©cessaires. <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserProfileViewModel</span></span></span></span>( savedStateHandle: SavedStateHandle ) : ViewModel() { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> userId : String = savedStateHandle[<span class="hljs-string"><span class="hljs-string">"uid"</span></span>] ?: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"missing user id"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> user : LiveData&lt;User&gt; = TODO() }</code> </pre> <br>  Maintenant, nous modifions <code>UserProfileFragment</code> pour observer les donn√©es dans le <code>ViewModel</code> et pour mettre √† jour l'interface utilisateur en fonction des changements: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onViewCreated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">, savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onViewCreated(view, savedInstanceState) viewModel.user.observe(viewLifecycleOwner) { <span class="hljs-comment"><span class="hljs-comment">//  UI } }</span></span></code> </pre> <br>  Chaque fois que les donn√©es du profil utilisateur sont mises √† jour, le rappel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">onChanged ()</a> est appel√© et l'interface utilisateur est mise √† jour. <br><br>  Si vous connaissez d'autres biblioth√®ques qui utilisent des rappels observables, vous avez peut-√™tre r√©alis√© que nous n'avons pas red√©fini la m√©thode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">onStop ()</a> du fragment pour arr√™ter l'observation des donn√©es.  Cette √©tape est facultative pour LiveData car elle prend en charge le cycle de vie, ce qui signifie qu'elle n'appellera pas le rappel <code>onChanged()</code> si le fragment est dans un √©tat inactif;  c'est-√†-dire qu'il a re√ßu un appel √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">onStart ()</a> , mais n'a pas encore re√ßu <code>onStop()</code> ).  LiveData supprime √©galement automatiquement l'observateur lors de l'appel de la m√©thode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">onDestroy ()</a> sur le fragment. <br><br>  Nous n'avons ajout√© aucune logique pour g√©rer les modifications de configuration, telles que la rotation de l'√©cran de l'appareil par l'utilisateur.  <code>UserProfileViewModel</code> automatiquement restaur√© lorsque la configuration est modifi√©e, donc d√®s qu'un nouveau fragment est cr√©√©, il obtient la m√™me instance de <code>ViewModel</code> et le rappel est appel√© imm√©diatement √† l'aide des donn√©es actuelles.  √âtant donn√© que les objets <code>ViewModel</code> sont con√ßus pour survivre aux objets <code>View</code> correspondants qu'ils mettent √† jour, vous ne devez pas inclure de r√©f√©rences directes aux objets <code>View</code> dans votre impl√©mentation ViewModel.  Pour plus d'informations sur la dur√©e de vie du <code>ViewModel</code> correspond au cycle de vie des composants de l'interface utilisateur, voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ViewModel Life Cycle.</a> <br><br><h3>  R√©cup√©ration de donn√©es </h3><br>  Maintenant que nous avons utilis√© LiveData pour connecter <code>UserProfileViewModel</code> √† <code>UserProfileFragment</code> , comment pouvons-nous obtenir les donn√©es de profil utilisateur? <br><br>  Dans cet exemple, nous supposons que notre backend fournit une API REST.  Nous utilisons la biblioth√®que Retrofit pour acc√©der √† notre backend, bien que vous puissiez utiliser une biblioth√®que diff√©rente qui sert le m√™me objectif. <br><br>  Voici notre d√©finition d'un <code>Webservice</code> qui relie √† notre backend: <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Webservice</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@GET</span></span></span><span class="hljs-comment"> declares an HTTP GET request * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Path</span></span></span><span class="hljs-comment">("user") annotation on the userId parameter marks it as a * replacement for the {user} placeholder in the </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@GET</span></span></span><span class="hljs-comment"> path */</span></span> <span class="hljs-meta"><span class="hljs-meta">@GET(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/users/{user}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@Path(</span></span></span><span class="hljs-meta-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta"><span class="hljs-meta-string">"user"</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">)</span></span></span></span><span class="hljs-function"><span class="hljs-params"> userId: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Call&lt;User&gt; }</code> </pre> <br>  Une premi√®re id√©e pour impl√©menter un <code>ViewModel</code> pourrait impliquer d'appeler <code>Webservice</code> pour r√©cup√©rer les donn√©es et affecter ces donn√©es √† notre objet <code>LiveData</code> .  Cette conception fonctionne, mais son utilisation rend notre application plus difficile √† maintenir √† mesure qu'elle grandit.  Cela donne trop de responsabilit√© √† la classe <code>UserProfileViewModel</code> , qui viole le principe de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">s√©paration des int√©r√™ts</a> .  De plus, la port√©e du ViewModel est associ√©e au cycle de vie de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">activit√©</a> ou du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fragment</a> , ce qui signifie que les donn√©es du <code>Webservice</code> perdues lorsque le cycle de vie de l'objet d'interface utilisateur associ√© se termine.  Ce comportement cr√©e une exp√©rience utilisateur ind√©sirable. <br><br>  Au lieu de cela, notre <code>ViewModel</code> d√©l√®gue le processus de r√©cup√©ration des donn√©es √† un nouveau module de stockage. <br><br>  <u><i><b>Les</b> modules du <b>r√©f√©rentiel</b> g√®rent les op√©rations de donn√©es.</i></u>  <u><i>Ils fournissent une API propre pour que le reste de l'application puisse facilement obtenir ces donn√©es.</i></u>  <u><i>Ils savent o√π obtenir les donn√©es et quels appels d'API effectuer lors de la mise √† jour des donn√©es.</i></u>  <u><i>Vous pouvez consid√©rer les r√©f√©rentiels comme des interm√©diaires entre diff√©rentes sources de donn√©es, telles que les mod√®les persistants, les services Web et les caches.</i></u> <br><br>  Notre classe <code>UserRepository</code> , illustr√©e dans l'extrait de code suivant, utilise une instance de <code>WebService</code> pour r√©cup√©rer les donn√©es utilisateur: <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserRepository</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> webservice: Webservice = TODO() <span class="hljs-comment"><span class="hljs-comment">// ... fun getUser(userId: String): LiveData&lt;User&gt; { //    .    . val data = MutableLiveData&lt;User&gt;() webservice.getUser(userId).enqueue(object : Callback&lt;User&gt; { override fun onResponse(call: Call&lt;User&gt;, response: Response&lt;User&gt;) { data.value = response.body() } //     . override fun onFailure(call: Call&lt;User&gt;, t: Throwable) { TODO() } }) return data } }</span></span></code> </pre> <br>  Bien que le module de stockage semble inutile, il sert un objectif important: il extrait les sources de donn√©es du reste de l'application.  Maintenant, notre <code>UserProfileViewModel</code> ne sait pas comment r√©cup√©rer des donn√©es, nous pouvons donc fournir des mod√®les de pr√©sentation avec des donn√©es obtenues √† partir de plusieurs impl√©mentations d'extraction de donn√©es diff√©rentes. <br><br>  <b>Remarque</b>  Nous avons rat√© le cas des erreurs de r√©seau pour plus de simplicit√©.  Pour une impl√©mentation alternative qui expose les erreurs et l'√©tat de t√©l√©chargement, voir l'annexe: divulgation de l'√©tat du r√©seau. <br><br>  <b>Gestion des d√©pendances entre les composants</b> <br><br>  La classe <code>UserRepository</code> ci-dessus a besoin d'une instance de <code>Webservice</code> pour r√©cup√©rer les donn√©es utilisateur.  Il pourrait simplement cr√©er une instance, mais pour cela, il doit √©galement conna√Ætre les d√©pendances de la classe <code>Webservice</code> .  De plus, <code>UserRepository</code> n'est probablement pas la seule classe √† avoir besoin d'un service Web.  Cette situation nous oblige √† dupliquer le code, car chaque classe qui a besoin d'un lien vers le <code>Webservice</code> doit savoir comment le cr√©er et ses d√©pendances.  Si chaque classe cr√©e un nouveau <code>WebService</code> , notre application peut devenir tr√®s gourmande en ressources. <br><br>  Pour r√©soudre ce probl√®me, vous pouvez utiliser les mod√®les de conception suivants: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Injection de d√©pendance (DI)</a> .  L'injection de d√©pendances permet aux classes de d√©finir leurs d√©pendances sans les cr√©er.  Au moment de l'ex√©cution, une autre classe est charg√©e de fournir ces d√©pendances.  Nous recommandons la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dagger 2</a> pour impl√©menter l'injection de d√©pendances dans les applications Android.  Dagger 2 cr√©e automatiquement des objets, en contournant l'arborescence des d√©pendances et fournit des garanties de compilation pour les d√©pendances. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">(Emplacement du service) Localisateur de services</a> : le mod√®le de localisateur de services fournit un registre dans lequel les classes peuvent obtenir leurs d√©pendances au lieu de les cr√©er. </li></ul><br>  L'impl√©mentation d'un registre de services est plus facile que l'utilisation de DI, donc si vous d√©butez avec DI, utilisez plut√¥t le template: service location. <br><br>  Ces mod√®les vous permettent de faire √©voluer votre code car ils fournissent des mod√®les clairs pour g√©rer les d√©pendances sans dupliquer ou compliquer le code.  De plus, ces mod√®les vous permettent de basculer rapidement entre les impl√©mentations de test et de production d'√©chantillonnage de donn√©es. <br><br>  Notre exemple d'application utilise <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dagger 2</a> pour g√©rer les d√©pendances de l'objet <code>Webservice</code> . <br><br><h3>  Connectez ViewModel et Storage </h3><br>  Maintenant, nous modifions notre <code>UserProfileViewModel</code> pour utiliser l'objet <code>UserRepository</code> : <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserProfileViewModel</span></span></span><span class="hljs-class"> </span><span class="hljs-meta"><span class="hljs-class"><span class="hljs-meta">@Inject</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">constructor</span></span></span></span>( savedStateHandle: SavedStateHandle, userRepository: UserRepository ) : ViewModel() { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> userId : String = savedStateHandle[<span class="hljs-string"><span class="hljs-string">"uid"</span></span>] ?: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"missing user id"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> user : LiveData&lt;User&gt; = userRepository.getUser(userId) }</code> </pre> <br><h3>  Mise en cache </h3><br>  L'impl√©mentation <code>UserRepository</code> r√©sume l'invocation de l'objet <code>Webservice</code> , mais comme elle ne repose que sur une seule source de donn√©es, elle n'est pas tr√®s flexible. <br><br>  Le principal probl√®me avec la mise en ≈ìuvre de <code>UserRepository</code> est qu'apr√®s avoir re√ßu des donn√©es de notre backend, ces donn√©es ne sont stock√©es nulle part.  Par cons√©quent, si l'utilisateur quitte <code>UserProfileFragment</code> puis y revient, notre application doit r√©cup√©rer les donn√©es, m√™me si elles n'ont pas chang√©. <br><br>  Cette conception n'est pas optimale pour les raisons suivantes: <br><br><ul><li>  Il d√©pense de pr√©cieuses ressources de trafic. </li><li>  Cela oblige l'utilisateur √† attendre la fin d'une nouvelle demande. </li></ul><br>  Pour rem√©dier √† ces lacunes, nous ajoutons une nouvelle source de donn√©es √† notre <code>UserRepository</code> , qui met en cache <code>User</code> objets <code>User</code> en m√©moire: <br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// Dagger,        . @Singleton class UserRepository @Inject constructor( private val webservice: Webservice, //    .    . private val userCache: UserCache ) { fun getUser(userId: String): LiveData&lt;User&gt; { val cached = userCache.get(userId) if (cached != null) { return cached } val data = MutableLiveData&lt;User&gt;() userCache.put(userId, data) //     ,  ,  . //      . webservice.getUser(userId).enqueue(object : Callback&lt;User&gt; { override fun onResponse(call: Call&lt;User&gt;, response: Response&lt;User&gt;) { data.value = response.body() } //     . override fun onFailure(call: Call&lt;User&gt;, t: Throwable) { TODO() } }) return data } }</span></span></code> </pre> <br><h3>  Donn√©es persistantes </h3><br>  En utilisant notre impl√©mentation actuelle, si l'utilisateur fait pivoter l'appareil ou quitte et revient imm√©diatement √† l'application, l'interface utilisateur existante devient imm√©diatement visible, car le magasin r√©cup√®re les donn√©es de notre cache en m√©moire. <br><br>  Cependant, que se passe-t-il si un utilisateur quitte l'application et revient quelques heures apr√®s la fin du processus sous Android OS?  En nous appuyant sur notre impl√©mentation actuelle dans cette situation, nous devons √† nouveau r√©cup√©rer les donn√©es du r√©seau.  Ce processus de mise √† niveau n'est pas seulement une mauvaise exp√©rience utilisateur;  c'est aussi un gaspillage car il consomme de pr√©cieuses donn√©es mobiles. <br><br>  Vous pouvez r√©soudre ce probl√®me en mettant en cache les demandes Web, mais cela cr√©e un nouveau probl√®me cl√©: que se passe-t-il si les m√™mes donn√©es utilisateur sont affich√©es dans une demande d'un type diff√©rent, par exemple, lors de la r√©ception d'une liste d'amis?  L'application affichera des donn√©es contradictoires, ce qui est au mieux d√©routant.  Par exemple, notre application peut afficher deux versions diff√©rentes des donn√©es du m√™me utilisateur si l'utilisateur a envoy√© une demande de liste d'amis et une demande mono-utilisateur √† des moments diff√©rents.  Notre application devrait comprendre comment combiner ces donn√©es contradictoires. <br><br>  La bonne fa√ßon de g√©rer cette situation est d'utiliser un mod√®le constant.  La biblioth√®que de donn√©es permanentes (DB) de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pi√®ce</a> vient √† notre aide. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Room</a> est une biblioth√®que de cartographie d'objets qui fournit un stockage de donn√©es local avec un code standard minimum.  Au moment de la compilation, il v√©rifie la conformit√© de chaque requ√™te avec votre sch√©ma de donn√©es, de sorte que les requ√™tes SQL qui ne fonctionnent pas entra√Ænent des erreurs au moment de la compilation et non des blocages d'ex√©cution.  R√©sum√©s de salle de certains d√©tails de base de l'impl√©mentation des tables et requ√™tes SQL brutes.  Il vous permet √©galement d'observer les changements dans les donn√©es de base de donn√©es, y compris les collections et les demandes de connexion, exposant ces changements √† l'aide d'objets LiveData.  Il d√©finit m√™me explicitement les contraintes d'ex√©cution qui r√©solvent les probl√®mes de threads courants, tels que l'acc√®s au stockage dans le thread principal. <br><br>  <i><b>Remarque</b></i>  <i>Si votre application utilise d√©j√† une autre solution, telle que le mappage relationnel objet SQLite (ORM), vous n'avez pas besoin de remplacer la solution existante par Room.</i>  <i>Cependant, si vous √©crivez une nouvelle application ou r√©organisez une application existante, nous vous recommandons d'utiliser Room pour enregistrer vos donn√©es d'application.</i>  <i>Ainsi, vous pouvez profiter de l'abstraction de la biblioth√®que et de la validation des requ√™tes.</i> <br><br>  Pour utiliser Room, nous devons d√©finir notre disposition locale.  Tout d'abord, nous ajoutons l'annotation <code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@Entity</a></code> √† notre classe de mod√®le de donn√©es <code>User</code> et l'annotation <code>@PrimaryKey</code> dans le champ <code>id</code> la classe.  Ces annotations marquent l' <code>User</code> comme table dans notre base de donn√©es et <code>id</code> comme cl√© primaire de la table: <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span></span>( <span class="hljs-meta"><span class="hljs-meta">@PrimaryKey</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> id: String, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> lastName: String )</code> </pre> <br>  Ensuite, nous cr√©ons la classe de base de donn√©es en impl√©mentant <code>RoomDatabase</code> pour notre application: <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Database(entities = [User::class], version = 1)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserDatabase</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RoomDatabase</span></span></span></span>()</code> </pre> <br>  Notez que <code>UserDatabase</code> est abstrait.  La biblioth√®que de salle fournit automatiquement une impl√©mentation de cela.  Voir la documentation de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Room</a> pour plus de d√©tails. <br><br>  Nous avons maintenant besoin d'un moyen d'ins√©rer des donn√©es utilisateur dans la base de donn√©es.  Pour cette t√¢che, nous cr√©ons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un objet d'acc√®s aux donn√©es (DAO)</a> . <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Dao</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserDao</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Insert(onConflict = REPLACE)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(user: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">User</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-meta"><span class="hljs-meta">@Query(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"SELECT * FROM user WHERE id = :userId"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(userId: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: LiveData&lt;User&gt; }</code> </pre> <br>  Notez que la m√©thode de <code>load</code> renvoie un objet de type LiveData.  La salle sait quand la base de donn√©es est modifi√©e et informe automatiquement tous les observateurs actifs des changements de donn√©es.  Puisque Room utilise <i>LiveData</i> , cette op√©ration est efficace;  il met √† jour les donn√©es uniquement s'il y a au moins un observateur actif. <br><br>  <i><b>Remarque: La</b> salle v√©rifie l'invalidation en fonction des modifications de la table, ce qui signifie qu'elle peut envoyer des notifications fausses positives.</i> <br><br>  Apr√®s avoir d√©fini notre classe <code>UserDao</code> , nous r√©f√©ren√ßons ensuite le DAO √† partir de notre classe de base de donn√©es: <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Database(entities = [User::class], version = 1)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserDatabase</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RoomDatabase</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">userDao</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: UserDao }</code> </pre> <br>  Nous pouvons maintenant modifier notre <code>UserRepository</code> d' <code>UserRepository</code> pour inclure la source de donn√©es de la salle: <br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">//  Dagger,         . @Singleton class UserRepository @Inject constructor( private val webservice: Webservice, //    .    . private val executor: Executor, private val userDao: UserDao ) { fun getUser(userId: String): LiveData&lt;User&gt; { refreshUser(userId) //   LiveData    . return userDao.load(userId) } private fun refreshUser(userId: String) { //    . executor.execute { // ,      . val userExists = userDao.hasUser(FRESH_TIMEOUT) if (!userExists) { //  . val response = webservice.getUser(userId).execute() //    . //   .  LiveData  , //        . userDao.save(response.body()!!) } } } companion object { val FRESH_TIMEOUT = TimeUnit.DAYS.toMillis(1) } }</span></span></code> </pre> <br>  Veuillez noter que m√™me si nous avons chang√© la source de donn√©es dans <code>UserRepository</code> , nous n'avons pas eu besoin de changer notre <code>UserProfileViewModel</code> ou <code>UserProfileFragment</code> .  Cette petite mise √† jour d√©montre la flexibilit√© de notre architecture d'application.  Il est √©galement id√©al pour les tests car nous pouvons fournir un faux <code>UserRepository</code> et tester notre production <code>UserProfileViewModel</code> en m√™me temps. <br><br>  Si les utilisateurs reviennent dans quelques jours, une application utilisant cette architecture est susceptible d'afficher des informations obsol√®tes jusqu'√† ce que le r√©f√©rentiel re√ßoive des informations mises √† jour.  Selon votre cas d'utilisation, vous pouvez ne pas afficher d'informations obsol√®tes.  Au lieu de cela, vous pouvez afficher <i>des</i> donn√©es d' <i>espace r√©serv√©</i> , qui affichent des valeurs fictives et indiquent que votre application t√©l√©charge et charge actuellement des informations √† jour. <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La seule source de v√©rit√©.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> En r√®gle g√©n√©rale, diff√©rents points de terminaison de l'API REST renvoient les m√™mes donn√©es. Par exemple, si notre backend a un autre point de terminaison qui renvoie une liste d'amis, le m√™me objet utilisateur peut provenir de deux points de terminaison API diff√©rents, √©ventuellement m√™me en utilisant diff√©rents niveaux de d√©tail. Si nous </font></font><code>UserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">renvoyions la r√©ponse de la demande </font></font><code>Webservice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">telle quelle, sans v√©rifier la coh√©rence, nos interfaces utilisateur pourraient afficher des informations confuses, car la version et le format des donn√©es du stockage d√©pendraient du dernier point de terminaison appel√©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour cette raison, notre impl√©mentation </font></font><code>UserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stocke les r√©ponses des services Web dans une base de donn√©es. Les modifications apport√©es √† la base de donn√©es d√©clenchent ensuite des rappels pour les objets </font><i><font style="vertical-align: inherit;">LiveData</font></i><font style="vertical-align: inherit;"> actifs</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En utilisant ce mod√®le, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la base de donn√©es est la seule source de v√©rit√©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et d'autres parties de l'application y acc√®dent via la n√¥tre </font></font><code>UserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Que vous utilisiez ou non un cache disque, nous recommandons que votre r√©f√©rentiel identifie la source de donn√©es comme la seule source de v√©rit√© pour le reste de votre application.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Afficher la progression de l'op√©ration </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans certains cas d'utilisation, comme le pull-to-refresh, il est important que l'interface utilisateur montre √† l'utilisateur qu'une op√©ration r√©seau est en cours. </font><font style="vertical-align: inherit;">Il est recommand√© de s√©parer l'action de l'interface utilisateur des donn√©es r√©elles, car les donn√©es peuvent √™tre mises √† jour pour diverses raisons. </font><font style="vertical-align: inherit;">Par exemple, si nous obtenons une liste d'amis, le m√™me utilisateur peut √™tre s√©lectionn√© √† nouveau par programme, ce qui entra√Ænera une mise √† jour de LiveData. </font><font style="vertical-align: inherit;">Du point de vue de l'interface utilisateur, le fait d'avoir une requ√™te en vol n'est qu'un autre point de donn√©es, similaire √† n'importe quelle autre donn√©e dans l'objet lui-m√™me </font></font><code>User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous pouvons utiliser l'une des strat√©gies suivantes pour afficher l'√©tat de mise √† jour des donn√©es convenu dans l'interface utilisateur, ind√©pendamment de l'origine de la demande de mise √† jour des donn√©es: </font></font><br><br><ul><li>  <code>getUser ()</code> ,      <code>LiveData</code> .         .  ,   NetworkBoundResource   GitHub <a href="">android-Architecture-components</a> . </li><li>       <code>UserRepository</code> ,      .    ,              ,         ,   pull-to-refresh. </li></ul><br><h3>    </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans la section sur la s√©paration des int√©r√™ts, nous avons mentionn√© que l'un des principaux avantages de suivre ce principe est la testabilit√©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La liste suivante montre comment tester chaque module de code √† partir de notre exemple √©tendu:</font></font><br><br><ul><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interface utilisateur et interaction</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : utilisez la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bo√Æte √† outils de test de l'interface utilisateur Android</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">La meilleure fa√ßon de cr√©er ce test est d'utiliser la biblioth√®que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espresso</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vous pouvez cr√©er un fragment et lui fournir une mise en page </font></font><code>UserProfileViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">√âtant donn√© que le fragment n'est associ√© qu'√† </font></font><code>UserProfileViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, la simulation </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(imitation) de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cette seule classe suffit pour tester compl√®tement l'interface utilisateur de votre application.</font></font></li><li> <b>ViewModel:</b>     <code>UserProfileViewModel</code>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JUnit</a> .      , <code>UserRepository</code> . </li><li> <b>UserRepository:</b>     <code>UserRepository</code>    JUnit.    <code>Webservice</code>  <code>UserDao</code> .      : <br><br><ul><li>     -. </li><li>      . </li><li>     ,     . </li></ul><br></li><li>   <code>Webservice</code> ,  <code>UserDao</code>  ,             . </li><li> <b>UserDao:</b>   DAO    .       -   ,   .        ,  ,      ,        ‚Ä¶ <br><br> <i><b>:</b> Room     ,    DAO,   JSQL  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SupportSQLiteOpenHelper</a></b> .     ,      SQLite     SQLite   .</i> </li><li> <b>-:</b>         .   ,  -,      .  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://github.com/square/ok">MockWebServer</a> ,          . </li><li> <b> :</b>     maven    .    <code>androidx.arch.core</code> :    JUnit: <br><br><ul><li> <code>InstantTaskExecutorRule:</code>            . </li><li> <code>CountingTaskExecutorRule:</code>         .        Espresso     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> . </li></ul><br></li></ul><br><h2>   </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La programmation est un domaine cr√©atif et la cr√©ation d'applications Android ne fait pas exception. Il existe de nombreuses fa√ßons de r√©soudre le probl√®me, qu'il s'agisse de transf√©rer des donn√©es entre plusieurs actions ou fragments, de r√©cup√©rer des donn√©es supprim√©es et de les stocker localement hors ligne, ou de nombreux autres sc√©narios courants rencontr√©s par des applications non triviales. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bien que les recommandations suivantes ne soient pas requises, notre exp√©rience montre que leur impl√©mentation rend votre base de code plus fiable, testable et prise en charge √† long terme: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©vitez de d√©signer les points d'entr√©e de votre application - tels que les actions, les services et les r√©cepteurs de diffusion - comme sources de donn√©es.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au lieu de cela, ils ont seulement besoin de se coordonner avec d'autres composants pour obtenir un sous-ensemble des donn√©es li√©es √† ce point d'entr√©e. Chaque composant de l'application est assez √©ph√©m√®re, selon l'interaction de l'utilisateur avec son appareil et l'√©tat g√©n√©ral actuel du syst√®me. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©ez des lignes de responsabilit√© claires entre les diff√©rents modules de votre application.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Par exemple, ne distribuez pas de code qui t√©l√©charge des donn√©es du r√©seau vers plusieurs classes ou packages de votre base de code. De m√™me, ne d√©finissez pas plusieurs responsabilit√©s non li√©es - telles que la mise en cache et la liaison de donn√©es - dans la m√™me classe. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exposez le moins possible de chaque module.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©sistez √† la tentation de cr√©er une √©tiquette ¬´juste un¬ª qui r√©v√®le les d√©tails d'une impl√©mentation interne d'un module. Vous pouvez gagner du temps √† court terme, mais vous encourrez alors une dette technique plusieurs fois √† mesure que votre base de code se d√©veloppera. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©fl√©chissez √† la fa√ßon de rendre chaque module testable de mani√®re isol√©e.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Par exemple, avoir une API bien d√©finie pour r√©cup√©rer des donn√©es du r√©seau facilite le test d'un module qui stocke ces donn√©es dans une base de donn√©es locale. Si au contraire vous m√©langez la logique de ces deux modules en un seul endroit ou distribuez votre code r√©seau √† travers la base de code, le test devient beaucoup plus difficile - dans certains cas, m√™me pas impossible. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Concentrez-vous sur le c≈ìur unique de votre application pour vous d√©marquer des autres applications.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ne r√©inventez pas la roue en √©crivant le m√™me motif encore et encore. Au lieu de cela, concentrez votre temps et votre √©nergie sur ce qui rend votre application unique et laissez les composants de l'architecture Android et les autres biblioth√®ques recommand√©es faire face √† un mod√®le r√©p√©titif. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conservez autant de donn√©es pertinentes et r√©centes que possible.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ainsi, les utilisateurs peuvent profiter des fonctionnalit√©s de votre application, m√™me si leur appareil est hors ligne. N'oubliez pas que tous vos utilisateurs n'utilisent pas une connexion haut d√©bit constante. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©signez une seule source de donn√©es comme seule v√©ritable source.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Chaque fois que votre application a besoin d'acc√©der √† cette donn√©e, elle doit toujours provenir de cette seule source de v√©rit√©.</font></font><br><br><h3> <u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Addendum: divulgation de l'√©tat du r√©seau</font></font></u> </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans la section ci-dessus de l'architecture d'application recommand√©e, nous avons ignor√© les erreurs r√©seau et les √©tats de d√©marrage pour simplifier les extraits de code. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette section montre comment afficher l'√©tat du r√©seau √† l'aide de la classe Resource, qui encapsule √† la fois les donn√©es et son √©tat. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'extrait de code suivant fournit un exemple d'impl√©mentation</font></font><code>Resource:</code> <br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,         . sealed class Resource&lt;T&gt;( val data: T? = null, val message: String? = null ) { class Success&lt;T&gt;(data: T) : Resource&lt;T&gt;(data) class Loading&lt;T&gt;(data: T? = null) : Resource&lt;T&gt;(data) class Error&lt;T&gt;(message: String, data: T? = null) : Resource&lt;T&gt;(data, message) }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âtant donn√© que le t√©l√©chargement de donn√©es √† partir du r√©seau lors de l'affichage d'une copie de ces donn√©es est une pratique courante, il est utile de cr√©er une classe d'assistance qui peut √™tre r√©utilis√©e √† plusieurs endroits. Pour cet exemple, nous cr√©ons une classe avec le nom </font></font><code>NetworkBoundResource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le diagramme suivant montre l'arbre de d√©cision pour </font></font><code>NetworkBoundResource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br><br><img src="https://habrastorage.org/webt/e1/wv/c9/e1wvc9un_w2t8jyi0kiky8wagw0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il commence par observer la base de donn√©es de la ressource. Lorsqu'un enregistrement est t√©l√©charg√© depuis la base de donn√©es pour la premi√®re fois, il </font></font><code>NetworkBoundResource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v√©rifie si le r√©sultat est suffisamment bon pour √™tre envoy√© ou s'il doit √™tre r√©cup√©r√© sur le r√©seau. Veuillez noter que ces deux situations peuvent se produire simultan√©ment, √©tant donn√© que vous souhaitez probablement afficher les donn√©es mises en cache lors de la mise √† jour √† partir du r√©seau.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si l'appel r√©seau r√©ussit, il stocke la r√©ponse dans la base de donn√©es et r√©initialise le flux. En cas d' </font></font><code>NetworkBoundResource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©chec </font><font style="vertical-align: inherit;">d'une demande de r√©seau </font><font style="vertical-align: inherit;">, il envoie l'√©chec directement. </font></font><br><br> <code><b>.</b>             .       ,       .</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gardez √† l'esprit que compter sur une base de donn√©es pour envoyer des modifications implique l'utilisation d'effets secondaires associ√©s, ce qui n'est pas tr√®s bon car le comportement ind√©fini de ces effets secondaires peut se produire si la base de donn√©es n'envoie pas les modifications car les donn√©es n'ont pas chang√©.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N'envoyez pas non plus les r√©sultats re√ßus du r√©seau, car cela viole le principe d'une seule source de v√©rit√©. </font><font style="vertical-align: inherit;">Au final, il est possible que la base de donn√©es contienne des d√©clencheurs qui modifient les valeurs des donn√©es lors de l'op√©ration de sauvegarde. </font><font style="vertical-align: inherit;">De m√™me, n'envoyez pas ¬´SUCC√àS¬ª sans nouvelles donn√©es, car alors le client recevra la mauvaise version des donn√©es. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'extrait de code suivant montre l'API ouverte fournie par la classe </font></font><code>NetworkBoundResource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour ses sous-classes:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// ResultType:   . // RequestType:   API. abstract class NetworkBoundResource&lt;ResultType, RequestType&gt; { //      API   . @WorkerThread protected abstract fun saveCallResult(item: RequestType) //      ,  ,    //     . @MainThread protected abstract fun shouldFetch(data: ResultType?): Boolean //        . @MainThread protected abstract fun loadFromDb(): LiveData&lt;ResultType&gt; //     API. @MainThread protected abstract fun createCall(): LiveData&lt;ApiResponse&lt;RequestType&gt;&gt; // ,    .   //    ,    . protected open fun onFetchFailed() {} //   LiveData,  , //    . fun asLiveData(): LiveData&lt;ResultType&gt; = TODO() }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Faites attention aux d√©tails importants suivants de la d√©finition de classe: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il d√©finit deux param√®tres de type, </font></font><code>ResultType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>RequestType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puisque le type de donn√©es renvoy√© par l'API peut ne pas correspondre au type de donn√©es utilis√© localement.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il utilise une classe </font></font><code>ApiResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour les requ√™tes r√©seau. </font></font><code>ApiResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Est un simple wrapper pour une classe </font></font><code>Retrofit2.Call</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui convertit les r√©ponses en instances </font></font><code>LiveData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'impl√©mentation compl√®te de la classe </font></font><code>NetworkBoundResource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">appara√Æt dans le cadre du projet </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub android-Architecture-components</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une fois cr√©√©, </font></font><code>NetworkBoundResource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous pouvons l'utiliser pour √©crire nos impl√©mentations de disque et de r√©seau </font></font><code>User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans la classe </font></font><code>UserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">//  Dagger2,         . @Singleton class UserRepository @Inject constructor( private val webservice: Webservice, private val userDao: UserDao ) { fun getUser(userId: String): LiveData&lt;User&gt; { return object : NetworkBoundResource&lt;User, User&gt;() { override fun saveCallResult(item: User) { userDao.save(item) } override fun shouldFetch(data: User?): Boolean { return rateLimiter.canFetch(userId) &amp;&amp; (data == null || !isFresh(data)) } override fun loadFromDb(): LiveData&lt;User&gt; { return userDao.load(userId) } override fun createCall(): LiveData&lt;ApiResponse&lt;User&gt;&gt; { return webservice.getUser(userId) } }.asLiveData() } }</span></span></code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr456256/">https://habr.com/ru/post/fr456256/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr456240/index.html">D√©veloppement de chatbot (laravel + botman)</a></li>
<li><a href="../fr456242/index.html">Un peu plus sur le multit√¢che dans les microcontr√¥leurs</a></li>
<li><a href="../fr456246/index.html">√âl√©ment z√©ro</a></li>
<li><a href="../fr456248/index.html">Comment j'ai attrap√©: avant les styles pour un √©l√©ment de focus</a></li>
<li><a href="../fr456250/index.html">Localisation d'applications et prise en charge RTL. Signaler Yandex.Taxi</a></li>
<li><a href="../fr456258/index.html">Free as a wind et free as a beer traduction de ¬´Free as in Freedom¬ª en russe sous la licence GNU FDL 1.3</a></li>
<li><a href="../fr456260/index.html">Discussion sur l'√©conomie √©quitable</a></li>
<li><a href="../fr456262/index.html">Radio d√©finie par logiciel - comment √ßa marche? Partie 9</a></li>
<li><a href="../fr456264/index.html">Cr√©ez des fichiers binaires Android √† l'aide de la source et d'Android NDK. Nous pompons l'utilitaire screencap</a></li>
<li><a href="../fr456266/index.html">Le condens√© de mat√©riaux int√©ressants pour le d√©veloppeur mobile # 302 (du 10 au 16 juin)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>