<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëáüèΩ ‚òÄÔ∏è üêù Bonsai: motor wiki familiar üåØ üë©üèª‚Äçüç≥ üßëüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introducci√≥n l√≠rica 
 Una tarde, al poner las cosas en orden en un armario de pared, me top√© con una gran caja de cart√≥n. Sobrevivi√≥ a dos reubicacion...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bonsai: motor wiki familiar</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438622/"><h4>  Introducci√≥n l√≠rica </h4><br>  Una tarde, al poner las cosas en orden en un armario de pared, me top√© con una gran caja de cart√≥n.  Sobrevivi√≥ a dos reubicaciones y no abri√≥ durante tantos a√±os que olvid√© por completo lo que estaba almacenado en √©l.  Result√≥ que hab√≠a fotos, en √°lbumes, en sobres de una tienda, y algunas eran as√≠. <br><br>  Muchas fotograf√≠as fueron tomadas hace m√°s de setenta a√±os.  Uno era abuelo: en su √©poca de estudiante, todav√≠a joven y guapo, con gafas absolutamente <i>destructivas</i> .  "Wow, mi abuelo usaba ropa hipster incluso antes de que se convirtiera en la corriente principal", pens√©, e involuntariamente sonre√≠.  Lo reconoc√≠ de inmediato, pero luego tom√© fotos de personas de las que no recuerdo nada.  En los rasgos faciales, puedes adivinar vagamente la relaci√≥n, y eso es todo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/030/417/94a/03041794abba8a11f5c660bb249ec9fb.png"><br><br>  Cuando ten√≠a quince a√±os, mi abuela mostr√≥ repetidamente estas tarjetas y habl√≥ sobre los que est√°n representados en ellas.  Desafortunadamente, el valor de tales historias se entiende solo cuando no hay nadie para contarlas.  En ese momento, por d√©cima vez fue absolutamente desinteresado escuchar algunos cuentos cubiertos de musgo sobre los a√±os anteriores a la guerra, los rechac√© y les hice caso.  Ahora, de repente, al darme cuenta de que parte de la historia de mi familia estaba irremediablemente perdida, tuve la idea de sistematizar y preservar lo que quedaba. <br><br>  La soluci√≥n ideal para almacenar datos familiares me pareci√≥ un h√≠brido de un motor wiki y un √°lbum de fotos.  No hab√≠a soluciones adecuadas ya hechas, as√≠ que tuve que escribir la m√≠a.  Se llama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Bonsai</a> y es de c√≥digo abierto bajo la licencia MIT.  Luego habr√° una historia sobre c√≥mo est√° organizada y c√≥mo usarla, as√≠ como la historia de su desarrollo y un poco de <i>DRAMA</i> . <a name="habracut"></a><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b82/efe/8e3/b82efe8e382a652be0aa4882f500dff5.jpg"><br><br><h4>  Otra bicicleta? </h4><br>  Hoy en d√≠a, hay muchas herramientas que le permiten crear √°rboles geneal√≥gicos y catalogar informaci√≥n sobre parientes.  Se dividen condicionalmente en dos grandes categor√≠as: servicios en l√≠nea y aplicaciones de escritorio. <br><br>  En el caso de una aplicaci√≥n de escritorio, la base de datos generalmente se almacena como un archivo en el disco.  Abre la aplicaci√≥n y la repone en modo de usuario √∫nico.  Si es necesario, los datos se pueden exportar para hacer una copia de seguridad o transferirlos a otro sistema (por ejemplo, en formato <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GEDCOM</a> ).  De los que vi, el m√°s agradable de usar parec√≠a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Gramps</a> (gratis) y el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Life Tree</a> dom√©stico (requiere una compra √∫nica). <br><br>  El lado opuesto del espectro son los servicios web.  Almacenan sus datos en servidores remotos y cobran una tarifa de uso peri√≥dica.  Dado que este es un producto comercial con una base centralizada y una buena monetizaci√≥n, los servicios de este plan le brindan la oportunidad, por ejemplo, de buscar familiares perdidos mediante pruebas de ADN o registros de archivo. <br><br>  Los pros y los contras de ambas opciones son bastante obvios.  En el primer caso, almacena la base de datos localmente y controla completamente el acceso a ella y la creaci√≥n de copias de seguridad.  Si la aplicaci√≥n es de c√≥digo abierto, si es necesario, incluso puede agregarle funcionalidad adicional.  Sin embargo, trabajar con dicha base de datos juntos o ver datos desde otro dispositivo ser√° dif√≠cil.  En el segundo, por el contrario, el acceso es desde cualquier dispositivo, pero usted cede sus datos a terceros y espera su decencia.  En la historia de mi familia no hay secretos comprometedores y terribles, sin embargo, todav√≠a considero que esta informaci√≥n es puramente personal y, en principio, no quiero que nadie m√°s la almacene o analice. <br><br>  Dadas las deficiencias de ambos enfoques, podemos formular una lista de requisitos para el motor "ideal": <br><br><ol><li>  Aplicaci√≥n web alojada en su propio servidor </li><li>  Creaci√≥n de art√≠culos sobre personas, mascotas, lugares, eventos, etc.  como un wiki </li><li>  Descargar medios </li><li>  Marcas de personas en fotos y videos. </li><li>  Construcci√≥n autom√°tica de √°rboles geneal√≥gicos </li><li>  Calendario con todas las fechas importantes. </li><li>  Herramientas para coedici√≥n y relleno </li></ol><br>  Para ser justos, logr√© encontrar varios proyectos con una implementaci√≥n autohospedada, pero estaban en un estado deplorable: la apariencia se congel√≥ a mediados de la d√©cada de 2000, no hab√≠a un conjunto completo de la funcionalidad necesaria y no quer√≠a profundizar en los scripts heredados en PHP.  Adem√°s, el proyecto de mascota anterior hab√≠a terminado y hab√≠a un deseo de asumir algo nuevo. <br><br>  La regla de oro dice: <i>si quieres hacerlo bien, ¬°hazlo t√∫ mismo!</i> <br><br>  Las tecnolog√≠as utilizadas se seleccionaron de acuerdo con tres criterios: mi experiencia con ellas, popularidad y sin apertura.  Aqu√≠ est√° el resultado: <br><br><ul><li>  <b>Rantime</b> : .NET Core 2.1 </li><li>  <b>Back</b> - <b>end</b> : ASP.NET Core MVC </li><li>  <b>Base de datos</b> : PostgreSQL </li><li>  <b>L√≥gica frontend</b> : parcialmente Vue, parcialmente jQuery. </li><li>  <b>Estilos frontend</b> : Bootstrap + Sass </li></ul><br>  Los roles de apoyo incluyen Elasticsearch para b√∫squeda de texto completo y ffmpeg para tomar capturas de pantalla del video. <br><br><h4>  Esquema de datos </h4><br>  Los objetos principales en la base de datos Bonsai son una <i>p√°gina</i> y un <i>archivo multimedia</i> .  Est√°n conectados por una relaci√≥n de muchos a muchos a trav√©s de las <i>marcas</i> .  Una etiqueta puede tener un t√≠tulo sin un enlace, por ejemplo, si necesita etiquetar a alguien en una foto, pero no hay informaci√≥n en una p√°gina completa al respecto. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8b7/c75/f0c/8b7c75f0c97b58cee523f9984000e37f.png"><br><br>  Adem√°s del texto libre, la p√°gina puede contener <i>datos</i> que se ingresan en campos especiales en el panel de administraci√≥n.  Los hechos adicionales se calculan sobre los hechos: por ejemplo, si indica la fecha de nacimiento de la persona, se marcar√° en el calendario y su p√°gina mostrar√° la edad actual (o la esperanza de vida, si tambi√©n se indica la fecha de fallecimiento), el sexo puede usarse para determinar el nombre correcto de la relaci√≥n ("padre "O" madre "en lugar de los" padres "comunes), y as√≠ sucesivamente.  Los hechos se almacenan en la base de datos como un documento JSON. <br><br>  Hay cinco tipos de p√°ginas para elegir: persona, mascota, evento, lugar, etc.  La lista de datos disponibles depende del tipo de p√°gina: por ejemplo, "educaci√≥n" es relevante solo para una persona, "fecha de nacimiento" - para una persona y un animal, y "direcci√≥n" - solo para un lugar. <br><br>  Las p√°ginas est√°n interconectadas por <i>relaciones</i> : "padre", "c√≥nyuge", "amigo", "propietario", "residente" y muchos otros.  Algunas relaciones pueden ser limitadas en el tiempo (c√≥nyuge, propietario, residente), otras se consideran permanentes. <br><br>  Cuando guarda cualquier p√°gina o relaci√≥n, se verifica la coherencia del modelo resultante.  Por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">los a√±os de vida de los c√≥nyuges deben superponerse</a> , una persona no puede tener m√°s de un padre biol√≥gico de cada sexo y tampoco puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">convertirse en su propio padre</a> .  Los matrimonios del mismo sexo, sin embargo, son permisibles. <br><br>  La edici√≥n de una p√°gina, un archivo multimedia o una relaci√≥n guarda el <i>cambio</i> en la base de datos.  Esto le permite guardar el historial de ediciones y revertirlas si es necesario. <br><br><h4>  Relaci√≥n </h4><br>  El parentesco es uno de los conceptos m√°s antiguos de la sociedad.  Ya en el idioma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pre-indoeuropeo,</a> hab√≠a muchos nombres para ellos, que, en una forma ligeramente modificada, migraron a los idiomas modernos de varios grupos: la palabra "madre" ser√° entendida por el ruso, el ingl√©s y el chino. <br><br>  Hay muchas opciones para el parentesco, pero las b√°sicas son tres: <i>padre</i> , <i>hijo</i> y <i>c√≥nyuge</i> .  Le permiten construir un gr√°fico dirigido de la familia donde estas relaciones son aristas y las personas son nodos.  En esta columna, puede expresar cualquier otra relaci√≥n, conociendo el camino entre los participantes y su g√©nero: por ejemplo, para identificar al abuelo de alguien, primero debe encontrar a su padre (cualquier g√©nero), y luego el padre de este padre (hombre), y as√≠ sucesivamente. <br><br>  En el panel de administraci√≥n de Bonsai, puede ingresar las relaciones de estos tres tipos b√°sicos.  Lo opuesto se crear√° autom√°ticamente para cada relaci√≥n: padre por hijo, c√≥nyuge por c√≥nyuge, due√±o por mascota.  El motor calcula todas las relaciones adicionales y se muestran en la barra lateral de la p√°gina: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/242/d23/4a4/242d234a49a7c7a75788e384d82b8950.png"><br><br>  Para calcular la relaci√≥n, se utiliza un recorrido de gr√°fico elemental y los nombres de relaci√≥n se establecen en forma de un DSL especial: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> RelationDefinition[] ParentRelations = { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Parent:m"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Parent:f"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Parent Child:m"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Parent Child:f"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Parent Parent:m"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Parent Parent:f"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) };</code> </pre> <br>  Incluso una persona puede tener <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">muchos</a> parientes directos.  Bonsai divide los enlaces en los siguientes grupos: <br><br><ol><li>  <b>La relaci√≥n de sangre m√°s cercana</b> es la familia en la que la persona creci√≥: madre y padre, abuelos, hermanos y hermanas.  Si observa el gr√°fico, esta es la ruta 1-2 pasos hacia arriba y 1 hacia los lados. </li><li>  <b>Familia propia</b> : un grupo por cada c√≥nyuge e hijos de √©l.  Esto tambi√©n incluye a los familiares del c√≥nyuge: suegra, cu√±ado y similares. </li><li>  <b>Otros</b> : parientes m√°s distantes (nietos, t√≠os, t√≠as) y lazos no familiares (amigos, colegas). </li></ol><br>  A veces, una forma de determinar la pertenencia a un grupo no es suficiente.  Los datos pueden estar incompletos, pero a√∫n deben mostrarse de la manera m√°s adecuada posible.  Considere el siguiente gr√°fico de hermanos: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a2a/47a/9c7/a2a47a9c749012092d863bcb52c399bf.png"><br><br>  Como podemos ver, dos esposas (Vera y Galina) y un hijo (Boris) est√°n indicados para Alexander, pero no sabemos cu√°l de las esposas es la madre del ni√±o; tal vez esta sea una especie de tercera mujer, pero a√∫n no ha sido agregada.  Para tales casos, se pueden indicar varias rutas que deber√≠an existir o no, y est√°n marcadas con signos <code>+</code> y <code>-</code> respectivamente: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Spouse Child+Child"</span></span>, <span class="hljs-string"><span class="hljs-string">"||"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Spouse Child-Child:m"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Spouse Child-Child:f"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)</code> </pre><br><h4>  √Årbol geneal√≥gico </h4><br>  Cualquier motor de genealog√≠a decente deber√≠a ser capaz de construir un √°rbol geneal√≥gico.  Esta es la forma m√°s visual de mostrar informaci√≥n general sobre las personas y sus relaciones familiares.  Los datos se almacenan en la base de datos en forma de un gr√°fico dirigido y, en teor√≠a, deber√≠a ser f√°cil de visualizar.  En la pr√°ctica, fue con la exhibici√≥n del √°rbol que surgieron las mayores dificultades. <br><br>  Aqu√≠ hay algunos ejemplos de c√≥mo se ver√≠an los √°rboles geneal√≥gicos: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eab/d88/aad/eabd88aadfe933595863249db8a269d5.png"><br><br>  √Årbol geneal√≥gico de Targaryenov.  Muy compacto, porque est√° hecho a mano.  Generar tal √°rbol a partir de datos arbitrarios ser√° extremadamente dif√≠cil autom√°ticamente. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9bd/be7/d2d/9bdbe7d2dd44d9ade8a9906e4b93fdd5.png"><br><br>  Dioses griegos  La representaci√≥n gr√°fica se genera a partir de una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sintaxis de reducci√≥n especial</a> , en la que a√∫n debe organizar manualmente todos los bloques y dibujar los enlaces entre ellos.  Un poco como el arte ASCII. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7d2/6d7/11b/7d26d711b2ca68ac6f9b0f364fe30f3a.png"><br><br>  Presentaci√≥n de un √°rbol en forma de diagrama semicircular.  Se genera f√°cilmente de forma autom√°tica, pero solo tiene en cuenta antepasados ‚Äã‚Äãdirectos. <br><br>  Mir√© a trav√©s de muchas opciones.  Lo m√°s est√©ticamente agradable fue en el sitio web MyHeritage: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/42b/0e9/73b/42b0e973bd48a5faaab3ee06758358d9.png"><br><br>  La representaci√≥n de dicho √°rbol se puede dividir en tres pasos condicionales: obtener datos de la base de datos, organizar bloques / l√≠neas de conexi√≥n y mostrarlos directamente en la p√°gina.  Si todo fue trivial con el primer y tercer paso, entonces en el segundo tropec√©. <br><br>  Los intentos de lanzar una soluci√≥n hecha a s√≠ misma a toda prisa terminaron en un fiasco completo.  Una disposici√≥n competente de elementos gr√°ficos es un √°rea tan compleja que las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">disertaciones est√°n escritas</a> en ella, y los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">componentes terminados</a> son como un apartamento en Mosc√∫.  De acuerdo, no podr√°s escribir t√∫ mismo, pero ¬øseguramente hay soluciones gratuitas decentes? <br><br>  La mayor√≠a de mis esperanzas estaban en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">biblioteca D3.js.</a>  Quiz√°s esto es lo primero que viene a la mente si necesita dibujar un gr√°fico o cuadro en una p√°gina web.  Por desgracia, entre m√°s de trescientos (!) Ejemplos en la wiki, no hab√≠a uno m√°s o menos similar a un √°rbol con MyHeritage. <br><br>  El siguiente paso fue sumergirse en bibliotecas que no estaban involucradas en el renderizado, sino en el c√°lculo de la disposici√≥n √≥ptima de los elementos en el gr√°fico.  La mayor√≠a de ellos ofrecen el llamado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dise√±o de la Fuerza</a> .  Este es un enfoque muy simple, que se basa en f√≥rmulas f√≠sicas: los nodos de la gr√°fica est√°n representados por cuerpos el√°sticos, y las l√≠neas de conexi√≥n est√°n representadas por resortes.  Se puede reconocer f√°cilmente por su animaci√≥n caracter√≠stica: el gr√°fico parece "enderezarse" sobre la marcha, y esto no es una caracter√≠stica adicional, sino una consecuencia inevitable de la naturaleza de simulaci√≥n del algoritmo.  El enfoque de dise√±o forzado es bueno para visualizar datos sin una jerarqu√≠a clara (por ejemplo, conexiones en redes sociales), pero el √°rbol geneal√≥gico de esta forma parece defectuoso. <br><br>  Otra opci√≥n considerada es la biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Graphviz</a> .  El resultado de su trabajo puede reconocerse f√°cilmente por las flechas caracter√≠sticas.  Se utiliza un lenguaje especial <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DOT</a> para describir el gr√°fico.  Los casos de prueba se ven a√∫n m√°s o menos, pero hay problemas con los datos reales: las flechas "se rompen" y se conectan en √°ngulos extra√±os, el gr√°fico se desliza hacia arriba y no puede ajustarlo y no puede evitarlo. <br><br>  Al no haber encontrado una soluci√≥n adecuada por mi cuenta, decid√≠ pedirla por cuenta propia, y luego comenz√≥ el mismo <i>DRAMA</i> . <br><br>  El pedido se realiz√≥ en la ma√±ana del 22 de octubre, y en una hora recibi√≥ varias respuestas.  Uno de los encuestados se llamaba Vladislav;  envi√≥ un ejemplo de una soluci√≥n similar y prometi√≥ completar la tarea en <i>un d√≠a</i> .  Esta velocidad me pareci√≥ sospechosa, pero esperaba su experiencia y para m√≠ mismo le di al chico un error de una semana.  Los primeros d√≠as, Vladislav hizo preguntas adicionales, sin dejar de sorprenderme con una profunda inmersi√≥n en el proyecto y una actitud atenta a los detalles, y luego desapareci√≥.  Se despert√≥ el 1 de noviembre, se disculp√≥ por la desaparici√≥n forzada por razones familiares y envi√≥ un enlace con una versi√≥n beta que se parec√≠a bastante a lo que quer√≠a si no fuera por el nodo en las l√≠neas de conexi√≥n en el centro: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/79e/402/bda/79e402bda04af7142d02273b7969ff1c.png"><br><br>  La desaparici√≥n del int√©rprete siempre es una llamada de atenci√≥n, pero nunca se sabe, sucede algo, porque √©l hizo algo.  ¬°Que contin√∫e!  Envi√© un prepago y comenc√© a esperar mejoras.  Despu√©s de un par de d√≠as, Vladislav escribi√≥ que no pod√≠a solucionar el problema y luego desapareci√≥ nuevamente, esta vez durante tres semanas.  Durante este tiempo, no hizo nada y se neg√≥ a devolver el anticipo, porque "la tarea fue realizada por un <i>est√∫pido ex amigo</i> que lo decepcion√≥ y no le devolvi√≥ el dinero".  Despu√©s de un par de preguntas aclaratorias, el desafortunado delegado dej√≥ de intentar disculparse y se call√≥.  As√≠ que ahora vivimos, de vez en cuando le recuerdo la deuda, y en respuesta env√≠a una captura de pantalla de la aplicaci√≥n bancaria, dicen, "no hay dinero, pero tan pronto como sea, de inmediato".  ¬°Deseo que Vladislav tenga √©xito en los negocios y enriquecerse m√°s r√°pido! <br><br>  <i>Lanz√≥ al ni√±o - menos en karma!</i> <br><br>  Perder dinero no fue tan molesto, pero pas√≥ un mes, y la tarea no se movi√≥, y ahora no hab√≠a ning√∫n lugar para esperar ayuda.  En primer lugar, estaba enojado conmigo mismo: tom√© el camino de menor resistencia, viol√© la <i>regla de oro</i> , y aqu√≠ est√° el resultado.  Lleno de ira justa, nuevamente me sent√© a estudiar bibliotecas para dibujar gr√°ficos y ¬°he aqu√≠!  - De repente encontr√≥ exactamente lo que necesita. <br><br>  La biblioteca se llamaba <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Eclipse Layout Kernel</a> , abreviado ELK.  Como puede suponer, se usa para mostrar diagramas en el Eclipse IDE, pero tambi√©n se puede usar de forma aut√≥noma.  En general, est√° escrito en Java, pero hay una versi√≥n transmitida en JS.  S√≠, su c√≥digo es una <a href="">pesadilla</a> y pesa un megabyte y medio, pero estas deficiencias se pueden perdonar por el hecho de que <i>simplemente funciona</i> y hace exactamente lo correcto.  La interfaz es elemental: los nodos, bordes y configuraciones se transmiten a la entrada, y en la salida obtenemos las coordenadas.  Puede dibujar un √°rbol con ellos de cualquier manera conveniente: eleg√≠ SVG para conectar l√≠neas y divs con posicionamiento absoluto para bloques. <br><br>  La integraci√≥n de la biblioteca y la selecci√≥n de configuraciones √≥ptimas tom√≥ dos noches en la fuerza.  Esto, por supuesto, no es "un d√≠a", como prometi√≥ mi desafortunado y arrogante profesional independiente, sino bastante cerca.  Como resultado, Bonsai pudo mostrar el √°rbol aproximadamente de esta forma: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/57a/f67/bdc/57af67bdcd299bb1f995aa73e09d0fd5.png"><br><br>  Ahora el √∫nico problema que queda es el tiempo de procesamiento.  ELK utiliza un algoritmo iterativo: puede acercarse a la ubicaci√≥n √≥ptima al dedicar m√°s tiempo.  En un √°rbol de 20-30 elementos, un buen resultado requiere aproximadamente 5 segundos.  Debido a esto, una p√°gina con un √°rbol se abre cada vez durante mucho tiempo, y r√°pidamente comienza a molestar.  Para la pr√≥xima versi√≥n, el c√°lculo se transferir√° al backend para que se pueda hacer una vez al cambiar la p√°gina y el almacenamiento en cach√©. <br><br><h4>  B√∫squeda de texto completo </h4><br>  Un sistema para almacenar informaci√≥n textual ser√≠a in√∫til sin una conveniente b√∫squeda de texto completo.  Bonsai utiliza la base de datos PostgreSQL, por lo que lo primero que decid√≠ fue comprobar qu√© pod√≠a ofrecer de inmediato.  Otra decepci√≥n: <code>tsvector</code> hace frente a palabras comunes, pero se niega a buscar lo m√°s importante: nombres y apellidos: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> to_tsvector(<span class="hljs-string"><span class="hljs-string">''</span></span>) @@ to_tsquery(<span class="hljs-string"><span class="hljs-string">''</span></span>), <span class="hljs-comment"><span class="hljs-comment">-- true to_tsvector('') @@ to_tsquery(''), -- false to_tsvector('') @@ to_tsquery(''), -- false to_tsvector('') @@ to_tsquery(''), -- false to_tsvector('  ') @@ to_tsquery('') -- false</span></span></code> </pre><br>  Los trigramas tampoco dieron nada bueno.  Al final, me decid√≠ por una opci√≥n bastante esperada: ElasticSearch + <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Russian Morfology</a> .  Result√≥ ser muy inconveniente trabajar con √©l desde .NET, pero se las arregla con un s√≥lido cinco con una b√∫squeda por nombre. <br><br><h4>  Imperfecci√≥n consciente </h4><br>  Al trabajar en un proyecto, las situaciones ocurr√≠an regularmente cuando un <i>perfeccionista interno</i> estaba furioso por la soluci√≥n elegida.  El √°rea tem√°tica es bastante no est√°ndar y las "buenas maneras" generalmente aceptadas no siempre funcionan. <br><br>  Por ejemplo, ¬øqu√© sucede cuando abrimos cualquier p√°gina? <br><br><ol><li>  El texto de la p√°gina se compila de Markdown a HTML.  Si el texto contiene enlaces a otras p√°ginas y archivos multimedia, tendr√° que ir a la base de datos para obtener m√°s informaci√≥n. </li><li>  Los hechos se deserializan del JSON en el que se almacenan en la base de datos, en el modelo de vista. </li><li>  Las relaciones est√°n determinadas.  Para hacer esto, desde la larga base de datos, es necesario obtener el <i>gr√°fico de conexi√≥n completo</i> y encontrar nodos en √©l de acuerdo con una lista de rutas previamente conocida. </li></ol><br>  A primera vista, parece una operaci√≥n terriblemente dif√≠cil, pero en realidad no se debe a la cantidad relativamente peque√±a de datos.  ¬øCu√°ntos parientes puedes recordar y quieres escribir?  Intente contarlos por inter√©s y descubra que ser√° muy dif√≠cil marcar al menos un centenar.  ¬øY cu√°ntas personas quieren dar acceso?  ¬°Incluso un n√∫mero astron√≥micamente grande para una familia es mil personas!  - Seg√∫n los est√°ndares de las bases de datos modernas, sigue siendo rid√≠culo. <br><br>  Por supuesto, el modelo de vista de p√°gina compilada todav√≠a se almacena en cach√© la primera vez que se abre y se reutiliza en los posteriores, principalmente porque era muy f√°cil de implementar.  La regla de invalidaci√≥n de cach√© para los cambios en el panel de administraci√≥n tambi√©n se toma de la manera m√°s simple posible: si cambiamos solo el texto y algunos datos <i>locales</i> (lista de idiomas, tipo de sangre, color de cabello, etc.), simplemente restablezca esta p√°gina espec√≠fica.  Con cualquier otro cambio (nombre de la p√°gina, fecha de nacimiento o sexo, agregando o cambiando cualquier conexi√≥n), el cach√© se restablece por <i>completo</i> .  S√≠, esta no es la forma m√°s inteligente de limpiar.  S√≠, seguro, podr√≠a escribir un algoritmo complejo que restablecer√≠a solo lo que necesita, pero para este proyecto no justificar√≠a los costos. <br><br>  El proyecto no admite la localizaci√≥n y el cambio de apariencia, la autorizaci√≥n funciona en OAuth en Facebook \ Google, y el panel de administraci√≥n se realiza en los formularios habituales, y no en un marco de SPA basado en la √∫ltima moda.  Todo esto <i>podr√≠a</i> realizarse o mejorarse, pero no habr√≠a resuelto ning√∫n problema y, por lo tanto, se habr√≠a perdido el tiempo. <br><br><h4>  Mirando hacia el futuro </h4><br>  Otra raz√≥n por la que no tiene sentido invertir en la complejidad del dispositivo del motor es la naturaleza ef√≠mera de la implementaci√≥n en comparaci√≥n con los datos que almacena.  Solo piense por un momento: la web en su forma actual ha existido durante casi veinte a√±os, y la historia familiar ha existido <i>durante siglos</i> .  Nadie ha resuelto este problema simplemente porque la industria de la tecnolog√≠a de la informaci√≥n en s√≠ misma existe mucho menos.  Que se puede hacer <br><br>  El motor tendr√° que ser reescrito regularmente desde cero, al igual que durante miles de a√±os, los monjes han sido dif√≠ciles de copiar textos de libros en ruinas a otros nuevos.  La √∫nica diferencia es que el libro puede durar cien a√±os con un manejo adecuado y la aplicaci√≥n, con una solidez de 15-20 a√±os.  Espero que en veinte a√±os todav√≠a pueda hacerlo yo mismo, pero en otros veinte a√±os mis hijos o nietos tendr√°n que hacerlo.  Me gustar√≠a dejarles una fuente simple, comprensible y documentada. <br><br>  En las primeras etapas del dise√±o, quer√≠a incrustar un cierto lenguaje similar al SQL en el motor, con la ayuda de la cual pude obtener respuestas a preguntas espec√≠ficas: "cu√°l es el porcentaje de mis antepasados ‚Äã‚Äãcon ojos azules", "cuando Ivan compr√≥ el primer auto", etc.  Esta idea tuvo que ser abandonada porque requerir√≠a, en lugar del texto sin formato, ingresar toda la informaci√≥n en una determinada forma formal, y solo una descripci√≥n de este tipo llevar√≠a a√±os.  Por otro lado, la comprensi√≥n del lenguaje natural est√° ganando impulso.  No me sorprender√° si dentro de diez o dos a√±os ser√° posible pedirle a Siri que lea el texto por usted, siga los enlaces y, como resultado, presente un extracto de los hechos.  Chicos, empujen! <br><br><h4>  ¬øC√≥mo intentarlo? </h4><br>  Lamentablemente, no puedo proporcionar un enlace a la demostraci√≥n finalizada: no hay ning√∫n servidor que pueda soportar el efecto habra.  Pero hay algunas capturas de pantalla visuales (se puede hacer clic en las im√°genes). <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/161/06a/0d0/16106a0d0a093a140c5095b472f847b5.png"></a> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/92e/c5b/798/92ec5b798673b928cf0e7ad6755bbc0d.png"></a> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/350/041/c9d/350041c9d3943b630474931f60f794bf.png"></a> <br><br>  Si Bonsai te pareci√≥ √∫til y quieres ejecutarlo t√∫ mismo, el c√≥digo fuente se puede descargar desde Github: <br><br>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/impworks/bonsai</a></strong> <br><br>  Las instrucciones detalladas de instalaci√≥n se proporcionan en el archivo L√©ame.  Necesitar√°s esto: <br><br><ol><li>  .NET Core 2.1+ </li><li>  PostgreSQL 10+ </li><li>  ElasticSearch 5.xy el complemento de morfolog√≠a rusa </li><li>  Aplicaci√≥n de Facebook o Google para la autorizaci√≥n de oAuth </li></ol><br>  Despu√©s del primer lanzamiento, se crean varias p√°ginas de prueba y fotos en la base de datos.  Para la producci√≥n, este comportamiento no es necesario y el indicador lo deshabilita en la configuraci√≥n. <br><br>  Hace apenas un mes, lanc√© mi propia instancia y comenc√© a ejecutarla, obteniendo datos reales.  Se encuentra cierta aspereza, pero de lo contrario estoy completamente satisfecho con el resultado.  Ahora el proyecto se desarrollar√° y finalizar√° gradualmente.  Las tareas principales son acelerar la visualizaci√≥n del √°rbol, permitir la descarga de documentos en forma de PDF y agregar ajustes de los derechos de acceso.  Ser√≠a bueno mejorar la usabilidad del panel de administraci√≥n en algunos lugares o reconocer autom√°ticamente las caras en la foto, <i>pero esto no es exacto</i> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/438622/">https://habr.com/ru/post/438622/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../438606/index.html">Agradable degradaci√≥n. Informe Yandex.Taxi</a></li>
<li><a href="../438610/index.html">Plantillas Responsive Figma: creaci√≥n de un componente de dise√±o flexible para iOS Mobile Navigation</a></li>
<li><a href="../438614/index.html">¬øQu√© es una animaci√≥n inactiva de calidad? Los desarrolladores comparten sus ejemplos favoritos.</a></li>
<li><a href="../438618/index.html">Hacer un proyector l√°ser de texto DIY</a></li>
<li><a href="../438620/index.html">Mi camino como desarrollador de juegos novatos</a></li>
<li><a href="../438624/index.html">Programamos el cambio a trav√©s del pasaje. MicroPython en esp8266 (sonoff) con OTA. Parte 1</a></li>
<li><a href="../438626/index.html">El resumen de materiales interesantes para el desarrollador m√≥vil # 284 (28 de enero - 3 de febrero)</a></li>
<li><a href="../438628/index.html">Notificaci√≥n de estado de cambio de componente de estado compartido</a></li>
<li><a href="../438630/index.html">Google+ Sic transit gloria mundi ...</a></li>
<li><a href="../438632/index.html">Hardcore 2D RPG Gamedev Diaries, vol.0 - INTRO, o "C√≥mo llegu√© aqu√≠"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>