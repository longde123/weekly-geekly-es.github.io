<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’  ğŸ¤¬ ğŸ¸ ã€Šå·«å¸ˆ3ã€‹çš„æ¸²æŸ“æ–¹å¼æ˜¯å¦‚ä½•å®ç°çš„ï¼šé—ªç”µï¼Œå·«å¸ˆçš„å¤©èµ‹å’Œå…¶ä»–æ•ˆæœ ğŸ™ğŸ¼ ğŸ‘©â€ğŸ”§ ğŸ‘†ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç¬¬1éƒ¨åˆ†ã€‚æ‹‰é“¾ 
 åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶ã€Šå·«å¸ˆ3ï¼šç‹‚çŒã€‹ä¸­çš„é—ªç”µæ¸²æŸ“è¿‡ç¨‹ã€‚ 

 é—ªç”µæ¸²æŸ“çš„æ‰§è¡Œæ—¶é—´æ¯”é›¨å¹•æ•ˆæœæ™šä¸€äº›ï¼Œä½†ä»åœ¨ç›´æ¥æ¸²æŸ“è¿‡ç¨‹ä¸­è¿›è¡Œã€‚ å¯ä»¥åœ¨æ­¤è§†é¢‘ä¸­çœ‹åˆ°é—ªç”µï¼š 


 å®ƒä»¬ä¼šå¾ˆå¿«æ¶ˆå¤±ï¼Œå› æ­¤æœ€å¥½ä»¥0.25çš„é€Ÿåº¦è§‚çœ‹è§†é¢‘ã€‚ 

 æ‚¨ä¼šçœ‹åˆ°è¿™äº›ä¸æ˜¯é™æ€å›¾åƒï¼› éšç€æ—¶é—´çš„æµé€ï¼Œå®ƒä»¬çš„äº®åº¦ä¼šç•¥...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ã€Šå·«å¸ˆ3ã€‹çš„æ¸²æŸ“æ–¹å¼æ˜¯å¦‚ä½•å®ç°çš„ï¼šé—ªç”µï¼Œå·«å¸ˆçš„å¤©èµ‹å’Œå…¶ä»–æ•ˆæœ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450332/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/abf/ce7/1c4/abfce71c4469b6dcd077723d498c1685.jpg" alt="å›¾ç‰‡"></div><br><h2> ç¬¬1éƒ¨åˆ†ã€‚æ‹‰é“¾ </h2><br> åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶ã€Šå·«å¸ˆ3ï¼šç‹‚çŒã€‹ä¸­çš„é—ªç”µæ¸²æŸ“è¿‡ç¨‹ã€‚ <br><br> é—ªç”µæ¸²æŸ“çš„æ‰§è¡Œæ—¶é—´æ¯”<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é›¨å¹•</a>æ•ˆæœæ™šä¸€äº›ï¼Œä½†ä»åœ¨ç›´æ¥æ¸²æŸ“è¿‡ç¨‹ä¸­è¿›è¡Œã€‚ å¯ä»¥åœ¨æ­¤è§†é¢‘ä¸­çœ‹åˆ°é—ªç”µï¼š <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/VXt4PEEqV2k" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> å®ƒä»¬ä¼šå¾ˆå¿«æ¶ˆå¤±ï¼Œå› æ­¤æœ€å¥½ä»¥0.25çš„é€Ÿåº¦è§‚çœ‹è§†é¢‘ã€‚ <br><br> æ‚¨ä¼šçœ‹åˆ°è¿™äº›ä¸æ˜¯é™æ€å›¾åƒï¼› éšç€æ—¶é—´çš„æµé€ï¼Œå®ƒä»¬çš„äº®åº¦ä¼šç•¥æœ‰å˜åŒ–ã€‚ <br><br> ä»ç»†å¾®å·®åˆ«çš„è§’åº¦æ¥çœ‹ï¼Œåœ¨è¿œå¤„ç”»é›¨å¸˜æœ‰è®¸å¤šç›¸ä¼¼ä¹‹å¤„ï¼Œä¾‹å¦‚ï¼Œæ··åˆçŠ¶æ€ï¼ˆåŠ æ³•æ··åˆï¼‰å’Œæ·±åº¦ç›¸åŒï¼ˆå¯ç”¨æ£€æŸ¥ï¼Œä¸è¿›è¡Œæ·±åº¦è®°å½•ï¼‰ã€‚ <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ba/7e1/f20/4ba7e1f2075dc128baf8b717eeb3ce92.jpg"></div><br>  <i>æ²¡æœ‰é—ªç”µçš„åœºæ™¯</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3dd/37a/e59/3dd37ae5986de4621766f4fc64525906.jpg"></div><br>  <i>é—ªç”µåœºæ™¯</i> <br><br> å°±é—ªç”µçš„å‡ ä½•å½¢çŠ¶è€Œè¨€ï¼Œå·«å¸ˆ3æ˜¯ä¸€ä¸ªæ ‘çŠ¶ç½‘æ ¼ã€‚ æ­¤é—ªç”µç¤ºä¾‹ç”±ä»¥ä¸‹ç½‘æ ¼è¡¨ç¤ºï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5b7/23c/3dc/5b723c3dc1f934c0f6c14903e2a260cf.jpg"></div><br> å®ƒå…·æœ‰UVåæ ‡å’Œæ³•çº¿å‘é‡ã€‚ æ‰€æœ‰è¿™äº›åœ¨é¡¶ç‚¹ç€è‰²å™¨é˜¶æ®µéƒ½æ´¾ä¸Šç”¨åœºã€‚ <br><br><h3> é¡¶ç‚¹ç€è‰²å™¨ </h3><br> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ç»„è£…å¥½çš„é¡¶ç‚¹ç€è‰²å™¨ä»£ç ï¼š <br><br><pre><code class="cpp hljs">vs_5_0 dcl_globalFlags refactoringAllowed dcl_constantbuffer cb1[<span class="hljs-number"><span class="hljs-number">9</span></span>], immediateIndexed dcl_constantbuffer cb2[<span class="hljs-number"><span class="hljs-number">6</span></span>], immediateIndexed dcl_input v0.xyz dcl_input v1.xy dcl_input v2.xyz dcl_input v4.xyzw dcl_input v5.xyzw dcl_input v6.xyzw dcl_input v7.xyzw dcl_output o0.xy dcl_output o1.xyzw dcl_output_siv o2.xyzw, position dcl_temps <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: mov o0.xy, v1.xyxx <span class="hljs-number"><span class="hljs-number">1</span></span>: mov o1.xyzw, v7.xyzw <span class="hljs-number"><span class="hljs-number">2</span></span>: mul r0.xyzw, v5.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">0</span></span>].yyyy <span class="hljs-number"><span class="hljs-number">3</span></span>: mad r0.xyzw, v4.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">0</span></span>].xxxx, r0.xyzw <span class="hljs-number"><span class="hljs-number">4</span></span>: mad r0.xyzw, v6.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">0</span></span>].zzzz, r0.xyzw <span class="hljs-number"><span class="hljs-number">5</span></span>: mad r0.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">0</span></span>].wwww, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>), r0.xyzw <span class="hljs-number"><span class="hljs-number">6</span></span>: mov r1.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">7</span></span>: mad r1.xyz, v0.xyzx, cb2[<span class="hljs-number"><span class="hljs-number">4</span></span>].xyzx, cb2[<span class="hljs-number"><span class="hljs-number">5</span></span>].xyzx <span class="hljs-number"><span class="hljs-number">8</span></span>: dp4 r2.x, r1.xyzw, v4.xyzw <span class="hljs-number"><span class="hljs-number">9</span></span>: dp4 r2.y, r1.xyzw, v5.xyzw <span class="hljs-number"><span class="hljs-number">10</span></span>: dp4 r2.z, r1.xyzw, v6.xyzw <span class="hljs-number"><span class="hljs-number">11</span></span>: add r2.xyz, r2.xyzx, -cb1[<span class="hljs-number"><span class="hljs-number">8</span></span>].xyzx <span class="hljs-number"><span class="hljs-number">12</span></span>: dp3 r1.w, r2.xyzx, r2.xyzx <span class="hljs-number"><span class="hljs-number">13</span></span>: rsq r1.w, r1.w <span class="hljs-number"><span class="hljs-number">14</span></span>: div r1.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>), r1.w <span class="hljs-number"><span class="hljs-number">15</span></span>: mul r1.w, r1.w, l(<span class="hljs-number"><span class="hljs-number">0.000001</span></span>) <span class="hljs-number"><span class="hljs-number">16</span></span>: mad r2.xyz, v2.xyzx, l(<span class="hljs-number"><span class="hljs-number">2.000000</span></span>, <span class="hljs-number"><span class="hljs-number">2.000000</span></span>, <span class="hljs-number"><span class="hljs-number">2.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>), l(<span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">17</span></span>: mad r1.xyz, r2.xyzx, r1.wwww, r1.xyzx <span class="hljs-number"><span class="hljs-number">18</span></span>: mov r1.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">19</span></span>: dp4 o2.x, r1.xyzw, r0.xyzw <span class="hljs-number"><span class="hljs-number">20</span></span>: mul r0.xyzw, v5.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">1</span></span>].yyyy <span class="hljs-number"><span class="hljs-number">21</span></span>: mad r0.xyzw, v4.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">1</span></span>].xxxx, r0.xyzw <span class="hljs-number"><span class="hljs-number">22</span></span>: mad r0.xyzw, v6.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">1</span></span>].zzzz, r0.xyzw <span class="hljs-number"><span class="hljs-number">23</span></span>: mad r0.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">1</span></span>].wwww, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>), r0.xyzw <span class="hljs-number"><span class="hljs-number">24</span></span>: dp4 o2.y, r1.xyzw, r0.xyzw <span class="hljs-number"><span class="hljs-number">25</span></span>: mul r0.xyzw, v5.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">2</span></span>].yyyy <span class="hljs-number"><span class="hljs-number">26</span></span>: mad r0.xyzw, v4.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">2</span></span>].xxxx, r0.xyzw <span class="hljs-number"><span class="hljs-number">27</span></span>: mad r0.xyzw, v6.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">2</span></span>].zzzz, r0.xyzw <span class="hljs-number"><span class="hljs-number">28</span></span>: mad r0.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">2</span></span>].wwww, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>), r0.xyzw <span class="hljs-number"><span class="hljs-number">29</span></span>: dp4 o2.z, r1.xyzw, r0.xyzw <span class="hljs-number"><span class="hljs-number">30</span></span>: mul r0.xyzw, v5.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">3</span></span>].yyyy <span class="hljs-number"><span class="hljs-number">31</span></span>: mad r0.xyzw, v4.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">3</span></span>].xxxx, r0.xyzw <span class="hljs-number"><span class="hljs-number">32</span></span>: mad r0.xyzw, v6.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">3</span></span>].zzzz, r0.xyzw <span class="hljs-number"><span class="hljs-number">33</span></span>: mad r0.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">3</span></span>].wwww, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>), r0.xyzw <span class="hljs-number"><span class="hljs-number">34</span></span>: dp4 o2.w, r1.xyzw, r0.xyzw <span class="hljs-number"><span class="hljs-number">35</span></span>: ret</code> </pre> <br> é¡¶ç‚¹ç€è‰²å™¨é˜²é›¨å¸˜æœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ï¼Œå› æ­¤æˆ‘ä¸å†é‡å¤ã€‚ æˆ‘æƒ³å‘æ‚¨å±•ç¤ºç¬¬11-18è¡Œçš„é‡è¦åŒºåˆ«ï¼š <br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">11</span></span>: add r2.xyz, r2.xyzx, -cb1[<span class="hljs-number"><span class="hljs-number">8</span></span>].xyzx <span class="hljs-number"><span class="hljs-number">12</span></span>: dp3 r1.w, r2.xyzx, r2.xyzx <span class="hljs-number"><span class="hljs-number">13</span></span>: rsq r1.w, r1.w <span class="hljs-number"><span class="hljs-number">14</span></span>: div r1.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>), r1.w <span class="hljs-number"><span class="hljs-number">15</span></span>: mul r1.w, r1.w, l(<span class="hljs-number"><span class="hljs-number">0.000001</span></span>) <span class="hljs-number"><span class="hljs-number">16</span></span>: mad r2.xyz, v2.xyzx, l(<span class="hljs-number"><span class="hljs-number">2.000000</span></span>, <span class="hljs-number"><span class="hljs-number">2.000000</span></span>, <span class="hljs-number"><span class="hljs-number">2.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>), l(<span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">17</span></span>: mad r1.xyz, r2.xyzx, r1.wwww, r1.xyzx <span class="hljs-number"><span class="hljs-number">18</span></span>: mov r1.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">19</span></span>: dp4 o2.x, r1.xyzw, r0.xyzw</code> </pre> <br> é¦–å…ˆï¼Œcb1 [8] .xyzæ˜¯æ‘„åƒæœºçš„ä½ç½®ï¼Œè€Œr2.xyzæ˜¯ä¸–ç•Œç©ºé—´ä¸­çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¬¬11è¡Œè®¡ç®—ä»æ‘„åƒæœºåˆ°ä¸–ç•Œä½ç½®çš„çŸ¢é‡ã€‚ ç„¶åç¬¬12-15è¡Œè®¡ç®—<i>é•¿åº¦ï¼ˆworldPos-cameraPosï¼‰* 0.000001ã€‚</i> <br><br>  v2.xyzæ˜¯ä¼ å…¥å‡ ä½•çš„æ³•çº¿å‘é‡ã€‚ ç¬¬16è¡Œå°†å…¶ä»é—´éš”[0-1]æ‰©å±•åˆ°é—´éš”[-1; 1]ã€‚ <br><br> ç„¶åè®¡ç®—ä¸–ç•Œä¸Šçš„æœ€ç»ˆä½ç½®ï¼š <br><br>  <i>finalWorldPos = worldPos +é•¿åº¦ï¼ˆworldPos-cameraPosï¼‰* 0.000001 * normalVector</i> <br> æ­¤æ“ä½œçš„HLSLä»£ç æ®µå°†å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="cpp hljs"> ... <span class="hljs-comment"><span class="hljs-comment">// final world-space position float3 vNormal = Input.NormalW * 2.0 - 1.0; float lencameratoworld = length( PositionL - g_cameraPos.xyz) * 0.000001; PositionL += vNormal*lencameratoworld; // SV_Posiiton float4x4 matModelViewProjection = mul(g_viewProjMatrix, matInstanceWorld ); Output.PositionH = mul( float4(PositionL, 1.0), transpose(matModelViewProjection) ); return Output;</span></span></code> </pre> <br> æ­¤æ“ä½œå¯¼è‡´ç½‘æ ¼çš„è¾ƒå°â€œçˆ†å‘â€ï¼ˆæ²¿æ³•å‘çŸ¢é‡çš„æ–¹å‘ï¼‰ã€‚ æˆ‘å°è¯•ç”¨å…¶ä»–å‡ ä¸ªå€¼æ›¿æ¢0.000001ã€‚ ç»“æœå¦‚ä¸‹ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6f1/dca/ddb/6f1dcaddbdcd0f6e3c957cd8d2a1121b.jpg"></div><br>  <i>0.000002</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/609/289/c37/609289c37cea41590ffcb94beebae7e5.jpg"></div><br>  <i>0.000005</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/56a/d36/09c/56ad3609c6bbe28990bc8894b163c50d.jpg"></div><br>  <i>0.00001</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/71b/e90/b04/71be90b04a538e953b4a0ee0d4ce2912.jpg"></div><br>  <i>0.000025</i> <br><br><h3> åƒç´ ç€è‰²å™¨ </h3><br> å¥½äº†ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†é¡¶ç‚¹ç€è‰²å™¨ï¼Œç°åœ¨æ˜¯æ—¶å€™å¼€å§‹è®¨è®ºåƒç´ ç€è‰²å™¨çš„æ±‡ç¼–ä»£ç äº†ï¼ <br><br><pre> <code class="cpp hljs"> ps_5_0 dcl_globalFlags refactoringAllowed dcl_constantbuffer cb0[<span class="hljs-number"><span class="hljs-number">1</span></span>], immediateIndexed dcl_constantbuffer cb2[<span class="hljs-number"><span class="hljs-number">3</span></span>], immediateIndexed dcl_constantbuffer cb4[<span class="hljs-number"><span class="hljs-number">5</span></span>], immediateIndexed dcl_input_ps linear v0.x dcl_input_ps linear v1.w dcl_output o0.xyzw dcl_temps <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: mad r0.x, cb0[<span class="hljs-number"><span class="hljs-number">0</span></span>].x, cb4[<span class="hljs-number"><span class="hljs-number">4</span></span>].x, v0.x <span class="hljs-number"><span class="hljs-number">1</span></span>: add r0.y, r0.x, l(<span class="hljs-number"><span class="hljs-number">-1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span>: round_ni r0.y, r0.y <span class="hljs-number"><span class="hljs-number">3</span></span>: ishr r0.z, r0.y, l(<span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span>: xor r0.y, r0.y, r0.z <span class="hljs-number"><span class="hljs-number">5</span></span>: imul null, r0.z, r0.y, r0.y <span class="hljs-number"><span class="hljs-number">6</span></span>: imad r0.z, r0.z, l(<span class="hljs-number"><span class="hljs-number">0x0000ec4d</span></span>), l(<span class="hljs-number"><span class="hljs-number">0.0000000000000000000000000000000000001</span></span>) <span class="hljs-number"><span class="hljs-number">7</span></span>: imad r0.y, r0.y, r0.z, l(<span class="hljs-number"><span class="hljs-number">146956042240.000000</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> r0.y, r0.y, l(<span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>) <span class="hljs-number"><span class="hljs-number">9</span></span>: round_ni r0.z, r0.x <span class="hljs-number"><span class="hljs-number">10</span></span>: frc r0.x, r0.x <span class="hljs-number"><span class="hljs-number">11</span></span>: add r0.x, -r0.x, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">12</span></span>: ishr r0.w, r0.z, l(<span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-number"><span class="hljs-number">13</span></span>: xor r0.z, r0.z, r0.w <span class="hljs-number"><span class="hljs-number">14</span></span>: imul null, r0.w, r0.z, r0.z <span class="hljs-number"><span class="hljs-number">15</span></span>: imad r0.w, r0.w, l(<span class="hljs-number"><span class="hljs-number">0x0000ec4d</span></span>), l(<span class="hljs-number"><span class="hljs-number">0.0000000000000000000000000000000000001</span></span>) <span class="hljs-number"><span class="hljs-number">16</span></span>: imad r0.z, r0.z, r0.w, l(<span class="hljs-number"><span class="hljs-number">146956042240.000000</span></span>) <span class="hljs-number"><span class="hljs-number">17</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> r0.z, r0.z, l(<span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>) <span class="hljs-number"><span class="hljs-number">18</span></span>: itof r0.yz, r0.yyzy <span class="hljs-number"><span class="hljs-number">19</span></span>: mul r0.z, r0.z, l(<span class="hljs-number"><span class="hljs-number">0.000000001</span></span>) <span class="hljs-number"><span class="hljs-number">20</span></span>: mad r0.y, r0.y, l(<span class="hljs-number"><span class="hljs-number">0.000000001</span></span>), -r0.z <span class="hljs-number"><span class="hljs-number">21</span></span>: mul r0.w, r0.x, r0.x <span class="hljs-number"><span class="hljs-number">22</span></span>: mul r0.x, r0.x, r0.w <span class="hljs-number"><span class="hljs-number">23</span></span>: mul r0.w, r0.w, l(<span class="hljs-number"><span class="hljs-number">3.000000</span></span>) <span class="hljs-number"><span class="hljs-number">24</span></span>: mad r0.x, r0.x, l(<span class="hljs-number"><span class="hljs-number">-2.000000</span></span>), r0.w <span class="hljs-number"><span class="hljs-number">25</span></span>: mad r0.x, r0.x, r0.y, r0.z <span class="hljs-number"><span class="hljs-number">26</span></span>: add r0.y, -cb4[<span class="hljs-number"><span class="hljs-number">2</span></span>].x, cb4[<span class="hljs-number"><span class="hljs-number">3</span></span>].x <span class="hljs-number"><span class="hljs-number">27</span></span>: mad_sat r0.x, r0.x, r0.y, cb4[<span class="hljs-number"><span class="hljs-number">2</span></span>].x <span class="hljs-number"><span class="hljs-number">28</span></span>: mul r0.x, r0.x, v1.w <span class="hljs-number"><span class="hljs-number">29</span></span>: mul r0.yzw, cb4[<span class="hljs-number"><span class="hljs-number">0</span></span>].xxxx, cb4[<span class="hljs-number"><span class="hljs-number">1</span></span>].xxyz <span class="hljs-number"><span class="hljs-number">30</span></span>: mul r0.xyzw, r0.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">2</span></span>].wxyz <span class="hljs-number"><span class="hljs-number">31</span></span>: mul o0.xyz, r0.xxxx, r0.yzwy <span class="hljs-number"><span class="hljs-number">32</span></span>: mov o0.w, r0.x <span class="hljs-number"><span class="hljs-number">33</span></span>: ret</code> </pre> <br> å¥½æ¶ˆæ¯ï¼šä»£ç å¹¶ä¸é•¿ã€‚ <br><br> åæ¶ˆæ¯ï¼š <br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">3</span></span>: ishr r0.z, r0.y, l(<span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span>: xor r0.y, r0.y, r0.z <span class="hljs-number"><span class="hljs-number">5</span></span>: imul null, r0.z, r0.y, r0.y <span class="hljs-number"><span class="hljs-number">6</span></span>: imad r0.z, r0.z, l(<span class="hljs-number"><span class="hljs-number">0x0000ec4d</span></span>), l(<span class="hljs-number"><span class="hljs-number">0.0000000000000000000000000000000000001</span></span>) <span class="hljs-number"><span class="hljs-number">7</span></span>: imad r0.y, r0.y, r0.z, l(<span class="hljs-number"><span class="hljs-number">146956042240.000000</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> r0.y, r0.y, l(<span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>)</code> </pre> <br>  ...è¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ <br><br> è€å®è¯´ï¼Œè¿™ä¸æ˜¯æˆ‘ç¬¬ä¸€æ¬¡åœ¨Witcher 3ç€è‰²å™¨ä¸­çœ‹åˆ°è¿™æ ·çš„æ±‡ç¼–ä»£ç ã€‚ ä½†æ˜¯å½“æˆ‘ç¬¬ä¸€æ¬¡è§åˆ°ä»–æ—¶ï¼Œæˆ‘æƒ³ï¼šâ€œè¿™åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿâ€ <br><br> åœ¨å…¶ä»–ä¸€äº›TW3ç€è‰²å™¨ä¸­ä¹Ÿå¯ä»¥æ‰¾åˆ°ç±»ä¼¼çš„å†…å®¹ã€‚ æˆ‘ä¸ä¼šç”¨è¿™ä¸ªç‰‡æ®µæ¥æè¿°æˆ‘çš„å†’é™©ç»å†ï¼Œè€Œåªæ˜¯è¯´ç­”æ¡ˆåœ¨äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ•´æ•°å™ªå£°</a> ï¼š <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// For more details see: http://libnoise.sourceforge.net/noisegen/ float integerNoise( int n ) { n = (n &gt;&gt; 13) ^ n; int nn = (n * (n * n * 60493 + 19990303) + 1376312589) &amp; 0x7fffffff; return ((float)nn / 1073741824.0); }</span></span></code> </pre> <br> å¦‚æ‚¨æ‰€è§ï¼Œåœ¨åƒç´ ç€è‰²å™¨ä¸­å®ƒè¢«è°ƒç”¨äº†ä¸¤æ¬¡ã€‚ ä½¿ç”¨è¯¥ç½‘ç«™ä¸Šçš„æŒ‡å—ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£å¦‚ä½•æ­£ç¡®å®ç°å¹³æ»‘å™ªå£°ã€‚ ä¸€åˆ†é’Ÿåï¼Œæˆ‘ä¼šå†è°ˆè¿™ä¸ªã€‚ <br><br> çœ‹ä¸€ä¸‹ç¬¬0è¡Œ-æˆ‘ä»¬åœ¨æ­¤åŸºäºä»¥ä¸‹å…¬å¼è¿›è¡ŒåŠ¨ç”»å¤„ç†ï¼š <br><br>  <i>åŠ¨ç”»=ç»è¿‡æ—¶é—´*åŠ¨ç”»é€Ÿåº¦+ TextureUV.x</i> <br> è¿™äº›å€¼åœ¨å°†æ¥å››èˆäº”å…¥åˆ°ä¸‹ä¾§ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">floor</a> ï¼‰ï¼ˆæŒ‡ä»¤<i>round_ni</i> ï¼‰åï¼Œå°†æˆä¸ºæ•´æ•°å™ªå£°çš„è¾“å…¥ç‚¹ã€‚ é€šå¸¸ï¼Œæˆ‘ä»¬è®¡ç®—ä¸¤ä¸ªæ•´æ•°çš„å™ªå£°å€¼ï¼Œç„¶åè®¡ç®—å®ƒä»¬ä¹‹é—´çš„æœ€ç»ˆå†…æ’å€¼ï¼ˆæœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§libnoiseç½‘ç«™ï¼‰ã€‚ <br><br> å¥½å§ï¼Œè¿™æ˜¯<b>æ•´æ•°</b>å™ªå£°ï¼Œä½†æ¯•ç«Ÿï¼Œæ‰€æœ‰å‰é¢æåˆ°çš„å€¼ï¼ˆä¹Ÿå››èˆäº”å…¥ï¼‰éƒ½æ˜¯æµ®ç‚¹çš„ï¼ <br><br> è¯·æ³¨æ„ï¼Œæ­¤å¤„æ²¡æœ‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ftoi</a>æŒ‡ä»¤ã€‚ æˆ‘å‡è®¾CD Projekt Redçš„ç¨‹åºå‘˜<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨è¿™é‡Œ</a>ä½¿ç”¨äº†HLSL <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">asint</a>å†…éƒ¨å‡½æ•°ï¼Œè¯¥å‡½æ•°æ‰§è¡Œâ€œ reinterpret_castâ€æµ®ç‚¹å€¼çš„è½¬æ¢å¹¶å°†å®ƒä»¬è§†ä¸ºæ•´æ•°æ¨¡å¼ã€‚ <br><br> è¿™ä¸¤ä¸ªå€¼çš„æ’å€¼æƒé‡åœ¨ç¬¬10-11è¡Œä¸­è®¡ç®—ã€‚ <br><br>  <i>æ’å€¼æƒé‡= 1.0-å‹è£‚ï¼ˆåŠ¨ç”»ï¼‰;</i> <br> è¿™ç§æ–¹æ³•ä½¿æˆ‘ä»¬å¯ä»¥éšç€æ—¶é—´åœ¨å€¼ä¹‹é—´è¿›è¡Œæ’å€¼ã€‚ <br><br> ä¸ºäº†äº§ç”Ÿå¹³æ»‘å™ªå£°ï¼Œå°†æ­¤å†…æ’å™¨ä¼ é€’ç»™<b>SCurve</b>å‡½æ•°ï¼š <br><br><pre> <code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s_curve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x2 = x * x; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x3 = x2 * x; <span class="hljs-comment"><span class="hljs-comment">// -2x^3 + 3x^2 return -2.0*x3 + 3.0*x2; }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15a/5d0/48e/15a5d048e4fcf9b12c51cad50d7bfc3e.png"></div><br>  <i>å¹³æ»‘æ­¥å‡½æ•°[libnoise.sourceforge.net]</i> <br><br> æ­¤åŠŸèƒ½ç§°ä¸ºâ€œå¹³æ»‘æ­¥ä¼â€ã€‚ ä½†æ˜¯ï¼Œä»æ±‡ç¼–ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œè¿™<b>ä¸æ˜¯</b> HLSL <b>çš„</b>å†…éƒ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¹³æ»‘æ­¥</a>å‡½æ•°ã€‚ å†…éƒ¨å‡½æ•°ä¼šåº”ç”¨é™åˆ¶ï¼Œä»¥ä½¿å€¼å‡ä¸ºtrueã€‚ ä½†æ˜¯ç”±äºæˆ‘ä»¬çŸ¥é“<i>æ’å€¼æƒé‡</i>å°†å§‹ç»ˆåœ¨[0-1]èŒƒå›´å†…ï¼Œå› æ­¤å¯ä»¥å®‰å…¨åœ°è·³è¿‡è¿™äº›æ£€æŸ¥ã€‚ <br><br> åœ¨è®¡ç®—æœ€ç»ˆå€¼æ—¶ï¼Œå°†ä½¿ç”¨å‡ ä¸ªä¹˜æ³•è¿ç®—ã€‚ äº†è§£æœ€ç»ˆçš„alphaè¾“å‡ºå¦‚ä½•æ ¹æ®å™ªå£°å€¼è€Œå˜åŒ–ã€‚ è¿™å¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºå®ƒä¼šå½±å“æ¸²æŸ“çš„é—ªç”µçš„ä¸é€æ˜åº¦ï¼Œå°±åƒåœ¨ç°å®ç”Ÿæ´»ä¸­ä¸€æ ·ã€‚ <br><br> å‡†å¤‡å¥½åƒç´ ç€è‰²å™¨ï¼š <br><br><pre> <code class="cpp hljs"> cbuffer cbPerFrame : <span class="hljs-keyword"><span class="hljs-keyword">register</span></span> (b0) { float4 cb0_v0; float4 cb0_v1; float4 cb0_v2; float4 cb0_v3; } cbuffer cbPerFrame : <span class="hljs-keyword"><span class="hljs-keyword">register</span></span> (b2) { float4 cb2_v0; float4 cb2_v1; float4 cb2_v2; float4 cb2_v3; } cbuffer cbPerFrame : <span class="hljs-keyword"><span class="hljs-keyword">register</span></span> (b4) { float4 cb4_v0; float4 cb4_v1; float4 cb4_v2; float4 cb4_v3; float4 cb4_v4; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VS_OUTPUT</span></span></span><span class="hljs-class"> {</span></span> float2 Texcoords : Texcoord0; float4 InstanceLODParams : INSTANCE_LOD_PARAMS; float4 PositionH : SV_Position; }; <span class="hljs-comment"><span class="hljs-comment">// Shaders in TW3 use integer noise. // For more details see: http://libnoise.sourceforge.net/noisegen/ float integerNoise( int n ) { n = (n &gt;&gt; 13) ^ n; int nn = (n * (n * n * 60493 + 19990303) + 1376312589) &amp; 0x7fffffff; return ((float)nn / 1073741824.0); } float s_curve( float x ) { float x2 = x * x; float x3 = x2 * x; // -2x^3 + 3x^2 return -2.0*x3 + 3.0*x2; } float4 Lightning_TW3_PS( in VS_OUTPUT Input ) : SV_Target { // * Inputs float elapsedTime = cb0_v0.x; float animationSpeed = cb4_v4.x; float minAmount = cb4_v2.x; float maxAmount = cb4_v3.x; float colorMultiplier = cb4_v0.x; float3 colorFilter = cb4_v1.xyz; float3 lightningColorRGB = cb2_v2.rgb; // Animation using time and X texcoord float animation = elapsedTime * animationSpeed + Input.Texcoords.x; // Input parameters for Integer Noise. // They are floored and please note there are using asint. // That might be an optimization to avoid "ftoi" instructions. int intX0 = asint( floor(animation) ); int intX1 = asint( floor(animation-1.0) ); float n0 = integerNoise( intX0 ); float n1 = integerNoise( intX1 ); // We interpolate "backwards" here. float weight = 1.0 - frac(animation); // Following the instructions from libnoise, we perform // smooth interpolation here with cubic s-curve function. float noise = lerp( n0, n1, s_curve(weight) ); // Make sure we are in [0.0 - 1.0] range. float lightningAmount = saturate( lerp(minAmount, maxAmount, noise) ); lightningAmount *= Input.InstanceLODParams.w; // 1.0 lightningAmount *= cb2_v2.w; // 1.0 // Calculate final lightning color float3 lightningColor = colorMultiplier * colorFilter; lightningColor *= lighntingColorRGB; float3 finalLightningColor = lightningColor * lightningAmount; return float4( finalLightningColor, lightningAmount ); }</span></span></code> </pre> <br><h3> æ€»ç»“ä¸€ä¸‹ </h3><br> åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘æè¿°äº†ä¸€ç§åœ¨ã€Šå·«å¸ˆ3ã€‹ä¸­æ¸²æŸ“é—ªç”µçš„æ–¹æ³•ã€‚ <br><br> æˆ‘å¾ˆé«˜å…´æˆ‘çš„ç€è‰²å™¨äº§ç”Ÿçš„æ±‡ç¼–ä»£ç ä¸åŸå§‹ä»£ç å®Œå…¨åŒ¹é…ï¼ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/25c/708/e50/25c708e503f4528c313c557abb080222.jpg"></div><br><h2> ç¬¬2éƒ¨åˆ†ã€‚æ„šè ¢çš„å¤©ç©ºæŠ€å·§ </h2><br> è¿™éƒ¨åˆ†å°†ä¸ä¹‹å‰çš„éƒ¨åˆ†ç•¥æœ‰ä¸åŒã€‚ åœ¨å…¶ä¸­ï¼Œæˆ‘æƒ³å‘æ‚¨å±•ç¤ºSky Shader Witcher 3çš„æŸäº›æ–¹é¢ã€‚ <br><br> ä¸ºä»€ä¹ˆä½¿ç”¨â€œæ„šè ¢çš„æŠŠæˆâ€è€Œä¸æ˜¯æ•´ä¸ªç€è‰²å™¨ï¼Ÿ å¥½å§ï¼Œæœ‰å‡ ä¸ªåŸå› ã€‚ é¦–å…ˆï¼Œã€Šå·«å¸ˆ3ã€‹çš„å¤©ç©ºç€è‰²å™¨æ˜¯ç›¸å½“å¤æ‚çš„é‡å…½ã€‚  2015ç‰ˆçš„åƒç´ ç€è‰²å™¨åŒ…å«267è¡Œæ±‡ç¼–ä»£ç ï¼ŒBlood and Wine DLCçš„ç€è‰²å™¨åŒ…å«385è¡Œã€‚ <br><br> è€Œä¸”ï¼Œå®ƒä»¬æ¥æ”¶åˆ°å¾ˆå¤šè¾“å…¥ï¼Œè¿™ä¸åˆ©äºå¯¹å®Œæ•´ï¼ˆä¸”å¯è¯»ï¼ï¼‰çš„HLSLä»£ç è¿›è¡Œé€†å‘å·¥ç¨‹ã€‚ <br><br> å› æ­¤ï¼Œæˆ‘å†³å®šåªå±•ç¤ºè¿™äº›ç€è‰²å™¨çš„éƒ¨åˆ†æŠ€å·§ã€‚ å¦‚æœæˆ‘å‘ç°æ–°çš„ä¸œè¥¿ï¼Œæˆ‘å°†è¡¥å……è¯¥èŒä½ã€‚ <br><br>  2015ç‰ˆå’ŒDLCï¼ˆ2016ï¼‰ä¹‹é—´çš„å·®å¼‚éå¸¸æ˜æ˜¾ã€‚ å°¤å…¶æ˜¯ï¼Œå®ƒä»¬åŒ…æ‹¬è®¡ç®—æ˜Ÿæ˜Ÿå’Œé—ªçƒçš„å·®å¼‚ï¼Œä»¥åŠæ¸²æŸ“å¤ªé˜³çš„ä¸åŒæ–¹æ³•ã€‚ <i>è¡€æ¶²å’Œè‘¡è„é…’</i>ç€è‰²å™¨ç”šè‡³å¯ä»¥è®¡ç®—å¤œé—´çš„é“¶æ²³ç³»ã€‚ <br><br> æˆ‘å°†ä»åŸºç¡€çŸ¥è¯†å¼€å§‹ï¼Œç„¶åè®¨è®ºæ„šè ¢çš„æŠŠæˆã€‚ <br><br><h3> åŸºç¡€çŸ¥è¯† </h3><br> åƒå¤§å¤šæ•°ç°ä»£æ¸¸æˆä¸€æ ·ï¼Œã€Šå·«å¸ˆ3ã€‹ä½¿ç”¨skydomeå»ºæ¨¡å¤©ç©ºã€‚ è¯·çœ‹ã€Šå·«å¸ˆ3ã€‹ï¼ˆ2015ï¼‰ä¸­ç”¨äºæ­¤ç›®çš„çš„åŠçƒã€‚ æ³¨æ„ï¼šåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ­¤ç½‘æ ¼çš„è¾¹ç•Œæ¡†åœ¨[0,0,0]åˆ°[1,1,1]çš„èŒƒå›´å†…ï¼ˆZæ˜¯æŒ‡å‘ä¸Šæ–¹çš„è½´ï¼‰ï¼Œå¹¶ä¸”UVå¹³æ»‘åˆ†å¸ƒã€‚ ä»¥åæˆ‘ä»¬ä½¿ç”¨å®ƒä»¬ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3cf/49a/34d/3cf49a34dead2ff2e6f2542487edbf65.jpg"></div><br>  skydomeèƒŒåçš„æƒ³æ³•ç±»ä¼¼äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">skybox</a>çš„æƒ³æ³•ï¼ˆå”¯ä¸€çš„åŒºåˆ«æ˜¯æ‰€ä½¿ç”¨çš„ç½‘æ ¼ï¼‰ã€‚ åœ¨é¡¶ç‚¹ç€è‰²å™¨é˜¶æ®µï¼Œæˆ‘ä»¬ç›¸å¯¹äºè§‚å¯Ÿè€…ï¼ˆé€šå¸¸æ ¹æ®æ‘„å½±æœºçš„ä½ç½®ï¼‰å¯¹å¤©ç©¹è¿›è¡Œè½¬æ¢ï¼Œä»è€Œäº§ç”Ÿä¸€ç§å¹»è±¡ï¼Œå³å¤©ç©ºå®é™…ä¸Šè·ç¦»å¾ˆè¿œ-æˆ‘ä»¬å°†æ°¸è¿œæ— æ³•åˆ°è¾¾å¤©ç©ºã€‚ <br><br> å¦‚æœæ‚¨é˜…è¯»äº†æœ¬ç³»åˆ—æ–‡ç« çš„å‰å‡ éƒ¨åˆ†ï¼Œé‚£ä¹ˆæ‚¨å°±ä¼šçŸ¥é“â€œå·«å¸ˆ3â€ä½¿ç”¨çš„æ˜¯åæ·±åº¦ï¼Œå³è¿œå¹³é¢ä¸º0.0fï¼Œæœ€è¿‘çš„å¹³é¢ä¸º1.0fã€‚ ä¸ºäº†åœ¨è¿œå¹³é¢ä¸Šå®Œæˆskydomeè¾“å‡ºï¼Œåœ¨æµè§ˆçª—å£çš„å‚æ•°ä¸­ï¼Œæˆ‘ä»¬å°†<i>MinDepth</i>è®¾ç½®<i>ä¸º</i>ä¸<i>MaxDepth</i>ç›¸åŒçš„å€¼ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d7/34f/931/2d734f931c687dde42e3bb549a695764.jpg"></div><br> è‹¥è¦äº†è§£åœ¨æµè§ˆçª—å£è½¬æ¢æœŸé—´å¦‚ä½•ä½¿ç”¨<i>MinDepth</i>å’Œ<i>MaxDepthå­—æ®µ</i> ï¼Œè¯·å•å‡»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a> ï¼ˆdocs.microsoft.comï¼‰ã€‚ <br><br><h3> é¡¶ç‚¹ç€è‰²å™¨ </h3><br> è®©æˆ‘ä»¬ä»é¡¶ç‚¹ç€è‰²å™¨å¼€å§‹ã€‚ åœ¨Witcher 3ï¼ˆ2015ï¼‰ä¸­ï¼Œæ±‡ç¼–å™¨ç€è‰²å™¨ä»£ç å¦‚ä¸‹ï¼š <br><br><pre> <code class="cpp hljs"> vs_5_0 dcl_globalFlags refactoringAllowed dcl_constantbuffer cb1[<span class="hljs-number"><span class="hljs-number">4</span></span>], immediateIndexed dcl_constantbuffer cb2[<span class="hljs-number"><span class="hljs-number">6</span></span>], immediateIndexed dcl_input v0.xyz dcl_input v1.xy dcl_output o0.xy dcl_output o1.xyz dcl_output_siv o2.xyzw, position dcl_temps <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: mov o0.xy, v1.xyxx <span class="hljs-number"><span class="hljs-number">1</span></span>: mad r0.xyz, v0.xyzx, cb2[<span class="hljs-number"><span class="hljs-number">4</span></span>].xyzx, cb2[<span class="hljs-number"><span class="hljs-number">5</span></span>].xyzx <span class="hljs-number"><span class="hljs-number">2</span></span>: mov r0.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">3</span></span>: dp4 o1.x, r0.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">0</span></span>].xyzw <span class="hljs-number"><span class="hljs-number">4</span></span>: dp4 o1.y, r0.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">1</span></span>].xyzw <span class="hljs-number"><span class="hljs-number">5</span></span>: dp4 o1.z, r0.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyzw <span class="hljs-number"><span class="hljs-number">6</span></span>: mul r1.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">0</span></span>].yyyy, cb2[<span class="hljs-number"><span class="hljs-number">1</span></span>].xyzw <span class="hljs-number"><span class="hljs-number">7</span></span>: mad r1.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">0</span></span>].xyzw, cb1[<span class="hljs-number"><span class="hljs-number">0</span></span>].xxxx, r1.xyzw <span class="hljs-number"><span class="hljs-number">8</span></span>: mad r1.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyzw, cb1[<span class="hljs-number"><span class="hljs-number">0</span></span>].zzzz, r1.xyzw <span class="hljs-number"><span class="hljs-number">9</span></span>: mad r1.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">0</span></span>].wwww, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>), r1.xyzw <span class="hljs-number"><span class="hljs-number">10</span></span>: dp4 o2.x, r0.xyzw, r1.xyzw <span class="hljs-number"><span class="hljs-number">11</span></span>: mul r1.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">1</span></span>].yyyy, cb2[<span class="hljs-number"><span class="hljs-number">1</span></span>].xyzw <span class="hljs-number"><span class="hljs-number">12</span></span>: mad r1.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">0</span></span>].xyzw, cb1[<span class="hljs-number"><span class="hljs-number">1</span></span>].xxxx, r1.xyzw <span class="hljs-number"><span class="hljs-number">13</span></span>: mad r1.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyzw, cb1[<span class="hljs-number"><span class="hljs-number">1</span></span>].zzzz, r1.xyzw <span class="hljs-number"><span class="hljs-number">14</span></span>: mad r1.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">1</span></span>].wwww, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>), r1.xyzw <span class="hljs-number"><span class="hljs-number">15</span></span>: dp4 o2.y, r0.xyzw, r1.xyzw <span class="hljs-number"><span class="hljs-number">16</span></span>: mul r1.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">2</span></span>].yyyy, cb2[<span class="hljs-number"><span class="hljs-number">1</span></span>].xyzw <span class="hljs-number"><span class="hljs-number">17</span></span>: mad r1.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">0</span></span>].xyzw, cb1[<span class="hljs-number"><span class="hljs-number">2</span></span>].xxxx, r1.xyzw <span class="hljs-number"><span class="hljs-number">18</span></span>: mad r1.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyzw, cb1[<span class="hljs-number"><span class="hljs-number">2</span></span>].zzzz, r1.xyzw <span class="hljs-number"><span class="hljs-number">19</span></span>: mad r1.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">2</span></span>].wwww, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>), r1.xyzw <span class="hljs-number"><span class="hljs-number">20</span></span>: dp4 o2.z, r0.xyzw, r1.xyzw <span class="hljs-number"><span class="hljs-number">21</span></span>: mul r1.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">3</span></span>].yyyy, cb2[<span class="hljs-number"><span class="hljs-number">1</span></span>].xyzw <span class="hljs-number"><span class="hljs-number">22</span></span>: mad r1.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">0</span></span>].xyzw, cb1[<span class="hljs-number"><span class="hljs-number">3</span></span>].xxxx, r1.xyzw <span class="hljs-number"><span class="hljs-number">23</span></span>: mad r1.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyzw, cb1[<span class="hljs-number"><span class="hljs-number">3</span></span>].zzzz, r1.xyzw <span class="hljs-number"><span class="hljs-number">24</span></span>: mad r1.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">3</span></span>].wwww, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>), r1.xyzw <span class="hljs-number"><span class="hljs-number">25</span></span>: dp4 o2.w, r0.xyzw, r1.xyzw <span class="hljs-number"><span class="hljs-number">26</span></span>: ret</code> </pre> <br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé¡¶ç‚¹ç€è‰²å™¨ä»…å°†texcoordså’Œä¸–ç•Œç©ºé—´ä¸­çš„ä½ç½®ä¼ è¾“åˆ°è¾“å‡ºã€‚ åœ¨<i>Blood and Wineä¸­ï¼Œ</i>ä»–è¿˜æ˜¾ç¤ºäº†å½’ä¸€åŒ–çš„æ³•çº¿å‘é‡ã€‚ æˆ‘ä¼šè€ƒè™‘ä½¿ç”¨2015ç‰ˆï¼Œå› ä¸ºå®ƒæ›´ç®€å•ã€‚ <br><br> æŸ¥çœ‹æŒ‡å®šä¸º<b>cb2</b>çš„å¸¸é‡ç¼“å†²åŒºï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/360/38d/fc6/36038dfc67c29ef2934d96314ed46aff.jpg"></div><br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªä¸–ç•ŒçŸ©é˜µï¼ˆæŒ‰100å‡åŒ€ç¼©æ”¾å¹¶ç›¸å¯¹äºæ‘„åƒæœºä½ç½®è¿›è¡Œä¼ è¾“ï¼‰ã€‚ æ²¡ä»€ä¹ˆå¤æ‚çš„ã€‚  cb2_v4å’Œcb2_v5æ˜¯ç”¨äºå°†é¡¶ç‚¹ä½ç½®ä»é—´éš”[0-1]è½¬æ¢ä¸ºé—´éš”[-1; 1]çš„æ¯”ä¾‹/åå·®å› å­ã€‚ ä½†æ˜¯åœ¨è¿™é‡Œï¼Œè¿™äº›ç³»æ•°â€œå‹ç¼©â€ Zè½´ï¼ˆå‘ä¸Šï¼‰ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7e9/774/4c2/7e97744c28b0997b0b11049bee26fa7b.jpg"></div><br> åœ¨æœ¬ç³»åˆ—çš„å‰å‡ éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬æœ‰ç±»ä¼¼çš„é¡¶ç‚¹ç€è‰²å™¨ã€‚ é€šç”¨ç®—æ³•æ˜¯è¿›ä¸€æ­¥ä¼ é€’texcoordsï¼Œç„¶åè€ƒè™‘æ¯”ä¾‹å°º/åå·®ç³»æ•°<i>æ¥</i>è®¡ç®—<i>Position</i> ï¼Œç„¶ååœ¨ä¸–ç•Œç©ºé—´ä¸­è®¡ç®—<i>PositionW</i> ï¼Œç„¶åé€šè¿‡å°†<i>matWorld</i>å’Œ<i>matViewProj</i>ç›¸ä¹˜æ¥è®¡ç®—è£å‰ªç©ºé—´çš„æœ€ç»ˆä½ç½®-&gt;ä½¿ç”¨å®ƒä»¬çš„ä¹˜ç§¯ä¹˜ä»¥<i>Position</i>ä»¥è·å¾—æœ€ç»ˆçš„SV_Position ã€‚ <br><br> å› æ­¤ï¼Œæ­¤é¡¶ç‚¹ç€è‰²å™¨çš„HLSLåº”è¯¥æ˜¯è¿™æ ·çš„ï¼š <br><br><pre> <code class="cpp hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InputStruct</span></span></span><span class="hljs-class"> {</span></span> float3 param0 : POSITION; float2 param1 : TEXCOORD; float3 param2 : NORMAL; float4 param3 : TANGENT; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OutputStruct</span></span></span><span class="hljs-class"> {</span></span> float2 param0 : TEXCOORD0; float3 param1 : TEXCOORD1; float4 param2 : SV_Position; }; <span class="hljs-function"><span class="hljs-function">OutputStruct </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditedShaderVS</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(in InputStruct IN)</span></span></span><span class="hljs-function"> </span></span>{ OutputStruct OUT = (OutputStruct)<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Simple texcoords passing OUT.param0 = IN.param1; // * Manually construct world and viewProj martices from float4s: row_major matrix matWorld = matrix(cb2_v0, cb2_v1, cb2_v2, float4(0,0,0,1) ); matrix matViewProj = matrix(cb1_v0, cb1_v1, cb1_v2, cb1_v3); // * Some optional fun with worldMatrix // a) Scale //matWorld._11 = matWorld._22 = matWorld._33 = 0.225f; // b) Translate // XYZ //matWorld._14 = 520.0997; //matWorld._24 = 74.4226; //matWorld._34 = 113.9; // Local space - note the scale+bias here! //float3 meshScale = float3(2.0, 2.0, 2.0); //float3 meshBias = float3(-1.0, -1.0, -0.4); float3 meshScale = cb2_v4.xyz; float3 meshBias = cb2_v5.xyz; float3 Position = IN.param0 * meshScale + meshBias; // World space float4 PositionW = mul(float4(Position, 1.0), transpose(matWorld) ); OUT.param1 = PositionW.xyz; // Clip space - original approach from The Witcher 3 matrix matWorldViewProj = mul(matViewProj, matWorld); OUT.param2 = mul( float4(Position, 1.0), transpose(matWorldViewProj) ); return OUT; }</span></span></code> </pre> <br> æˆ‘çš„ç€è‰²å™¨ï¼ˆå·¦ï¼‰å’ŒåŸå§‹ç€è‰²å™¨ï¼ˆå³ï¼‰çš„æ¯”è¾ƒï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fd9/ed7/de2/fd9ed7de275ba36551e7751e1d351b8c.jpg"></div><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RenderDocçš„</a>ä¸€ä¸ªå‡ºè‰²ç‰¹æ€§æ˜¯å®ƒå…è®¸æˆ‘ä»¬æ³¨å…¥è‡ªå·±çš„ç€è‰²å™¨ï¼Œè€Œä¸æ˜¯åŸå§‹çš„ç€è‰²å™¨ï¼Œå¹¶ä¸”è¿™äº›æ›´æ”¹å°†å½±å“åˆ°å¸§æœ«å°¾çš„ç®¡é“ã€‚ ä»HLSLä»£ç å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘æä¾›äº†å‡ ä¸ªç”¨äºç¼©æ”¾å’Œå˜æ¢æœ€ç»ˆå‡ ä½•å›¾å½¢çš„é€‰é¡¹ã€‚ æ‚¨å¯ä»¥å¯¹å®ƒä»¬è¿›è¡Œè¯•éªŒï¼Œå¹¶è·å¾—éå¸¸æœ‰è¶£çš„ç»“æœï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0a5/350/e14/0a5350e14231505c0ff1bd5cbf384e15.jpg"></div><br><h4> é¡¶ç‚¹ç€è‰²å™¨ä¼˜åŒ– </h4><br> æ‚¨æ˜¯å¦æ³¨æ„åˆ°åŸå§‹é¡¶ç‚¹ç€è‰²å™¨çš„é—®é¢˜ï¼Ÿ çŸ©é˜µçš„é¡¶ç‚¹ä¹˜ä»¥çŸ©é˜µæ˜¯å®Œå…¨å¤šä½™çš„ï¼ æˆ‘è‡³å°‘åœ¨ä¸€äº›é¡¶ç‚¹ç€è‰²å™¨ä¸­å‘ç°äº†è¿™ä¸€ç‚¹ï¼ˆä¾‹å¦‚ï¼Œåœ¨ç€è‰²å™¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸­è¿œå¤„</a>æœ‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é›¨å¸˜</a> ï¼‰ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ç«‹å³å°†<i>PositionW</i>ä¹˜ä»¥<i>matViewProj</i>æ¥ä¼˜åŒ–å®ƒï¼ <br><br> å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»£ç æ›¿æ¢ä¸ºHLSLï¼š <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// Clip space - original approach from The Witcher 3 matrix matWorldViewProj = mul(matViewProj, matWorld); OUT.param2 = mul( float4(Position, 1.0), transpose(matWorldViewProj) );</span></span></code> </pre> <br> å¦‚ä¸‹ï¼š <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// Clip space - optimized version OUT.param2 = mul( matViewProj, PositionW );</span></span></code> </pre> <br> ä¼˜åŒ–ç‰ˆæœ¬ä¸ºæˆ‘ä»¬æä¾›äº†ä»¥ä¸‹æ±‡ç¼–ä»£ç ï¼š <br><br><pre> <code class="cpp hljs"> vs_5_0 dcl_globalFlags refactoringAllowed dcl_constantbuffer CB1[<span class="hljs-number"><span class="hljs-number">4</span></span>], immediateIndexed dcl_constantbuffer CB2[<span class="hljs-number"><span class="hljs-number">6</span></span>], immediateIndexed dcl_input v0.xyz dcl_input v1.xy dcl_output o0.xy dcl_output o1.xyz dcl_output_siv o2.xyzw, position dcl_temps <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: mov o0.xy, v1.xyxx <span class="hljs-number"><span class="hljs-number">1</span></span>: mad r0.xyz, v0.xyzx, cb2[<span class="hljs-number"><span class="hljs-number">4</span></span>].xyzx, cb2[<span class="hljs-number"><span class="hljs-number">5</span></span>].xyzx <span class="hljs-number"><span class="hljs-number">2</span></span>: mov r0.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">3</span></span>: dp4 r1.x, r0.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">0</span></span>].xyzw <span class="hljs-number"><span class="hljs-number">4</span></span>: dp4 r1.y, r0.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">1</span></span>].xyzw <span class="hljs-number"><span class="hljs-number">5</span></span>: dp4 r1.z, r0.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyzw <span class="hljs-number"><span class="hljs-number">6</span></span>: mov o1.xyz, r1.xyzx <span class="hljs-number"><span class="hljs-number">7</span></span>: mov r1.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span>: dp4 o2.x, cb1[<span class="hljs-number"><span class="hljs-number">0</span></span>].xyzw, r1.xyzw <span class="hljs-number"><span class="hljs-number">9</span></span>: dp4 o2.y, cb1[<span class="hljs-number"><span class="hljs-number">1</span></span>].xyzw, r1.xyzw <span class="hljs-number"><span class="hljs-number">10</span></span>: dp4 o2.z, cb1[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyzw, r1.xyzw <span class="hljs-number"><span class="hljs-number">11</span></span>: dp4 o2.w, cb1[<span class="hljs-number"><span class="hljs-number">3</span></span>].xyzw, r1.xyzw <span class="hljs-number"><span class="hljs-number">12</span></span>: ret</code> </pre> <br> å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»¬å°†æŒ‡ä»¤çš„æ•°é‡ä»26æ¡å‡å°‘åˆ°12æ¡-ç›¸å½“é‡è¦çš„å˜åŒ–ã€‚ æˆ‘ä¸çŸ¥é“è¿™ä¸ªé—®é¢˜åœ¨æ¸¸æˆä¸­çš„æ™®åŠç¨‹åº¦ï¼Œä½†æ˜¯ä¸ºäº†ä¸Šå¸çš„ç¼˜æ•…ï¼ŒCD Projekt Redä¹Ÿè®¸å‘å¸ƒäº†è¡¥ä¸ï¼Ÿ  :) <br><br> è€Œä¸”æˆ‘ä¸æ˜¯åœ¨å¼€ç©ç¬‘ã€‚ æ‚¨å¯ä»¥æ’å…¥ä¼˜åŒ–çš„ç€è‰²å™¨ï¼Œè€Œä¸æ˜¯åŸå§‹çš„RenderDocï¼Œæ‚¨ä¼šçœ‹åˆ°æ­¤ä¼˜åŒ–åœ¨è§†è§‰ä¸Šæ²¡æœ‰ä»»ä½•å½±å“ã€‚ è€å®è¯´ï¼Œæˆ‘ä¸æ˜ç™½ä¸ºä»€ä¹ˆCD Projekt Redå†³å®šæ‰§è¡ŒçŸ©é˜µä¸çŸ©é˜µçš„é¡¶ç‚¹ä¹˜æ³•... <br><br><h3> å¤ªé˜³ </h3><br> åœ¨ã€Šå·«å¸ˆ3ã€‹ï¼ˆ2015å¹´ï¼‰ä¸­ï¼Œå¤§æ°”æ•£å°„å’Œå¤ªé˜³çš„è®¡ç®—åŒ…æ‹¬ä¸¤ä¸ªå•ç‹¬çš„ç»˜å›¾è°ƒç”¨ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/649/9df/02c/6499df02c248c9bab14a597b6b111d6d.jpg"></div><br>  <i>å·«å¸ˆ3ï¼ˆ2015ï¼‰-ç›´åˆ°</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fe6/4ee/77c/fe64ee77c1923920bc01de149ddb60e7.jpg"></div><br>  <i>å·«å¸ˆ3ï¼ˆ2015ï¼‰-å¤©ç©º</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/64d/9e5/416/64d9e541622b33d646b887db01c7c1a2.jpg"></div><br>  <i>å·«å¸ˆ3ï¼ˆ2015ï¼‰-å¤©ç©º+å¤ªé˜³</i> <br><br> å°±å‡ ä½•å½¢çŠ¶å’Œæ··åˆ/æ·±åº¦çŠ¶æ€è€Œè¨€ï¼Œ2015å¹´ç‰ˆæœ¬ä¸­å¤ªé˜³çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ¸²æŸ“ä¸æœˆäº®</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ¸²æŸ“</a>éå¸¸ç›¸ä¼¼ã€‚ <br><br> å¦ä¸€æ–¹é¢ï¼Œåœ¨<i>â€œè¡€æ¶²å’Œè‘¡è„é…’â€</i>ä¸­ï¼Œä¸€æ¬¡æ¸²æŸ“æœ‰å¤ªé˜³<i>çš„</i>å¤©ç©ºï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/184/7dd/daa/1847dddaa38e0876bc829a2d5747c9ce.jpg"></div><br>  <i>å·«å¸ˆ3ï¼šè¡€ä¸é…’ï¼ˆ2016ï¼‰-é€šå¾€å¤©å ‚</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7fa/aff/002/7faaff002cc6d328d663c582c74a3628.jpg"></div><br>  <i>ã€Šå·«å¸ˆ3ï¼šé²œè¡€ä¸ç¾é…’ã€‹ï¼ˆ2016ï¼‰-ã€Šå¤©å ‚ä¸å¤ªé˜³ã€‹</i> <br><br> æ— è®ºæ‚¨å¦‚ä½•æ¸²æŸ“å¤ªé˜³ï¼Œåœ¨æŸä¸ªé˜¶æ®µæ‚¨ä»ç„¶éœ€è¦é˜³å…‰çš„ï¼ˆè§„èŒƒåŒ–ï¼‰æ–¹å‘ã€‚ è·å¾—æ­¤å‘é‡çš„æœ€åˆä¹é€»è¾‘çš„æ–¹æ³•æ˜¯ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çƒåæ ‡</a> ã€‚ å®é™…ä¸Šï¼Œæˆ‘ä»¬åªéœ€è¦ä¸¤ä¸ªè¡¨ç¤ºä¸¤ä¸ªè§’åº¦ï¼ˆä»¥å¼§åº¦è¡¨ç¤ºï¼‰çš„å€¼å³å¯ï¼š <i>Phi</i>å’Œ<i>theta</i> ã€‚ æ”¶åˆ°å®ƒä»¬åï¼Œæˆ‘ä»¬å¯ä»¥å‡å®š<i>r = 1</i> ï¼Œä»è€Œå°†å…¶å‡å°ã€‚ ç„¶åï¼Œå¯¹äºYè½´æŒ‡å‘ä¸Šæ–¹çš„ç›´è§’åæ ‡ï¼Œå¯ä»¥åœ¨HLSLä¸­ç¼–å†™ä»¥ä¸‹ä»£ç ï¼š <br><br><pre> <code class="cpp hljs"> float3 vSunDir; vSunDir.x = <span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(fTheta)*<span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>(fPhi); vSunDir.y = <span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(fTheta)*<span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(fPhi); vSunDir.z = <span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>(fTheta); vSunDir = normalize(vSunDir);</code> </pre> <br> é€šå¸¸ï¼Œåœ¨åº”ç”¨ç¨‹åºä¸­è®¡ç®—æ—¥å…‰çš„æ–¹å‘ï¼Œç„¶åå°†å…¶ä¼ é€’ç»™å¸¸é‡ç¼“å†²åŒºä»¥å¤‡å°†æ¥ä½¿ç”¨ã€‚ <br><br> æ¥æ”¶åˆ°é˜³å…‰çš„æ–¹å‘åï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ·±å…¥åœ°ç ”ç©¶<i>â€œ Blood and Wineâ€</i>åƒç´ ç€è‰²å™¨çš„æ±‡ç¼–ä»£ç ... <br><br><pre> <code class="cpp hljs"> ... <span class="hljs-number"><span class="hljs-number">100</span></span>: add r1.xyw, -r0.xyxz, cb12[<span class="hljs-number"><span class="hljs-number">0</span></span>].xyxz <span class="hljs-number"><span class="hljs-number">101</span></span>: dp3 r2.x, r1.xywx, r1.xywx <span class="hljs-number"><span class="hljs-number">102</span></span>: rsq r2.x, r2.x <span class="hljs-number"><span class="hljs-number">103</span></span>: mul r1.xyw, r1.xyxw, r2.xxxx <span class="hljs-number"><span class="hljs-number">104</span></span>: mov_sat r2.xy, cb12[<span class="hljs-number"><span class="hljs-number">205</span></span>].yxyy <span class="hljs-number"><span class="hljs-number">105</span></span>: dp3 r2.z, -r1.xywx, -r1.xywx <span class="hljs-number"><span class="hljs-number">106</span></span>: rsq r2.z, r2.z <span class="hljs-number"><span class="hljs-number">107</span></span>: mul r1.xyw, -r1.xyxw, r2.zzzz ...</code> </pre> <br> å› æ­¤ï¼Œé¦–å…ˆï¼Œ <i>cb12 [0] .xyz</i>æ˜¯æ‘„åƒæœºä½ç½®ï¼Œåœ¨<i>r0.xyzä¸­ï¼Œ</i>æˆ‘ä»¬å­˜å‚¨é¡¶ç‚¹ä½ç½®ï¼ˆè¿™æ˜¯é¡¶ç‚¹ç€è‰²å™¨çš„è¾“å‡ºï¼‰ã€‚ å› æ­¤ï¼Œç¬¬100è¡Œè®¡ç®—å‘é‡<i>worldToCamera</i> ã€‚ ä½†æ˜¯ï¼Œè¯·çœ‹ç¬¬105-107è¡Œã€‚ æˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬å†™ä¸º<i>å½’ä¸€åŒ–ï¼ˆ-worldToCameraï¼‰</i> ï¼Œå³æˆ‘ä»¬è®¡ç®—å½’ä¸€åŒ–çš„<i>cameraToWorld</i>å‘é‡ã€‚ <br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">120</span></span>: dp3_sat r1.x, cb12[<span class="hljs-number"><span class="hljs-number">203</span></span>].yzwy, r1.xywx</code> </pre> <br> ç„¶åï¼Œæˆ‘ä»¬è®¡ç®—<i>cameraToWorld</i>å’Œ<i>sunDirectionå‘é‡</i>çš„æ ‡é‡ç§¯ï¼ è¯·è®°ä½ï¼Œå¿…é¡»å°†å®ƒä»¬æ ‡å‡†åŒ–ã€‚ æˆ‘ä»¬è¿˜ä½¿è¯¥å®Œæ•´è¡¨è¾¾å¼é¥±å’Œï¼Œä»¥å°†å…¶é™åˆ¶ä¸ºé—´éš”[0-1]ã€‚ <br><br> å¤ªå¥½äº†ï¼ è¯¥æ ‡é‡ç§¯å­˜å‚¨åœ¨r1.xä¸­ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹å®ƒçš„ä¸‹ä¸€æ­¥åº”ç”¨... <br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">152</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> r1.x, r1.x <span class="hljs-number"><span class="hljs-number">153</span></span>: mul r1.x, r1.x, cb12[<span class="hljs-number"><span class="hljs-number">203</span></span>].x <span class="hljs-number"><span class="hljs-number">154</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">exp</span></span> r1.x, r1.x <span class="hljs-number"><span class="hljs-number">155</span></span>: mul r1.x, r2.y, r1.x</code> </pre> <br> ä¸‰ä½ä¸€ä½“â€œ logï¼Œmulï¼Œexpâ€æ˜¯å¹‚ã€‚ å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»¬å°†ä½™å¼¦ï¼ˆå½’ä¸€åŒ–å‘é‡çš„æ ‡é‡ç§¯ï¼‰æé«˜åˆ°ä¸€å®šç¨‹åº¦ã€‚ æ‚¨å¯èƒ½ä¼šé—®ä¸ºä»€ä¹ˆã€‚ è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºæ¨¡ä»¿å¤ªé˜³çš„æ¸å˜ã€‚  ï¼ˆå¹¶ä¸”ç¬¬155è¡Œä¼šå½±å“æ­¤æ¸å˜çš„ä¸é€æ˜åº¦ï¼Œå› æ­¤ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬å°†å…¶é‡ç½®ä¸ºå®Œå…¨éšè—å¤ªé˜³ï¼‰ã€‚ ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/674/662/658/6746626580dbe0d943c27bcda10f8a9d.jpg"></div><br>  <i>æŒ‡æ•°= 54</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b0a/a4e/fca/b0aa4efcae350fe8423e3bc8a1463d78.jpg"></div><br>  <i>æŒ‡æ•°= 2400</i> <br><br> æœ‰äº†è¿™ä¸ªæ¸å˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å®ƒåœ¨<i>skyColor</i>å’Œ<i>sunColor</i>ä¹‹é—´è¿›è¡Œæ’å€¼ï¼ ä¸ºé¿å…å‡ºç°ä¼ªå½±ï¼Œæ‚¨éœ€è¦ä½¿ç¬¬120è¡Œçš„å€¼é¥±å’Œã€‚ <br><br> å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¯¥æŠ€å·§å¯ç”¨äºæ¨¡æ‹Ÿæœˆçƒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å† </a> ï¼ˆåœ¨ä½æŒ‡æ•°å€¼ä¸‹ï¼‰ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦<i>moonDirection</i>å‘é‡ï¼Œå¯ä»¥ä½¿ç”¨çƒåæ ‡è½»æ¾è®¡ç®—å‡ºè¯¥å‘é‡ã€‚ <br><br> ç°æˆçš„HLSLä»£ç å¯èƒ½ç±»ä¼¼äºä»¥ä¸‹ä»£ç æ®µï¼š <br><br><pre> <code class="cpp hljs"> float3 vCamToWorld = normalize( PosW â€“ CameraPos ); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cosTheta = saturate( dot(vSunDir, vCamToWorld) ); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sunGradient = <span class="hljs-built_in"><span class="hljs-built_in">pow</span></span>( cosTheta, sunExponent ); float3 color = lerp( skyColor, sunColor, sunGradient );</code> </pre> <br><h3> æ˜Ÿæ˜Ÿè¿åŠ¨ </h3><br> å¦‚æœæ‚¨å°†â€œå·«å¸ˆ3â€æ™´æœ—çš„å¤œç©ºå»¶æ—¶æ‹æ‘„ï¼Œæ‚¨ä¼šå‘ç°æ˜Ÿæ˜Ÿä¸æ˜¯é™æ­¢çš„-å®ƒä»¬åœ¨å¤©ç©ºä¸­ç§»åŠ¨ä¸€äº›ï¼ æˆ‘å‡ ä¹å¶ç„¶åœ°æ³¨æ„åˆ°äº†è¿™ä¸€ç‚¹ï¼Œå¹¶æƒ³çŸ¥é“å®ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚ <br><br> è®©æˆ‘ä»¬ä»ä»¥ä¸‹äº‹å®å¼€å§‹ï¼šå·«å¸ˆ3ä¸­çš„æ’æ˜Ÿä»¥å¤§å°ä¸º1024x1024x6çš„ç«‹æ–¹å›¾è¡¨ç¤ºã€‚ å¦‚æœæ‚¨è€ƒè™‘ä¸€ä¸‹ï¼Œæ‚¨å°†ç†è§£è¿™æ˜¯ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„è§£å†³æ–¹æ¡ˆï¼Œå¯è®©æ‚¨è½»æ¾åœ°ä¸ºé‡‡æ ·ç«‹æ–¹å›¾ç¡®å®šæ–¹å‘ã€‚ <br><br> è®©æˆ‘ä»¬çœ‹ä¸‹é¢çš„æ±‡ç¼–ä»£ç ï¼š <br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">159</span></span>: add r1.xyz, -v1.xyzx, cb1[<span class="hljs-number"><span class="hljs-number">8</span></span>].xyzx <span class="hljs-number"><span class="hljs-number">160</span></span>: dp3 r0.w, r1.xyzx, r1.xyzx <span class="hljs-number"><span class="hljs-number">161</span></span>: rsq r0.w, r0.w <span class="hljs-number"><span class="hljs-number">162</span></span>: mul r1.xyz, r0.wwww, r1.xyzx <span class="hljs-number"><span class="hljs-number">163</span></span>: mul r2.xyz, cb12[<span class="hljs-number"><span class="hljs-number">204</span></span>].zwyz, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">164</span></span>: mad r2.xyz, cb12[<span class="hljs-number"><span class="hljs-number">204</span></span>].yzwy, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>), -r2.xyzx <span class="hljs-number"><span class="hljs-number">165</span></span>: mul r4.xyz, r2.xyzx, cb12[<span class="hljs-number"><span class="hljs-number">204</span></span>].zwyz <span class="hljs-number"><span class="hljs-number">166</span></span>: mad r4.xyz, r2.zxyz, cb12[<span class="hljs-number"><span class="hljs-number">204</span></span>].wyzw, -r4.xyzx <span class="hljs-number"><span class="hljs-number">167</span></span>: dp3 r4.x, r1.xyzx, r4.xyzx <span class="hljs-number"><span class="hljs-number">168</span></span>: dp2 r4.y, r1.xyxx, r2.yzyy <span class="hljs-number"><span class="hljs-number">169</span></span>: dp3 r4.z, r1.xyzx, cb12[<span class="hljs-number"><span class="hljs-number">204</span></span>].yzwy <span class="hljs-number"><span class="hljs-number">170</span></span>: dp3 r0.w, r4.xyzx, r4.xyzx <span class="hljs-number"><span class="hljs-number">171</span></span>: rsq r0.w, r0.w <span class="hljs-number"><span class="hljs-number">172</span></span>: mul r2.xyz, r0.wwww, r4.xyzx <span class="hljs-number"><span class="hljs-number">173</span></span>: sample_indexable(texturecube)(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) r4.xyz, r2.xyzx, t0.xyzw, s0</code> </pre> <br> ä¸ºäº†è®¡ç®—æœ€ç»ˆé‡‡æ ·å‘é‡ï¼ˆç¬¬173è¡Œï¼‰ï¼Œæˆ‘ä»¬é¦–å…ˆè®¡ç®—å½’ä¸€åŒ–çš„<i>worldToCamera</i>å‘é‡ï¼ˆç¬¬159-162è¡Œï¼‰ã€‚ <br><br> ç„¶åæˆ‘ä»¬ä½¿ç”¨<i>moonDirection</i>è®¡ç®—ä¸¤ä¸ªå‘é‡ä¹˜ç§¯ï¼ˆ <i>163-164ï¼Œ165-166ï¼‰</i> ï¼Œç„¶åæˆ‘ä»¬è®¡ç®—ä¸‰ä¸ªæ ‡é‡ä¹˜ç§¯ä»¥è·å¾—æœ€ç»ˆé‡‡æ ·å‘é‡ã€‚  HLSLä»£ç ï¼š <br><br><pre> <code class="cpp hljs"> float3 vWorldToCamera = normalize( g_CameraPos.xyz - Input.PositionW.xyz ); float3 vMoonDirection = cb12_v204.yzw; float3 vStarsSamplingDir = cross( vMoonDirection, float3(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) ); float3 vStarsSamplingDir2 = cross( vStarsSamplingDir, vMoonDirection ); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dirX = dot( vWorldToCamera, vStarsSamplingDir2 ); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dirY = dot( vWorldToCamera, vStarsSamplingDir ); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dirZ = dot( vWorldToCamera, vMoonDirection); float3 dirXYZ = normalize( float3(dirX, dirY, dirZ) ); float3 starsColor = texNightStars.Sample( samplerAnisoWrap, dirXYZ ).rgb;</code> </pre> <br> è¯·æ³¨æ„ï¼šè¿™æ˜¯ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„ä»£ç ï¼Œæˆ‘åº”è¯¥å¯¹å…¶è¿›è¡Œè¯¦ç»†ç ”ç©¶ã€‚ <br><br> è¯»è€…æ³¨æ„ï¼šå¦‚æœæ‚¨å¯¹æ­¤æ“ä½œäº†è§£æ›´å¤šï¼Œè¯·å‘Šè¯‰æˆ‘ï¼ <br><br><h3> é—ªçƒçš„æ˜Ÿæ˜Ÿ </h3><br> æˆ‘æƒ³æ›´è¯¦ç»†åœ°æ¢è®¨çš„å¦ä¸€ä¸ªæœ‰è¶£çš„æŠ€å·§æ˜¯æ˜Ÿæ˜Ÿçš„é—ªçƒã€‚<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åœ¨æ™´æœ—çš„å¤©æ°”ä¸­åœ¨è¯ºç»´æ ¼å‹’ï¼ˆNovigradï¼‰å‘¨å›´å¾˜å¾Šï¼Œæ‚¨ä¼šæ³¨æ„åˆ°æ˜Ÿæ˜Ÿé—ªçƒã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å¾ˆå¥½å¥‡è¿™æ˜¯å¦‚ä½•å®ç°çš„ã€‚äº‹å®è¯æ˜ï¼Œ2015ç‰ˆä¸</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â€œè¡€æ¶²ä¸è‘¡è„é…’â€</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¹‹é—´çš„å·®å¼‚</font><font style="vertical-align: inherit;">éå¸¸å¤§ã€‚ä¸ºç®€å•èµ·è§ï¼Œæˆ‘å°†è€ƒè™‘2015ç‰ˆã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬</font><font style="vertical-align: inherit;">ä»ä¸Šä¸€èŠ‚ä¸­çš„</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">starsColor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‡‡æ ·ä¹‹åå¼€å§‹</font><font style="vertical-align: inherit;">ï¼š</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">174</span></span>: mul r0.w, v0.x, l(<span class="hljs-number"><span class="hljs-number">100.000000</span></span>) <span class="hljs-number"><span class="hljs-number">175</span></span>: round_ni r1.w, r0.w <span class="hljs-number"><span class="hljs-number">176</span></span>: mad r2.w, v0.y, l(<span class="hljs-number"><span class="hljs-number">50.000000</span></span>), cb0[<span class="hljs-number"><span class="hljs-number">0</span></span>].x <span class="hljs-number"><span class="hljs-number">177</span></span>: round_ni r4.w, r2.w <span class="hljs-number"><span class="hljs-number">178</span></span>: bfrev r4.w, r4.w <span class="hljs-number"><span class="hljs-number">179</span></span>: iadd r5.x, r1.w, r4.w <span class="hljs-number"><span class="hljs-number">180</span></span>: ishr r5.y, r5.x, l(<span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-number"><span class="hljs-number">181</span></span>: xor r5.x, r5.x, r5.y <span class="hljs-number"><span class="hljs-number">182</span></span>: imul null, r5.y, r5.x, r5.x <span class="hljs-number"><span class="hljs-number">183</span></span>: imad r5.y, r5.y, l(<span class="hljs-number"><span class="hljs-number">0x0000ec4d</span></span>), l(<span class="hljs-number"><span class="hljs-number">0.0000000000000000000000000000000000001</span></span>) <span class="hljs-number"><span class="hljs-number">184</span></span>: imad r5.x, r5.x, r5.y, l(<span class="hljs-number"><span class="hljs-number">146956042240.000000</span></span>) <span class="hljs-number"><span class="hljs-number">185</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> r5.x, r5.x, l(<span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>) <span class="hljs-number"><span class="hljs-number">186</span></span>: itof r5.x, r5.x <span class="hljs-number"><span class="hljs-number">187</span></span>: mad r5.y, v0.x, l(<span class="hljs-number"><span class="hljs-number">100.000000</span></span>), l(<span class="hljs-number"><span class="hljs-number">-1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">188</span></span>: round_ni r5.y, r5.y <span class="hljs-number"><span class="hljs-number">189</span></span>: iadd r4.w, r4.w, r5.y <span class="hljs-number"><span class="hljs-number">190</span></span>: ishr r5.z, r4.w, l(<span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-number"><span class="hljs-number">191</span></span>: xor r4.w, r4.w, r5.z <span class="hljs-number"><span class="hljs-number">192</span></span>: imul null, r5.z, r4.w, r4.w <span class="hljs-number"><span class="hljs-number">193</span></span>: imad r5.z, r5.z, l(<span class="hljs-number"><span class="hljs-number">0x0000ec4d</span></span>), l(<span class="hljs-number"><span class="hljs-number">0.0000000000000000000000000000000000001</span></span>) <span class="hljs-number"><span class="hljs-number">194</span></span>: imad r4.w, r4.w, r5.z, l(<span class="hljs-number"><span class="hljs-number">146956042240.000000</span></span>) <span class="hljs-number"><span class="hljs-number">195</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> r4.w, r4.w, l(<span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>) <span class="hljs-number"><span class="hljs-number">196</span></span>: itof r4.w, r4.w <span class="hljs-number"><span class="hljs-number">197</span></span>: add r5.z, r2.w, l(<span class="hljs-number"><span class="hljs-number">-1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">198</span></span>: round_ni r5.z, r5.z <span class="hljs-number"><span class="hljs-number">199</span></span>: bfrev r5.z, r5.z <span class="hljs-number"><span class="hljs-number">200</span></span>: iadd r1.w, r1.w, r5.z <span class="hljs-number"><span class="hljs-number">201</span></span>: ishr r5.w, r1.w, l(<span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-number"><span class="hljs-number">202</span></span>: xor r1.w, r1.w, r5.w <span class="hljs-number"><span class="hljs-number">203</span></span>: imul null, r5.w, r1.w, r1.w <span class="hljs-number"><span class="hljs-number">204</span></span>: imad r5.w, r5.w, l(<span class="hljs-number"><span class="hljs-number">0x0000ec4d</span></span>), l(<span class="hljs-number"><span class="hljs-number">0.0000000000000000000000000000000000001</span></span>) <span class="hljs-number"><span class="hljs-number">205</span></span>: imad r1.w, r1.w, r5.w, l(<span class="hljs-number"><span class="hljs-number">146956042240.000000</span></span>) <span class="hljs-number"><span class="hljs-number">206</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> r1.w, r1.w, l(<span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>) <span class="hljs-number"><span class="hljs-number">207</span></span>: itof r1.w, r1.w <span class="hljs-number"><span class="hljs-number">208</span></span>: mul r1.w, r1.w, l(<span class="hljs-number"><span class="hljs-number">0.000000001</span></span>) <span class="hljs-number"><span class="hljs-number">209</span></span>: iadd r5.y, r5.z, r5.y <span class="hljs-number"><span class="hljs-number">210</span></span>: ishr r5.z, r5.y, l(<span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-number"><span class="hljs-number">211</span></span>: xor r5.y, r5.y, r5.z <span class="hljs-number"><span class="hljs-number">212</span></span>: imul null, r5.z, r5.y, r5.y <span class="hljs-number"><span class="hljs-number">213</span></span>: imad r5.z, r5.z, l(<span class="hljs-number"><span class="hljs-number">0x0000ec4d</span></span>), l(<span class="hljs-number"><span class="hljs-number">0.0000000000000000000000000000000000001</span></span>) <span class="hljs-number"><span class="hljs-number">214</span></span>: imad r5.y, r5.y, r5.z, l(<span class="hljs-number"><span class="hljs-number">146956042240.000000</span></span>) <span class="hljs-number"><span class="hljs-number">215</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> r5.y, r5.y, l(<span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>) <span class="hljs-number"><span class="hljs-number">216</span></span>: itof r5.y, r5.y <span class="hljs-number"><span class="hljs-number">217</span></span>: frc r0.w, r0.w <span class="hljs-number"><span class="hljs-number">218</span></span>: add r0.w, -r0.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">219</span></span>: mul r5.z, r0.w, r0.w <span class="hljs-number"><span class="hljs-number">220</span></span>: mul r0.w, r0.w, r5.z <span class="hljs-number"><span class="hljs-number">221</span></span>: mul r5.xz, r5.xxzx, l(<span class="hljs-number"><span class="hljs-number">0.000000001</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">3.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">222</span></span>: mad r0.w, r0.w, l(<span class="hljs-number"><span class="hljs-number">-2.000000</span></span>), r5.z <span class="hljs-number"><span class="hljs-number">223</span></span>: frc r2.w, r2.w <span class="hljs-number"><span class="hljs-number">224</span></span>: add r2.w, -r2.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">225</span></span>: mul r5.z, r2.w, r2.w <span class="hljs-number"><span class="hljs-number">226</span></span>: mul r2.w, r2.w, r5.z <span class="hljs-number"><span class="hljs-number">227</span></span>: mul r5.z, r5.z, l(<span class="hljs-number"><span class="hljs-number">3.000000</span></span>) <span class="hljs-number"><span class="hljs-number">228</span></span>: mad r2.w, r2.w, l(<span class="hljs-number"><span class="hljs-number">-2.000000</span></span>), r5.z <span class="hljs-number"><span class="hljs-number">229</span></span>: mad r4.w, r4.w, l(<span class="hljs-number"><span class="hljs-number">0.000000001</span></span>), -r5.x <span class="hljs-number"><span class="hljs-number">230</span></span>: mad r4.w, r0.w, r4.w, r5.x <span class="hljs-number"><span class="hljs-number">231</span></span>: mad r5.x, r5.y, l(<span class="hljs-number"><span class="hljs-number">0.000000001</span></span>), -r1.w <span class="hljs-number"><span class="hljs-number">232</span></span>: mad r0.w, r0.w, r5.x, r1.w <span class="hljs-number"><span class="hljs-number">233</span></span>: add r0.w, -r4.w, r0.w <span class="hljs-number"><span class="hljs-number">234</span></span>: mad r0.w, r2.w, r0.w, r4.w <span class="hljs-number"><span class="hljs-number">235</span></span>: mad r2.xyz, r0.wwww, l(<span class="hljs-number"><span class="hljs-number">0.000500</span></span>, <span class="hljs-number"><span class="hljs-number">0.000500</span></span>, <span class="hljs-number"><span class="hljs-number">0.000500</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>), r2.xyzx <span class="hljs-number"><span class="hljs-number">236</span></span>: sample_indexable(texturecube)(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) r2.xyz, r2.xyzx, t0.xyzw, s0 <span class="hljs-number"><span class="hljs-number">237</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> r4.xyz, r4.xyzx <span class="hljs-number"><span class="hljs-number">238</span></span>: mul r4.xyz, r4.xyzx, l(<span class="hljs-number"><span class="hljs-number">2.200000</span></span>, <span class="hljs-number"><span class="hljs-number">2.200000</span></span>, <span class="hljs-number"><span class="hljs-number">2.200000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">239</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">exp</span></span> r4.xyz, r4.xyzx <span class="hljs-number"><span class="hljs-number">240</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> r2.xyz, r2.xyzx <span class="hljs-number"><span class="hljs-number">241</span></span>: mul r2.xyz, r2.xyzx, l(<span class="hljs-number"><span class="hljs-number">2.200000</span></span>, <span class="hljs-number"><span class="hljs-number">2.200000</span></span>, <span class="hljs-number"><span class="hljs-number">2.200000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">242</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">exp</span></span> r2.xyz, r2.xyzx <span class="hljs-number"><span class="hljs-number">243</span></span>: mul r2.xyz, r2.xyzx, r4.xyzx</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å—¯è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™æ®µç›¸å½“é•¿çš„æ±‡ç¼–ä»£ç çš„ç»“å°¾ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨</font><font style="vertical-align: inherit;">ç¬¬173è¡Œä¸Š</font><font style="vertical-align: inherit;">å¯¹</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">starsColor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿›è¡Œ</font><font style="vertical-align: inherit;">é‡‡æ ·å</font><font style="vertical-align: inherit;">ï¼Œæˆ‘ä»¬è®¡ç®—å‡ºæŸç§</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åç§»</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å€¼</font><font style="vertical-align: inherit;">ã€‚è¯¥</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åç§»é‡</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”¨äºä½¿é‡‡æ ·çš„ç¬¬ä¸€ä¸ªæ–¹å‘å¤±çœŸï¼ˆr2.xyzï¼Œç¬¬235è¡Œï¼‰ï¼Œç„¶åå†æ¬¡å¯¹æ’æ˜Ÿçš„ä¸‰æ¬¡æ–¹å›¾è¿›è¡Œé‡‡æ ·ï¼Œå¯¹è¿™ä¸¤ä¸ªå€¼è¿›è¡Œä¼½ç›æ ¡æ­£ï¼ˆ237-242ï¼‰å¹¶å°†å®ƒä»¬ç›¸ä¹˜ï¼ˆ243ï¼‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç®€å•å§ï¼Ÿå¥½å§ï¼Œä¸æ˜¯çœŸçš„ã€‚è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹è¿™ä¸ª</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åç§»é‡</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚åœ¨æ•´ä¸ªç©¹é¡¶ä¸­ï¼Œæ­¤å€¼åº”æœ‰æ‰€ä¸åŒ-é—ªçƒçš„æ˜Ÿæ˜Ÿçœ‹èµ·æ¥éå¸¸ä¸ç°å®ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŠµæ¶ˆ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœUVå°½å¯èƒ½å¤šæ ·åŒ–ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨UVå»¶ä¼¸åˆ°å¤©ç©¹ï¼ˆv0.xyï¼‰å¹¶åº”ç”¨å­˜å‚¨åœ¨å¸¸é‡ç¼“å†²åŒºï¼ˆcb [0] .xï¼‰ä¸­çš„ç»è¿‡æ—¶é—´è¿™ä¸€äº‹å®ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰è¿™äº›ä»¤äººææƒ§çš„ishr / xor /ï¼Œé‚£ä¹ˆåœ¨æœ‰å…³é—ªç”µæ•ˆæœçš„éƒ¨åˆ†ä¸­ï¼Œè¯·é˜…è¯»æœ‰å…³æ•´æ•°å™ªå£°çš„å†…å®¹ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æ‚¨æ‰€è§ï¼Œè¿™é‡Œä¼šäº§ç”Ÿå››æ¬¡æ•´æ•°å™ªå£°ï¼Œä½†å®ƒä¸åŒäºé›·ç”µã€‚ä¸ºäº†ä½¿ç»“æœæ›´åŠ éšæœºï¼Œå™ªå£°çš„è¾“å…¥æ•´æ•°æ˜¯æ€»å’Œï¼ˆ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iadd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ï¼Œå¹¶ä¸”å°†å…¶</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ä¹‹å–</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åï¼ˆå†…éƒ¨å‡½æ•°</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">reversebits</font></a><font style="vertical-align: inherit;">ï¼›</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bfrev</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŒ‡ä»¤</font><font style="vertical-align: inherit;">ï¼‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰€ä»¥ï¼Œç°åœ¨æ…¢ä¸‹æ¥ã€‚è®©æˆ‘ä»¬ä»å¤´å¼€å§‹ã€‚</font></font><br><br>    4 Â«Â»  .    ,   4   : <br><br><pre> <code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> asint( <span class="hljs-built_in"><span class="hljs-built_in">floor</span></span>(x) ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getReverseInt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> reversebits( getInt(x) ); } <span class="hljs-comment"><span class="hljs-comment">// * Inputs - UV and elapsed time in seconds float2 starsUV; starsUV.x = 100.0 * Input.TextureUV.x; starsUV.y = 50.0 * Input.TextureUV.y + g_fTime; // * Iteration 1 int iStars1_A = getReverseInt( starsUV.y ); int iStars1_B = getInt( starsUV.x ); float fStarsNoise1 = integerNoise( iStars1_A + iStars1_B ); // * Iteration 2 int iStars2_A = getReverseInt( starsUV.y ); int iStars2_B = getInt( starsUV.x - 1.0 ); float fStarsNoise2 = integerNoise( iStars2_A + iStars2_B ); // * Iteration 3 int iStars3_A = getReverseInt( starsUV.y - 1.0 ); int iStars3_B = getInt( starsUV.x ); float fStarsNoise3 = integerNoise( iStars3_A + iStars3_B ); // * Iteration 4 int iStars4_A = getReverseInt( starsUV.y - 1.0 ); int iStars4_B = getInt( starsUV.x - 1.0 ); float fStarsNoise4 = integerNoise( iStars4_A + iStars4_B );</span></span></code> </pre> <br>     4  (  ,    <i>itof</i> ): <br><br>  1 â€” r5.x, <br><br>  2 â€” r4.w, <br><br>  3 â€” r1.w, <br><br>  4 â€” r5.y <br><br>   <i>itof</i> ( 216)  : <br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">217</span></span>: frc r0.w, r0.w <span class="hljs-number"><span class="hljs-number">218</span></span>: add r0.w, -r0.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">219</span></span>: mul r5.z, r0.w, r0.w <span class="hljs-number"><span class="hljs-number">220</span></span>: mul r0.w, r0.w, r5.z <span class="hljs-number"><span class="hljs-number">221</span></span>: mul r5.xz, r5.xxzx, l(<span class="hljs-number"><span class="hljs-number">0.000000001</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">3.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">222</span></span>: mad r0.w, r0.w, l(<span class="hljs-number"><span class="hljs-number">-2.000000</span></span>), r5.z <span class="hljs-number"><span class="hljs-number">223</span></span>: frc r2.w, r2.w <span class="hljs-number"><span class="hljs-number">224</span></span>: add r2.w, -r2.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">225</span></span>: mul r5.z, r2.w, r2.w <span class="hljs-number"><span class="hljs-number">226</span></span>: mul r2.w, r2.w, r5.z <span class="hljs-number"><span class="hljs-number">227</span></span>: mul r5.z, r5.z, l(<span class="hljs-number"><span class="hljs-number">3.000000</span></span>) <span class="hljs-number"><span class="hljs-number">228</span></span>: mad r2.w, r2.w, l(<span class="hljs-number"><span class="hljs-number">-2.000000</span></span>), r5.z</code> </pre> <br>     S-        UV,      . å› æ­¤ï¼š <br><br><pre> <code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s_curve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x2 = x * x; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x3 = x2 * x; <span class="hljs-comment"><span class="hljs-comment">// -2x^3 + 3x^2 return -2.0*x3 + 3.0*x2; } ... // lines 217-222 float weightX = 1.0 - frac( starsUV.x ); weightX = s_curve( weightX ); // lines 223-228 float weightY = 1.0 - frac( starsUV.y ); weightY = s_curve( weightY );</span></span></code> </pre> <br>    ,              : <br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">229</span></span>: mad r4.w, r4.w, l(<span class="hljs-number"><span class="hljs-number">0.000000001</span></span>), -r5.x <span class="hljs-number"><span class="hljs-number">230</span></span>: mad r4.w, r0.w, r4.w, r5.x <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> noise0 = lerp( fStarsNoise1, fStarsNoise2, weightX ); <span class="hljs-number"><span class="hljs-number">231</span></span>: mad r5.x, r5.y, l(<span class="hljs-number"><span class="hljs-number">0.000000001</span></span>), -r1.w <span class="hljs-number"><span class="hljs-number">232</span></span>: mad r0.w, r0.w, r5.x, r1.w <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> noise1 = lerp( fStarsNoise3, fStarsNoise4, weightX ); <span class="hljs-number"><span class="hljs-number">233</span></span>: add r0.w, -r4.w, r0.w <span class="hljs-number"><span class="hljs-number">234</span></span>: mad r0.w, r2.w, r0.w, r4.w <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> offset = lerp( noise0, noise1, weightY ); <span class="hljs-number"><span class="hljs-number">235</span></span>: mad r2.xyz, r0.wwww, l(<span class="hljs-number"><span class="hljs-number">0.000500</span></span>, <span class="hljs-number"><span class="hljs-number">0.000500</span></span>, <span class="hljs-number"><span class="hljs-number">0.000500</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>), r2.xyzx <span class="hljs-number"><span class="hljs-number">236</span></span>: sample_indexable(texturecube)(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) r2.xyz, r2.xyzx, t0.xyzw, s0 float3 starsPerturbedDir = dirXYZ + offset * <span class="hljs-number"><span class="hljs-number">0.0005</span></span>; float3 starsColorDisturbed = texNightStars.Sample( samplerAnisoWrap, starsPerturbedDir ).rgb;</code> </pre> <br>     <i>offset</i> : <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/SAI-cLJFpfg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è®¡ç®—äº†</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">starsColorDisturbedä¹‹åï¼Œ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€éš¾çš„éƒ¨åˆ†å°±å®Œæˆäº†ã€‚</font></font>ä¸‡å²ï¼ <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸‹ä¸€æ­¥æ˜¯å¯¹</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">starsColor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">starsColorDisturbed</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿›è¡Œä¼½ç›æ ¡æ­£</font><font style="vertical-align: inherit;">ï¼Œç„¶åå°†å®ƒä»¬ç›¸ä¹˜ï¼š</font></font><br><br><pre> <code class="cpp hljs"> starsColor = <span class="hljs-built_in"><span class="hljs-built_in">pow</span></span>( starsColor, <span class="hljs-number"><span class="hljs-number">2.2</span></span> ); starsColorDisturbed = <span class="hljs-built_in"><span class="hljs-built_in">pow</span></span>( starsColorDisturbed, <span class="hljs-number"><span class="hljs-number">2.2</span></span> ); float3 starsFinal = starsColor * starsColorDisturbed;</code> </pre> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ˜Ÿæ˜Ÿ-ç”»é¾™ç‚¹ç› </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬æœ‰</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">starsFinal</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨r1.xyzã€‚</font><font style="vertical-align: inherit;">åœ¨æ˜Ÿå½¢å¤„ç†ç»“æŸæ—¶ï¼Œå°†å‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">256</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> r1.xyz, r1.xyzx <span class="hljs-number"><span class="hljs-number">257</span></span>: mul r1.xyz, r1.xyzx, l(<span class="hljs-number"><span class="hljs-number">2.500000</span></span>, <span class="hljs-number"><span class="hljs-number">2.500000</span></span>, <span class="hljs-number"><span class="hljs-number">2.500000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">258</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">exp</span></span> r1.xyz, r1.xyzx <span class="hljs-number"><span class="hljs-number">259</span></span>: min r1.xyz, r1.xyzx, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">260</span></span>: add r0.w, -cb0[<span class="hljs-number"><span class="hljs-number">9</span></span>].w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">261</span></span>: mul r1.xyz, r0.wwww, r1.xyzx <span class="hljs-number"><span class="hljs-number">262</span></span>: mul r1.xyz, r1.xyzx, l(<span class="hljs-number"><span class="hljs-number">10.000000</span></span>, <span class="hljs-number"><span class="hljs-number">10.000000</span></span>, <span class="hljs-number"><span class="hljs-number">10.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸é—ªçƒå’Œç§»åŠ¨çš„æ’æ˜Ÿç›¸æ¯”ï¼Œè¿™è¦å®¹æ˜“å¾—å¤šã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬é¦–å…ˆå°†</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">starsFinal</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æé«˜</font><font style="vertical-align: inherit;">åˆ°2.5çš„å¹‚-è¿™ä½¿æˆ‘ä»¬å¯ä»¥æ§åˆ¶æ˜Ÿæ˜Ÿçš„å¯†åº¦ã€‚</font><font style="vertical-align: inherit;">å¾ˆèªæ˜ </font><font style="vertical-align: inherit;">ç„¶åï¼Œä½¿æ˜Ÿæ˜Ÿçš„æœ€å¤§é¢œè‰²ç­‰äºfloat3ï¼ˆ1ã€1ã€1ï¼‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb0 [9] .wç”¨äºæ§åˆ¶æ’æ˜Ÿçš„æ•´ä½“å¯è§æ€§ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é¢„æœŸåœ¨ç™½å¤©è¯¥å€¼ä¸º1.0ï¼ˆä¹˜ä»¥é›¶ï¼‰ï¼Œè€Œåœ¨æ™šä¸Šä¸º0.0ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åï¼Œæˆ‘ä»¬å°†æ’æ˜Ÿçš„èƒ½è§åº¦æé«˜äº†10ã€‚å°±è¿™æ ·ï¼</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¬¬3éƒ¨åˆ†ã€‚å·«å¸ˆå¤©æ‰ï¼ˆå¯¹è±¡å’Œäº®åº¦å›¾ï¼‰ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡ ä¹æ‰€æœ‰å…ˆå‰æè¿°çš„æ•ˆæœå’ŒæŠ€æœ¯éƒ½ä¸å·«å¸ˆ3å¹¶æ²¡æœ‰çœŸæ­£çš„è”ç³»ï¼Œè¯¸å¦‚è‰²è°ƒæ ¡æ­£ï¼Œæ¸æ™•æˆ–è®¡ç®—å¹³å‡äº®åº¦ä¹‹ç±»çš„äº‹æƒ…å‡ ä¹å‡ºç°åœ¨æ¯ä¸ªç°ä»£æ¸¸æˆä¸­ã€‚</font><font style="vertical-align: inherit;">ç”šè‡³ä¸­æ¯’çš„å½±å“ä¹Ÿç›¸å½“æ™®éã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘å†³å®šä»”ç»†ç ”ç©¶â€œç»´å…‹ç‰¹æœ¬èƒ½â€çš„æ¸²æŸ“æœºåˆ¶ã€‚</font><font style="vertical-align: inherit;">æ°æ‹‰ç‰¹ï¼ˆGeraltï¼‰æ˜¯ä¸ªå·«å¸ˆï¼Œå› æ­¤ä»–çš„æ„Ÿæƒ…æ¯”æ™®é€šäººè¦æ•é”å¾—å¤šã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œä»–æ¯”å…¶ä»–äººå¯ä»¥çœ‹åˆ°å’Œå¬åˆ°æ›´å¤šçš„å£°éŸ³ï¼Œè¿™å¯¹ä»–çš„è°ƒæŸ¥éå¸¸æœ‰å¸®åŠ©ã€‚</font><font style="vertical-align: inherit;">å·«å¸ˆçš„å¤©èµ‹æœºåˆ¶å…è®¸ç©å®¶å¯è§†åŒ–æ­¤ç±»ç—•è¿¹ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ˜¯æ•ˆæœçš„æ¼”ç¤ºï¼š</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/794z0wbcI6U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¿˜æœ‰ä¸€ä¸ªï¼Œå…·æœ‰æ›´å¥½çš„ç…§æ˜ï¼š </font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/ReB6IrOb3ic" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æ‚¨æ‰€è§ï¼Œæœ‰ä¸¤ç§ç±»å‹çš„å¯¹è±¡ï¼šGeraltå¯ä»¥ä¸ä¹‹äº¤äº’çš„å¯¹è±¡ï¼ˆé»„è‰²è½®å»“ï¼‰å’Œä¸è°ƒæŸ¥ç›¸å…³è”çš„ç—•è¿¹ï¼ˆçº¢è‰²è½®å»“ï¼‰ã€‚</font><font style="vertical-align: inherit;">æ°æ‹‰ç‰¹ï¼ˆGeraltï¼‰æ£€æŸ¥äº†çº¢è‰²è¶³è¿¹åï¼Œå®ƒå¯èƒ½å˜æˆé»„è‰²ï¼ˆç¬¬ä¸€ä¸ªè§†é¢‘ï¼‰ã€‚</font><font style="vertical-align: inherit;">è¯·æ³¨æ„ï¼Œæ•´ä¸ªå±å¹•å˜ä¸ºç°è‰²ï¼Œå¹¶æ·»åŠ äº†é±¼çœ¼æ•ˆæœï¼ˆç¬¬äºŒä¸ªè§†é¢‘ï¼‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™ç§å½±å“ç›¸å½“å¤æ‚ï¼Œå› æ­¤æˆ‘å†³å®šå°†ä»–çš„ç ”ç©¶åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ç¬¬ä¸€ç¯‡ä¸­ï¼Œæˆ‘å°†è®¨è®ºå¯¹è±¡çš„é€‰æ‹©ï¼Œç¬¬äºŒç¯‡ä¸­ï¼Œå°†è®¨è®ºè½®å»“çš„ç”Ÿæˆï¼Œç¬¬ä¸‰ç¯‡ä¸­ï¼Œå°†æ‰€æœ‰è¿™äº›å…ƒç´ æœ€ç»ˆç»Ÿä¸€ä¸ºä¸€ä¸ªæ•´ä½“ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é€‰æ‹©å¯¹è±¡ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­£å¦‚æˆ‘æ‰€è¯´ï¼Œæœ‰ä¸¤ç§ç±»å‹çš„å¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡ŒåŒºåˆ†ã€‚</font><font style="vertical-align: inherit;">åœ¨Witcher 3ä¸­ï¼Œè¿™æ˜¯ä½¿ç”¨æ¨¡æ¿ç¼“å†²åŒºå®ç°çš„ã€‚</font><font style="vertical-align: inherit;">ç”Ÿæˆåº”æ ‡è®°ä¸ºâ€œè¿¹çº¿â€ï¼ˆçº¢è‰²ï¼‰çš„GBufferç½‘æ ¼ç‰©ä½“æ—¶ï¼Œå°†ä»¥stencil = 8æ¸²æŸ“å®ƒä»¬ã€‚ä»¥é»„è‰²æ ‡è®°ä¸ºâ€œæœ‰è¶£â€å¯¹è±¡çš„ç½‘æ ¼ç‰©ä½“å°†ä»¥stencil = 4æ¸²æŸ“</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä¸¤ä¸ªçº¹ç†æ˜¾ç¤ºäº†ä¸€ä¸ªç¤ºä¾‹æ¡†æ¶ï¼Œå…¶ä¸­åŒ…å«å¯è§çš„å·«å¸ˆæœ¬èƒ½å’Œç›¸åº”çš„æ¨¡å…·ç¼“å†²åŒºï¼š</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a6/7ed/667/2a67ed667870cd52dcf0da4f366975b6.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ac7/a84/a9c/ac7a84a9c8aa25c1685a2a5f83f7447f.jpg"></div><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ¨¡æ¿ç¼“å†²ç®€ä»‹ </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¨¡æ¿ç¼“å†²åŒºé€šå¸¸åœ¨æ¸¸æˆä¸­ç”¨äºæ ‡è®°ç½‘æ ¼ã€‚</font><font style="vertical-align: inherit;">æŸäº›ç±»åˆ«çš„ç½‘æ ¼è¢«åˆ†é…äº†ç›¸åŒçš„IDã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æƒ³æ³•æ˜¯ï¼Œ</font><font style="vertical-align: inherit;">å¦‚æœæ¨¡æ¿æµ‹è¯•æˆåŠŸï¼Œ</font><font style="vertical-align: inherit;">åˆ™å°†</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Always</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡½æ•°</font><font style="vertical-align: inherit;">ä¸</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Replace</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿ç®—ç¬¦</font><font style="vertical-align: inherit;">ä¸€èµ·ä½¿ç”¨</font><font style="vertical-align: inherit;">ï¼Œè€Œ</font><font style="vertical-align: inherit;">åœ¨æ‰€æœ‰å…¶ä»–æƒ…å†µä¸‹</font><font style="vertical-align: inherit;">ï¼Œä¸</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keep</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿ç®—ç¬¦</font><font style="vertical-align: inherit;">ä¸€èµ·ä½¿ç”¨ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ˜¯ä½¿ç”¨D3D11å®æ–½çš„æ–¹æ³•ï¼š</font></font><br><br><pre> <code class="cpp hljs"> D3D11_DEPTH_STENCIL_DESC depthstencilState; <span class="hljs-comment"><span class="hljs-comment">// Set depth parameters.... // Enable stencil depthstencilState.StencilEnable = TRUE; // Read &amp; write all bits depthstencilState.StencilReadMask = 0xFF; depthstencilState.StencilWriteMask = 0xFF; // Stencil operator for front face depthstencilState.FrontFace.StencilFunc = D3D11_COMPARISON_ALWAYS; depthstencilState.FrontFace.StencilDepthFailOp = D3D11_STENCIL_OP_KEEP; depthstencilState.FrontFace.StencilFailOp = D3D11_STENCIL_OP_KEEP; depthstencilState.FrontFace.StencilPassOp = D3D11_STENCIL_OP_REPLACE; // Stencil operator for back face. depthstencilState.BackFace.StencilFunc = D3D11_COMPARISON_ALWAYS; depthstencilState.BackFace.StencilDepthFailOp = D3D11_STENCIL_OP_KEEP; depthstencilState.BackFace.StencilFailOp = D3D11_STENCIL_OP_KEEP; depthstencilState.BackFace.StencilPassOp = D3D11_STENCIL_OP_REPLACE; pDevice-&gt;CreateDepthStencilState( &amp;depthstencilState, &amp;m_pDS_AssignValue );</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦å†™å…¥ç¼“å†²åŒºçš„stensilå€¼</font><font style="vertical-align: inherit;">åœ¨APIè°ƒç”¨ä¸­</font><font style="vertical-align: inherit;">ä½œä¸º</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StencilRef</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¼ é€’</font><font style="vertical-align: inherit;">ï¼š</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// from now on set stencil buffer values to 8 pDevCon-&gt;OMSetDepthStencilState( m_pDS_AssignValue, 8 ); ... pDevCon-&gt;DrawIndexed( ... );</span></span></code> </pre> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ¸²æŸ“äº®åº¦ </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»å®ç°çš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ®µä»£ç ä»¥R11G11B10_FLOATæ ¼å¼æä¾›äº†ä¸€ä¸ªå…¨å±çº¹ç†ï¼Œåœ¨é€šé“Rå’ŒGä¸­å­˜å‚¨äº†æœ‰è¶£çš„å¯¹è±¡å’Œè¿¹çº¿ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºä»€ä¹ˆåœ¨äº®åº¦æ–¹é¢éœ€è¦è¿™æ ·åšï¼Ÿ</font><font style="vertical-align: inherit;">äº‹å®è¯æ˜ï¼ŒGeraltçš„æœ¬èƒ½åªæœ‰æœ‰é™çš„åŠå¾„ï¼Œå› æ­¤ï¼Œåªæœ‰å½“ç©å®¶ç¦»ä»–ä»¬è¶³å¤Ÿè¿‘æ—¶ï¼Œå¯¹è±¡æ‰ä¼šè·å¾—è½®å»“ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çœ‹çœ‹å®é™…çš„è¿™æ–¹é¢ï¼š</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Xbs-ZRJ7v1w" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6f1/073/f03/6f1073f03172250a5b4c052ebfdfd832.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬é¦–å…ˆæ¸…æ´äº®åº¦çº¹ç†ï¼Œç„¶åç”¨é»‘è‰²å¡«å……ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç„¶åè¿›è¡Œä¸¤ä¸ªå…¨å±ç»˜åˆ¶è°ƒç”¨ï¼šç¬¬ä¸€ä¸ªç”¨äºè·Ÿè¸ªï¼Œç¬¬äºŒä¸ªç”¨äºæœ‰è¶£çš„å¯¹è±¡ï¼š</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/077/c17/138/077c1713805b1f95625c05fb11643c53.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¬¬ä¸€æ¬¡è¿›è¡Œæç”»è°ƒç”¨-ç»¿è‰²é€šé“ï¼š </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/14f/7df/63e/14f7df63e4e1760304e4a2c6279953d1.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¬¬äºŒä¸ªè°ƒç”¨æ˜¯é’ˆå¯¹æœ‰è¶£çš„å¯¹è±¡-çº¢è‰²é€šé“ï¼š </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6db/379/add/6db379add4ffc7f54a047f79b608d67f.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¥½å§ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚ä½•ç¡®å®šè¦è€ƒè™‘çš„åƒç´ å‘¢ï¼Ÿ</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä¸å¾—ä¸ä½¿ç”¨æ¨¡æ¿ç¼“å†²åŒºï¼</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹äºè¿™äº›è°ƒç”¨ä¸­çš„æ¯ä¸ªè°ƒç”¨ï¼Œéƒ½å°†è¿›è¡Œæ¨¡æ¿æµ‹è¯•ï¼Œå¹¶ä¸”ä»…æ¥å—å…ˆå‰æ ‡è®°ä¸ºâ€œ 8â€ï¼ˆç¬¬ä¸€æ¬¡ç»˜åˆ¶è°ƒç”¨ï¼‰æˆ–â€œ 4â€çš„é‚£äº›åƒç´ ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¨¡æ¿æµ‹è¯•ç—•è¿¹çš„å¯è§†åŒ–ï¼š</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a60/227/b57/a60227b575f307ad5a251aa817a49963.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ...ä»¥åŠæœ‰è¶£çš„å¯¹è±¡ï¼š </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/014/6eb/5f4/0146eb5f4da50018f5d28b4453e2424c.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹å¦‚ä½•è¿›è¡Œæµ‹è¯•ï¼Ÿ</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥åœ¨ä¸€ç¯‡ä¸é”™çš„</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ç« ä¸­</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">äº†è§£æ¨¡æ¿æµ‹è¯•çš„åŸºç¡€çŸ¥è¯†</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">é€šå¸¸ï¼Œæ¨¡æ¿æµ‹è¯•å…¬å¼å…·æœ‰ä»¥ä¸‹å½¢å¼ï¼š</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (StencilRef &amp; StencilReadMask OP StencilValue &amp; StencilReadMask) accept pixel <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> discard pixel</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¶ä¸­ï¼š</font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StencilRef</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯APIè°ƒç”¨ä¼ é€’çš„å€¼ï¼Œ</font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StencilReadMask</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯ç”¨äºè¯»å–Stensilå€¼çš„æ©ç ï¼ˆè¯·æ³¨æ„ï¼Œå®ƒåŒæ—¶å‡ºç°åœ¨å·¦å³ä¸¤ä¾§ï¼‰ï¼Œ</font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OP</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯é€šè¿‡APIè®¾ç½®çš„æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œ</font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StencilValue</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯æ¨¡æ¿ç¼“å†²åŒºçš„å€¼åœ¨å½“å‰æ­£åœ¨å¤„ç†çš„åƒç´ ä¸­ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‡è¦çš„æ˜¯è¦ç†è§£æˆ‘ä»¬ä½¿ç”¨äºŒè¿›åˆ¶ANDæ¥è®¡ç®—æ“ä½œæ•°ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç†Ÿæ‚‰åŸºç¡€çŸ¥è¯†ä¹‹åï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨ä»¥ä¸‹ç»˜åˆ¶è°ƒç”¨ä¸­ä½¿ç”¨è¿™äº›å‚æ•°ï¼š</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/164/373/d2c/164373d2c3421c708e40dc9cb26eb7c9.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿¹çº¿çš„æ¨¡å…·æ¡ä»¶</font></font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e5/3c0/ae3/1e53c0ae3680bebe785e64739c4ece43.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¨¡å…·çŠ¶æ€ä¸ºæœ‰è¶£çš„ç‰©ä½“</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å“ˆï¼</font><font style="vertical-align: inherit;">å¦‚æˆ‘ä»¬æ‰€è§ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ReadMaskã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬çœ‹çœ‹å§ï¼</font><font style="vertical-align: inherit;">å°†è¿™äº›å€¼æ›¿æ¢ä¸ºæ¨¡æ¿æµ‹è¯•æ–¹ç¨‹å¼ï¼š</font></font><br><br><pre> <code class="cpp hljs"> Let StencilReadMask = <span class="hljs-number"><span class="hljs-number">0x08</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> StencilRef = <span class="hljs-number"><span class="hljs-number">0</span></span>: For a pixel with stencil = <span class="hljs-number"><span class="hljs-number">8</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> &amp; <span class="hljs-number"><span class="hljs-number">0x08</span></span> &lt; <span class="hljs-number"><span class="hljs-number">8</span></span> &amp; <span class="hljs-number"><span class="hljs-number">0x08</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> &lt; <span class="hljs-number"><span class="hljs-number">8</span></span> TRUE For a pixel with stencil = <span class="hljs-number"><span class="hljs-number">4</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> &amp; <span class="hljs-number"><span class="hljs-number">0x08</span></span> &lt; <span class="hljs-number"><span class="hljs-number">4</span></span> &amp; <span class="hljs-number"><span class="hljs-number">0x08</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> FALSE</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èªæ˜åœ° </font><font style="vertical-align: inherit;">å¦‚æ‚¨æ‰€è§ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸æ¯”è¾ƒæ¨¡æ¿å€¼ï¼Œè€Œæ˜¯æ£€æŸ¥æ¨¡æ¿ç¼“å†²åŒºçš„æŸä¸ªä½æ˜¯å¦å·²è®¾ç½®ã€‚</font><font style="vertical-align: inherit;">æ¨¡æ¿ç¼“å†²åŒºçš„æ¯ä¸ªåƒç´ å‡å…·æœ‰uint8æ ¼å¼ï¼Œå› æ­¤å€¼çš„é—´éš”ä¸º[0-255]ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨æ„ï¼šæ‰€æœ‰</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DrawIndexedï¼ˆ36ï¼‰</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è°ƒç”¨</font><font style="vertical-align: inherit;">éƒ½ä¸å°†è„šå°æ¸²æŸ“ä¸ºè„šå°æœ‰å…³ï¼Œå› æ­¤åœ¨æ­¤ç‰¹å®šå¸§ä¸­ï¼Œäº®åº¦è´´å›¾å…·æœ‰ä»¥ä¸‹æœ€ç»ˆå½¢å¼ï¼š</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/917/f0d/d04/917f0dd0490ef8faa829ede007838906.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†æ˜¯åœ¨æ¨¡æ¿æµ‹è¯•ä¹‹å‰ï¼Œæœ‰ä¸€ä¸ªåƒç´ ç€è‰²å™¨ã€‚</font><font style="vertical-align: inherit;">28738å’Œ28748éƒ½ä½¿ç”¨ç›¸åŒçš„åƒç´ ç€è‰²å™¨ï¼š</font></font><br><br><pre> <code class="cpp hljs"> ps_5_0 dcl_globalFlags refactoringAllowed dcl_constantbuffer cb0[<span class="hljs-number"><span class="hljs-number">2</span></span>], immediateIndexed dcl_constantbuffer cb3[<span class="hljs-number"><span class="hljs-number">8</span></span>], immediateIndexed dcl_constantbuffer cb12[<span class="hljs-number"><span class="hljs-number">214</span></span>], immediateIndexed dcl_sampler s15, <span class="hljs-function"><span class="hljs-function">mode_default </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dcl_resource_texture2d</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> t15 dcl_input_ps_siv v0.xy, position dcl_output o0.xyzw dcl_output o1.xyzw dcl_output o2.xyzw dcl_output o3.xyzw dcl_temps 2 0: mul r0.xy, v0.xyxx, cb0[1].zwzz 1: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r0.x, r0.xyxx, t15.xyzw, s15 2: mul r1.xyzw, v0.yyyy, cb12[211].xyzw 3: mad r1.xyzw, cb12[210].xyzw, v0.xxxx, r1.xyzw 4: mad r0.xyzw, cb12[212].xyzw, r0.xxxx, r1.xyzw 5: add r0.xyzw, r0.xyzw, cb12[213].xyzw 6: div r0.xyz, r0.xyzx, r0.wwww 7: add r0.xyz, r0.xyzx, -cb3[7].xyzx 8: dp3 r0.x, r0.xyzx, r0.xyzx 9: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">sqrt</span></span></span><span class="hljs-function"> r0.x, r0.x 10: mul r0.y, r0.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.120000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 11: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">log</span></span></span><span class="hljs-function"> r1.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cb3[</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">].y)</span></span></span><span class="hljs-function"> 12: mul r1.xy, r1.xxxx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2.800000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.800000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 13: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">exp</span></span></span><span class="hljs-function"> r1.xy, r1.xyxx 14: mad r0.zw, r1.xxxy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">120.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">120.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 15: lt r1.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.030000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, cb3[6].y 16: movc r0.xy, r1.xxxx, r0.yzyy, r0.xwxx 17: div r0.x, r0.x, r0.y 18: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">log</span></span></span><span class="hljs-function"> r0.x, r0.x 19: mul r0.x, r0.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.600000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 20: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">exp</span></span></span><span class="hljs-function"> r0.x, r0.x 21: add r0.x, -r0.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 22: max r0.x, r0.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 23: mul o0.xyz, r0.xxxx, cb3[0].xyzx 24: mov o0.w, cb3[0].w 25: mov o1.xyzw, cb3[1].xyzw 26: mov o2.xyzw, cb3[2].xyzw 27: mov o3.xyzw, cb3[3].xyzw 28: ret</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤åƒç´ ç€è‰²å™¨ä»…å†™å…¥ä¸€ä¸ªæ¸²æŸ“ç›®æ ‡ï¼Œå› æ­¤ç¬¬24-27è¡Œæ˜¯å¤šä½™çš„ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™é‡Œå‘ç”Ÿçš„ç¬¬ä¸€ä»¶äº‹æ˜¯æ·±åº¦é‡‡æ ·ï¼ˆä½¿ç”¨å…·æœ‰å€¼é™åˆ¶çš„ç‚¹é‡‡æ ·å™¨ï¼‰ï¼Œç¬¬1è¡Œã€‚è¯¥å€¼ç”¨äºé€šè¿‡ä¹˜ä»¥ç‰¹æ®ŠçŸ©é˜µå†è¿›è¡Œé€è§†åˆ’åˆ†ï¼ˆç¬¬2-6è¡Œï¼‰æ¥é‡æ–°åˆ›å»ºä¸–ç•Œä¸Šçš„ä½ç½®ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è€ƒè™‘Geraltçš„ä½ç½®ï¼ˆcb3 [7] .xyz-æ³¨æ„ï¼Œè¿™</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸æ˜¯</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›¸æœº</font><i><font style="vertical-align: inherit;">çš„</font></i><font style="vertical-align: inherit;">ä½ç½®ï¼ï¼‰ï¼Œæˆ‘ä»¬è®¡ç®—å‡ºGeraltåˆ°è¯¥ç‰¹å®šç‚¹çš„è·ç¦»ï¼ˆç¬¬7-9è¡Œï¼‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä¸‹è¾“å…¥åœ¨æ­¤ç€è‰²å™¨ä¸­å¾ˆé‡è¦ï¼š</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-cb3 [0] .rgb-è¾“å‡ºé¢œè‰²ã€‚å®ƒçš„æ ¼å¼å¯ä»¥ä¸ºfloat3ï¼ˆ0ï¼Œ1ï¼Œ0ï¼‰ï¼ˆè¿¹çº¿ï¼‰æˆ–float3ï¼ˆ1ï¼Œ0ï¼Œ0ï¼‰ï¼ˆæœ‰è¶£çš„å¯¹è±¡ï¼‰ï¼Œ</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-cb3 [6] .y-è·ç¦»æ¯”ä¾‹å› å­ã€‚</font><font style="vertical-align: inherit;">ç›´æ¥å½±å“æœ€ç»ˆè¾“å‡ºçš„åŠå¾„å’Œäº®åº¦ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åæ¥ï¼Œæˆ‘ä»¬æœ‰äº†ç›¸å½“å¤æ‚çš„å…¬å¼æ¥è®¡ç®—äº®åº¦ï¼Œå…·ä½“å–å†³äºGeraltå’Œç‰©ä½“ä¹‹é—´çš„è·ç¦»ã€‚</font><font style="vertical-align: inherit;">æˆ‘å¯ä»¥å‡è®¾æ‰€æœ‰ç³»æ•°éƒ½æ˜¯é€šè¿‡å®éªŒé€‰æ‹©çš„ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€ç»ˆè¾“å‡ºæ˜¯</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¢œè‰²</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¼ºåº¦</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HLSLä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FSInput</span></span></span><span class="hljs-class"> {</span></span> float4 param0 : SV_Position; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FSOutput</span></span></span><span class="hljs-class"> {</span></span> float4 param0 : SV_Target0; float4 param1 : SV_Target1; float4 param2 : SV_Target2; float4 param3 : SV_Target3; }; <span class="hljs-function"><span class="hljs-function">float3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWorldPos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( float2 screenPos, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> depth )</span></span></span><span class="hljs-function"> </span></span>{ float4 worldPos = float4(screenPos, depth, <span class="hljs-number"><span class="hljs-number">1.0</span></span>); worldPos = mul( worldPos, screenToWorld ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> worldPos.xyz / worldPos.w; } <span class="hljs-function"><span class="hljs-function">FSOutput </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditedShaderPS</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(in FSInput IN)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// * Inputs // Directly affects radius of the effect float distanceScaling = cb3_v6.y; // Color of output at the end float3 color = cb3_v0.rgb; // Sample depth float2 uv = IN.param0.xy * cb0_v1.zw; float depth = texture15.Sample( sampler15, uv ).x; // Reconstruct world position float3 worldPos = getWorldPos( IN.param0.xy, depth ); // Calculate distance from Geralt to world position of particular object float dist_geraltToWorld = length( worldPos - cb3_v7.xyz ); // Calculate two squeezing params float t0 = 1.0 + 120*pow( abs(distanceScaling), 2.8 ); float t1 = 1.0 + 120*pow( abs(distanceScaling), 0.8 ); // Determine nominator and denominator float2 params; params = (distanceScaling &gt; 0.03) ? float2(dist_geraltToWorld * 0.12, t0) : float2(dist_geraltToWorld, t1); // Distance Geralt &lt;-&gt; Object float nominator = params.x; // Hiding factor float denominator = params.y; // Raise to power of 1.6 float param = pow( params.x / params.y, 1.6 ); // Calculate final intensity float intensity = max(0.0, 1.0 - param ); // * Final outputs. // * // * This PS outputs only one color, the rest // * is redundant. I just added this to keep 1-1 ratio with // * original assembly. FSOutput OUT = (FSOutput)0; OUT.param0.xyz = color * intensity; // == redundant == OUT.param0.w = cb3_v0.w; OUT.param1 = cb3_v1; OUT.param2 = cb3_v2; OUT.param3 = cb3_v3; // =============== return OUT; }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åŸå§‹ï¼ˆå·¦ï¼‰å’Œæˆ‘çš„ï¼ˆå³ï¼‰æ±‡ç¼–å™¨ç€è‰²å™¨ä»£ç çš„æ¯”è¾ƒã€‚ </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/68c/07d/1d6/68c07d1d6fd99f81cb0b3b63c9927a53.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ˜¯</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å·«å©†å¤©èµ‹</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½œç”¨çš„ç¬¬ä¸€æ­¥</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å®é™…ä¸Šï¼Œè¿™æ˜¯æœ€ç®€å•çš„ã€‚</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¬¬4éƒ¨åˆ†ã€‚å·«å¸ˆçš„å¤©æ‰ï¼ˆè½®å»“å›¾ï¼‰ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å†æ¬¡çœ‹ä¸€ä¸‹æˆ‘ä»¬æ­£åœ¨æ¢ç´¢çš„åœºæ™¯ï¼š </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a6/7ed/667/2a67ed667870cd52dcf0da4f366975b6.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨åˆ†æå¥³å·«çš„æœ¬èƒ½çš„ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘å±•ç¤ºäº†å¦‚ä½•ç”Ÿæˆâ€œäº®åº¦å›¾â€ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬æœ‰ä¸€ä¸ªR11G11B10_FLOATæ ¼å¼çš„å…¨å±çº¹ç†ï¼Œçœ‹èµ·æ¥å¯èƒ½åƒè¿™æ ·ï¼š</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/917/f0d/d04/917f0dd0490ef8faa829ede007838906.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»¿è‰²é€šé“è¡¨ç¤ºâ€œè¶³è¿¹â€ï¼Œçº¢è‰²æ˜¯Geraltå¯ä»¥ä¸ä¹‹äº¤äº’çš„æœ‰è¶£å¯¹è±¡ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ”¶åˆ°æ­¤çº¹ç†åï¼Œæˆ‘ä»¬å¯ä»¥è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µ-æˆ‘å°†å…¶ç§°ä¸ºâ€œè½®å»“å›¾â€ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1bf/428/855/1bf4288554d1cef31c2607a4ca73c2bb.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ˜¯512x512 R16G16_FLOATæ ¼å¼çš„æ€ªå¼‚çº¹ç†ã€‚</font><font style="vertical-align: inherit;">ä»¥â€œä¹’ä¹“â€çš„æ–¹å¼å®ç°å®ƒå¾ˆé‡è¦ã€‚</font><font style="vertical-align: inherit;">å‰ä¸€å¸§çš„è½®å»“å›¾æ˜¯è¾“å…¥æ•°æ®ï¼ˆè¿åŒäº®åº¦å›¾ï¼‰ï¼Œä»¥åœ¨å½“å‰å¸§ä¸­ç”Ÿæˆæ–°çš„è½®å»“å›¾ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¹’ä¹“ç¼“å†²åŒºå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®ç°ï¼Œä½†æˆ‘ä¸ªäººæœ€å–œæ¬¢ä»¥ä¸‹å†…å®¹ï¼ˆä¼ªä»£ç ï¼‰ï¼š</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// Declarations Texture2D m_texOutlineMap[2]; uint m_outlineIndex = 0; // Rendering void Render() { pDevCon-&gt;SetInputTexture( m_texOutlineMap[m_outlineIndex] ); pDevCon-&gt;SetOutputTexture( m_texOutlineMap[!m_outlineIndex] ); ... pDevCon-&gt;Draw(...); // after draw m_outlineIndex = !m_outlineIndex; }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™ç§æ–¹æ³•çš„è¾“å…¥å§‹ç»ˆä¸º</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[m_outlineIndex]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè€Œè¾“å‡ºå§‹ç»ˆä¸º</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ï¼M_outlineIndex]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä¸ºä½¿ç”¨å…¶ä»–åæœŸæ•ˆæœæä¾›äº†çµæ´»æ€§ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹åƒç´ ç€è‰²å™¨ï¼š</font></font><br><br><pre> <code class="cpp hljs"> ps_5_0 dcl_globalFlags refactoringAllowed dcl_constantbuffer cb3[<span class="hljs-number"><span class="hljs-number">1</span></span>], immediateIndexed dcl_sampler s0, mode_default dcl_sampler s1, <span class="hljs-function"><span class="hljs-function">mode_default </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dcl_resource_texture2d</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> t0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dcl_resource_texture2d</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> t1 dcl_input_ps linear v2.xy dcl_output o0.xyzw dcl_temps 4 0: add r0.xyzw, v2.xyxy, v2.xyxy 1: round_ni r1.xy, r0.zwzz 2: frc r0.xyzw, r0.xyzw 3: add r1.zw, r1.xxxy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 4: dp2 r1.z, r1.zwzz, r1.zwzz 5: add r1.z, -r1.z, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 6: max r2.w, r1.z, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 7: dp2 r1.z, r1.xyxx, r1.xyxx 8: add r3.xyzw, r1.xyxy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 9: add r1.x, -r1.z, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 10: max r2.x, r1.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 11: dp2 r1.x, r3.xyxx, r3.xyxx 12: dp2 r1.y, r3.zwzz, r3.zwzz 13: add r1.xy, -r1.xyxx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 14: max r2.yz, r1.xxyx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 15: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r1.xyzw, r0.zwzz, t1.xyzw, s1 16: dp4 r1.x, r1.xyzw, r2.xyzw 17: add r2.xyzw, r0.zwzw, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.003906</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.003906</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 18: add r0.xyzw, r0.xyzw, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.003906</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.003906</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 19: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r1.yz, r2.xyxx, t1.zxyw, s1 20: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r2.xy, r2.zwzz, t1.xyzw, s1 21: add r1.yz, r1.yyzy, -r2.xxyx 22: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r0.xy, r0.xyxx, t1.xyzw, s1 23: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r0.zw, r0.zwzz, t1.zwxy, s1 24: add r0.xy, -r0.zwzz, r0.xyxx 25: max r0.xy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r0.xyxx)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r1.yzyy)</span></span></span><span class="hljs-function"> 26: min r0.xy, r0.xyxx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 27: mul r0.xy, r0.xyxx, r1.xxxx 28: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r0.zw, v2.xyxx, t0.zwxy, s0 29: mad r0.w, r1.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.150000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r0.w 30: mad r0.x, r0.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.350000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r0.w 31: mad r0.x, r0.y, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.350000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r0.x 32: mul r0.yw, cb3[0].zzzw, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">300.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">300.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 33: mad r0.yw, v2.xxxy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">150.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">150.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r0.yyyw 34: ftoi r0.yw, r0.yyyw 35: bfrev r0.w, r0.w 36: iadd r0.y, r0.w, r0.y 37: ishr r0.w, r0.y, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">13</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 38: xor r0.y, r0.y, r0.w 39: imul null, r0.w, r0.y, r0.y 40: imad r0.w, r0.w, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0x0000ec4d</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.0000000000000000000000000000000000001</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 41: imad r0.y, r0.y, r0.w, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">146956042240.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 42: </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">and</span></span></span><span class="hljs-function"> r0.y, r0.y, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0x7fffffff</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 43: itof r0.y, r0.y 44: mad r0.y, r0.y, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000001</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.650000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 45: add_sat r1.xyzw, v2.xyxy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.001953</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.001953</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 46: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r0.w, r1.xyxx, t0.yzwx, s0 47: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r1.x, r1.zwzz, t0.xyzw, s0 48: add r0.w, r0.w, r1.x 49: add_sat r1.xyzw, v2.xyxy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.001953</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.001953</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 50: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r1.x, r1.xyxx, t0.xyzw, s0 51: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r1.y, r1.zwzz, t0.yxzw, s0 52: add r0.w, r0.w, r1.x 53: add r0.w, r1.y, r0.w 54: mad r0.w, r0.w, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.250000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, -r0.z 55: mul r0.w, r0.y, r0.w 56: mul r0.y, r0.y, r0.z 57: mad r0.x, r0.w, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.900000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r0.x 58: mad r0.y, r0.y, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.240000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r0.x 59: add r0.x, r0.y, r0.z 60: mov_sat r0.z, cb3[0].x 61: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">log</span></span></span><span class="hljs-function"> r0.z, r0.z 62: mul r0.z, r0.z, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">100.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 63: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">exp</span></span></span><span class="hljs-function"> r0.z, r0.z 64: mad r0.z, r0.z, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.160000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.700000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 65: mul o0.xy, r0.zzzz, r0.xyxx 66: mov o0.zw, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 67: ret</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¦‚æ‚¨æ‰€è§ï¼Œè¾“å‡ºè½®å»“å›¾è¢«åˆ†ä¸ºå››ä¸ªç›¸ç­‰çš„æ­£æ–¹å½¢ï¼Œè¿™æ˜¯æˆ‘ä»¬éœ€è¦ç ”ç©¶çš„ç¬¬ä¸€ä»¶äº‹ï¼š </font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">0</span></span>: add r0.xyzw, v2.xyxy, v2.xyxy <span class="hljs-number"><span class="hljs-number">1</span></span>: round_ni r1.xy, r0.zwzz <span class="hljs-number"><span class="hljs-number">2</span></span>: frc r0.xyzw, r0.xyzw <span class="hljs-number"><span class="hljs-number">3</span></span>: add r1.zw, r1.xxxy, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span>: dp2 r1.z, r1.zwzz, r1.zwzz <span class="hljs-number"><span class="hljs-number">5</span></span>: add r1.z, -r1.z, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">6</span></span>: max r2.w, r1.z, l(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">7</span></span>: dp2 r1.z, r1.xyxx, r1.xyxx <span class="hljs-number"><span class="hljs-number">8</span></span>: add r3.xyzw, r1.xyxy, l(<span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">9</span></span>: add r1.x, -r1.z, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">10</span></span>: max r2.x, r1.x, l(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">11</span></span>: dp2 r1.x, r3.xyxx, r3.xyxx <span class="hljs-number"><span class="hljs-number">12</span></span>: dp2 r1.y, r3.zwzz, r3.zwzz <span class="hljs-number"><span class="hljs-number">13</span></span>: add r1.xy, -r1.xyxx, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">14</span></span>: max r2.yz, r1.xxyx, l(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬é¦–å…ˆè®¡ç®—åœ°æ¿ï¼ˆTextureUV * 2.0ï¼‰ï¼Œè¿™å°†ä¸ºæˆ‘ä»¬æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e25/7b3/e14/e257b3e14ac5b8a1f2b65525333924c5.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¸ºäº†ç¡®å®šå„ä¸ªæ­£æ–¹å½¢ï¼Œä½¿ç”¨äº†ä¸€ä¸ªå°å‡½æ•°ï¼š </font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(float2 uv)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> d = dot(uv, uv); d = <span class="hljs-number"><span class="hljs-number">1.0</span></span> - d; d = max( d, <span class="hljs-number"><span class="hljs-number">0.0</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> d; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯·æ³¨æ„ï¼Œè¯¥å‡½æ•°ä½¿ç”¨è¾“å…¥float2ï¼ˆ0.0ï¼Œ0.0ï¼‰è¿”å›1.0ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™ç§æƒ…å†µå‘ç”Ÿåœ¨å·¦ä¸Šè§’ã€‚</font><font style="vertical-align: inherit;">è¦åœ¨å³ä¸Šè§’å¾—åˆ°ç›¸åŒçš„æƒ…å†µï¼Œè¯·ä»å››èˆäº”å…¥çš„texcoordsä¸­å‡å»float2ï¼ˆ1ï¼Œ0ï¼‰ï¼Œä¸ºç»¿è‰²æ­£æ–¹å½¢å‡å»float2ï¼ˆ0ï¼Œ1ï¼‰ï¼Œä¸ºé»„è‰²æ­£æ–¹å½¢å‡å»float2ï¼ˆ1.0ï¼Œ1.0ï¼‰ã€‚</font></font><br><br> å› æ­¤ï¼š <br><br><pre> <code class="cpp hljs"> float2 flooredTextureUV = <span class="hljs-built_in"><span class="hljs-built_in">floor</span></span>( <span class="hljs-number"><span class="hljs-number">2.0</span></span> * TextureUV ); ... float2 uv1 = flooredTextureUV; float2 uv2 = flooredTextureUV + float2(<span class="hljs-number"><span class="hljs-number">-1.0</span></span>, <span class="hljs-number"><span class="hljs-number">-0.0</span></span>); float2 uv3 = flooredTextureUV + float2( <span class="hljs-number"><span class="hljs-number">-0.0</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0</span></span>); float2 uv4 = flooredTextureUV + float2(<span class="hljs-number"><span class="hljs-number">-1.0</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0</span></span>); float4 mask; mask.x = getParams( uv1 ); mask.y = getParams( uv2 ); mask.z = getParams( uv3 ); mask.w = getParams( uv4 );</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯ä¸ª</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è’™ç‰ˆ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆåˆ†</font><font style="vertical-align: inherit;">è¦ä¹ˆä¸ºé›¶ï¼Œè¦ä¹ˆä¸ºä¸€ï¼Œå¹¶è´Ÿè´£çº¹ç†çš„ä¸€å¹³æ–¹ã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mask.r</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mask.w</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/559/e1c/242/559e1c242221886f5c0100fa66837c31.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é®ç½©</font></font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bb5/108/a24/bb5108a241181f23a66c7f3803d33cea.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mask.w</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬æœ‰</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mask</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè®©æˆ‘ä»¬ç»§ç»­ã€‚</font><font style="vertical-align: inherit;">ç¬¬15è¡Œé‡‡æ ·äº®åº¦å›¾ã€‚</font><font style="vertical-align: inherit;">è¯·æ³¨æ„ï¼Œå°½ç®¡æˆ‘ä»¬é‡‡æ ·äº†æ‰€æœ‰rgbaåˆ†é‡ï¼Œä½†äº®åº¦çº¹ç†çš„æ ¼å¼ä¸ºR11G11B10_FLOATã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‡å®š.aä¸º1.0fã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ä»¥å°†ç”¨äºæ­¤æ“ä½œçš„Texcoordsè®¡ç®—ä¸º</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fracï¼ˆTextureUV * 2.0ï¼‰</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæ­¤æ“ä½œçš„ç»“æœå¯èƒ½ä¾‹å¦‚å¦‚ä¸‹æ‰€ç¤ºï¼š</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/955/071/c05/955071c057420f3c4b083ed174046189.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çœ‹åˆ°ç›¸ä¼¼ä¹‹å¤„å—ï¼Ÿ</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸‹ä¸€æ­¥éå¸¸æ˜æ™º-æ‰§è¡Œå››åˆ†é‡æ ‡é‡ç§¯ï¼ˆdp4ï¼‰ï¼š</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">16</span></span>: dp4 r1.x, r1.xyzw, r2.xyzw</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œåªæœ‰çº¢è‰²é€šé“ï¼ˆå³åªæœ‰æœ‰è¶£çš„ç‰©ä½“ï¼‰ä¿ç•™åœ¨å·¦ä¸Šè§’ï¼Œåªæœ‰ç»¿è‰²é€šé“åœ¨å³ä¸Šè§’ï¼ˆä»…æ˜¯è¿¹çº¿ï¼‰ï¼Œå¹¶ä¸”æ‰€æœ‰åœ¨å³ä¸‹è§’éƒ½æœ‰ï¼ˆå› ä¸ºäº®åº¦åˆ†é‡.wè¢«é—´æ¥è®¾ç½®ä¸º1.0ï¼‰ã€‚</font><font style="vertical-align: inherit;">å¥½ä¸»æ„ã€‚</font><font style="vertical-align: inherit;">æ ‡é‡ç§¯çš„ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/37c/488/3ab/37c4883ab098cd1bc4ef2d22187f7d16.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ”¶åˆ°æ­¤</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">masterFilterä¹‹å</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¡®å®šå¯¹è±¡çš„è½®å»“äº†ã€‚</font><font style="vertical-align: inherit;">å®ƒå¹¶ä¸åƒçœ‹èµ·æ¥é‚£æ ·å›°éš¾ã€‚</font><font style="vertical-align: inherit;">è¯¥ç®—æ³•ä¸ç”¨äºè·å¾—æ¸…æ™°åº¦çš„ç®—æ³•éå¸¸ç›¸ä¼¼-æˆ‘ä»¬éœ€è¦è·å–å€¼çš„æœ€å¤§ç»å¯¹å·®ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™å°±æ˜¯å‘ç”Ÿçš„æƒ…å†µï¼šæˆ‘ä»¬åœ¨è¦å¤„ç†çš„å½“å‰çº¹ç†åƒç´ æ—è¾¹é‡‡æ ·å››ä¸ªçº¹ç†åƒç´ ï¼ˆé‡è¦çš„æ˜¯ï¼šåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œçº¹ç†åƒç´ å¤§å°ä¸º1.0 / 256.0ï¼ï¼‰ï¼Œå¹¶è®¡ç®—çº¢è‰²å’Œç»¿è‰²é€šé“çš„æœ€å¤§ç»å¯¹å·®ï¼š</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> fTexel = <span class="hljs-number"><span class="hljs-number">1.0</span></span> / <span class="hljs-number"><span class="hljs-number">256</span></span>; float2 sampling1 = TextureUV + float2( fTexel, <span class="hljs-number"><span class="hljs-number">0</span></span> ); float2 sampling2 = TextureUV + float2( -fTexel, <span class="hljs-number"><span class="hljs-number">0</span></span> ); float2 sampling3 = TextureUV + float2( <span class="hljs-number"><span class="hljs-number">0</span></span>, fTexel ); float2 sampling4 = TextureUV + float2( <span class="hljs-number"><span class="hljs-number">0</span></span>, -fTexel ); float2 intensity_x0 = texIntensityMap.Sample( sampler1, sampling1 ).xy; float2 intensity_x1 = texIntensityMap.Sample( sampler1, sampling2 ).xy; float2 intensity_diff_x = intensity_x0 - intensity_x1; float2 intensity_y0 = texIntensityMap.Sample( sampler1, sampling3 ).xy; float2 intensity_y1 = texIntensityMap.Sample( sampler1, sampling4 ).xy; float2 intensity_diff_y = intensity_y0 - intensity_y1; float2 maxAbsDifference = max( <span class="hljs-built_in"><span class="hljs-built_in">abs</span></span>(intensity_diff_x), <span class="hljs-built_in"><span class="hljs-built_in">abs</span></span>(intensity_diff_y) ); maxAbsDifference = saturate(maxAbsDifference);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬ä¹˜çš„</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿‡æ»¤å™¨</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸Š</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maxAbsDifference</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ...</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dcb/332/626/dcb332626d34f07ecf1bd85928b7d1dc.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éå¸¸ç®€å•é«˜æ•ˆã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥æ”¶åˆ°è½®å»“åï¼Œæˆ‘ä»¬ä»å‰ä¸€å¸§ä¸­é‡‡æ ·è½®å»“å›¾ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç„¶åï¼Œä¸ºäº†è·å¾—â€œå¹½çµèˆ¬â€çš„æ•ˆæœï¼Œæˆ‘ä»¬é‡‡ç”¨äº†å½“å‰é€šè¿‡è®¡ç®—å‡ºçš„éƒ¨åˆ†å‚æ•°ä»¥åŠç­‰é«˜çº¿å›¾ä¸­çš„å€¼ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘æˆ‘ä»¬çš„è€æœ‹å‹é—®å¥½-æ•´æ•°å™ªéŸ³ã€‚</font><font style="vertical-align: inherit;">ä»–åœ¨è¿™é‡Œã€‚</font><font style="vertical-align: inherit;">åŠ¨ç”»å‚æ•°ï¼ˆcb3 [0] .zwï¼‰ä»å¸¸é‡ç¼“å†²åŒºä¸­è·å–ï¼Œå¹¶éšæ—¶é—´å˜åŒ–ã€‚</font></font><br><br><pre> <code class="cpp hljs"> float2 outlines = masterFilter * maxAbsDifference; <span class="hljs-comment"><span class="hljs-comment">// Sample outline map float2 outlineMap = texOutlineMap.Sample( samplerLinearWrap, uv ).xy; // I guess it's related with ghosting float paramOutline = masterFilter*0.15 + outlineMap.y; paramOutline += 0.35 * outlines.r; paramOutline += 0.35 * outlines.g; // input for integer noise float2 noiseWeights = cb3_v0.zw; float2 noiseInputs = 150.0*uv + 300.0*noiseWeights; int2 iNoiseInputs = (int2) noiseInputs; float noise0 = clamp( integerNoise( iNoiseInputs.x + reversebits(iNoiseInputs.y) ), -1, 1 ) + 0.65; // r0.y</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨æ„ï¼šå¦‚æœæ‚¨æƒ³è‡ªå·±å®ç°å·«å©†çš„æœ¬èƒ½ï¼Œé‚£ä¹ˆæˆ‘å»ºè®®å°†æ•´æ•°å™ªå£°é™åˆ¶ä¸º[-1; 1]åŒºé—´ï¼ˆå¦‚å…¶ç½‘ç«™ä¸Šæ‰€è¿°ï¼‰ã€‚</font><font style="vertical-align: inherit;">åŸå§‹çš„TW3ç€è‰²å™¨æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰å®ƒï¼Œæˆ‘å°†å¾—åˆ°å¯æ€•çš„ä¼ªå½±ï¼Œæ•´ä¸ªè½®å»“å›¾ä¸ç¨³å®šã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç„¶åï¼Œæˆ‘ä»¬ä»¥ä¸ä¹‹å‰çš„äº®åº¦å›¾ç›¸åŒçš„æ–¹å¼å¯¹è½®å»“å›¾è¿›è¡Œé‡‡æ ·ï¼ˆè¿™æ¬¡ï¼Œçº¹ç†åƒç´ çš„å¤§å°ä¸º1.0 / 512.0ï¼‰ï¼Œå¹¶è®¡ç®—.xåˆ†é‡çš„å¹³å‡å€¼ï¼š</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// sampling of outline map fTexel = 1.0 / 512.0; sampling1 = saturate( uv + float2( fTexel, 0 ) ); sampling2 = saturate( uv + float2( -fTexel, 0 ) ); sampling3 = saturate( uv + float2( 0, fTexel ) ); sampling4 = saturate( uv + float2( 0, -fTexel ) ); float outline_x0 = texOutlineMap.Sample( sampler0, sampling1 ).x; float outline_x1 = texOutlineMap.Sample( sampler0, sampling2 ).x; float outline_y0 = texOutlineMap.Sample( sampler0, sampling3 ).x; float outline_y1 = texOutlineMap.Sample( sampler0, sampling4 ).x; float averageOutline = (outline_x0+outline_x1+outline_y0+outline_y1) / 4.0;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç„¶åï¼Œé€šè¿‡æ±‡ç¼–ä»£ç åˆ¤æ–­ï¼Œè®¡ç®—è¯¥ç‰¹å®šåƒç´ çš„å¹³å‡å€¼ä¸å€¼ä¹‹å·®ï¼Œç„¶åæ‰§è¡Œæ•´æ•°å™ªå£°å¼•èµ·çš„å¤±çœŸï¼š </font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// perturb with noise float frameOutlineDifference = averageOutline - outlineMap.x; frameOutlineDifference *= noise0;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸‹ä¸€æ­¥æ˜¯ä½¿ç”¨å™ªå£°ä½¿â€œæ—§â€è½®å»“å›¾çš„å€¼å¤±çœŸ-è¿™æ˜¯ä½¿è¾“å‡ºçº¹ç†å…·æœ‰å—çŠ¶æ„Ÿè§‰çš„ä¸»çº¿ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç„¶åè¿˜æœ‰å…¶ä»–è®¡ç®—ï¼Œç„¶ååœ¨æœ€åè®¡ç®—â€œè¡°å‡â€ã€‚</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// the main place with gives blocky look of texture float newNoise = outlineMap.x * noise0; float newOutline = frameOutlineDifference * 0.9 + paramOutline; newOutline -= 0.24*newNoise; // 59: add r0.x, r0.y, r0.z float2 finalOutline = float2( outlineMap.x + newOutline, newOutline); // * calculate damping float dampingParam = saturate( cb3_v0.x ); dampingParam = pow( dampingParam, 100 ); float damping = 0.7 + 0.16*dampingParam; // * final multiplication float2 finalColor = finalOutline * damping; return float4(finalColor, 0, 0);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¿™æ˜¯ä¸€ä¸ªç®€çŸ­çš„è§†é¢‘ï¼Œæ¼”ç¤ºäº†å®é™…çš„è½®å»“å›¾ï¼š </font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/vSscLz2RYsQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœæ‚¨å¯¹å…¨åƒç´ ç€è‰²å™¨æ„Ÿå…´è¶£ï¼Œåˆ™å¯ä»¥</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ­¤å¤„è·å¾—</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">Shaderä¸RenderDocå…¼å®¹ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰è¶£çš„æ˜¯ï¼ˆè€å®è¯´ï¼Œæœ‰ç‚¹çƒ¦äººï¼‰ï¼Œå°½ç®¡æ±‡ç¼–ä»£ç ä¸Witcher 3çš„åŸå§‹ç€è‰²å™¨ç›¸åŒï¼Œä½†RenderDocä¸­è½®å»“å›¾çš„æœ€ç»ˆå¤–è§‚ä»åœ¨æ”¹å˜ï¼</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨æ„ï¼šåœ¨æœ€åä¸€éï¼ˆè¯·å‚é˜…ä¸‹ä¸€éƒ¨åˆ†ï¼‰ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°ä»…ä½¿ç”¨ç­‰é«˜çº¿å›¾çš„.ré€šé“ã€‚</font><font style="vertical-align: inherit;">ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦.gé€šé“ï¼Ÿ</font><font style="vertical-align: inherit;">æˆ‘è®¤ä¸ºè¿™æ˜¯ä¸€ç§çº¹ç†ä¸­çš„ä¹’ä¹“ç¼“å†²åŒº-è¯·æ³¨æ„.råŒ…å«.gé€šé“+ä¸€äº›æ–°å€¼ã€‚</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¬¬äº”éƒ¨åˆ†ï¼šå·«å¸ˆçš„å¤©æ‰ï¼ˆé±¼çœ¼å’Œæœ€ç»ˆç»“æœï¼‰ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ç®€è¦åˆ—å‡ºæˆ‘ä»¬å·²ç»æ‹¥æœ‰çš„ä¸œè¥¿ï¼šåœ¨ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œä¸“é—¨é’ˆå¯¹å¥³å·«çš„ç›´è§‰ï¼Œå°†ç”Ÿæˆä¸€ä¸ªå…¨å±äº®åº¦å›¾ï¼Œè¯¥å›¾è¡¨æ˜æ•ˆæœå–å†³äºè·ç¦»çš„æ˜æ˜¾ç¨‹åº¦ã€‚</font><font style="vertical-align: inherit;">åœ¨ç¬¬äºŒéƒ¨åˆ†ä¸­ï¼Œæˆ‘æ›´è¯¦ç»†åœ°ç ”ç©¶äº†è½®å»“å›¾ï¼Œè¯¥è½®å»“å›¾è´Ÿè´£å®Œæˆæ•ˆæœçš„è½®å»“å’ŒåŠ¨ç”»ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬åˆ°äº†æœ€åé˜¶æ®µã€‚</font><font style="vertical-align: inherit;">æ‰€æœ‰è¿™äº›éƒ½éœ€è¦ç»“åˆèµ·æ¥ï¼</font><font style="vertical-align: inherit;">æœ€åä¸€éæ˜¯å…¨å±å››è¾¹å½¢ã€‚</font><font style="vertical-align: inherit;">è¾“å…¥ï¼šé¢œè‰²ç¼“å†²åŒºï¼Œè½®å»“å›¾å’Œäº®åº¦å›¾ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‡³ï¼š</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a6/7ed/667/2a67ed667870cd52dcf0da4f366975b6.jpg"></div><br><br> ä¹‹åï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/abf/ce7/1c4/abfce71c4469b6dcd077723d498c1685.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘å°†å†æ¬¡å±•ç¤ºå…·æœ‰æ‰€åº”ç”¨æ•ˆæœçš„è§†é¢‘ï¼š </font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/ReB6IrOb3ic" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æ‚¨æ‰€è§ï¼Œé™¤äº†å°†è½®å»“åº”ç”¨äºGeraltå¯ä»¥çœ‹åˆ°æˆ–å¬åˆ°çš„å¯¹è±¡ä¹‹å¤–ï¼Œé±¼çœ¼æ•ˆæœè¿˜åº”ç”¨äºæ•´ä¸ªå±å¹•ï¼Œå¹¶ä¸”æ•´ä¸ªå±å¹•ï¼ˆå°¤å…¶æ˜¯è§’è½ï¼‰éƒ½å˜ç°ï¼Œä»¥ä¼ è¾¾çœŸæ­£çš„æ€ªç‰©çŒäººçš„æ„Ÿè§‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®Œå…¨ç»„è£…çš„åƒç´ ç€è‰²å™¨ä»£ç ï¼š</font></font><br><br><pre> <code class="cpp hljs"> ps_5_0 dcl_globalFlags refactoringAllowed dcl_constantbuffer cb0[<span class="hljs-number"><span class="hljs-number">3</span></span>], immediateIndexed dcl_constantbuffer cb3[<span class="hljs-number"><span class="hljs-number">7</span></span>], immediateIndexed dcl_sampler s0, mode_default dcl_sampler s2, <span class="hljs-function"><span class="hljs-function">mode_default </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dcl_resource_texture2d</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> t0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dcl_resource_texture2d</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> t2 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dcl_resource_texture2d</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> t3 dcl_input_ps_siv v0.xy, position dcl_output o0.xyzw dcl_temps 7 0: div r0.xy, v0.xyxx, cb0[2].xyxx 1: mad r0.zw, r0.xxxy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 2: mov r1.yz, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r0.zzwz)</span></span></span><span class="hljs-function"> 3: div r0.z, cb0[2].x, cb0[2].y 4: mul r1.x, r0.z, r1.y 5: add r0.zw, r1.xxxz, -cb3[2].xxxy 6: mul_sat r0.zw, r0.zzzw, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.555556</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.555556</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 7: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">log</span></span></span><span class="hljs-function"> r0.zw, r0.zzzw 8: mul r0.zw, r0.zzzw, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 9: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">exp</span></span></span><span class="hljs-function"> r0.zw, r0.zzzw 10: dp2 r0.z, r0.zwzz, r0.zwzz 11: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">sqrt</span></span></span><span class="hljs-function"> r0.z, r0.z 12: min r0.z, r0.z, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 13: add r0.z, -r0.z, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 14: mov_sat r0.w, cb3[6].x 15: add_sat r1.xy, -r0.xyxx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.030000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.030000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 16: add r1.x, r1.y, r1.x 17: add_sat r0.xy, r0.xyxx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.970000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.970000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 18: add r0.x, r0.x, r1.x 19: add r0.x, r0.y, r0.x 20: mul r0.x, r0.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">20.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 21: min r0.x, r0.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 22: add r1.xy, v0.xyxx, v0.xyxx 23: div r1.xy, r1.xyxx, cb0[2].xyxx 24: add r1.xy, r1.xyxx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 25: dp2 r0.y, r1.xyxx, r1.xyxx 26: mul r1.xy, r0.yyyy, r1.xyxx 27: mul r0.y, r0.w, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.100000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 28: mul r1.xy, r0.yyyy, r1.xyxx 29: max r1.xy, r1.xyxx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.400000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.400000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 30: min r1.xy, r1.xyxx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.400000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.400000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 31: mul r1.xy, r1.xyxx, cb3[1].xxxx 32: mul r1.zw, r1.xxxy, cb0[2].zzzw 33: mad r1.zw, v0.xxxy, cb0[1].zzzw, -r1.zzzw 34: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r2.xyz, r1.zwzz, t0.xyzw, s0 35: mul r3.xy, r1.zwzz, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 36: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r0.y, r3.xyxx, t2.yxzw, s2 37: mad r3.xy, r1.zwzz, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 38: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r2.w, r3.xyxx, t2.yzwx, s2 39: mul r2.w, r2.w, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.125000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 40: mul r3.x, cb0[0].x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.100000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 41: add r0.x, -r0.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 42: mul r0.xy, r0.xyxx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.030000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.125000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 43: mov r3.yzw, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 44: mov r4.x, r0.y 45: mov r4.y, r2.w 46: mov r4.z, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 47: loop 48: ige r4.w, r4.z, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">8</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 49: breakc_nz r4.w 50: itof r4.w, r4.z 51: mad r4.w, r4.w, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.785375</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, -r3.x 52: sincos r5.x, r6.x, r4.w 53: mov r6.y, r5.x 54: mul r5.xy, r0.xxxx, r6.xyxx 55: mad r5.zw, r5.xxxy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.125000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.125000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r1.zzzw 56: mul r6.xy, r5.zwzz, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 57: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r4.w, r6.xyxx, t2.yzwx, s2 58: mad r4.x, r4.w, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.125000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r4.x 59: mad r5.zw, r5.zzzw, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 60: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r4.w, r5.zwzz, t2.yzwx, s2 61: mad r4.y, r4.w, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.125000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r4.y 62: mad r5.xy, r5.xyxx, r1.xyxx, r1.zwzz 63: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r5.xyz, r5.xyxx, t0.xyzw, s0 64: mad r3.yzw, r5.xxyz, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.125000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.125000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.125000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r3.yyzw 65: iadd r4.z, r4.z, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 66: endloop 67: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r0.xy, r1.zwzz, t3.xyzw, s0 68: mad_sat r0.xy, -r0.xyxx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.800000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.750000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r4.xyxx 69: dp3 r1.x, r3.yzwy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.300000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.300000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.300000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 70: add r1.yzw, -r1.xxxx, r3.yyzw 71: mad r1.xyz, r0.zzzz, r1.yzwy, r1.xxxx 72: mad r1.xyz, r1.xyzx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.600000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.600000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.600000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, -r2.xyzx 73: mad r1.xyz, r0.wwww, r1.xyzx, r2.xyzx 74: mul r0.yzw, r0.yyyy, cb3[4].xxyz 75: mul r2.xyz, r0.xxxx, cb3[5].xyzx 76: mad r0.xyz, r0.yzwy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.200000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.200000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.200000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r2.xyzx 77: mov_sat r2.xyz, r0.xyzx 78: dp3_sat r0.x, r0.xyzx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 79: add r0.yzw, -r1.xxyz, r2.xxyz 80: mad o0.xyz, r0.xxxx, r0.yzwy, r1.xyzx 81: mov o0.w, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 82: ret</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">82è¡Œ-æ‰€ä»¥æˆ‘ä»¬è¦åšå¾ˆå¤šå·¥ä½œï¼</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¦–å…ˆï¼Œçœ‹ä¸€ä¸‹è¾“å…¥æ•°æ®ï¼š</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// *** Inputs // * Zoom amount, always 1 float zoomAmount = cb3_v1.x; // Another value which affect fisheye effect // but always set to float2(1.0, 1.0). float2 amount = cb0_v2.zw; // Elapsed time in seconds float time = cb0_v0.x; // Colors of witcher senses float3 colorInteresting = cb3_v5.rgb; float3 colorTraces = cb3_v4.rgb; // Was always set to float2(0.0, 0.0). // Setting this to higher values // makes "grey corners" effect weaker. float2 offset = cb3_v2.xy; // Dimensions of fullscreen float2 texSize = cb0_v2.xy; float2 invTexSize = cb0_v1.zw; // Main value which causes fisheye effect [0-1] const float fisheyeAmount = saturate( cb3_v6.x );</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½±å“æ•ˆæœå¤§å°çš„ä¸»è¦å€¼æ˜¯</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fisheyeAmount</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘è®¤ä¸ºGeraltå¼€å§‹ä½¿ç”¨æœ¬èƒ½æ—¶ï¼Œå®ƒä¼šä»0.0é€æ¸ä¸Šå‡åˆ°1.0ã€‚</font><font style="vertical-align: inherit;">å…¶ä½™çš„å€¼å˜åŒ–ä¸å¤§ï¼Œä½†æ˜¯æˆ‘æ€€ç–‘å¦‚æœç”¨æˆ·åœ¨é€‰é¡¹ä¸­ç¦ç”¨äº†é±¼çœ¼æ•ˆæœï¼ˆæˆ‘æ²¡æœ‰å¯¹æ­¤è¿›è¡Œæ£€æŸ¥ï¼‰ï¼Œå…¶ä¸­çš„ä¸€äº›å€¼ä¼šæœ‰æ‰€ä¸åŒã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘ç”Ÿçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ï¼Œç€è‰²å™¨è®¡ç®—é€ æˆç°åº¦è§’åº¦çš„è’™ç‰ˆï¼š</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">0</span></span>: div r0.xy, v0.xyxx, cb0[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyxx <span class="hljs-number"><span class="hljs-number">1</span></span>: mad r0.zw, r0.xxxy, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">2.000000</span></span>, <span class="hljs-number"><span class="hljs-number">2.000000</span></span>), l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span>: mov r1.yz, <span class="hljs-built_in"><span class="hljs-built_in">abs</span></span>(r0.zzwz) <span class="hljs-number"><span class="hljs-number">3</span></span>: div r0.z, cb0[<span class="hljs-number"><span class="hljs-number">2</span></span>].x, cb0[<span class="hljs-number"><span class="hljs-number">2</span></span>].y <span class="hljs-number"><span class="hljs-number">4</span></span>: mul r1.x, r0.z, r1.y <span class="hljs-number"><span class="hljs-number">5</span></span>: add r0.zw, r1.xxxz, -cb3[<span class="hljs-number"><span class="hljs-number">2</span></span>].xxxy <span class="hljs-number"><span class="hljs-number">6</span></span>: mul_sat r0.zw, r0.zzzw, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.555556</span></span>, <span class="hljs-number"><span class="hljs-number">0.555556</span></span>) <span class="hljs-number"><span class="hljs-number">7</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> r0.zw, r0.zzzw <span class="hljs-number"><span class="hljs-number">8</span></span>: mul r0.zw, r0.zzzw, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">2.500000</span></span>, <span class="hljs-number"><span class="hljs-number">2.500000</span></span>) <span class="hljs-number"><span class="hljs-number">9</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">exp</span></span> r0.zw, r0.zzzw <span class="hljs-number"><span class="hljs-number">10</span></span>: dp2 r0.z, r0.zwzz, r0.zwzz <span class="hljs-number"><span class="hljs-number">11</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span> r0.z, r0.z <span class="hljs-number"><span class="hljs-number">12</span></span>: min r0.z, r0.z, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">13</span></span>: add r0.z, -r0.z, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åœ¨HLSLä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ç¼–å†™ï¼š </font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// Main uv float2 uv = PosH.xy / texSize; // Scale at first from [0-1] to [-1;1], then calculate abs float2 uv3 = abs( uv * 2.0 - 1.0); // Aspect ratio float aspectRatio = texSize.x / texSize.y; // * Mask used to make corners grey float mask_gray_corners; { float2 newUv = float2( uv3.x * aspectRatio, uv3.y ) - offset; newUv = saturate( newUv / 1.8 ); newUv = pow(newUv, 2.5); mask_gray_corners = 1-min(1.0, length(newUv) ); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¦–å…ˆï¼ŒåŒºé—´[-1ï¼›</font><font style="vertical-align: inherit;">1] UVåŠå…¶ç»å¯¹å€¼ã€‚</font><font style="vertical-align: inherit;">ç„¶åæ˜¯ä¸€ä¸ªæ£˜æ‰‹çš„â€œæŒ¤å‹â€ã€‚</font><font style="vertical-align: inherit;">æˆå“å£ç½©å¦‚ä¸‹ï¼š</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ba9/320/0d4/ba93200d4f20e0a5bc361e96994b525b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¨åæˆ‘å°†è¿”å›æ­¤è’™ç‰ˆã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘å°†æœ‰æ„è·³è¿‡å‡ è¡Œä»£ç ï¼Œå¹¶ä»”ç»†ç ”ç©¶è´Ÿè´£ç¼©æ”¾æ•ˆæœçš„ä»£ç ã€‚</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">22</span></span>: add r1.xy, v0.xyxx, v0.xyxx <span class="hljs-number"><span class="hljs-number">23</span></span>: div r1.xy, r1.xyxx, cb0[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyxx <span class="hljs-number"><span class="hljs-number">24</span></span>: add r1.xy, r1.xyxx, l(<span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">25</span></span>: dp2 r0.y, r1.xyxx, r1.xyxx <span class="hljs-number"><span class="hljs-number">26</span></span>: mul r1.xy, r0.yyyy, r1.xyxx <span class="hljs-number"><span class="hljs-number">27</span></span>: mul r0.y, r0.w, l(<span class="hljs-number"><span class="hljs-number">0.100000</span></span>) <span class="hljs-number"><span class="hljs-number">28</span></span>: mul r1.xy, r0.yyyy, r1.xyxx <span class="hljs-number"><span class="hljs-number">29</span></span>: max r1.xy, r1.xyxx, l(<span class="hljs-number"><span class="hljs-number">-0.400000</span></span>, <span class="hljs-number"><span class="hljs-number">-0.400000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">30</span></span>: min r1.xy, r1.xyxx, l(<span class="hljs-number"><span class="hljs-number">0.400000</span></span>, <span class="hljs-number"><span class="hljs-number">0.400000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">31</span></span>: mul r1.xy, r1.xyxx, cb3[<span class="hljs-number"><span class="hljs-number">1</span></span>].xxxx <span class="hljs-number"><span class="hljs-number">32</span></span>: mul r1.zw, r1.xxxy, cb0[<span class="hljs-number"><span class="hljs-number">2</span></span>].zzzw <span class="hljs-number"><span class="hljs-number">33</span></span>: mad r1.zw, v0.xxxy, cb0[<span class="hljs-number"><span class="hljs-number">1</span></span>].zzzw, -r1.zzzw</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é¦–å…ˆï¼Œè®¡ç®—â€œåŠ å€â€çš„çº¹ç†åæ ‡ï¼Œå¹¶æ‰§è¡Œå‡æ³•float2ï¼ˆ1ã€1ï¼‰ï¼š </font></font><br><br><pre> <code class="cpp hljs"> float2 uv4 = <span class="hljs-number"><span class="hljs-number">2</span></span> * PosH.xy; uv4 /= cb0_v2.xy; uv4 -= float2(<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¿™æ ·çš„texcoordå¯ä»¥å¦‚ä¸‹æ˜¾ç¤ºï¼š </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/70a/0b0/dfe/70a0b0dfeb9ca86eb86f137ac96c9811.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç„¶åè®¡ç®—æ ‡é‡ç§¯</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‚¹ï¼ˆuv4ï¼Œuv4ï¼‰</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè¿™ç»™äº†æˆ‘ä»¬æ©ç ï¼š</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1f0/b6c/0a9/1f0b6c0a97ed9ad17a6bc17f3ebcf6c6.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç”¨äºä¹˜ä»¥ä¸Šé¢çš„texcoordsï¼š </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e34/27e/5f2/e3427e5f2a925c8a78f77d81c5840da4.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‡è¦æç¤ºï¼šåœ¨å·¦ä¸Šè§’ï¼ˆé»‘è‰²åƒç´ ï¼‰ï¼Œè¯¥å€¼ä¸ºè´Ÿã€‚</font><font style="vertical-align: inherit;">ç”±äºR11G11B10_FLOATæ ¼å¼çš„å‡†ç¡®æ€§æœ‰é™ï¼Œå®ƒä»¬ä»¥é»‘è‰²ï¼ˆ0.0ï¼‰æ˜¾ç¤ºã€‚</font><font style="vertical-align: inherit;">å®ƒæ²¡æœ‰ç¬¦å·ä½ï¼Œå› æ­¤ä¸èƒ½åœ¨å…¶ä¸­å­˜å‚¨è´Ÿå€¼ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç„¶åè®¡ç®—è¡°å‡ç³»æ•°ï¼ˆå¦‚ä¸Šæ‰€è¿°ï¼Œ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fisheyeAmount</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨0.0åˆ°1.0 </font><i><font style="vertical-align: inherit;">ä¹‹é—´</font></i><font style="vertical-align: inherit;">å˜åŒ–ï¼‰ã€‚</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> attenuation = fisheyeAmount * <span class="hljs-number"><span class="hljs-number">0.1</span></span>; uv4 *= attenuation;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç„¶åæ‰§è¡Œé™åˆ¶ï¼ˆæœ€å¤§/æœ€å°ï¼‰å’Œä¸€ä¸ªä¹˜æ³•ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œè®¡ç®—å‡ºåç§»é‡ã€‚</font><font style="vertical-align: inherit;">è¦è®¡ç®—æœ€ç»ˆçš„uvï¼ˆå°†ç”¨äºå¯¹é¢œè‰²çº¹ç†è¿›è¡Œé‡‡æ ·ï¼‰ï¼Œæˆ‘ä»¬åªéœ€æ‰§è¡Œå‡æ³•æ“ä½œå³å¯ï¼š</font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">float2 colorUV = mainUv-offset; </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šè¿‡å¯¹è¾“å…¥çš„</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">colorUV</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¢œè‰²</font><i><font style="vertical-align: inherit;">çº¹ç†</font></i><font style="vertical-align: inherit;">è¿›è¡Œé‡‡æ ·</font><font style="vertical-align: inherit;">ï¼Œæˆ‘ä»¬åœ¨æ‹è§’å¤„å¾—åˆ°äº†å¤±çœŸçš„å›¾åƒï¼š</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bbc/4f4/967/bbc4f4967c3bf008bf3692af3eb54d69.jpg"></div><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ¦‚è¿° </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸‹ä¸€æ­¥æ˜¯å¯¹ç­‰é«˜çº¿å›¾è¿›è¡Œé‡‡æ ·ä»¥æ‰¾åˆ°ç­‰é«˜çº¿ã€‚</font><font style="vertical-align: inherit;">è¿™å¾ˆç®€å•ï¼Œé¦–å…ˆæˆ‘ä»¬æ‰¾åˆ°texcoordsæ¥é‡‡æ ·æœ‰è¶£ç‰©ä½“çš„è½®å»“ï¼Œç„¶åå¯¹è½¨é“è¿›è¡Œç›¸åŒçš„å¤„ç†ï¼š</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// * Sample outline map // interesting objects (upper left square) float2 outlineUV = colorUV * 0.5; float outlineInteresting = texture2.Sample( sampler2, outlineUV ).x; // r0.y // traces (upper right square) outlineUV = colorUV * 0.5 + float2(0.5, 0.0); float outlineTraces = texture2.Sample( sampler2, outlineUV ).x; // r2.w outlineInteresting /= 8.0; // r4.x outlineTraces /= 8.0; // r4.y</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a08/746/0a3/a087460a37b1b88733e1fef632a566db.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç­‰é«˜çº¿å›¾ä¸­æœ‰è¶£çš„ç‰©ä½“</font></font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c6/edc/995/0c6edc995e2f6cb4c6aeec6701c30ba3.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è½®å»“å›¾ä¸Šçš„è¿¹çº¿</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä»…ä»è½®å»“å›¾ä¸Šé‡‡æ ·.xé€šé“ï¼Œå¹¶ä¸”ä»…è€ƒè™‘äº†ä¸Šæ–¹çš„æ­£æ–¹å½¢ã€‚</font></font><br><br><h4> æœºèŠ¯ </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†å®ç°è½¨é“çš„è¿åŠ¨ï¼Œä½¿ç”¨äº†ä¸é†‰é…’æ•ˆæœå‡ ä¹ç›¸åŒçš„æŠ€å·§ã€‚</font><font style="vertical-align: inherit;">æ·»åŠ äº†ä¸€ä¸ªå•ä½å¤§å°çš„åœ†åœˆï¼Œæˆ‘ä»¬å¯¹è½®å»“å›¾è¿›è¡Œäº†8å€é‡‡æ ·ï¼Œä»¥è·å–æœ‰è¶£çš„å¯¹è±¡å’Œè¿¹çº¿ä»¥åŠé¢œè‰²çº¹ç†ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä»…å°†æ‰¾åˆ°çš„è·¯å¾„é™¤ä»¥8.0ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬å¤„äºçº¹ç†åæ ‡[0-1] </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„ç©ºé—´ä¸­</font><font style="vertical-align: inherit;">ï¼Œå› æ­¤å­˜åœ¨ä¸€ä¸ªåŠå¾„ä¸º1çš„åœ†ä»¥ä½¿å•ä¸ªåƒç´ ç¯ç»•çš„æ“ä½œå°†äº§ç”Ÿä¸å¯æ¥å—çš„ä¼ªåƒï¼š</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3e3/8f1/de3/3e38f1de3016256205a5aa9199bb3a0d.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œåœ¨ç»§ç»­ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹å¦‚ä½•è®¡ç®—æ­¤åŠå¾„ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦è¿”å›åˆ°ç¼ºå°‘çš„ç¬¬15-21è¡Œã€‚</font><font style="vertical-align: inherit;">è®¡ç®—æ­¤åŠå¾„çš„ä¸€ä¸ªå°é—®é¢˜æ˜¯å…¶è®¡ç®—åˆ†æ•£åœ¨ç€è‰²å™¨å‘¨å›´ï¼ˆå¯èƒ½æ˜¯ç”±äºç¼–è¯‘å™¨ä¼˜åŒ–äº†ç€è‰²å™¨ï¼‰ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œè¿™æ˜¯ç¬¬ä¸€éƒ¨åˆ†ï¼ˆ15-21ï¼‰å’Œç¬¬äºŒéƒ¨åˆ†ï¼ˆ41-42ï¼‰ï¼š</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">15</span></span>: add_sat r1.xy, -r0.xyxx, l(<span class="hljs-number"><span class="hljs-number">0.030000</span></span>, <span class="hljs-number"><span class="hljs-number">0.030000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">16</span></span>: add r1.x, r1.y, r1.x <span class="hljs-number"><span class="hljs-number">17</span></span>: add_sat r0.xy, r0.xyxx, l(<span class="hljs-number"><span class="hljs-number">-0.970000</span></span>, <span class="hljs-number"><span class="hljs-number">-0.970000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">18</span></span>: add r0.x, r0.x, r1.x <span class="hljs-number"><span class="hljs-number">19</span></span>: add r0.x, r0.y, r0.x <span class="hljs-number"><span class="hljs-number">20</span></span>: mul r0.x, r0.x, l(<span class="hljs-number"><span class="hljs-number">20.000000</span></span>) <span class="hljs-number"><span class="hljs-number">21</span></span>: min r0.x, r0.x, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) ... <span class="hljs-number"><span class="hljs-number">41</span></span>: add r0.x, -r0.x, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">42</span></span>: mul r0.xy, r0.xyxx, l(<span class="hljs-number"><span class="hljs-number">0.030000</span></span>, <span class="hljs-number"><span class="hljs-number">0.125000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»¬ä»…è€ƒè™‘æ¯ä¸ªè¡¨é¢æ—è¾¹çš„[0.00-0.03]ä¸­çš„çº¹ç´ ï¼Œæ±‡æ€»å…¶å€¼ï¼Œä¹˜ä»¥20å¹¶ä½¿å…¶é¥±å’Œã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯ç¬¬15-21è¡Œä¹‹åçš„æ ·å­ï¼š</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5b2/080/809/5b20808099b641be7510714ffd45a737.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¿™æ˜¯ç¬¬41è¡Œä¹‹åçš„æ–¹å¼ï¼š </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa8/51d/853/fa851d8539027d54d2874472d5952448.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ç¬¬42è¡Œï¼Œæˆ‘ä»¬å°†å…¶ä¹˜ä»¥0.03ï¼Œè¯¥å€¼æ˜¯æ•´ä¸ªå±å¹•çš„åœ†çš„åŠå¾„ã€‚</font><font style="vertical-align: inherit;">å¦‚æ‚¨æ‰€è§ï¼ŒåŠå¾„è¶Šé è¿‘å±å¹•è¾¹ç¼˜ï¼ŒåŠå¾„å°±è¶Šå°ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è´Ÿè´£è¯¥è¿åŠ¨çš„æ±‡ç¼–ä»£ç ï¼š</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">40</span></span>: mul r3.x, cb0[<span class="hljs-number"><span class="hljs-number">0</span></span>].x, l(<span class="hljs-number"><span class="hljs-number">0.100000</span></span>) <span class="hljs-number"><span class="hljs-number">41</span></span>: add r0.x, -r0.x, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">42</span></span>: mul r0.xy, r0.xyxx, l(<span class="hljs-number"><span class="hljs-number">0.030000</span></span>, <span class="hljs-number"><span class="hljs-number">0.125000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">43</span></span>: mov r3.yzw, l(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">44</span></span>: mov r4.x, r0.y <span class="hljs-number"><span class="hljs-number">45</span></span>: mov r4.y, r2.w <span class="hljs-number"><span class="hljs-number">46</span></span>: mov r4.z, l(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">47</span></span>: loop <span class="hljs-number"><span class="hljs-number">48</span></span>: ige r4.w, r4.z, l(<span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-number"><span class="hljs-number">49</span></span>: breakc_nz r4.w <span class="hljs-number"><span class="hljs-number">50</span></span>: itof r4.w, r4.z <span class="hljs-number"><span class="hljs-number">51</span></span>: mad r4.w, r4.w, l(<span class="hljs-number"><span class="hljs-number">0.785375</span></span>), -r3.x <span class="hljs-number"><span class="hljs-number">52</span></span>: sincos r5.x, r6.x, r4.w <span class="hljs-number"><span class="hljs-number">53</span></span>: mov r6.y, r5.x <span class="hljs-number"><span class="hljs-number">54</span></span>: mul r5.xy, r0.xxxx, r6.xyxx <span class="hljs-number"><span class="hljs-number">55</span></span>: mad r5.zw, r5.xxxy, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.125000</span></span>, <span class="hljs-number"><span class="hljs-number">0.125000</span></span>), r1.zzzw <span class="hljs-number"><span class="hljs-number">56</span></span>: mul r6.xy, r5.zwzz, l(<span class="hljs-number"><span class="hljs-number">0.500000</span></span>, <span class="hljs-number"><span class="hljs-number">0.500000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">57</span></span>: sample_indexable(texture2d)(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) r4.w, r6.xyxx, t2.yzwx, s2 <span class="hljs-number"><span class="hljs-number">58</span></span>: mad r4.x, r4.w, l(<span class="hljs-number"><span class="hljs-number">0.125000</span></span>), r4.x <span class="hljs-number"><span class="hljs-number">59</span></span>: mad r5.zw, r5.zzzw, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.500000</span></span>, <span class="hljs-number"><span class="hljs-number">0.500000</span></span>), l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.500000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">60</span></span>: sample_indexable(texture2d)(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) r4.w, r5.zwzz, t2.yzwx, s2 <span class="hljs-number"><span class="hljs-number">61</span></span>: mad r4.y, r4.w, l(<span class="hljs-number"><span class="hljs-number">0.125000</span></span>), r4.y <span class="hljs-number"><span class="hljs-number">62</span></span>: mad r5.xy, r5.xyxx, r1.xyxx, r1.zwzz <span class="hljs-number"><span class="hljs-number">63</span></span>: sample_indexable(texture2d)(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) r5.xyz, r5.xyxx, t0.xyzw, s0 <span class="hljs-number"><span class="hljs-number">64</span></span>: mad r3.yzw, r5.xxyz, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.125000</span></span>, <span class="hljs-number"><span class="hljs-number">0.125000</span></span>, <span class="hljs-number"><span class="hljs-number">0.125000</span></span>), r3.yyzw <span class="hljs-number"><span class="hljs-number">65</span></span>: iadd r4.z, r4.z, l(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">66</span></span>: endloop</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬åœ¨è¿™é‡Œå¾…ä¸€åˆ†é’Ÿã€‚åœ¨ç¬¬40è¡Œä¸Šï¼Œæˆ‘ä»¬è·å¾—äº†æ—¶é—´ç³»æ•°</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-elapsedTime * 0.1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚åœ¨ç¬¬43è¡Œä¸­ï¼Œæˆ‘ä»¬ä¸ºå¾ªç¯å†…è·å¾—çš„é¢œè‰²çº¹ç†æä¾›äº†ä¸€ä¸ªç¼“å†²åŒºã€‚</font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¼—æ‰€å‘¨çŸ¥ï¼Œr0.x</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆç¬¬41-42è¡Œï¼‰æ˜¯åœ†çš„åŠå¾„ã€‚</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r4.x</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆç¬¬44è¡Œï¼‰æ˜¯æ„Ÿå…´è¶£å¯¹è±¡çš„è½®å»“ï¼Œ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r4.y</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆç¬¬45è¡Œï¼‰æ˜¯è½¨é“çš„è½®å»“ï¼ˆä»¥å‰è¢«8ï¼é™¤ï¼‰ï¼Œ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r4.z</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆç¬¬46è¡Œï¼‰æ˜¯å¾ªç¯è®¡æ•°å™¨ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æ‚¨æ‰€æ–™ï¼Œå¾ªç¯æœ‰8æ¬¡è¿­ä»£ã€‚æˆ‘ä»¬é¦–å…ˆä»¥å¼§åº¦</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i * PI_4</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®¡ç®—è§’åº¦</font><font style="vertical-align: inherit;">ï¼Œè¿™</font><i><font style="vertical-align: inherit;">å°†ä½¿</font></i><font style="vertical-align: inherit;">æˆ‘ä»¬è·å¾—2 * PI-ä¸€ä¸ªå®Œæ•´çš„åœ†ã€‚è§’åº¦ä¼šéšç€æ—¶é—´è€Œå˜å½¢ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨sincosï¼Œæˆ‘ä»¬ç¡®å®šé‡‡æ ·ç‚¹ï¼ˆå•ä½åœ†ï¼‰ï¼Œå¹¶ä½¿ç”¨ä¹˜æ³•æ›´æ”¹åŠå¾„ï¼ˆç¬¬54è¡Œï¼‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨é‚£ä¹‹åï¼Œæˆ‘ä»¬ç»•ä¸€ä¸ªåƒç´ ç»•åœˆï¼Œå¹¶é‡‡æ ·è½®å»“å’Œé¢œè‰²ã€‚</font><font style="vertical-align: inherit;">å¾ªç¯ä¹‹åï¼Œæˆ‘ä»¬è·å¾—è½®å»“å’Œé¢œè‰²çš„å¹³å‡å€¼ï¼ˆç”±äºé™¤ä»¥8ï¼‰ã€‚</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> timeParam = time * <span class="hljs-number"><span class="hljs-number">0.1</span></span>; <span class="hljs-comment"><span class="hljs-comment">// adjust circle radius circle_radius = 1.0 - circle_radius; circle_radius *= 0.03; float3 color_circle_main = float3(0.0, 0.0, 0.0); [loop] for (int i=0; 8 &gt; i; i++) { // full 2*PI = 360 angles cycle const float angleRadians = (float) i * PI_4 - timeParam; // unit circle float2 unitCircle; sincos(angleRadians, unitCircle.y, unitCircle.x); // unitCircle.x = cos, unitCircle.y = sin // adjust radius unitCircle *= circle_radius; // * base texcoords (circle) - note we also scale radius here by 8 // * probably because of dimensions of outline map. // line 55 float2 uv_outline_base = colorUV + unitCircle / 8.0; // * interesting objects (circle) float2 uv_outline_interesting_circle = uv_outline_base * 0.5; float outline_interesting_circle = texture2.Sample( sampler2, uv_outline_interesting_circle ).x; outlineInteresting += outline_interesting_circle / 8.0; // * traces (circle) float2 uv_outline_traces_circle = uv_outline_base * 0.5 + float2(0.5, 0.0); float outline_traces_circle = texture2.Sample( sampler2, uv_outline_traces_circle ).x; outlineTraces += outline_traces_circle / 8.0; // * sample color texture (zooming effect) with perturbation float2 uv_color_circle = colorUV + unitCircle * offsetUV; float3 color_circle = texture0.Sample( sampler0, uv_color_circle ).rgb; color_circle_main += color_circle / 8.0; }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¢œè‰²é‡‡æ ·å°†ä»¥å‡ ä¹ç›¸åŒçš„æ–¹å¼æ‰§è¡Œï¼Œä½†æ˜¯</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†å‘</font><font style="vertical-align: inherit;">åŸºç¡€</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">colorUV</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ åç§»é‡ä¹˜ä»¥â€œå•ä¸ªâ€åœ†ã€‚</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> äº®åº¦è°ƒèŠ‚ </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åœ¨å¾ªç¯ä¹‹åï¼Œæˆ‘ä»¬å¯¹äº®åº¦å›¾è¿›è¡Œé‡‡æ ·å¹¶æ›´æ”¹æœ€ç»ˆçš„äº®åº¦å€¼ï¼ˆå› ä¸ºäº®åº¦å›¾å¯¹è½®å»“ä¸€æ— æ‰€çŸ¥ï¼‰ï¼š </font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">67</span></span>: sample_indexable(texture2d)(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) r0.xy, r1.zwzz, t3.xyzw, s0 <span class="hljs-number"><span class="hljs-number">68</span></span>: mad_sat r0.xy, -r0.xyxx, l(<span class="hljs-number"><span class="hljs-number">0.800000</span></span>, <span class="hljs-number"><span class="hljs-number">0.750000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>), r4.xyxx</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HLSLä»£ç ï¼š </font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// * Sample intensity map float2 intensityMap = texture3.Sample( sampler0, colorUV ).xy; float intensityInteresting = intensityMap.r; float intensityTraces = intensityMap.g; // * Adjust outlines float mainOutlineInteresting = saturate( outlineInteresting - 0.8*intensityInteresting ); float mainOutlineTraces = saturate( outlineTraces - 0.75*intensityTraces );</span></span></code> </pre> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç°è‰²çš„è§’è½å’Œä¸€åˆ‡çš„æœ€ç»ˆç»Ÿä¸€ </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä½¿ç”¨æ ‡é‡ä¹˜ç§¯ï¼ˆæ±‡ç¼–å™¨è¡Œ69ï¼‰è®¡ç®—æ›´é è¿‘æ‹è§’çš„ç°è‰²ï¼š </font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// * Greyish color float3 color_greyish = dot( color_circle_main, float3(0.3, 0.3, 0.3) ).xxx;</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b55/9a1/e0f/b559a1e0f3ae66041cdf3f9f48ba4b06.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç„¶åè¿›è¡Œä¸¤ä¸ªæ’å€¼ã€‚</font><font style="vertical-align: inherit;">ç¬¬ä¸€ä¸ªä½¿ç”¨æˆ‘æè¿°çš„ç¬¬ä¸€ä¸ªè’™ç‰ˆå°†ç°è‰²ä¸â€œåœ†åœˆä¸­çš„é¢œè‰²â€ç»“åˆåœ¨ä¸€èµ·ï¼Œå› æ­¤æ‹è§’å˜ä¸ºç°è‰²ã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œç³»æ•°ä¸º0.6ï¼Œå¯é™ä½æœ€ç»ˆå›¾åƒçš„é¥±å’Œåº¦ï¼š</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c6a/389/202/c6a38920286de2fe269224a6b26ebd77.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬äºŒç§ä½¿ç”¨</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fisheyeAmount</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†ç¬¬ä¸€ç§é¢œè‰²ä¸ä¸Šè¿°é¢œè‰²ç»“åˆåœ¨ä¸€èµ·</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿™æ„å‘³ç€å±å¹•é€æ¸å˜æš—ï¼ˆç”±äºä¹˜ä»¥0.6ï¼‰ï¼Œè§’è½å¤„é€æ¸å˜ç°ï¼</font><font style="vertical-align: inherit;">ç²¾å·§ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HLSLï¼š</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// * Determine main color. // (1) At first, combine "circled" color with gray one. // Now we have have greyish corners here. float3 mainColor = lerp( color_greyish, color_circle_main, mask_gray_corners ) * 0.6; // (2) Then mix "regular" color with the above. // Please note this operation makes corners gradually gray (because fisheyeAmount rises from 0 to 1) // and gradually darker (because of 0.6 multiplier). mainColor = lerp( color, mainColor, fisheyeAmount );</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥ç»§ç»­æ·»åŠ å¯¹è±¡çš„è½®å»“ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¢œè‰²ï¼ˆçº¢è‰²å’Œé»„è‰²ï¼‰æ¥è‡ªå¸¸é‡ç¼“å†²åŒºã€‚</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// * Determine color of witcher senses float3 senses_traces = mainOutlineTraces * colorTraces; float3 senses_interesting = mainOutlineInteresting * colorInteresting; float3 senses_total = 1.2 * senses_traces + senses_interesting;</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ca/4ea/52d/9ca4ea52df8a22889828414ee2bfde05.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¿«åˆ°ç»ˆç‚¹äº†ï¼</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬æœ‰æœ€ç»ˆçš„é¢œè‰²ï¼Œæœ‰å¥³å·«æœ¬èƒ½çš„é¢œè‰²â€¦â€¦å®ƒä»ç„¶éœ€è¦ä»¥æŸç§æ–¹å¼ç»“åˆèµ·æ¥ï¼</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œç®€å•çš„æ·»åŠ æ˜¯ä¸åˆé€‚çš„ã€‚</font><font style="vertical-align: inherit;">é¦–å…ˆï¼Œæˆ‘ä»¬è®¡ç®—æ ‡é‡ç§¯ï¼š</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">78</span></span>: dp3_sat r0.x, r0.xyzx, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dot_senses_total = saturate( dot(senses_total, float3(<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>) ) );</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> çœ‹èµ·æ¥åƒè¿™æ ·ï¼š </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ae/357/099/2ae357099e5bfe5185d16103f87a6b69.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æœ€åï¼Œè¿™äº›å€¼ç”¨äºåœ¨é¢œè‰²å’Œï¼ˆé¥±å’Œçš„ï¼‰å¥³å·«çš„å¤©èµ‹ä¹‹é—´è¿›è¡Œæ’å€¼ï¼š </font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">76</span></span>: mad r0.xyz, r0.yzwy, l(<span class="hljs-number"><span class="hljs-number">1.200000</span></span>, <span class="hljs-number"><span class="hljs-number">1.200000</span></span>, <span class="hljs-number"><span class="hljs-number">1.200000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>), r2.xyzx <span class="hljs-number"><span class="hljs-number">77</span></span>: mov_sat r2.xyz, r0.xyzx <span class="hljs-number"><span class="hljs-number">78</span></span>: dp3_sat r0.x, r0.xyzx, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">79</span></span>: add r0.yzw, -r1.xxyz, r2.xxyz <span class="hljs-number"><span class="hljs-number">80</span></span>: mad o0.xyz, r0.xxxx, r0.yzwy, r1.xyzx <span class="hljs-number"><span class="hljs-number">81</span></span>: mov o0.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">82</span></span>: ret float3 senses_total = <span class="hljs-number"><span class="hljs-number">1.2</span></span> * senses_traces + senses_interesting; <span class="hljs-comment"><span class="hljs-comment">// * Final combining float3 senses_total_sat = saturate(senses_total); float dot_senses_total = saturate( dot(senses_total, float3(1.0, 1.0, 1.0) ) ); float3 finalColor = lerp( mainColor, senses_total_sat, dot_senses_total ); return float4( finalColor, 1.0 );</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/abf/ce7/1c4/abfce71c4469b6dcd077723d498c1685.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»…æ­¤è€Œå·²ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®Œæ•´çš„ç€è‰²å™¨å¯</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ­¤å¤„è·å¾—</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘çš„ï¼ˆå·¦ï¼‰ç€è‰²å™¨å’ŒåŸå§‹ï¼ˆå³ï¼‰ç€è‰²å™¨çš„æ¯”è¾ƒï¼š</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/433/5be/2e4/4335be2e49bd901916567734cc0485a5.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸Œæœ›æ‚¨å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼</font><font style="vertical-align: inherit;">â€œç»´å…‹æœ¬èƒ½â€çš„æœºåˆ¶ä¸­æœ‰è®¸å¤šç»å¦™çš„ä¸»æ„ï¼Œè€Œä¸”æœ€ç»ˆçš„ç»“æœå¾ˆåˆç†ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[åˆ†æçš„å…ˆå‰éƒ¨åˆ†ï¼š</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬ä¸€</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬äºŒ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚]</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN450332/">https://habr.com/ru/post/zh-CN450332/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN450318/index.html">ç°ä»£JavaScriptå¼€å‘ä¸­çš„è®¾è®¡æ¨¡å¼</a></li>
<li><a href="../zh-CN450320/index.html">ç®€å•çš„é‡å­æ¸¸æˆæ­ç¤ºäº†å®‡å®™çš„ç»ˆæå¤æ‚æ€§</a></li>
<li><a href="../zh-CN450322/index.html">ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦è¿™ä¹ˆå¤šçš„ä½¿è€…ï¼Ÿ</a></li>
<li><a href="../zh-CN450324/index.html">ç”Ÿäº§åŠ›è·Ÿè¸ªç³»ç»Ÿå¦‚ä½•è‡ªåŠ¨è§£é›‡äºšé©¬é€Šå‘˜å·¥</a></li>
<li><a href="../zh-CN450330/index.html">å‰å¾€ç¾å›½æ—¶é€‰æ‹©ä¸€æ‰€å­¦æ ¡</a></li>
<li><a href="../zh-CN450334/index.html">IaaSå’Œæ‰˜ç®¡ITï¼šæŠ€æœ¯æ‘˜è¦</a></li>
<li><a href="../zh-CN450340/index.html">å¦‚ä½•å…è´¹åˆ†æç«äº‰å¯¹æ‰‹çš„ç½‘ç«™ã€‚ åˆ†æ­¥è¯´æ˜</a></li>
<li><a href="../zh-CN450342/index.html">å…³äºç®€å•çš„äº‹æƒ…ï¼Œå¤æ‚çš„ã€‚ æˆ‘ä»¬åœ¨å®¶ä¸­å½’è¿˜å¥³å­©å®¶ç¦½æˆ–RTFMæ¥å®šä¹‰å¡‘æ–™</a></li>
<li><a href="../zh-CN450344/index.html">ç™½æ ‡å¸–å­ï¼Œæˆ–â€œæˆ‘å¦‚ä½•ä¿å­˜æ‚¨çš„è§†é¢‘è¯¾ç¨‹ï¼Œä½¿å…¶ä¸å‡ºç°åœ¨è·Ÿè¸ªå™¨ä¸Šâ€</a></li>
<li><a href="../zh-CN450346/index.html">ç‰›é¡¿çš„å°å±‹æ‘‡ç¯®</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>