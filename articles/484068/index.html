<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìù üî° üìÜ gRPC como protocolo de comunicaci√≥n entre servicios. Informe Yandex üë©üèº‚Äç‚úàÔ∏è üöµüèæ üë®üèæ‚Äçüè´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="gRPC es un marco de c√≥digo abierto para la llamada a procedimiento remoto. En Yandex.Market, gRPC se utiliza como una alternativa m√°s conveniente a RE...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>gRPC como protocolo de comunicaci√≥n entre servicios. Informe Yandex</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/484068/"> gRPC es un marco de c√≥digo abierto para la llamada a procedimiento remoto.  En Yandex.Market, gRPC se utiliza como una alternativa m√°s conveniente a REST.  Sergey Fedoseenkov, que dirige el servicio de desarrollo de herramientas para los socios de Market, comparti√≥ su experiencia de usar gRPC como protocolo para crear integraciones entre los servicios de Java y C ++.  Del informe aprender√° c√≥mo evitar problemas comunes si comienza a usar gRPC despu√©s de REST, c√≥mo devolver errores, implementar el seguimiento, depurar consultas y probar llamadas de clientes.  <a href="https://habr.com/ru/company/yandex/blog/484068">Al final</a> hay un registro no oficial del informe. <br><br>  - Primero, me gustar√≠a presentarle algunos datos sobre Yandex.Market, que ser√°n √∫tiles como parte del informe.  Primer hecho: escribimos servicios en diferentes idiomas.  Esto impone requisitos del cliente para los servicios. <br><a name="habracut"></a><br>  Y si tenemos un servicio en Java, ser√≠a bueno que el cliente para √©l fuera, por ejemplo, tambi√©n un plus o uno peque√±o. <br><br><img src="https://habrastorage.org/webt/fk/km/ek/fkkmekzj1zv6uobtlxcypvjb5bq.jpeg"><br><br>  Todos los servicios que tenemos son independientes, no hay grandes lanzamientos planeados de todo el mercado.  Los microservicios se lanzar√°n de forma independiente, y la compatibilidad con versiones anteriores es importante para nosotros aqu√≠, para que el protocolo lo admita. <br><br>  El tercer hecho: tenemos integraci√≥n sincr√≥nica y asincr√≥nica.  En el informe, hablar√© principalmente sobre s√≠ncrono. <br><br>  ¬øQu√© usamos?  Ahora, por supuesto, la base de nuestras integraciones es REST o servicios similares a REST que intercambian XML / JSON sobre HTTP 1.1.  Tambi√©n hay XML-RPC: lo usamos principalmente cuando se integra con el c√≥digo Python, es decir, Python tiene un servidor XML-RPC incorporado.  Es lo suficientemente conveniente para implementarlo all√≠, y lo apoyamos. <br><br>  Una vez tuvimos CORBA.  Afortunadamente, lo abandonamos.  Ahora principalmente REST y XML / JSON sobre HTTP. <br><br><img src="https://habrastorage.org/webt/mw/we/q6/mwweq653dwqkzn9afcvtqt3temm.jpeg"><br><br>  Las integraciones sincr√≥nicas tienen problemas con los protocolos existentes.  Nos encontramos con tales problemas y tratamos de tratarlos con gRPC.  ¬øCu√°les son estos problemas?  Como dije, quiero tener clientes en diferentes idiomas.  Es aconsejable que todav√≠a no tengan que ser escritos por nosotros mismos.  Y, en general, ser√≠a genial si el cliente pudiera ser s√≠ncrono y as√≠ncrono, dependiendo de los objetivos del usuario del servicio. <br><br>  Tambi√©n me gustar√≠a que el protocolo que utilizamos sea compatible con la compatibilidad con versiones anteriores lo suficientemente bien: esto es muy importante con las versiones independientes paralelas.  Todos nuestros lanzamientos son compatibles con versiones anteriores, no rompemos los comentarios.  Si lo rompi√≥, esto es un error, y solo necesita solucionarlo lo antes posible. <br><br>  Tambi√©n es necesario un enfoque coherente para el manejo de errores: todos los que hicieron servicios REST saben que no se puede usar el estado HTTP.  Por lo general, no permiten una descripci√≥n detallada del problema, debe ingresar algunos de sus estados, sus detalles.  En los servicios REST, todos introducen su propia implementaci√≥n de estos errores, cada vez que tiene que trabajar de manera diferente con esto.  Esto no siempre es conveniente. <br><br>  Tambi√©n me gustar√≠a tener una gesti√≥n del tiempo de espera en el lado del cliente.  Una vez m√°s, aquellos que trabajan con HTTP entienden que si establecemos un tiempo de espera en el lado del cliente y expira, el cliente dejar√° de esperar a que se complete la solicitud, pero el servidor no sabr√° nada al respecto y continuar√° ejecut√°ndolo.  Adem√°s, en el medio hay varios servidores proxy que establecen tiempos de espera globales.  Y el cliente puede simplemente no saber nada sobre ellos y configurarlos no siempre es trivial. <br><br>  Y finalmente, el problema de la documentaci√≥n.  No siempre est√° claro d√≥nde obtener la documentaci√≥n para los recursos REST o para algunos m√©todos, qu√© par√°metros aceptan, qu√© cuerpo se puede transferir y c√≥mo comunicar esta documentaci√≥n con los consumidores del servicio.  Est√° claro que existe Swagger, pero con √©l tampoco todo es trivial. <br><br><h3>  gRPC  Teor√≠a </h3><br>  Me gustar√≠a hablar sobre la parte te√≥rica de gRPC: qu√© es, cu√°les son las ideas.  Y luego pasaremos a practicar. <br><br><img src="https://habrastorage.org/webt/4t/ly/cn/4tlycnzym8eeecxp8_-j2fwedwe.jpeg"><br><br>  En general, gRPC es una especificaci√≥n abstracta.  Describe una RPC abstracta (llamada a procedimiento remoto), es decir, una llamada a procedimiento remoto que tiene ciertas propiedades.  Ahora los enumeraremos.  La primera propiedad es la compatibilidad con llamadas individuales y transmisi√≥n.  Es decir, todos los servicios que implementan esta especificaci√≥n admiten ambas opciones.  El siguiente elemento es la disponibilidad de metadatos, es decir, para que junto con la carga √∫til pueda pasar alg√∫n tipo de metadatos, condicionalmente, encabezados.  Y: soporte para cancelar una solicitud y tiempos de espera listos para usar. <br><br>  Tambi√©n supone que la descripci√≥n de los mensajes y los servicios en s√≠ se realiza a trav√©s de un determinado lenguaje de definici√≥n de interfaz o IDL.  La especificaci√≥n tambi√©n describe el protocolo de conexi√≥n a trav√©s de HTTP / 2, es decir, gRPC supone que funciona solo a trav√©s de HTTP / 2. <br><br><img src="https://habrastorage.org/webt/e0/s9/5n/e0s95ncgptmoczazqnei0yns3b4.jpeg"><br><br>  Hay una implementaci√≥n t√≠pica de gRPC que se usa en la mayor√≠a de los casos.  Tambi√©n lo usamos, y ahora lo veremos.  El formato proto se usa como IDL.  El complemento gRPC para el compilador de prototipos le permite obtener las fuentes de los servicios generados a partir de la descripci√≥n del prototipo.  Y hay bibliotecas de tiempo de ejecuci√≥n en diferentes lenguajes: Java, C ++, Python.  En general, casi todos los idiomas populares son compatibles, existen bibliotecas de tiempo de ejecuci√≥n para ellos.  Y a medida que se intercambian mensajes entre servicios, se utiliza un mensaje proto, mensajes estilizados de acuerdo con el esquema protobuf. <br><br><img src="https://habrastorage.org/webt/wy/zp/bh/wyzpbhu3uhozqntsux32nyvpejw.jpeg"><br><br>  Quiero sumergirme un poco en algunas caracter√≠sticas espec√≠ficas.  Aqu√≠ est√°n  La escritura fuerte, es decir, un mensaje proto, es un mensaje fuertemente escrito.  Aquellos que alguna vez trabajaron con protobuf saben que all√≠ puede describir los campos en su mensaje con tipos.  Los tipos existen tanto primitivos como de series de bytes.  Pueden ser escalares, pueden ser vectores.  Y, de hecho, los mensajes pueden, como campo, contener otros mensajes, lo cual es bastante conveniente, en general, cualquier modelo puede ser representado. <br><br><img src="https://habrastorage.org/webt/29/oz/e6/29oze6gv_s9vazqemxztvqyrrbs.jpeg"><br><br>  Sobre compatibilidad con versiones anteriores.  Me gustar√≠a se√±alar que proto IDL es un formato en el que la compatibilidad con versiones anteriores se presenta de f√°brica, es decir, se concibi√≥ con una acumulaci√≥n de compatibilidad con versiones anteriores, y Google lanz√≥ una versi√≥n de proto3 que, en comparaci√≥n con proto2, mejora a√∫n m√°s la compatibilidad con versiones anteriores.  Adem√°s, hay todo tipo de especificaciones, c√≥mo y qu√© se puede cambiar para preservar la compatibilidad con versiones anteriores en algunos casos no triviales. <br><br>  Existe la posibilidad de valores predeterminados, puede agregar nuevos campos y el consumidor no necesita cambiar nada, de hecho.  Todos los campos en proto3 son opcionales y, por ejemplo, se pueden eliminar, y acceder al campo remoto no causa errores en el cliente. <br><br><img src="https://habrastorage.org/webt/dl/ws/kh/dlwskhpcodspqbqkwe-q1ihxaas.jpeg"><br><br>  Otra caracter√≠stica de gRPC es que el cliente y el servidor se generan utilizando el compilador de proto y el complemento gRPC seg√∫n la descripci√≥n de proto.  Existe la posibilidad en el momento en que se est√° escribiendo el c√≥digo para elegir qu√© cliente se utilizar√°.  Es decir, elija un cliente as√≠ncrono o s√≠ncrono, seg√∫n el tipo de c√≥digo que escriba.  Por ejemplo, un cliente as√≠ncrono es muy adecuado para el c√≥digo reactivo.  Y esta oportunidad es para cualquier idioma.  Es decir, una vez que escribe una protodescripci√≥n, despu√©s de eso puede generar un cliente para cualquier idioma, y ‚Äã‚Äãno necesita desarrollarlos por separado de alguna manera.  Puede distribuir la interfaz para su servicio simplemente como una protodescripci√≥n.  Cualquier consumidor puede generar un cliente para s√≠ mismo. <br><br><img src="https://habrastorage.org/webt/ny/at/qr/nyatqr7l4jcnnxrzwudubg0u_wc.jpeg"><br><br>  Sobre la cancelaci√≥n de la solicitud y los plazos, me gustar√≠a se√±alar que la solicitud se puede cancelar en el servidor y en el cliente.  Si entendemos que todo, no necesitamos seguir cumpliendo con la solicitud, entonces podemos cancelarla.  Es posible establecer un tiempo de espera a pedido.  En gRPC, la mayor√≠a de las bibliotecas de tiempo de ejecuci√≥n usan una fecha l√≠mite como concepto de tiempo de espera.  Pero de hecho es lo mismo.  Es decir, este es el momento en que la solicitud debe completarse. <br><br>  Y lo m√°s interesante es que el servidor puede averiguar tanto sobre la cancelaci√≥n de la solicitud como sobre el vencimiento del tiempo de espera y dejar de ejecutar la solicitud por su parte.  Esto es genial, me parece que no hay mucho en ning√∫n otro lado. <br><br>  Sobre la documentaci√≥n, quer√≠a se√±alar que, dado que el formato proto se usa en el IDL para gRPC, este es un c√≥digo regular.  All√≠ puede escribir comentarios, incluidos los muy detallados.  Y debe comprender que para integrarse con su servicio, sus usuarios deben tener este protoformato en su hogar, y les llegar√° junto con comentarios, no se encontrar√°n en otro lugar.  Es muy conveniente.  Y puede ampliar esta descripci√≥n, es decir, es una caracter√≠stica tan conveniente que la documentaci√≥n va al lado del c√≥digo, al igual que puede estar al lado de los m√©todos en forma de javadoc o cualquier otro comentario. <br><br><h3>  Llamada unaria gRPC.  Practica </h3><br>  Sigamos, veamos un poco de pr√°ctica.  Y el ejemplo m√°s b√°sico del uso de gRPC es la llamada llamada unaria, o llamada √∫nica.  Este es un esquema cl√°sico: enviamos una solicitud al servidor y obtenemos una respuesta del servidor.  Parece que esto funciona en HTTP. <br><br><img src="https://habrastorage.org/webt/dd/lh/kd/ddlhkdqueihh4_s65obi4t9qxns.jpeg"><br><br>  Considere el ejemplo del servicio de eco que hacemos.  El servidor se escribir√° en pluses, el cliente en Java.  El circuito de equilibrio cl√°sico se us√≥ aqu√≠.  Es decir, el cliente se dirige al equilibrador, y luego el equilibrador ya selecciona un backend espec√≠fico para procesar la solicitud. <br><br>  Quer√≠a prestar atenci√≥n, ya que gRPC funciona sobre HTTP / 2, se utiliza una conexi√≥n TCP.  Y adem√°s, varias corrientes lo atraviesan.  Aqu√≠ puede ver que la conexi√≥n entre el cliente y el equilibrador se establece una vez y permanece persistente, y luego el equilibrador equilibra la carga en diferentes backends para cada llamada.  Si miras, sucede as√≠ y as√≠ si los mensajes se distribuyen. <br><br><img src="https://habrastorage.org/webt/yc/tn/fe/yctnfe9-06tb1-en3lvbxlmqbsu.jpeg"><br><br>  Aqu√≠ hay un c√≥digo de muestra para nuestro archivo proto.  Puede notar que primero describimos el mensaje, es decir, tenemos EchoRequest y EchoResponse.  Tiene solo un campo de cadena que almacena el mensaje. <br><br>  El segundo paso describimos nuestro procedimiento.  El procedimiento de entrada acepta EchoRequest, devuelve EchoResponse como resultado, todo es bastante trivial.  Esta es la descripci√≥n del servicio gRPC y los mensajes que ser√°n perseguidos. <br><br><br><img src="https://habrastorage.org/webt/yo/ti/mi/yotimiyugzrzit8vy2xdfn-yely.jpeg"><br><br>  Veamos c√≥mo va esto en el caso de las ventajas, por ejemplo.  Se ensambla en tres etapas.  En la primera etapa, nuestra tarea es generar fuentes de mensajes.  Aqu√≠ estamos haciendo esto con este equipo.  Llamamos al compilador de proto, pasamos el archivo de proto a la entrada, indicamos d√≥nde colocar los archivos de salida. <br><br>  El segundo equipo.  Tambi√©n generamos servicios de la misma manera.  La √∫nica diferencia con el comando anterior es que pasamos el complemento y, seg√∫n la descripci√≥n, que est√° en formato proto, genera servicios. <br><br>  El tercer paso: recopilamos todo esto en un binario para que nuestro servidor se pueda iniciar. <br><br>  Se pasa una bandera adicional al enlazador, se llama grpc ++ _ reflexi√≥n.  Quiero se√±alar: el servidor gRPC tiene esa caracter√≠stica, reflejo del servidor.  Le permite explorar qu√© tipo de servicios, llamadas RPC y mensajes tiene el servicio.  De forma predeterminada, est√° desactivado y puede acceder al servicio solo si tiene un prototipo a mano.  Pero, por ejemplo, para la depuraci√≥n, es muy conveniente, sin el proto-formato disponible, solo encienda el servidor con la funci√≥n de reflexi√≥n y reciba informaci√≥n de inmediato. <br><br><br><img src="https://habrastorage.org/webt/yl/h-/fw/ylh-fw1j3sykaipf5_4c3zvvhgi.jpeg"><br><br>  Ahora veamos la implementaci√≥n.  La implementaci√≥n tambi√©n es minimalista.  Es decir, nuestra tarea principal es implementar el servicio de eco generado.  Tiene un m√©todo getEcho.  Simplemente genera mensajes y los devuelve.  Estado correcto: estado de √©xito. <br><br>  A continuaci√≥n, creamos ServerBuilder, registramos nuestro servicio en √©l, que creamos un poco m√°s. <br><br><br><img src="https://habrastorage.org/webt/u8/6l/yz/u86lyzlselt_gi1khgl7l5umzw8.jpeg"><br><br>  Ahora solo comenzamos y esperamos las solicitudes entrantes. <br><br><br><img src="https://habrastorage.org/webt/bd/v9/bl/bdv9blqsyc3gbw-atarolnny0ha.jpeg"><br><br><br>  Ahora veamos al cliente en Java.  Recolectamos gradle.  Nuestra tarea es conectar primero el plugin protobuf. <br><br>  Hay un conjunto b√°sico de dependencias que necesitamos arrastrar para nuestro servicio, que se necesitan en la etapa de compilaci√≥n. <br><br>  Tambi√©n quiero se√±alar que hay una biblioteca en tiempo de ejecuci√≥n.  Para Java, usa netty como servidor y cliente, es compatible con HTTP / 2, es bastante conveniente y de alto rendimiento. <br><br>  A continuaci√≥n configuramos el compilador proto.  No es necesario que el compilador en s√≠ mismo se instale localmente para Java; se puede tomar de artefactos. <br><br>  Lo mismo con los complementos.  Localmente para Java, no es necesario.  Puedes arrastrar un artefacto.  Y es importante configurarlo simplemente para que para todos los shuffle tambi√©n se llame, de modo que se generen stubs. <br><br><br><img src="https://habrastorage.org/webt/iu/n7/v6/iun7v66-lubn0f1qrwb1napvw6s.jpeg"><br><br><br>  Pasemos al c√≥digo Java.  Aqu√≠ somos los primeros en crear el trozo de nuestro servicio.  Esa es nuestra tarea para Java para proporcionar Canal.  Hay un ChannelBuilder en la biblioteca de tiempo de ejecuci√≥n con el que podemos construir este canal.  Aqu√≠ activamos manualmente el texto sin formato para simplificar, pero HTTP2 y gRPC cifran todo de forma predeterminada y usan TLS. <br><br>  Tenemos un trozo de nuestro cliente, aqu√≠ se genera un cliente s√≠ncrono.  Del mismo modo, puede generar un cliente asincr√≥nico, hay otras opciones. <br><br>  A continuaci√≥n, creamos nuestra solicitud de protobuff, es decir, construimos un mensaje de protobuff. <br><br><br><img src="https://habrastorage.org/webt/kn/qo/1u/knqo1uengqboh-vagqyfyipqvrs.jpeg"><br><br><br>  Eso es todo, env√≠elo, en nuestro cliente llamamos a getEcho e imprimimos el resultado.  Todo es simple  Como puede ver, se necesita bastante c√≥digo y se construye la integraci√≥n. <br><br><h3>  Transmisi√≥n de gRPC.  Practica </h3><br>  Ahora echemos un vistazo a algo m√°s avanzado, esto es la transmisi√≥n.  Te dir√© c√≥mo funciona, y luego te dir√© c√≥mo usarlo. <br><br><img src="https://habrastorage.org/webt/ly/pu/15/lypu157vtebmx4q8sw11d70gemo.jpeg"><br><br>  La transmisi√≥n cliente-servidor se ve arquitect√≥nicamente m√°s o menos igual.  Es decir, tenemos una conexi√≥n persistente entre el cliente y el equilibrador.  Entonces comienzan las diferencias.  La esencia de la transmisi√≥n es que el cliente est√° conectado a alg√∫n backend final, y la conexi√≥n se guarda a trav√©s.  Es decir, sigue as√≠.  Y asi.  Aqu√≠ me gustar√≠a se√±alar por separado que el uso de un equilibrador no es t√≠pico para la transmisi√≥n, es decir, debe comprender que las solicitudes de transmisi√≥n pueden durar bastante.  Es decir, puede abrirlos e intercambiar mensajes durante mucho tiempo.  Y estos mensajes pasar√°n por el equilibrador, pero, de hecho, siempre ir√°n al mismo backend.  Y no est√° muy claro por qu√© es necesario. <br><br>  Una pr√°ctica com√∫n es cuando un servicio, por ejemplo, es puramente streaming, o principalmente streaming, luego se utiliza el descubrimiento de servicios.  GRPC tiene un punto de extensi√≥n donde se puede incrustar el descubrimiento de servicios. <br><br><img src="https://habrastorage.org/webt/dm/5f/lq/dm5flqilbfrmpdwlz-xi-0dn9nw.jpeg"><br><br>  ¬øQu√© necesitamos para implementar servicios de transmisi√≥n?  Tenemos el mismo formato de proto.  Estamos agregando otro RPC, y aqu√≠ puede notar que hemos agregado dos palabras clave antes de la solicitud y antes de la respuesta.  Por lo tanto, declaramos las secuencias EchoRequest y EchoResponse. <br><br><br><img src="https://habrastorage.org/webt/y7/ji/8i/y7ji8idykqbfsumuuj91t1fwwde.jpeg"><br><br>  Lo m√°s interesante comienza.  Nuestra compilaci√≥n no cambia de ninguna manera para que los servicios de transmisi√≥n lo hagan.  Nuestra siguiente tarea es anular nuestro nuevo m√©todo en nuestro servicio Echo, que funcionar√° con transmisiones.  En el caso del servidor, todo esto es algo m√°s f√°cil.  Es decir, podemos leer constantemente de la transmisi√≥n y podemos responder algo.  Podemos responder asincr√≥nicamente.  Es decir, son independientes, transmiten para escribir y transmiten para leer, y aqu√≠ todo es simple para un escenario simple. <br><br><img src="https://habrastorage.org/webt/vv/ih/as/vvihasd7g8s9s8jfxte2lgdkae0.jpeg"><br><br>  Aqu√≠ est√° la lectura ahora, aqu√≠ est√° la grabaci√≥n. <br><br><br><img src="https://habrastorage.org/webt/v_/rb/l_/v_rbl_m4pyxndxrkveev_ibze2q.jpeg"><br><br>  En clientes Java, las cosas son un poco m√°s complicadas.  All√≠ no puede usar ninguna API s√≠ncrona, es decir, simplemente no funciona con transmisiones.  Y all√≠ se usa la API asincr√≥nica.  Es decir, nuestra tarea es implementar la plantilla Observer.  Hay una interfaz StreamObserver all√≠.  Contiene tres m√©todos: onNext, onCompleted y onError.  Aqu√≠, por simplicidad, implement√© solo en Next.  Se contrae solo cuando la respuesta nos llega del servidor. <br><br><br><img src="https://habrastorage.org/webt/o5/ma/2r/o5ma2rsuawum-empf1enylvayos.jpeg"><br><br>  Aqu√≠ solo puse una cola para mensajes entre hilos. <br><br><img src="https://habrastorage.org/webt/wt/pu/zd/wtpuzdzh5dlmkgdxqpkieddlegg.jpeg"><br><br>  Cual es la diferencia  En lugar de blockStub, simplemente hacemos newStub.  Esta es una implementaci√≥n asincr√≥nica que puede funcionar solo con Observer.  De hecho, puede hacer llamadas unitarias en Observer, pero no es tan conveniente.  Nosotros, al menos, no lo usamos tan activamente. <br><br>  A continuaci√≥n construimos nuestro Observador. <br><br>  Y hacemos nuestra llamada RPC.  Pasamos ResponseObserver a la entrada, y en la salida nos emite RequestObserver.  Adem√°s, podemos hacer llamadas en RequestObserver, transmitiendo as√≠ mensajes al servidor.  Y nuestro ResponseObserver se contraer√° y procesar√° los mensajes. <br><br>  Aqu√≠ hay un ejemplo.  Solo estamos haciendo una llamada.  Llame al siguiente, pase Solicitud all√≠. <br><br>  M√°s all√° de la cola, esperamos que el servidor responda e imprima. <br><br><br><img src="https://habrastorage.org/webt/bg/ta/hq/bgtahqaqbyqbzp72lhix4tzsmii.jpeg"><br><br><br>  Quiero llamar la atenci√≥n sobre el hecho de que nuestra tarea aqu√≠, como las personas responsables de la implementaci√≥n de la transmisi√≥n, es manejar correctamente el cierre de este RequestObserver.  Es decir, en caso de error, debemos llamar al m√©todo onError y, en caso de finalizaci√≥n exitosa, cuando creemos que la secuencia puede cerrarse, debemos llamar al m√©todo onCompleted. <br><br><img src="https://habrastorage.org/webt/js/4a/ze/js4aze1vr9sb4t9clbpq0obdywy.jpeg"><br><br>  Seguimos adelante.  ¬øCu√°les son las aplicaciones de transmisi√≥n?  Esto es algo m√°s avanzado, no el hecho de que es directamente √∫til para todos, sino que a veces se usa.  Es decir, el primero es descargar y cargar grandes cantidades de datos.  El servidor o el cliente pueden producir datos en algunas partes.  Estas porciones ya pueden estar agrupadas de alguna manera en el cliente o en el servidor.  Es decir, ya puede hacer optimizaciones adicionales aqu√≠. <br><br>  Adem√°s, el esquema de transmisi√≥n es muy adecuado para el empuje del servidor.  Debe comprender que consider√© la opci√≥n m√°s extrema cuando tenemos transmisi√≥n bidireccional.  Y tal vez transmitiendo en una direcci√≥n.  Por ejemplo, de cliente a servidor o de servidor a cliente.  En el caso de un servidor a un cliente, podemos conectarnos a alg√∫n servidor, y nos enviar√° insultos, y para esto no necesitaremos sondear regularmente. <br><br>  La siguiente ventaja de la transmisi√≥n es vinculante para una m√°quina.  Como ya dije, se establecer√° una conexi√≥n de extremo a extremo para todos los mensajes dentro de la transmisi√≥n, y esta conexi√≥n estar√° vinculada a una m√°quina, y definitivamente no cambiar√° a ninguna parte.  Por lo tanto, es posible, en primer lugar, simplificar algo, alg√∫n tipo de sincronizaci√≥n entre servidores y, adem√°s, puede hacer cosas transaccionales. <br><br>  Y la transmisi√≥n bidireccional, solo un ejemplo que mostr√©, es la capacidad de construir algunos de mis propios protocolos.  Lo suficientemente interesante.  Tenemos colas internas en Yandex que solo usan transmisi√≥n bidireccional.  Y si de repente alguien tiene tales tareas, entonces es una buena oportunidad para usarlo. <br><br>    ,     .            .            . ,     -   ,      ,      .      .  gRPC    . <br><br><h3>   </h3><br>  ,      gRPC. <br><br><img src="https://habrastorage.org/webt/wl/un/lo/wlunloh9hz1t6cklr4zaqzketmm.jpeg"><br><br>     ,   .   -  .   gRPC    . , ,  ,   , ,   .   ,    runtime- .  ,   .      ,   OK,       runtime- . <br><br> ,  Java      .                    .  google.rpc.Status  3 :  ,   .     ,   .        ,    .  ‚Äî  ,      ,    . <br><br>      error details,   ,   .   : ,   , , stack traces,      .   ,    . <br><br>    ‚Äî   ,  HTTP   ,     ?       .     BadRequest   .   ,     ,      error details,   . <br><br>   .   , , BadRequest  -  (   ),     - error detail.       , ,      ,   - .    ,    . <br><br><img src="https://habrastorage.org/webt/dk/dn/zl/dkdnzlcnav_kpnc7e29mv7j5hqa.jpeg"><br><br>       .  .   ,    , ,     .   - -   ,  - - ,     ,  .       .  , , Zipkin.   ,  HTTP    ,  ‚Äî  metadata.         . <br><br>       ,   .       ,        - ,    ,    ,     . <br><br>     runtime-,           - ,   .  Java  ClientInterceptor  ServerInterceptor.  ,    ,   . ,   ,  ,       ,    ,   - . ,  - API - .    ,  ,  , ,   - .  ,     gRPC,      ,  - .       ,  ,   - , ,  ,  . <br><br><img src="https://habrastorage.org/webt/fy/8u/iz/fy8uiztm6gwxntcvzc8m0qdcply.jpeg"><br><br>   -   .     -.   Java  .       ,       ,    -  .   -  ,     . <br><br><img src="https://habrastorage.org/webt/sb/zx/th/sbzxthmnnf_fh8iyxl9ghv02s4y.jpeg"><br><br>  .   gRPC ‚Äî  . HTTP/2  .   -   ,   ?    : , .    .   ,    gRPC   grpc_cli,  curl.   ,      . , -,  .    ,    gRPC    ,       . <br><br>    ,  evans.   ,    CLI:   ,     ,  ,  .  ,   .  - , ,  ,   , ,  . <br><br>  -  UI ‚Äî ,   Postman, ‚Äî  BloomRPC.     Postman .  Postman, , ,    .   , BloomRPC ,   . <br><br>  -  ,   .  , ,     grpc_cli.          .   ,   .  ,   ,  .       ,       .  , - -  .    ‚Äî . <br><br><img src="https://habrastorage.org/webt/7y/oe/w3/7yoew3fwgydkvdgiaxm1acueyki.jpeg"><br><br> ,     ,    gRPC.       . -    , -  ,  .  Swagger. ,    HTTP/1    .     OpenAPI   ,        .       . ,        HTTP/2,  Swagger ‚Äî   . <br><br> WSDL ‚Äî  ,  .   .       Swagger,     ,   .    .   -. <br><br>  ,  , ,       ,  JAX-RS,   Java  .    . <br><br>     Twirp.   ?     Go,     .     . ,  ,   Go ,   gRPC  Twirp.   ?  ,  gRPC ‚Äî   ,   , ,  IDL .     proto-  ,        gRPC-.      protoc,       ,       . <br><br>  Twirp     .   proto-      ,    HTTP/1.1    ,   JSON.    ,  Twirp      Go.       ,    ,   Java      Jetty.    ,    . <br><br><img src="https://habrastorage.org/webt/fn/p3/bi/fnp3bihwdt68ttten4_mpx7qal4.jpeg"><br><br>     ? gRPC ‚Äî    REST   .    ,     ,   , ,  HTTP/2 balancer.   service discovery,    . gRPC ,   .    . <br><br>      gRPC ‚Äî  ,  .   CLI,   UI. ,        . <br><br>    ,      gRPC.  inter-process-. , sidecar pattern.  ,          .      ,    . ,   -.    -     ,              ,     -.              .      ,  , ,    ,     - . <br><br> ,       .  gRPC    .   ,  .    ,   unary-.         ,      . <br><br>   : <br> ‚Äî <a href="https://grpc.io/">C  gRPC</a> ‚Äî   , .  ,    , ,      . <br> ‚Äî <a href="https://github.com/grpc-ecosystem/awesome-grpc">Awesome gRPC</a> ‚Äî   GitHub      .      ,    ,   , .  .    ‚Äî  ,  . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Puede encontrar muchos otros recursos en Internet, en algunas diapositivas. </font><font style="vertical-align: inherit;">Pero estos me gustaron m√°s. </font><font style="vertical-align: inherit;">El c√≥digo ligeramente modificado de la presentaci√≥n est√° </font></font><a href="https://github.com/homer-j/grpc-examples"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font> Gracias <br><br><a name="video1"></a><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grabaci√≥n informal de informes</font></font></b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/AciUs4Yq7oU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div></div></div><p>Source: <a href="https://habr.com/ru/post/484068/">https://habr.com/ru/post/484068/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../484052/index.html">Tareas para la base lunar</a></li>
<li><a href="../484056/index.html">¬øSu proyecto realmente necesita pruebas?</a></li>
<li><a href="../484062/index.html">Aprendiendo ingl√©s por MEMASICS</a></li>
<li><a href="../484064/index.html">¬øC√≥mo preparar un juego para la localizaci√≥n? 10 reglas b√°sicas</a></li>
<li><a href="../484066/index.html">Dinero vs equipo. No son los aspectos m√°s obvios de la relaci√≥n de empresarios, fundadores e inversores.</a></li>
<li><a href="../484070/index.html">C√≥mo escribimos un sistema antifraude en cuatro manos y tres cabezas</a></li>
<li><a href="../484072/index.html">5. Fortinet Getting Started v6.0. NAT</a></li>
<li><a href="../484076/index.html">D√≥nde almacenar la criptomoneda: impuestos de las criptomonedas en diferentes pa√≠ses</a></li>
<li><a href="../484084/index.html">1C-Bitrix y un intento de presentarlo</a></li>
<li><a href="../484088/index.html">Desfile de contrase√±as (an√°lisis de ~ 5 mil millones de contrase√±as de fugas)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>