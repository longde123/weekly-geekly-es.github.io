<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçë üìõ üåµ Guide de gestion des erreurs JavaScript üõÄüèø üßíüèº üöï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les erreurs sont bonnes. L'auteur du document, dont nous publions la traduction aujourd'hui, se dit convaincu que cette id√©e est connue de tous. √Ä pre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guide de gestion des erreurs JavaScript</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/431078/">  Les erreurs sont bonnes.  L'auteur du document, dont nous publions la traduction aujourd'hui, se dit convaincu que cette id√©e est connue de tous.  √Ä premi√®re vue, les erreurs semblent effrayantes.  Ils peuvent √™tre accompagn√©s d'une sorte de perte.  Une erreur commise en public nuit √† l'autorit√© de celui qui l'a commise.  Mais en faisant des erreurs, nous en tirons des le√ßons, ce qui signifie que la prochaine fois que nous nous retrouverons dans une situation o√π nous nous serions auparavant mal comport√©s, nous ferons tout ce qui est n√©cessaire. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/9q/dw/s5/9qdws5ejk1iibkjghqujq6m4c_4.jpeg"></a> <br><br>  Ci-dessus, nous avons parl√© des erreurs que les gens font dans la vie quotidienne.  Les erreurs de programmation sont autre chose.  Les messages d'erreur nous aident √† am√©liorer le code, ils nous permettent d'informer les utilisateurs de nos projets que quelque chose s'est mal pass√©, et √©ventuellement de dire aux utilisateurs comment se comporter afin que les erreurs ne se produisent plus. <br><a name="habracut"></a><br>  Ce mat√©riel de gestion des erreurs JavaScript est divis√© en trois parties.  Tout d'abord, nous allons donner un aper√ßu g√©n√©ral du syst√®me de gestion des erreurs en JavaScript et parler des objets d'erreur.  Apr√®s cela, nous recherchons la r√©ponse √† la question de savoir quoi faire avec les erreurs qui se produisent dans le code du serveur (en particulier, lors de l'utilisation du bundle Node.js + Express.js).  Ensuite, nous discutons de la gestion des erreurs dans React.js.  Les cadres qui seront examin√©s ici sont s√©lectionn√©s en raison de leur √©norme popularit√©.  Cependant, les principes de traitement des erreurs discut√©s ici sont universels, donc m√™me si vous n'utilisez pas Express et React, vous pouvez facilement appliquer ce que vous avez appris aux outils avec lesquels vous travaillez. <br><br>  Le code du projet de d√©monstration utilis√© dans ce mat√©riel se trouve dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ce</a> r√©f√©rentiel. <br><br><h2>  <font color="#3AC1EF">1. Erreurs dans JavaScript et fa√ßons universelles de les utiliser</font> </h2><br>  Si quelque chose s'est mal pass√© dans votre code, vous pouvez utiliser la construction suivante. <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">'something went wrong'</span></span>)</code> </pre> <br>  Pendant l'ex√©cution de cette commande, une instance de l'objet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Error</a> sera cr√©√©e et une exception sera g√©n√©r√©e (ou, comme on dit, "lev√©e") avec cet objet.  L'instruction <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">throw</a> peut lever des exceptions contenant des expressions arbitraires.  Dans ce cas, l'ex√©cution du script s'arr√™tera si aucune mesure n'a √©t√© prise pour g√©rer l'erreur. <br><br>  Les programmeurs JS d√©butants n'utilisent g√©n√©ralement pas l'instruction <code>throw</code> .  Ils rencontrent g√©n√©ralement des exceptions lev√©es par le langage d'ex√©cution ou des biblioth√®ques tierces.  Lorsque cela se produit, quelque chose comme une <code>ReferenceError: fs is not defined</code> p√©n√®tre dans la console <code>ReferenceError: fs is not defined</code> et l'ex√©cution du programme s'arr√™te. <br><br><h3>  <font color="#3AC1EF">‚ñçErreur d'objet</font> </h3><br>  Les instances de l'objet <code>Error</code> ont plusieurs propri√©t√©s que nous pouvons utiliser.  La premi√®re propri√©t√© qui nous int√©resse est le <code>message</code> .  C'est l√† que la ligne obtient qui peut √™tre pass√©e au constructeur d'erreur comme argument.  Par exemple, ce qui suit montre comment instancier l'objet <code>Error</code> et afficher dans la console la cha√Æne transmise par le constructeur en acc√©dant √† sa propri√©t√© de <code>message</code> . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> myError = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">'please improve your code'</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(myError.message) <span class="hljs-comment"><span class="hljs-comment">// please improve your code</span></span></code> </pre> <br>  La deuxi√®me propri√©t√© de l'objet, tr√®s importante, est la trace de la pile d'erreurs.  Il s'agit d'une propri√©t√© de <code>stack</code> .  Pour ce faire, vous pouvez afficher la pile des appels (historique des erreurs), qui montre la s√©quence des op√©rations qui ont conduit au dysfonctionnement du programme.  En particulier, cela nous permet de comprendre quel fichier contient le mauvais code et de voir quelle s√©quence d'appels de fonction a conduit √† l'erreur.  Voici un exemple de ce que vous pouvez voir en acc√©dant √† la propri√©t√© <code>stack</code> . <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>: please improve your code at <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.&lt;anonymous&gt; (<span class="hljs-regexp"><span class="hljs-regexp">/Users/gi</span></span>sderdube/Documents/_projects/hacking.nosync/error-handling/src/general.js:<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">79</span></span>) at Module._compile (internal/modules/cjs/loader.js:<span class="hljs-number"><span class="hljs-number">689</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>) at <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.Module._extensions..js (internal/modules/cjs/loader.js:<span class="hljs-number"><span class="hljs-number">700</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>) at Module.load (internal/modules/cjs/loader.js:<span class="hljs-number"><span class="hljs-number">599</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span>) at tryModuleLoad (internal/modules/cjs/loader.js:<span class="hljs-number"><span class="hljs-number">538</span></span>:<span class="hljs-number"><span class="hljs-number">12</span></span>) at <span class="hljs-built_in"><span class="hljs-built_in">Function</span></span>.Module._load (internal/modules/cjs/loader.js:<span class="hljs-number"><span class="hljs-number">530</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>) at <span class="hljs-built_in"><span class="hljs-built_in">Function</span></span>.Module.runMain (internal/modules/cjs/loader.js:<span class="hljs-number"><span class="hljs-number">742</span></span>:<span class="hljs-number"><span class="hljs-number">12</span></span>) at startup (internal/bootstrap/node.js:<span class="hljs-number"><span class="hljs-number">266</span></span>:<span class="hljs-number"><span class="hljs-number">19</span></span>) at bootstrapNodeJSCore (internal/bootstrap/node.js:<span class="hljs-number"><span class="hljs-number">596</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>)</code> </pre> <br>  Ici, en haut, il y a un message d'erreur, suivi d'une indication de la section de code dont l'ex√©cution a provoqu√© l'erreur, puis d√©crit l'endroit d'o√π cette section ayant √©chou√© a √©t√© appel√©e.  Cela continue au ¬´plus loin¬ª par rapport au fragment de code d'erreur. <br><br><h3>  <font color="#3AC1EF">‚ñç G√©n√©ration et gestion des erreurs</font> </h3><br>  La cr√©ation d'une instance de l'objet <code>Error</code> , c'est-√†-dire l'ex√©cution d'une commande de la forme <code>new Error()</code> , n'entra√Æne aucune cons√©quence particuli√®re.  Des choses int√©ressantes commencent √† se produire apr√®s l'application de l'op√©rateur de <code>throw</code> , ce qui g√©n√®re une erreur.  Comme d√©j√† mentionn√©, si une telle erreur n'est pas trait√©e, l'ex√©cution du script s'arr√™tera.  Dans ce cas, cela ne fait aucune diff√©rence si l'op√©rateur <code>throw</code> √©t√© utilis√© par le programmeur lui-m√™me, si une erreur s'est produite dans une certaine biblioth√®que ou dans le langage d'ex√©cution (dans un navigateur ou dans Node.js).  Parlons de divers sc√©narios de gestion des erreurs. <br><br><h3>  <font color="#3AC1EF">Tryconstruction essayer ... attraper</font> </h3><br>  Le <code>try...catch</code> est le moyen le plus simple de g√©rer les erreurs souvent oubli√©es.  Aujourd'hui, cependant, il est utilis√© de mani√®re beaucoup plus intensive qu'auparavant, car il peut √™tre utilis√© pour g√©rer les erreurs dans les constructions <code>async/await</code> . <br><br>  Ce bloc peut √™tre utilis√© pour g√©rer les erreurs qui se produisent dans le code synchrone.  Prenons un exemple. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> a = <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {   <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(b) <span class="hljs-comment"><span class="hljs-comment">//  b   -   } catch (err) {   console.error(err) //          } console.log(a) //    ,   </span></span></code> </pre> <br>  Si dans cet exemple, nous n'avons pas <code>console.log(b)</code> commande rat√©e <code>console.log(b)</code> dans un <code>try...catch</code> , le script serait arr√™t√©. <br><br><h3>  <font color="#3AC1EF">‚ñç enfin bloquer</font> </h3><br>  Parfois, il arrive que du code doive √™tre ex√©cut√©, qu'une erreur soit survenue ou non.  Pour ce faire, vous pouvez utiliser le troisi√®me bloc facultatif, <code>finally</code> dans la construction <code>try...catch</code> .  Souvent, son utilisation est √©quivalente √† du code qui vient imm√©diatement apr√®s <code>try...catch</code> , mais dans certaines situations, il peut √™tre utile.  Voici un exemple de son utilisation. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> a = <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {   <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(b) <span class="hljs-comment"><span class="hljs-comment">//  b   -   } catch (err) {   console.error(err) //          } finally {   console.log(a) //        }</span></span></code> </pre> <br><h3>  <font color="#3AC1EF">MechanismsM√©canismes asynchrones - rappels</font> </h3><br>  Lors de la programmation en JavaScript, vous devez toujours faire attention aux sections de code qui s'ex√©cutent de mani√®re asynchrone.  Si vous disposez d'une fonction asynchrone et qu'une erreur s'y produit, le script continuera de s'ex√©cuter.  Lorsque des m√©canismes asynchrones dans JS sont impl√©ment√©s √† l'aide de rappels (d'ailleurs, ce n'est pas recommand√©), le rappel correspondant (fonction de rappel) re√ßoit g√©n√©ralement deux param√®tres.  C'est quelque chose comme le param√®tre <code>err</code> , qui peut contenir une erreur et le <code>result</code> - avec les r√©sultats d'une op√©ration asynchrone.  Cela ressemble √† ceci: <br><br><pre> <code class="javascript hljs">myAsyncFunc(someInput, (err, result) =&gt; {   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(err) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(err) <span class="hljs-comment"><span class="hljs-comment">//           console.log(result) })</span></span></code> </pre> <br>  Si une erreur se produit dans le rappel, elle y est visible en tant que param√®tre <code>err</code> .  Sinon, ce param√®tre obtiendra la valeur <code>undefined</code> ou <code>null</code> .  S'il s'av√®re que <code>err</code> quelque chose, il est important d'y r√©pondre soit parce que dans notre exemple, en utilisant la commande <code>return</code> , soit en utilisant la <code>if...else</code> et en pla√ßant des commandes dans le bloc <code>else</code> pour travailler avec le r√©sultat de l'op√©ration asynchrone.  Il s'agit, en cas d'erreur, d'exclure la possibilit√© de travailler avec le r√©sultat, le param√®tre de <code>result</code> , qui dans ce cas peut √™tre <code>undefined</code> .  L'utilisation de cette valeur, si l'on suppose, par exemple, qu'elle contient un objet, peut elle-m√™me provoquer une erreur.  Disons que cela se produit lorsque vous essayez d'utiliser la construction <code>result.data</code> ou <code>result.data</code> similaire. <br><br><h3>  <font color="#3AC1EF">MechanismsM√©canismes asynchrones - promesses</font> </h3><br>  Pour effectuer des op√©rations asynchrones en JavaScript, il est pr√©f√©rable d'utiliser des promesses plut√¥t que des rappels.  Ici, en plus d'une meilleure lisibilit√© du code, il existe des m√©canismes de gestion des erreurs plus avanc√©s.  √Ä savoir, vous n'avez pas besoin de vous soucier de l'objet d'erreur qui peut tomber dans la fonction de rappel lorsque vous utilisez des promesses.  Ici, √† cet effet, un bloc de <code>catch</code> sp√©cial est fourni.  Il intercepte toutes les erreurs qui se sont produites dans les promesses qui le pr√©c√®dent, ou toutes les erreurs qui se sont produites dans le code apr√®s le <code>catch</code> pr√©c√©dent.  Veuillez noter que si une erreur se produit dans la promesse qui n'a pas de bloc <code>catch</code> √† traiter, cela n'arr√™tera pas l'ex√©cution du script, mais le message d'erreur ne sera pas particuli√®rement lisible. <br><br><pre> <code class="javascript hljs">(node:<span class="hljs-number"><span class="hljs-number">7741</span></span>) UnhandledPromiseRejectionWarning: Unhandled promise rejection (rejection id: <span class="hljs-number"><span class="hljs-number">1</span></span>): <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>: something went wrong (node:<span class="hljs-number"><span class="hljs-number">7741</span></span>) DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> a non-zero exit code. *<span class="hljs-regexp"><span class="hljs-regexp">/</span></span></code> </pre> <br>  Par cons√©quent, vous pouvez toujours recommander, lorsque vous travaillez avec des promesses, d'utiliser le <code>catch</code> .  Jetez un oeil √† un exemple. <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.resolve(<span class="hljs-number"><span class="hljs-number">1</span></span>)   .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function"> =&gt;</span></span> {       <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(res) <span class="hljs-comment"><span class="hljs-comment">// 1       throw new Error('something went wrong')       return Promise.resolve(2)   })   .then(res =&gt; {       console.log(res) //        })   .catch(err =&gt; {       console.error(err) //  ,     ,         return Promise.resolve(3)   })   .then(res =&gt; {       console.log(res) // 3   })   .catch(err =&gt; {       //      ,      -        console.error(err)   })</span></span></code> </pre> <br><h3>  <font color="#3AC1EF">MechanismsM√©canismes asynchrones et essayez ... attraper</font> </h3><br>  Apr√®s que la construction <code>async/await</code> apparue en JavaScript, nous sommes revenus √† la mani√®re classique de g√©rer les erreurs - pour <code>try...catch...finally</code> .  La gestion des erreurs avec cette approche est tr√®s simple et pratique.  Prenons un exemple. <br><br><pre> <code class="javascript hljs">;(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {       <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> someFuncThatThrowsAnError()   } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) {       <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(err) <span class="hljs-comment"><span class="hljs-comment">//       }   console.log('Easy!') //   })()</span></span></code> </pre> <br>  Avec cette approche, les erreurs dans le code asynchrone sont trait√©es de la m√™me mani√®re que dans le mode synchrone.  Par cons√©quent, maintenant, si n√©cessaire, dans un seul <code>catch</code> vous pouvez g√©rer un plus large √©ventail d'erreurs. <br><br><h2>  <font color="#3AC1EF">2. G√©n√©ration et traitement des erreurs dans le code du serveur</font> </h2><br>  Maintenant que nous avons les outils pour travailler avec les erreurs, regardons ce que nous pouvons en faire dans des situations r√©elles.  La g√©n√©ration et la gestion correcte des erreurs est un aspect essentiel de la programmation c√¥t√© serveur.  Il existe diff√©rentes approches pour traiter les erreurs.  Ici, nous allons d√©montrer une approche utilisant notre propre constructeur pour les instances de l'objet <code>Error</code> et les codes d'erreur qui sont commod√©ment transmis au front-end ou √† tout m√©canisme utilisant des API de serveur.  La fa√ßon dont le backend d'un projet sp√©cifique est structur√© n'a pas vraiment d'importance, car avec n'importe quelle approche, vous pouvez utiliser les m√™mes id√©es concernant le traitement des erreurs. <br><br>  En tant que cadre serveur responsable du routage, nous utiliserons Express.js.  R√©fl√©chissons √† la structure dont nous avons besoin pour organiser un syst√®me efficace de gestion des erreurs.  Voici donc ce dont nous avons besoin: <br><br><ol><li>  La gestion des erreurs universelle est un m√©canisme de base adapt√© pour g√©rer les erreurs, au cours duquel un message comme <code>Something went wrong, please try again or contact us</code> , demandant √† l'utilisateur d'essayer d'effectuer l'op√©ration qui a √©chou√©, √† nouveau ou contactez le propri√©taire du serveur.  Ce syst√®me n'est pas particuli√®rement intelligent, mais au moins il est capable d'informer l'utilisateur que quelque chose s'est mal pass√©.  Un tel message est bien meilleur que "t√©l√©chargement sans fin" ou quelque chose de similaire. </li><li>  Traitement d'erreurs sp√©cifiques - un m√©canisme qui vous permet d'informer l'utilisateur des informations d√©taill√©es sur les causes d'un comportement incorrect du syst√®me et de lui donner des conseils sp√©cifiques sur la fa√ßon de traiter le probl√®me.  Par exemple, cela peut √™tre li√© √† l'absence de certaines donn√©es importantes dans la demande que l'utilisateur envoie au serveur, ou qu'il existe d√©j√† un certain enregistrement dans la base de donn√©es qu'il essaie d'ajouter √† nouveau, etc. </li></ol><br><h3>  <font color="#3AC1EF">‚ñç D√©velopper votre propre constructeur d'objets d'erreur</font> </h3><br>  Ici, nous allons utiliser la classe d' <code>Error</code> standard et l'√©tendre.  L'utilisation de m√©canismes d'h√©ritage en JavaScript est risqu√©e, mais dans ce cas, ces m√©canismes sont tr√®s utiles.  Pourquoi avons-nous besoin d'h√©ritage?  Le fait est que pour que nous puissions facilement d√©boguer le code, nous avons besoin d'informations sur la trace de la pile d'erreurs.  En √©tendant la classe d' <code>Error</code> standard, nous avons la possibilit√© de tracer la pile sans effort suppl√©mentaire.  Nous ajoutons deux propri√©t√©s √† notre propre objet d'erreur.  La premi√®re est la propri√©t√© de <code>code</code> , accessible √† l'aide d'une structure de la forme <code>err.code</code> .  Le second est la propri√©t√© <code>status</code> .  Il enregistrera le code d'√©tat HTTP, qui devrait √™tre transmis √† la partie cliente de l'application. <br><br>  Voici √† quoi ressemble la classe <code>CustomError</code> , dont le code est con√ßu comme un module. <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomError</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Error</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(code = 'GENERIC', status = 500, ...params) {       <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(...params)       <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>.captureStackTrace) {           <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>.captureStackTrace(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, CustomError)       }       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.code = code       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.status = status   } } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = CustomError</code> </pre> <br><h3>  <font color="#3AC1EF">‚ñç Routage</font> </h3><br>  Maintenant que notre objet d'erreur est pr√™t √† l'emploi, nous devons configurer la structure de l'itin√©raire.  Comme mentionn√© ci-dessus, nous devons mettre en ≈ìuvre une approche unifi√©e de la gestion des erreurs, ce qui nous permet de g√©rer √©galement les erreurs pour toutes les routes.  Par d√©faut, le framework Express.js ne prend pas totalement en charge un tel sch√©ma.  Le fait est que toutes ses routes sont encapsul√©es. <br><br>  Afin de faire face √† ce probl√®me, nous pouvons impl√©menter notre propre gestionnaire d'itin√©raire et d√©finir la logique de l'itin√©raire sous la forme de fonctions ordinaires.  Gr√¢ce √† cette approche, si la fonction route (ou toute autre fonction) g√©n√®re une erreur, elle tombera dans le gestionnaire de route, qui pourra ensuite la transmettre √† la partie cliente de l'application.  Si une erreur se produit sur le serveur, nous pr√©voyons de la transf√©rer vers le frontal au format suivant, en supposant que l'API JSON sera utilis√©e pour cela: <br><br><pre> <code class="javascript hljs">{   <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-string"><span class="hljs-string">'SOME_ERROR_CODE'</span></span>,   <span class="hljs-attr"><span class="hljs-attr">description</span></span>: <span class="hljs-string"><span class="hljs-string">'Something bad happened. Please try again or contact support.'</span></span> }</code> </pre> <br>  Si √† ce stade ce qui se passe vous semble incompr√©hensible - ne vous inqui√©tez pas - continuez √† lire, essayez de travailler avec ce qui est discut√©, et progressivement vous le comprendrez.  En fait, si nous parlons de formation en informatique, l'approche ¬´descendante¬ª est utilis√©e ici, lorsque les id√©es g√©n√©rales sont d'abord discut√©es, puis la transition vers les d√©tails est effectu√©e. <br><br>  Voici √† quoi ressemble le code du gestionnaire d'itin√©raire. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> router = express.Router() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CustomError = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../CustomError'</span></span>) router.use(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (req, res) =&gt; {   <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {       <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> route = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">`.</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${req.path}</span></span></span><span class="hljs-string">`</span></span>)[req.method]       <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {           <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = route(req) <span class="hljs-comment"><span class="hljs-comment">//    route           res.send(result) //   ,     route       } catch (err) {           /*                ,    route             */           if (err instanceof CustomError) {               /*                   -                                  */               return res.status(err.status).send({                   error: err.code,                   description: err.message,               })           } else {               console.error(err) //                  //   -                   return res.status(500).send({                   error: 'GENERIC',                   description: 'Something went wrong. Please try again or contact support.',               })           }       }   } catch (err) {       /*          ,    ,  ,            ,  ,          ,                       */       res.status(404).send({           error: 'NOT_FOUND',           description: 'The resource you tried to access does not exist.',       })   } }) module.exports = router</span></span></code> </pre> <br>  Nous pensons que les commentaires dans le code l'expliquent assez bien.  Nous esp√©rons que leur lecture est plus pratique que les explications d'un tel code donn√©es apr√®s. <br><br>  Jetez maintenant un ≈ìil au fichier d'itin√©raire. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CustomError = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../CustomError'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> GET = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-comment"><span class="hljs-comment">//       return { name: 'Rio de Janeiro' } } const POST = req =&gt; {   //       throw new Error('Some unexpected error, may also be thrown by a library or the runtime.') } const DELETE = req =&gt; {   //  ,      throw new CustomError('CITY_NOT_FOUND', 404, 'The city you are trying to delete could not be found.') } const PATCH = req =&gt; {   //      CustomError   try {       //   -        throw new Error('Some internal error')   } catch (err) {       console.error(err) //    ,           throw new CustomError(           'CITY_NOT_EDITABLE',           400,           'The city you are trying to edit is not editable.'       )   } } module.exports = {   GET,   POST,   DELETE,   PATCH, }</span></span></code> </pre> <br>  Dans ces exemples, rien n'est fait avec les requ√™tes elles-m√™mes.  Il consid√®re simplement diff√©rents sc√©narios de survenance d'erreurs.  Ainsi, par exemple, la requ√™te <code>GET /city</code> tombera dans la fonction <code>const GET = req =&gt;...</code> , la <code>POST /city</code> tombera dans la fonction <code>const POST = req =&gt;...</code> et ainsi de suite.  Ce sch√©ma fonctionne √©galement lors de l'utilisation des param√®tres de requ√™te.  Par exemple, pour une demande du formulaire <code>GET /city?startsWith=R</code>  En g√©n√©ral, il a √©t√© d√©montr√© ici que lors du traitement des erreurs, le frontend peut obtenir soit une erreur g√©n√©rale contenant uniquement une offre pour r√©essayer ou contacter le propri√©taire du serveur, soit une erreur g√©n√©r√©e √† l'aide du constructeur <code>CustomError</code> qui contient des informations d√©taill√©es sur le probl√®me. <br>  Les donn√©es d'erreur g√©n√©rales seront transmises √† la partie client de l'application sous la forme suivante: <br><br><pre> <code class="javascript hljs">{   <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-string"><span class="hljs-string">'GENERIC'</span></span>,   <span class="hljs-attr"><span class="hljs-attr">description</span></span>: <span class="hljs-string"><span class="hljs-string">'Something went wrong. Please try again or contact support.'</span></span> }</code> </pre> <br>  Le constructeur <code>CustomError</code> est utilis√© comme ceci: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomError(<span class="hljs-string"><span class="hljs-string">'MY_CODE'</span></span>, <span class="hljs-number"><span class="hljs-number">400</span></span>, <span class="hljs-string"><span class="hljs-string">'Error description'</span></span>)</code> </pre> <br>  Cela donne le code JSON suivant transmis au frontend: <br><br><pre> <code class="javascript hljs">{   <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-string"><span class="hljs-string">'MY_CODE'</span></span>,   <span class="hljs-attr"><span class="hljs-attr">description</span></span>: <span class="hljs-string"><span class="hljs-string">'Error description'</span></span> }</code> </pre> <br>  Maintenant que nous avons minutieusement travaill√© sur la partie serveur de l'application, les journaux d'erreurs inutiles ne tombent plus dans la partie client.  Au lieu de cela, le client re√ßoit des informations utiles sur ce qui s'est mal pass√©. <br><br>  N'oubliez pas que se trouve <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> le r√©f√©rentiel avec le code consid√©r√© ici.  Vous pouvez le t√©l√©charger, l'exp√©rimenter et, si n√©cessaire, l'adapter aux besoins de votre projet. <br><br><h2>  <font color="#3AC1EF">3. Travailler avec des erreurs sur le client</font> </h2><br>  Il est maintenant temps de d√©crire la troisi√®me partie de notre syst√®me frontal de gestion des erreurs.  Ici, il sera n√©cessaire, d'une part, de g√©rer les erreurs qui se produisent dans la partie cliente de l'application, et d'autre part, il sera n√©cessaire d'informer l'utilisateur des erreurs qui se produisent sur le serveur.  Nous allons d'abord traiter de l'affichage des informations d'erreur du serveur.  Comme d√©j√† mentionn√©, la biblioth√®que React sera utilis√©e dans cet exemple. <br><br><h3>  <font color="#3AC1EF">‚ñçEnregistrer les informations d'erreur dans l'√©tat de l'application</font> </h3><br>  Comme toutes les autres donn√©es, les erreurs et les messages d'erreur peuvent changer, il est donc logique de les mettre dans l'√©tat des composants.  Lorsque le composant est mont√©, les donn√©es d'erreur sont r√©initialis√©es. Par cons√©quent, lorsque l'utilisateur voit la page pour la premi√®re fois, aucun message d'erreur ne s'affiche. <br><br>  La prochaine chose √† traiter est que les erreurs du m√™me type doivent √™tre affich√©es dans le m√™me style.  Par analogie avec le serveur, on distingue ici 3 types d'erreurs. <br><br><ol><li>  Erreurs globales - cette cat√©gorie comprend les messages d'erreur g√©n√©raux provenant du serveur ou des erreurs qui, par exemple, se produisent si l'utilisateur n'est pas connect√© au syst√®me dans d'autres situations similaires. </li><li>  Erreurs sp√©cifiques g√©n√©r√©es par le c√¥t√© serveur de l'application - cela inclut les erreurs signal√©es par le serveur.  Par exemple, une erreur similaire se produit si un utilisateur tente de se connecter et envoie un nom d'utilisateur et un mot de passe au serveur, et que le serveur l'informe que le mot de passe est incorrect.  Ces √©l√©ments ne sont pas v√©rifi√©s dans la partie client de l'application, les messages sur ces erreurs doivent donc provenir du serveur. </li><li>  Erreurs sp√©cifiques g√©n√©r√©es par la partie client de l'application.  Un exemple d'une telle erreur est un message sur une adresse e-mail non valide entr√©e dans le champ correspondant. </li></ol><br>  Les erreurs des deuxi√®me et troisi√®me types sont tr√®s similaires, vous pouvez les utiliser en utilisant le magasin d'√©tat des composants du m√™me niveau.  Leur principale diff√©rence est qu'ils proviennent de diff√©rentes sources.  Ci-dessous, en analysant le code, nous verrons comment travailler avec eux. <br><br>  Il utilisera le syst√®me int√©gr√© pour g√©rer l'√©tat de l'application dans React, mais, si n√©cessaire, vous pouvez utiliser des solutions sp√©cialis√©es pour g√©rer l'√©tat - telles que MobX ou Redux. <br><br><h3>  <font color="#3AC1EF">‚ñç Erreurs globales</font> </h3><br>  En r√®gle g√©n√©rale, ces messages d'erreur sont stock√©s dans le composant de plus haut niveau avec un √©tat.  Ils sont affich√©s dans un √©l√©ment d'interface utilisateur statique.  Cela peut √™tre une bo√Æte rouge en haut de l'√©cran, une fen√™tre modale ou autre chose.  La mise en ≈ìuvre d√©pend du projet sp√©cifique.  Voici √† quoi ressemble le message d'erreur. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1fb/5d9/c43/1fb5d9c436f66a99bd3b14d07f543740.jpg"></div><br>  <i><font color="#999999">Message d'erreur global</font></i> <br><br>  Jetez maintenant un ≈ìil au code qui est stock√© dans le fichier <code>Application.js</code> . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { Component } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> GlobalError <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./GlobalError'</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(props) {       <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(props)       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = {           <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>,       }       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._resetError = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._resetError.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._setError = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._setError.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)   }   render() {       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (           <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">               </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">GlobalError</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">error</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.state.error}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">resetError</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this._resetError}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">               </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Handling Errors</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">           </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">       )   }   _resetError() {       this.setState({ error: '' })   }   _setError(newError) {       this.setState({ error: newError })   } } export default Application</span></span></code> </pre> <br>  ,  ,  <code>Application.js</code> ,      .  ,           . <br><br>         <code>GlobalError</code> ,                  <code>x</code>  ,   .    <code>GlobalError</code> ( <code>GlobalError.js</code> ). <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { Component } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GlobalError</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{   render() {       <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.error) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (           <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">               </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{{</span></span></span></span><span class="xml"><span class="hljs-tag">                   </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">position:</span></span></span></span><span class="xml"><span class="hljs-tag"> '</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">fixed</span></span></span></span><span class="xml"><span class="hljs-tag">',                   </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">top:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">,                   </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">left:</span></span></span></span><span class="xml"><span class="hljs-tag"> '</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">50</span></span></span></span><span class="xml"><span class="hljs-tag">%',                   </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">transform:</span></span></span></span><span class="xml"><span class="hljs-tag"> '</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">translateX</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-50</span></span></span></span><span class="xml"><span class="hljs-tag">%)',                   </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">padding:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">10</span></span></span></span><span class="xml"><span class="hljs-tag">,                   </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">backgroundColor:</span></span></span></span><span class="xml"><span class="hljs-tag"> '#</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ffcccc</span></span></span></span><span class="xml"><span class="hljs-tag">',                   </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">boxShadow:</span></span></span></span><span class="xml"><span class="hljs-tag"> '</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">3px</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">25px</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-10px</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">rgba</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0.5</span></span></span></span><span class="xml"><span class="hljs-tag">)',                   </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">display:</span></span></span></span><span class="xml"><span class="hljs-tag"> '</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">flex</span></span></span></span><span class="xml"><span class="hljs-tag">',                   </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">alignItems:</span></span></span></span><span class="xml"><span class="hljs-tag"> '</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">center</span></span></span></span><span class="xml"><span class="hljs-tag">',               }}           &gt;</span></span></span><span class="xml">               {this.props.error}                              </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">i</span></span></span></span><span class="xml"><span class="hljs-tag">                   </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"material-icons"</span></span></span></span><span class="xml"><span class="hljs-tag">                   </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">cursor:</span></span></span></span><span class="xml"><span class="hljs-tag"> '</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pointer</span></span></span></span><span class="xml"><span class="hljs-tag">' }}                   </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.props.resetError}</span></span></span></span><span class="xml"><span class="hljs-tag">               &gt;</span></span></span><span class="xml">                   close               </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">font</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">i</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>           &lt;<span class="hljs-regexp"><span class="hljs-regexp">/div&gt;       )   } } export default GlobalError</span></span></code> </pre> <br>     <code>if (!this.props.error) return null</code> .    ,        .        . , ,  ,        . ,  ,       <code>x</code> ,   -   ,       . <br><br> ,        ,       <code>_setError</code>  <code>Application.js</code> . ,      ,  ,    ,      ( <code>error: 'GENERIC'</code> ).   ( <code>GenericErrorReq.js</code> ). <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { Component } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> axios <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'axios'</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GenericErrorReq</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(props) {       <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(props)       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._callBackend = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._callBackend.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)   }   render() {       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (           <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">               </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this._callBackend}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Click me to call the backend</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">           </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>       )   }   _callBackend() {       axios           .post(<span class="hljs-string"><span class="hljs-string">'/api/city'</span></span>)           .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function"> =&gt;</span></span> {               <span class="hljs-comment"><span class="hljs-comment">//  -     ,               })           .catch(err =&gt; {               if (err.response.data.error === 'GENERIC') {                   this.props.setError(err.response.data.description)               }           })   } } export default GenericErrorReq</span></span></code> </pre> <br>   ,            .          ,       ,        .          . -,         ,  -,    UX-,        ,    ‚Äî . <br><br><h3> <font color="#3AC1EF">‚ñç  ,    </font> </h3><br>      ,    ,        ,   . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dee/2f6/bd1/dee2f6bd1605d89c082a46f6feaa86b6.jpg"></div><br> <i><font color="#999999">   </font></i> <br><br>     ,        .           .          .    <code>SpecificErrorReq.js</code> . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { Component } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> axios <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'axios'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> InlineError <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./InlineError'</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SpecificErrorRequest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(props) {       <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(props)       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = {           <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>,       }       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._callBackend = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._callBackend.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)   }   render() {       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (           <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">               </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this._callBackend}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Delete your city</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">               </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">InlineError</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">error</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.state.error}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">           </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">       )   }   _callBackend() {       this.setState({           error: '',       })       axios           .delete('/api/city')           .then(result =&gt; {               //  -     ,               })           .catch(err =&gt; {               if (err.response.data.error === 'GENERIC') {                   this.props.setError(err.response.data.description)               } else {                   this.setState({                       error: err.response.data.description,                   })               }           })   } } export default SpecificErrorRequest</span></span></code> </pre> <br>   ,      , ,      <code>x</code> . ,         ,     .   ,     ,  ‚Äî   ,    ,  ,    .        , ,    .       ,      ,       ,   ‚Äî     . <br><br><h3> <font color="#3AC1EF">‚ñç,     </font> </h3><br>    ,            ,        ,   . ,                ,       - .            . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/532/553/2f5/5325532f59efd4ff9ad92e2a33209d9f.jpg"></div><br> <i><font color="#999999">   ,     </font></i> <br><br>    <code>SpecificErrorFrontend.js</code> ,   . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { Component } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> axios <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'axios'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> InlineError <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./InlineError'</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SpecificErrorRequest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(props) {       <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(props)       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = {           <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>,           <span class="hljs-attr"><span class="hljs-attr">city</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>,       }       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._callBackend = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._callBackend.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._changeCity = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._changeCity.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)   }   render() {       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (           &lt;div&gt;               &lt;input                   type="text"                   value={this.state.city}                   style={{ marginRight: 15 }}                   onChange={this._changeCity}               /&gt;               &lt;button onClick={this._callBackend}&gt;Delete your city&lt;/button&gt;               &lt;InlineError error={this.state.error} /&gt;           &lt;/div&gt;       )   }   _changeCity(e) {       this.setState({           error: '',           city: e.target.value,       })   }   _validate() {       if (!this.state.city.length) throw new Error('Please provide a city name.')   }   _callBackend() {       this.setState({           error: '',       })       try {           this._validate()       } catch (err) {           return this.setState({ error: err.message })       }       axios           .delete('/api/city')           .then(result =&gt; {               //  -     ,               })           .catch(err =&gt; {               if (err.response.data.error === 'GENERIC') {                   this.props.setError(err.response.data.description)               } else {                   this.setState({                       error: err.response.data.description,                   })               }           })   } } export default SpecificErrorRequest</code> </pre> <br><h3> <font color="#3AC1EF">‚ñç       </font> </h3><br> ,      ,      ( <code>GENERIC</code> ),        ,   .   , ,      , ,  ,    ,   ,   ,           .                 . <br><br><h2>  <font color="#3AC1EF">R√©sum√©</font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous esp√©rons que vous comprenez maintenant comment g√©rer les erreurs dans les applications Web. </font><font style="vertical-align: inherit;">Quelque chose comme √ßa </font></font><code>console.error(err)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne devrait √™tre utilis√© qu'√† des fins de d√©bogage, de telles choses oubli√©es par le programmeur ne devraient pas p√©n√©trer dans la production. </font><font style="vertical-align: inherit;">Simplifie la solution au probl√®me de la journalisation √† l'aide d'une biblioth√®que appropri√©e comme </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loglevel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chers lecteurs! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment g√©rez-vous les erreurs dans vos projets?</font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr431078/">https://habr.com/ru/post/fr431078/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr431068/index.html">L'art de l'√©ducation: l'id√©ologie des machines √† sous</a></li>
<li><a href="../fr431070/index.html">Hara mange? Nous parlons des habitudes alimentaires d'un sp√©cialiste informatique moderne</a></li>
<li><a href="../fr431072/index.html">Guide JavaScript partie 7: mode strict, ce mot-cl√©, √©v√©nements, modules, math√©matiques</a></li>
<li><a href="../fr431074/index.html">Guide JavaScript Partie 8: Pr√©sentation des fonctionnalit√©s d'ES6</a></li>
<li><a href="../fr431076/index.html">Les frameworks Node.js les plus populaires de 2018</a></li>
<li><a href="../fr431080/index.html">Comment organiser des bureaux distants et ne pas perdre une √©quipe dans l'espace</a></li>
<li><a href="../fr431082/index.html">Kotlin: √† la recherche d'un responsable marketing</a></li>
<li><a href="../fr431084/index.html">Dans toute situation incompr√©hensible - √©crire des scripts</a></li>
<li><a href="../fr431086/index.html">Tout ce que vous vouliez savoir sur PVS-Studio et n'h√©sitez pas √† demander</a></li>
<li><a href="../fr431088/index.html">La gestion des fichiers a mal tourn√© - Partie 1: √† l'origine des ann√©es 90</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>