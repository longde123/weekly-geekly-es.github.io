<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçüé§ üë®üèΩ‚Äç‚úàÔ∏è üëÅÔ∏è Monitoramento por SMS do peso de tr√™s colmeias por US $ 35 ‚ÜóÔ∏è üöè üë®üèø‚Äç‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="J√° faz um bom tempo desde a publica√ß√£o anterior sobre o sistema por US $ 30 . 


 O que mudou no √∫ltimo m√™s lunar? 


1. Uma bateria solar foi adicion...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Monitoramento por SMS do peso de tr√™s colmeias por US $ 35</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448274/"><p><img src="https://habrastorage.org/getpro/habr/post_images/77d/797/12a/77d79712a55957a17ca74a0995a7844d.jpg" alt="Newbee"></p><br><p>  J√° faz um bom tempo desde a publica√ß√£o anterior <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sobre o sistema por US $ 30</a> . </p><br><p>  O que mudou no √∫ltimo m√™s lunar? </p><br><ol><li>  Uma bateria solar foi adicionada - o tempo de opera√ß√£o √© quase ilimitado. </li><li>  Adicionado o envio de informa√ß√µes em uma chamada. </li><li>  A capacidade de trabalhar com todos os tipos de m√≥dulos de comunica√ß√£o que surgiram em minha opini√£o - AiThinker, Goouu tech, SIM800 / 900, Neoway M590 * </li></ol><br><p>  Mas o mais importante √© que agora o m√≥dulo de comunica√ß√£o e o microcontrolador est√£o fisicamente separados, o que elimina a interfer√™ncia em sua opera√ß√£o com o HX711. </p><br><p>  E tudo isso gra√ßas √†s cr√≠ticas construtivas dos moradores e apicultores de Habrovsk, que se juntaram √† discuss√£o do sistema. </p><br><p>  O restante das caracter√≠sticas de desempenho permaneceu o mesmo - o peso m√°ximo das colmeias √© de 200 kg, ap√≥s a medi√ß√£o do p√¥r-do-sol e os indicadores s√£o enviados. </p><br><p>  Antecipando cr√≠ticas sobre o n√£o uso dos modos de suspens√£o e linhas de sinal adicionais dos m√≥dulos GSM, direi o seguinte: </p><br><p>  Cada m√≥dulo de comunica√ß√£o tem suas pr√≥prias especificidades - algumas adormecem com um n√≠vel de sinal baixo, outras com um n√≠vel alto, outras com um toque duplo. </p><br><p>  As especificidades de "fa√ßa voc√™ mesmo" implicam uma certa parte criativa e vale a pena mostr√°-la aqui. </p><br><p>  Tamb√©m fiz um sistema de olho no desenvolvimento adicional de monitoramento de outros par√¢metros da colm√©ia, onde o sono n√£o √© particularmente necess√°rio. </p><br><p>  Em geral, no quadro de t√≠tulos - <del>  android puro </del>  sistema b√°sico a partir do qual voc√™ pode dan√ßar em qualquer lugar com o design e o n√∫mero / conjunto de sensores, m√≥dulos, etc. </p><br><p>  Este artigo √© sobre escalas e, sob o corte, minha vis√£o pessoal e implementa√ß√£o do sistema. </p><br><p>  Em uma palavra - BEM-VINDO!  Vamos l√°! </p><a name="habracut"></a><br><p>  Para come√ßar, esse sistema n√£o dorme ... de jeito nenhum, porque uma bateria solar de duas c√©lulas de 6 volts produz 5 volts e at√© cem miliamperes, mesmo em tempo nublado. </p><br><p>  E o consumo de todo o sistema √© 17mA, no modo de espera (no padr√£o GSM1800) e cerca de trinta no GSM900. </p><br><p>  Al√©m disso, como j√° mencionado, isso foi feito com o objetivo de implementar fun√ß√µes de monitoramento adicionais em tempo real (um enxame, por exemplo, pode sair em 5 minutos) - n√£o h√° tempo para dormir ;-) </p><br><p>  Voc√™ deseja economia absoluta de energia, por isso ser√° na pr√≥xima publica√ß√£o, mas ser√° completamente diferente <del>  a hist√≥ria </del>  o sistema. </p><br><h4 id="da-esche-po-povodu-snoski-o-modulyah-svyazi---ne-to-chtoby-ya-stal-adeptom-aithinker-prosto-neoway-nuzhno-esche-samomu-sobirat-a-moduli-sim800l-trebuyut-otdelnoy-stati-s-likbezom-po-rabote-s-nimi">  * Sim, no que diz respeito √† nota de rodap√© sobre os m√≥dulos de comunica√ß√£o, n√£o √© que eu me tornei adepto do AiThinker, s√≥ preciso montar a Neoway pessoalmente, e os m√≥dulos SIM800L exigem um artigo separado com programa educacional sobre como trabalhar com eles. </h4><br><p>  Em uma palavra, os GSMs selecionados s√£o IMHO, os √∫nicos que podem trabalhar em 4 fios, incluindo energia, sem dan√ßas adicionais com pandeiros. </p><br><p>  Vamos precisar do seguinte conjunto de equipamentos / materiais: </p><br><ol><li>  Arduino Pro Mini 3V <br>  Voc√™ deve prestar aten√ß√£o ao microchip do conversor linear - ele deve ser exatamente 3,3V - no chip de marca√ß√£o KB 33 / LB 33 / DE A10 - os chineses misturaram algo comigo e todo o lote <br>  as placas de circuito na loja eram de reguladores de 5 volts e quartzo de 16 MHz. </li><li>  USB-Ttl em um chip CH340 - voc√™ pode at√© 5 volts, mas, durante o firmware do microcontrolador, o Arduino precisar√° ser desconectado do m√≥dulo GSM, para n√£o queimar o √∫ltimo. <br>  As placas no chip PL2303 n√£o funcionam no Windows 10. </li><li>  M√≥dulo de comunica√ß√£o GSM Goouu Tech IOT GA-6-B ou AI-THINKER A-6 Mini. </li><li>  Antena GSM GPRS "YG-01" <br><img src="https://habrastorage.org/getpro/habr/post_images/ff7/aa9/69e/ff7aa969e86e53e60122bcdb2ca47c04.jpg"><br>  Como eles alcan√ßaram esse aumento - um enigma - talvez isso seja relativo √† completa aus√™ncia dele ;-). </li><li>  Pacote inicial para um operador com boa cobertura no local do seu api√°rio. <br>  Sim, o pacote deve primeiro ser ativado em um telefone comum, DESATIVAR o PEDIDO DE PIN na entrada e reabastecer a conta. </li><li>  fio dupont 20cm m√£e m√£e - 4 unid.  (para conectar o Arduino ao USB-TTL) </li><li>  3pcs  HX711 - ADC para balan√ßas </li><li>  6 c√©lulas de carga com peso at√© 50 kg </li><li>  15 metros de cabo telef√¥nico de 4 n√∫cleos - para conectar m√≥dulos de peso e GSM ao ARDUINO. </li><li>  Fotoresistor GL5528 (isto √© importante, com uma resist√™ncia escura de 1MOhm e uma resist√™ncia √† luz de 10-20kOhm). </li><li>  dois pares de fichas e tomadas 6P6C - telefone, tomadas - com "rabos" </li><li>  Fita dupla face de 50 cm com 10 mm de largura - para conectar o painel solar √† carca√ßa do m√≥dulo GSM. </li><li>  Placa do carregador baseada em TP4056 para baterias LiIon </li><li>  O suporte da bateria 18650 e, de fato, a pr√≥pria bateria. </li><li>  Um pouco de cera ou parafina (vela de tablet com l√¢mpada de aroma) - para prote√ß√£o contra umidade HX711 </li><li>  Um peda√ßo de viga de madeira 25x50x300mm para a base das c√©lulas de carga. </li><li>  Uma d√∫zia de parafusos autorroscantes com uma arruela de press√£o de 4,2x19 mm para montar sensores na base. </li><li>  Bateria solar de 5-6V 2W (n√£o havia no pr√≥ximo mago do r√°dio - tomei dois watts simples e um par de diodos 1N4148) <br><img src="https://habrastorage.org/getpro/habr/post_images/397/805/59c/39780559cbbd169641e5371eba3ec8e3.jpg" alt="Vista traseira dos pain√©is"><br>  N√£o h√° corrente reversa atrav√©s do carregador, mas os m√≥dulos solares paralelos devem ser ligados corretamente atrav√©s de diodos </li><li>  Uma caixa para um m√≥dulo de comunica√ß√£o e uma bateria solar (tamanho 60x100mm) - voc√™ pode obter uma distribui√ß√£o adequada de produtos el√©tricos, o meu pl√°stico dos cart√µes de visita 30x60x100 ideais. </li></ol><br><p>  Al√©m disso, ser√£o necess√°rias m√£os tortas, ferro de solda EPSN-25, resina e solda POS-60. </p><br><p>  Para carpintaria, uma serra para madeira / metal, um form√£o e uma broca com uma broca de 3 mm s√£o suficientes. </p><br><p>  O layout do sistema √© o seguinte: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d34/875/ffc/d34875ffca19e80ac4658a8e439f749e.jpg" alt="Layout"></p><br><p>  Em qualquer caso, voc√™ n√£o deve colocar o m√≥dulo GSM a menos de um metro do Arduino - com uma alta pot√™ncia de sinal no padr√£o GSM900, isso pode causar a reinicializa√ß√£o do microcontrolador! </p><br><p>  Bem, o m√≥dulo de comunica√ß√£o com a bateria solar - deve ser instalado em um poste - e a recep√ß√£o ser√° melhor e mais distante das abelhas. </p><br><p>  Agora vamos come√ßar a montagem: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/eba/218/027/eba21802786557630e811458e9a07eaa.jpg" alt="GSM A6"></p><br><p>  Para iniciantes, dois LEDs s√£o soldados no m√≥dulo GSM (o local em que foram circulados em um oval laranja). </p><br><p>  N√≥s inserimos o cart√£o SIM com os blocos na placa de circuito impresso, o canto chanfrado da foto √© indicado pela seta. </p><br><p>  Al√©m disso, a bateria e o fio que vai para o controlador s√£o soldados diretamente no capacitor (4). </p><br><p>  O fato √© que o pr√≥prio m√≥dulo de comunica√ß√£o requer 3,4-4,2V para sua fonte de alimenta√ß√£o e seu contato PWR √© conectado a um conversor abaixador, de modo que a opera√ß√£o com tens√£o de √≠on de l√≠tio deve ser aplicada ignorando esta parte do circuito. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b89/f94/1c2/b89f941c27d96e91f2d7ec3c970e453d.jpg" alt="Arduino Pro Mini 3v"></p><br><p>  Em seguida, realizamos um procedimento semelhante com o LED na placa Arduino (o oval √† direita do chip quadrado). </p><br><p>  Soldamos o pente em quatro contatos (1), sempre na horizontal - ao longo do quadro. </p><br><p>  Encurtamos as pernas do fotoresistor para 10 mm e a soldamos com condutores de 20 cm aos terminais GND e D2 da placa (2). </p><br><p>  N√≥s fornecemos energia atrav√©s de um conversor linear - em correntes baixas, a queda de tens√£o de abandono √© de 0.1V. </p><br><p>  Mas, ao aplicar tens√£o estabilizada aos m√≥dulos HX711, eliminamos a necessidade de refin√°-los sob uma tens√£o mais baixa (e ao mesmo tempo aumentamos o ru√≠do como resultado dessa opera√ß√£o). </p><br><p>  Agora voc√™ precisa pegar 5 metros de cabo telef√¥nico de quatro fios e soldar entre o microcontrolador e o m√≥dulo de comunica√ß√£o, conforme o diagrama no in√≠cio do artigo (as cores dos fios correspondem √† realidade). </p><br><p>  Tamb√©m soldamos o suporte da bateria, faremos o resto um pouco mais tarde. </p><br><p>  E agora, por algum tempo, nos desviamos do ferro de soldar e passamos √† parte do software. <br>  Vou descrever a sequ√™ncia de a√ß√µes para o Windows: <br>  Primeiro, voc√™ precisa baixar e instalar / descompactar o programa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">IDE</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Arduino</a> - a vers√£o atual √© 1.8.9, mas eu uso o 1.6.4 </p><br><p>  Por uma quest√£o de simplicidade, descompactamos o arquivo na pasta C: \ arduino- "your_version_number", onde teremos / dist, drivers, exemplos, hardware, java, lib, bibliotecas, refer√™ncias, pastas de ferramentas, al√©m do arquivo execut√°vel do arduino (entre outros). </p><br><p>  Agora precisamos de uma biblioteca para trabalhar com o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">HX711</a> ADC - o bot√£o verde "clonar ou baixar" - fa√ßa o download do ZIP. </p><br><p>  O conte√∫do (pasta HX711-master) √© colocado no diret√≥rio C: \ arduino- "your_version_number" \ library </p><br><p>  E, √© claro, o driver do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">USB-TTL √©</a> do mesmo github - do arquivo descompactado, o arquivo SETUP do instalador √© simplesmente iniciado. </p><br><p>  Para aqueles que relutam em se incomodar com as bibliotecas, empacotei minha montagem do programa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">IDE</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Arduino</a> - basta baixar e descompact√°-lo. </p><br><p>  Iniciamos e configuramos o programa C: \ arduino- "your_version_number" \ arduino </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/2fd/429/2d5/2fd4292d54f67c31052b54ca853be5b3.jpg" alt="Interface do programa"></p><br><p>  Vamos para o item "Ferramentas" - selecione a placa "Arduino Pro ou Pro Mini", o processador Atmega 328 3.3V 8 MHz, a porta √© o n√∫mero diferente do COM1 do sistema (ele aparece ap√≥s a instala√ß√£o do driver CH340 com o adaptador USB-TTL conectado). </p><br><p>  Ok, copie o seguinte esbo√ßo (programa) e cole-o na janela do IDE do Arduino </p><br><pre><code class="plaintext hljs">char phone_no[]="+123456789012"; // Your phone number that receive SMS with counry code // NeverSleep #include &lt;SoftwareSerial.h&gt; // Sofrware serial library #include "HX711.h" // HX711 lib. https://github.com/bogde/HX711 #include &lt;EEPROM.h&gt; // EEPROM lib. HX711 scale0(10, 14); HX711 scale1(11, 14); HX711 scale2(12, 14); #define SENSORCNT 3 HX711 *scale[SENSORCNT]; SoftwareSerial mySerial(5, 4); // Set I/O-port TXD, RXD of GSM-shield float delta00; // delta weight from start float delta10; float delta20; float delta01; // delta weight from yesterday float delta11; float delta21; float raw00; //raw data from sensors on first start float raw10; float raw20; float raw01; //raw data from sensors on yesterday float raw11; float raw21; float raw02; //actual raw data from sensors float raw12; float raw22; word calibrate0=20880; //calibration factor for each sensor word calibrate1=20880; word calibrate2=20880; word daynum=0; //numbers of day after start int notsunset=0; boolean setZero=false; boolean forceSend=false; char ch = 0; char ch1 = 0; char ch2 = 0; char ch3 = 0; char ch4 = 0; void readVcc() // read battery capacity { ch = mySerial.read(); while (mySerial.available() &gt; 0) { ch = mySerial.read(); } // empty input buffer from modem mySerial.println("AT+CBC?"); //ask gprs for battery status (for sim800 and neoway command must be "AT+CBC" ) delay(200); while (mySerial.available() &gt; 0) { //read input string between coma and CR ch = mySerial.read(); if (ch ==','){ ch1 = mySerial.read(); ch2 = mySerial.read(); ch3 = mySerial.read(); ch4 = mySerial.read(); } } } // ********************************************************************** void SendStat() { detachInterrupt(digitalPinToInterrupt(0)); // turn off external interrupt digitalWrite(13, HIGH); if (!forceSend){ notsunset=0; for (int i=0; i &lt;= 250; i++){ if ( !digitalRead(2) ){ notsunset++; } //is a really sunset now? you shure? delay(360); } } if ( notsunset==0 || forceSend ) { raw01=raw02; raw11=raw12; raw21=raw22; raw02=scale0.get_units(16); //read data from scales raw12=scale1.get_units(16); raw22=scale2.get_units(16); daynum++; delta00=(raw02-raw00)/calibrate0; // calculate weight changes delta01=(raw02-raw01)/calibrate0; delta10=(raw12-raw10)/calibrate1; delta11=(raw12-raw11)/calibrate1; delta20=(raw22-raw20)/calibrate2; delta21=(raw22-raw21)/calibrate2; readVcc(); delay(200); mySerial.println("AT+CMGF=1"); // Part of SMS sending delay(2000); mySerial.print("AT+CMGS=\""); mySerial.print(phone_no); mySerial.write(0x22); mySerial.write(0x0D); // hex equivalent of Carraige return mySerial.write(0x0A); // hex equivalent of newline delay(2000); mySerial.print("Turn "); mySerial.println(daynum); mySerial.print("Hive1 "); mySerial.print(delta01); mySerial.print(" "); mySerial.println(delta00); mySerial.print("Hive2 "); mySerial.print(delta11); mySerial.print(" "); mySerial.println(delta10); mySerial.print("Hive3 "); mySerial.print(delta21); mySerial.print(" "); mySerial.println(delta20); mySerial.print("Battery capacity is "); mySerial.print(ch1); mySerial.print(ch2); mySerial.print(ch3); mySerial.print(ch4); mySerial.println(" %"); if (forceSend) {mySerial.print("Forced SMS");} mySerial.println (char(26));//the ASCII code of the ctrl+z is 26 delay(3000); } forceSend=false; digitalWrite(13, LOW); attachInterrupt(0, SendStat , RISING); // Interrupt by HIGH level } // ************************************************************************************************* void switchto9600() { mySerial.begin(115200); // Open software serial port delay(16000); // wait for boot mySerial.println("AT"); delay(200); mySerial.println("AT"); delay(200); mySerial.println("AT+IPR=9600"); // Change Serial Speed delay(200); mySerial.begin(9600); mySerial.println("AT&amp;W0"); delay(200); mySerial.println("AT&amp;W"); } void setup() { // Setup part run once, at start pinMode(13, OUTPUT); // Led pin init pinMode(2, INPUT_PULLUP); // Set pullup voltage Serial.begin(9600); // ------------------------------------------------------------------------------- switchto9600(); // switch module port speed // ------------------------------------------------------------------------------- mySerial.begin(9600); delay(200); scale[0] = &amp;scale0; //init scale scale[1] = &amp;scale1; scale[2] = &amp;scale2; scale0.set_scale(); scale1.set_scale(); scale2.set_scale(); delay(200); setZero=digitalRead(2); //if (EEPROM.read(500)==EEPROM.read(501) || setZero) // first boot/reset with hiding photoresistor if (setZero) { raw00=scale0.get_units(16); //read data from scales raw10=scale1.get_units(16); raw20=scale2.get_units(16); EEPROM.put(500, raw00); //write data to eeprom EEPROM.put(504, raw10); EEPROM.put(508, raw20); for (int i = 0; i &lt;= 24; i++) { //blinking LED13 on reset/first boot digitalWrite(13, HIGH); delay(500); digitalWrite(13, LOW); delay(500); } } else { EEPROM.get(500, raw00); // read data from eeprom after battery change EEPROM.get(504, raw10); EEPROM.get(508, raw20); digitalWrite(13, HIGH); // turn on LED 13 on 12sec. delay(12000); digitalWrite(13, LOW); } delay(200); // Test SMS at initial boot readVcc(); delay(200); mySerial.println("AT+CMGF=1"); delay(2000); mySerial.print("AT+CMGS=\""); mySerial.print(phone_no); mySerial.write(0x22); mySerial.write(0x0D); // hex equivalent of Carraige return mySerial.write(0x0A); // hex equivalent of newline delay(2000); mySerial.println("INITIAL BOOT OK"); mySerial.print("Battery capacity is "); mySerial.print(ch1); mySerial.print(ch2); mySerial.print(ch3); mySerial.print(ch4); mySerial.println(" %"); mySerial.println (char(26));//the ASCII code of the ctrl+z is 26 delay(3000); raw02=raw00; raw12=raw10; raw22=raw20; attachInterrupt(0, SendStat , RISING); // Interrupt by HIGH level } void loop() { digitalWrite(13, LOW); ch=mySerial.read(); if ( ch=='R' ) { //wait first lerrer from "RING" string forceSend=true; mySerial.println("ATH"); SendStat(); ch=' '; } }</code> </pre> <br><p>  Na primeira linha, entre aspas char phone_no [] = "+ 123456789012";  - em vez de 123456789012, colocamos nosso n√∫mero de telefone com o c√≥digo do pa√≠s para o qual o SMS ser√° enviado. </p><br><p>  Clique no bot√£o de verifica√ß√£o (acima do n√∫mero um na captura de tela acima) - se a compila√ß√£o estiver abaixo (abaixo do triplo na captura de tela), poderemos exibir o microcontrolador. </p><br><p>  Portanto, o USB-TTL est√° conectado ao ARDUINO e ao computador (como na foto acima), colocamos a bateria carregada no suporte (geralmente em um novo arduino, o LED come√ßa a piscar uma vez por segundo). </p><br><p>  Agora o firmware - estamos treinando para pressionar o bot√£o vermelho (prateado) do microcontrolador - isso precisar√° ser feito estritamente em um determinado momento !!! </p><br><p>  Existe  Clique no bot√£o "Upload" (acima dos dois na captura de tela) e observe atentamente a linha na parte inferior da interface (nas tr√™s telas). </p><br><p>  Assim que a inscri√ß√£o "compila√ß√£o" for substitu√≠da por "download" - pressione o bot√£o vermelho (redefinir) - se estiver tudo bem - o adaptador USB-TTL pisca com alegria e a inscri√ß√£o "Downloaded" na parte inferior da interface </p><br><p>  Enquanto aguardamos a chegada do SMS de teste no telefone, mostrarei como o programa funciona: </p><br><p>  Na primeira vez em que o sistema √© ligado, ele verifica os bytes 500 e 501 da EEPROM; se eles s√£o iguais, os dados de calibra√ß√£o n√£o foram gravados e o algoritmo prossegue para a se√ß√£o de configura√ß√£o. </p><br><p>  O mesmo acontece se, quando ligado, o fotorresistor estiver sombreado (com uma tampa de uma caneta) - o modo de redefini√ß√£o de par√¢metro √© ativado. </p><br><p>  Os strain gauges j√° devem ser instalados sob as colmeias, pois simplesmente fixamos o n√≠vel inicial de zero e medimos a mudan√ßa de peso (agora os zeros vir√£o, pois ainda n√£o conectamos nada). </p><br><p>  No arduino, o LED embutido do pino 13 pisca. <br>  Se a redefini√ß√£o n√£o ocorrer, o LED acender√° por 12 segundos. <br>  Depois disso, um SMS de teste √© enviado com a mensagem "INICIAL BOOT OK" e a porcentagem de carga da bateria. </p><br><p>  Al√©m disso, temos uma interrup√ß√£o no fotossensor trabalhando no segundo pino (mais a eleva√ß√£o √© ativada pela fun√ß√£o pullup). <br>  Nesse caso, depois de disparar por mais 3 minutos, o estado do fotorresistor √© verificado para excluir positivos repetidos / falsos. <br>  Para impedir que o sistema fa√ßa um reset sempre que for ligado, pelo menos o primeiro m√≥dulo HX711 deve ser conectado (pinos DT-D10, SCK-A0) </p><br><p>  Em seguida, s√£o feitas as leituras das c√©lulas de carga, calculada a altera√ß√£o de peso da opera√ß√£o anterior (o primeiro n√∫mero na linha ap√≥s o Hive) e, desde o primeiro in√≠cio, a tens√£o da bateria √© verificada e essas informa√ß√µes s√£o enviadas na forma de SMS: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c63/a89/992/c63a89992a1311d828e3d9380ba45036.jpg" alt="Sistema de amostra"></p><br><p>  A prop√≥sito, voc√™ recebeu SMS?  Parab√©ns!  Estamos a meio caminho!  Enquanto a bateria puder ser removida do suporte, n√£o precisaremos de mais um computador. </p><br><p>  Prosseguimos na fabrica√ß√£o de sensores, para come√ßar, vamos tocar no layout dos sensores: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/182/43b/cec/18243bcecc904c4018d7b2217cc72d9b.jpg" alt="Localiza√ß√£o do sensor"></p><br><p>  Este √© o plano da colm√©ia. </p><br><p>  Classicamente, 4 sensores s√£o instalados nos cantos (1,2,3,4) </p><br><p>  Vamos medir de forma diferente.  Ou melhor, mesmo no terceiro.  Como os caras do BroodMinder fazem diferente: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b49/fbe/1f3/b49fbe1f378d3e5b4b7320bf6ac83520.jpg" alt="Broodminder"></p><br><p>  Neste projeto, os sensores s√£o instalados nas posi√ß√µes 1 e 2, os pontos 3.4 s√£o baseados na viga. <br>  Ent√£o, apenas metade do peso cai nos sensores. <br>  Sim, esse m√©todo tem menos precis√£o, mas √© dif√≠cil imaginar que as abelhas constru√≠ssem todos os quadros com "l√≠nguas" dos favos de mel ao longo de uma parede da colm√©ia. </p><br><p>  Ent√£o, proponho reduzir os sensores para o ponto 5 completamente - ent√£o n√£o h√° necessidade de proteger o sistema e, ao usar colmeias de luz, √© completamente necess√°rio fazer um sensor. </p><br><p>  Portanto, em uma se√ß√£o, instalaremos duas c√©lulas de carga e um m√≥dulo HX711, o diagrama de fia√ß√£o √© o seguinte: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/6d2/39b/bef/6d239bbef099b427b0f6127a323a7e69.jpg"></p><br><p>  Da placa ADC ao arduino, existem 5 metros de cabo telef√¥nico de 4 n√∫cleos (no caso dos m√≥dulos de peso 2 e 3), o primeiro sensor √© conectado a uma cauda de 10 cm, mas mais sobre isso posteriormente. </p><br><p>  Em geral, nos sensores deixamos "caudas" de 8 cm, limpamos o par tran√ßado e vendemos tudo como na foto acima. </p><br><p>  Antes de iniciar a carpintaria, coloque cera / parafina em um recipiente adequado para derreter em banho-maria. </p><br><p>  Agora pegamos nossa viga e dividimos em tr√™s segmentos de 100 mm </p><br><p>  Em seguida, marque uma ranhura longitudinal de 25 mm de largura e 7-8 mm de profundidade, usando uma serra e um cinzel para remover o excesso - um perfil em forma de u deve sair. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/509/226/d98/509226d98d5b52f993b21c9e6679fc1a.jpg" alt="O b√°sico"></p><br><p>  De fato, precisamos de uma parte 1 e duas em forma de H - P-shki, todas com 10 cm de comprimento. </p><br><p>  Por que N-ka - n√£o acredite, esconda o Arduino nele: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/096/e6b/89d/096e6b89d4442e3bf898be19dae38566.jpg" alt="o milagre da tecnologia hostil"></p><br><p>  Al√©m disso, os soquetes 6P6C para conectar os sensores 2 e 3 tamb√©m est√£o conectados aqui. </p><br><p>  Cera aquecida?  - mergulhamos nossas placas ADC l√° - isso as proteger√° da umidade / n√©voa: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a57/672/7f1/a576727f1b4385933b640b0dd1ef2a01.jpg" alt="Prote√ß√£o ADC contra umidade"></p><br><p>  Temos tudo em uma base de madeira (√© necess√°rio trat√°-lo com um anti-s√©ptico por decomposi√ß√£o): </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a57/a6b/347/a57a6b34743c1f8b8add453e729fadea.jpg" alt="Assembl√©ia"></p><br><p>  E, finalmente, consertamos os sensores com parafusos: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/94d/e43/541/94de435418f3d001e47b181935612e5f.jpg" alt="Sensor pronto"></p><br><p>  Em seguida, soldamos todos os componentes restantes de acordo com o esquema no cabe√ßalho e no senso comum. </p><br><h4 id="v-plane-raspolozheniya-komponentov-zhelatelno-proyavit-fantaziyu-stoit-uchityvat-odno---rasstoyanie-mezhdu-mikrokontrollerom-i-gsm-modulem-dolzhno-sostavlyat-ne-menee-odnogo-metra">  Em termos de localiza√ß√£o dos componentes, √© aconselh√°vel mostrar imagina√ß√£o, uma coisa a considerar - a dist√¢ncia entre o microcontrolador e o m√≥dulo GSM deve ser de pelo menos um metro! </h4><br><p>  Eu tenho o seguinte design: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/828/60b/f5a/82860bf5acb8465591e4fa82f0d284da.jpg" alt="Final"></p><br><p>  Sim, assumi o √¢ngulo de instala√ß√£o dos pain√©is em 45 graus - devido √† simplicidade da fabrica√ß√£o, mas est√° pr√≥ximo dos quarenta graus ideais para o ver√£o na latitude de Kiev. </p><br><p>  √â isso, agora, para a verifica√ß√£o final, coloque os sensores nos setores do c√≠rculo, em cima - um peda√ßo de madeira, zere o controlador (ligue o sistema com a tampa no fotodiodo da caneta-tinteiro). </p><br><p>  Nesse caso, o LED no arduino deve piscar e um SMS de teste deve aparecer. </p><br><p>  Depois removemos a tampa da fotoc√©lula e vamos coletar √°gua em uma garrafa de pl√°stico de 6 litros. <br>  Colocamos a garrafa no compensado e, se j√° passaram alguns minutos de lig√°-la, colocamos a tampa novamente no fotorresistor (simulando o p√¥r do sol). </p><br><p>  Ao mesmo tempo, o LED do arduino acender√° e voc√™ dever√° receber um SMS com um valor de peso de cerca de 4 kg em todas as posi√ß√µes. </p><br><p>  Parab√©ns!  O sistema foi montado com sucesso! </p><br><p>  Se agora fizermos o sistema funcionar novamente, na primeira coluna do peso obteremos zeros. </p><br><p>  Sim, em condi√ß√µes reais, √© desej√°vel orientar o fotorresistor verticalmente para cima. </p><br><p>  Agora vou dar um breve manual sobre o uso de: </p><br><ol><li>  Instale extens√¥metros sob as paredes traseiras das colmeias (sob a frente, substitua uma viga / placa com aproximadamente 30 mm de espessura) </li><li>  Instale um m√≥dulo de comunica√ß√£o com pain√©is solares a uma altitude, a poucos metros das colmeias. <br>  A orienta√ß√£o dos pain√©is solares - para o sul - pode ser calculada (n√£o pegaremos o verdadeiro). </li><li>  Proteja o fotorresistor e coloque a bateria - o LED deve piscar e um SMS de teste com o texto "INICIAL BOOT OK" deve aparecer <br>  Todas as noites, ap√≥s o p√¥r do sol, o SMS chega com uma altera√ß√£o de peso por dia e a partir do momento do lan√ßamento. <br>  Quando voc√™ liga para o n√∫mero do cart√£o SIM do m√≥dulo GSM, o controlador fica fora do gancho (ouvimos ‚ÄúO assinante n√£o pode receber a chamada‚Äù) e o SMS vem com medi√ß√µes extraordin√°rias. <br>  Em tal mensagem, haver√° uma linha adicional - "SMS for√ßado"; </li></ol><br><p>  Resta muito pouco √† beleza completa do sistema: </p><br><ol><li>  Adicione o sistema autom√°tico do dispositivo no fotosensor. </li><li>  Verifique outros tipos de m√≥dulos de comunica√ß√£o. </li><li>  Para fazer tudo sob o ESP-8266 - em primeiro lugar, ele suporta atualiza√ß√µes de firmware "over the air" - √© conveniente. </li></ol><br><p>  Em segundo lugar - ele pode fornecer estat√≠sticas na forma de simples p√°ginas da web. <br>  E, finalmente, se voc√™ possui Wi-Fi, pode recusar completamente o GSM-ki. </p><br><p>  Ah, sim, estou cansado de algo que mexe com os fios e prometi um sistema com economia de energia "absoluta". </p><br><p>  Em uma palavra, eu decidi brincar de "idiota" e fazer tudo. <br>  Quanto sucesso - leia a publica√ß√£o em um m√™s! </p><br><p>  Vejo voc√™ nas p√°ginas da Habr-a, <br>  Apicultor el√©trico Andrey </p><br><p>  PS Para novas publica√ß√µes sobre esse t√≥pico, consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">beefree.xyz</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt448274/">https://habr.com/ru/post/pt448274/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt448264/index.html">Nada de lip√≠dios frios: impedindo a cristaliza√ß√£o da √°gua a -263 ¬∞ C</a></li>
<li><a href="../pt448266/index.html">Telefonou! Como montar seu discador da Web em uma hora</a></li>
<li><a href="../pt448268/index.html">Sistemas de telefone in a box</a></li>
<li><a href="../pt448270/index.html">Alterar as configura√ß√µes do programa enquanto mant√©m as configura√ß√µes pessoais</a></li>
<li><a href="../pt448272/index.html">Por que desativou o avi√£o antes da partida e o que acontecer√° se isso n√£o for feito?</a></li>
<li><a href="../pt448276/index.html">Como o Alfa Bank vive um per√≠odo de mudan√ßa e o que conseguimos fazer ao combinar o desenvolvimento de TI e o Alfa Lab</a></li>
<li><a href="../pt448278/index.html">Hipoteca t√©cnica: o que e a quem a equipe deve</a></li>
<li><a href="../pt448280/index.html">Teste o nanoCAD SPDS Metalwork 1.2. Parte 2</a></li>
<li><a href="../pt448286/index.html">Not√≠cias do mundo do OpenStreetMap n¬∫ 455 (02/04/2019 - 04/04/2019)</a></li>
<li><a href="../pt448288/index.html">Usando C ++ e modelos com um n√∫mero vari√°vel de argumentos ao programar microcontroladores</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>