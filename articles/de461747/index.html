<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçá üöê ü¶ê Wie wir ML in einer Anwendung mit fast 50 Millionen Benutzern implementiert haben. Sberbank Erfahrung ü•É üèΩ üëßüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! Mein Name ist Nikolai und ich besch√§ftige mich mit der Konstruktion und Implementierung von Modellen f√ºr maschinelles Lernen in der Sberba...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie wir ML in einer Anwendung mit fast 50 Millionen Benutzern implementiert haben. Sberbank Erfahrung</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sberbank/blog/461747/">  Hallo Habr!  Mein Name ist Nikolai und ich besch√§ftige mich mit der Konstruktion und Implementierung von Modellen f√ºr maschinelles Lernen in der Sberbank.  Heute werde ich √ºber die Entwicklung eines Empfehlungssystems f√ºr Zahlungen und √úberweisungen in der Anwendung auf Ihrem Smartphone sprechen. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/358/23c/0f8/35823c0f8e513f268f58de291b8504c7.png"></a> <br>  <i>Gestaltung des Hauptbildschirms der mobilen Anwendung mit Empfehlungen</i> <br><br>  Wir hatten zweihunderttausend m√∂gliche Zahlungsoptionen, 55 Millionen Kunden, 5 verschiedene Bankquellen, eine halbe Entwicklers√§ule und einen Berg von Bankaktivit√§ten, Algorithmen und all das, alle Farben sowie einen Liter zuf√§lliger Samen, eine Schachtel Hyperparameter, einen halben Liter Korrekturfaktoren und zwei Dutzende von Bibliotheken.  Nicht, dass dies alles f√ºr die Arbeit notwendig gewesen w√§re, aber da er begann, das Leben der Kunden zu verbessern, gehen Sie Ihrem Hobby bis zum Ende nach.  Unter dem Schnitt steht die Geschichte des Kampfes um UX, die korrekte Formulierung des Problems, der Kampf gegen die Dimension der Daten, der Beitrag zu Open Source und unsere Ergebnisse. <br><br><a name="habracut"></a><br><h2>  Erkl√§rung des Problems </h2><br>  Mit der Entwicklung und Skalierung erh√§lt die Sberbank Online-Anwendung n√ºtzliche Funktionen und zus√§tzliche Funktionen.  Insbesondere k√∂nnen Sie in der Anwendung Geld √ºberweisen oder f√ºr Dienstleistungen verschiedener Organisationen bezahlen. <br><br>  ‚ÄûWir haben alle Benutzerpfade in der Anwendung sorgf√§ltig gepr√ºft und festgestellt, dass viele davon erheblich reduziert werden k√∂nnen.  Zu diesem Zweck haben wir uns entschlossen, den Hauptbildschirm in mehreren Schritten zu personalisieren.  Zuerst haben wir versucht, das, was der Client nicht verwendet, vom Bildschirm zu entfernen, beginnend mit Bankkarten.  Dann haben sie die Aktionen in den Vordergrund ger√ºckt, die der Kunde bereits zuvor ausgef√ºhrt hatte und f√ºr die er jetzt in die Anwendung gehen konnte.  Jetzt umfasst die Liste der Aktionen Zahlungen an Organisationen und √úberweisungen an Kontakte. Dann wird die Liste dieser Aktionen erweitert ‚Äú, sagte mein Kollege Sergey Komarov, der die Funktionalit√§t aus Sicht des Kunden im Sberbank Online-Team entwickelt.  Es ist erforderlich, ein Modell zu erstellen, das die festgelegten Slots in den Aktions-Widgets (Abbildung oben) mit pers√∂nlichen Empfehlungen f√ºr Zahlungen und √úberweisungen anstelle einfacher Regeln f√ºllt. <br><br><h2>  L√∂sung </h2><br>  Wir im Team haben die Aufgabe in zwei Teile zerlegt: <br><br><ul><li>  die Empfehlung der Wiederholung von Operationen zur Bezahlung von Dienstleistungen oder zur √úberweisung von Geldern (Block "Empfohlene Operationen") <br></li><li>  Empfehlung von Beispielen f√ºr Suchanfragen zur Zahlung f√ºr Dienste, die zuvor von diesem Client nicht verwendet wurden (Block ‚ÄûSuchbeispiele‚Äú) <br></li></ul><br>  Wir haben uns entschlossen, die Funktionalit√§t zuerst auf der Registerkarte "Suchen" zu testen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8fe/450/0ee/8fe4500ee0d612b4210a7237a643850b.png"></div><br>  <i>Empfohlenes Design des Suchbildschirms</i> <br><br><h2>  Empfohlene Operationen </h2><br><h3>  Bewertungsoptimierung </h3><br>  Wenn wir die Unteraufgabe als Empfehlung f√ºr die Wiederholung von Vorg√§ngen festlegen, k√∂nnen wir die Berechnung und Auswertung von Billionen von Kombinationen aller m√∂glichen Vorg√§nge f√ºr alle Kunden loswerden und uns auf eine viel geringere Anzahl von Vorg√§ngen konzentrieren.  Wenn der hypothetische Kunde mit dem JJJ-Hash von allen unseren Kunden zur Verf√ºgung stehenden Vorg√§ngen nur die Zahlung f√ºr Benzin und Parken verwendet hat, wird die Wahrscheinlichkeit bewertet, dass nur diese Vorg√§nge f√ºr diesen Kunden wiederholt werden: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/33f/d0e/415/33fd0e4159a1143ff54c6834c0cd964d.png"><br>  <i>Ein Beispiel f√ºr die Reduzierung der Dimension von Daten f√ºr die Bewertung</i> <br><br><h3>  Datensatz vorbereiten </h3><br>  Die Stichprobe ist eine Transaktionsbeobachtung, angereichert mit Faktoren der Kundendemographie, Finanzaggregaten und verschiedenen Frequenzmerkmalen eines bestimmten Vorgangs. <br><br>  Die Zielvariable ist in diesem Fall bin√§r und spiegelt die Tatsache des Ereignisses am Tag nach dem Tag wider, an dem die Faktoren berechnet werden.  Wenn wir also den Tag der Berechnung der Faktoren iterativ verschieben und das Flag der Zielvariablen setzen, multiplizieren und markieren wir dieselben Operationen und markieren sie je nach Position relativ zu diesem Tag unterschiedlich. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/929/618/c8a/929618c8a1fbcf3b2385300bf9669ae3.png"></div><br>  <i>Beobachtungsschema</i> <br><br>  Wenn wir den Schnitt am 17.03.2019 f√ºr den Kunden ‚ÄûJJJ‚Äú berechnen, erhalten wir zwei Beobachtungen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/78b/e70/741/78be707412f6a3fee92dcb5d62413de9.png"></div><br>  <i>Ein Beispiel f√ºr die Beobachtungen f√ºr einen Datensatz</i> <br><br>  "Merkmal 1" kann zum Beispiel das Guthaben auf allen Karten des Kunden bedeuten, "Merkmal 2" - das Vorhandensein dieser Art von Operation in der letzten Woche. <br><br>  Wir nehmen die gleichen Transaktionen vor, bilden jedoch Beobachtungen f√ºr das Training zu einem anderen Zeitpunkt: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/901/c8e/618/901c8e6188d792bb9c77fc207f7d95d1.png"></div><br>  <i>Beobachtungsschema</i> <br><br>  Wir erhalten Beobachtungen f√ºr einen Datensatz mit anderen Werten beider Merkmale und der Zielvariablen: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e99/a4f/060/e99a4f0602c8c127f47aecee38f02292.png"><br>  <i>Ein Beispiel f√ºr die Beobachtungen f√ºr einen Datensatz</i> <br><br>  In den obigen Beispielen sind zur Verdeutlichung die tats√§chlichen Werte der Faktoren angegeben, aber tats√§chlich werden die Werte von einem automatischen Algorithmus verarbeitet: Die Ergebnisse der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">WOE-Konvertierung</a> werden der Eingabe des Modells zugef√ºhrt.  Sie k√∂nnen die Variablen in eine monotone Beziehung zur Zielvariablen bringen und gleichzeitig die Auswirkungen von Ausrei√üern beseitigen.  Zum Beispiel haben wir den Faktor "Anzahl der Karten" und eine Verteilung der Zielvariablen: <br><br><img src="https://habrastorage.org/webt/4z/vz/xt/4zvzxtz04cy0corijvcyz4zfhf0.png"><br><br>  <i>Beispiel f√ºr eine WOE-Konvertierung</i> <br><br>  Die WOE-Transformation erm√∂glicht es uns, eine nichtlineare Abh√§ngigkeit in mindestens eine monotone Abh√§ngigkeit umzuwandeln.  Jeder Wert des analysierten Faktors ist mit einem eigenen WOE-Wert verkn√ºpft, sodass ein neuer Faktor gebildet und der urspr√ºngliche aus dem Datensatz entfernt wird: <br><br><img src="https://habrastorage.org/webt/9j/os/o4/9joso4mjqdpris64sxtrb3ji34k.png"><br>  <i>Die Auswirkung der WOE-Transformation auf die Beziehung zur Zielvariablen</i> <br><br>  Das W√∂rterbuch zum Konvertieren von Variablenwerten in WOE wird gespeichert und sp√§ter f√ºr die Bewertung verwendet.  Das hei√üt, wenn wir die Wahrscheinlichkeiten f√ºr morgen berechnen m√ºssen, erstellen wir einen Datensatz wie in den Tabellen mit Beispielen f√ºr Beobachtungen oben, konvertieren die erforderlichen Variablen mit dem gespeicherten Code in WOE und wenden das Modell auf diese Daten an. <br><br><h3>  Schulung </h3><br>  Die Wahl der Methode war streng begrenzt - Interpretierbarkeit.  Um die Fristen einzuhalten, wurde daher beschlossen, die Erkl√§rungen in der zweiten H√§lfte des Problems mit demselben <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SHAP</a> zu verschieben und relativ einfache Methoden zu testen: Regression und flache Neuronen.  Das Tool war SAS Miner, eine Software zur Vorverarbeitung, Analyse und Erstellung von Modellen f√ºr verschiedene Daten in interaktiver Form, die viel Zeit beim Schreiben von Code spart. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1ae/80d/b3c/1ae80db3c2741d5c70a2cbc9e48dd0ff.png"><br>  <i>SAS Miner-Schnittstelle</i> <br><br><h3>  Qualit√§tsbewertung </h3><br>  Ein Vergleich der GINI-Metrik mit einer Stichprobe au√üerhalb der Zeit ergab, dass das neuronale Netzwerk die Aufgabe am besten bew√§ltigt: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d24/553/e79/d24553e79a193415b2fa94c6e3b0d987.png"></div><br>  <i>Vergleichstabelle von Qualit√§tsmodellen und Frequenzregeln</i> <br><br>  Das Modell hat zwei Austrittspunkte.  Die Empfehlungen in Form von Widgetkarten auf dem Hauptbildschirm umfassen Vorg√§nge, deren Prognose √ºber einem bestimmten Schwellenwert liegt (siehe das erste Bild im Beitrag).  Die Auswahl der Grenze basiert auf einem Gleichgewicht zwischen Qualit√§t und Abdeckung, das in einer solchen Architektur die H√§lfte aller durchgef√ºhrten Operationen ausmacht.  Die Top-4-Vorg√§nge werden an den Block ‚ÄûEmpfohlene Vorg√§nge‚Äú des Suchbildschirms gesendet (siehe zweites Bild). <br><br><h2>  Suchbeispiele </h2><br>  Wenn wir uns dem zweiten Teil der Aufgabe zuwenden, kehren wir zum Problem einer Vielzahl m√∂glicher Zahlungsoptionen f√ºr die Dienste von Anbietern zur√ºck, die innerhalb jedes Kunden bewertet und sortiert werden m√ºssen - Billionen von Paaren.  Dar√ºber hinaus verf√ºgen wir √ºber implizite Daten, dh es gibt keine Informationen √ºber die Bewertung der geleisteten Zahlungen oder dar√ºber, warum der Kunde keine Zahlungen geleistet hat.  Daher wurde zun√§chst beschlossen, verschiedene Methoden zur Erweiterung der Zahlungsmatrix von Kunden zu Anbietern zu testen: ALS und FM. <br><br><h3>  ALS </h3><br>  ALS (Alternating Least Squares) oder Alternating Least Squares - bei der kollaborativen Filterung eine der Methoden zur L√∂sung des Problems der Faktorisierung der Interaktionsmatrix.  Wir werden unsere Transaktionsdaten zur Zahlung von Diensten in Form einer Matrix pr√§sentieren, in der Spalten eindeutige Kennungen der Dienste aller Anbieter und Zeilen eindeutige Kunden sind.  In den Zellen platzieren wir die Anzahl der Operationen bestimmter Kunden bei bestimmten Anbietern f√ºr einen bestimmten Zeitraum: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/430/fcd/db7/430fcddb7494ed4ba54411d0423b5b16.png"><br>  <i>Matrixzerlegungsprinzip</i> <br><br>  Die Bedeutung der Methode besteht darin, dass wir zwei solche Matrizen niedrigerer Dimension erstellen, deren Multiplikation das Ergebnis ergibt, das der urspr√ºnglichen gro√üen Matrix in den gef√ºllten Zellen am n√§chsten kommt.  Das Modell lernt, eine versteckte faktorielle Beschreibung f√ºr Kunden und Anbieter zu erstellen.  Eine Implementierung der Methode in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">impliziten</a> Bibliothek wurde verwendet.  Das Training erfolgt nach folgendem Algorithmus: <br><br><ol><li>  Matrizen von Kunden und Anbietern mit versteckten Faktoren werden initialisiert.  Ihre Anzahl ist der Hyperparameter des Modells. <br></li><li>  Die Matrix der versteckten Faktoren der Anbieter wird festgelegt und die Ableitung der Verlustfunktion f√ºr die Korrektur der Kundenmatrix ber√ºcksichtigt.  Der Autor verwendete eine interessante <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Methode f√ºr konjugierte Gradienten</a> , mit der Sie diesen Schritt erheblich beschleunigen k√∂nnen. <br></li><li>  Der vorherige Schritt wird in √§hnlicher Weise f√ºr die Matrix der verborgenen Faktoren der Kunden wiederholt. </li><li>  Die Schritte 2-3 wechseln sich ab, bis der Algorithmus konvergiert. </li></ol><br><h3>  Vorbereitung </h3><br>  Transaktionsdaten wurden in eine Matrix von Interaktionen mit einem Grad an Sp√§rlichkeit von ~ 99% mit gro√üer Ungleichm√§√üigkeit zwischen den Anbietern umgewandelt.  Um die Daten in Zug- und Validierungsmuster zu unterteilen, haben wir den Anteil der gef√ºllten Zellen zuf√§llig maskiert: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d60/d96/282/d60d96282aac1b7425ee0ea597253d66.png"><br>  <i>Beispiel f√ºr die gemeinsame Nutzung von Daten</i> <br><br>  Die Transaktionen wurden als Test f√ºr den Zeitraum nach dem Training verwendet und in einer Matrix des gleichen Formats angeordnet - es stellte sich heraus, dass die Zeit abgelaufen war. <br><br><h3>  Schulung </h3><br>  Das Modell verf√ºgt √ºber mehrere Hyperparameter, die zur Verbesserung der Qualit√§t angepasst werden k√∂nnen: <br><br><ul><li>  Alpha ist der Koeffizient, mit dem die Matrix gewichtet wird, wobei der Grad des Vertrauens ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">C_iu</a> ) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">angepasst wird,</a> dass der angegebene Service vom Kunden wirklich ‚Äûgemocht‚Äú wird. <br></li><li>  Die Anzahl der Faktoren in den verborgenen Matrizen von Clients und Anbietern ist die Anzahl der Spalten bzw. Zeilen. <br></li><li>  Regularisierungskoeffizient L2 Œª. <br></li><li>  Die Anzahl der Iterationen der Methode. <br></li></ul><br>  Wir haben die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hyperopt-</a> Bibliothek verwendet, mit der wir die Auswirkung von Hyperparametern auf die Qualit√§tsmetrik mithilfe der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">TPE-</a> Methode bewerten und ihren optimalen Wert ausw√§hlen k√∂nnen.  Der Algorithmus beginnt mit einem Kaltstart und f√ºhrt abh√§ngig von den Werten der analysierten Hyperparameter mehrere Bewertungen der Qualit√§tsmetrik durch.  Dann versucht er im Wesentlichen, eine Reihe von Werten von Hyperparametern auszuw√§hlen, die mit gr√∂√üerer Wahrscheinlichkeit einen guten Wert f√ºr die Qualit√§tsmetrik ergeben.  Die Ergebnisse werden in einem W√∂rterbuch gespeichert, aus dem Sie ein Diagramm erstellen und das Ergebnis des Optimierers visuell auswerten k√∂nnen (Blau ist besser): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa2/175/64a/fa217564a3f448a81abbbfad1d27f7a1.png"></div><br>  <i>Das Diagramm der Abh√§ngigkeit der Qualit√§tsmetrik von der Kombination der Hyperparameter</i> <br><br>  Die Grafik zeigt, dass die Werte der Hyperparameter die Qualit√§t des Modells stark beeinflussen.  Da f√ºr jeden von ihnen Bereiche auf die Eingabe der Methode angewendet werden m√ºssen, kann das Diagramm weiter bestimmen, ob es sinnvoll ist, den Wertebereich zu erweitern oder nicht.  In unserer Aufgabe ist es beispielsweise klar, dass es sinnvoll ist, gro√üe Werte f√ºr die Anzahl der Faktoren zu testen.  In Zukunft hat dies das Modell wirklich verbessert. <br><br><h3>  Metrik und Komplexit√§t der Qualit√§tsbewertung </h3><br>  Wie ist die Qualit√§t des Modells zu bewerten?  Eine der am h√§ufigsten verwendeten Metriken f√ºr Empfehlungssysteme, bei denen die Reihenfolge wichtig ist, ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MAP @ k</a> oder Mean Average Precision bei K. Diese Metrik sch√§tzt die Genauigkeit des Modells anhand der K-Empfehlungen unter Ber√ºcksichtigung der Reihenfolge der Elemente in der Liste dieser Empfehlungen im Durchschnitt f√ºr alle Kunden. <br><br>  Leider dauerte eine Qualit√§tsbewertung selbst an einer Probe mehrere Stunden.  Nachdem wir die √Ñrmel hochgekrempelt hatten, begannen wir, die Funktion mean_average_pecision_at_k () mit der Bibliothek line_profiler zu profilieren.  Die Aufgabe wurde weiter dadurch erschwert, dass die Funktion Cython-Code verwendete und korrekt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ber√ºcksichtigt werden musste</a> , da sonst die notwendigen Statistiken einfach nicht erhoben wurden.  Infolgedessen standen wir erneut vor dem Problem der Dimensionalit√§t unserer Daten.  Um diese Metrik zu berechnen, m√ºssen Sie einige Sch√§tzungen f√ºr jeden Service von allen m√∂glichen f√ºr jeden Kunden abrufen und die pers√∂nlichen Top-K-Empfehlungen ausw√§hlen, indem Sie aus dem resultierenden Array sortieren.  Selbst unter Ber√ºcksichtigung der teilweisen Sortierung von numpy.argpartition () mit O (n) -Komplexit√§t erwies sich das Sortieren der Noten als der l√§ngste Schritt, der die Qualit√§tsbewertung √ºber die Uhr streckte.  Da numpy.argpartition () nicht alle Kernel unseres Servers verwendete, wurde beschlossen, den Algorithmus zu verbessern, indem dieser Teil in C ++ und OpenMP √ºber cython neu geschrieben wurde.  Ein kurz neuer Algorithmus lautet wie folgt: <br><br><ol><li>  Daten werden von Kunden in Stapel geschnitten. <br></li><li>  Eine leere Matrix und Zeiger auf den Speicher werden initialisiert. <br></li><li>  Batch-Strings nach Zeigern werden auf zwei Arten sortiert: nach der Funktion teilweise_sortieren und dann nach der C ++ - Algorithmusbibliothek. <br></li><li>  Die Ergebnisse werden parallel in die Zellen der leeren Matrix geschrieben. <br></li><li>  Daten werden in Python zur√ºckgegeben. <br></li></ol><br>  Dadurch konnten wir die Berechnung der Empfehlungen mehrmals beschleunigen.  Die Revision wurde dem offiziellen Repository <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hinzugef√ºgt</a> . <br><br><h2>  OOT-Ergebnisanalyse </h2><br>  Und jetzt ist es Zeit, die Qualit√§t des Modells zu bewerten.  Warum brauchen wir eine zeitversetzte Probenahme?  Wenn wir uns die Verteilung der Operationen nach Anbietern ansehen, sehen wir das folgende Bild: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/345/5d2/3d4/3455d23d4093172fbbf416d9719e14fa.png"></div><br>  <i>Verteilung der Popularit√§t von Dienstleistern</i> <br><br>  Es gibt ein Ungleichgewicht.  Dies f√ºhrt dazu, dass das Modell versucht, beliebte Dienste zu empfehlen.  Zur√ºck zum obigen Bild: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ef/0fd/b08/6ef0fdb084bd7495ad12821c42cd70c2.png"><br><br>  Das Problem ist, dass, wenn Sie die Genauigkeit des Modells √ºberpr√ºfen, indem Sie dieselbe Matrix maskieren, wie es fast √ºberall empfohlen wird, f√ºr die meisten Kunden (Randbeispiele: ‚ÄûW‚Äú, ‚ÄûE‚Äú und ‚ÄûI‚Äú) die Qualit√§t der Validierungsprognosen gilt (wir werden dies so tun) Sie hat nicht an der Auswahl der Hyperparameter teilgenommen.) wird hoch sein, wenn dies die beliebtesten Anbieter sind.  Infolgedessen erhalten wir ein falsches Vertrauen in die St√§rke des Modells.  Daher haben wir wie folgt gehandelt: <br><br><ol><li>  Gebildete Sch√§tzungen der Anbieter nach Modell. <br></li><li>  Die vorhandenen Client-Service-Paare wurden aus den Bewertungen (siehe Abbildung unten) und OOT-Matrizen ausgeschlossen. <br></li><li>  Gebildet aus den verbleibenden Bewertungen der Top-K-Empfehlungen und bewertet MAP @ k auf dem verbleibenden OOT. <br></li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/ee7/c06/f4b/ee7c06f4b68beda0b4f0e22e3c8163c1.png"><br>  <i>Die Logik der Vorbereitung der Matrix zur Erstellung von Prognosen</i> <br><br>  Als Basis haben wir eine Liste von Anbietern zusammengestellt, sortiert nach Beliebtheit, und diese mit allen Kunden multipliziert, wobei wiederum die vorhandenen Kunden-Service-Paare ausgeschlossen wurden.  Es stellte sich als traurig heraus und √ºberhaupt nicht das, was wir in den Zug- / Validierungsmustern erwartet und gesehen hatten: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee2/a94/050/ee2a94050abe17d305bdcffeb895f2d0.png"></div><br>  <i>Vergleichstabelle f√ºr Benchmark und Modellqualit√§t</i> <br><br>  H√∂r auf!  Wir haben Kundenfaktoren und Parameter von Anbietern.  Wir bekommen Faktorisierungsmaschinen. <br><br><h3>  FM </h3><br>  Faktorisierungsmaschinen (Faktorisierungsmaschine) - ein Lernalgorithmus mit einem Lehrer, der entwickelt wurde, um Beziehungen zwischen Faktoren zu finden, die interagierende Entit√§ten beschreiben, die in Form von sp√§rlichen Matrizen dargestellt werden.  Wir haben die FM-Implementierung aus der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">LightFM-</a> Bibliothek verwendet. <br><br><h3>  Datenformat </h3><br>  Zus√§tzlich zur normalisierten Interaktionsmatrix verwendet die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Methode</a> zwei zus√§tzliche Datens√§tze mit Faktoren f√ºr Kunden und f√ºr Dienste von Anbietern in Form von One-Hot-Coded-Matrizen, die mit einzelnen verbunden sind: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/61b/fa6/c8a/61bfa6c8ab458cfb9b747a37a28e0e32.png"><br>  <i>Die Logik der Vorbereitung der Matrix zur Erstellung von Prognosen</i> <br><br><h3>  Qualit√§tsbewertung </h3><br>  Die Qualit√§t des FM-Modells in unseren Daten war geringer als bei ALS: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/48b/457/003/48b457003013f435b77ba2d9ecc4cb25.png"></div><br>  <i>Vergleichstabelle der Qualit√§tsmodelle und der Basislinie</i> <br><br><h3>  Modellarchitektur √§ndern - Boosting </h3><br>  Es wurde beschlossen, von der anderen Seite hereinzukommen.  Unter Hinweis auf die Verteilung der Popularit√§t von Diensten haben wir 300 von ihnen identifiziert, Transaktionen, die 80% aller Operationen abdecken, und einen Klassifikator f√ºr sie geschult.  Hier stellen die Daten Aggregate von Kundentransaktionen dar, die mit Kundenfunktionen angereichert sind: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d25/47d/718/d2547d718a7199fba96be2d0f653bf9a.png"><br>  <i>Transaktionsaggregationsschema</i> <br><br>  Warum nur clientseitig?  In diesem Fall reicht es aus, eine Zeile pro Kunde zu haben, um Empfehlungen vorzubereiten.  Wenn wir das Modell darauf anwenden, erhalten wir den Ausgabevektor der Wahrscheinlichkeiten f√ºr alle Klassen, aus denen sich leicht Top-K-Empfehlungen ausw√§hlen lassen.  Wenn wir die Funktionen von Anbieterservices zum Schulungssatz hinzuf√ºgen, m√ºssen wir in der Phase der Anwendung des Modells entweder 300 Zeilen f√ºr jeden Kunden vorbereiten - eine f√ºr jeden Anbieterservice mit Funktionen, die diese beschreiben, oder ein anderes Modell f√ºr die Vorsortierung von Bewertungskandidaten erstellen . <br><br>  Das Hinzuf√ºgen von Funktionen zu Kunden von ALS hat unsere Daten nicht erh√∂ht, da wir bereits Transaktionsaktivit√§ten ber√ºcksichtigt haben - beispielsweise in Abschnitten des Kundencenters oder in Kategorien im Stil von ‚ÄûSpieler‚Äú oder ‚ÄûTheater‚Äú.  In diesem Format konnten wir gute Ergebnisse erzielen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eed/66a/389/eed66a389e4b545fa18a59c6c4ac123a.png"></div><br>  <i>Vergleichstabelle der Qualit√§tsmodelle und der Basislinie</i> <br><br><h3>  Regionalfilter </h3><br>  Trotz der hohen Qualit√§t des Modells bleibt ein weiteres Problem bei diesem Ansatz.  Da die Architektur der Daten und des Modells nicht die Verwendung von Merkmalen der Dienste von Anbietern impliziert, ber√ºcksichtigt das Modell die Geografie nicht vollst√§ndig und empfiehlt m√∂glicherweise, dass Personen f√ºr den Dienst eines lokalen Anbieters aus einer anderen Region bezahlen.  Um dieses Risiko zu minimieren, haben wir einen kleinen Filter entwickelt, um Optionen vor der Eingabe von Empfehlungen abzuschneiden.  Dem Algorithmus wird eine leichte Rekursionsfliege verliehen: <br><br><ol><li>  Wir sammeln Informationen √ºber die Region des Kunden aus Bankprofilen und anderen internen Quellen. <br></li><li>  Wir w√§hlen f√ºr jeden Anbieter die wichtigsten Pr√§senzregionen aus. <br></li><li>  Wir kl√§ren / f√ºllen die Informationen √ºber die Region des Kunden nach Regionen der Anbieter aus, die er verwendet. <br></li></ol><br>  Nach diesen Manipulationen trennen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wir</a> anhand <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">des Herfindahl-Index</a> die regionalen Anbieter, die in einer begrenzten Anzahl von Regionen vertreten sind, von den Bundesanbietern: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/620/15f/090/62015f090d3bdcc34d468f7b36ffef90.png"></div><br>  <i>Trennung der Anbieter nach Pr√§senz in den Regionen</i> <br><br>  Wir bilden eine Maske mit akzeptablen regionalen Anbietern f√ºr Kunden und schlie√üen unn√∂tige Elemente von Modellvorhersagen aus, bevor wir eine Liste mit Empfehlungen erstellen. <br><br><h2>  Fazit </h2><br>  Wir haben zwei Modelle entwickelt, die zusammen einen vollst√§ndigen Satz von Empfehlungen zu Zahlungen und √úberweisungen bilden.  Der Clientpfad f√ºr die H√§lfte der wiederkehrenden Vorg√§nge konnte auf einen Klick reduziert werden.  In zuk√ºnftigen Pl√§nen soll das Modell der ‚Äûempfohlenen Operationen‚Äú mithilfe von Feedback-Daten (Karten k√∂nnen ausgeblendet werden usw.) verbessert werden, wodurch der Schwellenwert f√ºr die Auswahl von Empfehlungen gesenkt und die Abdeckung erh√∂ht wird.  Es ist auch geplant, die Abdeckung der empfohlenen Zahlungen im Modell der ‚ÄûSuchbeispiele‚Äú zu erweitern und einen Algorithmus zur Bewertung der Optimierung daf√ºr zu entwickeln. <br><br>  Wir haben den schwierigen Weg beschritten, ein Empfehlungssystem f√ºr Zahlungen und √úberweisungen aufzubauen.  Unterwegs haben wir Unebenheiten gesammelt und Erfahrungen mit der Zerlegung und Vereinfachung solcher Aufgaben, der korrekten Bewertung solcher Systeme, der Anwendbarkeit von Methoden, der optimalen Arbeit mit gro√üen Datenmengen und der deutlichen Erweiterung unseres Verst√§ndnisses der Besonderheiten solcher Aufgaben gesammelt.  Unterwegs habe ich es geschafft, zu Open Source beizutragen, das wir selbst nutzen.  Ich w√ºnsche Ihnen interessante Aufgaben, realistische Basislinien und einzelne F1.  Vielen Dank f√ºr Ihre Aufmerksamkeit! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de461747/">https://habr.com/ru/post/de461747/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de461737/index.html">Wir sammeln die Umgebung f√ºr modernes TDD auf JavaScript + VS-Code</a></li>
<li><a href="../de461739/index.html">Backend United 4: Okroshka. Vorf√§lle</a></li>
<li><a href="../de461741/index.html">Hierarchisches Clustering kategorialer Daten in R.</a></li>
<li><a href="../de461743/index.html">Sicherheitswoche 31: VLC-Sicherheitsl√ºcke und defektes Telefon</a></li>
<li><a href="../de461745/index.html">DeviceLock DLP: Preise des russischen Schwarzmarktes f√ºr das Durchbrechen personenbezogener Daten (plus eine Antwort auf die Antwort der Tinkoff Bank)</a></li>
<li><a href="../de461749/index.html">Sch√∂nheit im Auge des Betrachters</a></li>
<li><a href="../de461751/index.html">Designerbeitrag zur Entwicklung mobiler Apps</a></li>
<li><a href="../de461753/index.html">Globale Transaktionen von InterSystems IRIS</a></li>
<li><a href="../de461755/index.html">Die Psychologie des Schallbildes. Svetlana Lebedeva erz√§hlte, wie den Menschen eine neue Art der Wahrnehmung beigebracht wird</a></li>
<li><a href="../de461759/index.html">Abh√∂ren verschl√ºsselter VoIP-Kommunikation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>