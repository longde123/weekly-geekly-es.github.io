<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>筹   El enfrentamiento: c贸mo fue   </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saludos! Habiendo visto suficiente inter茅s en lo que est谩 sucediendo en The Standoff en las filas de defensores en PHDays 9, decidimos hablar sobre c贸...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>El enfrentamiento: c贸mo fue</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jetinfosystems/blog/454298/"><img src="https://habrastorage.org/webt/ef/tx/b3/eftxb30vyae7fr5w6xkios-nl9q.jpeg"><br><br>  Saludos!  Habiendo visto suficiente inter茅s en lo que est谩 sucediendo en The Standoff en las filas de defensores en PHDays 9, decidimos hablar sobre c贸mo la preparaci贸n y el "enfrentamiento" tuvieron lugar a trav茅s de los ojos del Jet CSIRT como parte del Equipo Jet Security. <br><a name="habracut"></a><br><h3>  Guo Standoff, cre茅 </h3><br>  Algo as铆, los colegas informaron que una vez m谩s est谩bamos participando en The Standoff, y naturalmente estuvimos de acuerdo. <br><br>  Vale la pena mencionar de inmediato que para los defensores de este a帽o, el formato de la competencia ha cambiado un poco.  Todos los equipos recibieron infraestructuras de oficina muy similares, y esto permiti贸 a los organizadores ingresar una calificaci贸n de defensores en ciertos loros.  Y para el equipo de Jet Security, esta fue la primera "confrontaci贸n", donde se defendi贸 la oficina, y no la infraestructura industrial. <br><br>  Tenemos acceso a la infraestructura para prepararnos para la batalla cibern茅tica a fines de abril.  Despu茅s de la auditor铆a de la infraestructura, se mont贸 todo un vag贸n de deficiencias, aqu铆 hay algunas de ellas.  Absolutamente en toda la infraestructura no hab铆a parches reales.  Las contrase帽as de todos los usuarios se pueden obtener a trav茅s de Ntds.dit en texto sin cifrar.  Adem谩s, algunos usuarios ten铆an contrase帽as de la lista TOP-500 o contrase帽as con un hash f谩cilmente reversible.  El endurecimiento del sistema era casi nulo o nada en absoluto.  Algunos hosts en la DMZ ten铆an una interfaz en la subred del servidor. <br><br>  Con base en los resultados de la auditor铆a, desarrollamos ciertas medidas de seguridad, a su vez, los organizadores, despu茅s de la aprobaci贸n preliminar, nos permitieron aplicar las pol铆ticas que necesit谩bamos y llevar todas las herramientas y herramientas de seguridad que se pueden implementar en un entorno virtual.  Debido a los plazos ajustados, algunas ideas sobre medidas de protecci贸n se cayeron al principio.  La configuraci贸n principal y el perfil del SPI se llevaron a cabo durante las vacaciones de mayo (hola a todos los que arrojaron fotos de los picnics, nosotros tambi茅n los amamos), y algunos de los equipos de protecci贸n tuvieron que ajustarse justo antes del inicio en el sitio.  Adem谩s, varios servicios ten铆an prohibido parchear y reconfigurar fuertemente.  Por ejemplo, uno de estos fue Oracle Weblogic con CVE-2019-2725, que PoC se lanz贸 en los primeros d铆as de mayo de 2019. <br><br>  Bueno, y una lista de lo que trajimos con nosotros: <br><br><ul><li>  Cortafuegos (proporcionado por los organizadores ha sido reemplazado); </li><li>  Soluci贸n antivirus; </li><li>  WAF; </li><li>  EDR </li><li>  Un par de soluciones de enga帽o; </li><li>  Un par de esc谩neres de vulnerabilidad; </li><li>  Pila ELK para an谩lisis adicional de Netflow; </li><li>  SIEM </li></ul><br>  Tambi茅n deber铆amos hablar sobre lo que iba a SIEM.  Como fuentes de eventos, ten铆amos a nuestra disposici贸n los registros de Windows, Sysmon, registros de Auditd y, como se puede adivinar, eventos del propio SZI.  Si no hubo problemas especiales con los dos primeros, y r谩pidamente acordamos cambios en la pol铆tica y configuraci贸n de Sysmon, entonces tuvimos que luchar con los organizadores para la configuraci贸n de Auditd. <br><br>  Paralelamente a esto, identificamos los principales vectores de ataque y, en base a esto, seleccionamos y adaptamos escenarios relevantes y reglas de correlaci贸n, un total de aproximadamente 160 reglas de correlaci贸n.  Adem谩s, se ensambl贸 un conjunto de paneles variados para nodos cr铆ticos, SZI y lo que requer铆a atenci贸n especial en la infraestructura del juego. <br><br><h3>  El enfrentamiento </h3><br>  Para The Standoff, decidimos adherirnos al concepto de separar los incidentes en externos e internos, ya que exist铆a un entendimiento exacto de que afuera tratar铆amos activamente de escanear y operar la web.  Los incidentes relacionados con el escaneo y los intentos de evadir WAF se monitorearon por separado, con una prioridad m谩s baja, esto nos permiti贸 centrarnos en incidentes internos.  Se distribuyeron paneles para SPI entre los defensores en 谩reas de responsabilidad, y se asignaron al menos 2 personas a cada herramienta, para la posibilidad de rotaci贸n y descanso. <br><br>  Todo sucedi贸, como esper谩bamos.  El enfrentamiento comenz贸 alrededor de las 10 de la ma帽ana, y tan pronto como se inici贸, el sistema SIEM comenz贸 a emitir un mont贸n de incidentes relacionados con un escaneo externo y los intentos de los atacantes de explotar la red.  En algunos casos, incluso el grupo no guard贸.  Junto con esto, los verificadores de los organizadores comenzaron a trabajar, verificando el estado de varios servicios en la oficina, lo que nos oblig贸 a volver a realizar perfiles hasta cierto punto para cortar los falsos positivos asociados con ellos. <br><br>  En las primeras horas del juego, el equipo de Hack.ERS logr贸 encontrar las credenciales est谩ndar del administrador (admin / admin) en el CMS de uno de los recursos y detectar una posible vulnerabilidad de LFI.  Estos intentos no pasaron desapercibidos, nuestros defensores llevaron a cabo una respuesta operativa y los atacantes al final no pudieron avanzar m谩s. <br><br>  Hasta el final del primer d铆a del juego, los m茅todos no cambiaron, WAF a煤n super贸 todos los intentos de subir algo interesante a los sitios web de la compa帽铆a, y las mismas "direcciones externas", sin cesar, intentaron escanear nuestros recursos. <br><br><img src="https://habrastorage.org/webt/k4/h2/je/k4h2jeeackujcdpdfydy2ci7i7s.png"><br><br>  En total, para todo el evento, se registraron 3000 incidentes relacionados con intentos de escaneo, sin tener en cuenta la agrupaci贸n de eventos en incidentes. <br><br><img src="https://habrastorage.org/webt/eo/c0/j-/eoc0j-v5ohyz-kbja5goxy9vzsi.png"><br><br>  Y alrededor de 2500 incidentes con intentos de evadir WAF, tambi茅n sin tener en cuenta la agrupaci贸n de eventos en incidentes. <br><br>  Hacia la noche, la intensidad de todas las actividades disminuy贸; hubo varias razones para esto.  Parte de los defensores y atacantes no pudieron resistir la prueba de sonido y el ensayo del concierto, que se supon铆a que se celebrar铆a al d铆a siguiente.  Algunos equipos atacantes decidieron tomar un descanso y continuar los ataques m谩s cerca de la ma帽ana con la esperanza de que los defensores y el monitoreo tuvieran menos recursos de monitoreo y algo de fatiga. <br><br>  En la ma帽ana del segundo d铆a, los atacantes cambiaron de t谩ctica.  La informaci贸n sobre una parte de sus empleados se public贸 en uno de los sitios web de la compa帽铆a.  Los hackers aprovecharon esta informaci贸n y comenzaron a recopilar activamente cuentas de usuario a trav茅s de Exchange (estad铆sticas de intentos en la captura de pantalla). <br><br><img src="https://habrastorage.org/webt/ud/pp/z0/udppz0drbdk_woprerkpwz3xgos.png"><br><br>  Un poco m谩s tarde, se hicieron intentos inseguros para seleccionar una contrase帽a en la puerta de enlace VPN, las cuentas que no estaban en nuestra infraestructura participaron en el bruto.  Con alta probabilidad, los atacantes intentaron usar cuentas de la infraestructura ya hackeada con la esperanza de que los organizadores los dejaran igual en todas partes.  Como resultado, toda la situaci贸n con fuerza bruta nos llev贸 a crear un grupo de paneles sobre tendencias en t茅rminos de autenticaci贸n de usuarios.  Adem谩s, reforzamos el monitoreo de incidentes relacionados con la fuerza bruta exitosa, pero, afortunadamente, no se detectaron tales casos. <br><br>  Aproximadamente una hora antes del final del juego, las tendencias vieron intentos 煤nicos exitosos de autenticar a varios usuarios, incluidos los de Exchange, el an谩lisis operativo mostr贸 que las fuentes eran m谩quinas de usuario directamente, la mayor铆a de los eventos indicaron que los organizadores iniciaron sesi贸n desde la consola VMware Vcenter <br><br>  Al mismo tiempo, grabamos un escaneo interno desde un nodo que se conect贸 con 茅xito a trav茅s de VPN.  Despu茅s de un an谩lisis operativo de los eventos relacionados con el incidente, qued贸 claro que los atacantes pod铆an comprometer las credenciales de varios usuarios y, a juzgar por la ausencia de intentos de autenticaci贸n fallidos, es probable que los datos del usuario se hayan "filtrado". <br><br>  Se transmiti贸 informaci贸n a los defensores.  Durante todo el tiempo de respuesta en las computadoras personales de los usuarios comprometidos, la soluci贸n de punto final se puso en modo de protecci贸n preventiva para reducir la capacidad de afianzarse en el sistema.  Las sesiones de ataque en la puerta de enlace VPN se dejaron caer por la fuerza, y los atacantes fueron expulsados del per铆metro protegido.  En UZ comprometida, las contrase帽as se cambiaron r谩pidamente. <br><br>  En ese mismo momento, los muchachos del equipo True0xA3 subieron al escenario y usaron con 茅xito OSINT e informaron el compromiso de la oficina de Behealthy, que est谩 bajo la protecci贸n de otro equipo.  Los atacantes lograron comprometer al administrador del dominio.  Los organizadores fueron notificados de nuestro incidente y se proporcionaron pruebas. <br><br>  La 煤ltima hora fue especialmente calurosa debido al repentino OSINT, todos esperaban m谩s preparativos de los organizadores.  El equipo de monitoreo, a su vez, monitore贸 todas las anomal铆as e incidentes sospechosos, pero despu茅s de un intento fallido de penetrar nuevos intentos de pirater铆a, no lo sigui贸.  As铆 que pasaron los 煤ltimos minutos de tiempo de juego, y el pirateo exitoso de la oficina protegida por el Equipo de Seguridad de Jet no ocurri贸. <br><br>  Y un poco de estad铆sticas finales para dos d铆as de juego: <br><br><ul><li>  1200 EPS en promedio y un poco menos de 3000 EPS en el pico; </li><li>  Cerca de 7000 incidentes; </li><li>  M谩s de 120 millones de eventos. </li></ul><br><br><h3>  Factores que nos ayudaron a ganar </h3><br><ul><li>  Distribuci贸n competente de roles.  Cada uno se prepar贸 y particip贸 en la mayor铆a de lo que hace en proyectos cotidianos.  Nadie tuvo que estudiar materiales de la categor铆a de "cortafuegos para tontos". </li><li>  Perfil operativo de las reglas de correlaci贸n.  Todos los falsos positivos se procesaron y se hicieron correcciones relacionadas con las caracter铆sticas de la infraestructura de juego. </li><li>  Pronta respuesta.  Debido al hecho de que se asignaron varias personas a cada tipo de SZI y sistemas, no tuvimos problemas con el hecho de que la persona responsable descansara o simplemente se fuera por un par de minutos.  Toda la informaci贸n del monitoreo se proces贸 lo m谩s r谩pido posible. </li><li>  Experiencia en el endurecimiento y seguimiento de diversas infraestructuras. </li></ul><br>  PD: Un agradecimiento especial a todos los que vinieron y formularon preguntas, y nos disculpamos con aquellos que no pudieron decir algo en el proceso: el equipo estaba esperando "cosacos mal manejados" de los atacantes y no pudo revelar todos los detalles. <br><br>  <i>Dmitry Lifanov, experto en el Centro de Monitoreo y Respuesta a Incidentes de Seguridad de la Informaci贸n Jet CSIRT</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/454298/">https://habr.com/ru/post/454298/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../454284/index.html">Lo siento, no vendr茅 a trabajar porque es invierno</a></li>
<li><a href="../454290/index.html">Principio de responsabilidad 煤nica. No es tan simple como parece</a></li>
<li><a href="../454292/index.html">JS. Proxy Dificultades para conocer</a></li>
<li><a href="../454294/index.html">"Sin experimentos innecesarios", o c贸mo lanzamos un acelerador bancario</a></li>
<li><a href="../454296/index.html">C贸mo una escuela en Puerto Rico da vida a la qu铆mica con Minecraft: Edici贸n educativa</a></li>
<li><a href="../454300/index.html">C贸mo los CTT difieren de los tubos de calor convencionales y c贸mo aplicarlos</a></li>
<li><a href="../454302/index.html">Archivos QVD: lo que hay dentro</a></li>
<li><a href="../454304/index.html">Impresora Delta 3D h谩galo usted mismo para cer谩mica</a></li>
<li><a href="../454306/index.html">Cinco errores que comet铆 como desarrollador principal</a></li>
<li><a href="../454308/index.html">AMA con Habr. V.9.0. Podcast, Conferencia y Conceptos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>