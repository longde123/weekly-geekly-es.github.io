<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⛳️ 🎪 📱 El enfrentamiento: cómo fue 🦏 🧓🏼 🎶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saludos! Habiendo visto suficiente interés en lo que está sucediendo en The Standoff en las filas de defensores en PHDays 9, decidimos hablar sobre có...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>El enfrentamiento: cómo fue</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jetinfosystems/blog/454298/"><img src="https://habrastorage.org/webt/ef/tx/b3/eftxb30vyae7fr5w6xkios-nl9q.jpeg"><br><br>  Saludos!  Habiendo visto suficiente interés en lo que está sucediendo en The Standoff en las filas de defensores en PHDays 9, decidimos hablar sobre cómo la preparación y el "enfrentamiento" tuvieron lugar a través de los ojos del Jet CSIRT como parte del Equipo Jet Security. <br><a name="habracut"></a><br><h3>  Guo Standoff, creé </h3><br>  Algo así, los colegas informaron que una vez más estábamos participando en The Standoff, y naturalmente estuvimos de acuerdo. <br><br>  Vale la pena mencionar de inmediato que para los defensores de este año, el formato de la competencia ha cambiado un poco.  Todos los equipos recibieron infraestructuras de oficina muy similares, y esto permitió a los organizadores ingresar una calificación de defensores en ciertos loros.  Y para el equipo de Jet Security, esta fue la primera "confrontación", donde se defendió la oficina, y no la infraestructura industrial. <br><br>  Tenemos acceso a la infraestructura para prepararnos para la batalla cibernética a fines de abril.  Después de la auditoría de la infraestructura, se montó todo un vagón de deficiencias, aquí hay algunas de ellas.  Absolutamente en toda la infraestructura no había parches reales.  Las contraseñas de todos los usuarios se pueden obtener a través de Ntds.dit en texto sin cifrar.  Además, algunos usuarios tenían contraseñas de la lista TOP-500 o contraseñas con un hash fácilmente reversible.  El endurecimiento del sistema era casi nulo o nada en absoluto.  Algunos hosts en la DMZ tenían una interfaz en la subred del servidor. <br><br>  Con base en los resultados de la auditoría, desarrollamos ciertas medidas de seguridad, a su vez, los organizadores, después de la aprobación preliminar, nos permitieron aplicar las políticas que necesitábamos y llevar todas las herramientas y herramientas de seguridad que se pueden implementar en un entorno virtual.  Debido a los plazos ajustados, algunas ideas sobre medidas de protección se cayeron al principio.  La configuración principal y el perfil del SPI se llevaron a cabo durante las vacaciones de mayo (hola a todos los que arrojaron fotos de los picnics, nosotros también los amamos), y algunos de los equipos de protección tuvieron que ajustarse justo antes del inicio en el sitio.  Además, varios servicios tenían prohibido parchear y reconfigurar fuertemente.  Por ejemplo, uno de estos fue Oracle Weblogic con CVE-2019-2725, que PoC se lanzó en los primeros días de mayo de 2019. <br><br>  Bueno, y una lista de lo que trajimos con nosotros: <br><br><ul><li>  Cortafuegos (proporcionado por los organizadores ha sido reemplazado); </li><li>  Solución antivirus; </li><li>  WAF; </li><li>  EDR </li><li>  Un par de soluciones de engaño; </li><li>  Un par de escáneres de vulnerabilidad; </li><li>  Pila ELK para análisis adicional de Netflow; </li><li>  SIEM </li></ul><br>  También deberíamos hablar sobre lo que iba a SIEM.  Como fuentes de eventos, teníamos a nuestra disposición los registros de Windows, Sysmon, registros de Auditd y, como se puede adivinar, eventos del propio SZI.  Si no hubo problemas especiales con los dos primeros, y rápidamente acordamos cambios en la política y configuración de Sysmon, entonces tuvimos que luchar con los organizadores para la configuración de Auditd. <br><br>  Paralelamente a esto, identificamos los principales vectores de ataque y, en base a esto, seleccionamos y adaptamos escenarios relevantes y reglas de correlación, un total de aproximadamente 160 reglas de correlación.  Además, se ensambló un conjunto de paneles variados para nodos críticos, SZI y lo que requería atención especial en la infraestructura del juego. <br><br><h3>  El enfrentamiento </h3><br>  Para The Standoff, decidimos adherirnos al concepto de separar los incidentes en externos e internos, ya que existía un entendimiento exacto de que afuera trataríamos activamente de escanear y operar la web.  Los incidentes relacionados con el escaneo y los intentos de evadir WAF se monitorearon por separado, con una prioridad más baja, esto nos permitió centrarnos en incidentes internos.  Se distribuyeron paneles para SPI entre los defensores en áreas de responsabilidad, y se asignaron al menos 2 personas a cada herramienta, para la posibilidad de rotación y descanso. <br><br>  Todo sucedió, como esperábamos.  El enfrentamiento comenzó alrededor de las 10 de la mañana, y tan pronto como se inició, el sistema SIEM comenzó a emitir un montón de incidentes relacionados con un escaneo externo y los intentos de los atacantes de explotar la red.  En algunos casos, incluso el grupo no guardó.  Junto con esto, los verificadores de los organizadores comenzaron a trabajar, verificando el estado de varios servicios en la oficina, lo que nos obligó a volver a realizar perfiles hasta cierto punto para cortar los falsos positivos asociados con ellos. <br><br>  En las primeras horas del juego, el equipo de Hack.ERS logró encontrar las credenciales estándar del administrador (admin / admin) en el CMS de uno de los recursos y detectar una posible vulnerabilidad de LFI.  Estos intentos no pasaron desapercibidos, nuestros defensores llevaron a cabo una respuesta operativa y los atacantes al final no pudieron avanzar más. <br><br>  Hasta el final del primer día del juego, los métodos no cambiaron, WAF aún superó todos los intentos de subir algo interesante a los sitios web de la compañía, y las mismas "direcciones externas", sin cesar, intentaron escanear nuestros recursos. <br><br><img src="https://habrastorage.org/webt/k4/h2/je/k4h2jeeackujcdpdfydy2ci7i7s.png"><br><br>  En total, para todo el evento, se registraron 3000 incidentes relacionados con intentos de escaneo, sin tener en cuenta la agrupación de eventos en incidentes. <br><br><img src="https://habrastorage.org/webt/eo/c0/j-/eoc0j-v5ohyz-kbja5goxy9vzsi.png"><br><br>  Y alrededor de 2500 incidentes con intentos de evadir WAF, también sin tener en cuenta la agrupación de eventos en incidentes. <br><br>  Hacia la noche, la intensidad de todas las actividades disminuyó; hubo varias razones para esto.  Parte de los defensores y atacantes no pudieron resistir la prueba de sonido y el ensayo del concierto, que se suponía que se celebraría al día siguiente.  Algunos equipos atacantes decidieron tomar un descanso y continuar los ataques más cerca de la mañana con la esperanza de que los defensores y el monitoreo tuvieran menos recursos de monitoreo y algo de fatiga. <br><br>  En la mañana del segundo día, los atacantes cambiaron de táctica.  La información sobre una parte de sus empleados se publicó en uno de los sitios web de la compañía.  Los hackers aprovecharon esta información y comenzaron a recopilar activamente cuentas de usuario a través de Exchange (estadísticas de intentos en la captura de pantalla). <br><br><img src="https://habrastorage.org/webt/ud/pp/z0/udppz0drbdk_woprerkpwz3xgos.png"><br><br>  Un poco más tarde, se hicieron intentos inseguros para seleccionar una contraseña en la puerta de enlace VPN, las cuentas que no estaban en nuestra infraestructura participaron en el bruto.  Con alta probabilidad, los atacantes intentaron usar cuentas de la infraestructura ya hackeada con la esperanza de que los organizadores los dejaran igual en todas partes.  Como resultado, toda la situación con fuerza bruta nos llevó a crear un grupo de paneles sobre tendencias en términos de autenticación de usuarios.  Además, reforzamos el monitoreo de incidentes relacionados con la fuerza bruta exitosa, pero, afortunadamente, no se detectaron tales casos. <br><br>  Aproximadamente una hora antes del final del juego, las tendencias vieron intentos únicos exitosos de autenticar a varios usuarios, incluidos los de Exchange, el análisis operativo mostró que las fuentes eran máquinas de usuario directamente, la mayoría de los eventos indicaron que los organizadores iniciaron sesión desde la consola VMware Vcenter <br><br>  Al mismo tiempo, grabamos un escaneo interno desde un nodo que se conectó con éxito a través de VPN.  Después de un análisis operativo de los eventos relacionados con el incidente, quedó claro que los atacantes podían comprometer las credenciales de varios usuarios y, a juzgar por la ausencia de intentos de autenticación fallidos, es probable que los datos del usuario se hayan "filtrado". <br><br>  Se transmitió información a los defensores.  Durante todo el tiempo de respuesta en las computadoras personales de los usuarios comprometidos, la solución de punto final se puso en modo de protección preventiva para reducir la capacidad de afianzarse en el sistema.  Las sesiones de ataque en la puerta de enlace VPN se dejaron caer por la fuerza, y los atacantes fueron expulsados ​​del perímetro protegido.  En UZ comprometida, las contraseñas se cambiaron rápidamente. <br><br>  En ese mismo momento, los muchachos del equipo True0xA3 subieron al escenario y usaron con éxito OSINT e informaron el compromiso de la oficina de Behealthy, que está bajo la protección de otro equipo.  Los atacantes lograron comprometer al administrador del dominio.  Los organizadores fueron notificados de nuestro incidente y se proporcionaron pruebas. <br><br>  La última hora fue especialmente calurosa debido al repentino OSINT, todos esperaban más preparativos de los organizadores.  El equipo de monitoreo, a su vez, monitoreó todas las anomalías e incidentes sospechosos, pero después de un intento fallido de penetrar nuevos intentos de piratería, no lo siguió.  Así que pasaron los últimos minutos de tiempo de juego, y el pirateo exitoso de la oficina protegida por el Equipo de Seguridad de Jet no ocurrió. <br><br>  Y un poco de estadísticas finales para dos días de juego: <br><br><ul><li>  1200 EPS en promedio y un poco menos de 3000 EPS en el pico; </li><li>  Cerca de 7000 incidentes; </li><li>  Más de 120 millones de eventos. </li></ul><br><br><h3>  Factores que nos ayudaron a ganar </h3><br><ul><li>  Distribución competente de roles.  Cada uno se preparó y participó en la mayoría de lo que hace en proyectos cotidianos.  Nadie tuvo que estudiar materiales de la categoría de "cortafuegos para tontos". </li><li>  Perfil operativo de las reglas de correlación.  Todos los falsos positivos se procesaron y se hicieron correcciones relacionadas con las características de la infraestructura de juego. </li><li>  Pronta respuesta.  Debido al hecho de que se asignaron varias personas a cada tipo de SZI y sistemas, no tuvimos problemas con el hecho de que la persona responsable descansara o simplemente se fuera por un par de minutos.  Toda la información del monitoreo se procesó lo más rápido posible. </li><li>  Experiencia en el endurecimiento y seguimiento de diversas infraestructuras. </li></ul><br>  PD: Un agradecimiento especial a todos los que vinieron y formularon preguntas, y nos disculpamos con aquellos que no pudieron decir algo en el proceso: el equipo estaba esperando "cosacos mal manejados" de los atacantes y no pudo revelar todos los detalles. <br><br>  <i>Dmitry Lifanov, experto en el Centro de Monitoreo y Respuesta a Incidentes de Seguridad de la Información Jet CSIRT</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/454298/">https://habr.com/ru/post/454298/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../454284/index.html">Lo siento, no vendré a trabajar porque es invierno</a></li>
<li><a href="../454290/index.html">Principio de responsabilidad única. No es tan simple como parece</a></li>
<li><a href="../454292/index.html">JS. Proxy Dificultades para conocer</a></li>
<li><a href="../454294/index.html">"Sin experimentos innecesarios", o cómo lanzamos un acelerador bancario</a></li>
<li><a href="../454296/index.html">Cómo una escuela en Puerto Rico da vida a la química con Minecraft: Edición educativa</a></li>
<li><a href="../454300/index.html">Cómo los CTT difieren de los tubos de calor convencionales y cómo aplicarlos</a></li>
<li><a href="../454302/index.html">Archivos QVD: lo que hay dentro</a></li>
<li><a href="../454304/index.html">Impresora Delta 3D hágalo usted mismo para cerámica</a></li>
<li><a href="../454306/index.html">Cinco errores que cometí como desarrollador principal</a></li>
<li><a href="../454308/index.html">AMA con Habr. V.9.0. Podcast, Conferencia y Conceptos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>