<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😀 🥧 🚀 Erste Einführung in AssemblyScript 👨🏾‍🏭 🕞 🧘🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Unterstützung der WebAssembly (Wasm) -Technologie wurde in den letzten Jahren in Browsern eingeführt. Diese Technologie kann jedoch die Funktionen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Erste Einführung in AssemblyScript</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/477272/">  Die Unterstützung der <a href="https://webassembly.org/">WebAssembly</a> (Wasm) -Technologie wurde in den letzten Jahren in Browsern eingeführt.  Diese Technologie kann jedoch die Funktionen des Webs erweitern und es zu einer Plattform machen, die solche Anwendungen unterstützt, die normalerweise als Desktop angesehen werden. <br><br>  Das Beherrschen von WebAssembly kann für Webentwickler eine entmutigende Aufgabe sein.  Der <a href="https://assemblyscript.org/">AssemblyScript-</a> Compiler kann die Situation jedoch verbessern. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pw/p4/91/pwp491ryabgnwblabon5slwooey.jpeg"></div><br>  Der Autor des Artikels, den wir in der heutigen Übersetzung veröffentlichen, erklärt zunächst, warum WebAssembly eine vielversprechende Technologie ist, und wirft anschließend einen Blick darauf, wie AssemblyScript dazu beitragen kann, das Potenzial von Wasm auszuschöpfen. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Webassembly</font> </h2><br>  WebAssembly kann als einfache Sprache für Browser bezeichnet werden.  Es gibt Entwicklern die Möglichkeit, Code zu erstellen, der in etwas anderem als JavaScript kompiliert wird.  Auf diese Weise können die auf den Webseiten enthaltenen Programme für verschiedene Plattformen fast so schnell arbeiten wie native Anwendungen.  Solche Programme werden in einer begrenzten, sicheren Umgebung ausgeführt. <br><br>  Vertreter der für die Entwicklung aller führenden Browser (Chrome, Firefox, Safari und Edge) zuständigen Teams waren an der Erstellung des WebAssembly-Standards beteiligt.  Sie einigten sich Anfang 2017 auf eine Systemarchitektur.  Jetzt unterstützen alle oben genannten Browser WebAssembly.  Tatsächlich kann diese Technologie in <a href="https://caniuse.com/">ungefähr 87% der</a> Browser verwendet werden. <br><br>  WebAssembly-Code ist im Binärformat vorhanden.  Dies bedeutet, dass ein solcher Code kleiner als ein ähnlicher JavaScript-Code ist und schneller geladen wird.  Wasm-Code kann außerdem im <a href="https://developer.mozilla.org/en-US/docs/WebAssembly/Understanding_the_text_format">Textformat dargestellt werden</a> , sodass die Benutzer ihn lesen und bearbeiten können. <br><br>  Als der WebAssembly-Standard zum ersten Mal erschien, dachten einige Entwickler, dass er JavaScript ersetzen und die Hauptsprache des Webs werden könnte.  WebAssembly wird jedoch am besten als neues Tool angesehen, das sich gut in die vorhandene Webplattform integrieren lässt.  Dies ist eines seiner <a href="https://webassembly.org/docs/high-level-goals/">vorrangigen Ziele</a> . <br><br>  Anstatt JavaScript zu ersetzen, wo diese Sprache lange und erfolgreich verwendet wurde, bietet WebAssembly neue interessante Möglichkeiten für Webentwickler.  Zwar hat der Wasm-Code keinen direkten Zugriff auf das DOM, daher verwenden die meisten vorhandenen Webprojekte weiterhin JavaScript.  Diese Sprache ist im Laufe der Jahre der Entwicklung und Optimierung bereits recht schnell.  Und WebAssembly verfügt über eigene <a href="https://webassembly.org/docs/use-cases/">Anwendungen</a> : <br><br><ul><li>  Spiele </li><li>  Wissenschaftliche Berechnungen, Visualisierungen, Simulationen. </li><li>  CAD-Anwendungen. </li><li>  Bearbeiten von Bildern und Videos. </li></ul><br>  Alle diese Verwendungszwecke von Wasm werden durch das vereinigt, was ihre jeweiligen Anwendungen normalerweise als Desktop betrachten.  Aufgrund der Tatsache, dass Sie mit WebAssembly ein Leistungsniveau erreichen können, das dem von Native nahekommt, können viele ähnliche Anwendungen jetzt über die Webplattform implementiert werden. <br><br>  WebAssembly kann vorhandene Webprojekte nutzen.  Ein Beispiel ist das <a href="https://www.figma.com/">Figma-</a> Projekt.  Dank der Wasm-Anwendung konnte die Ladezeit dieses Projekts erheblich verbessert werden.  Wenn eine Website Code verwendet, der umfangreiche Berechnungen durchführt, ist es zur Verbesserung der Leistung dieser Website sinnvoll, nur diesen Code durch ein WebAssembly-Analogon zu ersetzen. <br><br>  Möglicherweise möchten Sie versuchen, WebAssembly in Ihren eigenen Projekten zu verwenden.  Diese Sprache kann sofort gelernt und geschrieben werden.  Dennoch wurde WebAssembly ursprünglich als <a href="https://github.com/appcypher/awesome-wasm-langs">Kompilierungsziel</a> für andere Sprachen entwickelt.  Es wurde mit guter Unterstützung für C und C ++ entwickelt.  Wasm <a href="">experimentelle Unterstützung</a> erschien in Go 1.11.  Es wird viel Mühe darauf verwendet, Wasm-Anträge in <a href="https://www.rust-lang.org/what/wasm">Rust</a> zu schreiben. <br><br>  Es ist jedoch durchaus möglich, dass Webentwickler C, C ++, Go oder Rust nicht nur zur Verwendung von WebAssembly erlernen möchten.  Was machen sie?  Die Antwort auf diese Frage kann AssemblyScript geben. <br><br><h2>  <font color="#3AC1EF">AssemblyScript</font> </h2><br>  AssemblyScript ist ein Compiler, der TypeScript-Code in WebAssembly-Code konvertiert.  TypeScript ist eine von Microsoft entwickelte Sprache.  Dies ist eine Obermenge von JavaScript mit verbesserter Typunterstützung und einigen anderen Funktionen.  TypeScript ist eine ziemlich <a href="https://insights.stackoverflow.com/survey/2019">beliebte</a> Sprache geworden.  Es ist zu beachten, dass AssemblyScript nur eine begrenzte Anzahl von TypeScript-Konstrukten in Wasm konvertieren kann.  Dies bedeutet, dass auch jemand, der nicht mit TypeScript vertraut ist, diese Sprache schnell auf einem Niveau erlernen kann, das ausreicht, um Code zu schreiben, den AssemblyScript versteht. <br><br>  Angesichts der Tatsache, dass TypeScript JavaScript sehr ähnlich ist, können wir sagen, dass mit der AssemblyScript-Technologie Webentwickler problemlos Wasm-Module in ihre Projekte integrieren können, ohne eine komplett neue Sprache erlernen zu müssen. <br><br><h2>  <font color="#3AC1EF">Beispiel</font> </h2><br>  Schreiben wir unser erstes AssemblyScript-Modul.  Der gesamte Code, den wir jetzt diskutieren werden, ist auf <a href="https://github.com/dguo/assemblyscript-demo">GitHub</a> zu finden.  Zur <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly">Unterstützung von</a> WebAssembly benötigen wir mindestens <a href="https://nodejs.org/">Node.js</a> 8. <br><br>  Erstellen Sie ein neues Verzeichnis, initialisieren Sie das npm-Projekt und installieren Sie AssemblyScript: <br><br><pre><code class="javascript hljs">mkdir assemblyscript-demo cd assemblyscript-demo npm init npm install --save-dev github:AssemblyScript/assemblyscript</code> </pre> <br>  Beachten Sie, dass AssemblyScript direkt vom <a href="https://github.com/AssemblyScript/assemblyscript">GitHub-Repository des</a> Projekts installiert werden muss.  AssemblyScript wurde noch nicht in npm veröffentlicht, da die Entwickler <a href="https://github.com/AssemblyScript/assemblyscript/issues/442">es noch nicht</a> für weit verbreitet halten. <br><br>  Wir werden Hilfsdateien mit dem in AssemblyScript <code>asinit</code> Befehl <code>asinit</code> erstellen: <br><br><pre> <code class="javascript hljs">npx asinit .</code> </pre> <br>  Nun sollte der <code>package.json</code> unserer <code>package.json</code> die folgende Form haben: <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: {    <span class="hljs-string"><span class="hljs-string">"asbuild:untouched"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/untouched.wasm -t build/untouched.wat --sourceMap --validate --debug"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild:optimized"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/optimized.wasm -t build/optimized.wat --sourceMap --validate --optimize"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run asbuild:untouched &amp;&amp; npm run asbuild:optimized"</span></span>  } }</code> </pre> <br>  Die Datei <code>index.js</code> im Stammverzeichnis des Projekts sieht folgendermaßen aus: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"fs"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> compiled = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebAssembly.Module(fs.readFileSync(__dirname + <span class="hljs-string"><span class="hljs-string">"/build/optimized.wasm"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> imports = {  <span class="hljs-attr"><span class="hljs-attr">env</span></span>: {    abort(_msg, _file, line, column) {       <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(<span class="hljs-string"><span class="hljs-string">"abort called at index.ts:"</span></span> + line + <span class="hljs-string"><span class="hljs-string">":"</span></span> + column);    }  } }; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(<span class="hljs-built_in"><span class="hljs-built_in">module</span></span>, <span class="hljs-string"><span class="hljs-string">"exports"</span></span>, {  <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebAssembly.Instance(compiled, imports).exports });</code> </pre> <br>  Auf diese Weise können Sie WebAssembly-Module mit dem Befehl <a href="https://nodejs.org/api/modules.html">require</a> in Ihren Code aufnehmen.  Das heißt - genauso wie normale JavaScript-Module verbunden sind. <br><br>  Der <code>assembly</code> enthält die Datei <code>index.ts</code> .  Der Quellcode wurde gemäß den AssemblyScript-Regeln geschrieben.  Der automatisch generierte Kesselschildcode ist eine einfache Funktion zum Hinzufügen von zwei Zahlen: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a: i32, b: i32</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i32</span></span></span><span class="hljs-function"> </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b; }</code> </pre> <br>  Vielleicht haben Sie erwartet, dass die Signatur einer ähnlichen Funktion wie <code>add(a: number, b: number): number</code> aussieht: <code>add(a: number, b: number): number</code> .  Es würde also so aussehen, als ob es in normalem TypeScript geschrieben wäre.  Hier wird jedoch anstelle der Typennummer der Typ <code>i32</code> .  Dies liegt daran, dass AssemblyScript-Code bestimmte <a href="https://docs.assemblyscript.org/basics/types">WebAssembly-Typen</a> für Ganzzahlen und Gleitkommazahlen verwendet und nicht den generischen Zahlentyp von TypeScript. <br><br>  Lassen Sie uns das Projekt zusammenstellen: <br><br><pre> <code class="javascript hljs">npm run asbuild</code> </pre> <br>  Die folgenden Dateien sollten im <code>build</code> angezeigt werden: <br><br><pre> <code class="javascript hljs">optimized.wasm optimized.wasm.map optimized.wat untouched.wasm untouched.wasm.map untouched.wat</code> </pre> <br>  Es gibt optimierte und reguläre Versionen der Baugruppe.  Jede Version der Assembly enthält eine binäre .wasm-Datei, eine <a href="https://developer.mozilla.org/en-US/docs/Tools/Debugger/How_to/Use_a_source_map">Map-Map</a> .wasm.map und eine Textdarstellung des Binärcodes in einer .wat-Datei.  Die Testpräsentation des Wasm-Codes ist für den Programmierer gedacht, aber wir werden uns diese Datei nicht einmal ansehen.  Tatsächlich ist einer der Gründe für die Verwendung von AssemblyScript, dass die Arbeit mit Wasm-Code entfällt. <br><br>  Führen Sie nun Node.js im REPL-Modus aus und stellen Sie sicher, dass das kompilierte Wasm-Modul auf die gleiche Weise wie jedes andere reguläre JS-Modul verwendet werden kann: <br><br><pre> <code class="javascript hljs">$ node Welcome to Node.js v12<span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>. Type <span class="hljs-string"><span class="hljs-string">".help"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> more information. &gt; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> add = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./index'</span></span>).add; <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> &gt; add(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span></code> </pre> <br>  Im Allgemeinen ist dies alles, was für die Verwendung der WebAssembly-Technologie in Node.js erforderlich ist. <br><br><h2>  <font color="#3AC1EF">Ein Projekt mit einem Beobachter-Skript ausstatten</font> </h2><br>  Um das Modul bei Änderungen während der Entwicklung automatisch neu zu <a href="https://github.com/Qard/onchange">erstellen</a> , empfehle ich die Verwendung des Pakets <a href="https://github.com/Qard/onchange">onchange</a> .  Tatsache ist, dass AssemblyScript <a href="https://github.com/AssemblyScript/assemblyscript/issues/624">noch kein</a> eigenes System zur Überwachung von Dateiänderungen besitzt.  Installieren Sie das onchange-Paket: <br><br><pre> <code class="javascript hljs">npm install --save-dev onchange</code> </pre> <br>  Fügen Sie <code>asbuild:watch</code> script zu <code>package.json</code> .  <a href="https://github.com/Qard/onchange">Das Flag</a> <code>-i</code> <a href="https://github.com/Qard/onchange">ist</a> im Befehl enthalten, sodass der Erstellungsprozess einmal beim Aufrufen des Skripts gestartet wird, bevor Ereignisse auftreten. <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: {    <span class="hljs-string"><span class="hljs-string">"asbuild:untouched"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/untouched.wasm -t build/untouched.wat --sourceMap --validate --debug"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild:optimized"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/optimized.wasm -t build/optimized.wat --sourceMap --validate --optimize"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run asbuild:untouched &amp;&amp; npm run asbuild:optimized"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild:watch"</span></span>: <span class="hljs-string"><span class="hljs-string">"onchange -i 'assembly/**/*' -- npm run asbuild"</span></span>  } }</code> </pre> <br>  Anstatt den Befehl <code>asbuild</code> ständig <code>asbuild</code> , führen Sie <code>asbuild:watch</code> once. <br><br><h2>  <font color="#3AC1EF">Leistung</font> </h2><br>  Wir werden einen einfachen Test schreiben, der das Leistungsniveau des Wasm-Codes bewertet.  Der Hauptumfang von WebAssembly besteht darin, Aufgaben zu lösen, die den Prozessor intensiv nutzen.  Dies sind zum Beispiel „schwere“ Berechnungen.  Lassen Sie uns eine Funktion erstellen, die herausfindet, ob eine bestimmte Zahl eine Primzahl ist. <br><br>  Die grundlegende JS-Implementierung einer ähnlichen Funktion ist unten dargestellt.  Es ist sehr einfach aufgebaut, es prüft die Zahl mit roher Gewalt, aber für unsere Zwecke ist es geeignet, da es viele Berechnungen durchführt. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPrime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;    }    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; x; i++) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x % i === <span class="hljs-number"><span class="hljs-number">0</span></span>) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br>  Eine ähnliche Funktion, die für den AssemblyScript-Compiler geschrieben wurde, sieht fast gleich aus.  Der Hauptunterschied ist das Vorhandensein von Typanmerkungen im Code: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPrime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x: u32</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;    }    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i: u32 = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; x; i++) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x % i === <span class="hljs-number"><span class="hljs-number">0</span></span>) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br>  Um die Leistung des Codes zu analysieren, verwenden wir das Paket <a href="https://benchmarkjs.com/">Benchmark.js</a> .  Installiere es: <br><br><pre> <code class="javascript hljs">npm install --save-dev benchmark</code> </pre> <br>  Erstellen Sie die Datei <code>benchmark.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Benchmark = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'benchmark'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> assemblyScriptIsPrime = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./index'</span></span>).isPrime; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPrime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; x; i++) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x % i === <span class="hljs-number"><span class="hljs-number">0</span></span>) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> suite = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Benchmark.Suite; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> startNumber = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> stopNumber = <span class="hljs-number"><span class="hljs-number">10000</span></span>; suite.add(<span class="hljs-string"><span class="hljs-string">'AssemblyScript isPrime'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = startNumber; i &lt; stopNumber; i++) {        assemblyScriptIsPrime(i);    } }).add(<span class="hljs-string"><span class="hljs-string">'JavaScript isPrime'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = startNumber; i &lt; stopNumber; i++) {        isPrime(i);    } }).on(<span class="hljs-string"><span class="hljs-string">'cycle'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{    <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>(event.target)); }).on(<span class="hljs-string"><span class="hljs-string">'complete'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fastest = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filter(<span class="hljs-string"><span class="hljs-string">'fastest'</span></span>);    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> slowest = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filter(<span class="hljs-string"><span class="hljs-string">'slowest'</span></span>);    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> difference = (fastest.map(<span class="hljs-string"><span class="hljs-string">'hz'</span></span>) - slowest.map(<span class="hljs-string"><span class="hljs-string">'hz'</span></span>)) / slowest.map(<span class="hljs-string"><span class="hljs-string">'hz'</span></span>) * <span class="hljs-number"><span class="hljs-number">100</span></span>;    <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${fastest.map(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'name'</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string"> is ~</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${difference.toFixed(</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">% faster.`</span></span>); }).run();</code> </pre> <br>  Folgendes gelang mir, nachdem ich den Befehl <code>node benchmark</code> auf meinem Computer ausgeführt hatte: <br><br><pre> <code class="javascript hljs">AssemblyScript isPrime x <span class="hljs-number"><span class="hljs-number">74.00</span></span> ops/sec ±<span class="hljs-number"><span class="hljs-number">0.43</span></span>% (<span class="hljs-number"><span class="hljs-number">76</span></span> runs sampled) JavaScript isPrime x <span class="hljs-number"><span class="hljs-number">61.56</span></span> ops/sec ±<span class="hljs-number"><span class="hljs-number">0.30</span></span>% (<span class="hljs-number"><span class="hljs-number">64</span></span> runs sampled) AssemblyScript isPrime is ~<span class="hljs-number"><span class="hljs-number">20.2</span></span>% faster.</code> </pre> <br>  Wie Sie sehen, war die AssemblyScript-Implementierung des Algorithmus 20% schneller als die JS-Implementierung.  Beachten Sie jedoch, dass dieser Test ein <a href="https://stackoverflow.com/a/2842707/1481479">Mikrobenchmark ist</a> .  Verlassen Sie sich nicht zu sehr auf die Ergebnisse. <br><br>  Um zuverlässigere Ergebnisse der Performance-Recherche von AssemblyScript-Projekten zu erhalten, empfehle ich Ihnen, sich <a href="https://wasmboy.app/benchmark/">dieses</a> und <a href="https://jtiscione.github.io/webassembly-wave/index.html">dieses</a> Benchmark anzusehen. <br><br><h2>  <font color="#3AC1EF">Verwenden eines Wasm-Moduls auf einer Webseite</font> </h2><br>  Lassen Sie uns unser Wasm-Modul auf einer Webseite verwenden.  Wir beginnen mit der Erstellung einer <code>index.html</code> Datei mit folgendem Inhalt: <br><br><pre> <code class="javascript hljs">&lt;!DOCTYPE html&gt; &lt;html&gt;    &lt;head&gt;        &lt;meta charset="utf-8" /&gt;        &lt;title&gt;AssemblyScript isPrime demo&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;form id="prime-checker"&gt;            &lt;label for="number"&gt;Enter a number to check if it is prime:&lt;/label&gt;            &lt;input name="number" type="number" /&gt;            &lt;button type="submit"&gt;Submit&lt;/button&gt;        &lt;/form&gt;        &lt;p id="result"&gt;&lt;/p&gt;        &lt;script src="demo.js"&gt;&lt;/script&gt;    &lt;/body&gt; &lt;/html&gt;</code> </pre> <br>  Erstellen Sie nun die Datei <code>demo.js</code> , deren Code unten angezeigt wird.  Es gibt <a href="https://developers.google.com/web/updates/2018/04/loading-wasm">viele Möglichkeiten,</a> WebAssembly-Module <a href="https://developers.google.com/web/updates/2018/04/loading-wasm">zu</a> laden.  Am effizientesten ist das Kompilieren und Initialisieren im Streaming-Modus mit der Funktion <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly/instantiateStreaming">WebAssembly.instantiateStreaming</a> .  Bitte beachten Sie, dass wir die Abbruchfunktion neu definieren müssen, die aufgerufen wird, wenn eine <a href="https://docs.assemblyscript.org/basics/environment">Anweisung</a> nicht ausgeführt wird. <br><br><pre> <code class="javascript hljs">(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; {    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> importObject = {        <span class="hljs-attr"><span class="hljs-attr">env</span></span>: {            abort(_msg, _file, line, column) {                <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(<span class="hljs-string"><span class="hljs-string">"abort called at index.ts:"</span></span> + line + <span class="hljs-string"><span class="hljs-string">":"</span></span> + column);            }        }    };    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> WebAssembly.instantiateStreaming(        fetch(<span class="hljs-string"><span class="hljs-string">"build/optimized.wasm"</span></span>),        importObject    );    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isPrime = <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.instance.exports.isPrime;    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"#result"</span></span>);    <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"#prime-checker"</span></span>).addEventListener(<span class="hljs-string"><span class="hljs-string">"submit"</span></span>, event =&gt; {        event.preventDefault();        result.innerText = <span class="hljs-string"><span class="hljs-string">""</span></span>;        <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> number = event.target.elements.number.value;        result.innerText = <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${number}</span></span></span><span class="hljs-string"> is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${isPrime(number) ? </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">''</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> : </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'not '</span></span></span></span><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class="hljs-string">prime.`</span></span>;    }); })();</code> </pre> <br>  Installieren Sie als Nächstes das <a href="https://github.com/nbluis/static-server">Static-Server-</a> Paket.  Wir benötigen einen Server, da zur Verwendung der Funktion <code>WebAssembly.instantiateStreaming</code> das Modul mit dem MIME-Typ <code>application/wasm</code> gewartet werden muss. <br><br><pre> <code class="javascript hljs">npm install --save-dev <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>-server</code> </pre> <br>  Fügen Sie das entsprechende Skript zu <code>package.json</code> : <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: {    <span class="hljs-string"><span class="hljs-string">"serve-demo"</span></span>: <span class="hljs-string"><span class="hljs-string">"static-server"</span></span>  } }</code> </pre> <br>  <code>npm run serve-demo</code> Befehl <code>npm run serve-demo</code> und öffnen Sie die lokale Host-URL im Browser.  Wenn Sie eine bestimmte Zahl in das Formular eingeben, können Sie herausfinden, ob es einfach ist oder nicht.  Bei der Entwicklung von AssemblyScript haben wir den Weg vom Schreiben von Code zur Verwendung in Node.js und auf einer Webseite weit zurückgelegt. <br><br><h2>  <font color="#3AC1EF">Zusammenfassung</font> </h2><br>  WebAssembly und damit auch AssemblyScript können Websites nicht auf magische Weise beschleunigen.  Aber Wasm wurde nie beauftragt, absolut alles zu beschleunigen.  Diese Technologie ist insofern bemerkenswert, als sie den Zugang zum Internet für neue Arten von Anwendungen eröffnet. <br><br>  Ähnliches gilt für AssemblyScript.  Diese Technologie vereinfacht den Zugriff auf WebAssembly für eine große Anzahl von Entwicklern.  Wenn Sie Code in einer Sprache in der Nähe von JavaScript erstellen, können Sie mit den Funktionen von WebAssembly komplexe Rechenprobleme lösen. <br><br>  <b>Sehr geehrte Leser!</b>  Wie beurteilen Sie die Aussichten für die Verwendung von AssemblyScript in Ihren Projekten? <br><br><div style="text-align:center;"> <a href="https://ruvds.com/vps_start/"><img src="https://habrastorage.org/webt/-o/2e/tu/-o2etuqogwhmdnmysb9_vivc9v4.png"></a> </div><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de477272/">https://habr.com/ru/post/de477272/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de477256/index.html">Der erste vollständige Start von OneWeb mit der Trägerrakete Sojus wird im nächsten Jahr verschoben, ebenso wie der Start der Trägerrakete Angara</a></li>
<li><a href="../de477262/index.html">Androiden der Firma Promobot. Seitenansicht</a></li>
<li><a href="../de477264/index.html">Der Bagger wurde zu einem autonomen Roboter, der Gräben selbständig ausheben kann</a></li>
<li><a href="../de477266/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends für die letzte Woche Nr. 390 (18.-24. November 2019)</a></li>
<li><a href="../de477268/index.html">Suchlösungsoptimierung auf Github</a></li>
<li><a href="../de477274/index.html">Wie werden Sie nicht verwendeten CSS-Code los? Teil 1</a></li>
<li><a href="../de477276/index.html">Wie werden Sie nicht verwendeten CSS-Code los? Teil 2</a></li>
<li><a href="../de477278/index.html">Frontend-Test</a></li>
<li><a href="../de477282/index.html">Profiling Go-Projektcode und Beheben von Speicherzuordnungsproblemen</a></li>
<li><a href="../de477284/index.html">Warum ist JavaScript im strikten Modus erforderlich?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>