<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš£ğŸ» ğŸ“• ğŸ‘§ğŸ¾ ä»»åŠ¡è®¡åˆ’ç¨‹åºæ¼”å˜ ğŸ‘µğŸ¿ â†”ï¸ ğŸ’—</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„iFunnyåº”ç”¨ç¨‹åºå·²ç»åœ¨å•†åº—ä¸­ä½¿ç”¨äº†äº”å¹´ä»¥ä¸Šã€‚ åœ¨è¿™æ®µæ—¶é—´é‡Œï¼Œç§»åŠ¨å›¢é˜Ÿä¸å¾—ä¸ç»å†è®¸å¤šä¸åŒçš„æ–¹æ³•ä»¥åŠå·¥å…·ä¹‹é—´çš„è¿ç§»ï¼Œè€Œä¸€å¹´å‰ï¼Œæœ‰ä¸€æ®µæ—¶é—´éœ€è¦ä»è‡ªå†™è§£å†³æ–¹æ¡ˆåˆ‡æ¢åˆ°æ›´â€œæ—¶å°šâ€å’Œæ›´å¹¿æ³›çš„æ–¹å‘ã€‚ æœ¬æ–‡åªæ˜¯å¯¹ç ”ç©¶çš„å†…å®¹ï¼Œç ”ç©¶çš„è§£å†³æ–¹æ¡ˆä»¥åŠæœ€ç»ˆçš„è§£å†³æ–¹æ¡ˆè¿›è¡Œäº†å°å¹…æŒ¤å‹ã€‚ 

 ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦æ‰€æœ‰è¿™...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä»»åŠ¡è®¡åˆ’ç¨‹åºæ¼”å˜</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/funcorp/blog/434680/"><img src="https://habrastorage.org/webt/bv/mr/ps/bvmrpspwu-kyhojb5tiu4lqbdi8.jpeg"><br><br> æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„iFunnyåº”ç”¨ç¨‹åºå·²ç»åœ¨å•†åº—ä¸­ä½¿ç”¨äº†äº”å¹´ä»¥ä¸Šã€‚ åœ¨è¿™æ®µæ—¶é—´é‡Œï¼Œç§»åŠ¨å›¢é˜Ÿä¸å¾—ä¸ç»å†è®¸å¤šä¸åŒçš„æ–¹æ³•ä»¥åŠå·¥å…·ä¹‹é—´çš„è¿ç§»ï¼Œè€Œä¸€å¹´å‰ï¼Œæœ‰ä¸€æ®µæ—¶é—´éœ€è¦ä»è‡ªå†™è§£å†³æ–¹æ¡ˆåˆ‡æ¢åˆ°æ›´â€œæ—¶å°šâ€å’Œæ›´å¹¿æ³›çš„æ–¹å‘ã€‚ æœ¬æ–‡åªæ˜¯å¯¹ç ”ç©¶çš„å†…å®¹ï¼Œç ”ç©¶çš„è§£å†³æ–¹æ¡ˆä»¥åŠæœ€ç»ˆçš„è§£å†³æ–¹æ¡ˆè¿›è¡Œäº†å°å¹…æŒ¤å‹ã€‚ <a name="habracut"></a><br><br>  <b>ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦æ‰€æœ‰è¿™äº›ï¼Ÿ</b> <br><br> ä¸ºäº†çºªå¿µæœ¬æ–‡çš„å†…å®¹ä»¥åŠä¸ºä»€ä¹ˆè¿™ä¸ªä¸»é¢˜å¯¹Androidå¼€å‘å›¢é˜Ÿéå¸¸é‡è¦ï¼Œè®©æˆ‘ä»¬ç«‹å³åšå‡ºå†³å®šï¼š <br><br><ol><li> åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦åœ¨æ´»åŠ¨ç”¨æˆ·ç•Œé¢æ¡†æ¶ä¹‹å¤–è¿è¡Œä»»åŠ¡ã€‚ </li><li> ç³»ç»Ÿå¯¹æ­¤ç±»ä»»åŠ¡çš„å¯åŠ¨æ–½åŠ äº†å¾ˆå¤šé™åˆ¶ï¼› </li><li> äº‹å®è¯æ˜ï¼Œåœ¨æ¯ç§ç°æœ‰è§£å†³æ–¹æ¡ˆä¹‹é—´è¿›è¡Œé€‰æ‹©éå¸¸å›°éš¾ï¼Œå› ä¸ºæ¯ç§å·¥å…·éƒ½æœ‰å…¶ä¼˜ç¼ºç‚¹ã€‚ </li></ol><br><h3>  <b>äº‹ä»¶å‘å±•çš„å¹´ä»£</b> </h3><br>  <b>Android 0</b> <b><br></b> <h3>  AlarmManagerï¼Œå¤„ç†ç¨‹åºï¼ŒæœåŠ¡ </h3><br> æœ€åˆï¼Œå®æ–½ä»–ä»¬çš„è§£å†³æ–¹æ¡ˆæ˜¯ä¸ºäº†åŸºäºæœåŠ¡å¯åŠ¨åŸºäºåå°çš„ä»»åŠ¡ã€‚ è¿˜æœ‰ä¸€ç§æœºåˆ¶å¯ä»¥å°†ä»»åŠ¡é“¾æ¥åˆ°ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶å¯ä»¥å–æ¶ˆå’Œæ¢å¤å®ƒä»¬ã€‚ è¿™å¾ˆé€‚åˆå›¢é˜Ÿä½¿ç”¨å¾ˆé•¿æ—¶é—´ï¼Œå› ä¸ºè¯¥å¹³å°æ²¡æœ‰å¯¹æ­¤ç±»ä»»åŠ¡æ–½åŠ ä»»ä½•é™åˆ¶ã€‚ <br>  Googleå»ºè®®æ ¹æ®ä»¥ä¸‹å›¾è¡¨è¿›è¡Œæ“ä½œï¼š <br><br><img src="https://habrastorage.org/webt/e-/46/zn/e-46znleyxvynpm35pbebgrkdhk.png"><br><br> åˆ°2018å¹´åº•ï¼Œäº†è§£è¿™ä¸€ç‚¹æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œè¶³ä»¥è¯„ä¼°ç¾éš¾çš„è§„æ¨¡ã€‚ <br> å®é™…ä¸Šï¼Œæ²¡æœ‰äººå…³å¿ƒåå°å‘ç”Ÿäº†å¤šå°‘å·¥ä½œã€‚ åº”ç”¨ç¨‹åºå®Œæˆäº†ä»–ä»¬æƒ³è¦çš„å·¥ä½œï¼Œå¹¶åœ¨éœ€è¦æ—¶å®Œæˆäº†å·¥ä½œã€‚ <br><br>  <i><b>ä¼˜ç‚¹</b> ï¼š</i> <i><br></i>  <i>éšå¤„å¯è§ï¼›</i> <i><br></i>  <i>æ‰€æœ‰äººéƒ½å¯ä»¥ä½¿ç”¨ã€‚</i> <i><br><br></i>  <i><b>ç¼ºç‚¹</b> ï¼š</i> <i><br></i>  <i>ç³»ç»Ÿä»¥å„ç§æ–¹å¼é™åˆ¶å·¥ä½œï¼›</i> <i><br></i>  <i>æ²¡æœ‰æ¡ä»¶å‘å°„ï¼›</i> <i><br></i>  <i>è¯¥APIæœ€å°‘ï¼Œæ‚¨éœ€è¦ç¼–å†™å¤§é‡ä»£ç ã€‚</i> <i><br></i> <br>  <b>Android 5.æ£’æ£’ç³–</b> <b><br></b> <h3>  Jobcheduler </h3><br> åœ¨æ¥è¿‘2015å¹´çš„5ï¼ˆï¼ï¼‰å¹´ä¹‹åï¼ŒGoogleæ³¨æ„åˆ°ä»»åŠ¡æ‰§è¡Œæ•ˆç‡ä½ä¸‹ã€‚ ç”¨æˆ·å¼€å§‹ç»å¸¸æŠ±æ€¨è¯´ï¼Œä»–ä»¬çš„æ‰‹æœºåªæ˜¯èººåœ¨æ¡Œå­ä¸Šæˆ–æ”¾åœ¨å£è¢‹é‡Œå°±æ²¡ç”µäº†ã€‚ <br><br> éšç€Android 5çš„å‘å¸ƒï¼Œå‡ºç°äº†ç±»ä¼¼JobSchedulerçš„å·¥å…·ã€‚ è¿™æ˜¯ä¸€ç§å¯ä»¥åœ¨åå°è¿›è¡Œå„ç§å·¥ä½œçš„æœºåˆ¶ï¼Œç”±äºå¯åŠ¨è¿™äº›ä»»åŠ¡çš„é›†ä¸­ç³»ç»Ÿä»¥åŠä¸ºå¯åŠ¨è¯¥ä»»åŠ¡è®¾å®šæ¡ä»¶çš„èƒ½åŠ›ï¼Œè¯¥æœºåˆ¶çš„å¼€å§‹å¾—åˆ°äº†ä¼˜åŒ–å’Œç®€åŒ–ã€‚ <br><br> åœ¨ä»£ç ä¸­ï¼Œæ‰€æœ‰è¿™äº›çœ‹èµ·æ¥éƒ½éå¸¸ç®€å•ï¼šå®£å¸ƒäº†å…¶ä¸­åŒ…å«å¼€å§‹å’Œç»“æŸäº‹ä»¶çš„æœåŠ¡ã€‚ <br> ä»ç»†å¾®å·®åˆ«ï¼šå¦‚æœè¦å¼‚æ­¥æ‰§è¡Œå·¥ä½œï¼Œåˆ™éœ€è¦ä»onStartJobå¯åŠ¨æµï¼› æœ€ä¸»è¦çš„æ˜¯ä¸è¦å¿˜è®°åœ¨å·¥ä½œç»“æŸæ—¶è°ƒç”¨jobFinishedæ–¹æ³•ï¼Œå¦åˆ™ç³»ç»Ÿä¸ä¼šæ”¾å¼€WakeLockï¼Œæ‚¨çš„ä»»åŠ¡å°†ä¸ä¼šè¢«è§†ä¸ºå·²å®Œæˆå¹¶ä¸”ä¼šä¸¢å¤±ã€‚ <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JobSchedulerService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JobService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStartJob</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JobParameters params)</span></span></span><span class="hljs-function"> </span></span>{ doWork(params); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStopJob</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JobParameters params)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } }</code> </pre> <br> æ‚¨å¯ä»¥ä»åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•ä½ç½®å¯åŠ¨æ­¤å·¥ä½œã€‚ ä»»åŠ¡åœ¨æˆ‘ä»¬çš„æµç¨‹ä¸­æ‰§è¡Œï¼Œä½†åœ¨IPCçº§åˆ«å¯åŠ¨ã€‚ æœ‰ä¸€ä¸ªé›†ä¸­çš„æœºåˆ¶æ¥æ§åˆ¶å®ƒä»¬çš„æ‰§è¡Œï¼Œå¹¶ä»…åœ¨å¿…è¦æ—¶æ‰å”¤é†’åº”ç”¨ç¨‹åºã€‚ æ‚¨è¿˜å¯ä»¥è®¾ç½®å„ç§è§¦å‘æ¡ä»¶ï¼Œå¹¶é€šè¿‡æ†ç»‘åŒ…ä¼ è¾“æ•°æ®ã€‚ <br><br><pre> <code class="java hljs">JobInfo task = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JobInfo.Builder(JOB_ID, serviceName) .setRequiredNetworkType(JobInfo.NETWORK_TYPE_UNMETERED) .setRequiresDeviceIdle(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) .setRequiresCharging(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) .build(); JobScheduler scheduler = (JobScheduler) context.getSystemService(JOB_SCHEDULER_SERVICE); scheduler.schedule(task);</code> </pre> <br> æ€»çš„æ¥è¯´ï¼Œç›¸æ¯”ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œè¿™å·²ç»æ˜¯ä»€ä¹ˆäº†ã€‚ ä½†æ˜¯ï¼Œè¯¥æœºåˆ¶ä»…åœ¨API 21ä¸­å¯ç”¨ï¼Œå¹¶ä¸”åœ¨Android 5.0å‘è¡Œæ—¶ï¼Œåœæ­¢æ”¯æŒæ‰€æœ‰æ—§è®¾å¤‡ï¼ˆå·²ç»è¿‡å»äº†3å¹´ï¼Œå¹¶ä¸”æˆ‘ä»¬ä»ç„¶æ”¯æŒFoursï¼‰ä¼šå¾ˆå¥‡æ€ªã€‚ <br><br>  <i><b>ä¼˜ç‚¹</b> ï¼š</i> <i><br></i>  <i>APIå¾ˆç®€å•ï¼›</i> <i><br></i>  <i>å‘å°„æ¡ä»¶ã€‚</i> <i><br></i> <br>  <b><i>ç¼ºç‚¹</i></b> ï¼š <br>  <s>ä»API 21å¼€å§‹å¯ç”¨</s> <br> å®é™…ä¸Šï¼Œä»…ä½¿ç”¨APIâ€‹â€‹ 23ï¼› <br> å®¹æ˜“çŠ¯é”™è¯¯ã€‚ <br><br>  <b>Android 5.æ£’æ£’ç³–</b> <b><br></b> <h3>  <b>GCMç½‘ç»œç»ç†</b> </h3><br> è¿˜ä»‹ç»äº†JobSchedulerçš„ç±»ä¼¼ç‰©-GCMç½‘ç»œç®¡ç†å™¨ã€‚ è¿™æ˜¯ä¸€ä¸ªæä¾›ç›¸ä¼¼åŠŸèƒ½çš„åº“ï¼Œä½†å·²ç»ä¸API 9ä¸€èµ·ä½¿ç”¨ã€‚ç¡®å®ï¼Œå®ƒéœ€è¦Google PlayæœåŠ¡ä½œä¸ºå›æŠ¥ã€‚ æ˜¾ç„¶ï¼ŒJobSchedulerå·¥ä½œæ‰€éœ€çš„åŠŸèƒ½ä¸ä»…å¼€å§‹é€šè¿‡Androidç‰ˆæœ¬æä¾›ï¼Œè€Œä¸”è¿˜å¼€å§‹åœ¨GPSçº§åˆ«æä¾›ã€‚ åº”å½“æŒ‡å‡ºï¼Œè¯¥æ¡†æ¶çš„å¼€å‘äººå‘˜å¾ˆå¿«æ”¹å˜äº†ä¸»æ„ï¼Œå¹¶å†³å®šä¸å°†ä»–ä»¬çš„æœªæ¥ä¸GPSè¿æ¥èµ·æ¥ã€‚ å¤šäºäº†ä»–ä»¬ã€‚ <br><br> ä¸€åˆ‡çœ‹èµ·æ¥éƒ½å®Œå…¨ç›¸åŒã€‚ ç›¸åŒçš„æœåŠ¡ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GcmNetworkManagerService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GcmTaskService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onRunTask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TaskParams taskParams)</span></span></span><span class="hljs-function"> </span></span>{ doWork(taskParams); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre><br> ç›¸åŒçš„ä»»åŠ¡å¯åŠ¨ï¼š <br><br><pre> <code class="java hljs">OneoffTask task = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OneoffTask.Builder() .setService(GcmNetworkManagerService.class) .setTag(TAG) .setRequiredNetworkType(JobInfo.NETWORK_TYPE_UNMETERED) .setRequiresCharging(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) .build(); GcmNetworkManager mGcmNetworkManager = GcmNetworkManager.getInstance(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); mGcmNetworkManager.schedule(task);</code> </pre> <br> æ¶æ„çš„ç›¸ä¼¼æ€§æ˜¯ç”±ç»§æ‰¿çš„åŠŸèƒ½å’Œåœ¨å·¥å…·ä¹‹é—´è¿›è¡Œç®€å•è¿ç§»çš„æ„¿æœ›æ‰€å†³å®šçš„ã€‚ <br><br>  <i><b>ä¼˜ç‚¹</b> ï¼š</i> <i><br></i>  <i>ä¸JobSchedulerç±»ä¼¼çš„APIï¼›</i> <i><br></i>  <i>ä»API 9å¼€å§‹å¯ç”¨ã€‚</i> <i><br><br></i>  <i><b>ç¼ºç‚¹</b> ï¼š</i> <i><br></i>  <i>æ‚¨å¿…é¡»æ‹¥æœ‰Google PlayæœåŠ¡</i> <i><br></i>  <i>å®¹æ˜“çŠ¯é”™è¯¯ã€‚</i> <br><br>  <b>Android 5.æ£’æ£’ç³–</b> <b><br></b> <h3>  <b>å”¤é†’å¹¿æ’­æ¥æ”¶å™¨</b> </h3><br> æ¥ä¸‹æ¥ï¼Œæˆ‘å°†ç®€è¦ä»‹ç»JobSchedulerä¸­ä½¿ç”¨çš„ä¸€ç§åŸºæœ¬æœºåˆ¶ï¼Œå¼€å‘äººå‘˜å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ è¿™æ˜¯WakeLockåŠå…¶åŸºç¡€çš„WakefulBroadcastReceiverã€‚ <br><br> ä½¿ç”¨WakeLockï¼Œå¯ä»¥é˜²æ­¢ç³»ç»Ÿè¿›å…¥æŒ‚èµ·çŠ¶æ€ï¼Œå³ä¿æŒè®¾å¤‡å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚ å¦‚æœæˆ‘ä»¬æƒ³åšä¸€äº›é‡è¦çš„å·¥ä½œï¼Œè¿™æ˜¯å¿…è¦çš„ã€‚ <br> åˆ›å»ºWakeLockæ—¶ï¼Œå¯ä»¥æŒ‡å®šå…¶è®¾ç½®ï¼šæŒ‰ä½CPUï¼Œå±å¹•æˆ–é”®ç›˜ã€‚ <br><br><pre> <code class="java hljs">PowerManager pm = (PowerManager) context.getSystemService(Context.POWER_SERVICE) PowerManager.WakeLock wl = pm.newWakeLock(PARTIAL_WAKE_LOCK, <span class="hljs-string"><span class="hljs-string">"name"</span></span>) wl.acquire(timeout);</code> </pre> <br> åŸºäºæ­¤æœºåˆ¶ï¼ŒWakefulBroadcastReceiverå¯ä»¥å·¥ä½œã€‚ æˆ‘ä»¬å¯åŠ¨æœåŠ¡å¹¶æŒ‰ä½WakeLockã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleWakefulReceiver</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WakefulBroadcastReceiver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ Intent service = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(context, SimpleWakefulService.class); startWakefulService(context, service); } }</code> </pre> <br> æœåŠ¡å®Œæˆå¿…è¦çš„å·¥ä½œåï¼Œæˆ‘ä»¬é€šè¿‡ç±»ä¼¼çš„æ–¹æ³•å°†å…¶é‡Šæ”¾ã€‚ <br><br> é€šè¿‡4ä¸ªç‰ˆæœ¬ï¼Œæ­¤BroadcastReceiverå°†è¢«å¼ƒç”¨ï¼Œå¹¶åœ¨developer.android.comä¸Šä»‹ç»ä»¥ä¸‹æ›¿ä»£æ–¹æ¡ˆï¼š <br><br><ul><li>  JobScheduler; </li><li> ååŒå‰‘ </li><li> ä¸‹è½½ç®¡ç†å™¨ </li><li> ç”¨äºçª—å£çš„FLAG_KEEP_SCREEN_ONã€‚ </li></ul><br>  <b>Android 6.æ£‰èŠ±ç³–</b> <b><br></b> <h3>  <b>DozeModeï¼šéšæ—¶éšåœ°ç¡çœ </b> </h3><br> ç„¶åGoogleå¼€å§‹å¯¹è®¾å¤‡ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºè¿›è¡Œå„ç§ä¼˜åŒ–ã€‚ ä½†æ˜¯ï¼Œå¯¹ç”¨æˆ·è€Œè¨€æœ€ä¼˜åŒ–çš„æ˜¯å¯¹å¼€å‘äººå‘˜çš„é™åˆ¶ã€‚ <br><br> ç¬¬ä¸€æ­¥æ˜¯DozeModeï¼Œå¦‚æœè®¾å¤‡é—²ç½®äº†ä¸€æ®µæ—¶é—´ï¼Œå®ƒå°†è¿›å…¥ç¡çœ æ¨¡å¼ã€‚ åœ¨ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä¸­ï¼Œå®ƒæŒç»­ä¸€ä¸ªå°æ—¶ï¼Œåœ¨åç»­ç‰ˆæœ¬ä¸­ï¼Œç¡çœ æ—¶é—´å‡å°‘åˆ°30åˆ†é’Ÿã€‚ æ‰‹æœºä¼šå®šæœŸå”¤é†’ï¼Œæ‰§è¡Œæ‰€æœ‰å¾…å¤„ç†çš„ä»»åŠ¡ï¼Œç„¶åå†æ¬¡å…¥ç¡ã€‚  DozeModeçª—å£ä»¥æŒ‡æ•°å½¢å¼å±•å¼€ã€‚ å¯ä»¥é€šè¿‡adbè·Ÿè¸ªæ¨¡å¼ä¹‹é—´çš„æ‰€æœ‰è½¬æ¢ã€‚ <br><br> å½“å‘ç”ŸDozeModeæ—¶ï¼Œä¼šå¯¹åº”ç”¨ç¨‹åºæ–½åŠ ä»¥ä¸‹é™åˆ¶ï¼š <br><br><ul><li> ç³»ç»Ÿå°†å¿½ç•¥æ‰€æœ‰WakeLockï¼› </li><li>  AlarmManagerå»¶è¿Ÿï¼› </li><li>  JobScheduleræ— æ³•æ­£å¸¸å·¥ä½œï¼› </li><li>  SyncAdapteræ— æ³•æ­£å¸¸å·¥ä½œï¼› </li><li> ç½‘ç»œè®¿é—®å—åˆ°é™åˆ¶ã€‚ </li></ul><br> æ‚¨ä¹Ÿå¯ä»¥å°†åº”ç”¨ç¨‹åºæ·»åŠ åˆ°ç™½åå•ä¸­ï¼Œè¿™æ ·å®ƒå°±ä¸ä¼šå—åˆ°DozeModeçš„é™åˆ¶ï¼Œä½†æ˜¯è‡³å°‘ä¸‰æ˜Ÿå®Œå…¨å¿½ç•¥äº†æ­¤åˆ—è¡¨ã€‚ <br><br>  <b>Android 6.æ£‰èŠ±ç³–</b> <b><br></b> <h3>  <b>AppStandbyï¼šä¸æ´»åŠ¨çš„åº”ç”¨ç¨‹åº</b> </h3><br> ç³»ç»Ÿè¯†åˆ«ä¸æ´»åŠ¨çš„åº”ç”¨ç¨‹åºï¼Œå¹¶å¯¹å®ƒä»¬æ–½åŠ ä¸DozeModeä¸­ç›¸åŒçš„é™åˆ¶ã€‚ <br> åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ï¼Œä¼šå°†åº”ç”¨ç¨‹åºå‘é€åˆ°éš”ç¦»ï¼š <br><br><ul><li> åœ¨å‰å°æ²¡æœ‰è¿›ç¨‹ï¼› </li><li> æ²¡æœ‰æœ‰æ•ˆçš„é€šçŸ¥ï¼› </li><li> æœªæ·»åŠ åˆ°æ’é™¤åˆ—è¡¨ã€‚ </li></ul><br>  <b>Android 7.ç‰›è½§ç³–</b> <b><br></b> <h3>  <b>èƒŒæ™¯ä¼˜åŒ–ã€‚</b>  <b>æ–¯ç»´å°”ç‰¹</b> </h3><br>  Svelteæ˜¯ä¸€ä¸ªé¡¹ç›®ï¼Œå…¶ä¸­Googleè¯•å›¾ä¼˜åŒ–åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿæœ¬èº«çš„RAMæ¶ˆè€—ã€‚ <br> åœ¨Android 7ä¸­ï¼Œåœ¨è¯¥é¡¹ç›®çš„æ¡†æ¶å†…ï¼Œå·²ç¡®å®šéšå¼å¹¿æ’­ä¸æ˜¯å¾ˆæœ‰æ•ˆï¼Œå› ä¸ºå®ƒä»¬è¢«å¤§é‡åº”ç”¨ç¨‹åºç›‘å¬ï¼Œå¹¶ä¸”å½“è¿™äº›äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿä¼šèŠ±è´¹å¤§é‡èµ„æºã€‚ å› æ­¤ï¼Œæ¸…å•ä¸­ç¦æ­¢å£°æ˜ä»¥ä¸‹ç±»å‹çš„äº‹ä»¶ï¼š <br><br><ul><li>  CONNECTIVITY_ACTION; </li><li>  ACTION_NEW_PICTURE; </li><li>  ACTION_NEW_VIDEOã€‚ </li></ul><br>  <b>Android 7.ç‰›è½§ç³–</b> <b><br></b> <h3>  <b>FirebaseJobDispatcher</b> </h3><br> åŒæ—¶ï¼Œå‘å¸ƒäº†ä»»åŠ¡å¯åŠ¨æ¡†æ¶çš„æ–°ç‰ˆæœ¬-FirebaseJobDispatcherã€‚ å®é™…ä¸Šï¼Œè¿™æ˜¯å®Œæ•´çš„GCM NetworkManagerï¼Œå®ƒç»è¿‡æ•´ç†å’Œçµæ´»ä¸€äº›ã€‚ <br><br> åœ¨è§†è§‰ä¸Šï¼Œä¸€åˆ‡çœ‹èµ·æ¥éƒ½å®Œå…¨ä¸€æ ·ã€‚ ç›¸åŒçš„æœåŠ¡ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JobSchedulerService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JobService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStartJob</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JobParameters params)</span></span></span><span class="hljs-function"> </span></span>{ doWork(params); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStopJob</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JobParameters params)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } }</code> </pre> <br> ä»–ä¹‹é—´çš„å”¯ä¸€åŒºåˆ«æ˜¯å®‰è£…é©±åŠ¨ç¨‹åºçš„èƒ½åŠ›ã€‚ é©±åŠ¨ç¨‹åºæ˜¯è´Ÿè´£ä»»åŠ¡å¯åŠ¨ç­–ç•¥çš„ç±»ã€‚ <br><br> ä»»åŠ¡çš„å¯åŠ¨æœ¬èº«å¹¶æ²¡æœ‰éšç€æ—¶é—´è€Œæ”¹å˜ã€‚ <br><br><pre> <code class="java hljs">FirebaseJobDispatcher dispatcher = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FirebaseJobDispatcher(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GooglePlayDriver(context)); Job task = dispatcher.newJobBuilder() .setService(FirebaseJobDispatcherService.class) .setTag(TAG) .setConstraints(Constraint.ON_UNMETERED_NETWORK, Constraint.DEVICE_IDLE) .build(); dispatcher.mustSchedule(task);</code> </pre><br>  <i><b>ä¼˜ç‚¹</b> ï¼š</i> <i><br></i>  <i>ä¸JobSchedulerç±»ä¼¼çš„APIï¼›</i> <i><br></i>  <i>ä»API 9å¼€å§‹å¯ç”¨ã€‚</i> <i><br><br></i>  <i><b>ç¼ºç‚¹</b> ï¼š</i> <i><br></i>  <i>æ‚¨å¿…é¡»æ‹¥æœ‰Google PlayæœåŠ¡</i> <i><br></i>  <i>å®¹æ˜“çŠ¯é”™è¯¯ã€‚</i> <i><br></i> <br> å®‰è£…æˆ‘çš„é©±åŠ¨ç¨‹åºæ‘†è„±GPSçš„åšæ³•ä»¤äººé¼“èˆã€‚ æˆ‘ä»¬ç”šè‡³è¿›è¡Œäº†æœç´¢ï¼Œä½†æœ€ç»ˆæ‰¾åˆ°äº†ä»¥ä¸‹å†…å®¹ï¼š <br><br><img src="https://habrastorage.org/webt/3n/39/ua/3n39uanajermu--vb5qrzgfl8jq.png"><br><br><img src="https://habrastorage.org/webt/zm/rq/i3/zmrqi3pnt_0hx8lcspdy8k6xio8.png"><br><br>  GoogleçŸ¥é“è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯è¿™äº›ä»»åŠ¡ä»ç„¶å­˜åœ¨æ•°å¹´ã€‚ <br><br>  <b>Android 7.ç‰›è½§ç³–</b> <b><br></b> <h3>  <b>Evernoteçš„Android Job</b> </h3><br> ç»“æœï¼Œç¤¾åŒºæ— æ³•å¿å—ï¼Œä¸€ä¸ªè‡ªåˆ¶çš„è§£å†³æ–¹æ¡ˆä»¥Evernoteçš„å›¾ä¹¦é¦†å½¢å¼å‡ºç°ã€‚ å®ƒä¸ä»…æ˜¯å”¯ä¸€çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œä¸”è¿˜æ˜¯Evernoteçš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒèƒ½å¤Ÿå»ºç«‹è‡ªå·±çš„åœ°ä½å¹¶â€œèå…¥äººæ°‘â€ã€‚ <br><br> ä»ä½“ç³»ç»“æ„çš„è§’åº¦æ¥çœ‹ï¼Œè¯¥åº“æ¯”å…¶å‰èº«æ›´æ–¹ä¾¿ã€‚ <br> å‡ºç°äº†è´Ÿè´£åˆ›å»ºä»»åŠ¡çš„å®ä½“ã€‚ å¯¹äºJobSchedulerï¼Œå®ƒä»¬æ˜¯é€šè¿‡åå°„åˆ›å»ºçš„ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SendLogsJobCreator</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JobCreator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tag: String)</span></span></span><span class="hljs-function">: Job? </span></span>{ when (tag) { SendLogsJob.TAG -&gt; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> SendLogsJob() } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> } }</code> </pre> <br> æœ‰ä¸€ä¸ªå•ç‹¬çš„ç±»ï¼Œå³ä»»åŠ¡æœ¬èº«ã€‚ åœ¨JobSchedulerä¸­ï¼Œæ‰€æœ‰è¿™äº›éƒ½è¢«è½¬å‚¨åˆ°onStartJobå†…éƒ¨çš„å¼€å…³ä¸­ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SendLogsJob</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Job</span></span></span><span class="hljs-class">() </span></span>{ <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onRunJob</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(params: Params)</span></span></span><span class="hljs-function">: Result </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> doWork(params) } }</code> </pre> <br> ä»»åŠ¡çš„å¯åŠ¨æ˜¯ç›¸åŒçš„ï¼Œä½†Evernoteé™¤äº†ç»§æ‰¿çš„äº‹ä»¶å¤–ï¼Œè¿˜æ·»åŠ äº†è‡ªå·±çš„ä»»åŠ¡ï¼Œä¾‹å¦‚å¯åŠ¨æ—¥å¸¸ä»»åŠ¡ï¼Œå”¯ä¸€ä»»åŠ¡ä»¥åŠåœ¨çª—å£å†…å¯åŠ¨ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JobRequest.Builder(JOB_ID) .setRequiresDeviceIdle(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) .setRequiresCharging(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) .setRequiredNetworkType(JobRequest.NetworkType.UNMETERED) .build() .scheduleAsync();</code> </pre> <br>  <i><b>ä¼˜ç‚¹</b> ï¼š</i> <i><br></i>  <i>æ–¹ä¾¿çš„API;</i> <i><br></i>  <i>æ‰€æœ‰ç‰ˆæœ¬å‡å—æ”¯æŒï¼›</i> <i><br></i>  <i>ä¸éœ€è¦Google PlayæœåŠ¡ã€‚</i> <i><br><br></i>  <i><b>ç¼ºç‚¹</b> ï¼š</i> <i><br></i>  <i>ç¬¬ä¸‰æ–¹è§£å†³æ–¹æ¡ˆã€‚</i> <i><br></i> <br> ä¼™è®¡ä»¬ç§¯ææ”¯æŒä»–ä»¬çš„å›¾ä¹¦é¦†ã€‚ å°½ç®¡å­˜åœ¨å¾ˆå¤šå…³é”®é—®é¢˜ï¼Œä½†å®ƒé€‚ç”¨äºæ‰€æœ‰ç‰ˆæœ¬å’Œæ‰€æœ‰è®¾å¤‡ã€‚ ç»“æœï¼Œå»å¹´æˆ‘ä»¬çš„Androidå›¢é˜Ÿé€‰æ‹©äº†Evernoteçš„è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºGoogleçš„åº“å‰Šå‡äº†ä»–ä»¬æ— æ³•æ”¯æŒçš„å¤§é‡è®¾å¤‡ã€‚ <br> åœ¨å†…éƒ¨ï¼Œå¥¹åœ¨æç«¯æƒ…å†µä¸‹ä½¿ç”¨AlarmManagerç ”ç©¶Googleçš„è§£å†³æ–¹æ¡ˆã€‚ <br><br>  <b>Android 8. Oreo</b> <b><br></b> <h3>  <b>åå°æ‰§è¡Œé™åˆ¶</b> </h3><br> è®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„å±€é™æ€§ã€‚ éšç€æ–°çš„Androidçš„åˆ°æ¥ï¼Œæ–°çš„ä¼˜åŒ–æ–¹æ³•å·²ç»å‡ºç°ã€‚ è°·æ­Œçš„å®¶ä¼™å‘ç°äº†å¦ä¸€ä¸ªé—®é¢˜ã€‚ è¿™æ¬¡ï¼Œäº‹å®è¯æ˜æ•´ä¸ªè¿‡ç¨‹éƒ½åœ¨æœåŠ¡å’Œå¹¿æ’­ä¸­ï¼ˆæ˜¯çš„ï¼Œæ²¡æœ‰æ–°å†…å®¹ï¼‰ã€‚ <br><br><ul><li>  <s>å¦‚æœåå°æœ‰åº”ç”¨ç¨‹åºï¼Œåˆ™ä¸ºstartService</s> </li><li>  <s>æ¸…å•ä¸­çš„éšå¼å¹¿æ’­</s> </li></ul><br> é¦–å…ˆï¼Œç¦æ­¢ä»åå°å¯åŠ¨æœåŠ¡ã€‚ åœ¨â€œæ³•å¾‹æ¡†æ¶â€ä¸­ï¼Œä»…ä¿ç•™å‰å°æœåŠ¡ã€‚ ç°åœ¨å¯ä»¥è¯´æœåŠ¡å·²è¿‡æ—¶ã€‚ <br> ç¬¬äºŒä¸ªé™åˆ¶æ˜¯ç›¸åŒçš„å¹¿æ’­ã€‚ è¿™æ¬¡ç¦æ­¢åœ¨æ¸…å•ä¸­æ³¨å†Œæ‰€æœ‰éšå¼å¹¿æ’­ã€‚ éšå¼å¹¿æ’­æ˜¯ä¸€ç§å¹¿æ’­ï¼Œä¸ä»…ä»…ç”¨äºæˆ‘ä»¬çš„åº”ç”¨ã€‚ ä¾‹å¦‚ï¼Œæœ‰åŠ¨ä½œACTION_PACKAGE_REPLACEDï¼Œæœ‰ACTION_MY_PACKAGE_REPLACEDã€‚ å› æ­¤ï¼Œç¬¬ä¸€ä¸ªæ˜¯éšå¼çš„ã€‚ <br><br> ä½†æ˜¯ï¼Œä»ç„¶å¯ä»¥é€šè¿‡Context.registerBroadcastæ³¨å†Œä»»ä½•å¹¿æ’­ã€‚ <br><br>  <b>Android 9. Pie</b> <b><br></b> <h3>  <b>å·¥ä½œç»ç†</b> </h3><br> å…³äºæ­¤ä¼˜åŒ–å°šæœªåœæ­¢ã€‚ å°±èƒ½è€—è€Œè¨€ï¼Œè¿™äº›è®¾å¤‡ä¹Ÿè®¸å¼€å§‹è¿…é€Ÿè€Œè°¨æ…åœ°å·¥ä½œï¼› ä¹Ÿè®¸ç”¨æˆ·å¯¹æ­¤æŠ±æ€¨è¾ƒå°‘ã€‚ <br> åœ¨Android 9ä¸­ï¼Œè¯¥æ¡†æ¶çš„å¼€å‘äººå‘˜å½»åº•ä½¿ç”¨äº†è¯¥å·¥å…·æ¥å¯åŠ¨ä»»åŠ¡ã€‚ ä¸ºäº†è§£å†³æ‰€æœ‰ç´§è¿«çš„é—®é¢˜ï¼Œåœ¨Google I / Oä¸Šå¼•å…¥äº†ä¸€ä¸ªåº“ï¼Œç”¨äºå¯åŠ¨WorkManagerçš„åå°ä»»åŠ¡ã€‚ <br><br>  Googleæœ€è¿‘ä¸€ç›´åœ¨å°è¯•å¡‘é€ å…¶å¯¹Androidåº”ç”¨ç¨‹åºä½“ç³»ç»“æ„çš„æ„¿æ™¯ï¼Œå¹¶ä¸ºå¼€å‘äººå‘˜æä¾›ä¸ºæ­¤æ‰€éœ€çš„å·¥å…·ã€‚ å› æ­¤ï¼Œå­˜åœ¨å¸¦æœ‰LiveDataï¼ŒViewModelå’ŒRoomçš„å»ºç­‘ç»„ä»¶ã€‚  WorkManagerçœ‹èµ·æ¥æ˜¯å¯¹å…¶æ–¹æ³•å’ŒèŒƒä¾‹çš„åˆç†è¡¥å……ã€‚ <br><br> å¦‚æœæˆ‘ä»¬è°ˆè®ºWorkManagerçš„å†…éƒ¨å¸ƒç½®æ–¹å¼ï¼Œåˆ™å…¶ä¸­æ²¡æœ‰æŠ€æœ¯çªç ´ã€‚ å®é™…ä¸Šï¼Œè¿™æ˜¯ç°æœ‰è§£å†³æ–¹æ¡ˆçš„åŒ…è£…ï¼šJobSchedulerï¼ŒFirebaseJobDispatcherå’ŒAlarmManagerã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">createBestAvailableBackgroundScheduler</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Scheduler </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createBestAvailableBackgroundScheduler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context, WorkManager)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Build.VERSION.SDK_INT &gt;= MIN_JOB_SCHEDULER_API_LEVEL) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SystemJobScheduler(context, workManager); } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tryCreateFirebaseJobScheduler(context); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SystemAlarmScheduler(context); } }</code> </pre> <br></div></div><br> é€‰æ‹©ä»£ç éå¸¸ç®€å•ã€‚ ä½†åº”æ³¨æ„çš„æ˜¯ï¼ŒJobSchedulerä»API 21å¼€å§‹å¯ç”¨ï¼Œä½†ç”±äºç¬¬ä¸€ä¸ªç‰ˆæœ¬ç›¸å½“ä¸ç¨³å®šï¼Œå› æ­¤å®ƒä»¬ä»…ä¸API 23ä¸€èµ·ä½¿ç”¨ã€‚ <br><br> å¦‚æœç‰ˆæœ¬ä½äº23ï¼Œåˆ™é€šè¿‡åå°„å°è¯•æ‰¾åˆ°FirebaseJobDispatcherï¼Œå¦åˆ™ä½¿ç”¨AlarmManagerã€‚ <br><br> å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒåŒ…è£…å™¨çš„åŒ…è£…éå¸¸çµæ´»ã€‚ è¿™æ¬¡ï¼Œå¼€å‘äººå‘˜å°†æ‰€æœ‰å†…å®¹åˆ†è§£ä¸ºå•ç‹¬çš„å®ä½“ï¼Œåœ¨ç»“æ„ä¸Šçœ‹èµ·æ¥å¾ˆæ–¹ä¾¿ï¼š <br><br><ul><li> å·¥äºº-å·¥ä½œé€»è¾‘ï¼› </li><li>  WorkRequest-ä»»åŠ¡å¯åŠ¨çš„é€»è¾‘ï¼› </li><li>  WorkRequest.Builder-å‚æ•°ï¼› </li><li> çº¦æŸ-æ¡ä»¶ï¼› </li><li>  WorkManager-ç®¡ç†ä»»åŠ¡çš„ç»ç†ï¼› </li><li>  WorkStatus-ä»»åŠ¡çŠ¶æ€ã€‚ </li></ul><br><br><img src="https://habrastorage.org/webt/n_/ts/xi/n_tsxiw0wsxv6a5abotzdzokcba.png"><br><br> å¯åŠ¨æ¡ä»¶æ˜¯ä»JobSchedulerç»§æ‰¿çš„ã€‚ <br> å¯ä»¥æ³¨æ„åˆ°ï¼Œç”¨äºæ›´æ”¹URIçš„è§¦å‘å™¨ä»…åœ¨API 23ä¸­å‡ºç°ã€‚æ­¤å¤–ï¼Œä½¿ç”¨æ–¹æ³•ä¸­çš„æ ‡å¿—ï¼Œæ‚¨ä¸ä»…å¯ä»¥è®¢é˜…ç‰¹å®šURIçš„æ›´æ”¹ï¼Œè¿˜å¯ä»¥è®¢é˜…æ‰€æœ‰åµŒå¥—åœ¨å…¶ä¸­çš„æ›´æ”¹ã€‚ <br><br> å¦‚æœæˆ‘ä»¬è°ˆè®ºæˆ‘ä»¬ï¼Œé‚£ä¹ˆåœ¨Alphaé˜¶æ®µï¼Œå†³å®šåˆ‡æ¢åˆ°WorkManagerã€‚ <br> è¿™æœ‰å‡ ä¸ªåŸå› ã€‚  Evernoteæœ‰å‡ ä¸ªå…³é”®é”™è¯¯ï¼Œè¯¥åº“çš„å¼€å‘äººå‘˜æ‰¿è¯ºåœ¨è¿‡æ¸¡åˆ°é›†æˆWorkManagerçš„ç‰ˆæœ¬æ—¶ä¼šä¿®å¤è¿™äº›é”™è¯¯ã€‚ ä»–ä»¬è‡ªå·±ä¹ŸåŒæ„Googleçš„å†³å®šå¦å®šäº†Evernoteçš„ä¼˜åŠ¿ã€‚ å¦å¤–ï¼Œç”±äºæˆ‘ä»¬ä½¿ç”¨æ¶æ„ç»„ä»¶ï¼Œå› æ­¤è¯¥è§£å†³æ–¹æ¡ˆéå¸¸é€‚åˆæˆ‘ä»¬çš„æ¶æ„ã€‚ <br><br> æ­¤å¤–ï¼Œæˆ‘æƒ³ä»¥ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹è¯´æ˜æˆ‘ä»¬å¦‚ä½•å°è¯•ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚ åŒæ—¶ï¼Œæ˜¯å¦æ‹¥æœ‰WorkManageræˆ–JobSchedulerå¹¶ä¸æ˜¯å¾ˆå…³é”®ã€‚ <br><br><img src="https://habrastorage.org/webt/ox/yd/0p/oxyd0pizr6h8tx4egaz_kub5wqy.png" width="300" height="430"><img src="https://habrastorage.org/webt/6m/ec/hd/6mechdqawzamahgaij7df-isocg.png" width="300" height="430"><br><br> è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­ï¼šå•å‡»é‡æ–°å‘å¸ƒæˆ–ç‚¹èµã€‚ <br><br> ç°åœ¨ï¼Œæ‰€æœ‰åº”ç”¨ç¨‹åºéƒ½è¯•å›¾æ‘†è„±é˜»å¡å¯¹ç½‘ç»œçš„è¯·æ±‚ï¼Œå› ä¸ºè¿™ä½¿ç”¨æˆ·æ„Ÿåˆ°ç´§å¼ å¹¶ä½¿å…¶ç­‰å¾…ï¼Œå°½ç®¡æ­¤æ—¶ä»–å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå†…è¿›è¡Œè´­ä¹°æˆ–è§‚çœ‹å¹¿å‘Šã€‚ <br><br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ¬åœ°æ•°æ®é¦–å…ˆä¼šå‘ç”Ÿå˜åŒ–-ç”¨æˆ·ç«‹å³çœ‹åˆ°å…¶æ“ä½œçš„ç»“æœã€‚ ç„¶ååœ¨åå°å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚å¤±è´¥ï¼Œåˆ™æ•°æ®å°†é‡ç½®ä¸ºå…¶åˆå§‹çŠ¶æ€ã€‚ <br><br> æ¥ä¸‹æ¥ï¼Œæˆ‘å°†å±•ç¤ºä¸€ä¸ªç¤ºä¾‹ï¼Œè¯´æ˜æˆ‘ä»¬çš„æƒ…å†µã€‚ <br><br>  JobRunneråŒ…å«å¯åŠ¨ä»»åŠ¡çš„é€»è¾‘ã€‚ ä»–çš„æ–¹æ³•æè¿°äº†ä»»åŠ¡çš„é…ç½®å’Œä¼ é€’å‚æ•°ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">JobRunner.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">likePost</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(content: IFunnyContent)</span></span></span><span class="hljs-function"> </span></span>{ val constraints = Constraints.Builder() .setRequiredNetworkType(NetworkType.CONNECTED) .build() val input = Data.Builder() .putString(LikeContentJob.ID, content.id) .build() val request = OneTimeWorkRequest.Builder(LikeContentJob::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">setInputData</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">input</span></span></span><span class="hljs-class">) .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">setConstraints</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constraints</span></span></span><span class="hljs-class">) .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">build</span></span></span><span class="hljs-class">() </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WorkManager</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getInstance</span></span></span><span class="hljs-class">().</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">enqueue</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">request</span></span></span><span class="hljs-class">) }</span></span></code> </pre><br></div></div><br>  WorkManagerä¸­çš„ä»»åŠ¡æœ¬èº«å¦‚ä¸‹ï¼šæˆ‘ä»¬ä»å‚æ•°ä¸­è·å–IDï¼Œå¹¶åœ¨æœåŠ¡å™¨ä¸Šè°ƒç”¨æ–¹æ³•ä»¥å–œæ¬¢æ­¤å†…å®¹ã€‚ <br><br> æˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å«ä»¥ä¸‹é€»è¾‘çš„åŸºç±»ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseJob</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Worker</span></span></span><span class="hljs-class">() </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doWork</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: Result </span></span>{ val workerInjector = WorkerInjectorProvider.injector() workerInjector.inject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> performJob(inputData) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performJob</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(params: Data)</span></span></span><span class="hljs-function">: Result }</span></span></code> </pre><br> é¦–å…ˆï¼Œå®ƒå¯ä»¥ä½¿æ‚¨è¿œç¦»å¯¹Workerçš„æ˜ç¡®äº†è§£ã€‚ å®ƒè¿˜é€šè¿‡WorkerInjectoråŒ…å«ä¾èµ–é¡¹æ³¨å…¥é€»è¾‘ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">WorkerInjectorImpl.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Singleton</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WorkerInjectorImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WorkerInjector</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WorkerInjectorImpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-meta"><span class="hljs-meta">@Ovierride</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Worker job)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (worker <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> AppCrashedEventSendJob) { Injector.getAppComponent().inject((AppCrashedEventSendJob) job); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (worker <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> CheckNativeCrashesJob) { Injector.getAppComponent().inject((CheckNativeCrashesJob) job); } } }</code> </pre><br></div></div><br> å®ƒåªæ˜¯ä»£ç†å¯¹Daggerçš„è°ƒç”¨ï¼Œä½†å¯ä»¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œæµ‹è¯•ï¼šæˆ‘ä»¬æ›¿æ¢æ³¨å°„å™¨çš„å®ç°ï¼Œå¹¶åœ¨ä»»åŠ¡ä¸­å®ç°å¿…è¦çš„ç¯å¢ƒã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testRegisterPushProvider</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ WorkManagerTestInitHelper.initializeTestWorkManager(context) val testDriver = WorkManagerTestInitHelper.getTestDriver() WorkerInjectorProvider.setInjector(TestInjector()) <span class="hljs-comment"><span class="hljs-comment">// mock dependencies val id = jobRunner.runPushRegisterJob() testDriver.setAllConstraintsMet(id) Assert.assertTrue(â€¦) }</span></span></code> </pre><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LikePostInteractor</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Inject</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constructor</span></span></span><span class="hljs-class">( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">iFunnyContentDao</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IFunnyContentDao</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">jobRunner</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JobRunner</span></span></span><span class="hljs-class">) : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Interactor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ iFunnyContentDao.like(getContent().id) jobRunner.likePost(getContent()) } }</code> </pre> <br> äº¤äº’å™¨æ˜¯ViewControlleræ‹‰åŠ¨ä»¥å¯åŠ¨è„šæœ¬é€šè¿‡çš„å®ä½“ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°±åƒå®ƒä¸€æ ·ï¼‰ã€‚ æˆ‘ä»¬åœ¨æœ¬åœ°å°†å†…å®¹æ ‡è®°ä¸ºâ€œå·²ä¸Šä¼ â€ï¼Œç„¶åæäº¤ä»»åŠ¡ä»¥æ‰§è¡Œã€‚ å¦‚æœä»»åŠ¡å¤±è´¥ï¼Œå°†åˆ é™¤ç±»ä¼¼å†…å®¹ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IFunnyContentViewModel</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">iFunnyContentDao</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IFunnyContentDao</span></span></span><span class="hljs-class">) : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewModel</span></span></span><span class="hljs-class">() </span></span>{ val likeState = MediatorLiveData&lt;Boolean&gt;() <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> iFunnyContentId = MutableLiveData&lt;String&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> iFunnyContentState: LiveData&lt;IFunnyContent&gt; = attachLiveDataToContentId(); init { likeState.addSource(iFunnyContentState) { likeState.postValue(it!!.hasLike) } } }</code> </pre> <br> æˆ‘ä»¬ä½¿ç”¨Googleçš„æ¶æ„ç»„ä»¶ï¼šViewModelå’ŒLiveDataã€‚ è¿™å°±æ˜¯æˆ‘ä»¬çš„ViewModelçš„æ ·å­ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†çŠ¶æ€ä¸ºlikeçš„DAOä¸­çš„å¯¹è±¡æ›´æ–°è¿æ¥èµ·æ¥ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">IFunnyContentViewController.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IFunnyContentViewController</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Inject</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constructor</span></span></span><span class="hljs-class">( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">likePostInteractor</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LikePostInteractor</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">viewModel</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IFunnyContentViewModel</span></span></span><span class="hljs-class">) : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: View)</span></span></span><span class="hljs-function"> </span></span>{ viewModel.likeState.observe(lifecycleOwner, { updateLikeView(it!!) }) } <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onLikePost</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ likePostInteractor.setContent(getContent()) likePostInteractor.execute() } }</code> </pre> <br></div></div><br> ä¸€æ–¹é¢ï¼ŒViewControllerè®¢é˜…æ›´æ”¹çŠ¶æ€çš„è¯·æ±‚ï¼Œå¦ä¸€æ–¹é¢ï¼Œå®ƒå¯åŠ¨æˆ‘ä»¬éœ€è¦çš„è„šæœ¬çš„ä¼ é€’ã€‚ <br><br> è¿™å‡ ä¹æ˜¯æˆ‘ä»¬éœ€è¦çš„æ‰€æœ‰ä»£ç ã€‚ å‰©ä¸‹çš„å°±æ˜¯æ·»åŠ Viewæœ¬èº«çš„è¡Œä¸ºä»¥åŠDAOçš„å®ç°ï¼› å¦‚æœä½¿ç”¨â€œæˆ¿é—´â€ï¼Œåˆ™åªéœ€åœ¨å¯¹è±¡ä¸­æ³¨å†Œå­—æ®µã€‚ å®ƒçœ‹èµ·æ¥éå¸¸ç®€å•æœ‰æ•ˆã€‚ <br><br><h3>  <b>æ€»ç»“ä¸€ä¸‹</b> </h3><br>  <b>JobSchedulerï¼ŒGCMç½‘ç»œç»ç†ï¼ŒFirebaseJobDispatcherï¼š</b> <br><br><ul><li> ä¸è¦ä½¿ç”¨å®ƒä»¬ </li><li> ä¸å†é˜…è¯»æœ‰å…³å®ƒä»¬çš„æ–‡ç«  </li><li> ä¸çœ‹æŠ¥å‘Š </li><li> ä¸è¦ä»¥ä¸ºé€‰æ‹©å“ªä¸€ä¸ªã€‚ </li></ul><br>  <b>Evernoteçš„Android Jobï¼š</b> <br><br><ul><li> åœ¨å†…éƒ¨ï¼Œä»–ä»¬å°†ä½¿ç”¨WorkManagerï¼› </li><li> å…³é”®é”™è¯¯åœ¨è§£å†³æ–¹æ¡ˆä¹‹é—´æ˜¯æ¨¡ç³Šçš„ã€‚ </li></ul><br>  <b>å·¥ä½œç®¡ç†å™¨ï¼š</b> <br><br><ul><li>  APIç­‰çº§9ä»¥ä¸Šï¼› </li><li> ç‹¬ç«‹äºGoogle PlayæœåŠ¡ï¼› </li><li> é“¾æ¥/è¾“å…¥åˆå¹¶å™¨ï¼› </li><li> ååº”æ–¹æ³• </li><li>  Googleçš„æ”¯æŒï¼ˆæˆ‘æƒ³ç›¸ä¿¡ï¼‰ã€‚ </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN434680/">https://habr.com/ru/post/zh-CN434680/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN434670/index.html">å¹´åº¦æŠ¥å‘ŠHabrapost-2018</a></li>
<li><a href="../zh-CN434672/index.html">ã€Šé‡‘èç§‘æŠ€æ–‡æ‘˜ã€‹ï¼š2018å¹´æœ€å—æ¬¢è¿çš„äº§å“ï¼Œå¡ä¸å¡ä¹‹é—´çš„è½¬è´¦é‡ç¿»äº†ä¸€ç•ªï¼ŒåŠ å¯†è´§å¸ç¨</a></li>
<li><a href="../zh-CN434674/index.html">æˆ‘ä»¬è¿…é€Ÿåº”å¯¹ç”µç¼†ç ´åï¼Œæ— å¤„ä¸åœ¨ï¼Œæ— ç‰©ç†é™·é˜±</a></li>
<li><a href="../zh-CN434676/index.html">TOP-10-2019å¹´åº¦å­¦ä¹ </a></li>
<li><a href="../zh-CN434678/index.html">ç®¡ç†å‘˜ä¸Šåˆï¼šåœ¨æ•°åå°æœåŠ¡å™¨ä¸Šæ·»åŠ ç©ºé—´ä»¥å–å’–å•¡</a></li>
<li><a href="../zh-CN434682/index.html">ä¸ªäººåŸå¸‚ä¼ é€å™¨</a></li>
<li><a href="../zh-CN434684/index.html">Rust 2019åŠä»¥åï¼šå¢é•¿é™åˆ¶</a></li>
<li><a href="../zh-CN434686/index.html">KPIä¸­çš„JavaScriptå’ŒNode.jsè®²åº§</a></li>
<li><a href="../zh-CN434688/index.html">FreeBSDè®¡åˆ’åˆ‡æ¢åˆ°ZFSonLinux</a></li>
<li><a href="../zh-CN434690/index.html">Haikuæ“ä½œç³»ç»Ÿï¼šç§»æ¤åº”ç”¨ç¨‹åºå’Œåˆ›å»ºè½¯ä»¶åŒ…</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>