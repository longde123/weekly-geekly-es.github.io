<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äçüåæ üåÉ üë®üèæ‚Äçüöí Manipulation en temps r√©el des maillages sur Unity üèÇüèª üßõüèº üéä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'un des avantages d'Unity en tant que plateforme de d√©veloppement de jeux est son puissant moteur 3D. Dans ce didacticiel, vous d√©couvrirez le monde ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Manipulation en temps r√©el des maillages sur Unity</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428796/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ce5/532/c83/ce5532c83ff152100775d62091370bf2.gif" alt="image"></div><br>  L'un des avantages d'Unity en tant que plateforme de d√©veloppement de jeux est son puissant moteur 3D.  Dans ce didacticiel, vous d√©couvrirez le monde des objets 3D et la manipulation des maillages. <br><br>  En raison de la croissance des technologies de r√©alit√© virtuelle et augment√©e (VR / AR), la plupart des d√©veloppeurs sont confront√©s √† des concepts complexes de graphiques 3D.  Que ce didacticiel soit le point de d√©part pour eux.  Ne vous inqui√©tez pas, il n'y aura pas de math√©matiques 3D compliqu√©es - seulement des coeurs, des dessins, des fl√®ches et plein de choses int√©ressantes! <br><a name="habracut"></a><br><blockquote>  <em>Remarque:</em> ce didacticiel est destin√© aux utilisateurs qui connaissent l'EDI Unity et ont une certaine exp√©rience de programmation en C #.  Si vous ne disposez pas de telles connaissances, √©tudiez d'abord les didacticiels <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener">Introduction √† l'interface utilisateur Unity</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener">Introduction aux scripts Unity</a> . <br><br>  Vous aurez besoin d'une version d'Unity inf√©rieure √† 2017.3.1.  La derni√®re version d'Unity peut √™tre t√©l√©charg√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener">ici</a> .  Ce didacticiel utilise un √©diteur personnalis√© et vous pouvez en savoir plus √† leur sujet dans le didacticiel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener">Extension de l'√©diteur Unity</a> . </blockquote><br><h2>  Se rendre au travail </h2><br>  Pour commencer, familiarisez-vous avec les termes de base des graphiques 3D, qui vous permettront de mieux comprendre le didacticiel. <br><br>  Termes techniques de base des graphiques 3D: <br><br><ul><li>  <em>Sommets</em> : chaque sommet est un point dans l'espace 3D. </li><li>  <em>Maillage</em> : contient tous les sommets, ar√™tes, triangles, normales et donn√©es UV du mod√®le. </li><li>  <em>Filtre de maillage</em> : stocke les donn√©es de maillage du mod√®le. </li><li>  <em>Rendu de maillage</em> : restitue les donn√©es de maillage dans la sc√®ne. </li><li>  <em>Normales</em> : vecteur d'un sommet ou d'une surface.  Il est dirig√© vers l'ext√©rieur, perpendiculairement √† la surface du maillage. </li><li>  <em>Lignes / ar√™tes</em> : lignes invisibles reliant les sommets les uns aux autres. </li><li>  <em>Triangles</em> : form√©s en reliant trois pics. </li><li>  <em>Carte UV</em> : attache le mat√©riau √† un objet, cr√©ant une texture et une couleur pour celui-ci. </li></ul><br>  L'anatomie d'un objet 3D commence par son maillage.  La cr√©ation de ce maillage commence √† ses sommets.  Les lignes invisibles reliant ces sommets forment des triangles qui d√©finissent la forme de base de l'objet. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a7/83a/4c2/5a783a4c2ed2c144ccd0d7eb97369370.gif"></div><br>  Ensuite, les donn√©es normales et UV d√©finissent l'ombrage, la couleur et la texture.  Les donn√©es de maillage sont stock√©es dans un filtre de maillage et le rendu de maillage utilise ces donn√©es pour dessiner un objet dans la sc√®ne. <br><br>  Autrement dit, le pseudocode pour cr√©er un mod√®le 3D ressemble √† ceci: <br><br><ul><li>  Cr√©ez un nouveau maillage appel√© ¬´myMesh¬ª. </li><li>  Ajoutez des donn√©es aux propri√©t√©s des sommets et triangles myMesh. </li><li>  Cr√©ez un nouveau filtre maill√© appel√© ¬´myMeshFilter¬ª. </li><li>  D√©finissez la propri√©t√© de maillage myMeshFilter sur myMesh. </li></ul><br>  Une fois que vous ma√Ætrisez les bases, t√©l√©chargez le <a href="">projet</a> , d√©compressez les fichiers et ex√©cutez la pi√®ce du projet dans Unity.  Regardez la structure des dossiers dans la fen√™tre <em>Projet</em> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/690/2d6/c2e/6902d6c2e14a98284c8af39055242bc7.png"></div><br>  Description des dossiers: <br><br><ul><li>  <em>Pr√©fabriqu√©s</em> : contient le pr√©fabriqu√© Sph√®re qui sera utilis√© pour enregistrer le maillage 3D lors de l'ex√©cution de l'application. </li><li>  <em>Sc√®nes</em> : contient les trois sc√®nes que nous utilisons dans ce didacticiel. </li><li>  <em>Editeur</em> : les scripts √† l'int√©rieur de ce dossier nous donnent les super-fonctionnalit√©s de l'√©diteur que nous utilisons en d√©veloppement. </li><li>  <em>Scripts</em> : voici les scripts d'ex√©cution qui s'attachent au GameObject et s'ex√©cutent lorsque vous cliquez sur <em>Play</em> . </li><li>  <em>Mat√©riaux</em> : ce dossier contient le mat√©riau du maillage. </li></ul><br>  Dans la section suivante, nous allons cr√©er un √©diteur personnalis√© pour visualiser la cr√©ation d'un maillage 3D. <br><br><h2>  Modifier les maillages avec l'√©diteur personnalis√© </h2><br>  Ouvrez la <em>d√©mo 01 Mesh Study</em> situ√©e dans le dossier <em>Scenes</em> .  Dans la fen√™tre <em>Sc√®ne</em> , vous verrez un cube 3D: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d5/ed2/812/6d5ed28123a0c65bb083c67efab702c7.gif"></div><br>  Avant d'entrer dans le maillage, jetons un ≈ìil au script de l'√©diteur personnalis√©. <br><br><h3>  Modification d'un script d'√©diteur </h3><br>  S√©lectionnez le dossier <em>Editeur</em> dans la fen√™tre <em>Projet</em> .  Les scripts de ce dossier ajoutent des fonctionnalit√©s √† l'√©diteur (Editor) pendant le d√©veloppement et ne sont pas disponibles en mode Build. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/442/653/b41/442653b41ca755b67d3a1ce42ae1ec5a.png"></div><br>  Ouvrez <em>MeshInspector.cs</em> et affichez le code source.  Tous les scripts Editor doivent impl√©menter la classe <code>Editor</code> , son attribut <code>CustomEditor</code> indique √† la classe <code>Editor</code> quel type d'objet il est destin√©.  <code>OnSceneGUI()</code> est une m√©thode d'√©v√©nement qui permet le rendu dans la fen√™tre Scene;  <code>OnInspectorGUI()</code> vous permet d'ajouter des √©l√©ments GUI suppl√©mentaires √† l'inspecteur. <br><br>  Dans <em>MeshInspector.cs,</em> avant de d√©marrer la classe <code>MeshInspector</code> ajoutez ce qui suit: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">CustomEditor(typeof(MeshStudy))</span></span>]</code> </pre> <br>  Explication du code: l'attribut <code>CustomEditor</code> indique √† Unity quel type d'objet la classe de l'√©diteur personnalis√© peut modifier. <br><br>  Dans <code>OnSceneGUI()</code> avant <code>EditMesh()</code> ajoutez ce qui suit: <br><br><pre> <code class="cs hljs">mesh = target <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> MeshStudy; Debug.Log(<span class="hljs-string"><span class="hljs-string">"Custom editor is running"</span></span>);</code> </pre> <br>  Explication du code: la classe <code>Editor</code> a une variable <code>target</code> standard.  Ici, la <code>target</code> est une conversion vers <code>MeshStudy</code> .  Maintenant, l'√©diteur personnalis√© dessinera tous les GameObjects dans la fen√™tre Scene et les <em>MeshStudy.cs</em> qui leur <em>sont</em> attach√©s.  L'ajout de messages de d√©bogage vous permet de v√©rifier dans la console que l'√©diteur personnalis√© est r√©ellement en cours d'ex√©cution. <br><br>  Enregistrez le fichier et revenez √† Unity.  Acc√©dez au dossier <em>Scripts</em> et faites glisser <em>MeshStudy.cs</em> sur le <em>cube</em> GameObject dans la <em>hi√©rarchie</em> pour le joindre. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa6/b8a/ee4/aa6b8aee48eacb8421eff3c4e1ef4be3.png"></div><br>  Maintenant, le message ¬´L'√©diteur personnalis√© est en cours d'ex√©cution¬ª devrait s'afficher dans la console, ce qui signifie que nous avons tout fait correctement!  Vous pouvez supprimer le message de d√©bogage afin qu'il ne nous d√©range pas dans la console. <br><br><h3>  Clonage et vidage du maillage </h3><br>  Lorsque vous travaillez avec un maillage 3D en mode √âdition √† l'aide de l'√©diteur personnalis√©, veillez √† ne pas √©craser le maillage Unity par d√©faut.  Si cela se produit, vous devrez red√©marrer Unity. <br><br>  Pour cloner le maillage en toute s√©curit√© sans √©craser le formulaire d'origine, cr√©ez une copie du maillage √† partir de la propri√©t√© <code>MeshFilter.sharedmesh</code> et affectez-le √† nouveau au filtre de maillage. <br><br>  Pour ce faire, double-cliquez sur <em>MeshStudy.cs</em> dans le dossier <em>Scripts</em> pour ouvrir le fichier dans l'√©diteur de code.  Ce script h√©rite de la classe <code>MonoBehaviour</code> et sa fonction <code>Start()</code> n'est pas ex√©cut√©e en mode Edit. <br><br>  Dans <em>MeshStudy.cs,</em> avant de d√©marrer la classe <code>MeshStudy</code> ajoutez ce qui suit: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ExecuteInEditMode</span></span>]</code> </pre> <br>  Explication du code: apr√®s l'ajout de cet attribut, la fonction <code>Start()</code> sera ex√©cut√©e √† la fois en mode Play et en mode Edit.  Maintenant, nous pouvons d'abord instancier l'objet maill√© et le cloner. <br><br>  Dans <code>InitMesh()</code> ajoutez le code suivant: <br><br><pre> <code class="cs hljs">oMeshFilter = GetComponent&lt;MeshFilter&gt;(); oMesh = oMeshFilter.sharedMesh; <span class="hljs-comment"><span class="hljs-comment">//1 cMesh = new Mesh(); //2 cMesh.name = "clone"; cMesh.vertices = oMesh.vertices; cMesh.triangles = oMesh.triangles; cMesh.normals = oMesh.normals; cMesh.uv = oMesh.uv; oMeshFilter.mesh = cMesh; //3 vertices = cMesh.vertices; //4 triangles = cMesh.triangles; isCloned = true; Debug.Log("Init &amp; Cloned");</span></span></code> </pre> <br>  Explication du code: <br><br><ol><li>  Obtient le maillage <code>oMesh</code> origine du composant <code>MeshFilter</code> . </li><li>  Copie <code>cMesh</code> dans une nouvelle <code>cMesh</code> maillage. </li><li>  Attribue √† nouveau le filtre de maillage de maillage copi√©. </li><li>  Met √† jour les variables locales. </li></ol><br>  Enregistrez le fichier et revenez √† Unity.  Le message ¬´Init &amp; Cloned¬ª doit √™tre affich√© dans la console de d√©bogage.  S√©lectionnez le <code>Cube</code> GameObject dans la <em>hi√©rarchie</em> et v√©rifiez ses propri√©t√©s dans l' <em>inspecteur</em> .  <em>Le filtre de maillage</em> doit afficher un √©l√©ment de maillage appel√© <em>clone</em> .  Super!  Cela signifie que nous avons r√©ussi √† cloner le maillage. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c6c/2da/3e0/c6c2da3e0e29703888bad5e50bb608a6.png"></div><br>  Dans le dossier Editor, acc√©dez √† <em>MeshInspector.cs</em> .  Dans <code>OnInspectorGUI()</code> , apr√®s la deuxi√®me ligne de code, ajoutez ce qui suit: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GUILayout.Button(<span class="hljs-string"><span class="hljs-string">"Reset"</span></span>)) <span class="hljs-comment"><span class="hljs-comment">//1 { mesh.Reset(); //2 }</span></span></code> </pre> <br>  Explication du code: <br><br><ol><li>  Ce code dessine un bouton R√©initialiser dans l' <em>inspecteur</em> . </li><li>  Lorsqu'il est press√©, il appelle la fonction <code>Reset()</code> dans <em>MeshStudy.cs</em> . </li></ol><br>  Enregistrez le fichier, ouvrez <em>MeshStudy.cs</em> et ajoutez le code suivant √† la fonction <code>Reset()</code> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cMesh != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; oMesh != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-comment"><span class="hljs-comment">//1 { cMesh.vertices = oMesh.vertices; //2 cMesh.triangles = oMesh.triangles; cMesh.normals = oMesh.normals; cMesh.uv = oMesh.uv; oMeshFilter.mesh = cMesh; //3 vertices = cMesh.vertices; //4 triangles = cMesh.triangles; }</span></span></code> </pre> <br>  Explication du code: <br><br><ol><li>  V√©rification de l'existence de la source et du maillage clon√©. </li><li>  R√©initialisez <code>cMesh</code> au maillage d'origine. </li><li>  Affectation √† <code>cMesh</code> <code>oMeshFilter</code> . </li><li>  Mise √† jour des variables locales. </li></ol><br>  Enregistrez le fichier et revenez √† Unity.  Dans l' <em>inspecteur,</em> cliquez sur le bouton <em>Test Edit</em> pour d√©former le maillage du cube.  Ensuite, cliquez sur le bouton <em>R√©initialiser</em> ;  le cube doit reprendre sa forme d'origine. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c3/a8a/e22/0c3a8ae22c8f8382dd46ee652b4b6eea.gif"></div><br><h3>  Explication des sommets et triangles dans Unity </h3><br>  Un maillage est compos√© de sommets reli√©s par des ar√™tes en triangles.  Les triangles d√©finissent la forme de base de l'objet. <br><br><blockquote>  <em>Classe de maille:</em> <br><br><ul><li>  Les sommets sont stock√©s sous forme de tableau de valeurs <code>Vector3</code> . </li><li>  Les triangles sont stock√©s sous la forme d'un tableau d'entiers correspondant aux indices du tableau de sommets. </li></ul><br>  Autrement dit, dans un simple maillage Quad, compos√© de quatre sommets et de deux triangles, les donn√©es du maillage ressembleront √† ceci: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/56c/56d/794/56c56d794628ff20592f801340308790.gif"></div></blockquote><br><h3>  Cartographie des sommets </h3><br>  Ici, nous voulons afficher les sommets du cube sous forme de points bleus. <br><br>  Dans <em>MeshInspector.cs,</em> nous <em>allons</em> entrer dans la fonction <code>EditMesh()</code> et ajouter ce qui suit: <br><br><pre> <code class="cs hljs">handleTransform = mesh.transform; <span class="hljs-comment"><span class="hljs-comment">//1 handleRotation = Tools.pivotRotation == PivotRotation.Local ? handleTransform.rotation : Quaternion.identity; //2 for (int i = 0; i &lt; mesh.vertices.Length; i++) //3 { ShowPoint(i); }</span></span></code> </pre> <br>  Explication du code: <br><br><ol><li>  <code>handleTransform</code> obtient les valeurs de transformation √† partir du <code>mesh</code> . </li><li>  <code>handleRotation</code> obtient le mode Rotation de l'articulation actuelle. </li><li>  Parcourez les sommets du maillage et tracez les points √† l'aide de <code>ShowPoint()</code> . </li></ol><br>  Dans la fonction <code>ShowPoint()</code> , imm√©diatement apr√®s le commentaire <code>//draw dot</code> , ajoutez ce qui suit: <br><br><pre> <code class="cs hljs">Vector3 point = handleTransform.TransformPoint(mesh.vertices[index]);</code> </pre> <br>  Explication du code: cette ligne convertit la position locale du sommet en coordonn√©es dans l'espace mondial. <br><br>  Dans la m√™me fonction, dans le bloc <code>if</code> , imm√©diatement apr√®s la ligne de code que vous venez d'ajouter, ajoutez ce qui suit: <br><br><pre> <code class="cs hljs">Handles.color = Color.blue; point = Handles.FreeMoveHandle(point, handleRotation, mesh.handleSize, Vector3.zero, Handles.DotHandleCap);</code> </pre> <br>  Explication du code: <br><br><ol><li>  D√©finit la couleur, la taille et la position d'un point √† l'aide de la classe d'assistance <code>Handles</code> . </li><li>  <code>Handles.FreeMoveHandle()</code> cr√©e un manipulateur de mouvement illimit√© qui simplifie l'op√©ration de glisser-d√©poser, ce qui nous est utile dans la section suivante. </li></ol><br>  Enregistrez le fichier et revenez √† Unity.  V√©rifiez la propri√©t√© du cube dans l' <em>inspecteur</em> et assurez-vous que l'option <em>D√©placer le point de</em> sommet est activ√©e.  Vous devriez maintenant voir que le maillage √† l'√©cran est marqu√© de plusieurs points bleus.  Les voici - les sommets du maillage cube!  Essayez de le faire avec d'autres objets 3D et observez les r√©sultats. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d78/3aa/205/d783aa2054dd9ca81ee7a6c948c7c00a.gif"></div><br><h3>  D√©placer un seul sommet </h3><br>  Commen√ßons par l'√©tape la plus simple de manipulation du maillage - d√©placer un seul sommet. <br><br>  Acc√©dez √† <em>MeshInspector.cs</em> .  Dans la fonction <code>ShowPoint()</code> , imm√©diatement apr√®s le commentaire <code>//drag</code> et juste avant les crochets de fermeture du bloc <code>if</code> , ajoutez ce qui suit: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GUI.changed) <span class="hljs-comment"><span class="hljs-comment">//1 { mesh.DoAction(index, handleTransform.InverseTransformPoint(point)); //2 }</span></span></code> </pre> <br>  Explication du code: <br><br><ol><li>  <code>GUI.changed</code> garde une trace de toutes les modifications qui se produisent avec les points et fonctionne bien avec <code>Handles.FreeMoveHandle()</code> pour reconna√Ætre une op√©ration de glisser-d√©poser. </li><li>  Pour le sommet d√©pla√ßable, la fonction <code>mesh.DoAction()</code> re√ßoit ses valeurs d'index et de transformation comme param√®tres.  √âtant donn√© que les valeurs de sommet de transformation sont dans l'espace mondial, nous les convertissons en espace local √† l'aide d' <code>InverseTransformPoint()</code> . </li></ol><br>  Enregistrez le fichier de script et acc√©dez √† <em>MeshStudy.cs</em> .  Dans <code>DoAction()</code> , apr√®s les crochets d'ouverture, ajoutez ce qui suit: <br><br><pre> <code class="cs hljs">PullOneVertex(index, localPos);</code> </pre> <br>  Ajoutez ensuite ce qui suit √† la fonction <code>PullOneVertex()</code> : <br><br><pre> <code class="cs hljs">vertices[index] = newPos; <span class="hljs-comment"><span class="hljs-comment">//1 cMesh.vertices = vertices; //2 cMesh.RecalculateNormals(); //3</span></span></code> </pre> <br>  Explication du code: <br><br><ol><li>  Nous mettons √† jour le sommet cible avec la valeur <code>newPos</code> . </li><li>  <code>cMesh.vertices</code> valeurs de sommet mises √† jour √† <code>cMesh.vertices</code> . </li><li>  Dans <code>RecalculateNormals()</code> recalculons et redessinons le maillage afin qu'il corresponde aux modifications. </li></ol><br>  Enregistrez le fichier et revenez √† Unity.  Essayez de faire glisser des points sur le cube;  avez-vous vu un maillage cass√©? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fca/ccf/c86/fcaccfc865e30b3c922e6cabcf9f79d7.gif"></div><br>  Il semble que certains des sommets aient la m√™me position, donc lorsque nous ne faisons glisser qu'un seul, les sommets restants restent derri√®re, et le maillage se brise.  Dans la section suivante, nous allons r√©soudre ce probl√®me. <br><br><h3>  Trouver tous les sommets similaires </h3><br>  Visuellement, un maillage cubique se compose de huit sommets, six c√¥t√©s et 12 triangles.  V√©rifions si c'est le cas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/253/a30/b3f/253a30b3fcca7b0d9028d92b4c4149c2.gif"></div><br>  Ouvrez <em>MeshStudy.cs</em> , jetez un ≈ìil devant la fonction <code>Start()</code> et trouvez la variable des <code>vertices</code> .  Nous verrons ce qui suit: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">HideInInspector</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3[] vertices;</code> </pre> <br>  Explication du code: <code>[HideInInspector]</code> masque une variable partag√©e dans la fen√™tre <em>Inspecteur</em> . <br><br>  Commentez cet attribut: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//[HideInInspector] public Vector3[] vertices;</span></span></code> </pre> <br><blockquote>  <em>Remarque:</em> masquer les valeurs des sommets aide <code>[HideInInspector]</code> avec des maillages 3D plus complexes.  √âtant donn√© que la taille du tableau de sommets peut atteindre des milliers d'√©l√©ments, cela peut entra√Æner une inhibition de Unity lorsque vous essayez d'afficher la valeur du tableau dans l'inspecteur. </blockquote><br>  Enregistrez le fichier et revenez √† Unity.  Allez √† l' <em>inspecteur</em> .  Maintenant, sous le composant de script <em>Mesh Study</em> , la propri√©t√© <em>verteices</em> est apparue.  Cliquez sur l'ic√¥ne de fl√®che √† c√¥t√©;  vous <code>Vector3</code> tableau des √©l√©ments <code>Vector3</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/feb/f83/fd0/febf83fd02d469734b73910b1769d670.gif"></div><br>  Vous pouvez voir que la taille du tableau est de 24, c'est-√†-dire qu'il y a des sommets ayant la m√™me position!  Avant de continuer, assurez-vous de d√©commenter <code>[HideInInspector]</code> . <br><br><div class="spoiler">  <b class="spoiler_title">Pourquoi y a-t-il 24 sommets?</b> <div class="spoiler_text">  Il existe de nombreuses th√©ories √† ce sujet.  Mais la r√©ponse la plus simple est: le cube a six c√¥t√©s, et chaque c√¥t√© est compos√© de quatre sommets qui forment un plan. <br><br>  Par cons√©quent, le calcul est le suivant: 6 x 4 = 24 sommets. <br><br>  Vous pouvez rechercher d'autres r√©ponses.  Mais pour l'instant, c'est assez simple de savoir que certains maillages auront des sommets qui auront la m√™me position. </div></div><br>  Dans <em>MeshStudy.cs,</em> remplacez <em>tout le</em> code √† l'int√©rieur de la fonction <code>DoAction()</code> par ce qui suit: <br><br><pre> <code class="cs hljs">PullSimilarVertices(index, localPos);</code> </pre> <br>  Passons √† la fonction <code>PullSimilarVertices()</code> et ajoutons ce qui suit: <br><br><pre> <code class="cs hljs">Vector3 targetVertexPos = vertices[index]; <span class="hljs-comment"><span class="hljs-comment">//1 List&lt;int&gt; relatedVertices = FindRelatedVertices(targetVertexPos, false); //2 foreach (int i in relatedVertices) //3 { vertices[i] = newPos; } cMesh.vertices = vertices; //4 cMesh.RecalculateNormals();</span></span></code> </pre> <br>  Explication du code: <br><br><ol><li>  nous obtenons la position du sommet cible, qui sera utilis√©e comme argument de la m√©thode <code>FindRelatedVertices()</code> . </li><li>  Cette m√©thode renvoie une liste d'index (correspondant aux sommets) qui ont la m√™me position que le sommet cible. </li><li>  La boucle traverse la liste enti√®re et d√©finit les sommets correspondants sur <code>newPos</code> . </li><li>  <code>cMesh.vertices</code> <code>vertices</code> mis √† jour √† <code>cMesh.vertices</code> .  Ensuite, nous appelons <code>RecalculateNormals()</code> pour redessiner le maillage avec les nouvelles valeurs. </li></ol><br>  Enregistrez le fichier et revenez √† Unity.  Faites glisser l'un des sommets;  maintenant le maillage doit conserver sa forme et ne pas s'effondrer. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b1b/66d/bcc/b1b66dbccb73ac3a8ad8c56594611919.gif"></div><br>  Maintenant que nous avons termin√© la premi√®re √©tape de la manipulation des maillages, enregistrez la sc√®ne et passez √† la section suivante. <br><br><h2>  Manipulation de maillage </h2><br>  Dans cette section, vous apprendrez √† manipuler les maillages en temps r√©el.  Il existe de nombreuses fa√ßons, mais dans ce didacticiel, nous examinerons le type de manipulation de maillage le plus simple, √† savoir le d√©placement des sommets de maillage cr√©√©s pr√©c√©demment. <br><br><h3>  Collecte des index s√©lectionn√©s </h3><br>  Commen√ßons par s√©lectionner les sommets que nous d√©placerons en temps r√©el. <br><br>  Ouvrez la sc√®ne <em>02 Create Heart Mesh √†</em> partir du dossier <em>Scenes</em> .  Dans la fen√™tre Sc√®ne, vous verrez une sph√®re rouge.  S√©lectionnez <em>Sph√®re</em> dans la <em>hi√©rarchie</em> et acc√©dez √† <em>Inspecteur</em> .  Vous verrez que le composant de script <em>Heart Mesh</em> est attach√© √† l'objet. <br><br>  Nous avons maintenant besoin du script Editor pour cet objet pour afficher les sommets du maillage dans la fen√™tre Scene.  Acc√©dez au dossier <em>Editor</em> et double-cliquez sur <em>HeartMeshInspector.cs</em> . <br><br>  Dans la fonction <code>ShowHandle()</code> , √† l'int√©rieur du bloc <code>if</code> , ajoutez ce qui suit: <br><br><pre> <code class="cs hljs">Handles.color = Color.blue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Handles.Button(point, handleRotation, mesh.pickSize, mesh.pickSize, Handles.DotHandleCap)) <span class="hljs-comment"><span class="hljs-comment">//1 { mesh.selectedIndices.Add(index); //2 }</span></span></code> </pre> <br>  Explication du code: <br><br><ol><li>  D√©finit et affiche les sommets du maillage en tant que type <code>Handles.Button</code> . </li><li>  Lorsque vous cliquez dessus, il ajoute l'index s√©lectionn√© √† la <code>mesh.selectedIndices</code> press√©e, <code>mesh.selectedIndices</code> . </li></ol><br>  Dans <code>OnInspectorGUI()</code> , avant le crochet de fermeture, ajoutez ce qui suit: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GUILayout.Button(<span class="hljs-string"><span class="hljs-string">"Clear Selected Vertices"</span></span>)) { mesh.ClearAllData(); }</code> </pre> <br>  Explication du code: <code>mesh.ClearAllData()</code> comment ajouter un bouton Reset √† l' <em>inspecteur</em> pour appeler <code>mesh.ClearAllData()</code> . <br><br>  Enregistrez le fichier et ouvrez <em>HeartMesh.cs √†</em> partir du dossier <em>Scripts</em> .  Dans la fonction <code>ClearAllData()</code> , ajoutez les √©l√©ments suivants: <br><br><pre> <code class="cs hljs">selectedIndices = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); targetIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; targetVertex = Vector3.zero;</code> </pre> <br>  Explication du code: le code efface les valeurs dans <code>selectedIndices</code> et <code>targetIndex</code> .  Il r√©initialise √©galement <code>targetVertex</code> . <br><br>  Enregistrez le fichier et revenez √† Unity.  S√©lectionnez <em>Sph√®re</em> et acc√©dez √† l' <em>inspecteur</em> du <em>composant de</em> script <em>HeartMesh</em> .  D√©veloppez les <em>indices s√©lectionn√©s</em> en cliquant sur l'ic√¥ne en forme de fl√®che √† c√¥t√©.  Cela nous permettra de suivre chaque sommet ajout√© √† la liste. <br><br>  Activez le <em>mode d'√©dition</em> √† l'aide de la case √† cocher √† c√¥t√©.  Pour cette raison, les sommets du maillage seront dessin√©s dans la fen√™tre Sc√®ne.  Un clic sur les points bleus dans les <em>indices s√©lectionn√©s</em> devrait modifier les valeurs en cons√©quence.  <em>Testez √©galement le</em> bouton <em>Effacer les sommets s√©lectionn√©s</em> pour vous assurer qu'il efface toutes les valeurs. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/17a/271/dea/17a271dea970e9c3ade451773b87eb65.gif"></div><br>  <em>Remarque:</em> dans l' <em>inspecteur</em> personnalis√© modifi√©, nous avons la possibilit√© d'afficher / masquer le manipulateur de transformation √† l'aide de <em>Afficher la poign√©e de transformation</em> .  Alors ne paniquez pas si vous ne trouvez pas le manipulateur Transform dans d'autres sc√®nes!  Allumez-le avant de quitter. <br><br><h3>  Transformer une sph√®re en c≈ìur </h3><br>  La modification des sommets du maillage en temps r√©el consiste essentiellement en trois √©tapes: <br><br><ol><li>  Copiez les sommets de maillage actuels (avant l'animation) dans <code>mVertices</code> . </li><li>  <code>mVertices</code> calculs et modifions les valeurs dans <code>mVertices</code> . </li><li>  Mettez √† jour les sommets de maillage actuels avec <code>mVertices</code> lors de la modification √† chaque √©tape et laissez Unity calculer automatiquement les normales. </li></ol><br>  Ouvrez <em>HeartMesh.cs</em> et les variables suivantes avant la fonction <code>Start()</code> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> radiusofeffect = <span class="hljs-number"><span class="hljs-number">0.3f</span></span>; <span class="hljs-comment"><span class="hljs-comment">//1 public float pullvalue = 0.3f; //2 public float duration = 1.2f; //3 int currentIndex = 0; //4 bool isAnimate = false; float starttime = 0f; float runtime = 0f;</span></span></code> </pre> <br>  Explication du code: <br><br><ol><li>  Rayon de la zone affect√©e par le sommet cible. </li><li>  Faites glisser la force. </li><li>  La dur√©e de l'animation. </li><li>  Index actuel de la liste <code>selectedIndices</code> . </li></ol><br>  Dans la fonction <code>Init()</code> , avant le bloc <code>if</code> , ajoutez ce qui suit: <br><br><pre> <code class="cs hljs">currentIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br>  Explication du code: au d√©but du jeu, <code>currentIndex</code> √† 0, le premier index de la liste <code>selectedIndices</code> . <br><br>  Dans la m√™me fonction <code>Init()</code> , avant le crochet de fermeture du bloc <code>else</code> , ajoutez ce qui suit: <br><br><pre> <code class="cs hljs">StartDisplacement();</code> </pre> <br>  Explication du code: ex√©cutez la fonction <code>StartDisplacement()</code> si <code>isEditMode</code> est false. <br><br>  Dans la fonction <code>StartDisplacement()</code> , ajoutez ce qui suit: <br><br><pre> <code class="cs hljs">targetVertex = oVertices[selectedIndices[currentIndex]]; <span class="hljs-comment"><span class="hljs-comment">//1 starttime = Time.time; //2 isAnimate = true;</span></span></code> </pre> <br>  Explication du code: <br><br><ol><li>  S√©lectionnez <code>targetVertex</code> pour d√©marrer l'animation. </li><li>  D√©finissez l'heure de d√©but et modifiez la valeur de <code>isAnimate</code> sur true. </li></ol><br>  Apr√®s la fonction <code>StartDisplacement()</code> , cr√©ez la fonction <code>FixedUpdate()</code> avec le code suivant: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FixedUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//1 { if (!isAnimate) //2 { return; } runtime = Time.time - starttime; //3 if (runtime &lt; duration) //4 { Vector3 targetVertexPos = oFilter.transform.InverseTransformPoint(targetVertex); DisplaceVertices(targetVertexPos, pullvalue, radiusofeffect); } else //5 { currentIndex++; if (currentIndex &lt; selectedIndices.Count) //6 { StartDisplacement(); } else //7 { oMesh = GetComponent&lt;MeshFilter&gt;().mesh; isAnimate = false; isMeshReady = true; } } }</span></span></span></span></code> </pre> <br>  Explication du code: <br><br><ol><li>  La fonction <code>FixedUpdate()</code> est ex√©cut√©e dans une boucle FPS fixe. </li><li>  Si <code>isAnimate</code> est faux, ignorez le code suivant. </li><li>  Modifiez <code>runtime</code> animations d' <code>runtime</code> . </li><li>  Si l' <code>runtime</code> est dans la <code>duration</code> , nous obtenons alors les coordonn√©es mondiales de <code>targetVertex</code> et <code>DisplaceVertices()</code> , couvrant le sommet cible avec les <code>radiusofeffect</code> <code>pullvalue</code> et <code>radiusofeffect</code> . </li><li>  Sinon, le temps est √©coul√©.  Ajoutez-en un √† <code>currentIndex</code> . </li><li>  V√©rifiez si <code>currentIndex</code> partie des <code>selectedIndices</code> .  Acc√©dez au sommet suivant de la liste √† l'aide de <code>StartDisplacement()</code> . </li><li>  Sinon, √† la fin de la liste, remplacez les donn√©es <code>oMesh</code> par le maillage actuel et <code>isAnimate</code> sur false pour arr√™ter l'animation. </li></ol><br>  Dans <code>DisplaceVertices()</code> ajoutez les √©l√©ments suivants: <br><br><pre> <code class="cs hljs">Vector3 currentVertexPos = Vector3.zero; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sqrRadius = radius * radius; <span class="hljs-comment"><span class="hljs-comment">//1 for (int i = 0; i &lt; mVertices.Length; i++) //2 { currentVertexPos = mVertices[i]; float sqrMagnitute = (currentVertexPos - targetVertexPos).sqrMagnitude; //3 if (sqrMagnitute &gt; sqrRadius) { continue; //4 } float distance = Mathf.Sqrt(sqrMagnitute); //5 float falloff = GaussFalloff(distance, radius); Vector3 translate = (currentVertexPos * force) * falloff; //6 translate.z = 0f; Quaternion rotation = Quaternion.Euler(translate); Matrix4x4 m = Matrix4x4.TRS(translate, rotation, Vector3.one); mVertices[i] = m.MultiplyPoint3x4(currentVertexPos); } oMesh.vertices = mVertices; //7 oMesh.RecalculateNormals();</span></span></code> </pre> <br>  Explication du code: <br><br><ol><li>  Le carr√© du rayon. </li><li>  Nous parcourons chaque sommet du maillage. </li><li>  <code>sqrMagnitude</code> entre <code>currentVertexPos</code> et <code>targetVertexPos</code> . </li><li>  Si <code>sqrMagnitude</code> d√©passe <code>sqrRadius</code> , passez au sommet suivant. </li><li>  Sinon, continuez en d√©finissant la valeur d' <code>falloff</code> , qui d√©pend de la <code>distance</code> sommet actuel par rapport au point central de l'oscilloscope. </li><li>  <code>Vector3</code> nouvelle position de <code>Vector3</code> et appliquez sa transformation au sommet actuel. </li><li>  Lorsque vous quittez la boucle, nous <code>mVertices</code> valeurs <code>mVertices</code> modifi√©es aux <code>mVertices</code> et <code>mVertices</code> Unity √† recalculer les normales. </li></ol><br><blockquote>  <em>Source de technologie Falloff</em> <br>  La formule d'origine est extraite du fichier de package d'actifs <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener">Exemples de proc√©dures</a> , qui peut √™tre t√©l√©charg√© gratuitement √† partir de l'Unity Asset Store. </blockquote><br>  Enregistrez le fichier et revenez √† Unity.  S√©lectionnez <em>Sph√®re</em> , acc√©dez au composant <em>HeartMesh</em> et essayez d'ajouter des sommets √† la propri√©t√© <em>Indices s√©lectionn√©s</em> .  D√©sactivez le <em>mode √âdition</em> et cliquez sur <em>Lecture</em> pour voir le r√©sultat de votre travail. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e1e/527/23b/e1e52723b08453591da6d10a28dbe13d.gif"></div><br>  Essayez les <em>valeurs Radiusofeffect</em> , <em>Pullvalue</em> et <em>Duration</em> pour obtenir des r√©sultats diff√©rents.  Lorsque vous √™tes pr√™t, modifiez les param√®tres conform√©ment √† la capture d'√©cran ci-dessous. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a63/c44/082/a63c44082183529e737f287cb746dfd6.png"></div><br>  Cliquez sur <em>Play</em> .  Votre sph√®re s'est-elle transform√©e en c≈ìur? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ce5/532/c83/ce5532c83ff152100775d62091370bf2.gif"></div><br>  F√©licitations!  Dans la section suivante, nous enregistrerons le maillage en tant que pr√©fabriqu√© pour une utilisation future. <br><br><h3>  Sauvegarde du maillage en temps r√©el </h3><br>  Pour enregistrer un maillage proc√©dural en forme de c≈ìur en mode Lecture, vous devez pr√©parer un pr√©fabriqu√© dont l'enfant sera un objet 3D, puis remplacer son actif de maillage par un nouveau √† l'aide d'un script. <br><br>  Dans la fen√™tre <em>Projet,</em> recherchez <em>CustomHeart</em> dans le dossier <em>Prefabs</em> .  Cliquez sur l'ic√¥ne de fl√®che pour d√©velopper son contenu et s√©lectionnez <em>Enfant</em> .  Vous voyez maintenant un objet Sph√®re dans la fen√™tre d'aper√ßu de l' <em>inspecteur</em> .  Il s'agit du pr√©fabriqu√© qui stockera les donn√©es du nouveau maillage. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9a3/f07/048/9a3f070486f3a66ee56304dae5bd2b12.png"></div><br>  Ouvrez <em>HeartMeshInspector.cs</em> .  Dans la fonction <code>OnInspectorGUI()</code> , avant le crochet de fermeture, ajoutez ce qui suit: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!mesh.isEditMode &amp;&amp; mesh.isMeshReady) { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> path = <span class="hljs-string"><span class="hljs-string">"Assets/Prefabs/CustomHeart.prefab"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//1 if (GUILayout.Button("Save Mesh")) { mesh.isMeshReady = false; Object pfObj = AssetDatabase.LoadAssetAtPath(path, typeof(GameObject)); //2 Object pfRef = AssetDatabase.LoadAssetAtPath (path, typeof(GameObject)); GameObject gameObj = (GameObject)PrefabUtility.InstantiatePrefab(pfObj); Mesh pfMesh = (Mesh)AssetDatabase.LoadAssetAtPath(path, typeof(Mesh)); //3 if (!pfMesh) { pfMesh = new Mesh(); } else { pfMesh.Clear(); } pfMesh = mesh.SaveMesh(); //4 AssetDatabase.AddObjectToAsset(pfMesh, path); gameObj.GetComponentInChildren&lt;MeshFilter&gt;().mesh = pfMesh; //5 PrefabUtility.ReplacePrefab(gameObj, pfRef, ReplacePrefabOptions.Default); //6 Object.DestroyImmediate(gameObj); //7 } }</span></span></code> </pre> <br>  Explication du code: <br><br><ol><li>  D√©finit le <code>path</code> d' <code>path</code> au <code>path</code> d'acc√®s √† l'objet <em>pr√©fabriqu√©</em> CustomHeart. </li><li>  Cr√©e deux objets √† partir du <em>pr√©fabriqu√©</em> CustomHeart, un pour cr√©er une instance en tant que GameObject ( <code>pfObj</code> ) et le second en tant que liens ( <code>pfRef</code> ). </li><li>  Cr√©e <em>une</em> instance de l'actif de maillage <code>pfMesh</code> .  S'il n'est pas trouv√©, cr√©e un nouveau maillage, sinon il nettoie les donn√©es existantes. </li><li>  <code>pfMesh</code> avec de nouvelles donn√©es de maillage, puis l'ajoute en tant qu'actif √† <em>CustomHeart</em> . <br></li><li>  Remplit un actif maill√© dans <code>gameObj</code> valeur <code>pfMesh</code> . </li><li>  Remplace <em>CustomHeart</em> par <code>gameObj</code> faisant correspondre les connexions pr√©existantes. </li><li>  <code>gameObj</code> instantan√©ment <code>gameObj</code> . </li></ol><br>  Enregistrez le fichier et acc√©dez √† <em>HeartMesh.cs</em> .  Dans la <code>SaveMesh()</code> g√©n√©rale <code>SaveMesh()</code> , apr√®s avoir cr√©√© l'instance <code>nMesh</code> ajoutez ce qui suit: <br><br><pre> <code class="cs hljs">nMesh.name = <span class="hljs-string"><span class="hljs-string">"HeartMesh"</span></span>; nMesh.vertices = oMesh.vertices; nMesh.triangles = oMesh.triangles; nMesh.normals = oMesh.normals;</code> </pre> <br>  Explication du code: renvoie un actif de maillage avec des valeurs provenant d'un maillage en forme de c≈ìur. <br><br>  Enregistrez le fichier et revenez √† Unity.  Cliquez sur <em>Lecture</em> .  Une fois l'animation termin√©e, le bouton <em>Enregistrer le maillage</em> appara√Æt dans l' <em>inspecteur</em> .  Cliquez sur le bouton pour enregistrer le nouveau maillage, puis arr√™tez le lecteur. <br><br>  Acc√©dez au dossier <em>Prefabs</em> et examinez le <em>pr√©fabriqu√©</em> CustomHeart.  Vous devriez voir que maintenant dans l'objet <em>pr√©fabriqu√©</em> CustomHeart il y a un tout nouveau maillage en forme de coeur. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/126/dee/103/126dee103ce798611d2dc2e94013c23c.png"></div><br>  <i>Excellent travail!</i> <br><br><h2>  Tout mettre ensemble </h2><br>  Dans la sc√®ne pr√©c√©dente, la fonction <code>DisplaceVertices()</code> utilis√© la formule Falloff pour d√©terminer la force de tra√Æn√©e qui a √©t√© appliqu√©e √† chaque sommet dans un rayon donn√©.  Le point de ¬´chute¬ª, auquel la force de tra√Æn√©e commence √† diminuer, d√©pend du type de chute utilis√©: lin√©aire, gaussien ou aiguille.  Chaque type produit des r√©sultats diff√©rents dans le maillage. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ff/284/9c0/9ff2849c0d0fe5f9d496d641c07e35d8.png"></div><br>  Dans cette section, nous verrons une autre fa√ßon de manipuler les sommets: en utilisant une courbe donn√©e.  En supposant que la vitesse est √©gale √† la distance divis√©e par le temps (d = (v / t)), nous pouvons d√©terminer la position du vecteur, en se r√©f√©rant √† sa distance divis√©e par le temps. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b8/2d6/13c/3b82d613cedaf85e12db66beb6349201.gif"></div><br><h3>  Utilisation de la m√©thode de courbe </h3><br>  Enregistrez la sc√®ne actuelle et ouvrez <em>03 Customize Heart Mesh</em> dans le dossier <em>Scenes</em> .  Vous verrez une instance de <em>hi√©rarchie</em> du <em>pr√©fabriqu√©</em> CustomHeart.  Cliquez sur l'ic√¥ne en forme de fl√®che √† c√¥t√© pour d√©velopper son contenu et s√©lectionnez <em>Enfant</em> . <br><br>  Affichez ses propri√©t√©s dans l' <em>inspecteur</em> .  Vous verrez le composant <em>Filtre de maillage</em> avec l'actif de <em>maillage Heart</em> .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attachez </font><font style="vertical-align: inherit;">un script </font><em><font style="vertical-align: inherit;">Heart personnalis√©</font></em><font style="vertical-align: inherit;"> √† </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Child en</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tant que composant </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Maintenant, l'actif devrait passer de </font><em><font style="vertical-align: inherit;">HeartMesh</font></em><font style="vertical-align: inherit;"> √† </font><em><font style="vertical-align: inherit;">cloner</font></em><font style="vertical-align: inherit;"> .</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/954/27f/89d/95427f89d17410e26893a0ec27dff51d.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensuite, ouvrez </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CustomHeart.cs √†</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partir du dossier </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scripts</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Avant la fonction, </font></font><code>Start()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ajoutez ce qui suit:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> CurveType { Curve1, Curve2 } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CurveType curveType; Curve curve;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Explication du code: ici une √©num√©ration g√©n√©rale est cr√©√©e sous le nom </font></font><code>CurveType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, apr√®s quoi elle est mise √† disposition par l' </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inspecteur</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acc√©dez √† </font></font><code>CurveType1()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et ajoutez les √©l√©ments suivants:</font></font><br><br><pre> <code class="cs hljs">Vector3[] curvepoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3[<span class="hljs-number"><span class="hljs-number">3</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//1 curvepoints[0] = new Vector3(0, 1, 0); curvepoints[1] = new Vector3(0.5f, 0.5f, 0); curvepoints[2] = new Vector3(1, 0, 0); curve = new Curve(curvepoints[0], curvepoints[1], curvepoints[2], false); //2</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Explication du code: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une courbe simple se compose de trois points. </font><font style="vertical-align: inherit;">D√©finissez les points de la premi√®re courbe.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous g√©n√©rons la premi√®re courbe avec l'aide </font></font><code>Curve()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et attribuons ses valeurs </font></font><code>curve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">La courbe dessin√©e peut √™tre affich√©e dans l'aper√ßu si vous sp√©cifiez true comme dernier param√®tre.</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acc√©dez √† </font></font><code>CurveType2()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et ajoutez les √©l√©ments suivants:</font></font><br><br><pre> <code class="cs hljs">Vector3[] curvepoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3[<span class="hljs-number"><span class="hljs-number">3</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//1 curvepoints[0] = new Vector3(0, 0, 0); curvepoints[1] = new Vector3(0.5f, 1, 0); curvepoints[2] = new Vector3(1, 0, 0); curve = new Curve(curvepoints[0], curvepoints[1], curvepoints[2], false); //2</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Explication du code: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> D√©finissez les points de la deuxi√®me courbe. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous g√©n√©rons la deuxi√®me courbe avec </font></font><code>Curve()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et attribuons ses valeurs </font></font><code>curve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">La courbe dessin√©e peut √™tre affich√©e dans l'aper√ßu si vous sp√©cifiez true comme dernier param√®tre.</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B </font></font><code>StartDisplacement()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, avant le crochet de fermeture, ajoutez ce qui suit:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (curveType == CurveType.Curve1) { CurveType1(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (curveType == CurveType.Curve2) { CurveType2(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Explication du code: ici nous v√©rifions l'option s√©lectionn√©e par l'utilisateur </font></font><code>curveType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et la g√©n√©rons en cons√©quence </font></font><code>curve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B </font></font><code>DisplaceVertices()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, √† l'int√©rieur de l'instruction de boucle </font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avant les crochets de fermeture, ajoutez ce qui suit:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> increment = curve.GetPoint(distance).y * force; <span class="hljs-comment"><span class="hljs-comment">//1 Vector3 translate = (vert * increment) * Time.deltaTime; //2 Quaternion rotation = Quaternion.Euler(translate); Matrix4x4 m = Matrix4x4.TRS(translate, rotation, Vector3.one); mVertices[i] = m.MultiplyPoint3x4(mVertices[i]);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Explication du code: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous </font><font style="vertical-align: inherit;">obtenons la </font><font style="vertical-align: inherit;">position de la courbe √† celle donn√©e </font></font><code>distance</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et multiplions sa valeur </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par </font></font><code>force</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour obtenir </font></font><code>increment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©ez un nouveau type de donn√©es </font></font><code>Vector3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour stocker la nouvelle position du sommet actuel et appliquez sa transformation en cons√©quence.</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enregistrez le fichier et revenez √† Unity. </font><font style="vertical-align: inherit;">V√©rifiez les propri√©t√©s du composant </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CustomHeart</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> objet jeu d' </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enfants</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vous verrez une liste d√©roulante o√π vous pouvez s√©lectionner le </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">type de courbe</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans la liste d√©roulante </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modifier le type</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">s√©lectionnez </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajouter des indices</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supprimer des indices</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour mettre √† jour la liste des sommets et exp√©rimenter diff√©rents param√®tres.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/792/1a7/3b6/7921a73b676b205bd33ec1db076cd4a6.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pour voir des r√©sultats d√©taill√©s pour diff√©rents types de courbes, entrez les valeurs selon la capture d'√©cran: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e06/ab3/e5d/e06ab3e5d0bfc950be0c6dbc82d36f6e.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour la liste </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Curve Type</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">s√©lectionnez </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Curve1</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , assurez-vous que </font><em><font style="vertical-align: inherit;">None est</font></em><font style="vertical-align: inherit;"> s√©lectionn√© </font><font style="vertical-align: inherit;">pour </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edit Type,</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> puis cliquez sur </font><em><font style="vertical-align: inherit;">Play</font></em><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vous devriez voir le maillage diverger dans le motif. </font><font style="vertical-align: inherit;">Faites rouler le mod√®le pour le voir en vue lat√©rale et comparez les r√©sultats pour les deux types de courbes. </font><font style="vertical-align: inherit;">Vous voyez ici comment le </font><em><font style="vertical-align: inherit;">type de courbe</font></em><font style="vertical-align: inherit;"> s√©lectionn√© </font><font style="vertical-align: inherit;">affecte le d√©calage du maillage.</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8e1/f90/4d5/8e1f904d50987247014011ac32261134.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/da0/e1a/df4/da0e1adf49f8503188f47826c4079cf1.png"></div><br>  C'est tout!<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez cliquer sur </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Effacer les sommets s√©lectionn√©s</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour r√©initialiser les </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indices s√©lectionn√©s</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et exp√©rimenter avec vos propres motifs. </font><font style="vertical-align: inherit;">Mais n'oubliez pas qu'il existe d'autres facteurs qui affecteront le r√©sultat final du maillage, √† savoir:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La valeur du rayon. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La distribution des sommets dans la zone. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Position du motif des sommets s√©lectionn√©s. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La m√©thode s√©lectionn√©e pour le d√©calage. </font></font></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O√π aller ensuite? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les fichiers du projet termin√© sont dans les </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">archives du projet de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tutoriel. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ne vous arr√™tez pas l√†! </font><font style="vertical-align: inherit;">Essayez les techniques plus sophistiqu√©es utilis√©es </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans le</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> didacticiel </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">Unity Procedural Maze Generation</font></a><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'esp√®re que vous avez appr√©ci√© ce didacticiel et que les informations vous ont √©t√© utiles. </font><font style="vertical-align: inherit;">Un grand </font><font style="vertical-align: inherit;">merci que </font><font style="vertical-align: inherit;">j'exprime </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jasper Flick</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catlike de </font><font style="vertical-align: inherit;">codage</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour ses excellents tutoriels qui m'a aid√© √† </font><font style="vertical-align: inherit;">assembler une d√©mo pour mon projet.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/190/e37/362/190e3736241796c39eac74bbe3ddc86e.png"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr428796/">https://habr.com/ru/post/fr428796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr428786/index.html">Processeur quantique bas√© sur la r√©sonance de spin et les manipulations avec un syst√®me singlet-triplet</a></li>
<li><a href="../fr428788/index.html">Sous le capot de Bitfury Clarke - comment fonctionne notre nouvelle puce mini√®re</a></li>
<li><a href="../fr428790/index.html">Nous √©crivons un chat bot pour VKontakte en python en utilisant longpoll. Deuxi√®me partie Boucles doubles, exceptions et autres h√©r√©sies</a></li>
<li><a href="../fr428792/index.html">La nouvelle puce Apple T2 rend difficile l'√©coute via le microphone int√©gr√© de l'ordinateur portable</a></li>
<li><a href="../fr428794/index.html">Pr√©sentation des m√©thodes de base d'optimisation math√©matique pour les probl√®mes de contraintes</a></li>
<li><a href="../fr428798/index.html">Comment survivre √† un d√©veloppeur ind√©pendant. 2e partie</a></li>
<li><a href="../fr428800/index.html">Cooking Perfect CSS</a></li>
<li><a href="../fr428806/index.html">Analyse des ch√®ques de consommation: ce qu'ils ach√®tent sur Amazon</a></li>
<li><a href="../fr428808/index.html">Peu de commodit√© dans la vie √©tudiante</a></li>
<li><a href="../fr428810/index.html">18 documents sur la technologie num√©rique dans l'audio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>