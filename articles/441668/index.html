<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåª ‚úãüèΩ ‚õπüèΩ STM32. Pr√°ctica de p√©rdida de peso o dieta para el controlador ‚õπüèø üë¥üèæ üõå</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Qu√© tipo de tonter√≠a, algunos lectores probablemente pensar√°n cuando vean el t√≠tulo de la publicaci√≥n. ¬øEl autor cometi√≥ un error en el recurso? ¬øO se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>STM32. Pr√°ctica de p√©rdida de peso o dieta para el controlador</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/441668/"><img src="https://habrastorage.org/webt/u0/9v/yw/u09vyw-escpdlkeezud4cab8trw.jpeg"><br><br><p>  Qu√© tipo de tonter√≠a, algunos lectores probablemente pensar√°n cuando vean el t√≠tulo de la publicaci√≥n.  ¬øEl autor cometi√≥ un error en el recurso?  ¬øO se plane√≥ colocarlo en el centro "Geek Health"?  Y estar√°n en parte en lo cierto, pero solo en parte ... Bajo el corte, hablaremos sobre un m√©todo para reducir y optimizar el consumo de energ√≠a de los dispositivos electr√≥nicos. </p><a name="habracut"></a><br><p>  Hace alg√∫n tiempo, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">placa X-NUCLEO-LPM01A</a> cay√≥ en mis manos, que por el momento estaba inactiva hasta que decid√≠ estudiar el consumo de energ√≠a de un dispositivo dise√±ado con energ√≠a aut√≥noma. </p><br><img src="https://habrastorage.org/webt/v-/ma/qp/v-maqpklxovwalvp3dc_99ireja.jpeg"><br><p>  Esta placa fue desarrollada por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">STMicroelectronics</a> y se posiciona como "Power Shield, placa de expansi√≥n Nucleo para la medici√≥n del consumo de energ√≠a".  No encontr√© una descripci√≥n explicativa en idioma ruso en la red para trabajar con este devkit y decid√≠ resolverlo yo mismo, y al mismo tiempo compartir informaci√≥n con la respetada comunidad de habro. </p><br><p>  Si destacamos la principal, la placa de expansi√≥n es una fuente de energ√≠a programable de 1.8 a 3.3 voltios con la capacidad de medir la corriente de carga en tiempo real (en modo din√°mico hasta <br>  50 mA) con una frecuencia de muestreo de hasta 100 kHz.  El dispositivo puede funcionar de forma independiente y como parte de un complejo de hardware y software.  Para mostrar gr√°ficamente los valores medidos, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se utiliza la</a> utilidad <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">STM32Cube MonitorPower</a> .  Este software tambi√©n le permite establecer todos los par√°metros necesarios y llevar a cabo el procesamiento en caso de que ocurra un evento (inicio del disparador).  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">X-NUCLEO-LPM01A est√°</a> afilado para trabajar con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">placas</a> Nucleo-32 (64, 144), Arduino Nano (Uno), para este prop√≥sito se colocan los escudos correspondientes, pero es posible trabajar con placas arbitrarias.  La foto a continuaci√≥n muestra la conexi√≥n del dispositivo en estudio a uno de los conectores de la placa. </p><br><img src="https://habrastorage.org/webt/3p/o-/ll/3po-lljw_abqlzhztomwkzncw0i.jpeg"><br><br><p>  Adem√°s del software de aplicaci√≥n, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">X-NUCLEO-LPM01A</a> admite el modo de comando, para el cual <s>cualquier programa de terminal deber√≠a</s> funcionar.  (Aqu√≠ parece que me emociono un poco, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://">HTerm termin√≥</a> con una media patada, pero tuve que jugar un poco con mi ZOC favorito).  Adem√°s, a juzgar por la descripci√≥n, a trav√©s del uso del controlador VCP, el dispositivo puede verter datos en el puerto COM con una velocidad de hasta 3686400 baudios.  Se garantiza una velocidad tan alta en particular mediante la transmisi√≥n de un flujo de datos binarios (para frecuencias de muestreo superiores a 50 KHz), para los caracteres ASCII la velocidad es ligeramente menor. </p><br><p>  M√°s espec√≠ficamente, la tarea que intentar√© resolver usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">X-NUCLEO-LPM01A</a> es: </p><ol><li><p>  Para obtener informaci√≥n sobre el consumo din√°mico de energ√≠a de los nodos de inter√©s en el producto dise√±ado utilizando el disparador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">X-NUCLEO-LPM01A</a> en los lugares estudiados del c√≥digo del programa. </p></li><li><p>  En el proceso de funcionamiento continuo del dispositivo para organizar la acumulaci√≥n de los fragmentos necesarios para su posterior an√°lisis generalizado. </p></li></ol><br><p>  La captura de pantalla siguiente muestra el registro actual de la tarjeta SD durante la grabaci√≥n de datos. </p><br> <a href=""><img src="https://habrastorage.org/webt/_g/t6/3h/_gt63h_pmhohs4w_q-higuefp8k.jpeg"></a> <br><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">STM32Cube MonitorPower</a> permite no solo cualitativamente, sino tambi√©n cuantitativamente evaluar el consumo de energ√≠a del dispositivo en estudio.  Los valores m√≠nimos, m√°ximos y promedio de la corriente consumida y el valor de energ√≠a integrado se muestran en la parte inferior de la imagen.  Dichos datos est√°n disponibles tanto para la medici√≥n completa como para el fragmento seleccionado. </p><br><p>  En el manual del usuario, se observa que la activaci√≥n del disparador de la medici√≥n se lleva a cabo por un impulso en la pata del escudo arduino D7.  Al final result√≥ que, solo un inicio del proceso con la grabaci√≥n continua posterior funciona.  El intento de organizar un modo de inicio-parada para registrar la corriente (en ambos frentes del pulso) no tuvo √©xito.  Es decir, una vez que comienza a grabar en el lugar correcto en el frente ascendente, no es posible ralentizar el proceso con un frente descendente del pulso.  Y esto no es exactamente lo que esperaba obtener de este dispositivo. </p><br><div class="spoiler">  <b class="spoiler_title">Se puede establecer un modo de inicio-parada totalmente controlado utilizando la secuencia de comandos del programa del terminal</b> <div class="spoiler_text"><table cellpadding="2"><tbody><tr><td><p>  el equipo </p></td><td><p>  la descripcion </p></td></tr><tr><td><p>  htc </p></td><td><p>  captura de control de host </p></td></tr><tr><td><p>  volt 3300-03 </p></td><td><p>  tensi√≥n de alimentaci√≥n en el canal medido 3300 mV </p></td></tr><tr><td><p>  acqtime 0 </p></td><td><p>  medici√≥n continua sin l√≠mite de tiempo </p></td></tr><tr><td><p>  freq 10000 </p></td><td><p>  frecuencia de muestreo 10 kHz </p></td></tr><tr><td><p>  empezar </p></td><td><p>  inicio de medici√≥n </p></td></tr><tr><td><p>  ... </p></td><td><p>  medici√≥n (los datos se vierten en el terminal) </p></td></tr><tr><td><p>  parar </p></td><td><p>  fin de la medida </p></td></tr></tbody></table></div></div><br><p>  El problema es que este es un control manual que no est√° sincronizado con los eventos en el controlador de destino.  Por supuesto, puede intentar formar la secuencia de comandos indicada en el lado del dispositivo en estudio, no en el host, pero luego el flujo de salida de datos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">X-NUCLEO-LPM01A</a> tambi√©n se rociar√° en el controlador y no est√° claro qu√© hacer con ellos, y la redirecci√≥n de la salida a "alg√∫n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lugar_ a_otro_</a> lugar" tampoco est√° disponible, ( aunque hay pines UART Tx, Rx en la placa, aparecen como "reservados" en el manual y probablemente no est√©n involucrados en la versi√≥n actual del firmware).  Sal√≠ de esta situaci√≥n de la siguiente manera: </p><br><div class="spoiler">  <b class="spoiler_title">La siguiente secuencia de comandos se forma en el lado del host (computadora)</b> <div class="spoiler_text"><table cellpadding="4"><tbody><tr><td><p>  el equipo </p></td><td><p>  la descripcion </p></td></tr><tr><td><p>  htc </p></td><td><p>  captura de control de host </p></td></tr><tr><td><p>  volt 3300-03 </p></td><td><p>  tensi√≥n de alimentaci√≥n en el canal medido 3300 mV </p></td></tr><tr><td><p>  <em><strong>acqtime 1</strong></em> </p></td><td><p>  duraci√≥n de la medici√≥n <br>  (se puede usar un rango de 10 Œºs a 10 segundos) </p></td></tr><tr><td><p>  <em><strong>trigsrc d7</strong></em> </p></td><td><p>  sincronizaci√≥n del comienzo de la medici√≥n con un borde ascendente <br>  pulso en el pin D7 </p></td></tr><tr><td><p>  freq 10000 </p></td><td><p>  frecuencia de muestreo 10 kHz </p></td></tr><tr><td><p>  empezar </p></td><td><p>  inicio de medici√≥n </p></td></tr><tr><td><p>  ... </p></td><td><p>  medici√≥n (los datos comienzan en el borde del pulso y se detienen <br>  vierta despu√©s del tiempo especificado en acqtime) </p></td></tr></tbody></table></div></div><br><p>  Ahora los datos se capturar√°n en lotes, en lugar de en una secuencia continua.  Este enfoque le permite explorar el consumo del circuito en diferentes lugares del programa y en diferentes intervalos de tiempo, que est√°n bastante lejos el uno del otro.  Es decir, si es necesario recopilar informaci√≥n sobre el consumo de energ√≠a de un dispositivo que funciona una hora (d√≠a, semana), no es necesario que escriba una secuencia continua, e incluso con una frecuencia de muestreo m√°xima, y ‚Äã‚Äãluego comprenda este desorden, solo proporcione el algoritmo de operaci√≥n anterior.  Y si el programa del terminal escribe marcadores de tiempo en su registro, como se muestra en la imagen a continuaci√≥n, entonces ser√° bastante simple analizar el historial de eventos desde dicho archivo. </p><br> <a href=""><img src="https://habrastorage.org/webt/pu/0j/cp/pu0jcpgvy-7wnmcgipzauzjjlw0.jpeg"></a> <br><br><p>  Es como una grabadora de video con detecci√≥n de movimiento y marcas de tiempo. </p><br><p>  D√©jame darte un par de capturas de pantalla obtenidas usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">X-NUCLEO-LPM01A</a> .  El primero es el consumo de energ√≠a del controlador mientras lee datos del ADC incorporado.  Se leen 32 valores por interrupci√≥n del temporizador con una frecuencia de 4 KHz y se almacenan en la memoria. </p><br> <a href=""><img src="https://habrastorage.org/webt/yu/d-/lz/yud-lz-ormre9rvdr9pqklka9e4.jpeg"></a> <br><br><p>  En el segundo: lectura y almacenamiento de datos similar, pero solo el controlador "se permite dormir" despu√©s de cada medici√≥n, hasta que se produce la siguiente interrupci√≥n del temporizador, utilizando uno de los modos de ahorro de energ√≠a disponibles. </p><br> <a href=""><img src="https://habrastorage.org/webt/zb/ze/zu/zbzezucrkjdtpxou_jll9hk3owm.jpeg"></a> <br><br><p>  Un delta significativo en el consumo de corriente durante la medici√≥n, ~ 6 mA, se nota inmediatamente.  Estos dos ejemplos no pretenden optimizar el consumo de energ√≠a de los dispositivos de baja potencia, sino que solo demuestran las capacidades del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">X-NUCLEO-LPM01A</a> , que es capaz de medir corrientes de 1 nA. </p><br><p>  En conclusi√≥n, dir√© que, en mi humilde opini√≥n, este dispositivo parece ser una herramienta perfectamente adecuada que puede ocupar el lugar que le corresponde al lado del osciloscopio y el analizador de se√±ales l√≥gicas en la mesa de inserci√≥n.  Y el uso del enfoque descrito permitir√° no solo "moderar el apetito del controlador" en el desarrollo de dispositivos cr√≠ticos de energ√≠a, sino tambi√©n comprender mejor la din√°mica de los procesos en los diversos modos de ahorro de energ√≠a utilizados activamente por los desarrolladores de dispositivos electr√≥nicos modernos. </p><br><p>  El costo del tablero: m√°s de 7,000 rublos, eclipsa el arco√≠ris de la imagen, pero ¬øuna cantidad tan insignificante en la actualidad puede evitar que un verdadero geek tenga este maravilloso kit de desarrollo? </p><br><p>  PD A pesar de la indicaci√≥n en UM de que UART est√° reservado para futuras aplicaciones, todav√≠a me qued√© pegado y descubr√≠ que vive como una segunda interfaz (la E / S est√° duplicada desde VCP) a una velocidad de 921600 8N1 y puede usarse como un comando, formando inicio y parada para el comienzo: el final de la medici√≥n.  La desventaja de este enfoque ser√° la disponibilidad obligatoria de UART gratis en el lado del controlador en estudio, sin mencionar el hecho de que 921600 baudios son a menudo imposibles a bajas frecuencias de reloj. </p><br><p>  PPS Ya despu√©s de escribir el art√≠culo, not√© una diferencia en las √∫ltimas im√°genes de ~ 2 mA en la entrada de la medici√≥n y al final de la misma.  Probablemente no apagu√© el reloj ADC, o dej√© el temporizador para trabajar, pero esto es, como le gusta decir a Leonid Kanevsky: "una historia completamente diferente" ... </p><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/441668/">https://habr.com/ru/post/441668/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../441648/index.html">Presentaci√≥n de Microsoft HoloLens 2</a></li>
<li><a href="../441650/index.html">Webinar Group-IB "Visi√≥n forense sobre la protecci√≥n de objetos CII en 2019"</a></li>
<li><a href="../441654/index.html">C√≥mo realizar una pasant√≠a en una gran empresa de TI</a></li>
<li><a href="../441660/index.html">STM32F103C8T6 como unidad flash con sistema de archivos FAT12</a></li>
<li><a href="../441664/index.html">Linus Torvalds no cree que los servidores en la arquitectura ARM reemplacen a x86. "Venta de un modelo de 64 bits - idiotez"</a></li>
<li><a href="../441676/index.html">C√≥mo hacer amigos PLUTO y HDSDR</a></li>
<li><a href="../441678/index.html">Juego de f√≠sica de tornados: c√≥mo se implementa la aerodin√°mica en Just Cause 4 (tr√°fico)</a></li>
<li><a href="../441680/index.html">Programa de conferencia Lua In Moscow 2019</a></li>
<li><a href="../441682/index.html">HyperX Fury 3D: SSD con un pedigr√≠ claro</a></li>
<li><a href="../441684/index.html">Predicciones: las nubes cambiar√°n 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>