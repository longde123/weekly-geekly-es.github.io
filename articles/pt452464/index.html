<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚öñÔ∏è üßü üí∫ Se o seu projeto for "Teatro", use atores üñ§ ü•à ‚ö±Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="H√° uma hist√≥ria sobre uma experi√™ncia do uso do modelo de ator em um projeto interessante de desenvolvimento de um sistema de controle autom√°tico para...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Se o seu projeto for "Teatro", use atores</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452464/"><p>  H√° uma hist√≥ria sobre uma experi√™ncia do uso do modelo de ator em um projeto interessante de desenvolvimento de um sistema de controle autom√°tico para um teatro.  Abaixo vou contar minhas impress√µes, n√£o mais do que isso. </p><a name="habracut"></a><br><p> H√° pouco tempo, participei de uma tarefa emocionante: moderniza√ß√£o do sistema de controle autom√°tico (ACS) para guinchos de sarrafo, mas, na verdade, era o desenvolvimento de um novo ACS. </p><br><p>  Um teatro moderno (especialmente se for grande) √© uma organiza√ß√£o muito complexa.  Existem muitas pessoas, v√°rios mecanismos e sistemas.  Um desses sistemas √© o ACS para o manuseio de eleva√ß√£o e configura√ß√£o do cen√°rio.  Apresenta√ß√µes modernas, como √≥peras e bal√©s, usam cada vez mais meios t√©cnicos ano ap√≥s ano.  O cen√°rio √© usado ativamente pelos diretores do programa e at√© desempenha seu pr√≥prio papel importante.  Foi fascinante descobrir o que est√° acontecendo por tr√°s das cortinas, porque os espectadores comuns podem ver apenas a√ß√µes em cena. </p><br><p>  Mas este √© um artigo t√©cnico, e quero compartilhar minha experi√™ncia de usar o Modelo de Ator para escrever um sistema de controle.  E compartilhe minhas impress√µes sobre o uso de uma das estruturas de ator para C ++: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SObjectizer</a> . </p><br><p>  Por que escolhemos essa estrutura?  Estamos analisando isso h√° muito tempo.  Existem muitos artigos em russo, e tem uma documenta√ß√£o maravilhosa e muitos exemplos.  O projeto parece maduro.  Uma breve olhada nos exemplos mostrou que os desenvolvedores do SObjectizer usam os mesmos termos (estados, temporizadores, eventos etc.) e n√£o esper√°vamos grandes problemas ao estud√°-lo e us√°-lo.  E ainda outro fator importante: a equipe do SObjectizer √© √∫til e sempre pronta para nos ajudar.  Ent√£o decidimos tentar. </p><br><h1 id="what-were-doing">  O que estamos fazendo? </h1><br><p>  Vamos falar sobre o objetivo do nosso projeto.  O sistema de talhas de sarrafo possui 62 sarrafos (tubos de metal).  Cada sarrafo tem o comprimento de todo o est√°gio.  Eles s√£o suspensos em cordas em paralelo com intervalos de 30 a 40 cm, a partir da borda frontal do palco.  Cada sarrafo pode ser elevado ou abaixado.  Alguns deles s√£o usados ‚Äã‚Äãem um show para cen√°rio.  O cen√°rio √© fixo no sarrafo e √© movido para cima / para baixo durante a apresenta√ß√£o.  Os comandos dos operadores iniciam o movimento.  Um sistema de "contrapeso de corda de motor" √© semelhante ao usado em elevadores em edif√≠cios residenciais.  Os motores s√£o colocados fora do palco, para que os espectadores n√£o os vejam.  Todos os motores s√£o divididos em 8 grupos, e cada grupo possui 3 conversores de frequ√™ncia (FC).  No m√°ximo tr√™s motores podem ser usados ‚Äã‚Äãao mesmo tempo em um grupo, cada um deles est√° conectado a um FC separado.  Portanto, temos um sistema de 62 motores e 24 FCs, e temos que controlar esse sistema. </p><br><p>  Nossa tarefa era desenvolver uma interface homem-m√°quina (HMI) para controlar esse sistema e implementar algoritmos de controle.  O sistema inclui tr√™s esta√ß√µes de controle.  Dois deles s√£o colocados logo acima do palco, e um est√° na sala de m√°quinas (esta esta√ß√£o √© usada por um eletricista de plant√£o).  Tamb√©m existem blocos de controle com controladores na sala de m√°quinas.  Esses controladores executam comandos de controle, modulam a largura de pulso (PWM), ligam ou desligam os motores, controlam a posi√ß√£o das ripas.  Duas esta√ß√µes de controle acima do palco t√™m monitores, unidades do sistema e trackballs como dispositivos apontadores.  As esta√ß√µes de controle s√£o conectadas via Ethernet.  Cada esta√ß√£o de controle √© conectada com blocos de controle pelo canal RS485.  Ambas as esta√ß√µes acima do palco podem ser usadas para controlar o sistema ao mesmo tempo, mas apenas uma esta√ß√£o pode estar ativa.  A esta√ß√£o ativa √© selecionada por um operador;  a segunda esta√ß√£o ser√° passiva;  a esta√ß√£o passiva tem seu canal RS485 desativado. </p><br><h1 id="why-actors">  Por que atores? </h1><br><p>  Do ponto de vista dos algoritmos, o sistema √© constru√≠do sobre os eventos.  Dados de sensores, a√ß√µes do operador, expira√ß√£o de temporizadores ... Todos esses s√£o exemplos de eventos.  O modelo de ator funciona bem para esses algoritmos: os atores lidam com eventos recebidos e formam algumas a√ß√µes de sa√≠da, dependendo do estado atual.  Essas mec√¢nicas est√£o dispon√≠veis no SObjectizer imediatamente. </p><br><p>  Os princ√≠pios b√°sicos para esses sistemas s√£o: atores interagem via mensagens ass√≠ncronas, atores t√™m estados e alternam de um estado para outro, apenas as mensagens que s√£o significativas para o estado atual s√£o tratadas. </p><br><p>  √â interessante que os atores sejam dissociados dos threads de trabalho no SObjectizer.  Isso significa que voc√™ pode implementar e depurar seus atores primeiro e s√≥ depois decidir qual encadeamento de trabalho ser√° usado para cada ator.  Existem "Dispatchers" que implementam v√°rias pol√≠ticas relacionadas ao encadeamento.  Por exemplo, h√° um expedidor que fornece um thread de trabalho separado para cada ator;  existe um distribuidor de conjunto de encadeamentos que fornece um conjunto de segmentos de trabalho de tamanho fixo;  existe um expedidor que executa todos os atores no mesmo encadeamento. </p><br><p>  A presen√ßa de despachantes fornece uma maneira muito flex√≠vel de ajustar um sistema de ator para nossas necessidades.  Podemos agrupar alguns atores para trabalhar no mesmo contexto.  Podemos alterar o tipo de expedidor apenas com uma √∫nica linha de c√≥digo.  Os desenvolvedores do SObjectizer dizem que escrever um despachante personalizado n√£o √© uma tarefa complexa.  Mas n√£o havia necessidade de escrever nosso pr√≥prio despachante neste projeto;  tudo o que precis√°vamos foi encontrado no SObjectizer. </p><br><p>  Outra caracter√≠stica interessante s√£o as coopera√ß√µes de atores.  Uma coopera√ß√£o √© um grupo de atores que pode existir se e somente se todos os atores foram iniciados com √™xito.  A coopera√ß√£o n√£o pode ser iniciada se pelo menos um de seus atores falhar ao iniciar.  Parece que existe uma analogia entre as coopera√ß√µes do SObjectizer e os pods da Kubernetes, mas tamb√©m parece que as coopera√ß√µes do SObjectizer apareceram anteriormente ... </p><br><p>  Quando um ator √© criado, ele √© adicionado √† coopera√ß√£o (a coopera√ß√£o pode conter apenas um ator) e √© vinculado a algum despachante.  √â f√°cil criar coopera√ß√µes e atores dinamicamente e os desenvolvedores do SObjectizer dizem que √© uma opera√ß√£o bastante barata. </p><br><p>  Todos os atores interagem entre si atrav√©s de "caixas de mensagem" (mbox).  √â mais um conceito interessante e poderoso do SObjectizer.  Ele fornece uma maneira flex√≠vel de processamento de mensagens. </p><br><p>  A princ√≠pio, pode haver mais de um receptor de mensagens atr√°s de uma mbox.  √â bastante √∫til.  Por exemplo, pode haver uma mbox usada pelos sensores para publicar novos dados.  Os atores podem criar assinaturas para essa mbox e os atores assinados receber√£o os dados que desejarem.  Isso permite trabalhar da maneira "Publicar / Assinar". </p><br><p>  Em um segundo momento, os desenvolvedores do SObjectizer consideraram a possibilidade de cria√ß√£o de mbox personalizada.  √â relativamente f√°cil criar uma mbox personalizada com processamento especial de mensagens recebidas (como filtrar ou espalhar entre v√°rios assinantes com base no conte√∫do da mensagem). </p><br><p>  H√° tamb√©m uma mbox pessoal para cada ator, e os atores podem passar uma refer√™ncia a essa mbox em mensagens para outros atores (que permitem responder diretamente a um ator espec√≠fico). </p><br><p>  Em nosso projeto, dividimos todos os objetos controlados em oito grupos (um grupo para cada caixa de controle).  Tr√™s threads de trabalho foram criados para cada grupo (√© porque apenas tr√™s mecanismos podem funcionar ao mesmo tempo).  Isso nos permitiu ter independ√™ncia entre grupos de motores.  Tamb√©m permitiu trabalhar de forma ass√≠ncrona com os mecanismos dentro de cada grupo. </p><br><p>  √â necess√°rio mencionar que o SObjectizer-5 n√£o possui mecanismos para interprocesso ou intera√ß√£o de rede.  Esta √© uma decis√£o consciente dos desenvolvedores do SObjectizer;  eles queriam tornar o SObjectizer o mais leve poss√≠vel.  Al√©m disso, o suporte transparente √† rede j√° existia em algumas vers√µes anteriores do SObjectizer, mas foi removido.  Isso n√£o nos incomodou porque um mecanismo para a rede depende muito de uma tarefa, protocolos usados ‚Äã‚Äãe outras condi√ß√µes.  N√£o existe uma solu√ß√£o universal √∫nica para todos os casos. </p><br><p>  No nosso caso, usamos nossa antiga biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">libuniset2</a> para comunica√ß√µes de rede e interprocessos.  Como resultado, o libuniset2 suporta comunica√ß√µes com sensores e blocos de controle, e o SObjectizer suporta atores e intera√ß√µes entre atores dentro de um √∫nico processo. </p><br><p>  Como eu disse anteriormente, existem 62 motores.  Todo mecanismo pode ser conectado a um FC (conversor de frequ√™ncia);  uma coordenada de destino pode ser especificada para o sarrafo correspondente;  a velocidade do movimento da barra tamb√©m pode ser especificada.  Al√©m disso, todo mecanismo tem os seguintes estados: </p><br><ul><li>  pronto para trabalhar; </li><li>  conectado; </li><li>  trabalhando; </li><li>  mau funcionamento; </li><li>  conectando (um estado de transi√ß√£o); </li><li>  desconectar (um estado de transi√ß√£o); </li></ul><br><p> Cada mecanismo √© representado no sistema por um ator que implementa a transi√ß√£o entre estados, manipulando dados de sensores e emitindo comandos.  N√£o √© dif√≠cil criar um ator no SObjectizer: apenas herde sua classe do tipo <code>so_5::agent_t</code> .  O primeiro argumento do construtor do ator deve ser do tipo <code>context_t</code> , todos os outros argumentos podem ser definidos como o desenvolvedor desejar. </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Drive_A</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">agent_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Drive_A( <span class="hljs-keyword"><span class="hljs-keyword">context_t</span></span> ctx, ... ); ... }</code> </pre> <br><p>  N√£o mostrarei a descri√ß√£o detalhada de classes e m√©todos porque n√£o √© um tutorial.  Eu s√≥ quero mostrar o qu√£o f√°cil tudo isso pode ser feito no SObjectizer (em algumas linhas, literalmente).  Deixe-me lembr√°-lo de que o SObjectizer possui uma excelente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> e muitos exemplos. </p><br><h1 id="what-is-the-state-of-an-actor-what-are-we-talking-about">  Qual √© o "estado" de um ator?  Do que estamos falando? </h1><br><p>  O uso de estados e a transi√ß√£o entre eles √© um "t√≥pico nativo" para sistemas de controle.  Este conceito √© muito bom para manipula√ß√£o de eventos.  Esse conceito √© suportado no SObjectizer no n√≠vel da API.  Os estados s√£o declarados dentro da classe do ator: </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Drive_A</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">agent_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Drive_A( <span class="hljs-keyword"><span class="hljs-keyword">context_t</span></span> ctx, ... ); <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~Drive_A(); <span class="hljs-comment"><span class="hljs-comment">//  state_t st_base {this}; state_t st_disabled{ initial_substate_of{st_base}, "disabled" }; state_t st_preinit{ substate_of{st_base}, "preinit" }; state_t st_off{ substate_of{st_base}, "off" }; state_t st_connecting{ substate_of{st_base}, "connecting" }; state_t st_disconnecting{ substate_of{st_base}, "disconnecting" }; state_t st_connected{ substate_of{st_base}, "connected" }; ... }</span></span></code> </pre> <br><p>  e, em seguida, os manipuladores de eventos s√£o definidos para cada estado.  √Äs vezes √© necess√°rio fazer algo ao entrar ou sair de um estado.  Isso tamb√©m √© suportado no SObjectizer atrav√©s dos manipuladores on_enter / on_exit.  Parece que os desenvolvedores do SObjectizer t√™m experi√™ncia no desenvolvimento de sistemas de controle. </p><br><h1 id="event-handlers">  Manipuladores de eventos </h1><br><p>  Um manipulador de eventos √© um local onde a l√≥gica do aplicativo √© implementada.  Como eu disse anteriormente, uma assinatura √© criada para uma mbox espec√≠fica e um estado espec√≠fico.  Se um ator n√£o tiver estados especificados explicitamente, ele estar√° em um "estado_ padr√£o" especial. </p><br><p>  Manipuladores diferentes podem ser definidos para o mesmo evento em diferentes estados.  Se voc√™ n√£o definir um manipulador para algum evento, esse evento ser√° ignorado (um ator n√£o saber√° sobre isso). </p><br><p>  Existe uma sintaxe simples para definir manipuladores de eventos.  Voc√™ especifica um m√©todo e n√£o h√° necessidade de especificar tipos ou par√¢metros de modelo adicionais.  Por exemplo: </p><br><pre> <code class="cpp hljs">so_subscribe(drv-&gt;so_mbox()) .in(st_base) .event( &amp;Drive_A::on_get_info ) .event( &amp;Drive_A::on_control ) .event( &amp;Drive_A::off_control );</code> </pre> <br><p>  √â um exemplo de inscri√ß√£o em eventos de uma mbox espec√≠fica no estado st_base.  Vale ressaltar que st_base √© um estado base para alguns outros estados e que a assinatura ser√° herdada pelos estados derivados.  Essa abordagem permite livrar-se de copiar e colar para manipuladores de eventos semelhantes em diferentes estados.  Mas o manipulador de eventos herdado pode ser redefinido para um estado espec√≠fico ou um evento pode ser completamente desativado ("suprimido"). </p><br><p>  Outra maneira de definir manipuladores de eventos √© usar fun√ß√µes lambda.  √â uma maneira muito conveniente, pois os manipuladores de eventos geralmente cont√™m apenas uma ou duas linhas de c√≥digo: um envio de algo para algum lugar ou uma altera√ß√£o de estado: </p><br><pre> <code class="cpp hljs">so_subscribe(drv-&gt;so_mbox()) .in(st_disconnecting) .event([<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>](<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">msg_disconnected_t</span></span>&amp; m) { ... st_off.activate(); }) .event([<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>]( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">msg_failure_t</span></span>&amp; m ) { ... st_protection.activate(); });</code> </pre> <br><p>  Essa sintaxe parece complexa no come√ßo, mas se torna familiar logo ap√≥s alguns dias de codifica√ß√£o ativa e voc√™ come√ßa a gostar.  √â porque toda a l√≥gica de algum ator pode ser concisa e colocada em uma tela.  No exemplo mostrado acima, h√° transi√ß√µes de st_disconnected para st_off ou st_protection.  Este c√≥digo √© f√°cil de ler. </p><br><p>  BTW, para casos diretos, onde apenas uma transi√ß√£o de estado √© necess√°ria, h√° uma sintaxe especial: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> mbox = drv-&gt;so_mbox(); st_off .just_switch_to&lt;<span class="hljs-keyword"><span class="hljs-keyword">msg_connected_t</span></span>&gt;(mbox, st_connected) .just_switch_to&lt;<span class="hljs-keyword"><span class="hljs-keyword">msg_failure_t</span></span>&gt;(mbox, st_protection) .just_switch_to&lt;<span class="hljs-keyword"><span class="hljs-keyword">msg_on_limit_t</span></span>&gt;(mbox, st_protection) .just_switch_to&lt;<span class="hljs-keyword"><span class="hljs-keyword">msg_on_t</span></span>&gt;(mbox, st_on);</code> </pre> <br><h1 id="the-control">  O controle </h1><br><p>  Como o controle √© organizado?  Como mencionado acima, existem duas esta√ß√µes de controle para controlar o movimento das ripas.  Cada esta√ß√£o de controle possui uma tela, um dispositivo apontador (trackball) e um regulador de velocidade (e n√£o contamos um computador dentro da esta√ß√£o e alguns acess√≥rios adicionais). </p><br><p>  Existem dois modos de controle: manual e "modo de cen√°rio".  O "modo de cen√°rio" ser√° discutido mais tarde, e agora vamos falar sobre o modo manual.  Nesse modo, um operador seleciona uma barra, prepara-a para o movimento (conecta o motor a um FC), define a marca alvo para a barra e, quando a velocidade √© definida acima de zero, a barra come√ßa a se mover. </p><br><p>  O regulador de velocidade √© um acess√≥rio f√≠sico na forma de um "potenci√¥metro com al√ßa", mas tamb√©m h√° um virtual mostrado no visor da esta√ß√£o.  Quanto mais ele gira, maior √© a velocidade de movimento.  A velocidade m√°xima √© limitada a 1,5 metros por segundo.  O regulador de velocidade √© um para todas as ripas.  Isso significa que todas as ripas selecionadas se movem na mesma velocidade.  As ripas podem se mover em dire√ß√µes opostas (depende da sele√ß√£o do operador).  √â aparente que √© dif√≠cil para um humano controlar mais do que algumas ripas.  Por esse motivo, apenas pequenos grupos de ripas s√£o manuseados no modo manual.  Os operadores podem controlar ripas de duas esta√ß√µes de controle ao mesmo tempo.  Portanto, h√° um regulador de velocidade separado para cada esta√ß√£o. </p><br><p>  Do ponto de vista da implementa√ß√£o, n√£o h√° l√≥gica espec√≠fica no modo manual.  Um comando "conectar mecanismo" sai da interface gr√°fica, √© transformado em uma mensagem correspondente a um ator e, em seguida, est√° sendo tratado por esse ator.  O ator passa do estado "desligado" para "conectando" e depois para o estado "conectado".  Coisas semelhantes acontecem com os comandos para posicionar uma barra e definir a velocidade do movimento.  Todos esses comandos s√£o passados ‚Äã‚Äãpara um ator na forma de mensagens.  Mas vale ressaltar que "interface gr√°fica" e "processo de controle" s√£o processos separados e o libuniset2 √© usado para o IPC. </p><br><h1 id="the-scenario-mode-are-there-actors-again">  O modo Cen√°rio (existem atores de novo?) </h1><br><p>  Na pr√°tica, o modo manual √© usado apenas para casos muito simples ou durante os ensaios.  O modo de controle principal √© "modo de cen√°rio".  Nesse modo, cada barra √© movida para uma posi√ß√£o espec√≠fica com velocidade espec√≠fica, de acordo com as configura√ß√µes do cen√°rio.  Dois comandos simples est√£o dispon√≠veis para um operador nesse modo: </p><br><ul><li>  prepare (um grupo de motores est√° sendo conectado ao FC); </li><li>  ir (o movimento do grupo come√ßa). </li></ul><br><p>  Todo o cen√°rio √© dividido em "agendas".  Uma "agenda" descreve um √∫nico movimento de um grupo de sarrafos.  Isso significa que uma "agenda" inclui alguns sarrafos e cont√©m destinos e velocidades desejados para eles.  Na realidade, um cen√°rio consiste em atos, atos consistem em imagens, imagem consiste em agendas e agenda consiste em alvos para sarrafos.  Mas, do ponto de vista do controle, isso n√£o importa, porque apenas as agendas cont√™m os par√¢metros precisos do movimento da barra. </p><br><p>  O modelo do ator se encaixa perfeitamente nesse caso.  N√≥s desenvolvemos um "player de cen√°rio" que gera um grupo de atores especiais e os inicia.  Desenvolvemos dois tipos de atores: atores executores (eles controlam o movimento das ripas) e atores coordenadores (eles distribuem tarefas entre os executores).  Executores s√£o criados sob demanda: quando n√£o h√° executores livres, um novo executor ser√° criado.  O coordenador gerencia o pool de executores dispon√≠veis.  Como resultado, o controle √© mais ou menos assim: </p><br><ul><li>  um operador carrega um cen√°rio; </li><li>  "rola" at√© a agenda necess√°ria; </li><li>  pressiona o bot√£o "preparar" no momento apropriado.  Nesse momento, uma mensagem √© enviada para um coordenador.  Esta mensagem cont√©m dados para todos os sarrafos da agenda; </li><li>  o coordenador analisa seu conjunto de executores e distribui tarefas entre executores livres (novos executores s√£o criados, se necess√°rio); </li><li>  cada executor recebe uma tarefa e executa a√ß√µes de prepara√ß√£o (conecta um mecanismo a um FC e aguarda o comando "go"); </li><li>  o operador pressiona o bot√£o "go" no momento apropriado; </li><li>  o comando "go" vai para o coordenador e distribui o comando entre todos os executores atualmente em uso. </li></ul><br><p>  Existem alguns par√¢metros adicionais nas agendas.  Como "iniciar o movimento somente ap√≥s um atraso de N segundos" ou "iniciar o movimento somente ap√≥s um comando adicional de um operador".  Por esse motivo, a lista de estados de um executor √© bastante longa: "pronto para o pr√≥ximo comando", "pronto para movimento", "atraso do movimento", "aguardando comando do operador", "movendo", "conclu√≠do", "falha". </p><br><p>  Quando uma barra atinge com sucesso a marca de destino (ou h√° uma falha), o executor informa o coordenador sobre a conclus√£o da tarefa.  O coordenador responde com um comando para desligar o mecanismo (se o sarrafo n√£o participa mais da agenda) ou envia uma nova tarefa ao executor.  O executor desliga o mecanismo e passa para o estado "em espera" ou inicia o processamento do novo comando. </p><br><p>  Como o SObjectizer possui uma API bastante atenciosa e conveniente para trabalhar com estados, o c√≥digo de implementa√ß√£o acabou sendo bastante conciso.  Por exemplo, um atraso antes do movimento √© descrito apenas por uma linha de c√≥digo: </p><br><pre> <code class="cpp hljs">st_delay.time_limit( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::chrono::milliseconds{target-&gt;delay()}, st_moving ); st_delay.activate(); ...</code> </pre> <br><p>  O m√©todo <code>time_limit</code> especifica a quantidade de tempo para permanecer no estado e qual estado deve ser ativado em seguida ( <code>st_moving</code> nesse exemplo). </p><br><h1 id="protection-actors">  Atores de prote√ß√£o </h1><br><p>  Certamente, podem ocorrer falhas.  Existem requisitos para lidar corretamente com essas falhas.  Os atores tamb√©m s√£o usados ‚Äã‚Äãpara essas tarefas.  Vejamos alguns exemplos: </p><br><ul><li>  prote√ß√£o contra sobrecorrente; </li><li>  prote√ß√£o contra mau funcionamento do sensor; </li><li>  prote√ß√£o contra movimento na dire√ß√£o oposta (isso pode acontecer se houver algo errado com sensores ou atuadores); </li><li>  prote√ß√£o contra movimento espont√¢neo (sem comando); </li><li>  controle de execu√ß√£o de comando (o movimento de uma barra deve ser verificado). </li></ul><br><p>  Podemos ver que todos esses casos s√£o auto-suficientes, mas devem ser controlados juntos, ao mesmo tempo.  Isso significa que qualquer falha pode acontecer.  Mas toda verifica√ß√£o tem sua l√≥gica: √†s vezes √© necess√°rio verificar um tempo limite, √†s vezes √© necess√°rio analisar alguns valores anteriores de um sensor.  Por esse motivo, a prote√ß√£o √© implementada na forma de pequenos atores.  Esses atores s√£o adicionados √† coopera√ß√£o com o ator principal que implementa a l√≥gica de controle.  Essa abordagem permite a adi√ß√£o f√°cil de novos casos de prote√ß√£o: basta adicionar mais um ator protetor √† coopera√ß√£o.  O c√≥digo desse ator geralmente √© conciso e f√°cil de entender, porque implementa apenas uma fun√ß√£o. </p><br><p>  Os atores protetores tamb√©m t√™m v√°rios estados.  Geralmente, eles s√£o ligados quando um motor √© ligado ou quando um sarrafo inicia seu movimento.  Quando um protetor detecta uma falha / mau funcionamento, ele publica uma notifica√ß√£o (com c√≥digo de prote√ß√£o e alguns detalhes adicionais).  O ator principal reage a essa notifica√ß√£o e executa as a√ß√µes necess√°rias (como desligar o mecanismo e mudar para o estado protegido). </p><br><h1 id="as-the-conclusion">  Como conclus√£o ... </h1><br><p>  ... este artigo n√£o √© um avan√ßo, √© claro.  O modelo de ator est√° sendo usado em v√°rios sistemas diferentes por um longo tempo.  Mas foi minha primeira experi√™ncia no uso do modelo de ator para construir um sistema de controle autom√°tico em um projeto bastante pequeno.  E essa experi√™ncia acabou sendo bastante bem-sucedida.  Espero ter demonstrado que os atores se encaixam bem nos algoritmos de controle: existem lugares para atores literalmente em todo lugar. </p><br><p>  Implementamos algo semelhante em projetos anteriores (refiro-me a estados, troca de mensagens, gerenciamento de threads de trabalho etc.), mas n√£o era uma abordagem unificada.  Usando o SObjectizer, obtemos uma ferramenta pequena e leve que resolve muitos problemas.  N√£o precisamos mais (explicitamente) usar mecanismos de sincroniza√ß√£o de baixo n√≠vel (como mutexes), n√£o h√° gerenciamento manual de threads, nem mais statecharts manuscritos.  Tudo isso √© fornecido pela estrutura, logicamente conectado e expresso na forma de API conveniente, mas voc√™ n√£o perde o controle sobre os detalhes.  Ent√£o foi uma experi√™ncia emocionante.  Se voc√™ ainda estiver em d√∫vida, recomendo que voc√™ d√™ uma olhada no Modelo do ator e no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SObjectizer</a> em particular.  Deixa emo√ß√µes positivas. </p><br><p>  O modelo do ator realmente funciona!  Especialmente no teatro. </p><br><p>  Artigo original em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">russo</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt452464/">https://habr.com/ru/post/pt452464/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt452454/index.html">Entrando no DevOps do Azure usando suas credenciais do GitHub</a></li>
<li><a href="../pt452456/index.html">O Microsoft Kaizala permite que a Indian Railways conecte seus tr√™s milh√µes de funcion√°rios a servi√ßos de sa√∫de</a></li>
<li><a href="../pt452458/index.html">Assista c√£es na vida real ou vulnerabilidades graves no ACS</a></li>
<li><a href="../pt452460/index.html">Apresentando o Terminal do Windows</a></li>
<li><a href="../pt452462/index.html">Sobre OOP</a></li>
<li><a href="../pt452466/index.html">Teclado Braille</a></li>
<li><a href="../pt452468/index.html">"Se voc√™ precisa matar algu√©m, veio ao endere√ßo"</a></li>
<li><a href="../pt452474/index.html">An√°lise wavelet. Parte 2</a></li>
<li><a href="../pt452478/index.html">Criando tabelas no sistema de design Figma e implementa√ß√£o no Storybook (React)</a></li>
<li><a href="../pt452480/index.html">Phoenix LiveView: quando voc√™ n√£o precisa mais JavaScript *</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>