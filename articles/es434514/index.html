<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë≤üèæ üë©üèª‚Äçü§ù‚Äçüë®üèΩ üè´ DPAPI o DPAPI "Secretos" para Pentesters üëß üé£ üë¶üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El segundo art√≠culo se basa en los resultados del desempe√±o de nuestro equipo en OFFZONE-2018. Esta vez, considere una charla con MainTrack "Windows D...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DPAPI o DPAPI "Secretos" para Pentesters</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434514/">  El segundo art√≠culo se basa en los resultados del desempe√±o de nuestro equipo en OFFZONE-2018.  Esta vez, considere una charla con MainTrack "Windows DPAPI" Sekretiki "o DPAPI para pentesters". <br><br>  Atencion  ¬°Muchas hayas! <br><br>  Al realizar campa√±as de RedTeam, quiero dar menos razones para la reacci√≥n de BlueTeam, pero puede haber muchas.  Por ejemplo, ejecutar mimikatz para obtener contrase√±as o certificados de usuario.  Incluso si pudi√©ramos "otmazyvat" de Kaspersky, BlueTeam tiene la capacidad de rastrear usando herramientas especializadas como Sysmon, Microsoft ATA, etc.  Al mismo tiempo, me gustar√≠a obtener la m√°xima informaci√≥n de una m√°quina de usuario comprometida.  En el curso de las campa√±as llevadas a cabo repetidamente por RedTeam para contrarrestar equipos reales de BlueTeam, llegamos a la conclusi√≥n de que es necesario evitar acciones que puedan servir como indicadores de compromiso del sistema.  Para lograr este objetivo es posible mediante el uso de mecanismos legales y acciones proporcionadas por el sistema operativo para el usuario. <br><br>  Una de esas herramientas legales es el mecanismo DPAPI (API de protecci√≥n de datos de Windows), que es utilizado por el sistema operativo y varias aplicaciones para cifrar datos confidenciales del usuario (principalmente contrase√±as, claves criptogr√°ficas, etc.). Para el usuario final y sus aplicaciones, DPAPI parece extremadamente simple : Solo hay 2 funciones: "cifrar datos" y "descifrar datos".  En este art√≠culo me gustar√≠a considerar c√≥mo tal mecanismo es √∫til para los pentesters durante las campa√±as de RedTeam. <br><a name="habracut"></a><br><h3>  ¬øQu√© es DPAPI?  Solo brevemente y en ruso </h3><br>  Desde 2000, todos los sistemas operativos Windows han comenzado a usar el motor DPAPI para mantener seguros los datos del usuario. <br><br>  Si omitimos toda la criptograf√≠a que examinamos en el informe, para descifrar los datos cifrados a trav√©s de DPAPI, necesitamos: una clave maestra, SID de usuario, hash de contrase√±a de usuario y el blob DPAPI (datos DPAPI cifrados). <br><br>  En general, el proceso se ve as√≠: <br><br><img src="https://habrastorage.org/webt/n1/ex/ah/n1exahepzml5ykake_tcy_qaj6i.jpeg"><br><br>  Dentro de nuestro "sombrero criptogr√°fico" hay muchos mecanismos criptogr√°ficos diferentes que no consideraremos en este art√≠culo, para no sobrecargar al lector.  Solo notamos que la parte principal de DPAPI es la llamada Masterkey (clave maestra).  En t√©rminos simples, la clave maestra es de 64 bytes de datos aleatorios cifrados con la clave previa, que se genera a partir de la contrase√±a del usuario y su SID. <br><img src="https://habrastorage.org/webt/dr/gu/b2/drgub2ccge4pjhkz1czilfleveg.jpeg"><br><br>  Los par√°metros adicionales tambi√©n participan en la generaci√≥n previa a la clave: el n√∫mero de iteraciones (IterN), sal y HMAC, que pueden variar de un caso a otro.  Los valores de estos par√°metros se almacenan junto con la clave maestra en un archivo. <br><br>  Por lo tanto, conociendo la contrase√±a del usuario, su SID y leyendo los par√°metros de generaci√≥n del archivo de clave maestra (HMAC, Salt, InterN), podemos generar una clave previa y descifrar la clave maestra, es decir.  obtenga los 64 bytes muy aleatorios que usaremos para descifrar los blobs DPAPI. <br><br><h3>  ¬øQu√© pasa si cambio mi contrase√±a? </h3><br>  Por lo general, las contrase√±as de los usuarios cambian a intervalos regulares.  ¬øQu√© sucede si el usuario cambia la contrase√±a?  ¬øA d√≥nde fue el anterior?  De hecho, para descifrar la clave maestra, debe conocer la contrase√±a del usuario, y volver a cifrar todas las claves maestras del usuario cada vez es un placer demasiado costoso.  En este caso, todo est√° pensado en Windows. <br><br>  Hay un archivo especial (CREDHIST), cuya tarea es almacenar todas las contrase√±as de usuario anteriores.  Tambi√©n se cifra con la contrase√±a actual del usuario y se almacena en la pila.  Si el sistema de repente no descifra la clave maestra, entonces procede de la siguiente manera: usando la contrase√±a actual, descifra el primer registro en CREDHIST.  La contrase√±a est√° tratando de descifrar la clave maestra nuevamente, y as√≠ sucesivamente hasta que se agoten las contrase√±as en la cadena o se descifre la clave maestra. <br><br><h3>  Un poco sobre las claves privadas de un controlador de dominio </h3><br>  Como habr√°s adivinado, DPAPI se aplica a todos los usuarios, incluidos los usuarios de dominio.  Para poder restablecer la contrase√±a a un usuario que la ha olvidado con √©xito despu√©s de una fiesta el viernes por la noche, necesita una clave de repuesto que se guardar√° en un lugar seguro.  Seg√∫n Microsoft, un lugar tan confiable es un controlador de dominio. <br><br>  La esencia del mecanismo para descifrar la clave maestra despu√©s de restablecer la contrase√±a del usuario es la siguiente: se crea un par de claves RSA, privadas y p√∫blicas, en el controlador de dominio.  La clave privada se almacena en el controlador de dominio en la base de datos NTDS y se llama BCKUPKEY_xxxx (consulte la figura a continuaci√≥n), y la clave p√∫blica se distribuye a todos los sistemas de dominio y se utiliza para generar un duplicado de la clave maestra cuando se genera. <br><br>  Despu√©s de crear una clave maestra en una m√°quina de dominio, tambi√©n se crea su duplicado (o m√°s bien, el material de la clave maestra es sus 64 bytes), que se almacena junto con la clave maestra principal en un archivo y se llama Clave de dominio.  Si pierde la clave maestra principal, es decir  Al restablecer la contrase√±a del usuario, el sistema env√≠a un duplicado al controlador de dominio y le pide que la descifre.  El controlador, habiendo autorizado al usuario, descifra el duplicado y lo devuelve al sistema, despu√©s de lo cual el material de la clave maestra ya est√° encriptado nuevamente con una nueva contrase√±a. <br><br><img src="https://habrastorage.org/webt/jj/7h/zr/jj7hzrqypjkdjwiaooxks9wcbj0.jpeg"><br><br>  Al tener los privilegios apropiados en el dominio (generalmente administrador), puede obtener estas claves RSA privadas del controlador de dominio a trav√©s del mecanismo de replicaci√≥n y usarlas para descifrar a√∫n m√°s las claves maestras creadas en las m√°quinas de dominio.  Esto se puede hacer usando mimikatz o DSInternals.  Puede leer m√°s sobre esto en el wiki <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mimikatz</a> o en el blog <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DSInternals</a> . <br><br><h3>  ¬øD√≥nde se almacenan las claves maestras y qu√© son? </h3><br>  La clave maestra puede ser el usuario y el sistema, seg√∫n los secretos que est√©n cifrados.  La clave maestra de usuario se almacena en el perfil de usuario de la siguiente manera: <br><br> <code>Users\%USER%\AppData\Roaming\Microsoft\Protect\%SID%\</code> <br> <br>  Por si acaso, el sistema almacena todas las claves maestras utilizadas por el usuario.  Despu√©s de todo, ella no sabe de antemano qu√© maestro necesitar√° descifrar algo con una clave.  El GUID de la clave actual utilizada se almacena en el archivo Preferido. <br><br><img src="https://habrastorage.org/webt/xf/vm/dr/xfvmdrhqgsspxyznypourrwceh8.jpeg"><br><br>  Las claves maestras del sistema se almacenan de la siguiente manera: <br> <code>windows\system32\Microsoft\Protect\S-1-5-18\</code> <br> <br>  De manera similar con el usuario, se utiliza una clave maestra, cuyo nombre se puede encontrar en el archivo Preferido, donde se almacenan todas las claves que se han utilizado. <br><br><img src="https://habrastorage.org/webt/zt/xt/xj/ztxtxjcblhgk7ugrwxwgosbtmjw.jpeg"><br><br><h3>  Bueno, ¬øqu√© puede darle este DPAPI al Pentester? </h3><br>  Dado que DPAPI es un mecanismo legal y simple, varias aplicaciones intentan usarlo.  Porque es conveniente y seguro.  Por el momento, por supuesto. <br><br>  Por ejemplo, DPAPI se usa para cifrar claves privadas de certificados de cliente y sistema, claves WIFI, Chrome (cookies, contrase√±as), DropBox, Skype, RSA SecurID (una aplicaci√≥n de software que genera claves √∫nicas).  Y esta no es una lista exhaustiva. <br><br>  La tarea del pentester es descifrar los blobs necesarios y obtener contrase√±as, cookies, etc. <br><br>  Hay varias formas de hacer esto.  De una forma u otra, todos se reducen a dos transcripciones: en l√≠nea y fuera de l√≠nea.  El descifrado en l√≠nea es cuando en la m√°quina del usuario simplemente llamamos a las funciones del sistema para descifrar los datos y pasamos el blob DPAPI a la entrada, y el sistema hace todo por s√≠ mismo: busca la clave maestra con la que se cifr√≥ el blob, lo descifra usando el SID del usuario y un hash de contrase√±a almacenado en la memoria LSASS. <br><br>  La siguiente figura muestra un ejemplo de invocaci√≥n de funciones DPAPI para cifrado y descifrado en powershell. <br><br><img src="https://habrastorage.org/webt/nj/h3/ko/njh3koyjpr5f1yft8o6zllkpjfw.jpeg"><br><br>  Primero, encriptamos nuestro secreto (en este caso, la palabra "Contrase√±a") llamando a la funci√≥n [Security.Cryptography.ProtectedData] :: Protect ().  Y hacemos esto dos veces, en el primer caso usando la clave maestra del usuario (par√°metro CurrentUser), y en el segundo, la clave maestra del sistema (par√°metro LocalMachine).  Entonces podemos descifrar los blobs resultantes llamando a la funci√≥n inversa - [Security.Cryptography.ProtectedData] :: UnProtect (). <br><br>  Adem√°s, en este caso, el valor del par√°metro CurrentUser o LocalMachine no importa, porque  el sistema mismo encuentra una clave maestra adecuada para decodificar el blob y hace todo lo necesario.  En ambos casos, obtenemos nuestro secreto inicial: la palabra "Contrase√±a" (su representaci√≥n byte a bit). <br><br>  Al descifrar en l√≠nea, es importante comprender en qu√© contexto est√° llamando a la funci√≥n UnProtect ().  Para que el descifrado tenga √©xito, debe estar en una sesi√≥n de usuario o iniciar sesi√≥n en una nueva sesi√≥n.  El problema es el hash de contrase√±a, que se almacena en la memoria LSASS.  Si realiza una llamada fuera de la sesi√≥n del usuario (por ejemplo, inici√≥ sesi√≥n en el sistema a trav√©s de la red a trav√©s de psexec o meterpreter), entonces no necesita un hash de contrase√±a para descifrar la clave maestra.  √âl, por supuesto, est√° en la pr√≥xima sesi√≥n, pero LSASS no te lo dar√°, porque  Esta es otra sesi√≥n, aunque fue creada bajo el mismo usuario.  Para un descifrado en l√≠nea exitoso, debe migrar a cualquier proceso iniciado por el usuario que inici√≥ sesi√≥n a trav√©s de la GUI o iniciar sesi√≥n completamente en el sistema, por ejemplo, a trav√©s de RDP. <br><br>  Una alternativa a powershell para el descifrado en l√≠nea de blobs DPAPI puede ser una llamada a mimiktaz :: blob con el par√°metro / unprotect.  En la entrada, se le da un archivo binario con un blob DPAPI, y en la salida obtenemos datos descifrados.  Se describen m√°s casos con mimikatz <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en el blog</a> HarmJ0y. <br><br><h3>  La bola blanca cay√≥.  ¬øQu√© hacer con mi granja con vidyuhi? </h3><br>  Debido al hecho de que las claves maestras DPAPI est√°n encriptadas en la contrase√±a del usuario, puede intentar el proceso inverso: fuerza bruta la contrase√±a del usuario con su clave maestra.  Por ejemplo, recibimos una conexi√≥n inversa de nuestra macro o DDE desde el archivo docx enviado.  Podemos tomar la clave maestra del usuario y restaurar la contrase√±a del usuario sin escalar los privilegios y los lanzamientos de mimikatz. <br><br>  ¬øPuedo usar Hashcat o JohnTheRipper para la fuerza bruta de la contrase√±a?  Pero antes de eso, debe obtener los par√°metros para la fuerza bruta de la composici√≥n de John con el script apropiado: <br><br><pre> <code class="xml hljs">./DPAPImk2john.py ‚ÄìS <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sid</span></span></span><span class="hljs-tag">&gt;</span></span> -mk <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkey</span></span></span><span class="hljs-tag">&gt;</span></span> -c <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">domain|local</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Entonces ya podemos enviar el resultado del script a nuestra granja con tarjetas de video y esperar que el usuario tenga una contrase√±a d√©bil, porque  la velocidad de fuerza bruta de la clave maestra es aproximadamente comparable a la velocidad de enumeraci√≥n WPA2, es decir  bastante despacio <br><br>  Vale la pena se√±alar aqu√≠ que en el caso de que se genere una clave maestra en un dominio de Windows 10, se agregan otras 10.000 rondas del algoritmo PBKDF2 a la generaci√≥n de la clave previa.  Pero a√∫n peor, ni Hashcat ni JohnTheRipper lo saben (al menos al momento de escribir esto), lo que significa que no podr√°n eliminar la contrase√±a de dicha clave maestra. <br><br><h3>  "Quitar todo lo que es malo y luego resolverlo ..." </h3><br>  Como notamos anteriormente, la ejecuci√≥n de acciones sospechosas en la m√°quina del usuario puede provocar un inter√©s adicional por parte del equipo de Blueteam, y esto, en consecuencia, est√° plagado del hecho de que todo RedTeam terminar√° all√≠.  Un ejemplo es el lanzamiento de powershell en la computadora de un contador o secretario, seguido de una investigaci√≥n del incidente.  Para no causar sospechas innecesarias, es mejor usar m√©todos fuera de l√≠nea para decodificar blobs DPAPI.  Para hacer esto, primero debe recoger todo lo que necesita de la m√°quina, a saber: <br><br><ul><li>  Claves maestras de usuario </li><li>  Claves maestras del sistema </li><li>  Archivo CREDHIST (si no es una m√°quina de dominio); </li><li>  Contrase√±a de usuario (o su hash sha1 / ntlm); </li><li>  SID del usuario; </li><li>  DPAPI blobs que queremos descifrar. </li></ul><br>  Para el descifrado en modo fuera de l√≠nea, no podemos prescindir de herramientas especializadas.  Dichas herramientas pueden ser: <br><br><ul><li>  Mimikatz </li><li>  Impacket (a partir de la versi√≥n 18, tiene funcionalidad DPAPI); </li><li>  Dpapick framework. </li></ul><br>  Se trata del marco dpapick del que hablaremos con m√°s detalle. <br><br>  El marco de trabajo de python dpapick fue creado por el investigador Jean-Michel Pikode en 2014 y es una implementaci√≥n de mecanismos DPAPI en las bibliotecas de cifrado de Python.  El uso de python, as√≠ como la estructura del marco, permite que se adapte f√°cilmente a varios mecanismos DPAPI.  En su versi√≥n original, dpapick no pod√≠a usar la clave de copia de seguridad del dominio para descifrar las claves maestras, y no hab√≠a mecanismos para descifrar las claves maestras creadas en Windows 10 en modo m√°quina de dominio. <br><br>  Despu√©s de corregir estas deficiencias y expandir la funcionalidad para descifrar los blobs DPAPI, dpapick se convirti√≥ en una herramienta bastante buena para la decodificaci√≥n fuera de l√≠nea de DPAPI.  A continuaci√≥n, como ejemplos, mostraremos las opciones para usar este marco para descifrar los datos de usuario cifrados a trav√©s de DPAPI. <br><br><h3>  Chrome: toma y descifra cookies y contrase√±as </h3><br>  Las <code>%localappdata%\Google\Chrome\User Data\Default\Cookies</code> Chrome se almacenan en el archivo <code>%localappdata%\Google\Chrome\User Data\Default\Cookies</code> <br>  Los datos de inicio de sesi√≥n est√°n en el archivo <code>%localappdata%\Google\Chrome\User Data\Default\Login Data</code> <br><br>  Ambos archivos son bases de datos sqlite3 en las que los datos confidenciales se almacenan como blobs DPAPI.  Como parte de dpapick, hay un disector (analizador) listo para usar de estos datos (ejemplos / chrome.py).  Para un descifrado exitoso, necesita especificar el directorio con las claves maestras, el sid del usuario, su contrase√±a o la ubicaci√≥n de la clave privada del controlador de dominio, as√≠ como el archivo sqlite3 de Chrome (cookie o datos de inicio de sesi√≥n). <br><br>  Descifrado sin conexi√≥n de la cookie de Chrome con contrase√±a de usuario <br><br><pre> <code class="xml hljs">./chrome.py --cookie <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cookiefile</span></span></span><span class="hljs-tag">&gt;</span></span> --sid <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SID</span></span></span><span class="hljs-tag">&gt;</span></span> --password <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkeydir</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Descifrado sin conexi√≥n de una cookie de Chrome utilizando un hash de la contrase√±a de un usuario <br><br><pre> <code class="xml hljs">./chrome.py --cookie <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cookiefile</span></span></span><span class="hljs-tag">&gt;</span></span> --sid <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SID</span></span></span><span class="hljs-tag">&gt;</span></span> --hash <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkeydir</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Descifrado sin conexi√≥n de contrase√±as de Chrome con una clave privada de un controlador de dominio <br><br><pre> <code class="xml hljs">./chrome.py --chrome <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">login</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">file</span></span></span><span class="hljs-tag">&gt;</span></span> --pkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rsa-priv.pem</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkeydir</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3>  DPAPI para certificados de cliente </h3><br>  Los certificados de cliente se usan mucho donde: para generar OTP, EFS o autenticaci√≥n en VPN, aplicaciones web, etc. <br><br>  Los certificados de clave p√∫blica se almacenan en el perfil del usuario: <br> <code>%APPDATA%\Microsoft\SystemCertificates\My\Certificates\</code> <br>  Y las claves privadas, con la ayuda de las cuales la firma se realiza realmente u otras operaciones criptogr√°ficas se cifran a trav√©s de DPAPI y tambi√©n se encuentran en el perfil del usuario a lo largo de la ruta: <br><br><pre> <code class="bash hljs">%APPDATA%\Roaming\Microsoft\Crypto\RSA\&lt;SID&gt;\</code> </pre> <br>  Para descifrar con √©xito las claves de certificado privadas y luego recrear los archivos PFX, adem√°s de los archivos anteriores, tambi√©n necesitamos las claves maestras del usuario, as√≠ como su SID y contrase√±a (o una clave RSA privada del controlador). <br><br>  Usando Dpapick y la contrase√±a de usuario, desciframos esto: <br><br><pre> <code class="xml hljs">./efs.py --certificates <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cert</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">&gt;</span></span> --rsakyes <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RSA</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">&gt;</span></span> --sid <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --password <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkeydir</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/tx/kf/bp/txkfbp91hcb6pg_rq7wgh8w7v5u.jpeg"><br><br>  El par√°metro opcional rsaout en la captura de pantalla le permite exportar adicionalmente claves RSA descifradas en formato PEM.  El resultado de la secuencia de comandos es un archivo PFX recreado sin una contrase√±a, que ya puede importarse a usted mismo y usarse para el prop√≥sito previsto.  Si en los directorios anteriores hay varios certificados y claves privadas, dpapick intentar√° descifrar cada uno de ellos y crear varios archivos pfx. <br><br>  Se pueden realizar las mismas acciones utilizando una clave privada de dominio para descifrar la clave maestra especificando el par√°metro apropiado: <br><br><pre> <code class="xml hljs">./efs.py --certificates <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cert</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">&gt;</span></span> --rsakyes <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RSA</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkeydir</span></span></span><span class="hljs-tag">&gt;</span></span> --pkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">domain</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bkp</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3>  Un poco m√°s sobre los "chips" del dominio </h3><br>  Hablando sobre el dominio de Active Directory, vale la pena mencionar una caracter√≠stica tan maravillosa como Credentials Roaming, una funci√≥n de dominio cuando las claves maestras, las contrase√±as cifradas y los certificados "viajan" para el usuario en todo el dominio de Active Directory.  No est√°n vinculados a una m√°quina espec√≠fica y "llegar√°n" a la computadora en la que el usuario del dominio inicia sesi√≥n. <br><br>  Cuando esta "caracter√≠stica" est√° activada, todos los certificados que importa el usuario, as√≠ como todas sus claves privadas y contrase√±as, vuelan a AD y se almacenan en los atributos de cuenta correspondientes: msPKIAccountCrdentailas y msPKIDPAPIMasterKeys. <br><br>  Puede ver c√≥mo se ve dentro de AD, por ejemplo, a trav√©s de ldapsearch: <br><br><pre> <code class="xml hljs">ldapsearch -x -h dc1.lab.local -D ‚Äúuser1@lab.local" -s sub "samAccountname=user1" ldapsearch -x -h dc1.lab.local -D "admin@lab.local" -s sub "samAccountname=anyuser"</code> </pre> <br><img src="https://habrastorage.org/webt/vl/sh/01/vlsh019lykontfubtr-g5rx__dc.jpeg"><br><br>  Por defecto, un usuario solo puede recibir atributos DPAPI para su cuenta.  Pero con privilegios elevados, esto se puede hacer para cualquier cuenta, incluida una cuenta de computadora. <br><br>  El roaming de credenciales es una tecnolog√≠a muy conveniente no solo para administradores, sino tambi√©n para pentesters.  Despu√©s de acceder al controlador de dominio a trav√©s de ldap, puede fusionar todos los certificados de usuario, sus claves maestras y contrase√±as cifradas a trav√©s de DPAPI (por ejemplo, contrase√±as para conectarse a unidades de red). <br><br>  Y pensamos por qu√© no agregar dicha funcionalidad a dpapick, y le ense√±amos c√≥mo extraer autom√°ticamente certificados de un controlador de dominio a trav√©s de ldap, descifrarlos y generar archivos pfx. <br><br><pre> <code class="xml hljs">./efs.py ‚Äìldap-server <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --ldap-connect admin:Passw0rd@lab.local --ldap-user user1 --password Password1 ./efs.py ‚Äìldap-server <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --ldap-connect admin:Passw0rd@lab.local --ldap-user user1 --pkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rsa-priv.pem</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><img src="https://habrastorage.org/webt/an/_p/bi/an_pbimm2jjr-iuapm945q43rzs.jpeg"><br><br>  Para ejecutar el script, es necesario especificar el controlador de dominio como un servidor ldap, los detalles de la conexi√≥n, el nombre de la cuenta para la que recibimos certificados y una contrase√±a para descifrar la clave maestra (o una clave de respaldo privada del controlador). <br><br><h3>  Dropbox  Ido en 60 segundos ... </h3><br>  Dropbox es otro ejemplo del uso de DPAPI para almacenar secretos de usuario.  Los tokens de autorizaci√≥n para Dropbox se almacenan en archivos: <br><br><pre> <code class="bash hljs">c:\users\&lt;username&gt;\Appdata\Local\Dropbox\instance1\config.dbx c:\users\&lt;username&gt;\Appdata\Local\Dropbox\instance_db\instanse.dbx</code> </pre> <br>  Estas son bases de datos encriptadas sqlite3 que contienen datos para la conexi√≥n.  Para el cifrado, se utiliza una clave sim√©trica, que a su vez se cifra mediante DPAPI y se almacena en el registro: <br><br> <code>HKCU\SOFTWARE\Dropbox\ks <br> HKCU\SOFTWARE\Dropbox\ks1</code> <br> <br>  Por lo tanto, el orden general del secuestro de Dropbox es el siguiente: <br><br><ol><li>  tomamos dos archivos de base de datos de la computadora; </li><li>  obtenemos las claves del registro y las desciframos usando dpapick; </li><li>  usando DPAPI, encriptamos las claves recibidas en nuestra m√°quina y las colocamos en el registro; </li><li>  en nuestra m√°quina reemplazamos los archivos de la base de datos y ejecutamos Dropbox. </li></ol><br>  Debe tener en cuenta que se establecen permisos especiales para las ramas de registro anteriores.  Solo pueden ser le√≠dos por el usuario.  Ni el administrador ni el sistema pueden leerlos.  Por lo tanto, si accede al registro en nombre de otro usuario (incluso un administrador), primero debe establecer los permisos apropiados en las ramas de registro especificadas.  Por ejemplo, entonces (powershell): <br><br><pre> <code class="xml hljs">$Sid="S-1-5-21-3463664321-2923530833-3546627382-1000"; $key=[Microsoft.Win32.Registry]::USERS.OpenSubKey("$sid\SOFTWARE\Dropbox\ks",[Microsoft.Win32.RegistryKeyPermissionCheck]::ReadWriteSubTree,[System.Security.AccessControl.RegistryRights]::ChangePermissions); $acl = $key.GetAccessControl(); $rule = New-Object System.Security.AccessControl.RegistryAccessRule ("administrator","FullControl","Allow"); $acl.SetAccessRule($rule); $key.SetAccessControl($acl); $key_path = "REGISTRY::HKEY_USERS\$Sid\SOFTWARE\Dropbox\ks"; (Get-ItemProperty -Path $key_path -Name Client).Client;</code> </pre> <br>  Las claves ks y ks1 contienen el encabezado (8 bytes) de la versi√≥n dbx antes del blob DPAPI y el blob md5 HMAC DPAPI (√∫ltimos 16 bytes).  El blob DPAPI comienza con el noveno byte 0x01000000D0 ... Estos bytes deben copiarse en formato base64 a un archivo, que luego se descifra mediante dpapick: <br><br><pre> <code class="xml hljs">./filegeneric.py --sid <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --password <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --base64file <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Luego, en su m√°quina, debe cifrar las claves recibidas en la √∫ltima etapa con nuestra clave maestra y colocar el resultado en las ramas de registro apropiadas. <br><br>  Para el cifrado, lo m√°s conveniente es usar powershell: <br><br><pre> <code class="xml hljs">$hdata="4efebbdf394d4003317fc5c357beac4b"; [Byte[]] $dv0_entropy = 0xd1,0x14,0xa5,0x52,0x12,0x65,0x5f,0x74,0xbd,0x77,0x2e,0x37,0xe6,0x4a,0xee,0x9b; $data = ($hdata -split "(?<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">=\G\w{2})(?=\w{2})"</span></span></span><span class="hljs-tag"> | %{ [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Convert</span></span></span><span class="hljs-tag">]</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">::ToByte</span></span></span><span class="hljs-tag">( $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">_</span></span></span><span class="hljs-tag">, </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">16</span></span></span><span class="hljs-tag"> ) }); </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Add-Type</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">-AssemblyName</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">System.Security</span></span></span><span class="hljs-tag">; $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dk1</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">[system.security.cryptography.protecteddata]::Protect($data,$dv0_entropy,[System.Security.Cryptography.DataProtectionScope]::CurrentUser);</span></span></span><span class="hljs-tag"> $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pr</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">([System.BitConverter]::ToString($dk1));$pr</span></span></span><span class="hljs-tag"> $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">OBJ_hmac</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">New-Object</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">System.Security.Cryptography.HMACMD5</span></span></span><span class="hljs-tag"> $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">hmac</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">$OBJ_hmac.ComputeHash($dk1)</span></span></span><span class="hljs-tag"> $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pr</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">([System.BitConverter]::ToString($hmac));$pr</span></span></span></span></code> </pre> <br>  En este caso, hdata es la clave que se recibi√≥ en la etapa de descifrado.  dv0_entropy es la constante de entrop√≠a utilizada por DBOX en DPAPI.  Para el blob resultante, debe asignar un encabezado de 8 bytes 0x00000000F6000000 al frente y HMACMD5 + 0x00 al reverso <br>  Despu√©s de eso, puede escribir datos en las claves de registro apropiadas. <br><br><h3>  DPAPI y RSA SecurID </h3><br>  RSA SecurID es un programa cliente que se utiliza para generar una contrase√±a de un solo uso, desarrollado por RSA. <br><br>  Es algo bastante popular para las grandes empresas y tambi√©n utiliza DPAPI, solo que un poco m√°s complicado.  En este caso, los ingenieros de RSA decidieron confundirse y aplicaron esquemas DPAPI m√°s complejos. <br><br>  Los datos del token se almacenan en el archivo <code>%LOCALAPPDATA%\RSA\SecurIDStorage</code> , que es la base de datos sqlite3.  Cada token cifrado contiene su EnTokenSid cifrado (par√°metros para la inicializaci√≥n inicial del algoritmo de generaci√≥n de c√≥digo).  EnTokenSid se genera sobre la base de DBKey, SID del token y SID de usuario, y DBKey ya se genera mediante el descifrado DPAPI DBKeyEnc en la siguiente secuencia: <br> <code>DBKeyEnc = DPAPI(CurrenUser, DPAPI(LocalSystem(DBKey))</code> <br> <br>  Es decir  Primero, la clave DB se cifra con la clave maestra del sistema, y ‚Äã‚Äãluego el blob DPAPI resultante se vuelve a cifrar con la clave maestra del usuario. <br><br>  Tambi√©n en la base de datos hay CryptoCheckSum de CheckSum: <br>  CryptoCheckSum = blob DPAPI (CurrenUser) <br><br>  Por lo tanto, para que el SecurIDStorage combinado funcione en su m√°quina, debe: <br><br><ol><li>  Debido al hecho de que el SID del usuario est√° involucrado en la formaci√≥n de EncTokenSid, es necesario establecer el SID del usuario actual en la m√°quina virtual en el mismo valor que el SID del usuario del que se toma la base de almacenamiento SecurIDS.  La utilidad NewSid de SysInternals nos ayudar√° con esto; </li><li>  Descifre DBKeyEnc utilizando la clave maestra del usuario y la contrase√±a o la clave privada de dominio (en caso de que la m√°quina sea un dominio); </li><li>  Descifre el resultado del descifrado anterior utilizando la clave maestra del sistema y el valor del par√°metro DPAPI_SYSTEM; </li><li>  Descifre CryptoCheckSum usando la clave maestra del usuario </li><li>  Cifre los valores DBKey y CheckSum recibidos en orden inverso ya en su m√°quina virtual; </li><li>  En algunas versiones de SecurID, tambi√©n necesitar√° establecer el tama√±o del disco duro de la m√°quina virtual en el mismo tama√±o que el tama√±o del disco duro de la m√°quina de origen, como  el programa lo verifica al inicio. </li></ol><br>  Como se mencion√≥ anteriormente, para descifrar DBKeyEnc, adem√°s de la clave maestra del usuario, tambi√©n necesitaremos una clave maestra del sistema, as√≠ como el valor DPAPI_SYSTEM, con el que se descifran las claves maestras del sistema.  DAPPI_SYSTEM es en realidad una preclave ya formada, que participa en la formaci√≥n de claves maestras del sistema.  Puede obtenerlo de la memoria LSASS (a trav√©s de mimikatz o analizando el volcado del proceso) o de las ramas de registro correspondientes (HKLM \ SYSTEM, HKLM \ SECURITY), volcarlas y analizar el mismo Impacket. <br><br>  Entonces podemos usar el DPAPI_SYSTEM obtenido para descifrar los blobs necesarios usando dpapick (el analizador es examples / filegeneric.py), como se muestra en las siguientes capturas de pantalla: <br><br>  1) Obtener DPAPI_SYSTEM a trav√©s de mimikatz sin conexi√≥n <br><br><img src="https://habrastorage.org/webt/ww/xi/ov/wwxiovhm-6gdcbn7tmmpr7-qsim.jpeg"><br><br>  2) Obtener DPAPI_SYSTEM a trav√©s de Impacket sin conexi√≥n <br><br><img src="https://habrastorage.org/webt/s7/9v/5g/s79v5gxvzjjccekaklg8gtefyfw.jpeg"><br><br>  3) Descifrado DPAPIck con claves maestras de usuario y sistema <br><br><img src="https://habrastorage.org/webt/ip/th/qm/ipthqmqacvzvixntzgk_n1vsgvs.jpeg"><br><br><h3>  Hoja de trucos </h3><br>  Para que no olvide el lugar de datos espec√≠ficos, los colocaremos en una secci√≥n separada: <br><br>  <b>Llaves maestras personalizadas</b> <br><br><pre> <code class="bash hljs">%APPDATA%\Microsoft\Protect\&lt;SID&gt;\*</code> </pre> <br>  <b>Claves maestras del sistema</b> <br><br><pre> <code class="bash hljs">Windows\System32\Microsoft\Protect\*</code> </pre> <br>  <b>DPAPI_SYSTEM</b> <br><br><pre> <code class="bash hljs">LSASecrets ‚Äì online SYSTEM, SECURITY (reg save ‚Ä¶, system\backup, etc)</code> </pre> <br>  <b>Certificados de usuario</b> <br><br><pre> <code class="bash hljs">%APPDATA%\Microsoft\SystemCertificates\My\Certificates\ %APPDATA%\Microsoft\Crypto\RSA\&lt;SID&gt;\</code> </pre> <br>  <b>Certificados del sistema</b> <br><br><pre> <code class="bash hljs">HKLM:\SOFTWARE\Microsoft\SystemCertificates\MY\Certificates\* C:\Programdata\Microsoft\Crypto\RSA\MachineKeys\</code> </pre> <br>  <b>Cromo</b> <br><br><pre> <code class="bash hljs">%localappdata%\Google\Chrome\User Data\Default\Cookies %localappdata%\Google\Chrome\User Data\Default\Login Data</code> </pre> <br>  <b>Dropbox</b> <br><br><pre> <code class="bash hljs">HKCU\SOFTWARE\Dropbox\ks HKCU\SOFTWARE\Dropbox\ks1 %APPDATA%\Local\Dropbox\instance1\config.dbx %APPDATA%\Local\Dropbox\instance_db\instanse.dbx</code> </pre> <br>  <b>Rsa securid</b> <br><br><pre> <code class="bash hljs">%LOCALAPPDATA%\RSA\SecurIDStorage</code> </pre> <br><h3>  Poca conclusi√≥n </h3><br>  DPAPI es una cosa magn√≠fica: lo principal es entender c√≥mo se puede usar al realizar pentests y estudios de RedTeam. <br><br>  En este art√≠culo, observamos solo algunos ejemplos en los que se puede aplicar el descifrado DPAPI.  De hecho, el alcance es mucho m√°s amplio.  Por ejemplo, no consideramos RDP (* .rdg), Icloud (archivo pList), Skype (*. Xml), claves para conectarse a Wi-Fi.  En todas partes se aplica DPAPI y los analizadores correspondientes se implementan como parte del marco dpapick. <br><br>  Una versi√≥n modificada de dpapick est√° disponible en nuestro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GitHub</a> .  Le instamos a utilizar esta herramienta para descifrar DPAPI y le agradeceremos el desarrollo posterior de dpapick. <br><br>  Y se puede encontrar informaci√≥n interesante en nuestro canal en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">telegramas</a> .  Contamos sobre IB a trav√©s de los ojos de RedTeam. <br><br>  PD: ¬°Gracias a los organizadores de OFFZONE-2018 por una conferencia genial! <br><br>  PPS La segunda parte del art√≠culo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es434514/">https://habr.com/ru/post/es434514/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es434504/index.html">20 a√±os Fast Reports "El producto fue creado de una sola vez, simplemente alto ..."</a></li>
<li><a href="../es434506/index.html">Experiencia publicando una aplicaci√≥n de edici√≥n de video en Microsoft Store</a></li>
<li><a href="../es434508/index.html">El lado oscuro del marketing en buscadores: c√≥mo y por qu√© Google recopila nuestra informaci√≥n personal</a></li>
<li><a href="../es434510/index.html">Brevemente sobre trabajar con RabbitMQ de Python</a></li>
<li><a href="../es434512/index.html">Corporativo corporativo</a></li>
<li><a href="../es434516/index.html">Una manera f√°cil de lidiar con sus aspiraciones profesionales.</a></li>
<li><a href="../es434518/index.html">Aplausos y v√≠tores: drama cuidadosamente controlado en las tiendas de Apple</a></li>
<li><a href="../es434522/index.html">Patrones de justificaci√≥n de tareas y antipatrones</a></li>
<li><a href="../es434524/index.html">Kubernetes Ingress a trav√©s de los ojos de un principiante</a></li>
<li><a href="../es434528/index.html">Descifrado de trazado de rayos del tama√±o de una postal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>