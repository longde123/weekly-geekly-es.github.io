<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤ğŸ» ğŸ´ ğŸ™†ğŸ¼ ä½¿ç”¨æˆåƒä¸Šä¸‡çš„è™šæ‹Ÿç”¨æˆ·å¯¹æ¸¸æˆè¿›è¡Œè´Ÿè½½æµ‹è¯• â—€ï¸ ğŸ’ªğŸ½ â˜•ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å“ˆHaï¼ 

 æˆ‘åœ¨ä¸€å®¶å¼€å‘åœ¨çº¿æ¸¸æˆçš„æ¸¸æˆå…¬å¸å·¥ä½œã€‚ ç›®å‰ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„æ¸¸æˆéƒ½è¢«åˆ’åˆ†ä¸ºå¤šä¸ªâ€œå¸‚åœºâ€ï¼ˆæ¯ä¸ªå›½å®¶/åœ°åŒºä¸€ä¸ªâ€œå¸‚åœºâ€ï¼‰ï¼Œå¹¶ä¸”åœ¨æ¯ä¸ªâ€œå¸‚åœºâ€ä¸­éƒ½æœ‰åå‡ ä¸ªä¸–ç•Œï¼Œç©å®¶åœ¨æ³¨å†Œæ—¶å¯ä»¥åœ¨è¿™äº›ä¸–ç•Œä¹‹é—´è¿›è¡Œåˆ†é…ï¼ˆå½“ç„¶ï¼Œæœ‰æ—¶ä»–ä»¬å¯ä»¥è‡ªå·±é€‰æ‹©ï¼‰ã€‚ æ¯ä¸ªä¸–ç•Œéƒ½æœ‰ä¸€ä¸ªæ•°æ®åº“å’Œä¸€ä¸ªæˆ–å¤šä¸ªWeb /åº”ç”¨ç¨‹åºæœåŠ¡å™¨ã€‚ å› ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨æˆåƒä¸Šä¸‡çš„è™šæ‹Ÿç”¨æˆ·å¯¹æ¸¸æˆè¿›è¡Œè´Ÿè½½æµ‹è¯•</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445368/"> å“ˆHaï¼ <br><br> æˆ‘åœ¨ä¸€å®¶å¼€å‘åœ¨çº¿æ¸¸æˆçš„æ¸¸æˆå…¬å¸å·¥ä½œã€‚ ç›®å‰ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„æ¸¸æˆéƒ½è¢«åˆ’åˆ†ä¸ºå¤šä¸ªâ€œå¸‚åœºâ€ï¼ˆæ¯ä¸ªå›½å®¶/åœ°åŒºä¸€ä¸ªâ€œå¸‚åœºâ€ï¼‰ï¼Œå¹¶ä¸”åœ¨æ¯ä¸ªâ€œå¸‚åœºâ€ä¸­éƒ½æœ‰åå‡ ä¸ªä¸–ç•Œï¼Œç©å®¶åœ¨æ³¨å†Œæ—¶å¯ä»¥åœ¨è¿™äº›ä¸–ç•Œä¹‹é—´è¿›è¡Œåˆ†é…ï¼ˆå½“ç„¶ï¼Œæœ‰æ—¶ä»–ä»¬å¯ä»¥è‡ªå·±é€‰æ‹©ï¼‰ã€‚ æ¯ä¸ªä¸–ç•Œéƒ½æœ‰ä¸€ä¸ªæ•°æ®åº“å’Œä¸€ä¸ªæˆ–å¤šä¸ªWeb /åº”ç”¨ç¨‹åºæœåŠ¡å™¨ã€‚ å› æ­¤ï¼Œè´Ÿè½½å‡ ä¹å‡åŒ€åœ°åˆ†å¸ƒåœ¨ä¸–ç•Œ/æœåŠ¡å™¨ä¹‹é—´ï¼Œç»“æœï¼Œæˆ‘ä»¬è·å¾—äº†æœ€å¤§çš„åœ¨çº¿6K-8Kæ’­æ”¾å™¨ï¼ˆè¿™æ˜¯æœ€å¤§æ•°é‡ï¼Œå¤šæ•°æƒ…å†µä¸‹å°‘äº†å‡ å€ï¼‰ï¼Œæ¯ä¸ªä¸–ç•Œæ¯ä¸ªé»„é‡‘æ—¶æ®µæœ‰200-300ä¸ªè¯·æ±‚ã€‚ <br><br> è¿™ç§å°†å‚ä¸è€…åˆ†ä¸ºå¸‚åœºå’Œä¸–ç•Œçš„ç»“æ„å·²ç»è¿‡æ—¶ï¼›å‚ä¸è€…å¸Œæœ›è·å¾—å…¨çƒåŒ–çš„ä¸œè¥¿ã€‚ åœ¨ä¸Šä¸€å±Šçš„æ¯”èµ›ä¸­ï¼Œæˆ‘ä»¬åœæ­¢äº†æŒ‰å›½å®¶/åœ°åŒºåˆ’åˆ†äººå‘˜ï¼Œåªç•™ä¸‹äº†ä¸€ä¸ª/ä¸¤ä¸ªå¸‚åœºï¼ˆç¾å›½å’Œæ¬§æ´²ï¼‰ï¼Œä½†æ¯ä¸ªå¸‚åœºä»ç„¶æœ‰å¾ˆå¤šä¸–ç•Œã€‚ ä¸‹ä¸€æ­¥å°†æ˜¯å¼€å‘å…·æœ‰æ–°æ¶æ„çš„æ¸¸æˆï¼Œå¹¶é€šè¿‡<b>ä¸€ä¸ªæ•°æ®åº“</b>å°†æ‰€æœ‰ç©å®¶ç»Ÿä¸€åœ¨ä¸€ä¸ªä¸–ç•Œä¸­ã€‚ <br><br> ä»Šå¤©ï¼Œæˆ‘æƒ³è°ˆè°ˆæˆ‘çš„ä»»åŠ¡æ˜¯å¦‚ä½•æ£€æŸ¥ä¸€ä¸ªæµè¡Œæ¸¸æˆçš„æ•´ä¸ªç½‘ç»œï¼ˆä¸€æ¬¡æ˜¯50-200,000ä¸ªç”¨æˆ·ï¼‰æ˜¯å¦â€œå‘é€â€ä»¥ç©åŸºäºæ–°æ¶æ„çš„ä¸‹ä¸€æ¬¾æ¸¸æˆï¼Œä»¥åŠæ˜¯å¦æ•´ä¸ªç³»ç»Ÿï¼Œç‰¹åˆ«æ˜¯æ•°æ®åº“ï¼ˆ <b>PostgreSQL 11</b> ï¼‰å®é™…ä¸Šå¯ä»¥æ‰¿å—è¿™æ ·çš„è´Ÿè½½ï¼Œå¦‚æœä¸èƒ½æ‰¿å—ï¼Œåˆ™æ‰¾å‡ºæœ€å¤§å€¼ã€‚ æˆ‘å°†å‘Šè¯‰æ‚¨ä¸€äº›æœ‰å…³å·²å‡ºç°çš„é—®é¢˜ä»¥åŠå‡†å¤‡æµ‹è¯•å¦‚æ­¤å¤šçš„ç”¨æˆ·çš„å†³å®šï¼Œè¿‡ç¨‹æœ¬èº«ä»¥åŠæœ‰å…³ç»“æœçš„ä¿¡æ¯ã€‚ <br><a name="habracut"></a><br><h2> å‰è¨€ </h2><br> è¿‡å»ï¼Œåœ¨<b>InnoGames GmbHï¼Œ</b>æ¯ä¸ªæ¸¸æˆå›¢é˜Ÿç»å¸¸ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯ï¼Œç¼–ç¨‹è¯­è¨€å’Œæ•°æ®åº“æ¥æ ¹æ®è‡ªå·±çš„å£å‘³å’Œè‚¤è‰²åˆ›å»ºä¸€ä¸ªæ¸¸æˆé¡¹ç›®ã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬æœ‰è®¸å¤šå¤–éƒ¨ç³»ç»Ÿè´Ÿè´£ä»˜æ¬¾ï¼Œå‘é€æ¨é€é€šçŸ¥ï¼Œè¥é”€ç­‰ã€‚ ä¸ºäº†ä¸è¿™äº›ç³»ç»Ÿä¸€èµ·ä½¿ç”¨ï¼Œå¼€å‘äººå‘˜è¿˜å°½å¯èƒ½åœ°åˆ›å»ºäº†ä»–ä»¬ç‹¬ç‰¹çš„ç•Œé¢ã€‚ <br><br> å½“å‰åœ¨ç§»åŠ¨æ¸¸æˆä¸šåŠ¡ä¸­æœ‰å¾ˆå¤š<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é’±</a> ï¼Œå› æ­¤ç«äº‰ä¹Ÿå¾ˆå¤šã€‚ åœ¨è¿™é‡Œï¼Œä»è¥é”€ä¸ŠèŠ±è´¹çš„æ¯ä¸€ç¾å…ƒä»¥åŠä»ä¸Šé¢è·å¾—çš„æ›´å¤šé’±å–å›éƒ½æ˜¯éå¸¸é‡è¦çš„ï¼Œå› æ­¤ï¼Œå³ä½¿æ‰€æœ‰æ¸¸æˆå…¬å¸éƒ½ä¸æ»¡è¶³åˆ†ææœŸæœ›ï¼Œå³ä½¿åœ¨å°é—­æµ‹è¯•é˜¶æ®µï¼Œå®ƒä»¬ä¹Ÿç»å¸¸â€œå…³é—­â€æ¸¸æˆã€‚ å› æ­¤ï¼Œåœ¨ä¸‹ä¸€è½®å‘æ˜ä¸Šæµªè´¹æ—¶é—´æ˜¯æ— åˆ©å¯å›¾çš„ï¼Œå› æ­¤å†³å®šåˆ›å»ºä¸€ä¸ªç»Ÿä¸€çš„å¹³å°ï¼Œè¯¥å¹³å°å°†ä¸ºå¼€å‘äººå‘˜æä¾›ä¸€ä¸ªç°æˆçš„è§£å†³æ–¹æ¡ˆï¼Œç”¨äºä¸æ‰€æœ‰å¤–éƒ¨ç³»ç»Ÿï¼Œå¸¦æœ‰å¤åˆ¶çš„æ•°æ®åº“å’Œæ‰€æœ‰æœ€ä½³å®è·µçš„é›†æˆã€‚ å¼€å‘äººå‘˜æ‰€éœ€è¦åšçš„å°±æ˜¯åœ¨æ­¤åŸºç¡€ä¸Šå¼€å‘å’Œâ€œæŠ•æ”¾â€ä¸€æ¬¾å‡ºè‰²çš„æ¸¸æˆï¼Œè€Œä¸æ˜¯åœ¨ä¸æ¸¸æˆæœ¬èº«æ— å…³çš„å¼€å‘ä¸Šæµªè´¹æ—¶é—´ã€‚ <br><br> è¿™ä¸ªå¹³å°å«åš<b>GameStarter</b> ï¼š <br><br><img src="https://habrastorage.org/webt/fz/go/g3/fzgog3jsz4rzjqi0zvbwzysz-po.jpeg" alt="å›¾ç‰‡"><br><br> æ‰€ä»¥ï¼Œåˆ°äº†é‡ç‚¹ã€‚ å°†æ¥æ‰€æœ‰InnoGamesæ¸¸æˆéƒ½å°†åœ¨æ­¤å¹³å°ä¸Šæ„å»ºï¼Œè¯¥å¹³å°å…·æœ‰ä¸¤ä¸ªæ•°æ®åº“-masterå’Œgameï¼ˆPostgreSQL 11ï¼‰ã€‚  Masterä¼šå­˜å‚¨æœ‰å…³ç©å®¶çš„åŸºæœ¬ä¿¡æ¯ï¼ˆç™»å½•åï¼Œå¯†ç ç­‰ï¼‰ï¼Œå¹¶ä¸”ä¸»è¦ä»…å‚ä¸æ¸¸æˆæœ¬èº«çš„ç™»å½•/æ³¨å†Œè¿‡ç¨‹ã€‚ æ¸¸æˆ-æ¸¸æˆæœ¬èº«çš„æ•°æ®åº“ï¼Œç›¸åº”åœ°ï¼Œæ‰€æœ‰æ¸¸æˆæ•°æ®å’Œå®ä½“éƒ½å­˜å‚¨åœ¨è¯¥æ•°æ®åº“ä¸­ï¼Œè¿™æ˜¯æ¸¸æˆçš„æ ¸å¿ƒï¼Œæ•´ä¸ªè´Ÿè½½å°†åœ¨æ­¤å­˜å‚¨ã€‚ <br> å› æ­¤ï¼Œå‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå³æ•´ä¸ªç»“æ„æ˜¯å¦å¯ä»¥æ‰¿å—è¿™æ ·ä¸€ä¸ªæ½œåœ¨çš„ç”¨æˆ·æ•°é‡ï¼Œè¯¥æ•°é‡ç­‰äºæˆ‘ä»¬æœ€å—æ¬¢è¿çš„æ¸¸æˆä¹‹ä¸€çš„æœ€å¤§åœ¨çº¿äººæ•°ã€‚ <br><br><h2> æŒ‘æˆ˜èµ› </h2><br> ä»»åŠ¡æœ¬èº«æ˜¯è¿™æ ·çš„ï¼šæ£€æŸ¥å¯ç”¨äº†å¤åˆ¶çš„æ•°æ®åº“ï¼ˆPostgreSQL 11ï¼‰æ˜¯å¦å¯ä»¥æ‰¿å—æ•´ä¸ªPowerEdge M630ç³»ç»Ÿç®¡ç†ç¨‹åºï¼ˆHVï¼‰æ‰€æ‰¿å—çš„å½“å‰è´Ÿè½½æœ€å¤§çš„æ¸¸æˆä¸­çš„æ‰€æœ‰è´Ÿè½½ã€‚ <br> æˆ‘è¦æ¾„æ¸…çš„æ˜¯ï¼Œç›®å‰çš„ä»»åŠ¡<b>åªæ˜¯</b>ä½¿ç”¨ç°æœ‰çš„æ•°æ®åº“é…ç½®<b>æ¥éªŒè¯</b> ï¼Œæˆ‘ä»¬æ˜¯æ ¹æ®æœ€ä½³åšæ³•å’Œæˆ‘ä»¬è‡ªå·±çš„ç»éªŒå½¢æˆçš„ã€‚ <br><br> æˆ‘é©¬ä¸Šè¦è¯´æ•°æ®åº“ï¼Œæ•´ä¸ªç³»ç»Ÿæ˜¾ç¤ºå¾—å¾ˆå¥½ï¼Œé™¤äº†å‡ ç‚¹ã€‚ ä½†æ˜¯ï¼Œè¿™ä¸ªç‰¹å®šçš„æ¸¸æˆé¡¹ç›®å¤„äºåŸå‹é˜¶æ®µï¼Œå¹¶ä¸”åœ¨å°†æ¥ï¼Œéšç€æ¸¸æˆæœºåˆ¶çš„å¤æ‚åŒ–ï¼Œå¯¹æ•°æ®åº“çš„è¯·æ±‚å°†å˜å¾—æ›´åŠ å¤æ‚ï¼Œè´Ÿè½½æœ¬èº«å¯èƒ½ä¼šæ˜¾ç€å¢åŠ ï¼Œå¹¶ä¸”å…¶æ€§è´¨å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚ ä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œæœ‰å¿…è¦å¯¹æ¯ä¸ªæˆ–å¤šæˆ–å°‘é‡è¦çš„é‡Œç¨‹ç¢‘è¿›è¡Œè¿­ä»£æµ‹è¯•ã€‚ åœ¨æ•°åä¸‡åç”¨æˆ·ä¸­è‡ªåŠ¨åŒ–è¿è¡Œè¿™äº›æµ‹è¯•çš„èƒ½åŠ›å·²æˆä¸ºç°é˜¶æ®µçš„ä¸»è¦ä»»åŠ¡ã€‚ <br><br><h2> ä¸ªäººèµ„æ–™ </h2><br> åƒä»»ä½•è´Ÿè½½æµ‹è¯•ä¸€æ ·ï¼Œè¿™ä¸€åˆ‡éƒ½ä»è´Ÿè½½é…ç½®æ–‡ä»¶å¼€å§‹ã€‚ <br> æˆ‘ä»¬çš„æ½œåœ¨ä»·å€¼CCU60ï¼ˆCCUæ˜¯ç‰¹å®šæ—¶é—´æ®µå†…çš„æœ€å¤§ç”¨æˆ·æ•°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¸º60åˆ†é’Ÿï¼‰ä¸º<b>250,000ä¸ª</b>ç”¨æˆ·ã€‚ ç«äº‰æ€§è™šæ‹Ÿç”¨æˆ·ï¼ˆVUï¼‰çš„æ•°é‡ä½äºCCU60ï¼Œåˆ†æå®¶å»ºè®®å¯ä»¥å°†å…¶å®‰å…¨åœ°åˆ†ä¸ºä¸¤ä¸ªã€‚ æ±‡æ€»å¹¶æ¥å—<b>150,000ä¸ª</b>ç«äº‰æ€§VUã€‚ <br><br> æ¯ç§’çš„æ€»è¯·æ±‚æ•°æ¥è‡ªä¸€ä¸ªè´Ÿè½½æ¯”è¾ƒå¤§çš„æ¸¸æˆï¼š <br><br><img src="https://habrastorage.org/webt/lv/te/69/lvte69rifceelurn7r3t7trbgs4.png"><br><br> å› æ­¤ï¼Œæˆ‘ä»¬çš„ç›®æ ‡è´Ÿè½½ä¸º<b>150,000</b> VUæ—¶ã€œ20,000 <b>ä¸ªè¯·æ±‚/ç§’</b> ã€‚ <br><br><h2> ç»“æ„å½¢å¼ </h2><br><h3>  â€œçœ‹å°â€çš„ç‰¹å¾ </h3><br> åœ¨ä¸Š<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œ</a>æˆ‘å·²ç»è®¨è®ºäº†è‡ªåŠ¨åŒ–è´Ÿè½½æµ‹è¯•çš„æ•´ä¸ªè¿‡ç¨‹ã€‚ æ­¤å¤–ï¼Œæˆ‘å¯èƒ½ä¼šå†è¯´ä¸€éï¼Œä½†æˆ‘ä¼šæ›´è¯¦ç»†åœ°å‘Šè¯‰æ‚¨ä¸€äº›è¦ç‚¹ã€‚ <br><br><img src="https://habrastorage.org/webt/zh/hz/eo/zhhzeorw5_gboyuocu9ajmb3ulo.png"><br><br> åœ¨å›¾ä¸­ï¼Œè“è‰²æ–¹å—æ˜¯æˆ‘ä»¬çš„è™šæ‹Ÿæœºç®¡ç†ç¨‹åºï¼ˆHVï¼‰ï¼Œå®ƒæ˜¯ç”±è®¸å¤šæœåŠ¡å™¨ï¼ˆDell M620-M640ï¼‰ç»„æˆçš„äº‘ã€‚ åœ¨æ¯ä¸ªHVä¸Šï¼Œé€šè¿‡KVMï¼ˆæ··åˆçš„Web /åº”ç”¨ç¨‹åºå’Œæ•°æ®åº“ï¼‰å¯åŠ¨äº†åäºŒä¸ªè™šæ‹Ÿæœºï¼ˆVMï¼‰ã€‚ åˆ›å»ºä»»ä½•æ–°çš„VMæ—¶ï¼Œä¼šåœ¨é€‚å½“çš„HVçš„å‚æ•°é›†ä¸­è¿›è¡Œå¹³è¡¡å’Œæœç´¢ï¼Œå¹¶ä¸”æœ€åˆä¸çŸ¥é“å®ƒå°†åœ¨å“ªä¸ªæœåŠ¡å™¨ä¸Šè¿è¡Œã€‚ <br><br><h4> æ•°æ®åº“ï¼ˆæ¸¸æˆæ•°æ®åº“ï¼‰ï¼š </h4><br> ä½†å‡ºäºdb1çš„ç›®çš„ï¼Œæˆ‘ä»¬åŸºäº<b>M630</b>ä¿ç•™äº†å•ç‹¬çš„HV targer_hypervisorã€‚ <br><br>  targer_hypervisorçš„ç®€è¦ç‰¹å¾ï¼š <br><br> æˆ´å°”M_630 <br> å‹å·åç§°ï¼šè‹±ç‰¹å°”Â®è‡³å¼ºÂ®CPU E5-2680 v3 @ 2.50GHz <br>  CPUï¼ˆsï¼‰ï¼š48 <br> æ¯ä¸ªæ ¸å¿ƒçº¿ç¨‹æ•°ï¼š2 <br> æ¯ä¸ªæ’æ§½çš„èŠ¯æ•°ï¼š12 <br> æ’åº§ï¼š2 <br> å†…å­˜ï¼š128 GB <br>  Debian GNU / Linux 9ï¼ˆå»¶ä¼¸ï¼‰ <br>  4.9.0-8-amd64ï¼ƒ1 SMP Debian 4.9.130-2ï¼ˆ2018-10-27ï¼‰ <br><br><div class="spoiler">  <b class="spoiler_title">è¯¦ç»†è§„æ ¼</b> <div class="spoiler_text">  Debian GNU / Linux 9ï¼ˆå»¶ä¼¸ï¼‰ <br>  4.9.0-8-amd64ï¼ƒ1 SMP Debian 4.9.130-2ï¼ˆ2018-10-27ï¼‰ <br>  lscpu <br> æ¶æ„ï¼šx86_64 <br>  CPUæ“ä½œæ¨¡å¼ï¼š32ä½ï¼Œ64ä½ <br> å­—èŠ‚é¡ºåºï¼šå°å°¾æ•° <br>  CPUï¼ˆsï¼‰ï¼š48 <br> åœ¨çº¿CPUåˆ—è¡¨ï¼š0-47 <br> æ¯ä¸ªæ ¸å¿ƒçº¿ç¨‹æ•°ï¼š2 <br> æ¯ä¸ªæ’æ§½çš„èŠ¯æ•°ï¼š12 <br> æ’åº§ï¼š2 <br>  NUMAä¸ªèŠ‚ç‚¹ï¼š2 <br> ä¾›åº”å•†IDï¼šæ­£ç‰ˆè‹±ç‰¹å°” <br>  CPUç³»åˆ—ï¼š6 <br> å‹å·ï¼š63 <br> å‹å·åç§°ï¼šè‹±ç‰¹å°”Â®è‡³å¼ºÂ®CPU E5-2680 v3 @ 2.50GHz <br> æ­¥è¿›ï¼š2 <br>  CPU MHzï¼š1309.356 <br>  CPUæœ€å¤§MHzï¼š3300.0000 <br>  CPUæœ€ä½MHzï¼š1200.0000 <br>  BogoMIPSï¼š4988.42 <br> è™šæ‹ŸåŒ–ï¼šVT-x <br>  L1då¿«å–ï¼š32K <br>  L1iç¼“å­˜ï¼š32K <br>  L2å¿«å–ï¼š256K <br> ä¸‰çº§ç¼“å­˜ï¼š30720K <br>  NUMA node0 CPUï¼ˆsï¼‰ï¼š0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42 44.46 <br>  NUMA node1 CPUï¼š1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43 ï¼Œ45.47 <br> æ ‡å¿—ï¼šfpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lmå¸¸æ•°qtsopmooptoptsoptsoptsoptsoptsoptsoptsoptsopts SMX EST TM2 SSSE3 SDBG FMA CX16 xtpr PDCM PCID DCA sse4_1 sse4_2 x2apic movbe POPCNT tsc_deadline_timer AES XSAVE AVX F16C rdrand lahf_lm ABM EPB invpcid_single SSBD IBRS ibpb stibpå‡¯æ³½tpr_shadow vnmi FlexPriorityå¯EPT VPID fsgsbase tsc_adjust BMI1 AVX2 SMEP bmi2 ERMS invpcid CQM xsaveopt cqm_llc cqm_occup_llc dtherm IDAé˜¿æ‹‰ç‰¹plnç§¯åˆ†flush_l1d <br><br>  / usr / bin / qemu-system-x86_64 --version <br>  QEMUä»¿çœŸå™¨ç‰ˆæœ¬2.8.1ï¼ˆDebian 1ï¼š2.8 + dfsg-6 + deb9u5ï¼‰ <br> ç‰ˆæƒæ‰€æœ‰Â©2003-2016 Fabrice Bellardå’ŒQEMUé¡¹ç›®å¼€å‘äººå‘˜ <br></div></div><br>  db1çš„ç®€è¦ç‰¹å¾ï¼š <br> æ¶æ„ï¼šx86_64 <br>  CPUï¼ˆsï¼‰ï¼š48 <br> å†…å­˜ï¼š64 GB <br>  4.9.0-8-amd64ï¼ƒ1 SMP Debian 4.9.144-3.1ï¼ˆ2019-02-19ï¼‰x86_64 GNU / Linux <br>  Debian GNU / Linux 9ï¼ˆå»¶ä¼¸ï¼‰ <br>  psqlï¼ˆPostgreSQLï¼‰11.2ï¼ˆDebian 11.2-1.pgdg90 +1ï¼‰ <br><br><div class="spoiler">  <b class="spoiler_title">PostgreSQLé…ç½®å’Œä¸€äº›è§£é‡Š</b> <div class="spoiler_text">  seq_page_cost = 1.0 <br>  random_page_cost = 1.1ï¼ƒæˆ‘ä»¬æœ‰SSD <br> åŒ…æ‹¬'/etc/postgresql/11/main/extension.conf' <br>  log_line_prefix ='ï¼…t [ï¼…p-ï¼…l]ï¼…qï¼…u @ï¼…h' <br>  log_checkpoints =å¼€å¯ <br>  log_lock_waits =å¼€ <br>  log_statement = ddl <br>  log_min_duration_statement = 100 <br>  log_temp_files = 0 <br>  autovacuum_max_workers = 5 <br>  autovacuum_naptime = 10ç§’ <br>  autovacuum_vacuum_cost_delay = 20ms <br>  vacuum_cost_limit = 2000 <br>  maintenance_work_mem = 128MB <br>  sync_commit =å…³ <br>  checkpoint_timeout = 30åˆ†é’Ÿ <br>  listen_addresses ='*' <br>  work_mem = 32MB <br>  Effective_cache_size = 26214MBï¼ƒ50ï¼…çš„å¯ç”¨å†…å­˜ <br>  shared_buffers = 16384MBï¼ƒå¯ç”¨å†…å­˜çš„25ï¼… <br>  max_wal_size = 15GB <br>  min_wal_size = 80MB <br>  wal_level = hot_standby <br>  max_wal_senders = 10 <br>  wal_compression =å¼€å¯ <br>  archive_mode =å¼€ <br>  archive_command ='/ bin / true' <br>  archive_timeout = 1800 <br>  hot_standby =å¼€å¯ <br>  wal_log_hints =å¼€å¯ <br>  hot_standby_feedback =å¼€å¯ <br></div></div><br>  <b>hot_standby_feedback</b>é»˜è®¤ä¸ºå…³é—­ï¼Œæˆ‘ä»¬å·²å°†å…¶æ‰“å¼€ï¼Œä½†åæ¥å¿…é¡»å°†å…¶å…³é—­æ‰èƒ½è¿›è¡ŒæˆåŠŸçš„æµ‹è¯•ã€‚ ç¨åæˆ‘å°†è§£é‡ŠåŸå› ã€‚ <br><br> æ•°æ®åº“ä¸­çš„ä¸»è¦æ´»åŠ¨è¡¨ï¼ˆæ„é€ ï¼Œç”Ÿäº§ï¼Œæ¸¸æˆå®ä½“ï¼Œå»ºç­‘ç‰©ï¼Œcore_inventory_player_resourceï¼Œå¹¸å­˜è€…ï¼‰ä½¿ç”¨bashè„šæœ¬é¢„å…ˆå¡«å……äº†æ•°æ®ï¼ˆå¤§çº¦80GBï¼‰ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">db-fill-script.sh</b> <div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash --clean TRUNCATE TABLE production CASCADE; TRUNCATE TABLE construction CASCADE; TRUNCATE TABLE building CASCADE; TRUNCATE TABLE grid CASCADE; TRUNCATE TABLE core_inventory_player_resource CASCADE; TRUNCATE TABLE survivor CASCADE; TRUNCATE TABLE city CASCADE; TRUNCATE TABLE game_entity CASCADE; TRUNCATE TABLE player CASCADE; TRUNCATE TABLE core_player CASCADE; TRUNCATE TABLE core_client_device CASCADE; --core_client_device INSERT INTO core_client_device (id, creation_date, modification_date, device_model, device_name, locale, platform, user_agent, os_type, os_version, network_type, device_type) SELECT (1000000000+generate_series(0,999999)) AS id, now(), now(), 'device model', 'device name', 'en_DK', 'ios', 'ios user agent', 'android', '8.1', 'wlan', 'browser'; --core_player INSERT INTO core_player (id, guest, name, nickname, premium_points, soft_deleted, session_id, tracking_device_data_id) SELECT (1000000000+generate_series(0,999999)) AS id, true, 'guest0000000000000000000', null, 100, false, '00000000-0000-0000-0000-000000000000', (1000000000+generate_series(0,999999)) ; --player INSERT INTO player (id, creation_date, modification_date, core_player_id) SELECT (1000000000+generate_series(0,999999)) , now(), now(), (1000000000+generate_series(0,999999)) ; --city INSERT INTO game_entity (id, type, creation_date, modification_date) SELECT (1000000000+generate_series(0,999999)) , 'city', now(), now(); INSERT INTO city (id, game_design, player_id) SELECT (1000000000+generate_series(0,999999)) , 'city.default', (1000000000+generate_series(0,999999)) ; --survivor INSERT INTO game_entity (id, type, creation_date, modification_date) SELECT (1001000000+generate_series(0,999999)) , 'survivor', now(), now(); INSERT INTO survivor (id, game_design, owning_entity_id, type) SELECT (1001000000+generate_series(0,999999)) , 'survivor.prod_1', (1000000000+generate_series(0,999999)) , 'survivor'; --core_inventory_player_resource INSERT INTO core_inventory_player_resource (id, creation_date, modification_date, amount, player_id, resource_key) SELECT (1000000000+generate_series(0,1999999)) , NOW(), NOW(), 1000, (1000000000+generate_series(0,1999999)/2) , CONCAT('resource_', (1000000000+generate_series(0,1999999)) % 2); --grid DROP INDEX grid_area_idx; INSERT INTO grid (id, creation_date, modification_date, area, city_id) SELECT (1000000000+generate_series(0,19999999)) , NOW(), NOW(), BOX '0,0,4,4', (1000000000+generate_series(0,19999999)/20) ; create index on grid using gist (area box_ops); --building INSERT INTO game_entity (id, type, creation_date, modification_date) SELECT (1002000000+generate_series(0,99999999)) , 'building', now(), now(); INSERT INTO building (id, game_design, owning_entity_id, x, y, rotation, type) SELECT (1002000000+generate_series(0,99999999)) , 'building.building_prod_1', (1000000000+generate_series(0,99999999)/100) , 0, 0, 'DEGREES_0', 'building'; --construction INSERT INTO construction (id, creation_date, modification_date, definition, entity_id, start) SELECT (1000000000+generate_series(0,1999999)) , NOW(), NOW(), 'construction.building_prod_1-construction', (1002000000+generate_series(0,1999999)*50) , NOW(); --production INSERT INTO production (id, creation_date, modification_date, active, definition, entity_id, start_time) SELECT (1000000000+generate_series(0,49999999)) , NOW(), NOW(), true, 'production.building_prod_1_production_1', (1002000000+generate_series(0,49999999)*2) , NOW();</span></span></code> </pre> <br></div></div><br> å¤åˆ¶ï¼š <br><br><pre> <code class="plaintext hljs">SELECT * FROM pg_stat_replication; pid | usesysid | usename | application_name | client_addr | client_hostname | client_port | backend_start | backend_xmin | state | sent_lsn | write_lsn | flush_lsn | replay_lsn | write_lag | flush_lag | replay_lag | sync_priority | sync_state -----+----------+---------+---------------------+--------------+---------------------+-------------+-------------------------------+--------------+-----------+------------+------------+------------+------------+-----------------+-----------------+-----------------+---------------+------------ 759 | 17035 | repmgr | xl1db2 | xxxx | xl1db2 | 51142 | 2019-01-27 08:56:44.581758+00 | | streaming | 18/424A9F0 | 18/424A9F0 | 18/424A9F0 | 18/424A9F0 | 00:00:00.000393 | 00:00:00.001159 | 00:00:00.001313 | 0 | async 977 | 17035 | repmgr | xl1db3 |xxxxx | xl1db3 | 42888 | 2019-01-27 08:57:03.232969+00 | | streaming | 18/424A9F0 | 18/424A9F0 | 18/424A9F0 | 18/424A9F0 | 00:00:00.000373 | 00:00:00.000798 | 00:00:00.000919 | 0 | async</code> </pre><br><h4> åº”ç”¨æœåŠ¡å™¨ </h4><br> ç„¶åï¼Œåœ¨å„ç§é…ç½®å’Œå®¹é‡çš„ç”Ÿäº§æ€§HVï¼ˆprod_hypervisorsï¼‰ä¸Šï¼Œå¯åŠ¨äº†15ä¸ªåº”ç”¨ç¨‹åºæœåŠ¡å™¨ï¼š8ä¸ªå†…æ ¸ï¼Œ4GBã€‚ å¯ä»¥è¯´çš„æœ€ä¸»è¦çš„äº‹æƒ…ï¼šopenjdk 11.0.1 2018-10-16ï¼Œæ˜¥å­£ï¼Œé€šè¿‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">hikari</a>ä¸æ•°æ®åº“äº¤äº’ï¼ˆhikari.maximum-pool-sizeï¼š50ï¼‰ <br><br><h4> å‹åŠ›æµ‹è¯•ç¯å¢ƒ </h4><br> æ•´ä¸ªè´Ÿè½½æµ‹è¯•ç¯å¢ƒç”±ä¸€å°ä¸»æœåŠ¡å™¨<b>admin.loadtest</b>å’Œå‡ <b>å°generatorN.loadtest</b>æœåŠ¡å™¨ç»„æˆï¼ˆæœ¬ä¾‹ä¸­æœ‰14å°ï¼‰ã€‚ <br><br>  <b>generatorN.loadtest-</b> â€œè£¸æœºâ€ VM Debian Linux 9ï¼Œå·²å®‰è£…Java8ã€‚32ä¸ªå†…æ ¸/ 32 GBã€‚ å®ƒä»¬ä½äºâ€œéç”Ÿäº§å‹â€ HVä¸Šï¼Œä»¥å…æ„å¤–ç ´åé‡è¦VMçš„æ€§èƒ½ã€‚ <br><br>  <b>admin.loadtest</b> -Debian Linux 9 <b>è™šæ‹Ÿæœº</b> ï¼Œ16ä¸ªæ ¸å¿ƒ/ 16ä¸ªæ¼”å‡ºï¼Œå®ƒè¿è¡ŒJenkinsï¼ŒJLTCå’Œå…¶ä»–å…¶ä»–ä¸é‡è¦çš„è½¯â€‹â€‹ä»¶ã€‚ <br><br>  JLTC- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">jmeterè´Ÿè½½æµ‹è¯•ä¸­å¿ƒ</a> ã€‚  Py / Djangoä¸­çš„ä¸€ä¸ªç³»ç»Ÿï¼Œç”¨äºæ§åˆ¶å’Œè‡ªåŠ¨åŒ–æµ‹è¯•çš„å¯åŠ¨ä»¥åŠç»“æœçš„åˆ†æã€‚ <br><br><h3> æµ‹è¯•å¯åŠ¨æ–¹æ¡ˆ </h3><br><img src="https://habrastorage.org/webt/pb/f_/th/pbf_thx7mwuois96bffvbeehtxk.png"><br><br> è¿è¡Œæµ‹è¯•çš„è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><ul><li> è¯¥æµ‹è¯•ä»<b>è©¹é‡‘æ–¯ï¼ˆJenkins</b> ï¼‰å¯åŠ¨ã€‚ é€‰æ‹©æ‰€éœ€çš„ä½œä¸šï¼Œç„¶åæ‚¨éœ€è¦è¾“å…¥æ‰€éœ€çš„æµ‹è¯•å‚æ•°ï¼š <ul><li> æŒç»­æ—¶é—´-æµ‹è¯•æŒç»­æ—¶é—´ </li><li>  <b>RAMPUP-</b> â€œçƒ­èº«â€æ—¶é—´ </li><li>  <b>THREAD_COUNT_TOTAL-</b>æ‰€éœ€çš„è™šæ‹Ÿç”¨æˆ·æ•°ï¼ˆVUï¼‰æˆ–çº¿ç¨‹ </li><li>  <b>TARGET_RESPONSE_TIME</b>æ˜¯ä¸€ä¸ªé‡è¦çš„å‚æ•°ï¼Œå› æ­¤ä¸ºäº†é¿å…æ•´ä¸ªç³»ç»Ÿè¿‡è½½ï¼Œæˆ‘ä»¬è®¾ç½®äº†æ‰€éœ€çš„å“åº”æ—¶é—´ï¼Œå› æ­¤è¯¥æµ‹è¯•ä¼šå°†è´Ÿè½½ä¿æŒåœ¨æ•´ä¸ªç³»ç»Ÿçš„å“åº”æ—¶é—´ä¸è¶…è¿‡æŒ‡å®šå“åº”æ—¶é—´çš„æ°´å¹³ã€‚ </li></ul></li><li> å‘å°„ </li><li>  Jenkinsä»Gitlabå…‹éš†äº†æµ‹è¯•è®¡åˆ’ï¼Œå¹¶å°†å…¶å‘é€ç»™JLTCã€‚ </li><li>  JLTCå¯ä»¥é…åˆæµ‹è¯•è®¡åˆ’å·¥ä½œï¼ˆä¾‹å¦‚ï¼Œæ’å…¥CSVç®€å•ç¼–å†™å™¨ï¼‰ã€‚ </li><li>  JLTCè®¡ç®—æ‰€éœ€æ•°é‡çš„JmeteræœåŠ¡å™¨ä»¥è¿è¡Œæ‰€éœ€æ•°é‡çš„VUï¼ˆTHREAD_COUNT_TOTALï¼‰ã€‚ </li><li>  JLTCè¿æ¥åˆ°æ¯ä¸ªloadgeneratorNç”Ÿæˆå™¨å¹¶å¯åŠ¨jmeteræœåŠ¡å™¨ã€‚ </li></ul><br> åœ¨æµ‹è¯•æœŸé—´ï¼Œ <b>JMeterå®¢æˆ·ç«¯ä¼š</b>ç”Ÿæˆä¸€ä¸ªåŒ…å«ç»“æœçš„CSVæ–‡ä»¶ã€‚ å› æ­¤ï¼Œåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæ•°æ®é‡å’Œè¯¥æ–‡ä»¶çš„å¤§å°ä»¥æƒŠäººçš„é€Ÿåº¦å¢é•¿ï¼Œå¹¶ä¸”åœ¨æµ‹è¯•<b>Daemon</b>å‘æ˜å‡ºæ¥ï¼ˆä½œä¸ºå®éªŒï¼‰åå°±æ— æ³•ç”¨äºåˆ†æï¼Œ <b>Daemon</b>å¯ä»¥<i>â€œåŠ¨æ€â€</i>è§£æå®ƒã€‚ <br><br><h3> æµ‹è¯•è®¡åˆ’ </h3><br> æ‚¨å¯ä»¥åœ¨<a href="">æ­¤å¤„</a>ä¸‹è½½æµ‹è¯•è®¡åˆ’ã€‚ <br><br> æ³¨å†Œ/ç™»å½•åï¼Œç”¨æˆ·å°†åœ¨â€œ <b>è¡Œä¸ºâ€</b>æ¨¡å—ä¸­å·¥ä½œï¼Œè¯¥æ¨¡å—ç”±å‡ ä¸ª<b>ååé‡æ§åˆ¶å™¨</b>ç»„æˆï¼Œè¿™äº›<b>æ§åˆ¶å™¨</b>æŒ‡å®šç‰¹å®šæ¸¸æˆåŠŸèƒ½çš„å¯èƒ½æ€§ã€‚ åœ¨æ¯ä¸ªååé‡æ§åˆ¶å™¨ä¸­ï¼Œéƒ½æœ‰ä¸€ä¸ª<b>æ¨¡å—æ§åˆ¶å™¨</b> ï¼Œå®ƒå¼•ç”¨å®ç°è¯¥åŠŸèƒ½çš„ç›¸åº”æ¨¡å—ã€‚ <br><br><img src="https://habrastorage.org/webt/t0/ws/qp/t0wsqpbkgo-w6dt55gvxd6aw9pm.png"><br><br><h4> ç¦»é¢˜ </h4><br> åœ¨è„šæœ¬çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°è¯•æœ€å¤§ç¨‹åº¦åœ°ä½¿ç”¨Groovyï¼Œå¹¶ä¸”ç”±äºæˆ‘ä»¬çš„Javaç¨‹åºå‘˜ï¼Œæˆ‘ä¸ºè‡ªå·±æ‰¾åˆ°äº†ä¸€äº›æŠ€å·§ï¼ˆä¹Ÿè®¸å¯¹æŸäººæœ‰ç”¨ï¼‰ï¼š <br><br><ul><li> æ‚¨å¯ä»¥åœ¨æµ‹è¯•è®¡åˆ’å¼€å§‹çš„æŸä¸ªåœ°æ–¹å£°æ˜ä¸€ä¸ªå‡½æ•°ï¼Œç„¶ååœ¨å…¶ä»–é¢„å¤„ç†å™¨ï¼Œåå¤„ç†å™¨å’Œé‡‡æ ·å™¨ä¸­ä½¿ç”¨å®ƒã€‚ æ›´å¥½çš„ç‰¹æ€§<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ï¼šå°†æ–¹æ³•è½¬å˜ä¸ºé—­åŒ…</a> ï¼š <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//     - def sum(Integer x, Integer y) { return x + y } vars.putObject('sum', this.&amp;sum) //      closure.   . //     sampler`       def sum= vars.getObject('sum'); println sum(2, 2);</span></span></code> </pre> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">groovy.json.JsonSlurper</a>æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„å¿«é€ŸJSONè§£æå™¨ã€‚ ä¸groovyä¸€èµ·ï¼Œå®ƒä½¿æ‚¨å¯ä»¥ä¼˜é›…åœ°è§£æå’Œå¤„ç†æ•°æ®ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.json.JsonSlurper def canBuild = vars.getObject(canBuild); <span class="hljs-comment"><span class="hljs-comment">// ""       def content = jsonSlurper.parseText(response).content def buildings = content[0].buildings //         //               def constructableBuildingDefs = buildings .collect { k,v -&gt; v } .grep{ it.definitions .grep { it2 -&gt; it2['@type'] == 'type.googleapis.com/ConstructionDefinitionDTO'} .grep { it2 -&gt; canBuild(it2) } //   .size() &gt; 0 } if (!constructableBuildingDefs) { return; } Collections.shuffle(constructableBuildingDefs) //       </span></span></code> </pre></li></ul><br><h3>  VU /çº¿ç¨‹ </h3><br> åœ¨Jenkinsä¸­é…ç½®ä½œä¸šæ—¶ï¼Œå½“ç”¨æˆ·ä½¿ç”¨THREAD_COUNT_TOTALå‚æ•°è¾“å…¥æ‰€éœ€æ•°é‡çš„VUæ—¶ï¼Œæœ‰å¿…è¦ä»¥æŸç§æ–¹å¼å¯åŠ¨æ‰€éœ€æ•°é‡çš„JmeteræœåŠ¡å™¨å¹¶åœ¨å®ƒä»¬ä¹‹é—´åˆ†é…æœ€ç»ˆVUæ•°é‡ã€‚ è¿™éƒ¨åˆ†ä¸JLTCä¸€èµ·ä½äºç§°ä¸º<b>æ§åˆ¶å™¨/é…ç½®</b>çš„éƒ¨åˆ†ä¸­ã€‚ <br><br> æœ¬è´¨ä¸Šï¼Œç®—æ³•å¦‚ä¸‹ï¼š <br><br><ul><li> æˆ‘ä»¬å°†æ‰€éœ€æ•°é‡çš„<b>VUthreads_numåˆ’åˆ†</b>ä¸º200-300ä¸ªçº¿ç¨‹ï¼Œå¹¶æ ¹æ®æˆ–å¤šæˆ–å°‘çš„é€‚å½“å¤§å°<b>-Xmsm -Xmxm</b>ç¡®å®šä¸€ä¸ª<i>jmeter-server</i> <b>required_memory_for_jri</b> ï¼ˆJRI-æˆ‘ç§°ä¸ºJmeterè¿œç¨‹å®ä¾‹ï¼Œè€Œä¸æ˜¯Jmeter-serverï¼‰çš„æ‰€éœ€å†…å­˜å€¼ã€‚ </li><li> ä»threads_numå’Œ<b>Required_memory_for_jriä¸­</b> ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†jmeteræœåŠ¡å™¨çš„æ€»æ•°ï¼š <b>target_amount_jri</b>å’Œæ‰€éœ€å†…å­˜çš„æ€»æ•°ï¼š <b>required_memory_total</b> ã€‚ </li><li> æˆ‘ä»¬å°†æ‰€æœ‰loadgeneratorNç”Ÿæˆå™¨ä¸€ä¸€åˆ†ç±»ï¼Œå¹¶æ ¹æ®å…¶ä¸Šçš„å¯ç”¨å†…å­˜å¯åŠ¨æœ€å¤§æ•°é‡çš„jmeteræœåŠ¡å™¨ã€‚ åªè¦æ­£åœ¨è¿è¡Œçš„current_amount_jriå®ä¾‹æ•°<b>ä¸ç­‰äº</b> target_amount_jriã€‚ </li><li>  ï¼ˆå¦‚æœç”Ÿæˆå™¨æ•°å’Œæ€»å†…å­˜ä¸è¶³ï¼Œè¯·å‘æ± ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„ï¼‰ </li><li> æˆ‘ä»¬ä½¿ç”¨<b>netstat</b>è¿æ¥åˆ°æ¯ä¸ªç”Ÿæˆå™¨ï¼Œ <b>æˆ‘ä»¬ä¼š</b>è®°ä½æ‰€æœ‰ç¹å¿™çš„ç«¯å£ï¼Œå¹¶åœ¨æ‰€éœ€æ•°é‡çš„jmeteræœåŠ¡å™¨ä¸Šçš„éšæœºç«¯å£ï¼ˆæœªå ç”¨çš„ç«¯å£ï¼‰ä¸Šè¿è¡Œï¼š <br><br><pre> <code class="python hljs"> netstat_cmd= <span class="hljs-string"><span class="hljs-string">'netstat -tulpn | grep LISTEN'</span></span> stdin, stdout, stderr = ssh.exec_command(cmd1) used_ports = [] netstat_output = str(stdout.readlines()) ports = re.findall(<span class="hljs-string"><span class="hljs-string">'\d+\.\d+\.\d+\.\d+\:(\d+)'</span></span>, netstat_output) ports_ipv6 = re.findall(<span class="hljs-string"><span class="hljs-string">'\:\:\:(\d+)'</span></span>, netstat_output) p.wait() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> port <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ports: used_ports.append(int(port)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> port <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ports_ipv6: used_ports.append(int(port)) ssh.close() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, possible_jris_on_host + <span class="hljs-number"><span class="hljs-number">1</span></span>): port = int(random.randint(<span class="hljs-number"><span class="hljs-number">10000</span></span>, <span class="hljs-number"><span class="hljs-number">20000</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> port <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> used_ports: port = int(random.randint(<span class="hljs-number"><span class="hljs-number">10000</span></span>, <span class="hljs-number"><span class="hljs-number">20000</span></span>)) <span class="hljs-comment"><span class="hljs-comment"># ...  Jmeter-    </span></span></code> </pre></li><li> æˆ‘ä»¬ä¸€æ¬¡æ”¶é›†æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„jmeteræœåŠ¡å™¨ï¼Œå…¶æ ¼å¼ä¸ºåœ°å€ï¼šç«¯å£ï¼Œä¾‹å¦‚<b>generator13ï¼š15576ï¼Œgenerator9ï¼š14015ï¼Œgenerator11ï¼š19152ï¼Œgenerator14ï¼š12125ï¼Œgenerator2ï¼š17602</b> </li><li> æµ‹è¯•å¼€å§‹æ—¶ï¼Œç»“æœåˆ—è¡¨å’Œthreads_per_hostå°†å‘é€åˆ°JMeterå®¢æˆ·ç«¯ï¼š <br><br><pre> <code class="bash hljs">REMOTE_TESTING_FLAG=<span class="hljs-string"><span class="hljs-string">" -R </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$REMOTE_HOSTS_STRING</span></span></span><span class="hljs-string">"</span></span> java -jar -Xms7g -Xmx7g -Xss228k <span class="hljs-variable"><span class="hljs-variable">$JMETER_DIR</span></span>/bin/ApacheJMeter.jar -Jserver.rmi.ssl.disable=<span class="hljs-literal"><span class="hljs-literal">true</span></span> -n -t <span class="hljs-variable"><span class="hljs-variable">$TEST_PLAN</span></span> -j <span class="hljs-variable"><span class="hljs-variable">$WORKSPACE</span></span>/loadtest.log -GTHREAD_COUNT=<span class="hljs-variable"><span class="hljs-variable">$THREADS_PER_HOST</span></span> <span class="hljs-variable"><span class="hljs-variable">$OTHER_VARS</span></span> <span class="hljs-variable"><span class="hljs-variable">$REMOTE_TESTING_FLAG</span></span> -Jjmeter.save.saveservice.default_delimiter=,</code> </pre></li></ul><br> åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œæµ‹è¯•æ˜¯åŒæ—¶ä»300ä¸ªJmeteræœåŠ¡å™¨è¿›è¡Œçš„ï¼Œæ¯ä¸ªæœåŠ¡å™¨500ä¸ªçº¿ç¨‹ï¼Œä¸€å°å¸¦æœ‰Javaå‚æ•°çš„JmeteræœåŠ¡å™¨çš„å¯åŠ¨æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="bash hljs">nohup java -server -Xms1200m -Xmx1200m -Xss228k -XX:+DisableExplicitGC -XX:+CMSClassUnloadingEnabled -XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=70 -XX:+ScavengeBeforeFullGC -XX:+CMSScavengeBeforeRemark -XX:+UseConcMarkSweepGC -XX:+CMSParallelRemarkEnabled -Djava.net.preferIPv6Addresses=<span class="hljs-literal"><span class="hljs-literal">true</span></span> -Djava.net.preferIPv4Stack=<span class="hljs-literal"><span class="hljs-literal">false</span></span> -jar <span class="hljs-string"><span class="hljs-string">"/tmp/jmeter-JwKse5nY/bin/ApacheJMeter.jar"</span></span> -Jserver.rmi.ssl.disable=<span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-string"><span class="hljs-string">"-Djava.rmi.server.hostname=generator12.loadtest.ig.local"</span></span> -Duser.dir=/tmp/jmeter-JwKse5nY/bin/ -Dserver_port=13114 -s -Jpoll=49 &gt; /dev/null 2&gt;&amp;1</code> </pre> <br><h3>  50æ¯«ç§’ </h3><br> ä»»åŠ¡æ˜¯ç¡®å®šæˆ‘ä»¬çš„æ•°æ®åº“å¯ä»¥æ‰¿å—çš„è´Ÿè½½é‡ï¼Œè€Œä¸æ˜¯ä½¿æ•°æ®åº“ä»¥åŠæ•´ä¸ªç³»ç»Ÿæ•´ä½“è¿‡è½½åˆ°ä¸´ç•ŒçŠ¶æ€ã€‚ æ‹¥æœ‰å¦‚æ­¤å¤šçš„JmeteræœåŠ¡å™¨ï¼Œæ‚¨éœ€è¦ä»¥æŸç§æ–¹å¼å°†è´Ÿè½½ä¿æŒåœ¨ä¸€å®šæ°´å¹³ï¼Œè€Œä¸æ˜¯æ€æ­»æ•´ä¸ªç³»ç»Ÿã€‚ å¼€å§‹æµ‹è¯•æ—¶æŒ‡å®šçš„<b>TARGET_RESPONSE_TIME</b>å‚æ•°å¯¹æ­¤è´Ÿè´£ã€‚ æˆ‘ä»¬åŒæ„<b>50ms</b>æ˜¯ç³»ç»Ÿåº”è´Ÿè´£çš„æœ€ä½³å“åº”æ—¶é—´ã€‚ <br><br> åœ¨JMeterä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæœ‰è®¸å¤šä¸åŒçš„è®¡æ—¶å™¨å¯è®©æ‚¨æ§åˆ¶ååé‡ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œä»ä½•å¤„è·å–å®ƒæ˜¯æœªçŸ¥çš„ã€‚ ä½†æ˜¯æœ‰<b>JSR223-Timer</b> ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒä½¿ç”¨<b>å½“å‰çš„</b>ç³»ç»Ÿ<b>å“åº”æ—¶é—´æå‡ºä¸€äº›å»ºè®®</b> ã€‚ è®¡æ—¶å™¨æœ¬èº«ä½äºä¸»è¦çš„<b>Behavior</b>å—ä¸­ï¼š <br><br><img src="https://habrastorage.org/webt/uv/o8/rb/uvo8rb9ph7mr1xhxkzxccsfa06a.png"><br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//      = 0 vars.put('samples', '20'); vars.putObject('respAvg', ${TARGET_RESPONSE_TIME}.0); vars.putObject('sleep', 0.0); //  JSR223-Timer           "" double sleep = vars.getObject('sleep'); double respAvg = vars.getObject('respAvg'); double previous = sleep; double target = ${TARGET_RESPONSE_TIME}; if (respAvg &lt; target) { sleep /= 1.5; } if (respAvg &gt; target) { sleep *= 1.1; } sleep = Math.max(10, sleep); //      sleep = Math.min(20000, sleep); vars.putObject('sleep', sleep); return (int)sleep;</span></span></code> </pre><br><h3> ç»“æœåˆ†æï¼ˆå®ˆæŠ¤ç¨‹åºï¼‰ </h3><br> é™¤äº†Grafanaä¸­çš„å›¾å½¢å¤–ï¼Œè¿˜å¿…é¡»å…·æœ‰æ±‡æ€»çš„æµ‹è¯•ç»“æœï¼Œä»¥ä¾¿éšåå¯ä»¥åœ¨JLTCä¸­å¯¹æµ‹è¯•è¿›è¡Œæ¯”è¾ƒã€‚ <br><br> ä¸€ä¸ªè¿™æ ·çš„æµ‹è¯•æ¯ç§’ç”Ÿæˆ16k-20kä¸ªè¯·æ±‚ï¼Œå¾ˆå®¹æ˜“è®¡ç®—å‡ºå®ƒåœ¨4å°æ—¶å†…ä¼šç”Ÿæˆä¸€ä¸ªå¤§å°ä¸ºæ•°ç™¾GBçš„CSVæ–‡ä»¶ï¼Œå› æ­¤æœ‰å¿…è¦æå‡ºä¸€é¡¹æ¯åˆ†é’Ÿè§£æä¸€æ¬¡æ•°æ®ï¼Œå°†å…¶å‘é€åˆ°æ•°æ®åº“å¹¶æ¸…ç†ä¸»æ–‡ä»¶çš„ä½œä¸šã€‚ <br><br><img src="https://habrastorage.org/webt/pb/mj/kc/pbmjkcwgjcxupnihgzpzmqd0nvq.png"><br><br> ç®—æ³•å¦‚ä¸‹ï¼š <br><br><ul><li> æˆ‘ä»¬ä»jmeter-clientç”Ÿæˆçš„CSVæ–‡ä»¶<b>result.jtlä¸­</b>è¯»å–æ•°æ®ï¼Œå°†å…¶ä¿å­˜å¹¶æ¸…ç†æ–‡ä»¶ï¼ˆæ‚¨éœ€è¦æ­£ç¡®æ¸…ç†å®ƒï¼Œå¦åˆ™ï¼Œç©ºæ–‡ä»¶å°†å…·æœ‰ç›¸åŒçš„FDï¼Œä¸”å¤§å°ç›¸åŒï¼‰ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(jmeter_results_file, <span class="hljs-string"><span class="hljs-string">'r+'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: rows = f.readlines() f.seek(<span class="hljs-number"><span class="hljs-number">0</span></span>) f.truncate(<span class="hljs-number"><span class="hljs-number">0</span></span>) f.writelines(rows[<span class="hljs-number"><span class="hljs-number">-1</span></span>])</code> </pre></li><li> æˆ‘ä»¬å°†è¯»å–çš„æ•°æ®å†™å…¥ä¸´æ—¶æ–‡ä»¶<b>temp_result.jtlä¸­</b> ï¼š <br><br><pre> <code class="python hljs">rows_num = len(rows) open(temp_result_filename, <span class="hljs-string"><span class="hljs-string">'w'</span></span>).writelines(rows[<span class="hljs-number"><span class="hljs-number">0</span></span>:rows_num]) <span class="hljs-comment"><span class="hljs-comment"># avoid last line</span></span></code> </pre> </li><li> æˆ‘ä»¬è¯»å–äº†æ–‡ä»¶<b>temp_result.jtl</b> ã€‚ æˆ‘ä»¬ä»¥åˆ†é’Ÿä¸ºå•ä½åˆ†å‘è¯»å–çš„æ•°æ®ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> r <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> f.readlines(): row = r.split(<span class="hljs-string"><span class="hljs-string">','</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(row[<span class="hljs-number"><span class="hljs-number">0</span></span>]) == <span class="hljs-number"><span class="hljs-number">13</span></span>: ts_c = int(row[<span class="hljs-number"><span class="hljs-number">0</span></span>]) dt_c = datetime.datetime.fromtimestamp(ts_c/<span class="hljs-number"><span class="hljs-number">1000</span></span>) minutes_data.setdefault(dt_c.strftime(<span class="hljs-string"><span class="hljs-string">'%Y_%m_%d_%H_%M'</span></span>), []).append(r)</code> </pre></li><li>  <b>minutes_dataä¸­</b>æ¯åˆ†é’Ÿçš„æ•°æ®<b>å°†</b>å†™å…¥<b>to_parse /</b>æ–‡ä»¶å¤¹ä¸­çš„ç›¸åº”æ–‡ä»¶ã€‚  ï¼ˆå› æ­¤ï¼Œç›®å‰ï¼Œæµ‹è¯•çš„æ¯ä¸€åˆ†é’Ÿéƒ½æœ‰å…¶è‡ªå·±çš„æ•°æ®æ–‡ä»¶ï¼Œç„¶ååœ¨èšåˆè¿‡ç¨‹ä¸­ï¼Œæ•°æ®æŒ‰ä»€ä¹ˆé¡ºåºè¿›å…¥æ¯ä¸ªæ–‡ä»¶<b>éƒ½</b>æ— å…³ç´§è¦ï¼‰ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> key, value <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> minutes_data.iteritems(): <span class="hljs-comment"><span class="hljs-comment">#      timestamp (key) temp_ts_file = os.path.join(temp_to_parse_path, key) open(temp_ts_file, 'a+').writelines(value)</span></span></code> </pre></li><li> åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åˆ†æäº†to_parseæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ï¼Œå¦‚æœå®ƒä»¬åœ¨ä¸€åˆ†é’Ÿä¹‹å†…æ²¡æœ‰å˜åŒ–ï¼Œé‚£ä¹ˆè¯¥æ–‡ä»¶æ˜¯æ•°æ®åˆ†æï¼Œèšåˆå¹¶å‘é€åˆ°JLTCæ•°æ®åº“çš„å€™é€‰æ–‡ä»¶ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> filename <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.listdir(temp_to_parse_path): data_file = os.path.join(temp_to_parse_path, filename) file_mod_time = os.stat(data_file).st_mtime last_time = (time.time() - file_mod_time) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> last_time &gt; <span class="hljs-number"><span class="hljs-number">60</span></span>: logger.info(<span class="hljs-string"><span class="hljs-string">'[DAEMON] File {} was not modified since 1min, adding to parse list.'</span></span>.format(data_file)) files_to_parse.append(data_file)</code> </pre></li><li> å¦‚æœæœ‰è¿™æ ·çš„æ–‡ä»¶ï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å®ƒä»¬è§£æåå‘é€åˆ°<b>parse_csv_data</b>å‡½æ•°ï¼ˆæ¯ä¸ªæ–‡ä»¶å¹¶è¡Œï¼‰ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files_to_parse: logger.info(<span class="hljs-string"><span class="hljs-string">'[DAEMON THREAD] Parse {}.'</span></span>.format(f)) t = threading.Thread( target=parse_csv_data, args=( f, jmeter_results_file_fields, test, data_resolution)) t.start() threads.append(t) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> threads: t.join()</code> </pre></li></ul><br>  cron.dä¸­çš„å®ˆæŠ¤è¿›ç¨‹æœ¬èº«æ¯åˆ†é’Ÿå¯åŠ¨ä¸€æ¬¡ï¼š <br><br> å®ˆæŠ¤è¿›ç¨‹æ¯åˆ†é’Ÿä»cron.då¼€å§‹ï¼š <br><br><pre> <code class="bash hljs">* * * * * root sleep 21 &amp;&amp; /usr/bin/python /var/lib/jltc/manage.py daemon</code> </pre> <br> å› æ­¤ï¼Œå…·æœ‰ç»“æœçš„æ–‡ä»¶ä¸ä¼šè†¨èƒ€åˆ°æ— æ³•æƒ³è±¡çš„å¤§å°ï¼Œè€Œæ˜¯ä¼šè¿›è¡ŒåŠ¨æ€åˆ†æå¹¶æ¸…é™¤ã€‚ <br><br><h2> ç»“æœ </h2><br><h3> è¯¥åº”ç”¨ç¨‹åº </h3><br> æˆ‘ä»¬çš„150,000åè™šæ‹Ÿç©å®¶ï¼š <br><br><img src="https://habrastorage.org/webt/sv/ex/ep/svexepi9ikzy0unpxur96mty5q8.png"><br><br> è¯¥æµ‹è¯•è¯•å›¾â€œåŒ¹é…â€ 50msçš„å“åº”æ—¶é—´ï¼Œå› æ­¤è´Ÿè½½æœ¬èº«åœ¨16k-18kä¸ªè¯·æ±‚/ cä¹‹é—´çš„åŒºåŸŸä¸­ä¸æ–­è·³è·ƒï¼š <br><br><img src="https://habrastorage.org/webt/-z/98/oi/-z98oi-_8a41hkqbrmz2rvzmryk.png"><br><br> åº”ç”¨ç¨‹åºæœåŠ¡å™¨è´Ÿè½½ï¼ˆ15ä¸ªåº”ç”¨ç¨‹åºï¼‰ã€‚ é€Ÿåº¦è¾ƒæ…¢çš„M620ä¸Šæœ‰ä¸¤å°æœåŠ¡å™¨æ˜¯â€œä¸å¹¸çš„â€ï¼š <br><br><img src="https://habrastorage.org/webt/nc/xy/et/ncxyetqyk_a8mbhjocndd-yxgkm.png"><br><br> æ•°æ®åº“å“åº”æ—¶é—´ï¼ˆå¯¹äºåº”ç”¨æœåŠ¡å™¨ï¼‰ï¼š <br><br><img src="https://habrastorage.org/webt/zr/a-/gw/zra-gwtq_vqhtfhlrjzzy1osisg.png"><br><br><h3> èµ„æ–™åº“ </h3><br>  db1ï¼ˆVMï¼‰ä¸Šçš„CPU utilï¼š <br><br><img src="https://habrastorage.org/webt/ej/hn/in/ejhnin0jo_7rrzhlj7pqko6udnq.png"><br><br> ç³»ç»Ÿç®¡ç†ç¨‹åºä¸Šçš„CPU utilï¼š <br><br><img src="https://habrastorage.org/webt/uw/ik/tz/uwiktzvcdzydlsjaoexqfbr3tay.png"><br><br> è™šæ‹Ÿæœºä¸Šçš„è´Ÿè½½è¾ƒä½ï¼Œå› ä¸ºå®ƒè®¤ä¸ºè™šæ‹Ÿæœºä¸Šæœ‰48ä¸ªå®é™…å†…æ ¸å¯ä¾›ä½¿ç”¨ï¼Œå®é™…ä¸Šï¼Œè™šæ‹Ÿæœºç®¡ç†ç¨‹åºä¸Šæœ‰24ä¸ª<b>è¶…çº¿ç¨‹</b>å†…æ ¸ã€‚ <br><br>  <b>æœ€å¤šã€œ25ä¸‡æ¬¡æŸ¥è¯¢/ç§’</b>è¿›å…¥æ•°æ®åº“ï¼ŒåŒ…æ‹¬ï¼ˆ83ï¼…é€‰æ‹©ï¼Œ3ï¼…-æ’å…¥ï¼Œ11.6ï¼…-æ›´æ–°ï¼ˆ90ï¼…HOTï¼‰ï¼Œ1.6ï¼…åˆ é™¤ï¼‰ï¼š <br><br><img src="https://habrastorage.org/webt/lx/lu/bl/lxlublobhm4nm3c45g9jikcstc4.png"><br><br><img src="https://habrastorage.org/webt/18/jw/gp/18jwgpmebrkyot3ngvarsl_3ysu.png"><br><br> åœ¨é»˜è®¤å€¼<b>autovacuum_vacuum_scale_factor</b> = 0.2çš„æƒ…å†µä¸‹ï¼Œéšç€æµ‹è¯•çš„è¿›è¡Œï¼Œæ­»å…ƒç»„çš„æ•°é‡å¢é•¿éå¸¸å¿«ï¼ˆè¡¨å¤§å°ä¸æ–­å¢åŠ ï¼‰ï¼Œè¿™å¤šæ¬¡å¯¼è‡´æ•°æ®åº“æ€§èƒ½å‡ºç°é—®é¢˜ï¼Œä»è€Œä½¿æ•´ä¸ªæµ‹è¯•å¤šæ¬¡å´©æºƒã€‚ æˆ‘å¿…é¡»é€šè¿‡ä¸ºæ­¤å‚æ•°åˆ†é…ä¸ªäººå€¼autovacuum_vacuum_scale_factoræ¥â€œæ§åˆ¶â€æŸäº›è¡¨çš„å¢é•¿ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">ALTER TABLE ... SETï¼ˆautovacuum_vacuum_scale_factor = ...ï¼‰</b> <div class="spoiler_text">  ALTER TABLEæ„é€ é›†ï¼ˆautovacuum_vacuum_scale_factor = 0.10ï¼‰; <br>  ALTER TABLEç”Ÿäº§è®¾ç½®ï¼ˆautovacuum_vacuum_scale_factor = 0.01ï¼‰; <br>  ALTER TABLE game_entity SETï¼ˆautovacuum_vacuum_scale_factor = 0.01ï¼‰; <br>  ALTER TABLE game_entity SETï¼ˆautovacuum_analyze_scale_factor = 0.01ï¼‰; <br>  ALTER TABLEå»ºç­‘ç‰©è®¾ç½®ï¼ˆautovacuum_vacuum_scale_factor = 0.01ï¼‰; <br>  ALTER TABLEå»ºç­‘è®¾ç½®ï¼ˆautovacuum_analyze_scale_factor = 0.01ï¼‰; <br>  ALTER TABLE core_inventory_player_resource SETï¼ˆautovacuum_vacuum_scale_factor = 0.10ï¼‰; <br>  ALTER TABLE Survivor SETï¼ˆautovacuum_vacuum_scale_factor = 0.01ï¼‰; <br>  ALTER TABLEå¹¸å­˜è€…é›†ï¼ˆautovacuum_analyze_scale_factor = 0.01ï¼‰; <br></div></div><br><img src="https://habrastorage.org/webt/0s/ja/1e/0sja1e1m3-2gitbmhh8j24t2ktu.png"><br><br> ç†æƒ³æƒ…å†µä¸‹ï¼Œrows_fetchedåº”â€‹â€‹è¯¥æ¥è¿‘rows_returnedï¼Œå¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°ï¼š <br><br><img src="https://habrastorage.org/webt/e4/k6/zo/e4k6zobp25h5asrmxhmficoea3a.png"><br><br><h4>  hot_standby_feedback </h4><br> é—®é¢˜åœ¨äº<b>hot_standby_feedback</b>å‚æ•°ï¼Œå¦‚æœ<b>ä¸»</b>æœåŠ¡å™¨çš„<b>å¤‡ç”¨</b>æœåŠ¡å™¨æ²¡æœ‰æ—¶é—´åº”ç”¨æ¥è‡ªWALæ–‡ä»¶çš„æ›´æ”¹ï¼Œåˆ™è¯¥å‚æ•°ä¼šæå¤§åœ°å½±å“<b>ä¸»</b>æœåŠ¡å™¨çš„æ€§èƒ½ã€‚ è¯¥æ–‡æ¡£ï¼ˆhttps://postgrespro.ru/docs/postgrespro/11/runtime-config-replicationï¼‰æŒ‡å‡ºï¼Œå®ƒâ€œç¡®å®šçƒ­å¤‡ç”¨æœåŠ¡å™¨æ˜¯å°†å½“å‰æ­£åœ¨æ‰§è¡Œçš„è¯·æ±‚é€šçŸ¥ä¸»æœåŠ¡å™¨è¿˜æ˜¯ä¸Šçº§ä»æœåŠ¡å™¨ã€‚â€ é»˜è®¤æƒ…å†µä¸‹å®ƒæ˜¯å…³é—­çš„ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„é…ç½®ä¸­å®ƒæ˜¯æ‰“å¼€çš„ã€‚ å¯¼è‡´å¯æ‚²çš„åæœï¼Œå¦‚æœæœ‰2ä¸ªå¤‡ç”¨æœåŠ¡å™¨ï¼Œå¹¶ä¸”åŠ è½½æœŸé—´çš„å¤åˆ¶æ»åä¸åŒäºé›¶ï¼ˆå‡ºäºå„ç§åŸå› ï¼‰ï¼Œåˆ™å¯ä»¥è§‚å¯Ÿåˆ°è¿™æ ·çš„æƒ…å†µï¼Œè¿™å¯èƒ½å¯¼è‡´æ•´ä¸ªæµ‹è¯•å´©æºƒï¼š <br><br><img src="https://habrastorage.org/webt/vl/1l/jd/vl1ljdockxrjlfsoiybq751vo9y.png"><br><br><img src="https://habrastorage.org/webt/qh/4s/m_/qh4sm_hpnunb2w0axzhk90lmf6u.png"><br><br> è¿™æ˜¯ç”±äºä»¥ä¸‹äº‹å®ï¼šå¯ç”¨hot_standby_feedbackæ—¶ï¼ŒVACUUMä¸æƒ³åˆ é™¤å¤‡ç”¨æœåŠ¡å™¨çš„äº‹åŠ¡IDä¸­çš„æ— æ•ˆå…ƒç»„ï¼Œä»¥é˜²æ­¢å¤åˆ¶å†²çªã€‚ è¯¦ç»†çš„æ–‡ç« <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PostgreSQLä¸­çš„hot_standby_feedbackå®é™…ä¸Šæ˜¯åšä»€ä¹ˆçš„</a> ï¼š <br><br><pre> <code class="plaintext hljs">xl1_game=# VACUUM VERBOSE core_inventory_player_resource; INFO: vacuuming "public.core_inventory_player_resource" INFO: scanned index "core_inventory_player_resource_pkey" to remove 62869 row versions DETAIL: CPU: user: 1.37 s, system: 0.58 s, elapsed: 4.20 s â€¦â€¦â€¦... INFO: "core_inventory_player_resource": found 13682 removable, 7257082 nonremovable row versions in 71842 out of 650753 pages &lt;b&gt;DETAIL: 3427824 dead row versions cannot be removed yet, oldest xmin: 3810193429&lt;/b&gt; There were 1920498 unused item pointers. Skipped 8 pages due to buffer pins, 520953 frozen pages. 0 pages are entirely empty. CPU: user: 4.55 s, system: 1.46 s, elapsed: 11.74 s.</code> </pre><br> å¦‚æ­¤å¤§é‡çš„æ­»å…ƒç»„å¯¼è‡´äº†ä¸Šé¢çš„å›¾ç‰‡ã€‚ è¿™æ˜¯ä¸¤ä¸ªæµ‹è¯•ï¼Œåˆ†åˆ«æ‰“å¼€å’Œå…³é—­hot_standby_feedbackï¼š <br><br><img src="https://habrastorage.org/webt/8f/od/n6/8fodn60lohgzsu-twheqysldjzy.png"><br><br> è¿™æ˜¯æˆ‘ä»¬åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­çš„å¤åˆ¶æ»åï¼Œå°†æ¥æœ‰å¿…è¦åšä¸€äº›äº‹æƒ…ï¼š <br><br><img src="https://habrastorage.org/webt/et/s0/7h/ets07hkl8skkv5wexxjrgi-3x7m.png"><br><br><h2> ç»“è®º </h2><br> å¹¸è¿çš„æ˜¯ï¼Œæ­¤æµ‹è¯•ï¼ˆæˆ–ä¸å¹¸çš„æ˜¯ï¼Œå¯¹äºæœ¬æ–‡çš„å†…å®¹è€Œè¨€ï¼‰è¡¨æ˜ï¼Œåœ¨æ¸¸æˆåŸå‹çš„ç°é˜¶æ®µï¼Œå¾ˆæœ‰å¯èƒ½å¸æ”¶ç”¨æˆ·æ–¹é¢çš„æœŸæœ›è´Ÿè½½ï¼Œè¿™è¶³ä»¥ä¸ºè¿›ä¸€æ­¥çš„åŸå‹å¼€å‘æä¾›å¼€ç»¿ç¯ã€‚ åœ¨åç»­çš„å¼€å‘é˜¶æ®µï¼Œæœ‰å¿…è¦éµå¾ªåŸºæœ¬è§„åˆ™ï¼ˆä»¥ä¿æŒæ‰€æ‰§è¡ŒæŸ¥è¯¢çš„ç®€å•æ€§ï¼Œé˜²æ­¢ç´¢å¼•è¿‡å¤šä»¥åŠæœªç´¢å¼•çš„è¯»æ•°ç­‰ï¼‰ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œåœ¨å¼€å‘çš„æ¯ä¸ªé‡è¦é˜¶æ®µéƒ½è¦å¯¹é¡¹ç›®è¿›è¡Œæµ‹è¯•ï¼Œä»¥å‘ç°å¹¶è§£å†³é—®é¢˜ã€‚å¯ä»¥æ—©äº›ã€‚ ä¹Ÿè®¸å¾ˆå¿«ï¼Œæˆ‘å°†å†™ä¸€ç¯‡æ–‡ç« ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»è§£å†³äº†ç‰¹å®šçš„é—®é¢˜ã€‚ <br><br> ç¥å¤§å®¶å¥½è¿ï¼ <br><br> æˆ‘ä»¬çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHub</a>ä»¥é˜²ä¸‡ä¸€;ï¼‰ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN445368/">https://habr.com/ru/post/zh-CN445368/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN445356/index.html">DUMP-2019çš„ç§»åŠ¨éƒ¨åˆ†æ¦‚è¿°ï¼šåœ¨æ—¥å¸¸å·¥ä½œä¸­å¾—åˆ°æœ€å¤§åº”ç”¨å’Œå¸®åŠ©</a></li>
<li><a href="../zh-CN445358/index.html">åœ¨Unityä¸­ç»„ç»‡äº‹ä»¶ç³»ç»Ÿ-é€šè¿‡æ¸¸æˆè®¾è®¡å¸ˆçš„çœ¼å…‰</a></li>
<li><a href="../zh-CN445360/index.html">JavaScripté‡‡è®¿çš„5ä¸ªå…¸å‹ä»»åŠ¡ï¼šè§£æå’Œè§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="../zh-CN445362/index.html">ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿã€‹ä¸€ä¹¦ã€‚ è®¾è®¡æ¨¡å¼</a></li>
<li><a href="../zh-CN445366/index.html">ç”±äºSIMDå—ï¼Œå¦‚ä½•æ ¹æ®Baikal-T1å¤„ç†å™¨ä¸Šçš„GOST 28147-89åŠ å¿«åŠ å¯†é€Ÿåº¦</a></li>
<li><a href="../zh-CN445370/index.html">Prometheus 2ä¸­çš„TSDBåˆ†æ</a></li>
<li><a href="../zh-CN445372/index.html">æœºå™¨è§†è§‰ä¸äººç±»ç›´è§‰ï¼šç ´åå¯¹è±¡è¯†åˆ«ç¨‹åºæ“ä½œçš„ç®—æ³•</a></li>
<li><a href="../zh-CN445378/index.html">è¿·å®«ï¼šåˆ†ç±»ï¼Œç”Ÿæˆï¼Œå¯»æ‰¾è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="../zh-CN445380/index.html">ç°ä»£PHPç¾ä¸½è€Œé«˜æ•ˆ</a></li>
<li><a href="../zh-CN445384/index.html">eå¨¥å››å·ä»»åŠ¡-ç€é™†æ¨¡å—å’Œä¸­ç»§å«æ˜Ÿä¸Šçš„ç§‘å­¦è®¾å¤‡</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>