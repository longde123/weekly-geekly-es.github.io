<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üàöÔ∏è üë©üèæ‚Äçü§ù‚Äçüë®üèª üéß A hist√≥ria da cria√ß√£o de uma nuvem dom√©stica. Parte 3. Criando uma nuvem pessoal - instalando e configurando o Nextcloud üë®üèª‚Äç‚úàÔ∏è üçû üìü</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No caminho para criar nosso pr√≥prio servi√ßo de nuvem, enquanto nos acostumamos com o sistema Debian e criamos um servidor web . Agora √© hora da etapa ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>A hist√≥ria da cria√ß√£o de uma nuvem dom√©stica. Parte 3. Criando uma nuvem pessoal - instalando e configurando o Nextcloud</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/410011/">  No caminho para criar nosso pr√≥prio servi√ßo de nuvem, enquanto nos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">acostumamos com o sistema Debian</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">criamos um servidor web</a> .  Agora √© hora da etapa final - criar e configurar uma nuvem pessoal baseada no servidor Nextcloud. <br><br><img src="https://habrastorage.org/webt/hd/zf/np/hdzfnpy3coj3pu5hr6xs8ssjop8.jpeg"><br><a name="habracut"></a><br><hr><a name="chap0"></a><br><h3>  Sum√°rio </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">Parte 1. Configurando seu ambiente Debian para uso di√°rio</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">Parte 2. Criando um servidor - configurando o LAMP no Debian</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">Parte 3. Criando uma nuvem pessoal - instalando e configurando o Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">Parte 4. Atualiza√ß√£o 2018 - Debian 9 e Nextcloud 13</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 5. Atualizando 2019 - PHP 7.2, MariaDB 10.4 e Nextcloud 17</a> <br><br><hr><br><h3>  Navega√ß√£o r√°pida por cap√≠tulo </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pref√°cio</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Preparando um Servidor para Instalar o Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Instale o Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Organizando o armazenamento Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Configurar o acesso √† m√°quina virtual Nextcloud a partir da rede local</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Configura√ß√£o do Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ajuste avan√ßado avan√ßado da Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Prote√ß√£o para Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sincroniza√ß√£o na nuvem do smartphone</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sincroniza√ß√£o em nuvem para computador pessoal</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Posf√°cio</a> <br><br><hr><a name="chap1"></a><br><h3>  Pref√°cio </h3><br>  Ent√£o chegamos exatamente √†quilo em que tudo foi iniciado e para o qual n√£o avan√ßamos rapidamente.  Esta parte descrever√° a instala√ß√£o e alguns pontos na configura√ß√£o do servidor Nextcloud na m√°quina virtual VMWare, al√©m de um pouco de experi√™ncia trabalhando com ele na forma de sincronizar o conte√∫do de um par de smartphones e pastas baseados no Windows em um computador desktop.  As instru√ß√µes de instala√ß√£o a seguir para o Nextcloud indicam que o servi√ßo √© implantado em um servidor criado de acordo com as instru√ß√µes na parte anterior da minha hist√≥ria. <br><br>  Inicialmente, este cap√≠tulo foi planejado para ser pequeno, j√° que eu queria me limitar a apenas descrever a instala√ß√£o e configura√ß√£o do Nextcloud, encerrando essencialmente essa hist√≥ria sobre ‚Äúapenas entrar no Linux para uma tarefa espec√≠fica‚Äù.  Mas, pensando que isso pode parecer interessante para algu√©m, ele decidiu mostrar como eu resolvi o problema de sincronizar as pastas do meu computador dom√©stico, de modo que este cap√≠tulo final fluiu suavemente a partir das instru√ß√µes claras sobre o que e como fazer na programa√ß√£o.  Isso explica alguns ‚Äúvinagretes‚Äù desta parte - come√ßa com o trabalho e as configura√ß√µes no Linux, fluindo para o n√≠vel das configura√ß√µes de rede e software virtual e termina com muletas de planejamento no Windows.  Por outro lado, esta s√©rie de artigos tem o t√≠tulo ‚ÄúHist√≥ria da Cria√ß√£o ...‚Äù e eu decidi contar at√© o final. <br><br>  <b>Nota</b> <br>  Ap√≥s uma leitura mais aprofundada nas constru√ß√µes do formul√°rio http: // 127.0.0.1 (https: // 127.0.0.1), o espa√ßo ap√≥s http: // (https: //) deve ser removido ao entrar na barra de endere√ßos do navegador.  Um espa√ßo foi inserido ao publicar este artigo para impedir que o mecanismo converta automaticamente o texto em links. <br><br><hr><a name="chap2"></a><br><h3>  Preparando um Servidor para Instalar o Nextcloud </h3><br>  O Nextcloud √© um aplicativo da web que possui um conjunto de arquivos e funciona com um determinado banco de dados MySQL.  O aplicativo da Web √© instalado como um site regular, para a instala√ß√£o da qual voc√™ precisa fazer o upload dos arquivos ‚Äúengine‚Äù para o servidor, execute o arquivo de instala√ß√£o e especifique os detalhes de acesso ao banco de dados criado anteriormente para este site durante a instala√ß√£o. <br><br>  Crie um diret√≥rio no qual os arquivos Nextcloud ser√£o colocados: <br>  <b># mkdir / var / www / nextcloud</b> <br><br>  Decidi recusar o HTTP, deixando o acesso apenas via HTTPS.  Para fazer isso, voc√™ precisa configurar o apache. <br><br>  Abra o arquivo: <br>  <b># nano /etc/apache2/sites-available/default-ssl.conf</b> <br>  E antes da tag, adicione o seguinte conte√∫do: <br><br><pre><code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;Directory /var/www/nextcloud&gt;</span></span> <span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">Options</span></span></span></span> FollowSymLinks AllowOverride <span class="hljs-literal"><span class="hljs-literal">All</span></span> Require <span class="hljs-literal"><span class="hljs-literal">all</span></span> granted &lt;/Directory&gt;</code> </pre> <br><br>  Desative a configura√ß√£o HTTP: <br>  <b># a2dissite 000-default.conf</b> <br><br>  Feche a porta 80: <br>  <b># ufw delete allow 80</b> <br><br>  E reinicie o servidor da web: <br>  <b># service apache2 restart</b> <br><br>  Agora voc√™ precisa criar um banco de dados para o nextcloud.  Entramos no mysql digitando a senha do superusu√°rio mysql: <br>  <b># mysql -u root -p</b> <br><br>  Crie um banco de dados chamado nextcloud: <br>  <b>mysql&gt; CREATE DATABASE `nextcloud`;</b> <br><br>  Crie um usu√°rio com o nome nextcloud e a senha trivial nc123: <br>  <b>mysql&gt; CREATE USER 'nextcloud' @ 'localhost' IDENTIFICADO POR 'nc123';</b> <br><br>  Damos acesso total ao usu√°rio nextcloud ao banco de dados nextcloud: <br>  <b>mysql&gt; CONCEDE TODOS OS PRIVIL√âGIOS NO `nextcloud`. * TO 'nextcloud' @ 'localhost';</b> <br><br>  Atualizar tabela de privil√©gios: <br>  <b>mysql&gt; PRIVIL√âGIOS DE FLUSH;</b> <br><br>  Saia do mysql: <br>  <b>mysql: mysql&gt; exit</b> <br><br>  Al√©m disso, voc√™ precisa instalar m√≥dulos adicionais para PHP: <br>  <b># apt-get install curl libcurl3 libcurl3-dev php5-curl</b> <b><br></b>  <b># a2enmod reescrita</b> <br><br>  Na primeira parte desta hist√≥ria, abrimos portas para intera√ß√£o de rede e correio, mas para nosso destino elas n√£o s√£o necess√°rias e √© melhor fech√°-las.  Exclua as regras: <br>  <b># ufw delete allow 138 / udp</b> <b><br></b>  <b># ufw delete allow 139 / udp</b> <b><br></b>  <b># ufw delete allow 139 / tcp</b> <b><br></b>  <b># ufw delete allow 445 / tcp</b> <b><br></b>  <b># ufw delete allow 25</b> <b><br></b>  <b># ufw delete allow 465</b> <b><br></b>  <b># ufw delete allow 110</b> <b><br></b>  <b># ufw delete allow 143</b> <b><br></b>  <b># ufw delete allow 993</b> <br><br><hr><a name="chap3"></a><br><h3>  Instale o Nextcloud </h3><br>  Fa√ßa o download dos arquivos e descompacte-os no diret√≥rio desejado: <br>  <b># wget <a href="" rel="nofollow">download.nextcloud.com/server/releases/nextcloud-11.0.2.tar.bz2</a></b> <b><br></b>  <b># tar xjf nextcloud-11.0.2.tar.bz2 -C / var / www</b> <br><br>  Alterar permiss√µes da pasta: <br>  <b># chmod 755 / var / www / nextcloud</b> <br><br>  E atribu√≠mos ao propriet√°rio desta pasta um servidor web para que n√£o haja problemas ao escrever nela: <br>  <b># chown -R www-data: www-data / var / www / nextcloud</b> <br><br>  Isso √© tudo!  O servi√ßo est√° instalado. Se voc√™ digitar o navegador https: // 127.0.0.1/nextcloud, o assistente de instala√ß√£o ser√° aberto.  Mas vamos esperar com isso, tendo preparado anteriormente um local para armazenar dados do usu√°rio. <br><br>  Vale ressaltar que a vers√£o 11.0.2 do Nextcloud atualmente est√° bastante desatualizada e cont√©m vulnerabilidades que n√£o est√£o presentes nas vers√µes mais recentes e mais recentes; portanto, se voc√™ instalar o ramo 11.x, ser√° melhor instalar uma vers√£o mais recente (no in√≠cio de 2018 - este vers√£o 11.0.7). <br><br><hr><a name="chap4"></a><br><h3>  Organizando o armazenamento Nextcloud </h3><br>  Esta parte √© opcional e pode ser pulada sem problemas - tudo funcionar√° sem ela.  No entanto, se voc√™ criar um diret√≥rio de dados fora da m√°quina virtual, recomendo que voc√™ se familiarize com ele. <br><br>  Por padr√£o, o conte√∫do sincronizado ser√° armazenado no diret√≥rio / var / www / nextcloud / nxcdata.  Esta op√ß√£o n√£o me agradou imediatamente por v√°rios motivos.  Por um lado, eu n√£o gostaria de aumentar constantemente o tamanho do arquivo de um disco virtual.  Por outro lado, gostaria de ter uma solu√ß√£o separada e independente da solu√ß√£o de armazenamento de dados da m√°quina virtual.  A coisa mais simples que vem √† mente imediatamente √© o uso de uma unidade USB.  Se n√£o houver espa√ßo suficiente, a unidade pode ser simplesmente substitu√≠da.  Se necess√°rio, ele pode ser conectado a outro computador e baixar os arquivos necess√°rios.  M√≥vel e conveniente.  No entanto, eu n√£o queria usar o USB 2.0 por causa da largura de banda relativamente pequena para os padr√µes modernos, e n√£o obtive sucesso com o USB 3.0 - o software de virtualiza√ß√£o (WMVare e VirtualBox) n√£o queria encaminhar normalmente dispositivos conectados por um controlador USB 3.0. <br><br>  Meu apetite no processo de cria√ß√£o da nuvem aumentou e eu n√£o tinha mais de um terabyte, ent√£o, no final, decidi conectar um disco r√≠gido comum de dois terabytes √† m√°quina virtual, que j√° estava localizada e conectada dentro do computador.  Se necess√°rio, ele pode ser retirado sem problemas e conectado atrav√©s do adaptador SATA &lt;-&gt; USB 3.0 existente. <br><br>  Portanto, a id√©ia principal √© organizar um ponto permanente para conectar um diret√≥rio ao conte√∫do do usu√°rio fora do diret√≥rio / var / www / nextcloud, no qual um link simb√≥lico chamado nxcdata √© criado, referenciando um diret√≥rio de dados reais que pode ser conectado de v√°rias maneiras em diferentes m√≠dias. <br><br>  Crie um diret√≥rio: <br>  <b># mkdir / mnt / nxcdata</b> <br><br>  Mudamos os direitos: <br>  <b># chmod 770 / mnt / nxcdata</b> <br><br>  Tornamos o propriet√°rio do servidor web: <br>  <b># chown www-data: www-data / mnt / nxcdata</b> <br><br>  Posso colocar os dados em qualquer lugar e em qualquer lugar, o principal √© colocar um link simb√≥lico para esse diret√≥rio no diret√≥rio / mnt / nxcdata e nome√°-lo como nxcdata, ou seja,  o caminho completo ser√° parecido com / mnt / nxcdata / nxcdata. <br><br>  Primeiro, testei a solu√ß√£o para a pasta local que criei no diret√≥rio inicial. <br><br>  Criou uma pasta no lugar certo: <br>  <b>$ mkdir / home / usu√°rio / nxcdata</b> <br><br>  Os direitos foram alterados: <br>  <b># chmod 755 / home / usu√°rio / nxcdata</b> <br><br>  Propriedade do servidor da web: <br>  <b># chown -R www-data: www-data / home / user / nxcdata</b> <br><br>  Criou um link simb√≥lico: <br>  <b># ln -s / home / usu√°rio / nxcdata / mnt / nxcdata / nxcdata</b> <br><br>  Esta solu√ß√£o foi vi√°vel, para que voc√™ possa seguir em frente.  O diret√≥rio de dados externo pode ser conectado de duas maneiras - por meio do servi√ßo VMWare Shared ou diretamente como um disco ou parti√ß√£o f√≠sica.  Deve-se entender que a primeira solu√ß√£o √© poss√≠vel apenas se as ferramentas vmware estiverem instaladas, que s√£o instaladas sem problemas apenas se houver uma interface gr√°fica do sistema operacional (caso contr√°rio, voc√™ precisar√° editar os scripts de instala√ß√£o das ferramentas vmware).  Se abandonarmos a interface gr√°fica, resta apenas a op√ß√£o de conectar a unidade diretamente √† m√°quina virtual, mas com esta solu√ß√£o, tive que sofrer muito.  Depois de algum tempo, ainda encontrei uma vers√£o de trabalho est√°vel, levando em considera√ß√£o que um script universal foi inventado e que incorporava as duas op√ß√µes de conex√£o. <br><br>  Para uma pasta conectada por meio de Pastas compartilhadas do VMWare, na se√ß√£o Pastas compartilhadas das configura√ß√µes da m√°quina virtual, √© necess√°rio conectar a pasta necess√°ria no sistema host e dar o nome de vmw-nxcdata.  Essa pasta pode se referir a algum diret√≥rio no disco r√≠gido ou diretamente ao diret√≥rio raiz de algum disco no sistema host. <br><br>  A pasta montada aparecer√° no sistema virtual automaticamente ao longo do caminho / mnt / hgfs / vmw-nxcdata.  No entanto, o problema √© que o servidor da Web n√£o ter√° direitos suficientes para gravar arquivos nesse caminho e os meios padr√£o do sistema n√£o podem reatribuir os direitos para esse diret√≥rio.  Portanto, eu tive que descobrir como montar manualmente esses recursos. <br><br>  Crie uma pasta: <br>  <b># mkdir / mnt / vmw-nxcdata</b> <br><br>  Montamos usando o m√≥dulo vmhgfs, que foi instalado com o vmware-tools: <br>  <b># mount -t vmhgfs -o uid = www-data, gid = www-data, fmask = 007, dmask = 007 .host: / vmw-nxcdata / mnt / vmw-nxcdata</b> <br><br>  A montagem precisa ser realizada com exatamente esses par√¢metros para uma opera√ß√£o sem problemas do servidor da Web no futuro.  Inicialmente, montei sem especificar uid / gid e m√°scaras, mas n√£o levou a nada de bom, pois n√£o era mais poss√≠vel alterar os direitos ap√≥s a montagem.  Ap√≥s concluir a montagem, ele pode exibir: ‚ÄúN√£o foi poss√≠vel adicionar entrada ao mtab, continuando‚Äù, mas ele ser√° montado e funcionar√°. <br><br>  √ìtimo, montamos o diret√≥rio.  Agora voc√™ pode colocar um link simb√≥lico para esse diret√≥rio em / mnt / nxcdata.  Mas eu n√£o gostaria de fazer isso manualmente sempre que iniciar ou reiniciar o servidor.  A maneira mais f√°cil √© inserir o comando acima no arquivo /etc/rc.local para mont√°-lo na linha "exit 0".  No entanto, eu queria que a desmontagem autom√°tica ocorresse quando a m√°quina virtual fosse desligada para seguran√ßa confi√°vel dos dados.  E eu decidi fazer tudo no n√≠vel de servi√ßo e lidar um pouco com os mecanismos init / update-rc, tanto mais fiquei curioso que acabou sendo bastante interessante. <br><br>  O significado das a√ß√µes a seguir √© criar um servi√ßo do sistema que seria chamado e executar comandos predefinidos quando o sistema for ligado ou desligado.  O servi√ßo √© descrito por um script compilado de acordo com certas regras e est√° localizado em /etc/init.d.  O bloco INIT INFO est√° localizado no in√≠cio do script e cont√©m informa√ß√µes auxiliares nas quais eu gostaria de mencionar as diretivas Default-Start e Default-Stop - elas especificam os n√≠veis de execu√ß√£o nos quais o script deve ser iniciado ou interrompido por padr√£o. <br><br>  N√≠veis de execu√ß√£o: <br><br>  0 - execu√ß√£o de script quando o sistema est√° desligado <br>  1 - execu√ß√£o de script na inicializa√ß√£o do sistema no modo de usu√°rio √∫nico <br>  2 - execu√ß√£o de script na inicializa√ß√£o do sistema no modo multiusu√°rio <br>  3 - 5 - reservado <br>  6 - execu√ß√£o de script na reinicializa√ß√£o do sistema <br><br>  Ap√≥s escrever o script, ele √© ativado usando o mecanismo update-rc, que de fato cria links para o script nos diret√≥rios necess√°rios /etc/rc0.d - /etc/rc6.d, cujo conte√∫do corresponde √†s tarefas executadas pelos n√≠veis de execu√ß√£o.  Os links podem ser criados de forma independente, mas, ao contr√°rio de ativar ou desativar as configura√ß√µes do servidor da web apache, √© necess√°rio levar em considera√ß√£o muitas nuances aqui; portanto, √© necess√°rio ativar ou desativar o servi√ßo atrav√©s do update-rc. <br><br>  Ent√£o, crie um arquivo: <br>  <b># nano /etc/init.d/nxcdata_automount.sh</b> <br><br>  E escreva o seguinte conte√∫do nele: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # nxcdata_automount.sh 1.0 ### BEGIN INIT INFO # Provides: myscript # Required-Start: # Required-Stop: # Default-Start: 1 2 3 4 5 # Default-Stop: 0 6 # Short-Description: nxcdata_automount.sh 1.0 # Description: nxcdata_automount.sh 1.0 ### END INIT INFO . /lib/lsb/init-functions # Start actions perform_start() { log_daemon_msg ¬´Start nxcdata_automount¬ª sleep 30 mount -t vmhgfs -o uid=www-data,gid=www-data,fmask=007,dmask=007 .host:/vmw-nxcdata /mnt/vmw-nxcdata #mount -t ntfs-3g -o uid=www-data,gid=www-data,fmask=007,dmask=007 /dev/sdb1 /mnt/sdb1 #mount -t ext4 /dev/sdb1 /mnt/sdb1 sleep 5 service fail2ban restart log_end_msg 0 return 0 } # Stop actions perform_stop() { log_daemon_msg ¬´Stop nxcdata_automount¬ª umount /mnt/nxcdata log_end_msg 0 return 0 } case $1 in start) perform_start ;; stop) perform_stop ;; *) echo ‚ÄúUsage: /etc/init.d/myscript {start|stop}‚Äù exit 3 ;; esac</span></span></code> </pre><br><br>  Preste aten√ß√£o a algumas equipes comentadas na se√ß√£o perform_start - este √© o nosso fundamento para o futuro.  Al√©m disso, ap√≥s a montagem, o servi√ßo fail2ban √© reiniciado. <br><br>  O paradoxo √© que, depois de um ano, n√£o me lembro mais por que fiz isso, mas duvido muito que tenha sido feito assim.  Obviamente, ap√≥s a montagem do servi√ßo, por algum motivo, o servi√ßo travou ou falhou ao iniciar inicialmente e teve que ser reiniciado manualmente. <br><br>  Ap√≥s essa distra√ß√£o, continuamos a configurar ainda mais.  Crie um link simb√≥lico: <br>  <b># ln -s / mnt / vmw-nxcdata / mnt / nxcdata / nxcdata</b> <br><br>  Tornamos nosso script execut√°vel: <br>  <b># chmod + x /etc/init.d/nxcdata_automount.sh</b> <br><br>  Adicione o script √† inicializa√ß√£o: <br>  <b># update-rc.d padr√µes nxcdata_automount.sh</b> <br><br>  Reiniciamos o sistema e garantimos que a montagem autom√°tica foi bem-sucedida e que tudo esteja acess√≠vel da maneira certa. <br><br>  Para remover o script, voc√™ precisar√° executar alguns comandos: <br>  <b># update-rc.d -f nxcdata_automount.sh remover</b> <b><br></b>  <b># rm -f /etc/init.d/nxcdata_automount.sh</b> <br><br>  No caso de montar uma unidade que n√£o seja atrav√©s das Pastas Compartilhadas do VMWare, voc√™ deve seguir diretamente as mesmas etapas que ao montar atrav√©s das Pastas Compartilhadas do VMWare, mas levando em considera√ß√£o o fato de uma segunda unidade aparecer no sistema.  Como descobrir a letra da unidade? <br><br>  A maioria dos dispositivos de bloco do Linux s√£o conectados via interface SCSI; portanto, na maioria dos casos, os discos come√ßam com as letras sd.  A terceira letra no nome do disco significa seu n√∫mero de s√©rie no sistema e √© indicada em ordem alfab√©tica: sda - o primeiro disco, sdb - o segundo disco, sdc - o terceiro e assim por diante.  Depois, vem o n√∫mero que define o n√∫mero da parti√ß√£o no disco: sda1, sda2 e assim por diante.  A maneira mais f√°cil de ver todas as unidades mapeadas √© examinar o conte√∫do do diret√≥rio / dev / e filtrar os dispositivos sd: <br><br>  <b>$ ls -l / dev / |</b>  <b>grep sd</b> <br><br>  Por exemplo, precisamos conectar uma unidade sdb1 a um sistema de arquivos NTFS. <br><br>  Crie um diret√≥rio e monte o disco nele: <br>  <b># mkdir / mnt / sdb1</b> <b><br></b>  <b># mount -t ext4 / dev / sdb1 / mnt / sdb1</b> <br><br>  Crie um diret√≥rio para os dados, defina os direitos e o usu√°rio para eles: <br>  <b># mkdir / mnt / sdb1 / nxcdata e chmod 770 / mnt / sdb1 / nxcdata e chown -R www-data: www-data / mnt / sdb1 / nxcdata</b> <br><br>  Em seguida, voc√™ tamb√©m precisa criar um script para montagem autom√°tica e ajustar o comando mount no script (exemplos de conex√£o de uma unidade com NTFS e EXT4 j√° est√£o no script e comentados) e incluir o script na inicializa√ß√£o. <br><br>  B crie um link simb√≥lico para o diret√≥rio de dados: <br>  <b># ln -s / mnt / sdb1 / nxcdata / mnt / nxcdata / nxcdata</b> <br><br>  De fato, todo esse problema com um monte de diret√≥rios nxcdata foi projetado para uma coisa: fornecer uma transfer√™ncia simples do diret√≥rio de dados no futuro - voc√™ n√£o precisar√° editar a configura√ß√£o no mecanismo Nextcloud e, geralmente, entrar nele - tudo o que voc√™ precisa fazer √© conectar um novo disco, copiar para dados e recrie um link simb√≥lico que leva a um novo diret√≥rio com dados.  Ao mesmo tempo, todas as a√ß√µes n√£o v√£o al√©m do diret√≥rio / mnt.  Ent√£o tudo se tornou complicado evolutivamente, eu s√≥ n√£o queria perder as solu√ß√µes que tinha. <br><br>  Qual √© a melhor maneira de transferir dados para fora da m√°quina virtual?  Vou compartilhar minha experi√™ncia sobre qual op√ß√£o eu parei e por qu√™. <br><br>  As unidades USB foram capturadas automaticamente quando a m√°quina virtual foi inicializada, correta e totalmente lan√ßada para dentro, e tudo sempre funcionou, mas apenas at√© a unidade ser desconectada do sistema por algum motivo.  Reinicializa√ß√£o ou desconex√£o f√≠sica e conex√£o de um disco ajudado.  A decis√£o acabou n√£o sendo confi√°vel.  N√£o havia esse problema com os pen drives, mas o volume e a velocidade do trabalho categoricamente n√£o eram adequados para mim.  Talvez valesse a pena tentar uma unidade externa com energia aut√¥noma. <br><br>  O encaminhamento de diret√≥rio por meio das pastas compartilhadas do VMWare funcionou de maneira est√°vel e perfeita.  Esta solu√ß√£o satisfez completamente a tarefa de sincronizar dois smartphones.  Tudo funcionou por v√°rios dias, dezenas de gigabytes de dados foram bombeados.  No entanto, quando decidi adicionar dados do computador √† nuvem, repentinamente encontrei um problema com caminhos longos e nomes de arquivos.  Em teoria, o limite de nome de arquivo / pasta NTFS √© de 255 caracteres, mas, na pr√°tica, a API do Windows o limita a 244 caracteres.  Em teoria, o limite do comprimento do caminho para um arquivo ou pasta no NTFS √© de 32.767 caracteres, mas, na pr√°tica, a API do Windows o limita a 245 caracteres.  Dado que sou um grande f√£ de informa√ß√µes estruturantes, o comprimento do meu caminho pode ser muito grande.  O t√≠tulo n√£o abreviado dos livros tamb√©m pode ser facilmente de 100 a 150 caracteres, incluindo espa√ßos.  Essa restri√ß√£o √© um problema conhecido das pastas compartilhadas do VMWare, que n√£o p√¥de ser curado mesmo quando o Windows 10 foi usado com todos os tipos de chaves inteligentes no registro para remover o limite de 255 caracteres.  Um poss√≠vel motivo s√£o as limita√ß√µes do vmhgfs.  Essa maneira conveniente de se conectar teve que ser abandonada.  O motivo foi resolvido com certeza - o problema est√° no sistema de arquivos virtual, usado no mecanismo VMWare Shared Folders. <br><br>  A pr√≥xima solu√ß√£o √© conectar o disco r√≠gido diretamente √† m√°quina virtual.  Tamb√©m n√£o deu certo.  A estrutura de dados (ou sistema de arquivos, e isso era evidente para o NTFS e o EXT2 / 3/4) era constantemente interrompida quando o disco ou sua parti√ß√£o era ‚Äúcapturada‚Äù pelo software da m√°quina virtual ou quando era devolvida ao sistema host, mesmo que eu transferisse o todo Dirija offline no sistema host.  Em alguns modos, n√£o estou gravando ou lendo dados - n√£o conseguia nem formatar adequadamente o disco r√≠gido ou a parti√ß√£o encaminhada.  No entanto, conseguimos encontrar um modo de trabalho: um disco r√≠gido f√≠sico com uma parti√ß√£o, formatada em NTFS, foi conectado √† m√°quina virtual em um determinado modo de conex√£o: SATA / Independente / Persistente / Usar parti√ß√£o individual.  A pasta nxcdata que cont√©m os dados deve estar no disco r√≠gido. <br><br><hr><a name="chap5"></a><br><h3>  Configurar o acesso √† m√°quina virtual Nextcloud a partir da rede local </h3><br>  N√£o temos problemas para abrir sites em uma m√°quina virtual ou em um sistema host.  Mas como abrir o site criado a partir de outro computador na rede local?  Vejamos a estrutura de nossa rede, mostrada abaixo. <br><br><img src="https://habrastorage.org/webt/vt/ge/zt/vtgeztmrqy5y22zje4pgdn-40ro.png"><br><br>  A imagem mostra que o roteador est√° conectado diretamente √† Internet e configurado para distribuir automaticamente os endere√ßos IP aos dispositivos conectados no intervalo 192.168.0.2-192.168.0.254.  O endere√ßo 192.168.0.2 foi recebido pelo nosso computador e 192.168.0.3 - o segundo computador em que fabricamos o servidor.  No entanto, o software de virtualiza√ß√£o √© instalado no segundo computador, que criou seu pr√≥prio roteador virtual e configurou seu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">DHCP</a> na sub-rede 192.168.233.0/24.  Nosso servidor virtual recebeu IP 192.168.133.138. <br><br>  Eu posso abrir facilmente o site dentro da m√°quina virtual 192.168.233.138.  Eu posso abrir o site facilmente da m√°quina 192.168.0.3 simplesmente inserindo o endere√ßo IP desejado no navegador - o software de virtualiza√ß√£o j√° cuidou da configura√ß√£o correta do ambiente de rede na m√°quina host.  Mas como chego ao site a partir do computador 192.168.0.2?  Se eu inserir o endere√ßo IP 192.168.233.138, nada ser√° aberto para mim, pois nem meu computador nem o roteador real sabem alguma coisa sobre essa sub-rede.  Se eu digitar o endere√ßo 192.168.0.3, nada ser√° aberto para mim tamb√©m, j√° que realmente n√£o h√° site neste computador - ele est√° dentro de sua m√°quina virtual. <br><br>  Para resolver esse problema, voc√™ precisa configurar o roteador virtual do computador 192.168.0.3.  J√° sabemos que o acesso aos sites passa pelas portas 80 e 443. Ao acessar essas portas para uma m√°quina 192.168.0.3, precisamos criar roteamento para que as solicita√ß√µes sejam encaminhadas para a m√°quina virtual 192.168.233.138.  Felizmente para isso, temos as ferramentas dispon√≠veis.  O VMWare Workstation possui uma ferramenta do Editor de rede virtual que pode ser aberta no menu da m√°quina virtual (Editar -&gt; Editor de rede virtual). <br><br><img src="https://habrastorage.org/webt/07/-x/ml/07-xmlj7novkph4sr6e0yrmabnw.jpeg"><br><br>  Essa ferramenta permite gerenciar de maneira bastante flex√≠vel as configura√ß√µes de rede.  Precisamos selecionar a placa de rede virtual VMNet8 e clicar no bot√£o "Configura√ß√µes NAT ..." que ficou dispon√≠vel.  Na janela que se abre, voc√™ precisa adicionar regras para criar o roteamento necess√°rio. <br><br><img src="https://habrastorage.org/webt/uc/jh/dp/ucjhdp0cif4azermsxbwfra4v-o.jpeg"><br><br>  Especifique a porta do sistema host e especifique o endere√ßo IP e a porta da m√°quina virtual para a qual as solicita√ß√µes devem ser redirecionadas.  Para encaminhar o tr√°fego HTTPS, voc√™ deve especificar a porta 443 e 443 do sistema host e o endere√ßo da m√°quina virtual 192.168.233.138.  Ap√≥s criar as regras, clique em ‚ÄúOK‚Äù em todas as janelas - o ambiente de rede virtual √© reconfigurado automaticamente. <br><br>  Ap√≥s essas altera√ß√µes, nossos sites come√ßar√£o a abrir a partir da m√°quina 192.168.0.2 ao acessar o endere√ßo 192.168.0.3. <br><br>  Configura√ß√µes semelhantes para encaminhamento de porta est√£o dispon√≠veis n√£o apenas para o VMWare, mas tamb√©m para o VirtualBox (Configura√ß√µes ‚Üí Rede ‚Üí selecione o adaptador necess√°rio ‚Üí Avan√ßado ‚Üí Encaminhamento de porta).  No entanto, durante as experi√™ncias de conex√£o do disco r√≠gido a esse est√°gio, encontrei o VMWare Player gratuito instalado, no qual o Editor de Rede Virtual n√£o estava.  N√£o encontrei nada sobre o encaminhamento de portas para o VMWare Player na Internet e tive que usar uma vers√£o de avalia√ß√£o do VMWare Workstation - ao instalar o produto, ele oferece 30 dias de uso gratuito.  Ap√≥s 30 dias, o produto pode ser removido, limpo e instalado novamente, mas essa aten√ß√£o ao servidor √© de alguma forma redundante e claramente indesej√°vel.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E ent√£o eu fui para um truque pequeno (ou grande). O conjunto de arquivos da Esta√ß√£o de Trabalho VMWare cont√©m o utilit√°rio vmnetcfg, que √© executado basicamente pelo item do Editor de rede virtual. No entanto, ele n√£o estava no conjunto de arquivos do VMWare Player. Mas, ao instalar o VMWare Player, ele de alguma forma configura seu ambiente de rede? Eu peguei esse utilit√°rio e o copiei para a pasta com o VMWare Player e o iniciei. Surpreendentemente, tudo deu certo. √â poss√≠vel que configura√ß√µes de rede finas no ambiente do VMWare Player n√£o funcionem, mas o encaminhamento de porta seja fornecido e n√£o preciso de mais.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para acessar nosso servidor pela Internet, √© necess√°rio encaminhar as portas em um roteador conectado √† Internet da mesma maneira. No firmware da grande maioria dos roteadores, h√° uma se√ß√£o de encaminhamento de porta, na qual voc√™ pode configurar o roteamento especificando a porta externa, a porta e o endere√ßo IP da m√°quina interna. No entanto, h√° uma ligeira nuance. Se o provedor nos fornecer um endere√ßo IP real ou o tivermos comprado dele, n√£o haver√° problemas - se inserirmos esse endere√ßo IP de um computador de qualquer lugar do mundo, o roteador real redirecionar√° o tr√°fego para um computador com uma m√°quina virtual na qual o roteador virtual redirecionar√° o tr√°fego diretamente para o virtual um carro Mas o que fazer com algu√©m que n√£o tem a oportunidade de obter um endere√ßo IP real e ele obt√©m endere√ßos din√¢micos ou est√° atr√°s do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NAT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">provedor, obtendo um endere√ßo IP "cinza"? </font><font style="vertical-align: inherit;">N√£o precisei resolver esse problema, pois tenho um IP "branco" est√°tico. </font><font style="vertical-align: inherit;">Qualquer pessoa que precise resolver esse problema de uma forma ou de outra ter√° que lidar com esse problema. </font><font style="vertical-align: inherit;">Eu recomendaria procurar na dire√ß√£o de dyndns ou freedns.afraid.org no caso de endere√ßos din√¢micos ou comprar um VDS barato para tentar criar algum tipo de roteamento, j√° que, em qualquer caso, sem um servidor externo com um endere√ßo IP est√°tico, esse problema n√£o pode ser resolvido. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depois de configurar o roteamento, consertei os endere√ßos IP dos computadores 192.168.0.3 e 192.168.233.138, escrevendo-os manualmente nas configura√ß√µes da placa de rede dessas m√°quinas para excluir sua reatribui√ß√£o autom√°tica.</font></font><br><br><hr><a name="chap6"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Configura√ß√£o do Nextcloud </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora √© hora de abrir https: // 127.0.0.1/nextcloud no navegador dentro da m√°quina virtual, https: // 192.168.233.138/nextcloud do sistema host ou, com base no roteamento configurado descrito acima, https: // 192.168.0.3/nextcloud de qualquer computador na rede local. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em seguida, configuramos o login / senha do administrador, o acesso ao banco de dados criado anteriormente e, como local de armazenamento, especificamos o caminho completo para o diret√≥rio nxcdata: / mnt / nxcdata / nxcdata. Esta etapa da instala√ß√£o n√£o √© diferente da instala√ß√£o de um site. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nas configura√ß√µes de administrador, fiz as seguintes altera√ß√µes simples: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Pessoal ‚Üí escolheu russo e especifiquei um e-mail para o usu√°rio administrador @ localhost </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Administra√ß√£o ‚Üí Acesso geral ‚Üí desabilitou todos os itens </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Administra√ß√£o ‚Üí Pesquisa de uso ‚Üí desabilitou todos os itens</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Administra√ß√£o ‚Üí Configura√ß√µes avan√ßadas ‚Üí Gerenciamento de arquivos: "Tamanho m√°ximo do arquivo de upload" definido como 25 GB </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Usu√°rios ‚Üí criou o grupo de usu√°rios e adicionou um novo usu√°rio a ele. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√≥s a configura√ß√£o, √© necess√°rio ativar o cache. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra o arquivo: </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># nano /var/www/nextcloud/config/config.php</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E no final, antes de ");" adicione o seguinte: </font><font style="vertical-align: inherit;">Agora voc√™ precisa permitir acesso externo ao site no n√≠vel de seu "mecanismo". </font><font style="vertical-align: inherit;">Abra o arquivo: </font><b><font style="vertical-align: inherit;"># nano /var/www/nextcloud/config/config.php</font></b><font style="vertical-align: inherit;"> Na se√ß√£o </font><b><font style="vertical-align: inherit;">confi√°vel_dom√≠nios</font></b><font style="vertical-align: inherit;"> , voc√™ precisa adicionar o endere√ßo IP do servidor √† matriz, adicione o endere√ßo no qual o Nexcloud est√° instalado. A se√ß√£o confi√°vel_dom√≠nios em nosso caso ter√° a seguinte apar√™ncia:</font></font><br><br> <code>'memcache.local' =&gt; '\OC\Memcache\Memcached', <br> 'memcache.distributed' =&gt; '\OC\Memcache\Memcached', <br> 'memcached_servers' =&gt; array( <br> array('localhost', 11211), <br> ), <br></code> <br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br> <b><font style="vertical-align: inherit;"></font></b> <br><br><font style="vertical-align: inherit;"></font><br><br> <code>'trusted_domains' =&gt; <br> array ( <br> 0 =&gt; '127.0.0.1', <br> 1 =&gt; '192.168.233.138', <br> ), <br></code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora voc√™ pode verificar a capacidade de manuten√ß√£o do servi√ßo - abra o site e fa√ßa login como usu√°rio. Se a autoriza√ß√£o foi bem-sucedida, o servi√ßo est√° pronto para a batalha - voc√™ pode instalar o aplicativo para sincroniza√ß√£o em computadores e smartphones. Para acessar, digite o endere√ßo IP 192.168.0.3 e os detalhes de acesso √† conta criados para cada dispositivo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Felizmente ou infelizmente, eu n√£o precisei usar todo o potencial do servi√ßo criado, pois inicialmente eu precisava de um sistema de backup com verifica√ß√£o e, no come√ßo, eu s√≥ queria continuar com o subversion, mas a velocidade de consolida√ß√£o de um n√∫mero especialmente grande de arquivos pequenos me entristeceu bastante. Fiz tudo para crescer, mas n√£o ia tirar proveito disso e, de alguma forma, ficou completamente fora da nuvem.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma vis√£o geral mais detalhada do uso do servi√ßo foi feita pelo usu√°rio </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wtigga</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no final de 2017 em seu artigo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúComo baixar o VPS: sua‚Äú nuvem ‚Äùdo Nextcloud</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Do ponto de vista do usu√°rio, o artigo fornece uma vis√£o geral do servidor Nextcloud mais recente, vers√£o 12.</font></font><br><br><hr><a name="chap7"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ajuste avan√ßado avan√ßado da Nextcloud </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Durante a opera√ß√£o da nuvem durante o primeiro m√™s de trabalho, surgiram alguns problemas que tive que resolver com a ajuda da comunidade ou por conta pr√≥pria. </font><font style="vertical-align: inherit;">Devo dizer que usei muito o servi√ßo e, de fato, verifiquei a resist√™ncia ao estresse. </font><font style="vertical-align: inherit;">Sincronizar alguns gigabytes de dados de telefones durante a noite e at√© um milh√£o de arquivos pequenos de um computador era algo comum. </font><font style="vertical-align: inherit;">Em geral, o servi√ßo causou uma impress√£o muito positiva em mim.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu n√£o diria que as solu√ß√µes abaixo s√£o corretas e bonitas, mas essas muletas funcionam pelo menos para a vers√£o 11.0.2, caso contr√°rio, seria imposs√≠vel usar o servi√ßo. Na vers√£o 12.x, algo pode ter sido aprimorado e corrigido, portanto, eu n√£o recomendaria definir essas configura√ß√µes imediatamente como parte da configura√ß√£o de inicializa√ß√£o, enquanto que na linha 11.x elas podem ser aplicadas imediatamente. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problema 1</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ocorre um erro como "o arquivo est√° bloqueado" durante a sincroniza√ß√£o. A sincroniza√ß√£o para. O problema √© conhecido - √© necess√°rio limpar o conte√∫do da tabela oc_file_locks executando a seguinte consulta no console do mysql (ao autorizar o usu√°rio do nextcloud): </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; DELETE FROM oc_file_locks WHERE 1</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como esses erros n√£o s√£o incomuns, n√£o </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">criei</font></font></b> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nada melhor do que criar um script e coloc√°-lo diretamente na pasta raiz: </font><b><font style="vertical-align: inherit;"># nano / root / empty_oc_file_locks</font></b></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Conte√∫do do </font><b><font style="vertical-align: inherit;">script</font></b><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash mysql -unextcloud &gt; -pnc123 -D nextcloud &lt;&lt;MY_QUERY DELETE FROM oc_file_locks WHERE 1 MY_QUERY</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O script pode ser executado manualmente, mas esse n√£o √© o nosso m√©todo. </font><font style="vertical-align: inherit;">Decidi execut√°-lo automaticamente a cada 15 minutos usando cron (https://ru.wikipedia.org/wiki/Cron). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para fazer isso, crie um arquivo: </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># nano / root / crontab</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Com o seguinte conte√∫do: </font><font style="vertical-align: inherit;">Agora voc√™ precisa fazer altera√ß√µes no agendador: </font><b><font style="vertical-align: inherit;"># crontab / root / crontab</font></b><font style="vertical-align: inherit;"> Voc√™ pode verificar altera√ß√µes como esta: </font><b><font style="vertical-align: inherit;"># crontab -l </font></b><b><font style="vertical-align: inherit;">Problema 2</font></b><font style="vertical-align: inherit;"> Ao sincronizar via webDAV nos logs (consulte painel de administrador, autorizado pelo administrador), os seguintes erros podem aparecer:</font></font><br><br> <code>*/15 * * * * root bash /root/empty_oc_file_locks <br></code> <br><br><font style="vertical-align: inherit;"></font><br> <b><font style="vertical-align: inherit;"></font></b> <br><br><font style="vertical-align: inherit;"></font><br> <b><font style="vertical-align: inherit;"></font></b> <br><br> <b><font style="vertical-align: inherit;"></font></b> <br><br><font style="vertical-align: inherit;"></font><br><br> <code>Error PHP reset() expects parameter 1 to be array, null given at /var/www/nextcloud/apps/files_versions/lib/Storage.php#783 <br> Error PHP ksort() expects parameter 1 to be array, null given at /var/www/nextcloud/apps/files_versions/lib/Storage.php#782 <br> Error PHP Invalid argument supplied for foreach() at /var/www/nextcloud/apps/files_versions/lib/Storage.php#759 <br> Error PHP Undefined index: by_file at /var/www/nextcloud/apps/files_versions/lib/Storage.php#759 <br> Error PHP Undefined index: all at /var/www/nextcloud/apps/files_versions/lib/Storage.php#757 <br></code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desta vez, a comunidade n√£o fez nada e teve que conduzir a investiga√ß√£o sozinha. O motivo estava no erro "√çndice indefinido ... Storage.php # 757", que causa v√°rios erros em cascata. N√≥s olhamos o c√≥digo para este arquivo. Todo o problema estava na cota. Nesta linha do c√≥digo (Storage.php # 757), o espa√ßo livre √© calculado levando em considera√ß√£o o volume dos arquivos compactados. Algo est√° errado no c√°lculo, embora a cota esteja definida como "ilimitada". Para corrigir o erro no painel de administra√ß√£o, defino uma cota "infinita, mas num√©rica" ‚Äã‚Äãpara cada usu√°rio, por exemplo, 100 TB. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problema 3</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O problema com a sincroniza√ß√£o de arquivos .htaccess - eles simplesmente n√£o s√£o sincronizados! </font><font style="vertical-align: inherit;">E eu n√£o estava sozinho, em alguns f√≥runs eles fizeram perguntas semelhantes. </font><font style="vertical-align: inherit;">No entanto, n√£o encontrei uma solu√ß√£o pronta. </font><font style="vertical-align: inherit;">Eu mesmo tive que pensar novamente. </font><font style="vertical-align: inherit;">Como resultado da pesquisa no Google, exibi√ß√£o de logs e an√°lise de c√≥digo, n√£o pensei em nada melhor do que como corrigir o arquivo do mecanismo nextcloud. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No arquivo /var/www/nextcloud/lib/private/Files/filesystem.php, procuramos a seguinte linha: </font><font style="vertical-align: inherit;">E a trazemos da seguinte forma:</font></font><br><br> <code>$blacklist = \OC::$server-&gt;getConfig()-&gt;getSystemValue('blacklisted_files', array('.htaccess')); <br></code> <br><br><font style="vertical-align: inherit;"></font><br><br> <code>$blacklist = \OC::$server-&gt;getConfig()-&gt;getSystemValue('blacklisted_files', array('')); <br></code> <br><br><hr><a name="chap8"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Prote√ß√£o para Nextcloud </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode proteger nosso servi√ßo da sele√ß√£o de senhas para o painel de administra√ß√£o usando fail2ban. Para fazer isso, √© necess√°rio descrever a express√£o caracter√≠stica que ocorre nos logs da nextcloud quando a autentica√ß√£o falha, de acordo com a qual o acionador correspondente ser√° acionado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crie o arquivo: </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># nano /etc/fail2ban/filter.d/nextcloud.conf</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Com o seguinte conte√∫do: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[Defini√ß√£o] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">failregex = {"reqId": ". *", "RemoteAddr": ". *", "App": " core "," message ":" Falha no login: '. *' \ (IP remoto: '' \) "," level ": 2," time ":". * "} </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ignoreregex = </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra o arquivo: </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># nano / etc /fail2ban/jail.local</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E no final do arquivo, adicione o seguinte: </font><font style="vertical-align: inherit;">Reinicie o servi√ßo: </font><b><font style="vertical-align: inherit;"># service fail2ban restart</font></b><font style="vertical-align: inherit;"> Verifique se h√° um filtro ativo:</font></font><br><br> <code>#       nextcloud <br> [nextcloud] <br> enabled = true <br> port = http,https <br> protocol = tcp <br> filter = nextcloud <br> logpath = /var/log/nextcloud.log <br></code> <br><br><font style="vertical-align: inherit;"></font><br> <b><font style="vertical-align: inherit;"></font></b> <br><br><font style="vertical-align: inherit;"></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># fail2ban-client status nextcloud</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> N√£o se esque√ßa que, de acordo com as configura√ß√µes de fail2ban da parte anterior, se a senha for digitada incorretamente seis vezes seguidas por 12 horas, seu IP ser√° bloqueado por at√© 30 dias. </font><font style="vertical-align: inherit;">De alguma forma, passei duas noites devido a uma senha incorreta em um dos telefones, at√© descobrir esse fato simples nos logs do sistema.</font></font><br><br><hr><a name="chap9"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sincroniza√ß√£o na nuvem do smartphone </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para sincronizar o conte√∫do de telefones com Android, existe um maravilhoso aplicativo FolderSync. O programa justifica totalmente seu pre√ßo baixo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeiro, voc√™ precisa criar uma nova conta na qual especifique https: // 192.168.0.3/nextcloud como o endere√ßo do servidor, insira o login e a senha da conta criada anteriormente e ative o certificado autoassinado. Clique no bot√£o "Testar" e verifique se a conex√£o com o servidor est√° em ordem.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em seguida, voc√™ precisa criar uma tarefa. Na tarefa, especifique a conta criada anteriormente e selecione o tipo de sincroniza√ß√£o - "Para a pasta remota". Especifique a pasta remota (voc√™ pode cri√°-la diretamente do aplicativo "e selecione a pasta local para sincroniza√ß√£o. Defino a programa√ß√£o √†s 2 da manh√£ todos os dias. Nas configura√ß√µes de sincroniza√ß√£o, ativei" Sincroniza√ß√£o de subpastas "e" Sincroniza√ß√£o de pastas inclu√≠das ", tamb√©m selecionei a op√ß√£o de sempre substituir arquivos antigos e, em caso de conflito, permiti usar o arquivo local por padr√£o.Na se√ß√£o "Conex√µes", desliguei todas as conex√µes, exceto o Wi-Fi, e registrei o SSID da minha rede Wi-Fi dom√©stica na se√ß√£o "SSIDs WiFi permitidos" - aplicativo broto S√≥ consigo sincronizar na minha rede dom√©stica e n√£o tentar procurar o servidor em outras redes; deixei o restante das configura√ß√µes por padr√£o.Aqui voc√™ pode adicionar filtragem. Criei um novo filtro, ‚ÄúO nome da pasta cont√©m‚Äù e especifiquei o valor [nosync]. Portanto, posso excluir algumas pastas da pasta local especificada da sincroniza√ß√£o simplesmente adicionando o nome ‚Äú[nosync]‚Äù ao final.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essa configura√ß√£o foi feita para pastas locais como DCIM, Download, Telegram, Viber, WhatsApp. </font><font style="vertical-align: inherit;">Al√©m disso, algumas das minhas pastas de usu√°rios com v√°rios gigabytes de tamanho. </font><font style="vertical-align: inherit;">Uma vez por dia, o conte√∫do dessas pastas √© sincronizado com o servidor, e as vers√µes antigas dos arquivos no servidor n√£o s√£o exclu√≠das, mas s√£o renomeadas e movidas para o arquivo morto. </font><font style="vertical-align: inherit;">Isso me permitiu recuperar rapidamente arquivos exclu√≠dos acidentalmente ou reverter altera√ß√µes em alguns outros arquivos.</font></font><br><br><hr><a name="chap10"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sincroniza√ß√£o em nuvem para computador pessoal </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o me considero um verdadeiro programador. Nos √∫ltimos dez anos, tenho programado em linguagens de programa√ß√£o que s√£o usadas apenas no desenvolvimento de processadores ou chipsets. Como eu n√£o fazia nada em C / C ++ h√° 15 anos, mas precisava automatizar algo no computador, usei ativamente linguagens de script como BAT / CMD ou software como Sign 0f Mistery ou xStarter. Uma vez eu descobri e tentei o que √© o AutoIt e isso se tornou uma nova era na automa√ß√£o do meu PC.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depois de me convencer da estabilidade e confiabilidade do sistema de sincroniza√ß√£o nos smartphones, pensei que seria bom sincronizar dados no meu computador dom√©stico. O Nextcloud possui seu pr√≥prio cliente para Windows e, naturalmente, tornou-se o primeiro candidato a testes. Iria sincronizar um volume de dados da ordem de um terabyte, consistindo em centenas de milhares de arquivos de tamanhos diferentes. Os dados eram diferentes: m√∫sicas, fotos, documentos, livros eletr√¥nicos, distribui√ß√µes, sites de backup e assim por diante. Seria razo√°vel reduzir tudo isso √† sincroniza√ß√£o de dados mais cr√≠ticos, por exemplo, como documentos, mas a emo√ß√£o tomou conta de mim e eu queria verificar a for√ßa do servi√ßo.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dez horas ap√≥s o in√≠cio da sincroniza√ß√£o e, de fato, o primeiro upload de conte√∫do para o servidor, o cliente encontrou um arquivo com um nome longo. Naquela √©poca, no servidor, eu tamb√©m usava a conex√£o de armazenamento externo via VMWare Shared Folders e tinha que tentar uma d√∫zia de clientes e, em seguida, fazer experimentos simples para copiar manualmente os arquivos no servidor, a fim de entender que o problema est√° no lado do servidor. Portanto, depois de uma semana de lan√ßamento bem-sucedido do servi√ßo, tive que reverter para a m√°quina virtual de backup e abandonar o mecanismo de pastas compartilhadas do VMWare, come√ßando tudo de novo. No final, removi esse gargalo no lado do servidor, testei a confiabilidade da solu√ß√£o por uma semana de sincroniza√ß√£o de smartphones e decidi voltar ao meu computador dom√©stico. Dessa vez, o cliente n√£o trope√ßou no arquivo malfadado e eu j√° estava felizno entanto, ap√≥s meio dia de sincroniza√ß√£o de arquivos pequenos, o cliente congelou novamente. Agora, o caminho √© muito longo no lado do computador dom√©stico e o cliente Nextcloud n√£o pode process√°-lo corretamente. Infelizmente, o cliente nativo do Nextcloud n√£o funcionou e seu conte√∫do de informa√ß√µes n√£o era muito alto, ent√£o tive que abandon√°-lo.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Passei algum tempo tentando encontrar um programa conveniente para sincroniza√ß√£o que suporte o gerenciamento de linha de comando. Eu queria fazer minha tarefa para todas as pastas grandes do computador e execut√°-las no modo em lote. Antes, eu j√° havia criado e elaborado um conjunto de arquivos BAT para sincroniza√ß√£o usando scripts e gerenciando o FreeFileSync atrav√©s da linha de comando. O problema de caminhos longos ou nomes de arquivos foi resolvido configurando pastas locais no formato "\\? \ D: \ Info", ou seja, referindo-se essencialmente √† pasta local como uma pasta de rede. No entanto, o que √© o webdav FreeFileSync n√£o sabe. Infelizmente, n√£o havia an√°logos completos do FolderSync para Windows, mas mais de uma vez nos f√≥runs eles recomendaram o GoodSync e, depois de lan√ßar uma d√∫zia de outros programas, decidi experiment√°-lo. Infelizmente, o GoodSync √© muito mais caro,mas um desperd√≠cio √∫nico de US $ 15 para a seguran√ßa de seus preciosos dados, em princ√≠pio, um desperd√≠cio vi√°vel. O programa possui um modo de teste, portanto, primeiro voc√™ pode verificar seu desempenho e estabilidade.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O GoodSync acabou sendo um software bastante amig√°vel. Existe uma vers√£o port√°til especial chamada GoodSync2Go. Ent√£o ela me interessou. Durante a instala√ß√£o, voc√™ precisa selecionar a letra da unidade e o programa √© instalado nela na pasta GoodSync. Criei a pasta Sync no diret√≥rio raiz da unidade, digamos D, e movi a pasta GoodSync criada com todo o conte√∫do. </font></font><br><br> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este texto foi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escrito especificamente para o site </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geektimes.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AlexanderS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O link para a fonte √© opcional, mas sua refer√™ncia √© altamente desej√°vel! ]</font></font></sup> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√≥s a instala√ß√£o, o programa precisa criar tarefas: a pasta local e a pasta remota para sincroniza√ß√£o s√£o indicadas. Nos par√¢metros do trabalho, selecionei a sincroniza√ß√£o da esquerda para a direita com as op√ß√µes "Exclus√£o s√≠ncrona" e "Salvar vers√µes anteriores de arquivos exclu√≠dos / substitu√≠dos". Nas configura√ß√µes do lado esquerdo, selecionei "C√≥pia Segura" e "N√£o crie a pasta _gsdata_", no lado direito - "C√≥pia Segura" e "Pr√©-An√°lise R√°pida por Data e Hora". Assim, s√£o criadas tarefas para cada pasta necess√°ria. Digamos que eu configurei a tarefa na pasta Info e chamei de ‚Äúbck_Info‚Äù. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em seguida, na pasta D: \ Sync, o arquivo bck_Info.bat √© criado com o seguinte conte√∫do:</font></font><br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0 @%dir%GoodSync\GoodSync2Go-v10.exe /miniwin /<span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> sync <span class="hljs-string"><span class="hljs-string">"%~n0"</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essa √© a linguagem de script BAT. Na primeira linha de c√≥digo, o caminho atual para o script em execu√ß√£o √© definido como a vari√°vel A segunda linha inicia o arquivo GoodSync2Go-v10.exe da pasta GoodSync nesse caminho, no qual a tarefa com o nome desse arquivo deve ser executada (bck_Info), a janela de execu√ß√£o da tarefa √© minimizada e o programa deve fechar automaticamente ap√≥s a conclus√£o da tarefa. Posso copiar esse script v√°rias vezes, alterando apenas seu nome para o nome de uma tarefa criada anteriormente no GoodSync. Assim, apenas clicando no bot√£o Enter no arquivo BAT, posso iniciar a sincroniza√ß√£o das pastas necess√°rias individualmente.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para adicionar uma nova tarefa no FreeFileSync, basta copiar o arquivo de script xml e corrigi-lo manualmente, ou seja, </font><font style="vertical-align: inherit;">executar o shell gr√°fico do programa n√£o era necess√°rio. </font><font style="vertical-align: inherit;">No GoodSync, todas as tarefas s√£o registradas no arquivo D: \ Sync \ GoodSync \ GoodSync \ Profile \ jobs.tic e para adicionar uma nova tarefa, voc√™ precisar√° abrir o programa e cri√°-lo, porque </font><font style="vertical-align: inherit;">editar este arquivo √© um tanto problem√°tico e n√£o se sabe o que isso pode levar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para sincronizar todas as pastas, agora voc√™ pode escrever um script bck_all.bat simples:</font></font><br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0 call %dir%bck_Info.bat call %dir%bck_Info2.bat call %dir%bck_Info3.bat call %dir%bck_Info4.bat</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cada linha do script simplesmente causa a execu√ß√£o de um script separado, que inicia a sincroniza√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tudo isso funciona muito bem e convenientemente, mas n√£o h√° controle de erros durante a sincroniza√ß√£o. Por exemplo, se o servidor n√£o estiver ligado, todas as tarefas ser√£o conclu√≠das rapidamente, e eu, depois de uma hora depois, pensarei que a sincroniza√ß√£o j√° foi conclu√≠da. Ao mesmo tempo, os logs de todas as tarefas s√£o criados no caminho D: \ Sync \ GoodSync \ GoodSync \ Profile \ *. Log. Basta observar o log de cada sincroniza√ß√£o para a presen√ßa da palavra "ERRO" - por algum motivo, √© assim que as falhas de sincroniza√ß√£o s√£o relatadas no log. Portanto, decidiu-se escrever um pequeno programa para analisar esses logs ap√≥s todas as sincroniza√ß√µes, que deve ser iniciado automaticamente ap√≥s a sincroniza√ß√£o de todas as pastas. O programa recebeu o nome orgulhoso log_analayser e est√° escrito na linguagem de semi-script </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoIt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Se algu√©m estiver interessado, fa√ßa o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">download da vers√£o completa</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode acessar o site oficial da AutoIt, que cont√©m as bibliotecas necess√°rias, o compilador e o SciTE - um editor de plataforma cruzada para o c√≥digo a partir do qual voc√™ pode compilar o programa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quanto tempo gastei no desenvolvimento e depura√ß√£o do c√≥digo, o resultado foi um arquivo log_analayser.au3 com o seguinte conte√∫do:</font></font><br><br><pre> <code class="plaintext hljs">; LOG Analyser 1.0 ;      - #Region ;**** Directives created by AutoIt3Wrapper_GUI **** #AutoIt3Wrapper_Res_Field=ProductName|LOG Analyser #AutoIt3Wrapper_Res_Fileversion=1.0.0.0 #AutoIt3Wrapper_Res_Field=OriginalFilename|log_analyser.exe #AutoIt3Wrapper_Res_Comment=     - #AutoIt3Wrapper_Res_Description= - ;**** #AutoIt3Wrapper_Res_Language=1049 #AutoIt3Wrapper_Res_ProductVersion=1.0 #AutoIt3Wrapper_Compile_Both=y #EndRegion ;**** Directives created by AutoIt3Wrapper_GUI **** ;AutoItSetOption ("WinTitleMatchMode", 2) ;       ;#NoTrayIcon ;         If WinExists('[CLASS:AutoIt v3;TITLE:' &amp; @ScriptName &amp; ']') Then MsgBox(48, @ScriptName, "     !"); ;             ;WinActivate('  ') Exit EndIf AutoItWinSetTitle(@ScriptName) #include &lt;Array.au3&gt; #include &lt;_FileDirList.au3&gt; ;  Local $msg_title = "LOG Analyser 1.0" Local $path = @ScriptDir Local $soft_open_log = "notepad.exe" Local $path, $dir_mode, $word, $file_analyse_name, $file_analyse_ext, $log_path, $log_msg_on Local $file_log, $word_detect, $file_analyse, $cnt_files, $i ;    if ($CmdLine[0] &lt; 6) then MsgBox(0x10, $msg_title, "   !" &amp; @CRLF &amp; @CRLF &amp; "  ") Exit else if (StringCompare($CmdLine[1], "file") = 0) then $dir_mode = 0 elseif (StringCompare($CmdLine[1], "dir") = 0) then $dir_mode = 1 else MsgBox(0x10, $msg_title, "     'file'  'dir'!" &amp; @CRLF &amp; @CRLF &amp; "  ") Exit endif $word = $CmdLine[2] if ($dir_mode = 0) then $file_analyse_name = $CmdLine[3] else $dir_analyse = $CmdLine[3] endif $file_analyse_ext = $CmdLine[4] $log_path = $CmdLine[5] if (StringCompare($CmdLine[6], "err_msg_on") = 0) then $log_msg_on = 1 elseif (StringCompare($CmdLine[6], "err_msg_off") = 0) then $log_msg_on = 0 else MsgBox(0x10, $msg_title, "     'log_msg_on'  'log_msg_off'!" &amp; @CRLF &amp; @CRLF &amp; "  ") Exit endif endIf ;   $file_log = $log_path &amp; "\" &amp; "log_analyser" &amp; "-" &amp; @YEAR &amp; "-" &amp; @MON &amp; "-" &amp; @MDAY &amp; "-" &amp; @HOUR &amp; "-" &amp; @MIN &amp; "-" &amp; @SEC &amp; ".log" $word_detect = 0 ;    if ($dir_mode = 0) then $file_analyse = $file_analyse_name &amp; "." &amp; $file_analyse_ext if (_file_analyser($file_analyse, $msg_title, $word, $file_log, $word_detect) = 1) then $word_detect = 1 endif else ;     $dir_arr = _FileDirList($dir_analyse, "*."&amp;$file_analyse_ext, 1, 1, 0) ;_ArrayDisplay($dir_arr) ;    -       if ($dir_arr = 0) then MsgBox(0x10, $msg_title, "       !" &amp; @CRLF &amp; @CRLF &amp; "  ") Exit endif $cnt_files = $dir_arr[0] ;    $i = 0 While $i &lt;&gt; $cnt_files $i = $i + 1 $file_analyse = $dir_arr[$i] if (_file_analyser($file_analyse, $msg_title, $word, $file_log, $word_detect) = 1) then $word_detect = 1 endif WEnd endif ;    if ($word_detect = 1) and ($log_msg_on = 1) then if (MsgBox (0x41034, $msg_title, " !" &amp; @CRLF &amp; "      : " &amp; $file_log &amp; @CRLF &amp; @CRLF &amp; "   ?")) = 6 then ShellExecuteWait($soft_open_log, $file_log) endif endif Exit ;                    ;   ,   ,     Func _file_analyser($file_analyse, $msg_title, $word, $file_log, $word_detect) Local $file1, $file2, $file_line, $write_once $word_detect = 0 $write_once = 0 $file1 = FileOpen($file_analyse, 0) ;     If $file1 = -1 Then FileClose($file1) MsgBox(0x10, $msg_title, "   !" &amp; @CRLF &amp; @CRLF &amp; "  ") Exit EndIf ;       While 1 $file_line = FileReadLine($file1) If @error = -1 Then ExitLoop if (StringInStr($file_line, $word) &lt;&gt; 0) then $word_detect = 1 ;            if (FileExists($file_log) = 0) then $file2 = FileOpen($file_log, 1) FileClose($file2) endif ;        if ($write_once = 0) then $write_once = 1 $file2 = FileOpen($file_log, 1) FileWriteLine($file2, " : " &amp; $file_analyse) FileClose($file2) endif ;       $file2 = FileOpen($file_log, 1) FileWriteLine($file2, $file_line) FileClose($file2) endif WEnd ;     ,          if ($word_detect = 1) then $file2 = FileOpen($file_log, 1) FileWriteLine($file2, @CRLF) FileClose($file2) endif FileClose($file1) Return $word_detect EndFunc</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√≥s digitar o c√≥digo, pressione o bot√£o F7 no editor SciTE e obtenha o arquivo log_analayser.exe na sa√≠da. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O programa analisa o arquivo quanto √† presen√ßa de uma palavra, quando encontrada, um arquivo de log √© criado, no qual a linha encontrada que cont√©m essa palavra √© copiada. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O programa pode funcionar de dois modos: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- an√°lise de um arquivo espec√≠fico </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- an√°lise da pasta que cont√©m os arquivos para an√°lise (todas as subpastas tamb√©m s√£o analisadas) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando voc√™ faz uma chamada de console, precisa definir seis par√¢metros para o programa: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 - modo de opera√ß√£o [arquivo = an√°lise de arquivo; dir = an√°lise da pasta que cont√©m os arquivos] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 - pesquisa por palavra-chave </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 - nome do arquivo ou caminho completo para a pasta </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 - extens√£o ou arquivos para an√°lise na pasta</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 - o caminho completo para a pasta onde o log do programa estar√° localizado; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6 - exibi√ß√£o da janela ap√≥s an√°lise de todos os arquivos no caso de encontrar a palavra especificada [err_msg_on = display; </font><font style="vertical-align: inherit;">err_msg_off = n√£o exibir] </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assim, recebemos um novo script bck_auto.bat:</font></font><br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Start Backup @<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0 call %dir%bck_all.bat log_analyser.exe dir  %dir%GoodSync\Profile <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> %dir%LOG err_msg_on <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O script inicia um arquivo a partir do qual as tarefas para sincronizar todas as pastas necess√°rias s√£o chamadas individualmente uma ap√≥s a outra e, em seguida, o analisador de log de sincroniza√ß√£o √© chamado, ap√≥s o qual, em caso de erros, uma mensagem √© exibida solicitando que voc√™ observe as linhas de log onde esses erros s√£o encontrados e voc√™ pode entender qual tarefa ocorreram problemas. </font><font style="vertical-align: inherit;">Essas linhas s√£o gravadas em um arquivo de log separado na pasta D: \ Sync \ LOG.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E ent√£o eu sofri um fracasso terr√≠vel. O Log Analyzer n√£o funcionou. N√£o, funcionou muito bem nos arquivos de teste, mas teimosamente n√£o queria ver erros nos logs. Durante muito tempo, n√£o consegui entender qual era o motivo at√© descobrir uma coisa terr√≠vel: n√£o apenas no registro em ingl√™s, a falha √© exibida pela √∫nica palavra em russo ‚ÄúERROR‚Äù, mas tamb√©m a codifica√ß√£o desse alfabeto cir√≠lico √© o Macintosh! N√£o sei por que os programadores da Siber Systems fizeram isso; provavelmente √© o resultado de uma muleta terr√≠vel dentro do software. Bem, quem disse que a programa√ß√£o deve ser chata? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o havia escolha a n√£o ser apoiar uma muleta com outra e, como resultado, apareceu uma constru√ß√£o de trabalho:</font></font><br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Start Backup @<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0 call %dir%bck_all.bat log_analyser.exe dir –ãÀú‚Ç¨–É–â–Ç %dir%GoodSync\Profile <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> %dir%LOG err_msg_on <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, o seguinte problema apareceu: GoodSync em si n√£o exclui arquivos de log, novos arquivos aparecem a cada nova execu√ß√£o de tarefa. </font><font style="vertical-align: inherit;">E se algum tipo de sincroniza√ß√£o falhar, nosso analisador sempre encontrar√° esse arquivo e informar√° com alegria o erro. </font><font style="vertical-align: inherit;">Portanto, antes de iniciar a sincroniza√ß√£o, foi decidido limpar automaticamente a pasta D: \ Sync de qualquer arquivo de log. </font><font style="vertical-align: inherit;">Um script clean_logs.bat elegante foi criado para isso:</font></font><br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0 For /R %dir% %%i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (*.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>) Do ( Del /q <span class="hljs-string"><span class="hljs-string">"%%i"</span></span>) @<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> on</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O script desativa a sa√≠da de qualquer mensagem, descobre o diret√≥rio de inicializa√ß√£o do script, verifica todos os arquivos (incluindo subpastas) at√© que eles terminem e exclui todos os arquivos com a extens√£o de log. </font><font style="vertical-align: inherit;">No final do trabalho, a sa√≠da da mensagem √© ativada. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O script bck_auto.bat foi alterado:</font></font><br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Start Backup @<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0 @call clean_logs.bat call %dir%bck_all.bat log_analyser.exe dir –ãÀú‚Ç¨–É–â–Ç %dir%GoodSync\Profile <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> %dir%LOG err_msg_on <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tudo funciona muito bem, mas o objetivo √© automatizar a√ß√µes de rotina. </font><font style="vertical-align: inherit;">Por que n√£o desligar o computador √† noite e dormir, e ele pr√≥prio sincroniza v√°rios arquivos, analisa e desativa o caminho? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos modificar nosso script bck_auto.bat:</font></font><br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Start Backup &amp; PCOFF @<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0 start MonitorOnOff.exe 0 @call clean_logs.bat call %dir%bck_all.bat log_analyser.exe dir –ãÀú‚Ç¨–É–â–Ç %dir%GoodSync\Profile <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> %dir%LOG err_msg_off shutdown /s /t 0 <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Duas novas linhas apareceram no script. </font><font style="vertical-align: inherit;">O aplicativo MonitorOnOff simplesmente desliga o monitor (para que n√£o ilumine a sala, mas deslig√°-lo manualmente todas as noites e lig√°-lo todas as manh√£s √© muito pregui√ßoso) e o comando shutdown desliga o computador. </font><font style="vertical-align: inherit;">O par√¢metro respons√°vel por exibir as mensagens quando um erro foi encontrado foi alterado no log_analyser, porque ap√≥s a sincroniza√ß√£o, n√£o √© necess√°rio retardar a execu√ß√£o do script por esta mensagem, mas permitir que ele desligue o computador. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MonitorOnOff tamb√©m √© escrito em AutoIt.</font></font><br><br><pre> <code class="plaintext hljs">; Monitor On Off 1.0 ;   /  #Region ;**** Directives created by AutoIt3Wrapper_GUI **** #AutoIt3Wrapper_Res_Field=ProductName|Monitor On Off #AutoIt3Wrapper_Res_Fileversion=1.0.0.0 #AutoIt3Wrapper_Res_Field=OriginalFilename|MonitorOnOff.exe #AutoIt3Wrapper_Res_Comment=  /  #AutoIt3Wrapper_Res_Description=  /  ;**** #AutoIt3Wrapper_Res_Language=1049 #AutoIt3Wrapper_Res_ProductVersion=1.0 #AutoIt3Wrapper_Compile_Both=y #EndRegion ;**** Directives created by AutoIt3Wrapper_GUI **** ;AutoItSetOption ("WinTitleMatchMode", 2) ;       ;#NoTrayIcon ;         If WinExists('[CLASS:AutoIt v3;TITLE:' &amp; @ScriptName &amp; ']') Then MsgBox(48, @ScriptName, "     !"); ;             ;WinActivate('  ') Exit EndIf AutoItWinSetTitle(@ScriptName) HotKeySet("{F10}", "_Monitor_ON") HotKeySet("{F11}", "_Monitor_OFF") HotKeySet("{Esc}", "_Quit") Global Const $lciWM_SYSCommand = 274 Global Const $lciSC_MonitorPower = 61808 Global Const $lciPower_Off = 2 Global Const $lciPower_On = -1 Global $MonitorIsOff = False if ($CmdLine[0] &lt;&gt; 0) then _Monitor_OFF() endif While 1 Sleep(10) WEnd Func _Monitor_ON() $MonitorIsOff = False Local $Progman_hwnd = WinGetHandle('[CLASS:Progman]') DllCall('user32.dll', 'int', 'SendMessage', _ 'hwnd', $Progman_hwnd, _ 'int', $lciWM_SYSCommand, _ 'int', $lciSC_MonitorPower, _ 'int', $lciPower_On) EndFunc Func _Monitor_OFF() $MonitorIsOff = True Local $Progman_hwnd = WinGetHandle('[CLASS:Progman]') While $MonitorIsOff = True DllCall('user32.dll', 'int', 'SendMessage', _ 'hwnd', $Progman_hwnd, _ 'int', $lciWM_SYSCommand, _ 'int', $lciSC_MonitorPower, _ 'int', $lciPower_Off) _IdleWaitCommit(0) Sleep(20) WEnd EndFunc Func _IdleWaitCommit($idlesec) Local $iSave, $LastInputInfo = DllStructCreate ("uint;dword") DllStructSetData ($LastInputInfo, 1, DllStructGetSize ($LastInputInfo)) DllCall ("user32.dll", "int", "GetLastInputInfo", "ptr", DllStructGetPtr ($LastInputInfo)) Do $iSave = DllStructGetData ($LastInputInfo, 2) Sleep(60) DllCall ("user32.dll", "int", "GetLastInputInfo", "ptr", DllStructGetPtr ($LastInputInfo)) Until (DllStructGetData ($LastInputInfo, 2)-$iSave) &gt; $idlesec Or $MonitorIsOff = False Return DllStructGetData ($LastInputInfo, 2)-$iSave EndFunc Func _Quit() _Monitor_ON() Exit EndFunc</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O programa iniciado √© controlado por tr√™s teclas: F10 liga o monitor, F11 - desliga e o bot√£o ESC finaliza o programa e o descarrega da mem√≥ria. Se voc√™ especificar qualquer par√¢metro ao iniciar o programa, o programa em execu√ß√£o desligar√° imediatamente a tela.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora estava tudo bem - antes de ir para a cama, executei o bck_all.bat, em vez de "Desligue o computador" e fui para a cama. O monitor n√£o iluminou a sala inteira, a sincroniza√ß√£o foi realizada automaticamente e seu sucesso foi analisado automaticamente. De manh√£, basta olhar o conte√∫do da pasta D: \ Sync \ GoodSync \ LOG \ para pelo menos alguns arquivos. Mas tamb√©m n√£o √© esse o caso - por que perder tempo se est√° tudo bem? Preciso fazer um analisador de logs e pendur√°-lo na inicializa√ß√£o do sistema para que funcione no dia seguinte quando o computador inicializar e preocupe minha aten√ß√£o apenas quando a sincroniza√ß√£o falhar. Foi assim que o programa check_file_exist surgiu.</font></font><br><br><pre> <code class="plaintext hljs">; Check File Exist 1.0 ;        #Region ;**** Directives created by AutoIt3Wrapper_GUI **** #AutoIt3Wrapper_Res_Field=ProductName|Check File Exist #AutoIt3Wrapper_Res_Fileversion=1.0.0.0 #AutoIt3Wrapper_Res_Field=OriginalFilename|check_file_exist.exe #AutoIt3Wrapper_Res_Comment=       #AutoIt3Wrapper_Res_Description=   ;**** #AutoIt3Wrapper_Res_Language=1049 #AutoIt3Wrapper_Res_ProductVersion=1.0 #AutoIt3Wrapper_Compile_Both=y #EndRegion ;**** Directives created by AutoIt3Wrapper_GUI **** ;AutoItSetOption ("WinTitleMatchMode", 2) ;       ;#NoTrayIcon ;         If WinExists('[CLASS:AutoIt v3;TITLE:' &amp; @ScriptName &amp; ']') Then MsgBox(48, @ScriptName, "     !"); ;             ;WinActivate('  ') Exit EndIf AutoItWinSetTitle(@ScriptName) #include &lt;Array.au3&gt; #include &lt;_FileDirList.au3&gt; ;  Local $msg_title = "Check File Exist 1.0" Local $path = @ScriptDir Local $soft_open_dir = "explorer.exe" Local $path, $dir_analyse, $words, $msg_open ;    if ($CmdLine[0] &lt; 5) then MsgBox(0x10, $msg_title, "   !" &amp; @CRLF &amp; @CRLF &amp; "  ") Exit else $dir_analyse = $CmdLine[1] $file = $CmdLine[2] $words0 = $CmdLine[3] $words1 = $CmdLine[4] if (StringCompare($CmdLine[5], "msg_on") = 0) then $msg_open = 1 elseif (StringCompare($CmdLine[5], "msg_off") = 0) then $msg_open = 0 else MsgBox(0x10, $msg_title, "     'msg_on'  'msg_off'!" &amp; @CRLF &amp; @CRLF &amp; "  ") Exit endif endIf ;      $dir_arr = _FileDirList($dir_analyse, "*"&amp;$file&amp;"*", 1, 0, 0) ;_ArrayDisplay($dir_arr) ;      if ($dir_arr = 0) then if (StringCompare($words0, "0") &lt;&gt; 0) then if ($msg_open = 0) then MsgBox(0x41030, $msg_title, $words0) else if (MsgBox(0x41034, $msg_title, $words0 &amp; @CRLF &amp; @CRLF &amp; "     ?")) = 6 then ShellExecuteWait($soft_open_dir, $dir_analyse) endif endif endif else if (StringCompare($words1, "0") &lt;&gt; 0) then if ($msg_open = 0) then MsgBox(0x41030, $msg_title, $words1) else if (MsgBox(0x41034, $msg_title, $words1 &amp; @CRLF &amp; @CRLF &amp; "    ?")) = 6 then ShellExecuteWait($soft_open_dir, $dir_analyse) endif endif endif endif Exit</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essencialmente, este programa √© uma funcionalidade log_analyser ligeiramente truncada. O programa analisa a pasta especificada (excluindo subpastas) em busca de arquivos e nomes que correspondam pelo menos parcialmente √† palavra de pesquisa especificada e exibe uma mensagem sobre o resultado da verifica√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par√¢metros do programa: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 - o caminho completo para a pasta (sem o caractere de barra - /) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 - a palavra-chave para pesquisar nomes de arquivos ou o nome completo do arquivo </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 - sequ√™ncia de texto exibida quando o arquivo n√£o for encontrado, se = 0 - n√£o exibir a mensagem </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 - texto a linha exibida quando o arquivo for encontrado, se = 0 - n√£o exibir uma mensagem</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 - sa√≠da da mensagem: msg_off - apenas uma mensagem sobre a presen√ßa / aus√™ncia de arquivos √© exibida, msg_on - na janela exibida, tamb√©m √© proposto abrir a pasta na qual os arquivos s√£o detectados ou n√£o encontrados </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora, para este programa, criei o script Check_LOG_from_log_analyser.bat, cujo link eu coloquei no habitual Inicializa√ß√£o do Windows:</font></font><br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0LOG start check_file_exist.exe %dir% .<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> 0 <span class="hljs-string"><span class="hljs-string">"     !"</span></span> msg_on <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assim, na final, obtivemos uma solu√ß√£o completamente aut√¥noma que n√£o depende da localiza√ß√£o da pasta Sync e funcionar√° corretamente de qualquer lugar do nosso computador. </font><font style="vertical-align: inherit;">A solu√ß√£o n√£o √© apenas vi√°vel, mas tamb√©m est√°vel - no Windows 7 x64, esse conjunto de scripts funcionou por um ano e n√£o houve absolutamente nenhum problema.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Talvez agora tudo isso pare√ßa um tanto monstruoso, mas n√£o h√° nada de complicado nisso. </font><font style="vertical-align: inherit;">Se voc√™ olhar atentamente para o c√≥digo AutoIt, a constru√ß√£o b√°sica s√£o os loops habituais do tipo se-ent√£o-outro-fim para qualquer linguagem de programa√ß√£o, na qual s√£o aprendidos alguns operadores e fun√ß√µes repetitivas do AutoIt, aprendidos literalmente em algumas noites. </font><font style="vertical-align: inherit;">A linguagem de script BAT nem pode ser ensinada, pois a maioria das solu√ß√µes √© padr√£o e h√° muito tempo √© descrita na Internet. </font><font style="vertical-align: inherit;">Ser capaz de usar a programa√ß√£o n√£o √© apenas interessante, mas pode ser muito √∫til.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ode ao c√≥digo de Dark Dragon</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/mt/oe/bi/mtoebi7ufvsfmzqjs52tihnxwiy.jpeg"><br></div></div><br><hr><a name="chap11"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Posf√°cio </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para ser sincero, presumi, mas n√£o esperava um volume t√£o grande de artigos, que precisei gastar at√© cinquenta horas. Como regra, a instala√ß√£o da sua nuvem na Internet √© reduzida a dizeres como: "Sim, voc√™ precisa executar v√°rios comandos l√°". √â verdade - a instala√ß√£o √© trivial. Quando voc√™ sabe quais comandos entrar no console e o que eles significam. Quando voc√™ entende a ess√™ncia do roteamento na rede. Quando voc√™ j√° possui um servidor em funcionamento e quando entende como adicionar um host a ele. Quando voc√™ sabe como configurar um site. Ou seja, para aplicar esses v√°rios comandos, voc√™ precisa ter uma certa quantidade de conhecimento e experi√™ncia. O objetivo desses tr√™s artigos √© uma tentativa de criar essa bagagem coletando as informa√ß√µes suficientes necess√°rias em um s√≥ lugar e explicando como us√°-las corretamente. Eu sinceramente esperoque esta s√©rie de artigos ajudar√° algu√©m a dar os primeiros passos conscientes no mundo do software livre.</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retorne </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ao in√≠cio, ao √≠ndice</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A hist√≥ria da cria√ß√£o de uma nuvem dom√©stica. </font><font style="vertical-align: inherit;">Parte 3. Criando uma nuvem pessoal - instalando e configurando o Nextcloud. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vers√£o em texto: 1.2.1. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data da primeira publica√ß√£o: 02/08/2018. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√öltima edi√ß√£o: 15/01/2020.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atualizar log</font></font></b> <div class="spoiler_text"> 1.2.1 [15-01-2020] <br>  . <br><br> 1.2.0 [08-02-2018] <br>  . <br><br> 1.1.0 [08-02-2018] <br>  . <br><br> 1.0.0 [08-02-2018] <br>  . <br>     Nextcloud 11.0.2    VMWare,    VMWare     ,     Nextcloud. <br></div></div><br><hr><a name="bug"></a><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Informa√ß√µes para a administra√ß√£o do recurso (bug suspeito)</font></font></b> <div class="spoiler_text">   -  (, code  blockquote) <b>  </b>   : <br><blockquote> [Definition] <br> failregex={¬´reqId¬ª:".*",¬´remoteAddr¬ª:".*",¬´app¬ª:¬´core¬ª,¬´message¬ª:¬´Login failed: '.*' \(Remote IP: ''\)¬ª,¬´level¬ª:2,¬´time¬ª:".*"} <br> ignoreregex = <br></blockquote><br>          !       , ..      .    (/)  ‚Äî    .  : <br> ‚Äî   <br> ‚Äî          <br> ‚Äî  ,   ¬´  Nextcloud¬ª   , ,  <br> ‚Äî  ,         <br><br></div></div><br><hr></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt410011/">https://habr.com/ru/post/pt410011/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt410001/index.html">Como a percep√ß√£o humana do espa√ßo se desenvolveu e por que precisamos de medidas</a></li>
<li><a href="../pt410003/index.html">Resultados da pesquisa: Pirataria ajuda a melhorar as vendas para muitos artistas</a></li>
<li><a href="../pt410005/index.html">Espremer a eletricidade</a></li>
<li><a href="../pt410007/index.html">Distr. Revis√£o de programas √∫teis com atraso de 16 anos</a></li>
<li><a href="../pt410009/index.html">A seguran√ßa pessoal do blockchain √© perigos pessoais?</a></li>
<li><a href="../pt410013/index.html">8 regras de comunica√ß√£o em um ambiente multil√≠ngue: instru√ß√µes para funcion√°rios de empresas internacionais</a></li>
<li><a href="../pt410017/index.html">UNICEF incentiva jogadores a extrair transmiss√£o para crian√ßas s√≠rias</a></li>
<li><a href="../pt410019/index.html">O que voc√™ precisa saber sobre os olhos das crian√ßas</a></li>
<li><a href="../pt410023/index.html">Revis√£o do multifuncional Dell Precision 5720: poderoso multifuncional tudo em um</a></li>
<li><a href="../pt410025/index.html">O que mudar√° em SSD e RAM em 2018 - os novos Kingston e HyperX</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>