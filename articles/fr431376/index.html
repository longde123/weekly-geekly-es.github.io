<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêÑ üë®üèΩ‚Äç‚úàÔ∏è ‚úñÔ∏è Migration des donn√©es dans l'entreprise sanglante: quoi analyser pour ne pas submerger le projet üßóüèø üéé üîé</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Un projet d'int√©gration de syst√®me typique pour nous ressemble √† ceci: le client a un chariot de syst√®mes pour les clients comptables, la t√¢che consis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Migration des donn√©es dans l'entreprise sanglante: quoi analyser pour ne pas submerger le projet</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/hflabs/blog/431376/"><img src="https://habrastorage.org/webt/yk/_w/ry/yk_wry8j7irc6ma2zn65mdw0ulq.jpeg"><br><br>  Un projet d'int√©gration de syst√®me typique pour nous ressemble √† ceci: le client a un chariot de syst√®mes pour les clients comptables, la t√¢che consiste √† collecter les cartes client dans une base de donn√©es unique.  Et non seulement pour collecter, mais aussi pour √©liminer les doublons et les ordures.  Pour obtenir des cartes clients propres, structur√©es et compl√®tes. <br><br>  Pour les d√©butants, je vais expliquer que la migration se d√©roule selon ce sch√©ma: <i>sources ‚Üí conversion de donn√©es (r√©ponses <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ETL</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bus</a> ) ‚Üí r√©cepteur</i> . <br><br>  Sur un projet, nous avons perdu trois mois simplement parce qu'une √©quipe tierce d'int√©grateurs n'a pas √©tudi√© les donn√©es dans les syst√®mes sources.  Le plus ennuyeux √©tait que cela aurait pu √™tre √©vit√©. <br><a name="habracut"></a><br>  Ils ont travaill√© comme ceci: <br><br><ol><li>  Les int√©grateurs syst√®me personnalisent le processus ETL. </li><li>  ETL transforme les donn√©es source et me les donne. </li><li>  J'√©tudie le d√©chargement et envoie des erreurs aux int√©grateurs. </li><li>  Les int√©grateurs corrigent les ETL et recommencent la migration. </li></ol><br>  Dans l'article, je montrerai comment analyser les donn√©es lors de l'int√©gration du syst√®me.  J'ai √©tudi√© les t√©l√©chargements ETL, c'√©tait tr√®s utile.  Mais sur les donn√©es source, les m√™mes techniques acc√©l√©reraient le travail deux fois. <br><br>  Les conseils seront utiles aux testeurs, aux d√©veloppeurs de produits d'entreprise, aux int√©grateurs de syst√®mes et aux analystes.  Les r√©ceptions sont universelles pour les bases de donn√©es relationnelles et sont enti√®rement divulgu√©es sur les volumes d'un million de clients. <br><br>  Mais d'abord, sur l'un des principaux mythes de l'int√©gration du syst√®me. <br><br><h2>  La documentation et l'architecte vous aideront (en fait pas) </h2><br>  Les int√©grateurs n'√©tudient souvent pas les donn√©es avant la migration - ils gagnent du temps.  Ils lisent la documentation, regardent la structure, parlent avec l'architecte - et cela suffit.  Apr√®s cela, ils planifient d√©j√† l'int√©gration. <br><br>  √áa tourne mal.  Seule l'analyse montrera ce qui se passe r√©ellement dans la base de donn√©es.  Si vous n'entrez pas dans les donn√©es avec des manches retrouss√©es et une loupe, la migration ira de travers. <br><br>  <b>La documentation ment.</b>  Un syst√®me d'entreprise typique fonctionne de 5 √† 20 ans.  Pendant toutes ces ann√©es, des changements ont √©t√© document√©s par divers services et entrepreneurs.  Chacun avec son propre clocher.  Par cons√©quent, il n'y a aucune int√©grit√© dans la documentation, personne ne comprend parfaitement la logique et la structure du stockage des donn√©es.  Sans oublier que les d√©lais sont toujours respect√©s et qu'il n'y a pas assez de temps pour la documentation. <br><br>  Une histoire commune: dans la table client il y a un champ "SNILS", sur papier c'est tr√®s important.  Mais quand je regarde les donn√©es, je vois - le champ est vide.  En cons√©quence, le client accepte que la base cible se passe d'un champ pour SNILS, car il n'y a toujours pas de donn√©es. <br><br>  Un cas particulier de la documentation est la r√©glementation et la description des processus m√©tier: comment les donn√©es entrent dans la base de donn√©es, dans quelles circonstances, sous quel format.  Tout cela n'aidera pas non plus. <br><br>  <b>Les processus commerciaux ne sont parfaits que sur papier.</b>  Au petit matin, l'op√©rateur endormi Anatoly entre dans le bureau de la banque √† la p√©riph√©rie de Vyksa.  Sous la fen√™tre, ils ont cri√© toute la nuit et le matin, Anatoly s'est disput√© avec la fille.  Il d√©teste le monde entier. <br><br>  Les nerfs n'ont pas encore √©t√© mis en ordre et Anatoly conduit enti√®rement le nom du nouveau client dans le champ du nom de famille.  Il oublie compl√®tement son anniversaire - le "01.01.1900 g" par d√©faut reste dans le formulaire.  Je m'en fous des r√®gles quand tout autour est si enrageant !!! <br><br>  Le chaos conquiert les processus m√©tiers, tr√®s bien proportionn√©s sur le papier. <br><br>  <b>Un architecte syst√®me ne sait pas tout.</b>  Il s'agit encore une fois de la v√©n√©rable dur√©e de vie des syst√®mes d'entreprise.  Au fil des ann√©es o√π ils travaillent, les architectes ont chang√©.  M√™me si vous parlez avec l'actuel, les d√©cisions des pr√©c√©dentes seront surprenantes pendant le projet. <br><br>  Et soyez s√ªr: m√™me un architecte agr√©able √† tous √©gards gardera secrets sa fakapy et ses b√©quilles du syst√®me. <br><br>  L'int√©gration "par instruments" sans analyse des donn√©es est une erreur.  Je vais montrer comment nous, chez HFLabs, apprenons les donn√©es gr√¢ce √† l'int√©gration du syst√®me.  Dans le dernier projet, je n'ai analys√© que les t√©l√©chargements ETL.  Mais lorsque le client donne acc√®s aux donn√©es sources, je les v√©rifie d√©finitivement selon les m√™mes principes. <br><br><h2>  Champs remplis et valeurs nulles </h2><br>  Les v√©rifications les plus simples concernent l'exhaustivit√© des tableaux dans leur ensemble et l'exhaustivit√© des champs individuels.  Je commence par eux. <br><br>  <b>Le nombre total de lignes dans le tableau.</b>  La demande la plus simple possible. <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt;;</code> </pre> <br>  J'obtiens le premier r√©sultat. <br><div class="scrollable-table"><table><tbody><tr><th>  Les particuliers </th><th>  La quantit√© </th></tr><tr><td>  Total </td><td>  99 966 324 </td></tr></tbody></table></div>  Ici, je regarde l'ad√©quation des donn√©es.  Si seulement deux millions de clients sont venus au d√©chargement d'une grande banque, alors quelque chose ne va clairement pas.  Mais alors que tout semble comme pr√©vu, on continue. <br><br>  <b>Combien de lignes sont remplies pour chaque champ s√©par√©ment.</b>  Je v√©rifie toutes les colonnes du tableau. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> &lt;column_name&gt;, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> &lt;column_name&gt; cnt <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> &lt;column_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>;</code> </pre> <br>  Le premier est tomb√© sur un champ de joyeux anniversaire, et imm√©diatement curieux: pour une raison quelconque, les donn√©es ne sont pas venues du tout. <br><div class="scrollable-table"><table><tbody><tr><th>  Les particuliers </th><th>  La quantit√© </th></tr><tr><td>  Total </td><td>  99 966 324 </td></tr><tr><td>  DR </td><td>  0 </td></tr></tbody></table></div>  Si toutes les valeurs du champ sont ¬´NULL¬ª dans le t√©l√©chargement, la premi√®re chose que je regarde est le syst√®me source.  Peut-√™tre que les donn√©es y sont stock√©es correctement, mais elles ont √©t√© perdues lors de la migration. <br><br>  Je vois que dans le syst√®me source, les anniversaires sont en place.  Je vais chez les int√©grateurs: les gars, erreur.  Il s'est av√©r√© que dans le processus ETL, la fonction de d√©codage ne fonctionnait pas correctement.  Le code a √©t√© corrig√©, lors du prochain t√©l√©chargement, nous v√©rifierons les modifications. <br><br>  Je vais plus loin sur le terrain avec le TIN. <br><div class="scrollable-table"><table><tbody><tr><th>  Les particuliers </th><th>  La quantit√© </th></tr><tr><td>  Total </td><td>  99 966 324 </td></tr><tr><td>  DR </td><td>  0 </td></tr><tr><td>  TIN </td><td>  65 136 </td></tr></tbody></table></div>  Il y a 100 millions de personnes dans la base de donn√©es, et seulement 65 000 sont remplies de NIF - c'est 0,07%.  Une occupation aussi faible indique que le champ dans la base du r√©cepteur peut ne pas √™tre n√©cessaire du tout. <br><br>  Je v√©rifie le syst√®me source, tout est correct: les TIN sont similaires aux vrais, mais il n'y en a presque pas.  Donc, ce n'est pas une question de migration.  Il reste √† savoir si le client a besoin d'un champ presque vide sous le TIN dans la base de donn√©es cible. <br><br>  Je suis arriv√© au drapeau de suppression du client. <br><div class="scrollable-table"><table><tbody><tr><th>  Les particuliers </th><th>  La quantit√© </th></tr><tr><td>  Total </td><td>  99 966 324 </td></tr><tr><td>  DR </td><td>  0 </td></tr><tr><td>  TIN </td><td>  65 136 </td></tr><tr><td>  Supprimer le drapeau </td><td>  0 </td></tr></tbody></table></div>  Les drapeaux sont vides.  Mais quoi, l'entreprise n'enl√®ve pas de clients?  Je regarde le syst√®me source, je parle avec le client.  Il s'av√®re que oui: le drapeau est formel, au lieu de supprimer des clients, leurs comptes sont supprim√©s.  Aucun compte - comme si le client avait √©t√© supprim√©. <br><br>  Dans le syst√®me cible, l'indicateur client distant est requis, il s'agit d'une caract√©ristique de l'architecture.  Ainsi, si le client n'a aucun compte dans le syst√®me r√©cepteur, il doit √™tre ferm√© via une logique suppl√©mentaire ou pas du tout import√©.  Ensuite, comment le client d√©cide. <br><br>  Ensuite, la plaque d'adresse.  Habituellement, quelque chose ne va pas avec ces tables, car les adresses sont une chose compliqu√©e, elles sont entr√©es de diff√©rentes mani√®res. <br><br>  Je v√©rifie l'exhaustivit√© des √©l√©ments de l'adresse. <br><div class="scrollable-table"><table><tbody><tr><th>  Adresses </th><th>  La quantit√© </th></tr><tr><td>  Total </td><td>  254 803 976 </td></tr><tr><td>  Pays </td><td>  229 256 090 </td></tr><tr><td>  Index </td><td>  46 834 777 </td></tr><tr><td>  Ville </td><td>  6 474 841 </td></tr><tr><td>  Rue </td><td>  894,040 </td></tr><tr><td>  Maison </td><td>  20 903 </td></tr></tbody></table></div>  Les adresses ne sont pas uniform√©ment renseign√©es, mais il est trop t√¥t pour tirer des conclusions: je vais d'abord demander au client √† quoi il sert.  Si pour la segmentation par pays, tout va bien: il y a suffisamment de donn√©es.  Si pour les listes de diffusion, le probl√®me est: les maisons sont presque vides, il n'y a pas d'appartements. <br><br>  En cons√©quence, le client a vu que l'ETL prenait des adresses d'une tablette ancienne et non pertinente.  Elle est √† la base comme un monument.  Mais il y a un autre tableau, nouveau et bon, les donn√©es doivent en √™tre tir√©es. <br><br>  Lors de l'analyse, je remplis les champs li√©s aux r√©pertoires avec particularit√©.  La condition ¬´IS NOT NULL¬ª ne fonctionne pas avec eux: au lieu de ¬´NULL¬ª, la cellule est g√©n√©ralement ¬´0¬ª.  Par cons√©quent, v√©rifiez les champs de r√©f√©rence s√©par√©ment. <br><br>  <b>Changements dans le remplissage des champs.</b>  J'ai donc v√©rifi√© l'occupation globale et l'occupation de chaque champ.  Probl√®mes d√©tect√©s, les int√©grateurs ont corrig√© le processus ETL et ont recommenc√© la migration. <br><br>  J'ex√©cute le deuxi√®me d√©chargement pour toutes les √©tapes √©num√©r√©es ci-dessus.  J'√©cris des statistiques dans le m√™me fichier pour voir les changements. <br><br>  Exhaustivit√© de tous les domaines. <br><div class="scrollable-table"><table><tbody><tr><th>  Les particuliers </th><th>  D√©charger 1 </th><th>  D√©chargement 2 </th><th>  Delta </th></tr><tr><td>  Total </td><td>  99 966 324 </td><td>  94 847 160 </td><td>  -5 119 164 </td></tr></tbody></table></div>  Entre les t√©l√©chargements, 5 millions d'enregistrements ont disparu.  Je vais chez les int√©grateurs, pose des questions typiques: <br><br><ul><li>  ¬´Pourquoi les records ont-ils √©t√© perdus?¬ª; </li><li>  "Quelles donn√©es ont √©t√© √©limin√©es?"; </li><li>  "Quelles donn√©es avez-vous laiss√©es?" </li></ul><br>  Il s'av√®re qu'il n'y a pas de probl√®me: ils ont simplement retir√© les clients ¬´techniques¬ª du nouveau d√©chargement.  Ils sont dans la base de donn√©es pour les tests, ce ne sont pas des personnes vivantes.  Mais avec la m√™me probabilit√©, les donn√©es pourraient √™tre perdues par erreur, cela se produit. <br><br>  Mais les anniversaires du nouveau d√©chargement sont apparus, comme je m'y attendais. <br><div class="scrollable-table"><table><tbody><tr><th>  Les particuliers </th><th>  D√©charger 1 </th><th>  D√©chargement 2 </th><th>  Delta </th></tr><tr><td>  Total </td><td>  99 966 324 </td><td>  94 847 160 </td><td>  -5 119 164 </td></tr><tr><td>  DR </td><td>  0 </td><td>  77 046 780 </td><td>  77 046 780 </td></tr></tbody></table></div>  Mais!  Pas n√©cessairement bon lorsque des donn√©es pr√©c√©demment manquantes sont soudainement apparues dans un nouveau t√©l√©chargement.  Par exemple, les anniversaires peuvent √™tre remplis de dates par d√©faut - il n'y a rien √† se r√©jouir.  Par cons√©quent, je v√©rifie toujours les donn√©es fournies. <br><br>  <i>Quoi v√©rifier, en un mot.</i> <i><br><br></i> <ol><li>  <i>Nombre total d'entr√©es dans les tableaux.</i>  <i>Cette quantit√© est-elle adapt√©e aux attentes?</i> </li><li>  <i>Le nombre de lignes remplies dans chaque champ.</i> </li><li>  <i>Rapport entre le nombre de lignes remplies dans chaque champ et le nombre de lignes de la table.</i>  <i>S'il est trop petit, c'est l'occasion de r√©fl√©chir √† la possibilit√© de faire glisser le champ vers la base cible.</i> </li></ol> <i><br></i>  <i>R√©p√©tez les trois premi√®res √©tapes pour chaque t√©l√©chargement.</i>  <i>Suivez la dynamique: o√π et pourquoi elle a augment√© ou diminu√©.</i> <br><br><h2>  Longueur des valeurs dans les champs de cha√Æne </h2><br>  Je respecte l'une des r√®gles de base des tests - je v√©rifie les valeurs limites. <br><br>  <b>Quelles valeurs sont trop courtes.</b>  Parmi les valeurs les plus courtes, il y a plein d'ordure, il est donc int√©ressant de creuser ici. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LENGTH</span></span>(&lt;column_name&gt;) &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>;</code> </pre> <br>  De cette fa√ßon, je v√©rifie le nom, le num√©ro de t√©l√©phone, le TIN, OKVED, les adresses de site Web.  Un non-sens appara√Æt comme "A * 1", "0", "11", "-" et "...". <br><br>  <b>Est-ce que tout va bien avec des valeurs maximales.</b>  Le champ de fermeture est un marqueur du fait que les donn√©es ne correspondaient pas pendant le transfert, et elles ont √©t√© automatiquement coup√©es.  MySQL le craque sans avertissement.  Dans le m√™me temps, il semble que la migration se soit bien d√©roul√©e. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LENGTH</span></span>(&lt;column_name&gt;) = <span class="hljs-number"><span class="hljs-number">65</span></span>;</code> </pre> <br>  De cette fa√ßon, j'ai trouv√© sur le terrain avec le type de document la ligne "Certificat d'enregistrement de la demande de reconnaissance de l'immigrant pour lui".  Elle a dit aux int√©grateurs que la longueur du champ a √©t√© corrig√©e. <br><br>  <b>Comment les valeurs sont r√©parties sur la longueur.</b>  Dans HFLabs, nous appelons la table de distribution de longueur pour les lignes. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LENGTH</span></span>(&lt;column_name&gt;), <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(&lt;column_name&gt;) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LENGTH</span></span>(&lt;column_name&gt;);</code> </pre> <br>  Ici je cherche des anomalies dans la distribution le long de la longueur.  Par exemple, voici une fr√©quence pour une table avec des adresses postales. <br><div class="scrollable-table"><table><tbody><tr><th>  La longueur </th><th>  La quantit√© </th></tr><tr><td>  122 </td><td>  120 </td></tr><tr><td>  123 </td><td>  90 </td></tr><tr><td>  124 </td><td>  130 </td></tr><tr><td>  125 </td><td>  1100 </td></tr><tr><td>  126 </td><td>  70 </td></tr></tbody></table></div>  Les valeurs d'une longueur de 125 sont trop nombreuses.  Je regarde la base de donn√©es source et constate que pour une raison quelconque, certaines adresses ont √©t√© coup√©es √† 125 caract√®res il y a trois ans.  Les autres ann√©es, tout va bien.  Je vais avec ce probl√®me au client et aux int√©grateurs, nous comprenons. <br><br>  <i>Quoi v√©rifier, en un mot.</i> <i><br><br></i> <ol><li>  <i>Les valeurs les plus courtes dans les champs de cha√Æne.</i>  <i>Souvent, les lignes de moins de trois caract√®res sont des ordures.</i> </li><li>  <i>Valeurs qui ¬´butent¬ª sur la longueur de la largeur du champ.</i>  <i>Ils sont souvent circoncis.</i> </li><li>  <i>Anomalies dans la distribution des rang√©es sur la longueur.</i> </li></ol><br><h2>  Valeurs populaires </h2><br>  Je divise en trois cat√©gories les valeurs qui tombent dans le top populaire: <br><br><ul><li>  <i>vraiment commun</i> , comme le nom "Tatyana" ou le deuxi√®me pr√©nom "Vladimirovitch".  Ici, il faut se rappeler que dans le cas g√©n√©ral, Tatiana ne devrait pas √™tre 100 fois plus populaire qu'Anna, et Ismail ne peut gu√®re √™tre plus populaire qu'Egor; </li><li>  <i>ordures</i> , comme ".", "1", "-" et similaires; </li><li>  <i>par d√©faut</i> sur le formulaire de saisie, comme "01/01/1900" pour les dates. </li></ul><br>  Deux cas sur trois sont des marqueurs du probl√®me, il est utile de les rechercher. <br><br>  Je recherche des valeurs populaires dans trois types de champs: <br><br><ol><li>  Champs de cha√Æne ordinaires. </li><li>  Champs de cha√Æne de r√©f√©rence.  Ce sont des champs de cha√Æne ordinaires, mais le nombre de valeurs diff√©rentes en eux est bien s√ªr r√©glement√©.  Ces champs stockent les pays, les villes, les mois et les types de t√©l√©phone. </li><li>  Champs de classificateur - ils contiennent un lien vers une entr√©e dans une table de classificateur tiers. </li></ol><br>  J'√©tudie les domaines de chacun de ces types un peu diff√©remment. <br><br>  <b>Pour les champs de cha√Æne - quelles sont les 100 premi√®res valeurs populaires.</b>  Si vous le souhaitez, vous pouvez en prendre plus, mais dans les cent premi√®res valeurs, toutes les anomalies sont g√©n√©ralement plac√©es. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> &lt;column_name&gt;, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) cnt <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> &lt;column_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROWNUM</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">100</span></span>;</code> </pre> <br>  Je v√©rifie les champs de cette fa√ßon: <br><br><ul><li>  Nom complet, ainsi que les noms de famille, pr√©noms et patronyme s√©par√©ment; </li><li>  les dates de naissance et g√©n√©ralement toutes les dates; </li><li>  adresses  L'adresse compl√®te et ses composants individuels, s'ils sont stock√©s dans la base de donn√©es; </li><li>  T√©l√©phones </li><li>  s√©rie, num√©ro, type, lieu de d√©livrance des documents. </li></ul><br>  Presque toujours parmi les valeurs populaires de test et par d√©faut, certains talons. <br><br><img src="https://habrastorage.org/webt/hl/sg/cr/hlsgcrpcy9y1i-gpyfoead8byzg.png"><br><br>  Il arrive que le probl√®me trouv√© ne soit pas du tout un probl√®me.  Une fois, j'ai trouv√© un num√©ro de t√©l√©phone √©trangement populaire dans la base de donn√©es.  Il s'est av√©r√© que les clients ont indiqu√© ce nombre en tant que travailleur, et dans la base de donn√©es, il y avait simplement beaucoup d'employ√©s d'une m√™me organisation. <br><br>  En cours de route, une telle analyse affichera des champs de r√©f√©rence cach√©s.  Logiquement, ces champs ne sont pas cens√©s √™tre des r√©pertoires, mais en fait ils se trouvent dans la base de donn√©es.  Par exemple, je s√©lectionne des valeurs populaires dans le champ "Position", et il n'y en a que cinq. <br><div class="scrollable-table"><table><tbody><tr><th>  Titre du poste </th></tr><tr><td>  R√©alisateur </td></tr><tr><td>  Comptable </td></tr><tr><td>  Sp√©cialiste </td></tr><tr><td>  Secr√©taire </td></tr><tr><td>  Administrateur syst√®me </td></tr></tbody></table></div>  L'entreprise ne sert peut-√™tre que cinq professions.  Pas tr√®s vrai, non?  Au contraire, dans le formulaire pour les op√©rateurs, au lieu d'une ligne, ils ont cr√©√© un r√©pertoire et oubli√© de vider les valeurs.  La question importante ici est la suivante: est-il sage de remplir des messages via l'annuaire?  Ainsi, gr√¢ce √† l'analyse des donn√©es, je m'attaque √† d'√©ventuels probl√®mes avec le logiciel op√©rateur. <br><br>  <b>Pour les champs de r√©f√©rence et les classificateurs, je v√©rifie la popularit√© de toutes les valeurs.</b>  Pour commencer, je d√©termine quels champs sont des r√©pertoires.  Vous ne pouvez pas vous en tirer avec les scripts, je prends la documentation et je fais semblant.  En r√®gle g√©n√©rale, les r√©pertoires sont cr√©√©s pour les valeurs, dont le nombre est bien s√ªr et relativement petit: <br><br><ul><li>  les pays </li><li>  langues </li><li>  devises </li><li>  mois </li><li>  la ville. </li></ul><br>  Dans un monde id√©al, le contenu des champs de r√©f√©rence est clair et coh√©rent.  Mais notre monde n'est pas comme √ßa, donc je v√©rifie avec une demande. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> &lt;column_name&gt;, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) cnt <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> &lt;column_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>;</code> </pre> <br>  Habituellement, dans les champs de cha√Æne des r√©pertoires se trouve ceci. <br><div class="scrollable-table"><table><tbody><tr><th>  Lieu de naissance </th><th>  La quantit√© </th></tr><tr><td>  le tadjikistan </td><td>  467 599 </td></tr><tr><td>  Tadjikistan </td><td>  410 484 </td></tr><tr><td>  La russie </td><td>  292,585 </td></tr><tr><td>  TAJIKISTAN </td><td>  234 465 </td></tr><tr><td>  La russie </td><td>  158 163 </td></tr><tr><td>  RUSSIE </td><td>  76 367 </td></tr></tbody></table></div>  Probl√®mes courants: <br><br><ul><li>  fautes de frappe; </li><li>  les espaces </li><li>  cas diff√©rent. </li></ul><br>  Apr√®s avoir trouv√© un g√¢chis, je vais chez les int√©grateurs avec des exemples sous la main.  Laissez-les laisser les ordures √† la source et √©liminez les √©carts.  Ensuite, dans la base de donn√©es cible pour la rigueur, il sera possible de transformer les lignes de r√©f√©rence en classificateurs. <br><br>  Je v√©rifie les valeurs populaires dans les champs du classificateur pour d√©tecter le manque d'options.  Face √† de tels cas. <br><div class="scrollable-table"><table><tbody><tr><th>  Sexe </th><th>  Type de t√©l√©phone </th></tr><tr><td><ol><li>  Femme </li><li>  Non d√©fini </li></ol></td><td><ol><li>  Accueil </li></ol></td></tr></tbody></table></div>  Ces classificateurs semblent tr√®s √©tranges, ils doivent √™tre montr√©s au client.  Chaque fois que j'ai eu une erreur derri√®re de tels cas: soit quelque chose ne va pas dans la base de donn√©es, soit les donn√©es ont √©t√© t√©l√©charg√©es au mauvais endroit. <br><br>  <i>Quoi v√©rifier, en un mot.</i> <i><br><br></i> <ol><li>  <i>Quels champs de cha√Æne sont des r√©f√©rences et lesquels ne le sont pas.</i> </li><li>  <i>Pour les champs de cha√Æne simples, les principales valeurs populaires.</i>  <i>Habituellement dans la poubelle sup√©rieure et les donn√©es par d√©faut.</i> </li><li>  <i>Pour les champs de r√©f√©rence de cha√Æne, la distribution de toutes les valeurs par popularit√©.</i>  <i>La s√©lection affichera des √©carts dans les valeurs de r√©f√©rence.</i> </li><li>  <i>Pour les classificateurs - y a-t-il suffisamment d'options dans la base de donn√©es.</i> </li></ol><br><h2>  Coh√©rence et r√©conciliation crois√©e </h2><br>  De l'analyse des donn√©es √† l'int√©rieur des tableaux, je passe √† l'analyse des relations. <br><br>  <b>Si les donn√©es sont li√©es ou non.</b>  Nous appelons ce param√®tre ¬´coh√©rence¬ª.  Je prends la table des subordonn√©s, par exemple, avec les t√©l√©phones.  Pour cela dans un couple - la table parentale des clients.  Et je vois combien de clients dans la table subordonn√©e sont des identifiants qui ne sont pas dans le parent. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> &lt;ID1&gt; <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name_1&gt;) <span class="hljs-keyword"><span class="hljs-keyword">MINUS</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> &lt;ID2&gt; <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name_2&gt;));</code> </pre> <br>  Si la demande a donn√© un delta, cela signifie pas de chance - il y a des donn√©es non li√©es dans le t√©l√©chargement.  Je v√©rifie donc les tables avec les t√©l√©phones, les contrats, les adresses, les factures, etc.  Une fois, lors d'un projet, elle a trouv√© 23 millions de num√©ros simplement suspendus dans l'air. <br><br>  Cela fonctionne √©galement dans la direction oppos√©e - je recherche des clients qui, pour une raison quelconque, n'ont pas un seul contrat, adresse, num√©ro de t√©l√©phone.  Parfois, c'est normal - eh bien, le client n'a pas d'adresse, qu'est-ce qui ne va pas.  Ici, vous devez vous renseigner aupr√®s du client, la documentation sera facilement trompeuse. <br><br>  <b>Y a-t-il des duplications de cl√©s primaires dans diff√©rentes tables.</b>  Parfois, des entit√©s identiques sont stock√©es dans des tables diff√©rentes.  Par exemple, les clients h√©t√©rosexuels.  (Personne ne sait pourquoi, car Brejnev a toujours revendiqu√© la structure.) Mais la table dans le r√©cepteur est unique et lors de la migration, les identifiants des clients entreront en conflit. <br><br>  Je tourne la t√™te et regarde la structure de la base: o√π la fragmentation d'entit√©s similaires est possible.  Il peut s'agir de tableaux de clients, de t√©l√©phones de contact, de passeports, etc. <br><br>  S'il y a plusieurs tables avec des entit√©s similaires, je fais un recoupement: je v√©rifie l'intersection des identifiants.  Intersection - collez un patch.  Par exemple, nous collectons des identifiants pour une seule table selon le sch√©ma ¬´nom de la table source + ID¬ª. <br><br>  <i>Quoi v√©rifier, en un mot.</i> <i><br><br></i> <ol><li>  <i>Combien de donn√©es non li√©es se trouvent dans des tables li√©es.</i> </li><li>  <i>Existe-t-il des conflits potentiels de cl√© primaire?</i> </li></ol><br><h2>  Quoi d'autre √† v√©rifier </h2><br>  <b>Y a-t-il des caract√®res latins auxquels ils n'appartiennent pas.</b>  Par exemple, dans les noms de famille. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> &lt;column_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REGEXP_LIKE</span></span>(&lt;column_name&gt;, <span class="hljs-string"><span class="hljs-string">'[AZ]'</span></span>, <span class="hljs-string"><span class="hljs-string">'i'</span></span>);</code> </pre> <br>  J'attrape donc la merveilleuse lettre latine "C", qui co√Øncide avec le cyrillique.  L'erreur est d√©sagr√©able, car selon le nom avec le latin "C" l'op√©rateur ne trouvera jamais de client. <br><br>  <b>Y a-t-il des caract√®res √©trangers dans les champs de cha√Æne destin√©s aux nombres?</b> <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> &lt;column_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REGEXP_LIKE</span></span>(&lt;column_name&gt;, <span class="hljs-string"><span class="hljs-string">'[^0-9]'</span></span>);</code> </pre> <br>  Des probl√®mes apparaissent dans les champs avec le num√©ro de passeport de la F√©d√©ration de Russie ou du TIN.  Les t√©l√©phones sont les m√™mes, mais l√† j'autorise plus, les crochets et les tirets.  La demande r√©v√©lera √©galement la lettre ¬´O¬ª, qui a √©t√© d√©finie au lieu de z√©ro. <br><br>  <b>Les donn√©es sont-elles ad√©quates?</b>  On ne sait jamais d'o√π viendra le probl√®me, donc je suis toujours sur mes gardes.  J'ai rencontr√© de tels cas: <br><br><ul><li>  <i>"Sofya Vladimirovna" est-elle un client de 50 000 t√©l√©phones? Est-ce normal?</i>  R√©ponse: pas normal.  Le client est technique, ils lui ont mis des num√©ros de t√©l√©phone ¬´sans propri√©taire¬ª pour faire des sms-mailings.  Il n'est pas n√©cessaire de tirer le client vers une nouvelle base; </li><li>  <i>Les NIF sont remplis, en fait, la colonne contient ¬´79853617764¬ª, ¬´89109462345¬ª, ¬´4956780966¬ª et ainsi de suite.</i>  Quel genre de t√©l√©phones, okuda?  O√π est l'auberge?  R√©ponse: quel type de chiffres - on ne sait pas qui l'a mis - n'est pas clair.  Personne ne les utilise.  Le TIN actuel est stock√© dans un autre champ d'une autre table, extrait de l√†; </li><li>  <i>le champ ¬´adresse sur une ligne¬ª ne correspond pas aux champs dans lesquels l'adresse est stock√©e en partie.</i>  Pourquoi les adresses sont-elles diff√©rentes?  R√©ponse: une fois que les op√©rateurs ont rempli les adresses avec une seule ligne, et le syst√®me externe a tri√© les adresses dans des champs s√©par√©s.  Pour la segmentation.  Au fil du temps, les gens ont chang√© d'adresse.  Les op√©rateurs les ont r√©guli√®rement mis √† jour, mais uniquement sous forme de cha√Æne: l'adresse est rest√©e ancienne en partie. </li></ul><br><h2>  Tout ce dont vous avez besoin est SQL et Excel </h2><br>  Pour analyser les donn√©es, aucun logiciel co√ªteux n'est n√©cessaire.  Assez bon vieux Excel et connaissance de SQL. <br><br>  Excel que j'utilise pour compiler une longue requ√™te.  Par exemple, je v√©rifie que les champs sont complets et il y en a 140 dans le tableau. J'√©crirai avec mes mains avant le complot de carottes, donc je recueille la demande avec les formules dans la plaque Excel. <br><br><img src="https://habrastorage.org/webt/ww/m3/br/wwm3br0qxpp7gudattxhkxnx1fm.png"><br>  <sub>Dans la colonne ¬´A¬ª j'ins√®re les noms des champs, je les prends dans les tables de documentation ou de service.</sub>  <sub>Dans la colonne "B" - une formule pour coller une demande</sub> <br><br>  J'ins√®re les noms des champs, √©cris la premi√®re formule dans la colonne "B", tire le coin - et vous avez termin√©. <br><br><img src="https://habrastorage.org/webt/1r/ld/ct/1rldctxhypv2xw3era05-lkixhu.gif"><br>  <sub>Fonctionne dans Excel, dans Google Docs et dans Excel Online (disponible sur Yandex.Disk)</sub> <br><br>  L'analyse des donn√©es sauve la voiture du temps et sauve les nerfs des managers.  Avec elle, il est plus facile de respecter le d√©lai.  Si le projet est important, l'analyse permettra d'√©conomiser des millions de roubles et une r√©putation. <br><br><h2>  Pas des chiffres, mais des conclusions </h2><br>  Elle a formul√© une r√®gle pour elle-m√™me: ne pas montrer de chiffres nus au client, vous n‚Äôobtiendrez toujours pas l‚Äôeffet.  Ma t√¢che consiste √† analyser les donn√©es et √† tirer des conclusions, et √† joindre les chiffres comme preuves.  Les conclusions sont primaires, les chiffres sont secondaires. <br><br>  Ce que je collecte pour le rapport: <br><br><ul><li>  <i>la formulation des probl√®mes sous forme d'hypoth√®se ou de question</i> : ¬´Le NIF est rempli de 0,07%.  Comment utilisez-vous ces donn√©es, quelle est leur pertinence, comment les interpr√©ter?  Y a-t-il une seule DCI dans une table? "  Vous ne pouvez pas bl√¢mer: "Votre NIF n'est pas du tout rempli."  En r√©ponse, vous ne recevrez que de l'agression; </li><li>  <i>exemples de probl√®mes.</i>  Ce sont les tablettes dont il y a tellement dans l'article; </li><li>  <i>options sur la fa√ßon de le faire:</i> "Il pourrait √™tre utile de supprimer le TIN de la base cible afin de ne pas produire de champs vides." </li></ul><br>  Je n'ai pas le droit de d√©cider quoi choisir exactement dans la base de donn√©es source et comment modifier les donn√©es pendant la migration.  Par cons√©quent, avec le rapport, je vais chez le client ou chez les int√©grateurs, et nous d√©couvrons comment proc√©der. <br><br>  Parfois, le client, voyant le probl√®me, r√©pond: ¬´Ne vous inqui√©tez pas, ne faites pas attention.  Nous allons acheter un t√©raoctet suppl√©mentaire de m√©moire, c'est tout.  C'est moins cher que l'optimisation. "  Vous ne pouvez pas accepter cela: si vous prenez tout de suite, il n'y aura pas de qualit√© dans le r√©cepteur.  Toutes les m√™mes donn√©es inutiles redondantes migrent. <br><br>  Par cons√©quent, nous demandons doucement mais r√©guli√®rement: "Dites-nous comment vous utiliserez ces donn√©es particuli√®res dans le syst√®me cible."  Pas "pourquoi vous avez besoin", √† savoir "comment vous allez l'utiliser".  Les r√©ponses ¬´alors nous trouverons¬ª ou ¬´juste au cas o√π¬ª ne conviennent pas.  T√¥t ou tard, le client comprend quelles donn√©es peuvent √™tre supprim√©es. <br><br>  L'essentiel est de trouver et de r√©soudre tous les probl√®mes jusqu'√† ce que le syst√®me soit lanc√© en prod.  Pour changer l'architecture et le mod√®le de donn√©es vivants, vous perdrez la t√™te. <br><br>  C'est tout avec des v√©rifications de base, √©tudiez les donn√©es! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr431376/">https://habr.com/ru/post/fr431376/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr431360/index.html">Expliquez la porte d√©rob√©e dans le flux d'√©v√©nements</a></li>
<li><a href="../fr431362/index.html">Comment un designer peut-il se d√©barrasser de la routine et garder son int√©r√™t pour son travail?</a></li>
<li><a href="../fr431370/index.html">Les rapports les plus rapides dans l'ouest sauvage. Et une poign√©e de bugs en plus ...</a></li>
<li><a href="../fr431372/index.html">Interruptions √† partir de p√©riph√©riques externes dans un syst√®me x86. Partie 2. Options de d√©marrage du noyau Linux</a></li>
<li><a href="../fr431374/index.html">Jugement dernier: analyse des indicateurs financiers du jeu en acc√®s anticip√©</a></li>
<li><a href="../fr431378/index.html">Toute la v√©rit√© sur RTOS. Article # 23. Files d'attente: introduction et services de base</a></li>
<li><a href="../fr431380/index.html">Mitap Netologiya et Skyeng √† propos des comp√©tences g√©n√©rales ¬´Ce qu'un d√©veloppeur doit savoir, sauf le code¬ª</a></li>
<li><a href="../fr431382/index.html">R√©sultats de l'enqu√™te JVM sur les √©cosyst√®mes</a></li>
<li><a href="../fr431384/index.html">CLion 2018.3: d√©veloppement √† distance, profilage de code, performances et plus</a></li>
<li><a href="../fr431388/index.html">Le monde √† travers les yeux d'une voiture. Comment les drones le voient-ils?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>