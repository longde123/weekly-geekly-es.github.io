<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕺🏼 😰 👨🏿‍🔧 Cara mudah dan aman untuk mengotomatiskan penyebaran kenari dengan Helm 👨🏽‍🚀 🧑🏽‍🤝‍🧑🏻 🔏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Penebaran kenari adalah cara yang sangat efektif untuk menguji kode baru pada sekelompok pengguna. Ini secara signifikan mengurangi beban lalu lintas,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cara mudah dan aman untuk mengotomatiskan penyebaran kenari dengan Helm</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/468013/"><img src="https://habrastorage.org/webt/im/p5/dz/imp5dzjfim9tzj6fs7iafpetfl0.jpeg"><br><br>  Penebaran kenari adalah cara yang sangat efektif untuk menguji kode baru pada sekelompok pengguna.  Ini secara signifikan mengurangi beban lalu lintas, yang dapat menyebabkan masalah selama proses penempatan, karena hanya terjadi dalam subkelompok tertentu.  Artikel ini dikhususkan untuk bagaimana mengatur penyebaran serupa menggunakan Kubernetes dan otomatisasi penyebaran.  <i>Diasumsikan bahwa Anda mengetahui sesuatu tentang sumber daya Helm dan Kubernetes</i> . <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/uw/wf/lc/uwwflcg7sk94dwvjgec0ksjr8ca.png"><br><br>  Penyebaran kenari sederhana Kubernetes mencakup dua sumber daya utama: layanan itu sendiri dan alat penyebaran.  Penempatan kenari berfungsi melalui satu layanan, yang berinteraksi dengan dua sumber berbeda yang melayani pembaruan lalu lintas.  Salah satu sumber daya ini akan bekerja dengan versi "kenari", dan yang kedua dengan yang stabil.  Dalam situasi ini, kita dapat menyesuaikan jumlah versi kenari untuk mengurangi jumlah lalu lintas yang diperlukan untuk pemeliharaan.  Jika, misalnya, Anda lebih suka menggunakan Yaml, maka akan terlihat seperti ini di Kubernetes: <br><br><pre><code class="xml hljs">kind: Deployment metadata: name: app-canary labels: app: app spec: replicas: 1 ... image: myapp:canary --- kind: Deployment metadata: name: app labels: app: app spec: replicas: 5 ... image: myapp:stable --- kind: Service selector: app: app # Selector will route traffic to both deployments.</code> </pre> <br>  Lebih mudah membayangkan opsi seperti itu di kubectl, dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi Kubernetes</a> bahkan memiliki tutorial lengkap tentang skenario ini.  Tetapi pertanyaan utama dari postingan ini adalah bagaimana kita akan mengotomatiskan proses ini menggunakan Helm. <br><br><h3>  Otomatisasi penyebaran kenari </h3><br>  Pertama-tama, kita membutuhkan Peta Grafik Helm, yang sudah termasuk sumber daya yang kita bahas di atas.  Seharusnya terlihat seperti ini: <br><br><pre> <code class="xml hljs">~/charts/app ├── Chart.yaml ├── README.md ├── templates │ ├── NOTES.txt │ ├── _helpers.tpl │ ├── deployment.yaml │ └── service.yaml └── values.yaml</code> </pre> <br>  Dasar dari konsep Helm adalah manajemen rilis multi-versi.  Versi stabil adalah cabang stabil utama kami dari kode proyek.  Tetapi dengan Helm, kami dapat menggunakan rilis kenari dengan kode eksperimental kami.  Hal utama adalah untuk menjaga pertukaran lalu lintas antara versi stabil dan rilis kenari.  Kami akan mengelola semua ini menggunakan pemilih khusus: <br><br><pre> <code class="xml hljs">selector: app.kubernetes.io/name: myapp</code> </pre> <br>  Sumber daya "kenari" dan penempatan stabil kami akan menunjukkan label ini pada modul.  Jika semuanya diatur dengan benar, maka selama penyebaran versi kenari dari grafik Helm kami, kami akan melihat bahwa lalu lintas akan diarahkan ke modul yang baru digunakan.  Versi stabil dari perintah ini akan terlihat seperti ini: <br><br><pre> <code class="xml hljs">helm upgrade --install myapp \ --namespace default \ --set app.name=myapp \ # Goes into app.kubernetes.io/name --set app.version=v1 \ # Goes into app.kubernetes.io/version --set image.tag=stable \ --set replicaCount=5</code> </pre> <br>  Sekarang mari kita periksa rilis kenari kita.  Untuk menggunakan versi kenari, kita perlu mengingat dua hal.  Nama rilis harus berbeda sehingga kami tidak menggulung pembaruan pada versi stabil saat ini.  Versi dan tag juga harus berbeda sehingga kami dapat menggunakan kode yang berbeda dan mengidentifikasi perbedaan berdasarkan label sumber daya. <br><br><pre> <code class="xml hljs">helm upgrade --install myapp-canary \ --namespace default \ --set app.name=myapp \ # Goes into app.kubernetes.io/name --set app.version=v2 \ # Goes into app.kubernetes.io/version --set image.tag=canary \ --set replicaCount=1</code> </pre> <br>  Itu saja, sebenarnya!  Jika Anda melakukan ping layanan, Anda dapat melihat bahwa kenari memperbarui rute hanya sebagian waktu. <br><br><hr><br>  Jika Anda mencari alat otomasi penyebaran yang menyertakan logika yang dijelaskan, maka periksa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Deliverybot</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">alat otomasi Helm di GitHub</a> .  Grafik Helm yang digunakan untuk mengimplementasikan metode yang dijelaskan di atas ada di Github, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di sini</a> .  Secara umum, ini adalah tinjauan teoretis tentang bagaimana menerapkan penyebaran versi kenari dalam praktiknya, dengan konsep dan contoh spesifik. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id468013/">https://habr.com/ru/post/id468013/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id468001/index.html">Jangan Anda pikirkan: program benar-benar menjadi lebih mahal</a></li>
<li><a href="../id468005/index.html">Ucapkan sepatah kata tentang dukungan luar biasa (24 September, Moskow)</a></li>
<li><a href="../id468007/index.html">Tetapi apakah saya tidak melakukan omong kosong lagi? Bagaimana dan mengapa menerapkan metrik kualitas</a></li>
<li><a href="../id468009/index.html">Kerentanan sistem ERP objek KII</a></li>
<li><a href="../id468011/index.html">Kisah robot hipotetis</a></li>
<li><a href="../id468015/index.html">Apa yang diketahui tentang ITIL 4 saat ini, dan siapa yang sudah menggunakan perpustakaan baru</a></li>
<li><a href="../id468017/index.html">The Maybe Monad via async / tunggu di C # (tanpa Task ov!)</a></li>
<li><a href="../id468019/index.html">Pengembangan situs web di WebAssembly menggunakan NetCore 3 dan Blazor</a></li>
<li><a href="../id468021/index.html">PHP, berapa banyak abstraksi untuk orang-orang?</a></li>
<li><a href="../id468023/index.html">Kecerdasan buatan dalam game pertarungan Shadow Fight 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>