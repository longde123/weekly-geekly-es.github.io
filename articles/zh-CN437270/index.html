<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏰 🦄 💉 我们使用QEMU和Intel GVT-g部署具有虚拟视频卡转发功能的Windows虚拟机 👨🏼‍🚒 💷 ✝️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="如何使Intel GVT-g工作 


 大家好！ 英特尔为这个永恒的问题提供了一个极好的解决方案：“我有一台笔记本电脑在Linux上，我需要通过硬件加速来运行Windows，但是我没有一台笨重的笔记本电脑带有两个GPU和液冷。” 他们使用他们的GPU或其他东西的架构，设法做到了这一点，以便您可以将...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>我们使用QEMU和Intel GVT-g部署具有虚拟视频卡转发功能的Windows虚拟机</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437270/"><h1 id="kak-zastavit-intel-gvt-g-rabotat"> 如何使Intel GVT-g工作 </h1><br><p> 大家好！ 英特尔为这个永恒的问题提供了一个极好的解决方案：“我有一台笔记本电脑在Linux上，我需要通过硬件加速来运行Windows，但是我没有一台笨重的笔记本电脑带有两个GPU和液冷。” 他们使用他们的GPU或其他东西的架构，设法做到了这一点，以便您可以将集成的Intel GPU拆分为两个或更多GPU。 </p><br><p> 不幸的是，这远非简单...文档有些过时了，有些事情由于没有明显的原因而无法解释。 因此，在本文中，我将告诉您如何使用凉爽的virtio和Intel GVT-g快速驱动程序配置硬件加速的Windows虚拟机。 </p><br><p> 为此，您需要或多或少的现代化GPU（ <em>译者注</em> ： <em>根据<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">官方文档</a> ，GVT-g支持从第五代Intel Core和第四代Xeon开始集成的视频卡</em> ）。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/760/a80/d5e/760a80d5edea70d7ba2eb33458205f89.jpg" alt="Windows屏幕截图"></p><a name="habracut"></a><br><h2 id="shag-1-nastraivaem-yadro"> 步骤1：配置内核 </h2><br><p> 验证您有一个新的内核版本。  GVT-g的选项似乎已包含在4.8版之前，但是它们的确工作得更差，所以我建议使用最新的可用内核。 如果您足够原始，可以构建内核，请启用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这些选项</a> 。 同时禁用删除未使用的ksyms，因为此选项<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">会导致bug</a> 。 </p><br><p> 现在，您需要修复内核命令行参数。 重要选项是： </p><br><pre><code class="plaintext hljs">i915.enable_gvt=1 kvm.ignore_msrs=1 intel_iommu=on i915.enable_guc=0</code> </pre> <br><p> 确保不要使用启用GuC加载的功能覆盖<code>enable_guc=0</code> ，因为这将导致i915驱动程序崩溃。 引导时，进入工作环境并检查目录<code>/sys/bus/pci/devices/0000:00:02.0/mdev_supported_types/</code> 。 如果不存在，则GVT-g不起作用。 检查原木和/或在枕头中哭泣。 </p><br><p> 为了解决该问题，您可以将<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这些</a>模块添加到initramfs中，然后从其中删除i915。 </p><br><p> 有关更详细的日志记录，可以将<code>drm.debug</code>变量设置为某个值，例如，将其设置为0x02将包含来自驱动程序的消息。 </p><br><h2 id="shag-2-sozdayom-virtualnogo-druga"> 步骤2：建立一个虚拟朋友 </h2><br><p> 在<code>mdev_supported_types</code>内部，您可以找到一整套目录。 该设置由您的图形内存量决定，每个子目录对应某种虚拟GPU。 其中的<code>description</code>文件包含有关此虚拟GPU支持的内存和分辨率的信息。 如果使用<code>/create</code>文件中的UUID输出<code>/create</code>具有大内存的虚拟GPU会给您带来无法理解的错误，那么您有几种选择。 首先，进入BIOS并添加视频内存（如果可能）。 如果这不起作用，则可以停止DM，切换到帧缓冲区，从那里创建所需的vGPU，然后返回到x11。 不幸的是，这种方法会导致许多错误，并且无法在笔记本电脑上达到60 FPS。 一种替代方法是创建一个较小的vGPU，并使用特殊程序来提高分辨率（CRU）。 这样，我设法达到了60 FPS，并且错误和冻结的发生率大大降低。 </p><br><p> 您可以使用以下命令创建vGPU： </p><br><pre> <code class="plaintext hljs">$ echo ${vGPU_UUID} | sudo tee /sys/bus/pci/devices/0000:00:02.0/mdev_supported_types/${vGPU_TYPE}/create</code> </pre> <br><p> 并删除-这： </p><br><pre> <code class="plaintext hljs">$ echo 1 | sudo tee /sys/bus/mdev/devices/${vGPU_UUID}/remove</code> </pre> <br><p>  <em>译者注</em> ： <br>  <em>您可以使用不带参数的<code>uuidgen</code>命令为vGPU生成UUID。</em>  <em>变量$ {vGPU_TYPE}表示<code>mdev_supported_types</code>目录中列出的类型之一。</em>  <em>还值得注意的是，每次重新启动时都必须重新创建vGPU，它们不会在两次操作系统启动之间保存。</em> </p><br><h2 id="shag-3-cortana-krichit-na-vas"> 步骤3：Cortana向您吼叫 </h2><br><p> 下一步要得到更好的支持，要慢得多，也要痛苦得多-安装Windows10。请勿使用torrents或非官方下载文件，或旧版本的Windows， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处提供</a>正确的链接。 还值得下载带有virtio驱动程序的磁盘映像，该驱动程序专门用于加速<a href="">此处的客户机</a> 。 安装<code>libvirt</code>和<code>virt-manager</code>并运行<code>libvirtd</code> ： </p><br><pre> <code class="plaintext hljs"># systemctl start libvirtd</code> </pre> <br><p> 运行<code>virt-manager</code>并确保您已连接到<code>libvirt</code>系统会话，而不是用户： <br><img src="https://habrastorage.org/getpro/habr/post_images/8e3/ca9/b29/8e3ca9b29bd86d43d7a79a2aecdaadd9.png" alt="病毒管理器窗口"></p><br><p>  <em>译者注</em> ： <br>  <em>为了使virt-manager能够连接到系统会话，可以以root用户身份运行它，但是最好配置授权，例如，如<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Arch Wiki</a>上所建议。</em> </p><br><p> 完成此操作后，就可以开始创建虚拟机了。 在设置对话框中，从本地iso图像中选择下载并找到下载的图像。 如果<code>virt-manager</code>无法将其识别为Windows 10映像，请手动选择它，因为这会加快Windows的速度，因为在这种情况下<code>virt-manager</code>提供了Microsoft的某些虚拟化界面。 创建磁盘映像或LVM分区并根据需要进行配置。 安装前的设置界面非常有限，因此我通常开始安装并立即停止以完全配置所有内容。 以下是一些设置： <br><img src="https://habrastorage.org/getpro/habr/post_images/a55/104/cca/a55104cca39b9a94e2ec55fb5248a6c0.png" alt="虚拟机CPU设置"><br><img src="https://habrastorage.org/getpro/habr/post_images/256/bde/55c/256bde55c4d6f438667ca75458ba1ab3.png" alt="虚拟机网络设置"></p><br><p>  <em>译者注</em> ： <br>  <em>尽管存在关于在便携式计算机上设置虚拟机的文章，但由于某种原因，省略了有关使用无线适配器分配网络的问题。</em>  <em>事实是，virt-manager中的默认网络设置不适用于无线网络。</em>  <em>在这种情况下， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此</a>问题的答案和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">对此的</a>评论会有所帮助。</em>  <em>作者还建议使用BIOS代替UEFI，这可能是因为UEFI需要其他配置。</em>  <em>另外，看来tianocore尚未与GVT-g配合使用，请参见<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">bug 935</a> 。</em>  <em>但是，就我而言，VM已启动，但Windows无法识别集成视频卡所连接的监视器。</em> </p><br><p> 如果您需要快速访问磁盘或什至在删除虚拟机文件时虚拟机具有压缩磁盘映像的能力（TRIM转发，为此，您需要使用<code>qemu-img create -f qcow2 -o preallocation=metadata,lazy_refcounts</code> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处的</a>完整说明来创建映像），配置主驱动器以使用SCSI。 您将需要Windows虚拟机的驱动程序才能理解这种格式，因此请插入先前下载的Windows 10 virtio驱动程序磁盘。默认情况下，它们使用IDE，但是如果您改而使用，则可以加快安装速度，并减少使用旧代码的次数。用于SCSI DVD。  Windows开箱即用地支持此功能。 您也可以： </p><br><ul><li> 强制USB使用USB 3.0 </li><li> 添加spice，spice-webdav和qemu-ga通道，以便在VM和主机之间进行复制和粘贴以及文件共享 </li><li> 删除未使用的虚拟硬件 </li><li> 将模拟视频卡切换为QXL并将显示切换为SPICE，而不是收听网络（甚至是环回）（ <em>译者注：否则，VM只会崩溃</em> ）。 </li><li> 将芯片类型切换为Q35，在BIOS设置旁边进行设置。 </li><li> 喂狗 </li></ul><br><p> 您还可以习惯于新朋友<code>virsh edit</code> 。 如果使用<code>sudo -E</code>运行它，则将使用环境变量（尤其是EDITOR）进行编辑，并且将使用libvirt系统会话，而不是用户会话。 例如，在此文件中，您可以在物理处理器和虚拟处理器之间分配对应关系，这是因为处理器缓存更加一致，并且调度程序的行为并不那么奇怪。 这是您可以放在其中的XML示例： </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vcpu</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placement</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'static'</span></span></span><span class="hljs-tag">&gt;</span></span>6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vcpu</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cputune</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vcpupin</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vcpu</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cpuset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'1'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vcpupin</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vcpu</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'1'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cpuset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'2'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vcpupin</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vcpu</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'2'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cpuset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'3'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vcpupin</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vcpu</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'3'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cpuset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'5'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vcpupin</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vcpu</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'4'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cpuset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'6'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vcpupin</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vcpu</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'5'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cpuset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'7'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cputune</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">features</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hyperv</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">relaxed</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">state</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'on'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vapic</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">state</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'on'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">spinlocks</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">state</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'on'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">retries</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'8191'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">runtime</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">state</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'on'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">synic</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">state</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'on'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stimer</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">state</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'on'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hyperv</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">features</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cpu</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'host-passthrough'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">check</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'none'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">topology</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">sockets</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'1'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cores</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'3'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">threads</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'2'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cpu</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> 在此代码段中，我对VM进行配置，以使其看到具有三个物理核心的处理器，每个物理核心都有两个超线程。 此外，每个处理器/超线程都附加到其自己的超线程，并且此对应关系不会更改。  Windows Scheduler知道超线程并且可以正确使用它们，而不会将它们视为单独的处理器。 我还启用了一些默认情况下关闭的Hyper-V接口，这些接口可能不会起作用。 如果使用SPICE，则可以添加以下行以禁用压缩，因为仍然不使用外部网络访问VM。 </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">graphics</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'spice'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">listen</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'none'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">image</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">compression</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'off'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jpeg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">compression</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'never'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">zlib</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">compression</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'never'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">playback</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">compression</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'off'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">streaming</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'off'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- &lt;gl enable='yes' rendernode='/dev/dri/by-path/pci-0000:00:02.0-render'/&gt;     ,     libvirt --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">graphics</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> 现在，您可以配置启动顺序并开始安装Windows。 如果您使用<code>virtio</code>或SCSI驱动器，Windows将找不到它。 您需要从所连接的驱动器安装SCSI驱动程序，它们位于<code>virtscsi/amd64</code>目录中。 一切应该顺利进行，Windows应该以缓慢而痛苦的而非加速模式启动。  Cortana将开始对您大吼大叫，并且您的网络将无法正常工作。 将其全部突破到桌面。 在此处，启动设备管理器，找到所有未识别的设备，然后从您连接的磁盘更新驱动程序。 您将获得一个稍快的Windows。 </p><br><h2 id="shag-4-vesyolaya-chast"> 步骤4：有趣的部分 </h2><br><p> 有三种方法可以从Windows在计算机屏幕上显示加速的虚拟VM。 </p><br><ul><li>  VNC或其他某种远程访问协议（通常这是一个非常糟糕的解决方案）。 在此选项中，您仅需要连接vGPU并禁用所有其他显示器和视频卡。 同时设置<code>display='off'</code>设置。 您不需要稍后显示的<code>igd-opregion</code>选项。 </li><li>  SPICE（我无法达到30 FPS或更高的速度，但是可以在VM和主机之间正常使用剪贴板和文件传输）。 </li><li>  GTK +上的内置QEMU接口（共享剪贴板和文件传输不起作用，但使用补丁程序可以达到60 FPS）。 </li></ul><br><p> 无论打算使用什么，都仍然必须使用第二个选项来安装GPU的驱动程序。 在编写本文时，Microsoft的内置驱动程序无法与GVT-g很好地配合，并且经常会损坏。 在将vGPU连接到VM之前，建议<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">从Intel</a>下载<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">最新的驱动程序</a> （显然， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Intel正在更改其分发驱动程序的方法</a> ，因此将来此步骤可能会有所不同或完全没有必要）。 现在，请确保您已创建vGPU。 打开<code>virt-manager</code>并用慢速的Cirrus替换快速QXL，以免发生冲突。 要将vGPU连接到VM，您需要打开<code>virsh edit</code>并在以下位置添加以下片段： </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">domain</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'kvm'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:qemu</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'http://libvirt.org/schemas/domain/qemu/1.0'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hostdev</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'subsystem'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'mdev'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">managed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'no'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">model</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'vfio-pci'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">display</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'on'</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><pre> <code class="plaintext hljs">&lt;address uuid='fff6f017-3417-4ad3-b05e-17ae3e1a4615'/&gt;</code> </pre> <br><pre> <code class="plaintext hljs"> &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x09' function='0x0'/&gt; &lt;rom enabled='no'/&gt; &lt;/hostdev&gt; &lt;graphics type='spice'&gt; &lt;listen type='none'/&gt; &lt;image compression='off'/&gt; &lt;jpeg compression='never'/&gt; &lt;zlib compression='never'/&gt; &lt;playback compression='off'/&gt; &lt;streaming mode='off'/&gt; &lt;gl enable='yes' rendernode='/dev/dri/by-path/pci-0000:00:02.0-render'/&gt; &lt;!--      , virt-manager     ,        GL. ,      ,   auto. --&gt; &lt;/graphics&gt; &lt;qemu:commandline&gt; &lt;qemu:arg value='-set'/&gt; &lt;qemu:arg value='device.hostdev0.x-igd-opregion=on'/&gt; &lt;!-- libvirt     ,      --&gt; &lt;/qemu:commandline&gt; &lt;/domain&gt;</code> </pre> <br><p> 注意：当我提供这样的XML代码片段时，应尽可能将其添加到当前的XML代码片段中，而不用替换任何内容。 </p><br><p> 确认您已为所有正在使用的vGPU创建了唯一的UUID，并且插槽号与任何其他PCI设备没有冲突。 如果插槽号在Cirrus GPU之后，则虚拟机将崩溃。 现在您可以启动虚拟机。  <strong>您需要安装<code>virt-viewer</code>才能看到两个显示！</strong> 您可以使用以下命令连接到VM </p><br><pre> <code class="plaintext hljs">$ sudo -E virt-viewer --attach</code> </pre> <br><p> 其中一个显示为空白或未初始化，第二个为熟悉的小型非加速显示。 展开它，然后输入，为GPU安装驱动程序。 如果幸运的话，一切都会立即生效。 否则，您必须使用工作屏幕关闭并重新启动VM（不要重新启动）。 现在是时候打开终端并在内部运行<code>dmesg -w</code> 。 该命令将为您提供有关使用vGPU的问题和总体进度的一些有用信息。 例如，在启动时，KVM会抱怨MSR被阻止，然后在初始化vGPU时应该会收到一些不正确的访问消息。 如果太多，那是不对的。 </p><br><p> 如果系统启动，则可以打开显示设置并关闭非加速屏幕。 可以通过<code>virt-viewer</code>的“ <em>查看”</em>菜单隐藏空白屏幕。 原则上，虚拟机已经可以使用，但是可以做几件事来实现更高的分辨率和更高的速度。 </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CRU实用程序</a>非常有用。 您可以使用它，即使偶然发现一些图形工件或什至几乎是全黑屏幕，对于我来说，也可以运行该程序附带的<code>Restart64.exe</code>文件来重新启动Windows图形子系统。 我个人使用此实用程序在更适中的vGPU上使用更高的分辨率。 </p><br><p> 为了获得出色的60 FPS，您需要切换到GTK +上的内置QEMU监视器，而不支持与主机和类似的包子共享的剪贴板，并在其中更改一行并重建QEMU。 您还需要在XML中添加一堆讨厌的命令行参数。 卸下SPICE显示屏和Cirrus图形卡，并将vGPU的<code>display</code>属性设置为<code>off</code> （libvirt不支持GTK +上的显示屏，并且不允许不带显示屏<code>display='on'</code>情况下从<code>display='on'</code>引导）。 </p><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">qemu:commandline</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">qemu:arg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'-set'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">qemu:arg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'device.hostdev0.x-igd-opregion=on'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">qemu:arg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'-set'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">qemu:arg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'device.hostdev0.display=on'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">qemu:arg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'-display'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">qemu:arg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'gtk,gl=on'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">qemu:env</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'DISPLAY'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">':1'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">qemu:env</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'GDK_SCALE'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'1.0'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">qemu:commandline</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> 在QEMU监视器上缩放HiDPI的效果非常差，因此我们将其关闭。 另外，您需要将<code>DISPLAY</code>变量设置为您正在使用的显示编号。 要为运行qemu的用户提供对X服务器的访问权限，请使用以下命令： </p><br><pre> <code class="plaintext hljs"># xhost si:localuser:nobody</code> </pre> <br><p> 如果这不起作用，请尝试使用<code>xhost +</code> ，但请确保您使用的是防火墙。 否则，请尝试更安全的方法。 </p><br><p> 使用这种技巧，如果您不通过更改行来对其进行打补丁（如注释链接中所示），则由于QEMU中的此<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">愚蠢错误</a> ，您仍然不会获得高于30 FPS的价格。 确保仅针对x86-64构建QEMU，除非打算在其他平台上使用它。 我连接了我的PKGBUILD，它不改变线路，但仅收集x86_64的QEMU，而<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>没有网络存储支持。 </p><br><p> 如果您迷路了，可以看到我当前<a href="">的libvirt XML</a> 。 </p><br><h2 id="poleznye-ssylki"> 有用的链接 </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">官方GVT-g调整指南</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Dma-buf用户指南</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">NixOS Wiki上的Intel GVT-g设置文章</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">关于libvirt的Arch Wiki文章</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">无线接口上的KVM中的网络设置</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">英特尔GVT-g网站</a> </p><br><p>  PS：感谢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">aNNiMON</a>在校对翻译文本和纠正错误方面的帮助。 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN437270/">https://habr.com/ru/post/zh-CN437270/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN437256/index.html">验证Cortex-M0 / M3 / M4 / M7上的内存地址</a></li>
<li><a href="../zh-CN437258/index.html">CATIA DESIGN团队的独特项目：Bleu概念车</a></li>
<li><a href="../zh-CN437260/index.html">Windows Phone 8.1：怀旧后开发。 单一申请历史</a></li>
<li><a href="../zh-CN437262/index.html">河水如何饮用？</a></li>
<li><a href="../zh-CN437264/index.html">IT专业倦怠（“我的圈子”研究结果）</a></li>
<li><a href="../zh-CN437274/index.html">实践中的可观察性愿景</a></li>
<li><a href="../zh-CN437276/index.html">带有日光LED的Remilicht台灯</a></li>
<li><a href="../zh-CN437280/index.html">轻松自做物流</a></li>
<li><a href="../zh-CN437282/index.html">针对VMware用户的Kubernetes简介。 第二部分练习</a></li>
<li><a href="../zh-CN437284/index.html">与音响行业有关的动物园专业</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>