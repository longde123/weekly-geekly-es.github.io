<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐯 👨🏼‍🎤 🙎🏻 Wir steuern das Android-Gerät 🙎🏼 🤹🏾 🥠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dies ist der dritte Versuch, ein Smart Home mit Android zu befreunden. Ich möchte Sie daran erinnern, dass der erste Versuch, Android-Geräte über HTTP...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wir steuern das Android-Gerät</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/iobroker/blog/443908/"><img src="https://habrastorage.org/webt/6f/v8/iv/6fv8ivfvowy3babfxb85nxj-xxe.jpeg"><br><br>  Dies ist der dritte Versuch, ein Smart Home mit Android zu befreunden. Ich möchte Sie daran erinnern, dass der erste Versuch, Android-Geräte über HTTP zu steuern, die Verwendung der Paw Server-Anwendung war.  Diese Anwendung ermöglichte die Verwendung der BeanShell-Sprache, um Ihren Code in eine XML-Seite einzubetten und mit ihr zu interagieren, Daten zu empfangen oder zu verwalten.  Für die Integration in den Smart Home-Server ( <b>ioBroker</b> ) wurde ein Treiber geschrieben, für die erste Konfiguration mussten jedoch Skripte manuell geladen werden.  Darüber hinaus wurden über den Treiber Skripte aktualisiert, die das Hinzufügen neuer Funktionen und das Beheben von Fehlern ermöglichten, aber auch eine Reihe von Einschränkungen auferlegten, wenn versucht wurde, von den in Paw Server festgelegten Methoden zur Implementierung neuer Funktionen abzuweichen. <br><a name="habracut"></a><br>  Der zweite Versuch bestand darin, Ihre Anwendung basierend auf der Quelle vom Paw-Server zu erstellen.  Das Hauptziel bestand darin, den Konfigurationsprozess für den Benutzer zu vereinfachen und neue Funktionen hinzuzufügen, die in der vorherigen Version nicht implementiert werden konnten. <br><br>  In derselben Version wurde beschlossen, den Paw-Server vollständig zu verlassen und die Anwendung und den Treiber für ioBroker neu zu schreiben.  Fügen Sie neben dem vorhandenen HTTP auch neue Verbindungsmethoden und MQTT hinzu.  Fügen Sie weitere Einstellungen für die Auswahl von Ereignissen hinzu, sowohl vom System selbst als auch von integrierten Sensoren.  Natürlich wird die Anwendung als erstes für ioBroker optimiert, kann aber ohne große Schwierigkeiten in andere Systeme integriert werden. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Google Play</a> <br><br>  Mit der Anwendung können Sie: <br><br><ol><li>  Abrufen des Status der Systemeinstellungen (Helligkeit der Hintergrundbeleuchtung, Bildschirmstatus, Lautstärke, Akku usw.) </li><li>  Empfangen Sie Daten von eingehenden Anrufen, Spracherkennung </li><li>  Empfangen Sie Daten von eingebauten Sensoren. </li><li>  Standortkoordinaten abrufen. </li><li>  Holen Sie sich eine Liste der installierten Anwendungen und starten Sie sie. </li><li>  Verwalten Sie die Systemeinstellungen (Helligkeit der Hintergrundbeleuchtung, Lautstärke usw.). </li><li>  Anrufe tätigen. </li><li>  Erstellen Sie Benachrichtigungen und Dialogfelder. </li><li>  Senden Sie Text an die Sprachsynthese. </li><li>  Interagiere mit Tasker. </li><li>  Senden Sie Dateien an Geräte (nur HTTP). </li></ol><br><h3>  Aussehen </h3><br><img src="https://habrastorage.org/webt/gy/cx/ex/gycxexy0qyrznfyah-ypsno_r3i.jpeg"><br><br>  Das Erscheinungsbild der Anwendung ist nicht endgültig und kann variieren.  Ich würde gerne viel ändern oder hinzufügen, aber das ist alles mit der Zeit. <br><br>  Bei der Navigation durch die Anwendung sollte es meiner Meinung nach keine Schwierigkeiten geben.  Beim ersten Start informiert die Anwendung kurz über die aktuellen Änderungen in der neuen Version und schlägt vor, den „Assistenten“ zu verwenden.  In den Anwendungseinstellungen können Sie die grundlegenden Betriebsparameter ändern, den Verbindungstyp auswählen, die Ereignisse auswählen, die an den Server übertragen werden, und den Zugriff auf einige Daten (Telefonbuch, Nachrichten, Anrufliste und Fotos) zulassen oder verweigern. <br><br>  Auf dem Hauptbildschirm können Sie die "Kacheln" sehen, obwohl dies eine Testversion ist, aber im Laufe der Zeit plane ich, ihre Funktionen zu erweitern.  Von den derzeit verfügbaren "Kacheln" gibt es: Schaltfläche, Dimmer, Zeit, Liste, Farbe, Informationen.  Die Hauptaufgabe der Kacheln besteht darin, Daten (Befehle) vom Server zu senden oder zu empfangen oder andere Geräte zu verwalten.  Obwohl es kein Gesamtbild darüber gibt, wie alles funktionieren sollte, werde ich jetzt nicht alle Nuancen beschreiben. <br><br><h2>  Verbindungen </h2><br>  In Bezug auf Verbindungen und Steuerbefehle verfügt die Anwendung über zwei Verbindungsoptionen über HTTP und MQTT.  Jede Methode hat ihre Vor- und Nachteile, welche Verbindungsmethode Sie wählen. <br><br><h3>  HTTP </h3><br>  Bei dieser Methode wird eine Verbindung über WLAN mit einem lokalen Netzwerk hergestellt.  Die Anwendung "erhöht" ihren Webserver (die IP-Adresse und der Port sind in der Benachrichtigung beim Herstellen der Verbindung zu sehen) und gewährt Zugriff auf die Verwaltung.  Dies kann entweder direkt (über einen Browser) oder in Integration mit dem UD-Server über POST- oder GET-Anforderungen erfolgen. <br><br> <a href=""><img src="https://habrastorage.org/webt/ju/qx/2l/juqx2lazbiw_mxp7h_iumx0eqii.jpeg"></a> <br><br> <a href=""><img src="https://habrastorage.org/webt/sm/bz/r7/smbzr7jrjuac4nxapcoly6nnc3q.jpeg"></a> <br><br>  Antworten von Anfragen werden im JSON-Format zurückgegeben, der Gerätename, die IP-Adresse und der Befehlsstatus werden im Antworttext übertragen.  Einige Anforderungen rufen einen zusätzlichen „Rückruf“ auf. Wenn Sie beispielsweise Text an die Sprachsynthese senden, sendet die Anwendung eine Anforderung an den Server über den Beginn des Sprechens des Textes und dessen Fertigstellung.  Auf die gleiche Weise überträgt die Anwendung Daten über Ereignisse und Messwerte integrierter Sensoren an den Server.  Für eine vollwertige Arbeit ist es daher erforderlich, dass der UD-Server sie verarbeiten kann. <br><br><h3>  MQTT </h3><br>  Das MQTT-Protokoll ist sehr beliebt und wird von verschiedenen DD-Systemen unterstützt. Dies erleichtert die Integration der Anwendung in diese.  Bei Auswahl dieser Verbindungsmethode können Sie sowohl lokale als auch externe MQTT-Broker verwenden. <br><br>  Wenn Sie eine Verbindung zum MQTT-Broker herstellen, wird der Hauptzweig <b>/ PAW / erstellt</b> , gefolgt vom Namen der Geräte (jedes Gerät muss einen eigenen haben), die wiederum in zwei Zweige des Themas <b>/ info /</b> und <b>/ comm / unterteilt</b> sind. Dies können Sie anhand des Namens erraten Der Zweig info (information) veröffentlicht alle eingehenden Informationen vom Gerät, und der Zweig comm (command) enthält Themen zu dessen Verwaltung.  Dies geschieht aus Gründen der Klarheit, um besser zu verstehen, welches Thema für was verantwortlich ist. <br><br><img src="https://habrastorage.org/webt/ww/9m/bz/ww9mbzkeo7e6fvhfouogaxjisag.jpeg"><br><br>  Auch im Hauptzweig gibt es <b>/ all_devices /</b> in diesem Zweig gibt es Themen, für die alle Geräte abonniert sind, <b>sodass</b> Sie alle Geräte gleichzeitig verwalten können. <br><br>  Aus Gründen der Universalität können in diesen Themen, deren Werte wahr (wahr) oder falsch (falsch) sein können, unterschiedliche Werte angenommen werden, dh <i>1, ein, automatisch, wahr</i> ist der wahre Wert und <i>0, aus, falsch, manuell</i> ist falsch .  Ein weiteres Merkmal der Anwendung besteht darin, dass zur Überprüfung der Ausführung des Befehls bei erfolgreicher Ausführung ein leerer Wert im selben Thema veröffentlicht wird.  Wenn der Wert nach der Veröffentlichung nicht verschwunden ist, weist dies darauf hin, dass beim Ausführen des Befehls ein Fehler aufgetreten ist oder der Wert nicht mit dem richtigen Wert für dieses Thema übereinstimmt.  Wenn beispielsweise beim Ändern des Lautstärkepegels der Wert für einen bestimmten Lautstärketyp nicht der Anzahl entspricht oder das Maximum überschreitet, wird ein Fehler zurückgegeben. <br><br>  Auch in dieser Version wurde der Befehlssatz für Benachrichtigungen und „Dialoge“ erweitert, mit dem Sie detailliertere Informationen anzeigen und mit dem Benutzer interagieren können, wenn das Gerät als Informant verwendet wird.  Bei der Erstellung sind eine große Anzahl von Parametern erforderlich. Daher muss der Wert im entsprechenden Thema im JSON-Format veröffentlicht werden. <br><br>  Für Benachrichtigungen Thema <b>/ comm / Benachrichtigung / erstellen</b> (unten ist ein Beispiel für den Wert) <br><br><pre><code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"noti"</span></span>:<span class="hljs-string"><span class="hljs-string">"Any text"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>:<span class="hljs-string"><span class="hljs-string">"Title 2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"info"</span></span>:<span class="hljs-string"><span class="hljs-string">"Any text"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"vibrate"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sound"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"light"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span> }</code> </pre> <br>  Für "Dialoge" Thema <b>/ Kommunikation / Benachrichtigung / Alarm</b> .  Die Antwort aus den "Dialogen" kommt im JSON-Format und wird im Thema <b>/ info / alert / response veröffentlicht</b> <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"alert"</span></span>:<span class="hljs-string"><span class="hljs-string">"Turn the lights off?"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>:<span class="hljs-string"><span class="hljs-string">"Light"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"negative"</span></span>:<span class="hljs-string"><span class="hljs-string">"No"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"positive"</span></span>:<span class="hljs-string"><span class="hljs-string">"Yes"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"neutral"</span></span>:<span class="hljs-string"><span class="hljs-string">"Neutral"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sound"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span> }</code> </pre> <br><h3>  IoBroker-Integration </h3><br><img src="https://habrastorage.org/webt/x5/hs/po/x5hspolcbtsbwbcypdkkj9pry6c.jpeg"><br><br>  Durch die Einbettung der Fähigkeit, das MQTT-Protokoll in Anwendungen zu verarbeiten, wollte ich nur die Integration in das System vereinfachen und das Schreiben eines separaten Treibers vermeiden.  Einige Funktionen können jedoch nicht über das MQTT-Protokoll implementiert werden, weshalb auf einen Treiber nicht verzichtet werden kann. <br><br>  Die Struktur von Treiberobjekten ähnelt der Struktur von MQTT und ist ebenfalls in zwei Zweige <b>/ info /</b> und <b>/ comm / unterteilt</b> . Sie verfügt über ähnliche Befehle zum Verwalten und die gleiche Reaktion auf falsche Daten.  Ich werde die Treibereinstellungen und den Betrieb hier nicht beschreiben, alle aktuellen Informationen werden auf <a href="">GitHub</a> aktualisiert. <br><br><h3>  Anmerkungen </h3><br>  Bei der Verwaltung der Systemeinstellungen (Steuerung der Helligkeit der Hintergrundbeleuchtung, Aufwachen aus dem Ruhezustand usw.) reagieren verschiedene Geräte unterschiedlich auf Befehle oder nicht.  Aufgrund der Vielzahl von Geräten, SDK-Versionen und Firmware ist es schwierig, ein Verhaltensmodell pro Befehl festzulegen.  Hier müssen Sie die Aktion entsprechend Ihrem Gerät auswählen. Damit die meisten Geräte den Bildschirm ausschalten (in den Ruhezustand versenden), reicht es aus, die Zeitüberschreitung für die Hintergrundbeleuchtung zu ändern. Bei einigen Geräten funktioniert dies jedoch nicht.  In der gleichen Situation wie bei anderen Systemeinstellungen treten bei den meisten Geräten sofort Änderungen auf, bei anderen ist es jedoch erforderlich, das Gerät in den Ruhezustand zu versetzen und dann zu aktivieren, damit die Änderungen wirksam werden.  Die kleinsten Probleme dieser Art treten mit SDK 19 (Android 4.4) auf, dies ist jedoch nicht korrekt.) Vergessen Sie auch nicht, dass Tasker unterstützt wird. Wenn Ihnen eine Funktion fehlt, können Sie sie hinzufügen und über die Anwendung interagieren. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de443908/">https://habr.com/ru/post/de443908/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de443898/index.html">Nägel in der Decke des Sarges von Runet</a></li>
<li><a href="../de443900/index.html">Wie wir die Qualität und Effektivität der Dokumentationsentwicklung messen. Hintergrund und Grundlagen. Yandex-Bericht</a></li>
<li><a href="../de443902/index.html">Wie wir den internen Hackathon gewonnen haben, indem wir Skibidi, Zahnseide und Javascript gelernt haben</a></li>
<li><a href="../de443904/index.html">Was tun, wenn nicht genügend Würfel vorhanden sind, um einen Roboter zu bauen?</a></li>
<li><a href="../de443906/index.html">Video Analytics Harvester: Was Gehirn und Maschinen mit unseren Gesichtern machen</a></li>
<li><a href="../de443910/index.html">Scratch-Programmierkonzepte</a></li>
<li><a href="../de443912/index.html">Hausgemachte BigData. Teil 1. Spark-Streaming-Praxis in einem AWS-Cluster</a></li>
<li><a href="../de443914/index.html">Wie haben wir SCRUM gemacht?</a></li>
<li><a href="../de443916/index.html">Das Kulturministerium und die Filmemacher schlagen vor, ein staatliches System zur Aufzeichnung von Zuschauern im Internet zu schaffen</a></li>
<li><a href="../de443918/index.html">Zwei neue minimalistische Taschenspiele</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>