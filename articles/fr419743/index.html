<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤ğŸ¿ ğŸƒ ğŸ§š Quel est le problÃ¨me avec les articles populaires qui disent que foo est plus rapide que bar? ğŸ‘©ğŸ¼â€ğŸ¤â€ğŸ‘¨ğŸ¿ ğŸ¤°ğŸ½ ğŸ“</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Note du traducteur: Je pensais aussi que le temps pour les articles Ã©tait "Quoi de plus rapide - des guillemets doubles ou simples?" Il a fallu encore...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Quel est le problÃ¨me avec les articles populaires qui disent que foo est plus rapide que bar?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419743/"><p>  <em><strong>Note du traducteur:</strong> Je pensais aussi que le temps pour les articles Ã©tait "Quoi de plus rapide - des guillemets doubles ou simples?"</em>  <em>Il a fallu encore 10 ans.</em>  <em>Mais ici, un article similaire ("Quelles astuces de performance fonctionnent rÃ©ellement") a rÃ©cemment recueilli une note relativement Ã©levÃ©e sur Reddit et est mÃªme entrÃ© dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">condensÃ© PHP</a> sur HabrÃ©.</em>  <em>En consÃ©quence, j'ai dÃ©cidÃ© de traduire l'article avec une analyse critique de ces Â«testsÂ» et d'autres similaires.</em> </p><br><p>  Il existe de nombreux articles (voire des sites entiers) consacrÃ©s au lancement de diffÃ©rents tests comparant les performances de diffÃ©rentes constructions syntaxiques et affirmant sur cette base que l'un est plus rapide que l'autre. </p><br><h3 id="glavnaya-problema">  ProblÃ¨me principal </h3><br><p>  De tels tests sont incorrects pour de nombreuses raisons, allant de la question aux erreurs d'implÃ©mentation.  Mais le plus important - de tels tests sont dÃ©nuÃ©s de sens <em>et en mÃªme temps</em> nocifs. </p><br><ul><li>  Ils n'ont pas de sens car ils n'ont aucune valeur pratique.  Aucun vÃ©ritable projet n'a jamais Ã©tÃ© accÃ©lÃ©rÃ© en utilisant les mÃ©thodes fournies dans ces articles.  Ce n'est pas parce que les diffÃ©rences de syntaxe sont importantes pour les performances, mais pour <strong>le traitement des donnÃ©es.</strong> </li><li>  Ils sont nuisibles car ils conduisent Ã  l'apparition des superstitions les plus folles et - pire encore - encouragent les lecteurs sans mÃ©fiance Ã  Ã©crire du mauvais code, pensant qu'ils "l'optimisent". </li></ul><br><p>  Cela devrait suffire Ã  clore la question.  Mais mÃªme si vous acceptez les rÃ¨gles du jeu et prÃ©tendez que ces Â«testsÂ» ont au moins un certain sens, il s'avÃ¨re que leurs rÃ©sultats ne se rÃ©duisent qu'Ã  une dÃ©monstration du manque de connaissances du testeur et de son manque d'expÃ©rience. <a name="habracut"></a></p><br><h3 id="odinarnye-protiv-dvoynyh">  Simple contre double </h3><br><p>  Prenez les citations notoires, "simple contre double".  Bien sÃ»r, aucune citation n'est plus rapide.  Tout d'abord, il existe un <em>cache opcode</em> , qui stocke le rÃ©sultat de l'analyse du script PHP dans le cache.  Dans ce cas, le code PHP est enregistrÃ© au format opcode, oÃ¹ les mÃªmes littÃ©raux de chaÃ®ne sont stockÃ©s en tant qu'entitÃ©s absolument identiques, quelles que soient les guillemets utilisÃ©s dans le script PHP.  Ce qui signifie l'absence mÃªme d'une diffÃ©rence thÃ©orique de performance. </p><br><p>  Mais mÃªme si nous n'utilisons pas de cache d'opcode (bien que nous le devrions, si notre tÃ¢che est vraiment d'augmenter les performances), nous constaterons que la diffÃ©rence dans le code d'analyse est si petite (plusieurs transitions conditionnelles comparant des caractÃ¨res Ã  un octet, littÃ©ralement plusieurs instructions de processeur) qu'elle sera absolument indÃ©tectable.  Cela signifie que tous les rÃ©sultats obtenus ne prÃ©senteront que des problÃ¨mes dans l'environnement de test.  Il y a un article trÃ¨s dÃ©taillÃ©, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Disproving the Single Quotes Performance Myth</a> du dÃ©veloppeur principal de PHP Nikita Popov, qui analyse ce problÃ¨me en dÃ©tail.  NÃ©anmoins, un testeur Ã©nergÃ©tique apparaÃ®t presque chaque mois pour rÃ©vÃ©ler Ã  la sociÃ©tÃ© une Â«diffÃ©renceÂ» imaginaire de performance. </p><br><h3 id="logicheskie-nestykovki">  IncohÃ©rences logiques </h3><br><p>  Certains tests sont gÃ©nÃ©ralement dÃ©nuÃ©s de sens, simplement du point de vue de la question: par exemple, le test intitulÃ© "Le lancer est-il vraiment une opÃ©ration super coÃ»teuse?"  c'est essentiellement la question "Est-ce vraiment que le traitement d'une erreur sera plus cher que le non-traitement?".  ÃŠtes-vous sÃ©rieux?  Bien sÃ»r, l'ajout de fonctionnalitÃ©s de base au code le rendra Â«plus lentÂ».  Mais cela ne signifie pas que de nouvelles fonctionnalitÃ©s ne doivent pas du tout Ãªtre ajoutÃ©es, sous un prÃ©texte aussi ridicule.  Si vous parlez comme Ã§a, alors le programme le plus rapide est celui qui ne fait rien du tout!  Le programme doit Ãªtre utile et fonctionner sans erreurs en premier lieu.  Et ce n'est qu'aprÃ¨s cela, et seulement s'il fonctionne lentement, qu'il doit Ãªtre optimisÃ©.  Mais si la question elle-mÃªme n'a pas de sens, alors pourquoi s'embÃªter Ã  tester les performances?  C'est drÃ´le que le testeur n'ait pas pu implÃ©menter correctement mÃªme ce test insensÃ©, qui sera montrÃ© dans la section suivante. </p><br><p> Ou un autre exemple, un test intitulÃ© " <code>$row[id]</code> sera-t-il vraiment plus lent que <code>$row['id']</code> ?"  c'est essentiellement la question "Quel code est le plus rapide - celui qui fonctionne avec ou sans erreur?"  (car Ã©crire <code>id</code> sans guillemets dans ce cas est une erreur du niveau <code>E_NOTICE</code> , et une telle Ã©criture sera dÃ©conseillÃ©e dans les futures versions de PHP).  WTF?  Quel est l'intÃ©rÃªt de mesurer gÃ©nÃ©ralement les performances d'un code d'erreur?  L'erreur doit Ãªtre corrigÃ©e simplement parce qu'il s'agit d'une erreur et non pas parce qu'elle ralentira l'exÃ©cution du code.  C'est drÃ´le que le testeur n'ait pas pu implÃ©menter correctement mÃªme ce test insensÃ©, qui sera montrÃ© dans la section suivante. </p><br><h3 id="kachestvo-testov">  Test de qualitÃ© </h3><br><p>  Et encore - mÃªme un test sciemment inutile devrait Ãªtre cohÃ©rent, cohÃ©rent - c'est-Ã -dire mesurer des valeurs comparables.  Mais, en rÃ¨gle gÃ©nÃ©rale, ces tests sont effectuÃ©s avec le talon gauche et, par consÃ©quent, les rÃ©sultats obtenus sont dÃ©nuÃ©s de sens et ne sont pas pertinents pour la tÃ¢che. </p><br><p>  Par exemple, notre stupide testeur a entrepris de mesurer "l'utilisation excessive de l'opÃ©rateur <code>try..catch</code> ".  Mais dans le test actuel, il a mesurÃ© non seulement le <code>try catch</code> , mais aussi le <code>throw</code> , lanÃ§ant une exception Ã  chaque itÃ©ration de la boucle.  Mais un tel test est tout simplement incorrect, car dans la rÃ©alitÃ©, des erreurs ne se produisent pas Ã  chaque exÃ©cution de script. </p><br><p>  Bien sÃ»r, les tests ne doivent pas Ãªtre effectuÃ©s sur les versions bÃªta de PHP et ne doivent pas comparer les solutions traditionnelles avec des solutions expÃ©rimentales.  Et si le testeur s'engage Ã  comparer la "vitesse d'analyse de json et xml", il ne doit pas utiliser la fonction expÃ©rimentale dans les tests. </p><br><p>  Certains tests dÃ©montrent simplement un malentendu complet par le testeur de la tÃ¢che qu'il a dÃ©finie.  Un exemple similaire tirÃ© d'un article rÃ©cemment publiÃ© a dÃ©jÃ  Ã©tÃ© mentionnÃ© ci-dessus: l'auteur du test a essayÃ© de savoir si le code Ã  l'origine de l'erreur ("Utilisation d'une constante non dÃ©finie") serait plus lent que le code sans erreur (qui utilise un littÃ©ral de chaÃ®ne syntaxiquement correct), mais a Ã©chouÃ© mÃªme avec ce test manifestement dÃ©nuÃ© de sens, en comparant les performances <em>d'un nombre citÃ©</em> avec les performances d'un nombre Ã©crit sans guillemets.  Bien sÃ»r, vous pouvez Ã©crire des nombres sans guillemets en PHP (contrairement aux chaÃ®nes), et en consÃ©quence, l'auteur a testÃ© une fonctionnalitÃ© complÃ¨tement diffÃ©rente, recevant des rÃ©sultats incorrects. </p><br><p>  Il y a d'autres problÃ¨mes Ã  considÃ©rer, tels que l'environnement de test.  Il existe des extensions de PHP telles que XDebug qui peuvent avoir un trÃ¨s gros impact sur les rÃ©sultats des tests.  Ou le cache d'opcode dÃ©jÃ  mentionnÃ©, qui doit Ãªtre inclus lors des tests de performances afin que les rÃ©sultats des tests puissent avoir au moins un certain sens. </p><br><p>  La maniÃ¨re dont les tests sont effectuÃ©s est Ã©galement importante.  Ã‰tant donnÃ© que le processus PHP meurt entiÃ¨rement aprÃ¨s chaque demande, il est logique de tester les performances de l'ensemble du cycle de vie, en commenÃ§ant par la crÃ©ation d'une connexion Ã  un serveur Web et en terminant par la fermeture de cette connexion.  Il existe des utilitaires comme Apache benchmark ou Siege qui vous permettent de le faire. </p><br><h3 id="realnoe-uluchshenie-proizvoditelnosti">  AmÃ©lioration rÃ©elle des performances </h3><br><p>  Tout cela est bien, mais quelle conclusion le lecteur doit-il tirer de cet article?  Quels tests de performances sont inutiles par dÃ©finition?  Bien sÃ»r que non.  Mais ce qui compte vraiment, c'est la <em>raison</em> pour <em>laquelle</em> ils devraient commencer.  Les tests Ã  partir de zÃ©ro sont une perte de temps.  Il doit toujours y avoir une raison spÃ©cifique pour exÃ©cuter des tests de performances.  Et cette raison est appelÃ©e <em>Â«profilageÂ»</em> .  Lorsque votre application commence Ã  s'exÃ©cuter lentement, vous devez effectuer un profilage, ce qui signifie mesurer la vitesse de diffÃ©rentes sections de code pour trouver la plus lente.  AprÃ¨s avoir trouvÃ© un tel site, nous devons dÃ©terminer la cause.  Le plus souvent, il s'agit soit d'un volume beaucoup plus important que nÃ©cessaire, de la quantitÃ© de donnÃ©es traitÃ©es ou d'une demande adressÃ©e Ã  une source de donnÃ©es externe.  Pour le premier cas, l'optimisation consistera Ã  rÃ©duire la quantitÃ© de donnÃ©es traitÃ©es, et pour le second cas, Ã  mettre en cache les rÃ©sultats de la requÃªte. </p><br><p>  Par exemple, en termes de performances, cela ne fait aucune diffÃ©rence si nous utilisons une boucle explicitement prescrite ou la fonction PHP intÃ©grÃ©e pour traiter les tableaux (qui ne sont essentiellement que du sucre syntaxique).  Ce qui est vraiment important, c'est la <em>quantitÃ© de donnÃ©es</em> que nous transmettons pour le traitement.  S'il est dÃ©raisonnablement grand, nous devons le couper ou dÃ©placer le traitement ailleurs (vers la base de donnÃ©es).  Cela nous donnera une <em>Ã©norme</em> amÃ©lioration des performances qui sera <em>rÃ©elle</em> .  Il est peu probable que la diffÃ©rence entre les mÃ©thodes d'appel de la boucle pour le traitement des donnÃ©es soit perceptible. </p><br><p>  Ce n'est qu'aprÃ¨s avoir effectuÃ© ces amÃ©liorations de performances obligatoires, ou si nous ne pouvons pas rÃ©duire la quantitÃ© de donnÃ©es traitÃ©es, que nous pouvons lancer des tests de performances.  Mais lÃ  encore, ces tests ne doivent pas Ãªtre effectuÃ©s Ã  partir de zÃ©ro.  Afin de commencer Ã  comparer les performances d'une boucle explicite et d'une fonction en ligne, nous devons Ãªtre sÃ»rs que la boucle est la cause du problÃ¨me, pas son contenu (spoiler: bien sÃ»r, c'est le contenu). </p><br><p>  Un exemple rÃ©cent de ma pratique: dans le code, il y avait une requÃªte utilisant Doctrine Query Builder, qui devait prendre plusieurs milliers de paramÃ¨tres.  La requÃªte elle-mÃªme est assez rapide, mais Doctrine met un certain temps Ã  digÃ©rer plusieurs milliers de paramÃ¨tres.  En consÃ©quence, la requÃªte a Ã©tÃ© rÃ©Ã©crite en SQL pur et les paramÃ¨tres ont Ã©tÃ© transfÃ©rÃ©s vers la mÃ©thode execute () de la bibliothÃ¨que PDO, qui gÃ¨re presque autant de paramÃ¨tres presque instantanÃ©ment. </p><br><p>  Est-ce Ã  dire que je n'utiliserai jamais Doctrine Query Builder?  Bien sÃ»r que non.  Il est parfait pour 99% des tÃ¢ches, et je continuerai Ã  l'utiliser pour toutes les requÃªtes.  Et seulement dans des cas exceptionnels, cela vaut la peine d'utiliser une mÃ©thode moins pratique, mais plus productive. </p><br><p>  La requÃªte et les paramÃ¨tres de cette sÃ©lection ont Ã©tÃ© construits en boucle.  Si j'avais une idÃ©e stupide de gÃ©rer la faÃ§on dont le cycle est appelÃ©, je perdrais simplement du temps sans rÃ©sultat positif.  Et c'est l'essence mÃªme de toutes les optimisations de performances: pour <strong>optimiser uniquement le code qui s'exÃ©cute lentement</strong> dans votre cas particulier.  Et pas le code qui Ã©tait considÃ©rÃ© comme lent il y a longtemps, dans une galaxie lointaine, lointaine, ou le code que quelqu'un a appelÃ© lent en se basant sur des tests dÃ©nuÃ©s de sens. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr419743/">https://habr.com/ru/post/fr419743/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr419727/index.html">Harbor - un registre pour les conteneurs Docker prÃªts Ã  l'emploi</a></li>
<li><a href="../fr419729/index.html">Ã‰vÃ©nement caritatif Â«Donner des ailes aux enfantsÂ»</a></li>
<li><a href="../fr419731/index.html">Mini-revue de l'imprimante 3D photopolymÃ¨re dentaire MoonRay S</a></li>
<li><a href="../fr419733/index.html">Git arrive! 6 Erreurs Git courantes et comment les corriger</a></li>
<li><a href="../fr419735/index.html">Examen du signal I / Q avec SDR Ã  l'aide d'Adobe Audition</a></li>
<li><a href="../fr419745/index.html">Genre classique de l'IA: ML se cherche dans la poÃ©sie</a></li>
<li><a href="../fr419747/index.html">DJI Ronin S - Premier lancement et fonctionnalitÃ©s clÃ©s</a></li>
<li><a href="../fr419761/index.html">CrÃ©ez un jeu 2D en Python avec la bibliothÃ¨que Arcade</a></li>
<li><a href="../fr419763/index.html">Exemples de calcul du "facteur de disponibilitÃ©" pour des ensembles d'Ã©quipements de rÃ©seau</a></li>
<li><a href="../fr419765/index.html">Le cours "Langages de programmation Web" (basÃ© sur Ruby) de MSTU. N.E. Bauman sur la chaÃ®ne Technostream</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>