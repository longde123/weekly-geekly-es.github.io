<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìÇ ü§õ ‚õé Surveillance des erreurs JavaScript avec window.onerror üßö ü•å üë®üèª‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le mat√©riel, dont nous publions la traduction aujourd'hui, est d√©di√© au traitement des erreurs JS √† l'aide de window.onerror . Il s'agit d'un √©v√©nemen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Surveillance des erreurs JavaScript avec window.onerror</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/413173/"> Le mat√©riel, dont nous publions la traduction aujourd'hui, est d√©di√© au traitement des erreurs JS √† l'aide de <code>window.onerror</code> .  Il s'agit d'un √©v√©nement sp√©cial du navigateur qui se d√©clenche lorsque des erreurs non d√©tect√©es se produisent.  Ici, nous expliquerons comment d√©tecter les erreurs √† l'aide du <code>onerror</code> √©v√©nements <code>onerror</code> et comment envoyer des informations √† leur sujet au serveur du d√©veloppeur du site Web.  Ce gestionnaire peut √™tre utilis√© comme base de votre propre syst√®me de collecte et d'analyse des informations d'erreur.  De plus, il s'agit de l'un des m√©canismes les plus importants utilis√©s dans les biblioth√®ques orient√©es erreur, telles que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">raven-js</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/11f/1b9/ddc/11f1b9ddcfdd735951758c0f56d57a03.jpg" alt="image"></a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">√âcoute de l'√©v√©nement window.onerror</font> </h2><br>  Vous pouvez √©couter l'√©v√©nement <code>onerror</code> en affectant <code>window.onerror</code> fonction qui agit comme un gestionnaire d'erreur: <br><br><pre> <code class="hljs lua">window.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(msg, url, lineNo, columnNo, error)</span></span></span></span> { // ...   ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  Cette fonction est appel√©e lorsqu'une erreur se produit; les arguments suivants lui sont transmis: <br><br><ul><li>  <code>msg</code> - message d'erreur.  Par exemple, <code>Uncaught ReferenceError: foo is not defined</code> . </li><li>  <code>url</code> - l'adresse du script ou du document dans lequel l'erreur s'est produite.  Par exemple, <code>/dist/app.js</code> . </li><li>  <code>lineNo</code> - num√©ro de ligne o√π l'erreur s'est produite (si prise en charge). </li><li>  <code>columnNo</code> - le num√©ro de colonne de la ligne (si pris en charge). </li><li>  <code>error</code> - l'objet d' <code>error</code> (s'il est pris en charge). </li></ul><br>  Les quatre premiers arguments indiquent au d√©veloppeur quel script, dans quelle ligne et dans quelle colonne de cette ligne une erreur s'est produite.  Le dernier argument, un objet de type <code>Error</code> , est peut-√™tre le plus important de tous les arguments.  Parlons-en. <br><br><h2>  <font color="#3AC1EF">Objet d'erreur et propri√©t√© Error.prototype.stack</font> </h2><br>  √Ä premi√®re vue, l'objet <code>Error</code> n'a rien de sp√©cial.  Il contient trois propri√©t√©s assez standard - <code>message</code> , <code>fileName</code> et <code>lineNumber</code> .  Ces donn√©es, compte tenu des informations transmises au gestionnaire d'√©v√©nements <code>window.onerror</code> , peuvent √™tre consid√©r√©es comme redondantes. <br><br>  La valeur r√©elle dans ce cas est la propri√©t√© non standard <code>Error.prototype.stack</code> .  Cette propri√©t√© donne acc√®s √† la pile des appels (pile des erreurs), vous permet de savoir ce qui se passait dans le programme au moment de l'erreur, quel appel de fonction a pr√©c√©d√© son apparition.  Le suivi de la pile d'appels peut √™tre un √©l√©ment essentiel du processus de d√©bogage.  Et, malgr√© le fait que la propri√©t√© de <code>stack</code> n'est pas standard, elle est disponible dans tous les navigateurs modernes. <br><br>  Voici √† quoi ressemble la propri√©t√© de <code>stack</code> de l'objet d'erreur dans Chrome 46. <br><br><pre> <code class="hljs css">"<span class="hljs-selector-tag"><span class="hljs-selector-tag">Error</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">foobar</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>    <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">new</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bar</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:241</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:11)</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>    <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">foo</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:245</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5)</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:250</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>    <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:251</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:3</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:267</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">callFunction</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:229</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:33)</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>    <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:239</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:23</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:240</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:3</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.InjectedScript</span></span>.\_<span class="hljs-selector-tag"><span class="hljs-selector-tag">evaluateOn</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:875</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:140)</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>    <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.InjectedScript</span></span>.\_<span class="hljs-selector-tag"><span class="hljs-selector-tag">evaluateAndWrap</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:808</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:34)"</span></span></code> </pre> <br>  Devant nous se trouve une cha√Æne non format√©e.  Lorsque le contenu de cette propri√©t√© est pr√©sent√© sous cette forme, il n'est pas pratique de travailler avec elle.  Voici √† quoi cela ressemblera apr√®s le formatage. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Error</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">foobar</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">new</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bar</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:241</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:11)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">foo</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:245</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">callFunction</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:229</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:33)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.InjectedScript</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">._evaluateOn</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:875</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:140)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.InjectedScript</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">._evaluateAndWrap</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:808</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:34)</span></span></code> </pre> <br>  Maintenant, apr√®s le formatage, la pile des erreurs semble beaucoup plus claire, il devient imm√©diatement clair pourquoi la propri√©t√© de la <code>stack</code> est tr√®s importante lors du d√©bogage des erreurs. <br><br>  Cependant, ici, tout ne se passe pas bien.  La propri√©t√© de <code>stack</code> n'est pas normalis√©e; elle est impl√©ment√©e diff√©remment dans diff√©rents navigateurs.  Voici, par exemple, √† quoi ressemble la pile d'erreurs dans Internet Explorer 11. <br><br><pre> <code class="hljs powershell">Error: foobar at bar (Unknown script code:<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span>) at foo (Unknown script code:<span class="hljs-number"><span class="hljs-number">6</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span>) at Anonymous <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Unknown script code:11:5)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">at</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Anonymous</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Unknown script code:10:2)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">at</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Anonymous</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Unknown script code:1:73)</span></span></span></span></code> </pre> <br>  Vous pouvez voir, par rapport √† l'exemple pr√©c√©dent, qu'ici non seulement un format diff√©rent pour repr√©senter les trames de pile est utilis√©, mais aussi qu'il y a moins de donn√©es pour chaque trame.  Par exemple, Chrome identifie les instances d'utilisation du <code>new</code> mot cl√© et fournit des informations plus d√©taill√©es sur d'autres √©v√©nements (en particulier, sur les appels de fonction. <code>_evaluateOn</code> et. <code>_evaluateAndWrap</code> ).  Dans le m√™me temps, nous n'avons compar√© ici que ce que IE et Chrome donnent.  D'autres navigateurs utilisent leurs propres approches pour afficher des donn√©es sur la pile et pour s√©lectionner les informations incluses dans ces donn√©es. <br><br>  Afin de rendre tout cela uniforme, vous pouvez utiliser des outils tiers.  Par exemple, raven-js utilise TraceKit pour cela.  Stacktrace.js et certains autres projets ont le m√™me objectif. <br><br><h2>  <font color="#3AC1EF">Caract√©ristiques de la prise en charge de window.onerror par divers navigateurs</font> </h2><br>  L'√©v√©nement <code>windows.onerror</code> existe dans les navigateurs depuis un certain temps.  En particulier, il peut √™tre trouv√© dans IE6 et Firefox 2. Le probl√®me ici est que tous les navigateurs impl√©mentent <code>windows.onerror</code> de diff√©rentes mani√®res.  Par exemple, cela concerne le nombre et la structure des arguments pass√©s aux gestionnaires de cet √©v√©nement. <br><br>  Voici un tableau <code>onerror</code> arguments pass√©s au gestionnaire <code>onerror</code> dans les principaux navigateurs. <br><table><tbody><tr><td>  Navigateur <br></td><td>  message <br></td><td>  url <br></td><td>  ligneNon <br></td><td>  colNo <br></td><td>  errorObj <br></td></tr><tr><td>  Firefox <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td></tr><tr><td>  Chrome <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td></tr><tr><td>  Bord <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td></tr><tr><td>  IE 11 <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td></tr><tr><td>  IE10 <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Non <br></td></tr><tr><td>  IE 9.8 <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Non <br></td><td>  Non <br></td></tr><tr><td>  Safari 10 et sup√©rieur <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td></tr><tr><td>  Safari 9 <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Non <br></td></tr><tr><td>  Navigateur Android 4.4 <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Il y a <br></td><td>  Non <br></td></tr></tbody></table><br>  Sans surprise, Internet Explorer 8, 9 et 10 ont un support limit√© pour <code>onerror</code> .  Cependant, il peut sembler inhabituel que dans le navigateur Safari, la prise en charge de l'objet d'erreur n'apparaisse que dans la 10e version, publi√©e en 2016.  En outre, certains appareils mobiles h√©rit√©s utilisent le navigateur Android standard, qui ne prend pas en charge l'objet d'erreur.  Dans les versions modernes d'Android, ce navigateur a √©t√© remplac√© par Chrome Mobile. <br><br>  S'il n'y a pas d'objet d'erreur √† notre disposition, alors il n'y a pas de donn√©es sur la trace de la pile.  Cela signifie que les navigateurs qui ne prennent pas en charge l'objet de l'erreur ne fournissent pas d'informations de pile dans le script standard pour utiliser le gestionnaire <code>onerror</code> .  Et cela, comme nous l'avons dit, est tr√®s important. <br><br><h2>  <font color="#3AC1EF">D√©veloppement Polyfill pour window.onerror utilisant la construction try / catch</font> </h2><br>  Afin d'obtenir des informations sur la pile dans les navigateurs qui ne prennent pas en charge la transmission d'un objet d' <code>onerror</code> au gestionnaire <code>onerror</code> , vous pouvez utiliser l'astuce suivante.  Vous pouvez encapsuler le code dans une construction <code>try/catch</code> et intercepter les erreurs vous-m√™me.  L'objet d'erreur r√©sultant contiendra, dans tous les navigateurs modernes, ce dont nous avons besoin, c'est la propri√©t√© <code>stack</code> . <br>  Jetez un ≈ìil au code de la m√©thode d'assistance <code>invoke()</code> , qui appelle la m√©thode donn√©e de l'objet, en lui passant un tableau d'arguments. <br><br><pre> <code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(obj, method, args)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj[<span class="hljs-type"><span class="hljs-type">method</span></span>].apply(this,args); }</code> </pre> <br>  Voici comment l'utiliser. <br><br><pre> <code class="hljs lisp">invoke(<span class="hljs-name"><span class="hljs-name">Math</span></span>, 'max', [<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>])<span class="hljs-comment"><span class="hljs-comment">; //  2</span></span></code> </pre> <br>  Voici la m√™me <code>invoke()</code> , mais maintenant l'appel de m√©thode est encapsul√© dans <code>try/catch</code> , ce qui vous permet d'attraper les erreurs possibles. <br><br><pre> <code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(obj, method, args)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj[<span class="hljs-type"><span class="hljs-type">method</span></span>].apply(this,args); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(e) {   captureError(e);//      <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e;//      } } invoke(Math,<span class="hljs-string"><span class="hljs-string">'highest'</span></span>,[<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>]); //  ,     Math.highest</code> </pre> <br>  Bien s√ªr, il est tr√®s co√ªteux d'ajouter manuellement de telles structures √† tous les endroits o√π elles peuvent √™tre n√©cessaires.  Cette t√¢che peut √™tre simplifi√©e en cr√©ant une fonction d'assistance universelle. <br><br><pre> <code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapErrors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fn)</span></span></span></span> { //      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!fn.__wrapped__) {   fn.__wrapped__ = function() {     <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fn.apply(this,arguments);     }<span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(e){       captureError(e);//          <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e;//          }   }; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fn.__wrapped__; } var invoke = wrapErrors(function(obj, method, args) { returnobj[<span class="hljs-type"><span class="hljs-type">method</span></span>].apply(this,args); }); invoke(Math,<span class="hljs-string"><span class="hljs-string">'highest'</span></span>,[<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>]);//,   Math.highest</code> </pre> <br>  √âtant donn√© que JavaScript utilise un mod√®le d'ex√©cution de code √† thread unique, ce wrapper ne doit √™tre utilis√© qu'avec les appels de fonction qui se trouvent au d√©but de nouvelles piles.  Il n'est pas n√©cessaire d'envelopper tous les appels de fonction. <br><br>  En cons√©quence, il s'av√®re que cette fonction doit √™tre utilis√©e aux endroits suivants: <br><br><ul><li>  O√π l'application d√©marre (par exemple, lors de l'utilisation de jQuery, dans la fonction <code>$(document).ready</code> ) </li><li>  Dans les gestionnaires d'√©v√©nements (par exemple, dans <code>addEventListener</code> ou dans les constructions de la forme <code>$.fn.click</code> ) </li><li>  Dans les rappels appel√©s par des √©v√©nements de temporisation (par exemple, il s'agit de <code>setTimeout</code> ou <code>requestAnimationFrame</code> ) </li></ul><br>  Voici un exemple d'utilisation de la fonction <code>wrapErrors</code> . <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span>(wrapErrors(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {//    doSynchronousStuff1();//     setTimeout(wrapErrors(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {   doSynchronousStuff2();//      })); <span class="hljs-variable"><span class="hljs-variable">$</span></span>(<span class="hljs-string"><span class="hljs-string">'.foo'</span></span>).click(wrapErrors(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {   doSynchronousStuff3();//     })); }));</code> </pre> <br>  De telles constructions peuvent √™tre ajout√©es au code vous-m√™me, mais cette t√¢che prend trop de temps.  Comme alternative pratique dans de telles situations, vous pouvez envisager des biblioth√®ques pour travailler avec les erreurs, qui, par exemple, ont des m√©canismes qui <code>addEventListener</code> et <code>setTimeout</code> outils pour d√©tecter les erreurs. <br><br><h2>  <font color="#3AC1EF">Erreur de transfert vers le serveur</font> </h2><br>  Donc, nous avons maintenant √† notre disposition des moyens pour intercepter les informations sur les erreurs en utilisant <code>windows.onerror</code> ou en utilisant des fonctions auxiliaires bas√©es sur <code>try/catch</code> .  Ces erreurs se produisent du c√¥t√© client et, apr√®s leur interception, nous aimerions les traiter et prendre des mesures pour les √©liminer.  Pour ce faire, ils doivent √™tre transf√©r√©s sur notre serveur.  Pour ce faire, vous devez pr√©parer un service Web qui recevrait des informations sur les erreurs via HTTP, puis les enregistrer d'une mani√®re ou d'une autre pour un traitement ult√©rieur, par exemple - √©crire dans un fichier journal ou une base de donn√©es. <br><br>  Si ce service Web se trouve sur le m√™me domaine que l'application Web, <code>XMLHttpRequest</code> suffira.  L'exemple suivant montre comment utiliser une fonction pour ex√©cuter des requ√™tes AJAX √† partir de jQuery pour transf√©rer des donn√©es vers un serveur. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> captureError(ex){ var errorData = {   <span class="hljs-type"><span class="hljs-type">name</span></span>:ex.name,// : ReferenceError   message:ex.line,// : x <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> undefined   url:document.<span class="hljs-keyword"><span class="hljs-keyword">location</span></span>.href,   stack:ex.stack//   ; ,     ! }; $.post(<span class="hljs-string"><span class="hljs-string">'/logger/js/'</span></span>,{   data:errorData }); }</code> </pre> <br>  Gardez √† l'esprit que si vous devez envoyer des demandes interdomaines pour envoyer des informations sur les erreurs au serveur, vous devrez prendre en charge ces demandes. <br><br><h2>  <font color="#3AC1EF">R√©sum√©</font> </h2><br>  Vous avez appris les bases de la cr√©ation d'un service pour d√©tecter les erreurs et envoyer des informations √† leur sujet au serveur.  En particulier, nous avons examin√© ici les questions suivantes: <br><br><ul><li>  Caract√©ristiques de l'√©v√©nement <code>onerror</code> et son support dans divers navigateurs. </li><li>  Utilisation du m√©canisme <code>try/catch</code> pour obtenir des informations sur la pile d'appels dans les cas o√π <code>onerror</code> ne prend pas en charge l'utilisation de l'objet d'erreur. </li><li>  Transf√©rez les donn√©es d'erreur sur le serveur du d√©veloppeur. </li></ul><br>  Apr√®s avoir appris comment fonctionnent les m√©canismes ci-dessus, vous avez acquis des connaissances de base qui vous permettront de commencer √† cr√©er votre propre syst√®me pour traiter les erreurs, en clarifiant des d√©tails suppl√©mentaires pendant le travail.  Ce sc√©nario est peut-√™tre particuli√®rement pertinent dans les cas o√π il s'agit d'une certaine application dans laquelle, par exemple, pour des raisons de s√©curit√©, il n'est pas pr√©vu d'utiliser des biblioth√®ques tierces.  Si votre application autorise l'utilisation de code tiers, vous pouvez tr√®s bien trouver le bon outil pour surveiller les erreurs JS.  Parmi ces outils figurent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sentry</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Rollbar</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">TrackJS</a> et d'autres projets similaires. <br><br>  <b>Chers lecteurs!</b>  Quels outils de surveillance des erreurs JS utilisez-vous? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413173/">https://habr.com/ru/post/fr413173/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr413163/index.html">Faiblesses HTTPS. 2e partie</a></li>
<li><a href="../fr413165/index.html">Explication SRTP</a></li>
<li><a href="../fr413167/index.html">Comment int√©grer Zimbra √† un syst√®me DLP?</a></li>
<li><a href="../fr413169/index.html">Array et m√©thodes d'objets utiles en JavaScript</a></li>
<li><a href="../fr413171/index.html">Tokamak JET lance une nouvelle campagne sur le deut√©rium tritium</a></li>
<li><a href="../fr413175/index.html">Analyse statique dans Go: comment gagner du temps lors de la v√©rification du code</a></li>
<li><a href="../fr413177/index.html">√âv√©nements num√©riques √† Moscou du 4 au 10 juin</a></li>
<li><a href="../fr413181/index.html">Lorsque les appels de fonctions externes sont plus rapides que les appels C natifs</a></li>
<li><a href="../fr413183/index.html">M√©moire persistante Optane DC - Optane au format DIMM</a></li>
<li><a href="../fr413185/index.html">Jeu d√©loyal ou comment les organisateurs du tirage nous trompent</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>