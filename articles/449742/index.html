<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÜö üòÉ üîÇ Proceso de desarrollo y prueba con Docker y Gitlab CI üßëüèº‚Äçü§ù‚Äçüßëüèº ‚õàÔ∏è üçì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le sugiero que se familiarice con la transcripci√≥n del informe de Alexander Sigachev de Inventos "El proceso de desarrollo y prueba con Docker + Gitla...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Proceso de desarrollo y prueba con Docker y Gitlab CI</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/449742/"><p>  <strong>Le sugiero que se familiarice con la transcripci√≥n del informe de Alexander Sigachev de Inventos "El proceso de desarrollo y prueba con Docker + Gitlab CI"</strong> </p><br><p>  Aquellos que reci√©n comienzan a implementar el proceso de desarrollo y prueba basado en Docker + Gitlab CI a menudo hacen preguntas b√°sicas.  Por donde empezar  ¬øC√≥mo organizarlo?  ¬øC√≥mo hacer la prueba? </p><br><p>  Este informe es bueno para informarle de manera estructurada sobre el proceso de desarrollo y prueba utilizando Docker y Gitlab CI.  Informe 2017 en s√≠.  Creo que de este informe puede extraer los conceptos b√°sicos, la metodolog√≠a, la idea y la experiencia de uso. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/lJsqRwULRVA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  A qui√©n le importa, por favor, debajo del gato. <a name="habracut"></a></p><br><p>  Me llamo Alexander Sigachev.  Yo trabajo para Inventos.  Le contar√© sobre mi experiencia en el uso de Docker y c√≥mo la estamos implementando gradualmente en proyectos en la empresa. </p><br><p>  Tema: Proceso de desarrollo utilizando Docker y Gitlab CI. </p><br><p><img src="https://habrastorage.org/webt/iu/r2/qt/iur2qtjwp2qa_f4vdvmetzii-no.png"></p><br><p>  Esta es mi segunda charla sobre Docker.  En el momento del primer informe, utilizamos Docker solo en Desarrollo en m√°quinas de desarrollo.  El n√∫mero de empleados que usaron Docker fue de aproximadamente 2-3 personas.  Poco a poco, se gan√≥ experiencia y avanzamos un poco m√°s.  Enlace a nuestro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">primer informe</a> . </p><br><p>  ¬øQu√© habr√° en este informe?  Compartiremos nuestra experiencia sobre qu√© rastrillo recolectamos, qu√© problemas resolvimos.  No en todas partes era hermoso, pero se le permiti√≥ seguir adelante. </p><br><p>  Nuestro lema es: dockerizar todo lo que alcanzan nuestras manos. </p><br><p><img src="https://habrastorage.org/webt/rg/wx/pb/rgwxpblyvmjf0hb0ly4eecmntf0.png"></p><br><p>  ¬øQu√© problemas resolvemos? </p><br><p>  Cuando una empresa tiene varios equipos, el programador es un recurso compartido.  Hay etapas en las que un programador se retira de un proyecto y se entrega por alg√∫n tiempo a otro proyecto. </p><br><p>  Para que el programador pueda profundizar r√°pidamente en √©l, necesita descargar el c√≥digo fuente del proyecto y lanzar el entorno lo antes posible, lo que le permitir√° avanzar m√°s en la soluci√≥n de los problemas de este proyecto. </p><br><p>  Por lo general, si comienza desde cero, la documentaci√≥n del proyecto no es suficiente.  Solo los veteranos tienen informaci√≥n sobre c√≥mo configurar.  Los empleados configuran independientemente su lugar de trabajo en uno o dos d√≠as.  Para acelerar esto, usamos Docker. </p><br><p>  La siguiente raz√≥n es la estandarizaci√≥n de la configuraci√≥n en Desarrollo.  En mi experiencia, los desarrolladores siempre toman la iniciativa.  En cada quinto caso, se ingresa un dominio personalizado, por ejemplo, vasya.dev.  Cerca est√° la vecina Petya, cuyo dominio es petya.dev.  Est√°n desarrollando un sitio web o alg√∫n componente del sistema utilizando este nombre de dominio. </p><br><p>  Cuando el sistema crece y estos nombres de dominio comienzan a caer en la configuraci√≥n, entonces hay un conflicto de entornos de desarrollo y la ruta del sitio se reescribe. </p><br><p> Lo mismo sucede con la configuraci√≥n de la base de datos.  Alguien no se molesta con la seguridad y trabaja con una contrase√±a de root vac√≠a.  Alguien en la etapa de instalaci√≥n MySQL exigi√≥ una contrase√±a y la contrase√±a result√≥ ser una 123. A menudo sucede que la configuraci√≥n de la base de datos cambia constantemente dependiendo del compromiso del desarrollador.  Alguien corrigi√≥, alguien no corrigi√≥ la configuraci√≥n.  Hubo trucos cuando <code>.gitignore</code> alg√∫n tipo de configuraci√≥n de prueba en <code>.gitignore</code> y cada desarrollador ten√≠a que instalar una base de datos.  Esto complica el proceso de inicio.  Entre otras cosas, debe recordar acerca de la base de datos.  Se debe inicializar la base de datos, se debe registrar una contrase√±a, se debe registrar un usuario, se debe crear una placa, etc. </p><br><p>  Otro problema son las diferentes versiones de las bibliotecas.  A menudo sucede que un desarrollador trabaja con diferentes proyectos.  Hay un proyecto Legacy que comenz√≥ hace cinco a√±os (desde 2017 - nota. Ed.).  Al principio, comenzamos con MySQL 5.5.  Tambi√©n hay proyectos modernos en los que estamos tratando de introducir versiones m√°s modernas de MySQL, por ejemplo 5.7 o m√°s antiguas (en 2017 - nota. Ed.) </p><br><p>  Cualquiera que trabaje con MySQL sabe que estas bibliotecas est√°n obteniendo dependencias.  Es bastante problem√°tico correr 2 bases juntas.  Como m√≠nimo, es problem√°tico para los clientes antiguos conectarse a la nueva base de datos.  Esto a su vez causa varios problemas. </p><br><p>  El siguiente problema es cuando el desarrollador trabaja en la m√°quina local, usa recursos locales, archivos locales, RAM local.  Toda la interacci√≥n a la hora de desarrollar la soluci√≥n al problema se lleva a cabo en el marco del hecho de que funciona en una m√°quina.  Un ejemplo es cuando tenemos un servidor de back-end en Production 3, y el desarrollador guarda los archivos en el directorio ra√≠z y desde all√≠ nginx toma los archivos para responder a la solicitud.  Cuando dicho c√≥digo cae en Producci√≥n, resulta que el archivo est√° presente en uno de los 3 servidores. </p><br><p>  Ahora se est√° desarrollando la direcci√≥n de los microservicios.  Cuando dividimos nuestras aplicaciones grandes en algunos componentes peque√±os que interact√∫an entre s√≠.  Esto le permite seleccionar tecnolog√≠a para una pila de tareas espec√≠fica.  Tambi√©n le permite compartir el trabajo y el √°rea de responsabilidad entre los desarrolladores. </p><br><p>  El desarrollador de Frondend, que se desarrolla en JS, pr√°cticamente no afecta a Backend.  El desarrollador de back-end, a su vez, desarrolla, en nuestro caso, Ruby on Rails y no interfiere con Frondend.  La interacci√≥n se realiza utilizando la API. </p><br><p>  Como beneficio adicional, con Docker pudimos utilizar recursos en la puesta en escena.  Cada proyecto, debido a su especificidad, requer√≠a ciertas configuraciones.  F√≠sicamente, era necesario seleccionar un servidor virtual y configurarlos por separado, o compartir alg√∫n tipo de entorno variable, y los proyectos podr√≠an influirse entre s√≠ seg√∫n la versi√≥n de las bibliotecas. </p><br><p><img src="https://habrastorage.org/webt/ue/fu/5h/uefu5hbokfkhivcwpffwt5xi4hi.png"></p><br><p>  Herramientas  Que utilizamos </p><br><ul><li>  Directamente Docker en s√≠.  Dockerfile describe las dependencias de una aplicaci√≥n. </li><li>  Docker-compose es un paquete que re√∫ne algunas de nuestras aplicaciones Docker. </li><li>  GitLab lo usamos para almacenar el c√≥digo fuente. </li><li>  Utilizamos GitLab-CI para la integraci√≥n del sistema. </li></ul><br><p><img src="https://habrastorage.org/webt/yq/z-/zb/yqz-zbkwsjbklpjpkxf6pzqasya.png"></p><br><p>  El informe consta de dos partes. </p><br><p>  La primera parte hablar√° sobre c√≥mo ejecutar Docker en m√°quinas de desarrollo. </p><br><p>  La segunda parte hablar√° sobre c√≥mo interactuar con GitLab, c√≥mo ejecutamos pruebas y c√≥mo implementamos Staging. </p><br><p><img src="https://habrastorage.org/webt/tk/4w/lm/tk4wlm_ul847kzentzlw1ikjypq.png"></p><br><p>  Docker es una tecnolog√≠a que permite (utilizando un enfoque declarativo) describir los componentes necesarios.  Este es un ejemplo de un Dockerfile.  Aqu√≠ anunciamos que estamos heredando de la imagen oficial de Ruby Docker: 2.3.0.  Contiene la versi√≥n 2.3 instalada de Ruby.  Instalamos las bibliotecas de compilaci√≥n necesarias y NodeJS.  Describimos que creamos el directorio <code>/app</code> .  Asigne el directorio de la aplicaci√≥n al directorio de trabajo.  En este directorio colocamos el m√≠nimo Gemfile y Gemfile.lock necesarios.  Luego construimos los proyectos que instalan esta imagen de dependencia.  Indicamos que el contenedor estar√° listo para escuchar en el puerto externo 3000. El √∫ltimo comando es el comando que inicia directamente nuestra aplicaci√≥n.  Si ejecutamos el comando de inicio del proyecto, la aplicaci√≥n intentar√° ejecutar y ejecutar el comando especificado. </p><br><p><img src="https://habrastorage.org/webt/yc/vn/mp/ycvnmp4_o5pcl9r9hobxbchmntw.png"></p><br><p>  Este es un ejemplo m√≠nimo de un archivo docker-compose.  En este caso, mostramos que hay una conexi√≥n entre los dos contenedores.  Esto es directamente al servicio de base de datos y al servicio web.  Nuestras aplicaciones web en la mayor√≠a de los casos requieren alg√∫n tipo de base de datos como back-end para almacenar datos.  Como usamos MySQL, el ejemplo es con MySQL, pero nada nos impide usar alg√∫n tipo de base de datos de amigos (PostgreSQL, Redis). </p><br><p>  Tomamos la imagen MySQL 5.7.14 de la fuente oficial con el centro Docker sin cambios.  La imagen que es responsable de nuestra aplicaci√≥n web que recopilamos del directorio actual.  √âl, durante el primer lanzamiento, recopila una imagen para nosotros.  Luego lanza el comando que ejecutamos aqu√≠.  Si volvemos, veremos que se ha definido el comando de lanzamiento a trav√©s de Puma.  Puma es un servicio escrito en Ruby.  En el segundo caso, redefinimos.  Este comando puede ser arbitrario seg√∫n nuestras necesidades o tareas. </p><br><p>  Tambi√©n describimos lo que necesita para reenviar el puerto en nuestra m√°quina host del contenedor de 3000 a 3000 puertos.  Esto se hace autom√°ticamente usando iptables y su propio mecanismo, que est√° directamente integrado en Docker. </p><br><p>  El desarrollador puede, como antes, aplicar a cualquier direcci√≥n IP disponible, por ejemplo, 127.0.0.1 direcci√≥n IP local o externa de la m√°quina. </p><br><p>  La √∫ltima l√≠nea dice que el contenedor web depende del contenedor db.  Cuando llamamos al lanzamiento del contenedor web, docker-compose iniciar√° la base de datos por nosotros.  Ya al ‚Äã‚Äãcomienzo de la base de datos (de hecho, ¬°despu√©s de iniciar el contenedor! Esto no garantiza la disponibilidad de la base de datos), lanzaremos una aplicaci√≥n, nuestro backend. </p><br><p>  Esto le permite evitar errores cuando la base de datos no se genera y le permite ahorrar recursos cuando detenemos el contenedor de la base de datos, liberando los recursos para otros proyectos. </p><br><p><img src="https://habrastorage.org/webt/s3/r1/9g/s3r19gc5pybevceyecewxzsdyxq.png"></p><br><p>  Lo que nos da el uso de la base de datos de dockerizaci√≥n en el proyecto.  Todos los desarrolladores arreglamos la versi√≥n de MySQL.  Esto le permite evitar algunos errores que pueden ocurrir cuando hay una divergencia de versiones, cuando la sintaxis, la configuraci√≥n y la configuraci√≥n predeterminada cambian.  Esto le permite especificar un nombre de host com√∫n para la base de datos, inicio de sesi√≥n, contrase√±a.  Nos alejamos de los nombres de zool√≥gicos y conflictos en los archivos de configuraci√≥n que eran anteriores. </p><br><p>  Podemos usar una configuraci√≥n m√°s √≥ptima para el entorno de Desarrollo, que ser√° diferente de la predeterminada.  MySQL est√° configurado de forma predeterminada en m√°quinas d√©biles y su rendimiento inmediato es muy bajo. </p><br><p><img src="https://habrastorage.org/webt/b2/qh/uz/b2qhuzt2zgbx5upj9etfnoilrnw.png"></p><br><p>  Docker le permite utilizar el int√©rprete Python, Ruby, NodeJS, PHP de la versi√≥n deseada.  Nos libramos de la necesidad de utilizar alg√∫n tipo de administrador de versiones.  Anteriormente, Ruby usaba el paquete rpm, que permit√≠a cambiar la versi√≥n seg√∫n el proyecto.  Esto tambi√©n permite que el contenedor Docker migre suavemente el c√≥digo y lo versione junto con las dependencias.  No tenemos problemas para entender la versi√≥n del int√©rprete y el c√≥digo.  Para actualizar la versi√≥n, baje el contenedor anterior y suba el nuevo contenedor.  Si algo sali√≥ mal, podemos bajar el nuevo contenedor, levantar el viejo contenedor. </p><br><p>  Despu√©s de ensamblar la imagen, los contenedores tanto en Desarrollo como en Producci√≥n ser√°n los mismos.  Esto es especialmente cierto para grandes instalaciones. </p><br><p><img src="https://habrastorage.org/webt/c3/vy/yx/c3vyyxestdms3fuo6vqpst5hhus.png">  En Frontend, usamos JavaScipt y NodeJS. </p><br><p>  Ahora tenemos el √∫ltimo proyecto en ReacJS.  El desarrollador ejecut√≥ todo el contenedor y lo desarroll√≥ utilizando la recarga en caliente. </p><br><p>  A continuaci√≥n, se inicia la tarea de ensamblar JavaScipt y el c√≥digo recopilado en las estad√≠sticas se proporciona a trav√©s de recursos de ahorro nginx. </p><br><p><img src="https://habrastorage.org/webt/6k/8y/ds/6k8yds401e1tmspqtvsnpv9hyq8.png"></p><br><p>  Aqu√≠ les di un diagrama de nuestro √∫ltimo proyecto. </p><br><p>  ¬øQu√© tareas resolviste?  Tenemos la necesidad de construir un sistema con el que interact√∫en los dispositivos m√≥viles.  Obtienen datos.  Una de las opciones es enviar notificaciones push a este dispositivo. </p><br><p>  ¬øQu√© hemos hecho para esto? </p><br><p>  Nos dividimos en componentes de aplicaci√≥n como: la parte de administraci√≥n en JS, el backend, que funciona a trav√©s de la interfaz REST en Ruby on Rails.  El backend interact√∫a con la base de datos.  El resultado que se genera se entrega al cliente.  El administrador con el backend y la base de datos interact√∫a a trav√©s de la interfaz REST. </p><br><p>  Tambi√©n necesit√°bamos enviar notificaciones push.  Antes de eso, ten√≠amos un proyecto en el que se implement√≥ un mecanismo que se encarga de entregar notificaciones a las plataformas m√≥viles. </p><br><p>  Desarrollamos dicho esquema: el operador del navegador interact√∫a con el panel de administraci√≥n, el panel de administraci√≥n interact√∫a con el backend, la tarea es enviar notificaciones Push. </p><br><p>  Las notificaciones push interact√∫an con otro componente que se implementa en NodeJS. </p><br><p>  Se est√°n creando colas y luego el env√≠o de notificaciones sigue su propio mecanismo. </p><br><p>  Aqu√≠ se dibujan dos bases de datos.  Por el momento, con la ayuda de Docker, utilizamos 2 bases de datos independientes, que de ninguna manera est√°n conectadas entre s√≠.  Adem√°s, tienen una red virtual com√∫n y los datos f√≠sicos se almacenan en diferentes directorios en la m√°quina del desarrollador. </p><br><p><img src="https://habrastorage.org/webt/7l/vd/iz/7lvdizkbaiozesiqkfy6zeu0ila.png"></p><br><p>  Lo mismo, pero en n√∫meros.  Reutilizar el c√≥digo es importante aqu√≠. </p><br><p>  Si anteriormente hablamos sobre la reutilizaci√≥n de c√≥digo en forma de bibliotecas, en este ejemplo, nuestro servicio, que responde a notificaciones push, se reutiliza como un servidor completo.  Proporciona una API.  Y ya con nuestro nuevo desarrollo interact√∫a con √©l. </p><br><p>  En ese momento, utilizamos la versi√≥n 4 de NodeJS.  Ahora (en 2017 - nota. Ed.) En desarrollos recientes utilizamos la versi√≥n 7 de NodeJS.  No hay problema en nuevos componentes para atraer nuevas versiones de bibliotecas. </p><br><p>  Si es necesario, puede refactorizar y actualizar la versi√≥n NodeJS del servicio de notificaci√≥n Push. </p><br><p>  Y si podemos mantener la compatibilidad de la API, podemos reemplazarla con otros proyectos que se utilizaron anteriormente. </p><br><p><img src="https://habrastorage.org/webt/wd/xv/4a/wdxv4acjvor1iz_4ay2iaxhwylg.png"></p><br><p>  ¬øQu√© necesitas para agregar Docker?  Agregue un Dockerfile a nuestro repositorio que describa las dependencias necesarias.  En este ejemplo, los componentes se desglosan por l√≥gica.  Este es un conjunto m√≠nimo de desarrolladores de back-end. </p><br><p>  Al crear un nuevo proyecto, cree un Dockerfile, describa el ecosistema deseado (Python, Ruby, NodeJS).  Docker-compose describe la dependencia necesaria: la base de datos.  Describimos que necesitamos una base de datos de tal o cual versi√≥n, para almacenar los datos all√≠ en alg√∫n lugar. </p><br><p>  Usamos un tercer contenedor separado con nginx para representar est√°tico.  Puedes subir fotos.  Backend los coloca en un volumen preparado previamente, que tambi√©n se monta en un contenedor con nginx, que proporciona est√°tica. </p><br><p>  Para almacenar la configuraci√≥n nginx, mysql, agregamos la carpeta Docker, en la que almacenamos las configuraciones necesarias.  Cuando un desarrollador crea un repositorio git clone en su m√°quina, ya tiene un proyecto listo para el desarrollo local.  La pregunta no surge sobre qu√© puerto o qu√© configuraciones aplicar. </p><br><p><img src="https://habrastorage.org/webt/vx/by/f2/vxbyf2i8sss85npgtavlhvgoe10.png"></p><br><p>  Adem√°s, tenemos varios componentes: admin, inform-API, notificaciones push. </p><br><p>  Para ejecutarlo todo, creamos otro repositorio llamado dockerized-app.  Actualmente, utilizamos varios repositorios para cada componente.  Simplemente difieren l√≥gicamente: en GitLab parece una carpeta, y en la m√°quina del desarrollador, una carpeta para un proyecto espec√≠fico.  Un nivel a continuaci√≥n son los componentes que se combinar√°n. </p><br><p><img src="https://habrastorage.org/webt/jd/ny/wq/jdnywqfo2xha1huuqqmnhb1bvpm.png"></p><br><p>  Este es un ejemplo de los contenidos de la aplicaci√≥n dockerized.  Tambi√©n traemos el cat√°logo de Docker aqu√≠, en el que completamos las configuraciones necesarias para las interacciones de todos los componentes.  Hay README.md, que describe brevemente c√≥mo iniciar un proyecto. </p><br><p>  Aqu√≠ usamos dos archivos docker-compose.  Esto se hace para poder ejecutar en pasos.  Cuando un desarrollador trabaja con el kernel, no necesita notificaciones Push, luego simplemente lanza el archivo de compilaci√≥n de acoplador y, en consecuencia, se guarda el recurso. </p><br><p>  Si existe la necesidad de integraci√≥n con notificaciones push, se inician docker-compose.yaml y docker-compose-push.yaml. </p><br><p>  Como docker-compose.yaml y docker-compose-push.yaml est√°n en la carpeta, se crea autom√°ticamente una √∫nica red virtual. </p><br><p><img src="https://habrastorage.org/webt/hb/sj/ua/hbsjuao3tzaozzkhtv97lzhinn8.png"></p><br><p>  Descripci√≥n de los componentes.  Este es un archivo m√°s avanzado que se encarga de recopilar componentes.  ¬øQu√© es notable aqu√≠?  Aqu√≠ presentamos el componente equilibrador. </p><br><p>  Esta es una imagen Docker preparada en la que se inicia nginx y una aplicaci√≥n que escucha el socket Docker.  Din√°mico, a medida que los contenedores se encienden y apagan, la configuraci√≥n de nginx se volver√° a generar.  Distribuimos el manejo de componentes por nombres de dominio de tercer nivel. </p><br><p>  Para el entorno de desarrollo, utilizamos el dominio .dev - api.informer.dev.  Las aplicaciones con el dominio .dev est√°n disponibles en la m√°quina del desarrollador local. </p><br><p>  Luego, las configuraciones se transfieren a cada proyecto y todos los proyectos se lanzan juntos al mismo tiempo. </p><br><p><img src="https://habrastorage.org/webt/ew/i0/_u/ewi0_udkilodmivdjgfjoqt9try.png"></p><br><p>  Si se representa gr√°ficamente, resulta que el cliente es nuestro navegador o alguna herramienta con la que realizamos solicitudes para el equilibrador. </p><br><p>  El equilibrador de nombre de dominio determina a qu√© contenedor acceder. </p><br><p>  Puede ser nginx, lo que le da al √°rea de administraci√≥n de JS.  Puede ser nginx, que proporciona la API o los archivos est√°ticos que se proporcionan a nginx en forma de carga de im√°genes. </p><br><p>  El diagrama muestra que los contenedores est√°n conectados por una red virtual y est√°n ocultos detr√°s del proxy. </p><br><p>  En la m√°quina del desarrollador, puede recurrir al contenedor conociendo IP, pero b√°sicamente no lo usamos.  La necesidad de tratamiento directo pr√°cticamente no surge. </p><br><p><img src="https://habrastorage.org/webt/6j/wa/af/6jwaaff9m7e_lwmgvxi88fxxkbi.png"></p><br><p>  ¬øQu√© ejemplo buscar para dockerizar la aplicaci√≥n?  En mi opini√≥n, un buen ejemplo es la imagen oficial de Docker para MySQL. </p><br><p>  Es bastante complicado  Hay muchas versiones  Pero su funcionalidad le permite cubrir muchas necesidades que puedan surgir en el proceso de desarrollo posterior.  Si pasa tiempo y descubre c√≥mo interact√∫a todo esto, creo que no tendr√° problemas en la auto implementaci√≥n. </p><br><p>  En hub.docker.com, generalmente hay enlaces a github.com, que proporcionan datos sin procesar directamente desde los cuales puede ensamblar la imagen usted mismo. </p><br><p>  Adem√°s en este repositorio est√° el script docker-endpoint.sh, que es responsable de la inicializaci√≥n inicial y del procesamiento posterior del lanzamiento de la aplicaci√≥n. </p><br><p>  Tambi√©n en este ejemplo existe la posibilidad de configuraci√≥n utilizando variables de entorno.  Al definir la variable de entorno al iniciar un solo contenedor o mediante docker-compose, podemos decir que necesitamos establecer una contrase√±a vac√≠a para docker en root en MySQL o lo que queramos. </p><br><p>  Hay una opci√≥n para crear una contrase√±a aleatoria.  Decimos que necesitamos un usuario, necesitamos establecer una contrase√±a para el usuario y necesitamos crear una base de datos. </p><br><p>  En nuestros proyectos, unificamos ligeramente el Dockerfile, que es responsable de la inicializaci√≥n.  All√≠, corregimos nuestras necesidades para hacer solo una extensi√≥n de los derechos de usuario que usa la aplicaci√≥n.  Esto permiti√≥ en el futuro simplemente crear una base de datos desde la consola de la aplicaci√≥n.  Las aplicaciones de Ruby tienen un comando para crear, modificar y eliminar bases de datos. </p><br><p><img src="https://habrastorage.org/webt/sj/cn/jy/sjcnjytvgchv17vawenbd66upls.png"></p><br><p>  Este es un ejemplo de c√≥mo se ve una versi√≥n particular de MySQL en github.com.  Puede abrir el dockerfile y ver c√≥mo se lleva a cabo la instalaci√≥n all√≠. </p><br><p>  Script docker-endpoint.sh responsable del punto de entrada.  Durante la inicializaci√≥n inicial, se requieren algunos pasos de preparaci√≥n y todas estas acciones se llevan a cabo solo en el script de inicializaci√≥n. </p><br><p><img src="https://habrastorage.org/webt/7h/z4/hy/7hz4hyunbt1ftm38hf9lnmesv3q.png"></p><br><p>  Pasamos a la segunda parte. </p><br><p>  Para almacenar el c√≥digo fuente, cambiamos a gitlab.  Este es un sistema bastante potente que tiene una interfaz visual. </p><br><p>  Uno de los componentes de Gitlab es Gitlab CI.  Le permite describir los comandos de seguimiento que posteriormente se utilizar√°n para organizar un sistema de entrega de c√≥digo o ejecutar pruebas autom√°ticas. </p><br><p>  Informe sobre Gitlab CI 2 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://goo.gl/uohKjI</a> , un informe del club Ruby Russia, bastante detallado y tal vez le interese. </p><br><p><img src="https://habrastorage.org/webt/9f/s8/pk/9fs8pkzbqq4uozrmd2bu4tq0-dg.png"></p><br><p>  Ahora consideraremos lo que se requiere para activar Gitlab CI.  Para iniciar Gitlab CI, es suficiente que coloquemos el archivo .gitlab-ci.yml en la ra√≠z del proyecto. </p><br><p>  Aqu√≠ describimos que queremos realizar una secuencia de estados como prueba, implementaci√≥n. </p><br><p>  Ejecutamos scripts que llaman directamente a docker-compose el ensamblaje de nuestra aplicaci√≥n.  Este es un ejemplo de solo un backend. </p><br><p>  A continuaci√≥n, decimos que es necesario realizar migraciones para cambiar la base de datos y ejecutar pruebas. </p><br><p>  Si las secuencias de comandos se ejecutan correctamente y no devuelven un c√≥digo de error, entonces el sistema pasa a la segunda etapa de la implementaci√≥n. </p><br><p>  La fase de implementaci√≥n se implementa actualmente para la preparaci√≥n.  No organizamos un reinicio sin problemas. </p><br><p>  Extinguimos por la fuerza todos los contenedores, y luego levantamos todos los contenedores nuevamente, recogidos en la primera etapa durante las pruebas. </p><br><p>  Lo estamos ejecutando para el entorno variable actual de migraci√≥n de base de datos, que fueron escritos por los desarrolladores. </p><br><p>  Hay una nota que aplica esto solo a la rama maestra. </p><br><p>  Al cambiar otras ramas no se ejecuta. </p><br><p>  Es posible organizar despliegues en sucursales. </p><br><p><img src="https://habrastorage.org/webt/2x/vc/6t/2xvc6tp0zrtrewnpnekatolnipm.png"></p><br><p>  Para organizar a√∫n m√°s esto, necesitamos instalar Gitlab Runner. </p><br><p>  Esta utilidad est√° escrita en Golang.  Es un archivo √∫nico, como es habitual en el mundo de Golang, que no requiere ninguna dependencia. </p><br><p>  Al inicio, registramos el Gitlab Runner. </p><br><p>  Obtenemos la clave en la interfaz web de Gitlab. </p><br><p>  Luego llamamos al comando init en la l√≠nea de comando. </p><br><p>  Configure Gitlab Runner en modo de di√°logo (Shell, Docker, VirtualBox, SSH) </p><br><p>  El c√≥digo en Gitlab Runner se ejecutar√° en cada confirmaci√≥n, dependiendo de la configuraci√≥n .gitlab-ci.yml. </p><br><p><img src="https://habrastorage.org/webt/jj/nx/c-/jjnxc-msfkvaey7qs-t6n3kbzww.png"></p><br><p>  C√≥mo se ve visualmente en Gitlab en una interfaz web.  Despu√©s de conectar GItlab CI, aparece un indicador que muestra el estado actual de la compilaci√≥n. </p><br><p>  Vemos que se realiz√≥ una confirmaci√≥n hace 4 minutos, que pas√≥ todas las pruebas y no caus√≥ ning√∫n problema. </p><br><p><img src="https://habrastorage.org/webt/da/vg/3h/davg3h0aqnoewa2xlu3eebuz5jg.png"></p><br><p>  Podemos ver las compilaciones con m√°s detalle.  Aqu√≠ vemos que dos estados ya han pasado.  Estado de prueba y estado de implementaci√≥n en la preparaci√≥n. </p><br><p>  Si hacemos clic en una compilaci√≥n espec√≠fica, habr√° una salida de consola de los comandos que se iniciaron en el proceso de acuerdo con .gitlab-ci.yml. </p><br><p><img src="https://habrastorage.org/webt/dg/zq/a5/dgzqa5difiuz1yw0e4i99jzgfik.png"></p><br><p>  As√≠ es como se ve la historia de nuestro producto.  Vemos que hubo intentos exitosos.  Cuando se env√≠an pruebas, no contin√∫a con el siguiente paso y el c√≥digo para la preparaci√≥n no se actualiza. </p><br><p><img src="https://habrastorage.org/webt/cp/g9/rv/cpg9rvvjttpmkvdmi-ve-ugtoh0.png"></p><br><p>  ¬øQu√© tareas resolvimos en la puesta en escena cuando presentamos Docker?           ,   ,     ,     . </p><br><p>         . </p><br><p>              Docker-compose           . </p><br><p>    ,     Docker .  Docker-compose        . </p><br><p>    ,           . </p><br><p>   ‚Äî   staging   . </p><br><p>            production   80  443 ,     WEB. </p><br><p><img src="https://habrastorage.org/webt/7w/4n/_d/7w4n_dfgts6p7pxijvb6eznq0m0.png"></p><br><p>    ?    Gitlab Runner   . </p><br><p> Gitlab     Gitlab Runner,    -      ,  . </p><br><p>             Gitlab Runner,       . </p><br><p>   nginx-proxy           . </p><br><p>      ,        .       . </p><br><p>        80      ,    . </p><br><p><img src="https://habrastorage.org/webt/az/ke/y8/azkey8kpxp3ruww8fbdc1bnfowk.png"></p><br><p>    ?           root.  root  root  . </p><br><p>     ,    root  ,         root. </p><br><p>         - ,   ,    ,        ,     . </p><br><p>    ?   ,    . </p><br><p>   ,    ? </p><br><p>        ID  (UID)  ID  (GID). </p><br><p>           ID 1000. </p><br><p>               Ubuntu.    Ubuntu    ID 1000. </p><br><p><img src="https://habrastorage.org/webt/wx/th/35/wxth352n7tza8gkpdfcmtaern3m.png"></p><br><p>    ? </p><br><p>    Docker.   ,  . ,    -  ,   . </p><br><p>  ,         . </p><br><p>         . </p><br><p>       Docker    Docker Swarm,    .   -     Docker Swarm. </p><br><p>       .   .    .          web-. </p><br><p><img src="https://habrastorage.org/webt/k8/uh/lw/k8uhlwuir8yffyugvdrupropoba.png"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/449742/">https://habr.com/ru/post/449742/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../449722/index.html">Efectos de esquina</a></li>
<li><a href="../449724/index.html">Liquidadores de acero</a></li>
<li><a href="../449728/index.html">Tr√°fico o cifrado de tr√°fico en Direct Connect, parte 3</a></li>
<li><a href="../449730/index.html">Criptomoneda: ¬øvive o muere? Parte 2. Tendencias pol√≠ticas y econ√≥micas.</a></li>
<li><a href="../449740/index.html">Vemos "Ventana en la ciudad" en alta calidad</a></li>
<li><a href="../449744/index.html">Almacenamiento en cach√© de resultados de consultas globales en ASP.NET CORE</a></li>
<li><a href="../449746/index.html">DockerHub hackeado</a></li>
<li><a href="../449748/index.html">Qui√©n es qui√©n en c√≥digo abierto - Parte 2: biograf√≠as geek</a></li>
<li><a href="../449750/index.html">Una herramienta de monitoreo de red abierta con dispositivos IoT</a></li>
<li><a href="../449752/index.html">Tarjetas magn√©ticas caseras para calculadora Casio PRO fx-1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>