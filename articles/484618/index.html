<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé¶ üåñ üë®üèæ‚ÄçüöÄ Angular 9 e Ivy: carga de componentes diferidos ‚úñÔ∏è üëº üë®‚Äçüë©‚Äçüëß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬øCarga de componentes perezosa en angular? ¬øTal vez estamos hablando de m√≥dulos de carga diferida utilizando el enrutador angular? No, estamos habland...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Angular 9 e Ivy: carga de componentes diferidos</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/484618/">  ¬øCarga de componentes perezosa en angular?  ¬øTal vez estamos hablando de m√≥dulos de carga diferida utilizando el enrutador angular?  No, estamos hablando de los componentes.  La versi√≥n actual de Angular solo admite la carga lenta de m√≥dulos.  Pero Ivy le da al desarrollador nuevas oportunidades para trabajar con componentes. <br><br> <a href="https://habr.com/ru/company/ruvds/blog/484618/"><img src="https://habrastorage.org/webt/ox/8d/ub/ox8dubshhrdlijoson4_gyjtarw.png"></a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">La carga perezosa que usamos hasta ahora: rutas</font> </h2><br>  La carga diferida es un gran mecanismo.  En Angular, puede usar este mecanismo sin tener que hacer casi ning√∫n esfuerzo declarando rutas que admitan la carga diferida.  Aqu√≠ hay un ejemplo de la <a href="https://angular.io/guide/lazy-loading-ngmodules">documentaci√≥n</a> angular <a href="https://angular.io/guide/lazy-loading-ngmodules">que</a> demuestra esto: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> routes: Routes = [     { <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">'customer-list'</span></span>,       <span class="hljs-attr"><span class="hljs-attr">loadChildren</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(<span class="hljs-string"><span class="hljs-string">'./customers/customers.module'</span></span>).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m</span></span></span><span class="hljs-function"> =&gt;</span></span> m.CustomersModule) }     ];</code> </pre> <br>  Gracias al c√≥digo anterior, se crear√° un fragmento separado para <code>customers.module</code> , que se cargar√° cuando el usuario navegue por la ruta de la <code>customer-list</code> . <br><br>  Esta es una forma muy agradable de reducir el tama√±o del paquete principal del proyecto y acelerar la carga inicial de la aplicaci√≥n. <br><br>  Pero a pesar de esto, ¬øno ser√≠a bueno poder controlar con mayor precisi√≥n la carga diferida?  Por ejemplo, ¬øqu√© pasar√≠a si pudi√©ramos organizar la carga diferida de componentes individuales? <br><br>  Hasta ahora, esto no ha sido posible.  Pero todo eso cambi√≥ con la llegada de Ivy. <br><br><h2>  <font color="#3AC1EF">Ivy y el concepto de "localidad"</font> </h2><br>  Los m√≥dulos son el concepto b√°sico y el componente b√°sico de cada aplicaci√≥n angular.  Los m√≥dulos declaran componentes, directivas, tuber√≠as, servicios. <br><br>  Una aplicaci√≥n angular moderna no puede existir sin m√≥dulos.  Una raz√≥n para esto es el hecho de que ViewEngine agrega todos los metadatos necesarios a los m√≥dulos. <br><br>  Ivy, por otro lado, adopta un enfoque diferente.  En Ivy, un componente puede existir sin un m√≥dulo.  Esto es posible gracias al concepto de localidad.  Su esencia es que todos los metadatos son locales para el componente. <br><br>  Expliquemos esto analizando el paquete es2015 generado con Ivy. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/02b/775/370/02b7753703a0599491c3f9076527168f.png"></div><br>  <i><font color="#999999">Paquete Es2015 generado con Ivy</font></i> <br><br>  En la secci√≥n <code>Component code</code> , puede ver que el sistema Ivy ha guardado el c√≥digo de componente.  No hay nada especial aqu√≠.  Pero luego Ivy agrega algunos metadatos al c√≥digo. <br><br>  La primera pieza de metadatos se muestra en la figura como una <code>Component factory</code> .  La f√°brica sabe c√≥mo instanciar un componente.  En la secci√≥n de <code>Component metadata</code> del <code>Component metadata</code> , Ivy coloca atributos adicionales, como <code>type</code> y <code>selectors</code> , es decir, todo lo que el componente necesita durante la ejecuci√≥n del programa. <br><br>  Vale la pena mencionar que Ivy agrega la funci√≥n de <code>template</code> aqu√≠.  Se muestra en la <code>Compiled version of your template</code> secci√≥n <code>Compiled version of your template</code> .  Deteng√°monos en este hecho interesante con m√°s detalle. <br><br>  La funci√≥n de <code>template</code> es una versi√≥n compilada de nuestro c√≥digo HTML.  Ella sigue las instrucciones de Ivy para crear un DOM.  Esto es diferente de c√≥mo funciona ViewEngine. <br><br>  El sistema ViewEngine toma el c√≥digo y lo omite.  Angular ejecutar√° el c√≥digo si lo usamos. <br><br>  Y con el enfoque utilizado por Ivy, el componente que invoca los comandos angulares se encarga de todo.  Este cambio permite que los componentes existan independientemente, esto lleva al hecho de que el algoritmo de sacudida de √°rbol se puede aplicar al c√≥digo base angular. <br><br><h2>  <font color="#3AC1EF">Un ejemplo real de carga de componentes diferidos</font> </h2><br>  Ahora que sabemos que la carga de componentes diferidos es posible, consid√©relo con un ejemplo real.  Es decir, crearemos una aplicaci√≥n de prueba que le haga preguntas al usuario con opciones de respuesta. <br><br>  La aplicaci√≥n muestra una imagen de la ciudad y las opciones entre las que debe elegir el nombre de esta ciudad.  Tan pronto como el usuario seleccione una opci√≥n haciendo clic en el bot√≥n correspondiente, este bot√≥n cambiar√° inmediatamente, indicando si la respuesta fue correcta o incorrecta.  Si el fondo del bot√≥n se vuelve verde, la respuesta fue correcta.  Si el fondo se vuelve rojo, significa que la respuesta fue incorrecta. <br><br>  Despu√©s de recibir la respuesta a la pregunta actual, el programa muestra la siguiente pregunta.  As√≠ es como se ve. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2fc/768/ece/2fc768ecebd5c52399030c0d2dc47c66.gif"></div><br>  <i><font color="#999999">Prueba de demostraci√≥n</font></i> <br><br>  Las preguntas que el programa hace al usuario est√°n representadas por el componente <code>QuizCardComponent</code> . <br><br><h2>  <font color="#3AC1EF">Concepto de carga de componentes perezosos</font> </h2><br>  Primero <code>QuizCardComponent</code> la idea general de la carga <code>QuizCardComponent</code> componente <code>QuizCardComponent</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ab/45a/b2b/4ab45ab2b677ce0d886d2f26a5645edb.png"></div><br>  <i><font color="#999999">El proceso de componentes de QuizCardComponent</font></i> <br><br>  Despu√©s de que el usuario comienza la prueba haciendo clic en el bot√≥n <code>Start quiz</code> , comenzamos la carga diferida del componente.  Una vez que el componente est√° a nuestra disposici√≥n, lo colocamos en un contenedor. <br><br>  Reaccionamos a la <code>questionAnsvered</code> eventos detectados de un componente "vago" de la misma manera que responder√≠amos a los eventos de un componente regular.  Es decir, despu√©s de la ocurrencia del evento, mostramos en la pantalla la siguiente tarjeta con la pregunta. <br><br><h2>  <font color="#3AC1EF">An√°lisis de c√≥digo</font> </h2><br>  Para comprender lo que sucede durante la carga diferida de un componente, comenzamos con una versi√≥n simplificada de <code>QuizCardComponent</code> , que muestra las propiedades de la pregunta. <br><br>  Luego expandiremos este componente usando componentes de material angular en √©l.  Y al final, ajustaremos la reacci√≥n a los eventos generados por el componente. <br><br>  Organicemos la carga diferida de una versi√≥n simplificada del componente <code>QuizCardComponent</code> , que tiene la siguiente plantilla: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Here's the question<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>Image: <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span> {{ question.image }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>Possible selections: <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span> {{ question.possibleSelections.toString() }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>Correct answer: <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span> {{ question.correctAnswer }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  El primer paso es crear un elemento contenedor.  Para hacer esto, podemos usar un elemento real, como <code>&lt;div&gt;</code> , o - recurrir a <code>ng-container</code> , que nos permite prescindir de un nivel adicional de c√≥digo HTML.  As√≠ es como se ve la declaraci√≥n del elemento contenedor en el que ponemos el componente "vago": <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-toolbar</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"primary"</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span>City quiz<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-toolbar</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> *</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngIf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"!quizStarted"</span></span></span><span class="hljs-tag">        </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mat-raised-button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"primary"</span></span></span><span class="hljs-tag">        </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"start-quiz-button"</span></span></span><span class="hljs-tag">        (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">)=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"startQuiz()"</span></span></span><span class="hljs-tag">&gt;</span></span>Start quiz<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ng-container</span></span></span><span class="hljs-tag"> #</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">quizContainer</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"quiz-card-container"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ng-container</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  En el componente necesita acceder al contenedor.  Para hacer esto, usamos la anotaci√≥n <code>@ViewChild</code> y nos <code>@ViewChild</code> que queremos leer <code>ViewContainerRef</code> . <br><br>  Tenga en cuenta que en Angular 9, la propiedad <code>static</code> en la anotaci√≥n <code>@ViewChild</code> se establece en <code>false</code> de forma predeterminada: <br><br><pre> <code class="javascript hljs">@ViewChild(<span class="hljs-string"><span class="hljs-string">'quizContainer'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">read</span></span>: ViewContainerRef}) quizContainer: ViewContainerRef;</code> </pre> <br>  Ahora tenemos un contenedor en el que queremos agregar el componente "perezoso".  A continuaci√≥n, necesitamos <code>ComponentFactoryResolver</code> e <code>Injector</code> .  Ambos pueden adquirirse recurriendo a la metodolog√≠a de inyecci√≥n de dependencia. <br><br>  La entidad <code>ComponentFactoryResolver</code> es un registro simple que establece la relaci√≥n entre los componentes y las clases <code>ComponentFactory</code> generadas autom√°ticamente que se pueden usar para crear instancias de componentes: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(private quizservice: QuizService,            private cfr: ComponentFactoryResolver,            private injector: Injector) { }</code> </pre> <br>  Ahora tenemos todo lo que se necesita para lograr el objetivo.  <code>startQuiz</code> en el contenido del m√©todo <code>startQuiz</code> y organicemos la carga diferida del componente: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {QuizCardComponent} = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(<span class="hljs-string"><span class="hljs-string">'./quiz-card/quiz-card.component'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> quizCardFactory = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cfr.resolveComponentFactory(QuizCardComponent); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {instance} = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.quizContainer.createComponent(quizCardFactory, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.injector); instance.question = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.quizservice.getNextQuestion();</code> </pre> <br>  Podemos usar el comando <code>import</code> ECMAScript para organizar la carga diferida de <code>QuizCardComponent</code> .  Una expresi√≥n de importaci√≥n devuelve una promesa.  Puede trabajar con √©l utilizando la construcci√≥n <code>async/await</code> <code>.then</code> o utilizando el controlador <code>.then</code> .  Despu√©s de resolver la promesa, usamos la desestructuraci√≥n para crear una instancia del componente. <br><br>  En estos d√≠as, debe usar <code>ComponentFactory</code> para proporcionar compatibilidad con versiones anteriores.  En el futuro, no se requiere la l√≠nea correspondiente, ya que podremos trabajar directamente con el componente. <br><br>  La f√°brica <code>ComponentFactory</code> nos da <code>componentRef</code> .  Pasamos <code>componentRef</code> e <code>Injector</code> al m√©todo <code>createComponent</code> del contenedor. <br><br>  El m√©todo <code>createComponent</code> devuelve un <code>ComponentRef</code> donde est√° contenida la instancia del componente.  Usamos <code>instance</code> para pasar las <code>@Input</code> del componente <code>@Input</code> . <br><br>  En el futuro, todo esto probablemente se puede hacer utilizando el m√©todo de <code>renderComponent</code> angular <code>renderComponent</code> .  Este m√©todo a√∫n es experimental.  Sin embargo, es muy probable que se convierta en un m√©todo angular regular.  <a href="https://github.com/LayZeeDK/ivy-dynamic-rendering">Aqu√≠ hay</a> materiales √∫tiles sobre este tema. <br><br>  Esto es todo lo que se necesita para organizar la carga diferida de un componente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d4/2bd/4bc/2d42bd4bc38ee01c427c94286e060cbb.png"></div><br>  <i><font color="#999999">Carga diferida de componentes</font></i> <br><br>  Despu√©s de presionar el bot√≥n <code>Start quiz</code> , comienza la carga diferida del componente.  Si abre la pesta√±a <code>Network</code> de las herramientas del desarrollador, puede ver el proceso de cargar perezosamente el fragmento de c√≥digo representado por el archivo <code>quiz-card-quiz-card-component.js</code> .  Despu√©s de cargar y procesar el componente que se muestra, el usuario ve una tarjeta de preguntas. <br><br><h2>  <font color="#3AC1EF">Extensi√≥n de componente</font> </h2><br>  Actualmente estamos cargando el componente <code>QuizCardComponent</code> .  Esto es muy bueno  Pero nuestra aplicaci√≥n a√∫n no es particularmente funcional. <br><br>  Arreglemos esto agregando caracter√≠sticas y componentes adicionales de material angular: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"quiz-card"</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-header</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mat-card-avatar</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"quiz-header-image"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-title</span></span></span><span class="hljs-tag">&gt;</span></span>Which city is this?<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-title</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-subtitle</span></span></span><span class="hljs-tag">&gt;</span></span>Click on the correct answer below<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-subtitle</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-header</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"image"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mat-card-image</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"'assets/' + question.image"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">alt</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Photo of a Shiba Inu"</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-actions</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"answer-section"</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"answeredCorrectly !== undefined"</span></span></span><span class="hljs-tag"> *</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngFor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"let selection of question.possibleSelections"</span></span></span><span class="hljs-tag">            </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mat-stroked-button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"primary"</span></span></span><span class="hljs-tag">            [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngClass</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{              'correct': answeredCorrectly &amp;&amp; selection === question.correctAnswer,              'wrong': answeredCorrectly === false &amp;&amp; selection === question.correctAnswer             }"</span></span></span><span class="hljs-tag">            (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">)=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"answer(selection)"</span></span></span><span class="hljs-tag">&gt;</span></span>      {{selection}}    <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-actions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Hemos incluido algunos hermosos componentes materiales en el componente.  ¬øQu√© pasa con los m√≥dulos correspondientes? <br><br>  Por supuesto, se pueden agregar al <code>AppModule</code> .  Pero esto significa que estos m√≥dulos se cargar√°n en modo "codicioso".  Y esta no es una buena idea.  Adem√°s, el montaje del proyecto fallar√°, con el siguiente mensaje: <br><br><pre> <code class="javascript hljs">ERROR <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> src/app/quiz-card/quiz-card.component.html:<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> - error TS<span class="hljs-number"><span class="hljs-number">-998001</span></span>: <span class="hljs-string"><span class="hljs-string">'mat-card'</span></span> is not a known element: <span class="hljs-number"><span class="hljs-number">1.</span></span> If <span class="hljs-string"><span class="hljs-string">'mat-card'</span></span> is an Angular component, then verify that it is part <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>. <span class="hljs-number"><span class="hljs-number">2.</span></span> If <span class="hljs-string"><span class="hljs-string">'mat-card'</span></span> is a Web Component then add <span class="hljs-string"><span class="hljs-string">'CUSTOM_ELEMENTS_SCHEMA'</span></span> to the <span class="hljs-string"><span class="hljs-string">'@NgModule.schemas'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> component to suppress <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> message.</code> </pre> <br>  Que hacer  Como probablemente ya haya entendido, este problema es completamente solucionable.  Esto se puede hacer usando m√≥dulos. <br><br>  Pero esta vez los usaremos un poco diferente que antes.  <code>QuizCardComponent</code> un peque√±o m√≥dulo al mismo archivo que <code>QuizCardComponent</code> (en el archivo <code>quizcard.component.ts</code> ): <br><br><pre> <code class="javascript hljs">@NgModule({  <span class="hljs-attr"><span class="hljs-attr">declarations</span></span>: [QuizCardComponent],  <span class="hljs-attr"><span class="hljs-attr">imports</span></span>: [CommonModule, MatCardModule, MatButtonModule] }) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QuizCardModule</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre> <br>  Tenga en cuenta que no hay declaraci√≥n de <code>export</code> . <br><br>  La especificaci√≥n de este m√≥dulo pertenece exclusivamente a nuestro componente, cargado en modo diferido.  Como resultado, el √∫nico componente que se declara en el m√≥dulo ser√° <code>QuizCardComponent</code> .  La secci√≥n de importaci√≥n solo importa los m√≥dulos que nuestro componente necesita. <br><br>  No exportamos el nuevo m√≥dulo para que los m√≥dulos cargados en modo codicioso no puedan importarlo. <br><br>  Reinicie la aplicaci√≥n y observe c√≥mo se comporta cuando hace clic en el <code> Start quiz</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc5/4bf/c60/bc54bfc6057cc6707e4f01a5bf871de9.png"></div><br>  <i><font color="#999999">An√°lisis de aplicaci√≥n modificado</font></i> <br><br>  Genial  El componente <code>QuizCardComponent</code> carga en modo <code>QuizCardComponent</code> y se agrega al <code>ViewContainer</code> .  Todas las dependencias necesarias se cargan con √©l. <br><br>  Analizaremos el paquete de la aplicaci√≥n utilizando la <code>webpack-bundle-analyze</code> proporcionada por el m√≥dulo npm correspondiente.  Le permite visualizar el contenido de los archivos que produce Webpack y examinar el esquema resultante. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d2a/a5a/2aa/d2aa5a2aae380755aca3872db6d068f9.png"></div><br>  <i><font color="#999999">An√°lisis de paquetes de aplicaciones</font></i> <br><br>  El tama√±o del paquete principal de la aplicaci√≥n es de aproximadamente 260 Kb.  Si descargamos el componente <code>QuizCardComponent</code> junto con √©l, el tama√±o de los datos descargados ser√≠a de aproximadamente 270 Kb.  Resulta que pudimos reducir el tama√±o del paquete principal en 10 Kb, cargando solo un componente en modo perezoso.  Buen resultado! <br><br>  El c√≥digo de <code>QuizCardComponent</code> despu√©s del ensamblado llega a un archivo separado.  Si analiza el contenido de este archivo, resulta que no solo <code>QuizCardComponent</code> c√≥digo <code>QuizCardComponent</code> , sino tambi√©n los m√≥dulos de Material utilizados en este componente. <br><br>  Aunque <code>QuizCardComponent</code> usa <code>MatButtonModule</code> y <code>MatCardModule</code> , solo <code>MatCardModule</code> al <code>MatCardModule</code> c√≥digo terminado.  La raz√≥n de esto es que tambi√©n usamos <code>MatButtonModule</code> en el <code>AppModule</code> , que muestra el bot√≥n <code>Start quiz</code> .  Como resultado, el c√≥digo correspondiente cae en otro fragmento del paquete. <br><br>  Ahora hemos organizado la carga diferida de <code>QuizCardComponent</code> .  Este componente muestra una tarjeta, dise√±ada al estilo de Material, que contiene una imagen, una pregunta y botones con opciones de respuesta.  ¬øQu√© sucede ahora si hace clic en uno de estos botones? <br><br>  El bot√≥n, dependiendo de si contiene la respuesta correcta o incorrecta, se vuelve verde o rojo cuando se presiona.  ¬øQu√© m√°s est√° pasando?  Nada  Y necesitamos que despu√©s de responder una pregunta, se muestre una tarjeta de otra pregunta.  Arreglarlo <br><br><h2>  <font color="#3AC1EF">Manejo de eventos</font> </h2><br>  La aplicaci√≥n no muestra una nueva tarjeta de preguntas cuando hace clic en el bot√≥n de respuesta debido al hecho de que a√∫n no hemos configurado mecanismos para responder a eventos de componentes cargados en modo diferido.  Ya sabemos que el componente <code>QuizCardComponent</code> genera eventos utilizando <code>EventEmitter</code> .  Si observa la definici√≥n de la clase <code>EventEmitter</code> , puede descubrir que es un descendiente del <code>Subject</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> declare <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventEmitter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">any</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Subject</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre> <br>  Esto significa que <code>EventEmitter</code> tiene un m√©todo de <code>subscribe</code> , que le permite configurar la respuesta del sistema a los eventos que ocurren: <br><br><pre> <code class="javascript hljs">instance.questionAnswered.pipe(    takeUntil(instance.destroy$) ).subscribe(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showNewQuestion());</code> </pre> <br>  Aqu√≠ nos suscribimos a la secuencia <code>questionAnswered</code> y llamamos al m√©todo <code>showNextQuestion</code> , que ejecuta la l√≥gica <code>lazyLoadQuizCard</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> showNewQuestion() {  <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.lazyLoadQuizCard(); }</code> </pre> <br>  La <code>takeUntil(instance.destroy$)</code> es necesaria para borrar la suscripci√≥n que se ejecuta despu√©s de que se destruye el componente.  Si se <code>ngOnDestroy</code> gancho <code>ngOnDestroy</code> ciclo de vida del componente <code>ngOnDestroy</code> , <code>destroy$</code> se llama con <code>next</code> y <code>complete</code> . <br><br>  Como el componente ya est√° cargado, el sistema no realiza una solicitud HTTP adicional.  Usamos el contenido del fragmento de c√≥digo que ya tenemos, creamos un nuevo componente y lo colocamos en el contenedor. <br><br><h2>  <font color="#3AC1EF">Ganchos de ciclo de vida de componentes</font> </h2><br>  Casi todos los ganchos del ciclo de vida del componente se <code>QuizCardComponent</code> autom√°ticamente cuando se trabaja con el componente <code>QuizCardComponent</code> utilizando la t√©cnica de carga diferida.  Pero un gancho no es suficiente.  ¬øPuedes entender cu√°l? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ceb/4f7/b2a/ceb4f7b2a34bbed6ced31f69713e4f68.png"></div><br>  <i><font color="#999999">Ganchos de ciclo de vida de componentes</font></i> <br><br>  Este es el <code>ngOnChanges</code> m√°s importante de <code>ngOnChanges</code> .  Como nosotros mismos actualizamos las propiedades de entrada de la instancia del componente, tambi√©n somos responsables de llamar al <code>ngOnChanges</code> ciclo de vida <code>ngOnChanges</code> . <br><br>  Para llamar al <code>ngOnChanges</code> de la instancia del <code>ngOnChanges</code> , debe construir un objeto <code>SimpleChange</code> usted mismo: <br><br><pre> <code class="javascript hljs">(instance <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> any).ngOnChanges({    <span class="hljs-attr"><span class="hljs-attr">question</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SimpleChange(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, instance.question, <span class="hljs-literal"><span class="hljs-literal">true</span></span>) });</code> </pre> <br>  Llamamos manualmente <code>ngOnChanges</code> instancia <code>ngOnChanges</code> componente y le pasamos un objeto <code>SimpleChange</code> .  Este objeto indica que este cambio es el primero, que el valor anterior es <code>null</code> y que el valor actual es una pregunta. <br><br>  Genial  Cargamos el componente con m√≥dulos de terceros, respondimos a los eventos que gener√≥ y configuramos la llamada de los ganchos necesarios del ciclo de vida del componente. <br><br>  <a href="https://github.com/kreuzerk/city-quiz">Aqu√≠ est√° el</a> c√≥digo fuente del proyecto terminado en el que est√°bamos trabajando. <br><br><h2>  <font color="#3AC1EF">Resumen</font> </h2><br>  La carga lenta de componentes ofrece a los desarrolladores de Angular grandes oportunidades para optimizar el rendimiento de la aplicaci√≥n.  A su disposici√≥n est√°n las herramientas para ajustar muy bien la composici√≥n de los materiales cargados en modo perezoso.  Anteriormente, cuando era posible cargar solo rutas en modo perezoso, no ten√≠amos tanta precisi√≥n. <br><br>  Desafortunadamente, cuando usamos m√≥dulos de terceros en el componente, tambi√©n debemos cuidar los m√≥dulos.  Sin embargo, vale la pena recordar que en el futuro esto puede cambiar. <br><br>  El motor Ivy introdujo el concepto de localidad, gracias al cual los componentes pueden existir independientemente.  Este cambio es la base del futuro de Angular. <br><br>  <b>Estimados lectores!</b>  ¬øPlanea utilizar la t√©cnica de carga de componentes diferidos en sus proyectos angulares? <br><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a href="https://habr.com/ru/post/484618/">https://habr.com/ru/post/484618/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../484604/index.html">A√±o nuevo, nuevo navegador: Microsoft Edge est√° fuera de la evaluaci√≥n preliminar y ahora est√° disponible para descargar</a></li>
<li><a href="../484610/index.html">Adi√≥s c√≥digo limpio</a></li>
<li><a href="../484612/index.html">Proyecto de optimizaci√≥n del tiempo de construcci√≥n</a></li>
<li><a href="../484614/index.html">6 recomendaciones para desarrollar aplicaciones Go seguras</a></li>
<li><a href="../484616/index.html">6 lecciones aprendidas de la experiencia de optimizaci√≥n del rendimiento del servicio de Node.js</a></li>
<li><a href="../484620/index.html">Nuevo PS1 Graphic Renderer para Omega Red Emulator</a></li>
<li><a href="../484624/index.html">Intervalo de ayuno y Lifext Life Patrones de extensi√≥n</a></li>
<li><a href="../484628/index.html">Eric Ciaramella como ejemplo de censura en Wikipedia / Google</a></li>
<li><a href="../484630/index.html">CES 2020: hora de sorprender</a></li>
<li><a href="../484634/index.html">Node.js VS Python: ¬øCu√°l es mejor?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>