<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🍳 🤸🏻 🤖 测试React组件的便捷方法 🌻 👩‍⚖️ ↕️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="我为Jest编写了一个自定义报告生成器，并将其发布在GitHub上 。 我的构建器叫做Jest-snapshots-book，它创建了一个HTML的React应用程序组件快照的书。 



 本文将讨论什么是Jest，即快照测试，它通常需要其他报表生成器以及如何编写它们。 基本上，所有这些都适用于测...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>测试React组件的便捷方法</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421647/"> 我为Jest编写了一个自定义报告生成器，并将其发布在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHub上</a> 。 我的构建器叫做Jest-snapshots-book，它创建了一个HTML的React应用程序组件快照的书。 <br><br><img src="https://habrastorage.org/webt/32/eu/rz/32eurzyx63oqbxjuy5vw8eo3-bu.png"><br><br> 本文将讨论什么是Jest，即快照测试，它通常需要其他报表生成器以及如何编写它们。 基本上，所有这些都适用于测试React组件，但是从理论上讲，它可以在处理任何可序列化数据时应用。 <br><a name="habracut"></a><br><h2> 分页器React组件 </h2><br> 例如，在本文中，我们将测试分页器组件（ <b>Paginator</b> ）。 这是在AWS（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHub</a> ）中创建无服务器应用程序的项目的一部分。 这种组件的任务是显示用于浏览表或其他页面的按钮。 <br><br> 这是一个简单的功能组件，没有无状态组件（无状态组件）。 作为输入，它从props接收页面总数，当前页面以及单击页面的处理程序功能。 在输出端，该组件生成一个成型的分页器。 为了显示按钮，使用了另一个子<b>Button</b>组件。 如果页面很多，则分页器不会显示所有页面，而是将它们组合在一起并以省略号的形式显示。 <br><br><img src="https://habrastorage.org/webt/9f/5m/ph/9f5mphp5a7hvkj0vmdgfcapz7ve.jpeg"><br><br><div class="spoiler">  <b class="spoiler_title">分页器组件代码</b> <div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> classes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Paginator.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Button <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../UI/Button/Button'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Paginator = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { tp, cp, pageClickHandler } = props; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> paginator = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tp !== <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> &amp;&amp; tp &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> buttons = []; buttons.push( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag">`</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pback</span></span></span></span><span class="xml"><span class="hljs-tag">`} </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{cp</span></span></span></span><span class="xml"><span class="hljs-tag"> === </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">clicked</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{(cp</span></span></span></span><span class="xml"><span class="hljs-tag"> === </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1</span></span></span></span><span class="xml"><span class="hljs-tag"> ? </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">null</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">event</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> pageClickHandler(event, 'back'))}&gt; ← </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isDots = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i, tp, cp</span></span></span><span class="hljs-function">) =&gt;</span></span> i &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; i &lt; tp &amp;&amp; (i &gt; cp + <span class="hljs-number"><span class="hljs-number">1</span></span> || i &lt; cp - <span class="hljs-number"><span class="hljs-number">1</span></span>) &amp;&amp; (cp &gt; <span class="hljs-number"><span class="hljs-number">4</span></span> || i &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>) &amp;&amp; (cp &lt; tp - <span class="hljs-number"><span class="hljs-number">3</span></span> || i &lt; tp - <span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> flag; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt;= tp; i++) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dots = isDots(i, tp, cp) &amp;&amp; (isDots(i - <span class="hljs-number"><span class="hljs-number">1</span></span>, tp, cp) || isDots(i + <span class="hljs-number"><span class="hljs-number">1</span></span>, tp, cp)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (flag &amp;&amp; dots) { flag = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; buttons.push( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag">`</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">p</span></span></span></span><span class="xml"><span class="hljs-tag">${</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">}`} </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{classes.Dots}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{true}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ... </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!dots) { flag = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; buttons.push( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag">`</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">p</span></span></span></span><span class="xml"><span class="hljs-tag">${</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">}`} </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{i</span></span></span></span><span class="xml"><span class="hljs-tag"> === </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">cp}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">clicked</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{(i</span></span></span></span><span class="xml"><span class="hljs-tag"> === </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">cp</span></span></span></span><span class="xml"><span class="hljs-tag"> ? </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">null</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">event</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> pageClickHandler(event, i))}&gt; {i} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } } buttons.push( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag">`</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pforward</span></span></span></span><span class="xml"><span class="hljs-tag">`} </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{cp</span></span></span></span><span class="xml"><span class="hljs-tag"> === </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">tp}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">clicked</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{(cp</span></span></span></span><span class="xml"><span class="hljs-tag"> === </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">tp</span></span></span></span><span class="xml"><span class="hljs-tag"> ? </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">null</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">event</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> pageClickHandler(event, 'forward'))}&gt; → </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); paginator = <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{classes.Paginator}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {buttons} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> paginator; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Paginator;</code> </pre> </div></div><div class="spoiler">  <b class="spoiler_title">按钮组件代码</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> classes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Button.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> button = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{props.disabled}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{classes.Button</span></span></span></span><span class="xml"><span class="hljs-tag"> + (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">props.className</span></span></span></span><span class="xml"><span class="hljs-tag"> ? ' ' + </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">props.className</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span></span><span class="xml"><span class="hljs-tag"> '')} </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{props.clicked}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {props.children} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> button;</code> </pre> </div></div><br><h2> 开玩笑 </h2><br>  Jest是一个著名的开源库，用于对JavaScript代码进行单元测试。 它的创建和开发归功于Facebook。 用Node.js编写。 <br><br> 一般而言，测试的含义归结为以下事实：您需要为代码提供输入参数，并立即描述代码应产生的输出。 在执行测试时，Jest使用输入参数执行代码，并根据预期结果检查结果。 如果匹配，则测试将通过，否则，测试将不通过。 <br><br> 来自<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">jestjs.io的</a>一个小例子。 <br><br> 假设我们有一个Node.js模块，它是一个将两个数字相加的函数（ <b>sum.js</b>文件）： <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b; } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = sum;</code> </pre> <br> 如果我们的模块保存在文件中以进行测试，则需要创建<b>sum.test.js</b>文件，在其中写入以下代码进行测试： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sum = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./sum'</span></span>); test(<span class="hljs-string"><span class="hljs-string">'adds 1 + 2 to equal 3'</span></span>, () =&gt; { expect(sum(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)).toBe(<span class="hljs-number"><span class="hljs-number">3</span></span>); });</code> </pre> <br> 在此示例中，我们使用<b>test</b>函数创建了一个名为<b>“将1 + 2等于3相加”的测试</b> 。  <b>测试</b>函数的第二个参数，我们传递一个实际执行测试的函数。 <br><br> 该测试包含以下事实：我们使用输入参数<b>1</b>和<b>2</b>执行<b>sum</b>函数，并将结果传递给Jest Expect <b>（）</b>函数。 然后，使用Jest <b>toBe（）</b>函数，将传输的结果与预期的结果进行比较（ <b>3</b> ）。  <b>toBe（）</b>函数属于Jest（匹配器）测试函数的类别。 <br><br> 为了进行测试，只需转到项目文件夹并在命令行上调用<b>jest</b> 。  Jest将找到扩展名为<b>.test.js</b>的文件并运行测试。 这是他将输出的结果： <br><br><pre> <code class="bash hljs">PASS ./sum.test.js ✓ adds 1 + 2 to equal 3 (5ms)</code> </pre> <br><h2> 组件的酶和快照测试 </h2><br> 快照测试是Jest中的一个相对较新的功能。 关键是，借助特殊的测试功能，我们要求Jest将数据结构的快照保存到磁盘，然后在随后的测试运行期间，将新快照与以前保存的快照进行比较。 <br><br> 在这种情况下，快照不过是数据的文本表示形式。 例如，某个对象的快照将如下所示（此处的数组键是测试的名称）： <br><br><pre> <code class="javascript hljs">exports[<span class="hljs-string"><span class="hljs-string">`some test name`</span></span>] = <span class="hljs-string"><span class="hljs-string">` Object { "Hello": "world" } `</span></span>;</code> </pre> <br> 这就是Jest测试功能的样子，它执行图像比较（可选参数）： <br><br><pre> <code class="javascript hljs">expect(value).toMatchSnapshot(propertyMatchers, snapshotName)</code> </pre> <br> 该<b>值</b>可以是任何可序列化的数据结构。 第一次， <b>toMatchSnapshot（）</b>函数仅将快照写入磁盘；在随后的时间里，它将已经执行比较。 <br><br> 通常，这种测试技术专门用于测试React组件，甚至更准确地用于测试React组件的正确呈现。 为此，您需要在渲染后将组件作为<b>值</b>传递。 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">酶</a>是一个库，通过提供方便的组件渲染功能大大简化了对React应用程序的测试。 酶是在Airbnb开发的。 <br><br> 酶允许您在代码中呈现组件。 为此，有几个方便的功能可以执行不同的渲染选项： <br><br><ul><li> 完整渲染（如浏览器中的完整DOM渲染）； </li><li> 简化渲染（浅渲染）； </li><li> 静态渲染 </li></ul><br> 我们不会深入研究渲染选项，对于快照测试而言，静态渲染就足够了，它使您能够获取组件及其子组件的静态HTML代码： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> wrapper = render(<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Foo</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"unique"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">);</span></span></code> </pre> <br> 因此，我们渲染组件并将结果传递给<b>Expect（）</b> ，然后调用<b>.toMatchSnapshot（）</b>函数。  <b>它</b>功能只是<b>测试</b>功能的缩写。 <br><br><pre> <code class="javascript hljs">... const wrapper = render(<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Paginator</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">tp</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{tp}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">cp</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{cp}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">); it(`Total = ${tp}, Current = ${cp}`, () =&gt; { expect(wrapper).toMatchSnapshot(); }); ...</span></span></code> </pre> <br> 每次<b>运行</b>测试时<b>，toMatchSnapshot（）都会</b>比较两个快照： <u>预期</u> （先前已写入磁盘）和<u>当前</u> （在当前测试期间获得）快照。 <br><br> 如果图片相同，则认为测试已通过。 如果图片之间存在差异，则认为未通过测试，并且以diff的形式向用户显示了两张图片之间的差异（如版本控制系统中所示）。 <br><br> 这是测试失败时Jest输出的示例。 在这里，我们看到当前图像中还有一个附加按钮。 <br><br><img src="https://habrastorage.org/webt/e2/3j/z1/e23jz1uhhisouenvdsl-64gsz3y.jpeg"><br><br> 在这种情况下，用户必须决定要做什么。 如果由于组件代码的更改而计划对快照进行更改，则它必须用新快照覆盖旧快照。 而且，如果更改是意外的，那么您需要在代码中查找问题。 <br><br> 我将给出一个测试分页器的完整示例（文件<b>Paginator.test.js</b> ）。 <br><br> 为了更方便地进行分页器测试，我创建了一个<b>快照（tp，cp）</b>函数，该函数将使用两个参数：页面总数和当前页面。 此功能将使用给定的参数执行测试。 剩下的就是用各种参数（甚至在循环中）调用<b>snapshoot（）</b>函数并进行测试，测试... <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { configure, render } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'enzyme'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Adapter <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'enzyme-adapter-react-16'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Paginator <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Paginator'</span></span>; configure({ <span class="hljs-attr"><span class="hljs-attr">adapter</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Adapter() }); describe(<span class="hljs-string"><span class="hljs-string">'Paginator'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> snapshoot = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tp, cp</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> wrapper = render(<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Paginator</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">tp</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{tp}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">cp</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{cp}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">); it(`Total = ${tp}, Current = ${cp}`, () =&gt; { expect(wrapper).toMatchSnapshot(); }); } snapshoot(0, 0); snapshoot(1, -1); snapshoot(1, 1); snapshoot(2, 2); snapshoot(3, 1); for (let cp = 1; cp </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">=</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">10</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">cp</span></span></span></span><span class="xml"><span class="hljs-tag">++) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">snapshoot</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">10</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">cp</span></span></span></span><span class="xml"><span class="hljs-tag">); } });</span></span></span></span></code> </pre> <br><h2> 为什么需要额外的报告生成器 </h2><br> 当我开始使用这项测试技术时，最初方法未完成的感觉并没有离开我。 毕竟，图片只能作为文本查看。 <br><br> 但是，如果某些组件在渲染时会产生大量HTML代码怎么办？ 这是一个三按钮分页器组件。 此类组件的快照如下所示： <br><br><pre> <code class="javascript hljs">exports[<span class="hljs-string"><span class="hljs-string">`Paginator Total = 1, Current = -1 1`</span></span>] = <span class="hljs-string"><span class="hljs-string">` &lt;div class="Paginator" &gt; &lt;button class="Button" &gt; ← &lt;/button&gt; &lt;button class="Button" &gt; 1 &lt;/button&gt; &lt;button class="Button" &gt; → &lt;/button&gt; &lt;/div&gt; `</span></span>;</code> </pre><br> 首先，您需要确保正确呈现组件的原始版本。 仅通过查看文本形式的HTML代码来执行此操作不是很方便。 但这只是三个按钮。 并且，如果您需要测试，例如，一张桌子或什至更大的东西？ 此外，要进行全面测试，您需要查看许多图片。 这将是非常不便和困难的。 <br><br> 然后，如果测试失败，则需要了解组件的外观如何不同。 当然，他们的HTML代码有所不同，您将可以了解发生了什么变化，但是，再次看到个人差异的机会也不会多余。 <br><br> 总的来说，我认为有必要使图片可以在浏览器中以与在应用程序中相同的形式被查看。 包括适用于它们的样式。 因此，我想到了通过为Jest编写一个额外的报表生成器来改善快照测试过程的想法。 <br><br> 展望未来，这就是我所得到的。 每次运行测试时，构建器都会更新快照书。 您可以直接在浏览器中查看在应用程序中的组件，也可以立即查看图像和diff的源代码（如果测试失败）。 <br><br><img src="https://habrastorage.org/webt/vp/pu/kk/vppukk7dddohnzz29gtrkylhsxi.gif"><br><br><h2> 笑话报表制作工具 </h2><br>  Jest的创建者提供了编写其他报表构建器的机会。 这样做如下。 您需要在Node.JS上编写一个模块，该模块必须具有以下一种或多种方法： <b>onRunStart</b> ， <b>onTestStart</b> ， <b>onTestResult</b> ， <b>onRunComplete</b> ，它们对应于各种测试进度事件。 <br><br> 然后，您需要在Jest配置中连接模块。 为此有一个特别的<b>记者</b>指令。 如果要另外包含构建器，则需要将其添加到<b>报告器</b>数组的末尾。 <br><br> 之后，Jest将在测试执行的某些阶段从模块中调用方法，并将当前结果传递给方法。 实际上，这些方法中的代码应创建您需要的其他报告。 因此，总的来说，创建其他报表构建器的过程很像。 <br><br><h2> 笑话快照书的工作原理 </h2><br> 我不会在文章中专门插入模块代码，因为我将对其进行进一步的改进。 可以在我的GitHub上找到，这是项目页面上的<a href="">src / index.js文件</a> 。 <br><br> 测试完成后，将调用我的报表生成器。 我将代码放在<b>onRunComplete（上下文，结果）</b>方法中。 它的工作原理如下。 <br><br> 在<b>estes.testResults</b>属性中，Jest将测试结果数组传递给此函数。 每个测试结果都包含测试文件的路径和包含结果的消息数组。 我的报告生成器使用相应的快照文件搜索每个测试文件。 如果检测到快照文件，则报告构建器将在快照书中创建一个HTML页面，并将其写入项目根文件夹中的“快照书”文件夹。 <br><br> 为了生成HTML页面，报表构建器使用<b>grabCSS</b>递归函数<b>（moduleName，css = []，级别= 0），</b>收集所有样式，从被测组件开始，一直到其导入的所有组件树为止。 因此，该功能收集了组件正确显示所需的所有样式。 收集的样式将添加到快照书的HTML页面中。 <br><br> 我在项目中使用CSS模块，所以不确定如果不使用CSS模块是否可以正常工作。 <br><br> 如果测试通过，则构建器会将iFrame插入HTML页面，并在两个显示选项中显示图像：源代码（按原样显示图像）和渲染后的组件。 通过单击鼠标可以更改iFrame中的显示选项。 <br><br> 如果测试未通过，那么一切都会更加复杂。 在这种情况下，Jest仅提供它在控制台中显示的消息（请参见上面的屏幕截图）。 <br><br> 它包含差异和有关失败测试的其他信息。 实际上，在这种情况下，我们实际上要处理两个图像： <u>预期</u>图像和<u>实际</u>图像。 如果我们有一个预期的快照-它存储在快照文件夹中的磁盘上，则当前的Jest快照不提供。 <br><br> 因此，我必须编写代码，将从消息中获取的Jest差异应用于期望的快照，并根据期望创建实际的快照。 之后，构建器在iFrame旁边显示当前快照的预期iFrame快照，可以在三个选项之间更改其内容：源代码，渲染后的组件，差异。 <br><br> 如果为它设置verbose = true选项，则这就是报告生成器的输出。 <br><br><img src="https://habrastorage.org/webt/qz/pd/4h/qzpd4hduqakenbx8vjhonggjgso.jpeg"><br><br><h2> 有用的链接 </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">开玩笑的快照书</a> </li><li>  <a href="">模块源代码</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">酶呈递选项</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">快照测试</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">记者Jest配置指令</a> </li></ul><br><h2> 聚苯乙烯 </h2><br> 快照测试不足以完全测试React应用程序。 它仅涵盖组件的渲染。 还必须测试其功能（例如，对用户操作的反应）。 但是，快照测试是确保组件按预期呈现的一种非常方便的方法。 而jest-snapshots-book使这个过程更加容易。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN421647/">https://habr.com/ru/post/zh-CN421647/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN421631/index.html">回顾Lenovo ThinkPad X1 Carbon（2018）笔记本电脑：轻巧，舒适，功能强大</a></li>
<li><a href="../zh-CN421633/index.html">如何在10天内制定标准</a></li>
<li><a href="../zh-CN421637/index.html">到9月1日，带GPS的儿童手表您需要注意什么</a></li>
<li><a href="../zh-CN421639/index.html">中文笔记本电脑跳线EZBook X4-背光键盘和全新的Gemini Lake平台</a></li>
<li><a href="../zh-CN421643/index.html">工艺-到图书馆</a></li>
<li><a href="../zh-CN421649/index.html">“顶级3D博览会。 Digital Education 2018” 9月21日在莫斯科科技城</a></li>
<li><a href="../zh-CN421653/index.html">现代电表的概述和装置</a></li>
<li><a href="../zh-CN421655/index.html">喷气背包工程师：亚历山大·费多罗维奇·安德烈耶夫</a></li>
<li><a href="../zh-CN421657/index.html">JSON持续增长</a></li>
<li><a href="../zh-CN421659/index.html">Microsoft如何忘记世界的一半或阅读错误消息</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>