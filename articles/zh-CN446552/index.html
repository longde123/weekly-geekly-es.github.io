<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚉 🏻 💟 使用示例EToken处理APDU命令 🤲🏾 🔆 ⛸️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="“ ...道路并不是那么难理解。自然的力量，自然的倾向，事件的模式... 
 对世界的原始理解只注意到四个要素，并且没有比这更进一步的了。 就像宇宙可以归结为四种可以理解的现象一样。” 
 斯蒂芬·埃里克森。 
 “午夜潮。” 



 哈Ha！ 

 APDU的主题反复提出，但主要涉及智能卡，因为...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>使用示例EToken处理APDU命令</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446552/">  <i>“ ...道路并不是那么难理解。自然的力量，自然的倾向，事件的模式...</i> <i><br></i>  <i>对世界的原始理解只注意到四个要素，并且没有比这更进一步的了。</i>  <i>就像宇宙可以归结为四种可以理解的现象一样。”</i> <i><br></i>  <i>斯蒂芬·埃里克森。</i> <i><br></i>  <i>“午夜潮。”</i> <br><br><img src="https://habrastorage.org/webt/pn/ja/xv/pnjaxvu9xha1saqk36veq8bghhm.jpeg" alt="图片"><br><br> 哈Ha！ <br><br>  APDU的主题反复提出，但主要涉及智能卡，因为您至少需要在Window $中使用OpenSC控制台界面，所以至少要说起来不便，因为智能卡需要使用读卡器和非可惜的卡以及软件。 <br> 为此，我编写了一个带有窗口界面的小程序，该程序可通过winscard运行。 <br> 源代码和二进制文件可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这里</a>下载。 <br> 这是在Visual Studio 2008下编译的，您需要将Microsoft Windows SDK中的WinSCard.Lib项目添加到项目中。 <br><a name="habracut"></a><br> 他们中的大多数人很可能会拥有蓝鱼，带有EDS证书的EToken PRO Java 72 K已在很多年前过期（使用带有有效EDS的“战斗”，不建议将该令牌用于实验！）。 <br>  JaCarta Pro也适用，仅在外部与etokens不同。 <br> 您也可以尝试使用Gemalto SafeNet eToken 5100，他们可以查看目录的内容，但是由于选择和读取文件的命令之间的时间非常短（可能是几毫秒），因此无法读取文件，因此，读取文件的命令是手动引用的已经在一个空地方（错误代码69 85）。 也许这是在这些令牌上的某些平台上他们不再看到密钥的原因之一。 关于SafeNet eToken 5100（“中国制造”一面带有诚实的铭文），我注意到以下内容：“ JaCarta Single Client”不希望使用它，并显示一条消息，表示该产品不受支持，Aladdin的64位eToken PKI Client 5.1。他没有看到它，但是Win XP的32版本可以使用它，尽管当然对于此令牌，建议安装原始的SafeNet身份验证客户端。 <br><br> 其他令牌（包括JaCarta家族）将不起作用，因为针对它们的APDU命令都完全不同，并且其ISO7816标准中描述的数字值不匹配。 <br><br> 例如，可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在此处</a>找到有关APDU命令格式的详细信息。 <br> 一条蓝鱼的读者可以不坐起床就熟悉APDU的工作。 <br> 必须为eToken eToken PKI Client 5.1或“ JaCarta Single Client”安装驱动程序并连接令牌。 <br><br> 要以方便的形式详细了解令牌的内容并与APDU命令提供的内容进行对帐，可以使用我编写的Autoit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JaCarta编辑器</a> 。 <br><br> 启动APDUExplorer，从阅读器列表中选择“ Aladdin Token JC 0”或“ ARDS JaCarta 0”或“ SafeNet Token JC 0”，然后可以输入命令。 <br> 您可以通过冒号，空格或全部输入。 <br><br> 首先，您可以通过单击“检查ATR”来检查性能并获得令牌响应。 <br><br> 第一个命令是选择默认的applet并转到带有标识符3f00的根目录（此标识符可能是任何供应商的令牌所共有的唯一东西）。 <br>  00：A4：0 00:04:00 <br><br> 接下来，我们获得根目录中的文件夹列表 <br>  80：01：01：00：04：09：02：00：00：CD（命令是常量“ Report folder list”）。 <br> 应该收到答复： <br>  0a 02 66 66 0b 01 00 90 00 <br><br> 响应中的第二个字节是接收到的数据的大小-两个字节，即只有一个文件夹（APDU中的文件或文件夹标识符始终占用两个字节）。 <br> 而且，我们仅看到一个标识符为66 66的文件夹，称为Aladdin AID目录。 <br><br> 报告文件列表（也恒定） <br>  80：01：02：00：04：09：02：00：00：CD <br> 必须收到 <br>  0a 00 0b 01 00 90 00 <br> 位置01的答案是00。 <br><br> 转到目录66 66 <br>  00 A4 08 04 02 66 66 00 <br> 这是一条SELECT FILE命令，其格式为：四个字节，命令00 A4 08 04本身，然后是完整路径的数据字段的大小（在示例02字节中），然后是路径本身（在示例66 66中）和00必须完成。 <br><br> 报告目录列表66 66 <br>  80：01：01：00：04：09：02：00：00：CD <br> 预留字节： <br>  0a 04 50 01 50 00 0b 01 00 90 00 <br> 响应字段01（响应大小）表示04，即  4个字节=两个文件夹50 01和50 00，而50 01是服务文件夹，而50 00是主文件夹，称为PKCS＃11目录，其中存储了所有数据 <br><br> 报告目录列表66 66 <br>  80：01：02：00：04：09：02：00：00：CD <br> 预留字节： <br>  0a 00 0b 01 00 90 00 <br> 这里没有文件。 <br><br> 研究表明，在50 01目录中没有可见的文件夹和文件，因此请转到主目录50 00 <br>  00 A4 08 04 04 66 66 50 00 00 <br> 报告文件夹列表 <br>  80：01：01：00：04：09：02：00：00：CD <br> 答案将取决于令牌上存储的内容。 <br> 报告文件清单 <br>  80：01：02：00：04：09：02：00：00：CD <br> 预留字节： <br>  0a 14 00 0f 00 02 00 03 00 04 00 05 00 06 00 07 00 08 00 09 00 0a 0b 01 00 90 00 <br> 我们看到14个文件（响应字段01），然后每2个字节为文件名，然后有服务信息。 <br><br> 所研究模型的每个标记都始终具有b000系统目录和其中的0002系统文件，尝试对其进行读取，并且可以按照相同的原理读取其他文件。 <br> 进入目录b0 00 <br>  00 A4 08 04 06 66 66 50 00 B0 00 00 <br> 获取文件列表 <br>  80：01：02：00：04：09：02：00：00：CD <br> 预留字节： <br>  0a 02 00 02 0b 01 00 90 00 <br> 我们看到文件00 02（响应字段01中的字节是名称大小（每个名称始终占用两个字节，以下字段是文件名，在这种情况下，只有一个文件，由字段01的值确定）。 <br><br> 从B000中选择文件0002作为完整路径 <br>  00 A4 08 04 08 66 66 50 00 B0 00 00 02 00 <br> 预留字节： <br>  01 01 02 02 02 00 00 02 03 02 00 10 04 08 00 ff 00 00 ff ff ff ff 05 00 90 00 <br> 响应格式如下：前导码-2个字节，文件类型-1个字节（02文件，01文件夹），定界符-2个字节，文件名-2个字节，定界符-2个字节，文件大小-2个字节，定界符-2个字节，访问权限-1字节（00-每个人都可用，63受PIN码保护）。 然后是一些开销信息，以成功执行APDU命令的代码结尾-90 00。 <br><br> 读取此文件后，命令的最后两个字节是缓冲区读取的大小（在这种情况下，它等于文件大小）。 <br>  80 18 00 00 04 0E 02 00 00 10 <br>  Resv字节：（每种情况下的值都将不同）： <br>  00 06 63 61 72 64 63 66 00 00 00 00 00 00 00 00 90 00 <br><br> 我在这里不考虑对令牌的身份验证，因为它由一系列问答命令组成并且已加密（有一个Antitoken项目，从根本上解决了这些产品的授权问题）。 <br> 其他一些令牌（例如JaCarta GOST-2）仅通过传递密码即可支持身份验证。 <br><br> 您可以通过运行<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">从此处</a>编译的嗅探器来拦截WinSCard.dll流量，从而获取任何智能卡和令牌命令的APDU值（实验表明，此嗅探器已安装且仅在Win XP下运行）。 <br><br> 作为参考，执行APDU命令的可能结果： <br>  90 00-好 <br>  69 85-使用条件不满意 <br>  63 00-主机密码验证失败（Ext auth） <br>  64 00-无特定诊断 <br>  67 00-Lc中的长度错误 <br>  67 XX-错误，参数P3不正确（ISO代码） <br>  68 81-逻辑通道不受支持或未激活 <br>  69 82-不满足安全状态 <br>  69 83-密码已锁定 <br>  69 85-当前没有选择的EF，没有监视的命令/没有事务管理器文件 <br>  6A 80-数据字段中的参数不正确 <br>  6A 81-卡被阻止或不支持命令 <br>  6A 82-找不到文件 <br>  6A 85-Lc与TLV结构不一致 <br>  6A 86-错误的P1 P2 <br>  6A 88-找不到参考数据（Init upd） <br>  6D 00-无效指令 <br>  6E 00-类别无效 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN446552/">https://habr.com/ru/post/zh-CN446552/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN446538/index.html">PhotoGuru切换到“暗面”和“更明智”</a></li>
<li><a href="../zh-CN446544/index.html">Microsoft通过Azure IoT创新者和初创公司的新IP优势扩展了Azure IP优势计划</a></li>
<li><a href="../zh-CN446546/index.html">Microsoft通过Azure IoT创新者和初创公司的新IP优势扩展了Azure IP优势</a></li>
<li><a href="../zh-CN446548/index.html">分析广告活动的统计信息-在DataFrame中创建一个新指标（python）</a></li>
<li><a href="../zh-CN446550/index.html">协调器模式问题以及RouteComposer与它有什么关系</a></li>
<li><a href="../zh-CN446554/index.html">Yandex居民计划，或如何使经验丰富的后端成为ML工程师</a></li>
<li><a href="../zh-CN446558/index.html">异国数据结构：修改后的Merkle Patricia Trie</a></li>
<li><a href="../zh-CN446560/index.html">“礼貌交流”：两家最著名的流媒体公司之间冲突的实质</a></li>
<li><a href="../zh-CN446562/index.html">编程异步</a></li>
<li><a href="../zh-CN446566/index.html">零项目。 亚马逊如何应对假货</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>