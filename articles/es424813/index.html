<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶é ‚ùì üë©üèΩ‚Äçü§ù‚Äçüë®üèª Una m√°quina basada en Arduino controlada por un dispositivo Android a trav√©s de Bluetooth - c√≥digo de aplicaci√≥n y mk (parte 2) üë∑ üî§ üë∏üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sobre la primera parte 
 En la primera parte, describ√≠ la parte f√≠sica de la construcci√≥n y solo un peque√±o fragmento de c√≥digo. Ahora considere el co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Una m√°quina basada en Arduino controlada por un dispositivo Android a trav√©s de Bluetooth - c√≥digo de aplicaci√≥n y mk (parte 2)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424813/"><h2>  Sobre la primera parte </h2><br>  En la primera parte, describ√≠ la parte f√≠sica de la construcci√≥n y solo un peque√±o fragmento de c√≥digo.  Ahora considere el componente de software: una aplicaci√≥n de Android y un boceto de Arduino. <br><br>  Primero, dar√© una descripci√≥n detallada de cada momento, y al final dejar√© enlaces a todo el proyecto + un video del resultado, lo que deber√≠a <s>decepcionarte</s> . <br><a name="habracut"></a><br><h2>  Aplicaci√≥n de Android </h2><br>  El programa para Android se divide en dos partes: la primera es conectar el dispositivo a trav√©s de Bluetooth, la segunda es el joystick de control. <br><br>  Te advierto: el dise√±o de la aplicaci√≥n no se resolvi√≥ en absoluto y se hizo con un error, si solo funcion√≥.  La adaptabilidad y la experiencia de usuario no esperan, pero no deber√≠an salir de la pantalla. <br><br><h3>  Dise√±o </h3><br>  La actividad inicial se basa en el dise√±o, elementos: botones y dise√±o para una lista de dispositivos.  El bot√≥n inicia el proceso de b√∫squeda de dispositivos con Bluetooth activo.  ListView muestra los dispositivos encontrados. <br><br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:tools</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/tools"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"60dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentStart</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginStart</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"40dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"50dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/start_search"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/button_start_find"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"60dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginEnd</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/button_start_control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/start_control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentEnd</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/list_device"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"300dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"200dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginEnd</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentEnd</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  La pantalla de control se basa en un dise√±o, en el que solo hay un bot√≥n, que en el futuro se convertir√° en un joystick.  Se adjunta un bot√≥n al bot√≥n a trav√©s del atributo de fondo, haci√©ndolo redondo. <br>  TextView no se usa en la versi√≥n final, pero se agreg√≥ originalmente para la depuraci√≥n: se mostraban los n√∫meros enviados a trav√©s de Bluetooth.  En la etapa inicial, te aconsejo que uses.  Pero luego los n√∫meros comenzar√°n a calcularse en una secuencia separada, desde la cual es dif√≠cil acceder a TextView. <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"200dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"200dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentStart</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"25dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginStart</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"15dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/button_drive_control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/button_control_circle"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentEnd</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:minWidth</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"70dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/view_result_touch"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginEnd</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"90dp"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  El archivo button_control_circle.xml (estilo), debe colocarse en la carpeta dibujable: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shape</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:shape</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rectangle"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">solid</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#00F"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">corners</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:bottomRightRadius</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:bottomLeftRadius</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:topRightRadius</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:topLeftRadius</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100dp"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shape</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Tambi√©n debe crear el archivo item_device.xml, es necesario para cada elemento de la lista: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"150dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"40dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/item_device_textView"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><h3>  Manifiesto </h3><br>  Por si acaso, le dar√© el c√≥digo de manifiesto completo.  Debe obtener acceso completo al bluetooth a trav√©s de permisos de uso y no olvide indicar la segunda actividad a trav√©s de la etiqueta de actividad. <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.example.bluetoothapp"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.BLUETOOTH"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.BLUETOOTH_ADMIN"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:allowBackup</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@mipmap/ic_launcher"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/app_name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:roundIcon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@mipmap/ic_launcher_round"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:supportsRtl</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:theme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@style/AppTheme"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.arproject.bluetoothworkapp.MainActivity"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:theme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@style/Theme.AppCompat.NoActionBar"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:screenOrientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"landscape"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.MAIN"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.LAUNCHER"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.arproject.bluetoothworkapp.ActivityControl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:theme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@style/Theme.AppCompat.NoActionBar"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:screenOrientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"landscape"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><h3>  La actividad principal, emparejar Arduino y Android </h3><br>  Heredamos la clase de AppCompatActivity y declaramos las variables: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BluetoothAdapter bluetoothAdapter; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ListView listView; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ArrayList&lt;String&gt; pairedDeviceArrayList; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ArrayAdapter&lt;String&gt; pairedDeviceAdapter; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> BluetoothSocket clientSocket; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button buttonStartControl; }</code> </pre><br>  Describir√© el m√©todo onCreate () l√≠nea por l√≠nea: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); <span class="hljs-comment"><span class="hljs-comment">//  //    setContentView(R.layout.activity_main); //    Button buttonStartFind = (Button) findViewById(R.id.button_start_find); // layout,       listView = (ListView) findViewById(R.id.list_device); //    buttonStartFind.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View v) { //   ( ) if(permissionGranted()) { //    bluetoothAdapter = BluetoothAdapter.getDefaultAdapter(); if(bluetoothEnabled()) { //   ( ) findArduino(); //   ( ) } } } }); //      buttonStartControl = (Button) findViewById(R.id.button_start_control); buttonStartControl.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View v) { //     Intent intent = new Intent(); //    intent.setClass(getApplicationContext(), ActivityControl.class); //  ,    startActivity(intent); } }); }</span></span></code> </pre><br>  Las funciones a continuaci√≥n verifican si se obtiene el permiso para usar el bluetooth (sin el permiso del usuario, no podremos transferir datos) y si el bluetooth est√° activado: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">permissionGranted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   ,  true if (ContextCompat.checkSelfPermission(getApplicationContext(), Manifest.permission.BLUETOOTH) == PermissionChecker.PERMISSION_GRANTED &amp;&amp; ContextCompat.checkSelfPermission(getApplicationContext(), Manifest.permission.BLUETOOTH_ADMIN) == PermissionChecker.PERMISSION_GRANTED) { return true; } else { ActivityCompat.requestPermissions(this, new String[] {Manifest.permission.BLUETOOTH, Manifest.permission.BLUETOOTH_ADMIN}, 0); return false; } } private boolean bluetoothEnabled() { //  ,  true,  ,      if(bluetoothAdapter.isEnabled()) { return true; } else { Intent enableBtIntent = new Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE); startActivityForResult(enableBtIntent, 0); return false; } }</span></span></code> </pre><br>  Si se pasan todas las verificaciones, comienza la b√∫squeda del dispositivo.  Si no se cumple una de las condiciones, se mostrar√° una notificaci√≥n que diga "¬øpermitir \ habilitar?", Y esto se repetir√° hasta que se pase la verificaci√≥n. <br><br>  La b√∫squeda de dispositivos se divide en tres partes: preparar la lista, agregar a la lista de dispositivos encontrados, establecer una conexi√≥n con el dispositivo seleccionado. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findArduino</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    Set&lt;BluetoothDevice&gt; pairedDevice = bluetoothAdapter.getBondedDevices(); if (pairedDevice.size() &gt; 0) { //     pairedDeviceArrayList = new ArrayList&lt;&gt;(); //  for(BluetoothDevice device: pairedDevice) { //      //: " /" pairedDeviceArrayList.add(device.getAddress() + "/" + device.getName()); } } //  ,    item_device.xml pairedDeviceAdapter = new ArrayAdapter&lt;String&gt;(getApplicationContext(), R.layout.item_device, R.id.item_device_textView, pairedDeviceArrayList); listView.setAdapter(pairedDeviceAdapter); //      listView.setOnItemClickListener(new AdapterView.OnItemClickListener() { @Override public void onItemClick(AdapterView&lt;?&gt; adapterView, View view, int i, long l) { //    String itemMAC = listView.getItemAtPosition(i).toString().split("/", 2)[0]; //      BluetoothDevice connectDevice = bluetoothAdapter.getRemoteDevice(itemMAC); try { // socket - ,      Method m = connectDevice.getClass().getMethod( "createRfcommSocket", new Class[]{int.class}); clientSocket = (BluetoothSocket) m.invoke(connectDevice, 1); clientSocket.connect(); if(clientSocket.isConnected()) { //  ,   bluetoothAdapter.cancelDiscovery(); } } catch(Exception e) { e.getStackTrace(); } } }); }</span></span></code> </pre><br>  Cuando se encuentra un m√≥dulo Bluetooth colgado en un Arduino (m√°s sobre esto m√°s adelante), aparecer√° en la lista.  Al hacer clic en √©l, comenzar√° a crear un socket (puede que tenga que esperar 3-5 segundos despu√©s de un clic o haga clic nuevamente).  Comprender√° que la conexi√≥n se establece mediante los LED en el m√≥dulo Bluetooth: sin conexi√≥n, parpadean r√°pidamente, si hay una conexi√≥n, la frecuencia disminuye notablemente. <br><br><img src="https://habrastorage.org/webt/hg/ok/nf/hgoknf_kwj_yobhcauvx_9lwf1o.png"><br><h3>  Administrar y enviar comandos </h3><br>  Una vez establecida la conexi√≥n, puede continuar con la segunda actividad: ActivityControl.  Solo habr√° un c√≠rculo azul en la pantalla: el joystick.  Est√° hecho del bot√≥n habitual, el marcado se da arriba. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActivityControl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//,   private Button buttonDriveControl; private float BDCheight, BDCwidth; private float centerBDCheight, centerBDCwidth; private String angle = "90"; //0, 30, 60, 90, 120, 150, 180 private ConnectedThread threadCommand; private long lastTimeSendCommand = System.currentTimeMillis(); }</span></span></code> </pre><br>  En el m√©todo onCreate (), se lleva a cabo toda la acci√≥n principal: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//        performClick() //    @SuppressLint("ClickableViewAccessibility") @Override protected void onCreate(Bundle savedInstanceState) { //  super.onCreate(savedInstanceState); // ,    setContentView(R.layout.activity_control); //  buttonDriveControl = (Button) findViewById(R.id.button_drive_control); //    final ViewTreeObserver vto = buttonDriveControl.getViewTreeObserver(); vto.addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener() { @Override public void onGlobalLayout() { //      (!) BDCheight = buttonDriveControl.getHeight(); BDCwidth = buttonDriveControl.getWidth(); //    (!) centerBDCheight = BDCheight/2; centerBDCwidth = BDCwidth/2; // GlobalListener,     buttonDriveControl.getViewTreeObserver().removeOnGlobalLayoutListener(this); } }); // ,     //    buttonDriveControl.setOnTouchListener(new ControlDriveInputListener()); //  ,      //    ,     //    threadCommand = new ConnectedThread(MainActivity.clientSocket); threadCommand.run(); }</span></span></code> </pre><br>  Presta atenci√≥n (!): Descubriremos cu√°ntos p√≠xeles ocupa el bot√≥n.  Gracias a esto, obtenemos adaptabilidad: el tama√±o del bot√≥n depender√° de la resoluci√≥n de la pantalla, pero el resto del c√≥digo se adaptar√° f√°cilmente a esto, porque no arreglamos los tama√±os por adelantado.  M√°s tarde, le ense√±aremos a la aplicaci√≥n a averiguar d√≥nde estaba el toque y luego lo traduciremos a valores que sean comprensibles para arduinki de 0 a 255 (despu√©s de todo, el toque puede estar a 456 p√≠xeles desde el centro y MK no funcionar√° con ese n√∫mero). <br><br>  El siguiente es el c√≥digo para ControlDriveInputListener (), esta clase se encuentra en la clase de la actividad en s√≠, despu√©s del m√©todo onCreate ().  Al estar en el archivo ActivityControl, la clase ControlDriveInputListener se convierte en secundaria, lo que significa que tiene acceso a todas las variables de la clase principal. <br><br>  No preste atenci√≥n a las funciones que se invocan al hacer clic.  Ahora estamos interesados ‚Äã‚Äãen el proceso de capturar toques: en qu√© punto la persona puso su dedo y qu√© datos obtendremos al respecto. <br><br>  Tenga en cuenta que uso la clase java.util.Timer: le permite crear un nuevo hilo que puede tener un retraso y se repetir√° un n√∫mero infinito de veces despu√©s de cada en√©simo n√∫mero de segundos.  Debe usarse para la siguiente situaci√≥n: la persona puso un dedo, el m√©todo ACTION_DOWN funcion√≥, la informaci√≥n fue al arduino, y luego la persona decidi√≥ no mover el dedo, porque la velocidad le conviene.  La segunda vez, el m√©todo ACTION_DOWN no ‚Äã‚Äãfuncionar√°, ya que primero debe llamar a ACTION_UP (para levantar el dedo de la pantalla). <br><br>  Bueno, comenzamos el bucle de clase Timer () y comenzamos a enviar los mismos datos cada 10 milisegundos.  Cuando se mueve el dedo (ACTION_MOVE funcionar√°) o se levanta (ACTION_UP), el ciclo del Temporizador debe cancelarse para que los datos de la prensa anterior no comiencen a enviarse nuevamente. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ControlDriveInputListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnTouchListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Timer timer; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTouch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View view, MotionEvent motionEvent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     //      (!) final float x = motionEvent.getX(); final float y = motionEvent.getY(); //,     switch(motionEvent.getAction()) { //  //  ,      case MotionEvent.ACTION_DOWN: //  timer = new Timer(); //  // :    0, //  10  timer.schedule(new TimerTask() { @Override public void run() { //   calculateAndSendCommand(x, y); } }, 0, 10); break; //    (  ACTION_DOWN) case MotionEvent.ACTION_MOVE: // (!) //     Timer(),   if(timer != null) { timer.cancel(); timer = null; } //   timer = new Timer(); //     ,    ACTION_UP timer.schedule(new TimerTask() { @Override public void run() { calculateAndSendCommand(x, y); } }, 0, 10); break; //     case MotionEvent.ACTION_UP: //  if(timer != null) { timer.cancel(); timer = null; } break; } return false; } }</span></span></code> </pre><br>  Preste atenci√≥n nuevamente: el m√©todo x e y cuenta con Touch () conduce desde la esquina superior izquierda de la Vista.  En nuestro caso, el punto (0; 0) se encuentra en el bot√≥n aqu√≠: <br><br><img src="https://habrastorage.org/webt/7m/yt/on/7mytonhvh6albac02enghpbmce0.png"><br><br>  Ahora que hemos aprendido c√≥mo obtener la ubicaci√≥n actual del dedo en los botones, descubriremos c√≥mo convertir p√≠xeles (porque x e y son solo la distancia en p√≠xeles) a valores de trabajo.  Para hacer esto, uso el m√©todo CalculateAndSendCommand (x, y), que debe colocarse en la clase ControlDriveInputListener.  Tambi√©n necesitar√° algunos m√©todos auxiliares, los escribimos en la misma clase despu√©s de CalculateAndSendCommand (x, y). <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateAndSendCommand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    //   // - 1, 2, 3, 4 // ,   ,      // ,     ,     int quarter = identifyQuarter(x, y); //       // y,        int speed = speedCalculation(centerBDCheight - y); //   //   ,    7   String angle = angleCalculation(x); //     ,     //      ,      /*String resultDown = "x: "+ Float.toString(x) + " y: " + Float.toString(y) + " qr: " + Integer.toString(quarter) + "\n" + "height: " + centerBDCheight + " width: " + centerBDCwidth + "\n" + "speed: " + Integer.toString(speed) + " angle: " + angle; */ //viewResultTouch.setText(resultDown); //  ,    //      (  ),   100  if((System.currentTimeMillis() - lastTimeSendCommand) &gt; 100) { //   threadCommand.sendCommand(Integer.toString(speed), angle); //     lastTimeSendCommand = System.currentTimeMillis(); } } private int identifyQuarter(float x, float y) { //,      //  if(x &gt; centerBDCwidth &amp;&amp; y &gt; centerBDCheight) { return 4; } else if (x &lt; centerBDCwidth &amp;&amp; y &gt;centerBDCheight) { return 3; } else if (x &lt; centerBDCwidth &amp;&amp; y &lt; centerBDCheight) { return 2; } else if (x &gt; centerBDCwidth &amp;&amp; y &lt; centerBDCheight) { return 1; } return 0; } private int speedCalculation(float deviation) { //  //      float coefficient = 255/(BDCheight/2); //    //   int speed = Math.round(deviation * coefficient); //    70,    // ,    ,    if(speed &gt; 0 &amp;&amp; speed &lt; 70) speed = 0; if(speed &lt; 0 &amp;&amp; speed &gt; - 70) speed = 0; //     120 // ,     if(speed &lt; 120 &amp;&amp; speed &gt; 70) speed = 120; if(speed &gt; -120 &amp;&amp; speed &lt; -70) speed = -120; //     , ACTION_MOVE   //    ,     //      if(speed &gt; 255 ) speed = 255; if(speed &lt; - 255) speed = -255; //:  &gt; 0 -  , &lt; 0 -  return speed; } private String angleCalculation(float x) { //    7  //0 -  , 180 -  //90 -    if(x &lt; BDCwidth/6) { angle = "0"; } else if (x &gt; BDCwidth/6 &amp;&amp; x &lt; BDCwidth/3) { angle = "30"; } else if (x &gt; BDCwidth/3 &amp;&amp; x &lt; BDCwidth/2) { angle = "60"; } else if (x &gt; BDCwidth/2 &amp;&amp; x &lt; BDCwidth/3*2) { angle = "120"; } else if (x &gt; BDCwidth/3*2 &amp;&amp; x &lt; BDCwidth/6*5) { angle = "150"; } else if (x &gt; BDCwidth/6*5 &amp;&amp; x &lt; BDCwidth) { angle = "180"; } else { angle = "90"; } return angle; }</span></span></code> </pre><br>  Cuando los datos se calculan y transfieren, la segunda transmisi√≥n ingresa al juego.  √âl es responsable de enviar la informaci√≥n.  No puede prescindir de √©l, de lo contrario, los datos de transmisi√≥n del socket ralentizar√°n la captura de toques, se crear√° una cola y todo el final ser√° m√°s corto. <br><br>  La clase ConnectedThread tambi√©n se encuentra en la clase ActivityControl. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConnectedThread</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Thread</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> BluetoothSocket socket; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> OutputStream outputStream; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConnectedThread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BluetoothSocket btSocket)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  this.socket = btSocket; //  -       OutputStream os = null; try { os = socket.getOutputStream(); } catch(Exception e) {} outputStream = os; } public void run() { } public void sendCommand(String speed, String angle) { //    ,   byte[] speedArray = speed.getBytes(); byte[] angleArray = angle.getBytes(); //    //  ,  ,       String a = "#"; String b = "@"; String c = "*"; try { outputStream.write(b.getBytes()); outputStream.write(speedArray); outputStream.write(a.getBytes()); outputStream.write(c.getBytes()); outputStream.write(angleArray); outputStream.write(a.getBytes()); } catch(Exception e) {} } }</span></span></code> </pre><br><h3>  Resumiendo la aplicaci√≥n de Android </h3><br>  Resuma brevemente todos los inc√≥modos anteriores. <br><br><ol><li>  En ActivityMain configuramos bluetooth, establecemos una conexi√≥n. </li><li>  En el ActivityControl adjuntamos el bot√≥n y obtenemos datos al respecto. </li><li>  Colgamos el bot√≥n OnTouchListener, se toca, toca y levanta un dedo. </li><li>  Los datos obtenidos (punto con coordenadas xey) se convierten al √°ngulo de rotaci√≥n y la velocidad. </li><li>  Enviamos datos, separ√°ndolos con caracteres especiales. </li></ol><br>  Y la comprensi√≥n final le llegar√° cuando vea todo el c√≥digo: <a href="">github.com/IDolgopolov/BluetoothWorkAPP.git</a> .  No hay c√≥digo de comentario, por lo que se ve mucho m√°s limpio, m√°s peque√±o y m√°s simple. <br><h2>  Sketch Arduino </h2><br>  La aplicaci√≥n de Android est√° desmontada, escrita, entendida ... y aqu√≠ ser√° m√°s f√°cil.  Tratar√© de considerar todo por etapas, y luego dar√© un enlace al archivo completo. <br><h3>  Variables </h3><br>  Primero, considere las constantes y variables que necesitar√°. <br><br><pre> <code class="hljs vhdl">#include &lt;SoftwareSerial.h&gt; //  \  //          SoftwareSerial BTSerial(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>); //    int speedRight = <span class="hljs-number"><span class="hljs-number">6</span></span>; int dirLeft = <span class="hljs-number"><span class="hljs-number">3</span></span>; int speedLeft = <span class="hljs-number"><span class="hljs-number">11</span></span>; int dirRight = <span class="hljs-number"><span class="hljs-number">7</span></span>; // ,   int angleDirection = <span class="hljs-number"><span class="hljs-number">4</span></span>; int angleSpeed = <span class="hljs-number"><span class="hljs-number">5</span></span>; //,     ,   //      int pinAngleStop = <span class="hljs-number"><span class="hljs-number">12</span></span>; //    <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> val; //  int speedTurn = <span class="hljs-number"><span class="hljs-number">180</span></span>; //,    //       int pinRed = A0; int pinWhite = A1; int pinBlack = A2; //   long lastTakeInformation; //, ,     <span class="hljs-built_in"><span class="hljs-built_in">boolean</span></span> readAngle = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">boolean</span></span> readSpeed = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre><br><h3>  M√©todo de configuraci√≥n () </h3><br>  En el m√©todo setup (), establecemos los par√°metros de los pines: funcionar√°n en entrada o salida.  Tambi√©n establecemos la velocidad de comunicaci√≥n de la computadora con el arduino, bluetooth con el arduino. <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> setup() { pinMode(dirLeft, OUTPUT); pinMode(speedLeft, OUTPUT); pinMode(dirRight, OUTPUT); pinMode(speedRight, OUTPUT); pinMode(pinRed, <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span>); pinMode(pinBlack, <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span>); pinMode(pinWhite, <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span>); pinMode(pinAngleStop, OUTPUT); pinMode(angleDirection, OUTPUT); pinMode(angleSpeed, OUTPUT); //      HC<span class="hljs-number"><span class="hljs-number">-05</span></span> //     ,   BTSerial.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">38400</span></span>); //   <span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">9600</span></span>); }</code> </pre><br><h3>  M√©todo Loop () y funciones adicionales </h3><br>  En el m√©todo loop () que se repite constantemente, los datos se leen.  Primero, considere el algoritmo principal, y luego las funciones involucradas en √©l. <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { //    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(BTSerial.available() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { //    <span class="hljs-type"><span class="hljs-type">char</span></span> a = BTSerial.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a == <span class="hljs-string"><span class="hljs-string">'@'</span></span>) { //   @ (   ) //  val val = ""; //,     readSpeed = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (readSpeed) { //         //   val <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(a == <span class="hljs-string"><span class="hljs-string">'#'</span></span>) { //   ,     //      <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(val); //,      readSpeed = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; //      go(val.toInt()); // val val = ""; //  ,     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } val+=a; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a == <span class="hljs-string"><span class="hljs-string">'*'</span></span>) { //    readAngle = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (readAngle) { // ,     //  ,    val <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(a == <span class="hljs-string"><span class="hljs-string">'#'</span></span>) { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(val); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("-----"); readAngle = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; //     turn(val.toInt()); val= ""; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } val+=a; } //     lastTakeInformation = millis(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { //   ,      <span class="hljs-number"><span class="hljs-number">150</span></span>  //  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(millis() - lastTakeInformation &gt; <span class="hljs-number"><span class="hljs-number">150</span></span>) { lastTakeInformation = <span class="hljs-number"><span class="hljs-number">0</span></span>; analogWrite(angleSpeed, <span class="hljs-number"><span class="hljs-number">0</span></span>); analogWrite(speedRight, <span class="hljs-number"><span class="hljs-number">0</span></span>); analogWrite(speedLeft, <span class="hljs-number"><span class="hljs-number">0</span></span>); } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtenemos el resultado: desde el tel√©fono enviamos bytes al estilo de "@ speed # angle #" (por ejemplo, un comando t√≠pico "@ 200 # 60 #". Este ciclo se repite cada 100 milisegundos, ya que en Android establecemos este intervalo para enviar comandos. En resumen, haga no tiene sentido, ya que comienzan a hacer cola, y si lo haces m√°s largo, las ruedas comienzan a moverse bruscamente. Todos los </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retrasos a trav√©s del comando delay (), que ver√°s m√°s adelante, se seleccionan no mediante c√°lculos f√≠sicos y matem√°ticos, sino emp√≠ricamente. zadrezham, la m√°quina funciona sin problemas, y en Todos los equipos tienen tiempo para hacer ejercicio (las corrientes tienen tiempo de atravesarlas). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se utilizan dos funciones secundarias en el ciclo, toman los datos recibidos y hacen que la m√°quina funcione y gire.</font></font><br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> go(<span class="hljs-type"><span class="hljs-type">int</span></span> mySpeed) { //   <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(mySpeed &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { //  digitalWrite(dirRight, HIGH); analogWrite(speedRight, mySpeed); digitalWrite(dirLeft, HIGH); analogWrite(speedLeft, mySpeed); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { //   <span class="hljs-number"><span class="hljs-number">0</span></span>,   digitalWrite(dirRight, LOW); analogWrite(speedRight, abs(mySpeed) + <span class="hljs-number"><span class="hljs-number">30</span></span>); digitalWrite(dirLeft, LOW); analogWrite(speedLeft, abs(mySpeed) + <span class="hljs-number"><span class="hljs-number">30</span></span>); } delay(<span class="hljs-number"><span class="hljs-number">10</span></span>); } <span class="hljs-type"><span class="hljs-type">void</span></span> turn(<span class="hljs-type"><span class="hljs-type">int</span></span> angle) { //      digitalWrite(pinAngleStop, HIGH); // ,     delay(<span class="hljs-number"><span class="hljs-number">5</span></span>); //  <span class="hljs-number"><span class="hljs-number">150</span></span>  ,   // <span class="hljs-number"><span class="hljs-number">30</span></span>  ,   //  <span class="hljs-number"><span class="hljs-number">31</span></span>  <span class="hljs-number"><span class="hljs-number">149</span></span>     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(angle &gt; <span class="hljs-number"><span class="hljs-number">149</span></span>) { //  ,      //   ,    //    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( digitalRead(pinWhite) == HIGH &amp;&amp; digitalRead(pinBlack) == LOW &amp;&amp; digitalRead(pinRed) == LOW) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } //      //  digitalWrite(angleDirection, HIGH); analogWrite(angleSpeed, speedTurn); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (angle &lt; <span class="hljs-number"><span class="hljs-number">31</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(digitalRead(pinRed) == HIGH &amp;&amp; digitalRead(pinBlack) == HIGH &amp;&amp; digitalRead(pinWhite) == HIGH) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } digitalWrite(angleDirection, LOW); analogWrite(angleSpeed, speedTurn); } //  digitalWrite(pinAngleStop, LOW); delay(<span class="hljs-number"><span class="hljs-number">5</span></span>); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gire cuando el Android env√≠e datos que el usuario fij√≥ el √°ngulo de 60, 90, 120, no vale la pena, de lo contrario no podr√° ir directamente. </font><font style="vertical-align: inherit;">S√≠, tal vez no deber√≠a enviar inmediatamente un comando de giro desde el androide si el √°ngulo es demasiado peque√±o, pero en mi opini√≥n, esto es de alguna manera torpe.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Resultados de croquis </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un boceto tiene solo tres pasos importantes: leer un comando, procesar los l√≠mites de rotaci√≥n y suministrar corriente a los motores. </font><font style="vertical-align: inherit;">Todo suena simple, y en ejecuci√≥n es m√°s f√°cil que f√°cil, aunque fue creado durante mucho tiempo y con embotamientos. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La versi√≥n completa del boceto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Al final </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se acab√≥ un inventario completo de varios meses de trabajo. </font><font style="vertical-align: inherit;">La parte f√≠sica se desmonta, el software a√∫n m√°s. </font><font style="vertical-align: inherit;">El principio sigue siendo el mismo: contacto para fen√≥menos incomprensibles, lo entenderemos juntos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y los comentarios en la primera parte son interesantes, aconsejaron una monta√±a de consejos √∫tiles, </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gracias</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a todos.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Video de resultados </font></font></h3><br><iframe width="560" height="315" src="https://www.youtube.com/embed/tRlm48wx9-Q" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es424813/">https://habr.com/ru/post/es424813/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es424801/index.html">Zeppelin OS: otro paso hacia contratos inteligentes seguros</a></li>
<li><a href="../es424803/index.html">El hacker taiwan√©s estaba a punto de hackear la p√°gina de Facebook de Mark Zuckerberg en l√≠nea, pero luego abandon√≥ sus amenazas.</a></li>
<li><a href="../es424805/index.html">C√≥mo escrib√≠ un diploma en LaTeX con GitHub, Docker y TravisCI</a></li>
<li><a href="../es424807/index.html">EOIP entre DD-WRT y Keenetic Giga 2 para combinar dos apartamentos en una red o un HDD en dos apartamentos</a></li>
<li><a href="../es424809/index.html">ADN Mecanismos para almacenar y procesar informaci√≥n. Parte 1</a></li>
<li><a href="../es424815/index.html">Facebook hackeado: hasta 90 millones de cuentas de usuario fueron atacadas debido a un error de c√≥digo, la compa√±√≠a se disculpa</a></li>
<li><a href="../es424817/index.html">Dise√±o de producto digital. Prop√≥sito, Rol, M√©todo</a></li>
<li><a href="../es424819/index.html">Validaci√≥n de datos - Validaci√≥n de Java y Spring</a></li>
<li><a href="../es424821/index.html">Sobre demonios y teletransportaci√≥n: dos tecnolog√≠as que acercan el futuro cu√°ntico</a></li>
<li><a href="../es424823/index.html">C√≥mo la nutrici√≥n baja en calor√≠as afecta el envejecimiento</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>