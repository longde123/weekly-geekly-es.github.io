<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîÅ ‚óºÔ∏è ü§æüèæ Palestras da Kaspersky Mobile # 1. Multi-modularidade üßîüèº üì∏ üëæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No final de fevereiro, lan√ßamos um novo formato para reuni√µes de desenvolvedores Android do Kaspersky Mobile Talks . A principal diferen√ßa dos com√≠cio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Palestras da Kaspersky Mobile # 1. Multi-modularidade</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/kaspersky/blog/446626/"><p>  No final de fevereiro, lan√ßamos um novo formato para reuni√µes de desenvolvedores Android do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Kaspersky Mobile Talks</a> .  A principal diferen√ßa dos com√≠cios comuns √© que, em vez de centenas de ouvintes e belas apresenta√ß√µes, desenvolvedores "experientes" se reuniram em v√°rios t√≥picos diferentes para discutir apenas um t√≥pico: como eles implementam a multi-modularidade em seus aplicativos, quais problemas enfrentam e como resolv√™-los. </p><br><p><img src="https://habrastorage.org/webt/i5/da/5v/i5da5vzrshhino9ayx-a5e6ikkc.jpeg"></p><a name="habracut"></a><br><h2 id="soderzhanie">  Conte√∫do </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Antecedentes</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mediadores no HeadHunter.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Alexander Blinov</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">M√≥dulos de Dom√≠nio Tinkoff</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vladimir Kokhanov, Alexander Zhukov</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">An√°lise de impacto no Avito.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mikhail Yudin, Evgeny Krivobokov</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como em Tinkoff, eles reduziram o tempo de montagem para o PR de quarenta minutos para quatro.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vladimir Kokhanov</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Links √∫teis</a> </li></ol><br><a name="history"></a><br><p>  Antes de prosseguir para o conte√∫do imediato da reuni√£o no escrit√≥rio da Kaspersky Lab, lembremos de onde veio o mod para dividir o aplicativo em m√≥dulos (daqui em diante, o m√≥dulo √© entendido como um m√≥dulo Gradle, n√£o um Dagger, a menos que seja indicado de outra forma). </p><br><p>  O t√≥pico da multi-modularidade est√° na mente da comunidade Android h√° anos.  Um dos fundamentos pode ser considerado um relat√≥rio de Denis Neklyudov no ano passado "Mobius" em S√£o Petersburgo.  Ele prop√¥s dividir o aplicativo monol√≠tico, que h√° muito deixou de ser um thin client, em m√≥dulos para aumentar a velocidade de constru√ß√£o. <br>  Link para o relat√≥rio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Apresenta√ß√£o</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V√≠deo</a> </p><br><p>  Houve um relat√≥rio de Vladimir Tagakov, do Yandex.Maps, sobre a vincula√ß√£o de m√≥dulos usando o Dagger.  Assim, eles resolvem o problema de alocar um √∫nico componente de cart√µes para reutiliza√ß√£o em muitos outros aplicativos Yandex. <br>  Link para o relat√≥rio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Apresenta√ß√£o</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V√≠deo</a> </p><br><p>  A Kaspersky Lab tamb√©m n√£o se afastou da tend√™ncia: em setembro, Evgeni Matsyuk escreveu um artigo sobre como conectar m√≥dulos usando o Dagger e, ao mesmo tempo, construiu uma arquitetura de m√∫ltiplos m√≥dulos horizontalmente, sem esquecer de seguir verticalmente os princ√≠pios da arquitetura limpa. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Link para o artigo</a> </p><br><p>  E no inverno Mobius houve dois relat√≥rios ao mesmo tempo.  Primeiro, Alexander Blinov falou sobre a multi-modularidade no aplicativo HeadHunter usando o Toothpick como DI, e logo ap√≥s ele Artem Zinnatulin falou sobre a dor de mais de 800 m√≥dulos no Lyft.  Sasha come√ßou a falar sobre multi-modularidade, como uma maneira de melhorar a arquitetura do aplicativo, e n√£o apenas acelerar a montagem. <br>  Relat√≥rio Blinov: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Apresenta√ß√£o</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V√≠deo</a> <br>  Relat√≥rio Zinnatulin: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V√≠deo</a> </p><br><p> Por que comecei o artigo com uma retrospectiva?  Em primeiro lugar, ele ajudar√° voc√™ a estudar melhor o t√≥pico se estiver lendo sobre multi-modularidade pela primeira vez.  Em segundo lugar, o primeiro discurso em nossa reuni√£o come√ßou com uma mini-apresenta√ß√£o de Alexey Kalaida, da empresa Stream, que mostrou como eles dividiram seu aplicativo em m√≥dulos com base no artigo de Zhenya (e alguns pontos me pareciam semelhantes √† abordagem de Vladimir). </p><br><p>  O principal recurso dessa abordagem foi a liga√ß√£o √† interface do usu√°rio: cada m√≥dulo √© conectado como uma tela separada - um fragmento para o qual as depend√™ncias s√£o transferidas do m√≥dulo de aplicativo principal, incluindo o FragmentManager.  Primeiro, os colegas tentaram implementar a multi-modularidade por meio de injetores proxy, que Zhenya prop√¥s no artigo.  Mas essa abordagem parecia esmagadora: havia problemas quando um recurso dependia de outro, que por sua vez dependia do terceiro - tivemos que escrever um injetor proxy para cada m√≥dulo de recurso.  A abordagem baseada nos componentes da interface do usu√°rio permite que voc√™ n√£o escreva nenhum injetor, permitindo depend√™ncias no n√≠vel de depend√™ncia dos fragmentos de destino. </p><br><p>  As principais limita√ß√µes desta implementa√ß√£o: um recurso deve ser um fragmento (ou outra visualiza√ß√£o);  a presen√ßa de fragmentos aninhados, o que leva a um grande clich√™.  Se um recurso implementa outros recursos, ele deve ser adicionado ao mapa de depend√™ncia, que o Dagger verifica ao compil√°-lo.  Quando existem muitos desses recursos, surgem dificuldades no momento de vincular o gr√°fico de depend√™ncia. </p><br><a name="hh"></a><br><p>  Ap√≥s o relat√≥rio de Alexey, Alexander Blinov tomou a palavra.  Na sua opini√£o, a implementa√ß√£o vinculada √† interface do usu√°rio seria adequada para cont√™ineres DI em Flutter.  Em seguida, a discuss√£o mudou para uma discuss√£o com v√°rios m√≥dulos no HeadHunter.  O objetivo de sua divis√£o em m√≥dulos era a possibilidade de isolamento arquitet√¥nico de recursos e aumentar a velocidade de montagem. </p><br><p>  Antes de dividir em m√≥dulos, √© importante se preparar.  Primeiro, voc√™ pode criar um gr√°fico de depend√™ncia - por exemplo, usando essa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ferramenta</a> .  Isso ajudar√° a identificar componentes com um n√∫mero m√≠nimo de depend√™ncias e a se livrar de desnecess√°rias (chop).  Somente depois disso, os componentes menos conectados podem ser selecionados nos m√≥dulos. </p><br><p>  Alexander lembrou os principais pontos sobre os quais falou com mais detalhes na Mobius.  Uma das tarefas complexas que a arquitetura deve levar em considera√ß√£o √© a reutiliza√ß√£o de um m√≥dulo de v√°rios locais no aplicativo.  No exemplo com o aplicativo hh, este √© um m√≥dulo de curr√≠culo, que deve estar acess√≠vel tanto ao m√≥dulo da lista de vagas (VacanciesList), quando o usu√°rio acessa o curr√≠culo que ele enviou para essa vaga quanto ao m√≥dulo de resposta negativa (Negocia√ß√£o).  Para maior clareza, redesenhei a imagem que Sasha mostrava em um flipchart. </p><br><p><img src="https://habrastorage.org/webt/e8/yv/jj/e8yvjjob9amuir_xu9693i2qisk.png"></p><br><p>  Cada m√≥dulo cont√©m duas entidades principais: Depend√™ncias - as depend√™ncias que esse m√≥dulo precisa e API - os m√©todos que o m√≥dulo fornece para outros m√≥dulos.  A comunica√ß√£o entre os m√≥dulos √© realizada por mediadores, que s√£o uma estrutura plana no principal m√≥dulo de aplicativo.  Cada recurso tem uma escolha.  Os pr√≥prios mediadores est√£o inclu√≠dos em um determinado MediatorManager no m√≥dulo de aplicativo do projeto.  No c√≥digo, parece algo como isto: </p><br><pre><code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">object</span></span> MediatorManager { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> chatMediator: ChatMediator <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> lazy { ChatMediator() } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> someMediator: ... } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TechSupportMediator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">provideComponent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: SuppportComponent { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deps = <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : SuppportComponentDependencies { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> getInternalChat{ MediatorManager.rootMediator.api.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openInternalChat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> } } } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SuppportComponent</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dependencies) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> api: SupportComponentApi = ... <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> { SupportDI.keeper.installComponent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SuppportComponentDependencies</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSmth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">close</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { scopeHolder.destroyCoordinator &lt; -ref count } }</code> </pre> <br><p>  Alexander prometeu publicar em breve um plug-in para a cria√ß√£o de m√≥dulos no Android Studio, que √© usado para se livrar de copiar e colar em sua empresa, bem como um exemplo de projeto de m√∫ltiplos m√≥dulos de console. </p><br><p>  Mais alguns fatos sobre os resultados atuais da separa√ß√£o de m√≥dulos de aplicativos hh: </p><br><ul><li>  ~ 83 m√≥dulos de recursos. </li><li>  Para realizar um teste A / B, os recursos podem ser substitu√≠dos inteiramente pelo m√≥dulo de recursos no n√≠vel do mediador. </li><li>  O gr√°fico do Gradle Scan mostra que, ap√≥s a compila√ß√£o dos m√≥dulos em paralelo, ocorre um processo bastante demorado de dexing do aplicativo (neste caso, dois: para candidatos e empregadores): <br><img src="https://habrastorage.org/webt/4a/wj/xz/4awjxzwf4ohdfdayj7xt591ekf0.png"></li></ul><br><a name="tinkoff"></a><br><p>  Interven√ß√µes de Alexander e Vladimir de Tinkoff: <br>  O esquema de sua arquitetura multi-m√≥dulo √© assim: <br><img src="https://habrastorage.org/webt/4x/p-/t0/4xp-t0r5xgdc2rhssvrzv0zqaco.png"></p><br><p>  Os m√≥dulos s√£o divididos em duas categorias: m√≥dulos de recurso e m√≥dulos de dom√≠nio. <br>  Os m√≥dulos de recursos cont√™m l√≥gica de neg√≥cios e recursos da interface do usu√°rio.  Eles dependem de m√≥dulos de dom√≠nio, mas n√£o podem depender um do outro. </p><br><p>  Os m√≥dulos de dom√≠nio cont√™m c√≥digo para trabalhar com fontes de dados, ou seja, alguns modelos, DAO (para trabalhar com o banco de dados), API (para trabalhar com a rede) e reposit√≥rios (combinam o trabalho da API e DAO).  Os m√≥dulos de dom√≠nio, diferentemente dos m√≥dulos de recursos, podem depender um do outro. </p><br><p>  A conex√£o entre o dom√≠nio e os m√≥dulos de recursos ocorre inteiramente dentro dos m√≥dulos de recursos (ou seja, na terminologia de hh, as depend√™ncias de API e depend√™ncias dos m√≥dulos de dom√≠nio s√£o completamente resolvidas nos m√≥dulos de recursos que os utilizam, sem o uso de entidades adicionais, como mediadores). </p><br><p>  Isto foi seguido por uma s√©rie de perguntas, que colocarei quase inalteradas aqui no formato de perguntas e respostas: </p><br><blockquote>  - Como √© feita a autoriza√ß√£o?  Como voc√™ o arrasta para os m√≥dulos de recursos? <br>  - Os recursos conosco n√£o dependem de autoriza√ß√£o, porque quase todas as a√ß√µes do aplicativo ocorrem na zona autorizada. <br><br>  - Como rastrear e limpar componentes n√£o utilizados? <br>  - Temos uma entidade como InjectorRefCount (implementada atrav√©s do WeakHashMap) que, ao excluir a √∫ltima atividade (ou fragmento) usando esse componente, a exclui. <br><br>  - Como medir uma verifica√ß√£o "limpa" e criar tempo?  Se os caches estiverem ativados, uma verifica√ß√£o bastante suja ser√° obtida. <br>  - Voc√™ pode desativar o Gradle Cache (org.gradle.caching em gradle.properties). <br><br>  - Como executar testes de unidade de todos os m√≥dulos no modo de depura√ß√£o?  Se voc√™ executar apenas o teste de classifica√ß√£o, os testes de todos os tipos e buildType ser√£o puxados. <br>  (Esta pergunta provocou a discuss√£o de muitos participantes da reuni√£o.) <br>  - Voc√™ pode tentar executar o testDebug. <br>  - Os m√≥dulos para os quais n√£o h√° configura√ß√£o de depura√ß√£o n√£o ser√£o apertados.  Come√ßa muito ou pouco. <br>  - Voc√™ pode escrever uma tarefa Gradle, que substituir√° testDebug para esses m√≥dulos, ou far√° uma configura√ß√£o de depura√ß√£o falsa no build.gradle do m√≥dulo. <br>  - Voc√™ pode implementar essa abordagem da seguinte maneira: </blockquote><br><pre> <code class="plaintext hljs">withAndroidPlugin(project) { _, applicationExtension -&gt; applicationExtension.testVariants.all { testVariant -&gt; val testVariantSuffix = testVariant.testedVariant.name.capitalize() } } val task = project.tasks.register &lt; SomeTask &gt; ( "doSomeTask", SomeTask::class.java ) { task.dependsOn("${project.path}:taskName$testVariantSuffix") }</code> </pre> <br><p><img src="https://habrastorage.org/webt/oy/gc/68/oygc68_brbzgxgzfh_wztse_na8.jpeg"></p><br><a name="avito"></a><br><p>  A pr√≥xima apresenta√ß√£o improvisada foi feita por Evgeny Krivobokov e Mikhail Yudin, de Avito. <br>  Eles usaram o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mapa mental</a> para visualizar sua hist√≥ria. </p><br><p>  Agora, o projeto da empresa possui mais de 300 m√≥dulos, com 97% da base de c√≥digo escrita em Kotlin.  O principal objetivo da decomposi√ß√£o em m√≥dulos era acelerar a montagem do projeto.  A divis√£o em m√≥dulos ocorreu gradualmente, com as partes menos dependentes do c√≥digo sendo alocadas aos m√≥dulos.  Para isso, foi desenvolvida uma ferramenta para marcar as depend√™ncias dos c√≥digos-fonte no gr√°fico para an√°lise de impacto ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">relat√≥rio sobre an√°lise de impacto no Avito</a> ). </p><br><p>  Usando esta ferramenta, voc√™ pode marcar um m√≥dulo de recurso como final, para que outros m√≥dulos n√£o possam depender dele.  Essa propriedade ser√° verificada durante a an√°lise de impacto e fornece uma designa√ß√£o de depend√™ncias e acordos expl√≠citos com as equipes respons√°veis ‚Äã‚Äãpelo m√≥dulo.  Com base no gr√°fico constru√≠do, a distribui√ß√£o das altera√ß√µes tamb√©m √© verificada para executar testes de unidade para o c√≥digo afetado. </p><br><p>  A empresa usa um reposit√≥rio mono, mas apenas para fontes Android.  O c√≥digo de outras plataformas vive separadamente. </p><br><p>  Gradle √© usado para construir o projeto (embora os colegas j√° estejam pensando em um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">colecionador</a> como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Buck</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Bazel,</a> mais adequado para projetos com v√°rios m√≥dulos).  Eles j√° experimentaram o Kotlin DSL e retornaram ao Groovy nos scripts Gradle, porque √© inconveniente oferecer suporte a diferentes vers√µes do Kotlin no Gradle e no projeto - a l√≥gica geral √© colocada nos plug-ins. </p><br><p>  O Gradle pode paralelizar tarefas, armazenar em cache e n√£o remontar depend√™ncias bin√°rias se a ABI n√£o tiver sido alterada, o que garante a montagem mais r√°pida de um projeto com v√°rios m√≥dulos.  Para um cache mais eficiente, Mainfraimer e v√°rias solu√ß√µes auto-escritas s√£o usadas: </p><br><ul><li>  Ao alternar de ramifica√ß√£o para ramifica√ß√£o, o Git pode deixar pastas vazias que interrompem o cache ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">problema Gradle n¬∫ 2463</a> ).  Portanto, eles s√£o exclu√≠dos manualmente usando o gancho Git. </li><li>  Se voc√™ n√£o controlar o ambiente nas m√°quinas dos desenvolvedores, vers√µes diferentes do Android SDK e outros par√¢metros poder√£o degradar o cache.  Durante a constru√ß√£o do projeto, o script compara os par√¢metros do ambiente com os esperados: se as vers√µes ou par√¢metros incorretos estiverem instalados, a constru√ß√£o ser√° interrompida. </li><li>  O Analytics est√° ativando / desativando par√¢metros e o ambiente.  Isso √© para monitorar e ajudar os desenvolvedores. </li><li>  Erros de compila√ß√£o tamb√©m s√£o enviados para a an√°lise.  Problemas conhecidos e populares s√£o inseridos em uma p√°gina especial com uma solu√ß√£o. </li></ul><br><p>  Tudo isso ajuda a obter 15% de perda de cache no IC e 60-80% localmente. </p><br><p>  As seguintes dicas do Gradle tamb√©m podem ser √∫teis se um grande n√∫mero de m√≥dulos aparecer no seu projeto: </p><br><ul><li>  Desabilitar os m√≥dulos por meio de sinalizadores IDE √© inconveniente; esses sinalizadores podem ser redefinidos.  Portanto, os m√≥dulos s√£o desativados por meio de settings.gradle. </li><li>  No est√∫dio 3.3.1, h√° uma caixa de sele√ß√£o "Ignorar gera√ß√£o de c√≥digo-fonte na sincroniza√ß√£o Gradle se um projeto tiver mais de 1 m√≥dulos".  Por padr√£o, est√° desativado, √© melhor ativ√°-lo. </li><li>  As depend√™ncias s√£o registradas no buildSrc para reutiliza√ß√£o em todos os m√≥dulos.  Outra op√ß√£o √© o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">DSL de plug</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ins</a> , mas voc√™ n√£o pode colocar o aplicativo do plug-in em um arquivo separado. </li></ul><br><a name="pr4"></a><br><p>  Nossa reuni√£o terminou com Vladimir, de Tinkoff, com o t√≠tulo clickbait do relat√≥rio, <strong>‚ÄúComo reduzir a</strong> montagem <strong>no PR de 40 minutos para quatro‚Äù</strong> .  Na verdade, est√°vamos falando sobre a distribui√ß√£o de partidas de plugues graduados: compila√ß√µes de apk, testes e analisadores est√°ticos. </p><br><p>  Inicialmente, os sujeitos de cada solicita√ß√£o pull executavam uma an√°lise est√°tica, diretamente na montagem e nos testes.  Esse processo levou 40 minutos, dos quais apenas Lint e SonarQube levaram 25 e ca√≠ram apenas 7% dos lan√ßamentos. </p><br><p>  Assim, foi decidido colocar o lan√ßamento em um Job separado, que √© executado em uma programa√ß√£o a cada duas horas e, em caso de erro, envia uma mensagem ao Slack. </p><br><p>  A situa√ß√£o oposta estava usando o Detect.  Falhava quase constantemente, e √© por isso que foi submetido a uma verifica√ß√£o preliminar pr√©via. </p><br><p>  Portanto, apenas os testes de montagem e unidade do apk permaneceram na verifica√ß√£o da solicita√ß√£o de recebimento.  Os testes compilam as fontes antes da execu√ß√£o, mas n√£o coletam recursos.  Como a mesclagem de recursos quase sempre teve √™xito, o pr√≥prio assembly apk tamb√©m foi abandonado. </p><br><p>  Como resultado, apenas o lan√ßamento dos testes de unidade permaneceu na solicita√ß√£o pull, o que nos permitiu atingir os 4 minutos indicados.  A compila√ß√£o apk √© realizada com a solicita√ß√£o de extra√ß√£o por fus√£o no dev. </p><br><a name="end"></a><br><p>  Apesar de a reuni√£o ter durado quase quatro horas, n√£o conseguimos discutir o problema de organizar a navega√ß√£o em um projeto com v√°rios m√≥dulos.  Talvez este seja o t√≥pico para as pr√≥ximas conversas do Kaspersky Mobile.  Al√©m disso, os participantes realmente gostaram do formato.  Diga-nos sobre o que voc√™ gostaria de falar na pesquisa ou nos coment√°rios. </p><br><p>  E, finalmente, links √∫teis do mesmo chat: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Defini√ß√£o de gr√°fico de conectividade monol√≠tica</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Regras para escrever c√≥digo em hh e utilit√°rios para ajud√°-los a suportar</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mirakle - plugin para transferir build para mainframe</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Resultados da Pesquisa de Modulariza√ß√£o de Aplicativos Android</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt446626/">https://habr.com/ru/post/pt446626/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt446614/index.html">Sistemas de arquivos virtuais Linux: por que eles s√£o necess√°rios e como eles funcionam? Parte 1</a></li>
<li><a href="../pt446616/index.html">Como fizemos o FaaS na nuvem dentro do Kubernetes e vencemos no Hackathon Tinkoff</a></li>
<li><a href="../pt446620/index.html">DataGrip 2019.1: suporte para novos bancos de dados, scripts de inicializa√ß√£o, novas inspe√ß√µes e muito mais</a></li>
<li><a href="../pt446622/index.html">Not√≠cias aos 11</a></li>
<li><a href="../pt446624/index.html">√çndices no PostgreSQL - 6 (SP-GiST)</a></li>
<li><a href="../pt446628/index.html">D√™ mais HighLoad ++: de segunda-feira em S√£o Petersburgo</a></li>
<li><a href="../pt446630/index.html">Como escolher uma impressora 3D ou por que voc√™ precisa de uma mesa de aquecimento e uma c√¢mera fechada</a></li>
<li><a href="../pt446632/index.html">Da lei ao desenvolvimento de big data</a></li>
<li><a href="../pt446634/index.html">SDN Digest - Seis emuladores de c√≥digo aberto</a></li>
<li><a href="../pt446638/index.html">Cisco HyperFlex vs. concorrentes: testando o desempenho</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>