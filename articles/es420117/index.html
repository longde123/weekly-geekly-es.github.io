<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßîüèª üì§ üññüèø Gu√≠a simple de colas en Mikrotik üë®üèª‚Äçüåæ üçã üóíÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hay muchos art√≠culos en Internet dedicados a la limitaci√≥n de velocidad y al tr√°fico compartido en los equipos MikroTik, pero casi todos consideran so...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gu√≠a simple de colas en Mikrotik</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420117/"><p>  Hay muchos art√≠culos en Internet dedicados a la limitaci√≥n de velocidad y al tr√°fico compartido en los equipos MikroTik, pero casi todos consideran solo el √Årbol de colas, que requiere una comprensi√≥n profunda y es redundante en muchas tareas y puede reemplazarse por Colas simples. </p><a name="habracut"></a><br><p>  Colas simplificadas: un mecanismo para dividir la capacidad del canal y priorizar el tr√°fico vinculado a un objetivo espec√≠fico.  El tr√°fico entrante y saliente se calcula en relaci√≥n con el objetivo. </p><br><p>  Hay tres opciones para los objetivos: ip, subred, interfaz.  Puede agregar m√∫ltiples objetivos para una regla. </p><br><h3 id="teoreticheskaya-chast">  Parte te√≥rica </h3><br><h4 id="sheypery-planirovschiki-i-ocheredi">  Moldeadores, planificadores y colas </h4><br><p>  La velocidad de datos se mide en relaci√≥n con la informaci√≥n transmitida en bits por segundo de tiempo, bit / seg.  La unidad de bits es peque√±a, por lo que utilizan los prefijos kilo (kbit / sec), mega (Mbit / sec), gig (Gbit / sec). </p><br><p>  La velocidad de transmisi√≥n de paquetes a trav√©s de redes de comunicaci√≥n siempre es igual a la velocidad de transmisi√≥n del medio (por ejemplo, 100Mbit / seg para Ethernet 100BASE-TX).  Si es necesario reducir esta velocidad, un dispositivo intermedio, como un enrutador, que recibe paquetes de una interfaz a la velocidad m√°xima, los env√≠a desde otro con cierto retraso, si los paquetes exceden el l√≠mite de velocidad establecido, se almacenan en una cola y se env√≠an de acuerdo con el Primero en entrar, Primero en salir ( FIFO), si la cola est√° llena (falta o tama√±o cero), el enrutador descarta los paquetes. </p><br><p>  <strong>L√≠mite</strong> : l√≠mite de velocidad administrativa para el tr√°fico proveniente de la interfaz. <br>  <strong>Shaper (Shaper)</strong> : un algoritmo de software que retrasa y descarta el exceso de paquetes. <br>  <strong>Scheduler (Sheduler)</strong> : un algoritmo que decide c√≥mo almacenar y enviar paquetes que van m√°s all√° del l√≠mite. <br>  <strong>Colas</strong> : algoritmos de almacenamiento y priorizaci√≥n para pasar el tr√°fico. </p><br><p>  Ejemplos gr√°ficos del trabajo de un modelador y planificador. </p><br><p>  Usar un moldeador fuera de l√≠nea </p><br><p><img src="https://habrastorage.org/webt/rk/60/8_/rk608_lhdbfv_zstsgrk0t_6rpq.png"></p><br><p>  Usar un moldeador con un programador </p><br><p><img src="https://habrastorage.org/webt/ln/ry/im/lnryimsagc89acaf3pgjy9qollk.png"></p><br><h4 id="simple-queues-na-packet-flow">  Colas simples en flujo de paquetes </h4><br><p>  Las colas simples vienen despu√©s del √°rbol de colas, a veces se usan colas simples para limitar r√°pidamente el tr√°fico a uno (o varios) usuarios, sin interferir con el √°rbol de colas. </p><br><div class="spoiler">  <b class="spoiler_title">Flujo de paquetes simplificado para aquellos interesados</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/9k/yk/vr/9kykvrkaxqkpncv_hjsqc3i9ssg.png"></p></div></div><br><h4 id="mehanika-raboty-ocheredey-none-pfifo-pcq">  Mec√°nica de colas: ninguna, pfifo, pcq </h4><br><p>  <strong>none</strong> : sin cola; si se supera el l√≠mite, se descartan todos los paquetes nuevos. </p><br><p>  <strong>pfifo</strong> es un algoritmo fifo orientado a paquetes.  Almacena el n√∫mero de paquetes especificados en la configuraci√≥n.  Usado por defecto en Colas simples. </p><br><p><img src="https://habrastorage.org/webt/o-/af/gv/o-afgv9hsemh5ekrhrloakgatnm.png"></p><br><p>  <strong>pcq (por conexi√≥n en cola)</strong> : todo el tr√°fico se divide en subcolas seg√∫n un conjunto de condiciones.  Desde cada sub cola, se env√≠a una parte del tr√°fico alternativamente.  El espacio desocupado est√° ocupado por el tr√°fico reci√©n llegado.  Si el lugar en la subcola se agota, los paquetes destinados a este se descartan. </p><br><p><img src="https://habrastorage.org/webt/0j/ya/2i/0jya2iixjm_adtvot6x5cuoa00u.png"></p><br><p>  Considere una peque√±a parte de la configuraci√≥n: <br>  <strong>Velocidad</strong> : l√≠mite de velocidad para cada una de las subcolas. <br>  <strong>L√≠mite</strong> : tama√±o de la cola secundaria en kilobytes. <br>  <strong>L√≠mite total</strong> : el tama√±o total de todas las subcolas en kilobytes. <br>  <em>La relaci√≥n L√≠mite / L√≠mite total se selecciona en funci√≥n de la situaci√≥n.</em>  <em>Por defecto, 40 colas (2000/50), sujetas a su m√°ximo llenado de tr√°fico.</em> <br>  <strong>R√°faga</strong> : sobre √©l ser√° menor. <br>  <strong>Clasificador</strong> : basado en qu√© dividir el tr√°fico en colas. <br>  El clasificador toma turnos de diferentes conexiones, si vas a [IP] -&gt; [Firewall] -&gt; [Conexiones], entonces se puede notar que la mayor√≠a de las conexiones contienen la direcci√≥n y el puerto del remitente (src. Address, src. Port) y el receptor ( dst. direcci√≥n, dst. puerto). </p><br><p>  Discutimos las colas simples, por lo que, por simplicidad, consideraremos que filtramos solo el tr√°fico que proviene de la interfaz wan, en este caso, en relaci√≥n con el destino, el tr√°fico saliente (carga) se clasificar√° por src.  direcci√≥n y la entrada (descarga) por dst.  direcci√≥n </p><br><p>  La clasificaci√≥n por puerto ayudar√° a evitar la situaci√≥n de obstruir la cola con el tr√°fico de una aplicaci√≥n, si una aplicaci√≥n produce muchas conexiones salientes (por ejemplo, torrent o web. Navegador con un mont√≥n de pesta√±as), entonces su src ser√° diferente.  el puerto y el tr√°fico tambi√©n se dividir√°n en colas. </p><br><h4 id="dinamicheskiy-sheyping-sredstvami-pcq">  Modelado din√°mico usando PCQ </h4><br><p>  Si la velocidad se establece estrictamente, cada subflujo tendr√° una velocidad determinada y no podr√° excederla hasta que la velocidad total de todos los subflujos exceda el l√≠mite superior (en colas simples es el l√≠mite total), en este caso la velocidad de todos los subflujos disminuir√° proporcionalmente </p><br><p><img src="https://habrastorage.org/webt/k8/z4/rb/k8z4rbxttud1n5yzgb0iapcpvom.png"></p><br><p>  Si la velocidad se establece en 0, la restricci√≥n m√°s alta se compartir√° entre todas las transmisiones secundarias.  De hecho, esto es conformaci√≥n din√°mica. </p><br><p><img src="https://habrastorage.org/webt/g-/ig/rm/g-igrm9quokfmrvbmot1fh5_g5e.png"></p><br><p>  Si la velocidad se establece en 0 y no se especifica el l√≠mite total para colas simples, entonces la velocidad entre los subprocesos se dividir√° en funci√≥n de un l√≠mite superior, si las colas no est√°n anidadas, esto es una limitaci√≥n de la interfaz f√≠sica.  Si su plan de tarifas es m√°s bajo, parte del tr√°fico se eliminar√° en el equipo del proveedor y las colas no beneficiar√°n. </p><br><p><img src="https://habrastorage.org/webt/0k/um/i7/0kumi7g7yykezh0v0jlkcp3dd8u.png"></p><br><p>  <em>Los tipos de colas restantes (SFQ, RED) tienen sus propias peculiaridades y aplicaciones y tambi√©n se pueden usar para Colas simples, pero ahora no nos interesan.</em> </p><br><h4 id="markirovka-paketov">  Etiquetado de paquetes </h4><br><p>  S√≠, en colas simples puede usar tr√°fico etiquetado.  Este no es un requisito previo (a diferencia del √Årbol de colas), pero le permite alejarse de las limitaciones del objetivo. </p><br><p> El etiquetado de tr√°fico se produce en [IP] -&gt; [Cortafuegos] -&gt; [Destrozar], en total hay tres tipos de etiquetas: Conexi√≥n, Paquete, Ruta.  Cada paquete puede contener una etiqueta de cada tipo.  Una vez en la barra, el paquete pasa uno por uno de acuerdo con todas las reglas, si hay dos etiquetas de conjunto fundidas, la regla inferior sobrescribir√° la etiqueta de la superior.  Para evitar sobrescribir, puede deshabilitar el paso de un paquete por la cadena en la primera regla ( <code>passtrought=no</code> ). </p><br><p>  Al configurar colas, solo puede usar etiquetas de paquete ( <code>action=mark-packet</code> ).  Pero para mejorar el rendimiento (las etiquetas de conexi√≥n se comprueban m√°s r√°pido que examinar las condiciones en cada paquete), se recomienda marcar las conexiones ( <code>action=mark-connection</code> ) primero, y luego los paquetes en esta conexi√≥n ( <code>action=mark-package</code> ).  <em>La regla con las conexiones de premarcado no siempre es cierta, pero si ha llegado a este entendimiento al crear colas, entonces debe usar el √Årbol de colas.</em> </p><br><p>  Puede marcar el tr√°fico de tr√°nsito en cualquiera de las cadenas de Packet Flow, pero en la mayor√≠a de los casos prefiero usar hacia adelante, porque  En esta etapa, se conocen las direcciones del destinatario con el remitente y los nombres de las interfaces entrantes y salientes. </p><br><div class="spoiler">  <b class="spoiler_title">Ejemplo de etiquetado de tr√°fico</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/4p/fk/kk/4pfkkkzdf7nrl0eew8x7ckapnas.png"></p><br><pre> <code class="plaintext hljs">/ip firewall mangle add action=mark-connection chain=forward connection-state=new dst-port=5060,10000-20000 new-connection-mark=output-sip-and-rtp passthrough=yes protocol=udp src-address=192.168.100.0/24 add action=mark-packet chain=forward connection-mark=output-sip-and-rtp new-packet-mark=output-packet-sip-and-rtp passthrough=no</code> </pre> </div></div><br><h4 id="chto-takoe-burst">  ¬øQu√© es la explosi√≥n? </h4><br><p>  Por lo general, el l√≠mite de velocidad se entiende como un cierto valor est√°tico del l√≠mite por segundo al alcanzar qu√© paquetes se descartan o se ponen en cola.  La r√°faga funciona con un valor promedio por unidad de tiempo, esto permite utilizar velocidades m√°s altas (pico) en cortos per√≠odos de tiempo y limita la velocidad con una carga constante en el canal. </p><br><p>  <strong>El l√≠mite m√°ximo</strong> es la principal limitaci√≥n. <br>  <strong>L√≠mite de r√°faga</strong> : velocidad m√°xima, tiene prioridad sobre el l√≠mite m√°ximo cuando se observa la velocidad promedio especificada. <br>  <strong>Umbral de r√°faga</strong> : velocidad del l√≠mite. <br>  <strong>Tiempo de explosi√≥n</strong> - tiempo. </p><br><p>  El objetivo obtiene la velocidad del l√≠mite de r√°faga, pero cada segundo se calcular√° la velocidad promedio para el tiempo de r√°faga.  Si la velocidad promedio durante un tiempo dado excede el Umbral de r√°faga, entonces el usuario estar√° limitado al L√≠mite m√°ximo, si la velocidad promedio vuelve a la normalidad, entonces el objetivo recibir√° nuevamente el L√≠mite de r√°faga. </p><br><div class="spoiler">  <b class="spoiler_title">Estudio de caso de explosi√≥n</b> <div class="spoiler_text"><p>  Regla de r√°faga: </p><br><p><img src="https://habrastorage.org/webt/x8/e6/kr/x8e6krcahevnrpazzw3eo1rlrv8.png"></p><br><p>  Diagrama de flujo que muestra el cambio de velocidad objetivo: </p><br><p><img src="https://habrastorage.org/webt/ss/u8/_i/ssu8_i_b8z-kbg9etldtnkzu9ga.png"></p><br><p>  Y c√≥mo se ve el cambio de velocidad objetivo: </p><br><p><img src="https://habrastorage.org/webt/av/kz/jb/avkzjbsh7wfduzsflatk8fqutqc.png"></p></div></div><br><p>  <em>Si est√° interesado en el tema R√°faga, le recomiendo leer la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">informaci√≥n en la wiki</a> , hay gr√°ficos y tablas en funci√≥n de los cuales ser√° mejor comprender c√≥mo los valores de Umbral y Tiempo afectan el l√≠mite de velocidad.</em> </p><br><h4 id="razlichie-limit-at-i-max-limit">  L√≠mite de diferencia en y l√≠mite m√°ximo </h4><br><p><img src="https://habrastorage.org/webt/ii/n7/jh/iin7jhchctr21e2n5i1jenft-my.png"></p><br><p>  <strong>L√≠mite a</strong> : velocidad garantizada para la regla.  Es deseable que la suma de todos los l√≠mites en no exceda el ancho de banda del canal.  Siempre menos que el m√°ximo. <br>  <strong>L√≠mite</strong> m√°ximo: velocidad m√°xima para la regla.  Si el "presupuesto" de la cola lo permite, se asignar√° el ancho de banda m√°ximo. </p><br><p>  Por lo general, solo se indica el l√≠mite m√°ximo en las colas simplificadas y esto funciona bien, pero en una configuraci√≥n de cola en cascada, se deben especificar ambos l√≠mites. </p><br><h3 id="prakticheskaya-chast">  Parte pr√°ctica </h3><br><p>  Las colas simples se configuran en [Colas] -&gt; [Colas simples]. <br>  Las reglas se procesan alternativamente de arriba a abajo, la primera regla adecuada se aplica al paquete que pasa.  De hecho, se puede hacer una excepci√≥n de cualquier regla colocando una regla m√°s espec√≠fica arriba. </p><br><h4 id="ogranichenie-skorosti-dlya-konkretnogo-hostapodsetiinterfeysa">  L√≠mite de velocidad de host / subred / interfaz </h4><br><p>  Por lo general, se usa cuando es necesario matar la velocidad de un usuario espec√≠fico. <br>  Nombre: cualquier nombre <br>  Destino: direcci√≥n, subred o interfaz. <br>  Carga de destino: l√≠mite de velocidad de salida. <br>  Descarga de Targer: l√≠mite de velocidad entrante. </p><br><p>  L√≠mite de velocidad a 1Mbit / seg: </p><br><p><img src="https://habrastorage.org/webt/rj/0l/dy/rj0ldymsyrl-ulstludlvz6uhty.png"></p><br><pre> <code class="plaintext hljs">/queue simple add max-limit=1M/1M name=Limit-For-100.200 queue=default/default target=192.168.100.200/32</code> </pre> <br><p>  En Estad√≠sticas, puede ver la velocidad actual del objetivo, la cantidad de paquetes en la cola y la cantidad de paquetes descartados. </p><br><h4 id="ogranichenie-skorosti-dlya-udalennogo-resursa">  L√≠mite de velocidad para un recurso remoto </h4><br><p>  Opci√≥n sin etiquetar paquetes. </p><br><p>  En el campo dst, se puede especificar de manera similar al objetivo: ip, subred, interfaz.  En las condiciones de Internet moderno, esto no es suficiente, pero puede ser √∫til para peque√±as empresas y l√≠mites de velocidad entre oficinas. </p><br><p><img src="https://habrastorage.org/webt/jo/fi/te/jofiteubgejsubajjte9e26smj0.png"></p><br><pre> <code class="plaintext hljs">/queue simple add dst=192.168.200.10/32 max-limit=10M/10M name=Limit-For-Fileserver target=192.168.100.0/24</code> </pre> <br><h4 id="ravnocennoe-delenie-kanala-mezhdu-uchastnikami-podseti-pcq">  Divisi√≥n equitativa de canales entre participantes de subred (pcq) </h4><br><p>  Una regla que salvar√° la subred de su hogar u oficina de la captura exclusiva de canales (en el ejemplo 50 Mb / s, ajuste a su canal) por un usuario. </p><br><p><img src="https://habrastorage.org/webt/w_/nl/mg/w_nlmgmsen5nlddzajhh1jm3v0y.png"></p><br><p>  Las colas de pcq especificadas est√°n presentes en la configuraci√≥n b√°sica, pero adjunto capturas de pantalla en caso de cambios. </p><br><p><img src="https://habrastorage.org/webt/ki/xk/-s/kixk-svzxxq8i3c7ekpzj_tynyc.png"></p><br><pre> <code class="plaintext hljs"># /queue type add kind=pcq name=pcq-upload-default pcq-burst-rate=0 pcq-burst-threshold=0 pcq-burst-time=10s pcq-classifier=src-address pcq-dst-address-mask=32 pcq-dst-address6-mask=128 pcq-limit=50KiB pcq-rate=0 pcq-src-address-mask=32 pcq-src-address6-mask=128 pcq-total-limit=2000KiB add kind=pcq name=pcq-download-default pcq-burst-rate=0 pcq-burst-threshold=0 pcq-burst-time=10s pcq-classifier=dst-address pcq-dst-address-mask=32 pcq-dst-address6-mask=128 pcq-limit=50KiB pcq-rate=0 pcq-src-address-mask=32 pcq-src-address6-mask=128 pcq-total-limit=2000KiB # Simple queues /queue simple add max-limit=50M/50M name=Limit-Equivalent queue=pcq-upload-default/pcq-download-default target=192.168.100.0/24</code> </pre> <br><p>  En la pesta√±a Estad√≠sticas, puede ver cu√°ntos hilos pcq hay actualmente en la cola. </p><br><p><img src="https://habrastorage.org/webt/yz/8s/vf/yz8svfgkm1oz-veqdsihxt0t_lq.png"></p><br><h4 id="markirovannyy-trafik">  Tr√°fico etiquetado </h4><br><p>  La opci√≥n dst es bastante limitada y si desea utilizar nombres de dominio o listas de direcciones, deber√° recurrir al marcado de tr√°fico.  Por ejemplo, eliminaremos las restricciones para el dominio yandex.ru (s√≠, hay un mont√≥n de cdn'ok conectado all√≠ y otras cosas, y para el funcionamiento normal, deber√° agregarlos). </p><br><p>  En una versi√≥n reciente, fue posible agregar nombres de dominio a las listas de direcciones, mikrotik los resolver√° autom√°ticamente y agregar√° entradas din√°micas. </p><br><p><img src="https://habrastorage.org/webt/sq/3h/zt/sq3hztxzt1qzmwfjeejb4seuzog.png"></p><br><p>  Marcado del tr√°fico http / https (conexi√≥n y paquetes en la conexi√≥n) para las direcciones especificadas: </p><br><p><img src="https://habrastorage.org/webt/xv/9e/8i/xv9e8ijrdum_l0owpnkri2mehs8.png"></p><br><p><img src="https://habrastorage.org/webt/nj/hh/xx/njhhxx9sgajhbqk2qixgosht3oi.png"></p><br><p><img src="https://habrastorage.org/webt/z_/hn/xi/z_hnxipzr3mhe3khsehfnb7l_gc.png"></p><br><p>  Regla en cola simple: </p><br><p><img src="https://habrastorage.org/webt/pk/2p/jx/pk2pjxppbsgbxgcpblnvppzuv7k.png"></p><br><pre> <code class="plaintext hljs">#   /ip firewall address-list add address=yandex.ru list=ForQueues add address=yastatic.net list=ForQueues #    /ip firewall mangle add action=mark-connection chain=forward connection-state=new dst-address-list=ForQueues dst-port=80,443 new-connection-mark=Mark-ForQueues passthrough=yes protocol=tcp src-address=192.168.100.0/24 add action=mark-packet chain=forward connection-mark=Mark-ForQueues new-packet-mark=Mark-Packet-ForQueues passthrough=no #  Simple Queue /queue simple add max-limit=1M/1M name=Limit-For-Yandex packet-marks=Mark-Packet-ForQueues target=192.168.100.0/24</code> </pre> <br><h4 id="kaskadnye-ocheredi">  Colas en cascada </h4><br><p>  Todo lo que se dijo anteriormente se refiere a limitar y dividir la velocidad entre los participantes de la red, es hora de tocar el tema de la priorizaci√≥n del tr√°fico.  Por lo general, se requiere para el tr√°fico interactivo (voip, vcs, ssh, rdp, ...) en un canal limitado y ocupado. </p><br><p>  Para las colas en cascada, el par√°metro padre es responsable, que se refiere a la cola "padre".  Para trabajar, todo el tr√°fico de las colas "secundarias" debe ser capturado por el padre. </p><br><p>  El par√°metro Priority es responsable de qu√© tr√°fico se agregar√° a la cola anteriormente, solo funciona en colas secundarias (o en "parent" si no tienen "child"), puede tomar valores de 1 (prioridad m√°s alta) a 8 y no tiene nada com√∫n con las etiquetas QoS (DSCP; TOS). </p><br><p>  Premarcado de tr√°fico: </p><br><p><img src="https://habrastorage.org/webt/3q/aj/wj/3qajwjqsgfsk2rjyttjox_puw_q.png"></p><br><pre> <code class="plaintext hljs">/ip firewall mangle add action=mark-connection chain=forward connection-state=related,new dst-port=5060,10000-20000 in-interface=br-lan new-connection-mark=mark-conn-voip passthrough=yes protocol=udp add action=mark-packet chain=forward connection-mark=mark-conn-voip new-packet-mark=mark-pkg-voip passthrough=no add action=mark-connection chain=forward connection-state=new dst-port=80,443 in-interface=br-lan new-connection-mark=mark-conn-web passthrough=yes protocol=tcp</code> </pre> <br><p>  Colas en SimpleQueue: </p><br><p><img src="https://habrastorage.org/webt/__/np/f0/__npf0bat-c1n1qzxtthgufnwnw.png"></p><br><p><img src="https://habrastorage.org/webt/z6/1h/kt/z61hktl_myep7moyk_l4tl4umji.png"></p><br><p><img src="https://habrastorage.org/webt/pu/uu/os/puuuosqryi6zu8_userqrvlse50.png"></p><br><p><img src="https://habrastorage.org/webt/ot/rc/dv/otrcdvd-qjwvsk7gettmlv-1qma.png"></p><br><p><img src="https://habrastorage.org/webt/0t/gg/ga/0tgggaclbuc1ar18coyvqkffplg.png"></p><br><pre> <code class="plaintext hljs">/queue simple add limit-at=24M/24M max-limit=25M/25M name=main target=10.10.10.0/24 add limit-at=5M/5M max-limit=8M/8M name=voip packet-marks=mark-pkg-voip parent=main priority=1/1 queue=pcq-upload-default/pcq-download-default target="" add limit-at=10M/10M max-limit=20M/20M name=web packet-marks=mark-pkg-web parent=main priority=2/2 queue=pcq-upload-default/pcq-download-default target="" add limit-at=10M/10M max-limit=20M/20M name=other packet-marks=mark-pkg-other parent=main priority=3/3 queue=pcq-upload-default/pcq-download-default target=""</code> </pre> <br><p>  Ahora, si necesita hacer una restricci√≥n para una IP, simplemente coloque la regla frente a la cascada de colas. </p><br><h3 id="posleslovie">  Ep√≠logo </h3><br><p>  Simple Queues es una herramienta bastante interesante y funcional para configuraciones dom√©sticas y SOHO, con una regla (sin recurrir al etiquetado de tr√°fico) puede resolver el problema de la captura de canales por un dispositivo.  Pero, si usa FastTrack, entonces olv√≠dese de las colas: el tr√°fico pasar√° de ellas. </p><br><p>  Para configuraciones m√°s complejas, hay un √°rbol de Colas (√°rboles HTB). </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es420117/">https://habr.com/ru/post/es420117/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es420107/index.html">Typegram - Plataforma Zen Blog</a></li>
<li><a href="../es420109/index.html">Elon Musk dijo que la compa√±√≠a podr√≠a venderse a inversores privados. Result√≥ ser un fondo saudita</a></li>
<li><a href="../es420111/index.html">De cero a h√©roe "Acciones en Google": su c√≥digo</a></li>
<li><a href="../es420113/index.html">La leyenda del marco del poder</a></li>
<li><a href="../es420115/index.html">UE4 | Equipo para Multijugador # 4 | Crear y conectar un contenedor</a></li>
<li><a href="../es420119/index.html">10 marcos web de Python con los que vale la pena trabajar en 2018</a></li>
<li><a href="../es420121/index.html">Prueba de resistencia: Termite LT450, LXI</a></li>
<li><a href="../es420123/index.html">¬øQu√© es realmente Node.js?</a></li>
<li><a href="../es420125/index.html">Automatizaci√≥n en finanzas: los empleados del banco pueden quedar sin trabajo debido a los robots</a></li>
<li><a href="../es420129/index.html">Patrones de rutina de Asyncio: afuera aguardan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>