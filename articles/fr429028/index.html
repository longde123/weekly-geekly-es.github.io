<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üóª üôÖüèΩ üë©üèº‚Äç‚öïÔ∏è Korolev. M√©decine pour le web üë≤üèø ü§¶ üõ†Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il y a environ un an, l' article manifeste de Nikita Prokopov sur la d√©ception des logiciels a √©t√© publi√©. √Ä en juger par les commentaires positifs, l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Korolev. M√©decine pour le web</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429028/"><p>  Il y a environ un an, l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article manifeste de</a> Nikita Prokopov sur la d√©ception des logiciels a √©t√© publi√©.  √Ä en juger par les commentaires positifs, les d√©veloppeurs ne sont pas indiff√©rents √† la qualit√© de leurs produits.  Peut-√™tre qu'il est temps de commencer √† jouer? </p><br><p>  Dans cet article, je veux parler de mon d√©veloppement, qui, √† mon avis, peut r√©soudre les principaux probl√®mes de performances du Web moderne et rendre l'utilisateur un peu plus heureux.  Les probl√®mes sont: un code JS lourd, un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©lai de d√©marrage de la page (TTI)</a> √©lev√©, une consommation de m√©moire et de processeur √©lev√©e. </p><a name="habracut"></a><br><p>  Avant de continuer √† lire, suivez le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien</a> .  Essayez de jouer √† quelques jeux.  Jouez de pr√©f√©rence depuis le bureau. </p><br><h2 id="nemnogo-istorii">  Un peu d'histoire </h2><br><p> D√®s le d√©but, le navigateur Web a √©t√© con√ßu comme un client l√©ger pour les serveurs Web.  Le navigateur affiche les pages hypertextes qu'il a re√ßues du serveur.  Simple et √©l√©gant.  Comme cela arrive souvent, une belle id√©e est confront√©e √† la r√©alit√©, et apr√®s quelques ann√©es, les fabricants de navigateurs ont ajout√© la prise en charge du langage de script.  Au d√©but, il ne servait que de d√©coration, et jusqu'au milieu des ann√©es 2000, il √©tait consid√©r√© comme une bonne forme pour faire fonctionner les pages Web sans le support de JS. </p><br><p>  Une approche moderne du d√©veloppement de sites Web est le r√©sultat du d√©veloppement des exigences d'interactivit√© de l'interface utilisateur.  Les t√¢ches visant √† am√©liorer l'interactivit√© incombaient aux codeurs.  Ceux-ci n'avaient souvent pas les comp√©tences et l'autorit√© n√©cessaires pour d√©velopper une solution ¬´de bout en bout¬ª.  Les concepteurs de mise en page ont appris √† √©crire JS et sont devenus front-end.  La logique a progressivement commenc√© √† circuler du serveur vers le client.  Il est pratique pour le front-runner d'√©crire pour le navigateur, et le back-end est pratique de ne pas penser √† l'utilisateur (donnez-moi mon JSON, puis au moins l'herbe ne pousse pas).  Il y a tout juste deux ans, l'int√©r√™t pour l'architecture sans serveur a fortement augment√©, et il a √©t√© sugg√©r√© que les applications JS fonctionneraient directement avec la base de donn√©es et les bus d'√©v√©nements. </p><br><p>  √Ä l'heure actuelle, le "site Web sph√©rique dans le vide" est une application JS complexe et un simple serveur API avec lequel il communique.  La logique principale s'ex√©cute sur un client lourd, le c√¥t√© serveur d√©g√©n√®re en une simple couche de la base de donn√©es. </p><br><p> La n√©cessit√© de garder la logique sur le client cr√©e des probl√®mes.  Si le service ¬´d√©colle¬ª et commence √† gagner de l'argent, alors, en termes de productivit√©, il ne fera qu'empirer.  Les exigences vont changer.  L'√©quipe de d√©veloppement va changer.  Il y aura de plus en plus de nouveau code et l'ancien code ne sera pas nettoy√©.  La page va gonfler des d√©pendances, elle chargera du JSON sur le but dont personne ne se souvient, mais √ßa fait peur √† supprimer, tout √† coup quelque chose se casse.  Des t√¢ches d'arri√®re-plan SetInterval appara√Ætront, chacune √©tant ex√©cut√©e pendant plusieurs millisecondes par seconde, ce qui, apr√®s un certain temps, entra√Ænera des freins et r√©chauffera l' <em>iPad</em> de l'infortun√© au point qu'il pourra y faire frire des ≈ìufs frits.  Cela se termine par le fait que le front-end <em>br√ªl√©</em> viendra au gestionnaire avec une proposition de tout r√©√©crire √† partir de z√©ro sur un nouveau cadre.  Le gestionnaire refusera et le frontal commencera √† utiliser deux cadres ensemble. </p><br><h2 id="kak-rabotaet-korolev">  Comment fonctionne Korolev </h2><br><p>  Et si nous revenons au point du rapport?  Le moment o√π quelqu'un a eu l'id√©e de mettre √† jour le contenu sans recharger la page, et l'in√©vitabilit√© historique a donn√© naissance √† AJAX?  Que faire si vous laissez tout sur le serveur et faites un client l√©ger?  Les meilleurs sites font le pr√©-rendu des pages du serveur (SSR) afin que l'utilisateur voit l'interface avant le chargement et le d√©marrage de JS.  Vous pouvez aller plus loin et ne laisser au client que le code responsable du traitement des E / S, compte tenu des exigences actuelles d'interactivit√©.  Des r√©flexions √† ce sujet ont d√©bord√© sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le projet Korolev</a> . </p><br><p>  Comment √ßa marche c√¥t√© client?  L'utilisateur vient sur la page.  Le serveur fournit le code HTML g√©n√©r√© et un petit script (~ 6 Ko sans compression) qui se connecte au serveur via une socket web.  Lorsqu'un utilisateur d√©clenche un √©v√©nement (par exemple, un clic), le script l'envoie au serveur.  Apr√®s traitement de l'√©v√©nement, le serveur g√©n√®re une liste de commandes de la forme "ajoutez un nouveau <code>&lt;div&gt;</code> l√†", "ajoutez une classe √† tel √©l√©ment", "supprimez tel ou tel √©l√©ment".  Le client applique la liste de commandes au DOM.  En tant que tel, le travail avec HTML ne se produit pas - le script fonctionne directement avec le DOM, alors ne vous inqui√©tez pas que le contenu du formulaire ou la position du d√©filement sera r√©initialis√©. </p><br><p>  Que se passe-t-il sur le serveur?  Lorsqu'une demande de page provient du navigateur, Korolev cr√©e une nouvelle session.  Pour la session, l'√©tat initial est cr√©√©, qui est stock√© dans le cache.  Le HTML est g√©n√©r√© √† partir de cet √©tat, qui est donn√© au client en r√©ponse √† la demande.  De plus, le serveur enregistre le "DOM virtuel" dans la session.  Apr√®s avoir demand√© la page, le serveur accepte la demande d'ouverture du socket Web.  Korolev associe une socket web ouverte √† une session.  Chaque √©v√©nement provenant du client peut changer l'√©tat associ√© √† la session.  Chaque changement d'√©tat conduit √† un appel √† la fonction de <code>render</code> , qui forme un nouveau "DOM virtuel", qui est compar√© √† l'ancienne version.  La comparaison aboutit √† une liste de commandes √† envoyer au client. </p><br><p>  Que se passe-t-il dans le code et la t√™te du d√©veloppeur?  Ce qui pr√©c√®de pourrait vous rappeler React, √† la diff√©rence pr√®s que tout fonctionne sur le serveur.  En termes d'approche de d√©veloppement, nous avons √©galement quelque chose de similaire.  Par cons√©quent, si vous avez travaill√© avec React ou un autre "DOM virtuel", l'approche de Queen vous sera famili√®re.  Si vous n'√™tes pas familier avec React, alors imaginez que vous avez des donn√©es que vous ins√©rez dans le mod√®le.  Imaginez que selon le mod√®le, les gestionnaires d'√©v√©nements sont dispers√©s et peuvent modifier les donn√©es (mais pas le DOM).  Vous changez les donn√©es, la page se change.  Korolev lui-m√™me trouve comment changer le DOM. </p><br><h2 id="proizvoditelnost">  Performances </h2><br><p>  Il y a deux questions fr√©quentes √† propos de Korolev: ¬´et si les retards sont importants¬ª et ¬´cela ne chargera-t-il pas mon serveur¬ª.  Les deux questions sont tr√®s raisonnables.  Le programmeur frontal a l'habitude de faire ex√©cuter son programme sur la machine locale de l'utilisateur.  Cela signifie que les modifications apport√©es seront appliqu√©es d√®s que la machine JS aura termin√© d'ex√©cuter le code et que le navigateur commencera le rendu.  J'ai montr√© sp√©cifiquement un exemple d'utilisation "√† vitesse maximale" au tout d√©but.  Vous ne pouviez observer le retard que si vous veniez de l'autre c√¥t√© du globe (les serveurs sont situ√©s √† Moscou) ou si vous vous √™tes assis sur Internet via GPRS.  Eh bien, ou mon serveur virtuel path√©tique avec un c≈ìur et 1 Go de RAM ne pouvait pas supporter l'effet habr. </p><br><p>  La question de la charge du serveur est g√©n√©ralement pos√©e par les beckenders.  Le moteur de sortie de changement fonctionne tr√®s rapidement: ~ 10 mille conclusions par seconde pour deux arbres arbitraires de 500 n≈ìuds sur le macbook junior de 2013.  Le rendu statique donne √©galement un assez bon r√©sultat: jusqu'√† 1 million de pages par seconde.  Chaque "DOM virtuel" est stock√© et trait√© sous une forme s√©rialis√©e sp√©ciale et prend 128 Ko pour une page Web moyenne.  Le processus de sortie est sp√©cialement optimis√© et n'a pas de surcharge pour la m√©moire et le GC. </p><br><p>  Quant √† la vitesse de d√©veloppement, Korolev offre ici de grands avantages.  Pas besoin d'√©crire une couche suppl√©mentaire entre la base de donn√©es et le serveur.  Pas besoin de n√©gocier un protocole entre le client et le serveur.  Pas besoin de vous soucier de la modularit√© du front-end - le poids JS sur le client restera toujours le m√™me.  Pas besoin de faire de logique suppl√©mentaire pour les √©v√©nements du serveur: acceptez simplement le message de la file d'attente et changez l'√©tat de la session, Korolev restituera et livrera. </p><br><h2 id="cena">  Prix </h2><br><p>  Vous devez payer pour les avantages.  Il faudra abandonner certaines habitudes et en acqu√©rir de nouvelles.  Par exemple, vous devez abandonner les animations JS et vous contenter des animations CSS.  Vous devrez apprendre √† rendre l'infrastructure initialement g√©o-distribu√©e si vous souhaitez servir des utilisateurs de diff√©rents pays avec une haute qualit√©.  Je dois abandonner JS et aller √† Scala. </p><br><p>  J'ai un peu honte (en fait pas) d'avoir tromp√© le lecteur et de ne pas dire imm√©diatement que Korolev a √©t√© √©crit en Scala.  Pourriez-vous lire jusqu'√† ce point si j'en parlais imm√©diatement?  En parlant de la Reine, je dois surmonter deux st√©r√©otypes.  Le premier est d√ª au fait que le rendu du serveur est per√ßu comme quelque chose de lent, pas interactif.  La seconde est li√©e au fait que Scala est quelque chose de compliqu√©.  Et le premier et le deuxi√®me st√©r√©otype n'ont rien √† voir avec la r√©alit√©.  De plus, la programmation dans le style React sur Scala est plus pratique que sur JS.  Le JS moderne se tourne vers la programmation fonctionnelle, Scala le sort de la bo√Æte.  Par exemple, tout objet dans Scala a une m√©thode <code>copy()</code> qui vous permet de copier un objet en modifiant certains champs.  Les collections immuables sont int√©gr√©es dans la biblioth√®que standard de Scala. </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  Korolev a √©t√© d√©velopp√© pendant trois ans par plusieurs d√©veloppeurs et de nombreux probl√®mes "enfants" y sont r√©solus.  Le projet est bien document√©, toutes les fonctionnalit√©s sont couvertes d'exemples.  Je propose de commencer la mise en place de la Reine avec de petits services ind√©pendants.  J'esp√®re que Korolev contribuera √† rendre les programmes moins d√©cevants. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien vers le projet sur github</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr429028/">https://habr.com/ru/post/fr429028/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr429016/index.html">Volvo et Baidu d√©velopperont ensemble des v√©hicules sans pilote</a></li>
<li><a href="../fr429018/index.html">Pourquoi la nouvelle conception de Gmail est-elle si lente?</a></li>
<li><a href="../fr429020/index.html">Qu'est-ce qu'un setter fluide</a></li>
<li><a href="../fr429022/index.html">GridGain on Highload: o√π parler des SGBD distribu√©s, en m√©moire et open source</a></li>
<li><a href="../fr429024/index.html">Cr√©er des GIF avec OpenCV</a></li>
<li><a href="../fr429030/index.html">Logomachine cr√©e des logos gratuits par commentaire</a></li>
<li><a href="../fr429032/index.html">Splunk Essentials pour l'application Financial Services Industry, ou comment Splunk entre sur le march√© de l'analyse financi√®re</a></li>
<li><a href="../fr429034/index.html">Quelques histoires sur les programmeurs underground</a></li>
<li><a href="../fr429038/index.html">Rust News # 2 (octobre 2018)</a></li>
<li><a href="../fr429040/index.html">Patch de code Java sur la production sans anesth√©sie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>