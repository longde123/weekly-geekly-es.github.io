<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⏯️ 🎮 🤴🏿 Energi, panas, dan air bagian tiga: buka radio 👩🏼‍🔧 💾 🦁</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Entri 
 Dalam proses memilih solusi untuk rumah pintar, saya mencoba untuk mem-bypass solusi kotak yang memerlukan komunikasi dengan cloud eksternal a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Energi, panas, dan air bagian tiga: buka radio</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/467761/"><h2>  Entri </h2><br>  Dalam proses memilih solusi untuk rumah pintar, saya mencoba untuk mem-bypass solusi kotak yang memerlukan komunikasi dengan cloud eksternal atau memiliki aplikasi sendiri, terutama solusi tanpa kemampuan untuk terhubung langsung ke perangkat.  Semua metrik yang tersedia dikurangi menjadi satu antarmuka - zabbix, di mana sistem peringatan pemangku kepentingan diatur.  Kenop kontrol diterapkan di antarmuka web yang berada di lokasi lokal. <br><br><h2>  Artikel sebelumnya: </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bagian satu</a> (suhu 1wire, ups, meter air ...) <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bagian dua</a> (netping, gidrolock, sensor tekanan ...) <br><br><h2>  Tugas yang diselesaikan dalam artikel ini </h2><br><ul><li>  Perlindungan kebocoran air yang fleksibel dan dapat diukur dengan peringatan zabbix </li><li>  Perangkat lain di 433mhz: bel, pintu terbuka, dll. </li><li>  Kami mendorong 1wire di MQTT </li></ul><br><h2>  Sistem perlindungan kebocoran </h2><br><h3>  Persyaratan Sistem: </h3><br><ul><li>  banyak sensor yang tersebar di sekitar rumah (dalam kasus saya - 6 buah di lokasi yang berbeda) </li><li>  tidak ada kabel di sensor </li><li>  shutdown cepat setelah deteksi kebocoran </li><li>  semua informasi status saat ini di zabbix.  Ada peringatan </li></ul><br><h3>  Komposisi Sistem </h3><br><ul><li>  Raspberry PI </li><li>  RTL2832U USB tuner </li><li>  Sensor Kebocoran 433mhz </li><li>  Netping + gidrolock crane (lihat artikel sebelumnya) untuk mematikan bagasi </li></ul><a name="habracut"></a><br><h3>  Tentang besi </h3><br>  Dalam artikel sebelumnya, saya menjelaskan solusi mematikan pasokan air menggunakan netping.  Saya punya satu sensor kabel untuk solusi ini.  Ini nyaman jika semua titik di mana kebocoran dapat terjadi berada di sekitar tempat yang sama.  Dalam kasus saya, netping dipasang langsung di pintu masuk jalan raya dan mengontrol derek gidrolock elektro-mekanis di tempat yang sama (lihat artikel sebelumnya).  Hamburan netping + gidrolock + sensor kabel di semua titik itu mahal dan rumit.  Selain itu, saya tidak lagi memiliki kesempatan untuk menarik kabel baru di sekitar rumah.  Mengisi soket dan menghirup derek listrik adalah solusi biasa-biasa saja.  Solusi yang diharapkan - kami menggunakan tumpang tindih jalan raya umum berdasarkan sinyal dari sensor radio yang tersebar di seluruh lokasi. <br>  Dari apa yang ditemukan di Internet - sekelompok sensor radio yang berbeda dari sistem yang siap pakai.  Beberapa dapat dibeli secara terpisah, saya tidak membeli controller untuk sensor, agar tidak menghasilkan elemen tambahan di sirkuit. <br><br>  Bagaimana saya bisa menangkap 433 MHz?  Ternyata - TV tuner pada chipset tertentu.  Dan sekarang dia layak satu sen (saya mengambil Avito untuk 300r) seperti ini: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b84/efb/7c8/b84efb7c88ad3e4a89edbb470a653843.png" alt="gambar"><br><br>  Saya memesan antena terpisah untuk itu pada 12dbi, karena yang sekarang tidak mencakup seluruh rumah. <br><br>  Karena saya mencoba untuk meminimalkan komponen kontrol sirkuit, ada keinginan untuk mengencangkan tuner ke router rumah saya dengan Openwrt, yang sampai sekarang adalah inti dari solusi rumah pintar untuk 1wire, modbus, sensor wifi / protokol, tetapi, sayangnya, saya menghabiskan beberapa sumber dayanya ( ruang pada built-in flash drive untuk perangkat lunak yang diperlukan berakhir, prosesor memuat sesuatu - sudah akan ada masalah dengan jaringan, dan kami masih memiliki 4k untuk terlihat online :), + sudah terlalu banyak hal yang tergantung pada USB, yang mempengaruhi stabilitas pengumpulan data).  Diputuskan untuk secara bertahap mentransfer fungsionalitas rumah pintar ke perangkat eksternal - rarpberry pi (salah satu versi pertama ada di tangan). <br><br><h3>  Tentang perangkat lunak </h3><br>  Setelah bermain dengan TV tuner sdr-tajam pada komputer desktop dengan windows (setelah mencoba menangkap radio orang lain dan negosiasi pesawat), saya mulai melihat apakah sensor sendiri melihat "peluit".  Ya, ia melihat dengan sempurna: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/37e/68a/4d6/37e68a4d69b575f74e47db6ae45b0d4b.jpg" alt="gambar"><br><br><h4>  Pengaturan raspberry </h4><br>  Saya memilih raspbian asli.  Saya menulis gambar terakhir pada USB flash drive di bawah mac / linux: <br><br><pre><code class="bash hljs">sudo dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=2019-07-10-raspbian-buster-lite.img of=/dev/disk2 bs=1048576 conv=sync</code> </pre> <br>  Boot, konfigurasikan jaringan dan ssh. <br><br>  Berikutnya - pakai paket raspberry rtl-sdr, rtl_433: <br><br><pre> <code class="bash hljs">sudo apt-get install cmake build-essential python-pip libusb-1.0-0-dev libusb-1.0 python-numpy git git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/merbanan/rtl_433.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> rtl_433/ mkdir build <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> build cmake .. make make install</code> </pre> <br>  rtl_433 memiliki protokol bawaan yang mendekripsi data dari berbagai perangkat yang beroperasi dalam kisaran 433mhz. <br><br><h4>  Kami mulai rtl_433 </h4><br><pre> <code class="bash hljs">rtl_433 -f 433.9e6</code> </pre> <br>  Kami menurunkan sensor ke dalam air dan mendapatkan yang berharga: <br><br><pre> <code class="bash hljs">time : 2019-09-17 15:04:39 model : Smoke detector GS 558 id : 16919 unit : 1 learn : 0 Raw Code : c842e1</code> </pre><br>  Detektor asap?  Ok, mari kita nyanyikan lagu "Smoke on the water" pada peringatan dari sensor-sensor ini ... :) <br>  Tapi serius - kami memiliki id masing-masing sensor, yang menurutnya di masa depan kita akan memahami di mana tepatnya kita memiliki kebocoran (dan kita akan mematikan dalam hal apapun). <br><br><h4>  Tentang sensor kebocoran </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/47a/255/60d/47a25560dd09554b0749dc171502c71b.png" alt="gambar"><img src="https://habrastorage.org/getpro/habr/post_images/710/dd8/917/710dd891751f85699ed64c30b180c443.png" alt="gambar"><img src="https://habrastorage.org/getpro/habr/post_images/b56/f4b/a31/b56f4ba310bd674da8b16171c5112806.png" alt="gambar"><br><br>  Setelah mengatur bagian perangkat lunak, saya perhatikan bahwa sensor dengan aliexpress (foto kiri) mengirim sinyal tunggal ketika air masuk ke kontak.  Ditambah satu sinyal jika air berhenti menutup kontak.  Ini sama sekali tidak cocok untuk saya (perilaku yang diharapkan: terus-menerus mengirim sinyal alarm ketika sensor merasakan air, karena satu sinyal mungkin hilang).  Perilaku serupa diamati jika Anda menutup kontak dengan kawat.  Tapi yang aneh - alarm terjadi setiap 2-3 detik, jika Anda menutup kontak dengan tangan (kulit).  Di sini saya masih memiliki dua asumsi: baik orang Cina mengacaukan pengukuran resistansi, atau sensor memiliki beberapa mode operasi lain di mana mereka berperilaku entah bagaimana berbeda (misalnya, dipasangkan dengan pengontrol), atau ada frekuensi lain (sampai saya menemukan ) <br><br>  <i>Ngomong-ngomong, tulis di komentar, mungkin seseorang bekerja dengan sensor ini, dapatkah mereka "diajari" untuk mengirim sinyal tentang kebocoran terus-menerus?</i> <br><br>  Saya mengesampingkan sensor ini, di gudang ada lagi dari rubetek (foto kanan) dan membeli di Leroy: GAL SHW-1005 (foto tengah). <br><br>  Perilaku sensor rubetek tampak benar-benar tidak dapat diprediksi (reaksi tak terduga "melihat air / tidak melihat"). <br><br>  Tetapi sensor dari Leroy bergerak menunjukkan apa yang saya butuhkan: ada air - saya mengirim spam ke udara, tidak ada air - saya diam.  Satu-satunya minus adalah jari-jari aksi lebih kecil dari sensor lainnya.  Tetapi masalahnya diselesaikan dengan membeli antena yang lebih sensitif untuk penerima. <br><br><h4>  MQTT </h4><br>  Bagaimana cara mengirim output rtl_433 ke zabbix?  Beri makan agen?  Kirim ke zabbix_sender, menganalisis prosesnya?  Mungkin melalui syslog? <br><br>  Di sini Anda perlu mengingat bahwa zabbix saya ada di suatu tempat di awan.  Dan tentu saja tidak perlu menghalangi air dengan bantuan pemicunya.  Lantai rumah akan banjir sampai dia membuat keputusan (jika tersedia). <br><br>  Berita baiknya adalah rtl_433 dapat mengirim informasi tentang MQTT.  Di luar kotak.  Pada saat yang sama, data dikirim ke broker dalam format json. <br><br>  Jadi, Anda perlu: <br><br><ul><li>  Tempatkan broker mosquitto lokal (lakukan di raspberry). </li><li>  Gabungkan info ke broker dengan topik yang diinginkan, sehingga nantinya bisa diuraikan. </li><li>  Sambungkan ke broker secara lokal di raspberry dan kirim perintah ke netping </li><li>  Terhubung ke broker dari tempat redirection ke zabbix akan berlangsung (server zabbix dalam kasus saya juga merupakan klien MQTT) </li></ul><br><h4>  Instalasi-pengaturan mosquitto MQTT: </h4><br><pre> <code class="bash hljs">apt-get install mosquitto mosquitto-clients systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> mosquitto systemctl start mosquitto</code> </pre> <br><h4>  Kami mengirim informasi ke broker yang menunjukkan id perangkat: </h4><br><pre> <code class="bash hljs">rtl_433 -f 433.88e6 -F mqtt://127.0.0.1,events=/433/[id]</code> </pre> <br>  Di klien mqtt kita akan mendapatkan sesuatu seperti berikut: <br><br><pre> <code class="bash hljs">mosquitto_sub -h 127.0.0.1 -t <span class="hljs-string"><span class="hljs-string">'#'</span></span> (   ) /433/16919 {<span class="hljs-string"><span class="hljs-string">"time"</span></span>:<span class="hljs-string"><span class="hljs-string">"2019-09-18 11:55:29"</span></span>,<span class="hljs-string"><span class="hljs-string">"model"</span></span>:<span class="hljs-string"><span class="hljs-string">"Smoke detector GS 558"</span></span>,<span class="hljs-string"><span class="hljs-string">"id"</span></span>:16919,<span class="hljs-string"><span class="hljs-string">"unit"</span></span>:1,<span class="hljs-string"><span class="hljs-string">"learn"</span></span>:0,<span class="hljs-string"><span class="hljs-string">"code"</span></span>:<span class="hljs-string"><span class="hljs-string">"c842e1"</span></span>}</code> </pre> <br><h4>  Script untuk terhubung ke broker dan mengirim perintah ke netping </h4><br>  Saya membuat sketsa klien skrip MQTT sederhana yang memungkinkan Anda menjalankan skrip yang terkait dengan topik saat topik yang ditentukan dalam konfigurasi muncul.  Dengan demikian, ketika sensor tertentu dipicu dan informasi tentang itu muncul di Udara (misalnya, / 433/16919), Anda dapat melakukan beberapa tindakan (dalam hal netping, kirim ikal permintaan untuk menutup crane, lihat artikel sebelumnya).  Tautan ke skrip ada di akhir artikel. <br><br><h4>  Pengalihan di zabbix </h4><br>  Saya menggunakan solusi mqtt-zabbix yang sudah jadi.  Pada levelnya, kami memahami item yang akan dikirim nilainya (berdasarkan id). <br><br>  Di keys.cfg, tentukan: <br><br><pre> <code class="bash hljs">/433/16919,mqtt.ventilation.waterleak::hostname</code> </pre> <br>  di mana nama host adalah nama host dengan jenis gelandangan item di Zabbix. <br><br>  Penting !!!  Nama host dalam pengaturan harus sesuai dengan nama yang akan dikirim dalam skrip, jenis item (elemen data) harus sesuai untuk data yang dikirim (misalnya, untuk json - teks), jika tidak, Anda akan menemukan kesalahan bentuk: <br><br><pre> <code class="bash hljs">2019-09-18 14:29:48,749 Got response from Zabbix: {u<span class="hljs-string"><span class="hljs-string">'info'</span></span>: u<span class="hljs-string"><span class="hljs-string">'processed: 0; failed: 1; total: 1; seconds spent: 0.000055'</span></span>, u<span class="hljs-string"><span class="hljs-string">'response'</span></span>: u<span class="hljs-string"><span class="hljs-string">'success'</span></span>}</code> </pre> <br>  Selain itu, sulit untuk mencapai lebih banyak debug (dan mengapa gagal) dari zabbix. <br><br>  Kami mengkonfigurasi /etc/mqtt-zabbix/mqtt-zabbix.cfg (tentukan broker ip mqtt dan alamat server zabbix). <br><br><h3>  Apa lagi yang terhubung ke 433? </h3><br>  <i>Ya semuanya!</i>  <i>:)</i> <br><br><h4>  Sensor Stasiun Cuaca </h4><br>  Sementara mengutak-atik sensor kebocoran nirkabel, saya tidak sengaja menangkap sinyal dari sensor eksternal dari stasiun cuaca.  Itu terlihat seperti ini: <br><br><pre> <code class="bash hljs">time : 2019-09-19 10:48:54 Protocol : 56 model : TFA pool temperature sensor Id : 182 Channel : 3 Temperature: 19.3 C Modulation: ASK Freq : 433.9 MHz RSSI : -0.1 dB SNR : 35.0 dB Noise : -35.2 dB time : 2019-09-20 10:57:29 Protocol : 12 brand : OS model : THN132N House Code: 4 Channel : 3 Battery : OK Celsius : 20.00 C Modulation: ASK Freq : 432.9 MHz RSSI : -0.2 dB SNR : 31.5 dB Noise : -31.7 dB</code> </pre><br>  Dengan demikian, bonusnya adalah kemampuan untuk memonitor suhu titik-titik di udara dengan tampilan di zabbix.  Hanya di beberapa kamar saya tidak bisa meregangkan kabel. <br><br><h4>  Bel </h4><br>  Banyak panggilan radio bekerja dalam rentang frekuensi yang sama ~ 433mhz.  Dengan demikian, kita dapat mencegat penekanan tombol panggil (bahkan tidak perlu memiliki panggilan itu sendiri, cukup tombolnya saja).  Mengapa  Misalnya, untuk mengkonfigurasi pemberitahuan tambahan melalui SMS / ke telegram / apa pun atau menampilkan gambar dari kamera pada monitor. <br><br>  Saya membeli telepon: Evology QA-688-E RU. <br><br>  Agar tombol rtl_433 melihat tombol panggilan, Anda perlu mengaktifkan protokol "test", misalnya dengan menjalankan dengan opsi "G" atau menentukan protokol tambahan tertentu, pada saat yang sama kami akan menambahkan output informasi tentang protokol dan frekuensi: <br><br><pre> <code class="bash hljs">rtl_433 -f 433.9e6 -G -M protocol -M level -F mqtt://127.0.0.1,events=/433/[id] &amp;</code> </pre> <br>  Dapatkan di MQTT: <br><br><pre> <code class="bash hljs">{<span class="hljs-string"><span class="hljs-string">"time"</span></span>:<span class="hljs-string"><span class="hljs-string">"2019-09-30 10:57:00"</span></span>,<span class="hljs-string"><span class="hljs-string">"protocol"</span></span>:72,<span class="hljs-string"><span class="hljs-string">"model"</span></span>:<span class="hljs-string"><span class="hljs-string">"RF-tech"</span></span>,<span class="hljs-string"><span class="hljs-string">"id"</span></span>:0,<span class="hljs-string"><span class="hljs-string">"battery"</span></span>:<span class="hljs-string"><span class="hljs-string">"LOW"</span></span>,<span class="hljs-string"><span class="hljs-string">"temperature_C"</span></span>:0,<span class="hljs-string"><span class="hljs-string">"button"</span></span>:0,<span class="hljs-string"><span class="hljs-string">"mod"</span></span>:<span class="hljs-string"><span class="hljs-string">"ASK"</span></span>,<span class="hljs-string"><span class="hljs-string">"freq"</span></span>:433.84822,<span class="hljs-string"><span class="hljs-string">"rssi"</span></span>:-3.5981,<span class="hljs-string"><span class="hljs-string">"snr"</span></span>:33.77488,<span class="hljs-string"><span class="hljs-string">"noise"</span></span>:-37.373}</code> </pre> <br>  Di sini Anda dapat melihat id = 0.  Pada saat yang sama, saya memiliki beberapa perangkat yang diidentifikasi sebagai RF-tech.  Semuanya memiliki id sama dengan 0. Sebagai hasilnya, semua perangkat di zabbix ditampilkan sebagai satu item.  Dimungkinkan untuk membedakan dengan tepat perangkat mana yang berfungsi, hanya berdasarkan frekuensi. <br><br>  Kami menarik frekuensi menjadi item yang terpisah: mqtt.outside.doorbell.freq dengan JSON preprocessing di $ .freq (zabbix dapat melakukan ini dari versi ke-4). <br><br>  Pada item ini, buat pemicu dengan ekspresi: <br><br><pre> <code class="bash hljs">{HOME_PI:mqtt.outside.doorbell.freq.last()}&gt;433.8 and {HOME_PI:mqtt.outside.doorbell.freq.last()}&lt;433.81 and {HOME_PI:mqtt.outside.doorbell.freq.nodata(30)}=0</code> </pre> <br>  Yaitu  jika tiba-tiba suatu nilai muncul di item umum mqtt.outside.doorbell.freq (nodata) dan frekuensi berada dalam kisaran yang ditentukan antara 433.8 dan 433.81, kita dapat menyimpulkan bahwa mereka memanggil kami (dan misalnya, untuk menggandakan panggilan ke SMS). <br><br><h4>  Sensor Pintu / Jendela </h4><br>  Saya memiliki sensor penetrasi dari rubetek.  Mengirim yang berikut: <br><br><pre> <code class="bash hljs">{<span class="hljs-string"><span class="hljs-string">"time"</span></span>:<span class="hljs-string"><span class="hljs-string">"2019-09-30 14:11:28"</span></span>,<span class="hljs-string"><span class="hljs-string">"protocol"</span></span>:86,<span class="hljs-string"><span class="hljs-string">"model"</span></span>:<span class="hljs-string"><span class="hljs-string">"Smoke detector GS 558"</span></span>,<span class="hljs-string"><span class="hljs-string">"id"</span></span>:12262,<span class="hljs-string"><span class="hljs-string">"unit"</span></span>:16,<span class="hljs-string"><span class="hljs-string">"learn"</span></span>:0,<span class="hljs-string"><span class="hljs-string">"code"</span></span>:<span class="hljs-string"><span class="hljs-string">"e5fcd0"</span></span>,<span class="hljs-string"><span class="hljs-string">"mod"</span></span>:<span class="hljs-string"><span class="hljs-string">"ASK"</span></span>,<span class="hljs-string"><span class="hljs-string">"freq"</span></span>:433.85021,<span class="hljs-string"><span class="hljs-string">"rssi"</span></span>:-3.99241,<span class="hljs-string"><span class="hljs-string">"snr"</span></span>:33.38058,<span class="hljs-string"><span class="hljs-string">"noise"</span></span>:-37.373}  : {<span class="hljs-string"><span class="hljs-string">"time"</span></span>:<span class="hljs-string"><span class="hljs-string">"2019-09-30 14:11:28"</span></span>,<span class="hljs-string"><span class="hljs-string">"protocol"</span></span>:68,<span class="hljs-string"><span class="hljs-string">"model"</span></span>:<span class="hljs-string"><span class="hljs-string">"Kerui Security"</span></span>,<span class="hljs-string"><span class="hljs-string">"id"</span></span>:46074,<span class="hljs-string"><span class="hljs-string">"cmd"</span></span>:7,<span class="hljs-string"><span class="hljs-string">"state"</span></span>:<span class="hljs-string"><span class="hljs-string">"close"</span></span>,<span class="hljs-string"><span class="hljs-string">"mod"</span></span>:<span class="hljs-string"><span class="hljs-string">"ASK"</span></span>,<span class="hljs-string"><span class="hljs-string">"freq"</span></span>:433.85021,<span class="hljs-string"><span class="hljs-string">"rssi"</span></span>:-3.99241,<span class="hljs-string"><span class="hljs-string">"snr"</span></span>:33.38058,<span class="hljs-string"><span class="hljs-string">"noise"</span></span>:-37.373}  : {<span class="hljs-string"><span class="hljs-string">"time"</span></span>:<span class="hljs-string"><span class="hljs-string">"2019-09-30 14:11:21"</span></span>,<span class="hljs-string"><span class="hljs-string">"protocol"</span></span>:68,<span class="hljs-string"><span class="hljs-string">"model"</span></span>:<span class="hljs-string"><span class="hljs-string">"Kerui Security"</span></span>,<span class="hljs-string"><span class="hljs-string">"id"</span></span>:46074,<span class="hljs-string"><span class="hljs-string">"cmd"</span></span>:14,<span class="hljs-string"><span class="hljs-string">"state"</span></span>:<span class="hljs-string"><span class="hljs-string">"open"</span></span>,<span class="hljs-string"><span class="hljs-string">"mod"</span></span>:<span class="hljs-string"><span class="hljs-string">"ASK"</span></span>,<span class="hljs-string"><span class="hljs-string">"freq"</span></span>:433.85005,<span class="hljs-string"><span class="hljs-string">"rssi"</span></span>:-11.0148,<span class="hljs-string"><span class="hljs-string">"snr"</span></span>:25.1088,<span class="hljs-string"><span class="hljs-string">"noise"</span></span>:-36.1236}</code> </pre> <br>  Segera setelah sensor radio terakhir ditambahkan ke zabbix, saya ingin mengulang semuanya di MQTT.  Pembuatan katalog yang mudah, Anda dapat menentukan topik-ah dan penempatan serta jenis perangkat.  Anda mendapatkan siaran umum semua acara. <br><br><h2>  1wire ke MQTT </h2><br>  Saya ingin semuanya berada di MQTT, setidaknya untuk jenis implementasi yang sama.  Saya ingin mendapatkan "eter" peristiwa umum dan pendekatan umum sebagai reaksi terhadap peristiwa-peristiwa ini.  Tentu saja, zabbix memecahkan masalah reaksi, dan saya meninggalkan peringatan di atasnya.  Tapi saya ingin membuat manajemen lebih ramah, dekat dengan sistem dan "ether". <br><br>  Solusi siap pakai untuk menyampaikan status sensor dari jaringan 1wire ke MQTT ada, tetapi tidak cocok untuk saya.  Solusi siap pakai pada node baik membawa banyak dependensi di belakang mereka, atau memakan seluruh prosesor raspberry.  Beberapa solusi dari 10 teratas dalam pencarian Google ditinggalkan oleh penulis, beberapa hanya didukung oleh sensor suhu.  Ada juga kelas gateway yang mengumpulkan informasi melalui antarmuka gpio.  Semua ini tidak cocok untukku. <br><br>  Saya memiliki sistem file pseudo terpasang dengan perangkat 1wire di / mnt / 1wire, di situlah saya ingin mendapatkan semua informasi yang diperlukan.  Untuk melakukan ini, cukup membuat satu baris sederhana di bash, mengirimkan data melalui mosquitto_pub untuk masing-masing sensor.  Namun, muncul pertanyaan untuk meluncurkan skrip ini (di atas, untuk mendorong ke semacam daemon?), Presentasi data yang normal (mendapatkan json yang sama), menambahkan sensor baru, dll. Semakin jauh pemikiran berkembang, semakin banyak kruk lahir.  Ternyata lebih mudah untuk menulis gateway untuk owf lain ke mqtt untuk tugas ini. <br><br>  Ada file konfigurasi di mana kita perlu memasukkan id sensor dan file-file itu dari fuse.OWFS yang ingin kita publikasikan ke mqtt. <br><br>  Output di mqtt adalah json berikut: <br><br><pre> <code class="bash hljs">/1wire/28.0425260a0000 {<span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"DS18B20"</span></span>, <span class="hljs-string"><span class="hljs-string">"temperature"</span></span>: <span class="hljs-string"><span class="hljs-string">"30"</span></span>} /1wire/28.bf16270a0000 {<span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"DS18B20"</span></span>, <span class="hljs-string"><span class="hljs-string">"temperature"</span></span>: <span class="hljs-string"><span class="hljs-string">"7.9375"</span></span>} /1wire/26.da2f71010000 {<span class="hljs-string"><span class="hljs-string">"temperature"</span></span>: <span class="hljs-string"><span class="hljs-string">"25.2812"</span></span>, <span class="hljs-string"><span class="hljs-string">"IAD"</span></span>: <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-string"><span class="hljs-string">"CA"</span></span>: <span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"VAD"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.91"</span></span>, <span class="hljs-string"><span class="hljs-string">"VDD"</span></span>: <span class="hljs-string"><span class="hljs-string">"4.59"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"DS2438"</span></span>} /1wire/28.48b3010b0000 {<span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"DS18B20"</span></span>, <span class="hljs-string"><span class="hljs-string">"temperature"</span></span>: <span class="hljs-string"><span class="hljs-string">"40.5625"</span></span>} /1wire/1d.6a9306000000 {<span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"DS2423"</span></span>, <span class="hljs-string"><span class="hljs-string">"counter.B"</span></span>: <span class="hljs-string"><span class="hljs-string">"9"</span></span>, <span class="hljs-string"><span class="hljs-string">"counter.A"</span></span>: <span class="hljs-string"><span class="hljs-string">"9219"</span></span>} /1wire/28.61cc260a0000 {<span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"DS18B20"</span></span>, <span class="hljs-string"><span class="hljs-string">"temperature"</span></span>: <span class="hljs-string"><span class="hljs-string">"12.5"</span></span>}</code> </pre> <br>  Tambahkan ke autorun, atur interval polling.  Masalahnya terpecahkan. <br><br><h3>  Referensi </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github.com/merbanan/rtl_433</a> - alat untuk mendekode protokol radio <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github.com/kylegordon/mqtt-zabbix</a> - MQTT di Zabbix <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github.com/unlo/1wire2mqtt</a> - 1wire di MQTT, klien MQTT yang memungkinkan Anda menjalankan skrip saat topik muncul </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id467761/">https://habr.com/ru/post/id467761/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id467749/index.html">GCP: Parsing Google Cloud Platform Computing Stack</a></li>
<li><a href="../id467751/index.html">Bagaimana cara messenger terdesentralisasi di blockchain</a></li>
<li><a href="../id467753/index.html">Rekor dunia untuk transmisi data nirkabel: 40 Gb / s per 11 kilometer</a></li>
<li><a href="../id467755/index.html">Prion, kalsium, mikrobiota, hormon makanan, dan Alzheimer</a></li>
<li><a href="../id467759/index.html">Desain OS seperti Unix - Ruang Alamat Virtual (6)</a></li>
<li><a href="../id467763/index.html">Seluruh kebenaran tentang RTOS. Artikel # 33. Menggunakan Sistem Operasi Real-Time Nucleus SE</a></li>
<li><a href="../id467767/index.html">Fasilitas lainnya untuk pengikut JSON-RPC</a></li>
<li><a href="../id467769/index.html">Pada sumber daya informasi federal tunggal yang mengandung informasi populasi</a></li>
<li><a href="../id467773/index.html">Sumber pada sumber daya yang tidak biasa dan melakukan kontak pertama</a></li>
<li><a href="../id467775/index.html">5 mitos tentang bisnis: mengapa klien salah dan bagaimana melampaui Apple</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>