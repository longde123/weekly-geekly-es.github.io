<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ”¯ ğŸ•³ï¸ ğŸ¥„ ä½¿ç”¨ChipWhispererä»STM32F1xxé—ªå­˜è¯»å–å®‰å…¨å›ºä»¶ ğŸ‘©ğŸ¿â€ğŸš€ ğŸ’Ÿ ğŸ“•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ChipWhispererå¤„ç†äº†Vccå°æ•…éšœæ”»å‡»ã€‚ æˆ‘ä»¬çš„è¿›ä¸€æ­¥ç›®æ ‡æ˜¯åˆ†é˜¶æ®µç ”ç©¶è¯»å–å—ä¿æŠ¤çš„å›ºä»¶å¾®æ§åˆ¶å™¨çš„è¿‡ç¨‹ã€‚ ä½¿ç”¨æ­¤ç±»æ”»å‡»ï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—®æ‰€æœ‰è®¾å¤‡å¯†ç å’Œè½¯ä»¶ç®—æ³•ã€‚ ä¸€ä¸ªç”ŸåŠ¨çš„ä¾‹å­æ˜¯ä½¿ç”¨Vcc-glitchæ”»å‡»é€šè¿‡MK STM32F042æ¿å¯¹ Ledger Nano Sç¡¬ä»¶...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨ChipWhispererä»STM32F1xxé—ªå­˜è¯»å–å®‰å…¨å›ºä»¶</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ntc-vulkan/blog/483732/"><img src="https://habrastorage.org/webt/8h/fe/kf/8hfekfa930idilbg4asymru0cbm.png"><br><p> åœ¨ä¸Š<a href="https://habr.com/ru/company/ntc-vulkan/blog/480500/">ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œ</a>æˆ‘ä»¬ä½¿ç”¨ChipWhispererå¤„ç†äº†Vccå°æ•…éšœæ”»å‡»ã€‚ æˆ‘ä»¬çš„è¿›ä¸€æ­¥ç›®æ ‡æ˜¯åˆ†é˜¶æ®µç ”ç©¶è¯»å–å—ä¿æŠ¤çš„å›ºä»¶å¾®æ§åˆ¶å™¨çš„è¿‡ç¨‹ã€‚ ä½¿ç”¨æ­¤ç±»æ”»å‡»ï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—®æ‰€æœ‰è®¾å¤‡å¯†ç å’Œè½¯ä»¶ç®—æ³•ã€‚ ä¸€ä¸ªç”ŸåŠ¨çš„ä¾‹å­æ˜¯ä½¿ç”¨Vcc-glitchæ”»å‡»é€šè¿‡MK STM32F042æ¿<a href="https://www.youtube.com/watch%3Flist%3DPLhixgUqwRTjyLgF4x-ZLVFL-CRTCrUo03%255E_%255Eamp%255E_%255Etime_continue%3D3%255E_%255Eamp%255E_%255Ev%3DnNBktKw9Is4">å¯¹</a> Ledger Nano Sç¡¬ä»¶åŠ å¯†é’±åŒ…çš„<a href="https://www.youtube.com/watch%3Flist%3DPLhixgUqwRTjyLgF4x-ZLVFL-CRTCrUo03%255E_%255Eamp%255E_%255Etime_continue%3D3%255E_%255Eamp%255E_%255Ev%3DnNBktKw9Is4">é»‘å®¢</a>æ”»å‡»ã€‚ </p><br><p> æœ‰æ„æ€å— è®©æˆ‘ä»¬åœ¨çŒ«ä¸‹çœ‹ã€‚ </p><a name="habracut"></a><br><p> æˆ‘ä»¬ä»<a href="https://pdfs.semanticscholar.org/4c01/a7514deacc2c02d010bb14c4fb58d1712adc.pdf">ä¸€ç¯‡</a>æ˜¾ç¤ºVccå°æ•…éšœæ”»å‡»ç»“æœçš„<a href="https://pdfs.semanticscholar.org/4c01/a7514deacc2c02d010bb14c4fb58d1712adc.pdf">æ–‡ç« </a>ä¸­äº†è§£äº†è¯»å–å—ä¿æŠ¤å›ºä»¶çš„å¯èƒ½æ€§-é€šè¿‡å¼•å¯¼åŠ è½½ç¨‹åºç»•è¿‡RDPä¿æŠ¤å­—èŠ‚ï¼Œç”¨äºå‡ ä¸ªå¾®æ§åˆ¶å™¨ï¼ˆä»¥ä¸‹ç§°ä¸ºMKï¼‰ã€‚ æˆ‘ä»¬è¿˜å»ºè®®æ‚¨é˜…è¯»æœ‰å…³ç ´åESP32çš„<a href="https://limitedresults.com/2019/11/pwn-the-esp32-forever-flash-encryption-and-sec-boot-keys-extraction/">æ–‡ç« </a> ã€‚ </p><br><p> è¯¥ç ”ç©¶çš„ç†è®ºåŸºç¡€æ˜¯ä½¿ç”¨ChipWhispereré€šè¿‡é¢ç½©åŠ è½½å™¨æˆåŠŸè¯»å–LPC1114çš„å—ä¿æŠ¤å›ºä»¶çš„<a href="https://wiki.newae.com/Tutorial_A9_Bypassing_LPC1114_Read_Protect">æŒ‡å—</a> ã€‚ </p><br><p> ä¸ç¬¬ä¸€ç¯‡æ–‡ç« ä¸€æ ·ï¼Œæˆ‘ä»¬å†³å®šåœ¨MK STM32F103RBT6æ¿ä¸Šè¿›è¡Œå®éªŒï¼š </p><br><img src="https://habrastorage.org/webt/nc/ul/rw/nculrwzmxjlbwnjkwqzs9wlpq3e.png"><br><p>  <em>æ¿STM32F103RBT6</em> </p><br><p> å°†æ•°æ®å†™å…¥é—ªå­˜å’ŒRAMæ‰‡åŒºæˆ–è¯»å–å®ƒä»¬ä»¥åŠå¯¹MKå­˜å‚¨å™¨æ‰§è¡Œå…¶ä»–æ“ä½œçš„èƒ½åŠ›å–å†³äºä¿æŠ¤å­—èŠ‚çš„å€¼ï¼ˆå¯¹äºSTM32-RDPï¼‰ã€‚ å¯¹äºä¸åŒçš„MKï¼Œä¿æŠ¤å­—èŠ‚çš„å€¼å’Œç”¨é€”ä»¥åŠæ£€æŸ¥å®ƒä»¬çš„ç®—æ³•æ˜¯ä¸åŒçš„ã€‚ </p><br><p>  <strong>ç¡¬ä»¶è®¾å®š</strong> </p><br><p> è®©æˆ‘ä»¬å¼€å§‹å®éªŒã€‚ é¦–å…ˆï¼Œæ‚¨éœ€è¦æ ¹æ®è¯¥å›¾å°†ChipWhispererè¿æ¥åˆ°MKï¼š </p><br><img src="https://habrastorage.org/webt/cw/fs/8s/cwfs8sdseto5gdlv8bcedgk9wzg.png"><br><p>  <em>ChipWhispererä¸STM32çš„è¿æ¥å›¾ï¼Œç”¨äºé€šè¿‡æ¨¡æ¿åŠ è½½å™¨è¯»å–å—ä¿æŠ¤çš„å›ºä»¶</em> </p><br><p> å›¾ä¸­æ ‡å‡ºäº†åº”ä»STM32F103RBT6æ¿ä¸Šç§»é™¤çš„å…ƒä»¶ï¼ˆä¸æ ‡å‡†MKè¿æ¥ç›¸åï¼‰ã€‚ ç®­å¤´æŒ‡ç¤ºChipWhispererçš„è¿æ¥ç‚¹ï¼Œç­¾åæŒ‡ç¤ºå…¶å¼•è„šã€‚ </p><br><p> å¦‚å›¾æ‰€ç¤ºï¼Œä¸éœ€è¦å¤–éƒ¨çŸ³è‹±ï¼Œå› ä¸ºåœ¨ä½¿ç”¨æ©è†œå™¨æ—¶ï¼ŒMK STM32F103RBT6ä½¿ç”¨å†…éƒ¨æ—¶é’Ÿçš„é¢‘ç‡ä¸º24 MHzï¼Œå› æ­¤ChipWhispererä¸MKä¹‹é—´æ²¡æœ‰åŒæ­¥ã€‚ </p><br><p> è®©æˆ‘ä»¬ç»§ç»­è®¾ç½®ChipWhispererã€‚ å¦‚ä¸Šæ‰€è¿°ï¼ŒChipWhispererçš„æ¨èé¢‘ç‡ä¸º24 MHzï¼ˆæˆ–å…¶ä»–å€æ•°ï¼‰ã€‚ æ­¤é¢‘ç‡çš„å€æ•°è¶Šé«˜ï¼Œæ‚¨å¯ä»¥æ›´å‡†ç¡®åœ°è°ƒæ•´èµ·éŸ³æ—¶åˆ»ã€‚ ç”±äºç¼ºä¹åŒæ­¥ï¼Œscope.glitch.offsetå‚æ•°çš„é€‰æ‹©æ˜¯å¯é€‰çš„ï¼›å¯ä»¥å°†ä»»ä½•å€¼åˆ†é…ç»™å®ƒã€‚ </p><br><p>å¿…é¡»æ ¹æ®ChipWhispererçš„è®¾ç½®é¢‘ç‡é€‰æ‹©å‚æ•°scope.glitch.repeatå’Œscope.glitch.widthã€‚ å¯¹äºè¾ƒå¤§çš„é¢‘ç‡å€¼ï¼Œæ‰€æœ‰çŸ­æœŸè„‰å†²ï¼ˆå…¶æ•°é‡ç”±scope.glitch.repeatè®¾ç½®ï¼‰å°†åˆå¹¶ä¸ºä¸€ä¸ªé•¿è„‰å†²ã€‚ å› æ­¤ï¼Œå¯ä»¥é€‰æ‹©å‚æ•°scope.glitch.widthå’Œscope.glitch.repeatä¿®å¤çš„å€¼ï¼Œåä¹‹äº¦ç„¶ã€‚ æˆ‘ä»¬å‘ç°æœ€ä½³è„‰å†²æŒç»­æ—¶é—´åº”çº¦ä¸º80 nsï¼ˆå®šä¹‰ä¸ºæœ€å¤§è„‰å†²å®½åº¦çš„ä¸€åŠï¼‰ã€‚ </p><br><p> ä»ç„¶å¯ä»¥é€‰æ‹©å‚æ•°scope.glitch.ext_offsetçš„å€¼ã€‚ </p><br><p>  <strong>é€‰æ‹©scope.glitch.ext_offset</strong> </p><br><p> é¦–å…ˆï¼Œæ‚¨éœ€è¦é€‰æ‹©æ”»å‡»æ—¶åˆ»ã€‚ æ ¹æ®STMå…¬å¸<a href="https://www.st.com/content/ccc/resource/technical/document/application_note/51/5f/03/1e/bd/9b/45/be/CD00264342.pdf/files/CD00264342.pdf/jcr:content/translations/en.CD00264342.pdf">æ–‡ä»¶ä¸­</a>æå‡ºçš„æ–¹æ¡ˆï¼Œåœ¨æ”¶åˆ°ä»é—ªå­˜æ‰‡åŒºè¯»å–æ•°æ®çš„è¯·æ±‚åï¼Œå°†æ£€æŸ¥ä¿æŠ¤å­—èŠ‚å€¼ï¼š </p><br><img src="https://habrastorage.org/webt/m7/b-/ja/m7b-jat7np90pioveykbe8giw6y.jpeg"><br><p>  <em>ç”¨äºå“åº”ä»é—ªå­˜æ‰‡åŒºè¯»å–æ•°æ®çš„è¯·æ±‚çš„ç®—æ³•</em> </p><br><p> ä¸ºäº†éªŒè¯è¿™ç§éªŒè¯æ–¹æ¡ˆçš„æœ‰æ•ˆæ€§ï¼Œæˆ‘ä»¬é€šè¿‡ST-Linkè¯»å–äº†å…·æœ‰RDPä¿æŠ¤çš„ç±»ä¼¼MKçš„Bootloaderå¯æ‰§è¡Œä»£ç ã€‚ ä¸‹å›¾æ˜¾ç¤ºäº†éƒ¨åˆ†<strong>è¯»å–å†…å­˜å‘½ä»¤</strong>å¤„ç†ç®—æ³•ã€‚ </p><br><img src="https://habrastorage.org/webt/tf/1k/uf/tf1kufh_t31hbeol-vhdxzooqba.png"><br><p>  <em>å¤„ç†å†…å­˜è¯»å–å‘½ä»¤çš„ä¸€èˆ¬è§†å›¾ï¼ˆå¯¹RDPæ£€æŸ¥åŠŸèƒ½çš„è°ƒç”¨ä»¥åŠåœ¨æ£€æŸ¥å¤±è´¥çš„æƒ…å†µä¸‹å‘é€NACKæ¸…æ™°å¯è§ï¼‰</em> </p><br><img src="https://habrastorage.org/webt/as/vk/3h/asvk3h81acmw7vjx75he0tcimga.jpeg"><br><p>  <em>RDPéªŒè¯åŠŸèƒ½ä¸»ä½“</em> </p><br><p>è®©æˆ‘ä»¬æ³¨æ„ä¸€ä¸‹RDPæ£€æŸ¥åŠŸèƒ½çš„ä¸»ä½“ï¼šå¯ä»¥çœ‹å‡ºï¼Œæ­£åœ¨<code>0x40022000 + 0x1C</code>è¯»å–å¯„å­˜å™¨ï¼Œé€»è¾‘ç§»ä½ä¸º30ä½å¹¶åˆ†æ”¯ã€‚ ä»<a href="https://www.st.com/content/ccc/resource/technical/document/programming_manual/10/98/e8/d4/2b/51/4b/f5/CD00283419.pdf/files/CD00283419.pdf/jcr:content/translations/en.CD00283419.pdf">PM0075ç¼–ç¨‹æ‰‹å†Œï¼ˆSTM32F10xxxé—ªå­˜å¾®æ§åˆ¶å™¨ï¼‰</a>çš„æ–‡æ¡£ä¸­ï¼Œå¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°<code>0x40022000</code>æ˜¯é—ªå­˜æ§åˆ¶å™¨çš„åŸºåœ°å€ï¼Œè€Œ<code>0x1C</code>æ˜¯<strong>FLASH_OBR</strong>å¯„å­˜å™¨<strong>åç§»é‡</strong> ï¼Œæˆ‘ä»¬æ„Ÿå…´è¶£çš„æ˜¯<strong>RDPRT</strong>çš„ç¬¬äºŒä½ï¼šè¯»å–ä¿æŠ¤ï¼Œå…¶ä¸­åŒ…å«RDPä¿æŠ¤çŠ¶æ€ã€‚ </p><br><p> æ”»å‡»çš„å¿…è¦æ—¶åˆ»æ˜¯å¼€å‘<code>LDR</code>æŒ‡ä»¤ï¼ˆä»å†…å­˜åŠ è½½ï¼‰ã€‚ è¯¥æŒ‡ä»¤ä½äºè¯»å–å›ºä»¶çš„è¯·æ±‚ï¼ˆå‘é€<code>0x11</code>å­—èŠ‚å’Œ<code>0xEE</code> ï¼‰ä¸UARTçš„<code>ACK</code> / <code>NOACK</code> MKå“åº”ä¹‹é—´ã€‚ ä¸ºäº†ä»è§†è§‰ä¸Šè§£å†³è¿™ä¸€é—®é¢˜ï¼Œæœ‰å¿…è¦å°†ç¤ºæ³¢å™¨è¿æ¥åˆ°UART1_RXï¼ˆå¼•è„šPA10ï¼‰å’ŒUART1_TXï¼ˆå¼•è„šPA9ï¼‰ï¼Œç„¶åæ ¹æ®UART1ç›‘è§†ç”µå‹å˜åŒ–ã€‚ ç»“æœï¼Œå…·æœ‰æ‰€é€‰scope.glitch.ext_offsetå€¼çš„åŠŸç‡èµ·ä¼æ³¢å½¢åº”å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><img src="https://habrastorage.org/webt/fz/dm/j5/fzdmj5iyu5zfmcvmbqx0hf2mqms.jpeg"><br><p>  <em>é€‰æ‹©æ”»å‡»æ—¶åˆ»</em> </p><br><p>  <strong>å›ºä»¶è¯»å–è„šæœ¬</strong> </p><br><p> ç°åœ¨ï¼Œæ‚¨éœ€è¦åœ¨Pythonä»£ç ä¸­æŒ‡å®šCW_TRIGè§¦å‘å™¨çš„è§¦å‘æ—¶åˆ»ï¼Œä»¥ä¾¿æ‹¦æˆªé€šè¿‡UART1_RXä¼ è¾“æ ¡éªŒå’Œçš„æ—¶åˆ»ã€‚  ChipWhispereræœ‰ä¸€ä¸ªç”¨äºä¸STM32 MK maskloaderé€šä¿¡çš„åº“ã€‚ åœ¨æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œè¯¥åº“ç”¨äºä½¿ç”¨ä½äº<code>class STM32FSerial(object)</code>æ–‡ä»¶ä¸­çš„ç±»<code>class STM32FSerial(object)</code>å°†æ‰‹å†Œä¸­çš„å›ºä»¶ä»æ‰‹å†Œä¸‹è½½åˆ°MKï¼Œå…¶è·¯å¾„ä¸º<code>software/chipwhisperer/hardware/naeusb/</code> ã€‚ è¦æ¿€æ´»è§¦å‘å™¨ï¼Œæ‚¨éœ€è¦å°†è¯¥ç±»å¤åˆ¶åˆ°ä¸»è¦çš„å¯æ‰§è¡Œè„šæœ¬ä¸­ï¼Œä»¥ä½¿ç±»æ–¹æ³•<code>CmdGeneric(self, cmd)</code>æˆä¸ºå…¨å±€å¯è®¿é—®çš„å¯¹è±¡ï¼Œå¹¶åœ¨å‘é€è¯·æ±‚çš„æ ¡éªŒå’Œï¼ˆ0xEEï¼‰ä»¥è¯»å–å†…å­˜æ‰‡åŒºä¹‹å‰æ·»åŠ <code>scope.arm()</code>å‘½ä»¤ã€‚ æœ€åçš„è¯¾ç¨‹åœ¨ä¸‹é¢çš„æ‰°æµå™¨ä¸­ç»™å‡ºã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ç”¨äºå°†ChipWhispererä¸STM32é€šä¿¡çš„ç±»</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> logging <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> chipwhisperer.common.utils <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> util <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> chipwhisperer.hardware.naeusb.programmer_stm32fserial <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> supported_stm32f <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> chipwhisperer.capture.api.programmers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Programmer <span class="hljs-comment"><span class="hljs-comment"># class which can normally using internal CW library for reading STM32 firmware by UART class STM32Reader(Programmer): def __init__(self): super(STM32Reader, self).__init__() self.supported_chips = supported_stm32f self.slow_speed = False self.small_blocks = True self.stm = None def stm32prog(self): if self.stm is None: stm = self.scope.scopetype.dev.serialstm32f else: stm = self.stm stm.slow_speed = self.slow_speed stm.small_blocks = self.small_blocks return stm def stm32open(self): stm32f = self.stm32prog() stm32f.open_port() def stm32find(self): stm32f = self.stm32prog() stm32f.scope = self.scope sig, chip = stm32f.find() def stm32readMem(self, addr, lng): stm32f = self.stm32prog() stm32f.scope = self.scope #answer = stm32f.readMemory(addr, lng) answer = self.ReadMemory(addr, lng) return answer def stm32GetID(self): stm32f = self.stm32prog() stm32f.scope = self.scope answer = stm32f.cmdGetID() return answer # Needed for connection to STM after reload by reset_target(scope) method def FindSTM(self): #setup serial port (or CW-serial port?) stm32f = self.stm32prog() try: stm32f.initChip() except IOError: print("Failed to detect chip. Check following: ") print(" 1. Connections and device power. ") print(" 2. Device has valid clock (or remove clock entirely for internal osc).") print(" 3. On Rev -02 CW308T-STM32Fx boards, BOOT0 is routed to PDIC.") raise boot_version = stm32f.cmdGet() chip_id = stm32f.cmdGetID() for t in supported_stm32f: if chip_id == t.signature: # print("Detected known STMF32: %s" % t.name) stm32f.setChip(t) return chip_id, t # print("Detected unknown STM32F ID: 0x%03x" % chip_id) return chip_id, None</span></span></code> </pre> </div></div><br><p> åº”è¯¥æ³¨æ„çš„æ˜¯ï¼ŒSTM32F1xx maskloaderä½¿æ‚¨å¯ä»¥åœ¨å•ä¸ªè¯·æ±‚ä¸­ä»æŒ‡å®šçš„é—ªå­˜æ‰‡åŒºè¯»å–ä¸è¶…è¿‡256ä¸ªå­—èŠ‚çš„å›ºä»¶ã€‚ å› æ­¤ï¼Œåœ¨è¯»å–MKçš„æ•´ä¸ªå›ºä»¶æ—¶ï¼Œæœ‰å¿…è¦åœ¨Vccå°æ•…éšœæ”»å‡»æœŸé—´æ‰§è¡Œå‡ ä¸ªè¯»å–è¯·æ±‚ã€‚ ç„¶åï¼Œåº”å°†æ”¶åˆ°çš„256ä¸ªå­—èŠ‚åˆ†æˆ8ä¸ª32å­—èŠ‚çš„æ•°ç»„ï¼Œå¹¶ä»ä¸­å½¢æˆä¸€ä¸ªHEXæ–‡ä»¶ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">HEXè½¬æ¢å™¨ä»£ç å’Œè¾…åŠ©åŠŸèƒ½</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int2str_0xFF</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int_number, number_of_bytes)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'{0:0{1}X}'</span></span>.format(int_number,number_of_bytes_in_string) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data_dividing_from_256_to_32_bytes</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data_to_divide, mem_sector, mem_step=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">32</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> mem_sector &gt; <span class="hljs-number"><span class="hljs-number">0xFFFF</span></span>: mem_conversion = mem_sector &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span> mem_conversion = mem_sector - (mem_conversion &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span>) data_out = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(int(<span class="hljs-number"><span class="hljs-number">256</span></span>/mem_step)): data_vector = data_to_divide[(i * mem_step):((i + <span class="hljs-number"><span class="hljs-number">1</span></span>) * mem_step)] mem_calc = mem_conversion + (i * mem_step) data_out += read_and_convert_data_hex_file(data_vector, mem_calc, mem_step) + <span class="hljs-string"><span class="hljs-string">'\n'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data_out <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_and_convert_data_hex_file</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data_to_convert, memory_address, mem_step)</span></span></span><span class="hljs-function">:</span></span> addr_string = memory_address -((memory_address &gt;&gt; <span class="hljs-number"><span class="hljs-number">20</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">20</span></span>) data_buffer = <span class="hljs-string"><span class="hljs-string">''</span></span> crcacc = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, len(data_to_convert)): data_buffer += int2str_0xFF(data_to_convert[x], <span class="hljs-number"><span class="hljs-number">2</span></span>) crcacc += data_to_convert[x] crcacc += mem_step temp_addr_string = addr_string <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range (<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>): crcacc += temp_addr_string &gt;&gt; i*<span class="hljs-number"><span class="hljs-number">4</span></span> temp_addr_string -= ((temp_addr_string &gt;&gt; i*<span class="hljs-number"><span class="hljs-number">4</span></span>) &lt;&lt; i*<span class="hljs-number"><span class="hljs-number">4</span></span>) crcacc_2nd_symbol = (crcacc &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span> crcacc = (crcacc_2nd_symbol &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) - crcacc <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> crcacc == <span class="hljs-number"><span class="hljs-number">0x100</span></span>: crcacc = <span class="hljs-number"><span class="hljs-number">0</span></span> RECTYP = <span class="hljs-number"><span class="hljs-number">0x00</span></span> out_string = <span class="hljs-string"><span class="hljs-string">':'</span></span>+ Int_To_Hex_String(mem_step, <span class="hljs-number"><span class="hljs-number">2</span></span>) +\ Int_To_Hex_String((addr_string),<span class="hljs-number"><span class="hljs-number">4</span></span>) +\ Int_To_Hex_String(RECTYP, <span class="hljs-number"><span class="hljs-number">2</span></span>) +\ data_buffer +\ Int_To_Hex_String(crcacc, <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> out_string <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_to_file</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(info_to_output, File_name, directory)</span></span></span><span class="hljs-function">:</span></span> file = open(directory + File_name + <span class="hljs-string"><span class="hljs-string">'.hex'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) file.write(info_to_output) file.close() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reset_target</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(scope)</span></span></span><span class="hljs-function">:</span></span> scope.io.nrst = <span class="hljs-string"><span class="hljs-string">'low'</span></span> time.sleep(<span class="hljs-number"><span class="hljs-number">0.05</span></span>) scope.io.nrst = <span class="hljs-string"><span class="hljs-string">'high'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> collections <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> namedtuple Range = namedtuple(<span class="hljs-string"><span class="hljs-string">'Range'</span></span>, [<span class="hljs-string"><span class="hljs-string">'min'</span></span>, <span class="hljs-string"><span class="hljs-string">'max'</span></span>, <span class="hljs-string"><span class="hljs-string">'step'</span></span>])</code> </pre></div></div><br><p> ç°å·²å®Œæˆé…ç½®ChipWhispererè®¾ç½®ã€‚ è¯»å–å›ºä»¶çš„æœ€ç»ˆè„šæœ¬å¦‚ä¸‹ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># string of start HEX file Start_of_File_Record = ':020000040800F2' # string of end HEX file End_of_File_Record = ':00000001FF' length_of_sector = 256 if length_of_sector % 4 != 0: sys.exit('length_of_sector must be equal to 4') output_to_file_buffer = '' output_to_file_buffer += Start_of_File_Record + '\n' mem_current = mem_start while mem_current &lt; mem_stop: # flush the garbage from the computer's target read buffer target.ser.flush() # run aux stuff that should run before the scope arms here reset_target(scope) # initialize STM32 after each reset prog.FindSTM() try: # reading of closed memory sector data = prog.stm32readMem(mem_current, length_of_sector) except Exception as message: message = str(message) if "Can't read port" in message: # print('Port silence') pass elif 'Unknown response. 0x11: 0x0' in message: # print('Crashed. Reload!') pass elif 'NACK 0x11' in message: # print('Firmware is closed!') pass else: # print('Unknown error:', message, scope.glitch.offset, scope.glitch.width, scope.glitch.ext_offset) pass else: data_to_out = data_dividing_from_256_to_32_bytes (data, mem_current) print(data_to_out) output_to_file_buffer += data_to_out mem_current += length_of_sector output_to_file_buffer += End_of_File_Record + '\n' send_to_file(output_to_file_buffer, File_name, directory)</span></span></code> </pre> <br><p> è¯¥è¡Œä¹‹åçš„æ‰€æœ‰æ³¨é‡Šæ‰çš„<code>print()</code>æ¶ˆæ¯<code>print()</code> <code>except Exception as</code>å¸®åŠ©æœç´¢æ•…éšœè„‰å†²çš„æœ€ä½³å‚æ•°æ—¶ç›‘è§†MCçš„çŠ¶æ€ã€‚ è¦è·Ÿè¸ªMKçš„ç‰¹å®šçŠ¶æ€ï¼Œåªéœ€å–æ¶ˆæ³¨é‡Šå¿…è¦çš„<code>print()</code>æ¶ˆæ¯å°±è¶³å¤Ÿäº†ã€‚ </p><br><p>  <strong>é˜…è¯»ç»“æœ</strong> </p><br><p> è§†é¢‘æ˜¾ç¤ºäº†é€šè¿‡ST-LINKç¼–ç¨‹å™¨å°†å›ºä»¶ä¸‹è½½åˆ°MKï¼Œå°†RDPè½¬ç§»åˆ°ä¿æŠ¤çŠ¶æ€ï¼Œç„¶åè¯»å–å›ºä»¶ï¼š </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/CRfg9-1BV0k" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p> ä¸‹åˆ—é”™è¯¯å¯èƒ½ä¼šé˜»æ­¢æˆåŠŸçš„Vccå°æ•…éšœæ”»å‡»ï¼š </p><br><p>  â€¢è¯»å–é”™è¯¯çš„å†…å­˜æ‰‡åŒºï¼› </p><br><p>  â€¢è‡ªå‘åˆ é™¤å›ºä»¶ã€‚ </p><br><p> é€šè¿‡æé«˜ChipWhispererçš„é¢‘ç‡æ¥å‡†ç¡®é€‰æ‹©èµ·éŸ³æ—¶åˆ»ï¼Œå°†æœ‰åŠ©äºé¿å…æ­¤ç±»é”™è¯¯ã€‚ </p><br><p> åœ¨å¼€å‘å¹¶è°ƒè¯•äº†è¯»å–å—ä¿æŠ¤å›ºä»¶çš„ç®—æ³•ä¹‹åï¼Œæˆ‘ä»¬å¯¹ST-LINK-V2.1ç¼–ç¨‹å™¨çš„å›ºä»¶è¿›è¡Œäº†æµ‹è¯•è¯»å–ï¼Œè¯¥ç¼–ç¨‹å™¨å¯åœ¨STM32F103CBT6 MKä¸Šè¿è¡Œã€‚ æˆ‘ä»¬å°†ä¸€äº›å›ºä»¶ç¼åˆ¶åœ¨ä¸€ä¸ªâ€œå¹²å‡€çš„â€ MK STM32F103CBT6ä¸Šï¼Œå¹¶å®‰è£…äº†è¯¥å›ºä»¶ï¼Œè€Œä¸æ˜¯å‡ºå‚æ—¶çš„å›ºä»¶ã€‚ ç»“æœï¼Œæ›¿æ¢ä¸ºMKçš„ST-LINK-V2.1åœ¨æ­£å¸¸æ¨¡å¼ä¸‹å·¥ä½œï¼Œå¥½åƒæ²¡æœ‰æ›¿ä»£å“ä¸€æ ·ã€‚ </p><br><p> æˆ‘ä»¬è¿˜è¯•å›¾å¯¹STM32F303RCT7è¿›è¡Œä¸€ç³»åˆ—æ”»å‡»ã€‚ æ”»å‡»æœŸé—´çš„æ­¤MKçš„è¡Œä¸ºä¸STM32F103RBT6ç›¸åŒï¼Œä½†å¯¹è¯»å–å†…å­˜è¯·æ±‚çš„å“åº”åŒ…å«ç­‰äº0x00çš„å­—èŠ‚ï¼Œè¿™ä¸æˆ‘ä»¬é¢„æœŸçš„ç»“æœä¸ä¸€è‡´ã€‚ å¤±è´¥çš„åŸå› æ˜¯ç»„ç»‡è¿™äº›MKçš„ä¿æŠ¤æ›´åŠ å¤æ‚å’Œå‘è¾¾çš„åŸåˆ™ã€‚ </p><br><p>  STM32F1xx MKæœ‰ä¸¤ç§ä¿æŠ¤çŠ¶æ€ï¼šä¿æŠ¤å…³é—­ï¼ˆçº§åˆ«0ï¼‰å’Œå¼€å¯ï¼ˆçº§åˆ«1ï¼‰ã€‚ åœ¨è¾ƒæ—©çš„å‹å·ä¸­ï¼Œæœ‰ä¸‰ç§ä¿æŠ¤çŠ¶æ€ï¼šç¦ç”¨ä¿æŠ¤ï¼ˆçº§åˆ«0ï¼ŒRDP = 0x55AAï¼‰ï¼Œä»…å¯¹é—ªå­˜å’ŒSRAMå­˜å‚¨å™¨è¿›è¡Œä¿æŠ¤ï¼ˆçº§åˆ«2ï¼ŒRDP = 0x33CCï¼‰ï¼Œä»…å¯¹é—ªå­˜è¿›è¡Œä¿æŠ¤ï¼ˆçº§åˆ«1ï¼ŒRDPé‡‡ç”¨é™¤ä»¥ä¸‹ä»¥å¤–çš„ä»»ä½•å€¼ï¼‰ä»0x55AAå’Œ0x33CCï¼‰ã€‚ ç”±äºçº§åˆ«1å¯ä»¥é‡‡ç”¨è®¸å¤šRDPå€¼ï¼Œå› æ­¤è®¾ç½®çº§åˆ«0éå¸¸å›°éš¾ã€‚ å¦ä¸€æ–¹é¢ï¼Œå¯ä»¥é€šè¿‡èˆå¼ƒRDPå­—èŠ‚ä¸­çš„ä¸€ä½ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰æ¥å°†ä¿æŠ¤çº§åˆ«ä»2çº§é™ä½åˆ°1çº§ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ï¼Œä»è€Œå¯ä»¥è®¿é—®SRAMå­˜å‚¨å™¨ã€‚ </p><br><img src="https://habrastorage.org/webt/dj/by/ef/djbyefc1yji_gpevygy72yzvtjm.jpeg"><br><p>  <em>æ¯”è¾ƒä¸åŒå›ºä»¶ä¿æŠ¤çº§åˆ«çš„RDPå€¼</em> </p><br><p> ä»ç„¶åªæœ‰äº†è§£æ”»å‡»è€…å¦‚ä½•åˆ©ç”¨æ­¤ä¼˜åŠ¿ã€‚ ä¾‹å¦‚ï¼Œä½¿ç”¨æœ¬æ–‡ä»‹ç»çš„CBSï¼ˆå†·å¯åŠ¨æ­¥è¿›ï¼‰æ–¹æ³•ã€‚ æ­¤æ–¹æ³•åŸºäºåŠ è½½MCä¹‹åçš„SRAMå­˜å‚¨å™¨çŠ¶æ€çš„åˆ†é˜¶æ®µå¿«ç…§ï¼ˆæ¯ä¸ªå¿«ç…§çš„é¢‘ç‡åœ¨å¾®ç§’åŒºåŸŸå†…ï¼‰ï¼Œä»¥è·å¾—åŠ å¯†å¯†é’¥ï¼Œéšè—çš„å¯†ç æˆ–ä»»ä½•å…¶ä»–æœ‰ä»·å€¼çš„ä¿¡æ¯ã€‚ ä½œè€…å»ºè®®CBSæ–¹æ³•å°†é€‚ç”¨äºæ‰€æœ‰STM32 MKç³»åˆ—ã€‚ </p><br><p>  <strong>ç»“è®º</strong> </p><br><p> æ€»ç»“ä¸€ä¸‹æˆ‘ä»¬çš„å®éªŒã€‚ æˆ‘ä»¬èŠ±äº†å‡ å¤©çš„æ—¶é—´æ‰èƒ½å®Œæˆä»å…ˆå‰ç ”ç©¶è·å¾—çš„Vccå°æ•…éšœæ”»å‡»ï¼ˆå¯ä»¥åœ¨<a href="https://habr.com/ru/company/ntc-vulkan/blog/480500/">æ­¤å¤„</a>é˜…è¯»ï¼‰ã€‚ å› æ­¤ï¼Œå­¦ä¹ å¦‚ä½•è¿›è¡Œæ­¤ç±»æ”»å‡»éå¸¸å®¹æ˜“ã€‚ </p><br><p>  Vccå°æ•…éšœæ”»å‡»å¾ˆå±é™©ï¼Œå› ä¸ºå®ƒä»¬å¾ˆéš¾é˜²å¾¡ã€‚ ä¸ºäº†å‡å°‘æˆåŠŸè¿›è¡Œæ­¤ç±»æ”»å‡»çš„å¯èƒ½æ€§ï¼Œå»ºè®®ä½¿ç”¨å…·æœ‰æ›´é«˜é˜²æŠ¤çº§åˆ«çš„MKã€‚ </p><br><p> <a href="https://raccoonsecurity.ru/"><img src="https://habrastorage.org/webt/6d/ts/lv/6dtslv2uikkshhl7tmsi7fgjp0y.png"></a> </p><br><p>  Raccoon Securityæ˜¯ä½äºç«å±±ç§‘å­¦æŠ€æœ¯ä¸­å¿ƒçš„ä¸“å®¶ç»„æˆçš„ç‰¹æ®Šå›¢é˜Ÿï¼Œå…¶é¢†åŸŸåŒ…æ‹¬å®ç”¨çš„ä¿¡æ¯å®‰å…¨æ€§ï¼Œå¯†ç å­¦ï¼Œç”µè·¯ï¼Œé€†å‘å·¥ç¨‹å’Œä½çº§è½¯ä»¶çš„åˆ›å»ºã€‚ </p><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN483732/">https://habr.com/ru/post/zh-CN483732/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN483720/index.html">æ˜¯ä»€ä¹ˆä½¿æˆ‘ä»¬æˆä¸ºPandas 1.0</a></li>
<li><a href="../zh-CN483722/index.html">é›¶å”®ä¸šçš„åœ°ç†åˆ†æï¼Œç¬¬1éƒ¨åˆ†ï¼šæˆ‘ä»¬ä½¿é€‰æ‹©ä¸šåŠ¡åœ°ç‚¹çš„è¿‡ç¨‹è‡ªåŠ¨åŒ–ã€‚ 2 GIS + MS Azure + ML</a></li>
<li><a href="../zh-CN483724/index.html">ä¸å®šåˆ¶è½®èƒé…åˆä½¿ç”¨Redd</a></li>
<li><a href="../zh-CN483726/index.html">é¦™è‰JavaScriptå’ŒHTMLã€‚ æ²¡æœ‰æ¡†æ¶ã€‚ æ²¡æœ‰å›¾ä¹¦é¦†ã€‚ æ²¡é—®é¢˜</a></li>
<li><a href="../zh-CN483730/index.html">ç¨‹åºå‘˜è”åˆä¼š2ï¼šæ‹–é‹ä¸å†ç¬‘ç€ï¼Œå˜å¾—å¾ˆä½“è´´</a></li>
<li><a href="../zh-CN483736/index.html">åå‘å›¾åƒæœç´¢ï¼šè´çµçŒ«ä¾¦æ¢ç¤¾çš„æŒ‡å—</a></li>
<li><a href="../zh-CN483740/index.html">åœ¨Linuxï¼ˆå¯èƒ½è¿˜æœ‰* BSDï¼‰ä¸Šçš„OpenVPNéš§é“ä¸Šè®¾ç½®åŠ¨æ€è·¯ç”±ï¼ˆç‰¹åˆ«æ˜¯BGPï¼‰</a></li>
<li><a href="../zh-CN483742/index.html">æœç´¢é”™è¯¯ä½œä¸ºä¸€ç§ç”Ÿæ´»æ–¹å¼</a></li>
<li><a href="../zh-CN483744/index.html">æ–°å¹´å¤§ç‰¹å–</a></li>
<li><a href="../zh-CN483746/index.html">é€šé“ç«™ï¼šè¿›å…¥æœˆçƒçº¿ï¼Œè¿›å…¥ç«æ˜Ÿç«™</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>