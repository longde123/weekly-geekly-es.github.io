<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ–ï¸ ğŸ“ ğŸ™†ğŸ¼ Backend Ortodoks ğŸ¬ ğŸ›’ ğŸ‘©ğŸ¾â€ğŸ’»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Backend modern beragam, tetapi masih mematuhi beberapa aturan yang tak terucapkan. Banyak dari kita yang mengembangkan aplikasi server dihadapkan deng...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Backend Ortodoks</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474504/"><img src="https://habrastorage.org/webt/dj/q5/y-/djq5y-xjov_bqvrrnb08bfyqn4i.jpeg"><br><br>  Backend modern beragam, tetapi masih mematuhi beberapa aturan yang tak terucapkan.  Banyak dari kita yang mengembangkan aplikasi server dihadapkan dengan pendekatan yang diterima secara umum, seperti Arsitektur Bersih, SOLID, Ketidaktahuan Ketekunan, Injeksi Ketergantungan dan lain-lain.  Banyak atribut pengembangan server yang sangat usang sehingga tidak menimbulkan pertanyaan dan digunakan tanpa berpikir.  Mereka berbicara banyak tentang beberapa, tetapi tidak pernah menggunakannya.  Arti dari sisanya adalah salah ditafsirkan atau terdistorsi.  Artikel ini berbicara tentang bagaimana membangun arsitektur backend sederhana, benar-benar khas, yang tidak hanya dapat mengikuti sila teori pemrograman terkenal tanpa kerusakan, tetapi juga dapat meningkatkannya sampai batas tertentu. <br><a name="habracut"></a><br>  <i>Didedikasikan untuk semua orang yang tidak berpikir pemrograman tanpa kecantikan dan tidak menerima kecantikan di tengah-tengah absurditas.</i> <br><br><h2>  Model Domain </h2><br>  Pemodelan adalah tempat pengembangan perangkat lunak di dunia yang ideal harus dimulai.  Tetapi kita semua tidak sempurna, kita banyak berbicara tentang itu, tetapi kita melakukan semuanya seperti biasa.  Seringkali alasannya adalah ketidaksempurnaan alat yang ada.  Dan jujur â€‹â€‹saja, kemalasan dan ketakutan kita untuk mengambil tanggung jawab untuk menjauh dari "praktik terbaik".  Dalam dunia yang tidak sempurna, pengembangan perangkat lunak dimulai, paling-paling, dengan perancah, dan paling buruk, dengan optimalisasi kinerja, tidak ada apa-apa.  Namun demikian, saya ingin membuang contoh-contoh sulit dari arsitek "luar biasa" dan berspekulasi pada hal-hal yang lebih biasa. <br><br>  Jadi, kami memiliki tugas teknis, dan bahkan memiliki desain antarmuka pengguna (atau tidak, jika UI tidak disediakan).  Langkah selanjutnya adalah mencerminkan persyaratan dalam model domain.  Untuk memulai, Anda dapat membuat sketsa diagram objek model untuk kejelasan: <br><br><img src="https://habrastorage.org/webt/4n/hp/m5/4nhpm5kbhwvomryj9xhyww1eep0.png"><br><br>  Kemudian, sebagai suatu peraturan, kita mulai memproyeksikan model pada sarana implementasinya - bahasa pemrograman, konverter objek-relasional (Object-Relational Mapper, ORM), atau pada beberapa jenis kerangka kerja kompleks seperti ASP.NET MVC atau Ruby on Rails, dengan kata lain - mulai menulis kode.  Dalam hal ini, kami mengikuti jalur kerangka kerja, yang saya pikir tidak benar dalam kerangka pengembangan berdasarkan model, tidak peduli seberapa nyaman awalnya mungkin terlihat.  Di sini Anda membuat asumsi besar, yang kemudian meniadakan manfaat pengembangan berbasis domain.  Sebagai pilihan yang lebih bebas, tidak dibatasi oleh ruang lingkup alat apa pun, saya akan menyarankan untuk menggunakan hanya alat sintaksis dari bahasa pemrograman untuk membangun model objek dari area subjek.  Dalam pekerjaan saya, saya menggunakan beberapa bahasa pemrograman - C #, JavaScript, Ruby.  Takdir telah menetapkan bahwa ekosistem Java dan C # adalah inspirasi saya, JS adalah penghasilan utama saya, dan Ruby adalah bahasa yang saya sukai.  Oleh karena itu, saya akan terus menunjukkan contoh sederhana di Ruby: Saya yakin ini tidak akan menyebabkan masalah bagi pengembang dalam bahasa lain untuk mengerti.  Jadi, port model ke kelas Faktur di Ruby: <br><br><pre><code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Invoice</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_reader</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">amount</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">date</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">created_at</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">paid_at</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attrs</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">payment_service</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">created_at</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DateTime</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">now</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">paid_at</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nil</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">amount</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attrs</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">amount</span></span></span><span class="hljs-class">] @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">date</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attrs</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">date</span></span></span><span class="hljs-class">] @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscription</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attrs</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscription</span></span></span><span class="hljs-class">] @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">payment_service</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">payment_service</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pay</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">credit_card</span></span></span><span class="hljs-class"> = @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscription</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">customer</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">credit_card</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">amount</span></span></span><span class="hljs-class"> = @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscription</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">plan</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">payment_service</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">charge</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">credit_card</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">amount</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">paid_at</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DateTime</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">now</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br>  Yaitu  kami memiliki kelas yang konstruktornya menerima Hash atribut, dependensi objek dan menginisialisasi bidangnya, dan metode pembayaran yang dapat mengubah keadaan objek.  Semuanya sangat sederhana.  Sekarang kita tidak memikirkan bagaimana dan di mana kita akan menampilkan dan menyimpan objek ini.  Itu hanya ada, kita dapat membuatnya, mengubah keadaannya, berinteraksi dengan objek lain.  Harap dicatat bahwa kode tidak mengandung artefak asing seperti BaseEntity dan sampah lain yang tidak terkait dengan model.  Ini sangat penting.  Ngomong-ngomong, pada tahap ini kita sudah bisa memulai pengembangan melalui pengujian (TDD), menggunakan objek rintisan alih-alih dependensi seperti payment_service: <br><br><pre> <code class="ruby hljs">RSpec.describe Invoice <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> before <span class="hljs-symbol"><span class="hljs-symbol">:each</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> @payment_service = double(<span class="hljs-symbol"><span class="hljs-symbol">:payment_service</span></span>) allow(@payment_service).to receive(<span class="hljs-symbol"><span class="hljs-symbol">:charge</span></span>) @amount = <span class="hljs-number"><span class="hljs-number">100</span></span> @credit_card = CreditCard.new({...}) @customer = Customer.new({<span class="hljs-symbol"><span class="hljs-symbol">credit_card:</span></span> @credit_card, ...}) @subscription = Subscription.new({<span class="hljs-symbol"><span class="hljs-symbol">customer:</span></span> customer, ...}) @invoice = Invoice.new({<span class="hljs-symbol"><span class="hljs-symbol">amount:</span></span> @amount, <span class="hljs-symbol"><span class="hljs-symbol">date:</span></span> DateTime.now, @subscription: subscription}, payment_service) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> describe <span class="hljs-string"><span class="hljs-string">'pay'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> it <span class="hljs-string"><span class="hljs-string">"charges customer's credit card"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> expect(@payment_service).to receive(<span class="hljs-symbol"><span class="hljs-symbol">:charge</span></span>).with(@credit_card, @amount) @invoice.pay <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> it <span class="hljs-string"><span class="hljs-string">'makes the invoice paid'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> expect(@invoice.paid_at).not_to be_nil @invoice.pay <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  atau bahkan bermain dengan model dalam interpreter (irb untuk Ruby), yang mungkin, meskipun tidak terlalu ramah, antarmuka pengguna: <br><br><pre> <code class="bash hljs">irb &gt; invoice = Invoice.new({amount: @amount, date: DateTime.now, @subscription: subscription}, payment_service) irb &gt; invoice.pay</code> </pre><br>  Mengapa sangat penting untuk menghindari "artefak asing" pada tahap ini?  Faktanya adalah bahwa model itu seharusnya tidak tahu bagaimana itu akan disimpan atau apakah itu akan disimpan sama sekali.  Pada akhirnya, untuk beberapa sistem penyimpanan objek secara langsung dalam memori mungkin sangat cocok.  Pada saat pemodelan, kita harus sepenuhnya abstrak dari detail ini.  Pendekatan ini disebut Ketidaktahuan Ketekunan.  Harus ditekankan bahwa kita tidak mengabaikan masalah bekerja dengan repositori, apakah itu adalah relasional atau database lain, kita hanya mengabaikan detail berinteraksi dengannya pada tahap pemodelan.  Ketidaktahuan Ketekunan berarti penghapusan mekanisme yang disengaja untuk bekerja dengan keadaan model, serta semua jenis metadata yang terkait dengan proses ini, dari model itu sendiri.  Contoh: <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">#  class User &lt; Entity #     table :users #     # mapping  field :name, type: 'String' #   def save ... end end user = User.load(id) #     user.save #    </span></span></code> </pre><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">#  class User #   ,      attr_accessor :name, :lastname end user = repo.load(id) #     repo.save(user) #    </span></span></code> </pre><br>  Pendekatan ini juga karena alasan mendasar - kepatuhan dengan prinsip tanggung jawab tunggal (Prinsip Tanggung Jawab Tunggal, S dalam SOLID).  Jika model, di samping komponen fungsionalnya, menjelaskan parameter pelestarian keadaan dan juga berkaitan dengan pelestarian dan pemuatannya, maka jelas ia memiliki terlalu banyak tanggung jawab.  Hasil dan bukan keuntungan terakhir dari Ketidaktahuan Ketekunan adalah kemampuan untuk mengganti alat penyimpanan dan bahkan jenis penyimpanan itu sendiri selama proses pengembangan. <br><br><h2>  Model-View-Controller </h2><br>  Konsep MVC sangat populer di lingkungan pengembangan berbagai aplikasi, tidak hanya server, dalam berbagai bahasa dan platform yang tidak lagi kita pikirkan tentang apa itu dan mengapa itu diperlukan sama sekali.  Saya memiliki sebagian besar pertanyaan dari singkatan ini yang disebut "Controller".  Dari sudut pandang pengorganisasian struktur kode, merupakan hal yang baik untuk mengelompokkan tindakan pada model.  Tetapi controller tidak boleh kelas sama sekali, itu harus lebih merupakan modul yang mencakup metode untuk mengakses model.  Tidak hanya itu, haruskah tempat itu ada?  Sebagai pengembang yang mengikuti jalur .NET -&gt; Ruby -&gt; Node.js, saya cukup tersentuh oleh pengontrol JS (ES5) yang menerapkan dalam kerangka express.js.  Memiliki kemampuan untuk menyelesaikan tugas yang diberikan kepada pengendali dengan gaya yang lebih fungsional, para pengembang, seperti yang disihir, menulis "Controller" ajaib berulang kali.  Mengapa pengontrol biasa buruk? <br><br>  Pengontrol tipikal adalah seperangkat metode yang tidak terkait erat satu sama lain, disatukan oleh hanya satu - esensi tertentu dari model;  dan terkadang bukan hanya satu, lebih buruk.  Setiap metode individual mungkin memerlukan dependensi yang berbeda.  Melihat ke depan sedikit, saya perhatikan bahwa saya adalah pendukung praktik inversi ketergantungan (Dependency Inversion, D in SOLID).  Oleh karena itu, saya perlu menginisialisasi dependensi ini di suatu tempat di luar dan meneruskannya ke konstruktor controller.  Misalnya, ketika membuat akun baru, saya harus mengirim notifikasi ke akuntan, yang mana saya memerlukan layanan notifikasi, dan dengan metode lain saya tidak memerlukannya: <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InvoiceController</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">invoice_repository</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notification_service</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">repository</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">invoice_repository</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notification_service</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notification_service</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">index</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">repository</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_all</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">show</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">repository</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_by_id</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">create</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">repository</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">create</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notification_service</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notify_accountant</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  Di sini ide tersebut ingin dibagi menjadi metode untuk bekerja dengan model ke dalam kelas terpisah, dan mengapa tidak? <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ListInvoices</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">invoice_repository</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">repository</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">invoice_repository</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">repository</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_all</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CreateInvoice</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">invoice_repository</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notification_service</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">repository</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">invoice_repository</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notification_service</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notification_service</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">repository</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">create</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notification_service</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notify_accountant</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  Nah, alih-alih controller, sekarang ada satu set "fungsi" untuk mengakses model, yang, omong-omong, juga dapat disusun menggunakan direktori sistem file, misalnya.  Sekarang Anda perlu "membuka" metode ini ke luar, mis.  mengatur sesuatu seperti router.  Sebagai orang yang tergoda dengan semua jenis DSL (Domain-Specific Language), saya lebih suka untuk memiliki deskripsi yang lebih visual dari instruksi untuk aplikasi web daripada trik dalam Ruby atau bahasa tujuan umum lainnya untuk menentukan rute: <br><br><pre> <code class="plaintext hljs">`HTTP GET /invoices -&gt; return all invoices` `HTTP POST /invoices -&gt; create new invoice`</code> </pre><br>  atau setidaknya <br><br><pre> <code class="plaintext hljs">`HTTP GET /invoices -&gt; ./invoices/list_invoices` `HTTP POST /invoices -&gt; ./invoices/create`</code> </pre><br>  Ini sangat mirip dengan Router biasa, dengan satu-satunya perbedaan adalah bahwa ia tidak berinteraksi dengan pengendali, tetapi langsung dengan tindakan pada model.  Jelas bahwa jika kita ingin mengirim dan menerima JSON, maka kita harus mengurus serialisasi dan deserialisasi objek dan banyak lagi.  Dengan satu atau lain cara, kita dapat menyingkirkan pengontrol, mengalihkan sebagian tanggung jawab mereka ke struktur direktori dan Router yang lebih canggih. <br><br><h2>  Ketergantungan injeksi </h2><br>  Saya sengaja menulis "Router yang lebih canggih."  Agar router benar-benar dapat memungkinkan aliran tindakan pada model menggunakan mekanisme injeksi dependensi pada tingkat deklaratif, itu mungkin harus cukup rumit di dalamnya.  Skema umum karyanya akan terlihat seperti ini: <br><br><img src="https://habrastorage.org/webt/62/v1/ts/62v1tsjynvq067lnqxmpqefw0lg.png"><br><br>  Seperti yang Anda lihat, seluruh router saya penuh dengan injeksi ketergantungan menggunakan wadah IoC.  Mengapa ini perlu?  Konsep "injeksi ketergantungan" kembali ke teknik Ketergantungan Inversi, yang dirancang untuk mengurangi konektivitas objek dengan memindahkan inisialisasi dependensi di luar ruang lingkup penggunaannya.  Contoh: <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Repository</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-comment"><span class="hljs-comment">#  (   ) class A def initialize </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@repo</span></span></span><span class="hljs-comment"> = Repository.new end end #  (   ) class A def initialize(repo) </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@repo</span></span></span><span class="hljs-comment"> = repo end end</span></span></code> </pre><br>  Pendekatan ini sangat membantu mereka yang menggunakan Test-Driven Development.  Dalam contoh di atas, kita dapat dengan mudah meletakkan sebuah rintisan di konstruktor alih-alih objek repositori nyata sesuai dengan antarmuka, tanpa "meretas" model objek.  Ini bukan satu-satunya bonus DI: ketika diterapkan dengan benar, pendekatan ini akan membawa banyak keajaiban yang menyenangkan ke aplikasi Anda, tetapi hal pertama yang pertama.  Dependency Injection adalah pendekatan yang memungkinkan Anda untuk mengintegrasikan teknik Ketergantungan Inversi ke dalam solusi arsitektur yang lengkap.  Alat implementasi biasanya merupakan wadah IoC- (Inversion of Control).  Ada banyak wadah IoC yang sangat keren di dunia Java dan .NET, ada puluhan.  Di JS dan Ruby, sayangnya, tidak ada opsi yang cocok untuk saya.  Secara khusus, saya melihat dry-container (wadah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">kering</a> ).  Ini akan menjadi seperti apa kelas saya akan terlihat seperti menggunakannya: <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Invoice</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">include</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Import</span></span></span><span class="hljs-class">['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">payment_service</span></span></span><span class="hljs-class">'] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pay</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">credit_card</span></span></span><span class="hljs-class"> = @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscription</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">customer</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">credit_card</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">amount</span></span></span><span class="hljs-class"> = @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscription</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">plan</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">payment_service</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">charge</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">credit_card</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">amount</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  Alih-alih menggunakan konstruktor yang lebih ramping, kami membebani kelas dengan memperkenalkan dependensi kami sendiri, yang pada tahap awal membawa kami menjauh dari model yang bersih dan mandiri.  Nah, sesuatu dan modelnya seharusnya tidak tahu sama sekali tentang IoC!  Ini berlaku untuk tindakan seperti CreateInvoice.  Untuk kasus yang diberikan, dalam pengujian saya, saya sudah wajib menggunakan IOC sebagai sesuatu yang tidak dapat dicabut.  Ini benar-benar salah.  Objek aplikasi untuk sebagian besar tidak boleh tahu tentang keberadaan IoC.  Setelah mencari dan berpikir banyak, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">saya membuat sketsa IoC saya</a> , yang tidak akan terlalu mengganggu. <br><br><h2>  Menyimpan dan memuat model </h2><br>  Ketidaktahuan Ketekunan membutuhkan transformator objek yang tidak mencolok.  Dalam artikel ini, maksud saya akan bekerja dengan database relasional, poin utama akan berlaku untuk jenis penyimpanan lainnya.  Konverter objek-relasional - ORM (Object Relational Mapper) digunakan sebagai konverter serupa untuk database relasional.  Di dunia .NET dan Java, ada banyak alat ORM yang benar-benar kuat.  Semua dari mereka memiliki beberapa atau kekurangan kecil lain yang dapat Anda tutup mata.  Tidak ada solusi yang baik di JS dan Ruby.  Semua dari mereka, dengan satu atau lain cara, dengan kaku mengikat model ke kerangka kerja dan memaksa deklarasi elemen asing, belum lagi ketidakmampuan Ketidaktahuan Ketekunan.  Seperti dalam kasus IoC, saya berpikir tentang menerapkan ORM sendiri, ini adalah keadaan di Ruby.  Saya tidak melakukan semuanya dari awal, tetapi mengambil sebagai sekuel ORM sederhana, yang menyediakan alat yang tidak mencolok untuk bekerja dengan berbagai DBMS relasional.  Pertama-tama, saya tertarik pada kemampuan untuk mengeksekusi query dalam bentuk SQL biasa, menerima array string (objek hash) pada output.  Tinggal menerapkan Mapper Anda dan memberikan Ketidaktahuan Ketekunan.  Seperti yang sudah saya sebutkan, saya tidak ingin mencampur bidang pemetaan ke dalam model domain, jadi saya mengimplementasikan Mapper sehingga menggunakan file konfigurasi terpisah dalam format tipe: <br><br><pre> <code class="ruby hljs">entity Invoice <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> field <span class="hljs-symbol"><span class="hljs-symbol">:amount</span></span> field <span class="hljs-symbol"><span class="hljs-symbol">:date</span></span> field <span class="hljs-symbol"><span class="hljs-symbol">:start_date</span></span> field <span class="hljs-symbol"><span class="hljs-symbol">:end_date</span></span> field <span class="hljs-symbol"><span class="hljs-symbol">:created_at</span></span> field <span class="hljs-symbol"><span class="hljs-symbol">:updated_at</span></span> reference <span class="hljs-symbol"><span class="hljs-symbol">:user</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">type:</span></span> User reference <span class="hljs-symbol"><span class="hljs-symbol">:subscription</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">type:</span></span> Subscription <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Ketidaktahuan Ketekunan cukup sederhana untuk diterapkan menggunakan objek eksternal dari tipe Repositori: <br><br><pre> <code class="ruby hljs">repository.save(user)</code> </pre> <br>  Namun kami akan melangkah lebih jauh dan menerapkan pola Unit Kerja.  Untuk melakukan ini, Anda perlu menyoroti konsep sesi.  Sesi adalah objek yang ada dari waktu ke waktu, di mana serangkaian tindakan dilakukan pada model, yang merupakan operasi logis tunggal.  Selama sesi berlangsung, pemuatan dan perubahan objek model dapat terjadi.  Pada akhir sesi, keadaan transaksional model disimpan. <br>  Unit kerja contoh: <br><br><pre> <code class="ruby hljs">user = session.load(User, <span class="hljs-symbol"><span class="hljs-symbol">id:</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) plan = session.load(Plan, <span class="hljs-symbol"><span class="hljs-symbol">id:</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) subscription = Subscription.new(user, plan) session.attach(subscription) invoice = Invoice.new(subscription) session.attach(invoice) <span class="hljs-comment"><span class="hljs-comment"># ... # -       if Date.today.yday == 1 subscription.comment = 'New year offer' invoice.amount /= 2 end session.flush</span></span></code> </pre><br>  Akibatnya, 2 instruksi akan dieksekusi dalam database, bukan 4, dan keduanya akan dieksekusi dalam transaksi yang sama. <br><br>  Dan tiba-tiba ingat repositori!  Di sini ada perasaan deja vu, seperti halnya dengan pengontrol: bukankah repositori merupakan entitas yang belum sempurna?  Ke depan, saya akan menjawab - ya, benar.  Tujuan utama repositori adalah untuk menyelamatkan lapisan logika bisnis agar tidak berinteraksi dengan penyimpanan nyata.  Misalnya, dalam konteks basis data relasional, itu berarti menulis query SQL langsung dalam kode logika bisnis.  Tidak diragukan lagi, ini adalah keputusan yang sangat masuk akal.  Tetapi kembali ke saat ketika kita menyingkirkan controller.  Dari sudut pandang OOP, repositori pada dasarnya adalah pengontrol yang sama - serangkaian metode yang sama, tidak hanya untuk memproses permintaan, tetapi untuk bekerja dengan repositori.  Repositori juga dapat dibagi menjadi beberapa tindakan.  Dengan semua indikasi, tindakan ini tidak akan berbeda dengan apa pun dari apa yang kami usulkan daripada controller.  Yaitu, kita dapat menolak Repositori dan Pengendali demi satu Tindakan tunggal! <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoadPlan</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">session</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">session</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">session</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sql</span></span></span><span class="hljs-class"> = &lt;&lt;~</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SQL</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SELECT</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class">.* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AS</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ENTITY</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">plan</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FROM</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">plans</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WHERE</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class"> = 1 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SQL</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">session</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fetch</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Plan</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sql</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  Anda mungkin memperhatikan bahwa saya menggunakan SQL alih-alih semacam sintaks objek.  Ini masalah selera.  Saya lebih suka SQL karena ini adalah bahasa query, semacam DSL untuk bekerja dengan data.  Jelas bahwa selalu lebih mudah untuk menulis Plan.load (id) daripada SQL yang sesuai, tetapi ini untuk kasus-kasus sepele.  Ketika datang ke hal-hal yang sedikit lebih kompleks, SQL menjadi alat yang sangat disambut.  Kadang-kadang Anda mengutuk ORM lain dalam mencoba membuatnya seperti SQL murni, yang "Saya akan menulis dalam beberapa menit."  Bagi mereka yang ragu, saya sarankan untuk melihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">dokumentasi MongoDB</a> , di mana penjelasannya diberikan dalam bentuk seperti SQL, yang terlihat sangat lucu!  Oleh karena itu, antarmuka untuk kueri dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">JetSet ORM</a> , yang saya tulis untuk tujuan saya, adalah SQL dengan impregnasi minimal seperti "SEBAGAIMANA ENTITAS".  Ngomong-ngomong, dalam kebanyakan kasus saya tidak menggunakan objek model, berbagai DTO, dll. Untuk menampilkan data tabular - Saya hanya menulis kueri SQL, mendapatkan array objek hash dan menampilkannya dalam tampilan.  Dengan satu atau lain cara, beberapa orang berhasil "menggulir" data besar dengan memproyeksikan tabel terkait ke model.  Dalam praktiknya, proyeksi rata (tampilan) lebih mungkin digunakan, dan produk yang sangat matang sampai pada tahap optimasi ketika solusi yang lebih kompleks seperti CQRS (Command and Query Responsibility Segregation) mulai digunakan. <br><br><h2>  Menyatukan semuanya </h2><br>  Jadi apa yang kita miliki: <br><br><ul><li>  kami menemukan cara memuat dan menyimpan model, kami juga merancang arsitektur kasar alat pengiriman web model, router tertentu; </li><li>  kami sampai pada kesimpulan bahwa semua logika yang bukan bagian dari area subjek dapat dibawa ke Tindakan (Actions), bukan pengendali dan repositori; </li><li>  Tindakan harus mendukung injeksi ketergantungan </li><li>  alat yang layak Injeksi Ketergantungan dilaksanakan; </li><li>  ORM yang diperlukan diimplementasikan. </li></ul><br>  Satu-satunya yang tersisa adalah mengimplementasikan "router" yang sama.  Karena kita menyingkirkan repositori dan pengontrol yang mendukung tindakan, jelas bahwa untuk satu permintaan kita perlu melakukan beberapa tindakan.  Tindakan bersifat otonom dan kami tidak dapat saling berinvestasi.  Oleh karena itu, sebagai bagian dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">kerangka kerja Dandy,</a> saya mengimplementasikan router yang memungkinkan Anda membuat rantai tindakan.  Contoh konfigurasi (perhatikan / rencana): <br><br><pre> <code class="plaintext hljs">:receive .-&gt; :before -&gt; common/open_db_session GET -&gt; welcome -&gt; :respond &lt;- show_welcome /auth -&gt; :before -&gt; current_user@users/load_current_user /profile -&gt; GET -&gt; plan@plans/load_plan \ -&gt; :respond &lt;- users/show_user_profile PATCH -&gt; users/update_profile /plans -&gt; GET -&gt; current_plan@plans/load_current_plan \ -&gt; plans@plans/load_plans \ -&gt; :respond &lt;- plans/list :catch -&gt; common/handle_errors</code> </pre><br>  "DAPATKAN / auth / paket" menampilkan semua paket berlangganan yang tersedia dan "menyoroti" yang sekarang.  Berikut ini terjadi: <br><br><ol><li>  ": before -&gt; common / open_db_session" - membuka sesi JetSet </li><li>  / auth ": before -&gt; current_user @ users / load_current_user" - memuat pengguna saat ini (berdasarkan token).  Hasilnya dicatat dalam wadah IoC sebagai current_user (current_user @ instruksi). </li><li>  / auth / plan "current_plan @ plan / load_current_plan" - muat paket saat ini.  Untuk ini, nilai @current_user diambil dari wadah.  Hasilnya dicatat dalam wadah IoC sebagai current_plan (current_plan @ instruksi): <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoadCurrentPlan</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">current_user</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">session</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">current_user</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">current_user</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">session</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">session</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sql</span></span></span><span class="hljs-class"> = &lt;&lt;~</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SQL</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SELECT</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class">.* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AS</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ENTITY</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">plan</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FROM</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">plans</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">INNER</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JOIN</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscriptions</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">s</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ON</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">s</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user_id</span></span></span><span class="hljs-class"> = :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user_id</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AND</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">s</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">current</span></span></span><span class="hljs-class"> = '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">t</span></span></span><span class="hljs-class">' </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WHERE</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class"> = :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user_id</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LIMIT</span></span></span><span class="hljs-class"> 1 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SQL</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">session</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">execute</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sql</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user_id</span></span></span><span class="hljs-class">: @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">current_user</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">row</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">map</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Plan</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">row</span></span></span><span class="hljs-class">, '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">plan</span></span></span><span class="hljs-class">') </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br></li><li>  "Plans @ plan / load_plans" - memuat daftar semua paket yang tersedia.  Hasilnya terdaftar dalam wadah IoC sebagai paket (paket rencana @ instruksi). </li><li>  ": balas &lt;- paket / daftar" - ViewBuilder terdaftar, misalnya JBuilder, menggambar Lihat 'paket / rencana' dari jenis: <br><br><pre> <code class="ruby hljs">json.plans @plans <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|plan|</span></span> json.id plan.id json.name plan.name json.price plan.price json.active plan.id == @current_plan.id <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br></li></ol><br>  Sebagai @plans dan @current_plan, nilai yang terdaftar di langkah sebelumnya diambil dari wadah.  Dalam konstruktor Aksi, secara umum, Anda dapat "memesan" semua yang Anda butuhkan, atau lebih tepatnya, semua yang terdaftar dalam wadah.  Seorang pembaca yang penuh perhatian kemungkinan besar akan memiliki pertanyaan, tetapi apakah ada isolasi variabel tersebut dalam mode "multi-pengguna"?  Ya itu.  Faktanya adalah bahwa wadah Hypo IoC memiliki kemampuan untuk mengatur masa pakai objek dan, apalagi, mengikatnya dengan masa pakai objek lain.  Di dalam Dandy, variabel-variabel seperti @plans, @current_plan, @current_user terikat ke objek permintaan dan akan dimusnahkan saat permintaan selesai.  Ngomong-ngomong, sesi JetSet juga terikat dengan permintaan - pengaturan ulang negaranya juga akan dilakukan ketika permintaan Dandy selesai.  Yaitu  Setiap permintaan memiliki konteks tersendiri.  Hypo memerintah seluruh siklus hidup Dandy, tidak peduli betapa menyenangkan pun permainan ini dalam terjemahan harfiah nama-nama itu. <br><br><h2>  Kesimpulan </h2><br>  Dalam kerangka arsitektur yang diberikan, saya menggunakan model objek untuk menggambarkan area subjek;  Saya menggunakan praktik yang sesuai seperti Injeksi Ketergantungan;  Saya bahkan bisa menggunakan warisan.  Tetapi, pada saat yang sama, semua Tindakan ini pada dasarnya adalah fungsi biasa yang dapat dirantai bersama pada tingkat deklaratif.  Kami mendapatkan backend yang diinginkan dalam gaya fungsional, tetapi dengan semua kelebihan dari pendekatan objek, ketika Anda tidak mengalami masalah dengan abstraksi dan menguji kode Anda.  Menggunakan router DSL Dandy sebagai contoh, kita bebas membuat bahasa yang diperlukan untuk menggambarkan rute dan banyak lagi. <br><br><h2>  Kesimpulan </h2><br>  Sebagai bagian dari artikel ini, saya melakukan semacam kunjungan pada aspek-aspek mendasar dari menciptakan backend seperti yang saya lihat.  Saya ulangi, artikel ini dangkal, tidak menyentuh banyak topik penting, seperti, misalnya, pengoptimalan kinerja.  Saya mencoba untuk fokus hanya pada hal-hal yang benar-benar dapat bermanfaat bagi masyarakat sebagai makanan untuk dipikirkan, dan tidak sekali lagi menuangkan dari kosong ke kosong, apa yang SOLID, TDD, bagaimana skema MVC terlihat, dan sebagainya.  Definisi yang ketat tentang ini dan istilah-istilah lain yang digunakan oleh pembaca yang ingin tahu dapat dengan mudah ditemukan di jaringan yang luas, belum lagi kolega di toko, untuk siapa singkatan ini merupakan bagian dari pidato sehari-hari.  Dan akhirnya, saya tekankan, cobalah untuk tidak fokus pada alat yang perlu saya implementasikan untuk menyelesaikan masalah yang diajukan.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ini hanya demonstrasi dari validitas pikiran, bukan esensi mereka. </font><font style="vertical-align: inherit;">Jika artikel ini menarik, saya akan menulis bahan terpisah tentang perpustakaan ini.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id474504/">https://habr.com/ru/post/id474504/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id474494/index.html">Bagaimana KTT Zabbix 2019</a></li>
<li><a href="../id474496/index.html">Database di HighLoad ++ 2019</a></li>
<li><a href="../id474498/index.html">Tutorial JavaFX: Hello World</a></li>
<li><a href="../id474500/index.html">Pengembangan plugin untuk Grafana: kisah kerucut penuh</a></li>
<li><a href="../id474502/index.html">Odnoklassniki parsing di Joker 2019</a></li>
<li><a href="../id474508/index.html">Pencapaian bioprinting 3D cangkok kulit</a></li>
<li><a href="../id474514/index.html">Bagaimana para pengusaha pertambangan Bitcoin Tiongkok bertahan</a></li>
<li><a href="../id474516/index.html">Aplikasi suara: pasar ke-milyar yang tidak diperhatikan Rusia</a></li>
<li><a href="../id474518/index.html">FP vs OOP</a></li>
<li><a href="../id474522/index.html">Cerita mutt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>