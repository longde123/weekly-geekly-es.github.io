<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò∞ üë° üíπ ¬øC√≥mo implementar an√°lisis y no romper la aplicaci√≥n? ‚úãüèΩ üïäÔ∏è üôèüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Me llamo Sosnin Ilya. Trabajo en el desarrollador de Android Lamoda. Pinto botones, salto listas y, desafortunadamente, escribo an√°lisis ... 

 L...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>¬øC√≥mo implementar an√°lisis y no romper la aplicaci√≥n?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lamoda/blog/469761/"> Hola  Me llamo Sosnin Ilya.  Trabajo en el desarrollador de Android Lamoda.  Pinto botones, salto listas y, desafortunadamente, escribo an√°lisis ... <br><br>  Lamoda es una empresa basada en datos en la que todas las decisiones se toman en funci√≥n del comportamiento del usuario.  Primero observamos y solo luego sacamos conclusiones.  Por lo tanto, es f√°cil adivinar que tenemos an√°lisis y realmente lo necesitamos. <br><br>  Al descifrar mi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">informe de mitap Mosdroid # 18 Argon,</a> le dir√© c√≥mo funciona nuestro SDK y por qu√© la reflexi√≥n no siempre es mala.  Y tambi√©n responder√© la pregunta principal de este tema: "¬øC√≥mo implementar an√°lisis y no romper la aplicaci√≥n?". <br><img src="https://habrastorage.org/webt/l9/c8/yd/l9c8ydu-xkfvholrwahstcndmg0.png" alt="imagen"><br>  Para comenzar, te har√© una pregunta simple: "¬øC√≥mo piensas, cu√°ntas instalaciones tenemos en Google Play?" <br><a name="habracut"></a><br>  ¬°10 millones de instalaciones! <br><img src="https://habrastorage.org/webt/ta/vl/z8/tavlz80t36oelmjkxtmamhpbwwg.png" alt="imagen"><br>  <i>Indicador a principios de julio de 2019.</i> <i><br></i> <br>  Adem√°s del hecho de que sacamos conclusiones basadas en los usuarios, tambi√©n tenemos clientes internos que tambi√©n est√°n interesados ‚Äã‚Äãen el an√°lisis. <br><img src="https://habrastorage.org/webt/u6/tk/st/u6tkstig2dyvpjlh3g3w44s305y.png" alt="imagen"><br><br>  En primer lugar, el marketing necesita an√°lisis para sus propios fines de investigaci√≥n.  R&amp;D controla nuestras consultas de b√∫squeda a expensas de esto, y los productos se ejecutan con nuevas funciones. <br><br>  Por ejemplo, ten√≠amos una funci√≥n que nos permit√≠a recopilar toda la imagen como un todo.  Es decir, puede comprar no solo la camisa que le gust√≥ en el modelo, sino tambi√©n pantalones de la misma imagen.  Decidimos que, para empezar, lo escribiremos para iOS, y luego pensaremos si lo necesitamos.  Escribieron, buscaron y se aseguraron de que a los usuarios no les gustara. <br><br><img src="https://habrastorage.org/webt/87/r6/rm/87r6rmysut2j8_r5lfdotrvufbu.png" alt="imagen"><br><br>  ¬øQu√© crees que deber√≠a hacerse con las funciones que las personas no necesitan? <br><br>  <b>Bien, ¬°t√≠ralos!</b>  Esto vale especialmente cuando la funci√≥n est√° vinculada a servicios externos, ya que tienden a recibir problemas o pueden ser pagados.  Esto sucedi√≥ con esta caracter√≠stica.  No implementamos Android ni Desktop, sino que decidimos evolucionarlo.  (Tal vez alg√∫n d√≠a ella ir√° al producto en una forma m√°s perfecta). <br><br><h2>  Cual es la dificultad? </h2><br>  No importa cu√°n divertido pueda sonar esto, al introducir an√°lisis, puede ser <b>dif√≠cil trabajar con los propios analistas</b> .  La mayor√≠a de las veces, surgen conflictos porque solicitan datos que usted no tiene.  Y siempre termina con el hecho de que todav√≠a tiene que arrastrar un grupo de par√°metros a trav√©s de 10 pantallas para enviarles un peque√±o evento.  Y esto sucede con bastante frecuencia. <br><br>  El segundo desaf√≠o es <b>recopilar an√°lisis</b> .  Tenemos este proceso llevado a cabo en 7 sistemas. <br><br><img src="https://habrastorage.org/webt/7m/j2/ua/7mj2ua32vv5afydoioxpifcgi7o.png" alt="imagen"><br><br>  Algunos eventos entran en un sistema, otros en varios a la vez ... Adem√°s, existe tal caracter√≠stica que los eventos con diferentes par√°metros y en diferentes formatos pueden ir a diferentes sistemas.  Por supuesto, no queremos resolver todas estas dependencias. <br><br><blockquote>  <i>LStat es nuestro propio SDK (estad√≠sticas de Lamoda).</i>  <i>Este es un sistema masivo, que toma m√°s del 60% de varios eventos.</i>  <i>Los eventos que van m√°s all√° de Google, Adjust, a menudo se recopilaron inicialmente solo en LStat.</i> <br></blockquote><br><h2>  SDK </h2><br>  Nuestro SDK es el siguiente. <br><img src="https://habrastorage.org/webt/ne/ew/ah/neewahjaa6gb3tux9c0io9uyhe8.png" alt="imagen"><br><br>  Sobresale un LStat limpio, que en su interior consta de dos partes: almacenamiento y env√≠o.  Cuando recopilamos un evento, no lo enviamos de inmediato.  De lo contrario, habr√≠a demasiados eventos y solicitudes, lo que no es muy conveniente.  Por lo tanto, ponemos todo en nuestra peque√±a base de datos SQLite, donde almacenamos todo.  Luego, en algunos intervalos, nuestra capa de red extrae los datos de la base de datos y los env√≠a. <br><br>  Despu√©s de recibir la confirmaci√≥n del servidor de que los eventos han llegado, borramos nuestra base de datos.  Este proceso ocurre regularmente.  Gracias a esto, nuestra base no crece y garantizamos la entrega de todos los eventos.  Si por alguna raz√≥n el evento no ha llegado, se almacenar√° en nuestra base de datos hasta que se reciba una respuesta del servidor. <br><br><h2>  Coleccionistas </h2><br>  Como dije anteriormente, tenemos 7 coleccionistas.  Consisten en tales m√©todos: anotaci√≥n personalizada, EventHandler y AppStartEvent.  ¬øQu√© crees que sigue este evento? <br><img src="https://habrastorage.org/webt/_d/tw/lo/_dtwloqivw9wcguv-egiwjznvje.png" alt="imagen"><br><br>  Por supuesto, este es un comienzo en fr√≠o para la aplicaci√≥n.  Y lo principal aqu√≠ es que tenemos una clase AppStartEvent que hereda de alguna interfaz de eventos.  Y por qu√© necesitamos esto, lo contar√© un poco m√°s tarde. <br><br>  Como va  Aqu√≠ es donde comienza el golpe, el ardor y la reflexi√≥n. <br><img src="https://habrastorage.org/webt/2t/cl/4y/2tcl4yjenftx0thk3plkagyrh4k.png" alt="imagen"><br><br>  Primero revisamos todos nuestros 7 coleccionistas.  Luego sacamos la clase Java y collectorName, que necesitamos m√°s tarde para el almacenamiento. <br><br>  Adem√°s, de esta clase de Java, sacamos todos nuestros m√©todos que est√°n en este c√≥digo.  Ahora tenemos que verificar y asegurarnos de que nuestro m√©todo sea un m√©todo de seguimiento de eventos que ser√° responsable del almacenamiento.  Para hacer esto, tenemos varios par√°metros: el primero es que tenemos la anotaci√≥n @EventHandler, no tenemos una lista vac√≠a de par√°metros y alg√∫n evento llega a la entrada. <br><br>  Se cumplen todas las condiciones, por lo que podemos suponer que esta funci√≥n ser√° un evento con nosotros.  Simplemente lo envuelvo en un contenedor y lo env√≠o a nuestra colecci√≥n. <br><br><h2>  La reflexi√≥n no siempre es mala. </h2><br>  S√≠, muchos de ustedes dir√°n que la reflexi√≥n es mala, lenta, terrible. <br><img src="https://habrastorage.org/webt/cm/zz/k4/cmzzk4pcnh35oztvvtj7iglwc5a.png" alt="imagen"><br>  Para empezar, puede ser lento o r√°pido.  Existen m√©todos como getFields, getConstructors que funcionan muy r√°pidamente en relaci√≥n con el resto de la reflexi√≥n.  Y hay, por ejemplo, Constructor newInstance, que funciona muy lentamente.  Por la palabra "lento" me refiero a la diferencia entre las columnas izquierda y derecha en la tabla de arriba por varios √≥rdenes de magnitud (aproximadamente una diferencia de cien veces).  Por lo tanto, si comprende lo que est√° haciendo y sabe de antemano para qu√© necesita estar preparado, entonces no todo es tan aterrador. <br><br>  <b>Estamos sacando m√°s de 500 m√©todos de 7 clases</b> .  Y lo hacemos solo una vez por sesi√≥n.  El tiempo necesario para completar un pasaje es de 40 milisegundos.  Esto es menos de 3 cuadros (en la etapa de pantalla de bienvenida).  Y estaba lejos de ser un dispositivo de gama alta, sino un simple NTC en Android 6, que ha existido durante muchos a√±os. <br><br>  Por supuesto, que en un dispositivo de gama alta todo funcionar√° m√°s r√°pido.  Y si hablamos de tel√©fonos chinos antiguos, entonces el tiempo que pase all√≠ ser√° de 100 milisegundos condicionales.  Los usuarios de estos tel√©fonos ya est√°n acostumbrados al hecho de que todo funciona lentamente para ellos, por lo que son profundamente indiferentes a 40 milisegundos o 100 all√≠. ¬øCu√°l es la diferencia?  Todav√≠a se ralentizan :) <br><br>  Y ahora la pregunta principal: ¬øc√≥mo implementar an√°lisis para no romper la arquitectura? <br><br><h2>  Arquitecto </h2><br>  Nuestra aplicaci√≥n usa MVP. <br><img src="https://habrastorage.org/webt/pi/dm/ft/pidmft4pgrgukv_lirindko4qu4.png" alt="imagen"><br><br>  Este es nuestro tipo de esencia divina, que "vive" en ApplicationScope y se inyecta exactamente donde la necesitamos.  Por ejemplo, necesitamos depositar en Click ().  Para no romper la arquitectura, no reenviaremos el evento desde la capa Vista al Presentador, para que luego vaya a alg√∫n lado.  En cambio, hacemos todo directamente desde la Vista y pasamos la pista al Administrador de an√°lisis. <br><br>  Y ahora un poco sobre enviar.  En AnalyticsManager se destaca un m√©todo: este es el m√©todo de seguimiento, que acepta cualquier clase de evento como entrada.  Y luego sucede la magia negra. <br><br><img src="https://habrastorage.org/webt/em/pi/kj/empikjusbjqotluav-_aclnwx94.png" alt="imagen"><br><br>  Este m√©todo es capaz de resolver todos nuestros problemas. <br><br>  En primer lugar, ayudar√° a <b>depositar en varios sistemas diferentes</b> .  Los controladores son todos nuestros eventos que alguna vez se recopilar√°n.  A continuaci√≥n, buscamos el m√©todo deseado aqu√≠.  En consecuencia, si tenemos un evento de pista escrito, por ejemplo, en 4 recopiladores, se almacenar√° en 4 copias.  Es decir, en 4 pasadas del ciclo lo encontraremos y lo enviaremos a los 4 sistemas con los par√°metros correspondientes. <br><br>  En segundo lugar, <b>ayuda a resolver el problema con eventos √∫nicos</b> .  Estos son eventos que se deben prometer estrictamente 1 vez para todo el ciclo de la aplicaci√≥n.  Marque una vez, la variable booleana habitual.  Si decimos que se trata de un evento √∫nico, simplemente lo eliminamos de la colecci√≥n.  ¬øQu√© sucede despu√©s si intentamos empe√±arlo nuevamente?  Obviamente, simplemente no lo encontraremos en esta colecci√≥n.  Puedes intentar dispararte en el pie tanto como quieras mientras contin√∫as escribiendo analyticsManager.track (AppStartEvent ()), todav√≠a se ejecutar√° una vez y no habr√° m√°s. <br><br><h2>  ¬øCu√°l es el beneficio? </h2><br>  1. <b>No rompemos la arquitectura de nuestra aplicaci√≥n</b> , ya que AnalyticsManager se encuentra y funciona fuera de la arquitectura.  Esto nos permite incrustarlo en cualquier parte de la aplicaci√≥n. <br><br>  2. <b>Le permite recopilar cualquier evento en una l√≠nea</b> en cualquier n√∫mero de sistemas de an√°lisis.  Para hacer esto, simplemente escribimos: analyticsManager.track (Event ()).  Porque entonces √©l mismo resuelve d√≥nde, en qu√© cantidad, con qu√© par√°metros, cu√°ndo, etc. <br><br>  3. <b>Resuelve el problema de los "eventos √∫nicos"</b> .  Ahora no necesitamos hacer varios tipos de controles.  Una vez enviado, eliminado, y no volveremos a verlo. <br><br>  4. <b>Resuelve el problema de recopilar el mismo elemento en diferentes sistemas</b> .  Debido al hecho de que escribimos todo en diferentes coleccionistas, fue a diferentes coleccionistas.  Por lo tanto, no tiene que recurrir a gestos innecesarios.  En mi opini√≥n, esto es maravilloso. <br><br><h2>  Prueba ... </h2><br>  Probamos manualmente.  ¬øPor qu√© no automatizar, preguntas?  Y luego resulta una cosa triste. <br><br>  En primer lugar, desafortunadamente, normalmente no cubrir√° esto con una prueba unitaria.  Debido a que la mayor√≠a de los problemas con los eventos en an√°lisis no surgen debido al hecho de que algunos de los par√°metros que no reuni√≥.  En mi experiencia personal, el 90% de los problemas surgen porque no enviaste el evento a donde se supon√≠a que deb√≠a ir.  Tales casos solo pueden detectarse con pruebas de IU, que a√∫n no hemos escrito para todo esto. <br><br>  Y en segundo lugar, por el momento descansamos un poco en el hecho de que los analistas describen los eventos en un formato bastante estricto (en confluencia), pero este formato no es un formato de especificaci√≥n estricto, como Swagger.  En consecuencia, hay ligeras discrepancias, hay duplicados (aunque en este caso, a menudo solo se hace un enlace a otra p√°gina).  Hasta ahora, esto nos limita en las posibilidades de automatizaci√≥n de las pruebas anal√≠ticas.  Pero estamos trabajando en eso. <br><br><h2>  Conclusiones </h2><br>  ¬øQu√© m√°s se puede hacer con esta decisi√≥n? <br><br>  1. <b>Escribir autotests para an√°lisis</b> .  Esto requerir√° mucho trabajo preparatorio.  Pero no se puede decir que esto es imposible. <br><br>  2. Los m√©todos de seguimiento m√°s-menos son bastante similares.  En cada uno, generamos algunos par√°metros "universales" que todos necesitamos.  Y solo recolecta el mapa de valores.  En general, se podr√≠a <b>escribir un complemento o una utilidad</b> .  No importa  Lo principal es que ella genera un evento de seguimiento para las clases respectivas. <br><br>  Pero aqu√≠ puede surgir un peque√±o problema si los eventos comienzan a desaparecer de manera un poco diferente (por ejemplo, para diferentes sistemas de an√°lisis).  Debido a esto, no todo se puede resolver adecuadamente.  Y adem√°s, no quiero producir generaci√≥n de c√≥digo innecesaria en un proyecto, que hay tantos en muchos proyectos en Android (hola Dagger, Moksi y otros que trabajan en codegen). <br><br>  3. <b>Integraci√≥n de la aplicaci√≥n con especificaciones de analistas</b> .  Probablemente, este es un sue√±o demasiado trascendental, pero a√∫n as√≠ ... Realmente nos gustar√≠a que nuestros analistas escribieran en un formato estricto, y pudi√©ramos analizar sus obras de arte e integrarlas.  Entonces vendr√≠a la paz y la armon√≠a.  Todos ser√≠an felices :) <br><br>  Entonces, ¬øqu√© quiero decir con todo esto? <br><br>  Primero, todav√≠a se necesita an√°lisis.  Porque le permite ahorrar dinero, recursos y esfuerzo.  Esto le evita escribir c√≥digo innecesario o eliminar c√≥digo que parece no ser antiguo, pero que todav√≠a no es necesario aqu√≠.  Menos legado siempre es bueno. <br><br>  En segundo lugar, la reflexi√≥n no siempre es mala.  Si, es lento.  Pero a veces perdemos muy poco en rendimiento, pero obtenemos mucho, por ejemplo, en el campo del desarrollo y el manejo de errores. <br><br>  Y en tercer lugar, estamos colocando el an√°lisis en la etapa de planificaci√≥n de caracter√≠sticas.  Debido a esto, podemos negociar con analistas mucho antes, llegando a un compromiso.  Y tambi√©n nos da la oportunidad de estimar el tiempo requerido para escribir an√°lisis por adelantado. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/469761/">https://habr.com/ru/post/469761/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../469747/index.html">Resumen de eventos de TI de octubre (primera parte)</a></li>
<li><a href="../469749/index.html">Mejorando UX con la tecla Tab</a></li>
<li><a href="../469753/index.html">Los 9 mejores hallazgos de c√≥digo abierto para septiembre de 2019</a></li>
<li><a href="../469755/index.html">C√≥mo ser un buen programador</a></li>
<li><a href="../469757/index.html">Tecnolog√≠a AR al servicio de la pintura.</a></li>
<li><a href="../469765/index.html">Los elogios se relajan y la cr√≠tica ofende: c√≥mo evaluar el trabajo de otra persona, para que todos est√©n bien</a></li>
<li><a href="../469767/index.html">C√≥mo elegimos ServiceDesk. Parte 1</a></li>
<li><a href="../469771/index.html">Crea una aplicaci√≥n de Android. Tarea con un asterisco</a></li>
<li><a href="../469775/index.html">Dibujar un sonido</a></li>
<li><a href="../469779/index.html">Meetup de Outdoor Future London Academy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>