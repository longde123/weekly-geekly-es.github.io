<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>   驴Por qu茅 los elementos React tienen una propiedad $ typeof?   猴</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sobre el mecanismo React para evitar la posibilidad de inyecci贸n JSON para XSS y sobre c贸mo evitar vulnerabilidades comunes. 
 


 Puede pensar que es...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>驴Por qu茅 los elementos React tienen una propiedad $$ typeof?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/432350/"><p>  <em>Sobre el mecanismo React para evitar la posibilidad de inyecci贸n JSON para XSS y sobre c贸mo evitar vulnerabilidades comunes.</em> <em><br></em> </p><a name="habracut"></a><br><p>  Puede pensar que est谩 escribiendo JSX: </p><br><pre><code class="javascript hljs">&lt;marquee bgcolor=<span class="hljs-string"><span class="hljs-string">"#ffa7c4"</span></span>&gt;hi&lt;<span class="hljs-regexp"><span class="hljs-regexp">/marquee&gt;</span></span></code> </pre> <br><p>  Pero en realidad est谩s llamando a la funci贸n: </p><br><pre> <code class="javascript hljs">React.createElement( <span class="hljs-comment"><span class="hljs-comment">/* type */</span></span> <span class="hljs-string"><span class="hljs-string">'marquee'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* props */</span></span> { <span class="hljs-attr"><span class="hljs-attr">bgcolor</span></span>: <span class="hljs-string"><span class="hljs-string">'#ffa7c4'</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* children */</span></span> <span class="hljs-string"><span class="hljs-string">'hi'</span></span> )</code> </pre> <br><p>  Y esta funci贸n le devuelve un objeto normal llamado elemento React.  En consecuencia, despu茅s de atravesar todos los componentes, se obtiene un 谩rbol de objetos similares: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'marquee'</span></span>, <span class="hljs-attr"><span class="hljs-attr">props</span></span>: { <span class="hljs-attr"><span class="hljs-attr">bgcolor</span></span>: <span class="hljs-string"><span class="hljs-string">'#ffa7c4'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: <span class="hljs-string"><span class="hljs-string">'hi'</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">key</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">ref</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">$$typeof</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.for(<span class="hljs-string"><span class="hljs-string">'react.element'</span></span>), }</code> </pre> <br><p>  Si utiliz贸 React anteriormente, puede estar familiarizado con los campos tipo, accesorios, clave y referencia.  <strong>Pero, 驴cu谩l es el tipo de propiedad <code>$$typeof</code> ?</strong>  <strong>驴Y por qu茅 tiene el s铆mbolo <code>Symbol()</code> como su valor?</strong> </p><br><hr><br><p>  Antes de que las bibliotecas de IU se hicieran populares, para mostrar la entrada del cliente en el c贸digo de la aplicaci贸n, se gener贸 una l铆nea que conten铆a marcado HTML y se insert贸 directamente en el DOM, a trav茅s de innerHTML: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> messageEl = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'message'</span></span>); messageEl.innerHTML = <span class="hljs-string"><span class="hljs-string">'&lt;p&gt;'</span></span> + message.text + <span class="hljs-string"><span class="hljs-string">'&lt;/p&gt;'</span></span>;</code> </pre> <br><p>  Este mecanismo funciona bien a menos que <code>message.text</code> est茅 configurado en <code>&lt;img src onerror="stealYourPassword()"&gt;</code> .  Por consiguiente, concluimos que <strong>no necesita interpretar todas las entradas del cliente como marcado HTML.</strong> </p><br><p>  Para protegerse contra tales ataques, puede usar API seguras como <code>document.createTextNode()</code> o <code>textContent</code> , que no interpretan el texto.  Y como medida adicional, escapa de las cadenas reemplazando los caracteres potencialmente peligrosos como <code>&lt;</code> , <code>&gt;</code> por otros seguros. </p><br><p>  Sin embargo, la probabilidad de error es alta, ya que es dif铆cil rastrear todos los lugares donde utiliza la informaci贸n registrada por el usuario en su p谩gina.  Esta es la raz贸n por la cual las bibliotecas modernas como React funcionan de manera segura con cualquier texto predeterminado: </p><br><pre> <code class="javascript hljs">&lt;p&gt; {message.text} &lt;<span class="hljs-regexp"><span class="hljs-regexp">/p&gt;</span></span></code> </pre> <br><p>  Si <code>message.text</code> es una cadena maliciosa con una <code>&lt;img&gt;</code> , no se convertir谩 en una <code>&lt;img&gt;</code> real.  React escapa del contenido de texto y luego lo agrega al DOM.  Por lo tanto, en lugar de ver la <code>&lt;img&gt;</code> , simplemente ve su marcado como una cadena. </p><br><p>  Para mostrar HTML arbitrario dentro de un elemento React, debe usar la siguiente construcci贸n: <code>dangerouslySetInnerHTML={{ __html: message.text }}</code> .  <strong>El dise帽o es intencionalmente inc贸modo.</strong>  Debido a su absurdo, se vuelve m谩s notable y llama la atenci贸n al ver el c贸digo. </p><br><hr><br><p>  <strong>驴Esto significa que React es completamente seguro?</strong>  <strong>No</strong>  Existen muchos m茅todos de ataque conocidos basados en HTML y DOM.  Los atributos de etiqueta merecen especial atenci贸n.  Por ejemplo, si escribe <code>&lt;a href={user.website}&gt;</code> , puede sustituir un c贸digo malicioso como un enlace de texto: <code>'javascript: stealYourPassword()'</code> . </p><br><p>  En la mayor铆a de los casos, la presencia de vulnerabilidades en el lado del cliente es el resultado de problemas en el lado del servidor, y debe solucionarse en primer lugar. </p><br><p>  Sin embargo, la visualizaci贸n segura de contenido de texto personalizado es una primera l铆nea de defensa razonable que refleja muchos ataques potenciales. </p><br><p>  Basado en consideraciones previas, podemos concluir que el siguiente c贸digo deber铆a ser completamente seguro: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   &lt;p&gt; {message.text} &lt;/p&gt;</span></span></code> </pre> <br><p>  <strong>Pero ese tampoco es el caso.</strong>  Y aqu铆 nos acercamos a explicar la presencia de <code>$$typeof</code> en el elemento React. </p><br><hr><br><p>  Como explicamos anteriormente, los elementos React son objetos simples: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'marquee'</span></span>, <span class="hljs-attr"><span class="hljs-attr">props</span></span>: { <span class="hljs-attr"><span class="hljs-attr">bgcolor</span></span>: <span class="hljs-string"><span class="hljs-string">'#ffa7c4'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: <span class="hljs-string"><span class="hljs-string">'hi'</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">key</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">ref</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">$$typeof</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.for(<span class="hljs-string"><span class="hljs-string">'react.element'</span></span>), }</code> </pre> <br><p>  Por lo general, un elemento React se crea llamando a la funci贸n <code>React.createElement()</code> , pero puede crearlo inmediatamente con un literal, como acabo de hacer anteriormente. </p><br><p>  Supongamos que almacenamos en el servidor una cadena que el usuario nos envi贸 previamente y cada vez que la mostramos en el lado del cliente.  Pero alguien, en lugar de una cadena, nos envi贸 JSON: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> expectedTextButGotJSON = { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'div'</span></span>, <span class="hljs-attr"><span class="hljs-attr">props</span></span>: { <span class="hljs-attr"><span class="hljs-attr">dangerouslySetInnerHTML</span></span>: { <span class="hljs-attr"><span class="hljs-attr">__html</span></span>: <span class="hljs-string"><span class="hljs-string">'/*     */'</span></span> }, }, <span class="hljs-comment"><span class="hljs-comment">// ... }; let message = { text: expectedTextButGotJSON }; //    React 0.13 &lt;p&gt; {message.text} &lt;/p&gt;</span></span></code> </pre> <br><p>  Es decir, de repente, en lugar de la cadena esperada, el valor de la variable <code>expectedTextButGotJSON</code> result贸 ser JSON.  Que ser谩 procesado por React como un literal y, por lo tanto, ejecutar谩 c贸digo malicioso. </p><br><p>  React 0.13 es vulnerable a un ataque tipo XSS, pero a partir de la versi贸n 0.14, cada elemento est谩 marcado con un s铆mbolo: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'marquee'</span></span>, <span class="hljs-attr"><span class="hljs-attr">props</span></span>: { <span class="hljs-attr"><span class="hljs-attr">bgcolor</span></span>: <span class="hljs-string"><span class="hljs-string">'#ffa7c4'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: <span class="hljs-string"><span class="hljs-string">'hi'</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">key</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">ref</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">$$typeof</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.for(<span class="hljs-string"><span class="hljs-string">'react.element'</span></span>), }</code> </pre> <br><p>  Dicha protecci贸n funciona porque los caracteres no son un valor JSON v谩lido.  Por lo tanto, incluso si el servidor tiene una vulnerabilidad potencial y devuelve JSON en lugar de texto, JSON no puede contener <code>Symbol.for('response.element')</code> .  React comprueba el elemento por <code>element.$$typeof</code> y se niega a procesar el elemento si falta o no es v谩lido. </p><br><p>  La principal ventaja de <code>Symbol.for()</code> es que los s铆mbolos son globales entre contextos porque usan un registro global.  Esto garantiza el mismo valor de retorno incluso en un iframe.  E incluso si hay varias copias de React en la p谩gina, a煤n podr谩n "coincidir" a trav茅s de un solo valor de <code>$$typeof</code> . </p><br><hr><br><p>  驴Qu茅 pasa con los navegadores que no admiten caracteres? </p><br><p>  Por desgracia, no podr谩n implementar la protecci贸n adicional que se discuti贸 anteriormente, pero los elementos React seguir谩n conteniendo la propiedad <code>$$typeof</code> para mantener la coherencia, pero ser谩 solo un n煤mero: <code>0xeac7</code> . </p><br><p>  驴Por qu茅 exactamente <code>0xeac7</code> ?  Porque parece reaccionar. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es432350/">https://habr.com/ru/post/es432350/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es432338/index.html">Robotaxi Waymo One se ha ganado como una red de transporte comercial</a></li>
<li><a href="../es432342/index.html">Camunda BPM Meetup Raiffeisenbank UPD Broadcast</a></li>
<li><a href="../es432344/index.html">Cuatro etapas de desarrollo de ingenieros.</a></li>
<li><a href="../es432346/index.html">Noticias del mundo de OpenStreetMap No. 436 (20/11/2018 - 26/06/2018)</a></li>
<li><a href="../es432348/index.html">Clase magistral: moldeo al vac铆o de pl谩sticos en silicona</a></li>
<li><a href="../es432352/index.html">Profundidades SIEM: correlaciones listas para usar. Parte 3.1. Categorizaci贸n de eventos</a></li>
<li><a href="../es432354/index.html">Las filtraciones de datos m谩s significativas en 2018. Primera parte (enero-junio)</a></li>
<li><a href="../es432356/index.html">C贸mo escribir una excelente fuente de noticias VKontakte en 20 horas</a></li>
<li><a href="../es432360/index.html">El "descendiente" AlphaGo aprendi贸 independientemente a jugar ajedrez, shogi e ir</a></li>
<li><a href="../es432362/index.html">Chang'e 4 - la misi贸n al otro lado de la luna comienza hoy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>