<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¶üèø üë®üèø‚Äçü§ù‚Äçüë®üèª üîá Pr√©chargement en PHP 7.4 üëÖ üëèüèΩ üèÇ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La traduction de cet article a √©t√© pr√©par√©e sp√©cialement pour les √©tudiants du cours Backend PHP Developer . 



 PHP 7.4 ajoute le pr√©chargement, une...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pr√©chargement en PHP 7.4</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/463117/">  <i>La traduction de cet article a √©t√© pr√©par√©e sp√©cialement pour les √©tudiants du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cours Backend PHP Developer</a> .</i> <br><br><img src="https://habrastorage.org/webt/xa/ye/vs/xayevs76f7sr7gyuummrtetx4ym.png"><br><br>  PHP 7.4 ajoute le pr√©chargement, une fonctionnalit√© qui peut consid√©rablement am√©liorer les performances du code. <br><br>  En pr√©charge en bref. <br><br><ul><li>  Pour pr√©charger les fichiers, vous devez √©crire un script PHP distinct. </li><li>  Ce script est ex√©cut√© une fois au d√©marrage du serveur. </li><li>  Tous les fichiers pr√©charg√©s sont disponibles en m√©moire pour toutes les demandes. </li><li>  Les modifications apport√©es au fichier source ne fonctionneront pas tant que vous n'aurez pas red√©marr√© le serveur. </li></ul><br><h4>  Parlons plus en d√©tail de la nouvelle fonctionnalit√©. </h4><a name="habracut"></a><br><h3>  Plus que Opcache </h3><br>  Oui, le pr√©chargement est bas√© sur opcache, mais ce n'est pas exactement la m√™me chose.  Opcache prend les fichiers source PHP, les compile en opcodes, puis enregistre les fichiers compil√©s sur le disque. <br><br>  Les opcodes peuvent √™tre consid√©r√©s comme une repr√©sentation de bas niveau de votre code qui est facilement interpr√©table lors de l'ex√©cution.  Ainsi, opcache vous permet de sauter l'√©tape de traduction des fichiers source en ce dont l'interpr√©teur PHP a r√©ellement besoin au moment de l'ex√©cution.  Des √©conomies notables! <br><br>  Cependant, vous pouvez √©conomiser encore plus.  <code>opcash</code> avec des fichiers <code>opcash</code> ne savent rien des autres fichiers.  Si vous avez la classe A, qui est une extension de la classe B, ils devront toujours √™tre li√©s au moment de l'ex√©cution.  De plus, opcache v√©rifie si les fichiers source ont chang√©, et lors de la d√©tection des modifications invalidera leurs caches. <br><br>  Et ici, la pr√©charge vient √† la rescousse: elle compile non seulement les fichiers source en opcodes, mais relie √©galement les classes, les traits et les interfaces d√©pendants.  Il stocke un tel fragment ¬´compil√©¬ª de code ex√©cutable (c'est-√†-dire du code que l'interpr√©teur PHP peut utiliser) en m√©moire. <br><br>  Lorsqu'une requ√™te arrive sur le serveur, il peut utiliser des parties de la base de code qui a d√©j√† √©t√© charg√©e en m√©moire, sans temps suppl√©mentaire. <br><br><h4>  De quelles ¬´parties de la base de code¬ª parlons-nous? </h4><br><h3>  Pratiquer le pr√©chargement </h3><br>  Pour un pr√©chargement correct, le d√©veloppeur doit indiquer au serveur les fichiers √† t√©l√©charger.  Cela se fait √† l'aide d'un simple script PHP, il n'y a donc rien √† craindre. <br><br>  Rien de compliqu√©. <br><br><ul><li>  Vous fournissez un script de pr√©chargement et un lien vers celui-ci dans votre fichier php.ini en utilisant <code>opcache.preload</code> . </li><li>  Chaque fichier PHP que vous souhaitez pr√©charger doit √™tre transmis √† <code>opcache_compile_file()</code> partir du script de pr√©chargement. </li></ul><br>  Supposons que vous souhaitiez pr√©charger une sorte de cadre.  Que ce soit Laravel.  Dans ce cas, votre script doit regarder tous les fichiers PHP dans le <code>vendor/laravel</code> et les ajouter un √† la fois. <br><br>  Voici comment vous pouvez inclure ce script dans php.ini: <br><br><pre> <code class="php hljs">opcache.preload=/path/to/project/preload.php</code> </pre> <br><br>  Et voici un exemple d'impl√©mentation: <br><br><pre> <code class="php hljs">$files = <span class="hljs-comment"><span class="hljs-comment">/*  ,      */</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($files <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $file) { opcache_compile_file($file); }</code> </pre> <br>  Au lieu de <code>opcache_compile_file</code> vous pouvez utiliser <code>include</code> .  Cependant, il semble qu'il y ait eu un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bogue ici</a> , car au moment de l'√©criture, la deuxi√®me option ne fonctionnait pas. <br><br><h4>  Avertissement que vous ne pouvez pas pr√©charger une classe non li√©e </h4><br>  Il y a un avertissement <i>Vous ne pouvez pas pr√©charger la classe non li√©e</i> ?  Le fait est qu'avant de pr√©charger les fichiers, vous devez √©galement pr√©charger leurs objets d√©pendants - interfaces, traits et classes parent. <br><br>  Si vous rencontrez des probl√®mes avec les d√©pendances de classe, vous en serez averti lors du d√©marrage du serveur: <br><br><pre> <code class="php hljs">Can<span class="hljs-string"><span class="hljs-string">'t preload unlinked class Illuminate\Database\Query\JoinClause: Unknown parent Illuminate\Database\Query\Builder</span></span></code> </pre> <br>  Notez que <code>opcache_compile_file()</code> uniquement le fichier, mais ne l'ex√©cutera pas.  Cela signifie que si une classe a des d√©pendances qui n'ont pas √©t√© pr√©charg√©es, la classe elle-m√™me ne peut pas √™tre pr√©charg√©e. <br><br>  Ce n'est pas critique: le serveur fonctionnera comme d'habitude, mais vous n'aurez pas √† votre disposition tous les fichiers que vous vouliez pr√©charger. <br><br>  C'est pourquoi vous devez s√©lectionner soigneusement les fichiers √† pr√©-charger afin d'√©viter les probl√®mes de d√©pendance.  Le faire manuellement est une t√¢che ingrate et fastidieuse, les d√©veloppeurs travaillent donc d√©j√† sur des solutions automatis√©es. <br><br><h3>  Prise en charge des compositeurs </h3><br>  La solution automatis√©e la plus prometteuse est en cours de pr√©paration par les d√©veloppeurs de compositeurs, qui est d√©j√† utilis√©e dans la plupart des projets PHP modernes. <br><br>  Maintenant, les gars travaillent sur la possibilit√© de configurer la pr√©charge dans <code>composer.json</code> , qui √† son tour va g√©n√©rer un fichier de pr√©charge √† votre place.  Comme le pr√©chargement lui-m√™me, cette fonctionnalit√© est toujours en cours de d√©veloppement.  Vous pouvez suivre l'√©volution des √©v√©nements <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br>  Heureusement, vous n'avez pas √† configurer manuellement les fichiers de pr√©chargement si vous ne le souhaitez pas - composer peut le faire pour vous. <br><br><h3>  Configuration requise pour le serveur </h3><br>  Il y a deux autres points importants qu'un d√©veloppeur doit garder √† l'esprit lors de l'utilisation de la pr√©charge. <br><br>  Vous savez d√©j√† que vous devez cr√©er une entr√©e dans <code>php.ini</code> pour que la pr√©charge fonctionne.  Cela signifie que si vous utilisez l'h√©bergement mutualis√©, vous ne pourrez pas configurer PHP comme vous le souhaitez. <br><br>  En pratique, vous aurez besoin d'un serveur d√©di√© (virtuel) pour optimiser les fichiers pr√©charg√©s pour un seul projet.  Gardez cela √† l'esprit. <br><br>  Souvenez-vous √©galement que vous devrez red√©marrer le serveur (si vous utilisez <code>php-fpm</code> , cela suffit) chaque fois que vous souhaitez recharger des fichiers en m√©moire.  Pour la plupart, cela est √©vident, mais il ne sera pas superflu de le rappeler. <br><br><h3>  Performances </h3><br>  Maintenant, pour la question la plus importante: le pr√©chargement am√©liore-t-il vraiment les performances? <br><br>  Bien s√ªr!  Ben Morel a partag√© les r√©sultats des tests comparatifs, qui peuvent √™tre trouv√©s dans le m√™me <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sujet sur le compositeur</a> , que nous avons mentionn√© ci-dessus. <br><br>  Et aussi, c'est int√©ressant.  Si vous le souhaitez, vous pouvez pr√©charger uniquement les soi-disant <code>hot classes</code> - classes qui sont souvent utilis√©es dans votre base de code.  Les tests de Ben Morel montrent que le chargement d'environ 100 de ces classes offre une augmentation des performances plus √©lev√©e que le pr√©chargement de tout √† la fois.  Dans le premier cas, la productivit√© augmente de 17%, dans le second - de 13%. <br><br>  Bien s√ªr, le choix des classes pour le pr√©chargement d√©pend du projet sp√©cifique.  Il est sage de commencer par simplement pr√©charger autant que possible.  Si ces quelques pourcentages de diff√©rences de performances sont si importants pour vous, vous devrez contr√¥ler le code lors de l'ex√©cution. <br><br>  Bien entendu, toutes ces op√©rations peuvent √™tre automatis√©es, ce qui est susceptible de se faire √† l'avenir. <br><br>  Maintenant, il est important que la prise en charge de la pr√©charge soit ajout√©e √† <code>composer</code> , ce qui √©limine la n√©cessit√© de cr√©er des fichiers pour elle-m√™me.  Cette fonctionnalit√© est tr√®s facile √† configurer sur le serveur, √† condition qu'elle soit √† votre enti√®re disposition. <br><br><hr><br>  Allez-vous utiliser le pr√©chargement dans la nouvelle version de PHP 7.4?  Des pens√©es ou des commentaires?  Envoyez-moi un courriel sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Twitter</a> ou par <a href="">courriel</a> . <br><br>  Traditionnellement, nous attendons vos commentaires et avantages si vous trouvez l'article int√©ressant :-) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr463117/">https://habr.com/ru/post/fr463117/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr463101/index.html">Gestion de centaines de serveurs pour les tests de charge: mise √† l'√©chelle automatique, surveillance personnalis√©e, culture DevOps</a></li>
<li><a href="../fr463105/index.html">Mon quatri√®me jour avec Haiku: probl√®mes d'installation et de d√©marrage</a></li>
<li><a href="../fr463107/index.html">ShIoTiny: petite automatisation, Internet des objets, ou ¬´six mois avant les vacances¬ª</a></li>
<li><a href="../fr463113/index.html">Contr√¥le de version des donn√©es et des mod√®les dans la rencontre Computer Vision</a></li>
<li><a href="../fr463115/index.html">Le probl√®me des portes dans la conception des tireurs</a></li>
<li><a href="../fr463121/index.html">Nous mangeons l'√©l√©phant par parties. Exemple de strat√©gie de surveillance de l'int√©grit√© des applications</a></li>
<li><a href="../fr463123/index.html">Biblioth√®que de g√©n√©rateur de code assembleur pour microcontr√¥leurs AVR. 3e partie</a></li>
<li><a href="../fr463125/index.html">OOP en images</a></li>
<li><a href="../fr463127/index.html">Surveillance UPS. Deuxi√®me partie - Automatiser l'analyse</a></li>
<li><a href="../fr463135/index.html">Dans quels pays est-il rentable d'enregistrer des soci√©t√©s informatiques en 2019?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>