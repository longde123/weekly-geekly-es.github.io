<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï∏Ô∏è üñïüèø üó∫Ô∏è Le temps est venu pour Java 12! Examen des JEP chauds üèòÔ∏è üë§ ü§∂üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Six mois se sont √©coul√©s, ce qui signifie qu'il est temps d'installer de nouveaux Java ! Ce fut un long voyage et peu atteignirent la fin. Les lignes ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Le temps est venu pour Java 12! Examen des JEP chauds</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/444434/"><p><img src="https://habrastorage.org/webt/k8/rn/qa/k8rnqagstd_wu4hezoj_bnjzfem.png"></p><br><p>  Six mois se sont √©coul√©s, ce qui signifie qu'il est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">temps d'installer de nouveaux Java</a> !  Ce fut un long voyage et peu atteignirent la fin.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les lignes brutes</a> sont tomb√©es des JEP int√©ressants, mais nous parlerons du reste sous la coupe. </p><a name="habracut"></a><br><h1 id="kak-vsyo-proishodit">  Comment √ßa se passe </h1><br><p>  La sortie de la nouvelle version de Java se d√©roule selon le nouveau cycle de sortie ¬´acc√©l√©r√©¬ª d'une dur√©e d'environ six mois.  Les dates exactes sont d√©finies sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la page du projet</a> .  Il y a eu plusieurs phases principales pour JDK 12: </p><br><ul><li>  13/12/2018 - La premi√®re phase du ralentissement (en ce moment, un fork est r√©alis√© √† partir de la branche principale du r√©f√©rentiel); </li><li>  2019/01/17 - La deuxi√®me phase du ralentissement (achever tout ce qui est possible); </li><li>  07/02/2019 - Release candidate (seuls les bugs les plus importants sont corrig√©s); </li><li>  2019/03/19 - Sortie, disponibilit√© g√©n√©rale.  <strong>&lt;- vous √™tes ici</strong> </li></ul><br><p>  Qu'avons-nous de ce calendrier?  Oui, en fait, rien - nous venons d'arriver √† la ligne d'arriv√©e, et nous regardons les amoureux de l'h√©ritage du haut du tout nouveau JDK 12. </p><br><h1 id="bagi-panika-vse-na-dno">  Bugs!  Panique!  Tout en bas! </h1><br><p><img src="https://habrastorage.org/webt/9j/jw/j8/9jjwj87t8vtlqyiv4zmox4xljem.jpeg"></p><br><p>  Lorsqu'une nouvelle version non LTS sort, g√©n√©ralement tout le monde s'en fout des nouvelles fonctionnalit√©s.  C'est plus int√©ressant si tout s'√©croule en enfer. </p><br><p>  Bien s√ªr, il y a beaucoup de bugs, mais pas dans JDK 12 :) A en juger par le jir, tout est normal: </p><br><p><img src="https://habrastorage.org/webt/st/yr/cr/styrcrroe8hobgqc6jpxgv5hknw.jpeg"></p><br><p>  Je citerai la demande pour que vous compreniez <em>exactement</em> ce qu'est la "norme": </p><br><pre><code class="plaintext hljs">project = JDK AND issuetype = Bug AND status in (Open, "In Progress", New) AND priority in (P1) AND (fixVersion in (12) OR fixVersion is EMPTY AND affectedVersion in (12) AND affectedVersion not in regexVersion("11.*", "10.*", "9.*", "8.*", "7.*", "6.*")) AND (labels is EMPTY OR labels not in (jdk12-defer-request, noreg-demo, noreg-doc, noreg-self)) AND (component not in (docs, globalization, infrastructure) OR component = infrastructure AND subcomponent = build) AND reporter != "Shadow Bug" ORDER BY priority, component, subcomponent, assignee</code> </pre> <br><p>  Bien s√ªr, <em>en g√©n√©ral, les</em> bugs ont leur place, ils n'iront nulle part dans un projet aussi √©norme.  Il est seulement affirm√© que pour l'instant, les bogues P1 n'ont pas √©t√© remarqu√©s. </p><br><p>  Une communication plus formelle avec les bogues est d√©clar√©e dans un document sp√©cial, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JEP 3: JDK Release Process</a> , qui appartient √† notre intendant immortel sur les vagues turbulentes de l'oc√©an Java - Mark Reinhold. </p><br><p>  Et en particulier, il vaut la peine de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©terrer un paragraphe</a> racontant <del>  qui est √† bl√¢mer et que faire </del>  comment transf√©rer des billets si vous n'avez pas le temps pour la 12e version.  Il est n√©cessaire de mettre dans le bugtracker l'√©tiquette <code>jdk$N-defer-request</code> dans laquelle N indique la version √† partir de laquelle vous souhaitez transf√©rer, et de laisser un commentaire, dont la premi√®re ligne est <em>Deferral Request</em> .  En outre, l'examen de toutes ces demandes est effectu√© par les responsables des domaines et projets respectifs. </p><br><p>  Les probl√®mes de passage de TCK ne peuvent pas √™tre ignor√©s de cette fa√ßon - il est garanti que Java reste Java, et non quelque chose comme une grenouille.  L' <code>jdk$N-defer-request label</code> ne dispara√Æt jamais.  C'est int√©ressant ce qu'ils font avec les gens qui violent la r√®gle de ne pas supprimer les √©tiquettes - je sugg√®re de nourrir les cobayes. </p><br><p>  Cependant, de cette fa√ßon, vous pouvez voir combien de bogues ont √©t√© port√©s sur JDK 13. Essayons cette requ√™te: </p><br><pre> <code class="plaintext hljs">project = JDK AND issuetype = Bug AND status in (Open, "In Progress", New) AND (labels in (jdk12-defer-request) AND labels not in (noreg-demo, noreg-doc, noreg-self)) AND (component not in (docs, globalization, infrastructure) OR component = infrastructure AND subcomponent = build) AND reporter != "Shadow Bug" ORDER BY priority, component, subcomponent, assignee</code> </pre> <br><p>  Seulement 1 pi√®ce, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JDK-8216039</a> : "TLS avec BC et RSASSA-PSS casse ECDHServerKeyExchange".  Ce n'est pas √©pais.  Si cet argument n'aide toujours pas, alors, en tant qu'avocat, je recommande d'essayer un s√©datif. </p><br><h1 id="i-chto-zhe-v-suhom-ostatke">  Et quel est le r√©sultat net? </h1><br><p><img src="https://habrastorage.org/webt/ef/uf/mx/efufmx-2rdphagrcihuscp0cswo.png"></p><br><p>  Il est clair que la plupart des fonctionnalit√©s n'affectent pas les utilisateurs (programmeurs Java), mais les d√©veloppeurs d'OpenJDK lui-m√™me.  Par cons√©quent, juste au cas o√π, je divise les fonctionnalit√©s en <strong>externes</strong> et <strong>internes</strong> .  Vous pouvez sauter les internes, mais je suis offens√©, j'ai √©crit tellement de texte. </p><br><p>  <strong>189: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Shenandoah: un ramasse-miettes √† faible pause (exp√©rimental)</a></strong> </p><br><p>  <strong>Fonction externe</strong> .  En bref, les gens n'aiment pas cela lorsque Java ralentit, surtout si le SLA n√©cessite une r√©activit√© de l'ordre de 10 √† 500 millisecondes.  Nous avons maintenant un GC low-punch gratuit qui essaie de travailler plus pr√®s du bord gauche de cette plage.  Le compromis est que nous √©changeons le CPU et la RAM pour r√©duire la latence.  Les phases de marquage et de compactage de la hanche fonctionnent en parall√®le avec les threads d'application en direct.  Les petites pauses restantes sont dues au fait que vous devez toujours rechercher et mettre √† jour les racines du graphique des objets. </p><br><p>  Si rien de ce qui pr√©c√®de n'a de sens pour vous - cela n'a pas d'importance, Shenandoah <em>fonctionne simplement</em> , ind√©pendamment de la compr√©hension ou de la non-compr√©hension des processus sous-jacents. </p><br><p>  Alexei Shipilev, Christina Flood et Roman Kennke y travaillent - vous devez vous efforcer de ne pas conna√Ætre ces gens.  Si vous comprenez g√©n√©ralement le fonctionnement de GC mais n‚Äôimaginez pas ce qu‚Äôun d√©veloppeur peut faire l√†-bas, je vous recommande de regarder la merveilleuse traduction du merveilleux article de Leshina <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´Homemade Garbage Collector for OpenJDK¬ª</a> ou la s√©rie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JVM Anatomy Quarks</a> .  C'est <strong>tr√®s int√©ressant</strong> . </p><br><blockquote>  <strong>Extr√™mement important.</strong>  Oracle a d√©cid√© de ne pas exp√©dier Sheandoah avec aucune de ses versions de version - ni celle sur jdk.java.net ni celle sur oracle.com.  √âtant donn√© que Shenandoah est l'une des caract√©ristiques les plus importantes du JDK 12, il vaut la peine d'installer un autre assemblage officiel, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">par exemple, d'Azul</a> . </blockquote><br><hr><br><p>  <strong>230: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Microbenchmark Suite</a></strong> </p><br><p>  <strong>Caract√©ristique int√©rieure</strong> .  Si vous avez d√©j√† essay√© d'√©crire des microbenchmarks, vous savez que cela se fait sur JMH.  JMH est un framework pour cr√©er, assembler, lancer et analyser des microbenchmarks pour Java et d'autres langages JVM, vous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">savez</a> vous- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">m√™me qui l'a</a> √©crit (toutes les correspondances sont al√©atoires).  Malheureusement, tout ce qui se fait dans le monde des applications "normales" ne peut pas √™tre appliqu√© √† l'int√©rieur du JDK.  Par exemple, il est peu probable que nous y voyions du code Spring Framework normal. </p><br><p>  Heureusement, √† partir de la version 12, vous pouvez utiliser au moins JMH, et il existe d√©j√† un ensemble de tests qui y sont √©crits.  Vous pouvez le voir dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>jdk/jdk/test/micro/org/openjdk/bench</code></a> (vous pouvez regarder directement dans le navigateur, ce chemin est un lien). </p><br><p>  Par exemple, voici √† quoi ressemble le <a href="">test GC</a> . </p><br><blockquote>  Permettez-moi de vous rappeler que nous n'avons pas StackOverflow ici, et il est interdit d'utiliser le code du copier-coller, ici et ci-apr√®s, sans lire et observer toutes les licences du <a href="">fichier correspondant</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">du projet OpenJDK</a> en g√©n√©ral, sinon vous obtiendrez facilement les derni√®res chaussettes poursuivies. </blockquote><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@BenchmarkMode</span></span>(Mode.AverageTime) <span class="hljs-meta"><span class="hljs-meta">@OutputTimeUnit</span></span>(TimeUnit.NANOSECONDS) <span class="hljs-meta"><span class="hljs-meta">@State</span></span>(Scope.Thread) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Alloc</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LENGTH = <span class="hljs-number"><span class="hljs-number">400</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ARR_LEN = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> largeLen = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> smalllen = <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Benchmark</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testLargeConstArray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Blackhole bh)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> localArrlen = ARR_LEN; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; LENGTH; i++) { Object[] tmp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object[localArrlen]; bh.consume(tmp); } } <span class="hljs-comment"><span class="hljs-comment">//... }</span></span></code> </pre> <br><hr><br><p>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">325: Changer d'expressions (pr√©version)</a></strong> </p><br><p>  <strong>Fonction externe</strong> .  Cela changera fondamentalement votre approche de l'√©criture de commutateurs sans fin avec une longueur de plus de deux √©crans.  Regardez: </p><br><h3 id="virgin-java-switch-vs-">  Virgin Java Switch vs ... </h3><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> dayNum = -<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (day) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MONDAY: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> FRIDAY: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SUNDAY: dayNum = <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TUESDAY: dayNum = <span class="hljs-number"><span class="hljs-number">7</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> THURSDAY: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SATURDAY: dayNum = <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> WEDNESDAY: dayNum = <span class="hljs-number"><span class="hljs-number">9</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; }</code> </pre> <br><p>  <strong>Pourquoi c'est mauvais</strong> : il y a beaucoup de lettres, vous pouvez sauter la pause (surtout si vous √™tes toxicomane ou malade du TDAH). </p><br><h3 id="-vs-chad-java-swtich-expression">  ... vs Chad Java Swtich Expression! </h3><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> dayNum = <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (day) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MONDAY -&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TUESDAY -&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k = day.toString().length(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = f(k); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> result; } };</code> </pre> <br><p>  <strong>Pourquoi bon</strong> : quelques lettres, s√ªr, pratique, nouvelle fonctionnalit√© cool. </p><br><p>  <strong>Bonus</strong> : si vous √™tes sadique, cela vous donnera la plus grande satisfaction, car des milliers de d√©veloppeurs IDE sont maintenant tourment√©s par le support de cette fonctionnalit√©.  Oui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">lany</a> , oui? <del>  Vous pouvez le rattraper <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">apr√®s le rapport du 6 avril</a> et lui demander gentiment de donner tous les d√©tails sales. </del></p><br><blockquote>  <strong>Ceci est une fonctionnalit√© de pr√©visualisation, cela ne fonctionnera tout simplement pas!</strong>  Lors de la compilation, dans <code>javac</code> vous devez passer les options de ligne de commande <code>--enable-preview --release 12</code> , et pour ex√©cuter via <code>java</code> - uniquement l'indicateur <code>--enable-preview</code> . </blockquote><br><hr><br><p>  <strong>334: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">API des constantes JVM</a></strong> </p><br><p>  <strong>Caract√©ristique int√©rieure</strong> .  Les d√©veloppeurs veulent manipuler les fichiers de classe.  Vous devez le faire facilement, et c'est l'√©nonc√© du probl√®me.  C'est du moins ce que Brian Goetz, propri√©taire de ce JEP, a d√©clar√© :-) Tout cela fait partie d'un champ de bataille plus large, mais pour l'instant nous n'irons pas en profondeur. </p><br><p>  Chaque classe Java a un soi-disant "pool constant", o√π il y a un vidage de certaines valeurs (comme les cha√Ænes et les entiers), ou d'entit√©s d'ex√©cution comme les classes et les m√©thodes.  Vous pouvez creuser dans ce vidage en utilisant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">l'instruction ldc</a> - "load costant", donc toutes ces ordures sont appel√©es constantes chargeables.  Il existe encore un cas particulier pour la dynamique invoqu√©e, mais tant pis. </p><br><p>  Si nous travaillons avec des fichiers de classe, nous voulons simuler facilement les instruments de bytecode, et donc les constantes chargeables.  Le premier souhait est de simplement cr√©er les types Java correspondants, mais comment les pr√©senter avec une classe "vivante", la structure <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>CONSTANT_Class_info</code></a> ?  <code>Class</code> objets de <code>Class</code> d√©pendent de l'exactitude et de la coh√©rence du chargement des classes, et avec le chargement des classes en Java, une bacchanale infernale est cr√©√©e.  Pour commencer, toutes les classes ne peuvent pas √™tre charg√©es dans la VM, mais vous devez toujours les d√©crire! </p><br><p>  Je voudrais en quelque sorte g√©rer des choses comme les classes, les m√©thodes et les b√™tes moins connues comme les poign√©es de m√©thode et les constantes dynamiques, en tenant compte de toutes ces subtilit√©s. </p><br><p>  Ceci est r√©solu en introduisant de nouveaux types de liens symboliques <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bas√©s sur des valeurs</a> (au sens de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JVMS 5.1</a> ), chacun d√©crivant un type sp√©cifique de constante.  D√©crit purement nominalement, ind√©pendamment des classes de chargement ou des probl√®mes d'acc√®s.  Ils vivent dans des packages comme <code>java.lang.invoke.constant</code> et ne le demandent pas, mais vous pouvez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">jeter un ≈ìil</a> au patch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><hr><br><p>  <strong>340: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un port AArch64, pas deux</a></strong> <br>  <strong>Fonction externe</strong> .  D√©j√† dans JDK 9, il y avait une situation √©trange quand Oracle et Red Hat mettaient simultan√©ment leurs ports ARM en alerte.  Et maintenant, nous voyons la fin de l'histoire: la partie 64 bits du port d'Oraklov a √©t√© retir√©e de l'amont. </p><br><p>  Vous auriez pu vous plonger dans l'histoire pendant longtemps, mais il y a une meilleure fa√ßon.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BellSoft a</a> particip√© au d√©veloppement de ce JEP, et son bureau est situ√© √† Saint-P√©tersbourg, √† c√¥t√© de l'ancien bureau d'Oracle. </p><br><p>  Par cons√©quent, je me suis imm√©diatement tourn√© imm√©diatement vers Alexey Voitilov, CTO de BellSoft: </p><br><blockquote>  "BellSoft lance le Liberica JDK, qui, en plus de x86 Linux / Windows / Mac et Solaris / SPARC, prend √©galement en charge ARM. En commen√ßant par JDK 9 pour ARM, nous nous sommes concentr√©s sur l'am√©lioration des performances du port AARCH64 pour les applications serveur et avons continu√© √† prendre en charge le port ARM 32 bits pour Ainsi, au moment de la sortie de JDK 11, il y avait une situation o√π personne ne supportait la partie port 64 bits d'Oracle (y compris Oracle), et la communaut√© OpenJDK a d√©cid√© de la supprimer afin de se concentrer sur le port AARCH64. voir, par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JEP 315</a> , que nous  int√©gr√© dans JDK 11) et, √† partir de JDK 12, il prend en charge toutes les fonctionnalit√©s pr√©sentes dans le port d'Oracle (le dernier, Minimal VM, j'ai int√©gr√© en septembre). Par cons√©quent, j'ai √©t√© heureux d'aider Bob Vandette √† supprimer ce rudiment dans JDK 12. En cons√©quence, OpenJDK la communaut√© a re√ßu un port sur AARCH64 et un port ARM32, ce qui les rend certainement plus faciles √† prendre en charge. " </blockquote><br><hr><br><p>  <strong>341: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Archives CDS par d√©faut</a></strong> </p><br><p>  <strong>Caract√©ristique int√©rieure</strong> .  Le probl√®me est qu'au d√©marrage d'une application Java, des milliers de classes sont charg√©es, ce qui donne l'impression que Java ralentit consid√©rablement au d√©marrage.  Mais qui est l√† pour mentir, ce n'est pas seulement une ¬´sensation¬ª - c'est le cas.  Pour r√©soudre le probl√®me des temps anciens, divers rituels sont pratiqu√©s. </p><br><p>  Le partage de donn√©es de classe est une fonctionnalit√© qui nous est venue <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">depuis des temps imm√©moriaux</a> , comme une fonctionnalit√© commerciale de JDK 8 Update 40. Il vous permet de regrouper toutes ces ordures de d√©marrage dans une archive de votre propre format (vous n'avez pas besoin de savoir lequel), apr√®s quoi la vitesse de lancement les applications augmentent.  Et apr√®s un certain temps, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JEP 310</a> est apparu: Application Class-Data Sharing, qui nous a permis de travailler de la m√™me mani√®re non seulement avec les classes syst√®me, mais aussi avec les classes d'application. </p><br><p>  Pour les classes JDK, cela ressemble √† ceci.  Tout d'abord, nous vidons les classes avec la commande <code>java -Xshare:dump</code> , puis <code>java -Xshare:dump</code> l'application en lui disant d'utiliser ce cache: <code>java -Xshare:on -jar app.jar</code> .  Tout, la startup s'est un peu am√©lior√©e.  Connaissiez-vous cette fonctionnalit√©?  Beaucoup qui ne savent toujours pas! </p><br><p>  Cela semble √©trange ici: pourquoi √† chaque fois √©crire rituellement <code>-Xshare:dump</code> si le r√©sultat par d√©faut de cette commande est un peu pr√©visible m√™me au stade de la cr√©ation de la distribution JDK?  Selon la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> , si la distribution Java 8 a √©t√© install√©e √† l'aide du programme d'installation, alors au moment de l'installation, elle devrait ex√©cuter les commandes n√©cessaires pour vous.  Comme, l'installateur est en train d'explorer tranquillement dans le coin.  Mais pourquoi?  Et que faire de la distribution, qui n'est pas distribu√©e en tant qu'installateur, mais en tant que fichier zip? </p><br><p>  C'est simple: √† partir de JDK 12, l'archive CDS sera g√©n√©r√©e par les cr√©ateurs du kit de distribution, imm√©diatement apr√®s la liaison.  M√™me pour les versions nocturnes (√† condition qu'elles soient 64 bits et natives, pas pour la compilation crois√©e). </p><br><p>  Les utilisateurs n'ont m√™me pas besoin de conna√Ætre la pr√©sence de cette fonctionnalit√©, car, √† partir de JDK 11, <code>-Xshare:auto</code> activ√© par d√©faut, et une telle archive sera automatiquement <code>-Xshare:auto</code> .  Ainsi, le simple <strong>fait de passer √† JDK 12 acc√©l√®re le lancement de l'application!</strong> </p><hr><br><p>  <strong>344: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Collections mixtes avortables pour G1</a></strong> </p><br><p>  <strong>Caract√©ristique int√©rieure</strong> .  Pour √™tre honn√™te <del>  Je ne comprends rien au travail de G1 </del>  Une explication des caract√©ristiques de GC est une t√¢che ingrate.  Cela n√©cessite une compr√©hension des d√©tails de son travail √† la fois de l'explicateur et de la compr√©hension.  Pour la plupart des gens, GC est une sorte d'enfer d'une tabati√®re que vous pouvez tricher en cas de quelque chose.  Par cons√©quent, le probl√®me doit √™tre expliqu√© d'une mani√®re ou d'une autre plus simple. </p><br><p>  <strong>Probl√®me</strong> : G1 pourrait mieux fonctionner. </p><br><p>  Eh bien, le probl√®me est que le GC est un compromis de nombreux param√®tres, dont l'un est la dur√©e de la pause.  Parfois, la pause est trop longue, puis c'est agr√©able de pouvoir l'annuler. </p><br><p>  Quand cela se produit-il?  G1 analyse r√©ellement le comportement de l'application et s√©lectionne le front du travail (exprim√© comme un <em>ensemble de collections</em> ) en fonction de ses conclusions.  Lorsque l'√©tendue des travaux est approuv√©e, G1 s'engage √† collecter tous les objets vivants de l'ensemble de collecte, obstin√©ment et sans arr√™t, en une seule s√©ance.  Parfois, cela prend trop de temps.  En substance, cela signifie que G1 a incorrectement calcul√© la quantit√© de travail.  Vous pouvez le tromper en modifiant soudainement le comportement de votre application afin que l'heuristique fonctionne au-dessus des donn√©es incorrectes lorsqu'un trop grand nombre d'anciennes r√©gions p√©n√®trent dans l'ensemble de collecte. </p><br><p>  Afin de sortir de la situation, G1 a √©t√© finalis√© par le m√©canisme suivant: si l'heuristique s√©lectionne r√©guli√®rement la mauvaise quantit√© de travail, G1 passe √† la collecte incr√©mentielle des ordures, √©tape par √©tape, et chaque √©tape suivante (si elle ne rentre pas dans le temps d'ex√©cution cible) peut √™tre annul√©e.  Il n'est pas logique de collecter quelque chose de mani√®re incr√©mentielle (r√©gions jeunes), par cons√©quent, tous ces travaux sont mis en √©vidence dans le bloc ¬´obligatoire¬ª, qui est toujours effectu√© en continu. </p><br><p>  Que faire avec l'utilisateur final?  Rien, vous devez passer √† JDK 12, tout ira mieux de lui-m√™me. </p><hr><br><p>  <strong>346: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">renvoyer rapidement la m√©moire valid√©e inutilis√©e de G1</a></strong> </p><br><p>  <strong>Caract√©ristique int√©rieure</strong> .  Le probl√®me est que si nous avons une grosse hanche que personne n'utilise activement, il semble juste de ramener toute cette m√©moire inactive au syst√®me d'exploitation.  Cependant, avant JDK 12, cela ne s'√©tait pas produit. </p><br><p>  Afin d'atteindre son objectif en termes de dur√©e de pause autoris√©e, G1 effectue un ensemble de cycles incr√©mentiels, parall√®les et √† plusieurs √©tages.  Dans JDK 11, il ne donne de m√©moire engag√©e au syst√®me d'exploitation qu'avec un GC complet, ou pendant la phase de marquage parall√®le.  Si vous connectez la journalisation (-Xloggc: /home/gc.log -XX: + PrintGCDetails -XX: + PrintGCDateStamps), alors cette phase s'affiche quelque chose comme ceci: </p><br><pre> <code class="plaintext hljs">8801.974: [G1Ergonomics (Concurrent Cycles) request concurrent cycle initiation, reason: occupancy higher than threshold, occupancy: 12582912000 bytes, allocation request: 0 bytes, threshold: 12562779330 bytes (45.00 %), source: end of GC] 8804.670: [G1Ergonomics (Concurrent Cycles) initiate concurrent cycle, reason: concurrent cycle initiation requested] 8805.612: [GC concurrent-mark-start] 8820.483: [GC concurrent-mark-end, 14.8711620 secs]</code> </pre> <br><p>  Ce qui est dr√¥le, c'est que G1, comme il peut, a du mal avec des arr√™ts complets, et le cycle simultan√© ne commence qu'avec des allocations fr√©quentes et un tas obstru√©.  Notre situation, lorsque personne ne touche la hanche, est tout le contraire.  Les situations o√π G1 gratte pour donner de la m√©moire au syst√®me d'exploitation se produiront tr√®s rarement! </p><br><p>  Donc, tout le monde aurait marqu√© sur ce probl√®me (¬´acheter encore plus de RAM, ce qui est comme un voyou!¬ª), Sinon un mais - il y a toutes sortes de nuages ‚Äã‚Äãet de conteneurs dans lesquels cela signifie une utilisation insuffisante et une perte d'argent s√©rieuse.  Regardez, quel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rapport cool</a> , rempli √† ras bord de douleur. </p><br><p>  La solution √©tait d'apprendre √† G1 √† bien se comporter dans ce cas particulier, comme le savent d√©j√† Shenanda ou GenCon d'OpenJ9.  Il est n√©cessaire de d√©terminer l'utilisation insuffisante de la hanche et, en cons√©quence, de r√©duire son utilisation.  Sur certains tests sur Tomcat, cela a permis de r√©duire de pr√®s de moiti√© la consommation de m√©moire. </p><br><p>  L'essentiel est que l'application est consid√©r√©e comme inactive, ou si l'intervalle (en millisecondes) s'est <code>getloadavg()</code> depuis la derni√®re g√©n√©ration et qu'il n'y a pas de cycle simultan√©, ou si <code>getloadavg()</code> pendant une p√©riode d'une minute a montr√© une charge inf√©rieure √† un certain seuil.  D√®s que l'un de ces √©v√©nements se produit, la collecte p√©riodique des ordures d√©marre - elle ne nettoiera certainement pas aussi bien que l'assemblage complet, mais cela affectera l'application de mani√®re minimale. </p><br><p>  Vous pouvez le pousser dans ce journal: </p><br><pre> <code class="plaintext hljs">(1) [6.084s][debug][gc,periodic ] Checking for periodic GC. [6.086s][info ][gc ] GC(13) Pause Young (Concurrent Start) (G1 Periodic Collection) 37M-&gt;36M(78M) 1.786ms (2) [9.087s][debug][gc,periodic ] Checking for periodic GC. [9.088s][info ][gc ] GC(15) Pause Young (Prepare Mixed) (G1 Periodic Collection) 9M-&gt;9M(32M) 0.722ms (3) [12.089s][debug][gc,periodic ] Checking for periodic GC. [12.091s][info ][gc ] GC(16) Pause Young (Mixed) (G1 Periodic Collection) 9M-&gt;5M(32M) 1.776ms (4) [15.092s][debug][gc,periodic ] Checking for periodic GC. [15.097s][info ][gc ] GC(17) Pause Young (Mixed) (G1 Periodic Collection) 5M-&gt;1M(32M) 4.142ms (5) [18.098s][debug][gc,periodic ] Checking for periodic GC. [18.100s][info ][gc ] GC(18) Pause Young (Concurrent Start) (G1 Periodic Collection) 1M-&gt;1M(32M) 1.685ms (6) [21.101s][debug][gc,periodic ] Checking for periodic GC. [21.102s][info ][gc ] GC(20) Pause Young (Concurrent Start) (G1 Periodic Collection) 1M-&gt;1M(32M) 0.868ms (7) [24.104s][debug][gc,periodic ] Checking for periodic GC. [24.104s][info ][gc ] GC(22) Pause Young (Concurrent Start) (G1 Periodic Collection) 1M-&gt;1M(32M) 0.778ms</code> </pre> <br><p>  Compris?  Non.  Dans JEP, il y a une traduction d√©taill√©e en langue des signes de chaque ligne du journal, et comment l'algorithme fonctionne, et tout le reste. </p><br><p>  "Alors quoi, pourquoi ai-je d√©couvert?"  - demandez-vous.  Nous avons maintenant deux poign√©es suppl√©mentaires: <code>G1PeriodicGCInterval</code> et <code>G1PeriodicGCSystemLoadThreshold</code> , qui peuvent √™tre tordues en cas de <code>G1PeriodicGCSystemLoadThreshold</code> .  C'est s√ªr que √ßa va √™tre mauvais un jour, c'est Java, b√©b√©! </p><hr><br><h1 id="itogi">  R√©sum√© </h1><br><p>  En cons√©quence, nous avons une version solide entre nos mains - pas une r√©volution, mais une √©volution ax√©e sur l'am√©lioration des performances.  Exactement la moiti√© des am√©liorations sont li√©es aux performances: trois JEP sur GC et un sur CDS, qui promettent de s'activer par eux-m√™mes, n'ont besoin que d'une mise √† niveau vers JDK 12. En outre, nous avons une fonction de langue (expressions de commutateur), deux nouveaux outils pour les d√©veloppeurs JDK ( Constantes API et tests JMH), et maintenant la communaut√© peut mieux se concentrer sur un seul port 64 bits sur ARM. </p><br><p>  En g√©n√©ral, passez √† JDK 12 maintenant, et que la Force soit avec vous.  Vous en aurez besoin. </p><br><blockquote>  Minute de publicit√©.  Tr√®s prochainement, du 5 au 6 avril, se tiendra la conf√©rence JPoint, qui r√©unira un grand nombre de personnes qui connaissent bien JDK et toutes sortes de nouvelles fonctionnalit√©s.  Par exemple, il y aura s√ªrement Simon Ritter d'Azul avec une conf√©rence sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´JDK 12: pi√®ges pour les imprudents¬ª</a> .  L'endroit le plus appropri√© pour discuter de la derni√®re version!  Vous pouvez en savoir plus sur JPoint sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site officiel</a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr444434/">https://habr.com/ru/post/fr444434/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr444424/index.html">AMD Radeon VII: puce haut de gamme (partie 2)</a></li>
<li><a href="../fr444426/index.html">Lyft et Uber sont introduits en bourse. Pourquoi investir dans Lyft?</a></li>
<li><a href="../fr444428/index.html">Mountain Car: R√©soudre le d√©fi classique avec une formation de renforcement</a></li>
<li><a href="../fr444430/index.html">Analyse: comment utiliser Present Perfect en anglais</a></li>
<li><a href="../fr444432/index.html">Application de Linux et de logiciels open source dans notre √©tablissement d'enseignement: √™tre ou ne pas √™tre?</a></li>
<li><a href="../fr444436/index.html">Qu'est-ce qu'un botnet Mirai et comment puis-je prot√©ger mes appareils?</a></li>
<li><a href="../fr444438/index.html">Une br√®ve histoire de l'open source - comment les logiciels libres se sont battus avec les logiciels propri√©taires</a></li>
<li><a href="../fr444442/index.html">Jetson Nano: Nvidia Machine Learning Single Board</a></li>
<li><a href="../fr444444/index.html">Les meilleurs √©checs de nos conf√©rences (Joker, JPoint, DotNext, Mobius, TechTrain et ainsi de suite)</a></li>
<li><a href="../fr444446/index.html">Cr√©er une application Web moderne √† partir de z√©ro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>