<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçå ü§πüèª üé™ Aprendizaje: escribir un mensajero p2p con cifrado de extremo a extremo üë®üèΩ‚Äçüéì üíπ üë©‚Äçüéì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Otro mensajero P2P 


 Leer rese√±as y documentaci√≥n de idiomas no es suficiente para aprender a escribir aplicaciones m√°s o menos √∫tiles en √©l. 


 As...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aprendizaje: escribir un mensajero p2p con cifrado de extremo a extremo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437686/"><h1 id="yet-another-p2p-messenger">  Otro mensajero P2P </h1><br><p>  Leer rese√±as y documentaci√≥n de idiomas no es suficiente para aprender a escribir aplicaciones m√°s o menos √∫tiles en √©l. </p><br><p>  Aseg√∫rese de consolidar, debe crear algo interesante para que los desarrollos puedan utilizarse en otras tareas. </p><br><p><img src="https://habrastorage.org/webt/kt/bm/3r/ktbm3rsivunfcdcvcyqvnm14f5u.png" alt="Ejemplo de IU de chat de ReactJs"></p><br><p>  Este art√≠culo est√° dirigido a principiantes interesados ‚Äã‚Äãen el lenguaje go y las redes punto a punto. <br>  Y para profesionales que pueden ofrecer ideas razonables o criticar constructivamente. </p><a name="habracut"></a><br><p>  He estado programando durante bastante tiempo con diferentes grados de inmersi√≥n en java, php, js, python. <br>  Y cada lenguaje de programaci√≥n es bueno en su campo. </p><br><p>  El √°rea principal de Go es la creaci√≥n de servicios distribuidos, microservicios. <br>  Muy a menudo, un microservicio es un peque√±o programa que realiza su funcionalidad altamente especializada. </p><br><p> Pero los microservicios a√∫n deber√≠an poder comunicarse entre s√≠, por lo que la herramienta para crear microservicios deber√≠a permitir una conexi√≥n en red f√°cil e indolora. <br>  Para probar esto, escribiremos una aplicaci√≥n que organice una red descentralizada de pares (Peer-to-Peer), el m√°s simple es un mensajero p2p (por cierto, ¬øhay un sin√≥nimo ruso para esta palabra?). </p><br><p>  En el c√≥digo, invento activamente bicicletas y me subo al rastrillo para sentir golang, recibir cr√≠ticas constructivas y sugerencias racionales. </p><br><h2 id="chto-delaem">  Que hacemos </h2><br><p>  Peer (peer): una instancia √∫nica del messenger. </p><br><p>  Nuestro mensajero deber√≠a poder: </p><br><ul><li>  Encuentra fiestas cercanas </li><li>  Establecer una conexi√≥n con otros compa√±eros </li><li>  Cifrar el intercambio de datos con compa√±eros </li><li>  Recibir mensajes del usuario </li><li>  Mostrar mensajes al usuario </li></ul><br><p>  Para hacer la tarea un poco m√°s interesante, hagamos que todo pase por un puerto de red. </p><br><p><img src="https://habrastorage.org/webt/5b/zo/8g/5bzo8g4eqogveeure4lzgngo5ma.png" alt="El esquema condicional del mensajero."></p><br><p>  Si extrae este puerto a trav√©s de HTTP, obtenemos una aplicaci√≥n React que extrae el mismo puerto estableciendo una conexi√≥n de socket web. </p><br><p>  Si extrae el puerto a trav√©s de HTTP no desde la m√°quina local, entonces mostramos el banner. </p><br><p>  Si hay otro par conectado a este puerto, se establece una conexi√≥n permanente con cifrado de extremo a extremo. </p><br><h2 id="opredelyaem-tip-vhodyaschego-soedineniya">  Determinar el tipo de conexi√≥n entrante </h2><br><p>  Primero, abra el puerto para escuchar y esperaremos nuevas conexiones. </p><br><pre><code class="go hljs">net.ListenTCP(<span class="hljs-string"><span class="hljs-string">"tcp"</span></span>, tcpAddr)</code> </pre> <br><p>  En la nueva conexi√≥n, lea los primeros 4 bytes. </p><br><p>  Tomamos la lista de verbos HTTP y comparamos nuestros 4 bytes con ella. </p><br><p>  Ahora determinamos si se realiza una conexi√≥n desde la m√°quina local, y si no, respondemos con un banner y colgamos. </p><br><pre> <code class="go hljs"> buf, err := readWriter.Peek(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ItIsHttp(buf) { handleHttp(readWriter, conn, p) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { peer := proto.NewPeer(conn) p.HandleProto(readWriter, peer) } <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !strings.EqualFold(s, <span class="hljs-string"><span class="hljs-string">"127"</span></span>) &amp;&amp; !strings.EqualFold(s, <span class="hljs-string"><span class="hljs-string">"[::"</span></span>) { response.Body = ioutil.NopCloser(strings.NewReader(<span class="hljs-string"><span class="hljs-string">"Peer To Peer Messenger. see https://github.com/easmith/p2p-messenger"</span></span>)) }</code> </pre> <br><p>  Si la conexi√≥n es local, respondemos con el archivo correspondiente a la solicitud. </p><br><p>  Luego decid√≠ escribir el procesamiento yo mismo, aunque pod√≠a usar el controlador disponible en la biblioteca est√°ndar. </p><br><pre> <code class="go hljs"> <span class="hljs-comment"><span class="hljs-comment">//   func processRequest(request *http.Request, response *http.Response) {/*    */} //     fileServer := http.FileServer(http.Dir("./front/build/")) fileServer.ServeHTTP(NewMyWriter(conn), request)</span></span></code> </pre> <br><p>  Si <code>/ws</code> solicita la ruta <code>/ws</code> , intentamos establecer una conexi√≥n websocket. </p><br><p>  Desde que ensambl√© la bicicleta procesando solicitudes de archivos, har√© el procesamiento de la conexi√≥n ws usando la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">biblioteca gorilla / websocket</a> . </p><br><p>  Para hacer esto, cree <code>MyWriter</code> e implemente m√©todos para que correspondan a las interfaces <code>http.ResponseWriter</code> y <code>http.Hijacker</code> . </p><br><pre> <code class="go hljs"> <span class="hljs-comment"><span class="hljs-comment">// w - MyWriter func handleWs(w http.ResponseWriter, r *http.Request, p *proto.Proto) { c, err := upgrader.Upgrade(w, r, w.Header()) /*          */ }</span></span></code> </pre> <br><h2 id="obnaruzhenie-pirov">  Detecci√≥n de pares </h2><br><p>  Para buscar pares en una red local, utilizaremos la multidifusi√≥n UDP. </p><br><p>  Enviaremos paquetes con informaci√≥n sobre nosotros a la direcci√≥n IP de multidifusi√≥n. </p><br><pre> <code class="go hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMeow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(address </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, p *proto.Proto)</span></span></span></span> { conn, err := net.DialUDP(<span class="hljs-string"><span class="hljs-string">"udp"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, addr) <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { _, err := conn.Write([]<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>(fmt.Sprintf(<span class="hljs-string"><span class="hljs-string">"meow:%v:%v"</span></span>, hex.EncodeToString(p.PubKey), p.Port))) <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> time.Sleep(<span class="hljs-number"><span class="hljs-number">1</span></span> * time.Second) } }</code> </pre> <br><p>  Y escuche por separado de Multicast IP para todos los paquetes UDP. </p><br><pre> <code class="go hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">listenMeow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(address </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, p *proto.Proto, handler </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">func</span></span></span></span><span class="hljs-function"><span class="hljs-params">(p *proto.Proto, peerAddress </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> conn, err := net.ListenMulticastUDP(<span class="hljs-string"><span class="hljs-string">"udp"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, addr) <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> _, src, err := conn.ReadFromUDP(buffer) <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-comment"><span class="hljs-comment">// connectToPeer handler(p, peerAddress) }</span></span></code> </pre> <br><p>  As√≠ nos declaramos y aprendemos sobre la aparici√≥n de otras fiestas. </p><br><p>  Ser√≠a posible organizar esto a nivel de IP, e incluso en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n oficial del paquete IPv4,</a> solo se proporciona el paquete de datos de multidifusi√≥n como un ejemplo de c√≥digo. </p><br><h2 id="protokol-vzaimodeystviya-pirov">  Protocolo de interacci√≥n entre pares </h2><br><p>  Empaquetaremos toda la comunicaci√≥n entre pares en un sobre (Sobre). </p><br><p>  En cualquier sobre siempre hay un remitente y un destinatario, a esto le agregaremos un comando (que lleva con √©l), un identificador (hasta ahora es un n√∫mero aleatorio, pero se puede hacer como un hash de contenido), la longitud del contenido y el contenido del sobre en s√≠, un mensaje o par√°metros de comando. </p><br><p><img src="https://habrastorage.org/webt/3b/yx/yc/3byxycyif222uk2jslbya9qb1bs.png" alt="Bytes de sobre"></p><br><p>  El comando (o el tipo de contenido) se coloca con √©xito al comienzo del sobre y definimos una lista de comandos de 4 bytes que no se cruzan con los nombres de los verbos HTTP. </p><br><p>  Todo el sobre durante la transmisi√≥n se serializa en una matriz de bytes. </p><br><h3 id="rukopozhatie">  Apret√≥n de manos </h3><br><p>  Cuando se establece la conexi√≥n, la fiesta se extiende inmediatamente para un apret√≥n de manos, dando su nombre, clave p√∫blica y clave p√∫blica ef√≠mera para generar una clave de sesi√≥n compartida. </p><br><p>  En respuesta, el par recibe un conjunto similar de datos, registra al par encontrado en su lista y calcula (CalcSharedSecret) la clave de sesi√≥n com√∫n. </p><br><pre> <code class="go hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handShake</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(p *proto.Proto, conn net.Conn)</span></span></span><span class="hljs-function"> *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">proto</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Peer</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> peer := proto.NewPeer(conn) <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> p.SendName(peer) <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> envelope, err := proto.ReadEnvelope(bufio.NewReader(conn)) <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> <br><h3 id="obmen-pirami">  Intercambio de fiestas </h3><br><p>  Despu√©s de un apret√≥n de manos, los compa√±eros intercambian sus listas de compa√±eros =) </p><br><p>  Para hacer esto, se env√≠a un sobre con el comando LIST y se coloca una lista JSON de pares en su contenido. <br>  En respuesta, obtenemos un sobre similar. </p><br><p>  Encontramos en las listas de nuevos y con cada uno de ellos tratamos de conectarnos, estrecharnos la mano, intercambiar fiestas, etc. </p><br><h3 id="obmen-polzovatelskimi-soobscheniyami">  Mensajes de usuario </h3><br><p>  Los mensajes personalizados son de gran valor para nosotros, por lo que encriptaremos y firmaremos cada conexi√≥n. </p><br><h4 id="o-shifrovanii">  Sobre el cifrado </h4><br><p>  En las bibliotecas de golang est√°ndar (google) del paquete de cifrado, se implementan muchos algoritmos diferentes (no hay est√°ndares GOST). </p><br><p>  La m√°s conveniente para las firmas, creo, es la curva Ed25519.  Utilizaremos la biblioteca ed25519 para firmar mensajes. </p><br><p>  Al principio, pens√© en usar un par de claves obtenido de ed25519 no solo para firmar, sino tambi√©n para generar una clave de sesi√≥n. </p><br><p>  Sin embargo, las claves para firmar no son aplicables para calcular la clave compartida; a√∫n debe conjurarlas: </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateKeyExchangePair</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(publicKey [32]</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">, privateKey [32]</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { pub, priv, err := ed25519.GenerateKey(<span class="hljs-literal"><span class="hljs-literal">nil</span></span>) <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span>(publicKey[:], pub[:]) <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span>(privateKey[:], priv[:]) curve25519.ScalarBaseMult(&amp;publicKey, &amp;privateKey) <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> <br><p>  Por lo tanto, se decidi√≥ generar claves ef√≠meras y, en t√©rminos generales, este es el enfoque correcto que no deja a los atacantes la oportunidad de elegir una clave com√∫n. </p><br><p>  Para los amantes de las matem√°ticas, aqu√≠ est√°n los enlaces wiki: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Protocolo <em>Diffie</em> - Hellman_ en curvas el√≠pticas</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Firma digital EdDSA</a> </p><br><p>  La generaci√≥n de una clave compartida es bastante est√°ndar: primero, para una nueva conexi√≥n, generamos claves ef√≠meras, enviamos un sobre con una clave p√∫blica al socket. </p><br><p>  El lado opuesto hace lo mismo, pero en un orden diferente: recibe un sobre con una clave p√∫blica, genera su propio par y env√≠a la clave p√∫blica al socket. </p><br><p>  Ahora cada participante tiene las claves ef√≠meras p√∫blicas y privadas de otra persona. </p><br><p>  Multiplic√°ndolos, obtenemos la misma clave para ambos, que usaremos para cifrar mensajes. </p><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">//CalcSharedSecret Calculate shared secret func CalcSharedSecret(publicKey []byte, privateKey []byte) (secret [32]byte) { var pubKey [32]byte var privKey [32]byte copy(pubKey[:], publicKey[:]) copy(privKey[:], privateKey[:]) curve25519.ScalarMult(&amp;secret, &amp;privKey, &amp;pubKey) return }</span></span></code> </pre> <br><p>  Cifraremos los mensajes mediante el algoritmo AES de larga data en modo de acoplamiento de bloque (CBC). </p><br><p>  Todas estas implementaciones se encuentran f√°cilmente en la documentaci√≥n de Golang. </p><br><p>  El √∫nico refinamiento es el llenado autom√°tico del mensaje con cero bytes para la multiplicidad de su longitud a la longitud del bloque de cifrado (16 bytes). </p><br><pre> <code class="go hljs"> <span class="hljs-comment"><span class="hljs-comment">//Encrypt the message func Encrypt(content []byte, key []byte) []byte { padding := len(content) % aes.BlockSize if padding != 0 { repeat := bytes.Repeat([]byte("\x00"), aes.BlockSize-(padding)) content = append(content, repeat...) } /* ... */ } //Decrypt encrypted message func Decrypt(encrypted []byte, key []byte) []byte { /* ... */ encrypted = bytes.Trim(encrypted, string([]byte("\x00"))) return encrypted }</span></span></code> </pre> <br><p>  En 2013, implement√≥ AES (con un modo similar a CBC) para cifrar mensajes en Telegram como parte de un concurso de Pavel Durov. </p><br><p>  En ese momento, el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">protocolo Diffie-Hellman</a> m√°s com√∫n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se</a> usaba en telegramas para generar una clave ef√≠mera. </p><br><p>  Y para excluir la carga de conexiones falsas, antes de cada intercambio de claves, los clientes resolvieron el problema de factorizaci√≥n. </p><br><h2 id="gui">  GUI </h2><br><p>  Necesitamos mostrar una lista de pares y una lista de mensajes con ellos, y tambi√©n responder a nuevos mensajes aumentando el contador al lado del nombre del par. </p><br><p>  Aqu√≠ sin problemas: ReactJS + websocket. </p><br><p>  Los mensajes de socket web son esencialmente sobres √∫nicos, solo que no contienen textos cifrados. </p><br><p>  Todos ellos son "herederos" del tipo <code>WsCmd</code> y se serializan en JSON tras la transferencia. </p><br><pre> <code class="go hljs"> <span class="hljs-comment"><span class="hljs-comment">//Serializable interface to detect that can to serialised to json type Serializable interface { ToJson() []byte } func toJson(v interface{}) []byte { json, err := json.Marshal(v) /*  err */ return json } /* ... */ //WsCmd WebSocket command type WsCmd struct { Cmd string `json:"cmd"` } //WsMessage WebSocket command: new Message type WsMessage struct { WsCmd From string `json:"from"` To string `json:"to"` Content string `json:"content"` } //ToJson convert to JSON bytes func (v WsMessage) ToJson() []byte { return toJson(v) } /* ... */</span></span></code> </pre> <br><p>  Entonces, una solicitud HTTP llega a la ra√≠z ("/"), ahora para mostrar el frente, busque en el directorio "front / build" y proporcione index.html </p><br><p>  Bueno, la interfaz est√° hecha, ahora la opci√≥n para los usuarios es: ejecutarla en un navegador o en una ventana separada: WebView. </p><br><p>  Para la √∫ltima opci√≥n utilizada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">zserge / webview</a> </p><br><pre> <code class="go hljs"> e := webview.Open(<span class="hljs-string"><span class="hljs-string">"Peer To Peer Messenger"</span></span>, fmt.Sprintf(<span class="hljs-string"><span class="hljs-string">"http://localhost:%v"</span></span>, initParams.Port), <span class="hljs-number"><span class="hljs-number">800</span></span>, <span class="hljs-number"><span class="hljs-number">600</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>)</code> </pre> <br><p>  Para construir una aplicaci√≥n con √©l, necesita instalar otro sistema </p><br><pre> <code class="bash hljs"> sudo apt install libwebkit2gtk-4.0-dev</code> </pre> <br><p>  Mientras pensaba en la GUI, encontr√© muchas bibliotecas para GTK, QT, y la interfaz de la consola se ver√≠a muy geek, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/jroimartin/gocui</a> , en mi opini√≥n, una idea muy interesante. </p><br><h2 id="zapusk-messendzhera">  Lanzamiento de Messenger </h2><br><h3 id="ustanovka-golang">  Instalaci√≥n de Golang </h3><br><p>  Por supuesto, primero necesitas instalar go. <br>  Para hacer esto, recomiendo usar las instrucciones <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">golang.org/doc/install</a> . </p><br><p>  Instrucciones simplificadas para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">bash script</a> </p><br><h3 id="zagruzka-prilozheniya-v-gopath">  Descargar una aplicaci√≥n en GOPATH </h3><br><p>  Est√° tan organizado que todas las bibliotecas e incluso sus proyectos deben estar en el llamado GOPATH. </p><br><p>  Por defecto, esto es $ HOME / go.  Go le permite extraer la fuente del repositorio p√∫blico con un simple comando: </p><br><pre> <code class="bash hljs"> go get github.com/easmith/p2p-messenger</code> </pre> <br><p>  Ahora, en su <code>$HOME/go/src/github.com/easmith/p2p-messenger</code> aparecer√° <code>$HOME/go/src/github.com/easmith/p2p-messenger</code> fuente de la rama maestra </p><br><h3 id="ustanovka-npm-i-sborka-fronta">  Instalaci√≥n NPM y montaje frontal </h3><br><p>  Como escrib√≠ anteriormente, nuestra GUI es una aplicaci√≥n web con un frente en ReactJs, por lo que el frente a√∫n necesita ser ensamblado. </p><br><p>  Nodejs + npm: aqu√≠, como siempre. </p><br><p>  Por si acaso, aqu√≠ est√°n las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">instrucciones para ubuntu</a> </p><br><p>  Ahora comenzamos el montaje frontal como est√°ndar </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> front npm update npm run build</code> </pre> <br><p>  ¬°El frente est√° listo! </p><br><h3 id="zapusk">  Lanzamiento </h3><br><p>  Volvamos a la ra√≠z y lancemos la fiesta de nuestro mensajero. </p><br><p>  En el inicio, podemos especificar el nombre de nuestro par, puerto, archivo con las direcciones de otros pares y una bandera que indica si se debe iniciar WebView. </p><br><p>  De manera predeterminada, <code>$USER@$HOSTNAME</code> se usa como el nombre de <code>$USER@$HOSTNAME</code> y el puerto 35035. </p><br><p>  Entonces, comenzamos y chateamos con amigos en la red local. </p><br><pre> <code class="bash hljs"> go run app.go -name Snowden</code> </pre> <br><h2 id="otzyv-o-programmirovanii-na-golang">  Comentarios sobre la programaci√≥n de golang </h2><br><ul><li>  Lo m√°s importante que me gustar√≠a se√±alar: <strong>sobre la marcha, inmediatamente resulta implementar lo que pretend√≠a</strong> . <br>  Casi todo lo que necesita est√° en la biblioteca est√°ndar. </li><li>  Sin embargo, hubo una dificultad cuando comenc√© el proyecto en un directorio distinto de GOPATH. <br>  Us√© GoLand para escribir c√≥digo.  Y al principio fue vergonzoso formatear autom√°ticamente el c√≥digo con bibliotecas de importaci√≥n autom√°tica. </li><li>  Hay <strong>muchos generadores de c√≥digo</strong> en el <strong>IDE</strong> , lo que nos permiti√≥ centrarnos en el desarrollo en lugar de en el conjunto de c√≥digos. </li><li>  Se <strong>acostumbra</strong> r√°pidamente al manejo frecuente de errores, pero se produce un error cuando se da cuenta de que una situaci√≥n normal es cuando la esencia del error se analiza de acuerdo con su representaci√≥n de cadena. <br><pre> <code class="go hljs">err != io.EOF</code> </pre> </li><li>  Las cosas est√°n un poco mejor con la biblioteca os.  Tales construcciones ayudan a comprender la esencia del problema. <br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> os.IsNotExist(err) { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> </li><li>  Fuera de la caja, go nos ense√±a a documentar correctamente el c√≥digo y escribir pruebas. <br>  Y hay algunos pero.  Hemos descrito la interfaz con el m√©todo <code>ToJson()</code> . <br>  Por lo tanto, el generador de documentaci√≥n no hereda la descripci√≥n de este m√©todo para los m√©todos que lo implementan, por lo que para eliminar advertencias innecesarias, debe copiar la documentaci√≥n en cada m√©todo implementado (proto / mtypes.go). </li><li>  Recientemente me acostumbr√© al poder de log4j en Java, por lo que no hay suficiente buen registrador en marcha. <br>  Probablemente valga la pena observar la inmensidad del hermoso registro de github con ap√©ndices y formateadores. </li><li>  Trabajo inusual con matrices. <br>  Por ejemplo, la concatenaci√≥n ocurre a trav√©s de la funci√≥n <code>append</code> , y la conversi√≥n de una matriz de longitud arbitraria en una matriz de longitud fija mediante <code>copy</code> . </li><li>  <code>switch-case</code> funciona como <code>if-elseif-else</code> , pero este es un enfoque interesante, pero una vez m√°s: <br>  si queremos el comportamiento habitual de <code>switch-case</code> , debemos poner en <code>fallthrough</code> cada caso. <br>  Tambi√©n puedes usar <code>goto</code> , pero no, ¬°por favor! </li><li>  No existe un operador ternario y, a menudo, esto no es conveniente. </li></ul><br><h2 id="chto-dalshe">  Que sigue </h2><br><p>  Por lo tanto, se implementa el mensajero punto a punto m√°s simple. </p><br><p>  Los conos est√°n abarrotados, adem√°s puede mejorar la funcionalidad del usuario: env√≠o de archivos, im√°genes, audio, emoticones, etc., etc. </p><br><p>  Y no puede inventar su protocolo y usar los Buffers de protocolo de Google, <br>  Conecte blockchain y prot√©jase del spam utilizando los contratos inteligentes de Ethereum. </p><br><p>  En contratos inteligentes, organice chats grupales, canales, un sistema de nombres, avatares y perfiles de usuario. </p><br><p>  Tambi√©n es imprescindible ejecutar pares de inicializaci√≥n, implementar bypass de NAT y enviar mensajes de igual a igual. </p><br><p>  Como resultado, obtienes un buen telegrama / tel√©fono de reemplazo, solo tienes que transferir a todos tus amigos all√≠ =) </p><br><h2 id="poleznosti">  Utilidad </h2><br><div class="spoiler">  <b class="spoiler_title">Algunos enlaces</b> <div class="spoiler_text"><p>  En el curso del trabajo en el messenger, encontr√© p√°ginas interesantes para un desarrollador principiante. <br>  Los comparto contigo: </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">golang.org/doc/</a> - documentaci√≥n del idioma, todo es simple, claro y con ejemplos.  La misma documentaci√≥n se puede ejecutar localmente con el comando </p><br><pre> <code class="bash hljs">godoc -HTTP=:6060</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">gobyexample.com</a> - una colecci√≥n de ejemplos simples </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">golang-book.ru</a> - un buen libro en ruso </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github.com/dariubs/GoBooks</a> es una colecci√≥n de libros sobre Go. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">awesome-go.com</a> : una lista de bibliotecas, marcos y aplicaciones interesantes sobre la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">marcha</a> .  La categorizaci√≥n es m√°s o menos, pero la descripci√≥n de muchos de ellos es muy escasa, lo que no ayuda a la b√∫squeda por Ctrl + F </p></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/437686/">https://habr.com/ru/post/437686/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../437674/index.html">M√©todos de reconocimiento de objetos en 3D para veh√≠culos no tripulados. Informe Yandex</a></li>
<li><a href="../437676/index.html">Las universidades y los aceleradores corporativos como apalancamiento para lanzar una startup B2B en los EE. UU.</a></li>
<li><a href="../437680/index.html">Mi colecci√≥n de bricolaje en Youtube</a></li>
<li><a href="../437682/index.html">Escribir otra herramienta de plantillas de Kubernetes</a></li>
<li><a href="../437684/index.html">Algoritmo Supremo - Compendio sesgado</a></li>
<li><a href="../437688/index.html">OpenSceneGraph: T√©cnicas b√°sicas de programaci√≥n</a></li>
<li><a href="../437694/index.html">An√°lisis de la utilidad Files.walkFileTree ();</a></li>
<li><a href="../437696/index.html">El resumen de materiales interesantes para el desarrollador m√≥vil # 283 (del 21 al 27 de enero)</a></li>
<li><a href="../437698/index.html">Servicio de traducci√≥n de patentes WIPO Translate - mis experiencias</a></li>
<li><a href="../437702/index.html">An√°lisis de entrevistas de trabajo de Google: consultas sin√≥nimas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>