<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘â€ğŸ—¨ ğŸ’… ğŸ¤§ åˆ›å»ºä¸€ä¸ªç›‘å¬åº”ç”¨ç¨‹åºä»¥æŸ¥çœ‹ç§»åŠ¨MMORPGæµé‡ ğŸ‘¨ğŸ»â€ğŸ¤ ğŸ¯ â˜‘ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è¿™æ˜¯æœ‰å…³ç§»åŠ¨MMORPGç½‘ç»œæµé‡åˆ†æçš„ç³»åˆ—æ–‡ç« çš„ç¬¬äºŒéƒ¨åˆ†ã€‚ æ ·æœ¬å¾ªç¯ä¸»é¢˜ï¼š 



1. è§£ææœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„æ¶ˆæ¯æ ¼å¼ã€‚ 
2. ç¼–å†™ä¾¦å¬åº”ç”¨ç¨‹åºä»¥æ–¹ä¾¿çš„æ–¹å¼æŸ¥çœ‹æ¸¸æˆæµé‡ã€‚ 
3. ä½¿ç”¨éHTTPä»£ç†æœåŠ¡å™¨è¿›è¡Œæµé‡æ‹¦æˆªåŠå…¶ä¿®æ”¹ã€‚ 
4. åˆ°æ‚¨è‡ªå·±çš„ï¼ˆâ€œç›—ç‰ˆâ€ï¼‰æœåŠ¡å™¨çš„ç¬¬ä¸€æ­¥ã€‚ 
 åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åˆ›å»ºä¸€ä¸ªç›‘å¬åº”ç”¨ç¨‹åºä»¥æŸ¥çœ‹ç§»åŠ¨MMORPGæµé‡</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457480/"> è¿™æ˜¯æœ‰å…³ç§»åŠ¨MMORPGç½‘ç»œæµé‡åˆ†æçš„ç³»åˆ—æ–‡ç« çš„ç¬¬äºŒéƒ¨åˆ†ã€‚ æ ·æœ¬å¾ªç¯ä¸»é¢˜ï¼š <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è§£ææœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„æ¶ˆæ¯æ ¼å¼ã€‚</a> </li><li> ç¼–å†™ä¾¦å¬åº”ç”¨ç¨‹åºä»¥æ–¹ä¾¿çš„æ–¹å¼æŸ¥çœ‹æ¸¸æˆæµé‡ã€‚ </li><li> ä½¿ç”¨éHTTPä»£ç†æœåŠ¡å™¨è¿›è¡Œæµé‡æ‹¦æˆªåŠå…¶ä¿®æ”¹ã€‚ </li><li> åˆ°æ‚¨è‡ªå·±çš„ï¼ˆâ€œç›—ç‰ˆâ€ï¼‰æœåŠ¡å™¨çš„ç¬¬ä¸€æ­¥ã€‚ </li></ol><br> åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘å°†æè¿°ä¾¦å¬åº”ç”¨ç¨‹åºï¼ˆå—…æ¢å™¨ï¼‰çš„åˆ›å»ºï¼Œè¯¥ä¾¦å¬å™¨å°†ä½¿æˆ‘ä»¬èƒ½å¤ŸæŒ‰äº‹ä»¶çš„ç±»å‹å’Œæ¥æºè¿‡æ»¤äº‹ä»¶ï¼Œæ˜¾ç¤ºæœ‰å…³æ¶ˆæ¯çš„ä¿¡æ¯å¹¶æœ‰é€‰æ‹©åœ°å°†å…¶ä¿å­˜ä»¥è¿›è¡Œåˆ†æï¼Œä»¥åŠç•¥å¾®è¿›å…¥æ¸¸æˆçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆâ€œäºŒè¿›åˆ¶æ–‡ä»¶â€ï¼‰æ”¯æŒä¿¡æ¯ï¼Œå¹¶å‘åº”ç”¨ç¨‹åºæ·»åŠ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åè®®ç¼“å†²åŒº</a>æ”¯æŒã€‚ æœ‰å…´è¶£çš„ï¼Œæˆ‘è¦çŒ«ã€‚ <br><a name="habracut"></a><br><h3> æ‰€éœ€å·¥å…· </h3><br> ä¸ºäº†èƒ½å¤Ÿé‡å¤ä¸‹é¢æè¿°çš„æ­¥éª¤ï¼Œæ‚¨å°†éœ€è¦ï¼š <br><br><ul><li>  Wiresharkç”¨äºæ•°æ®åŒ…åˆ†æï¼› </li><li>  .NET </li><li>  <a href="">PcapDotNet</a>åº“ï¼Œç”¨äºä¸WinPcapä¸€èµ·ä½¿ç”¨ï¼› </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">protobuf-net</a>åº“ï¼Œç”¨äºå¤„ç†åè®®ç¼“å†²åŒºã€‚ </li></ul><br><h3> ç¼–å†™å¬åŠ›åº”ç”¨ç¨‹åº </h3><br> ä»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸Šä¸€ç¯‡æ–‡ç« ä¸­</a>æˆ‘ä»¬è¿˜è®°å¾—ï¼Œæ¸¸æˆé€šè¿‡TCPåè®®è¿›è¡Œé€šä¿¡ï¼Œå¹¶ä¸”åœ¨ä¼šè¯æ¡†æ¶ä¸­ï¼Œå®ƒä»…é€šè¿‡ä¸€ä¸ªæœåŠ¡å™¨å’Œä¸€ä¸ªç«¯å£è¿›è¡Œé€šä¿¡ã€‚ ä¸ºäº†èƒ½å¤Ÿåˆ†ææ¸¸æˆæµé‡ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œä»¥ä¸‹ä»»åŠ¡ï¼š <br><br><ul><li> æ‹¦æˆªç§»åŠ¨è®¾å¤‡çš„æ•°æ®åŒ…ï¼› </li><li> è¿‡æ»¤æ¸¸æˆåŒ…ï¼› </li><li> å°†ä¸‹ä¸€ä¸ªæ•°æ®åŒ…çš„æ•°æ®æ·»åŠ åˆ°ç¼“å†²åŒºè¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ï¼› </li><li> ä»å¡«å……çš„ç¼“å†²åŒºä¸­è·å–æ¸¸æˆäº‹ä»¶ã€‚ </li></ul><br> è¿™äº›åŠ¨ä½œåœ¨<code>Sniffer</code>ç±»ä¸­å®ç°ï¼Œè¯¥ç±»ä½¿ç”¨PcapDotNetåº“æ¥æ‹¦æˆªæ•°æ®åŒ…ã€‚ åœ¨<code>Sniff</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä¼ é€’é€‚é…å™¨çš„IPåœ°å€ï¼ˆå®é™…ä¸Šï¼Œè¿™æ˜¯ä¸ºåŒä¸€ç½‘ç»œå†…çš„ç§»åŠ¨è®¾å¤‡åˆ†é…Wi-Fiçš„PCçš„åœ°å€ï¼‰ï¼Œç§»åŠ¨è®¾å¤‡çš„IPåœ°å€å’ŒæœåŠ¡å™¨IPåœ°å€ã€‚ ç”±äºæœ€åä¸¤ä¸ªä¸ä¸€è‡´ï¼ˆåœ¨ç›‘è§†ä¸åŒå¹³å°å’ŒæœåŠ¡å™¨å‡ ä¸ªæœˆåï¼Œäº‹å®è¯æ˜è¯¥æœåŠ¡å™¨æ˜¯ä»çº¦50ä¸ªæœåŠ¡å™¨çš„æ± ä¸­é€‰æ‹©çš„ï¼Œæ¯ä¸ªæœåŠ¡å™¨ä»å…·æœ‰5-7ä¸ªå¯èƒ½çš„ç«¯å£ï¼‰ï¼Œæˆ‘ä»…ä¼ è¾“å‰ä¸‰ä¸ªå…«ä½ä½ç»„ã€‚ åœ¨<code>IsTargetPacket</code>æ–¹æ³•ä¸­å¯ä»¥çœ‹åˆ°æ­¤è¿‡æ»¤çš„ä½¿ç”¨ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Sniffer</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] _data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[<span class="hljs-number"><span class="hljs-number">4096</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Active { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _adapterIP; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _target; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _server; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>&gt; _serverBuffer; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>&gt; _clientBuffer; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> LivePacketDevice _device = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> PacketCommunicator _communicator = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Action&lt;Event&gt; _eventCallback = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sniff</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ip, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> target, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> server</span></span></span><span class="hljs-function">)</span></span> { _adapterIP = ip; _target = target; _server = server; _serverBuffer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>&gt;(); _clientBuffer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>&gt;(); IList&lt;LivePacketDevice&gt; allDevices = LivePacketDevice.AllLocalMachine; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i != allDevices.Count; ++i) { LivePacketDevice device = allDevices[i]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> address = device.Addresses[<span class="hljs-number"><span class="hljs-number">1</span></span>].Address + <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (address == <span class="hljs-string"><span class="hljs-string">"Internet "</span></span> + _adapterIP) { _device = device; } } _communicator = _device.Open(<span class="hljs-number"><span class="hljs-number">65536</span></span>, PacketDeviceOpenAttributes.Promiscuous, <span class="hljs-number"><span class="hljs-number">1000</span></span>); _communicator.SetFilter(_communicator.CreateFilter(<span class="hljs-string"><span class="hljs-string">"ip and tcp"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Thread(() =&gt; { Thread.CurrentThread.IsBackground = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; BeginReceive(); }).Start(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BeginReceive</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _communicator.ReceivePackets(<span class="hljs-number"><span class="hljs-number">0</span></span>, OnReceive); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { PacketCommunicatorReceiveResult result = _communicator.ReceivePacket(<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> Packet packet); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (result) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> PacketCommunicatorReceiveResult.Timeout: <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> PacketCommunicatorReceiveResult.Ok: OnReceive(packet); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Active); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddEventCallback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action&lt;Event&gt; callback</span></span></span><span class="hljs-function">)</span></span> { _eventCallback = callback; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnReceive</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Packet packet</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Active) { IpV4Datagram ip = packet.Ethernet.IpV4; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsTargetPacket(ip)) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { ParseData(ip); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ObjectDisposedException) { } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (EndOfStreamException e) { Console.WriteLine(e); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>; } } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsTargetPacket</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IpV4Datagram ip</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sourceIp = ip.Source.ToString(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> destIp = ip.Destination.ToString(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (sourceIp != _adapterIP &amp;&amp; destIp != _adapterIP) &amp;&amp; ( (sourceIp.StartsWith(_target) &amp;&amp; destIp.StartsWith(_server)) || (sourceIp.StartsWith(_server) &amp;&amp; destIp.StartsWith(_target)) ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ParseData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IpV4Datagram ip</span></span></span><span class="hljs-function">)</span></span> { TcpDatagram tcp = ip.Tcp; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tcp.Payload != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; tcp.PayloadLength &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> payload = ExtractPayload(tcp); AddToBuffer(ip, payload); ProcessBuffers(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">byte</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExtractPayload</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TcpDatagram tcp</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> payloadLength = tcp.PayloadLength; MemoryStream ms = tcp.Payload.ToMemoryStream(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] payload = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[payloadLength]; ms.Read(payload, <span class="hljs-number"><span class="hljs-number">0</span></span>, payloadLength); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> payload; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddToBuffer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IpV4Datagram ip, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] payload</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ip.Destination.ToString().StartsWith(_target)) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> payload) _serverBuffer.Add(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> payload) _clientBuffer.Add(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessBuffers</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ProcessBuffer(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> _serverBuffer); ProcessBuffer(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> _clientBuffer); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessBuffer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> List&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; buffer</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// TODO } public void Suspend() { Active = false; } public void Resume() { Active = true; } }</span></span></code> </pre><br> å¤ªå¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬æœ‰ä¸¤ä¸ªç¼“å†²åŒºï¼ŒåŒ…å«æ¥è‡ªå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„æ•°æ®åŒ…æ•°æ®ã€‚ å›é¡¾æ¸¸æˆå’ŒæœåŠ¡å™¨ä¹‹é—´äº‹ä»¶çš„æ ¼å¼ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Event</span></span></span><span class="hljs-class"> {</span></span> uint payload_length &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0xFFFF00</span></span>, name=<span class="hljs-string"><span class="hljs-string">"Payload Length"</span></span>&gt;; ushort event_code &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0xFF9988</span></span>, name=<span class="hljs-string"><span class="hljs-string">"Event Code"</span></span>&gt;; byte payload[payload_length] &lt;name=<span class="hljs-string"><span class="hljs-string">"Event Payload"</span></span>&gt;; };</code> </pre><br> åŸºäºæ­¤ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ª<code>Event</code>äº‹ä»¶ç±»ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> EventSource { Client, Server } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> EventTypes : <span class="hljs-keyword"><span class="hljs-keyword">ushort</span></span> { Movement = <span class="hljs-number"><span class="hljs-number">11</span></span>, Ping = <span class="hljs-number"><span class="hljs-number">30</span></span>, Pong = <span class="hljs-number"><span class="hljs-number">31</span></span>, Teleport = <span class="hljs-number"><span class="hljs-number">63</span></span>, EnterDungeon = <span class="hljs-number"><span class="hljs-number">217</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Event</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> ID; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> Length { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ushort</span></span> Type { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> DataLength { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> EventType { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> EventSource Direction { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] _data; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> BinaryReader _br = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Event</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, EventSource direction</span></span></span><span class="hljs-function">)</span></span> { _data = data; _br = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BinaryReader(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemoryStream(_data)); Length = _br.ReadUInt32(); Type = _br.ReadUInt16(); DataLength = <span class="hljs-number"><span class="hljs-number">0</span></span>; EventType = <span class="hljs-string"><span class="hljs-string">$"Unknown (</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Type}</span></span></span><span class="hljs-string">)"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsKnown()) { EventType = ((EventTypes)Type).ToString(); } Direction = direction; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ParseData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsKnown</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Enum.IsDefined(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(EventTypes), Type); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">byte</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetPayload</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasDatLength = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> payloadLength = _data.Length - (hasDatLength ? <span class="hljs-number"><span class="hljs-number">10</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>&gt;(_data).GetRange(hasDatLength ? <span class="hljs-number"><span class="hljs-number">10</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>, payloadLength).ToArray(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> path = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, <span class="hljs-string"><span class="hljs-string">"Packets"</span></span>, EventType); Directory.CreateDirectory(path); File.WriteAllBytes(path + <span class="hljs-string"><span class="hljs-string">$"/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{ID}</span></span></span><span class="hljs-string">.dump"</span></span>, _data); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">$"Type </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Type}</span></span></span><span class="hljs-string">. Data length: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Length}</span></span></span><span class="hljs-string">."</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">ulong</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadVLQ</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> readFlag = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (readFlag) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> flag = _br.ReadByte(); } <span class="hljs-keyword"><span class="hljs-keyword">ulong</span></span> vlq = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; ; i += <span class="hljs-number"><span class="hljs-number">7</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = _br.ReadByte(); vlq |= (<span class="hljs-keyword"><span class="hljs-keyword">ulong</span></span>)(x &amp; <span class="hljs-number"><span class="hljs-number">0x7F</span></span>) &lt;&lt; i; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((x &amp; <span class="hljs-number"><span class="hljs-number">0x80</span></span>) != <span class="hljs-number"><span class="hljs-number">0x80</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vlq; } }</code> </pre><br>  <code>Event</code>ç±»å°†ç”¨ä½œæ¸¸æˆä¸­æ‰€æœ‰äº‹ä»¶çš„åŸºç±»ã€‚ è¿™æ˜¯<code>Ping</code>äº‹ä»¶çš„ç¤ºä¾‹ç±»ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Ping</span></span> : <span class="hljs-title"><span class="hljs-title">Event</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ulong</span></span> _pingTime; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ping</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data, EventSource.Client</span></span></span><span class="hljs-function">)</span></span> { EventType = <span class="hljs-string"><span class="hljs-string">"Ping"</span></span>; DataLength = <span class="hljs-number"><span class="hljs-number">4</span></span>; _pingTime = _br.ReadUInt32(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">$"Pinging server at </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{_pingTime}</span></span></span><span class="hljs-string">ms."</span></span>; } }</code> </pre><br> ç°åœ¨æˆ‘ä»¬æœ‰äº†äº‹ä»¶ç±»ï¼Œæˆ‘ä»¬å¯ä»¥å‘<code>Sniffer</code>æ·»åŠ æ–¹æ³•äº†ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessBuffer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> List&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; buffer</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (buffer.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Active) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (buffer.Count &gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-comment"><span class="hljs-comment">//  4        ... { var eventLength = BitConverter.ToInt32(buffer.Take(4).ToArray(), 0) + 6; // ...    -   .. +  4  + 2    if (eventLength &gt;= 6 &amp;&amp; buffer.Count &gt;= eventLength) { var eventData = buffer.Take(eventLength).ToArray(); var ev = CreateEvent(eventData, direction); buffer.RemoveRange(0, eventLength); continue; } } break; } } } private Event CreateEvent(byte[] data, EventSource direction) { var ev = new Event(data, direction); var eventType = Enum.GetName(typeof(EventTypes), ev.Type); if (eventType != null) { try { //     (, &lt;code&gt;Ping&lt;/code&gt;). var className = "Events." + eventType; Type t = Type.GetType(className); ev = (Event)Activator.CreateInstance(t, data); } catch (Exception) { //     -   . ev = new Event(data, direction); } finally { } } _eventCallback?.Invoke(ev); return ev; }</span></span></code> </pre><br> åˆ›å»ºä¸€ä¸ªå°†è§¦å‘çªƒå¬çš„è¡¨å•ç±»ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MainForm</span></span> : <span class="hljs-title"><span class="hljs-title">Form</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Sniffer _sniffer = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Event&gt; _events = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Event&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">ushort</span></span>&gt; _eventTypesFilter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">ushort</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _showClientEvents = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _showServerEvents = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _showUnknownEvents = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _clearLogsOnRestart = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> _eventId = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeSniffer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _sniffer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Sniffer(); _sniffer.AddEventCallback(NewEventThreaded); _sniffer.Sniff(<span class="hljs-string"><span class="hljs-string">"192.168.137.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"192.168.137."</span></span>, <span class="hljs-string"><span class="hljs-string">"123.45.67."</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NewEventThreaded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Event ev</span></span></span><span class="hljs-function">)</span></span> { events_table.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewEventCallback(NewEvent), ev); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">delegate</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NewEventCallback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Event ev</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NewEvent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Event ev</span></span></span><span class="hljs-function">)</span></span> { ev.ID = _eventId++; _events.Add(ev); LogEvent(ev); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LogEvent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Event ev</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (FilterEvent(ev)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> type = ev.GetType(); events_table.Rows.Add(<span class="hljs-number"><span class="hljs-number">1</span></span>); events_table.Rows[events_table.RowCount - <span class="hljs-number"><span class="hljs-number">1</span></span>].Cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].Value = ev.ID; events_table.Rows[events_table.RowCount - <span class="hljs-number"><span class="hljs-number">1</span></span>].Cells[<span class="hljs-number"><span class="hljs-number">1</span></span>].Value = ev.EventType; events_table.Rows[events_table.RowCount - <span class="hljs-number"><span class="hljs-number">1</span></span>].Cells[<span class="hljs-number"><span class="hljs-number">2</span></span>].Value = Enum.GetName(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(EventSource), ev.Direction); events_table.Rows[events_table.RowCount - <span class="hljs-number"><span class="hljs-number">1</span></span>].Cells[<span class="hljs-number"><span class="hljs-number">3</span></span>].Value = ev.ToString(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReloadEvents</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { events_table.Rows.Clear(); events_table.Refresh(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ev <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _events) { LogEvent(ev); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FilterEvent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Event ev</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( (ev.Direction == EventSource.Client &amp;&amp; _showClientEvents) || (ev.Direction == EventSource.Server &amp;&amp; _showServerEvents) ) &amp;&amp; (_eventTypesFilter.Contains(ev.Type) || (!ev.IsKnown() &amp;&amp; _showUnknownEvents)); } }</code> </pre><br> åšå®Œäº†ï¼ ç°åœ¨ï¼Œæ‚¨å¯ä»¥æ·»åŠ å‡ ä¸ªè¡¨æ¥ç®¡ç†äº‹ä»¶åˆ—è¡¨ï¼ˆé€šè¿‡å®ƒå¡«å……<code>_eventTypesFilter</code> ï¼‰å¹¶å®æ—¶æŸ¥çœ‹ï¼ˆä¸»è¡¨<code>events_table</code> ï¼‰ã€‚ ä¾‹å¦‚ï¼Œæˆ‘æŒ‰ä»¥ä¸‹æ¡ä»¶è¿‡æ»¤ï¼ˆ <code>FilterEvent</code>æ–¹æ³•ï¼‰ï¼š <br><br><ul><li> æ˜¾ç¤ºæ¥è‡ªå®¢æˆ·çš„äº‹ä»¶ï¼› </li><li> æ˜¾ç¤ºæ¥è‡ªæœåŠ¡å™¨çš„äº‹ä»¶ï¼› </li><li> æ˜¾ç¤ºæœªçŸ¥äº‹ä»¶ï¼› </li><li> æ˜¾ç¤ºé€‰å®šçš„å·²çŸ¥äº‹ä»¶ã€‚ </li></ul><br><h3> å­¦ä¹ æ¸¸æˆå¯æ‰§è¡Œæ–‡ä»¶ </h3><br> å°½ç®¡ç°åœ¨å¯ä»¥æ¯«æ— é—®é¢˜åœ°åˆ†ææ¸¸æˆä¸­çš„äº‹ä»¶ï¼Œä½†æ˜¯è¦è¿›è¡Œå¤§é‡çš„äººå·¥å·¥ä½œä¸ä»…è¦ç¡®å®šæ‰€æœ‰äº‹ä»¶ä»£ç çš„å«ä¹‰ï¼Œè¿˜è¦ç¡®å®šæœ‰æ•ˆè½½è·çš„ç»“æ„ï¼Œè¿™å°†éå¸¸å›°éš¾ï¼Œå°¤å…¶æ˜¯å½“å®ƒæ ¹æ®æŸäº›é¢†åŸŸè€Œå˜åŒ–æ—¶ã€‚ æˆ‘å†³å®šåœ¨æ¸¸æˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­å¯»æ‰¾ä¸€äº›ä¿¡æ¯ã€‚ ç”±äºæ¸¸æˆæ˜¯è·¨å¹³å°çš„ï¼ˆåœ¨Windowsï¼ŒiOSå’ŒAndroidä¸Šå¯ç”¨ï¼‰ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ä»¥ä¸‹é€‰é¡¹è¿›è¡Œåˆ†æï¼š <br><br><ul><li>  .exeæ–‡ä»¶ï¼ˆæˆ‘ä½äºè·¯å¾„Cï¼š/ç¨‹åºæ–‡ä»¶/ WindowsApps /ï¼…appnameï¼…/; </li><li>  AppleåŠ å¯†çš„äºŒè¿›åˆ¶iOSæ–‡ä»¶ï¼Œä½†æ˜¯ä½¿ç”¨JailBreakå¯ä»¥ä½¿ç”¨Crackulousæˆ–ç±»ä¼¼å·¥å…·è·å–è§£å¯†çš„ç‰ˆæœ¬ï¼› </li><li>  Androidå…±äº«åº“ å®ƒä½äºè·¯å¾„/ data / data /ï¼…app-vendor-nameï¼…/ lib /ã€‚ </li></ul><br> ä¸çŸ¥é“è¦ä¸ºAndroidå’ŒiOSé€‰æ‹©å“ªç§ä½“ç³»ç»“æ„ï¼Œæˆ‘ä»ä¸€ä¸ª.exeæ–‡ä»¶å¼€å§‹ã€‚ æˆ‘ä»¬å°†äºŒè¿›åˆ¶æ–‡ä»¶åŠ è½½åˆ°IDAä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†æ¶æ„çš„é€‰æ‹©ã€‚ <br><br><img src="https://habrastorage.org/webt/jb/q6/vh/jbq6vhlp9nqovpae87uka5jrof0.png"><br><br> æˆ‘ä»¬æœç´¢çš„ç›®çš„æ˜¯ä¸€äº›éå¸¸æœ‰ç”¨çš„è¡Œï¼Œè¿™æ„å‘³ç€è®¡åˆ’ä¸­ä¸åŒ…æ‹¬åæ±‡ç¼–ç¨‹åºï¼Œä½†æ˜¯ä¸ºäº†é˜²ä¸‡ä¸€ï¼Œè¯·é€‰æ‹©â€œå¯æ‰§è¡Œ80386â€ï¼Œå› ä¸ºâ€œäºŒè¿›åˆ¶æ–‡ä»¶â€å’Œâ€œ MS-DOSå¯æ‰§è¡Œæ–‡ä»¶â€é€‰é¡¹æ˜¾ç„¶ä¸åˆé€‚ã€‚ å•å‡»â€œç¡®å®šâ€ï¼Œç­‰å¾…æ–‡ä»¶åŠ è½½åˆ°æ•°æ®åº“ä¸­ï¼Œå»ºè®®ç­‰å¾…æ–‡ä»¶åˆ†æå®Œæˆã€‚ é€šè¿‡åœ¨å·¦ä¸‹æ–¹çš„çŠ¶æ€æ ä¸­æ˜¾ç¤ºä»¥ä¸‹çŠ¶æ€ï¼Œå¯ä»¥å‘ç°åˆ†æç»“æŸï¼š <br><br><img src="https://habrastorage.org/webt/yk/__/fb/yk__fbdgrskjle8c5zf6ro0q_f8.png"><br><br> è½¬åˆ°â€œå­—ç¬¦ä¸²â€é€‰é¡¹å¡ï¼ˆâ€œæŸ¥çœ‹/æ‰“å¼€å­è§†å›¾/å­—ç¬¦ä¸²â€æˆ–<code>Shift + F12</code> ï¼‰ã€‚ çº¿è·¯ç”Ÿæˆè¿‡ç¨‹å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ã€‚ å°±æˆ‘è€Œè¨€ï¼Œæ‰¾åˆ°äº†çº¦47kæ¡çº¿ã€‚ å­—ç¬¦ä¸²ä½ç½®çš„åœ°å€çš„å‰ç¼€ä¸º<code>.data</code> ï¼Œ <code>.rdata</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç­‰</a>å½¢å¼ã€‚ å°±æˆ‘è€Œè¨€ï¼Œæ‰€æœ‰â€œæœ‰è¶£â€è¡Œéƒ½ä½äº<code>.rdata</code>èŠ‚ä¸­ï¼Œå…¶å¤§å°çº¦ä¸º44.5kæ¡è®°å½•ã€‚ æŸ¥çœ‹è¡¨æ ¼ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ï¼š <br><br><ul><li> ç™»å½•é˜¶æ®µçš„é”™è¯¯æ¶ˆæ¯å’ŒæŸ¥è¯¢æ®µï¼› </li><li> æ¸¸æˆï¼Œæ¸¸æˆå¼•æ“ï¼Œç•Œé¢çš„é”™è¯¯å­—ç¬¦ä¸²å’Œåˆå§‹åŒ–ä¿¡æ¯ï¼› </li><li> å¾ˆå¤šåƒåœ¾ï¼› </li><li> å®¢æˆ·ç«¯çš„æ¸¸æˆæ¡Œæ¸…å•ï¼› </li><li> æ¸¸æˆä¸­æ¸¸æˆå¼•æ“çš„ä½¿ç”¨ä»·å€¼ï¼› </li><li> æ•ˆæœæ¸…å•ï¼› </li><li> æ¥å£æœ¬åœ°åŒ–é”®çš„å¤§é‡åˆ—è¡¨ï¼› </li><li> ç­‰ </li></ul><br> æœ€åï¼Œæˆ‘ä»¬æ­£åœ¨å¯»æ‰¾æ¥è¿‘è¡¨æ ¼æœ«å°¾çš„å†…å®¹ã€‚ <br><br><img src="https://habrastorage.org/webt/ua/jr/sw/uajrsw8i71x33xuhyhmzonprqku.png"><br><br> è¿™æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„äº‹ä»¶ä»£ç çš„åˆ—è¡¨ã€‚ è§£ææ¸¸æˆçš„ç½‘ç»œåè®®æ—¶ï¼Œè¿™å¯ä»¥ç®€åŒ–æˆ‘ä»¬çš„ç”Ÿæ´»ã€‚ ä½†æ˜¯æˆ‘ä»¬ä¸ä¼šæ­¢æ­¥äºæ­¤ï¼ æœ‰å¿…è¦æ£€æŸ¥æ˜¯å¦æœ‰å¯èƒ½ä»¥æŸç§æ–¹å¼è·å¾—äº‹ä»¶ä»£ç çš„æ•°å€¼ã€‚ æˆ‘ä»¬ä»ä»¥å‰çš„ä»£ç <code>CMSG_PING</code>å’Œ<code>SMSG_PONG</code>çœ‹åˆ°â€œç†Ÿæ‚‰çš„â€ï¼Œåˆ†åˆ«æ˜¯ä»£ç 30ï¼ˆ <code>1E <sub>16</sub></code> ï¼‰å’Œ31ï¼ˆ <code>1F <sub>16</sub></code> ï¼‰ã€‚ åŒå‡»è¯¥è¡Œä»¥è½¬åˆ°ä»£ç ä¸­çš„è¯¥ä½ç½®ã€‚ <br><br><img src="https://habrastorage.org/webt/la/ro/wj/larowjnopxrmyc53htrzo_-_2zi.png"><br><br> å®é™…ä¸Šï¼Œç´§æ¥åœ¨ä»£ç çš„å­—ç¬¦ä¸²å€¼ä¹‹åçš„æ˜¯<code>0x10 0x1E</code>å’Œ<code>0x10 0x1F</code>çš„åºåˆ—ã€‚ å¥½å§ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥è§£ææ•´ä¸ªè¡¨å¹¶è·å–äº‹ä»¶åŠå…¶æ•°å€¼çš„åˆ—è¡¨ï¼Œè¿™å°†è¿›ä¸€æ­¥ç®€åŒ–åè®®çš„åˆ†æã€‚ <br><br> ä¸å¹¸çš„æ˜¯ï¼Œæ¸¸æˆçš„Windowsç‰ˆæœ¬æ¯”ç§»åŠ¨ç‰ˆæœ¬è½åå¾ˆå¤šç‰ˆæœ¬ï¼Œå› æ­¤.exeä¸­çš„ä¿¡æ¯æ— å…³ç´§è¦ï¼Œå°½ç®¡å®ƒå¯ä»¥æä¾›å¸®åŠ©ï¼Œä½†æ‚¨ä¸åº”å®Œå…¨ä¾èµ–å®ƒã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘å†³å®šä½¿ç”¨Androidç ”ç©¶åŠ¨æ€åº“ï¼Œæ­£å¦‚æˆ‘åœ¨ä¸€ä¸ªè®ºå›ä¸Šçœ‹åˆ°çš„é‚£æ ·ï¼Œä¸iOSäºŒè¿›åˆ¶æ–‡ä»¶ä¸åŒï¼Œè¯¥è®ºå›åŒ…å«è®¸å¤šæœ‰å…³ç±»çš„å…ƒä¿¡æ¯ã€‚ ä½†å¯æƒœçš„æ˜¯ï¼Œåœ¨<code>CMSG_PING</code>å€¼<code>CMSG_PING</code>è¿›è¡Œçš„æœç´¢æœªè¿”å›ç»“æœã€‚ <br><br> æ¯«æ— å¸Œæœ›ï¼Œæˆ‘æ­£åœ¨iOSäºŒè¿›åˆ¶æ–‡ä»¶ä¸­è¿›è¡Œç›¸åŒçš„æœç´¢-ä»¤äººéš¾ä»¥ç½®ä¿¡ï¼Œä½†äº‹å®è¯æ˜ä¸.exeä¸­çš„æ•°æ®ç›¸åŒï¼ å°†æ–‡ä»¶ä¸Šä¼ åˆ°IDAã€‚ <br><br><img src="https://habrastorage.org/webt/la/ro/wj/larowjnopxrmyc53htrzo_-_2zi.png"><br><br> æˆ‘é€‰æ‹©ç¬¬ä¸€ä¸ªå»ºè®®çš„é€‰é¡¹ï¼Œå› ä¸ºæˆ‘ä¸ç¡®å®šéœ€è¦å“ªä¸ªã€‚ åŒæ ·ï¼Œæˆ‘ä»¬æ­£åœ¨ç­‰å¾…æ–‡ä»¶åˆ†æçš„ç»“æŸï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶.exeçš„å¤§å°å‡ ä¹å¢åŠ äº†4å€ï¼Œåˆ†ææ—¶é—´å½“ç„¶ä¹Ÿå¢åŠ äº†ï¼‰ã€‚ æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªå¸¦çº¿çš„çª—å£ï¼Œè¿™æ¬¡ç»“æœæ˜¯51kã€‚ é€šè¿‡<code>Ctrl + F</code>æˆ‘ä»¬å¯»æ‰¾<code>CMSG_PING</code>è€Œ...æˆ‘ä»¬æ‰¾ä¸åˆ°å®ƒã€‚ é€å­—ç¬¦è¾“å…¥ä»£ç ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°ä»¥ä¸‹ç»“æœï¼š <br><br><img src="https://habrastorage.org/webt/jk/rz/be/jkrzbe0uvyj2vi2fxphnldc_vki.png"><br><br> ç”±äºæŸç§åŸå› ï¼ŒIDAå°†æ•´ä¸ª<code>Opcode.proto</code>å¯¹è±¡æ”¾åœ¨ä¸€è¡Œä¸­ã€‚ åŒå‡»ä»£ç ä¸­çš„è¯¥ä½ç½®ï¼Œå¯ä»¥çœ‹åˆ°è¯¥ç»“æ„çš„æè¿°ä¸.exeæ–‡ä»¶ä¸­çš„æè¿°ç›¸åŒï¼Œå› æ­¤å¯ä»¥å¯¹å…¶è¿›è¡Œå‰ªåˆ‡å¹¶å°†å…¶è½¬æ¢ä¸º<code>Enum</code> ã€‚ <br><br> æœ€åï¼Œå€¼å¾—å›æƒ³ä¸€ä¸‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">aml</a>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« çš„è¯„è®ºä¸­å¦‚ä½•å»ºè®®æ¸¸æˆçš„æ¶ˆæ¯ç»“æ„æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Protocol Buffers</a>çš„å®ç°ã€‚ å¦‚æœä»”ç»†æŸ¥çœ‹äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„ä»£ç ï¼Œæ‚¨ä¼šå‘ç°<code>Opcode</code>è¯´æ˜ä¹Ÿé‡‡ç”¨è¿™ç§æ ¼å¼ã€‚ <br><br><img src="https://habrastorage.org/webt/a6/pl/bk/a6plbk-pb8ldifrvha6qfqmh0oi.png"><br><br> æˆ‘ä»¬å°†ä¸º010Editorç¼–å†™ä¸€ä¸ªè§£æå™¨æ¨¡æ¿ï¼Œä»¥è·å–æ‰€æœ‰ä»£ç å€¼ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">æ›´æ–°äº†010Editorçš„æ‰“åŒ…*ç±»å‹ä»£ç </b> <div class="spoiler_text"> è¾ƒå°çš„ç±»å‹æ›´æ”¹åŒ…å«å­—æ®µæ ‡ç­¾éªŒè¯ä»¥è·³è¿‡ä¸¢å¤±çš„æ ‡ç­¾ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">uint </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PeekTag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (FTell() == FileSize()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } Varint tag; FSkip(-tag.size); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tag._ &gt;&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>; } <span class="hljs-function"><span class="hljs-function">struct </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Packed</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint fieldNumber)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (PeekTag() != fieldNumber) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } Varint key &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0xFFBB00</span></span>&gt;; local uint wiredType = key._ &amp; <span class="hljs-number"><span class="hljs-number">0x7</span></span>; local uint field = key._ &gt;&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>; local uint size = key.size; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (wiredType) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> value; size += <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> value; size += <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: Varint value; size += value.size; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }; <span class="hljs-function"><span class="hljs-function">struct </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PackedString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint fieldNumber)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (PeekTag() != fieldNumber) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-function"><span class="hljs-function">Packed </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fieldNumber)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> str[length.value._]; };</code> </pre><br></div></div><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Code</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-function">Packed </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> &lt;bgcolor</span></span>=<span class="hljs-number"><span class="hljs-number">0x00FF00</span></span>&gt;; <span class="hljs-function"><span class="hljs-function">PackedString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">code_name</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> &lt;bgcolor</span></span>=<span class="hljs-number"><span class="hljs-number">0x00FF00</span></span>&gt;; <span class="hljs-function"><span class="hljs-function">Packed </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">code_value</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> &lt;bgcolor</span></span>=<span class="hljs-number"><span class="hljs-number">0x00FF00</span></span>&gt;; Printf(<span class="hljs-string"><span class="hljs-string">"%s = %d,\n"</span></span>, code_name.str, code_value.value._); <span class="hljs-comment"><span class="hljs-comment">//        Enum }; struct Property { Packed size(5) &lt;bgcolor=0x00FF00&gt;; PackedString prop_name(1) &lt;bgcolor=0x00FF00&gt;; while (FTell() - 0x176526B - prop_name.length.value._ &lt; size.value._) { Code codes &lt;name="Codes"&gt;; } }; struct { FSkip(0x176526B); PackedString object(1) &lt;bgcolor=0x00FF00&gt;; PackedString format(2) &lt;bgcolor=0x00FFFF&gt;; Property prop; } file;</span></span></code> </pre><br> ç»“æœæ˜¯è¿™æ ·çš„ï¼š <br><br><img src="https://habrastorage.org/webt/n5/ge/1d/n5ge1dnylry0n2tdskxrvqg9zmy.png"><br><br> æ›´æœ‰è¶£ï¼ åœ¨å¯¹è±¡è¯´æ˜ä¸­æ³¨æ„åˆ°äº†<code>pb</code> ï¼Ÿ æœ‰å¿…è¦å¯»æ‰¾å…¶ä»–è¡Œï¼Œçªç„¶æœ‰å¾ˆå¤šè¿™æ ·çš„å¯¹è±¡ï¼Ÿ <br><br><img src="https://habrastorage.org/webt/wf/cp/fx/wfcpfxmh1c6vhwycv9jnp4k9wle.png"><br><br> ç»“æœéå¸¸å‡ºä¹æ„æ–™ã€‚ æ˜¾ç„¶ï¼Œæ¸¸æˆçš„å¯æ‰§è¡Œæ–‡ä»¶æè¿°äº†å¤šç§ç±»å‹çš„æ•°æ®ï¼ŒåŒ…æ‹¬æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„æšä¸¾å’Œæ¶ˆæ¯æ ¼å¼ã€‚ è¿™æ˜¯ä¸€ä¸ªæè¿°ç±»å‹çš„ç¤ºä¾‹ï¼Œè¯¥ç±»å‹æè¿°äº†å¯¹è±¡åœ¨ä¸–ç•Œä¸Šçš„ä½ç½®ï¼š <br><br><img src="https://habrastorage.org/webt/jl/br/ix/jlbrixdyltdfgfmzkdoxvl038eg.png"><br><br> å¿«é€Ÿæœç´¢å‘ç°äº†ä¸¤ä¸ªå¸¦æœ‰ç±»å‹æè¿°çš„å¤§åœ°æ–¹ï¼Œå°½ç®¡ä»”ç»†æ£€æŸ¥å¯èƒ½ä¼šå‘ç°å…¶ä»–å°åœ°æ–¹ã€‚ åˆ‡æ‰å®ƒä»¬ä¹‹åï¼Œæˆ‘ç”¨Cï¼ƒç¼–å†™äº†ä¸€ä¸ªå°è„šæœ¬ï¼Œä»¥æŒ‰æ–‡ä»¶å°†æè¿°åˆ†å¼€ï¼ˆç»“æ„ä¸Šç±»ä¼¼äºäº‹ä»¶ä»£ç åˆ—è¡¨çš„æè¿°ï¼‰-åœ¨010Editorä¸­åˆ†æå®ƒä»¬æ›´å®¹æ˜“ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> br = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BinaryReader(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileStream(<span class="hljs-string"><span class="hljs-string">"./BinaryFile.partX"</span></span>, FileMode.Open)); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (br.BaseStream.Position &lt; br.BaseStream.Length) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> startOffset = br.BaseStream.Position; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> length = ReadVLQ(br, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tag = br.ReadByte(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventName = br.ReadString(); br.BaseStream.Position = startOffset; File.WriteAllBytes(<span class="hljs-string"><span class="hljs-string">$"./parsed/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{eventName}</span></span></span><span class="hljs-string">"</span></span>, br.ReadBytes((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)length + size + <span class="hljs-number"><span class="hljs-number">1</span></span>)); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">ulong</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadVLQ</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BinaryReader br, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">out</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> flag = br.ReadByte(); <span class="hljs-keyword"><span class="hljs-keyword">ulong</span></span> vlq = <span class="hljs-number"><span class="hljs-number">0</span></span>; size = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; ; i += <span class="hljs-number"><span class="hljs-number">7</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = br.ReadByte(); vlq |= (<span class="hljs-keyword"><span class="hljs-keyword">ulong</span></span>)(x &amp; <span class="hljs-number"><span class="hljs-number">0x7F</span></span>) &lt;&lt; i; size++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((x &amp; <span class="hljs-number"><span class="hljs-number">0x80</span></span>) != <span class="hljs-number"><span class="hljs-number">0x80</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vlq; } }</code> </pre><br> æˆ‘å°†ä¸åˆ†æç”¨äºè¯¦ç»†æè¿°ç»“æ„çš„æ ¼å¼ï¼Œå› ä¸º å®ƒæ˜¯é’ˆå¯¹ç‰¹å®šæ¸¸æˆçš„ï¼Œè¿˜æ˜¯<code>Protocol Buffers</code>æ™®éæ¥å—çš„æ ¼å¼ï¼ˆå¦‚æœæœ‰äººç¡®å®šï¼Œè¯·åœ¨è¯„è®ºä¸­æŒ‡å‡ºï¼‰ã€‚ ä»æˆ‘èƒ½å‘ç°çš„ï¼š <br><br><ul><li> æè¿°ä¹Ÿä»¥<code>Protocol Buffers</code>æ ¼å¼å‡ºç°ï¼› </li><li> æ¯ä¸ªå­—æ®µçš„æè¿°å‡åŒ…å«å…¶åç§°ï¼Œæ•°å­—å’Œæ•°æ®ç±»å‹ï¼Œå¹¶ä¸ºå…¶ä½¿ç”¨äº†è‡ªå·±çš„ç±»å‹è¡¨ï¼š <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TypeToStr</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint type)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Float"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"UInt64"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"UInt32"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Boolean"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"String"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Struct"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Enum"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: local <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> s; SPrintf(s, <span class="hljs-string"><span class="hljs-string">"%Lu"</span></span>, type); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> s; } };</code> </pre></li><li> å¦‚æœæ•°æ®ç±»å‹æ˜¯æšä¸¾æˆ–ç»“æ„ï¼Œåˆ™å­˜åœ¨æŒ‡å‘æ‰€éœ€å¯¹è±¡çš„é“¾æ¥ã€‚ </li></ul><br> å¥½å§ï¼Œå¯¹æˆ‘ä»¬æ¥è¯´ï¼Œå‰©ä¸‹çš„æœ€åä¸€ä»¶äº‹å°±æ˜¯ä½¿ç”¨åœ¨ä¾¦å¬åº”ç”¨ç¨‹åºä¸­æ”¶åˆ°çš„ä¿¡æ¯ï¼šä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>protobuf-net</code></a>åº“è§£ææ¶ˆæ¯ã€‚ é€šè¿‡NuGetè¿æ¥åº“ï¼Œ <code>using ProtoBuf;</code>æ·»åŠ <code>using ProtoBuf;</code> æ‚¨å¯ä»¥åˆ›å»ºç”¨äºæè¿°æ¶ˆæ¯çš„ç±»ã€‚ ä»¥ä¸Šä¸€ç¯‡æ–‡ç« ä¸ºä¾‹ï¼šè§’è‰²ç§»åŠ¨ã€‚ çªå‡ºæ˜¾ç¤ºç»†åˆ†æ—¶ï¼Œæ ¼å¼çš„æ ¼å¼è¯´æ˜å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><img src="https://habrastorage.org/webt/ce/qg/py/ceqgpyfbuxygvoqx4jnlp8slumy.png"><br><br> è°ƒè¯•è¾“å‡ºä½¿æ‚¨å¯ä»¥ä»ä¸­åˆ›å»ºç®€çŸ­æè¿°ï¼š <br><br><pre> <code class="plaintext hljs">Field 1 (Type 13): time Field 2 (Struct .pb.CxGS_Vec3): position Field 3 (UInt64): guid Field 4 (Struct .pb.CxGS_Vec3): direction Field 5 (Struct .pb.CxGS_Vec3): speed Field 6 (UInt32): state Field 10 (UInt32): flag Field 11 (Float): y_speed Field 12 (Boolean): is_flying Field 7 (UInt32): emote_id Field 9 (UInt32): emote_duration Field 8 (Boolean): emote_loop</code> </pre><br> ç°åœ¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>protobuf-net</code>åº“åˆ›å»ºé€‚å½“çš„ç±»ã€‚ <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ProtoContract</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MoveInfo</span></span> : <span class="hljs-title"><span class="hljs-title">ProtoBufEvent</span></span>&lt;<span class="hljs-title"><span class="hljs-title">MoveInfo</span></span>&gt; { [ProtoMember(<span class="hljs-number"><span class="hljs-number">3</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ulong</span></span> GUID; [ProtoMember(<span class="hljs-number"><span class="hljs-number">1</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ulong</span></span> Time; [ProtoMember(<span class="hljs-number"><span class="hljs-number">2</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vec3 Position; [ProtoMember(<span class="hljs-number"><span class="hljs-number">4</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vec3 Direction; [ProtoMember(<span class="hljs-number"><span class="hljs-number">5</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vec3 Speed; [ProtoMember(<span class="hljs-number"><span class="hljs-number">6</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ulong</span></span> State; [ProtoMember(<span class="hljs-number"><span class="hljs-number">7</span></span>, IsRequired = <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> EmoteID; [ProtoMember(<span class="hljs-number"><span class="hljs-number">8</span></span>, IsRequired = <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> EmoteLoop; [ProtoMember(<span class="hljs-number"><span class="hljs-number">9</span></span>, IsRequired = <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> EmoteDuration; [ProtoMember(<span class="hljs-number"><span class="hljs-number">10</span></span>, IsRequired = <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> Flag; [ProtoMember(<span class="hljs-number"><span class="hljs-number">11</span></span>, IsRequired = <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> SpeedY; [ProtoMember(<span class="hljs-number"><span class="hljs-number">12</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsFlying; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{GUID}</span></span></span><span class="hljs-string">: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Position}</span></span></span><span class="hljs-string">"</span></span>; } }</code> </pre><br> ä¸ºäº†è¿›è¡Œæ¯”è¾ƒï¼Œè¿™æ˜¯ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ç›¸åŒäº‹ä»¶çš„æ¨¡æ¿ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MoveEvent</span></span></span><span class="hljs-class"> {</span></span> uint data_length &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FF00</span></span>, name=<span class="hljs-string"><span class="hljs-string">"Data Length"</span></span>&gt;; Packed move_time &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FFFF</span></span>&gt;; PackedVector3 position &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FF00</span></span>&gt;; PackedVector3 direction &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FF00</span></span>&gt;; PackedVector3 speed &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FF00</span></span>&gt;; Packed state &lt;bgcolor=<span class="hljs-number"><span class="hljs-number">0x00FF00</span></span>&gt;; };</code> </pre><br> åœ¨ç»§æ‰¿<code>Event</code>ç±»æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ååºåˆ—åŒ–åŒ…æ•°æ®æ¥è¦†ç›–<code>ParseData</code>æ–¹æ³•ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CMSG_MOVE_INFO</span></span> : <span class="hljs-title"><span class="hljs-title">Event</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MoveInfo _message; [...] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ParseData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _message = MoveInfo.Deserialize(GetPayload()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _message.ToString(); } }</code> </pre><br> ä»…æ­¤è€Œå·²ã€‚ ä¸‹ä¸€æ­¥æ˜¯å°†æ¸¸æˆæµé‡é‡å®šå‘åˆ°æˆ‘ä»¬çš„ä»£ç†æœåŠ¡å™¨ï¼Œä»¥è¿›è¡Œæ³¨å…¥ï¼Œæ¬ºéª—å’Œå‰Šå‡ç¨‹åºåŒ…ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN457480/">https://habr.com/ru/post/zh-CN457480/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN457464/index.html">Yandex.Realæˆ¿åœ°äº§ä¸Šçš„å¹¿å‘Šé‡å¤æ•°æ®åˆ é™¤</a></li>
<li><a href="../zh-CN457466/index.html">æˆ‘ä»¬å¦‚ä½•åœ¨Leroy Merlinå¼€å‘ITï¼šåœ¨æ—…é€”ä¸­é‡å»ºå¼•æ“</a></li>
<li><a href="../zh-CN457468/index.html">é€šç”¨å†…å­˜ï¼šSRAMï¼ŒDRAMå’Œé—ªå­˜è£…åœ¨ä¸€ç“¶ä¸­</a></li>
<li><a href="../zh-CN457470/index.html">å¶å­æ•°å­¦ï¼šä¸€ä¸ªä¸å¯»å¸¸çš„çŒæœ¨ä¸›å¦‚ä½•æ”¹å˜æ¤ç‰©ç”Ÿé•¿æ¨¡å‹çš„æ–¹ç¨‹å¼</a></li>
<li><a href="../zh-CN457476/index.html">ä½¿ç”¨Spring Bootåº”ç”¨ç¨‹åºå‡å°‘Dockeræ˜ åƒçš„å¤§å°</a></li>
<li><a href="../zh-CN457490/index.html">æ‰å…‹ä¼¯æ ¼çš„Aisioshechka-ç®€è¦ä»‹ç»å¤©ç§¤åº§æ¡ˆä»¶</a></li>
<li><a href="../zh-CN457496/index.html">â€œæ‰¾åˆ°äº”ä¸ªå·®å¼‚ã€‚â€ å¯æ‰©å±•æ€§å’Œä¸–ä»£å·®å¼‚-æ–°ä¸€æ‰¹æµ‹è¯•</a></li>
<li><a href="../zh-CN457500/index.html">æˆ‘ä»¬å¦‚ä½•ä¸ºæœåŠ¡ç«™è¿›è¡Œè‡ªåŠ¨é©¾é©¶</a></li>
<li><a href="../zh-CN457508/index.html">è‚²å„¿ä¸æœºå™¨å­¦ä¹ ï¼šæ¯”è¾ƒå¹´è½»çš„æ¯äº²</a></li>
<li><a href="../zh-CN457510/index.html">ä½¿ç”¨mcrouteræ¥æ°´å¹³æ‰©å±•memcached</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>