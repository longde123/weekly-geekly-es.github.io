<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📝 ↗️ 👩‍💻 Inicie você mesmo, a primavera está chegando (Parte 1) 🔆 📖 💯</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Evgeny EvgenyBorisov Borisov (NAYA Technologies) e Kirill tolkkv Tolkachev (Cyan.Finance, Twitter ) falam sobre os momentos mais importantes e interes...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Inicie você mesmo, a primavera está chegando (Parte 1)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/424503/"> Evgeny <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">EvgenyBorisov</a> Borisov (NAYA Technologies) e Kirill <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">tolkkv</a> Tolkachev (Cyan.Finance, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Twitter</a> ) falam sobre os momentos mais importantes e interessantes do Spring Boot no exemplo de um iniciante para um imaginário Iron Bank. <br><br><img src="https://habrastorage.org/webt/wj/p5/pf/wjp5pfvfgcnp_mda9gcpuiln3zs.png"><br><br>  O artigo é baseado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">relatório de</a> Eugene e Cyril da nossa conferência Joker 2017. Abaixo do corte, está a transcrição em vídeo e texto do relatório. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/yy43NOreJG4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  A conferência Joker é patrocinada por muitos bancos, então vamos imaginar que o aplicativo no qual estudaremos o trabalho da bota Spring e o iniciador que criamos esteja conectado ao banco. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6b9/6b3/735/6b96b3735385c3774928851319b3569c.png"><br><br>  Portanto, suponha que um pedido seja recebido para um pedido do Banco de Ferro de Bravos.  Um banco comum simplesmente transfere dinheiro para frente e para trás.  Por exemplo, assim (temos uma API para isso): <br><br> <code>http://localhost:8080/credit\?name\=Targarian\&amp;amount\=100 <br></code> <br>  E no Iron Bank, antes de transferir dinheiro, é necessário que a API do banco calcule se uma pessoa pode devolvê-lo.  Talvez ele não sobreviva ao inverno e não haja ninguém para voltar.  Portanto, é fornecido um serviço que verifica a confiabilidade. <br><br>  Por exemplo, se tentarmos transferir dinheiro para Targaryen, a operação será aprovada: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cc1/d3b/c67/cc1d3bc67ae34759c85b4cae57189037.png"><br><br>  Mas se Stark, então não: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a65/453/a4d/a65453a4dc6bf6a0490cbbdaadf78404.png"><br><br>  Não é de admirar: os Starks morrem com muita frequência.  Por que transferir dinheiro se uma pessoa não sobrevive ao inverno? <br><br>  Vamos ver como fica por dentro. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RestController</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequiredArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronBankController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> TransferMoneyService transferMoney; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> MoneyDao moneyDao; <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/credit"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">credit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@RequestParam String name, @RequestParam </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> amount)</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> resultedDeposit = transferMoney.transfer(name, amount);   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resultedDeposit == -<span class="hljs-number"><span class="hljs-number">1</span></span>) {     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Rejected&lt;br/&gt;"</span></span> + name + <span class="hljs-string"><span class="hljs-string">" &lt;b&gt;will`t&lt;/b&gt; survive this winter"</span></span>;   }   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> format(       <span class="hljs-string"><span class="hljs-string">"&lt;i&gt;Credit approved for %s&lt;/i&gt; &lt;br/&gt;Current  bank balance: &lt;b&gt;%s&lt;/b&gt;"</span></span>,       name,       resultedDeposit   ); } <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/state"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currentState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> moneyDao.findAll().get(<span class="hljs-number"><span class="hljs-number">0</span></span>).getTotalAmount(); } }</code> </pre><br>  Este é um controlador de string comum. <br><br>  Quem é responsável pela lógica da escolha, a quem conceder um empréstimo e a quem - não?  Linha simples: se seu nome é Stark, certamente não o traímos.  Em outros casos - que sorte.  Banco comum. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Service</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NameBasedProphetService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProphetService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">willSurvive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !name.contains(<span class="hljs-string"><span class="hljs-string">"Stark"</span></span>) &amp;&amp; ThreadLocalRandom.current().nextBoolean(); } }</code> </pre><br>  Tudo o resto não é tão interessante.  Estas são algumas anotações que fazem todo o trabalho para nós.  Tudo é muito rápido. <br><br>  Onde estão todas as principais configurações?  Existe apenas um controlador.  No Dao, geralmente é uma interface vazia. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MoneyDao</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bank</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ }</code> </pre><br>  Em serviços - apenas serviços de tradução e previsão para quem você pode emitir.  Não há diretório Conf.  De fato, temos apenas application.yml (uma lista daqueles que pagam dívidas).  E main é o mais comum: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(ProphetProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MoneyRavenApplication</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{   SpringApplication.run(MoneyRavenApplication.class, args); } }</code> </pre><br>  Então, onde está toda a mágica escondida? <br><br>  O fato é que os desenvolvedores não gostam de pensar em dependências, configurar configurações, especialmente se forem configurações XML, e pensar em como o aplicativo é iniciado.  Portanto, o Spring Boot resolve esses problemas para nós.  Nós só precisamos escrever um aplicativo. <br><br><h2>  Dependências </h2><br>  O primeiro problema que sempre tivemos é um conflito de versão.  Sempre que conectamos bibliotecas diferentes que fazem referência a outras bibliotecas, aparecem conflitos de dependência.  Toda vez que leio na Internet que preciso adicionar algum gerente de entidade, surge uma pergunta e qual versão devo adicionar para que não quebre nada? <br><br>  O Spring Boot resolve o problema dos conflitos de versão. <br><br>  Como geralmente obtemos um projeto Spring Boot (se não chegamos a algum lugar onde ele já existe)? <br><br><ul><li>  ou vá para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">start.spring.io</a> , marque as caixas de seleção que Josh Long nos ensinou a configurar, clique no Download Project e abra o projeto onde tudo já está lá; <br></li><li>  ou use o IntelliJ, onde, graças à opção exibida, as caixas de seleção no Spring Initializer podem ser definidas a partir daí. <br></li></ul><br>  Se trabalharmos com o Maven, o projeto terá o pom.xml, onde existe um pai Spring Boot chamado <code>spring-boot-dependencies</code> .  Haverá um enorme bloco de gerenciamento de dependências. <br><br>  Não vou entrar nos detalhes do Maven agora.  Apenas duas palavras. <br><br>  O bloco de gerenciamento de dependências não registra dependências.  Este é um bloco com o qual você pode especificar versões caso essas dependências sejam necessárias.  E quando você indica algum tipo de dependência no bloco de gerenciamento de dependências sem especificar a versão, o Maven começa a procurar se existe um bloco de gerenciamento de dependências no qual pai esta versão está escrita no pom pai ou em outro lugar.  I.e.  no meu projeto, adicionando uma nova dependência, não indicarei mais a versão na esperança de que seja indicada em algum lugar no pai.  E se não for especificado no pai, certamente não criará nenhum conflito com ninguém.  Em nosso gerenciamento de dependências, boas quinhentas dependências são indicadas e todas são consistentes entre si. <br><br>  Mas qual é o problema?  O problema é que, na minha empresa, por exemplo, tenho meu próprio pai.  Se eu quiser usar o Spring, o que devo fazer com o meu pom pai? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3fc/b83/2ce/3fcb832ce3faa2a19f2d9f1e1cf6957a.png"><br><br>  Não temos herança múltipla.  Queremos usar nosso pom e obter o bloco de gerenciamento de dependências de fora. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/02e/835/ff7/02e835ff7cdd677895b23aa561e51130.png"><br><br>  Isso pode ser feito.  É suficiente registrar a importação da lista técnica do bloco de gerenciamento de dependências. <br><br><pre> <code class="java hljs">&lt;dependencyManagement&gt; &lt;dependencies&gt;    &lt;dependency&gt;       &lt;groupId&gt;io.spring.platform&lt;/groupId&gt;       &lt;artifactId&gt;platform-bom&lt;/artifactId&gt;       &lt;version&gt;Brussels-SR2&lt;/version&gt;       &lt;type&gt;pom&lt;/type&gt;       &lt;scope&gt;<span class="hljs-keyword"><span class="hljs-keyword">import</span></span>&lt;/scope&gt;    &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt;</code> </pre><br>  Quem quer saber mais sobre o bom - veja o relatório " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Maven vs. Gradle</a> ".  Aí tudo isso foi explicado em detalhes. <br><br>  Hoje, tornou-se bastante popular entre as grandes empresas escrever blocos tão grandes de gerenciamento de dependências, onde indicam todas as versões de seus produtos e todas as versões de produtos que usam seus produtos e que não conflitam entre si.  E isso se chama bom.  Essa coisa pode ser importada para o seu bloco de gerenciamento de dependências sem herança. <br><br>  E é assim que é feito em Gradle (como sempre, a mesma coisa, só que mais fácil): <br><br><pre> <code class="java hljs">dependencyManagement { imports {   mavenBom <span class="hljs-string"><span class="hljs-string">'org.springframework.cloud:spring-cloud-dependencies:Dalston.RELEASE'</span></span> } }</code> </pre><br>  Agora vamos falar sobre as próprias dependências. <br><br>  O que vamos escrever no aplicativo?  O gerenciamento de dependências é bom, mas queremos que o aplicativo tenha certas habilidades, por exemplo, responder via HTTP, ter um banco de dados ou suporte à JPA.  Portanto, tudo o que precisamos agora é obter três dependências. <br>  Costumava ser assim.  Eu quero trabalhar com o banco de dados e ele começa: é necessário algum tipo de gerenciador de transações; portanto, o módulo spring-tx é necessário.  Eu preciso de um pouco de hibernação, então é necessário o EntityManager, o hibernate-core ou qualquer outra coisa.  Eu configuro tudo através do Spring, então preciso do core da primavera.  Ou seja, por uma coisa simples, você tinha que pensar em uma dúzia de dependências. <br><br>  Hoje temos entradas.  A idéia de um iniciante é que nós dependemos disso.  Para começar, ele agrega as dependências necessárias para o mundo de onde ele veio.  Por exemplo, se for um iniciador de segurança, você não pensa em quais dependências são necessárias, elas chegam imediatamente na forma de dependências transitivas ao iniciador.  Ou, se você estiver trabalhando com o Spring Data Jpa, coloque uma dependência no iniciador e ele trará todos os módulos necessários para trabalhar com o Spring Data Jpa. <br><br>  I.e.  Nosso pom tem a seguinte aparência: contém apenas as 3-5 dependências de que precisamos: <br><br><pre> <code class="java hljs"><span class="hljs-string"><span class="hljs-string">'org.springframework.boot:spring-boot-starter-web'</span></span> <span class="hljs-string"><span class="hljs-string">'org.springframework.boot:spring-boot-starter-data-jpa'</span></span> <span class="hljs-string"><span class="hljs-string">'com.h2database:h2'</span></span></code> </pre><br>  Com as dependências resolvidas, tudo ficou mais fácil.  Precisamos pensar menos agora.  Não há conflito e o número de dependências diminuiu. <br><br><h2>  Configuração de contexto </h2><br>  Vamos falar sobre a próxima dor que sempre tivemos - definindo o contexto.  Sempre que começamos a escrever um aplicativo do zero, leva muito tempo para configurar toda a infraestrutura.  Registramos na configuração xml ou java muitos dos chamados beans de infraestrutura.  Se trabalhamos com o hibernate, precisamos do bean EntityManagerFactory.  Muitos beans de infraestrutura - gerenciador de transações, fonte de dados etc.  - Era necessário ajustar com as mãos.  Naturalmente, todos eles entraram em contexto. <br><br>  Durante o relatório do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Spring Ripper</a> , criamos o contexto principal e, se fosse o contexto xml, estava inicialmente vazio.  Se construímos o contexto por meio de <code>AnnotationConfigApplicationContext</code> , havia alguns processadores de beanpost que poderiam configurar os beans de acordo com as anotações, mas o contexto também estava quase vazio. <br>  E agora, principalmente, existe o <code>SpringApplication.run</code> e nenhum contexto é visível: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplilcation</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{   SpringApplication.run(App.class,args); } }</code> </pre><br>  Mas, na verdade, temos um contexto.  <code>SpringApplication.run</code> nos retorna algum contexto. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/da7/988/391/da79883913f411287e7a5fe0606bab8d.png"><br>  Este é um caso completamente atípico.  Costumava haver duas opções: <br><br><ul><li>  se esse for um aplicativo de desktop, diretamente no principal, você precisará escrever um novo com as mãos, selecionar <code>ClassPathXmlApplicationContext</code> , etc. <br></li><li>  se trabalhávamos com o Tomcat, havia um gerenciador de servlets que, por algumas convenções, procurava XML e, por padrão, criava um contexto a partir dele. <br></li></ul><br>  Em outras palavras, o contexto era de alguma forma.  E ainda passamos algumas classes de configuração para a entrada.  Em geral, escolhemos o tipo de contexto.  Agora só temos <code>SpringApplication.run</code> , ele aceita configurações como argumentos e constrói um contexto <br><br><h2>  Enigma: o que podemos passar por lá? </h2><br>  <b>Dado:</b> <br><br> <code>RipperApplication.class</code> <br> <pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span>… main(String[] args) {  SpringApplication.run(?,args); }</code> </pre><br>  Pergunta: o que mais pode ser transferido para lá? <br><br>  <b>Opções:</b> <br><ol><li> <code>RipperApplication.class</code> <br> </li><li> <code>String.class</code> <br> </li><li> <code>"context.xml"</code> <br> </li><li> <code>new ClassPathResource("context.xml")</code> <br> </li><li> <code>Package.getPackage("conference.spring.boot.ripper")</code> <br> </li></ol><br><div class="spoiler">  <b class="spoiler_title">A resposta</b> <div class="spoiler_text">  <b>A resposta é:</b> <br>  A documentação diz que qualquer coisa pode ser transferida para lá.  No mínimo, isso será compilado e funcionará de alguma forma. <br></div></div><br><img src="https://habrastorage.org/getpro/habr/post_images/524/9c0/cae/5249c0cae466170986ee0678fc608979.png"><br><br>  I.e.  de fato, todas as respostas estão corretas.  Qualquer um deles pode ser feito para funcionar, mesmo <code>String.class</code> , e em algumas condições você não precisa fazer nada para fazê-lo funcionar.  Mas esta é uma história diferente. <br><br>  A única coisa que não é mencionada na documentação é de que forma nos enviar para lá.  Mas isso já é do domínio do conhecimento secreto. <br><br><pre> <code class="java hljs">SpringApplication.run(Object[] sources, String[] args) # <span class="hljs-function"><span class="hljs-function">APPLICATION </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SETTINGS</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SpringApplication)</span></span></span><span class="hljs-function"> spring.main.sources</span></span>= # <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">package</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">xml</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">location</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">spring</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">main</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">web</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">environment</span></span></span></span>= # <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">false</span></span> spring.main.banner-mode=console # log/off</code> </pre><br>  <code>SpringApplication</code> é realmente importante aqui - mais abaixo nos slides, nós o teremos com Carlson. <br><br>  Nosso Carlson cria algum tipo de contexto com base nas informações que passamos a ele.  Lembro que damos a ele, por exemplo, cinco opções maravilhosas que você pode fazer com que tudo funcione usando <code>SpringApplication.run</code> : <br><br><ul><li> <code>RipperApplication.class</code> <br> </li><li> <code>String.class</code> <br> </li><li> <code>"context.xml"</code> <br> </li><li> <code>new ClassPathResource("context.xml")</code> <br> </li><li> <code>Package.getPackage("conference.spring.boot.ripper")</code> <br> </li></ul><br>  O que o <code>SpringApplication</code> faz por nós? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f10/dca/945/f10dca945d839f103d5f557fe456d0c9.png"><br><br>  Quando criamos o contexto de <code>new</code> em main por <code>new</code> , tivemos várias classes diferentes que implementam a interface <code>ApplicationContext</code> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/362/8c2/936/3628c2936a6b2fb26ffca700bde37db8.png"><br><br>  E que opções existem quando Carlson cria o contexto? <br><br>  Ele cria apenas dois tipos de contexto: um contexto da Web ( <code>WebApplicationContext</code> ) ou um contexto genérico ( <code>AnnotationConfigApplicationContext</code> ). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2fd/cf8/b4b/2fdcf8b4b95f922676b67bca5e80ebf7.png"><br><br>  A escolha do contexto é baseada na presença de duas classes no caminho de classe: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/07b/aa1/a79/07baa1a7908e04c88d3f707b2f60354e.png"><br><br>  Ou seja, o número de configurações não diminuiu.  Para criar um contexto, podemos especificar todas as opções de configuração.  Para criar o contexto, posso passar um script ou xml groovy;  Posso indicar quais pacotes verificar ou passar na classe marcada com algumas anotações.  Ou seja, eu tenho todas as possibilidades. <br><br>  No entanto, este é o Spring Boot.  Ainda não criamos uma única lixeira, nem uma única classe, temos apenas main, e nela está o nosso Carlson - <code>SpringApplication.run</code> .  Na entrada, ele recebe uma aula marcada com algum tipo de anotação de Spring Boot. <br><br>  Se você olhar para este contexto, o que acontecerá lá? <br><br>  Em nossa aplicação, depois de conectar um par de entradas, havia 436 caixas. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d3f/8c2/3bd/d3f8c23bde2c09e137620b7b13bda291.png"><br><br>  Quase 500 grãos apenas para começar a escrever. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bea/cce/768/beacce7686a37a19fa7af18af29906af.png"><br><br>  A seguir, entenderemos de onde esses grãos vieram. <br><br>  Mas antes de tudo, queremos fazer o mesmo. <br><br>  A mágica dos iniciantes, além de resolver todos os problemas com vícios, é que conectamos apenas 3-4 iniciantes e temos 436 caixas.  Nós conectaríamos 10 iniciantes, haveria mais de 1000 posições, pois cada partida, exceto as dependências, já traz configurações nas quais algumas posições necessárias são registradas.  I.e.  Você disse que deseja uma iniciação para a Web, portanto, precisa de um distribuidor de servlets e de <code>InternalResourceViewResolver</code> .  Conectamos o iniciador jpa - precisamos do bean <code>EntityManagerFactory</code> .  Todos esses beans já estão em algum lugar nas configurações iniciais e magicamente chegam ao aplicativo sem nenhuma ação de nossa parte. <br><br>  Para entender como isso funciona, hoje escreveremos um iniciador, que também trará caixas de infraestrutura para todos os aplicativos que usam esse iniciador. <br><br><h2>  Lei do Ferro 1.1.  Sempre envie um corvo </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/93f/100/bbf/93f100bbf10a54759538b2bcb87c6b89.png"><br><br>  Vamos olhar para a exigência do cliente.  O Iron Bank tem muitos aplicativos diferentes sendo executados em diferentes ramos.  Os clientes desejam que um corvo seja enviado toda vez que o aplicativo é aumentado - informações que o aplicativo aumentou. <br><br>  Vamos começar a escrever o código na aplicação de um banco de ferro específico (banco de ferro).  Escreveremos um iniciador para que todos os aplicativos do Iron Bank que dependem desse iniciador possam enviar automaticamente um corvo.  Lembramos que os iniciantes nos permitem restringir automaticamente as dependências.  E o mais importante, não escrevemos quase nenhuma configuração. <br><br>  Fazemos um ouvinte que escuta o contexto a ser atualizado (o último evento), após o qual ele envia um corvo.  Vamos ouvir <code>ContextRefreshEvent</code> . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextRefreshedEvent</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextRefreshedEvent event)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">" ..."</span></span>); } }</code> </pre><br><br>  Escrevemos ouvinte na configuração inicial.  Até o momento, haverá apenas um ouvinte, mas amanhã o cliente solicitará outras partes da infraestrutura e também as escreveremos nessa configuração. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(); } }</code> </pre><br><br>  Surge a pergunta: como fazer com que a configuração do nosso starter se encaixe automaticamente em todos os aplicativos que usam esse starter? <br><br>  Para todas as ocasiões, existe um "ativar algo". <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6c4/567/776/6c45677768f95b821d097093387cf611.png"><br><br>  Realmente, se eu depender de 20 entradas, terei que colocar <code>@Enable</code> ?  E se o acionador de partida tiver várias configurações?  A principal classe de configuração será pendurada com <code>@Enable*</code> , como está a árvore do Ano Novo? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/628/871/4ab/6288714abd5cb5b81b1abd6745507c1d.png"><br><br>  Na verdade, quero obter algum tipo de inversão de controle no nível de dependência.  Quero conectar o motor de arranque (para que tudo funcione) e não saber nada sobre como o seu interior é chamado.  Portanto, usaremos spring.factories. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/568/3cf/7e1/5683cf7e11a3019052515b81db30bf11.png"><br><br><h2>  Então, o que é <code>spring.factories</code> </h2><br>  A documentação diz que existem essas fontes de mola nas quais você precisa indicar a correspondência de interfaces e o que precisa carregar nelas - nossas configurações.  E tudo isso aparecerá magicamente no contexto, enquanto várias condições trabalharão neles. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/db0/f31/36c/db0f3136cdcb579a498223f3272e5d61.png"><br><br>  Assim, obtemos a inversão de controle, que precisávamos. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/915/4be/6fd/9154be6fd40c4a626a2ecd8d5198636c.png"><br><br>  Vamos tentar implementar.  Em vez de acessar as tripas do iniciador que eu conectei (pegue essa configuração e isso ...), tudo será exatamente o oposto.  O iniciador terá um arquivo chamado <b>spring.factories</b> .  Neste arquivo, prescrevemos qual configuração deste iniciador deve ser ativada para todos que o baixaram.  Um pouco mais tarde, explicarei como exatamente isso funciona no Spring Boot - em algum momento, ele começa a verificar todos os frascos e a procurar o arquivo spring.factories. <br><br><pre> <code class="java hljs">org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.ironbank.IronConfiguration</code> </pre><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(); } }</code> </pre><br><br>  Agora, tudo o que resta fazer é conectar o iniciador do projeto. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">compile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">project</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">':iron-starter'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span></code> </pre><br><br>  No maven, da mesma forma - você precisa registrar a dependência. <br><br>  Lançamos nosso aplicativo.  O corvo deve decolar no momento em que sobe, embora não tenhamos feito nada no aplicativo em si.  Em termos de infraestrutura, é claro que escrevemos e configuramos o iniciador.  Mas do ponto de vista do desenvolvedor, acabamos de conectar a dependência e a configuração apareceu - o corvo voou.  Tudo como queríamos. <br><br>  Isso não é mágico.  Inversão de controle não deve ser mágica.  Assim como o uso do Spring não deve ser mágico.  Sabemos que essa é uma estrutura principalmente para inversão de controle.  Como há inversão de controle para seu código, também há inversão de controle para módulos. <br><br><h2>  @SpringBootApplication em torno da cabeça </h2><br>  Lembre-se do momento em que construímos o contexto principal com nossas mãos.  Escrevemos o <code>new AnnotationConfigApplicationContext</code> e passamos algumas configurações para a entrada, que era uma classe java.  Agora também escrevemos <code>SpringApplication.run</code> e passamos a classe para lá, que é a configuração, mas é marcada com outra anotação bastante poderosa <code>@SpringBootApplication</code> , que carrega o mundo inteiro. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Target</span></span>(ElementType.TYPE) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Documented</span></span> <span class="hljs-meta"><span class="hljs-meta">@Inherited</span></span> <span class="hljs-meta"><span class="hljs-meta">@SpringBootConfiguration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableAutoConfiguration</span></span> <span class="hljs-meta"><span class="hljs-meta">@ComponentScan</span></span>(excludeFilters = { <span class="hljs-meta"><span class="hljs-meta">@Filter</span></span>(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class), <span class="hljs-meta"><span class="hljs-meta">@Filter</span></span>(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) }) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> SpringBootApplication { … }</code> </pre><br>  Primeiramente, dentro existe o <code>@Configuration</code> , ou seja, é uma configuração.  Você pode escrever <code>@Bean</code> e, como sempre, registrar os beans. <br><br>  Em segundo lugar, o <code>@ComponentScan</code> está acima dele.  Por padrão, ele verifica absolutamente todos os pacotes e subpacotes.  Portanto, se você começar a criar serviços no mesmo pacote ou em seus <code>@Service</code> - <code>@Service</code> , <code>@RestController</code> - eles serão verificados automaticamente, pois a configuração principal inicia o processo de verificação. <br><br>  Na verdade, <code>@SpringBootApplication</code> não faz nada de novo.  Ele simplesmente compilou todas as práticas recomendadas que estavam nos aplicativos Spring, então agora isso é algum tipo de composição de anotação, incluindo o <code>@ComponentScan</code> . <br><br>  Além disso, ainda existem coisas que não existiam antes - <code>@EnableAutoConfiguration</code> .  Esta é a classe que prescrevi na primavera. Fábricas. <br>  <code>@EnableAutoConfiguration</code> , se você olhar, carrega <code>@Import</code> : <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Target</span></span>({ElementType.TYPE}) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Documented</span></span> <span class="hljs-meta"><span class="hljs-meta">@Inherited</span></span> <span class="hljs-meta"><span class="hljs-meta">@AutoConfigurationPackage</span></span> <span class="hljs-meta"><span class="hljs-meta">@Import</span></span>({EnableAutoConfigurationImportSelector.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> EnableAutoConfiguration {  String ENABLED_OVERRIDE_PROPERTY = <span class="hljs-string"><span class="hljs-string">"spring.boot.enableautoconfiguration"</span></span>;  Class&lt;?&gt;[] exclude() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {};  String[] excludeName() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; }</code> </pre><br>  A principal tarefa do <code>@EnableAutoConfiguration</code> é fazer a importação da qual queremos nos livrar em nosso aplicativo, porque sua implementação deveria ter nos forçado a escrever o nome de alguma classe do iniciador.  E só podemos descobrir a partir da documentação.  Mas tudo deve ser por si só. <br><br>  Você precisa prestar atenção a esta aula.  Termina com <code>ImportSelector</code> .  No Spring regular, escrevemos <code>Import(Some Configuration.class)</code> alguma configuração e ela carrega, como todos os seus dependentes.  Este é <code>ImportSelector</code> , não é uma configuração.  <code>ImportSelector</code> todos os nossos iniciantes em contexto.  Ele processa a anotação <code>@EnableAutoConfiguration</code> de spring.factories, que seleciona quais configurações carregar, e adiciona os beans que especificamos em IronConfiguration ao contexto. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/606/62f/5cd/60662f5cd333ea707070ccf297177bc7.png"><br><br>  Como ele faz isso? <br><br>  Primeiro, ele usa uma classe de utilidade direta, SpringFactoriesLoader, que analisa spring.factories e carrega tudo, desde o que é solicitado.  Ele tem dois métodos, mas eles não são muito diferentes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2d2/219/686/2d2219686ee5232678b48cbaa051abf1.png"><br><br>  O Spring Factories Loader existia no Spring 3.2, mas ninguém o usou.  Aparentemente, foi escrito como um desenvolvimento potencial da estrutura.  E assim cresceu para Spring Boot, onde existem muitos mecanismos usando a convenção spring.factories.  Mostraremos ainda que, além da configuração, você também pode escrever em spring.factories - ouvintes, processadores incomuns, etc. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadFactories</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Class&lt;T&gt; factoryClass, ClassLoader cl )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadFactoryNames</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Class&lt;?&gt; factoryClass, ClassLoader cl )</span></span></span></span></code> </pre><br>  É assim que a inversão de controle funciona.     open closed principle,         - - .          (     ,   ).         ,   spring.factories.     ,   .   Spring Boot    ,       ,   spring.factories. <br><br>       .    ,      Spring,   ,      ,  ,       <code>org.springframework.boot:spring-boot-autoconfigure</code> ,   META-INF/spring.factories    <code>EnableAutoConfiguration</code> ,      ( ,   ,          80). <br><br><pre> <code class="java hljs">spring-boot-autoconfigure.jar/spring.factories&lt;/b&gt; org.springframework.boot.autoconfigure.EnableAutoConfiguration=\ org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration org.springframework.boot.autoconfigure.EnableAutoConfiguration=\ org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\ org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\ org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\ org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration.\ ...</code> </pre><br>      ,      ,     Spring Boot,     jar- (jar  Spring Boot),      spring.factories,   90 .           , , <code>CacheAutoConfiguration</code> ,     — ,     : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; types.length; i++) { Imports[i] = CacheConfigurations.getConfigurationClass(types[i]); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> imports;</code> </pre><br>  ,       - ,        (    spring.factories).       . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;CacheType, Class&lt;?&gt;&gt; MAPPINGS; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> { Map&lt;CacheType, Class&lt;?&gt;&gt; mappings = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;CacheType, Class&lt;?&gt;&gt;(); mappings.put(CacheType.GENERIC,    GenericCacheConfiguration.class); mappings.put(CacheType.EHCACHE,    EhCacheCacheConfiguration.class); mappings.put(CacheType.HAZELCAST,  HazelcastCacheConfiguration.class); mappings.put(CacheType.INFINISPAN, InfinispanCacheConfiguration.class); mappings.put(CacheType.JCACHE,     JCacheCacheConfiguration.class); mappings.put(CacheType.COUCHBASE,  CouchbaseCacheConfiguration.class); mappings.put(CacheType.REDIS,      RedisCacheConfiguration.class); mappings.put(CacheType.CAFFEINE,   CaffeineCacheConfiguration.class); addGuavaMapping(mappings); mappings.put(CacheType.SIMPLE,     SimpleCacheConfiguration.class); mappings.put(CacheType.NONE,       NoOpCacheConfiguration.class); MAPPINGS = Collections.unmodifiableMap(mappings); }</code> </pre><br>  ,          . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c3b/2fc/453/c3b2fc453c4a8dc085495a14e5e55fe5.png"><br><br>   . : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/620/a14/247/620a1424730c6f0a49c87e212966e049.png"><br><br>   .   — , ,  ,      open closed principle —   spring.factories,     .     ,    -   . <br><br>      ,    Spring Boot,    —   90 .     30 ,     Spring Boot. <br><br>    ,     .   2013  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>  ,    Spring 4,  ,    <code>@Conditional</code> ,        conditions,    ,  <code>true</code>  <code>false</code> .       ,  .  java-  Spring   ,      conditional.  ,  ,   conditional  <code>false</code> ,    . <br><br>   .       ,     ,    ,    -  . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2cc/f90/83f/2ccf9083f1a80c0d6b7723d846912b2e.png"><br><br>    . <br><br><h2>   1.2.     </h2><br>     .  —  ,    .    ,    ,   . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e1f/17e/71d/e1f17e71dcd1ec015e9044dbf021fbba.png"><br><br>  listener,   ,  ,    .   . <br><br>     : <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> &lt;b&gt;<span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span>&lt;/b&gt; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(); } }</code> </pre><br>   ,     ?      ,  : « Windows  ,   ,    Windows,  ».    conditional. <br><br>    ,        :   ,   : «  ».  condition    Spring Boot. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Conditional</span></span>(OnProductionCondition.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> ConditionalOnProduction { }</code> </pre><br>  - : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnProductionCondition</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Condition</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">matches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JOptionPane.showConfirmDialog(parentComponent: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">" ?"</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos tentar. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/431/b6d/865/431b6d8658b449e804b2cad93ecf6f08.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nós aumentamos o serviço, clique em sim na janela e o corvo voa (um ouvinte é criado). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Começamos novamente, respondemos Não, o corvo não voa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, a anotação </font></font><code>@Conditional(OnProductionCondition.class)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se refere à classe recém escrita, onde existe um método que deve retornar </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Esse ar condicionado pode ser inventado independentemente, o que torna a aplicação muito dinâmica, permitindo que ela funcione de maneira diferente em diferentes condições.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pazzler </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Então </font></font><code>@ConditionalOnProduction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nós escrevemos. Podemos fazer várias configurações, colocá-las em condição. Suponha que tenhamos nossa própria condição e que seja popular </font></font><code>@ConditionalOnProduction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. E há, por exemplo, 15 grãos necessários apenas na produção. Marquei-os com esta anotação. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pergunta: a</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lógica que descobre se é produção ou não, quantas vezes deve funcionar? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que diferença isso funciona? Bem, talvez essa lógica seja cara, leva tempo e tempo é dinheiro. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como ilustração, criamos um exemplo:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOn</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UndeadArmyConfiguration</span></span></span><span class="hljs-class"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DragonIslandConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOn</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> DragonGlassFactory </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragonGlassFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DragonGlassFactory(); } ... }</code> </pre><br>      :  ,  .   - —  ,    . <br><br>    .          —     ,  ,  . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/69d/220/f6e/69d220f6e04188268807f41dcde6c5ed.png"><br><br>      ,       (  <code>OnProductionCondition.class</code>   ,       —   ).    .   ,      ,        ,  - .      5 ? <br><br> <b> </b>    — 300  400.     -  .    ,   ,  .    —   . <br><br>  .       ( <code>@Component</code> , <code>@Configuration</code>  <code>@Service</code>      ),         .        ,   . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOn</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UndeadArmyConfiguration</span></span></span><span class="hljs-class"> </span></span>{ ... }</code> </pre><br>      ,    . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DragonIslandConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOn</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> DragonGlassFactory </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragonGlassFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DragonGlassFactory(); } ... }</code> </pre><br>       ,   ,   .     ,    -   ,          ,  300.       ,     ,      .  400. <br><br>  :         ?      : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6c7/efa/d4b/6c7efad4bc5e1279c7ba350355a0fa59.png"><br><br>  ,   .   :     -,      ,    ,      .          ,   ,   . <br><br><h2>   1.3.    </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Continuamos a desenvolver nossa iniciação. De alguma forma, devemos especificar o voo do corvo. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/932/4fc/726/9324fc726c3e1f36d5459fae6838f093.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em que arquivo prescrevemos coisas para o iniciante? Os iniciantes trazem uma configuração na qual existem beans. Como esses beans são configurados? Onde eles obtêm a fonte de dados, o usuário etc. Naturalmente, eles têm padrões para todas as ocasiões, mas como eles permitem que isso seja redefinido? Existem duas opções: </font></font><code>application.properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>application.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Lá, você pode inserir algumas informações que ainda serão lindamente preenchidas automaticamente no IDEA. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que torna a nossa partida pior? Quem o usa também deve saber em quais endereços o corvo está voando - precisamos fazer uma lista de destinatários. Este é o primeiro.</font></font><br><br>  —  ,        ,       .       listener-,   .  I.e.   ,         ,  .    ,    ,    . <br><br>   —    ,  ,      ,     ,   . <br><br>          .         .    - ? <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConditionalOnBean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnCloudPlatform</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnExpression</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnJava</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnJndi</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingClass</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnNotWebApplication</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnResource</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnSingleCandidate</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnWebApplication</span></span> ...</code> </pre><br>  ,   ,   .    <code>@ConditionalOnProperty</code> .  ,  ,    property  property  - ,   application.yml.     <code>@ConfigurationalProperty</code> ,   . <br><br><h2>  </h2><br>    ,   property  .  ,       ,    application.yml   ,     . <br><br>   property «».   ,  . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConfigurationProperties</span></span>(<span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RavenProperties</span></span></span><span class="hljs-class"> </span></span>{ List&lt;String&gt; ; }</code> </pre><br> IDEA  ,   -  : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/377/da5/e03/377da5e032812dd581b7832e2e6ef56b.png"><br><br>   ,       ( Maven      ,   « »).      . <br><br><pre> <code class="java hljs">subproject { dependencies { compileOnly <span class="hljs-string"><span class="hljs-string">'org.springframework.boot:spring-boot-configuration-processor'</span></span> compile <span class="hljs-string"><span class="hljs-string">'org.springframework.boot: spring-boot-starter'</span></span> } }</code> </pre><br>    IDEA,    . <br><br> ,     .  ,   annotation processor.      ,      - . ,  Lombok   annotation processor,          — , . <br><br>     property,    application properties?  JSON-,   IDEA  .      property,  IDEA   .   ,  property,     , IDEA   ,     : <br><br><ul><li>        JSON       ; <br></li><li>    annotation processor  Spring Boot,     JSON-     .   properties   ,    Spring Boot,     ,  property holder.    annotation processor Spring Boot   ,  <code>@ConfigurationalProperties</code> ,     property,   JSON.   ,     ,   JSON  . <br></li></ul><br>     <code>@EnableConfigurationProperties</code> ,         . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(); } }</code> </pre><br>    ,    ,     ,    (      property,   ). <br><br>       : <br><br><ul><li> <code>@EnableConfigurationProperties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indicando quais propriedades; </font></font><br></li><li> <code>@ConfigurationalProperties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dizendo que prefixo. </font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E não se deve esquecer getters e setters. </font><font style="vertical-align: inherit;">Eles também são importantes, caso contrário nada funciona - a ação não sobe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como resultado, temos um arquivo que pode, em princípio, ser escrito manualmente. </font><font style="vertical-align: inherit;">Mas ninguém gosta de escrever manualmente.</font></font><br><br><pre> <code class="java hljs">{ <span class="hljs-string"><span class="hljs-string">"hints"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"groups"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"sourceType"</span></span>: <span class="hljs-string"><span class="hljs-string">"com.ironbank.RavenProperties"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"com.ironbankRavenProperties"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"properties"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"sourceType"</span></span>: <span class="hljs-string"><span class="hljs-string">"com.ironbank.RavenProperties"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"."</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"java.util.List&lt;java.lang.String&gt;"</span></span> } ] }</code> </pre><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Endereço para raven </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fizemos a primeira parte da tarefa - obtivemos algumas propriedades. </font><font style="vertical-align: inherit;">Mas ninguém está relacionado a essas propriedades ainda. </font><font style="vertical-align: inherit;">Agora eles precisam ser definidos como condição para criar nosso ouvinte.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(); } }</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicionamos mais uma condição: um corvo deve ser criado apenas com a condição de que alguém diga para onde voar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora vamos escrever para onde voar em application.yml.</font></font><br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">spring</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">application</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.name</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">money-raven</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">jpa</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.hibernate</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ddl-auto</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">validate</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ironbank</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>:   <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>  : <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>: ,   : <span class="hljs-selector-tag"><span class="hljs-selector-tag">true</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resta prescrever em lógica que ele voe para onde foi informado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para fazer isso, podemos gerar um construtor. </font><font style="vertical-align: inherit;">O novo Spring possui uma injeção de construtor - esta é a maneira recomendada. </font><font style="vertical-align: inherit;">Eugene gosta de </font></font><code>@Autowired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fazer tudo aparecer no aplicativo através da reflexão. </font><font style="vertical-align: inherit;">Adoro seguir as convenções que a Spring oferece:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RequiredArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RavenListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextRefreshedEvent</span></span></span><span class="hljs-class">&gt;</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RavenProperties ravenProperties; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextRefreshedEvent event)</span></span></span><span class="hljs-function"> </span></span>{ ravenProperties.get().forEach(s -&gt; { System.out.println(<span class="hljs-string"><span class="hljs-string">" … "</span></span> + s); }); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas não é grátis. </font><font style="vertical-align: inherit;">Por um lado, você obtém um comportamento verificável, por outro, algumas hemorróidas.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(r); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em nenhum lugar existe </font></font><code>@Aurowired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, com o Spring 4.3 você não pode instalá-lo. </font><font style="vertical-align: inherit;">Se houver um único construtor, é </font></font><code>@Aurowired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nesse caso, é usada uma anotação </font></font><code>@RequiredArgsConstructor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que gera um único construtor. </font><font style="vertical-align: inherit;">Isso é equivalente a esse comportamento:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RavenListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextRefreshedEvent</span></span></span><span class="hljs-class">&gt;</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RavenProperties ravenProperties; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RavenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties ravenProperties)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ravenProperties = ravenProperties; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextRefreshedEvent event)</span></span></span><span class="hljs-function"> </span></span>{ ravenProperties.get().forEach(s -&gt; { System.out.println(<span class="hljs-string"><span class="hljs-string">" … "</span></span> + s); }); } }</code> </pre><br> Spring       Lombok. Jurgen Holler,   2002   80%  Spring,   <code>@Aurowired</code> ,    (        ). <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RavenListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextRefreshedEvent</span></span></span><span class="hljs-class">&gt;</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RavenProperties ravenProperties; <span class="hljs-meta"><span class="hljs-meta">@Aurowired</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RavenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties ravenProperties)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ravenProperties = ravenProperties; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextRefreshedEvent event)</span></span></span><span class="hljs-function"> </span></span>{ ravenProperties.get().forEach(s -&gt; { System.out.println(<span class="hljs-string"><span class="hljs-string">" … "</span></span> + s); }); } }</code> </pre><br>      ?    <code>RavenProperties</code>  Java-.    <code>@Aurowired</code>  ,      . <br><br> ,  .   ,           ,      ,         . <br><br><h2>   1.4.   </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/cdd/00e/5a3/cdd00e5a367e65ca813b456d704b8e44.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acontece que você precisa personalizar o comportamento do iniciador. Por exemplo, nós temos nosso próprio corvo preto. E precisamos de um branco que fume, e queremos enviá-lo para que as pessoas vejam fumaça no horizonte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos passar da alegoria para a vida real. O iniciante me trouxe um monte de beans de infraestrutura, e isso é ótimo. Mas eu não gosto de como eles estão configurados. Entrei nas propriedades do aplicativo e mudei algo por lá, e agora gosto de tudo. Mas há situações em que as configurações são tão complicadas que é mais fácil registrar a fonte de dados do que tentar descobrir as propriedades do aplicativo. Ou seja, queremos registrar a fonte de dados na lixeira recebida do iniciador. O que acontecerá então? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu mesmo registrei algo, e o iniciante me trouxe minha fonte de dados. Eu tenho dois agora? Ou alguém esmagará um (e qual?)</font></font><br><br>       ,    - ,    ,  ,   .  ,   . <br><br>    ,     : <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConditionalOnBean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnCloudPlatform</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnExpression</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnJava</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnJndi</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingClass</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnNotWebApplication</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnResource</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnSingleCandidate</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnWebApplication</span></span> ...</code> </pre><br>  , <code>@ConditionalOnMissingBean</code>  ,    .   ,  ,    ,         . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span>&lt;/b&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(r); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se você abrir a maioria dos iniciantes, verá que cada compartimento, cada configuração está pendurada com um pacote de anotações. </font><font style="vertical-align: inherit;">Estamos apenas tentando fazer um análogo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao tentar lançar o corvo não foi, mas o Evento apareceu, o que escrevemos em nosso novo ouvinte - </font></font><code>MyRavenListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/456/3a1/93c/4563a193c67943645fc7a4c006cd791b.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existem dois pontos importantes aqui. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O primeiro ponto é que ficamos viciados em nosso ouvinte existente e não escrevemos nenhum ouvinte lá:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyRavenListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyRavenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties ravenProperties)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(ravenProperties); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextRefreshedEvent event)</span></span></span><span class="hljs-function"> </span></span>{ ravenProperties.get().forEach(s -&gt; { System.out.println(<span class="hljs-string"><span class="hljs-string">"event = "</span></span> + event); }); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Segundo - fizemos com a ajuda do componente. </font><font style="vertical-align: inherit;">Se o fizermos em uma configuração Java, ou seja, </font><font style="vertical-align: inherit;">registraria a mesma classe que um bean de configuração, nada funcionaria para nós. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se eu limpar </font></font><code>extends</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e apenas criar algum tipo de ouvinte de aplicativo, </font></font><code>@ConditionalOnMissingBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">não funcionará.</font></font> Mas desde<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a classe também é chamada, quando tentamos criá-la, podemos escrever </font></font><code>ravenListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- exatamente como tínhamos em nossa configuração. Acima, focamos no fato de que o nome do bean na configuração Java será pelo nome do método. E, neste caso, criamos uma lixeira chamada </font></font><code>ravenListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br>      ?  Spring Boot   ,   .   ,   , , . -     ,         ,   .    .  ,          ,    ,     ,      ,      (     ,       ,      ).   ,    ,   ,   ,    . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Além disso, um conflito de feijão é uma boa situação porque você o vê. </font><font style="vertical-align: inherit;">Se especificarmos os mesmos nomes de bin, não teremos conflito. </font><font style="vertical-align: inherit;">Um bean simplesmente substituirá outro. </font><font style="vertical-align: inherit;">E você entenderá por um longo tempo onde está o que estava lá. </font><font style="vertical-align: inherit;">Por exemplo, se criarmos algum tipo de fonte de dados </font></font><code>@Bean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ela substituirá a fonte de dados existente </font></font><code>@Bean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A propósito, se o acionador de partida carrega o que você não precisa, basta fazer uma lixeira com o mesmo ID e pronto. </font><font style="vertical-align: inherit;">É verdade que, se o iniciador de alguma versão alterar o nome do método, é isso, sua lixeira será novamente dois.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ConditionalOnPuzzler </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temos </font></font><code>@ConditionalOnClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>@ConditionalOnMissingBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode haver escrevendo classes. </font><font style="vertical-align: inherit;">Como exemplo, considere a configuração de execução. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Há sabão, há uma corda - penduramos na forca. </font><font style="vertical-align: inherit;">Há uma cadeira e uma corrente - é lógico colocar uma pessoa em uma cadeira. </font><font style="vertical-align: inherit;">Há uma guilhotina e um bom humor - isso significa que você precisa cortar cabeças.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">  </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span>({.class, .class}) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span>({.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>  () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (<span class="hljs-string"><span class="hljs-string">"..."</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span>({.class, .class}) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span>({.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>  c() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (<span class="hljs-string"><span class="hljs-string">" "</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span>({.class, .class}) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span>({.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>  () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (<span class="hljs-string"><span class="hljs-string">" "</span></span>); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como vamos executar? </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pergunta:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Como as anotações de tipo podem </font></font><code>@ConditionalOnMissingClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funcionar </font><font style="vertical-align: inherit;">em geral </font><font style="vertical-align: inherit;">? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suponha que eu tenha um método que crie uma forca. </font><font style="vertical-align: inherit;">Mas uma caixa de forca só deve ser criada se houver sabão e corda. </font><font style="vertical-align: inherit;">Mas não há sabão. </font><font style="vertical-align: inherit;">Como posso entender que não há sabão ou apenas corda. </font><font style="vertical-align: inherit;">O que acontece se eu tentar ler anotações de um método, e essas anotações se referirem a classes que não são? </font><font style="vertical-align: inherit;">Posso fazer essas anotações? </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opções de resposta:</font></font></b> <br><ul><li> ClassDefNotFound?     ,    .     - ,  ClassDefNotFound  ,       reflection-    ,   conditional as long as; <br></li><li>   ,  .  reflection    .     ,  . <br></li><li>  ; <br></li><li>   . <br></li></ul><br><div class="spoiler"> <b class="spoiler_title"></b> <div class="spoiler_text"> <b>:</b>  ,   .    reflection   .    exception,     ,        —    .   reflection?        ,      ,    ,    ,     —   <code>ClassDefNotFound</code> . <br></div></div><br>      ASM. ,   reflection — , Spring   -, , .   ,       ,  ,    <code>@Conditional</code>  , .          .  ASM — ,  ,   .    ,   ,    . <br><br>  Juergen Hoeller      ,  ,   ,    <code>OnMissingClass</code> ,         (String).    ,   ,  ASM  . ,   ,    . <br><br><h2>   1.5.     </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/eb6/9b9/b83/eb69b9b8361dcc9924dc843290af9af2.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Precisávamos de outra propriedade - a capacidade de ativar ou desativar o corvo manualmente. Para não enviar ninguém garantido. Esta é a última condição que lhe mostramos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nosso titular não dá nada, exceto um corvo. Portanto, você pode perguntar: por que ser capaz de ligar / desligar, você pode simplesmente não aceitá-lo? Mas, na segunda parte, coisas úteis adicionais serão incluídas neste iniciador. Especificamente, um corvo pode não ser necessário - é caro, pode ser desligado. Ao mesmo tempo, não é muito bom remover o ponto final para onde enviá-lo - parece uma muleta. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, faremos tudo </font></font><code>@ConditionalOnProperty(".")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(r); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E ele jura para nós que isso não pode ser feito: anotação duplicada. </font><font style="vertical-align: inherit;">O problema é que, se tivermos uma anotação com alguns parâmetros, ela não poderá ser repetida. </font><font style="vertical-align: inherit;">Não podemos fazer isso em duas propriedades. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temos métodos para esta anotação, existe String e esta é uma matriz - você pode especificar várias propriedades lá.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Conditional</span></span>(OnPropertyCondition.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> ConditionalOnProperty { String[] value() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prefix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> ""</span></span>; String[] name() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">havingValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> ""</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">matchIfMissing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">false</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">relaxedNames</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">true</span></span></span></span>; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E tudo está bem, até você tentar personalizar o valor de cada elemento nessa matriz separadamente. </font><font style="vertical-align: inherit;">Temos uma propriedade </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que deve ser </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e é outra propriedade, que deve ter </font></font><code>string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um certo valor. </font><font style="vertical-align: inherit;">Mas você pode especificar apenas um valor em todas as propriedades. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ou seja, você não pode fazer isso:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(name = <span class="hljs-string"><span class="hljs-string">"."</span></span>, havingValue=<span class="hljs-string"><span class="hljs-string">"true"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(name = <span class="hljs-string"><span class="hljs-string">"."</span></span>,  havingValue=<span class="hljs-string"><span class="hljs-string">"true"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(name = <span class="hljs-string"><span class="hljs-string">"."</span></span>,havingValue=<span class="hljs-string"><span class="hljs-string">"false"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IronBankApplicationListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applicationListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... }</code> </pre><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>( name = {    <span class="hljs-string"><span class="hljs-string">"."</span></span>,    <span class="hljs-string"><span class="hljs-string">"."</span></span>,    <span class="hljs-string"><span class="hljs-string">"."</span></span> }, havingValue = <span class="hljs-string"><span class="hljs-string">"true"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IronBankApplicationListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applicationListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... }</code> </pre><br>   —   . <br><br>  ,      property, ,      : <code>AllNestedConditions</code>  <code>AnyNestedCondition</code> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ae2/7f1/0fe/ae27f10fea30542adc8340f98dc85887.png"><br><br>  ,  , .   .     —  ,     <code>.</code>  <code>.</code> . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnRaven</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(r); } }</code> </pre><br>     <code>@Conditional()</code>      - . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Conditional</span></span>({OnRavenCondional.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> CondionalOnRaven { }</code> </pre><br><br>  . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Condition</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre><br>      - ,      ,       : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CompositeCondition</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AllNestedConditions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(  name = <span class="hljs-string"><span class="hljs-string">"."</span></span>,  havingValue = <span class="hljs-string"><span class="hljs-string">"false"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenProperty</span></span></span><span class="hljs-class"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(  name = <span class="hljs-string"><span class="hljs-string">".enabled"</span></span>,  havingValue = <span class="hljs-string"><span class="hljs-string">"true"</span></span>,  matchIfMissing = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenEnabled</span></span></span><span class="hljs-class"> </span></span>{ } ... }</code> </pre><br>     <code>Conditional</code> ,        —  <code>AllNestedConditions</code> ,  <code>AnyNestedCondition</code> —       ,     .  I.e.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em vez disso </font></font><code>@Condition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, devemos especificar:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AllNestedConditions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(ConfigurationPhase.REGISTER_BEAN); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesse caso, você precisa criar um construtor dentro. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora temos que criar classes estáticas aqui. </font><font style="vertical-align: inherit;">Nós criamos algum tipo de classe (vamos chamá-lo de R).</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AllNestedConditions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(ConfigurationPhase.REGISTER_BEAN); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class"> </span></span>{} }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nós fazemos o nosso valor </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(deve ser exatamente </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AllNestedConditions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(ConfigurationPhase.REGISTER_BEAN); } <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(value= <span class="hljs-string"><span class="hljs-string">"."</span></span>, havingValue = <span class="hljs-string"><span class="hljs-string">"true"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class"> </span></span>{} }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para repetir isso, lembre-se do nome da classe. </font><font style="vertical-align: inherit;">O Spring possui boas docas Java. </font><font style="vertical-align: inherit;">Você pode deixar o IDEA, ler o dock Java e entender o que precisa ser feito. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Montamos a nossa </font></font><code>@ConditionalOnRaven</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Em princípio, você pode agrupar ambos </font></font><code>@ConditionalOnProduction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">e </font><font style="vertical-align: inherit;">, e </font></font><code>@ConditionalOnMissingBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas agora não faremos isso. </font><font style="vertical-align: inherit;">Basta ver o que aconteceu.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnRaven</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(r); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na ausência de um </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corvo não deve voar. </font><font style="vertical-align: inherit;">Ele não voou. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Não quero apostar </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, porque precisamos primeiro fazer um preenchimento automático - esse é um dos nossos requisitos.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConfigurationalProperties</span></span>(<span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RavenProperties</span></span></span><span class="hljs-class"> </span></span>{ List&lt;String&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> ; }</code> </pre><br>  Só isso. <code></code>   <code>false</code> ,  <code>true</code>  <br> application.yml: <br><br><pre> <code class="java hljs">jpa.hibernate.ddl-auto: validate ironbank: ---: -  : : ,   : <span class="hljs-keyword"><span class="hljs-keyword">true</span></span></code> </pre><br> ,    . <br><br>                ,     repeatable.     Java.   . <br><br>    ,      ,        . <br><br><hr><br><br>  Minuto de publicidade. 19-20    Joker 2018,            <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">«          [Joker Edition]»</a> ,         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">«Micronaut vs Spring Boot,     ?»</a>  .  Em geral, haverá muitos outros relatórios interessantes e dignos de nota no Joker.  Os ingressos podem ser adquiridos no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site oficial da</a> conferência. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E também temos uma pequena pesquisa para você! </font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt424503/">https://habr.com/ru/post/pt424503/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt424491/index.html">Mapas do hexágono da unidade: rugosidade, rios e estradas</a></li>
<li><a href="../pt424495/index.html">O Google Chrome adicionará a capacidade de recusar a sincronização automática de perfis ao fazer login nos serviços da empresa *</a></li>
<li><a href="../pt424497/index.html">Pare de suspeitar dos desenvolvedores de impostura. Aprenda a entrevistar melhor</a></li>
<li><a href="../pt424499/index.html">Bem, ele, seu pentesto</a></li>
<li><a href="../pt424501/index.html">Terminais de diagnóstico para soldadores reais</a></li>
<li><a href="../pt424505/index.html">“Temos ideias para o Maven 4 e até o Maven 5” - uma entrevista com Robert Scholte, um participante importante no projeto Maven</a></li>
<li><a href="../pt424507/index.html">VI Hackathon Anual da JetBrains: Shiftius Altius Ctrlius</a></li>
<li><a href="../pt424509/index.html">Trabalhando com a API KOMPAS-3D → Lição 12 → Linhas compostas</a></li>
<li><a href="../pt424511/index.html">Ferramentas para localizar classes anotadas em Java</a></li>
<li><a href="../pt424513/index.html">Sobre data centers baratos, proteção ILV e DDoS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>