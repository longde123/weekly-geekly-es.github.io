<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìù ‚ÜóÔ∏è üë©‚Äçüíª Inicie voc√™ mesmo, a primavera est√° chegando (Parte 1) üîÜ üìñ üíØ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Evgeny EvgenyBorisov Borisov (NAYA Technologies) e Kirill tolkkv Tolkachev (Cyan.Finance, Twitter ) falam sobre os momentos mais importantes e interes...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Inicie voc√™ mesmo, a primavera est√° chegando (Parte 1)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/424503/"> Evgeny <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">EvgenyBorisov</a> Borisov (NAYA Technologies) e Kirill <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">tolkkv</a> Tolkachev (Cyan.Finance, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Twitter</a> ) falam sobre os momentos mais importantes e interessantes do Spring Boot no exemplo de um iniciante para um imagin√°rio Iron Bank. <br><br><img src="https://habrastorage.org/webt/wj/p5/pf/wjp5pfvfgcnp_mda9gcpuiln3zs.png"><br><br>  O artigo √© baseado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">relat√≥rio de</a> Eugene e Cyril da nossa confer√™ncia Joker 2017. Abaixo do corte, est√° a transcri√ß√£o em v√≠deo e texto do relat√≥rio. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/yy43NOreJG4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  A confer√™ncia Joker √© patrocinada por muitos bancos, ent√£o vamos imaginar que o aplicativo no qual estudaremos o trabalho da bota Spring e o iniciador que criamos esteja conectado ao banco. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6b9/6b3/735/6b96b3735385c3774928851319b3569c.png"><br><br>  Portanto, suponha que um pedido seja recebido para um pedido do Banco de Ferro de Bravos.  Um banco comum simplesmente transfere dinheiro para frente e para tr√°s.  Por exemplo, assim (temos uma API para isso): <br><br> <code>http://localhost:8080/credit\?name\=Targarian\&amp;amount\=100 <br></code> <br>  E no Iron Bank, antes de transferir dinheiro, √© necess√°rio que a API do banco calcule se uma pessoa pode devolv√™-lo.  Talvez ele n√£o sobreviva ao inverno e n√£o haja ningu√©m para voltar.  Portanto, √© fornecido um servi√ßo que verifica a confiabilidade. <br><br>  Por exemplo, se tentarmos transferir dinheiro para Targaryen, a opera√ß√£o ser√° aprovada: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cc1/d3b/c67/cc1d3bc67ae34759c85b4cae57189037.png"><br><br>  Mas se Stark, ent√£o n√£o: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a65/453/a4d/a65453a4dc6bf6a0490cbbdaadf78404.png"><br><br>  N√£o √© de admirar: os Starks morrem com muita frequ√™ncia.  Por que transferir dinheiro se uma pessoa n√£o sobrevive ao inverno? <br><br>  Vamos ver como fica por dentro. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RestController</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequiredArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronBankController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> TransferMoneyService transferMoney; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> MoneyDao moneyDao; <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/credit"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">credit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@RequestParam String name, @RequestParam </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> amount)</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> resultedDeposit = transferMoney.transfer(name, amount);   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resultedDeposit == -<span class="hljs-number"><span class="hljs-number">1</span></span>) {     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Rejected&lt;br/&gt;"</span></span> + name + <span class="hljs-string"><span class="hljs-string">" &lt;b&gt;will`t&lt;/b&gt; survive this winter"</span></span>;   }   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> format(       <span class="hljs-string"><span class="hljs-string">"&lt;i&gt;Credit approved for %s&lt;/i&gt; &lt;br/&gt;Current  bank balance: &lt;b&gt;%s&lt;/b&gt;"</span></span>,       name,       resultedDeposit   ); } <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/state"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currentState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> moneyDao.findAll().get(<span class="hljs-number"><span class="hljs-number">0</span></span>).getTotalAmount(); } }</code> </pre><br>  Este √© um controlador de string comum. <br><br>  Quem √© respons√°vel pela l√≥gica da escolha, a quem conceder um empr√©stimo e a quem - n√£o?  Linha simples: se seu nome √© Stark, certamente n√£o o tra√≠mos.  Em outros casos - que sorte.  Banco comum. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Service</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NameBasedProphetService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProphetService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">willSurvive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !name.contains(<span class="hljs-string"><span class="hljs-string">"Stark"</span></span>) &amp;&amp; ThreadLocalRandom.current().nextBoolean(); } }</code> </pre><br>  Tudo o resto n√£o √© t√£o interessante.  Estas s√£o algumas anota√ß√µes que fazem todo o trabalho para n√≥s.  Tudo √© muito r√°pido. <br><br>  Onde est√£o todas as principais configura√ß√µes?  Existe apenas um controlador.  No Dao, geralmente √© uma interface vazia. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MoneyDao</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bank</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ }</code> </pre><br>  Em servi√ßos - apenas servi√ßos de tradu√ß√£o e previs√£o para quem voc√™ pode emitir.  N√£o h√° diret√≥rio Conf.  De fato, temos apenas application.yml (uma lista daqueles que pagam d√≠vidas).  E main √© o mais comum: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(ProphetProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MoneyRavenApplication</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{   SpringApplication.run(MoneyRavenApplication.class, args); } }</code> </pre><br>  Ent√£o, onde est√° toda a m√°gica escondida? <br><br>  O fato √© que os desenvolvedores n√£o gostam de pensar em depend√™ncias, configurar configura√ß√µes, especialmente se forem configura√ß√µes XML, e pensar em como o aplicativo √© iniciado.  Portanto, o Spring Boot resolve esses problemas para n√≥s.  N√≥s s√≥ precisamos escrever um aplicativo. <br><br><h2>  Depend√™ncias </h2><br>  O primeiro problema que sempre tivemos √© um conflito de vers√£o.  Sempre que conectamos bibliotecas diferentes que fazem refer√™ncia a outras bibliotecas, aparecem conflitos de depend√™ncia.  Toda vez que leio na Internet que preciso adicionar algum gerente de entidade, surge uma pergunta e qual vers√£o devo adicionar para que n√£o quebre nada? <br><br>  O Spring Boot resolve o problema dos conflitos de vers√£o. <br><br>  Como geralmente obtemos um projeto Spring Boot (se n√£o chegamos a algum lugar onde ele j√° existe)? <br><br><ul><li>  ou v√° para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">start.spring.io</a> , marque as caixas de sele√ß√£o que Josh Long nos ensinou a configurar, clique no Download Project e abra o projeto onde tudo j√° est√° l√°; <br></li><li>  ou use o IntelliJ, onde, gra√ßas √† op√ß√£o exibida, as caixas de sele√ß√£o no Spring Initializer podem ser definidas a partir da√≠. <br></li></ul><br>  Se trabalharmos com o Maven, o projeto ter√° o pom.xml, onde existe um pai Spring Boot chamado <code>spring-boot-dependencies</code> .  Haver√° um enorme bloco de gerenciamento de depend√™ncias. <br><br>  N√£o vou entrar nos detalhes do Maven agora.  Apenas duas palavras. <br><br>  O bloco de gerenciamento de depend√™ncias n√£o registra depend√™ncias.  Este √© um bloco com o qual voc√™ pode especificar vers√µes caso essas depend√™ncias sejam necess√°rias.  E quando voc√™ indica algum tipo de depend√™ncia no bloco de gerenciamento de depend√™ncias sem especificar a vers√£o, o Maven come√ßa a procurar se existe um bloco de gerenciamento de depend√™ncias no qual pai esta vers√£o est√° escrita no pom pai ou em outro lugar.  I.e.  no meu projeto, adicionando uma nova depend√™ncia, n√£o indicarei mais a vers√£o na esperan√ßa de que seja indicada em algum lugar no pai.  E se n√£o for especificado no pai, certamente n√£o criar√° nenhum conflito com ningu√©m.  Em nosso gerenciamento de depend√™ncias, boas quinhentas depend√™ncias s√£o indicadas e todas s√£o consistentes entre si. <br><br>  Mas qual √© o problema?  O problema √© que, na minha empresa, por exemplo, tenho meu pr√≥prio pai.  Se eu quiser usar o Spring, o que devo fazer com o meu pom pai? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3fc/b83/2ce/3fcb832ce3faa2a19f2d9f1e1cf6957a.png"><br><br>  N√£o temos heran√ßa m√∫ltipla.  Queremos usar nosso pom e obter o bloco de gerenciamento de depend√™ncias de fora. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/02e/835/ff7/02e835ff7cdd677895b23aa561e51130.png"><br><br>  Isso pode ser feito.  √â suficiente registrar a importa√ß√£o da lista t√©cnica do bloco de gerenciamento de depend√™ncias. <br><br><pre> <code class="java hljs">&lt;dependencyManagement&gt; &lt;dependencies&gt;    &lt;dependency&gt;       &lt;groupId&gt;io.spring.platform&lt;/groupId&gt;       &lt;artifactId&gt;platform-bom&lt;/artifactId&gt;       &lt;version&gt;Brussels-SR2&lt;/version&gt;       &lt;type&gt;pom&lt;/type&gt;       &lt;scope&gt;<span class="hljs-keyword"><span class="hljs-keyword">import</span></span>&lt;/scope&gt;    &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt;</code> </pre><br>  Quem quer saber mais sobre o bom - veja o relat√≥rio " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Maven vs. Gradle</a> ".  A√≠ tudo isso foi explicado em detalhes. <br><br>  Hoje, tornou-se bastante popular entre as grandes empresas escrever blocos t√£o grandes de gerenciamento de depend√™ncias, onde indicam todas as vers√µes de seus produtos e todas as vers√µes de produtos que usam seus produtos e que n√£o conflitam entre si.  E isso se chama bom.  Essa coisa pode ser importada para o seu bloco de gerenciamento de depend√™ncias sem heran√ßa. <br><br>  E √© assim que √© feito em Gradle (como sempre, a mesma coisa, s√≥ que mais f√°cil): <br><br><pre> <code class="java hljs">dependencyManagement { imports {   mavenBom <span class="hljs-string"><span class="hljs-string">'org.springframework.cloud:spring-cloud-dependencies:Dalston.RELEASE'</span></span> } }</code> </pre><br>  Agora vamos falar sobre as pr√≥prias depend√™ncias. <br><br>  O que vamos escrever no aplicativo?  O gerenciamento de depend√™ncias √© bom, mas queremos que o aplicativo tenha certas habilidades, por exemplo, responder via HTTP, ter um banco de dados ou suporte √† JPA.  Portanto, tudo o que precisamos agora √© obter tr√™s depend√™ncias. <br>  Costumava ser assim.  Eu quero trabalhar com o banco de dados e ele come√ßa: √© necess√°rio algum tipo de gerenciador de transa√ß√µes; portanto, o m√≥dulo spring-tx √© necess√°rio.  Eu preciso de um pouco de hiberna√ß√£o, ent√£o √© necess√°rio o EntityManager, o hibernate-core ou qualquer outra coisa.  Eu configuro tudo atrav√©s do Spring, ent√£o preciso do core da primavera.  Ou seja, por uma coisa simples, voc√™ tinha que pensar em uma d√∫zia de depend√™ncias. <br><br>  Hoje temos entradas.  A id√©ia de um iniciante √© que n√≥s dependemos disso.  Para come√ßar, ele agrega as depend√™ncias necess√°rias para o mundo de onde ele veio.  Por exemplo, se for um iniciador de seguran√ßa, voc√™ n√£o pensa em quais depend√™ncias s√£o necess√°rias, elas chegam imediatamente na forma de depend√™ncias transitivas ao iniciador.  Ou, se voc√™ estiver trabalhando com o Spring Data Jpa, coloque uma depend√™ncia no iniciador e ele trar√° todos os m√≥dulos necess√°rios para trabalhar com o Spring Data Jpa. <br><br>  I.e.  Nosso pom tem a seguinte apar√™ncia: cont√©m apenas as 3-5 depend√™ncias de que precisamos: <br><br><pre> <code class="java hljs"><span class="hljs-string"><span class="hljs-string">'org.springframework.boot:spring-boot-starter-web'</span></span> <span class="hljs-string"><span class="hljs-string">'org.springframework.boot:spring-boot-starter-data-jpa'</span></span> <span class="hljs-string"><span class="hljs-string">'com.h2database:h2'</span></span></code> </pre><br>  Com as depend√™ncias resolvidas, tudo ficou mais f√°cil.  Precisamos pensar menos agora.  N√£o h√° conflito e o n√∫mero de depend√™ncias diminuiu. <br><br><h2>  Configura√ß√£o de contexto </h2><br>  Vamos falar sobre a pr√≥xima dor que sempre tivemos - definindo o contexto.  Sempre que come√ßamos a escrever um aplicativo do zero, leva muito tempo para configurar toda a infraestrutura.  Registramos na configura√ß√£o xml ou java muitos dos chamados beans de infraestrutura.  Se trabalhamos com o hibernate, precisamos do bean EntityManagerFactory.  Muitos beans de infraestrutura - gerenciador de transa√ß√µes, fonte de dados etc.  - Era necess√°rio ajustar com as m√£os.  Naturalmente, todos eles entraram em contexto. <br><br>  Durante o relat√≥rio do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Spring Ripper</a> , criamos o contexto principal e, se fosse o contexto xml, estava inicialmente vazio.  Se constru√≠mos o contexto por meio de <code>AnnotationConfigApplicationContext</code> , havia alguns processadores de beanpost que poderiam configurar os beans de acordo com as anota√ß√µes, mas o contexto tamb√©m estava quase vazio. <br>  E agora, principalmente, existe o <code>SpringApplication.run</code> e nenhum contexto √© vis√≠vel: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplilcation</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{   SpringApplication.run(App.class,args); } }</code> </pre><br>  Mas, na verdade, temos um contexto.  <code>SpringApplication.run</code> nos retorna algum contexto. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/da7/988/391/da79883913f411287e7a5fe0606bab8d.png"><br>  Este √© um caso completamente at√≠pico.  Costumava haver duas op√ß√µes: <br><br><ul><li>  se esse for um aplicativo de desktop, diretamente no principal, voc√™ precisar√° escrever um novo com as m√£os, selecionar <code>ClassPathXmlApplicationContext</code> , etc. <br></li><li>  se trabalh√°vamos com o Tomcat, havia um gerenciador de servlets que, por algumas conven√ß√µes, procurava XML e, por padr√£o, criava um contexto a partir dele. <br></li></ul><br>  Em outras palavras, o contexto era de alguma forma.  E ainda passamos algumas classes de configura√ß√£o para a entrada.  Em geral, escolhemos o tipo de contexto.  Agora s√≥ temos <code>SpringApplication.run</code> , ele aceita configura√ß√µes como argumentos e constr√≥i um contexto <br><br><h2>  Enigma: o que podemos passar por l√°? </h2><br>  <b>Dado:</b> <br><br> <code>RipperApplication.class</code> <br> <pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span>‚Ä¶ main(String[] args) {  SpringApplication.run(?,args); }</code> </pre><br>  Pergunta: o que mais pode ser transferido para l√°? <br><br>  <b>Op√ß√µes:</b> <br><ol><li> <code>RipperApplication.class</code> <br> </li><li> <code>String.class</code> <br> </li><li> <code>"context.xml"</code> <br> </li><li> <code>new ClassPathResource("context.xml")</code> <br> </li><li> <code>Package.getPackage("conference.spring.boot.ripper")</code> <br> </li></ol><br><div class="spoiler">  <b class="spoiler_title">A resposta</b> <div class="spoiler_text">  <b>A resposta √©:</b> <br>  A documenta√ß√£o diz que qualquer coisa pode ser transferida para l√°.  No m√≠nimo, isso ser√° compilado e funcionar√° de alguma forma. <br></div></div><br><img src="https://habrastorage.org/getpro/habr/post_images/524/9c0/cae/5249c0cae466170986ee0678fc608979.png"><br><br>  I.e.  de fato, todas as respostas est√£o corretas.  Qualquer um deles pode ser feito para funcionar, mesmo <code>String.class</code> , e em algumas condi√ß√µes voc√™ n√£o precisa fazer nada para faz√™-lo funcionar.  Mas esta √© uma hist√≥ria diferente. <br><br>  A √∫nica coisa que n√£o √© mencionada na documenta√ß√£o √© de que forma nos enviar para l√°.  Mas isso j√° √© do dom√≠nio do conhecimento secreto. <br><br><pre> <code class="java hljs">SpringApplication.run(Object[] sources, String[] args) # <span class="hljs-function"><span class="hljs-function">APPLICATION </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SETTINGS</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SpringApplication)</span></span></span><span class="hljs-function"> spring.main.sources</span></span>= # <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">package</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">xml</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">location</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">spring</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">main</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">web</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">environment</span></span></span></span>= # <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">false</span></span> spring.main.banner-mode=console # log/off</code> </pre><br>  <code>SpringApplication</code> √© realmente importante aqui - mais abaixo nos slides, n√≥s o teremos com Carlson. <br><br>  Nosso Carlson cria algum tipo de contexto com base nas informa√ß√µes que passamos a ele.  Lembro que damos a ele, por exemplo, cinco op√ß√µes maravilhosas que voc√™ pode fazer com que tudo funcione usando <code>SpringApplication.run</code> : <br><br><ul><li> <code>RipperApplication.class</code> <br> </li><li> <code>String.class</code> <br> </li><li> <code>"context.xml"</code> <br> </li><li> <code>new ClassPathResource("context.xml")</code> <br> </li><li> <code>Package.getPackage("conference.spring.boot.ripper")</code> <br> </li></ul><br>  O que o <code>SpringApplication</code> faz por n√≥s? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f10/dca/945/f10dca945d839f103d5f557fe456d0c9.png"><br><br>  Quando criamos o contexto de <code>new</code> em main por <code>new</code> , tivemos v√°rias classes diferentes que implementam a interface <code>ApplicationContext</code> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/362/8c2/936/3628c2936a6b2fb26ffca700bde37db8.png"><br><br>  E que op√ß√µes existem quando Carlson cria o contexto? <br><br>  Ele cria apenas dois tipos de contexto: um contexto da Web ( <code>WebApplicationContext</code> ) ou um contexto gen√©rico ( <code>AnnotationConfigApplicationContext</code> ). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2fd/cf8/b4b/2fdcf8b4b95f922676b67bca5e80ebf7.png"><br><br>  A escolha do contexto √© baseada na presen√ßa de duas classes no caminho de classe: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/07b/aa1/a79/07baa1a7908e04c88d3f707b2f60354e.png"><br><br>  Ou seja, o n√∫mero de configura√ß√µes n√£o diminuiu.  Para criar um contexto, podemos especificar todas as op√ß√µes de configura√ß√£o.  Para criar o contexto, posso passar um script ou xml groovy;  Posso indicar quais pacotes verificar ou passar na classe marcada com algumas anota√ß√µes.  Ou seja, eu tenho todas as possibilidades. <br><br>  No entanto, este √© o Spring Boot.  Ainda n√£o criamos uma √∫nica lixeira, nem uma √∫nica classe, temos apenas main, e nela est√° o nosso Carlson - <code>SpringApplication.run</code> .  Na entrada, ele recebe uma aula marcada com algum tipo de anota√ß√£o de Spring Boot. <br><br>  Se voc√™ olhar para este contexto, o que acontecer√° l√°? <br><br>  Em nossa aplica√ß√£o, depois de conectar um par de entradas, havia 436 caixas. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d3f/8c2/3bd/d3f8c23bde2c09e137620b7b13bda291.png"><br><br>  Quase 500 gr√£os apenas para come√ßar a escrever. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bea/cce/768/beacce7686a37a19fa7af18af29906af.png"><br><br>  A seguir, entenderemos de onde esses gr√£os vieram. <br><br>  Mas antes de tudo, queremos fazer o mesmo. <br><br>  A m√°gica dos iniciantes, al√©m de resolver todos os problemas com v√≠cios, √© que conectamos apenas 3-4 iniciantes e temos 436 caixas.  N√≥s conectar√≠amos 10 iniciantes, haveria mais de 1000 posi√ß√µes, pois cada partida, exceto as depend√™ncias, j√° traz configura√ß√µes nas quais algumas posi√ß√µes necess√°rias s√£o registradas.  I.e.  Voc√™ disse que deseja uma inicia√ß√£o para a Web, portanto, precisa de um distribuidor de servlets e de <code>InternalResourceViewResolver</code> .  Conectamos o iniciador jpa - precisamos do bean <code>EntityManagerFactory</code> .  Todos esses beans j√° est√£o em algum lugar nas configura√ß√µes iniciais e magicamente chegam ao aplicativo sem nenhuma a√ß√£o de nossa parte. <br><br>  Para entender como isso funciona, hoje escreveremos um iniciador, que tamb√©m trar√° caixas de infraestrutura para todos os aplicativos que usam esse iniciador. <br><br><h2>  Lei do Ferro 1.1.  Sempre envie um corvo </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/93f/100/bbf/93f100bbf10a54759538b2bcb87c6b89.png"><br><br>  Vamos olhar para a exig√™ncia do cliente.  O Iron Bank tem muitos aplicativos diferentes sendo executados em diferentes ramos.  Os clientes desejam que um corvo seja enviado toda vez que o aplicativo √© aumentado - informa√ß√µes que o aplicativo aumentou. <br><br>  Vamos come√ßar a escrever o c√≥digo na aplica√ß√£o de um banco de ferro espec√≠fico (banco de ferro).  Escreveremos um iniciador para que todos os aplicativos do Iron Bank que dependem desse iniciador possam enviar automaticamente um corvo.  Lembramos que os iniciantes nos permitem restringir automaticamente as depend√™ncias.  E o mais importante, n√£o escrevemos quase nenhuma configura√ß√£o. <br><br>  Fazemos um ouvinte que escuta o contexto a ser atualizado (o √∫ltimo evento), ap√≥s o qual ele envia um corvo.  Vamos ouvir <code>ContextRefreshEvent</code> . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextRefreshedEvent</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextRefreshedEvent event)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">" ..."</span></span>); } }</code> </pre><br><br>  Escrevemos ouvinte na configura√ß√£o inicial.  At√© o momento, haver√° apenas um ouvinte, mas amanh√£ o cliente solicitar√° outras partes da infraestrutura e tamb√©m as escreveremos nessa configura√ß√£o. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(); } }</code> </pre><br><br>  Surge a pergunta: como fazer com que a configura√ß√£o do nosso starter se encaixe automaticamente em todos os aplicativos que usam esse starter? <br><br>  Para todas as ocasi√µes, existe um "ativar algo". <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6c4/567/776/6c45677768f95b821d097093387cf611.png"><br><br>  Realmente, se eu depender de 20 entradas, terei que colocar <code>@Enable</code> ?  E se o acionador de partida tiver v√°rias configura√ß√µes?  A principal classe de configura√ß√£o ser√° pendurada com <code>@Enable*</code> , como est√° a √°rvore do Ano Novo? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/628/871/4ab/6288714abd5cb5b81b1abd6745507c1d.png"><br><br>  Na verdade, quero obter algum tipo de invers√£o de controle no n√≠vel de depend√™ncia.  Quero conectar o motor de arranque (para que tudo funcione) e n√£o saber nada sobre como o seu interior √© chamado.  Portanto, usaremos spring.factories. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/568/3cf/7e1/5683cf7e11a3019052515b81db30bf11.png"><br><br><h2>  Ent√£o, o que √© <code>spring.factories</code> </h2><br>  A documenta√ß√£o diz que existem essas fontes de mola nas quais voc√™ precisa indicar a correspond√™ncia de interfaces e o que precisa carregar nelas - nossas configura√ß√µes.  E tudo isso aparecer√° magicamente no contexto, enquanto v√°rias condi√ß√µes trabalhar√£o neles. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/db0/f31/36c/db0f3136cdcb579a498223f3272e5d61.png"><br><br>  Assim, obtemos a invers√£o de controle, que precis√°vamos. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/915/4be/6fd/9154be6fd40c4a626a2ecd8d5198636c.png"><br><br>  Vamos tentar implementar.  Em vez de acessar as tripas do iniciador que eu conectei (pegue essa configura√ß√£o e isso ...), tudo ser√° exatamente o oposto.  O iniciador ter√° um arquivo chamado <b>spring.factories</b> .  Neste arquivo, prescrevemos qual configura√ß√£o deste iniciador deve ser ativada para todos que o baixaram.  Um pouco mais tarde, explicarei como exatamente isso funciona no Spring Boot - em algum momento, ele come√ßa a verificar todos os frascos e a procurar o arquivo spring.factories. <br><br><pre> <code class="java hljs">org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.ironbank.IronConfiguration</code> </pre><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(); } }</code> </pre><br><br>  Agora, tudo o que resta fazer √© conectar o iniciador do projeto. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">compile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">project</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">':iron-starter'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span></code> </pre><br><br>  No maven, da mesma forma - voc√™ precisa registrar a depend√™ncia. <br><br>  Lan√ßamos nosso aplicativo.  O corvo deve decolar no momento em que sobe, embora n√£o tenhamos feito nada no aplicativo em si.  Em termos de infraestrutura, √© claro que escrevemos e configuramos o iniciador.  Mas do ponto de vista do desenvolvedor, acabamos de conectar a depend√™ncia e a configura√ß√£o apareceu - o corvo voou.  Tudo como quer√≠amos. <br><br>  Isso n√£o √© m√°gico.  Invers√£o de controle n√£o deve ser m√°gica.  Assim como o uso do Spring n√£o deve ser m√°gico.  Sabemos que essa √© uma estrutura principalmente para invers√£o de controle.  Como h√° invers√£o de controle para seu c√≥digo, tamb√©m h√° invers√£o de controle para m√≥dulos. <br><br><h2>  @SpringBootApplication em torno da cabe√ßa </h2><br>  Lembre-se do momento em que constru√≠mos o contexto principal com nossas m√£os.  Escrevemos o <code>new AnnotationConfigApplicationContext</code> e passamos algumas configura√ß√µes para a entrada, que era uma classe java.  Agora tamb√©m escrevemos <code>SpringApplication.run</code> e passamos a classe para l√°, que √© a configura√ß√£o, mas √© marcada com outra anota√ß√£o bastante poderosa <code>@SpringBootApplication</code> , que carrega o mundo inteiro. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Target</span></span>(ElementType.TYPE) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Documented</span></span> <span class="hljs-meta"><span class="hljs-meta">@Inherited</span></span> <span class="hljs-meta"><span class="hljs-meta">@SpringBootConfiguration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableAutoConfiguration</span></span> <span class="hljs-meta"><span class="hljs-meta">@ComponentScan</span></span>(excludeFilters = { <span class="hljs-meta"><span class="hljs-meta">@Filter</span></span>(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class), <span class="hljs-meta"><span class="hljs-meta">@Filter</span></span>(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) }) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> SpringBootApplication { ‚Ä¶ }</code> </pre><br>  Primeiramente, dentro existe o <code>@Configuration</code> , ou seja, √© uma configura√ß√£o.  Voc√™ pode escrever <code>@Bean</code> e, como sempre, registrar os beans. <br><br>  Em segundo lugar, o <code>@ComponentScan</code> est√° acima dele.  Por padr√£o, ele verifica absolutamente todos os pacotes e subpacotes.  Portanto, se voc√™ come√ßar a criar servi√ßos no mesmo pacote ou em seus <code>@Service</code> - <code>@Service</code> , <code>@RestController</code> - eles ser√£o verificados automaticamente, pois a configura√ß√£o principal inicia o processo de verifica√ß√£o. <br><br>  Na verdade, <code>@SpringBootApplication</code> n√£o faz nada de novo.  Ele simplesmente compilou todas as pr√°ticas recomendadas que estavam nos aplicativos Spring, ent√£o agora isso √© algum tipo de composi√ß√£o de anota√ß√£o, incluindo o <code>@ComponentScan</code> . <br><br>  Al√©m disso, ainda existem coisas que n√£o existiam antes - <code>@EnableAutoConfiguration</code> .  Esta √© a classe que prescrevi na primavera. F√°bricas. <br>  <code>@EnableAutoConfiguration</code> , se voc√™ olhar, carrega <code>@Import</code> : <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Target</span></span>({ElementType.TYPE}) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Documented</span></span> <span class="hljs-meta"><span class="hljs-meta">@Inherited</span></span> <span class="hljs-meta"><span class="hljs-meta">@AutoConfigurationPackage</span></span> <span class="hljs-meta"><span class="hljs-meta">@Import</span></span>({EnableAutoConfigurationImportSelector.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> EnableAutoConfiguration {  String ENABLED_OVERRIDE_PROPERTY = <span class="hljs-string"><span class="hljs-string">"spring.boot.enableautoconfiguration"</span></span>;  Class&lt;?&gt;[] exclude() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {};  String[] excludeName() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; }</code> </pre><br>  A principal tarefa do <code>@EnableAutoConfiguration</code> √© fazer a importa√ß√£o da qual queremos nos livrar em nosso aplicativo, porque sua implementa√ß√£o deveria ter nos for√ßado a escrever o nome de alguma classe do iniciador.  E s√≥ podemos descobrir a partir da documenta√ß√£o.  Mas tudo deve ser por si s√≥. <br><br>  Voc√™ precisa prestar aten√ß√£o a esta aula.  Termina com <code>ImportSelector</code> .  No Spring regular, escrevemos <code>Import(Some Configuration.class)</code> alguma configura√ß√£o e ela carrega, como todos os seus dependentes.  Este √© <code>ImportSelector</code> , n√£o √© uma configura√ß√£o.  <code>ImportSelector</code> todos os nossos iniciantes em contexto.  Ele processa a anota√ß√£o <code>@EnableAutoConfiguration</code> de spring.factories, que seleciona quais configura√ß√µes carregar, e adiciona os beans que especificamos em IronConfiguration ao contexto. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/606/62f/5cd/60662f5cd333ea707070ccf297177bc7.png"><br><br>  Como ele faz isso? <br><br>  Primeiro, ele usa uma classe de utilidade direta, SpringFactoriesLoader, que analisa spring.factories e carrega tudo, desde o que √© solicitado.  Ele tem dois m√©todos, mas eles n√£o s√£o muito diferentes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2d2/219/686/2d2219686ee5232678b48cbaa051abf1.png"><br><br>  O Spring Factories Loader existia no Spring 3.2, mas ningu√©m o usou.  Aparentemente, foi escrito como um desenvolvimento potencial da estrutura.  E assim cresceu para Spring Boot, onde existem muitos mecanismos usando a conven√ß√£o spring.factories.  Mostraremos ainda que, al√©m da configura√ß√£o, voc√™ tamb√©m pode escrever em spring.factories - ouvintes, processadores incomuns, etc. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadFactories</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Class&lt;T&gt; factoryClass, ClassLoader cl )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadFactoryNames</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Class&lt;?&gt; factoryClass, ClassLoader cl )</span></span></span></span></code> </pre><br>  √â assim que a invers√£o de controle funciona.     open closed principle,         - - .          (     ,   ).         ,   spring.factories.     ,   .   Spring Boot    ,       ,   spring.factories. <br><br>       .    ,      Spring,   ,      ,  ,       <code>org.springframework.boot:spring-boot-autoconfigure</code> ,   META-INF/spring.factories    <code>EnableAutoConfiguration</code> ,      ( ,   ,          80). <br><br><pre> <code class="java hljs">spring-boot-autoconfigure.jar/spring.factories&lt;/b&gt; org.springframework.boot.autoconfigure.EnableAutoConfiguration=\ org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration org.springframework.boot.autoconfigure.EnableAutoConfiguration=\ org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\ org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\ org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\ org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration.\ ...</code> </pre><br>      ,      ,     Spring Boot,     jar- (jar  Spring Boot),      spring.factories,   90 .           , , <code>CacheAutoConfiguration</code> ,     ‚Äî ,     : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; types.length; i++) { Imports[i] = CacheConfigurations.getConfigurationClass(types[i]); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> imports;</code> </pre><br>  ,       - ,        (    spring.factories).       . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;CacheType, Class&lt;?&gt;&gt; MAPPINGS; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> { Map&lt;CacheType, Class&lt;?&gt;&gt; mappings = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;CacheType, Class&lt;?&gt;&gt;(); mappings.put(CacheType.GENERIC,    GenericCacheConfiguration.class); mappings.put(CacheType.EHCACHE,    EhCacheCacheConfiguration.class); mappings.put(CacheType.HAZELCAST,  HazelcastCacheConfiguration.class); mappings.put(CacheType.INFINISPAN, InfinispanCacheConfiguration.class); mappings.put(CacheType.JCACHE,     JCacheCacheConfiguration.class); mappings.put(CacheType.COUCHBASE,  CouchbaseCacheConfiguration.class); mappings.put(CacheType.REDIS,      RedisCacheConfiguration.class); mappings.put(CacheType.CAFFEINE,   CaffeineCacheConfiguration.class); addGuavaMapping(mappings); mappings.put(CacheType.SIMPLE,     SimpleCacheConfiguration.class); mappings.put(CacheType.NONE,       NoOpCacheConfiguration.class); MAPPINGS = Collections.unmodifiableMap(mappings); }</code> </pre><br>  ,          . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c3b/2fc/453/c3b2fc453c4a8dc085495a14e5e55fe5.png"><br><br>   . : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/620/a14/247/620a1424730c6f0a49c87e212966e049.png"><br><br>   .   ‚Äî , ,  ,      open closed principle ‚Äî   spring.factories,     .     ,    -   . <br><br>      ,    Spring Boot,    ‚Äî   90 .     30 ,     Spring Boot. <br><br>    ,     .   2013  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>  ,    Spring 4,  ,    <code>@Conditional</code> ,        conditions,    ,  <code>true</code>  <code>false</code> .       ,  .  java-  Spring   ,      conditional.  ,  ,   conditional  <code>false</code> ,    . <br><br>   .       ,     ,    ,    -  . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2cc/f90/83f/2ccf9083f1a80c0d6b7723d846912b2e.png"><br><br>    . <br><br><h2>   1.2.     </h2><br>     .  ‚Äî  ,    .    ,    ,   . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e1f/17e/71d/e1f17e71dcd1ec015e9044dbf021fbba.png"><br><br>  listener,   ,  ,    .   . <br><br>     : <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> &lt;b&gt;<span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span>&lt;/b&gt; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(); } }</code> </pre><br>   ,     ?      ,  : ¬´ Windows  ,   ,    Windows,  ¬ª.    conditional. <br><br>    ,        :   ,   : ¬´  ¬ª.  condition    Spring Boot. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Conditional</span></span>(OnProductionCondition.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> ConditionalOnProduction { }</code> </pre><br>  - : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnProductionCondition</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Condition</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">matches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JOptionPane.showConfirmDialog(parentComponent: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">" ?"</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos tentar. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/431/b6d/865/431b6d8658b449e804b2cad93ecf6f08.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√≥s aumentamos o servi√ßo, clique em sim na janela e o corvo voa (um ouvinte √© criado). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Come√ßamos novamente, respondemos N√£o, o corvo n√£o voa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, a anota√ß√£o </font></font><code>@Conditional(OnProductionCondition.class)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se refere √† classe rec√©m escrita, onde existe um m√©todo que deve retornar </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Esse ar condicionado pode ser inventado independentemente, o que torna a aplica√ß√£o muito din√¢mica, permitindo que ela funcione de maneira diferente em diferentes condi√ß√µes.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pazzler </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ent√£o </font></font><code>@ConditionalOnProduction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√≥s escrevemos. Podemos fazer v√°rias configura√ß√µes, coloc√°-las em condi√ß√£o. Suponha que tenhamos nossa pr√≥pria condi√ß√£o e que seja popular </font></font><code>@ConditionalOnProduction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. E h√°, por exemplo, 15 gr√£os necess√°rios apenas na produ√ß√£o. Marquei-os com esta anota√ß√£o. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pergunta: a</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> l√≥gica que descobre se √© produ√ß√£o ou n√£o, quantas vezes deve funcionar? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que diferen√ßa isso funciona? Bem, talvez essa l√≥gica seja cara, leva tempo e tempo √© dinheiro. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como ilustra√ß√£o, criamos um exemplo:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOn</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UndeadArmyConfiguration</span></span></span><span class="hljs-class"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DragonIslandConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOn</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> DragonGlassFactory </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragonGlassFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DragonGlassFactory(); } ... }</code> </pre><br>      :  ,  .   - ‚Äî  ,    . <br><br>    .          ‚Äî     ,  ,  . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/69d/220/f6e/69d220f6e04188268807f41dcde6c5ed.png"><br><br>      ,       (  <code>OnProductionCondition.class</code>   ,       ‚Äî   ).    .   ,      ,        ,  - .      5 ? <br><br> <b> </b>    ‚Äî 300  400.     -  .    ,   ,  .    ‚Äî   . <br><br>  .       ( <code>@Component</code> , <code>@Configuration</code>  <code>@Service</code>      ),         .        ,   . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOn</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UndeadArmyConfiguration</span></span></span><span class="hljs-class"> </span></span>{ ... }</code> </pre><br>      ,    . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DragonIslandConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOn</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> DragonGlassFactory </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragonGlassFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DragonGlassFactory(); } ... }</code> </pre><br>       ,   ,   .     ,    -   ,          ,  300.       ,     ,      .  400. <br><br>  :         ?      : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6c7/efa/d4b/6c7efad4bc5e1279c7ba350355a0fa59.png"><br><br>  ,   .   :     -,      ,    ,      .          ,   ,   . <br><br><h2>   1.3.    </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Continuamos a desenvolver nossa inicia√ß√£o. De alguma forma, devemos especificar o voo do corvo. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/932/4fc/726/9324fc726c3e1f36d5459fae6838f093.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em que arquivo prescrevemos coisas para o iniciante? Os iniciantes trazem uma configura√ß√£o na qual existem beans. Como esses beans s√£o configurados? Onde eles obt√™m a fonte de dados, o usu√°rio etc. Naturalmente, eles t√™m padr√µes para todas as ocasi√µes, mas como eles permitem que isso seja redefinido? Existem duas op√ß√µes: </font></font><code>application.properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>application.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. L√°, voc√™ pode inserir algumas informa√ß√µes que ainda ser√£o lindamente preenchidas automaticamente no IDEA. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que torna a nossa partida pior? Quem o usa tamb√©m deve saber em quais endere√ßos o corvo est√° voando - precisamos fazer uma lista de destinat√°rios. Este √© o primeiro.</font></font><br><br>  ‚Äî  ,        ,       .       listener-,   .  I.e.   ,         ,  .    ,    ,    . <br><br>   ‚Äî    ,  ,      ,     ,   . <br><br>          .         .    - ? <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConditionalOnBean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnCloudPlatform</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnExpression</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnJava</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnJndi</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingClass</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnNotWebApplication</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnResource</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnSingleCandidate</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnWebApplication</span></span> ...</code> </pre><br>  ,   ,   .    <code>@ConditionalOnProperty</code> .  ,  ,    property  property  - ,   application.yml.     <code>@ConfigurationalProperty</code> ,   . <br><br><h2>  </h2><br>    ,   property  .  ,       ,    application.yml   ,     . <br><br>   property ¬´¬ª.   ,  . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConfigurationProperties</span></span>(<span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RavenProperties</span></span></span><span class="hljs-class"> </span></span>{ List&lt;String&gt; ; }</code> </pre><br> IDEA  ,   -  : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/377/da5/e03/377da5e032812dd581b7832e2e6ef56b.png"><br><br>   ,       ( Maven      ,   ¬´ ¬ª).      . <br><br><pre> <code class="java hljs">subproject { dependencies { compileOnly <span class="hljs-string"><span class="hljs-string">'org.springframework.boot:spring-boot-configuration-processor'</span></span> compile <span class="hljs-string"><span class="hljs-string">'org.springframework.boot: spring-boot-starter'</span></span> } }</code> </pre><br>    IDEA,    . <br><br> ,     .  ,   annotation processor.      ,      - . ,  Lombok   annotation processor,          ‚Äî , . <br><br>     property,    application properties?  JSON-,   IDEA  .      property,  IDEA   .   ,  property,     , IDEA   ,     : <br><br><ul><li>        JSON       ; <br></li><li>    annotation processor  Spring Boot,     JSON-     .   properties   ,    Spring Boot,     ,  property holder.    annotation processor Spring Boot   ,  <code>@ConfigurationalProperties</code> ,     property,   JSON.   ,     ,   JSON  . <br></li></ul><br>     <code>@EnableConfigurationProperties</code> ,         . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(); } }</code> </pre><br>    ,    ,     ,    (      property,   ). <br><br>       : <br><br><ul><li> <code>@EnableConfigurationProperties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indicando quais propriedades; </font></font><br></li><li> <code>@ConfigurationalProperties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dizendo que prefixo. </font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E n√£o se deve esquecer getters e setters. </font><font style="vertical-align: inherit;">Eles tamb√©m s√£o importantes, caso contr√°rio nada funciona - a a√ß√£o n√£o sobe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como resultado, temos um arquivo que pode, em princ√≠pio, ser escrito manualmente. </font><font style="vertical-align: inherit;">Mas ningu√©m gosta de escrever manualmente.</font></font><br><br><pre> <code class="java hljs">{ <span class="hljs-string"><span class="hljs-string">"hints"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"groups"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"sourceType"</span></span>: <span class="hljs-string"><span class="hljs-string">"com.ironbank.RavenProperties"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"com.ironbankRavenProperties"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"properties"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"sourceType"</span></span>: <span class="hljs-string"><span class="hljs-string">"com.ironbank.RavenProperties"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"."</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"java.util.List&lt;java.lang.String&gt;"</span></span> } ] }</code> </pre><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Endere√ßo para raven </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fizemos a primeira parte da tarefa - obtivemos algumas propriedades. </font><font style="vertical-align: inherit;">Mas ningu√©m est√° relacionado a essas propriedades ainda. </font><font style="vertical-align: inherit;">Agora eles precisam ser definidos como condi√ß√£o para criar nosso ouvinte.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(); } }</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicionamos mais uma condi√ß√£o: um corvo deve ser criado apenas com a condi√ß√£o de que algu√©m diga para onde voar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora vamos escrever para onde voar em application.yml.</font></font><br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">spring</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">application</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.name</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">money-raven</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">jpa</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.hibernate</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ddl-auto</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">validate</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ironbank</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>:   <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>  : <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>: ,   : <span class="hljs-selector-tag"><span class="hljs-selector-tag">true</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resta prescrever em l√≥gica que ele voe para onde foi informado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para fazer isso, podemos gerar um construtor. </font><font style="vertical-align: inherit;">O novo Spring possui uma inje√ß√£o de construtor - esta √© a maneira recomendada. </font><font style="vertical-align: inherit;">Eugene gosta de </font></font><code>@Autowired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fazer tudo aparecer no aplicativo atrav√©s da reflex√£o. </font><font style="vertical-align: inherit;">Adoro seguir as conven√ß√µes que a Spring oferece:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RequiredArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RavenListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextRefreshedEvent</span></span></span><span class="hljs-class">&gt;</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RavenProperties ravenProperties; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextRefreshedEvent event)</span></span></span><span class="hljs-function"> </span></span>{ ravenProperties.get().forEach(s -&gt; { System.out.println(<span class="hljs-string"><span class="hljs-string">" ‚Ä¶ "</span></span> + s); }); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas n√£o √© gr√°tis. </font><font style="vertical-align: inherit;">Por um lado, voc√™ obt√©m um comportamento verific√°vel, por outro, algumas hemorr√≥idas.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(r); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em nenhum lugar existe </font></font><code>@Aurowired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, com o Spring 4.3 voc√™ n√£o pode instal√°-lo. </font><font style="vertical-align: inherit;">Se houver um √∫nico construtor, √© </font></font><code>@Aurowired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nesse caso, √© usada uma anota√ß√£o </font></font><code>@RequiredArgsConstructor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que gera um √∫nico construtor. </font><font style="vertical-align: inherit;">Isso √© equivalente a esse comportamento:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RavenListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextRefreshedEvent</span></span></span><span class="hljs-class">&gt;</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RavenProperties ravenProperties; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RavenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties ravenProperties)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ravenProperties = ravenProperties; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextRefreshedEvent event)</span></span></span><span class="hljs-function"> </span></span>{ ravenProperties.get().forEach(s -&gt; { System.out.println(<span class="hljs-string"><span class="hljs-string">" ‚Ä¶ "</span></span> + s); }); } }</code> </pre><br> Spring       Lombok. Jurgen Holler,   2002   80%  Spring,   <code>@Aurowired</code> ,    (        ). <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RavenListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextRefreshedEvent</span></span></span><span class="hljs-class">&gt;</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RavenProperties ravenProperties; <span class="hljs-meta"><span class="hljs-meta">@Aurowired</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RavenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties ravenProperties)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ravenProperties = ravenProperties; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextRefreshedEvent event)</span></span></span><span class="hljs-function"> </span></span>{ ravenProperties.get().forEach(s -&gt; { System.out.println(<span class="hljs-string"><span class="hljs-string">" ‚Ä¶ "</span></span> + s); }); } }</code> </pre><br>      ?    <code>RavenProperties</code>  Java-.    <code>@Aurowired</code>  ,      . <br><br> ,  .   ,           ,      ,         . <br><br><h2>   1.4.   </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/cdd/00e/5a3/cdd00e5a367e65ca813b456d704b8e44.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acontece que voc√™ precisa personalizar o comportamento do iniciador. Por exemplo, n√≥s temos nosso pr√≥prio corvo preto. E precisamos de um branco que fume, e queremos envi√°-lo para que as pessoas vejam fuma√ßa no horizonte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos passar da alegoria para a vida real. O iniciante me trouxe um monte de beans de infraestrutura, e isso √© √≥timo. Mas eu n√£o gosto de como eles est√£o configurados. Entrei nas propriedades do aplicativo e mudei algo por l√°, e agora gosto de tudo. Mas h√° situa√ß√µes em que as configura√ß√µes s√£o t√£o complicadas que √© mais f√°cil registrar a fonte de dados do que tentar descobrir as propriedades do aplicativo. Ou seja, queremos registrar a fonte de dados na lixeira recebida do iniciador. O que acontecer√° ent√£o? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu mesmo registrei algo, e o iniciante me trouxe minha fonte de dados. Eu tenho dois agora? Ou algu√©m esmagar√° um (e qual?)</font></font><br><br>       ,    - ,    ,  ,   .  ,   . <br><br>    ,     : <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConditionalOnBean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnCloudPlatform</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnExpression</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnJava</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnJndi</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingClass</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnNotWebApplication</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnResource</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnSingleCandidate</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnWebApplication</span></span> ...</code> </pre><br>  , <code>@ConditionalOnMissingBean</code>  ,    .   ,  ,    ,         . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span>&lt;/b&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(r); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ abrir a maioria dos iniciantes, ver√° que cada compartimento, cada configura√ß√£o est√° pendurada com um pacote de anota√ß√µes. </font><font style="vertical-align: inherit;">Estamos apenas tentando fazer um an√°logo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao tentar lan√ßar o corvo n√£o foi, mas o Evento apareceu, o que escrevemos em nosso novo ouvinte - </font></font><code>MyRavenListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/456/3a1/93c/4563a193c67943645fc7a4c006cd791b.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existem dois pontos importantes aqui. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O primeiro ponto √© que ficamos viciados em nosso ouvinte existente e n√£o escrevemos nenhum ouvinte l√°:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyRavenListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyRavenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties ravenProperties)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(ravenProperties); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextRefreshedEvent event)</span></span></span><span class="hljs-function"> </span></span>{ ravenProperties.get().forEach(s -&gt; { System.out.println(<span class="hljs-string"><span class="hljs-string">"event = "</span></span> + event); }); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Segundo - fizemos com a ajuda do componente. </font><font style="vertical-align: inherit;">Se o fizermos em uma configura√ß√£o Java, ou seja, </font><font style="vertical-align: inherit;">registraria a mesma classe que um bean de configura√ß√£o, nada funcionaria para n√≥s. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se eu limpar </font></font><code>extends</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e apenas criar algum tipo de ouvinte de aplicativo, </font></font><code>@ConditionalOnMissingBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o funcionar√°.</font></font> Mas desde<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a classe tamb√©m √© chamada, quando tentamos cri√°-la, podemos escrever </font></font><code>ravenListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- exatamente como t√≠nhamos em nossa configura√ß√£o. Acima, focamos no fato de que o nome do bean na configura√ß√£o Java ser√° pelo nome do m√©todo. E, neste caso, criamos uma lixeira chamada </font></font><code>ravenListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br>      ?  Spring Boot   ,   .   ,   , , . -     ,         ,   .    .  ,          ,    ,     ,      ,      (     ,       ,      ).   ,    ,   ,   ,    . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, um conflito de feij√£o √© uma boa situa√ß√£o porque voc√™ o v√™. </font><font style="vertical-align: inherit;">Se especificarmos os mesmos nomes de bin, n√£o teremos conflito. </font><font style="vertical-align: inherit;">Um bean simplesmente substituir√° outro. </font><font style="vertical-align: inherit;">E voc√™ entender√° por um longo tempo onde est√° o que estava l√°. </font><font style="vertical-align: inherit;">Por exemplo, se criarmos algum tipo de fonte de dados </font></font><code>@Bean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ela substituir√° a fonte de dados existente </font></font><code>@Bean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A prop√≥sito, se o acionador de partida carrega o que voc√™ n√£o precisa, basta fazer uma lixeira com o mesmo ID e pronto. </font><font style="vertical-align: inherit;">√â verdade que, se o iniciador de alguma vers√£o alterar o nome do m√©todo, √© isso, sua lixeira ser√° novamente dois.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ConditionalOnPuzzler </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temos </font></font><code>@ConditionalOnClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>@ConditionalOnMissingBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode haver escrevendo classes. </font><font style="vertical-align: inherit;">Como exemplo, considere a configura√ß√£o de execu√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√° sab√£o, h√° uma corda - penduramos na forca. </font><font style="vertical-align: inherit;">H√° uma cadeira e uma corrente - √© l√≥gico colocar uma pessoa em uma cadeira. </font><font style="vertical-align: inherit;">H√° uma guilhotina e um bom humor - isso significa que voc√™ precisa cortar cabe√ßas.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">  </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span>({.class, .class}) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span>({.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>  () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (<span class="hljs-string"><span class="hljs-string">"..."</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span>({.class, .class}) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span>({.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>  c() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (<span class="hljs-string"><span class="hljs-string">" "</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span>({.class, .class}) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span>({.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>  () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (<span class="hljs-string"><span class="hljs-string">" "</span></span>); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como vamos executar? </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pergunta:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Como as anota√ß√µes de tipo podem </font></font><code>@ConditionalOnMissingClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funcionar </font><font style="vertical-align: inherit;">em geral </font><font style="vertical-align: inherit;">? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suponha que eu tenha um m√©todo que crie uma forca. </font><font style="vertical-align: inherit;">Mas uma caixa de forca s√≥ deve ser criada se houver sab√£o e corda. </font><font style="vertical-align: inherit;">Mas n√£o h√° sab√£o. </font><font style="vertical-align: inherit;">Como posso entender que n√£o h√° sab√£o ou apenas corda. </font><font style="vertical-align: inherit;">O que acontece se eu tentar ler anota√ß√µes de um m√©todo, e essas anota√ß√µes se referirem a classes que n√£o s√£o? </font><font style="vertical-align: inherit;">Posso fazer essas anota√ß√µes? </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Op√ß√µes de resposta:</font></font></b> <br><ul><li> ClassDefNotFound?     ,    .     - ,  ClassDefNotFound  ,       reflection-    ,   conditional as long as; <br></li><li>   ,  .  reflection    .     ,  . <br></li><li>  ; <br></li><li>   . <br></li></ul><br><div class="spoiler"> <b class="spoiler_title"></b> <div class="spoiler_text"> <b>:</b>  ,   .    reflection   .    exception,     ,        ‚Äî    .   reflection?        ,      ,    ,    ,     ‚Äî   <code>ClassDefNotFound</code> . <br></div></div><br>      ASM. ,   reflection ‚Äî , Spring   -, , .   ,       ,  ,    <code>@Conditional</code>  , .          .  ASM ‚Äî ,  ,   .    ,   ,    . <br><br>  Juergen Hoeller      ,  ,   ,    <code>OnMissingClass</code> ,         (String).    ,   ,  ASM  . ,   ,    . <br><br><h2>   1.5.     </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/eb6/9b9/b83/eb69b9b8361dcc9924dc843290af9af2.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Precis√°vamos de outra propriedade - a capacidade de ativar ou desativar o corvo manualmente. Para n√£o enviar ningu√©m garantido. Esta √© a √∫ltima condi√ß√£o que lhe mostramos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nosso titular n√£o d√° nada, exceto um corvo. Portanto, voc√™ pode perguntar: por que ser capaz de ligar / desligar, voc√™ pode simplesmente n√£o aceit√°-lo? Mas, na segunda parte, coisas √∫teis adicionais ser√£o inclu√≠das neste iniciador. Especificamente, um corvo pode n√£o ser necess√°rio - √© caro, pode ser desligado. Ao mesmo tempo, n√£o √© muito bom remover o ponto final para onde envi√°-lo - parece uma muleta. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, faremos tudo </font></font><code>@ConditionalOnProperty(".")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(r); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E ele jura para n√≥s que isso n√£o pode ser feito: anota√ß√£o duplicada. </font><font style="vertical-align: inherit;">O problema √© que, se tivermos uma anota√ß√£o com alguns par√¢metros, ela n√£o poder√° ser repetida. </font><font style="vertical-align: inherit;">N√£o podemos fazer isso em duas propriedades. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temos m√©todos para esta anota√ß√£o, existe String e esta √© uma matriz - voc√™ pode especificar v√°rias propriedades l√°.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Conditional</span></span>(OnPropertyCondition.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> ConditionalOnProperty { String[] value() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prefix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> ""</span></span>; String[] name() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">havingValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> ""</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">matchIfMissing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">false</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">relaxedNames</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">true</span></span></span></span>; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E tudo est√° bem, at√© voc√™ tentar personalizar o valor de cada elemento nessa matriz separadamente. </font><font style="vertical-align: inherit;">Temos uma propriedade </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que deve ser </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e √© outra propriedade, que deve ter </font></font><code>string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um certo valor. </font><font style="vertical-align: inherit;">Mas voc√™ pode especificar apenas um valor em todas as propriedades. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ou seja, voc√™ n√£o pode fazer isso:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(name = <span class="hljs-string"><span class="hljs-string">"."</span></span>, havingValue=<span class="hljs-string"><span class="hljs-string">"true"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(name = <span class="hljs-string"><span class="hljs-string">"."</span></span>,  havingValue=<span class="hljs-string"><span class="hljs-string">"true"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(name = <span class="hljs-string"><span class="hljs-string">"."</span></span>,havingValue=<span class="hljs-string"><span class="hljs-string">"false"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IronBankApplicationListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applicationListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... }</code> </pre><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>( name = {    <span class="hljs-string"><span class="hljs-string">"."</span></span>,    <span class="hljs-string"><span class="hljs-string">"."</span></span>,    <span class="hljs-string"><span class="hljs-string">"."</span></span> }, havingValue = <span class="hljs-string"><span class="hljs-string">"true"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IronBankApplicationListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applicationListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... }</code> </pre><br>   ‚Äî   . <br><br>  ,      property, ,      : <code>AllNestedConditions</code>  <code>AnyNestedCondition</code> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ae2/7f1/0fe/ae27f10fea30542adc8340f98dc85887.png"><br><br>  ,  , .   .     ‚Äî  ,     <code>.</code>  <code>.</code> . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnRaven</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(r); } }</code> </pre><br>     <code>@Conditional()</code>      - . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Conditional</span></span>({OnRavenCondional.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> CondionalOnRaven { }</code> </pre><br><br>  . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Condition</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre><br>      - ,      ,       : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CompositeCondition</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AllNestedConditions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(  name = <span class="hljs-string"><span class="hljs-string">"."</span></span>,  havingValue = <span class="hljs-string"><span class="hljs-string">"false"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenProperty</span></span></span><span class="hljs-class"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(  name = <span class="hljs-string"><span class="hljs-string">".enabled"</span></span>,  havingValue = <span class="hljs-string"><span class="hljs-string">"true"</span></span>,  matchIfMissing = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenEnabled</span></span></span><span class="hljs-class"> </span></span>{ } ... }</code> </pre><br>     <code>Conditional</code> ,        ‚Äî  <code>AllNestedConditions</code> ,  <code>AnyNestedCondition</code> ‚Äî       ,     .  I.e.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em vez disso </font></font><code>@Condition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, devemos especificar:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AllNestedConditions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(ConfigurationPhase.REGISTER_BEAN); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesse caso, voc√™ precisa criar um construtor dentro. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora temos que criar classes est√°ticas aqui. </font><font style="vertical-align: inherit;">N√≥s criamos algum tipo de classe (vamos cham√°-lo de R).</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AllNestedConditions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(ConfigurationPhase.REGISTER_BEAN); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class"> </span></span>{} }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√≥s fazemos o nosso valor </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(deve ser exatamente </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AllNestedConditions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(ConfigurationPhase.REGISTER_BEAN); } <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(value= <span class="hljs-string"><span class="hljs-string">"."</span></span>, havingValue = <span class="hljs-string"><span class="hljs-string">"true"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class"> </span></span>{} }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para repetir isso, lembre-se do nome da classe. </font><font style="vertical-align: inherit;">O Spring possui boas docas Java. </font><font style="vertical-align: inherit;">Voc√™ pode deixar o IDEA, ler o dock Java e entender o que precisa ser feito. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Montamos a nossa </font></font><code>@ConditionalOnRaven</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Em princ√≠pio, voc√™ pode agrupar ambos </font></font><code>@ConditionalOnProduction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">e </font><font style="vertical-align: inherit;">, e </font></font><code>@ConditionalOnMissingBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas agora n√£o faremos isso. </font><font style="vertical-align: inherit;">Basta ver o que aconteceu.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnRaven</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(r); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na aus√™ncia de um </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corvo n√£o deve voar. </font><font style="vertical-align: inherit;">Ele n√£o voou. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o quero apostar </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, porque precisamos primeiro fazer um preenchimento autom√°tico - esse √© um dos nossos requisitos.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConfigurationalProperties</span></span>(<span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RavenProperties</span></span></span><span class="hljs-class"> </span></span>{ List&lt;String&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> ; }</code> </pre><br>  S√≥ isso. <code></code>   <code>false</code> ,  <code>true</code>  <br> application.yml: <br><br><pre> <code class="java hljs">jpa.hibernate.ddl-auto: validate ironbank: ---: -  : : ,   : <span class="hljs-keyword"><span class="hljs-keyword">true</span></span></code> </pre><br> ,    . <br><br>                ,     repeatable.     Java.   . <br><br>    ,      ,        . <br><br><hr><br><br>  Minuto de publicidade. 19-20    Joker 2018,            <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">¬´          [Joker Edition]¬ª</a> ,         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">¬´Micronaut vs Spring Boot,     ?¬ª</a>  .  Em geral, haver√° muitos outros relat√≥rios interessantes e dignos de nota no Joker.  Os ingressos podem ser adquiridos no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site oficial da</a> confer√™ncia. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E tamb√©m temos uma pequena pesquisa para voc√™! </font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt424503/">https://habr.com/ru/post/pt424503/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt424491/index.html">Mapas do hex√°gono da unidade: rugosidade, rios e estradas</a></li>
<li><a href="../pt424495/index.html">O Google Chrome adicionar√° a capacidade de recusar a sincroniza√ß√£o autom√°tica de perfis ao fazer login nos servi√ßos da empresa *</a></li>
<li><a href="../pt424497/index.html">Pare de suspeitar dos desenvolvedores de impostura. Aprenda a entrevistar melhor</a></li>
<li><a href="../pt424499/index.html">Bem, ele, seu pentesto</a></li>
<li><a href="../pt424501/index.html">Terminais de diagn√≥stico para soldadores reais</a></li>
<li><a href="../pt424505/index.html">‚ÄúTemos ideias para o Maven 4 e at√© o Maven 5‚Äù - uma entrevista com Robert Scholte, um participante importante no projeto Maven</a></li>
<li><a href="../pt424507/index.html">VI Hackathon Anual da JetBrains: Shiftius Altius Ctrlius</a></li>
<li><a href="../pt424509/index.html">Trabalhando com a API KOMPAS-3D ‚Üí Li√ß√£o 12 ‚Üí Linhas compostas</a></li>
<li><a href="../pt424511/index.html">Ferramentas para localizar classes anotadas em Java</a></li>
<li><a href="../pt424513/index.html">Sobre data centers baratos, prote√ß√£o ILV e DDoS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>