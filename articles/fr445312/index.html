<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•ß üò≤ ‚úùÔ∏è Allocation de m√©moire JVM üë©üèº‚Äçü§ù‚Äçüë®üèª üïì ü¶é</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous! Nous voulons faire co√Øncider la traduction du mat√©riel d'aujourd'hui avec le lancement d'un nouveau fil dans le cours Java Developer ,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Allocation de m√©moire JVM</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/445312/"> Bonjour √† tous!  Nous voulons faire co√Øncider la traduction du mat√©riel d'aujourd'hui avec le lancement d'un nouveau fil dans le cours <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Java Developer</a> , qui commence demain.  Eh bien, commen√ßons. <br><br>  La JVM peut √™tre une b√™te complexe.  Heureusement, la majeure partie de cette complexit√© est cach√©e sous le capot, et nous, en tant que d√©veloppeurs d'applications et responsables du d√©ploiement, n'avons souvent pas √† nous en pr√©occuper.  Bien qu'en raison de la popularit√© croissante de la technologie pour le d√©ploiement d'applications dans des conteneurs, il convient de pr√™ter attention √† l'allocation de m√©moire dans la JVM. <br><br><img src="https://habrastorage.org/webt/ju/oj/ek/juojekjvyfc9pflhqawoxksp-pe.png"><br><br>  <b>Deux types de m√©moire</b> <br><br>  La JVM divise la m√©moire en deux cat√©gories principales: tas et non-tas.  Un tas est un morceau de m√©moire JVM que les d√©veloppeurs connaissent le mieux.  Les objets cr√©√©s par l'application sont stock√©s ici.  Ils y restent jusqu'√† ce qu'ils soient retir√©s par le ramasse-miettes.  En r√®gle g√©n√©rale, la taille de segment de m√©moire que l'application utilise varie en fonction de la charge actuelle. <br><a name="habracut"></a><br>  La m√©moire hors segment est divis√©e en plusieurs zones.  Dans HotSpot, vous pouvez utiliser le m√©canisme de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">suivi de la m√©moire native (NMT)</a> pour explorer les zones de cette m√©moire.  Veuillez noter que m√™me si NMT ne suit pas l'utilisation de toute la m√©moire native ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">par exemple, il ne suit pas l'allocation de m√©moire native par du code tiers</a> ), ses capacit√©s sont suffisantes pour la plupart des applications Spring typiques.  Pour utiliser NMT, ex√©cutez l'application avec l' <code>-XX:NativeMemoryTracking=summary</code> et en utilisant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">jcmd VM.native_memory r√©sum√© voir les informations sur la m√©moire utilis√©e.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><br><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Prenons l'exemple de la NMT de notre vieil ami Petclinic</a> .  Le diagramme ci-dessous montre l'utilisation de la m√©moire JVM en fonction des donn√©es NMT (moins sa propre surcharge NMT) lors du d√©marrage de Petclinic avec une taille de segment de m√©moire maximale de 48 Mo ( <code>-Xmx48M</code> ): <br><br><img src="https://habrastorage.org/webt/m8/nk/be/m8nkberjczog7bolri8lwoglbbm.png"><br><br>  Comme vous pouvez le voir, la m√©moire en dehors du segment repr√©sente la majeure partie de la m√©moire JVM utilis√©e et la m√©moire du segment ne repr√©sente qu'un sixi√®me du total.  Dans ce cas, il s'agit d'environ 44 Mo (dont 33 Mo ont √©t√© utilis√©s imm√©diatement apr√®s la collecte des ordures).  L'utilisation de la m√©moire hors segment a totalis√© 223 Mo. <br><br>  <b>Zones de m√©moire native</b> <br><br>  <b>Espace de classe compress√©</b> : utilis√© pour stocker des informations sur les classes charg√©es.  Limit√© au param√®tre <code>MaxMetaspaceSize</code> .  Une fonction du nombre de classes qui ont √©t√© charg√©es. <br><br>  <i>Note du traducteur</i> <br><br><blockquote>  Pour une raison quelconque, l'auteur √©crit sur l'espace de classe compress√©, et non sur la zone de classe enti√®re.  La zone d'espace de classe compress√© fait partie de la zone de classe et le param√®tre <code>MaxMetaspaceSize</code> limite la taille de la zone de classe enti√®re, pas seulement l'espace de classe compress√©.  Pour limiter ¬´l'espace de classe compress√©¬ª, le param√®tre <code>CompressedClassSpaceSize</code> est utilis√©. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">D'ici</a> : <br>  Si <code>UseCompressedOops</code> est activ√© et <code>UseCompressedClassesPointers</code> est utilis√©, deux zones logiquement diff√©rentes de m√©moire native sont utilis√©es pour les m√©tadonn√©es de classe ... <br>  Une r√©gion est allou√©e √† ces pointeurs de classe compress√©s (les d√©calages 32 bits).  La taille de la r√©gion peut √™tre d√©finie avec <code>CompressedClassSpaceSize</code> et est de 1 gigaoctet (Go) par d√©faut ... <br>  <code>MaxMetaspaceSize</code> s'applique √† la somme de l'espace de classe compress√© engag√© et de l'espace pour les autres m√©tadonn√©es de classe <br><br>  Si le param√®tre <code>UseCompressedOops</code> est <code>UseCompressedOops</code> et <code>UseCompressedOops</code> utilis√©, deux zones logiquement diff√©rentes de m√©moire native sont utilis√©es pour les m√©tadonn√©es de classe ... <br><br>  Pour les pointeurs compress√©s, une zone m√©moire est allou√©e (d√©calages 32 bits).  La taille de cette zone peut √™tre d√©finie par <code>CompressedClassSpaceSize</code> et par d√©faut elle est de 1 Go ... <br>  Le param√®tre <code>MaxMetaspaceSize</code> fait r√©f√©rence √† la somme de la zone du pointeur compress√© et de la zone des autres m√©tadonn√©es de classe. </blockquote><br><br><ul><li>  Thread: La m√©moire utilis√©e par les threads de la JVM.  La fonction du nombre de threads en cours d'ex√©cution. </li><li>  Cache de code: la m√©moire utilis√©e par JIT pour l'ex√©cuter.  Une fonction du nombre de classes qui ont √©t√© charg√©es.  Limit√© √† <code>ReservedCodeCacheSize</code> .  Vous pouvez r√©duire le param√®tre de JIT, par exemple, en d√©sactivant la compilation √† plusieurs niveaux. </li><li>  GC (garbage collector): stocke les donn√©es utilis√©es par le garbage collector.  D√©pend du ramasse-miettes utilis√©. </li><li>  Symbole: stocke des caract√®res tels que les noms de champ, les signatures de m√©thode et les cha√Ænes internes.  Une utilisation excessive de la m√©moire de caract√®res peut indiquer que les lignes sont trop internes. </li><li>  Interne: stocke d'autres donn√©es internes qui ne sont incluses dans aucune des autres zones. </li></ul><br>  <b>Les diff√©rences</b> <br><br>  Par rapport √† un tas, la m√©moire hors tas change moins sous charge.  D√®s que l'application charge toutes les classes qui seront utilis√©es et que le JIT est compl√®tement r√©chauff√©, tout passe dans un √©tat stable.  Pour voir une diminution de l'utilisation de l' <i>espace de classe compress√©</i> , le chargeur de classe qui a charg√© les classes doit √™tre supprim√© par le garbage collector.  Cela √©tait courant dans le pass√© lorsque les applications √©taient d√©ploy√©es dans des conteneurs de servlets ou des serveurs d'applications (le chargeur de classe d'application a √©t√© supprim√© par le garbage collector lorsque l'application a √©t√© supprim√©e du serveur d'applications), mais cela se produit rarement avec les approches modernes du d√©ploiement d'applications. <br><br>  <b>Configurer la JVM</b> <br><br>  Il n'est pas facile de configurer la JVM pour utiliser efficacement la RAM disponible.  Si vous ex√©cutez la machine <code>-Xmx16M</code> avec le param√®tre <code>-Xmx16M</code> et n'attendez pas plus de 16 Mo de m√©moire √† utiliser, vous obtiendrez une surprise d√©sagr√©able. <br><br>  Un domaine int√©ressant de la m√©moire JVM est le cache de code JIT.  Par d√©faut, HotSpot JVM utilise jusqu'√† 240 Mo.  Si le cache de code est trop petit, le JIT peut ne pas avoir suffisamment d'espace pour stocker ses donn√©es et, par cons√©quent, les performances seront r√©duites.  Si le cache est trop volumineux, la m√©moire peut √™tre gaspill√©e.  Lors de la d√©termination de la taille d'un cache, il est important de prendre en compte son effet sur l'utilisation de la m√©moire et les performances. <br><br>  Lors de l'ex√©cution dans un conteneur Docker, les derni√®res versions de Java sont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©sormais conscientes</a> des limites de m√©moire du conteneur et tentent de redimensionner la m√©moire JVM en cons√©quence.  Malheureusement, beaucoup de m√©moire est souvent allou√©e en dehors du tas et pas assez dans le tas.  Supposons que vous ayez une application ex√©cut√©e dans un conteneur avec 2 processeurs et 512 Mo de m√©moire disponible.  Vous souhaitez g√©rer plus de charge de travail et augmenter le nombre de processeurs √† 4 et la m√©moire √† 1 Go.  Comme nous l'avons vu ci-dessus, la taille du tas varie g√©n√©ralement avec la charge et la m√©moire en dehors du tas change beaucoup moins.  Par cons√©quent, nous nous attendons √† ce que la plupart des 512 Mo suppl√©mentaires soient allou√©s au tas pour g√©rer la charge accrue.  Malheureusement, par d√©faut, la JVM ne le fera pas et r√©partira la m√©moire suppl√©mentaire plus ou moins √©galement entre la m√©moire du tas et hors du tas. <br><br>  Heureusement, l'√©quipe CloudFoundry poss√®de une connaissance approfondie de l'allocation de m√©moire dans la JVM.  Si vous t√©l√©chargez des applications sur CloudFoundry, le pack de construction vous appliquera automatiquement ces connaissances.  Si vous n'utilisez pas CloudFoudry ou souhaitez en savoir plus sur la configuration de JVM, il est recommand√© de lire la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">description de la</a> troisi√®me version du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">calculateur de m√©moire</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Java buildpack</a> . <br><br>  <b>Qu'est-ce que cela signifie pour le printemps</b> <br><br>  L'√©quipe de Spring passe beaucoup de temps √† r√©fl√©chir aux performances et √† l'utilisation de la m√©moire, consid√©rant la possibilit√© d'utiliser la m√©moire sur le tas et hors du tas.  Une fa√ßon de limiter l'utilisation de la m√©moire en dehors du tas consiste √† rendre les parties du cadre aussi polyvalentes que possible.  Un exemple de cela est l'utilisation de Reflection pour cr√©er et injecter des d√©pendances dans les beans de votre application.  Gr√¢ce √† l'utilisation de Reflection, la quantit√© de code d'infrastructure que vous utilisez reste constante, quel que soit le nombre de beans dans votre application.  Pour optimiser le temps de d√©marrage, nous utilisons le cache sur le tas, effa√ßant ce cache une fois le lancement termin√©.  La m√©moire de tas peut √™tre facilement nettoy√©e par le garbage collector pour fournir plus de m√©moire disponible √† votre application. <br><br>  Traditionnellement, nous attendons vos commentaires sur le mat√©riel. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr445312/">https://habr.com/ru/post/fr445312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr445300/index.html">Nouvelles de l'industrie du jeu (11-25 mars 2019)</a></li>
<li><a href="../fr445302/index.html">"Game of Thrones, continue." Ce qu'Apple a montr√© aujourd'hui lors de son √©v√©nement Show Time</a></li>
<li><a href="../fr445304/index.html">Programmation de LibreOffice Base. 2e partie</a></li>
<li><a href="../fr445308/index.html">Caract√©ristiques des tests d'hypoth√®ses pour les applications mobiles</a></li>
<li><a href="../fr445310/index.html">Sovereign Runet a augment√© de prix √† to30 milliards</a></li>
<li><a href="../fr445314/index.html">Pourquoi l'extraction des ast√©ro√Ødes est-elle difficile?</a></li>
<li><a href="../fr445316/index.html">DevDay G√©rer l'informatique. Enregistrement de performances</a></li>
<li><a href="../fr445318/index.html">Interruption (tarp) pour les connexions SSH entrantes</a></li>
<li><a href="../fr445320/index.html">Les disques roulent et roulent</a></li>
<li><a href="../fr445322/index.html">Grand choix de ressources utiles pour les chefs de produit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>