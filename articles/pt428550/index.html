<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï£ üéõÔ∏è üêå Um inversor com seno puro em 15 minutos ou "eletr√¥nica de pot√™ncia - para todos" üç® üßü ü§∞üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O que √© eletr√¥nica de pot√™ncia? Sem d√∫vida - este √© o mundo inteiro! Moderno e cheio de conforto. Muitas pessoas imaginam a eletr√¥nica de pot√™ncia com...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Um inversor com seno puro em 15 minutos ou "eletr√¥nica de pot√™ncia - para todos"</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428550/">  O que √© eletr√¥nica de pot√™ncia?  Sem d√∫vida - este √© o mundo inteiro!  Moderno e cheio de conforto.  Muitas pessoas imaginam a eletr√¥nica de pot√™ncia como algo ‚Äúm√°gico‚Äù e distante, mas olham em volta - quase tudo o que nos rodeia cont√©m um conversor de energia: uma fonte de alimenta√ß√£o para laptop, uma l√¢mpada LED, UPS, v√°rios reguladores, estabilizadores de tens√£o e medidores de frequ√™ncia (IF) ) na ventila√ß√£o ou elevador e muito mais.  A maioria desses equipamentos torna nossa vida confort√°vel e segura. <br><br>  Por v√°rias raz√µes, o desenvolvimento da eletr√¥nica de pot√™ncia √© uma das √°reas mais dif√≠ceis da eletr√¥nica - o pre√ßo do erro √© muito alto, enquanto o desenvolvimento de conversores de energia sempre atraiu amantes, trabalhadores de bricolage e n√£o apenas.  Certamente voc√™ queria construir uma fonte de alimenta√ß√£o poderosa para o seu projeto?  Ou talvez on-line UPS por um par de kW e n√£o ir √† fal√™ncia?  Ou talvez um chastotnik na oficina? <br><br>  Hoje vou falar sobre o meu pequeno projeto aberto, ou melhor, sobre a parte dele, que permitir√° a quem quiser entrar no mundo do desenvolvimento da eletr√¥nica de pot√™ncia e, ao mesmo tempo, permanecer vivo.  Como demonstra√ß√£o das possibilidades, mostrarei como montar um inversor de tens√£o de 12V DC a 230V AC com uma sa√≠da senoidal em 15 minutos.  Intrigado?  Vamos l√°! <br><br><img src="https://habrastorage.org/webt/na/rx/gk/narxgkn5e_6tiuqmfysesuukoug.jpeg"><br><a name="habracut"></a><br><br><h2>  Raz√µes do projeto </h2><br>  Nos √∫ltimos dois anos, o desenvolvimento de conversores de energia representou cerca de 90% dos meus pedidos, os principais custos de m√£o-de-obra v√£o principalmente para desenvolvimento e prototipagem de software, projeto de circuitos + rastreamento final da placa do custo total geralmente n√£o √© superior a 10-15%.  A√≠ vem o entendimento de que o processo de prototipagem, que inclui o desenvolvimento de software, precisa ser reduzido e otimizado de alguma forma. <br><br>  Como sempre, existem pelo menos duas maneiras: comprar depura√ß√£o pronta, por exemplo, da Texas Instrumets ou Infineon, mas elas geralmente s√£o personalizadas para uma tarefa espec√≠fica e custam de US $ 500 a US $ 5.000, enquanto n√£o h√° garantia de que haver√° uma ordem semelhante e esse investimento com alta probabilidade √© f√°cil n√£o vai pagar. <br>  A segunda op√ß√£o √© fazer voc√™ mesmo, mas faz√™-lo completamente √© quase o mesmo que lan√ßar "revis√£o +1 de ferro", o que resultar√° em despesas adicionais para o cliente.  Se n√£o for feito completamente, como sempre, tudo ficar√° irritado e em algum lugar algo cair√° at√© o layout, os componentes e o tempo. <br>  Depois de algum tempo, chamei a aten√ß√£o para a solu√ß√£o mais √≥bvia.  √â t√£o simples e √≥bvio que, durante muito tempo, me perguntei por que a mesma TI ou Infineon ainda n√£o haviam feito isso.  Agora vou falar sobre a minha "ilumina√ß√£o". <br><br>  Vejamos algumas das topologias de conversor de energia mais populares: <br><br><img src="https://habrastorage.org/webt/d8/_c/0v/d8_c0v8ih8ydkihocalqkrqc2xw.png"><br><img src="https://habrastorage.org/webt/gt/hy/fn/gthyfnx_nnsjohhak7ls4xjszny.png"><br><img src="https://habrastorage.org/webt/bk/ag/qq/bkagqqyzbrqjntnfuxsrrvuxpyy.png"><br><img src="https://habrastorage.org/webt/0y/w0/xp/0yw0xpwofk5jjf47usbdrwglyfy.png"><br><img src="https://habrastorage.org/webt/-c/mz/z_/-cmzz_9skvlq8ux30pjluy0zkvi.png"><br><br>  Agora olhe com cuidado novamente.  Pintei especificamente sem amarrar, apenas os principais componentes para torn√°-lo mais claro.  O que essas topologias t√™m em comum?  A primeira coisa que chama sua aten√ß√£o √© uma s√©rie de pontos em comum: <br><ul><li>  Todas as topologias incluem os principais componentes - capacitores, transistores e indut√¢ncia (indutor ou transformador).  S√£o tr√™s baleias de eletr√¥nica de pot√™ncia; </li><li>  Os transistores s√£o ligados em todos os lugares da mesma forma e formam a chamada "meia ponte".  Quase todas as topologias de conversor s√£o criadas a partir dele; </li><li>  A op√ß√£o de ligar o acoplador de meia ponte + capacitor n√£o muda em todas as topologias.  O tipo de indut√¢ncia e as op√ß√µes para incluir meias-pontes est√£o mudando. </li></ul><br><br>  A partir disso, podemos concluir que, com um determinado m√≥dulo padr√£o na forma de meia ponte + capacitor acoplado, voc√™ pode construir qualquer conversor adicionando apenas o indutor ou transformador necess√°rio.  Portanto, a solu√ß√£o √≥bvia para simplificar a cria√ß√£o de prot√≥tipos foi a cria√ß√£o desse m√≥dulo: <br><img src="https://habrastorage.org/webt/vx/d6/ec/vxd6ec8swnwqef7v6uhkljsysek.png"><br><br><h2>  A luta entre o bem e o mal </h2><br>  Infelizmente, um n√∫mero limitado de horas por dia e a pregui√ßa banal ditam suas condi√ß√µes.  Cheguei √† necessidade de criar este m√≥dulo h√° um ano, mas a implementa√ß√£o era constantemente transferida sob o lema - <i>"Definitivamente vou faz√™-lo no pr√≥ximo fim de semana!"</i>  . <br><br>  Talvez a ideia tenha permanecido na prateleira, se n√£o fosse por 2 eventos.  Em primeiro lugar, dois clientes me procuraram em um m√™s e todos queriam um conversor complexo e interessante de implementar, e o mais importante, eles estavam prontos para pagar muito bem.  Embora considerando que ele √© da Europa, pode ter sa√≠do barato para eles)) Ambos os projetos foram interessantes para mim, por exemplo, um deles era um "regulador de tens√£o trif√°sico com isolamento galv√¢nico (sic!)", Ou seja, um sistema trif√°sico Conversores PFC + 3 pontes (com mudan√ßa de fase) + retificador s√≠ncrono + inversor trif√°sico.  Tudo isso em SiC e muito compacto.  Em geral, aceitei 2 pedidos grandes, cada um deles ~ 800 horas-homem e um per√≠odo de 6 meses.  Como resultado, fui "for√ßado" a procurar maneiras de otimizar. <br><br>  Em segundo lugar, os caras da empresa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PCBway me</a> escreveram inesperadamente, muitos provavelmente pediram placas deles e se ofereceram para cooperar.  Eles apoiam ativamente projetos de hardware aberto, ou seja, a pr√≥pria iniciativa do CERN - Open Source Hardware.  A coopera√ß√£o √© simples e compreens√≠vel para ambas as partes - elas me fornecem taxas gratuitas para meus projetos, eu as abro e as coloco em seu site, em outros lugares j√° por solicita√ß√£o.  Para mim, tornou-se uma motiva√ß√£o adicional e, mais importante, minha consci√™ncia est√° limpa, porque  Encomende placas para prot√≥tipos h√° v√°rios anos e, para produ√ß√£o em massa, digo a amigos e parceiros sobre eles.  Agora, para isso, eu tamb√©m tenho um bolo na forma de placas gratuitas para pequenos projetos, voc√™ pode escrever frequentemente no hub)) <br><br>  E ent√£o o gelo quebrou, foi decidido criar n√£o apenas o m√≥dulo descrito anteriormente, mas todo um conjunto de desenvolvedores de eletr√¥nica de pot√™ncia e torn√°-lo aberto e acess√≠vel a todos. <br><br><h2>  Estrutura do projeto </h2><br>  No come√ßo do artigo, mencionei que vou contar apenas uma parte hoje - este √© o <b>m√≥dulo de energia da meia ponte</b> .  Somente ele permite criar um conversor simplesmente parafusando um circuito de controle, por exemplo, depurando o STM32-Discovery, Arduino, TMS320, TL494 ou o que voc√™ possui l√°.  N√£o h√° vincula√ß√£o a nenhuma plataforma ou MK. <br><br>  Somente este n√£o √© o projeto inteiro, mas parte)) Em que consiste o conversor de energia acabado?  Antes de tudo, a unidade de pot√™ncia precisa de um determinado m√≥dulo de controle para funcionar, para entender o que est√° acontecendo, √© necess√°ria uma indica√ß√£o e para entender o que est√° acontecendo a uma dist√¢ncia segura, tamb√©m h√° uma interface, por exemplo, Modbus RTU ou CAN. <br><br>  Como resultado, a estrutura geral do projeto fica assim: <br><br> <a href=""><img src="https://habrastorage.org/webt/oh/tj/ix/ohtjixc8dimubg0tr7mbjym_aqc.png"></a> <br><br>  Provavelmente, no futuro, tamb√©m escreverei um programa para calcular transformadores e bobinas, convencionais e planares.  At√© agora.  As diferentes partes do diagrama em forma de rascunho j√° foram implementadas e executadas em dois projetos; ap√≥s pequenas modifica√ß√µes, os artigos tamb√©m ser√£o escritos nelas e o c√≥digo-fonte estar√° dispon√≠vel. <br><br><h2>  M√≥dulo de alimenta√ß√£o de meia ponte </h2><br>  Agora √© hora de dar uma olhada no her√≥i de hoje.  O m√≥dulo √© universal e permite que voc√™ trabalhe com transistores Mosfet e IGBT, interruptores de baixa e alta tens√£o de at√© 1200V. <br><br>  <u>Recursos do m√≥dulo:</u> <br><ul><li>  Isolamento galv√¢nico do lado de controle (digital) da energia.  Tens√£o de ruptura do isolamento 3 kV; </li><li>  As teclas superior e inferior s√£o independentes, cada uma com seu pr√≥prio driver isolado galvanicamente e isolado galvanicamente dc / dc; </li><li>  O driver moderno da Infineon - 1EDC60I12AHXUMA1 √© aplicado.  A corrente de abertura / fechamento do pulso √© 6A / 10A.  Frequ√™ncia m√°xima - 1 MHz (testado at√© 1,5 MHz de forma est√°vel); </li><li>  Prote√ß√£o de corrente de hardware: shunt + op-amp + comparador + optocoupler; </li><li>  A corrente m√°xima √© 20A.  √â limitado n√£o por chaves, mas pelo tamanho do radiador e pela espessura dos pol√≠gonos de cobre. </li></ul><br><br>  A primeira revis√£o do m√≥dulo aparece no artigo, est√° totalmente operacional, mas haver√° uma segunda revis√£o, na qual as falhas de design puramente ser√£o eliminadas e os conectores ser√£o substitu√≠dos por outros mais convenientes.  Depois de completar a documenta√ß√£o, ele jogou o gerber na PCBway e ap√≥s 6 dias o correio bateu na minha porta e me entregou um charme: <br><br> <a href=""><img src="https://habrastorage.org/webt/bj/dw/lt/bjdwlt-ijg3_gdxfx0wfkwggk18.jpeg"></a> <br><br>  Uma semana depois, os <s>c√£es</s> finalmente trouxeram componentes de uma bela loja dom√©stica.  Como resultado, tudo foi montado: <br><br> <a href=""><img src="https://habrastorage.org/webt/kw/mv/cg/kwmvcghxvdiimkk9ili2zqfnorg.jpeg"></a> <br><br> <a href=""><img src="https://habrastorage.org/webt/ea/dg/cz/eadgczqqlkscl5n89r7ynnvyivm.jpeg"></a> <br><br>  Antes de prosseguir, vejamos o diagrama de circuitos do m√≥dulo.  Voc√™ pode fazer o download aqui - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PDF</a> . <br><br>  N√£o h√° nada complicado ou m√°gico.  A meia ponte habitual: 2 chaves abaixo, 2 acima, voc√™ pode soldar uma de cada vez.  O motorista, como escrito acima da fam√≠lia 1ED, √© muito mau e imortal.  Em todos os lugares da energia h√° uma indica√ß√£o, incluindo + 12V na sa√≠da dc / dc.  A prote√ß√£o √© implementada no elemento l√≥gico AND, se a corrente for excedida, o comparador produzir√° + 3,3V, iluminar√° o acoplador √≥ptico e atrair√° uma das entradas AND para o solo, o que significa que o estabelecimento de log.0 e o sinal PWM dos drivers desaparecer√£o.  E com 3 entradas foi usado especificamente, na pr√≥xima revis√£o, pretendo fazer prote√ß√£o contra superaquecimento pelo radiador e iniciar o sinal de erro tamb√©m.  Todas as fontes estar√£o no final do artigo. <br><br><h2>  Montamos o layout do inversor </h2><br>  Pensei durante muito tempo em como demonstrar a opera√ß√£o do m√≥dulo, para que n√£o fosse muito chato, √∫til e n√£o muito dif√≠cil, algu√©m poderia repetir.  Portanto, parei em um inversor de tens√£o, eles s√£o usados ‚Äã‚Äãpara trabalhar com pain√©is solares, se algo cheira no lado de baixa tens√£o, n√£o √© assustador, mas no lado de alta tens√£o, apenas quando voc√™ o liga, n√£o coloque as m√£os nele. <br><br>  O inversor em si √© feio e simples, a prop√≥sito, o MAP Energy √© rebitado assim mesmo, aqui est√° um exemplo at√© da implementa√ß√£o comercial dessa id√©ia.  O trabalho do inversor √© formar uma vari√°vel sinusoidal com uma frequ√™ncia de 50 Hz a partir de uma tens√£o de 12V DC, porque √© com isso que um transformador convencional a 50 Hz est√° acostumado a trabalhar.  Eu uso algum tipo de sovi√©tico, como OSM, f√°brica de enrolamento de 220V e √© usado como secund√°rio, e o ~ 8V prim√°rio √© enrolado com um barramento de cobre.  √â assim: <br><br> <a href=""><img src="https://habrastorage.org/webt/xf/6c/js/xf6cjsweiig-ter1invjtnfslci.jpeg"></a> <br><br>  E esse monstro tem apenas 400 watts!  O peso do transformador √© de cerca de 5-7 kg, de acordo com as sensa√ß√µes. Se voc√™ o deixar cair na perna, eles definitivamente n√£o ser√£o levados para o ex√©rcito.  Na verdade, este √© o menos dos inversores com transformadores de "ferro", eles s√£o enormes e pesados.  A vantagem deles √© que esses inversores s√£o muuuuito simples, n√£o exigem nenhuma experi√™ncia para criar e, √© claro, s√£o baratos. <br><br>  Agora vamos conectar os m√≥dulos e o transformador.  De fato, o m√≥dulo para o desenvolvedor deve ser apresentado simplesmente como uma ‚Äúcaixa preta‚Äù que possui uma entrada de 2 PWMs e 3 sa√≠das de pot√™ncia: VCC, GND e a pr√≥pria sa√≠da de meia ponte. <br><br><img src="https://habrastorage.org/webt/yt/4f/l5/yt4fl55ueuuzkxi2ytlanqt_z58.png"><br><br>  Agora, dessas "caixas pretas", vamos desenhar nosso inversor: <br><br><img src="https://habrastorage.org/webt/ht/ar/pu/htarpuz2ma1w3bduxmbpculsxia.png"><br><br>  Sim, foram necess√°rios apenas 3 elementos externos: um transformador + filtro LC.  Para o √∫ltimo, dei um estrangulamento simplesmente enrolando o fio do m√≥dulo ao transformador em um anel de material Kool Mu, tamanho R32 com permeabilidade de 60 e uma indut√¢ncia de cerca de 10 ŒºH.  Obviamente, o acelerador deve ser calculado, mas precisamos de 15 minutos)) Em geral, se voc√™ dirige algo assim a 400 W, precisa de um anel do tamanho R46 (esse √© o di√¢metro externo).  Capacit√¢ncia - filme de 1-10 uF, isso √© suficiente.  Na verdade, voc√™ n√£o pode definir o capacitor como uma economia, porque a capacidade de enrolamento do transformador √© saud√°vel ... em geral, os chineses e o MAP fizeram exatamente isso)) O indutor se parece com isso: <br><br><img src="https://habrastorage.org/webt/b0/wl/zy/b0wlzyrj0gxbmarg2rz5kuppdoc.jpeg"><br><br>  Resta jogar uma carga de teste na sa√≠da, tenho duas l√¢mpadas LED de 20 W (nada mais estava √† m√£o), elas mesmas comem 24 W, no entanto, a efici√™ncia.  Al√©m disso, a corrente de circuito aberto do transformador √© de cerca de 1A.  Com bateria vai comer cerca de 5A.  Como resultado, temos essa posi√ß√£o: <br><br> <a href=""><img src="https://habrastorage.org/webt/3s/w2/q2/3sw2q2qvocpryrps6vj4ynvwavo.jpeg"></a> <br><br>  Al√©m disso, o layout usa a bateria Delta HR12-17, respectivamente, a 12V e com capacidade de 17 A * h.  Controlaremos o conversor da placa de depura√ß√£o STM32F469-Discovery. <br><br><h2>  C√≥digo </h2><br>  Inicialmente, planejava-se usar o meu STM32VL-Disco, recebido na exposi√ß√£o em 2010, para gerenciamento, mas aconteceu que era nesse layout que estava destinado a morrer quando todo o c√≥digo foi escrito e o layout foi lan√ßado.  Eu esqueci as pontas de prova do oscilosc√≥pio e combinei duas terras, am√©m.  Como resultado, tudo foi reescrito no STM32F469NIH6, foi essa depura√ß√£o que estava em m√£os, portanto haver√° dois projetos: para o F100 e para o F469, ambos verificados.  O projeto foi desenvolvido para o TrueSTUDIO, a vers√£o eclipse do ST. <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo do cal√ßado</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/********************************************* Sinus table **********************************************************/</span></span></span><span class="hljs-meta"> uint16_t sinData[240] = {0,13,26,39,52,65,78,91,104,117,130,143,156,169,182,195,207,220,233,246,258,271,284,296,309,321,333,346,358,370, 382,394,406,418,430,442,453,465,477,488,500,511,522,533,544,555,566,577,587,598,608,619,629,639,649,659,669,678,688,697, 707,716,725,734,743,751,760,768,777,785,793,801,809,816,824,831,838,845,852,859,866,872,878,884,891,896,902,908,913,918, 923,928,933,938,942,946,951,955,958,962,965,969,972,975,978,980,983,985,987,989,991,993,994,995,996,997,998,999,999,999, 999,999,999,998,997,996,995,994,993,991,989,987,985,983,980,978,975,972,969,965,962,958,955,951,946,942,938,933,928,923, 918,913,908,902,896,891,884,878,872,866,859,852,845,838,831,824,816,809,801,793,785,777,768,760,751,743,734,725,716,707, 697,688,678,669,659,649,639,629,619,608,598,587,577,566,555,544,533,522,511,500,488,477,465,453,442,430,418,406,394,382, 370,358,346,333,321,309,296,284,271,258,246,233,220,207,195,182,169,156,143,130,117,104,91,78,65,52,39,26,13,0}; uint16_t sinStep; uint8_t sinStatus; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/******************************************** Used functions ********************************************************/</span></span></span><span class="hljs-meta"> void StartInitClock (void) { RCC-&gt;CR |= RCC_CR_HSEON; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// Enable HSE while (!(RCC-&gt;CR &amp; RCC_CR_HSERDY)); FLASH-&gt;ACR |= FLASH_ACR_LATENCY_5WS; RCC-&gt;PLLCFGR = 0x00; RCC-&gt;PLLCFGR |= RCC_PLLCFGR_PLLM_3; // Div for HSE = 8 RCC-&gt;PLLCFGR |= RCC_PLLCFGR_PLLN_4 | RCC_PLLCFGR_PLLN_5 | RCC_PLLCFGR_PLLN_6 | RCC_PLLCFGR_PLLN_7; // PLL mult x240 RCC-&gt;PLLCFGR |= RCC_PLLCFGR_PLLSRC; // Source HSE RCC-&gt;CR |= RCC_CR_PLLON; while((RCC-&gt;CR &amp; RCC_CR_PLLRDY) == 0){} RCC-&gt;CFGR &amp;= ~RCC_CFGR_SW; RCC-&gt;CFGR |= RCC_CFGR_SW_PLL; // Select source SYSCLK = PLL while((RCC-&gt;CFGR &amp; RCC_CFGR_SWS) != RCC_CFGR_SWS_1) {} // Wait till PLL is used RCC-&gt;CR |= RCC_CR_PLLSAION; while ((RCC-&gt;CR &amp; RCC_CR_PLLSAIRDY) == 0) {} } void EnableOutputMCO (void) { RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIOAEN; // Enable clock port A GPIOA-&gt;MODER &amp;= ~GPIO_MODER_MODER8; GPIOA-&gt;MODER |= GPIO_MODER_MODER8_1; // Alternative PP GPIOA-&gt;OSPEEDR |= GPIO_OSPEEDER_OSPEEDR8; // Very high speed RCC-&gt;CFGR |= RCC_CFGR_MCO1; // Source PLL RCC-&gt;CFGR &amp;= ~RCC_CFGR_MCO1PRE; // Div = 1 } void InitIndicatorLED (void) { /* * LED1 - PG6 * LED2 - PD4 * LED3 - PD5 * LED4 - PK3 */ RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIOGEN; RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIODEN; RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIOKEN; GPIOG-&gt;MODER &amp;= ~GPIO_MODER_MODER6; GPIOG-&gt;MODER |= GPIO_MODER_MODER6_0; // Output PP GPIOD-&gt;MODER &amp;= ~GPIO_MODER_MODER4; GPIOD-&gt;MODER |= GPIO_MODER_MODER4_0; // Output PP GPIOD-&gt;MODER &amp;= ~GPIO_MODER_MODER5; GPIOD-&gt;MODER |= GPIO_MODER_MODER5_0; // Output PP GPIOK-&gt;MODER &amp;= ~GPIO_MODER_MODER3; GPIOK-&gt;MODER |= GPIO_MODER_MODER3_0; // Output PP } void EnableIndicatorLED (void) { GPIOG-&gt;BSRR |= GPIO_BSRR_BR_6; GPIOD-&gt;BSRR |= GPIO_BSRR_BR_4; GPIOD-&gt;BSRR |= GPIO_BSRR_BR_5; GPIOK-&gt;BSRR |= GPIO_BSRR_BR_3; } void InitLowPWM (void) { /* * TIM1-CH1 - PA8 * TIM1-CH1N - PB13 */ RCC-&gt;APB2ENR |= RCC_APB2ENR_TIM1EN; RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIOAEN; RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIOBEN; /*********** GPIO **********/ GPIOA-&gt;MODER &amp;= ~GPIO_MODER_MODER8; GPIOA-&gt;MODER |= GPIO_MODER_MODER8_1; // Alternative output PP GPIOA-&gt;AFR[1] |= GPIO_AFRH_AFRH0_0; // Select TIM1-CH1 GPIOB-&gt;MODER &amp;= ~GPIO_MODER_MODER13; GPIOB-&gt;MODER |= GPIO_MODER_MODER13_1; // Alternative output PP GPIOB-&gt;AFR[1] |= GPIO_AFRH_AFRH5_0; // Select TIM1-CH1N /*********** Timer *********/ TIM1-&gt;PSC = 2400-1; // div for clock: F = SYSCLK / [PSC + 1] TIM1-&gt;ARR = 1000; // count to 1000 TIM1-&gt;CR1 &amp;= ~TIM_CR1_CKD; // div for dead-time: Tdts = 1/Fosc = 41.6 ns TIM1-&gt;CCR1 = 500; // duty cycle 50% TIM1-&gt;CCER |= TIM_CCER_CC1E | TIM_CCER_CC1NE; // enable PWM complementary out to PB15 and to PA10 TIM1-&gt;CCER &amp;= ~TIM_CCER_CC1NP; // active high level: 0 - high, 1 - low TIM1-&gt;CCMR1 &amp;= ~TIM_CCMR1_OC1M; TIM1-&gt;CCMR1 |= TIM_CCMR1_OC1M_2 | TIM_CCMR1_OC1M_1; // positiv PWM1_CH3 and PWM1_CH3N TIM1-&gt;BDTR &amp;= ~TIM_BDTR_DTG; // clear register TIM1-&gt;BDTR |= TIM_BDTR_DTG_2 | TIM_BDTR_DTG_1 | TIM_BDTR_DTG_0; // value dead-time: = 31*Tdts = 32*41,6ns = 1.29us TIM1-&gt;BDTR |= TIM_BDTR_MOE | TIM_BDTR_AOE; // enable generation output and dead-time TIM1-&gt;CR1 &amp;= ~TIM_CR1_DIR; // count up: 0 - up, 1 - down TIM1-&gt;CR1 &amp;= ~TIM_CR1_CMS; // aligned on the front signal: 00 - front; 01, 10, 11 - center TIM1-&gt;CR1 |= TIM_CR1_CEN; // start count } void InitSinusPWM (void) { /* * TIM3-CH1 - PB4 * TIM3-CH2 - PC7 */ RCC-&gt;APB1ENR |= RCC_APB1ENR_TIM3EN; RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIOBEN; RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIOCEN; /*********** GPIO **********/ GPIOB-&gt;MODER &amp;= ~GPIO_MODER_MODER4; GPIOB-&gt;MODER |= GPIO_MODER_MODER4_1; // Alternative output PP GPIOB-&gt;AFR[0] |= GPIO_AFRL_AFRL4_1; // Select TIM3-CH1 GPIOC-&gt;MODER &amp;= ~GPIO_MODER_MODER7; GPIOC-&gt;MODER |= GPIO_MODER_MODER7_1; // Alternative output PP GPIOC-&gt;AFR[0] |= GPIO_AFRL_AFRL7_1; // Select TIM3-CH2 /*********** Timer *********/ TIM3-&gt;PSC = 5-1; // div for clock: F = SYSCLK / [PSC + 1] TIM3-&gt;ARR = 1000; // count to 1000 TIM3-&gt;CCR1 = 0; // duty cycle 0% TIM3-&gt;CCR2 = 0; // duty cycle 0% TIM3-&gt;CCER |= TIM_CCER_CC1E; // enable PWM out to PA8 TIM3-&gt;CCER &amp;= ~TIM_CCER_CC1P; // active high level: 0 - high, 1 - low TIM3-&gt;CCER |= TIM_CCER_CC2E; // enable PWM complementary out to PA9 TIM3-&gt;CCER &amp;= ~TIM_CCER_CC1P; // active high level: 0 - high, 1 - low TIM3-&gt;CCMR1 &amp;= ~(TIM_CCMR1_OC1M | TIM_CCMR1_OC2M); TIM3-&gt;CCMR1 |= TIM_CCMR1_OC1M_2 | TIM_CCMR1_OC1M_1 | TIM_CCMR1_OC2M_2 | TIM_CCMR1_OC2M_1; // positiv PWM1_CH1 and PWM1_CH2 TIM3-&gt;CR1 &amp;= ~TIM_CR1_DIR; // count up: 0 - up, 1 - down TIM3-&gt;CR1 &amp;= ~TIM_CR1_CMS; // aligned on the front signal: 00 - front; 01, 10, 11 - center TIM3-&gt;CR1 |= TIM_CR1_CEN; // start count } void InitStepSinus (void) { RCC-&gt;APB1ENR |= RCC_APB1ENR_TIM6EN; // enable clock for basic TIM6 TIM6-&gt;PSC = 5-1; // div, frequency 24 kHz TIM6-&gt;ARR = 1000; // count to 1000 TIM6-&gt;DIER |= TIM_DIER_UIE; // enable interrupt for timer TIM6-&gt;CR1 |= TIM_CR1_CEN; // start count NVIC_EnableIRQ(TIM6_DAC_IRQn); // enable interrupt TIM6_DAC_IRQn } /************************************* Main code *********************************************/ int main (void) { StartInitClock(); // EnableOutputMCO(); InitIndicatorLED(); InitLowPWM(); InitSinusPWM(); InitStepSinus(); EnableIndicatorLED(); while(1) { } } /****************************** Interrupts ******************************************************/ void TIM6_DAC_IRQHandler (void) { TIM6-&gt;SR &amp;= ~TIM_SR_UIF; if (sinStatus == 0) {TIM3-&gt;CCR1 = sinData[sinStep];} if (sinStatus == 1) {TIM3-&gt;CCR2 = sinData[sinStep];} sinStep++; if (sinStep &gt;= 240) { sinStep = 0; sinStatus = sinStatus ? 0 : 1; } }</span></span></span></span></code> </pre> <br></div></div><br>  Em geral, em outro artigo, ele descreveu em detalhes e claramente como gerar um sinal sinusoidal, como escrever c√≥digo e assim por diante.  Voc√™ pode ler <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br>  Voc√™ leu?  Deseja colecionar?  Mantenha o projeto: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Projeto para F469</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Projeto para F100</a> </li></ul><br>  Executamos o c√≥digo, armar-nos com um oscilosc√≥pio e seguir em frente.  Antes de tudo, verificamos a presen√ßa de um sinal na entrada dos drivers, deve ser assim: <br><br><img src="https://habrastorage.org/webt/nd/gc/5f/ndgc5fcjhtwnxk_oxdwnanbwtkq.png"><br><br>  Vale a pena notar que eu dou 2 sinais desenhando um seno em uma meia ponte (m√≥dulo) e 50 Hz em 2 sinais.  Al√©m disso, uma diagonal √© "vermelho + amarelo" e a outra √© "azul + verde".  No artigo que eu dei acima, isso est√° escrito em detalhes, se voc√™ de repente n√£o entender.  Agora, quando os sinais chegaram, colocamos meia ponte + 12V e GND da fonte de alimenta√ß√£o do laborat√≥rio.  Imediatamente a bateria n√£o aconselha, se voc√™ cometer algum erro, algo poder√° queimar.  A prote√ß√£o na placa evita sobrecorrentes, mas n√£o de ombreiras √≥bvias, quando o mais e o menos s√£o misturados, mas o t√©cnico do laborat√≥rio economiza.  12V e 1A s√£o suficientes para testes.  Levamos a sonda do oscilosc√≥pio, seu fio terra √† sa√≠da da primeira meia ponte e a pr√≥pria sonda √† sa√≠da da outra meia ponte, e deve haver uma imagem: <br><br><img src="https://habrastorage.org/webt/px/6j/fk/px6jfknnkrrf4y_l09t-_h9csfk.png"><br><br>  Onde est√° o seno que voc√™ pergunta?  O fato √© que a resist√™ncia de entrada do oscilosc√≥pio √© grande e n√£o constitui uma carga; portanto, a corrente n√£o flui e n√£o h√° onde obter o seno.  Adicionar uma carga, eu fiz uma carga de 90 Ohm a partir de resistores de 10 Ohm, basta ligar 9 pe√ßas em s√©rie.  Ligamos a carga √†s sa√≠das das meias-pontes e vemos a seguinte figura: <br><br><img src="https://habrastorage.org/webt/a1/ro/7b/a1ro7ba6mmxhagnpiyau1mjstqo.png"><br><br>  Voc√™ tem o mesmo?  Portanto, √© hora de conectar o indutor, o transformador, a carga e tentar iniciar.  <b>Achtung!</b>  <b>Voc√™ n√£o pode ligar este modelo sem carga, porque em modo inativo, a sa√≠da pode ser de at√© 350 ... 380V.</b>  <b>Para que isso n√£o precise de carga ou sistema operacional.</b>  N√£o teremos o √∫ltimo, este √© o t√≥pico de um artigo separado. Voc√™ pode estragar o regulador-P t√£o simples quanto opcional, pois voc√™ j√° possui um modelo de projeto. <br><br><h2>  Inclus√£o </h2><br>  Depois de ligar, obtemos cerca de 230V na sa√≠da, a sa√≠da certamente n√£o est√° estabilizada e flutuar√° 230V + -30V, para testes, em outro artigo, finalizaremos o layout enquanto decido falar sobre os controladores P e PI e sua implementa√ß√£o. <br><br>  Agora voc√™ pode apreciar o resultado do trabalho e, se necess√°rio, colocar tudo em uma caixa e at√© aplic√°-lo na fazenda ou no pa√≠s para fornecer luz e outras comodidades. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Te0OhTMt0Tk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Voc√™ provavelmente notou um atraso entre o ‚Äúclique‚Äù, ou seja, ligando o Discovery e acendendo as l√¢mpadas - esse √© o tempo que o MK gastou na inicializa√ß√£o.  Esse atraso pode ser reduzido gravando um √∫nico d√≠gito no registro de uma s√≥ vez, em vez de dividir a entrada do registro em v√°rias linhas.  Esmaguei-o apenas para fins ilustrativos.  Embora isso n√£o seja assustador, com o c√≥digo HAL, o atraso √© tr√™s vezes maior e as pessoas de alguma forma vivem com ele)) <br><br>  At√© que eu esqueci, a fonte do projeto: <br><br><ul><li>  Diagrama esquem√°tico - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PDF</a> </li><li>  BOM - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Excel</a> </li><li>  Arquivos Gerber - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RAR</a> </li></ul><br><br>  Resta ver como est√£o as temperaturas no quadro, se houver algum ponto particularmente quente.  5-6A certamente n√£o √© suficiente, mas se houver um erro de corrente cont√≠nua ou algum erro grave, isso ser√° suficiente para transformar a placa em uma chaleira: <br><br><img src="https://habrastorage.org/webt/xz/fp/ln/xzfplnlxfklygc-vjabjtpws1em.png"><br><br>  Como voc√™ pode ver, o elemento mais quente √© o m√≥dulo dc / dc para isolamento galv√¢nico, que √© de 2 watts, que aquece at√© 34 graus, bem, tamb√©m √© uma deriva√ß√£o.  Os transistores e o radiador t√™m uma temperatura ambiente ap√≥s 30 minutos de opera√ß√£o do conversor)) <br><br><h2>  Obrigado e planos </h2><br>  Em um futuro pr√≥ximo, pretendo escrever sobre a placa DSP e gerenci√°-la n√£o a partir da descoberta de depura√ß√£o, mas a partir do m√≥dulo "especializado".  Os conselhos da 2¬™ revis√£o chegaram a ele da mesma PCBway, espero pelos componentes e escrevo imediatamente. <br><br>  Espero que tenham gostado do artigo e da pr√≥pria ideia.  No futuro, nos mesmos m√≥dulos, mostrarei como montar um chastotnik, um controlador de mppt ou talvez algo mais interessante.  Se voc√™ tiver d√∫vidas, n√£o hesite em perguntar nos coment√°rios ou no PM, se de repente voc√™ n√£o tiver uma conta completa, tentarei responder a todas as perguntas. <br><br>  Agora, gra√ßas ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PCBway</a> , √© realmente muito bom que eles suportem o mecanismo de c√≥digo aberto.  Em breve, os fabricantes de hardware podem at√© encontrar escritores de software em termos de n√∫mero e qualidade de projetos de c√≥digo aberto. <br><br><img src="https://habrastorage.org/webt/hm/pu/px/hmpupxkj9ov6-oum1vvnqmi0oqu.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt428550/">https://habr.com/ru/post/pt428550/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt428540/index.html">Os ensaios cl√≠nicos mostraram uma diminui√ß√£o na progress√£o da doen√ßa de Alzheimer em mais da metade</a></li>
<li><a href="../pt428542/index.html">Os turistas na Uni√£o Europeia ser√£o verificados usando IA</a></li>
<li><a href="../pt428544/index.html">Vulnerabilidade no Bluetooth abre oportunidades para ataques a pontos de acesso sem fio</a></li>
<li><a href="../pt428546/index.html">Tr√™s anos de tecnologia. suporte, 152 unidades de sa√∫de, 3740 unidades</a></li>
<li><a href="../pt428548/index.html">Programa√ß√£o Orientada a Aspectos, Spring AOP</a></li>
<li><a href="../pt428552/index.html">Algoritmo: Como encontrar a pr√≥xima permuta√ß√£o lexicogr√°fica</a></li>
<li><a href="../pt428556/index.html">‚ÄúO ambiente de produ√ß√£o est√° al√©m do seu controle‚Äù: Rian Lewis em testes de projetos de blockchain</a></li>
<li><a href="../pt428558/index.html">Como criei um assistente para WordPress a partir da minha profunda pregui√ßa</a></li>
<li><a href="../pt428560/index.html">An√∫ncio n√£o programado de sexta-feira</a></li>
<li><a href="../pt428562/index.html">Droidcon London. Como foi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>