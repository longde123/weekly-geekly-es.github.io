<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👱 🏍️ 🏞️ Mengelola status aplikasi dengan RxJS / Immer sebagai alternatif sederhana untuk Redux / MobX 🏴󠁧󠁢󠁳󠁣󠁴󠁿 🤺 😸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=""Kamu akan mengerti kapan kamu membutuhkan Flux. Jika kamu tidak yakin bahwa kamu membutuhkannya, kamu tidak membutuhkannya." Perburuan pete 



 Untu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mengelola status aplikasi dengan RxJS / Immer sebagai alternatif sederhana untuk Redux / MobX</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483526/"><blockquote>  "Kamu akan mengerti kapan kamu membutuhkan Flux. Jika kamu tidak yakin bahwa kamu membutuhkannya, kamu tidak membutuhkannya."  Perburuan pete </blockquote><br><img align="right" src="https://habrastorage.org/webt/r_/5f/tj/r_5ftjrh0you9eiryn6ae54nwea.png"><br><p>  Untuk mengontrol keadaan aplikasi, saya biasanya menggunakan Redux.  Tetapi tidak selalu ada kebutuhan untuk menggunakan model Action \ Reducer, jika hanya karena kesusahan penerapannya untuk menulis fungsional paling sederhana.  Ambil penghitung biasa sebagai contoh.  Pada output, saya ingin mendapatkan solusi sederhana dan praktis yang memungkinkan kami untuk menggambarkan model keadaan dan beberapa metode yang mengubahnya, seperti ini: </p><br><pre><code class="javascript hljs">state = {<span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>} increase() { state.value += <span class="hljs-number"><span class="hljs-number">1</span></span> } decrease() { state.value -= <span class="hljs-number"><span class="hljs-number">1</span></span> }</code> </pre> <br><p>  Sepertinya MobX dapat memberikan solusi seperti itu, jadi mengapa tidak menggunakannya?  Setelah bekerja dengan MobX untuk sementara waktu, saya sampai pada kesimpulan bahwa lebih mudah bagi saya secara pribadi untuk beroperasi dengan urutan keadaan tidak berubah (seperti Redux) daripada dengan logika keadaan berubah-ubah (seperti MobX), dan saya tidak akan menyebut dapur internalnya sederhana. </p><br><p>  Secara umum, saya ingin menemukan solusi manajemen negara sederhana berdasarkan kekebalan, dengan kemampuan untuk menggunakannya dalam Angular \ React dan diimplementasikan pada TypeScript.  Tinjauan singkat tentang ruang terbuka github tidak memberikan solusi yang cocok, jadi mari kita ambil RxJS / Immer dan coba lakukan sendiri. </p><a name="habracut"></a><br><h1 id="ispolzuem-rxjs">  Kami menggunakan RxJS </h1><br><p>  Kami akan mengambil <code>BehaviorSubjet</code> sebagai dasar, yang akan memodelkan aliran perubahan negara <code>{value: 0} -&gt; {value: 1} -&gt; {value: 2}</code> dan yang juga memiliki metode <code>getValue</code> yang dengannya Anda bisa mendapatkan status saat ini.  Jika Anda membandingkan <code>BehaviorSubject</code> API dengan Redux </p><br><ul><li> <code>getValue() / getState() //   </code> </li> <li> <code>subscribe() / subscribe() //      </code> </li> <li> <code>next(value) / dispatch(action), replaceReducer(nextReducer) //    </code> </li> </ul><br><p>  Anda mungkin memperhatikan bahwa mereka sangat mirip.  Perbedaan utama adalah bahwa dalam <code>BehaviorSubject</code> bukannya <code>Action/Reducer</code> negara baru dapat diatur menggunakan metode <code>next()</code> . </p><br><p>  Untuk contoh penghitung di atas, implementasi mungkin terlihat seperti ini: </p><br><p>  <strong>CounterService V1</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CounterServiceV1</span></span></span><span class="hljs-class"> </span></span>{ state = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BehaviorSubject({<span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>}) increase() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.next({<span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.value.value + <span class="hljs-number"><span class="hljs-number">1</span></span>}) } decrease() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.next({<span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.value.value - <span class="hljs-number"><span class="hljs-number">1</span></span>}) } }</code> </pre> <br><p>  Redundansi pengulangan dari <code>this.state.next</code> dan banyaknya perubahan status sangat mencolok.  Ini sangat berbeda dari keadaan hasil yang diinginkan.nilai <code>state.value += 1</code> </p><br><h1 id="dobavlyaem-immer">  Tambahkan Immer </h1><br><p>  Untuk menyederhanakan perubahan dalam status kekebalan, kita akan menggunakan perpustakaan Immer.  Immer memungkinkan Anda untuk membuat keadaan tidak berubah baru karena mutasi saat ini.  Cara kerjanya seperti ini: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> state = {<span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>} <span class="hljs-comment"><span class="hljs-comment">//     const draft = createDraft(state) //      draft.value += 1 //    const newState = finishDraft(draft)</span></span></code> </pre> <br><h3 id="svyazka-behaviorsubject-i-immer">  Bundel Subjek Perilaku dan Immer </h3><br><p>  Bungkus penggunaan <code>BehaviorSubject</code> dan Immer di kelas kita sendiri dan sebut <code>RxState</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RxState</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TState</span></span></span><span class="hljs-class">&gt; </span></span>{ private subject$: BehaviorSubject&lt;TState&gt; private currentDraft?: Draft&lt;TState&gt; get state() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.subject$.value } get state$() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.subject$ } get draft(): Draft&lt;TState&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentDraft !== <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentDraft } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">"draft doesn't exists"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(readonly initialState: TState) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.subject$ = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BehaviorSubject(initialState) } public updateState(recipe: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">draft: Draft&lt;TState&gt;</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> topLevelUpdate = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-comment"><span class="hljs-comment">//     updateState if (!this.currentDraft) { this.currentDraft = createDraft(this.state) topLevelUpdate = true } recipe(this.currentDraft) if (!topLevelUpdate) { return } const newState = finishDraft(this.currentDraft, () =&gt; {}) as TState this.currentDraft = undefined if (newState !== this.state) { this.subject$.next(newState) } } }</span></span></code> </pre> <br><p>  Menggunakan <code>RxState</code> , kami menulis ulang <code>CounterService</code> : </p><br><p>  <strong>CounterService V2</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CounterServiceV2</span></span></span><span class="hljs-class"> </span></span>{ state = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RxState({<span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>}) increase() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.updateState(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">draft</span></span></span><span class="hljs-function"> =&gt;</span></span> { draft.value += <span class="hljs-number"><span class="hljs-number">1</span></span> }) } decrease() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.updateState(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">draft</span></span></span><span class="hljs-function"> =&gt;</span></span> { draft.value -= <span class="hljs-number"><span class="hljs-number">1</span></span> }) } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Diff</b> <div class="spoiler_text"><pre> <code class="diff hljs"><span class="hljs-deletion"><span class="hljs-deletion">- state = new BehaviorSubject({value: 0}) + state = new RxState({value: 0}) increase() { - this.state.next({value: this.state.value.value + 1}) + this.state.updateState(draft =&gt; { + draft.value += 1 + }) } decrease() { - this.state.next({value: this.state.value.value - 1}) + this.state.updateState(draft =&gt; { + draft.value -= 1 + }) }</span></span></code> </pre> </div></div><br><p>  Ini terlihat sedikit lebih baik daripada opsi pertama, tetapi masih ada kebutuhan untuk memanggil <code>updateState</code> setiap waktu.  Untuk mengatasi masalah ini, buat kelas lain dan menyebutnya <code>SimpleImmutableStore</code> , itu akan menjadi dasar untuk cerita. </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleImmutableStore</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TState</span></span></span><span class="hljs-class">&gt; </span></span>{ rxState!: RxState&lt;TState&gt; get draft() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rxState.draft } <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(initialState: TState) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rxState = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RxState&lt;TState&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">initialState</span></span></span><span class="hljs-function">) } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">public</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">updateState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">recipe: (draft: Draft&lt;TState&gt;</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rxState.updateState(recipe) } }</code> </pre> <br><p>  Kami menerapkan penyimpanan dengan bantuannya: </p><br><p>  <strong>CounterStore V1</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CounterStoreV1</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleImmutableStore</span></span></span><span class="hljs-class">&lt;</span></span>{value: number}&gt; { <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(){ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>({<span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>}) } increase() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateState(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.draft.value += <span class="hljs-number"><span class="hljs-number">1</span></span> }) } decrease() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateState(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.draft.value -= <span class="hljs-number"><span class="hljs-number">1</span></span> }) } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Diff</b> <div class="spoiler_text"><pre> <code class="diff hljs"><span class="hljs-deletion"><span class="hljs-deletion">-class CounterServiceV2 { - state = new RxState({value: 0}) +class CounterStoreV1 extends SimpleImmutableStore&lt;{value: number}&gt; { + constructor(){ + super({value: 0}) + } increase() { - this.state.updateState(draft =&gt; { - draft.value += 1 + this.updateState(() =&gt; { + this.draft.value += 1 }) } decrease() { - this.state.updateState(draft =&gt; { - draft.value -= 1 + this.updateState(() =&gt; { + this.draft.value -= 1 }) } }</span></span></code> </pre></div></div><br><p>  Seperti yang Anda lihat, tidak ada yang berubah secara signifikan, tetapi sekarang semua metode memiliki kode umum dalam bentuk wrapper <code>this.updateState</code> .  Untuk menghilangkan duplikasi ini, kami menulis fungsi yang membungkus semua metode kelas dalam panggilan <code>updateState</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> wrapped = <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>() <span class="hljs-comment"><span class="hljs-comment">//     function getMethodsNames(constructor: any) { const names = Object.getOwnPropertyNames(constructor.prototype).filter( x =&gt; x !== "constructor" &amp;&amp; typeof constructor.prototype[x] === "function", ) return names } function wrapMethodsWithUpdateState(constructor: any) { if (constructor[wrapped]) { return } constructor[wrapped] = true for (const propertyName of getMethodsNames(constructor)) { const descriptor = Object.getOwnPropertyDescriptor( constructor.prototype, propertyName, )! const method = descriptor.value descriptor.value = function(...args: any[]) { const store = this as SimpleImmutableStore&lt;any&gt; let result: any store.updateState(() =&gt; { //     updateState result = method.call(store, ...args) }) return result } Object.defineProperty(constructor.prototype, propertyName, descriptor) } }</span></span></code> </pre> <br><p>  dan kami akan menyebutnya di konstruktor (jika diinginkan, metode ini juga dapat diimplementasikan sebagai dekorator untuk kelas) </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(initialState: TState ) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rxState = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RxState&lt;TState&gt;(initialState) wrapMethodsWithUpdateState(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.constructor) }</code> </pre> <br><p>  <strong>Counterstore</strong> </p><br><p>  Versi akhir cerita.  Untuk menunjukkan, tambahkan sedikit logika untuk <code>decrease</code> dan beberapa metode lainnya dengan meneruskan parameter <code>setValue</code> dan <code>setValue</code> asynchronyWithDelay: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CounterStore</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleImmutableStore</span></span></span><span class="hljs-class">&lt;</span></span>{ value: number }&gt; { <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>({<span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>}) } increase() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.draft.value += <span class="hljs-number"><span class="hljs-number">1</span></span> } decrease() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newValue = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.draft.value - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newValue &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.draft.value = newValue } } setValue(value: number) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.draft.value = value } increaseWithDelay() { setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.increase(), <span class="hljs-number"><span class="hljs-number">300</span></span>) } }</code> </pre> <br><h1 id="ispolzovanie-s-angular">  Gunakan dengan Angular </h1><br><p>  Karena RxJS adalah dasar dari stack yang dihasilkan, ia dapat digunakan dengan Angular bersamaan dengan pipa <code>async</code> : </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> *</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngIf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"store.rxState.state$ | async as state"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span>{{state.value}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">)=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"store.increase()"</span></span></span><span class="hljs-tag">&gt;</span></span>+<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">)=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"store.decrease()"</span></span></span><span class="hljs-tag">&gt;</span></span>-<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">)=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"store.setValue(0)"</span></span></span><span class="hljs-tag">&gt;</span></span>Reset<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">)=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"store.increaseWithDelay()"</span></span></span><span class="hljs-tag">&gt;</span></span>Increase with delay<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h2 id="demohttpsstackblitzcomeditangular-yywqyifilesrc2fapp2fappcomponentts">  <a href="https://stackblitz.com/edit/angular-yywqyi%3Ffile%3Dsrc%252Fapp%252Fapp.component.ts" rel="nofollow">Demo</a> </h2><br><h1 id="ispolzovanie-s-react">  Gunakan dengan Bereaksi </h1><br><p>  Untuk Bereaksi, kami akan menulis kait khusus: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useStore</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TState</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TResult</span></span></span><span class="hljs-function">&gt;(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> store: SimpleImmutableStore&lt;TState&gt;, project: (store: TState</span></span></span><span class="hljs-function">) =&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TResult</span></span></span><span class="hljs-function">, ): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TResult</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> projectRef = useRef(project) useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { projectRef.current = project }, [project]) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [state, setState] = useState(projectRef.current(store.rxState.state)) useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> subscription = store.rxState.state$.subscribe(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newState = projectRef.current(value) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!shallowEqual(state, newState)) { setState(newState) } }) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { subscription.unsubscribe() } }, [store, state]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state }</code> </pre> <br><p>  Komponen </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Counter = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = useMemo(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CounterStore(), []) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> value = useStore(store, x =&gt; x.value) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div className=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"counter"</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; &lt;span&gt;{value}&lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/span&gt; &lt;button onClick={() =&gt; store.increase()}&gt;+&lt;/</span></span></span></span><span class="hljs-function"><span class="hljs-params">button&gt; &lt;button onClick={(</span></span></span><span class="hljs-function">) =&gt;</span></span> store.decrease()}&gt;-<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;button onClick={() =&gt; store.setValue(<span class="hljs-number"><span class="hljs-number">0</span></span>)}&gt;Reset&lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt; &lt;button onClick={() =&gt; store.increaseWithDelay()}&gt;Increase with delay&lt;/</span></span>button&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ) }</code> </pre> <br><h2 id="demohttpsstackblitzcomeditreact-ts-jfudwqfileindextsx">  <a href="https://stackblitz.com/edit/react-ts-jfudwq%3Ffile%3Dindex.tsx" rel="nofollow">Demo</a> </h2><br><h1 id="zaklyuchenie">  Kesimpulan </h1><br><p>  Hasilnya adalah solusi yang cukup sederhana dan fungsional, yang saya gunakan secara berkala dalam proyek saya.  Jika mau, Anda dapat menambahkan berbagai manfaat ke sisi ini: middleware, state slicing, pembaruan rollback - tetapi ini sudah di luar cakupan artikel ini.  Hasil penambahan tersebut dapat ditemukan di github <strong><a href="https://github.com/simmor-store/simmor" rel="nofollow">https://github.com/simmor-store/simmor</a></strong> </p><br><p>  Saya akan berterima kasih atas saran dan komentar. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id483526/">https://habr.com/ru/post/id483526/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id483512/index.html">Mengembangkan paket pypi yang sempurna dengan dukungan untuk berbagai versi python</a></li>
<li><a href="../id483516/index.html">Berhenti meletakkan dioda 2</a></li>
<li><a href="../id483518/index.html">Pengembang game VVVVVV untuk menghormati dekade-nya membuat kode sumber terbuka</a></li>
<li><a href="../id483520/index.html">Menggunakan pengamat pola kesamaan dalam C</a></li>
<li><a href="../id483524/index.html">Analisis Habra: kapan sebaiknya mempublikasikan posting Anda?</a></li>
<li><a href="../id483528/index.html">REST API harus berdasarkan pada hypertext</a></li>
<li><a href="../id483530/index.html">Bagaimana kami melakukan permainan papan. Kenapa dan mengapa?</a></li>
<li><a href="../id483532/index.html">Konferensi DefCon 27: Di Balik Layar Membuat Lencana Elektronik Bagian 1</a></li>
<li><a href="../id483536/index.html">Sejarah mikroprosesor dan komputer pribadi: 1974 - 1980</a></li>
<li><a href="../id483538/index.html">Menghubungkan Layar 10 "ER-TFT101-1 ke STM32F429 via FMC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>