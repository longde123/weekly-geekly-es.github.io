<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ûï ü•Ö üïµüèΩ Warum haben React-Elemente eine Eigenschaft vom Typ $? ü§∂üèª üë©üèº‚Äçüè≠ üëåüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Informationen zum Reaktionsmechanismus zur Verhinderung der M√∂glichkeit einer JSON-Injektion f√ºr XSS und zur Vermeidung h√§ufiger Sicherheitsl√ºcken. 
 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Warum haben React-Elemente eine Eigenschaft vom Typ $$?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/432350/"><p>  <em>Informationen zum Reaktionsmechanismus zur Verhinderung der M√∂glichkeit einer JSON-Injektion f√ºr XSS und zur Vermeidung h√§ufiger Sicherheitsl√ºcken.</em> <em><br></em> </p><a name="habracut"></a><br><p>  Sie k√∂nnten denken, Sie schreiben JSX: </p><br><pre><code class="javascript hljs">&lt;marquee bgcolor=<span class="hljs-string"><span class="hljs-string">"#ffa7c4"</span></span>&gt;hi&lt;<span class="hljs-regexp"><span class="hljs-regexp">/marquee&gt;</span></span></code> </pre> <br><p>  Aber eigentlich rufen Sie die Funktion auf: </p><br><pre> <code class="javascript hljs">React.createElement( <span class="hljs-comment"><span class="hljs-comment">/* type */</span></span> <span class="hljs-string"><span class="hljs-string">'marquee'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* props */</span></span> { <span class="hljs-attr"><span class="hljs-attr">bgcolor</span></span>: <span class="hljs-string"><span class="hljs-string">'#ffa7c4'</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* children */</span></span> <span class="hljs-string"><span class="hljs-string">'hi'</span></span> )</code> </pre> <br><p>  Und diese Funktion gibt Ihnen ein regul√§res Objekt zur√ºck, das als React-Element bezeichnet wird.  Dementsprechend wird nach Durchlaufen aller Komponenten ein Baum √§hnlicher Objekte erhalten: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'marquee'</span></span>, <span class="hljs-attr"><span class="hljs-attr">props</span></span>: { <span class="hljs-attr"><span class="hljs-attr">bgcolor</span></span>: <span class="hljs-string"><span class="hljs-string">'#ffa7c4'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: <span class="hljs-string"><span class="hljs-string">'hi'</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">key</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">ref</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">$$typeof</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.for(<span class="hljs-string"><span class="hljs-string">'react.element'</span></span>), }</code> </pre> <br><p>  Wenn Sie zuvor React verwendet haben, sind Sie m√∂glicherweise mit den Feldern Typ, Requisiten, Schl√ºssel und Referenz vertraut.  <strong>Aber was ist die Eigenschaft <code>$$typeof</code> ?</strong>  <strong>Und warum hat es das Symbol <code>Symbol()</code> als Wert?</strong> </p><br><hr><br><p>  Bevor die UI-Bibliotheken popul√§r wurden, wurde zur Anzeige von Client-Eingaben im Anwendungscode eine Zeile mit HTML-Markup generiert und √ºber innerHTML direkt in das DOM eingef√ºgt: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> messageEl = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'message'</span></span>); messageEl.innerHTML = <span class="hljs-string"><span class="hljs-string">'&lt;p&gt;'</span></span> + message.text + <span class="hljs-string"><span class="hljs-string">'&lt;/p&gt;'</span></span>;</code> </pre> <br><p>  Dieser Mechanismus funktioniert <code>message.text</code> es sei denn, <code>message.text</code> ist auf <code>&lt;img src onerror="stealYourPassword()"&gt;</code> .  Dementsprechend kommen wir zu dem Schluss, dass Sie <strong>nicht alle Client-Eingaben als HTML-Markup interpretieren m√ºssen.</strong> </p><br><p>  Zum Schutz vor solchen Angriffen k√∂nnen Sie sichere APIs wie <code>document.createTextNode()</code> oder <code>textContent</code> , die den Text nicht interpretieren.  Und als zus√§tzliche Ma√ünahme entkommen Sie Zeichenfolgen, indem Sie potenziell gef√§hrliche Zeichen wie <code>&lt;</code> , <code>&gt;</code> durch sichere ersetzen. </p><br><p>  Trotzdem ist die Fehlerwahrscheinlichkeit hoch, da es schwierig ist, alle Stellen zu verfolgen, an denen Sie die vom Benutzer auf Ihrer Seite aufgezeichneten Informationen verwenden.  Aus diesem Grund arbeiten moderne Bibliotheken wie React sicher mit jedem Standardtext: </p><br><pre> <code class="javascript hljs">&lt;p&gt; {message.text} &lt;<span class="hljs-regexp"><span class="hljs-regexp">/p&gt;</span></span></code> </pre> <br><p>  Wenn <code>message.text</code> eine sch√§dliche Zeichenfolge mit einem <code>&lt;img&gt;</code> , wird sie nicht zu einem echten <code>&lt;img&gt;</code> .  React entgeht dem Textinhalt und f√ºgt ihn dann dem DOM hinzu.  Anstatt das <code>&lt;img&gt;</code> , sehen Sie daher einfach das Markup als Zeichenfolge. </p><br><p>  Um beliebigen HTML- <code>dangerouslySetInnerHTML={{ __html: message.text }}</code> in einem React-Element anzuzeigen, m√ºssen Sie die folgende Konstruktion verwenden: <code>dangerouslySetInnerHTML={{ __html: message.text }}</code> .  <strong>Das Design ist absichtlich unangenehm.</strong>  Aufgrund seiner Absurdit√§t wird es auff√§lliger und f√§llt beim Betrachten des Codes auf. </p><br><hr><br><p>  <strong>Bedeutet dies, dass React v√∂llig sicher ist?</strong>  <strong>Nein.</strong>  Es gibt viele bekannte Angriffsmethoden, die auf HTML und DOM basieren.  Tag-Attribute verdienen besondere Aufmerksamkeit.  Wenn Sie beispielsweise <code>&lt;a href={user.website}&gt;</code> schreiben, k√∂nnen Sie den Schadcode <code>'javascript: stealYourPassword()'</code> als Textlink <code>'javascript: stealYourPassword()'</code> . </p><br><p>  In den meisten F√§llen ist das Vorhandensein von Sicherheitsl√ºcken auf der Clientseite auf Probleme auf der Serverseite zur√ºckzuf√ºhren und sollte zun√§chst behoben werden. </p><br><p>  Die sichere Anzeige von benutzerdefiniertem Textinhalt ist jedoch eine vern√ºnftige erste Verteidigungslinie, die viele potenzielle Angriffe widerspiegelt. </p><br><p>  Aufgrund fr√ºherer √úberlegungen k√∂nnen wir den Schluss ziehen, dass der folgende Code absolut sicher sein sollte: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   &lt;p&gt; {message.text} &lt;/p&gt;</span></span></code> </pre> <br><p>  <strong>Das ist aber auch nicht der Fall.</strong>  Und hier kommen wir der Erkl√§rung des Vorhandenseins von <code>$$typeof</code> im React-Element n√§her. </p><br><hr><br><p>  Wie bereits erl√§utert, sind React-Elemente einfache Objekte: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'marquee'</span></span>, <span class="hljs-attr"><span class="hljs-attr">props</span></span>: { <span class="hljs-attr"><span class="hljs-attr">bgcolor</span></span>: <span class="hljs-string"><span class="hljs-string">'#ffa7c4'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: <span class="hljs-string"><span class="hljs-string">'hi'</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">key</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">ref</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">$$typeof</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.for(<span class="hljs-string"><span class="hljs-string">'react.element'</span></span>), }</code> </pre> <br><p>  Normalerweise wird ein React-Element durch Aufrufen der Funktion <code>React.createElement()</code> Sie k√∂nnen es jedoch sofort mit einem Literal erstellen, wie oben beschrieben. </p><br><p>  Angenommen, wir speichern auf dem Server eine Zeichenfolge, die der Benutzer zuvor an uns gesendet hat, und jedes Mal, wenn wir sie auf der Clientseite anzeigen.  Aber jemand hat uns anstelle einer Zeichenfolge JSON geschickt: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> expectedTextButGotJSON = { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'div'</span></span>, <span class="hljs-attr"><span class="hljs-attr">props</span></span>: { <span class="hljs-attr"><span class="hljs-attr">dangerouslySetInnerHTML</span></span>: { <span class="hljs-attr"><span class="hljs-attr">__html</span></span>: <span class="hljs-string"><span class="hljs-string">'/*     */'</span></span> }, }, <span class="hljs-comment"><span class="hljs-comment">// ... }; let message = { text: expectedTextButGotJSON }; //    React 0.13 &lt;p&gt; {message.text} &lt;/p&gt;</span></span></code> </pre> <br><p>  Das hei√üt, anstelle der erwarteten Zeichenfolge stellte sich pl√∂tzlich heraus, dass der Wert der Variablen " <code>expectedTextButGotJSON</code> JSON war.  Welches von React als Literal verarbeitet wird und dadurch b√∂sartigen Code ausf√ºhrt. </p><br><p>  React 0.13 ist anf√§llig f√ºr einen XSS-√§hnlichen Angriff. Ab Version 0.14 ist jedes Element mit einem Symbol gekennzeichnet: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'marquee'</span></span>, <span class="hljs-attr"><span class="hljs-attr">props</span></span>: { <span class="hljs-attr"><span class="hljs-attr">bgcolor</span></span>: <span class="hljs-string"><span class="hljs-string">'#ffa7c4'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: <span class="hljs-string"><span class="hljs-string">'hi'</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">key</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">ref</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">$$typeof</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.for(<span class="hljs-string"><span class="hljs-string">'react.element'</span></span>), }</code> </pre> <br><p>  Ein solcher Schutz funktioniert, weil Zeichen kein g√ºltiger JSON-Wert sind.  Selbst wenn der Server eine potenzielle Sicherheitsanf√§lligkeit aufweist und JSON anstelle von Text zur√ºckgibt, kann JSON daher <code>Symbol.for('response.element')</code> nicht enthalten.  React √ºberpr√ºft das Element auf <code>element.$$typeof</code> und weigert sich, das Element zu verarbeiten, wenn es fehlt oder ung√ºltig ist. </p><br><p>  Der Hauptvorteil von <code>Symbol.for()</code> besteht darin, dass Symbole zwischen Kontexten global sind, da sie eine globale Registrierung verwenden.  Dies stellt den gleichen R√ºckgabewert auch in einem Iframe sicher.  Und selbst wenn sich mehrere Kopien von React auf der Seite befinden, k√∂nnen sie durch einen einzigen Wert von <code>$$typeof</code> "√ºbereinstimmen". </p><br><hr><br><p>  Was ist mit Browsern, die keine Zeichen unterst√ºtzen? </p><br><p>  Leider k√∂nnen sie den oben beschriebenen zus√§tzlichen Schutz nicht implementieren, aber React-Elemente enthalten aus Konsistenzgr√ºnden weiterhin die Eigenschaft <code>$$typeof</code> , es handelt sich jedoch nur um eine Zahl - <code>0xeac7</code> . </p><br><p>  Warum genau <code>0xeac7</code> ?  Weil es aussieht wie Reagieren. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de432350/">https://habr.com/ru/post/de432350/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de432338/index.html">Robotaxi Waymo One hat sich als kommerzielles Transportnetz verdient</a></li>
<li><a href="../de432342/index.html">Camunda BPM Meetup Raiffeisenbank UPD-Sendung</a></li>
<li><a href="../de432344/index.html">Vier Stufen der Ingenieurentwicklung</a></li>
<li><a href="../de432346/index.html">Nachrichten aus der Welt von OpenStreetMap Nr. 436 (20.11.2008 - 26.06.2008)</a></li>
<li><a href="../de432348/index.html">Meisterklasse: Vakuumformen von Kunststoffen aus Silikon</a></li>
<li><a href="../de432352/index.html">SIEM-Tiefen: Out-of-Box-Korrelationen. Teil 3.1. Ereigniskategorisierung</a></li>
<li><a href="../de432354/index.html">Die wichtigsten Datenlecks im Jahr 2018. Erster Teil (Januar-Juni)</a></li>
<li><a href="../de432356/index.html">So schreiben Sie in 20 Stunden einen hervorragenden VKontakte-Newsfeed</a></li>
<li><a href="../de432360/index.html">"Nachkomme" AlphaGo lernte selbst√§ndig Schach, Shogi und Go</a></li>
<li><a href="../de432362/index.html">Chang'e 4 - Mission auf der anderen Seite des Mondes beginnt heute</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>