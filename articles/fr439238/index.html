<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äçüè≠ üëµüèø ‚õé Play Store accepte d√©sormais les applications Web progressives (PWA) ‚öúÔ∏è üòÖ üàØÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avis de non-responsabilit√©: je ne suis pas affili√© √† Google Play, Chrome ou √† toute entreprise mentionn√©e. Ce n'est pas une d√©claration officielle. Le...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Play Store accepte d√©sormais les applications Web progressives (PWA)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439238/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/abc/fb9/445/abcfb9445e58d62d216cdf938abaffca.png"></div><br>  <sup>Avis de non-responsabilit√©: je ne suis pas affili√© √† Google Play, Chrome ou √† toute entreprise mentionn√©e.</sup>  <sup>Ce n'est pas une d√©claration officielle.</sup>  <sup>Le logo et les noms sont utilis√©s √† des fins d'illustration uniquement.</sup> <br><br>  Chrome 72 pour Android dispose de la fonctionnalit√© attendue de confiance sur le Web.  Cela signifie que nous pouvons maintenant distribuer PWA via le r√©pertoire Google Play et ex√©cuter Chrome sans interface utilisateur hors ligne pour les packages natifs!  J'ai jou√© avec cette fonction pendant un certain temps, en me plongeant dans l'API, mais ici je vais vous dire de quoi il s'agit, √† quoi s'attendre et ce qui est disponible aujourd'hui. <br><a name="habracut"></a><br><h1>  PWA dans le catalogue Play Store </h1><br>  Chrome 72 pour Android est d√©sormais disponible pour tous les utilisateurs et Trusted Web Activity (TWA) est impl√©ment√© dans cette version.  En bref, Chrome est lanc√© hors ligne (sans barre d'outils ni interface utilisateur) pour les packages Android natifs. <br><br>  Pour commencer, la publication dans un r√©pertoire n'est pas une proc√©dure aussi simple qu'elle devrait l'√™tre (par exemple, entrer une URL sur Google Play - et l'application d√©marrera).  De plus, vous ne pouvez pas utiliser le WebAPK disponible et publier l'application dans un r√©pertoire.  Il utilise l'API Java, qui interagit avec Chrome via des services et semble √™tre √† un stade pr√©coce de d√©veloppement.  Par cons√©quent, il y a beaucoup √† faire manuellement. <br><br>  Je vois cela comme une premi√®re √©tape.  Certes, la meilleure bo√Æte √† outils appara√Ætra bient√¥t (peut-√™tre de la communaut√©) avec la prise en charge de toutes les API disponibles et le lancement en un clic.  Mais sur l'API actuelle, vous pouvez la publier dans le r√©pertoire du lanceur PWA.  Je partagerai mon exp√©rience sur la fa√ßon de proc√©der. <br><br>  Pour une raison quelconque, cette fonctionnalit√© n'est pas encore apparue dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Chrome Platform Status</a> , et la documentation n'a pas encore √©t√© mise √† jour (elle n'a pas du tout √©t√© mise √† jour depuis plus de 15 mois). <br><br>  <b>Mise √† jour du 5 f√©vrier</b> .  Le blog Chromium a publi√© une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">courte note</a> sur la prise en charge TWA et certains des d√©tails techniques mentionn√©s dans cet article. <br><br>  <b>Mise √† jour du 1er f√©vrier</b> .  Paul Kinlan, d√©veloppeur Chrome principal chez Google, a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">confirm√© la</a> sortie de la fonctionnalit√© TWA et que la documentation est retard√©e: la raison du retard est que l'autorisation pour la nouvelle fonctionnalit√© Chrome 72 a √©t√© accept√©e √† la derni√®re minute. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/TCgT8dzSiU8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i><font color="gray">Vid√©o d'un an de Pete Le Page expliquant le TWA</font></i> <br><br><h3>  Pourquoi publier PWA dans un annuaire? </h3><br>  Ceci est une plateforme web, Karl!  Pourquoi utiliser un annuaire? <br><br>  Eh bien, c'est une longue conversation, mais je conseille les grandes et petites entreprises depuis de nombreuses ann√©es, et lorsque nous envisageons le d√©veloppement de PWA, le catalogue d'applications est constamment mentionn√©: "Nos utilisateurs chercheront une application l√†-bas", "Nous avons d√©j√† notre propre application, et nous ne voulons pas perdre utilisateurs "," Nous avons besoin d'acc√©der √† notre propre API "ou" Je veux mon√©tiser PWA ". <br><br>  D√©sormais, il est devenu possible de publier PWA dans l'annuaire, ainsi que de travailler depuis le navigateur.  Bien s√ªr, il s'agit d'une op√©ration distincte.  Le Play Store n'√©mule pas le Microsoft Store: votre PWA n'appara√Ætra pas dans le magasin sauf si vous compilez l'APK et le publiez. <br><br><h3>  Avantages par rapport au PWA standard </h3><br>  En plus du nouveau m√©canisme de distribution et des nouveaux utilisateurs du catalogue (et m√™me d'une recherche Google dans la section "Applications"), d'autres avantages apparaissent: <br><br><ul><li>  La possibilit√© de placer le widget sur l'√©cran principal. <br></li><li>  Raccourcis d'application (en appuyant longuement sur l'ic√¥ne de l'application) et autre int√©gration approfondie avec le syst√®me d'exploitation. <br></li><li>  Travaillez avec un ¬´compagnon¬ª sur des appareils portables ou sur l'extension Android Auto. <br></li><li>  R√©installation apr√®s une r√©initialisation mat√©rielle ou une sauvegarde sur un nouveau t√©l√©phone. <br></li><li>  Services d'arri√®re-plan qui acc√®dent √† leurs propres fonctions (la communication avec PWA est encore limit√©e - plus de d√©tails ci-dessous). <br></li><li>  Mon√©tisation (limit√©e jusqu'√† pr√©sent, plus de d√©tails ci-dessous). <br></li><li>  Certains √©crans natifs m√©lang√©s avec du contenu PWA. <br></li><li>  Distribution de plusieurs ic√¥nes PWA dans le lanceur et / ou sur l'√©cran d'accueil, pointant vers diff√©rentes URL (au sein du m√™me h√¥te). <br></li><li>  Meilleur soutien √† l'internationalisation. </li></ul><br><h3>  Quelle est l'innovation? </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/06c/a7c/a1d/06ca7ca1d01be0f5174e371c774c6360.png"><br>  <i><font color="gray">Il y avait d√©j√† quelques PWA dans le catalogue, mais maintenant elles sont beaucoup plus faciles √† pr√©parer et √† publier.</font></i> <br><br>  Il existe d√©j√† des PWA dans le Google Play Store, tels que Google Maps Go, Instagram Lite et Twitter Lite.  La premi√®re application utilise une version priv√©e de pr√©-TWA, et les deux derni√®res utilisent WebView, ce qui n'√©tait pas l'id√©al, mais le seul moyen de faire quelque chose comme √ßa avant TWA.  Les applications ont beaucoup de code natif pour certaines choses, telles que les notifications.  Nous voulons publier des PWA en tant que d√©veloppeurs Web, et nous ne voulons pas √©crire beaucoup de code Java. <br><br>  TWA est un mode sp√©cial bas√© sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des onglets Chrome personnalis√©s</a> qui, √† partir de la version de Chrome 45, vous permettent de lancer le navigateur int√©gr√© √† l'application. <br><br><h3>  TWA est-il un framework hybride similaire √† Cordova? </h3><br>  Non.  Avec Cordova et d'autres solutions hybrides, vous fournissez g√©n√©ralement des ressources (HTML, JS, CSS, etc.).  dans le package APK.  <b>De plus, le moteur est diff√©rent, il est isol√© du navigateur de l'utilisateur, il ne prend donc pas en charge les sessions ni le partage de cache.</b> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8c8/1a6/feb/8c81a6feb0b4e06520eac4d39ace8f66.png"></div><br>  <i><font color="gray">Voici √† quoi ressemble PWA avec Trusted Web Activity.</font></i>  <i><font color="gray">Je ne vois pas encore la mise en ≈ìuvre de sch√©mas de couleurs</font></i> <br><br>  Gr√¢ce √† Trusted Web Activity, vous n'avez pas besoin de compresser les fichiers de ressources (uniquement des composants natifs, si n√©cessaire);  Toutes les ressources sont t√©l√©charg√©es et mises √† jour √† la vol√©e par un technicien de service.  Votre PWA est toujours rendu par la version install√©e de Chrome, avec son stockage, son cache et ses sessions.  Ainsi, si un utilisateur ouvre une session sur un site Web, puis installe l'application depuis le Play Store, il sera d√©j√† connect√© au syst√®me. <br><br><h3>  Exigences Play Store </h3><br>  L'URL utilis√©e pour une op√©ration Web approuv√©e doit r√©pondre aux exigences suivantes: <br><br><ul><li>  Transfert de crit√®res PWA (HTTPS, travailleur de service avec gestionnaire d'√©v√©nements fetch, manifeste d'application Web avec ic√¥ne 512px, background_color et un ensemble de base d'autres propri√©t√©s). <br></li><li>  Indice de performance 80/100 minimum du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">phare</a> (disponible dans Chrome Developer Tools ou en tant que NPM CLI). <br></li><li>  Toutes les r√®gles actuelles du Play Store. </li></ul><br>  Selon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un article du blog Chromium</a> , ¬´les applications qui ne sont pas conformes aux exigences de qualit√© TWA ou aux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">politiques du</a> Play Store peuvent se voir refuser l'admission ou peuvent √™tre exclues. <br><br>  Je ne suis pas encore s√ªr que l'√©quipe d'AQ Play Store v√©rifie toutes ces exigences lors de la publication de l'application. <br><br><h3>  Mod√®le de s√©curit√© PWA sur le Play Store </h3><br>  Votre PWA ob√©ira au mod√®le de s√©curit√© du navigateur, et non √† l'application native, jusqu'√† ce que vous ajoutiez le code natif directement √† l'APK.  Puisque tout est sous le contr√¥le du navigateur, l'utilisateur doit savoir que m√™me s'il vient d'installer l'application, il aura des donn√©es de session, un stockage local et des autorisations d√©j√† d√©finies pour cet h√¥te dans le navigateur.  C'est pourquoi, lorsque vous le d√©marrez pour la premi√®re <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fois, un mini-message "Works in Chrome" s'affiche</a> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5ff/8d9/1df/5ff8d91df535b119b0da91c92aca2a2b.jpg"><br><br>  En outre, lorsque l'utilisateur d√©sinstalle l'application, il recevra un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">avertissement</a> indiquant que l'√©tat et les donn√©es de l'application sont toujours disponibles dans Chrome, donc si n√©cessaire, videz le cache.  Parmi ces traces, par exemple, l'autorisation Web Push: m√™me si l'utilisateur d√©sinstalle l'application, il continuera de recevoir des notifications push.  Henry Lim a remarqu√© le message: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/547/90a/3bc/54790a3bceb7834fd83b7301866f118e.jpg"><br><br>  Paul Kinlan de l'√©quipe Chrome a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">indiqu√© la</a> n√©cessit√© de telles notifications. <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: absolute; visibility: hidden; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1092075825065873416"></twitter-widget><blockquote class="twitter-tweet" data-lang="en_US" data-twitter-extracted-i1583607266911845046="true"><p lang="en" dir="ltr">  Le stockage de session provient de la session de votre navigateur, nous devons l'indiquer aux utilisateurs d'applications Android qui ne s'attendent pas √† ce type d'exp√©rience. </p>  - Paul Kinlan (@Paul_Kinlan) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">3 f√©vrier 2019</a> </blockquote><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br><h1>  M√©thodes de d√©veloppement </h1><br>  Pour cr√©er un package avec TWA, vous devez d'abord avoir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Android Studio</a> .  Jusqu'√† pr√©sent, toutes les options sont exp√©rimentales et d√©crites uniquement par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des exemples de code</a> dans le r√©f√©rentiel Chrome sur GitHub. <br><br>  Options de d√©veloppement d'applications avec TWA: <br><br><ul><li>  <b>Utilisation de la biblioth√®que</b> de <b>support Java de haut niveau</b> de l'√©quipe Chrome: dans ce cas, vous n'avez pas besoin d'√©crire votre propre code Java ou Kotlin.  Cr√©ez un projet Android Studio (ou clonez un exemple), configurez certaines m√©tadonn√©es dans AndroidManifest.xml √† partir du manifeste de l'application Web - et vous avez termin√©. <br><br>  Le cadre fournira une connexion avec TWA et des fonctionnalit√©s suppl√©mentaires pour cr√©er un enregistrement de param√®tres dans un appareil Android, ainsi que des notifications push disponibles.  Maintenant, la biblioth√®que se trouve dans le r√©f√©rentiel Jitpack temporaire.  Je pense qu'√† l'avenir, elle d√©m√©nagera dans un autre endroit. <br></li><li>  <b>Gestion manuelle de l'activit√© Web s√©curis√©e</b> .  Si vous avez de l'exp√©rience dans le d√©veloppement d'applications Android en Java ou Kotlin, vous pouvez simplement connecter manuellement PWA.  Vous pouvez donc laisser des actions natives, en ouvrant Trusted Web Activity uniquement au bon moment.  Dans ce cas, je propose d'√©tudier <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la biblioth√®que de support</a> et de comprendre comment se connecter au Chrome depuis le projet. </li></ul><br>  <b>Mise √† jour du 5 f√©vrier</b> : la documentation de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">TrustedWebUtils</a> , l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">assistant</a> TWA, est d√©sormais disponible sur le site Android. <br><br><h3>  Distribution manifeste </h3><br>  PWA sur l'App Store n'acceptera pas le manifeste de l'application Web;  Vous devez copier manuellement certaines valeurs.  Les ic√¥nes sont extraites du dossier ¬´res¬ª, comme dans toute application Android native, le blocage d'orientation doit √™tre d√©fini dans l'enregistrement d'activit√© AndroidManifest, etc. <br><br>  Lorsque vous utilisez la biblioth√®que de support, un √©cran de d√©marrage est cr√©√© automatiquement, mais les autres propri√©t√©s du manifeste ne seront pas utilis√©es.  En fait, lors de mes tests, je n'ai pas pu appliquer le th√®me de la couleur lorsque le PWA s'est ouvert √† l'√©cran. <br><br><h3>  Validation d'URL </h3><br>  TWA ne fonctionnera qu'apr√®s une n√©gociation de domaine num√©rique avec l'application.  Le m√©canisme est connu sous le nom de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Digital Assets Links</a> .  Il √©tablit une relation de confiance entre votre h√¥te et l'APK, prouvant que vous poss√©dez PWA et que vous ne publierez pas d'applications sur le Play Store que vous ne poss√©dez pas.  Il √©tablit √©galement un canal num√©rique entre le site et l'application native, ce qui pourrait th√©oriquement leur permettre d'√©changer des donn√©es priv√©es (mais cela ne semble pas possible avec l'API TWA actuelle). <br><br>  Avec Digital Assets Links, vous devez t√©l√©charger le fichier <i>&lt;your-domain&gt; /.well-known/assetlinks.json</i> sur votre domaine.  Ce fichier JSON contient des informations sur le package Android (par exemple, l'identifiant du package) et un hachage du certificat de votre application, que vous pouvez trouver par la commande dans la console.  Le package Android aura un double sur l'URL de l'h√¥te.  Il y a un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">validateur en ligne</a> pour v√©rifier que tout est en ordre. <br><br>  Si vous n'avez pas serr√© la main, TWA ne s'activera pas et votre application utilisera simplement des onglets personnalis√©s Chrome standard avec une interface Chrome minimale, comme si <i>display: minimal-ui est</i> inclus dans PWA.  Je ne suis pas tout √† fait s√ªr, mais le Play Store peut probablement rejeter les applications qui pointent simplement vers des onglets r√©guliers sans validation TWA.  Je ne sais pas exactement √† quel moment Chrome effectue la v√©rification de Digital Asset Link;  si chaque fois que vous acc√©dez √† l'application, cela peut devenir un probl√®me de performances.  Je pense que la mise en cache est possible, ainsi que le Play Store peut faire une v√©rification avant d'approuver la demande tout en √©tant accept√© dans le catalogue.  Voyons ce qui sera √©crit dans la documentation. <br><br>  <b>Il existe un m√©canisme (pas si simple) pour contourner le processus de certification Digital Asset Link √† des fins de d√©veloppement, d√©crit ci-dessous.</b> <br><br><h1>  Publier l'application </h1><br>  Pour publier un label PWA √† l'aide de TWA, vous devez suivre toutes les r√®gles du Play Store.  Consultez le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Developer Policy Center pour</a> plus d'informations.  Vous devrez √©galement cr√©er un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">compte d'√©diteur</a> avec des frais uniques de 25 $, des m√©tadonn√©es, des captures d'√©cran et du mat√©riel marketing pour l'application. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ab9/348/32a/ab934832ad79351548be8cd22bfb9026.png"><br><br><h3>  D√©ployer </h3><br>  Lorsque vous avez termin√© le d√©veloppement dans Android Studio et que vous avez un compte pour la console du d√©veloppeur, vous devez cr√©er un APK pour la production et le signer avec la cl√© cr√©√©e dans Android Studio.  Vous pouvez vous r√©f√©rer au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">service</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">signature d'application par Google Play</a> pour simplifier le processus √† l'avenir. <br><br><h3>  Console Google Play </h3><br>  Il n'y a pas de r√®gles ou de processus sp√©cifiques pour t√©l√©charger ces applications, mais le service de r√©vision peut d√©tecter que vous utilisez TWA et v√©rifier que: 1) la liaison des actifs num√©riques fonctionne;  2) L'URL passe les crit√®res PWA (principalement pour le gestionnaire d'√©v√©nement d'extraction dans le service worker). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/365/83a/921/36583a921bd38dda3ce6af9b5103bb0f.png"><br>  <i><font color="gray">Pour publier sur le Play Store, vous devrez sp√©cifier un grand nombre de m√©tadonn√©es et de ressources graphiques</font></i> <br><br><h3>  Mise √† jour de l'application </h3><br>  Si vous modifiez le contenu, vous n'avez pas besoin de t√©l√©charger √† nouveau l'application, sauf si vous modifiez compl√®tement l'application (conform√©ment aux r√®gles du catalogue).  Continuez √† le mettre √† jour via les techniciens de maintenance et les mises √† jour sur le serveur.  Le nouveau fichier APK ne devra √™tre t√©l√©charg√© que si vous souhaitez modifier les m√©tadonn√©es, le code natif ou les ic√¥nes. <br><br><h1>  Limitations </h1><br>  Maintenant, la plate-forme a certaines limites, mais ce n'est que le d√©but.  Esp√©rons qu'ils seront supprim√©s au fil du temps. <br><br><h3>  PWA dans les sous-dossiers </h3><br>  Si vous publiez votre PWA dans un sous-dossier h√¥te, il y a plusieurs probl√®mes. <br><br><ul><li>  Digital Asset Link relie l'ensemble du domaine, pas seulement le dossier. <br></li><li>  La biblioth√®que de support actuelle semble g√©rer l'int√©gralit√© de l'h√¥te comme une intention (capture de lien), m√™me si le PWA se trouve dans un sous-dossier. </li></ul><br><h3>  Pas d'applications internes </h3><br>  Il s'agit d'une limitation du Play Store lui-m√™me (vous ne pouvez pas publier des applications pour le r√©seau local ou des applications destin√©es uniquement √† vous et √† votre entreprise).  Vous pouvez utiliser TWA et cr√©er un apk qui sera d√©ploy√© en dehors du magasin. <br><br>  Digital Asset Link fonctionne uniquement avec les URL publiques, car Chrome doit v√©rifier que nous sommes propri√©taires du domaine, ce qui n'est pas possible avec les URL internes. <br><br><h3>  Premier d√©marrage </h3><br>  Lorsque vous ouvrez une application r√©cemment install√©e pour la premi√®re fois, il n'y a pas encore de fichier d'application sur l'appareil (Service Worker n'a pas encore √©t√© enregistr√© si l'utilisateur n'a pas ouvert PWA auparavant), donc en mode hors ligne, l'utilisateur verra un √©cran blanc vierge.  Je pense que dans les versions futures, il serait utile d'impl√©menter une sorte de permutation via Chrome apr√®s l'installation de l'application.  Si vous utilisez l'API TWA au lieu de la biblioth√®que de support, vous trouverez cette situation et informerez correctement l'utilisateur via les API natives. <br><br><h3>  Appel du code natif </h3><br>  Il existe d√©j√† un canal bidirectionnel entre le serveur TWA (Chrome) et le client TWA (notre APK).  Cette cha√Æne n'est actuellement utilis√©e que pour envoyer des notifications push et les afficher dans l'application native, et non dans Chrome. <br><br>  Il existe un certain potentiel pour simplement connecter le code natif et JavaScript, donnant acc√®s PWA au code natif, similaire au m√©canisme APPX / PWA dans le Microsoft Store. <br><br>  Peut-√™tre qu'√† l'avenir, il sera possible d'enregistrer des classes Java / Kotlin dans le client TWA, afin que nous puissions les appeler en utilisant l'API JavaScript lorsque notre PWA est rendu en mode TWA. <br><br>  Aujourd'hui, la seule fa√ßon d'ex√©cuter du code natif consiste √† utiliser Intents pour ouvrir d'autres actions natives, puis √† rouvrir le TWA, en envoyant et en recevant des arguments via les param√®tres URI. <br><br>  De plus, vous pouvez cr√©er une sorte de serveur Web ou de serveur WebSocket dans le code natif et lui envoyer des PWA, mais c'est √©trange, compliqu√© et, peut-√™tre, cela consommera trop de batterie.  Mais nous avons un tout nouveau monde d'opportunit√©s.  Voyons voir ce que la communaut√© propose! <br><br><h3>  Mon√©tisation depuis le Play Store </h3><br>  Si vous avez une application payante, vous ne pouvez pas facilement v√©rifier que l'utilisateur l'a r√©ellement pay√©e (apr√®s tout, le contenu n'est qu'une URL).  En outre, si vous souhaitez vendre des ressources num√©riques ou des abonnements √† l'aide du portefeuille Play Store, il est difficile de mettre en ≈ìuvre un tel sch√©ma sans pont r√©el avec un code natif. <br><br><h3>  D√©bogage </h3><br>  Je ne sais pas s'il s'agit d'un bogue ou d'une sorte de probl√®me avec mon IDE, mais le d√©bogage √† distance des employ√©s de service de TWA ne fonctionne pas.  Je peux v√©rifier le contexte de la fen√™tre, mais pas le technicien de service. <br><br><h3>  Autres moteurs </h3><br>  TWA ne fonctionne actuellement que sur Chrome, mais √† l'avenir, d'autres navigateurs peuvent cloner l'API: par exemple, Samsung Internet, Edge ou Firefox. <br><br>  <b>Mise √† jour du 4 f√©vrier</b> : TWA fonctionne sur le protocole Android Custom Tab, que d'autres navigateurs impl√©mentent actuellement.  Par cons√©quent, si un autre navigateur par d√©faut est install√© sur le syst√®me, il peut ouvrir TWA avec le contenu du PWA.  Cependant, des tests suppl√©mentaires sont n√©cessaires pour comprendre comment cela fonctionne. <br><br>  Que se passe-t-il si l'utilisateur poss√®de une ancienne version de Chrome et installe l'application depuis le Play Store?  Dans ce cas, PWA appara√Ætra sous la forme d'un onglet Chrome personnalis√©, et non en mode enti√®rement hors ligne. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7c6/a0e/7e4/7c6a0e7e4cfb1be1f72cd71a30a45b7c.png"><br>  <i><font color="gray">Google Maps Go sur le Play Store utilisait d√©j√† quelque chose de similaire √† TWA, et Chrome est r√©pertori√© comme une condition pr√©alable au travail</font></i> <br><br>  Que se passe-t-il si un utilisateur n'a pas du tout Chrome?  Aujourd'hui, lors de l'utilisation de la biblioth√®que de support, l'application ne fonctionnera pas du tout (s'il n'y a pas d'autre navigateur prenant en charge le protocole Custom Tabs).  Si vous utilisez l'API TWA en code Java / Kotlin natif, vous pouvez v√©rifier la disponibilit√© du navigateur et t√©l√©charger une solution alternative, telle que WebView, ou ouvrir le navigateur. <br><br>  Bien que les appareils Android sans Chrome soient rares, sur certains, il n'est pas install√© par d√©faut, y compris <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur tous les nouveaux appareils en Europe</a> . <br><br><h3>  Autres plateformes </h3><br>  PWA ne fonctionne pas sur les OS portables (horloges), mais je ne suis pas s√ªr de ce qui se passe sur les autres plates-formes Android.  Il n'y a probablement pas encore de support, mais v√©rifiez ceci.  Je parle d'Android TV ou de Chromebooks du Play Store.  Si vous n'avez pas test√© ces plateformes, il est logique de les d√©sactiver dans la liste des r√©pertoires. <br><br><h3>  Conflit avec WebAPK </h3><br>  Si vous avez install√© PWA √† partir de Chrome, vous avez d√©j√† un APK pour cette URL sign√© par le Play Store, mais le r√©pertoire laissera toujours l'application dans la liste et permettra √† l'utilisateur de l'installer √©galement.  Et vice versa: l'installation de l'application √† partir du r√©pertoire n'emp√™chera pas Chrome d'inviter l'utilisateur √† ¬´l'ajouter¬ª depuis le navigateur.  Je pense que cela peut √™tre √©vit√© si WebAPK re√ßoit √©galement Digital Asset Link ou si nous pouvons en quelque sorte correspondre √† l'identifiant de l'application WebAPK, mais cela ne se produira probablement pas dans un avenir proche.  Voyons voir. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9c1/1fe/3a2/9c11fe3a28681544babba34025589479.png"></div><br>  <i><font color="gray">Deux applications Starbucks s'ex√©cutant simultan√©ment: WebAPK et notre propre APK</font></i> <br><br>  Vous pouvez bloquer l'offre de Chrome pour installer WebAPK et afficher votre application √† partir du r√©pertoire √† <i>l'</i> aide de <i>l'</i> attribut <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">related_applications</a></i> et de l'attribut <i>prefer_related_applications</i> du <i>manifeste</i> de l'application Web.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'API Get Installed Related Apps</a> peut aider √† r√©soudre ce conflit √† l'avenir. <br><br><h1>  Cr√©ation du premier PWApk </h1><br>  Je sais que je viens d'inventer le mot PWApk, mais √ßa sonne bien, non? <br><br>  Il y a quelques ann√©es, j'ai suivi un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cours vid√©o sur les applications Web Android natives</a> .  Bien que cela ne soit pas enti√®rement vrai pour PWA, cela aide √† comprendre l'√©cosyst√®me Android. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/737/af5/77f/737af577f5decf195a80d62670f783f2.png"></div><br>  <i><font color="gray">Le moyen le plus simple de cr√©er des fichiers APK bas√©s sur TWA est de cloner l'exemple de r√©f√©rentiel SVGOMG √† partir du r√©f√©rentiel ChromeLabs sur GitHub</font></i> <br><br>  Vous pouvez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cloner le r√©f√©rentiel git</a> ou d√©marrer un nouveau projet.  Dans notre cas, nous ne d√©marrons un nouveau projet que pour mieux comprendre le sujet. <br><br>  Cr√©ez un nouveau projet dans Android Studio et s√©lectionnez <i>Aucune activit√©</i> : nous n'utiliserons que l'activit√© Web de confiance de la biblioth√®que de support. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5f3/ed6/3a6/5f3ed63a6ff8edc7a331955cfc85bd9e.png"><br>  <i><font color="gray">Commen√ßons par un projet vide</font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remplissez les donn√©es, s√©lectionnez le nom du projet (nous le changerons plus tard) et le nom du package: ce sera l'identifiant de notre application dans Android, ainsi que dans le catalogue. Je recommande d'utiliser le nom d'h√¥te dans l'ordre inverse et un nom arbitraire √† la fin. Par exemple, si vous avez l'h√¥te </font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mypwa.com/calculator</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , le package peut √™tre appel√© </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com.mypwa.calculator</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En tant que base, l'API 19 (Android 4.4) convient. Il semble que ce sera bient√¥t la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">version minimale requise pour Chrome</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Certaines fonctions TWA ne fonctionneront qu'avec l'API 23 (Android 6.0), mais la biblioth√®que de support s'en occupera. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mise √† jour du 5 f√©vrier</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Chrome a officiellement annonc√© que TWA ne fonctionne qu'avec Android 4.4 KitKat. </font><font style="vertical-align: inherit;">Ainsi, cette fonction n'est pas disponible pour environ 5% des utilisateurs Android actifs: ils seront restaur√©s √† la version avec un onglet personnalis√© et une barre d'adresse. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/2d3/66a/8fb/2d366a8fbf19b050af01bc9e35ed5093.png"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le choix d'un niveau d'API minimum limitera la liste des appareils pour lesquels PWA sera propos√© dans le r√©pertoire Play Store</font></font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ajouter une d√©pendance </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'√©tape suivante consiste √† ajouter la biblioth√®que de prise en charge TWA en tant que d√©pendance, alors ouvrez deux fichiers appel√©s </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build.gradle</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/5fa/f6c/f11/5faf6cf11d05e2df8ed6c8eab783a8c4.png"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deux fichiers de configuration: pour le projet et pour l'application Android</font></font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Commen√ßons par le fichier de projet. </font><font style="vertical-align: inherit;">Ajoutez la </font><font style="vertical-align: inherit;">ligne suivante </font><font style="vertical-align: inherit;">√† la section </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">allprojects&gt; repositories</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre><code class="java hljs">maven { url <span class="hljs-string"><span class="hljs-string">"https://jitpack.io"</span></span> }</code> </pre> <br>  Dans l'√©tape suivante, nous ouvrons le module <i>build.gradle</i> et l'ajoutons en fonction: <br><br><pre> <code class="java hljs">implementation <span class="hljs-string"><span class="hljs-string">'com.github.GoogleChrome:custom-tabs-client:e446d08014'</span></span></code> </pre> <br><h3>  Configuration TWA </h3><br>  L'√©tape suivante consiste √† d√©finir les param√®tres PWA pour Trusted Web Activity dans le fichier de module, ajoutez la section <i>defaultConfig</i> : <br><br><pre> <code class="java hljs">manifestPlaceholders = [ hostName: <span class="hljs-string"><span class="hljs-string">"app.starbucks.com"</span></span>, defaultUrl: <span class="hljs-string"><span class="hljs-string">"https://app.starbucks.com"</span></span>, launcherName: <span class="hljs-string"><span class="hljs-string">"Starbucks"</span></span>, assetStatements: <span class="hljs-string"><span class="hljs-string">'[{ "relation": ["delegate_permission/common.handle_all_urls"], '</span></span> + <span class="hljs-string"><span class="hljs-string">'"target": {"namespace": "web", "site": "https://app.starbucks.com"}}]'</span></span> ]</code> </pre> <br>  Ici, √† titre d'exemple, je vais utiliser Starbucks PWA.  Les informations du processus Digital Asset Link seront requises par la cl√© assetStatements.  Nous allons sauter cette partie pour l'instant.  La propri√©t√© nomm√©e <i>launcherName</i> doit correspondre au <i>short_name</i> dans le manifeste de l'application Web. <br><br><h3>  Configuration du manifeste </h3><br>  Les applications Android ont leur propre manifeste, elles n'accepteront pas le manifeste de l'application Web.  Le fichier souhait√© se trouve dans la section <i>app&gt; manifestes</i> et s'appelle AndroidManifest.xml.  Vous y trouverez un √©l√©ment Application XML √† fermeture automatique. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/65d/486/38c/65d48638cd9d76411f8fc935d6e3fff4.png"><br>  <i><font color="gray">Fichier manifeste Android par d√©faut</font></i> <br><br>  L√†, nous changeons la valeur d'android: label en <b>$ {launcherName}</b> , que nous avons d√©finie plus t√¥t dans les m√©tadonn√©es, afin d'avoir la seule source de v√©rit√© pour le nom de l'application. <br><br>  L'√©tape suivante consiste √† configurer ce fichier, en commen√ßant par la balise &lt;application&gt;, pour y ajouter des √©l√©ments enfants, qui ressembleront √† ceci: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta-data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"asset_statements"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${assetStatements}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.support.customtabs.trusted.LauncherActivity"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${launcherName}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta-data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.support.customtabs.trusted.DEFAULT_URL"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${defaultUrl}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.MAIN"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.LAUNCHER"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.VIEW"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.DEFAULT"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.BROWSABLE"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:scheme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:host</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${hostName}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Le code ci-dessous configure TWA √† l'aide de la biblioth√®que de prise en charge et du filtre d'intention afin que l'application re√ßoive des liens vers PWA et Digital Asset Link.  Je vais sauter les d√©tails de ce qui se passe en termes d'application Android. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5b0/45f/bd2/5b045fbd2c03c263490b96905f79aac6.png"><br>  <i><font color="gray">Il est temps de synchroniser</font></i> <br><br>  √Ä ce stade, vous devez commander Android Studio pour accepter toutes vos modifications en cliquant sur <i>Synchroniser maintenant</i> .  Si tout est fait correctement, aucune erreur n'appara√Ætra. <br><br><h3>  Remplacement des ic√¥nes </h3><br>  Pour le moment, l'application utilise uniquement l'ic√¥ne Android par d√©faut, vous devez donc remplacer tous les fichiers dans <i>app&gt; res&gt; mipmap</i> dans diff√©rents sous-dossiers pour diff√©rentes densit√©s de pixels.  Il existe deux versions: ic√¥nes carr√©es et arrondies.  Arrondi est apparu dans Android 7.1, et si vous voulez les ignorer, supprimez le lien <i>android: roundIcon</i> dans AndroidManifest.xml. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/626/7c7/baf/6267c7bafb790307f16bf2c0bb8a037a.png"><br>  <i><font color="gray">Vous devez prendre les ic√¥nes du manifeste et les copier dans les sous-dossiers mipmap avec les noms correspondants</font></i> <br><br><h3>  Configuration du th√®me </h3><br>  Enfin, ouvrez <i>app / res / values ‚Äã‚Äã/ styles.xml</i> et apportez quelques modifications au th√®me pour qu'il ressemble √† PWA: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AppTheme"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">parent</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Theme.AppCompat.Light.NoActionBar"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">item</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"colorPrimary"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">@color/colorPrimary</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">item</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">item</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"colorPrimaryDark"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">@color/colorPrimaryDark</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">item</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">item</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"colorAccent"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">@color/colorAccent</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">item</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">item</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"android:windowNoTitle"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">true</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">item</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">item</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"android:backgroundDimEnabled"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">false</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">item</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Vous pouvez changer les couleurs depuis <i>app / res / values ‚Äã‚Äã/ colours.xml</i> , mais je n'ai pas encore vu ce travail dans TWA. <br><br>  Si vous limitez l'orientation dans le manifeste, vous pouvez ajouter cette restriction √† l'√©l√©ment &lt;activity&gt; dans AndroidManifest.xml. <br><br><h1>  Pr√™t pour les tests? </h1><br>  Nous sommes pr√™ts √† tester notre PWApk, mais avant cela, nous devons configurer le mode de d√©veloppement TWA pour Chrome sur un appareil de test Android ou dans un √©mulateur (avec Chrome 72+). <br><br><h3>  Configuration de Chrome </h3><br>  Assurez-vous que vous disposez de la version stable de Chrome 72 et ouvrez <i>les indicateurs chrome: //</i> .  Recherchez l'option <i>Activer la ligne de commande sur les appareils non root√©s</i> et <i>cochez la case</i> .  Red√©marrez votre navigateur. <br><br>  Ensuite, nous devons configurer Chrome pour contourner Digital Asset Link pour l'h√¥te que nous voulons tester, dans notre exemple, c'est <b>app.starbucks.com</b> . <br><br>  Pour modifier les options de ligne de commande de Chrome pour Android, vous devez √©crire un fichier texte dans le syst√®me de fichiers Android.  La fa√ßon la plus simple de le faire est d' <b>utiliser adb</b> (android debug bridge), qui doit √™tre enregistr√© dans path (google, si cela), et ex√©cutez la commande: <br><br><pre> <code class="bash hljs">adb shell cat /data/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/tmp/chrome-command-line _ - <span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-digital-asset-link-verification-for-url=<span class="hljs-string"><span class="hljs-string">"https://app.starbucks.com"</span></span></code> </pre> <br>  Vous pouvez utiliser un <a href="">simple script bash</a> de Google. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bb1/285/bec/bb1285becd4651597032df751d86abcf.png"><br>  <i><font color="gray">Vous devez arr√™ter Chrome pour qu'il accepte de nouveaux param√®tres au d√©marrage</font></i> <br><br>  Et red√©marrez Chrome.  Mais ne supprimez pas simplement l'application de la liste des t√¢ches, mais des param√®tres pour forcer le processus complet (Forcer l'arr√™t).  J'ai d√ª le faire plusieurs fois avant que √ßa marche. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/590/e38/84b/590e3884b2f60cb751eb746eb24e69f1.png"><br>  <i><font color="gray">Attention que le drapeau est allum√© et que tout s'est bien pass√©</font></i> <br><br>  Si tout est fait, chaque fois que vous ouvrez Chrome, vous verrez un avertissement concernant un indicateur non pris en charge.  Si vous ex√©cutez l'application depuis Android Studio, votre PWA va enfin d√©marrer et fonctionner hors ligne sous l'ic√¥ne et le nom de votre APK. <br><br><h1>  Conclusion </h1><br>  La possibilit√© de publier PWA dans le r√©pertoire Google Play change vraiment les r√®gles du jeu.  Il semble que nous ayons maintenant une version tr√®s pr√©coce de l'API et que nous ayons d√©finitivement besoin de travail.  Je veux vraiment pouvoir entrer l'URL de notre PWA et en obtenir le fichier APK.  Ce n'est pas tr√®s simple en raison du syst√®me de v√©rification Digital Asset Link.  Seul le Play Store peut le faire en utilisant le m√™me WebAPK qu'ils g√©n√®rent. <br><br>  Je me demandais si <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Google approuve les applications PWA ou fait la guerre contre elles</a> .  Mais maintenant, ils ont lev√© leurs soup√ßons, du moins en ce qui concerne le TWA. <br><br>  Esp√©rons que TWA dans Chrome 72 est la premi√®re √©tape d'un long voyage! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr439238/">https://habr.com/ru/post/fr439238/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr439224/index.html">Encore une fois sur les diagrammes de Voronoi</a></li>
<li><a href="../fr439226/index.html">Scala + MXNet = Microservice avec neurone en prod</a></li>
<li><a href="../fr439232/index.html">JAMstack: Comment cr√©er votre propre blog en utilisant Gatsby + Contentful + Netlify</a></li>
<li><a href="../fr439234/index.html">La vie du d√©veloppeur Open Source dans les GIF</a></li>
<li><a href="../fr439236/index.html">xenvman: environnements de test de microservices flexibles (et plus)</a></li>
<li><a href="../fr439240/index.html">Joomla Digest pour janvier 2019</a></li>
<li><a href="../fr439242/index.html">Autour de la b√™ta en 260 jours: comment nous avons appris √† √©couter les utilisateurs</a></li>
<li><a href="../fr439244/index.html">FAS recommande fortement de pr√©installer les logiciels russes sur les smartphones et ordinateurs portables vendus en F√©d√©ration de Russie</a></li>
<li><a href="../fr439248/index.html">Alan Kay: "Les anciens Romains pourraient-ils construire un ordinateur?"</a></li>
<li><a href="../fr439252/index.html">6 raisons de d√©velopper une carri√®re informatique en Arm√©nie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>