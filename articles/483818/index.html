<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçüîß üë©üèø‚Äç‚öñÔ∏è üçå Motor, lenguaje de script y novela visual: en 45 horas üç∏ ‚úÖ üèÑ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saludos Sucedi√≥ que durante tres a√±os seguidos, como un regalo para el A√±o Nuevo a ciertas personas, he estado haciendo un juego. En 2018, fue un jueg...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Motor, lenguaje de script y novela visual: en 45 horas</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483818/"><p><img src="https://habrastorage.org/webt/k-/q6/7j/k-q67jnxvm1knkh3qfvqjyhbira.png" alt="novela visual, motor y lenguaje de script durante 45 horas"></p><br><p>  Saludos  Sucedi√≥ que durante tres a√±os seguidos, como un regalo para el A√±o Nuevo a ciertas personas, he estado haciendo un juego.  En 2018, fue un juego de plataformas con elementos de rompecabezas, sobre el cual <a href="https://habr.com/ru/post/345958/">escrib√≠</a> en un centro  En 2019, un RTS de red para dos jugadores, sobre el que no escrib√≠ nada.  Y finalmente, en el 2020: una historia corta visual, que se discutir√° m√°s adelante, creada en un tiempo muy limitado. </p><br><p>  En este articulo: </p><br><ul><li>  dise√±o e implementaci√≥n del motor para cuentos visuales, </li><li>  un juego con una trama no lineal en 8 horas, </li><li>  eliminaci√≥n de la l√≥gica del juego en scripts en su propio idioma. </li></ul><br><p>  Interesante?  Entonces bienvenido al gato. </p><br><p>  <em>Precauci√≥n: hay mucho texto e im√°genes de ~ 3.5mb</em> </p><a name="habracut"></a><br><p>  Contenido: </p><br><p>  0. Justificaci√≥n para el desarrollo del motor. </p><br><ol><li>  La elecci√≥n de la plataforma. </li><li>  Arquitectura del motor y su implementaci√≥n: <br>  2.1.  Declaraci√≥n del problema. <br>  2.2.  Arquitectura e implementaci√≥n. </li><li>  Lenguaje de script: <br>  3.1.  Idioma. <br>  3.2.  Int√©rprete </li><li>  Desarrollo de juegos: <br>  4.1.  La historia y el desarrollo de la l√≥gica del juego. <br>  4.2.  Gr√°ficos </li><li>  Estad√≠sticas y resultados. </li></ol><br><p>  <em>Nota: Si por alguna raz√≥n no est√° interesado en los detalles t√©cnicos, puede pasar directamente al paso 4 "Desarrollo del juego", sin embargo, omitir√° la mayor parte del contenido.</em> </p><br><h2 id="0-obosnovanie-razrabotki-dvizhka">  0. Justificaci√≥n para el desarrollo del motor. </h2><br><p>  Por supuesto, hay una gran cantidad de motores listos para historias cortas visuales, que, sin duda, son mejores que la soluci√≥n que se describe a continuaci√≥n.  Sin embargo, sin importar qu√© tipo de programador fuera, si no hubiera escrito otro.  Por lo tanto, imaginemos que su desarrollo estaba justificado. </p><br><h2 id="1-vybor-platformy">  1. Selecci√≥n de plataforma </h2><br><p>  La elecci√≥n, de hecho, era peque√±a: Java o C ++.  Sin pensarlo dos veces, decid√≠ implementar mi plan en Java, porque  para un desarrollo r√°pido, ofrece todas las posibilidades (es decir, administraci√≥n autom√°tica de memoria y mayor simplicidad en comparaci√≥n con C ++, que oculta muchos detalles de bajo nivel y, como resultado, permite menos √©nfasis en el lenguaje en s√≠ mismo y piensa solo en la l√≥gica empresarial), y tambi√©n proporciona soporte para ventanas, gr√°ficos y audio listos para usar. </p><br><p>  Swing fue elegido para implementar la interfaz gr√°fica, ya que us√© Java 13, donde JavaFX ya no es parte de la biblioteca, y agregu√© decenas de megabytes de OpenJFX dependiendo de que fuera demasiado vago.  Quiz√°s esta no fue la mejor soluci√≥n, pero no obstante. </p><br><p>  <em>Probablemente surja la pregunta: ¬øqu√© tipo de motor de juego es, pero sin aceleraci√≥n de hardware?</em>  <em>La respuesta radica en la falta de tiempo para lidiar con OpenGL, as√≠ como su absoluta falta de sentido: FPS no es importante para una novela visual (en cualquier caso, con tanta animaci√≥n y gr√°ficos como en este caso).</em> </p><br><h2 id="2-arhitektura-dvizhka-i-ego-realizaciya">  2. La arquitectura del motor y su implementaci√≥n. </h2><br><h3 id="21-postanovka-zadachi">  2.1 enunciado del problema </h3><br><p>  Para decidir c√≥mo hacer algo, debe decidir por qu√©.  Este soy yo sobre la declaraci√≥n del problema, porque  la arquitectura no es universal, pero un motor "espec√≠fico de dominio", por definici√≥n, depende directamente del juego deseado. </p><br><p>  Por motor universal, entiendo el motor que admite conceptos de nivel relativamente bajo, como "Objeto de juego", "Escena", "Componente".  Se decidi√≥ que no fuera un motor universal, ya que esto reducir√≠a significativamente el tiempo de desarrollo. </p><br><p>  Seg√∫n lo planeado, el juego debe constar de las siguientes partes: </p><br><p><img src="https://habrastorage.org/webt/w9/fh/l5/w9fhl5dhsu2tiua2kd9d8n5lfdq.png" alt="estructura del juego de novela visual"></p><br><p>  Es decir, hay un fondo para cada escena, el texto principal, as√≠ como un campo de texto para la entrada del usuario (la novela visual fue concebida con una entrada arbitraria del usuario, y no con una elecci√≥n de las opciones propuestas, como suele ser el caso. M√°s adelante explicar√© por qu√© esto era malo decisi√≥n).  El diagrama tambi√©n muestra que puede haber varias escenas en el juego y, como resultado, se pueden hacer transiciones entre ellas. </p><br><p>  <em>Nota: Por escena me refiero a la parte l√≥gica del juego.</em>  <em>El criterio para la escena puede ser el mismo fondo en esta misma parte.</em> </p><br><p>  Tambi√©n entre los requisitos para el motor estaba la capacidad de reproducir audio y mostrar mensajes (con la funci√≥n opcional de entrada del usuario). </p><br><p>  Quiz√°s el deseo m√°s importante fue el deseo de escribir la l√≥gica del juego no en Java, sino en un lenguaje declarativo simple. </p><br><p>  Tambi√©n hubo un deseo de darse cuenta de la posibilidad de animaci√≥n de procedimiento, es decir, el movimiento elemental de im√°genes, mientras que en el nivel de Java era posible determinar la funci√≥n por la cual se considera la velocidad de movimiento actual (por ejemplo, para que el gr√°fico de velocidad sea directo, o sinusoide, u otra cosa). </p><br><p>  Seg√∫n lo planeado, toda la interacci√≥n del usuario deb√≠a hacerse a trav√©s de un sistema de di√°logos.  En este caso, el di√°logo se consider√≥ no necesariamente un di√°logo con el NPC o algo similar, sino que en general fue una reacci√≥n a cualquier entrada del usuario para la cual se registr√≥ el controlador correspondiente.  No est√° claro  Se aclarar√° pronto. </p><br><h3 id="22-arhitektura-i-realizaciya">  2.2.  Arquitectura e implementacion </h3><br><p>  Dado todo lo anterior, puede dividir el motor en tres partes relativamente grandes que corresponden a los mismos paquetes de Java: </p><br><ol><li> <code>display</code> : contiene todo lo que concierne a la salida para el usuario de cualquier informaci√≥n (gr√°fico, texto y sonido), as√≠ como la recepci√≥n de su informaci√≥n.  Una especie de (Ver), si hablamos de MVC / MVP / etc. </li><li>  <code>initializer</code> : contiene clases en las que el motor se inicializa y se inicia. </li><li>  <code>sl</code> : contiene herramientas para trabajar con el lenguaje de secuencias de comandos (en adelante, SL). </li></ol><br><p>  En este p√°rrafo considerar√© las dos primeras partes.  Comenzar√© con el segundo. </p><br><p>  La clase initializer tiene dos m√©todos principales: <code>initialize()</code> y <code>run()</code> .  Inicialmente, el control llega a la clase de <code>initialize()</code> , desde donde <code>initialize()</code> llama <code>initialize()</code> .  Despu√©s de la llamada, el inicializador analiza los par√°metros pasados ‚Äã‚Äãal programa (la ruta al directorio con b√∫squedas y el nombre de la b√∫squeda a ejecutar), carga el manifiesto de la b√∫squeda seleccionada (al respecto un poco m√°s tarde), inicializa la pantalla, verifica si la versi√≥n de idioma (SL) requerida por la b√∫squeda es compatible con los datos int√©rprete, y finalmente, lanza un hilo separado para la consola del desarrollador. </p><br><p>  Inmediatamente despu√©s de eso, si todo sali√≥ bien, el lanzador llama al m√©todo <code>run()</code> , que pone en marcha la carga real de la b√∫squeda.  Primero, est√°n todos los scripts relacionados con la b√∫squeda descargada (sobre la estructura del archivo de b√∫squeda, a continuaci√≥n), se env√≠an al analizador y el resultado se entrega al int√©rprete.  Luego, se inicia la inicializaci√≥n de todas las escenas y el inicializador completa la ejecuci√≥n de su flujo, colgando finalmente el controlador de la tecla Intro en la pantalla.  Y as√≠, cuando el usuario presiona Enter, se carga la primera escena, pero m√°s sobre eso m√°s tarde. </p><br><p>  La estructura de archivos de la b√∫squeda es la siguiente: </p><br><p><img src="https://habrastorage.org/webt/3l/xo/nr/3lxonrfkeik_hwids4tire50dge.png" alt="estructura de archivos de b√∫squeda"></p><br><p>  Hay una carpeta separada para la b√∫squeda, en la ra√≠z del cual se encuentra el manifiesto, as√≠ como tres carpetas adicionales: <code>audio</code> - para sonido, <code>graphics</code> - para la parte visual y <code>scenes</code> - para guiones que describen escenas. </p><br><p>  Me gustar√≠a describir brevemente el manifiesto.  Contiene los siguientes campos: </p><br><ul><li>  <code>sl_version_req</code> : versi√≥n de SL necesaria para comenzar la b√∫squeda, </li><li>  <code>init_scene</code> : el nombre de la escena desde la que comienza la b√∫squeda, </li><li>  <code>quest_name</code> : un hermoso nombre de b√∫squeda que aparece en el t√≠tulo de la ventana, </li><li>  <code>resolution</code> : la resoluci√≥n de la pantalla para la que est√° destinada la b√∫squeda (algunas palabras sobre esto m√°s adelante), </li><li>  <code>font_size</code> : tama√±o de fuente para todo el texto, </li><li>  <code>font_name</code> es el nombre de la fuente para todo el texto. </li></ul><br><p>  Vale la pena se√±alar que durante la inicializaci√≥n de la pantalla, entre otras cosas, se realiz√≥ el c√°lculo de la resoluci√≥n de representaci√≥n: es decir, la resoluci√≥n requerida se tom√≥ del manifiesto y se exprimi√≥ en el espacio disponible para la ventana para que: </p><br><ul><li>  la relaci√≥n de aspecto se mantuvo igual que en la resoluci√≥n del manifiesto, </li><li>  todo el espacio disponible estaba ocupado en ancho o en altura. <br>  Gracias a esto, el desarrollador de la b√∫squeda puede estar seguro de que sus im√°genes, por ejemplo 16: 9, se mostrar√°n en cualquier pantalla en esta proporci√≥n. </li></ul><br><p>  Adem√°s, cuando se inicializa la pantalla, el cursor est√° oculto, ya que no est√° involucrado en el juego. </p><br><p>  En pocas palabras sobre la consola del desarrollador.  Fue desarrollado por las siguientes razones: </p><br><ol><li>  Para depurar </li><li>  Si algo sale mal durante el juego, se puede solucionar a trav√©s de la consola del desarrollador. <br>  Implement√≥ solo unos pocos comandos, a saber: generar descriptores de un tipo espec√≠fico y su estado, generar hilos de trabajo, reiniciar la pantalla y el comando m√°s importante: <code>exec</code> , que permit√≠a ejecutar cualquier c√≥digo SL en la escena actual. </li></ol><br><p>  Esto finaliza la descripci√≥n del inicializador y las cosas relacionadas, y podemos proceder a la descripci√≥n de la pantalla. </p><br><p>  Su estructura final es la siguiente: </p><br><p><img src="https://habrastorage.org/webt/zz/qb/-1/zzqb-15nrxzhechuggvxgzoo-hg.png" alt="estructura de visualizaci√≥n"></p><br><p>  A partir del enunciado del problema, podemos concluir que todo lo que habr√° que hacer es dibujar im√°genes, dibujar texto, reproducir audio. </p><br><p>  ¬øC√≥mo se dibuja el texto / imagen en motores universales y m√°s all√°?  Hay un m√©todo de <code>update()</code> de tipo <code>update()</code> , que se llama cada tick / step / frame / render / frame / etc y en el que hay una llamada a un m√©todo de tipo <code>drawText()</code> / <code>drawImage()</code> - esto asegura la aparici√≥n de texto / imagen en este marco.  Sin embargo, tan pronto como se detiene la llamada a tales m√©todos, se detiene la representaci√≥n de las cosas correspondientes. </p><br><p>  En mi caso, se decidi√≥ hacer un poco diferente.  Dado que para las novelas visuales, el texto y las im√°genes son relativamente permanentes, y tambi√©n son casi todo lo que el usuario ve (es decir, son lo suficientemente importantes), se crearon como objetos de juego, es decir, cosas que solo necesitas generar y no desaparecer√°n hasta que les preguntes  Adem√°s, esta soluci√≥n simplific√≥ la implementaci√≥n. </p><br><p>  Un objeto (desde el punto de vista de OOP) que describe el texto / imagen se llama descriptor.  Es decir, para el usuario del motor API solo hay descriptores que se pueden agregar al estado de visualizaci√≥n y eliminar de √©l.  Por lo tanto, en la versi√≥n final de la pantalla hay los siguientes descriptores (corresponden a las clases del mismo nombre): </p><br><div class="scrollable-table"><table><thead><tr><th>  Nombre del descriptor: </th><th>  Descripci√≥n del descriptor: </th></tr></thead><tbody><tr><td> <code>ImageDescriptor</code> </td> <td>  Descriptor de imagen: contiene la imagen ( <code>BufferedImage</code> ), posici√≥n en la pantalla y ancho con altura.  Sin embargo, al crear, solo se especifica el ancho: la altura se calcula en proporci√≥n a la altura original (y no hay forma de estirar / comprimir manualmente la imagen desproporcionadamente, por lo que esta fue una mala decisi√≥n). </td></tr><tr><td> <code>TextDescriptor</code> </td> <td>  Descriptor de texto: contiene el texto, su posici√≥n y tama√±o.  Adem√°s, el texto no escala en ancho y alto, sino que se corta al ir m√°s all√° de los bordes.  El texto puede transferirse por s√≠labas y simplemente por espacios en blanco, y tambi√©n desplazarse por las l√≠neas. </td></tr><tr><td> <code>AudioDescriptor</code> </td> <td>  Un descriptor de audio que puede reproducir audio (ya sea una vez o en bucle), pausarlo y eliminarlo. </td></tr><tr><td> <code>AnimationDescriptor</code> </td> <td>  Un controlador de animaci√≥n que, como el audio, se puede colocar en bucle.  Contiene un objeto que implementa la animaci√≥n y un descriptor de imagen para el que se reproduce la animaci√≥n.  El m√©todo principal es la <code>update(long)</code> , que toma la cantidad de milisegundos que han pasado desde la √∫ltima llamada de <code>update(long)</code> .  Su n√∫mero se usa para calcular el estado actual de la animaci√≥n. </td></tr><tr><td> <code>InputDescriptor</code> </td> <td>  Descriptor de entrada: es un campo de texto en el que el cursor siempre est√° al final del texto.  Tambi√©n vale la pena se√±alar que el almacenamiento y la representaci√≥n del texto del descriptor de entrada se lleva a cabo a trav√©s de un descriptor de texto creado impl√≠citamente, para no duplicar la l√≥gica.  <em>Lo curioso es que tom√© en cuenta la posibilidad de presionar Retroceso, pero no tom√© en cuenta Eliminar;</em>  <em>y cuando todav√≠a se presion√≥ Eliminar durante el juego, ‚ñØ‚ñØ‚ñØ apareci√≥ en el campo, ya que no se realiz√≥ ning√∫n procesamiento para Eliminar y el personaje intent√≥ mostrarse como texto.</em> </td></tr><tr><td> <code>KeyAwaitDescriptor</code> </td> <td>  Un identificador al que se pasa la tecla necesaria (desde <code>KeyEvent</code> ) y una devoluci√≥n de llamada con cierta l√≥gica que se iniciar√° cuando se presione la tecla correspondiente. </td></tr><tr><td> <code>PostWorkDescriptor</code> </td> <td>  Un identificador que acepta una devoluci√≥n de llamada que se llamar√° despu√©s de procesar cada tick. </td></tr></tbody></table></div><br><p>  La pantalla tambi√©n contiene campos para el receptor de entrada actual (descriptor de entrada) y un campo que indica qu√© descriptor de texto ahora tiene foco y cuyo texto se desplazar√° bajo las acciones correspondientes por parte del usuario. </p><br><p>  El ciclo del juego se parece a esto: </p><br><ol><li>  Procesamiento de audio: llamar al m√©todo <code>update()</code> en los descriptores de audio, que verifica el estado actual del audio, libera memoria (si es necesario) y realiza otros trabajos t√©cnicos. </li><li>  Procesar pulsaciones de teclas: transfiera los caracteres ingresados ‚Äã‚Äãa un descriptor para recibir entradas, procesando pulsaciones de teclas para las teclas de desplazamiento (flechas arriba y abajo) y Retroceso. </li><li>  Procesamiento de animaci√≥n. </li><li>  Borrar el fondo en el b√∫fer de representaci√≥n ( <code>BufferedImage</code> sirvi√≥ como el b√∫fer). </li><li>  Dibujando im√°genes. </li><li>  Representaci√≥n de texto </li><li>  Dibujar campos para entrada. </li><li>  La salida del b√∫fer a la pantalla. </li><li>  Manejo de <code>PostWorkDescriptor</code> 's. </li><li>  Algunos trabajan para reemplazar los estados de la pantalla, que analizar√© m√°s adelante (en la secci√≥n sobre el int√©rprete de SL). </li><li>  Detenga el flujo durante un tiempo calculado din√°micamente para que el FPS sea igual al valor especificado (30 por defecto). </li></ol><br><p>  <em>Nota: Quiz√°s surja la pregunta: "¬øPor qu√© representar campos de entrada si se han creado descriptores de texto apropiados para ellos que se representar√°n un paso antes?"</em>  <em>De hecho, la representaci√≥n en el p√°rrafo 7 no ocurre, solo los <code>InputDescriptor</code> del <code>InputDescriptor</code> se sincronizan con los <code>InputDescriptor</code> del <code>InputDescriptor</code> , como la visibilidad de la pantalla, la posici√≥n, el tama√±o y otros.</em>  <em>Esto se hizo, como se indic√≥ anteriormente, por la raz√≥n de que el usuario no controla directamente el descriptor de entrada correspondiente con un descriptor de texto y generalmente no sabe nada al respecto.</em> </p><br><p>  Vale la pena se√±alar que el tama√±o y la posici√≥n de los elementos en la pantalla no se establecen en p√≠xeles, sino en tama√±os relativos: n√∫meros del 0 al 1 (diagrama a continuaci√≥n).  Es decir, todo el ancho para renderizar es 1, y toda la altura es 1 (y no son iguales, lo que olvid√© algunas veces y luego lament√©).  Tambi√©n valdr√≠a la pena hacer que (0,0) sea el centro, y el ancho / alto deber√≠a ser igual a dos, pero por alguna raz√≥n lo olvid√© / no lo pens√©.  Sin embargo, incluso la opci√≥n con un ancho / alto igual a 1 simplific√≥ la vida del desarrollador de la misi√≥n. </p><br><p><img src="https://habrastorage.org/webt/ay/ay/zy/ayayzykqpewkfcggqoxxz3mtcse.png" alt="sistema de coordenadas espec√≠ficas"></p><br><p>  Algunas palabras sobre el sistema para liberar memoria. </p><br><p>  Cada descriptor ten√≠a un <code>setDoFree(boolean)</code> , al que el usuario ten√≠a que llamar si quer√≠a destruir el descriptor dado.  La recolecci√≥n de basura para descriptores de alg√∫n tipo ocurri√≥ inmediatamente despu√©s de procesar todos los descriptores de este tipo.  Adem√°s, el audio que se reprodujo una vez se elimin√≥ autom√°ticamente una vez que finaliz√≥ la reproducci√≥n.  Exactamente lo mismo que la animaci√≥n sin bucle. </p><br><p>  Por lo tanto, en este momento puede dibujar lo que quiera, pero esta no es la imagen de arriba, en la que solo hay un fondo, el texto principal y un campo de entrada.  Y aqu√≠ viene el contenedor sobre la pantalla, que corresponde a la clase <code>DefaultDisplayToolkit</code> . </p><br><p>  Cuando se inicializa, simplemente agrega descriptores para el fondo, el texto, etc. a la pantalla. Tambi√©n sabe c√≥mo mostrar mensajes con el icono opcional, el campo de entrada y la devoluci√≥n de llamada. </p><br><p>  <em>Luego apareci√≥ un peque√±o error, cuya correcci√≥n completa requerir√≠a rehacer la mitad del sistema de representaci√≥n: si observa el orden de representaci√≥n en el bucle del juego, puede ver que las im√°genes se dibujan primero y solo luego el texto.</em>  <em>Al mismo tiempo, cuando el kit de herramientas muestra la imagen, la coloca en el centro de la pantalla en ancho y <strong>alto</strong> .</em>  <em>Y si hay mucho texto en el mensaje, entonces deber√≠a superponerse parcialmente al texto principal de la escena.</em>  <em>Sin embargo, dado que el fondo del mensaje es una imagen (completamente negra, pero no obstante), y las im√°genes se dibujan antes del texto, un texto se superpone a otro (captura de pantalla a continuaci√≥n).</em>  <em>El problema se resolvi√≥ parcialmente centrando verticalmente no en la pantalla, sino en el √°rea <strong>sobre el</strong> texto principal.</em>  <em>Una soluci√≥n completa incluir√≠a introducir un par√°metro de profundidad y rehacer los renderizadores de la palabra "completamente".</em> </p><br><div class="spoiler">  <b class="spoiler_title">Demostraci√≥n de superposici√≥n</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/la/t1/yn/lat1ynb6f3ivjxdvnhi4bsbjfvc.png" alt="superposici√≥n de texto"></p></div></div><br><p>  Quiz√°s se trata de la pantalla, finalmente, de todo.  Puede pasar al idioma, la API completa para trabajar que est√° contenida en el paquete <code>sl</code> . </p><br><h2 id="3-skriptovyy-yazyk">  3. Lenguaje de script </h2><br><p>  <em>Nota: Si el respetado% USERNAME% lo ley√≥ aqu√≠, lo hizo bien y le pedir√≠a que no dejara de hacerlo: ahora ser√° mucho m√°s interesante que antes.</em> </p><br><h3 id="31-yazyk">  3.1.  Idioma </h3><br><p>  Inicialmente, quer√≠a hacer un lenguaje declarativo en el que solo fuera necesario indicar todos los par√°metros necesarios para la escena, y eso es todo.  El motor tomar√≠a toda la l√≥gica.  Sin embargo, al final, llegu√© al lenguaje de procedimiento, incluso con elementos de OOP (apenas distinguibles), y esta fue una buena soluci√≥n, ya que, en comparaci√≥n con la versi√≥n declarativa, me dio la oportunidad de tener mucha m√°s flexibilidad en la l√≥gica del juego. </p><br><p>  La sintaxis del lenguaje fue pensada para ser lo m√°s simple posible para el an√°lisis, lo cual es l√≥gico, dada la cantidad de tiempo disponible. </p><br><p>  Entonces, el c√≥digo se almacena en archivos de texto con la extensi√≥n SSF;  cada archivo contiene una descripci√≥n de una o m√°s escenas;  cada escena contiene cero o m√°s acciones;  cada acci√≥n contiene cero o m√°s operadores. </p><br><p>  Una peque√±a explicaci√≥n sobre los t√©rminos.  Una acci√≥n es solo un procedimiento sin la posibilidad de pasar argumentos (de ninguna manera impidi√≥ el desarrollo del juego).  Aparentemente, el operador no es exactamente lo que significa esta palabra en los idiomas ordinarios (+, -, /, *), pero la forma es la misma: el operador es la totalidad de su nombre y todos sus argumentos. </p><br><p>  Quiz√°s est√© ansioso por ver finalmente el c√≥digo fuente de SL, aqu√≠ est√°: </p><br><pre> <code class="plaintext hljs">scene dungeon { action init { load_image "background" "dungeon/background.png" load_image "key" "dungeon/key.png" load_audio "background" "dungeon/background.wav" load_audio "got_key" "dungeon/got_key.wav" } action first_come { play "background" loop set_background "background" set_text "some text" add_dialog "(||(|) (||-))" "dial_look_around" dial_look_around on } //some comment action dial_look_around { play "got_key" once show "some text 2" "key" none tag "key" switch_dialog "dial_look_around" off } }</code> </pre> <br><p>  Ahora queda claro qu√© es el operador.  Tambi√©n se ve que cada acci√≥n es un bloque de declaraciones (una declaraci√≥n puede ser un bloque de declaraciones), as√≠ como el hecho de que los comentarios de una sola l√≠nea son compatibles (no ten√≠a sentido ingresar los de varias l√≠neas, adem√°s, no utilic√© los de una sola l√≠nea). </p><br><p>  En aras de la simplificaci√≥n, un concepto como "variable" no se introdujo en el lenguaje;  Como resultado, todos los valores utilizados en el c√≥digo son literales.  Dependiendo del tipo, se distinguen los siguientes literales: </p><br><div class="scrollable-table"><table><thead><tr><th>  Nombre literal </th><th>  Nota: </th></tr></thead><tbody><tr><td>  Cadena literal </td><td>  Se incluye la capacidad de escapar de comillas y barras inclinadas (\\), tambi√©n es posible insertar un gui√≥n en el texto </td></tr><tr><td>  Literal entero </td><td>  Admite n√∫meros negativos </td></tr><tr><td>  Literal de coma flotante </td><td>  Admite n√∫meros negativos </td></tr><tr><td>  Ninguno literal </td><td>  El c√≥digo se representa como <code>none</code> </td></tr><tr><td>  Literal booleano </td><td>  En el c√≥digo: <code>off</code> / <code>off</code> para verdadero / falso, respectivamente </td></tr><tr><td>  Literal general </td><td>  Si un literal no cae en ninguno de los tipos anteriores y consta de las letras del alfabeto ingl√©s, los n√∫meros y el gui√≥n bajo, es un literal general. </td></tr></tbody></table></div><br><p>  Algunas palabras sobre el an√°lisis del lenguaje.  Hay varios niveles de "carga" del c√≥digo (diagrama a continuaci√≥n): </p><br><ol><li>  Un tokenizer es una clase modular para dividir el c√≥digo fuente en tokens (las unidades sem√°nticas m√≠nimas del lenguaje).  Cada tipo de token est√° asociado con un n√∫mero: su tipo.  ¬øPor qu√© modular?  Porque aquellas partes del tokenizer que verifican si alguna parte del c√≥digo fuente es un token de cierto tipo se a√≠slan del tokenizer y se descargan desde el exterior (del segundo p√°rrafo). </li><li>  El complemento tokenizer es una clase que define la apariencia de cada tipo de token en SL;  en el nivel inferior usa un tokenizer.  Tambi√©n aqu√≠ est√° la selecci√≥n de tokens espaciales y la omisi√≥n de comentarios de una sola l√≠nea.  La salida proporciona un flujo limpio de tokens, que se utiliza en ... </li><li>  ... un analizador (tambi√©n es modular), que produce un √°rbol de sintaxis abstracta en la salida.  Modular: porque solo puede analizar escenas y acciones, pero no sabe c√≥mo analizar operadores.  Por lo tanto, los m√≥dulos se cargan en √©l (de hecho, √©l mismo los carga en el constructor, lo que no es muy bueno), que puede analizar cada uno de sus operadores. </li></ol><br><p><img src="https://habrastorage.org/webt/3c/vz/u-/3cvzu-qk5wgwwtgpn_dndl3aan8.png" alt="canalizaci√≥n de an√°lisis de lenguaje de scripting"></p><br><p>  Ahora, brevemente sobre los operadores, para que aparezca una idea de la funcionalidad del lenguaje.  Inicialmente, hab√≠a 11 operadores, luego, en el proceso de pensar en el juego, algunos se fusionaron en uno, algunos cambiaron y se agregaron 9 m√°s.  Aqu√≠ est√° la tabla resumen: </p><br><div class="scrollable-table"><table><thead><tr><th>  Nombre del operador: </th><th>  Nota: </th></tr></thead><tbody><tr><td> <code>load_image</code> </td> <td>  Carga una imagen en la memoria </td></tr><tr><td> <code>load_audio</code> </td> <td>  Carga audio en la memoria </td></tr><tr><td> <code>set_text</code> </td> <td>  Establece el texto principal de la escena. </td></tr><tr><td> <code>set_background</code> </td> <td>  Establece el fondo de la escena. </td></tr><tr><td> <code>play</code> </td> <td>  Reproduce audio (se puede reproducir una vez o reproducir en bucle) </td></tr><tr><td> <code>show</code> </td> <td>  Muestra un mensaje con una devoluci√≥n de llamada (en SL) y una imagen opcional (llamada despu√©s de que el usuario cierra el mensaje) </td></tr><tr><td> <code>tag</code> </td> <td>  Establece una etiqueta (etiqueta).  Se puede considerar como una variable global con el nombre especificado, que no almacena ning√∫n valor.  Esto es √∫til en diferentes casos: por ejemplo, puede marcar de tal manera si el jugador encontr√≥ la llave de la puerta, si ya estaba en esta ubicaci√≥n, etc. </td></tr><tr><td>  <code>if_tag</code> / <code>if_tag_n</code> </td><td>  Operadores de ramificaci√≥n que le permiten hacer algo dependiendo de si la etiqueta correspondiente est√° instalada.  <code>else</code> rama es compatible.  <code>if_tag</code> se ejecuta si se establece la etiqueta, <code>if_tag_n</code> - viceversa </td></tr><tr><td> <code>add_dialog</code> </td> <td>  Le permite agregar di√°logo a la escena.  Sobre ellos un poco m√°s tarde </td></tr><tr><td> <code>goto</code> </td> <td>  Transici√≥n a otra escena </td></tr><tr><td> <code>call</code> </td> <td>  Llamada de acci√≥n personalizada </td></tr><tr><td> <code>call_extern</code> </td> <td>  Invocando una acci√≥n de otra escena. </td></tr><tr><td> <code>stop_all</code> </td> <td>  Deja de reproducir todos los sonidos / m√∫sica </td></tr><tr><td> <code>show_motion</code> </td> <td>  Muestra y mueve la imagen de un punto a otro en el tiempo especificado (duraci√≥n) (con una devoluci√≥n de llamada opcional que se llama cuando finaliza el movimiento) </td></tr><tr><td> <code>animate</code> </td> <td>  Anima una imagen mostrada previamente a trav√©s de <code>show_motion</code> .  Desde las opciones: puede especificar el tipo de animaci√≥n: <code>v_motion</code> / <code>h_motion</code> (movimiento vertical / horizontal por funci√≥n <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>2</mn><msup><mi>t</mi><mn>3</mn></msup><mo>&amp;#x2212;</mo><mn>3</mn><msup><mi>t</mi><mn>2</mn></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.953ex" height="2.539ex" viewBox="0 -935.7 3854.8 1093.4" role="img" focusable="false" style="vertical-align: -0.366ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/483818/&amp;xid=17259,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhghtHGX0m5bdX-mE0S8HZMkcJX80w#MJMAIN-32" x="0" y="0"></use><g transform="translate(500,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/483818/&amp;xid=17259,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhghtHGX0m5bdX-mE0S8HZMkcJX80w#MJMATHI-74" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/483818/&amp;xid=17259,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhghtHGX0m5bdX-mE0S8HZMkcJX80w#MJMAIN-33" x="511" y="513"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/483818/&amp;xid=17259,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhghtHGX0m5bdX-mE0S8HZMkcJX80w#MJMAIN-2212" x="1538" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/483818/&amp;xid=17259,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhghtHGX0m5bdX-mE0S8HZMkcJX80w#MJMAIN-33" x="2538" y="0"></use><g transform="translate(3039,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/483818/&amp;xid=17259,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhghtHGX0m5bdX-mE0S8HZMkcJX80w#MJMATHI-74" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/483818/&amp;xid=17259,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhghtHGX0m5bdX-mE0S8HZMkcJX80w#MJMAIN-32" x="511" y="513"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><msup><mi>t</mi><mn>3</mn></msup><mo>‚àí</mo><mn>3</mn><msup><mi>t</mi><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-1"> 2t ^ 3-3t ^ 2 </script>  ), la posibilidad de bucle, una indicaci√≥n del tiempo (duraci√≥n) durante el cual se debe reproducir la animaci√≥n.  Es posible transferir un valor num√©rico (uno, ya que no hay forma de pasar un n√∫mero variable de argumentos, por lo que esto es en parte una muleta) a la animaci√≥n (para cada animaci√≥n significa cosas diferentes) y la devoluci√≥n de llamada opcional (llamada cuando se reproduce la animaci√≥n). </td></tr></tbody></table></div><br><p>  Operadores para trabajar con contadores: variables enteras espec√≠ficas de la escena. </p><br><div class="scrollable-table"><table><thead><tr><th>  Nombre del operador: </th><th>  Nota: </th></tr></thead><tbody><tr><td> <code>counter_set</code> </td> <td>  Crear un contador e inicializarlo con alg√∫n valor </td></tr><tr><td> <code>counter_add</code> </td> <td>  Agregar un valor a un contador </td></tr><tr><td> <code>if_counter &lt;modifier&gt;</code> </td> <td>  Capaz de comparar los valores de dos contadores / n√∫meros / n√∫meros y un contador.  <code>&lt;modifier&gt;</code> es un literal general y tiene la forma <code>eq/gr/ls[_n]</code> , donde <code>eq</code> es igual, <code>gr</code> es mayor que, <code>ls</code> es menor que, <code>_n</code> es negaci√≥n (por ejemplo, <code>gr_n</code> no es mayor).  Como puede ver, todo se simplific√≥ lo m√°s posible. </td></tr></tbody></table></div><br><p>  Tambi√©n se pens√≥ en introducir una <code>return</code> (incluso se agreg√≥ la funcionalidad correspondiente en el nivel central del int√©rprete), pero se me olvid√≥ y no fue √∫til. </p><br><p>           ,      ,     :  <code>show_motion</code>      (, , 0.01)         <code>duration</code> . </p><br><p>          ,   (lookup)  (  ):      ///,        <code>load_audio</code> / <code>load_image</code> / <code>counter_set</code> / <code>add_dialog</code> .   ,       ,   ,    , ‚Äî . .        ,     . , : " <code>scene_coast.dialog_1</code> " ‚Äî  <code>dialog_1</code>   <code>scene_coast</code> . </p><br><p>           SL-,   . , ,       , ‚Äî       .     :       (-, ),   ,       <code>lookup</code> ', ,  ,  .      ,            <code>goto</code>  <code>lookup</code> ',        . </p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><p>    -      ‚Äî - ,        ,       <code>n</code>  ( )    .             ,     ,       <code>n</code>   .   ,  . </p></div></div><br><p>   .     : </p><br><pre> <code class="plaintext hljs">add_dialog "regexp" "dialog_name" callback on/off</code> </pre> <br><p>     ,                  . ,     :     ,   ,      ,     ( ). </p><br><p>  ,    ,        ( )    ( )   ,    ( ).         :         ,    ,     , ""   "". </p><br><p><img src="https://habrastorage.org/webt/qw/nk/y6/qwnky6dhlw8amlkbhcnb3ex4tvs.png" alt="trabajo de sistema de di√°logos"></p><br><p> <em>,       ( ,  )</em> </p><br><p>     ,  "": </p><br><pre> <code class="plaintext hljs">(||((|||) ( )?(||)?)|(||)( )?|  )</code> </pre> <br><p>  *** </p><br><p>   ,     :  ‚Äî ,      ,   ‚Äî . </p><br><p> <em>,       :      </em> </p><br><h3 id="32-interpretator">  3.2.  </h3><br><p>      :   ,  ‚Äî  ""  (   ).  <em></em>           . </p><br><p>   SL    ,     - .  : </p><br><ol><li> <code>init</code> ‚Äî           ,    (  ,      , ,     ). </li><li> <code>first_come</code> ‚Äî ,      .     ,  ,     . </li><li>       ,     : <code>come</code> ‚Äî    ,     ( ). </li></ol><br><p> <em>: <code>init</code>  <code>first_come</code> ‚Äî     ,          .</em> </p><br><p>         .     :      ,    ,    <strong></strong>  <code>init</code> -.  ,  <strong></strong>    (   )    . </p><br><p>  ,     <code>n</code> ,        <code>first_come</code> - (  -       -     ).       .  ,   :       ,        ,  <code>first_come</code>  <code>come</code> ,   <code>come</code> ( ).    :        ,             ,         ,       . </p><br><p>          (,    "", " ", "  "  . .).  ,      ,   -    - .    ,             ( ),          . </p><br><p>              (, ,    ).   :        ?       ,        ,      .      <code>provideState</code>  ,        ;  <strong></strong>           ,      . </p><br><p> <em>      ,  ,     ,     ,    (    ,    ),         (, ,      ,    ).</em> </p><br><h2 id="4-razrabotka-igry"> 4.   </h2><br><p>          .   2019-  2018-,      ,  ,    . </p><br><h3 id="41-istoriya-i-razrabotka-logiki-igry">  4.1.      </h3><br><p>     ,  ,    , ‚Äî  .             ,      .      (  ),      , <del>  </del>     - , 9  (),      -  (   ,     ( , , )  . </p><br><p>  ,   :     ,       ,   ,     .           ,       ,     . </p><br><p>  ,        25% (5)  ,  :  ,   ;   ( <code>animate</code> ),      ( <code>call_extern</code> ). </p><br><p>   ,     -     ( ),      (,   ,   ‚Äî  ,  "You won"). </p><br><p><img src="https://habrastorage.org/webt/0g/la/gv/0glagv3q6tcjirb_qezojplz8tc.png" alt="novela visual de demostraci√≥n"></p><br><h3 id="42-grafika">  4.2.  </h3><br><p>          ,     : </p><br><p><img src="https://habrastorage.org/webt/pz/fw/qi/pzfwqi8pkcr7le0xjkjmkd8w-h8.png" alt="trozos para gr√°ficos"></p><br><p>      ,    ,    -   -    " ".     : </p><br><ul><li>      (4x2.23''),         . </li><li>       : ,    , ‚Äî     . </li><li>            ////etc. </li></ul><br><p><img src="https://habrastorage.org/webt/e9/ry/rv/e9ryrv-13waaticfbp04vhwq5tu.png" alt="uso de pinceles art√≠sticos"></p><br><ul><li>    ,    ,     . </li></ul><br><p><img src="https://habrastorage.org/webt/th/hj/jm/thhjjmkujbdjdo4eqvksclai7pq.png" alt="un personaje de la novela visual"></p><br><ul><li> ,        .      ,     , ,       .     . </li></ul><br><h2 id="5-statistika-i-itogi"> 5.    </h2><br><p>        ( 11 )    30  40 .    9    4  55 .     (  )  7  41 .   ‚Äî ~4-6  (    45   ). </p><br><p> <em>:      "Darkyen's Time Tracker"   JetBrains (  ).</em> <br> <em>:       2    ,    ‚Äî     .   45        8 .</em> </p><br><p>      : 4777,   ( ) ‚Äî 637. </p><br><p> <em>:     <code>cloc</code> .</em> </p><br><p>    30   .    (  ) :  ‚Äî ~8 ,      ‚Äî ~24 ,   (     ) ‚Äî ~8 .     . </p><br><p>   ‚Äî 232  (  - ,   WAV). </p><br><div class="spoiler"> <b class="spoiler_title"> WAV?</b> <div class="spoiler_text"><p>       <code>javax.sound.sampled.AudioSystem</code> ,    WAV  AU ,    WAV. </p></div></div><br><p>   28  (  3  ).          ‚Äî           17  /. </p><br><p>         -  :        ,        .  , ,   "   ",     " ".     (,   ),          (     ""/""  - ). </p><br><div class="spoiler"> <b class="spoiler_title">      ?</b> <div class="spoiler_text"><p>   ‚Äî      ,    .      :        . . ,       ,       ""    :        NPC,      ,       (,    ‚Äî    ..). </p></div></div><br><p>   ,      :  ,      . </p><br><p>    ‚Äî  .     ,  :  ,  ,  ,   .              . ,        ,     , , , . </p><br><p>   .       (        ),    : </p><br><ul><li>  .  .  . </li><li>     .              ,    . </li><li>   ,       . </li></ul><br><p> <em>,             ,  .</em> </p><br><p>           <a href="https://github.com/wcobalt/stepper" rel="nofollow">GitHub</a> . </p><br><p>        (assets)  <a href="https://github.com/wcobalt/stepper/releases" rel="nofollow"> "Releases"</a>   "v1.0"  . </p></div></div><p>Source: <a href="https://habr.com/ru/post/483818/">https://habr.com/ru/post/483818/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../483796/index.html">Par√°metros opcionales en repositorios de datos de Spring</a></li>
<li><a href="../483798/index.html">C√≥mo automatizar la redacci√≥n de anuncios en Google Ads</a></li>
<li><a href="../483800/index.html">¬°No duermas! C√≥mo aprendimos a lanzar 12,000 ofertas de boletos por noche</a></li>
<li><a href="../483802/index.html">C√≥mo lanzar un producto solo si es desarrollador: Consejos del creador de Laravel, Taylor Otvel. Parte 1: audiencia</a></li>
<li><a href="../483804/index.html">Richard Hamming "Cap√≠tulo inexistente": como sabemos lo que sabemos (11-20 minutos de 40)</a></li>
<li><a href="../483820/index.html">Lo que afecta la emisi√≥n de cr√©dito. Descripci√≥n general de la competencia de riesgo de incumplimiento de cr√©dito de vivienda</a></li>
<li><a href="../483822/index.html">5 caracter√≠sticas de JavaScript sin las cuales no podr√≠a escribir c√≥digo</a></li>
<li><a href="../483826/index.html">Conexi√≥n de un sensor de CO2 Modelo MH-Z19B utilizando la salida anal√≥gica Vo</a></li>
<li><a href="../483830/index.html">Enrutamiento para iOS: navegaci√≥n universal sin reescribir la aplicaci√≥n</a></li>
<li><a href="../483832/index.html">RxJava a Coroutines: migraci√≥n de caracter√≠sticas de extremo a extremo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>