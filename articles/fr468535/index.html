<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï∫ üà∫ üë¶üèΩ Vous n'avez pas besoin de journaux? üë®üèæ‚Äçüíª ‚ú°Ô∏è üëêüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le d√©veloppement a beaucoup chang√© ces derni√®res ann√©es. Au lieu d'applications monolithiques, des microservices et des fonctions sont venus. Les base...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Vous n'avez pas besoin de journaux?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/468535/">  Le d√©veloppement a beaucoup chang√© ces derni√®res ann√©es.  Au lieu d'applications monolithiques, des microservices et des fonctions sont venus.  Les bases de donn√©es de monstres industriels universels sont devenues √©troitement cibl√©es.  Docker a chang√© d'avis sur le d√©ploiement.  Mais notre id√©e des journaux a-t-elle chang√©? <br><br>  L'un des gros probl√®mes de Yandex.Verticals √©tait les journaux - 18 To par jour et 250 000 journaux par seconde, tout est √©crit dans des fichiers.  Les journaux sont h√©t√©rog√®nes car il existe de nombreux langages: Scala, Java, Python, Go.  Ensuite, ils sont collect√©s par Fluent Bit, √©crit en Kafka, les gestionnaires travaillent sur une machine √† repasser, assemblent √† partir de Kafka et √©crivent tout sur le disque.  De plus, il s'agit de la deuxi√®me version des journaux. <br><br><img src="https://habrastorage.org/webt/4i/z8/ws/4iz8wst0a72z7ytipvzx77wnxiq.jpeg"><br><br>  En cons√©quence, un long probl√®me de recherche se pose.  Ces journaux sont recherch√©s √† l'aide de grep.  Sur certains services, grep peut atteindre des heures.  Si vous rencontrez des probl√®mes de production, vous ne rechercherez pas vos journaux pendant des heures.  Pour r√©soudre le probl√®me, Yandex a d√©cid√© d'√©crire son propre v√©lo de livraison de journaux pour la recherche.  Ce qui en est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">ressorti</a> , le dira <b>Alexei Danilov</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">danevge</a> ) - le d√©veloppeur de l'√©quipe d'infrastructure de Yandex.Verticals.  D√©veloppe, √©crit et prend en charge les projets auto.ru et Yandex.Real Estate. <br><br>  <i>Clause de non-responsabilit√©.</i>  <i>L'article parle de d√©veloppement moderne et convient √† l'architecture de microservices.</i>  <i>Divers produits sont pr√©sent√©s ici - ce sont des outils utilis√©s dans Yandex.Verticals.</i>  <i>Dans d'autres conditions, les analogues sont possibles avec plus de succ√®s, mais ils remplissent presque les m√™mes fonctions.</i> <a name="habracut"></a><br><blockquote>  Remarque  L'article est une version √©tendue du rapport d'Alexey Danilov ¬´Les journaux ne sont pas n√©cessaires¬ª √† RIT ++ 2019 DevOps Conf, qui est stylistiquement modifi√© et compl√©t√© par de nouveaux √©l√©ments.  Vous pouvez trouver l'enregistrement vid√©o du discours d'Alexey <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur le lien</a> sur notre cha√Æne YouTube. </blockquote><br>  L'√©quipe Yandex.Vertical compte 300 personnes, dont une centaine de d√©veloppeurs.  En d√©veloppement, nous ne sommes pas diff√©rents de la plupart des entreprises qui cr√©ent leurs propres solutions de produits.  Microservices, tout le monde vit √† Docker, un monolithe en PHP recueille la poussi√®re dans un coin sombre, d√©ploy√© via Hashicorp Nomad et nous gardons un zoo de langages: Scala, Java, Go, Node.js, Python. <br><br>  L'un des gros probl√®mes d'infrastructure dans Yandex.Verticals est le journal des applications.  Lorsque nous avons s√©rieusement abord√© ce probl√®me, nous avons utilis√© la troisi√®me version de leur collecte et de leur traitement.  Simplifi√©, cela a fonctionn√© comme ceci: <br><br><ul><li>  applications √©crites dans des fichiers; <br></li><li>  Fluent Bit a lu des fichiers et les a envoy√©s ligne par ligne dans le fichier Kafka; <br></li><li>  Sur une machine √† repasser d√©di√©e, il y avait une application qui lisait le sujet Kafka et √©crivait dans des fichiers sur le disque. <br></li></ul><br>  Pendant la saison chaude, nous avions 18 To de journaux par jour, soit 250 000 lignes par seconde.  C'est une tr√®s grande quantit√©, ce qui complique le travail avec ces donn√©es.  La seule fa√ßon d'analyser cela est grep, car tout est stock√© dans des fichiers.  Pour les grandes applications, l'analyse peut prendre des heures.  Pour les probl√®mes de production, vous n'avez pas ce temps. <br><br>  Les solutions toutes faites ne correspondaient pas au prix, aux ressources ou √† la vitesse.  Ils ne pouvaient pas g√©rer de mani√®re acceptable notre flux.  Il est m√™me difficile de compter le nombre de tentatives de cuisson d'Elasticsearch.  Je suppose que nous ne savons pas comment le faire cuire.  Mais ce n'est pas ce dont nous avons besoin, si pour l'utiliser comme r√©f√©rentiel de journaux, des capacit√©s (comp√©tences) sp√©ciales sont requises. <br><br>  Dans cette situation, nous avons d√©cid√© de mettre en place notre propre syst√®me de collecte et d'analyse des journaux. <br><br><h2>  V√©lo </h2><br><img src="https://habrastorage.org/webt/aw/49/s9/aw49s9cfjgf28z2eqyofr3cx7ea.jpeg"><br><br>  <i>Remarque: Si le prochain v√©lo n'est pas int√©ressant, passez imm√©diatement √† la section "Typification".</i> <br><br><h3>  Format </h3><br>  Nous utilisons plusieurs PL et aimons les microservices.  Pour travailler avec les journaux, nous avons uniform√©ment form√© notre propre format JSON.  Il couvre la plupart des besoins de travaux suppl√©mentaires avec les journaux. <br><br><img src="https://habrastorage.org/webt/z8/8q/g5/z88qg5gh3s5ntz9n91q5opbk0ku.png"><br>  <i>Un exemple de journaux avec tous les champs possibles.</i> <br><br><h2>  Pilote de journal Docker </h2><br>  Pour collecter les journaux, nous avons √©crit notre propre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pilote de journal Docker</a> - une application sur Go.  Il est assembl√© d'une mani√®re sp√©ciale, livr√© par les commandes du plugin docker, stock√© dans le registre et s'ex√©cute dans une seule instance ex√©cutant Docker. <br><br>  √âtant donn√© que tout probl√®me avec le pilote de journal peut affecter n√©gativement tout le travail, nous avons essay√© d'√©crire une impl√©mentation minimale.  Notre chauffeur √©coute la sortie standard du conteneur et transmet imm√©diatement les journaux √† l'application qui se trouve √† proximit√©.  Il traite d√©j√† de la partie la plus complexe de la livraison. <br><br><h3>  Les probl√®mes </h3><br>  Je mentionnerai s√©par√©ment les probl√®mes de mise √† jour de la version du pilote de journal docker. <br><br><img src="https://habrastorage.org/webt/a6/sy/md/a6symdnuvy0z5kekvjv924yth-i.png"><br>  <i>Capture d'√©cran du Grafana interne.</i> <br><br>  √Ä gauche, le rapport entre les versions install√©es et les machines.  Maintenant, trois versions sont install√©es sur tout le mat√©riel - aucune voiture n'est perdue nulle part et il n'y a aucune installation inutile.  √Ä droite, le nombre de conteneurs qui utilisent telle ou telle version. <br><br>  Le pilote docker ne peut pas aller mettre √† jour imm√©diatement.  Pour ce faire, vous devrez red√©marrer tous les conteneurs et tous les services, ce qui pourrait entra√Æner des probl√®mes.  Par cons√©quent, pour installer la nouvelle version, nous attendons simplement que tous les conteneurs se mettent √† jour. <br><br><h2>  Sch√©ma g√©n√©ral </h2><br>  Consid√©rez le sch√©ma g√©n√©ral d'un nouveau syst√®me de collecte et de livraison des journaux.  D'autres d√©tails ne sont pas si int√©ressants. <br><br><img src="https://habrastorage.org/webt/nm/lx/pq/nmlxpqlg41ntzuar5imu8pw3-km.jpeg"><br><br>  Les applications √©crivent des journaux au format JSON dans stdout.  Docker √©coute le tuyau depuis le conteneur et le redirige vers le pilote Docker.  Le pilote Docker lit et refond de mani√®re asynchrone tout dans Pusher. <br><br>  Pusher se tient sur chaque voiture en fer.  Il pr√©pare, sature, retourne et pousse les journaux dans Yandex Message Queue.  Le flux de journaux de MQ est analys√© par trois types de travailleurs et √©crit dans les r√©f√©rentiels. <br><br>  Il existe trois r√©f√©rentiels pour l'enregistrement des journaux. <br><br><ul><li>  <b>Yandex mapReduce</b> pour stocker et analyser les journaux sur une longue p√©riode de temps.  Ceci est un analogue de Hadoop. <br></li><li>  <b>Cliquez</b> sur <b>Maison</b> pour stocker les journaux le dernier jour. <br></li><li>  <b>Humio</b> (√† titre exp√©rimental) pour stocker les journaux du dernier jour. <br></li></ul><br><h3>  B√©n√©fice </h3><br>  Le format g√©n√©ral vous permet d'√©crire et de traiter les journaux de la m√™me mani√®re.  La collecte des journaux est automatique, sans utiliser de disque, et la livraison se fait en quelques secondes.  Recherche de cl√© de 2 secondes √† 5 secondes.  Stockage et r√©cup√©ration sur une longue p√©riode. <br><br>  Pour les volumes plus petits, envisagez des alternatives: Humio, Splunk et Elastic.  Les deux derniers ont des pilotes Docker officiels.  Si vous vivez dans AWS, c'est Amazon CloudWatch. <br><br><h3>  Amazon cloudwatch </h3><br>  Amazon CloudWatch g√®re les m√©triques, les √©v√©nements et les journaux.  Il ne recherche pas ce dernier, ne donne pas d'√©l√©ments de super-recherche et ne les traite pas sous la forme habituelle.  Amazon CloudWatch traite les journaux, les analyses, les filtres et les affichages sur les graphiques. <br><br><img src="https://habrastorage.org/webt/xc/le/o2/xcleo2if8o1ezw7hob29olfzcta.png"><br>  <i>Amazon CloudWatch convertit les journaux en m√©triques et graphiques.</i> <br><br><h2>  Que faire des journaux? </h2><br>  Revenons √† notre v√©lo - satisfait-il tous les cas?  Non, notre solution vous permet de retrouver les logs, mais ils n√©cessitent une h√©t√©rog√©n√©it√© beaucoup plus grande des informations et de leurs types.  Les journaux sont utilis√©s dans beaucoup plus de cas. <br><br>  D√®s que vous collectez les journaux, la phrase suivante sera: "Analysons quelque chose, le traitons d'une mani√®re ou d'une autre, l'√©crivons quelque part et commen√ßons √† l'afficher sur des graphiques, sur des tableaux de bord."  C'est le chemin de l'enfer.  Surtout si nous parlons d'outils communs. <br><br><blockquote>  Si vous imaginez les journaux comme un certain chaos ou journal d'√©v√©nements de toutes les donn√©es, ils ne fonctionneront pas. </blockquote><br>  Ce sera un gros g√¢chis d'informations qui ne peuvent pas √™tre trait√©es.  Un jeu va commencer dans la formalisation des logs: "√âcrivons ces lignes dans un format sp√©cial pour qu'il soit plus pratique de les analyser plus tard!"  √áa ne marche pas non plus.  Croyez-nous, nous avons essay√©. <br><br><h2>  Dactylographie </h2><br>  Si vous divisez les journaux en types et les traitez s√©par√©ment, vous pouvez trouver des outils qui faciliteront leur utilisation.  Ne fonctionnant plus comme avec les journaux, mais comme avec les donn√©es utiles - un tel travail est plus transparent et plus pratique.  Certains types de journaux peuvent √™tre supprim√©s. <br><br><h3>  Juste au cas o√π </h3><br>  Ce type de journaux ¬´√† √™tre¬ª est mon pr√©f√©r√©.  S'il est impossible de dire clairement pourquoi telle ou telle ligne est n√©cessaire, alors ils le sont.  Ce type peut √©galement √™tre appel√© "journaux au cas o√π". <br><br><pre><code class="plaintext hljs">// validate customer func Validate(customer Customer) { // ??? log.debug(‚ÄúValidate customer %v‚Äù, customer) ‚Ä¶ log.Error(‚ÄúCustomer not valid %v. Reason: %s‚Äù, ...) ‚Ä¶. }</code> </pre> <br><blockquote>  Les journaux ne sont pas des commentaires qui peuvent √™tre supprim√©s.  Cela fait partie du code qui est plus difficile √† modifier, √† maintenir et encore plus √† supprimer. </blockquote><br>  Dans le meilleur des cas, un tel journal peut se transformer en d√©bogage ou en trace.  Ce type <b>encombre le code</b> .  En raison de la journalisation irr√©fl√©chie, je peux y r√©cup√©rer des donn√©es personnelles, des mots de passe et des cookies d'utilisateurs. <br><br>  La bonne fa√ßon est de les <b>jeter et de les oublier</b> .  Mais alors nous sommes confront√©s √† un nouveau probl√®me.  Comment analyser la situation avec une erreur? <br><br><h3>  Erreur fatale / critique </h3><br>  Pour commencer, nous ne consid√©rons que les erreurs critiques.  Ce sont des erreurs dues aux utilisateurs et aux d√©veloppeurs.  Le premier - quand ils ne peuvent pas terminer l'op√©ration.  La seconde - lorsque vous devez effectuer des corrections √† la main. <br><br>  Pourquoi les b√ªches ne correspondent pas? <br><br>  <b>Pas de r√©ponse rapide</b> .  Si l'√©quipe de d√©veloppement apprend l'erreur des utilisateurs via l'assistance ou via Twitter, il est temps de changer quelque chose. <br><br>  <b>Il n'y a pas de contexte</b> .  Une ligne distincte du journal des erreurs est inutile.  Nous devons collecter le contexte petit √† petit.  N√©anmoins, cela peut ne pas √™tre suffisant, car c'est le contexte du processus, pas l'erreur. <br><br>  <b>Il n'y a pas de grande image</b> .  Pas de r√©ponse aux questions: <br><br><ul><li>  combien de fois une telle erreur se produit; <br></li><li>  il s'est produit sur les r√©pliques restantes du service; <br></li><li>  c'√©tait avant? <br></li></ul><br>  Pour r√©soudre ces probl√®mes, utilisez un outil appropri√©, par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sentry.io</a> .  Il vous permet de travailler avec des informations d'erreurs repr√©sentatives et compl√®tes (contextuelles) avec une <code>alerting rule</code> personnalisable.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le site Web</a> sentry d√©crit les diff√©rences dans les journaux par rapport √† l'utilisation de sentry.io. <br><br><h3>  Erreur non critique </h3><br>  Nous avons jet√© des erreurs fatales et critiques et maintenant elles sont √©crites dans Sentry.  Mais il y avait des erreurs internes - diverses biblioth√®ques ou des r√©ponses de services tiers. <br><br>  Un bon exemple est une nouvelle tentative r√©ussie.  Supposons que le service A se soit tourn√© vers le service B mais, en raison de probl√®mes de r√©seau, n'a pas pu obtenir de r√©ponse.  Apr√®s l'erreur, le service A s'est √† nouveau tourn√© vers le service B et a re√ßu une r√©ponse valide.  L'erreur au premier appel est-elle critique?  Non.  Dans ce cas, le processus s'est termin√© avec succ√®s et l'utilisateur a pu utiliser le service. <br><br>  Si de telles erreurs ne sont pas critiques pour que le service fonctionne et qu'elles n'affectent pas l'utilisateur avec une r√©p√©tition rare, alors ce ne sont pas du tout des erreurs.  Il s'agit d'une d√©gradation du service, bien que la r√©ponse de l'utilisateur soit arriv√©e 50 ms plus tard.  Ce type de journal fait r√©f√©rence aux avertissements - Avertissement. <br><br><h3>  Avertissement </h3><br><blockquote>  Les alertes sont des informations sur la d√©gradation d'un service. </blockquote><br>  Nous verrons ici les m√™mes probl√®mes inh√©rents aux erreurs critiques, mais avec une r√©serve.  La r√©action √† un √©v√©nement individuel n'est pas importante - leur quantit√© dans le temps est importante. <br><br>  Prenons un exemple o√π un service ne peut pas r√©cup√©rer une entr√©e de cache et acc√®de au stockage √† froid.  Si cela se produit une fois par minute, cela peut √™tre pris pour le fonctionnement normal du service.  <b>Les √©missions rares ne sont pas importantes</b> . <br><br>  Mais en m√™me temps, vous avez besoin d'un outil pour visualiser la situation dans son ensemble, vous avez besoin d' <b>une analyse en temps r√©el</b> .  Pour suivre les changements sur une longue p√©riode, il serait bien d'avoir √©galement une <b>analyse r√©trospective</b> .  Une d√©gradation au-dessus d'un certain niveau (seuils) peut nuire aux utilisateurs - vous avez besoin d'une <b>r√©action avec une d√©gradation s√©v√®re</b> . <br><br><blockquote>  Nous n'avons pas besoin des journaux marqu√©s Avertissement, mais des mesures de d√©gradation. </blockquote><br>  L'outil de collecte m√©trique le plus populaire est Prometheus, et vous pouvez utiliser Grafana pour la visualisation.  Si vous avez besoin d'un contexte large (identique √† l'erreur), la m√™me Sentry fera l'affaire, mais avec des alertes d√©sactiv√©es.  Cependant, dans la plupart des cas, le contexte sera suffisant.  Il sera utilis√© pour les graphiques - √©tiquettes Prometheus. <br><br>  Exemples. <br><div class="scrollable-table"><table><tbody><tr><td>  √©tiquette <br></td><td>  exemple 1 <br></td><td>  exemple 2 <br></td><td>  exemple 3 <br></td></tr><tr><td>  contexte <br></td><td>  db <br></td><td>  service_interne <br></td><td>  cache <br></td></tr><tr><td>  module <br></td><td>  user_service <br></td><td>  user_service <br></td><td>  user_service <br></td></tr><tr><td>  raison <br></td><td>  long_query <br></td><td>  r√©essayer <br></td><td>  miss_cache <br></td></tr><tr><td>  autre <br></td><td>  get_user <br></td><td>  service_b <br></td><td>  user_permisson <br></td></tr></tbody></table></div><br>  Trois √©v√©nements se sont produits dans le service utilisateur conditionnel.  Ils affectent le fonctionnement du service: une longue requ√™te √† la base de donn√©es, un acc√®s r√©p√©t√© √† l'API du service <code>service_b</code> et aucun droit utilisateur n'a √©t√© trouv√© dans le cache.  Les graphiques et les alertes seront configur√©s comme importants pour les d√©veloppeurs du service, gr√¢ce au contexte. <br><br><h3>  Tra√ßage </h3><br>  C'est la premi√®re chose √† commencer si nous choisissons le chemin o√π vous devez analyser les journaux.  En soi, ces informations dans les journaux sont inutiles, car vous devez cr√©er des cha√Ænes d'appels, voir les donn√©es √† l'int√©rieur des demandes, les erreurs dans les cha√Ænes d'appels, les temps de r√©ponse, le nombre de RPS. <br><br>  Il existe d'excellents outils de tra√ßage - Jaeger ou Zipkin.  Je recommande d'utiliser OpenTracing, qu'ils prennent tous les deux en charge. <br><br>  Vous pouvez collecter le tra√ßage √† partir de trois sources. <br><br><ul><li>  Si vous utilisez des <b>√©quilibreurs</b> partag√©s, analysez-en les journaux et envoyez-les √† Jaeger. <br></li><li>  <b>Services eux</b> - <b>m√™mes</b> , s'ils re√ßoivent des adresses via Service Discovery et y vont directement.  Dans ce cas, la trace des services est envoy√©e directement √† Jaeger. <br></li><li>  Maillage de <b>service</b> intelligent.  Il sait comment collecter et envoyer une trace, par exemple Istio. <br></li></ul><br><br><h3>  Information initiale </h3><br>  Ces informations concernent les appels de service API, le lancement de Cron, les requ√™tes de base de donn√©es ou les appels √† d'autres services. <br><br><pre> <code class="plaintext hljs">{ "_message": "Request: ...; request_id: ...,... ", "_level": "INFO", "_time": "2019-03-08T12:04:05.000+07:00", "_context": "ryawvcHandler", "_tread": "785534" }</code> </pre> <br>  Ces informations appartiennent au bloc ¬´Juste au cas o√π¬ª, mais elles sont s√©par√©es car elles sont plus courantes.  Ces informations sont n√©cessaires pour analyser l'erreur et <b>vous pouvez la jeter</b> . <br><br>  Si les informations sur les appels aux m√©thodes internes sont d'une importance cruciale et que vous ne pouvez pas vous en passer, m√™me avec le contexte collect√© en cas d'erreur, il vaut la peine d'instrumenter les appels de m√©thode comme trace. <br><br><h3>  Temps d'ex√©cution </h3><br>  Ces informations concernent le temps d'ex√©cution des m√©thodes, des API, des requ√™tes de base de donn√©es ou d'autres services. <br><br><pre> <code class="plaintext hljs">{ "_message": "Get customer 12ms", "_level": "INFO", "_time": "2019-03-08T12:04:05.000+07:00", "_context": "ryawvcCustomerRepository", "_tread": "785534" }</code> </pre> <br>  Il n'y a aucune valeur dans les journaux, car vous devez analyser ces informations, les afficher sur des graphiques et configurer des seuils.  Ce type de journaux doit √™tre remplac√© par des <b>m√©triques</b> , par exemple, dans Prometheus. <br><br><h3>  Info entreprise </h3><br>  Ces informations sont n√©cessaires pour l'analyse commerciale, l'analyse du comportement des clients et les calculs financiers.  √Ä cet endroit, nous avons historiquement utilis√© l'approche oppos√©e - les journaux analys√©s.  Mais c'est un bon exemple de ce que les journaux d'application peuvent d√©g√©n√©rer si vous travaillez avec eux de cette mani√®re. <br><br>  Pour les journaux contenant des donn√©es commerciales, des accords ont √©t√© conclus avec des champs fixes au format TSKV, qui sont n√©cessaires pour l'analyse.  Les applications ont √©crit des journaux d'entreprise dans un fichier d√©di√©.  Ensuite, les journaux ont √©t√© lus et envoy√©s ligne par ligne √† MQ, et une application distincte les a trait√©s et les a √©crits dans la base de donn√©es.  Ceci est un exemple de ce que toute analyse se transforme. <br><br><blockquote>  Il ne fonctionnera pas pour analyser l'int√©gralit√© du flux de journaux dans l'espoir que les donn√©es convergent. </blockquote><br>  Des conventions, des formats, des r√®gles et des exigences de fiabilit√© font leur apparition.  Cela ressemble d√©j√† un peu aux journaux des applications.  Dans ce cas, le journal devient la file d'attente de livraison de donn√©es avec toutes les exigences qui en d√©coulent pour MQ.  Il est √† noter que le middleware sous forme de journal est ici superflu. <br><br>  Une bonne solution consiste √† envoyer ces donn√©es directement √† MQ.  D√©j√† l√†, ils seront trait√©s, stock√©s dans le stockage appropri√© et utilis√©s par l'√©quipe d'analyse.  Par exemple, pour l'affichage, nous utilisons Tableau. <br><br><h3>  Performances </h3><br>  Ce type de journal est rarement trouv√© dans les journaux des applications et est plus souvent collect√© en tant que m√©trique.  S√©par√©ment, j'ajoute que pour collecter les m√©triques de base sp√©cifiques √† la langue, il suffit d'utiliser la biblioth√®que Prometheus.  Elle collectera par d√©faut tout ce qu'elle atteint.  Le co√ªt de l'ajout de ces mesures est faible. <br><br><img src="https://habrastorage.org/webt/iz/od/jv/izodjvufyysy4-3ihlurtw9rueq.png"><br><br><h3>  R√©sultat de frappe </h3><br>  Apr√®s avoir tri√© les journaux par type, nous pouvons choisir des outils plus puissants pour travailler avec eux.  Il n'y a pas de syst√®mes complexes ou de technologies spatiales comme Amazon, il n'y a rien qui ne puisse pas √™tre soulev√© demain.  Vous avez probablement d√©j√† certains de ces syst√®mes ou analogues: Sentry ramasse de la poussi√®re quelque part, Prom√©th√©e travaille quelque part. <br><br><img src="https://habrastorage.org/webt/69/jj/ik/69jjikx9uuyrghuq-1rpw0bu5o0.png"><br><br><blockquote>  Le probl√®me n'est pas dans la technologie, mais dans un pi√®ge cognitif lorsque nous faisons confiance aux journaux comme moyen de repr√©sentation fiable de l'√©tat de notre syst√®me.  Ce n'est pas le cas, les journaux sont un ensemble d'√©v√©nements chaotiques. </blockquote><br>  Il existe une exception - les journaux de d√©bogage, qui peuvent √™tre utilis√©s dans de rares cas. <br><br><h3>  Journal de d√©bogage </h3><br>  Les journaux de d√©bogage doivent √™tre des informations d√©taill√©es.  Ils ne doivent pas reproduire ce qui est d√©j√† envoy√© aux syst√®mes que nous avons d√©crits ci-dessus.  Ce type existe pour l'analyse des cas sp√©ciaux.  Par exemple, un bogue incompr√©hensible se produit en production et, pour le moment, les mesures ne permettent pas de savoir ce qui se passe. <br><br>  <b>Activez les journaux de d√©bogage √† chaud, sans red√©marrer le service</b> .  Puisque nous parlons de plusieurs services, il n'y en aura pas beaucoup.  Une infrastructure sophistiqu√©e n'est pas n√©cessaire.  Assez de pile ELK sans "pr√©paration" compliqu√©e.  Il est √©galement judicieux d'ajouter une alerte √† Sentry avec tout le contexte n√©cessaire. <br><br>  <b>Les journaux de d√©bogage peuvent √™tre utilis√©s pour le d√©veloppement</b> .  Mais ils sont parfaitement remplac√©s par le d√©bogage. <br><br><h2>  Pour r√©sumer </h2><br>  <b>Nous avons √©crit notre livraison de journal de v√©lo pour la recherche</b> .  Nous n'avons pas satisfait les clients du service - ils viennent tous chez nous pour les analyser, les collecter et les agr√©ger quelque part.  Cela peut √™tre √©vit√© - des syst√®mes complexes de traitement des journaux ne sont pas n√©cessaires. <br><br><blockquote>  Les journaux bruts sont inutiles, mais ils peuvent √™tre transform√©s en mesures utiles. </blockquote><br>  Il suffit de cr√©er une infrastructure pour fournir des m√©triques et des donn√©es utiles autour des services.  En cons√©quence, des m√©triques utiles appara√Ætront qui parleront des services et montreront de mani√®re transparente tout ce qui leur arrive. <br><br><blockquote>  Les erreurs doivent contenir le contexte de l'erreur elle-m√™me. </blockquote><br>  Cela vous aidera √† y faire face et √† le corriger imm√©diatement.  <b>Les erreurs et la d√©gradation doivent conduire √† une action</b> , afin que les d√©veloppeurs <b>soient</b> instantan√©ment inform√©s des probl√®mes et les r√©solvent m√™me avant les demandes des utilisateurs en col√®re. <br><br>  <b>Les bons outils rendront le travail avec vos services plus agr√©able et transparent</b> .  Le d√©bogage a sa place, mais vous devez √™tre strict avec lui. <br><br><blockquote>  √Ä <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HighLoad ++ 2019</a> en novembre, il y aura une section DevOps - 13 rapports sur les charges dans AWS, un syst√®me de surveillance √† Lamoda, des convoyeurs pour la livraison des mod√®les, la vie sans Kubernetes, et bien plus encore.  Voir la liste compl√®te des sujets et r√©sum√©s sur la page s√©par√©e ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Rapports</a> ¬ª.  Et nous nous rencontrerons au DevOpsConf au printemps - inscrivez-vous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√† la newsletter</a> , faites-nous savoir quand nous d√©terminerons les dates et le lieu. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr468535/">https://habr.com/ru/post/fr468535/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr468525/index.html">Jouets en bois, premi√®re partie - 1982-1985</a></li>
<li><a href="../fr468527/index.html">Synth√®se d'un contr√¥leur par la m√©thode du probl√®me de dynamique inverse</a></li>
<li><a href="../fr468529/index.html">Apprivoiser Gorynych ou d√©compiler eBPF dans Ghidra</a></li>
<li><a href="../fr468531/index.html">Le premier bot PHP pour VKontakte</a></li>
<li><a href="../fr468533/index.html">Faire du stop sur DevOps avec Express 42</a></li>
<li><a href="../fr468537/index.html">Bases de DevOps. Entr√©e dans le projet √† partir de z√©ro</a></li>
<li><a href="../fr468543/index.html">Comit√© du programme en semaine FrontendConf. Entretien avec Sergey Popov</a></li>
<li><a href="../fr468545/index.html">"Alice, allons au front!"</a></li>
<li><a href="../fr468547/index.html">Parlant anglais, CSS, grille et accessibilit√© √† FrontendConf</a></li>
<li><a href="../fr468549/index.html">GPU Bound. Comment tout transf√©rer sur la carte vid√©o et un peu plus. Des animations</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>