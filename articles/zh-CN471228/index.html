<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš‚ ğŸ—’ï¸ âœŠğŸ¿ Grokay PyTorch ğŸ‘©ğŸ½â€ğŸš’ ğŸšœ ğŸ¤´ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å“ˆHaï¼ 

 æˆ‘ä»¬å·²ç»é¢„è´­äº†ä¸€æœ¬æœŸå¾…å·²ä¹…çš„æœ‰å…³PyTorchåº“çš„ä¹¦ã€‚ 



 ç”±äºæ‚¨å°†ä»æœ¬ä¹¦ä¸­å­¦ä¹ æœ‰å…³PyTorchçš„æ‰€æœ‰å¿…è¦åŸºæœ¬ææ–™ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬æé†’æ‚¨æƒ³å­¦ä¹ çš„ä¸»é¢˜ç§°ä¸ºâ€œæ‘¸ç´¢â€æˆ–â€œæ·±å…¥ç†è§£â€çš„å¥½å¤„ ã€‚ åœ¨ä»Šå¤©çš„å¸–å­ä¸­ï¼Œæˆ‘ä»¬å°†å‘Šè¯‰æ‚¨Kai Arulkumaranå¦‚ä½•æŠ¨å‡»PyTorchï¼ˆæ— å›¾ç‰‡ï¼‰ã€‚ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Grokay PyTorch</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/471228/">å“ˆHaï¼ <br><br> æˆ‘ä»¬å·²ç»é¢„è´­äº†ä¸€æœ¬æœŸå¾…å·²ä¹…çš„æœ‰å…³<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PyTorchåº“çš„</a>ä¹¦ã€‚ <br><br><img src="https://habrastorage.org/webt/bt/am/vl/btamvlvzqw01qwk-_2mq08t-sh4.jpeg"><br><br> ç”±äºæ‚¨å°†ä»æœ¬ä¹¦ä¸­å­¦ä¹ æœ‰å…³PyTorchçš„æ‰€æœ‰å¿…è¦åŸºæœ¬ææ–™ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬æé†’æ‚¨æƒ³å­¦ä¹ çš„ä¸»é¢˜ç§°ä¸ºâ€œæ‘¸ç´¢â€æˆ–â€œæ·±å…¥ç†è§£â€çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¥½å¤„</a> ã€‚ åœ¨ä»Šå¤©çš„å¸–å­ä¸­ï¼Œæˆ‘ä»¬å°†å‘Šè¯‰æ‚¨Kai Arulkumaranå¦‚ä½•æŠ¨å‡»PyTorchï¼ˆæ— å›¾ç‰‡ï¼‰ã€‚ æ¬¢è¿æ¥åˆ°çŒ«ã€‚ <br><a name="habracut"></a><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PyTorch</a>æ˜¯ä¸€ä¸ªçµæ´»çš„æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œå®ƒä½¿ç”¨åŠ¨æ€ç¥ç»ç½‘ç»œï¼ˆå³ä½¿ç”¨åŠ¨æ€æµæ§åˆ¶çš„ç½‘ç»œï¼Œä¾‹å¦‚<code>if</code>å’Œ<code>while</code>å¾ªç¯ï¼‰è‡ªåŠ¨åŒºåˆ†å¯¹è±¡ã€‚  PyTorchæ”¯æŒGPUåŠ é€Ÿï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ†å¸ƒå¼åŸ¹è®­</a> ï¼Œå„ç§ç±»å‹çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¼˜åŒ–</a>ä»¥åŠè®¸å¤šå…¶ä»–ä¸é”™çš„åŠŸèƒ½ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘å¯¹å¦‚ä½•ä½¿ç”¨PyTorchæå‡ºäº†ä¸€äº›æƒ³æ³•ã€‚ åº“çš„æ‰€æœ‰æ–¹é¢å’Œå»ºè®®çš„å®è·µéƒ½ä¸åœ¨æ­¤å¤„ï¼Œä½†æˆ‘å¸Œæœ›æœ¬æ–‡å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ã€‚ <br><br> ç¥ç»ç½‘ç»œæ˜¯è®¡ç®—å›¾çš„å­ç±»ã€‚ è®¡ç®—å›¾æ¥æ”¶æ•°æ®ä½œä¸ºè¾“å…¥ï¼Œç„¶ååœ¨å¤„ç†å®ƒä»¬çš„èŠ‚ç‚¹ä¸Šå°†è¿™äº›æ•°æ®è·¯ç”±ï¼ˆå¹¶å¯ä»¥è½¬æ¢ï¼‰ã€‚ åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œç¥ç»å…ƒï¼ˆèŠ‚ç‚¹ï¼‰é€šå¸¸é€šè¿‡å‘å…¶åº”ç”¨å‚æ•°å’Œå¯å¾®å‡½æ•°æ¥è½¬æ¢æ•°æ®ï¼Œä»¥ä¾¿å¯ä»¥é€šè¿‡æ¢¯åº¦ä¸‹é™æ³•å¯¹å‚æ•°è¿›è¡Œä¼˜åŒ–ä»¥ä½¿æŸå¤±æœ€å°åŒ–ã€‚ ä»å¹¿ä¹‰ä¸Šè®²ï¼Œæˆ‘æ³¨æ„åˆ°å‡½æ•°å¯ä»¥æ˜¯éšæœºçš„ï¼Œè€Œå›¾å¯ä»¥æ˜¯åŠ¨æ€çš„ã€‚ å› æ­¤ï¼Œè™½ç„¶ç¥ç»ç½‘ç»œéå¸¸é€‚åˆæ•°æ®æµç¼–ç¨‹èŒƒä¾‹ï¼Œä½†PyTorch APIä¸“æ³¨äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‘½ä»¤å¼ç¼–ç¨‹</a>èŒƒä¾‹ï¼Œè¿™ç§è§£é‡Šåˆ›å»ºçš„ç¨‹åºçš„æ–¹å¼æ›´åŠ ç†Ÿæ‚‰ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆPyTorchä»£ç æ›´æ˜“äºé˜…è¯»ï¼Œæ›´å®¹æ˜“åˆ¤æ–­å¤æ‚ç¨‹åºçš„è®¾è®¡çš„åŸå› ï¼Œç„¶è€Œï¼Œè¿™å¹¶ä¸éœ€è¦ä¸¥é‡å½±å“æ€§èƒ½ï¼šå®é™…ä¸Šï¼ŒPyTorchè¶³å¤Ÿå¿«ï¼Œå¹¶ä¸”æä¾›äº†è®¸å¤šä¼˜åŒ–ï¼Œä½œä¸ºæœ€ç»ˆç”¨æˆ·ï¼Œæ‚¨å®Œå…¨ä¸å¿…æ‹…å¿ƒï¼ˆä½†æ˜¯ï¼Œå¦‚æœæ‚¨çœŸçš„å¯¹å®ƒä»¬æ„Ÿå…´è¶£ï¼Œåˆ™å¯ä»¥æ›´æ·±å…¥åœ°äº†è§£å®ƒä»¬ï¼‰ã€‚ <br><br> æœ¬æ–‡çš„å…¶ä½™éƒ¨åˆ†æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯¹MNISTæ•°æ®é›†ä¸Šå®˜æ–¹ç¤ºä¾‹</a>çš„åˆ†æã€‚ åœ¨è¿™é‡Œæˆ‘ä»¬<i>ç©</i> PyTorchï¼Œå› æ­¤ï¼Œæˆ‘å»ºè®®æ‚¨ä»…åœ¨ç†Ÿæ‚‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­£å¼çš„åˆå­¦è€…æ‰‹å†Œ</a>åæ‰äº†è§£æœ¬æ–‡ã€‚ ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œè¯¥ä»£ç ä»¥å¸¦æœ‰æ³¨é‡Šçš„å°ç‰‡æ®µçš„å½¢å¼å‘ˆç°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ²¡æœ‰åˆ†å‘åˆ°æ‚¨ä¹ æƒ¯äºåœ¨çº¯æ¨¡å—åŒ–ä»£ç ä¸­çœ‹åˆ°çš„å•ç‹¬çš„å‡½æ•°/æ–‡ä»¶ä¸­ã€‚ <br><br><h4> è¿›å£è´§ </h4><br><pre> <code class="plaintext hljs">import argparse import os import torch from torch import nn, optim from torch.nn import functional as F from torch.utils.data import DataLoader from torchvision import datasets, transforms</code> </pre> <br> é™¤<code>torchvision</code>æ¨¡å—å¤–ï¼Œæ‰€æœ‰è¿™äº›éƒ½æ˜¯éå¸¸æ ‡å‡†çš„å¯¼å…¥ï¼Œç‰¹åˆ«æ˜¯åœ¨è§£å†³ä¸è®¡ç®—æœºè§†è§‰æœ‰å…³çš„ä»»åŠ¡æ—¶ï¼Œ <code>torchvision</code>æ¨¡å—é™¤å¤–ã€‚ <br><br><h4> å®¢åˆ¶åŒ– </h4><br><pre> <code class="python hljs">parser = argparse.ArgumentParser(description=<span class="hljs-string"><span class="hljs-string">'PyTorch MNIST Example'</span></span>) parser.add_argument(<span class="hljs-string"><span class="hljs-string">'--batch-size'</span></span>, type=int, default=<span class="hljs-number"><span class="hljs-number">64</span></span>, metavar=<span class="hljs-string"><span class="hljs-string">'N'</span></span>, help=<span class="hljs-string"><span class="hljs-string">'input batch size for training (default: 64)'</span></span>) parser.add_argument(<span class="hljs-string"><span class="hljs-string">'--epochs'</span></span>, type=int, default=<span class="hljs-number"><span class="hljs-number">10</span></span>, metavar=<span class="hljs-string"><span class="hljs-string">'N'</span></span>, help=<span class="hljs-string"><span class="hljs-string">'number of epochs to train (default: 10)'</span></span>) parser.add_argument(<span class="hljs-string"><span class="hljs-string">'--lr'</span></span>, type=float, default=<span class="hljs-number"><span class="hljs-number">0.01</span></span>, metavar=<span class="hljs-string"><span class="hljs-string">'LR'</span></span>, help=<span class="hljs-string"><span class="hljs-string">'learning rate (default: 0.01)'</span></span>) parser.add_argument(<span class="hljs-string"><span class="hljs-string">'--momentum'</span></span>, type=float, default=<span class="hljs-number"><span class="hljs-number">0.5</span></span>, metavar=<span class="hljs-string"><span class="hljs-string">'M'</span></span>, help=<span class="hljs-string"><span class="hljs-string">'SGD momentum (default: 0.5)'</span></span>) parser.add_argument(<span class="hljs-string"><span class="hljs-string">'--no-cuda'</span></span>, action=<span class="hljs-string"><span class="hljs-string">'store_true'</span></span>, default=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, help=<span class="hljs-string"><span class="hljs-string">'disables CUDA training'</span></span>) parser.add_argument(<span class="hljs-string"><span class="hljs-string">'--seed'</span></span>, type=int, default=<span class="hljs-number"><span class="hljs-number">1</span></span>, metavar=<span class="hljs-string"><span class="hljs-string">'S'</span></span>, help=<span class="hljs-string"><span class="hljs-string">'random seed (default: 1)'</span></span>) parser.add_argument(<span class="hljs-string"><span class="hljs-string">'--save-interval'</span></span>, type=int, default=<span class="hljs-number"><span class="hljs-number">10</span></span>, metavar=<span class="hljs-string"><span class="hljs-string">'N'</span></span>, help=<span class="hljs-string"><span class="hljs-string">'how many batches to wait before checkpointing'</span></span>) parser.add_argument(<span class="hljs-string"><span class="hljs-string">'--resume'</span></span>, action=<span class="hljs-string"><span class="hljs-string">'store_true'</span></span>, default=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, help=<span class="hljs-string"><span class="hljs-string">'resume training from checkpoint'</span></span>) args = parser.parse_args() use_cuda = torch.cuda.is_available() <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> args.no_cuda device = torch.device(<span class="hljs-string"><span class="hljs-string">'cuda'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> use_cuda <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">'cpu'</span></span>) torch.manual_seed(args.seed) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> use_cuda: torch.cuda.manual_seed(args.seed)</code> </pre> <br>  <code>argparse</code>æ˜¯åœ¨Pythonä¸­å¤„ç†å‘½ä»¤è¡Œå‚æ•°çš„æ ‡å‡†æ–¹æ³•ã€‚ <br><br> å¦‚æœæ‚¨éœ€è¦ç¼–å†™æ—¨åœ¨åœ¨ä¸åŒè®¾å¤‡ä¸Šå·¥ä½œçš„ä»£ç ï¼ˆä½¿ç”¨GPUåŠ é€Ÿï¼Œå¦‚æœå¯ç”¨ï¼Œä½†å¦‚æœæ²¡æœ‰å›æ»šåˆ°CPUä¸Šçš„è®¡ç®—ï¼‰ï¼Œåˆ™é€‰æ‹©å¹¶ä¿å­˜é€‚å½“çš„<code>torch.device</code> ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥æ–‡ä»¶ç¡®å®šåº”è¯¥åœ¨å“ªé‡Œå¼ é‡è¢«å­˜å‚¨ã€‚ æœ‰å…³åˆ›å»ºæ­¤ç±»ä»£ç çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹æ–‡æ¡£</a> ã€‚  PyTorchçš„æ–¹æ³•æ˜¯å°†è®¾å¤‡çš„é€‰æ‹©å¸¦ç»™ç”¨æˆ·æ§åˆ¶ï¼Œè¿™åœ¨ç®€å•çš„ç¤ºä¾‹ä¸­ä¼¼ä¹æ˜¯ä¸å¯å–çš„ã€‚ ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•æå¤§åœ°ç®€åŒ–äº†å¿…é¡»å¤„ç†å¼ é‡çš„å·¥ä½œï¼Œå…¶ä¸­aï¼‰è°ƒè¯•æ–¹ä¾¿bï¼‰å…è®¸æ‚¨æœ‰æ•ˆåœ°æ‰‹åŠ¨ä½¿ç”¨è®¾å¤‡ã€‚ <br><br> ä¸ºäº†æé«˜å®éªŒçš„å¯é‡å¤æ€§ï¼Œæ‚¨éœ€è¦ä¸ºæ‰€æœ‰ä½¿ç”¨éšæœºæ•°ç”Ÿæˆçš„ç»„ä»¶ï¼ˆåŒ…æ‹¬<code>random</code>æˆ–<code>numpy</code> ï¼Œå¦‚æœä¹Ÿä½¿ç”¨ï¼‰è®¾ç½®éšæœºåˆå§‹å€¼ã€‚ è¯·æ³¨æ„ï¼šcuDNNä½¿ç”¨éç¡®å®šæ€§ç®—æ³•ï¼Œå¹¶ä¸”å¯ä»¥é€‰æ‹©ä½¿ç”¨<code>torch.backends.cudnn.enabled = False</code>ç¦ç”¨ã€‚ <br><br><h4> èµ„æ–™ </h4><br><pre> <code class="python hljs">data_path = os.path.join(os.path.expanduser(<span class="hljs-string"><span class="hljs-string">'~'</span></span>), <span class="hljs-string"><span class="hljs-string">'.torch'</span></span>, <span class="hljs-string"><span class="hljs-string">'datasets'</span></span>, <span class="hljs-string"><span class="hljs-string">'mnist'</span></span>) train_data = datasets.MNIST(data_path, train=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, download=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, transform=transforms.Compose([ transforms.ToTensor(), transforms.Normalize((<span class="hljs-number"><span class="hljs-number">0.1307</span></span>,), (<span class="hljs-number"><span class="hljs-number">0.3081</span></span>,))])) test_data = datasets.MNIST(data_path, train=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, transform=transforms.Compose([ transforms.ToTensor(), transforms.Normalize((<span class="hljs-number"><span class="hljs-number">0.1307</span></span>,), (<span class="hljs-number"><span class="hljs-number">0.3081</span></span>,))])) train_loader = DataLoader(train_data, batch_size=args.batch_size, shuffle=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, num_workers=<span class="hljs-number"><span class="hljs-number">4</span></span>, pin_memory=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) test_loader = DataLoader(test_data, batch_size=args.batch_size, num_workers=<span class="hljs-number"><span class="hljs-number">4</span></span>, pin_memory=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><br> ç”±äº<code>torchvision</code>æ¨¡å‹å­˜å‚¨åœ¨<code>~/.torch/models/</code> ï¼Œå› æ­¤æˆ‘æ›´å–œæ¬¢å°†torchvision <code>torchvision</code>å­˜å‚¨åœ¨<code>~/.torch/datasets</code> ã€‚ è¿™æ˜¯æˆ‘çš„ç‰ˆæƒåè®®ï¼Œä½†æ˜¯åœ¨åŸºäºMNISTï¼ŒCIFAR-10ç­‰å¼€å‘çš„é¡¹ç›®ä¸­ä½¿ç”¨éå¸¸æ–¹ä¾¿ã€‚ é€šå¸¸ï¼Œå¦‚æœè¦é‡å¤ä½¿ç”¨å¤šä¸ªæ•°æ®é›†ï¼Œåˆ™åº”å°†æ•°æ®é›†ä¸ä»£ç åˆ†å¼€å­˜å‚¨ã€‚ <br><br>  <code>torchvision.transforms</code>åŒ…å«è®¸å¤šæ–¹ä¾¿çš„ç”¨äºå•ä¸ªå›¾åƒçš„è½¬æ¢é€‰é¡¹ï¼Œä¾‹å¦‚è£å‰ªå’Œå½’ä¸€åŒ–ã€‚ <br><br>  <code>batch_size</code>æœ‰å¾ˆå¤šé€‰é¡¹ï¼Œä½†æ˜¯é™¤äº†<code>batch_size</code>å’Œ<code>shuffle</code>ä¹‹å¤–ï¼Œæ‚¨è¿˜åº”è¯¥è®°ä½<code>num_workers</code>å’Œ<code>pin_memory</code> ï¼Œå®ƒä»¬æœ‰åŠ©äºæé«˜æ•ˆç‡ã€‚  <code>num_workers &gt; 0</code>ä½¿ç”¨å­è¿›ç¨‹è¿›è¡Œå¼‚æ­¥æ•°æ®åŠ è½½ï¼Œå¹¶ä¸”ä¸ä¼šä¸ºæ­¤é˜»å¡ä¸»è¿›ç¨‹ã€‚ ä¸€ä¸ªå…¸å‹çš„ç”¨ä¾‹æ˜¯ä»ç£ç›˜åŠ è½½æ•°æ®ï¼ˆä¾‹å¦‚å›¾åƒï¼‰ï¼Œå¹¶å¯èƒ½å¯¹å…¶è¿›è¡Œè½¬æ¢ã€‚ æ‰€æœ‰è¿™äº›ä»¥åŠç½‘ç»œæ•°æ®å¤„ç†å¯ä»¥å¹¶è¡Œå®Œæˆã€‚ å¯èƒ½éœ€è¦è°ƒæ•´å¤„ç†ç¨‹åº¦ï¼Œä»¥ä¾¿aï¼‰æœ€å°åŒ–å·¥ä½œäººå‘˜çš„æ•°é‡ï¼Œå¹¶å› æ­¤å‡å°‘æ‰€ä½¿ç”¨çš„CPUå’ŒRAMçš„æ•°é‡ï¼ˆæ¯ä¸ªå·¥ä½œäººå‘˜åŠ è½½ä¸€ä¸ªå•ç‹¬çš„æ‰¹æ¬¡ï¼Œè€Œä¸æ˜¯æ‰¹æ¬¡ä¸­åŒ…å«çš„å•ä¸ªæ ·æœ¬ï¼‰bï¼‰æœ€å°åŒ–æ•°æ®åœ¨ç½‘ç»œä¸Šç­‰å¾…çš„æ—¶é—´é•¿åº¦ã€‚  <code>pin_memory</code>ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å›ºå®šçš„å†…å­˜</a> ï¼ˆè€Œä¸æ˜¯åˆ†é¡µçš„ï¼‰æ¥åŠ é€Ÿä»RAMåˆ°GPUçš„ä»»ä½•æ•°æ®ä¼ è¾“æ“ä½œï¼ˆå¯¹CPUç‰¹å®šçš„ä»£ç ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼‰ã€‚ <br><br><h4> å‹å· </h4><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Net</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(nn.Module)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super(Net, self).__init__() self.conv1 = nn.Conv2d(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, kernel_size=<span class="hljs-number"><span class="hljs-number">5</span></span>) self.conv2 = nn.Conv2d(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, kernel_size=<span class="hljs-number"><span class="hljs-number">5</span></span>) self.conv2_drop = nn.Dropout2d() self.fc1 = nn.Linear(<span class="hljs-number"><span class="hljs-number">320</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>) self.fc2 = nn.Linear(<span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forward</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x)</span></span></span><span class="hljs-function">:</span></span> x = F.relu(F.max_pool2d(self.conv1(x), <span class="hljs-number"><span class="hljs-number">2</span></span>)) x = F.relu(F.max_pool2d(self.conv2_drop(self.conv2(x)), <span class="hljs-number"><span class="hljs-number">2</span></span>)) x = x.view(<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">320</span></span>) x = F.relu(self.fc1(x)) x = self.fc2(x) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> F.log_softmax(x, dim=<span class="hljs-number"><span class="hljs-number">1</span></span>) model = Net().to(device) optimiser = optim.SGD(model.parameters(), lr=args.lr, momentum=args.momentum) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> args.resume: model.load_state_dict(torch.load(<span class="hljs-string"><span class="hljs-string">'model.pth'</span></span>)) optimiser.load_state_dict(torch.load(<span class="hljs-string"><span class="hljs-string">'optimiser.pth'</span></span>))</code> </pre> <br> ç½‘ç»œåˆå§‹åŒ–é€šå¸¸æ‰©å±•åˆ°æˆå‘˜å˜é‡ï¼ŒåŒ…å«å­¦ä¹ å‚æ•°ä»¥åŠå¯èƒ½åŒ…å«å•ä¸ªå­¦ä¹ å‚æ•°å’Œæœªç»è®­ç»ƒçš„ç¼“å†²åŒºçš„å±‚ã€‚ ç„¶åï¼Œé€šè¿‡ç›´æ¥ä¼ é€’ï¼Œå°†å®ƒä»¬ä¸<code>F</code>ä¸­çš„çº¯å‡½æ•°ä¸”ä¸åŒ…å«å‚æ•°çš„å‡½æ•°ç»“åˆä½¿ç”¨ã€‚ æœ‰äº›äººå–œæ¬¢ä½¿ç”¨çº¯åŠŸèƒ½ç½‘ç»œï¼ˆä¾‹å¦‚ä¿ç•™å‚æ•°å¹¶ä½¿ç”¨<code>F.conv2d</code>è€Œä¸æ˜¯<code>nn.Conv2d</code> ï¼‰æˆ–å®Œå…¨ç”±å±‚ç»„æˆçš„ç½‘ç»œï¼ˆä¾‹å¦‚<code>nn.ReLU</code>è€Œä¸æ˜¯<code>F.relu</code> ï¼‰ã€‚ <br><br> å¦‚æœå°†<code>device</code>è®¾ç½®ä¸ºGPUï¼Œ <code>.to(device)</code>æ˜¯ä¸€ç§å°†è®¾å¤‡å‚æ•°ï¼ˆå’Œç¼“å†²åŒºï¼‰å‘é€åˆ°GPUçš„ä¾¿æ·æ–¹æ³•ï¼Œå› ä¸ºå¦åˆ™ï¼ˆå¦‚æœå°†è®¾å¤‡è®¾ç½®ä¸ºCPUï¼‰åˆ™ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œã€‚ åœ¨å°†è®¾å¤‡å‚æ•°ä¼ é€’ç»™ä¼˜åŒ–å™¨ä¹‹å‰ï¼Œå°†å…¶ä¼ é€’åˆ°é€‚å½“çš„è®¾å¤‡å¾ˆé‡è¦ï¼› å¦åˆ™ï¼Œä¼˜åŒ–å™¨å°†æ— æ³•æ­£ç¡®è·Ÿè¸ªå‚æ•°ï¼ <br><br> ç¥ç»ç½‘ç»œï¼ˆ <code>nn.Module</code> ï¼‰å’Œä¼˜åŒ–å™¨ï¼ˆ <code>optim.Optimizer</code> ï¼‰å‡å¯ä¿å­˜å’ŒåŠ è½½å…¶å†…éƒ¨çŠ¶æ€ï¼Œå»ºè®®ä½¿ç”¨<code>.load_state_dict(state_dict)</code>è¿›è¡Œæ­¤<code>.load_state_dict(state_dict)</code> -å¿…é¡»é‡æ–°åŠ è½½ä¸¤è€…çš„çŠ¶æ€ï¼Œä»¥ä¾¿åŸºäºå…ˆå‰ä¿å­˜çš„å­—å…¸æ¥æ¢å¤è®­ç»ƒçŠ¶æ€ã€‚ ä¿å­˜æ•´ä¸ªå¯¹è±¡å¯èƒ½ä¼š<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å……æ»¡é”™è¯¯</a> ã€‚ å¦‚æœå°†å¼ é‡ä¿å­˜åœ¨GPUä¸Šå¹¶æƒ³å°†å®ƒä»¬åŠ è½½åˆ°CPUæˆ–å¦ä¸€ä¸ªGPUä¸Šï¼Œé‚£ä¹ˆæœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨<code>map_location</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é€‰é¡¹</a>å°†å®ƒä»¬ç›´æ¥åŠ è½½åˆ°CPUä¸Šï¼Œä¾‹å¦‚<code>torch.load('model.pth'</code> ï¼Œ <code>map_location='cpu'</code> ï¼‰ã€‚ <br><br> è¿™é‡Œæœ‰ä¸€äº›å…¶ä»–åœ°æ–¹æœªåœ¨æ­¤å¤„æ˜¾ç¤ºï¼Œä½†å€¼å¾—ä¸€æï¼Œæ‚¨å¯ä»¥ç›´æ¥ä½¿ç”¨æ§åˆ¶æµï¼ˆä¾‹å¦‚ï¼Œ <code>if</code>çš„æ‰§è¡Œå¯èƒ½å–å†³äºæˆå‘˜å˜é‡æˆ–æ•°æ®æœ¬èº«ã€‚æ­¤å¤–ï¼Œåœ¨è¿‡ç¨‹ä¸­é—´è¿›è¡Œè¾“å‡ºæ˜¯å®Œå…¨å¯ä»¥æ¥å—çš„ï¼ˆ <code>print</code> ï¼‰å¼ é‡ï¼Œæå¤§åœ°ç®€åŒ–äº†è°ƒè¯•ï¼›æœ€åï¼Œé€šè¿‡ç›´æ¥ä¼ é€’ï¼Œå¯ä»¥ä½¿ç”¨å¾ˆå¤šå‚æ•°ã€‚æˆ‘å°†é€šè¿‡ç®€çŸ­çš„æ¸…å•æ¥è¯´æ˜è¿™ä¸€ç‚¹ï¼Œè¯¥æ¸…å•ä¸ä»»ä½•ç‰¹å®šæ€æƒ³æ— å…³ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forward</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, hx, drop=False)</span></span></span><span class="hljs-function">:</span></span> hx2 = self.rnn(x, hx) print(hx.mean().item(), hx.var().item()) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> hx.max.item() &gt; <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> self.can_drop <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> drop: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hx <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hx2</code> </pre> <br><h4> åŸ¹è®­è¯¾ç¨‹ </h4><br><pre> <code class="python hljs">model.train() train_losses = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, (data, target) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(train_loader): data = data.to(device=device, non_blocking=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) target = target.to(device=device, non_blocking=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) optimiser.zero_grad() output = model(data) loss = F.nll_loss(output, target) loss.backward() train_losses.append(loss.item()) optimiser.step() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i % <span class="hljs-number"><span class="hljs-number">10</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>: print(i, loss.item()) torch.save(model.state_dict(), <span class="hljs-string"><span class="hljs-string">'model.pth'</span></span>) torch.save(optimiser.state_dict(), <span class="hljs-string"><span class="hljs-string">'optimiser.pth'</span></span>) torch.save(train_losses, <span class="hljs-string"><span class="hljs-string">'train_losses.pth'</span></span>)</code> </pre> <br> é»˜è®¤æƒ…å†µä¸‹ï¼Œç½‘ç»œæ¨¡å—è¿›å…¥è®­ç»ƒæ¨¡å¼-åœ¨ä¸€å®šç¨‹åº¦ä¸Šå½±å“æ¨¡å—çš„è¿è¡Œ-æœ€é‡è¦çš„æ˜¯-ç²¾ç®€å’Œæ‰¹é‡æ ‡å‡†åŒ–ã€‚ ä¸€ç§æˆ–å¦ä¸€ç§æ–¹å¼ï¼Œæœ€å¥½ä½¿ç”¨<code>.train()</code>æ‰‹åŠ¨è®¾ç½®æ­¤ç±»è®¾ç½®ï¼Œè¯¥è®¾ç½®ä¼šè¿‡æ»¤æ‰€æœ‰å­æ¨¡å—çš„â€œ trainingâ€æ ‡å¿—ã€‚ <br><br> åœ¨è¿™é‡Œï¼Œ <code>.to()</code>æ–¹æ³•ä¸ä»…æ¥å—è®¾å¤‡ï¼Œè¿˜è®¾ç½®<code>non_blocking=True</code> ï¼Œä»è€Œç¡®ä¿å°†æ•°æ®ä»å·²æäº¤çš„å†…å­˜å¼‚æ­¥å¤åˆ¶åˆ°GPUï¼Œä»è€Œä½¿CPUåœ¨æ•°æ®ä¼ è¾“æœŸé—´ä¿æŒå¯æ“ä½œçŠ¶æ€ã€‚ å¦åˆ™ï¼Œ <code>non_blocking=True</code>æ ¹æœ¬ä¸æ˜¯ä¸€ç§é€‰æ‹©ã€‚ <br><br> åœ¨ä½¿ç”¨<code>loss.backward()</code>å’Œ<code>loss.backward()</code>å»ºç«‹æ–°çš„æ¢¯åº¦é›†ä¹‹å‰ï¼Œå¿…é¡»å…ˆä½¿ç”¨<code>loss.backward()</code>æ‰‹åŠ¨é‡ç½®è¦ä¼˜åŒ–çš„å‚æ•°çš„æ¢¯åº¦ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒPyTorchä¼šç´¯ç§¯æ¢¯åº¦ï¼Œå¦‚æœæ‚¨æ²¡æœ‰è¶³å¤Ÿçš„èµ„æºæ¥ä¸€æ¬¡è®¡ç®—æ‰€éœ€çš„æ‰€æœ‰æ¢¯åº¦ï¼Œè¿™å°†éå¸¸æ–¹ä¾¿ã€‚ <br><br>  PyTorchä½¿ç”¨è‡ªåŠ¨æ¸å˜çš„â€œç£å¸¦â€ç³»ç»Ÿ-å®ƒæ”¶é›†æœ‰å…³åœ¨å¼ é‡ä¸Šæ‰§è¡Œçš„æ“ä½œå’Œé¡ºåºçš„ä¿¡æ¯ï¼Œç„¶åä»¥ç›¸åçš„æ–¹å‘æ’­æ”¾å®ƒä»¬ä»¥ç›¸åçš„é¡ºåºæ‰§è¡Œå¾®åˆ†ï¼ˆåå‘æ¨¡å¼å¾®åˆ†ï¼‰ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒæ˜¯å¦‚æ­¤çš„çµæ´»ï¼Œå¹¶å…è®¸ä»»æ„çš„è®¡ç®—å›¾ã€‚ å¦‚æœè¿™äº›å¼ é‡éƒ½ä¸è¦æ±‚æ¸å˜ï¼ˆæ‚¨å¿…é¡»å°†<code>requires_grad=True</code>è®¾ç½®ä¸ºä¸ºæ­¤ç›®çš„åˆ›å»ºå¼ é‡ï¼‰ï¼Œåˆ™ä¸ä¼šä¿å­˜ä»»ä½•å›¾å½¢ï¼ ä½†æ˜¯ï¼Œç½‘ç»œé€šå¸¸å…·æœ‰éœ€è¦æ¢¯åº¦çš„å‚æ•°ï¼Œå› æ­¤ï¼ŒåŸºäºç½‘ç»œè¾“å‡ºæ‰§è¡Œçš„ä»»ä½•è®¡ç®—éƒ½å°†å­˜å‚¨åœ¨å›¾ä¸­ã€‚ å› æ­¤ï¼Œå¦‚æœè¦ä¿å­˜æ­¤æ­¥éª¤ç”Ÿæˆçš„æ•°æ®ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨ç¦ç”¨æ¸å˜æˆ–ï¼ˆæ›´å¸¸è§çš„æ–¹æ³•ï¼‰å°†æ­¤ä¿¡æ¯å¦å­˜ä¸ºPythonæ•°å­—ï¼ˆåœ¨PyTorchæ ‡é‡ä¸­ä½¿ç”¨<code>.item()</code> ï¼‰æˆ–<code>numpy</code>æ•°ç»„ã€‚ åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹æ–‡æ¡£ä¸­</a>é˜…è¯»æœ‰å…³<code>autograd</code>æ›´å¤šä¿¡æ¯ã€‚ <br><br> ç¼©çŸ­è®¡ç®—å›¾çš„ä¸€ç§æ–¹æ³•æ˜¯åœ¨å­¦ä¹ å¸¦æœ‰æˆªæ–­æ—¶é—´åå‘ä¼ æ’­ç‰ˆæœ¬çš„RNNæ—¶ï¼Œé€šè¿‡éšè—çŠ¶æ€æ—¶ä½¿ç”¨<code>.detach()</code> ã€‚ å½“åŒºåˆ†æŸå¤±æ—¶ï¼Œå½“ç»„ä»¶ä¹‹ä¸€æ˜¯å¦ä¸€ä¸ªç½‘ç»œçš„è¾“å‡ºæ—¶ï¼Œè¿™ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯ä¸åº”é’ˆå¯¹æŸå¤±ä¼˜åŒ–è¯¥å¦ä¸€ä¸ªç½‘ç»œã€‚ ä¾‹å¦‚ï¼Œæˆ‘å°†è®²æˆä¸GANåˆä½œæ—¶äº§ç”Ÿçš„è¾“å‡ºææ–™çš„åŒºåˆ«éƒ¨åˆ†ï¼Œæˆ–ä½¿ç”¨ç›®æ ‡å‡½æ•°ä½œä¸ºåŸºæœ¬å‡½æ•°ï¼ˆä¾‹å¦‚A2Cï¼‰çš„è¡Œä¸ºè€…è¯„è®ºç®—æ³•ä¸­çš„ç­–ç•¥è®­ç»ƒã€‚ é˜²æ­¢æ¢¯åº¦è®¡ç®—çš„å¦ä¸€ç§æŠ€æœ¯æœ‰æ•ˆåœ°è®­ç»ƒGANï¼ˆå¯¹åŒºåˆ†ææ–™è¿›è¡Œç”Ÿæˆéƒ¨åˆ†çš„è®­ç»ƒï¼‰ï¼Œå¹¶ä¸”åœ¨å¾®è°ƒä¸­é€šå¸¸é‡‡ç”¨çš„å…¸å‹æ–¹æ³•<code>param.requires_grad = False</code>å‚æ•°<code>param.requires_grad = False</code>çš„ç½‘ç»œå‚æ•°çš„å¾ªç¯æšä¸¾ã€‚ <br><br> é‡è¦çš„æ˜¯ï¼Œä¸ä»…è¦åœ¨æ§åˆ¶å°/æ—¥å¿—æ–‡ä»¶ä¸­è®°å½•ç»“æœï¼Œè€Œä¸”è¿˜è¦ä»¥é˜²ä¸‡ä¸€ï¼Œåœ¨æ¨¡å‹å‚æ•°ï¼ˆå’Œä¼˜åŒ–å™¨çŠ¶æ€ï¼‰ä¸­è®¾ç½®æ§åˆ¶ç‚¹ã€‚ æ‚¨è¿˜å¯ä»¥ä½¿ç”¨<code>torch.save()</code>ä¿å­˜å¸¸è§„çš„Pythonå¯¹è±¡ï¼Œæˆ–ä½¿ç”¨å¦ä¸€ä¸ªæ ‡å‡†è§£å†³æ–¹æ¡ˆ-å†…ç½®<code>pickle</code> ã€‚ <br><br><h4> æµ‹è¯•ä¸­ </h4><br><pre> <code class="python hljs">model.eval() test_loss, correct = <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> torch.no_grad(): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> data, target <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> test_loader: data = data.to(device=device, non_blocking=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) target = target.to(device=device, non_blocking=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) output = model(data) test_loss += F.nll_loss(output, target, reduction=<span class="hljs-string"><span class="hljs-string">'sum'</span></span>).item() pred = output.argmax(<span class="hljs-number"><span class="hljs-number">1</span></span>, keepdim=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) correct += pred.eq(target.view_as(pred)).sum().item() test_loss /= len(test_data) acc = correct / len(test_data) print(acc, test_loss)</code> </pre> <br> å“åº”<code>.train()</code>éœ€è¦ä½¿ç”¨<code>.eval()</code>å°†ç½‘ç»œæ˜ç¡®åœ°ç½®äºè¯„ä¼°æ¨¡å¼ã€‚ <br><br> å¦‚ä¸Šæ‰€è¿°ï¼Œå½“ä½¿ç”¨ç½‘ç»œæ—¶ï¼Œé€šå¸¸ä¼šç¼–è¯‘è®¡ç®—å›¾ã€‚ ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œè¯·åœ¨<code>no_grad</code>ä¸Šä¸‹æ–‡<code>no_grad</code>ä¸­<code>with torch.no_grad()</code> ã€‚ <br><br><h4> è¿˜æœ‰ä¸€äº› </h4><br> è¿™æ˜¯é™„åŠ çš„éƒ¨åˆ†ï¼Œåœ¨å…¶ä¸­æˆ‘åšäº†ä¸€äº›æ›´æœ‰ç”¨çš„è®ºè¿°ã€‚ <br> è¿™æ˜¯è§£é‡Šä½¿ç”¨å†…å­˜çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹æ–‡æ¡£</a> ã€‚ <br><br>  CUDAé”™è¯¯ï¼Ÿ å¾ˆéš¾ä¿®å¤å®ƒä»¬ï¼Œé€šå¸¸å®ƒä»¬ä¹‹é—´å­˜åœ¨é€»è¾‘ä¸Šçš„ä¸ä¸€è‡´ï¼Œæ®æ­¤ï¼Œåœ¨CPUä¸Šæ¯”åœ¨GPUä¸Šæ˜¾ç¤ºçš„é”™è¯¯ä¿¡æ¯æ›´å¤šã€‚ æœ€é‡è¦çš„æ˜¯ï¼Œå¦‚æœæ‚¨æ‰“ç®—ä½¿ç”¨GPUï¼Œåˆ™å¯ä»¥åœ¨CPUå’ŒGPUä¹‹é—´å¿«é€Ÿåˆ‡æ¢ã€‚ ä¸€ä¸ªæ›´é€šç”¨çš„å¼€å‘æŠ€å·§æ˜¯ç»„ç»‡ä»£ç ï¼Œä»¥ä¾¿åœ¨å¼€å§‹ä¸€é¡¹å®Œæ•´çš„ä»»åŠ¡ä¹‹å‰å¯ä»¥å¯¹å…¶è¿›è¡Œå¿«é€Ÿæ£€æŸ¥ã€‚ ä¾‹å¦‚ï¼Œå‡†å¤‡ä¸€ä¸ªå°å‹æˆ–ç»¼åˆæ•°æ®é›†ï¼Œè¿è¡Œä¸€ä¸ªæ—¶ä»£è®­ç»ƒ+æµ‹è¯•ç­‰ã€‚ å¦‚æœé—®é¢˜æ˜¯CUDAé”™è¯¯ï¼Œæˆ–è€…æ‚¨æ ¹æœ¬æ— æ³•åˆ‡æ¢åˆ°CPUï¼Œè¯·è®¾ç½®CUDA_LAUNCH_BLOCKING = 1ã€‚ è¿™å°†ä½¿CUDAå†…æ ¸å¯åŠ¨åŒæ­¥ï¼Œå¹¶ä¸”æ‚¨å°†æ”¶åˆ°æ›´å‡†ç¡®çš„é”™è¯¯æ¶ˆæ¯ã€‚ <br><br> å…³äº<code>torch.multiprocessing</code>çš„è¯´æ˜ï¼Œæˆ–ä»…åŒæ—¶è¿è¡Œå¤šä¸ªPyTorchè„šæœ¬ã€‚ ç”±äºPyTorchä½¿ç”¨å¤šçº¿ç¨‹BLASåº“æ¥åŠ é€ŸCPUä¸Šçš„çº¿æ€§ä»£æ•°è®¡ç®—ï¼Œå› æ­¤é€šå¸¸æ¶‰åŠå¤šä¸ªå†…æ ¸ã€‚ å¦‚æœè¦ä½¿ç”¨å¤šçº¿ç¨‹å¤„ç†æˆ–å¤šä¸ªè„šæœ¬åŒæ—¶æ‰§è¡Œå¤šä¸ªæ“ä½œï¼Œå»ºè®®é€šè¿‡å°†ç¯å¢ƒå˜é‡<code>OMP_NUM_THREADS</code>è®¾ç½®ä¸º1æˆ–å¦ä¸€ä¸ªè¾ƒä½çš„å€¼æ¥æ‰‹åŠ¨å‡å°‘å®ƒä»¬çš„æ•°é‡ã€‚ å› æ­¤ï¼Œå‡å°‘äº†æ»‘å€’å¤„ç†å™¨çš„å¯èƒ½æ€§ã€‚ å®˜æ–¹æ–‡æ¡£ä¸­è¿˜æœ‰å…³äºå¤šçº¿ç¨‹å¤„ç†çš„å…¶ä»–æ³¨é‡Šã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN471228/">https://habr.com/ru/post/zh-CN471228/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN471212/index.html">10æ¡æç¤ºå’ŒæŠ€å·§ï¼Œä»¥å¸®åŠ©æ‚¨æˆä¸ºVueJSä¸Šæœ€å¥½çš„å¼€å‘äººå‘˜</a></li>
<li><a href="../zh-CN471216/index.html">è¯¥æŒ‡å—çš„æ‚ ä¹…å†å²-æˆ‘å¦‚ä½•ç¼–å†™5å¹´çš„æ™ºèƒ½è¿œè¶³å¾„æœåŠ¡</a></li>
<li><a href="../zh-CN471220/index.html">åº§èˆ±-é€šè¿‡ä¾¿æ·çš„Webç•Œé¢ç®€åŒ–Linuxä¸­çš„å…¸å‹ç®¡ç†ä»»åŠ¡</a></li>
<li><a href="../zh-CN471222/index.html">äº†è§£åº”ç”¨ç¨‹åºå’ŒæœåŠ¡éšç§ç­–ç•¥å°†æœ‰åŠ©äºç¥ç»ç½‘ç»œ</a></li>
<li><a href="../zh-CN471226/index.html">Linuxæœ‰å¾ˆå¤šé¢å­”ï¼šå¦‚ä½•åœ¨ä»»ä½•å‘è¡Œç‰ˆä¸Šå·¥ä½œ</a></li>
<li><a href="../zh-CN471232/index.html">æˆ‘å°†LPS331APè¿æ¥åˆ°Omega Onion2çš„ç»éªŒ</a></li>
<li><a href="../zh-CN471236/index.html">Seryozhaçš„å‰‚é‡è®¡ã€‚ ç¬¬ä¸‰éƒ¨åˆ† å›½å®¶è¾å°„è®¡</a></li>
<li><a href="../zh-CN471240/index.html">â€œ Bitchy Bettyâ€å’Œç°ä»£éŸ³é¢‘æ¥å£ï¼šä¸ºä»€ä¹ˆå®ƒä»¬ä»¥å¥³æ€§å£°éŸ³è¯´è¯ï¼Ÿ</a></li>
<li><a href="../zh-CN471242/index.html">Bash Shellç®€ä»‹</a></li>
<li><a href="../zh-CN471244/index.html">Rosettaä»£ç ï¼šæµ‹é‡å¤§é‡ç¼–ç¨‹è¯­è¨€ä¸­ä»£ç çš„é•¿åº¦ï¼Œç ”ç©¶è¯­è¨€ä¹‹é—´çš„æ¥è¿‘åº¦</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>