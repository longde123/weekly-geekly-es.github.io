<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úçüèΩ üëäüèº üÖ±Ô∏è DevOps d'entreprise: comment une grande entreprise collecte des microservices üë®üèΩ‚Äçüöí üèÆ üì∞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous! 


 Netracker d√©veloppe et fournit des applications d'entreprise pour le march√© mondial des op√©rateurs de t√©l√©communications depuis de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DevOps d'entreprise: comment une grande entreprise collecte des microservices</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/netcracker/blog/421423/"><p>  Bonjour √† tous! </p><br><p>  Netracker d√©veloppe et fournit des applications d'entreprise pour le march√© mondial des op√©rateurs de t√©l√©communications depuis de nombreuses ann√©es.  Le d√©veloppement de telles solutions est assez compliqu√©: des centaines de personnes participent √† des projets, et le nombre de projets actifs par dizaines. </p><br><p>  Auparavant, les produits √©taient monolithiques, mais nous nous dirigeons maintenant en toute confiance vers des applications de microservices.  DevOps a √©t√© confront√© √† une t√¢che plut√¥t ambitieuse: fournir ce saut technologique. </p><br><p>  En cons√©quence, nous avons obtenu un concept d'assemblage r√©ussi, que nous voulons partager comme meilleure pratique.  La description de l'impl√©mentation avec les d√©tails techniques sera assez volumineuse; nous ne le ferons pas dans le cadre de cet article. </p><a name="habracut"></a><br><p>  <i>Dans le cas g√©n√©ral, l'assemblage est la transformation de certains artefacts en d'autres.</i> <i><br></i> </p><br><h2>  Qui sera int√©ress√© </h2><br><p>  Les entreprises qui fournissent des logiciels pr√™ts √† l'emploi √† une organisation enti√®rement tierce et sont r√©mun√©r√©es pour cela. </p><br><p>  Voici √† quoi pourrait ressembler un d√©veloppement sans livraison externe: </p><br><ul><li>  Le service informatique de l'usine d√©veloppe des logiciels pour son entreprise. </li><li> L'entreprise est engag√©e dans l'externalisation pour un client √©tranger.  Le client compile et exploite ind√©pendamment ce code sur son propre serveur Web. </li><li>  L'entreprise fournit des logiciels √† des clients externes, mais sous licence open source.  La majeure partie de la responsabilit√© est ainsi d√©charg√©e. </li></ul><br><p>  Si vous n'√™tes pas confront√© √† une offre externe, une grande partie de ce qui est √©crit ci-dessous vous semblera redondante, voire parano√Øaque. </p><br><p>  Dans la pratique, tout doit √™tre fait conform√©ment aux exigences internationales pour les licences et le cryptage utilis√©s, sinon des cons√©quences juridiques au moins se produiront. </p><br><p>  Un exemple de violation consiste √† prendre le code d'une biblioth√®que avec une licence GPL3 et √† l'int√©grer dans une application commerciale. </p><br><h2>  L'√©mergence des microservices n√©cessite un changement </h2><br><p>  Nous avons acquis une vaste exp√©rience dans l'assemblage et la livraison d'applications monolithiques. </p><br><p>  Plusieurs serveurs Jenkins, des milliers de travaux CI, plusieurs cha√Ænes de montage enti√®rement automatis√©es bas√©es sur Jenkins, des dizaines d'ing√©nieurs de version d√©di√©s, son propre groupe d'experts sur la gestion de la configuration. </p><br><p>  Historiquement, l'approche dans l'entreprise √©tait la suivante: les d√©veloppeurs √©crivent le code source, et DevOps inventent et √©crivent la configuration du syst√®me d'assemblage. </p><br><p>  En cons√©quence, nous avions deux ou trois configurations d'assemblage typiques con√ßues pour fonctionner dans l'√©cosyst√®me de l'entreprise.  Sch√©matiquement, cela ressemble √† ceci: </p><br><img src="https://habrastorage.org/webt/pr/hi/rm/prhirmtpwufl-vfhheebwfaujpg.png"><br><p>  L'outil de construction est g√©n√©ralement ant ou maven, et quelque chose est impl√©ment√© par des plug-ins disponibles publiquement, quelque chose est √©crit de lui-m√™me.  Cela fonctionne bien lorsqu'une entreprise utilise un ensemble restreint de technologies. </p><br><p>  <i>Les microservices diff√®rent des applications monolithiques principalement par la vari√©t√© des technologies.</i> </p><br><p>  Il s'av√®re que de nombreuses configurations d'assemblage pour au moins chaque langage de programmation.  Le contr√¥le centralis√© devient impossible. </p><br><p>  Il est n√©cessaire de simplifier autant que possible les scripts d'assemblage et de permettre aux d√©veloppeurs de les modifier ind√©pendamment. </p><br><p>  En plus d'une simple compilation et packaging (dans le diagramme en <font color="green">vert</font> ), ces scripts contiennent beaucoup de code pour l'int√©gration avec l'√©cosyst√®me de l'entreprise (dans le diagramme en <font color="red">rouge</font> ). </p><br><p>  Par cons√©quent, il a √©t√© d√©cid√© de percevoir l'assemblage comme une "bo√Æte noire", dans laquelle un environnement d'assemblage "intelligent" peut r√©soudre tous les probl√®mes, √† l'exception de la compilation et du conditionnement lui-m√™me. </p><br><p>  Au d√©but des travaux, il n'√©tait pas clair comment obtenir un tel syst√®me.  Prendre des d√©cisions architecturales pour les t√¢ches DevOps n√©cessite de l'exp√©rience et des connaissances.  Comment les obtenir?  Les options possibles sont ci-dessous: </p><br><ul><li>  Recherchez des informations sur Internet. </li><li>  Propre exp√©rience et connaissance de l'√©quipe DevOps.  Pour ce faire, il est bon de faire de cette √©quipe de programmeurs une exp√©rience polyvalente. </li><li>  Exp√©rience et connaissances acquises en dehors de l'√©quipe DevOps.  De nombreux d√©veloppeurs de l'entreprise ont de bonnes id√©es - vous devez les entendre.  La communication est utile. </li><li>  Nous inventons et exp√©rimentons! </li></ul><br><h2>  Ai-je besoin d'automatisation? </h2><br><p>  Pour r√©pondre √† cette question, vous devez comprendre √† quel stade d'√©volution sont nos approches d'assemblage.  En g√©n√©ral, une t√¢che passe par les niveaux suivants. </p><br><ol><li>  Niveau inconscient <br><br><img width="150" src="https://habrastorage.org/webt/an/e2/uv/ane2uvhcdznwqj-bncv49oo58p8.jpeg"><br><br><p>  Nous devons sortir un assemblage par semaine, nos gars vont bien.  C'est naturel, pourquoi en parler? </p></li><li>  Le niveau de ¬´l'artisan¬ª, se transformant finalement en niveau de ¬´l'escroc¬ª <br><br><img width="150" src="https://habrastorage.org/webt/ck/mc/-a/ckmc-a4-76nvtsanjjwf4ilsf-i.gif"><br><br><p>  Il est n√©cessaire de produire deux assemblages par jour de mani√®re stable et sans erreur.  Nous avons Vasya, il le fait cool, et personne d'autre que lui ne passe ce temps. </p></li><li>  Niveau manufacture <br><br><img width="150" src="https://habrastorage.org/webt/hw/_x/57/hw_x572z1bstsfv4gcp9ntekdho.jpeg"><br><br><p>  Les choses sont all√©es loin.  Vous avez besoin de 20 assembl√©es par jour, Vasya ne peut pas faire face, et maintenant une √©quipe de dix personnes est d√©j√† assise.  Ils ont un patron, des plans, des vacances, des cong√©s de maladie, de la motivation, du team building, des formations, des traditions et des r√®gles.  Il s'agit d'une sp√©cialisation, leur travail doit √™tre √©tudi√©. <br></p><br><p>  √Ä ce niveau, la t√¢che est s√©par√©e de l'ex√©cuteur testamentaire concret et devient ainsi un processus. </p><br><p>  Le r√©sultat sera une description claire, √©labor√©e, rod√©e et corrig√©e des centaines de fois du processus avec du texte. </p></li><li>  Le niveau de ¬´production automatis√©e¬ª <br><br><img width="150" src="https://habrastorage.org/webt/mw/2c/pt/mw2cptkfee3fmatsj6aw-21eka4.jpeg"><br><br><p>  Les exigences modernes pour les assemblages augmentent: tout doit √™tre rapide, fiable, 800 assemblages doivent √™tre fournis par jour.  Cela est essentiel, car sans ces volumes, l'entreprise perdra ses avantages concurrentiels. </p><br><p>  Une automatisation co√ªteuse est en cours et quelques DevOps qualifi√©s peuvent maintenir le processus en cours.  Une mise √† l'√©chelle suppl√©mentaire n'est plus un probl√®me. </p></li></ol><br><p>  <i>Toutes les t√¢ches ne doivent pas atteindre la derni√®re √©tape de l'automatisation.</i> </p><br><p>  Souvent, un artisan poss√©dant une ligne de commande r√©sout les probl√®mes facilement et efficacement. </p><br><p>  L'automatisation ¬´fige¬ª le processus, r√©duit le co√ªt de fonctionnement et augmente le co√ªt du changement. </p><br><p>  Vous pouvez vous rendre directement √† l'assemblage de la voiture, mais le syst√®me sera g√™nant, ne suivra pas les exigences de l'entreprise et, par cons√©quent, deviendra obsol√®te. </p><br><h2>  Quels sont les assemblages et pourquoi le probl√®me n'est pas r√©solu par des syst√®mes d'assemblage pr√™ts √† l'emploi <br></h2><br><img src="https://habrastorage.org/webt/0s/s1/dk/0ss1dkrnmpubpcllntnzuuwofw0.png"><br><p>  Nous utilisons la classification suivante pour d√©terminer les niveaux d'agr√©gation d'assemblage. <br><br></p><ul><li><p>  L1.  Une petite partie ind√©pendante d'une grande application.  Il peut s'agir d'un composant, d'un microservice ou d'une biblioth√®que auxiliaire.  L'assemblage L1 est une solution aux probl√®mes techniques lin√©aires: compilation, packaging, travail avec les d√©pendances.  Maven, gradle, npm, grunt et d'autres syst√®mes de construction font un excellent travail.  Il y en a des centaines. </p><p>  <i>L'assemblage L1 doit √™tre effectu√© √† l'aide d'outils tiers pr√™ts √† l'emploi.</i> </p></li><li><p>  L2 +.  Entit√©s d'int√©gration.  Les entit√©s L1 sont combin√©es en formations plus grandes, par exemple, en applications de microservices √† part enti√®re.  Plusieurs de ces applications peuvent √™tre regroup√©es en une seule solution.  Nous utilisons le signe ¬´+¬ª, car en fonction du niveau d'agr√©gation d'assemblage, un niveau L3 ou m√™me L4 peut √™tre attribu√©. </p><br><p>  Un exemple de tels assemblages dans le monde des tiers est la pr√©paration des distributions Linux.  M√©ta-packages l√†-bas. </p><br><p>  En plus de t√¢ches techniques assez complexes (comme celle-ci: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ru.wikipedia.org/wiki/Dependency_hell</a> ).  Les assemblages L2 + sont souvent le produit final et ont donc de nombreuses exigences de processus: un syst√®me de droits, la fixation de personnes responsables, l'absence d'erreurs l√©gales, la fourniture de divers documents. </p><br><p>  <i>Chez L2 +, les exigences de processus sont hi√©rarchis√©es par l'automatisation.</i> </p><br><p>  Si la solution automatique ne fonctionne pas car elle convient aux personnes int√©ress√©es, elle ne sera pas mise en ≈ìuvre. </p><br><p>  Les assemblages L2 + seront tr√®s probablement r√©alis√©s par un outil propri√©taire sp√©cifiquement adapt√© aux processus de l'entreprise.  Pensez-vous que les gestionnaires de packages Linux viennent juste avec √ßa? </p></li></ul><br><br><h2>  Nos bonnes pratiques </h2><br><h3>  L'infrastructure </h3><br><h4>  Disponibilit√© permanente de fer </h4><br><p>  L'ensemble de l'infrastructure d'assemblage se trouve sur des serveurs ferm√©s √† l'int√©rieur du r√©seau d'entreprise.  Dans certains cas, des services cloud commerciaux sont possibles. <br></p><br><h4>  Autonomie </h4><br><p>  Dans tous les processus CI, Internet n'est pas disponible.  Toutes les ressources n√©cessaires sont mises en miroir et mises en cache en interne.  Partiellement m√™me github.com (merci, npm!) La plupart de ces probl√®mes sont r√©solus par Artifactory. </p><br><p>  Par cons√©quent, nous sommes calmes lors de la suppression d'artefacts de maven central ou de la fermeture de r√©f√©rentiels populaires.  Il y a un exemple: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">community.oracle.com/community/java/javanet-forge-sunset</a> . </p><br><p>  La mise en miroir r√©duit consid√©rablement le temps d'assemblage et lib√®re le canal Internet d'entreprise.  Moins de ressources r√©seau critiques augmentent la stabilit√© de la construction. </p><br><h4>  Trois r√©f√©rentiels pour chaque type d'artefact </h4><br><ol><li>  Dev est un r√©f√©rentiel o√π n'importe qui peut publier des artefacts de toute origine.  Ici, vous pouvez exp√©rimenter des approches fondamentalement nouvelles sans les adapter aux normes de l'entreprise d√®s le premier jour. </li><li>  Le staging est un r√©f√©rentiel rempli uniquement avec un pipeline d'assemblage. </li><li>  Lib√©ration - assemblages simples, pr√™ts pour une livraison externe.  Il est rempli d'une op√©ration de transfert sp√©ciale avec confirmation manuelle. </li></ol><br><h4>  R√®gle des 30 jours <br></h4><br><p>  Dans les r√©f√©rentiels Dev et Staging, nous supprimons tout ce qui date de plus de 30 jours.  Cela permet de garantir √† tous des opportunit√©s de publication √©gales en d√©pensant une quantit√© limit√©e d'espace disque sur le serveur. </p><br><p>  La version est stock√©e pour toujours, l'archivage est effectu√© si n√©cessaire. </p><br><h4>  Environnement d'assemblage propre <br></h4><br><p>  Souvent, apr√®s les assemblages, les fichiers auxiliaires restent dans le syst√®me, ce qui peut affecter d'autres processus d'assemblage.  Exemples typiques: </p><br><ul><li>  le probl√®me le plus courant est un cache endommag√© par un assemblage incorrect (comment traiter les caches, d√©crit ci-dessous); </li><li>  certains utilitaires, tels que npm, laissent des fichiers de service dans le r√©pertoire $ HOME qui affectent tous les lancements ult√©rieurs de ces utilitaires; </li><li>  un assembly particulier peut d√©penser tout l'espace disque d'une partition / tmp, ce qui entra√Ænera une indisponibilit√© g√©n√©rale de l'environnement. </li></ul><br><p>  Par cons√©quent, il vaut mieux abandonner l'environnement unifi√© au profit des conteneurs dockers.  Les conteneurs ne doivent contenir que le logiciel n√©cessaire pour un assemblage sp√©cifique avec des versions fixes. </p><br><p>  DevOps g√®re une collection d'images Docker d'assemblage, qui est constamment mise √† jour.  Au d√©but, il y en avait environ six, puis c'√©tait moins de 30, puis nous avons mis en place une g√©n√©ration automatique d'images √† partir de la liste des logiciels.  Maintenant, sp√©cifiez simplement des exigences telles que require ('maven 3.3.9', 'python') - et l'environnement est pr√™t. </p><br><h4>  Auto-diagnostic </h4><br><p>  Il n'est pas seulement n√©cessaire d'organiser le support utilisateur pour les demandes, nous devons analyser nous-m√™mes le comportement de notre propre syst√®me.  Nous collectons constamment des journaux, recherchons dans ceux-ci des mots cl√©s montrant des probl√®mes. </p><br><p>  Sur un syst√®me "live", il suffit d'√©crire 20 √† 30 expressions r√©guli√®res pour que pour chaque assemblage vous puissiez dire la raison de sa chute au niveau: </p><br><ul><li>  Crash du serveur Git </li><li>  l'espace disque est √©puis√©; </li><li>  erreur de construction due √† la faute du d√©veloppeur; </li><li>  Bug connu dans Docker. </li></ul><br><p>  Si quelque chose est tomb√©, mais qu'aucun probl√®me connu n'a √©t√© d√©tect√©, c'est l'occasion de reconstituer la collection de masques. </p><br><p>  Ensuite, nous allons √† l'utilisateur et disons qu'il a une version et cela peut √™tre corrig√© de cette fa√ßon. </p><br><p>  Vous serez surpris du nombre de probl√®mes que les utilisateurs ne signalent pas √† l'appui.  Il est pr√©f√©rable de les r√©parer √† l'avance et √† un moment opportun.  Souvent, une erreur de publication mineure est ignor√©e pendant deux semaines, et vendredi soir, il s'av√®re que cela bloque la sortie externe. </p><br><h4>  Nous choisissons soigneusement les syst√®mes dont d√©pend l'assemblage <br></h4><br><p>  Id√©alement, en g√©n√©ral, pour assurer une autonomie compl√®te de l'ensemble, mais le plus souvent cela est impossible.  Pour les assemblys bas√©s sur java, vous avez besoin d'au moins Artifactory pour la mise en miroir - voir ci-dessus pour l'autonomie.  Chaque syst√®me int√©gr√© augmente le risque de d√©faillance.  Il est souhaitable que tous les syst√®mes fonctionnent en mode HA d√©cent. </p><br><h3>  Interface de ligne d'assemblage </h3><br><h4>  Interface unique pour appeler l'assembly </h4><br><p>  Nous r√©alisons tout type d'assemblage avec un seul syst√®me.  Les assemblages de tous les niveaux (L1, L2 +) sont d√©crits par code de programme et sont appel√©s via un travail Jenkins. </p><br><p>  Cependant, cette approche n'est pas id√©ale.  Il est pr√©f√©rable d'utiliser les m√©canismes de g√©n√©ration automatique de travaux Jenkins: par exemple, 1 travail = 1 r√©f√©rentiel git ou 1 travail = 1 branche git.  Cela permettra d'atteindre les objectifs suivants: </p><br><ul><li>  les journaux d'assemblages h√©t√©rog√®nes ne sont pas confondus dans une seule histoire sur la page de travail Jenkins; </li><li>  en fait, vous obtenez des emplois attribu√©s confortables pour une √©quipe ou pour un d√©veloppeur;  la sensation de confort peut √™tre am√©lior√©e en ajustant les graphiques des r√©sultats de junit, cobertura, sonar. </li></ul><br><h4>  Libert√© de choisir la technologie <br></h4><br><p>  Le d√©marrage de la construction est un appel au script bash "./build.sh".  Et puis - tous les syst√®mes d'assemblage, les langages de programmation et tout ce qui sera n√©cessaire pour effectuer une t√¢che commerciale.  Cela fournit une approche de l'assemblage sous forme de bo√Æte noire. </p><br><h4>  Message intelligent </h4><br><p>  La cha√Æne de montage intercepte les publications de la bo√Æte noire et les place d√©j√† dans le stockage de l'entreprise.  Pour cela, les probl√®mes ennuyeux tels que la g√©n√©ration de noms d'images Docker et le choix du bon r√©f√©rentiel pour la publication sont automatiquement r√©solus. </p><br><p>  Les r√©f√©rentiels de staging et de release ont toujours de l'ordre.  Il est n√©cessaire pour prendre en charge les sp√©cificit√©s des publications de diff√©rents types: maven, npm, file, docker. </p><br><h4>  Descripteur d'assemblage <br></h4><br><p>  Build.sh d√©crit comment compiler du code, mais cela ne suffit pas pour un conteneur d'assembly. </p><br><p>  Vous devez √©galement savoir: </p><br><ol><li>  quel environnement d'assemblage utiliser; </li><li>  variables d'environnement disponibles dans build.sh; </li><li>  quelles publications seront effectu√©es; </li><li>  d'autres options sp√©cifiques. </li></ol><br><p>  Nous avons choisi un moyen pratique de d√©crire ces informations sous la forme d'un fichier yaml ressemblant √† distance √† .gitlab-ci.yaml. </p><br><h4>  Param√©trage de l'assemblage <br></h4><br><p>  L'utilisateur peut sp√©cifier des param√®tres arbitraires sans ex√©cuter la commande git commit d√®s le d√©but de l'assembly. </p><br><p>  Nous l'avons impl√©ment√© en d√©finissant des variables d'environnement directement √† partir de l'interface de travail Jenkins. </p><br><p>  Par exemple, nous transf√©rons la version de la biblioth√®que d√©pendante vers un tel param√®tre d'assembly et, dans certains cas, red√©finissons cette version en une version exp√©rimentale.  Sans un tel m√©canisme, l'utilisateur devrait ex√©cuter la commande ¬´git commit¬ª √† chaque fois. </p><br><h4>  Portabilit√© du syst√®me <br></h4><br><p>  Vous devez √™tre en mesure de reproduire le processus d'assemblage non seulement sur le serveur CI principal, mais √©galement sur l'ordinateur du d√©veloppeur.  Cela aide √† d√©boguer des scripts de construction complexes.  De plus, au lieu de Jenkins, il sera parfois plus pratique d'utiliser Gitlab CI.  Par cons√©quent, le syst√®me de g√©n√©ration doit √™tre une application java ind√©pendante.  Nous l'avons impl√©ment√© comme un plugin gradle. </p><br><h4>  Un artefact peut √™tre publi√© sous diff√©rents noms. <br></h4><br><p>  Il existe deux exigences oppos√©es pour la publication qui peuvent survenir simultan√©ment. </p><br><p>  D'une part, pour le stockage √† long terme et la gestion des versions, il est n√©cessaire de garantir l'unicit√© des noms des artefacts publi√©s.  Cela prot√©gera au moins les artefacts contre l'√©crasement. </p><br><p>  D'un autre c√¥t√©, il est parfois pratique d'avoir un artefact r√©el avec un nom fixe comme le plus r√©cent.  Par exemple, le d√©veloppeur n'a pas besoin de conna√Ætre la version exacte de la d√©pendance √† chaque fois, vous pouvez simplement travailler avec la derni√®re version. </p><br><p>  L'artefact dans ce cas est publi√© sous deux noms ou plus, car il convient √† tout le monde. </p><br><p>  Par exemple: </p><br><ol><li>  un nom unique avec horodatage ou UUID - pour ceux qui ont besoin de pr√©cision; </li><li>  le nom ¬´dernier¬ª - pour leurs d√©veloppeurs, qui r√©cup√®rent toujours le dernier code; </li><li>  le nom "&lt;major version&gt; .x-latest" est pour une √©quipe voisine qui est pr√™te √† r√©cup√©rer les derni√®res versions, mais uniquement dans le cadre d'une certaine majeure. </li></ol><br><p>  Maven fait quelque chose de similaire dans son approche de SNAPSHOT. </p><br><h4>  Moins de restrictions de s√©curit√© <br></h4><br><p>  Tout le monde peut commencer l'assemblage.  Cela ne nuira √† personne, car l'assemblage cr√©e uniquement des artefacts. </p><br><h3>  Conformit√© l√©gale </h3><br><h4>  Contr√¥le des interactions externes du processus d'assemblage </h4><br><p>  L'assembl√©e ne peut utiliser aucun √©l√©ment interdit dans le cadre de ses travaux. </p><br><p>  Pour cela, l'enregistrement du trafic r√©seau et l'acc√®s aux caches de fichiers sont impl√©ment√©s.  Nous obtenons le journal d'activit√© r√©seau de l'assemblage sous la forme d'une liste d'url avec sha256 hachages des donn√©es re√ßues.  De plus, chaque URL est valid√©e: </p><br><ol><li>  liste blanche statique; </li><li>  base de donn√©es dynamique des artefacts autoris√©s (par exemple, pour les d√©pendances maven-, rpm-, npm-).  Chaque d√©pendance est consid√©r√©e individuellement.  Un permis automatique ou une interdiction d'utilisation peut fonctionner, et une longue discussion avec les avocats peut √©galement commencer. </li></ol><br><h4>  Contenu transparent des artefacts publi√©s <br></h4><br><p>  Parfois, la t√¢che consiste √† fournir une liste de logiciels tiers dans n'importe quel assemblage.  Pour ce faire, ils ont r√©alis√© un analyseur de composition simple qui analyse tous les fichiers et archives de l'assemblage, reconna√Æt le tiers par hachage et fait un rapport. </p><br><h4>  Le code source √©mis ne peut pas √™tre supprim√© de GIT <br></h4><br><p>  Parfois, vous devrez peut-√™tre trouver le code source en consultant l'artefact binaire compil√© il y a deux ans.  Pour ce faire, il est n√©cessaire d'allouer automatiquement des balises dans Git avec une sortie externe, ainsi que d'interdire leur suppression. </p><br><h3>  Logistique et comptabilit√© <br></h3><br><h4>  Tous les assemblages sont stock√©s dans la base de donn√©es. </h4><br><p>  Nous utilisons le r√©f√©rentiel de fichiers dans Artifactory √† ces fins.  Il contient toutes les informations √† l'appui: qui l'a lanc√©, quels ont √©t√© les r√©sultats des v√©rifications, quels artefacts ont √©t√© publi√©s, quel git hash a √©t√© utilis√©, etc. </p><br><h4>  Nous savons reproduire le montage le plus fid√®lement possible </h4><br><p>  Selon les r√©sultats de l'assemblage, nous stockons les informations suivantes: </p><br><ul><li>  l'√©tat exact du code qui a √©t√© collect√©; </li><li>  avec quels param√®tres le lancement a √©t√© effectu√©; </li><li>  quelles commandes ont √©t√© appel√©es; </li><li>  quel acc√®s aux ressources externes a eu lieu; </li><li>  environnement d'assemblage utilis√©. </li></ul><br><p>  Si n√©cessaire, nous pouvons r√©pondre avec pr√©cision √† la question de savoir comment il a √©t√© assembl√©. </p><br><h4>  Communication bidirectionnelle de l'assembl√©e avec le ticket JIRA <br></h4><br><p>  Assurez-vous de pouvoir r√©soudre les probl√®mes suivants: </p><br><ol><li>  pour l'assemblage, cr√©ez une liste des tickets JIRA qui y sont inclus; </li><li>  √©crire dans le ticket JIRA dans quels assemblages il est inclus. </li></ol><br><p>  Une communication bidirectionnelle √©troite entre l'assembly et git commit est fournie.  Et puis, √† partir du texte des commentaires, vous pouvez d√©j√† d√©couvrir tous les liens vers JIRA. </p><br><h3>  La vitesse </h3><br><h4>  Caches de syst√®me d'assemblage </h4><br><p>  L'absence de cache Maven peut augmenter le temps de g√©n√©ration d'une heure. </p><br><p>  Le cache viole l'isolement de l'environnement d'assemblage et la propret√© de l'assemblage.  Ce probl√®me peut √™tre r√©solu en d√©terminant son origine pour chaque artefact mis en cache.  Nous avons chaque fichier cache associ√© √† un lien https √† partir duquel il a √©t√© t√©l√©charg√© une fois.  De plus, nous traitons la lecture d'un cache en tant qu'adresse r√©seau. </p><br><h4>  Caches de ressources r√©seau </h4><br><p>  La croissance g√©ographique de l'entreprise conduit √† la n√©cessit√© de transf√©rer des fichiers de 300 Mo entre les continents.  Beaucoup de temps est consacr√©, surtout si vous devez le faire souvent. </p><br><p>  R√©f√©rentiels Git, images docker des environnements d'assemblage, stockages de fichiers - tout doit √™tre soigneusement mis en cache.  Eh bien, bien s√ªr, p√©riodiquement propre. </p><br><h4>  Assemblage - aussi vite que possible, tout le reste - puis </h4><br><p>  La premi√®re √©tape: nous faisons le montage et imm√©diatement, sans gestes inutiles, nous donnons le r√©sultat. </p><br><p>  La deuxi√®me √©tape: validation, analyse, comptabilit√© et autre bureaucratie.  Cela peut d√©j√† √™tre fait dans un travail Jenkins s√©par√© et sans limites de temps strictes. </p><br><h2>  Quel est le r√©sultat </h2><br><ol><li>  L'essentiel est que l' <i>assemblage soit devenu clair pour les d√©veloppeurs</i> , eux-m√™mes peuvent le d√©velopper et l'optimiser. </li><li>  La fondation a √©t√© cr√©√©e pour construire des processus m√©tier qui d√©pendent de l'assemblage: installation, gestion des probl√®mes, tests, gestion des versions, etc. </li><li>  L'√©quipe DevOps n'√©crit plus de scripts d'assemblage: les d√©veloppeurs le font. </li><li>  Les exigences complexes de l'entreprise se sont transform√©es en un rapport transparent avec une liste finale de contr√¥les. </li><li>  Tout le monde peut cr√©er n'importe quel r√©f√©rentiel simplement en appelant build.sh via une seule interface.  Il lui suffit de sp√©cifier simplement les coordonn√©es git du code source.  Cette personne peut √™tre chef d'√©quipe, ing√©nieur QA / IT, etc. </li></ol><br><p>  Et quelques chiffres </p><br><ol><li>  Co√ªts de temps.   15    Jenkins job    build.sh.   15    docker-,   ,  .      .        . </li><li>  .         .      2200 .   ‚Äî  on-commit-. </li><li>      300 git-,     . </li><li>      30   ,   (25 ) ‚Äî  docker. </li><li>      ,     : <br><ol><li> glide, golang, promu; </li><li> maven, gradle; </li><li> python &amp; pip; </li><li> ruby; </li><li> nodejs &amp; npm; </li><li> docker; </li><li> rpm build tools &amp; gcc; </li><li>  Android   ADT; </li><li>  ; </li><li>    legacy-; </li><li>   . </li></ol><br></li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr421423/">https://habr.com/ru/post/fr421423/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr421413/index.html">Acc√®s correct aux m√©thodes d'interface par d√©faut gr√¢ce √† la r√©flexion dans Java 8, 9, 10</a></li>
<li><a href="../fr421415/index.html">Magic Leap - trash trash</a></li>
<li><a href="../fr421417/index.html">Machine √† caf√© pour les accros au caf√© ou machine √† caf√© mobile Wacaco</a></li>
<li><a href="../fr421419/index.html">Ode au nickel ¬´mouss√©¬ª, aux saphirs inexistants et au sous-ministre sovi√©tique: l'OTTO SX-P1 embl√©matique au Japon, aux USA et en URSS</a></li>
<li><a href="../fr421421/index.html">LAppS: un demi-million de messages WebSocket de 1 Ko par seconde avec TLS sur un processeur</a></li>
<li><a href="../fr421425/index.html">Apprivoiser et consolider: l'histoire du passage √† Oracle Supercluster</a></li>
<li><a href="../fr421429/index.html">LSTM - ANN Prix dynamique dans la vente au d√©tail d'articles m√©nagers</a></li>
<li><a href="../fr421431/index.html">Gestion du temps ou gestion efficace du chaos</a></li>
<li><a href="../fr421433/index.html">Il restait exactement un jour avant le d√©marrage du serveur.</a></li>
<li><a href="../fr421435/index.html">"Pourquoi faisons-nous tous cela?" - Cr√©ateur de Prisma et ancien chef de projet VK √† propos de son nouveau projet secret</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>