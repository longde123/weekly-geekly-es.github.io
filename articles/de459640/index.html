<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõ∞Ô∏è üë©üèº‚Äç‚öñÔ∏è üëÅ‚Äçüó® Dokumente als Code. Teil 1: Automatisieren Sie das Update üî¨ ‚è´ üöµüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In gro√üen Projekten, die aus Dutzenden und Hunderten von interagierenden Diensten bestehen, wird ein Ansatz zur Dokumentation als Code - Dokumente als...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dokumente als Code. Teil 1: Automatisieren Sie das Update</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/youla/blog/459640/"><p><img src="https://habrastorage.org/webt/cw/mu/zp/cwmuzpbeunmmybhxtwlffemf01k.gif"></p><br><p>  In gro√üen Projekten, die aus Dutzenden und Hunderten von interagierenden Diensten bestehen, wird ein Ansatz zur Dokumentation als Code - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumente als Code</a> - immer zwingender. </p><br><p>  Ich werde zeigen, wie Sie diese Philosophie in der Realit√§t des klassifizierten Dienstes anwenden k√∂nnen, oder besser gesagt, ich beginne mit der ersten Phase ihrer Implementierung: der Automatisierung der Aktualisierung von Daten in der Dokumentation. </p><a name="habracut"></a><br><h2 id="nabor-instrumentov">  Werkzeugsatz </h2><br><p>  Das Prinzip ‚ÄûDokumentation als Code‚Äú impliziert die Verwendung derselben Tools beim Schreiben von Dokumentation wie beim Erstellen von Code: Textauszeichnungssprachen, Versionskontrollsysteme, Code√ºberpr√ºfung und automatische Tests.  Das Hauptziel: Schaffung von Bedingungen f√ºr die Zusammenarbeit des gesamten Teams am Endergebnis - eine vollst√§ndige Wissensbasis und Anweisungen zur Verwendung einzelner Produktdienstleistungen.  Als n√§chstes werde ich √ºber spezifische Tools sprechen, die wir ausgew√§hlt haben, um dieses Problem zu l√∂sen. </p><br><p>  Als Text-Markup-Sprache haben wir uns f√ºr den universellsten entschieden - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">reStructuredText</a> .  Neben einer Vielzahl von Anweisungen, die alle grundlegenden Funktionen zum Strukturieren von Text bereitstellen, unterst√ºtzt diese Sprache wichtige endg√ºltige Formate, einschlie√ülich des f√ºr unser Projekt erforderlichen HTML-Codes. </p><br><p>  Dateien werden mit dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sphinx-</a> Dokumentationsgenerator von .rst nach .html konvertiert.  Sie k√∂nnen statische Websites erstellen, f√ºr die Sie eigene <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Themen</a> erstellen oder vorgefertigte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Themen verwenden k√∂nnen</a> .  Unser Projekt verwendet zwei vorgefertigte Themen - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Stanford-Thema</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bootstrap-Thema</a> .  Das zweite enth√§lt Unterthemen, mit denen Sie verschiedene Farbschemata f√ºr wichtige Elemente der Benutzeroberfl√§che festlegen k√∂nnen. </p><br><p>  F√ºr einen bequemen und schnellen Zugriff auf die aktuelle Version der Dokumentation verwenden wir eine statische Site, die von einer virtuellen Maschine gehostet wird, auf die √ºber das lokale Netzwerk des Entwicklungsteams zugegriffen werden kann. </p><br><p>  Die Quelldateien des Projekts werden im Bitbucket-Repository gespeichert, und die Site wird nur aus den im Hauptzweig enthaltenen Dateien generiert.  Das Aktualisieren der darin enthaltenen Daten ist nur √ºber eine Pull-Anfrage m√∂glich, mit der Sie alle neuen Abschnitte der Dokumentation √ºberpr√ºfen k√∂nnen, bevor sie √∂ffentlich ver√∂ffentlicht werden. </p><br><p>  Da zwischen dem Abschluss eines neuen Abschnitts der Dokumentation und dem Senden an die Site der Inhalt √ºberpr√ºft werden muss, besteht der Schl√ºsselprozess in der gesamten Kette darin, die Site zu erstellen und die Daten auf dem Host zu aktualisieren.  Dieser Vorgang sollte jedes Mal wiederholt werden, nachdem die Pull-Anforderung mit dem Update mit dem Hauptzweig des Projekts zusammengef√ºhrt wurde. </p><br><p><img src="https://habrastorage.org/webt/z3/ua/e9/z3uae9eyv-lj3sipqmirpbpoony.png"></p><br><p>  Die Implementierung dieser Logik erm√∂glicht <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jenkins</a> - in unserem Fall ein System zur kontinuierlichen Integration der Entwicklung - Dokumentation.  Ich werde Ihnen mehr √ºber die Einstellungen in den Abschnitten erz√§hlen: </p><br><ol><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hinzuf√ºgen eines neuen Knotens zu Jenkins</a></em> </li><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beschreibung von Jenkinsfile</a></em> </li><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jenkins und Bitbucket Integration</a></em> </li></ol><br><h2 id="dobavlenie-novogo-uzla-v-jenkins">  Hinzuf√ºgen eines neuen Knotens zu Jenkins </h2><br><p>  Um die Dokumentation auf der Site zu erstellen und zu aktualisieren, m√ºssen Sie einen Computer vorbereiten, der zuvor als <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jenkins-</a> Agent daf√ºr vorbereitet wurde. </p><br><h4 id="podgotovka-mashiny">  Maschinenvorbereitung </h4><br><p> Gem√§√ü <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">den Jenkins-Anforderungen</a> muss auf allen im System enthaltenen Komponenten, einschlie√ülich der Master-Maschine und aller registrierten Agentenknoten, JDK oder JRE installiert sein.  In unserem Fall wird <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">JDK 8</a> verwendet, f√ºr dessen Installation der Befehl ausgef√ºhrt werden kann: </p><br><pre><code class="plaintext hljs">sudo apt-get -y install java-1.8.0-openjdk git</code> </pre> <br><p>  Der Master-Computer stellt eine Verbindung zum Agenten her, um ihm zugewiesene Aufgaben auszuf√ºhren.  Dazu m√ºssen Sie auf dem Agenten einen Benutzer erstellen, unter dem alle Vorg√§nge ausgef√ºhrt werden und in dem alle von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jenkins</a> generierten Dateien im Home-Ordner gespeichert werden.  F√ºhren Sie auf Linux-Systemen einfach den folgenden Befehl aus: </p><br><pre> <code class="plaintext hljs">sudo adduser jenkins \--shell /bin/bash su jenkins</code> </pre> <br><p>  Um eine Verbindung zwischen dem Master-Computer und dem Agenten herzustellen, m√ºssen Sie SSH konfigurieren und die erforderlichen Autorisierungsschl√ºssel hinzuf√ºgen.  Wir werden die Schl√ºssel auf dem Agenten generieren und danach den √∂ffentlichen Schl√ºssel zur Datei " <code>authorized_keys</code> " f√ºr den Benutzer " <em>jenkins"</em> hinzuf√ºgen. </p><br><p>  Wir werden die Site mit der Dokumentation in einem Docker-Container unter Verwendung eines vorgefertigten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Python-</a> Images erstellen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">: 3.7</a> .  Befolgen Sie die Anweisungen in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">offiziellen Dokumentation</a> , um Docker auf dem Agenten zu installieren.  Um den Installationsvorgang abzuschlie√üen, m√ºssen Sie erneut eine Verbindung zum Agenten herstellen.  √úberpr√ºfen Sie die Installation, indem Sie den Befehl ausf√ºhren, mit dem das Testabbild geladen wird: </p><br><pre> <code class="plaintext hljs">docker run hello-world</code> </pre> <br><p>  Um Docker-Befehle nicht im Namen des Superusers (sudo) ausf√ºhren zu m√ºssen, reicht es aus, die in der Installationsphase erstellte Benutzer-Docker-Gruppe hinzuzuf√ºgen, f√ºr die die Befehle ausgef√ºhrt werden. </p><br><pre> <code class="plaintext hljs">sudo usermod -aG docker $USER</code> </pre> <br><h4 id="konfiguraciya-novogo-uzla-v-jenkins">  Jenkins neue Knotenkonfiguration </h4><br><p>  Da f√ºr die Verbindung zum Agenten eine Autorisierung erforderlich ist, m√ºssen Sie die entsprechenden Anmeldeinformationen in den Jenkins-Einstellungen hinzuf√ºgen.  Detaillierte Anweisungen dazu auf Windows-Computern finden Sie in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">offiziellen Jenkins-Dokumentation</a> . </p><br><blockquote>  WICHTIG: Die im Abschnitt <em>Jenkins konfigurieren</em> -&gt; <em>Build-Umgebungen verwalten</em> -&gt; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Knotenname</a> -&gt; Im Parameter <strong>Tags</strong> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">konfigurieren</a> angegebene <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kennung</a> wird in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jenkinsfile verwendet</a> , um den Agenten anzugeben, auf dem alle Vorg√§nge ausgef√ºhrt werden. </blockquote><br><h2 id="opisanie-jenkinsfile">  Beschreibung von Jenkinsfile </h2><br><p>  Das Stammverzeichnis des Projekt-Repositorys enth√§lt die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jenkins-Datei</a> , die Anweisungen enth√§lt f√ºr: </p><br><ul><li>  Vorbereiten der Build-Umgebung und Installieren von Abh√§ngigkeiten </li><li>  Erstellen Sie eine Site mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sphinx</a> </li><li>  Aktualisieren der Hostinformationen. </li></ul><br><p>  Anweisungen werden mithilfe spezieller Anweisungen festgelegt, deren Anwendung wir am Beispiel der im Projekt verwendeten Datei weiter betrachten werden. </p><br><h4 id="ukazanie-agenta">  Agentenanzeige </h4><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Geben Sie zu</a> Beginn der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jenkins-</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Datei</a> die Bezeichnung des Agenten in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jenkins an</a> , f√ºr den alle Vorg√§nge ausgef√ºhrt werden sollen.  Verwenden Sie dazu die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Agentenanweisung</a> : </p><br><pre> <code class="plaintext hljs">agent { label '-' }</code> </pre> <br><h4 id="podgotovka-sredy">  Umweltvorbereitung </h4><br><p>  Um den Befehl sphinx-build site build auszuf√ºhren, m√ºssen Sie Umgebungsvariablen festlegen, in denen die tats√§chlichen Datenpfade gespeichert werden.  Um die Informationen auf dem Host zu aktualisieren, m√ºssen Sie im Voraus die Pfade angeben, in denen die Standortdaten mit der Dokumentation gespeichert sind.  Mit der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Umgebungsrichtlinie</a> k√∂nnen Sie diese Werte Variablen zuweisen: </p><br><pre> <code class="plaintext hljs">environment { SPHINX_DIR = '.' //,    Sphinx BUILD_DIR = 'project_home_built' //    SOURCE_DIR = 'project_home_source' //   .rst  .md  DEPLOY_HOST = 'username@127.1.1.0:/var/www/html/' //@IP__:__ }</code> </pre> <br><h4 id="osnovnye-deystviya">  Hauptaktionen </h4><br><p>  Die Hauptanweisungen, die in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jenkinsfile</a> ausgef√ºhrt werden, sind in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Stufenanweisung</a> enthalten, die aus den verschiedenen Schritten besteht, die durch die Stufenanweisungen beschrieben <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">werden</a> .  Ein einfaches Beispiel f√ºr eine dreistufige CI-Pipeline: </p><br><pre> <code class="plaintext hljs">pipeline { agent any stages { stage('Build') { steps { echo 'Building..' } } stage('Test') { steps { echo 'Testing..' } } stage('Deploy') { steps { echo 'Deploying....' } } } }</code> </pre> <br><h4 id="zapusk-konteynera-docker-i-ustanovka-zavisimostey">  Starten Sie den Docker-Container und installieren Sie Abh√§ngigkeiten </h4><br><p>  F√ºhren Sie zun√§chst den Docker-Container mit dem fertigen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Python-</a> Image aus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">: 3.7</a> .  Verwenden Sie dazu den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Befehl</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">docker</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">run</a> mit den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Flags --rm</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">-i</a> .  F√ºhren Sie dann nacheinander folgende Schritte aus: </p><br><ul><li>  Installieren Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Python Virtualenv</a> . </li><li>  Erstellen und Aktivieren einer neuen virtuellen Umgebung; </li><li>  Installieren Sie darin alle erforderlichen Abh√§ngigkeiten, die in der Datei aufgef√ºhrt sind <br>  require.txt, die im Stammverzeichnis des Projekt-Repositorys gespeichert ist. </li></ul><br><pre> <code class="plaintext hljs">stage('Install Dependencies') { steps { sh ''' docker run --rm -i python:3.7 python3 -m pip install --user --upgrade pip python3 -m pip install --user virtualenv python3 -m virtualenv pyenv . pyenv/bin/activate pip install -r \${SPHINX\_DIR}/requirements.txt ''' } }</code> </pre> <br><h4 id="sborka-sayta-s-dokumentaciey">  Erstellen Sie eine Site mit Dokumentation </h4><br><p>  Jetzt erstellen wir eine Site.  F√ºhren Sie dazu den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Befehl sphinx-build</a> mit den folgenden Flags aus: </p><br><p>  <code>-q</code> : nur Protokollwarnungen und Fehler; <br>  <code>-w</code> : schreibe ein Protokoll in die nach dem Flag angegebene Datei; <br>  <code>-b</code> : Name des Site Builders; <br>  <code>-d</code> : Geben Sie das Verzeichnis zum Speichern zwischengespeicherter Dateien an - doctree pickles. </p><br><p>  L√∂schen Sie vor dem Starten der Assembly mit dem <code>rm -rf</code> die vorherige Site-Assembly und die Protokolle.  Im Falle eines Fehlers in einer der Phasen wird das Ausf√ºhrungsprotokoll f√ºr die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sphinx-Erstellung</a> in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jenkins-</a> Konsole angezeigt. </p><br><pre> <code class="plaintext hljs">stage('Build') { steps { // clear out old files sh 'rm -rf ${BUILD_DIR}' sh 'rm -f ${SPHINX_DIR}/sphinx-build.log' sh ''' ${WORKSPACE}/pyenv/bin/sphinx-build -q -w ${SPHINX_DIR}/sphinx-build.log \ -b html \ -d ${BUILD_DIR}/doctrees ${SOURCE\_DIR} ${BUILD\_DIR} ''' } post { failure { sh 'cat ${SPHINX_DIR}sphinx-build.log' } } }</code> </pre> <br><h4 id="obnovlenie-sayta-na-hoste">  Host-Site-Update </h4><br><p>  Und schlie√ülich werden wir die Informationen auf dem Host, der die Site bedient, mit der in der lokalen Umgebung verf√ºgbaren Produktdokumentation aktualisieren.  In der aktuellen Implementierung ist der Host dieselbe virtuelle Maschine, die als Jenkins-Agent f√ºr die Zusammenstellung und Aktualisierung der Dokumentation registriert ist. </p><br><p>  Als Synchronisationstool verwenden wir das Dienstprogramm <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">rsync</a> .  Damit es ordnungsgem√§√ü funktioniert, muss eine SSH-Verbindung zwischen dem Docker-Container, in dem sich die Site mit der Dokumentation befand, und dem Host konfiguriert werden. </p><br><p>  Um die SSH-Verbindung mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jenkinsfile</a> zu konfigurieren, m√ºssen die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">folgenden Plugins</a> in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jenkins</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">installiert sein</a> : </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SSH Agent Plugin</a> - Mit dieser <code>sshagent</code> k√∂nnen Sie den Schritt <code>sshagent</code> in Skripten verwenden, um Anmeldeinformationen f√ºr den <em>Benutzernamen / Schl√ºssel</em> des Formulars bereitzustellen. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SSH Credentials Plugin</a> - Erm√∂glicht das Speichern von Anmeldeinformationen des Formularbenutzernamens <em>/ -schl√ºssels</em> in den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jenkins-</a> Einstellungen. </li></ol><br><p>  Nach der Installation der Plugins m√ºssen Sie die aktuellen Anmeldeinformationen f√ºr die Verbindung zum Host angeben, indem Sie das Formular im Abschnitt <strong>Anmeldeinformationen</strong> ausf√ºllen: </p><br><ul><li>  <strong>ID</strong> : Kennung, die in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jenkinsfile</a> in Schritt <code>sshagent</code> , um bestimmte Anmeldeinformationen anzugeben ( <code>docs-deployer</code> ); </li><li>  <strong>Benutzername</strong> : Der Benutzername, unter dem die Aktualisierungsvorg√§nge f√ºr die Site-Daten ausgef√ºhrt werden (der Benutzer muss <strong><em>Schreibzugriff auf den</em></strong> Ordner <code>/var/html</code> des Hosts haben). </li><li>  <strong>Privater Schl√ºssel</strong> : Ein privater Schl√ºssel f√ºr den Zugriff auf den Host. </li><li>  <strong>Passphrase</strong> : Passwort f√ºr den Schl√ºssel, falls dieser in der Generierungsphase festgelegt wurde. </li></ul><br><p>  Unten finden Sie den Skriptcode, der √ºber SSH eine Verbindung herstellt und die Informationen auf dem Host mithilfe der Systemvariablen aktualisiert, die in der Phase der Vorbereitung der Umgebung mit den Pfaden zu den erforderlichen Daten angegeben wurden.  Das Ergebnis des Befehls <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">rsync</a> wird in das Protokoll geschrieben, das bei Synchronisationsfehlern in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jenkins-</a> Konsole angezeigt wird. </p><br><pre> <code class="plaintext hljs">stage('Deploy') { steps { sshagent(credentials: ['docs-deployer']) { sh ''' #!/bin/bash rm -f ${SPHINX_DIR}/rsync.log RSYNCOPT=(-aze 'ssh -o StrictHostKeyChecking=no') rsync "${RSYNCOPT[@]}" \ --delete \ ${BUILD_DIR_CI} ${DEPLOY_HOST}/ ''' } } post { failure { sh 'cat ${SPHINX_DIR}/rsync.log' } } }</code> </pre> <br><h2 id="integraciya-jenkins-i-bitbucket">  Jenkins und Bitbucket Integration </h2><br><p>  Es gibt viele M√∂glichkeiten, die Interaktion von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jenkins</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bitbucket</a> zu organisieren. In unserem Projekt haben wir uns jedoch f√ºr das Plugin " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Parametrisierte Builds f√ºr Jenkins" entschieden</a> .  Die offizielle Dokumentation enth√§lt detaillierte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anweisungen zur Installation des</a> Plugins sowie die Einstellungen, die f√ºr beide Systeme angegeben werden m√ºssen.  Um mit diesem Plugin arbeiten zu k√∂nnen, m√ºssen Sie einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jenkins-</a> Benutzer erstellen und ein spezielles Token f√ºr ihn generieren, mit dem sich dieser Benutzer beim System anmelden kann. </p><br><h4 id="sozdanie-polzovatelya-i-api-tokena">  Erstellen eines Benutzer- und API-Tokens </h4><br><p>  Um einen neuen Benutzer in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jenkins</a> zu erstellen, gehen Sie zu <em>Jenkins-Einstellungen</em> -&gt; <em>Benutzerverwaltung</em> -&gt; <em>Benutzer erstellen</em> und f√ºllen Sie alle erforderlichen Anmeldeinformationen im Formular aus. </p><br><p>  Der Authentifizierungsmechanismus, mit dem Skripts oder Anwendungen von Drittanbietern die Jenkins-API verwenden k√∂nnen, ohne das Benutzerkennwort tats√§chlich zu √ºbertragen, ist ein spezielles API-Token, das f√ºr jeden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jenkins-</a> Benutzer generiert werden kann.  Daf√ºr: </p><br><ul><li>  Melden Sie sich bei der Verwaltungskonsole mit den Details des zuvor erstellten Benutzers an. </li><li>  Gehen Sie zu <em>Jenkins konfigurieren</em> -&gt; <em>Benutzerverwaltung</em> . </li><li>  Klicken Sie auf das Zahnradsymbol rechts neben dem Benutzernamen, unter dem sie im System autorisiert sind. </li><li>  Suchen Sie <em>die Token-API</em> in der Liste der Parameter und klicken Sie auf die Schaltfl√§che <em>Neues Token</em> hinzuf√ºgen. </li><li>  Geben Sie im angezeigten Feld die Kennung des API-Tokens an und klicken Sie auf die Schaltfl√§che <em>Generieren</em> . </li><li>  Kopieren Sie das generierte API-Token und speichern Sie es, indem Sie der Eingabeaufforderung auf dem Bildschirm folgen. </li></ul><br><p>  Jetzt k√∂nnen Sie in den Einstellungen des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bitbucket-</a> Servers den Standardbenutzer angeben, der eine Verbindung zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jenkins herstellen soll</a> . </p><br><h2 id="zaklyuchenie">  Fazit </h2><br><p>  Wenn fr√ºher, bestand der Prozess aus mehreren Schritten: </p><br><ul><li>  Laden Sie das Update in das Repository herunter </li><li>  Warten Sie auf die Best√§tigung der Richtigkeit. </li><li>  eine Website mit Dokumentation zusammenstellen; </li><li>  Informationen auf dem Host aktualisieren; </li></ul><br><p>  Klicken Sie jetzt einfach auf eine Schaltfl√§che In Bitbucket zusammenf√ºhren.  Wenn nach der √úberpr√ºfung keine √Ñnderungen an den Quelldateien erforderlich sind, wird die aktuelle Version der Dokumentation sofort nach Best√§tigung der Richtigkeit der Daten aktualisiert. </p><br><p>  Dies vereinfacht die Aufgabe des technischen Redakteurs erheblich und erspart ihm eine Vielzahl manueller Aktionen. Projektmanager erhalten ein praktisches Tool zum Verfolgen von Dokumentationserg√§nzungen und Feedback. </p><br><p>  Die Automatisierung dieses Prozesses ist der erste Schritt beim Aufbau einer Dokumentationsverwaltungsinfrastruktur.  In Zukunft planen wir, automatische Tests hinzuzuf√ºgen, die die Richtigkeit der in der Dokumentation verwendeten externen Links √ºberpr√ºfen, und interaktive Schnittstellenobjekte zu erstellen, die in vorgefertigte Themen f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sphinx integriert sind</a> . </p><br><p>  Dank derer, die dies zur Kenntnis genommen haben, werden wir bald weiterhin die Details der Dokumentationserstellung in unserem Projekt teilen! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de459640/">https://habr.com/ru/post/de459640/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de459624/index.html">Milit√§rische Drohnen</a></li>
<li><a href="../de459626/index.html">Windows Notification Facility: Die am wenigsten dokumentierte Angriffsfl√§che</a></li>
<li><a href="../de459628/index.html">Das Open Invention Network hat mehr als dreitausend Lizenznehmer - was bedeutet das f√ºr Open Source-Software?</a></li>
<li><a href="../de459630/index.html">Tic Tac Toe Teil 2: Staatenloses R√ºckg√§ngigmachen / Wiederherstellen</a></li>
<li><a href="../de459638/index.html">Schaffung einer globalen Wissensbasis √ºber Batterien</a></li>
<li><a href="../de459642/index.html">Sicherer Zugriff auf Registerfelder in C ++ ohne Einbu√üen bei der Effizienz (am Beispiel von CortexM)</a></li>
<li><a href="../de459644/index.html">LED-Dimmer</a></li>
<li><a href="../de459648/index.html">Im Analysator sollte alles in Ordnung sein: sowohl Funktionalit√§t als auch Schnittstelle ... Wir untersuchen die neue Solar AppScreener 3.1-Schnittstelle</a></li>
<li><a href="../de459650/index.html">So verlieren Sie kein Geld in der Black Box: Abrechnungstestmethoden</a></li>
<li><a href="../de459652/index.html">Automatisierter Regressionstestansatz</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>