<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚟 👨‍👩‍👧 🤰🏼 Benutzerdefinierte Coroutinen in Einheit mit Vorlieben und Kurtisanen ♌️ 😓 👸🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sie sind bereits so cool, dass Sie Coroutinen gleichzeitig um alle Achsen drehen. Auf einen Blick führen sie eine yield break und verstecken sich hint...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Benutzerdefinierte Coroutinen in Einheit mit Vorlieben und Kurtisanen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442820/"><p><img src="https://habrastorage.org/webt/ba/4v/xo/ba4vxoon1fdwi28pizrv99yg6cy.jpeg"></p><br><p> Sie sind bereits so cool, dass Sie Coroutinen gleichzeitig um alle Achsen drehen. Auf einen Blick führen sie eine <code>yield break</code> und verstecken sich hinter der IDE-Leinwand.  Einfache <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wrapper</a> sind längst vorbei. </p><br><p>  Sie wissen, wie man sie so gut kocht, dass Sie einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Michelin-</a> Stern (oder sogar zwei) bekommen könnten, wenn Sie ein eigenes Restaurant hätten.  Natürlich!  Niemand wird gleichgültig sein, wenn Sie Ihre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bouillabaisse</a> mit Coroutinensauce probieren. </p><br><p>  Für eine ganze Woche fällt der Code im Produkt nicht!  Wrapper, <code>callback</code> 'und <code>Start/Stop Coroutine</code> sind die Menge der Slaves.  Sie brauchen mehr Kontrolle und Handlungsfreiheit.  Sie sind bereit, den nächsten Schritt zu erklimmen (aber natürlich keine Coroutinen zu beenden). </p><br><p>  Wenn Sie sich in diesen Zeilen wiedererkennen, sind Sie bei cat willkommen. </p><br><p><a name="habracut"></a>  Ich nutze diese Gelegenheit, um eines meiner Lieblingsmuster zu begrüßen - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Command</a> . </p><br><h2 id="vvedenie">  Einführung </h2><br><p>  Für alle von Unity <code>Coroutine</code> <code>AsyncOperation</code> ( <code>Coroutine</code> , <code>AsyncOperation</code> , <code>WaiForSeconds</code> und andere) ist die Basisklasse die unauffällige <code>YieldInstruction</code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">docs</a> ) -Klasse: </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">StructLayout (LayoutKind.Sequential)</span></span>] [UsedByNativeCode] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">YieldInstruction</span></span> { }</code> </pre> <br><p>  Unter der Haube sind Coroutinen gewöhnliche Enumeratoren ( <code>IEnumerator</code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">docs</a> )).  Jeder Frame wird von der <code>MoveNext()</code> -Methode aufgerufen.  Wenn der Rückgabewert <code>true</code> , wird die Ausführung bis zur nächsten <code>yield</code> Anweisung verzögert. Wenn <code>false</code> , wird sie gestoppt. </p><br><p>  Für benutzerdefinierte <code>yield</code> stellt Unity die gleichnamige <code>CustomYieldInstruction</code> Klasse ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">docs</a> ) <code>CustomYieldInstruction</code> . </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CustomYieldInstruction</span></span> : <span class="hljs-title"><span class="hljs-title">IEnumerator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> keepWaiting { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> Current =&gt; <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveNext</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Reset</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre><br><p>  Es reicht aus, davon zu erben und die keepWaiting-Eigenschaft zu implementieren.  Wir haben seine Logik bereits oben diskutiert.  Es sollte <code>true</code> , solange Coroutine ausgeführt werden soll. </p><br><p>  Beispiel aus der Dokumentation: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WaitForMouseDown</span></span> : <span class="hljs-title"><span class="hljs-title">CustomYieldInstruction</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> keepWaiting { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !Input.GetMouseButtonDown(<span class="hljs-number"><span class="hljs-number">1</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WaitForMouseDown</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Debug.Log(<span class="hljs-string"><span class="hljs-string">"Waiting for Mouse right button down"</span></span>); } }</code> </pre> <br><p>  Ihr zufolge wird der <code>keepWating</code> Getter jeden Frame nach <code>Update()</code> und vor <code>LateUpdate()</code> . </p><br><p>  <em>Wenn Sie mit Code arbeiten, in dem bestimmte Dinge zu einem bestimmten Zeitpunkt funktionieren sollten, und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diese</a> Seite noch nicht studiert <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">haben</a> , empfehle ich dringend, sich für dieses Kunststück zu entscheiden.</em> </p><br><h2 id="kastomnye-yield-instrukcii">  Benutzerdefinierte Ertragsanweisungen </h2><br><p><img src="https://habrastorage.org/webt/4p/wt/xf/4pwtxfv0kjogj_2zwcrm-sputhc.jpeg"></p><br><p>  Wir sind jedoch nicht mit regulären Wrappern wie der <code>CustomYieldInstruction</code> um sie <code>CustomYieldInstruction</code> erben.  Dafür können Sie ohne Michelin bleiben. </p><br><p>  Deshalb rauchen wir die Dokumentation weiter und fast am Ende <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">derselben</a> Seite finden wir den wichtigsten Absatz. </p><br><p>  <strong>Um mehr Kontrolle zu haben und komplexere Ertragsanweisungen zu implementieren, können Sie direkt von der</strong> <code>System.Collections.IEnumerator</code> <strong>Klasse</strong> <strong>erben</strong> <strong>.</strong>  <strong>Implementieren</strong> <code>MoveNext()</code> <strong>in diesem Fall die</strong> <code>MoveNext()</code> <strong>-Methode genauso, wie Sie die</strong> <code>keepWaiting</code> <strong>Eigenschaft</strong> <strong>implementieren</strong> <code>keepWaiting</code> <strong>.</strong>  <strong>Darüber hinaus können Sie in der Eigenschaft <code>Current</code> ein Objekt zurückgeben, das nach Ausführung der MoveNext</strong> <code>MoveNext()</code> <strong>-Methode</strong> <strong>vom Coroutine-Scheduler von Unity verarbeitet wird</strong> <strong>.</strong>  <strong>Wenn</strong> <code>Current</code> <strong>beispielsweise ein</strong> <strong>anderes Objekt</strong> <code>IEnumerator</code> <strong>,</strong> <strong>das von</strong> <code>IEnumerator</code> <strong>, wird der aktuelle Enumerator angehalten, bis der zurückgegebene abgeschlossen ist.</strong> </p><br><div class="spoiler">  <b class="spoiler_title">Auf Russisch</b> <div class="spoiler_text"><p>  <strong>Um mehr Kontrolle zu erhalten und komplexere</strong> <code>yield</code> <strong>implementieren</strong> <strong>, können Sie direkt von der</strong> <code>System.Collections.IEnumerator</code> <strong>Schnittstelle erben</strong> <strong>.</strong>  <strong>Implementieren</strong> <code>MoveNext()</code> <strong>in diesem Fall die</strong> <code>MoveNext()</code> <strong>-Methode</strong> <strong>auf dieselbe Weise wie die</strong> <code>keepWaiting</code> <strong>Eigenschaft</strong> <strong>.</strong>  <strong>Darüber hinaus können Sie das Objekt in der</strong> <code>Current</code> <strong>Eigenschaft verwenden</strong> <strong>, die vom Unity-Coroutine-Scheduler nach Ausführung der</strong> <code>MoveNext()</code> <strong>-Methode verarbeitet wird</strong> <strong>.</strong>  <strong>Wenn die</strong> <code>Current</code> <strong>Eigenschaft beispielsweise ein</strong> <strong>anderes Objekt zurückgibt, das die</strong> <code>IEnumerator</code> <strong>Schnittstelle implementiert</strong> <strong>, wird die Ausführung des aktuellen Enumerators bis zum Abschluss des neuen verzögert.</strong> </p></div></div><br><p>  Heilige Muscheln!  Dies sind die Kontrollen und die Handlungsfreiheit, die ich so sehr wollte.  Nun, das ist es, jetzt wickelst du so viele Corutins ein, dass kein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gimbal Lock</a> beängstigend ist.  Die Hauptsache, aus Glück, stupste von der Vertukha, nicht zu schlagen. </p><br><h3 id="interfeys">  Schnittstelle </h3><br><p>  Nun, es wäre schön, zunächst zu entscheiden, welche Schnittstelle der Interaktion mit unserer Anweisung wir haben möchten.  Einige minimale Menge. </p><br><p>  Ich schlage die folgende Option vor </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IInstruction</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsExecuting { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsPaused { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-function">Instruction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pause</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Resume</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Terminate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Started; <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Paused; <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Cancelled; <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Done; }</code> </pre> <br><p>  Ich möchte Ihre Aufmerksamkeit auf die Tatsache <code>IsExecuting</code> , dass <code>IsExecuting</code> und <code>IsPaused</code> nicht das Gegenteil sind.  Wenn die Ausführung von Coroutine angehalten wird, wird sie noch ausgeführt. </p><br><h3 id="pasyans-i-kurtizanki">  Solitaire und Kurtisane </h3><br><p>  Wie in der Dokumentation angegeben, müssen Sie die <code>IEnumerator</code> Schnittstelle implementieren.  Lassen Sie uns an einigen Stellen vorerst die Stubs verlassen, da ihre Implementierung direkt davon abhängt, welche Funktionen wir in sie einfügen möchten. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IEnumerator = System.Collections.IEnumerator; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Instruction</span></span> : <span class="hljs-title"><span class="hljs-title">IEnumerator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Instruction current; <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> IEnumerator.Current =&gt; current; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> IEnumerator.Reset() { } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IEnumerator.MoveNext() { } }</code> </pre> <br><p>  Es ist zu bedenken, dass es mindestens zwei Möglichkeiten gibt, wie unser Unterricht gestartet werden kann: </p><br><ol><li><p>  <code>StartCoroutine(IEnumerator routine)</code> Methode <code>StartCoroutine(IEnumerator routine)</code> : </p><br><pre> <code class="plaintext hljs">StartCoroutine(new ConcreteInstruction());</code> </pre> <br></li><li><p>  Ertragserklärung: </p><br><pre> <code class="plaintext hljs">private IEnumerator SomeRoutine() { yield return new ConcreteInstruction(); }</code> </pre> <br></li></ol><br><p>  Die <code>Execute</code> Methode, die wir oben in der <code>IInstruction</code> Schnittstelle beschrieben haben, verwendet die erste Methode.  Daher fügen wir einige Felder hinzu, die in diesem Fall die Verwaltung der Anweisung erleichtern. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> routine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> MonoBehaviour Parent { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre> <br><p>  Jetzt Eigenschaften und Ereignisse für <code>IInstruction</code> . </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IEnumerator = System.Collections.IEnumerator; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Instruction</span></span> : <span class="hljs-title"><span class="hljs-title">IEnumerator</span></span>, <span class="hljs-title"><span class="hljs-title">IInstruction</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Instruction current; <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> IEnumerator.Current =&gt; current; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> routine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> MonoBehaviour Parent { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsExecuting { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsPaused { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsStopped { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Started; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Paused; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Terminated; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruciton&gt; Done; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> IEnumerator.Reset() { } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IEnumerator.MoveNext() { } Instruction(MonoBehaviour parent) =&gt; Parent = parent; }</code> </pre> <br><p>  Methoden zum Behandeln von Ereignissen in untergeordneten Klassen: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStarted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPaused</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnResumed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnTerminated</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDone</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { }</code> </pre> <br><p>  Sie werden unmittelbar vor den entsprechenden Ereignissen manuell aufgerufen, um den untergeordneten Klassen die Priorität ihrer Verarbeitung zu geben. </p><br><p>  Nun die restlichen Methoden. </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pause</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsExecuting &amp;&amp; !IsPaused) { IsPaused = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; OnPaused(); Paused?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Resume</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsExecuting) { IsPaused = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; OnResumed(); } }</code> </pre> <br><p>  Hier ist alles einfach.  Der Befehl kann nur angehalten werden, wenn er ausgeführt wird und nicht angehalten wurde, und die Ausführung nur fortsetzen, wenn er angehalten ist. </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Terminate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Stop()) { OnTerminated(); Terminate?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsExecuting) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (routine <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Coroutine) Parent.StopCoroutine(routine <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Coroutine); (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IEnumerator).Reset(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> IsStopped = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br><p>  Die Grundlogik zum Stoppen von Anweisungen wurde in die <code>Stop</code> Methode verschoben.  Dies ist notwendig, um einen stillen Stopp durchführen zu können (ohne Ereignisse auszulösen). <br>  Überprüfen Sie, <code>if (routine is Coroutine)</code> erforderlich <code>if (routine is Coroutine)</code> , da die Anweisung, wie oben beschrieben, über die <code>yield</code> gestartet werden kann ( <code>StartCoroutine</code> ohne <code>StartCoroutine</code> ). <code>StartCoroutine</code> bedeutet, dass möglicherweise keine Verknüpfung zu einer bestimmten Instanz von <code>Coroutine</code> .  In diesem Fall hat die <code>routine</code> nur ein Stub-Objekt. </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Instruction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MonoBehaviour parent</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Debug.LogWarning(<span class="hljs-string"><span class="hljs-string">$"Instruction </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{ GetType().Name}</span></span></span><span class="hljs-string"> is currently waiting for another one and can't be stared right now."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsExecuting) { IsExecuting = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; routine = (Parent = parent).StartCoroutine(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } Debug.LogWarning(<span class="hljs-string"><span class="hljs-string">$"Instruction </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{ GetType().Name}</span></span></span><span class="hljs-string"> is already executing."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }</code> </pre> <br><p>  Die Hauptstartmethode ist ebenfalls äußerst einfach: Der Start wird nur ausgeführt, wenn die Anweisung noch nicht gestartet wurde. </p><br><p>  Die Implementierung von <code>IEnumerator</code> , da wir in einigen Methoden Leerzeichen gelassen haben. </p><br><pre> <code class="cs hljs">IEnumerator.Reset() { IsExecuting = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; IsPaused = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; IsStopped = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; routine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br><p>  Und das interessanteste, aber nicht kompliziertere ist <code>MoveNext</code> : </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IEnumerator.MoveNext() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsStopped) { (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IEnumerator).Reset(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsExecuting) { IsExecuting = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; routine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>(); OnStarted(); Started?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsPaused) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Update()) { OnDone(); Done?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); IsStopped = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><p>  <code>if (!IsExecuting)</code> - Wenn die Anweisung nicht über <code>StartCoroutine</code> gestartet wurde und diese Codezeile ausgeführt wird, wurde sie von der <code>yield</code> gestartet.  Wir schreiben einen Stich in die <code>routine</code> und Feuerereignisse. </p><br><p>  <code>if (current != null)</code> - <code>current</code> für untergeordnete Anweisungen verwendet.  Wenn dies plötzlich aufgetaucht ist, warten wir auf sein Ende.  Bitte beachten Sie, dass ich den Prozess des Hinzufügens von Unterstützung für untergeordnete Anweisungen in diesem Artikel verpassen werde, um ihn nicht noch mehr aufzublasen.  Wenn Sie diese Funktionalität nicht weiter hinzufügen möchten, können Sie diese Zeilen einfach entfernen. </p><br><p>  <code>if (!Update())</code> - Die <code>Update</code> Methode in unseren Anweisungen funktioniert genauso wie <code>keepWaiting</code> in <code>CustomYieldInstruction</code> und sollte in einer <code>CustomYieldInstruction</code> Klasse implementiert werden.  <code>Instruction</code> ist nur eine abstrakte Methode. </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>;</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Gesamter Anweisungscode</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IEnumerator = System.Collections.IEnumerator; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Instruction</span></span> : <span class="hljs-title"><span class="hljs-title">IEnumerator</span></span>, <span class="hljs-title"><span class="hljs-title">IInstruction</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Instruction current; <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> IEnumerator.Current =&gt; current; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> routine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> MonoBehaviour Parent { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsExecuting { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsPaused { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsStopped { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Started; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Paused; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Terminated; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Done; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> IEnumerator.Reset() { IsPaused = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; IsStopped = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; routine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IEnumerator.MoveNext() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsStopped) { (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IEnumerator).Reset(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsExecuting) { IsExecuting = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; routine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>(); OnStarted(); Started?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsPaused) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Update()) { OnDone(); Done?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); IsStopped = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Instruction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MonoBehaviour parent</span></span></span><span class="hljs-function">)</span></span> =&gt; Parent = parent; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pause</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsExecuting &amp;&amp; !IsPaused) { IsPaused = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; OnPaused(); Paused?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Resume</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { IsPaused = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; OnResumed(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Terminate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Stop()) { OnTerminated(); Terminated?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsExecuting) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (routine <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Coroutine) Parent.StopCoroutine(routine <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Coroutine); (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IEnumerator).Reset(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> IsStopped = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Instruction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Debug.LogWarning(<span class="hljs-string"><span class="hljs-string">$"Instruction </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{ GetType().Name}</span></span></span><span class="hljs-string"> is currently waiting for another one and can't be stared right now."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsExecuting) { IsExecuting = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; routine = Parent.StartCoroutine(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } Debug.LogWarning(<span class="hljs-string"><span class="hljs-string">$"Instruction </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{ GetType().Name}</span></span></span><span class="hljs-string"> is already executing."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Instruction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MonoBehaviour parent</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Debug.LogWarning(<span class="hljs-string"><span class="hljs-string">$"Instruction </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{ GetType().Name}</span></span></span><span class="hljs-string"> is currently waiting for another one and can't be stared right now."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsExecuting) { IsExecuting = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; routine = (Parent = parent).StartCoroutine(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } Debug.LogWarning(<span class="hljs-string"><span class="hljs-string">$"Instruction </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{ GetType().Name}</span></span></span><span class="hljs-string"> is already executing."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Reset</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Terminate(); Started = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Paused = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Terminated = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Done = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStarted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPaused</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnResumed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnTerminated</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDone</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre> </div></div><br><h2 id="primery">  Beispiele </h2><br><p>  Die Basisklasse ist fertig.  Um Anweisungen zu erstellen, reicht es aus, sie zu erben und die erforderlichen Mitglieder zu implementieren.  Ich schlage vor, einige Beispiele anzuschauen. </p><br><h3 id="peredvizhenie-k-tochke">  Bewegen Sie sich zum Punkt </h3><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MoveToPoint</span></span> : <span class="hljs-title"><span class="hljs-title">Instruction</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform Transform { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 Target { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Speed { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Threshold { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveToPoint</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MonoBehaviour parent</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">parent</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Transform.position = Vector3.Lerp(Transform.position, Target, Time.deltaTime * Speed); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Vector3.Distance(Transform.position, Target) &gt;= Threshold; } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Startoptionen</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> move = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MoveToPoint(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) { Actor = transform, Target = target, Speed = <span class="hljs-number"><span class="hljs-number">1.0F</span></span>, Threshold = <span class="hljs-number"><span class="hljs-number">0.05F</span></span> }; move.Execute(); }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> move = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MoveToPoint(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); move.Execute(transform, target, <span class="hljs-number"><span class="hljs-number">1.0F</span></span>, <span class="hljs-number"><span class="hljs-number">0.05F</span></span>); }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">yield</span></span></span><span class="hljs-function"> return new </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveToPoint</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span></span><span class="hljs-function">)</span></span> { Actor = transform, Target = target, Speed = <span class="hljs-number"><span class="hljs-number">1.0F</span></span>, Threshold = <span class="hljs-number"><span class="hljs-number">0.05F</span></span> }; }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> move = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MoveToPoint(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) { Actor = transform, Target = target, Speed = <span class="hljs-number"><span class="hljs-number">1.0F</span></span>, Threshold = <span class="hljs-number"><span class="hljs-number">0.05F</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> move; }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> move = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MoveToPoint(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> move.Execute(transform, target, <span class="hljs-number"><span class="hljs-number">1.0F</span></span>, <span class="hljs-number"><span class="hljs-number">0.05F</span></span>); }</code> </pre> </div></div><br><h3 id="obrabotka-vvoda">  Eingabeverarbeitung </h3><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WaitForKeyDown</span></span> : <span class="hljs-title"><span class="hljs-title">Instruction</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> KeyCode Key { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !Input.GetKeyDown(Key); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WaitForKeyDown</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MonoBehaviour parent</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">parent</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Instruction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">KeyCode key</span></span></span><span class="hljs-function">)</span></span> { Key = key; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Execute(); } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Beispiele starten</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { car wait = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WaitForKeyDown(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); wait.Execute(KeyCode.Space).Done += (i) =&gt; DoSomething(); }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">yield</span></span></span><span class="hljs-function"> return new </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WaitForKeyDown</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span></span><span class="hljs-function">)</span></span> { Key = KeyCode.Space }; <span class="hljs-comment"><span class="hljs-comment">// do something; }</span></span></code> </pre> </div></div><br><h3 id="ozhidanie-i-pauza">  Warten Sie und halten Sie inne </h3><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Wait</span></span> : <span class="hljs-title"><span class="hljs-title">Instruction</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Delay { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> startTime; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Time.time - startTime &lt; Delay; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Wait</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MonoBehaviour parent</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">parent</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Wait</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delay, MonoBehaviour parent</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">parent</span></span></span><span class="hljs-function">)</span></span> { Delay = delay; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStarted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { startTime = Time.time; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Instruction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delay</span></span></span><span class="hljs-function">)</span></span> { Delay = delay; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Execute(); } }</code> </pre> <br><p>  Hier scheint alles so einfach wie möglich zu sein.  Zuerst haben wir die Startzeit aufgezeichnet und dann die Differenz zwischen der aktuellen Zeit und der <code>StartTime</code> .  Aber es gibt eine Nuance, die Sie nicht sofort bemerken können.  Wenn Sie während der Ausführung eines Befehls ihn anhalten (mithilfe der <code>Pause</code> Methode) und warten, wird er nach dem Fortsetzen ( <code>Resume</code> ) sofort ausgeführt.  Und das alles, weil diese Anweisung jetzt nicht berücksichtigt, dass ich sie anhalten kann. </p><br><p>  Versuchen wir, diese Ungerechtigkeit zu beheben: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPaused</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Delay -= Time.time - startTime; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnResumed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { startTime = Time.time; }</code> </pre> <br><p>  Fertig.  Jetzt, nach dem Ende der Pause, wird die Anweisung so lange ausgeführt, wie sie vor Beginn noch übrig war. </p><br><div class="spoiler">  <b class="spoiler_title">Beispiele starten</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wait = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Wait(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); wait.Execute(<span class="hljs-number"><span class="hljs-number">5.0F</span></span>).Done += (i) =&gt; DoSomething; }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">yield</span></span></span><span class="hljs-function"> return new </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Wait</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5.0F</span></span></span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-comment"><span class="hljs-comment">// do something; }</span></span></code> </pre> </div></div><br><h2 id="itog">  Zusammenfassung </h2><br><p>  Mit Coroutines in Unity können Sie erstaunliche und funktionale Dinge tun.  Aber wie komplex sie sein werden und ob Sie sie überhaupt brauchen, ist jedermanns persönliche Entscheidung. </p><br><p>  Die Funktionalität von Corutin zu erweitern ist nicht die schwierigste Aufgabe.  Alles, was Sie tun müssen, ist zu entscheiden, welche Schnittstelle Sie mit ihnen interagieren möchten und wie der Algorithmus ihrer Arbeit aussehen wird. </p><br><p>  Danke für deine Zeit.  Hinterlassen Sie Ihre Fragen / Kommentare / Ergänzungen in den Kommentaren.  Ich werde gerne kommunizieren. </p><br><hr><br><p>  PS Wenn Sie sich plötzlich wegen der Verwendung von Corutin verbrannt haben, lesen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesen</a> Kommentar und trinken Sie etwas Cooles. <br></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de442820/">https://habr.com/ru/post/de442820/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de442810/index.html">Mythen der Populärphysik, Fortsetzung: Schwerkraft</a></li>
<li><a href="../de442812/index.html">"Ich sehe keinen Grund, Python für die Arbeit mit Spark zu verwenden, außer Faulheit."</a></li>
<li><a href="../de442814/index.html">10 Jahre sind vergangen und niemand hat herausgefunden, wie man die Blockchain benutzt. Und wieder hier?</a></li>
<li><a href="../de442816/index.html">Erstellen Sie Ihren eigenen Gamecontroller</a></li>
<li><a href="../de442818/index.html">10 häufige Fehler in schriftlichem Englisch und wie man damit umgeht</a></li>
<li><a href="../de442822/index.html">Rechenzentrum im Meer und im Orbit: Haben sie praktische Bedeutung?</a></li>
<li><a href="../de442824/index.html">Willkommen im Silicon Valley</a></li>
<li><a href="../de442826/index.html">Social Engineering als Dramaturgie oder was die Phishing-Domäne und das Tschechow-Gewehr gemeinsam haben</a></li>
<li><a href="../de442828/index.html">IT-Management ohne Knoten und ohne Probleme</a></li>
<li><a href="../de442830/index.html">Anubis Schöpfer verhaftet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>