<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôçüèæ ü§¥üèæ üë∞üèº Wie ich das belarussische Internet NICHT gescannt habe ‚ô†Ô∏è ‚ö∞Ô∏è üëÅ‚Äçüó®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vorwort 
 Dieser Artikel ist nicht sehr √§hnlich zu denen, die zuvor √ºber das Scannen des Internets bestimmter L√§nder ver√∂ffentlicht wurden, da ich nic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie ich das belarussische Internet NICHT gescannt habe</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446022/"><h2>  Vorwort </h2><br>  Dieser Artikel ist nicht sehr √§hnlich zu denen, die zuvor √ºber das Scannen des Internets bestimmter L√§nder ver√∂ffentlicht wurden, da ich nicht die Ziele verfolgt habe, ein bestimmtes Segment des Internets nach offenen Ports und dem Vorhandensein der beliebtesten Sicherheitsl√ºcken zu durchsuchen, da dies gegen das Gesetz verst√∂√üt. <br><br>  Ich hatte eher ein etwas anderes Interesse - zu versuchen, alle relevanten Sites in der BY-Dom√§nenzone mit verschiedenen Methoden zu identifizieren, den Stapel der verwendeten Technologien durch Dienste wie Shodan, VirusTotal usw. zu bestimmen, eine passive Aufkl√§rung √ºber IP und offene Ports durchzuf√ºhren und im Anhang ein wenig anderes N√ºtzliches zu sammeln Informationen zur Erstellung einiger allgemeiner Statistiken zum Sicherheitsniveau in Bezug auf Websites und Benutzer. <br><a name="habracut"></a><br><h2>  Einf√ºhrung und unser Toolkit </h2><br>  Der Plan am Anfang war einfach: Wenden Sie sich an Ihren lokalen Registrar, um eine Liste der aktuell registrierten Domains zu erhalten. √úberpr√ºfen Sie dann alles auf Verf√ºgbarkeit und erkunden Sie funktionierende Websites.  In Wirklichkeit stellte sich heraus, dass alles viel komplizierter war - diese Art von Informationen war nat√ºrlich, niemand wollte sie bereitstellen, mit Ausnahme der offiziellen Statistikseite der tats√§chlich registrierten Domainnamen in der BY-Zone (ungef√§hr 130.000 Domains).  Wenn es keine solchen Informationen gibt, m√ºssen Sie sie selbst sammeln. <br><br><img src="https://habrastorage.org/webt/yh/pz/4w/yhpz4wvpvleq-f25o5fp5wwt_2u.png"><br><br>  In Bezug auf Werkzeuge ist in der Tat alles ganz einfach - wir schauen auf Open Source, Sie k√∂nnen immer etwas hinzuf√ºgen, einige minimale Kr√ºcken fertigstellen.  Von den beliebtesten wurden die folgenden Tools verwendet: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Whatweb</a> </li><li>  locken </li><li>  graben </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wafw00f</a> </li><li>  APIs von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Drittanbietern</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">VirusTotal</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Google SafeBrwosing</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Shodan</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vulners</a> ) </li></ul><br><br><h2>  Beginn der Aktivit√§ten: Ausgangspunkt </h2><br>  Als Einf√ºhrung waren, wie ich bereits sagte, idealerweise Domain-Namen geeignet, aber wo kann ich sie bekommen?  Wir m√ºssen von etwas Einfacherem ausgehen, in diesem Fall sind IP-Adressen f√ºr uns geeignet, aber auch hier ist es bei umgekehrten Suchvorg√§ngen nicht immer m√∂glich, alle Dom√§nen abzufangen, und beim Sammeln von Hostnamen ist dies nicht immer die richtige Dom√§ne.  Zu diesem Zeitpunkt begann ich erneut √ºber m√∂gliche Szenarien f√ºr das Sammeln dieser Art von Informationen nachzudenken - die Tatsache, dass unser Budget f√ºr die VPS-Vermietung 5 USD betrug, wurde ber√ºcksichtigt, alles andere sollte kostenlos sein. <br><br><h3>  Unsere potenziellen Informationsquellen: </h3><br><ul><li>  IP-Adressen ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ip2location</a> site) </li><li>  Suchen Sie nach Domains im zweiten Teil der E-Mail-Adresse (aber wo erhalten Sie sie? </li><li>  Einige Registrare / Hosting-Anbieter stellen uns solche Informationen m√∂glicherweise in Form von Subdomains zur Verf√ºgung </li><li>  Subdomains und ihre anschlie√üende Umkehrung (Sublist3r und Aquatone k√∂nnen hier helfen) </li><li>  Bruteforce und manuelle Eingabe (lang, trostlos, aber m√∂glich, obwohl ich diese Option nicht verwendet habe) </li></ul><br>  Ich werde ein wenig vorausgehen und sagen, dass ich mit diesem Ansatz ungef√§hr 50.000 eindeutige Domains bzw. Sites gesammelt habe (ich habe es nicht geschafft, alles zu verarbeiten).  Wenn er weiterhin aktiv Informationen gesammelt h√§tte, h√§tte mein F√∂rderer mit Sicherheit in weniger als einem Monat Arbeit die gesamte Datenbank oder den gr√∂√üten Teil davon gemeistert. <br><br><h3>  Kommen wir zur Sache </h3><br>  In fr√ºheren Artikeln wurden Informationen zu IP-Adressen von der IP2LOCATION-Site √ºbernommen. Aus offensichtlichen Gr√ºnden bin ich nicht auf diese Artikel gesto√üen (da alle Aktionen viel fr√ºher ausgef√ºhrt wurden), sondern auch auf diese Ressource.  In meinem Fall war der Ansatz zwar anders - ich habe mich entschieden, die Datenbank nicht lokal f√ºr mich zu nutzen und keine Informationen aus der CSV zu extrahieren, sondern die √Ñnderungen direkt auf der Website zu √ºberwachen, fortlaufend und als Hauptgrundlage, von der aus alle nachfolgenden Skripte Ziele verfolgen - eine Tabelle mit erstellt IP-Adressen in verschiedenen Formaten: CIDR, Liste ‚Äûvon‚Äú und ‚Äûbis‚Äú, L√§ndermarke (nur f√ºr den Fall), AS-Nummer, AS-Beschreibung. <br><br><img src="https://habrastorage.org/webt/mx/s4/wj/mxs4wjpxueytkcd15srf7alswf8.png"><br><br>  Das Format ist nicht das optimalste, aber ich war sehr zufrieden mit der Demo und der einmaligen Werbung. Um nicht st√§ndig nach zus√§tzlichen Informationen wie ASN zu suchen, habe ich beschlossen, diese zus√§tzlich selbst zu protokollieren.  Um diese Informationen zu erhalten, habe ich mich an den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">IpToASN-</a> Dienst <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gewandt. Er</a> verf√ºgt √ºber eine praktische API (mit Einschr√§nkungen), die Sie nur in sich selbst integrieren m√ºssen. <br><br><div class="spoiler">  <b class="spoiler_title">IP-Parsing-Code</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ipList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, <span class="hljs-string"><span class="hljs-string">"https://lite.ip2location.com/belarus-ip-address-ranges"</span></span>); curl_setopt($ch, CURLOPT_HEADER, <span class="hljs-number"><span class="hljs-number">0</span></span>); curl_setopt($ch, CURLOPT_USERAGENT,<span class="hljs-string"><span class="hljs-string">'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.13) Gecko/20080311 Firefox/2.0.0.13'</span></span>); curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); $ipList = curl_exec($ch); curl_close ($ch); preg_match_all(<span class="hljs-string"><span class="hljs-string">"/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\&lt;\/td\&gt;\s+\&lt;td\&gt;\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})/"</span></span>, $ipList, $matches); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $matches[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">iprange2cidr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($ipStart, $ipEnd)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_string($ipStart) || is_string($ipEnd)){ $start = ip2long($ipStart); $end = ip2long($ipEnd); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ $start = $ipStart; $end = $ipEnd; } $result = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>($end &gt;= $start){ $maxSize = <span class="hljs-number"><span class="hljs-number">32</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($maxSize &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>){ $mask = hexdec(iMask($maxSize - <span class="hljs-number"><span class="hljs-number">1</span></span>)); $maskBase = $start &amp; $mask; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($maskBase != $start) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; $maxSize--; } $x = log($end - $start + <span class="hljs-number"><span class="hljs-number">1</span></span>)/log(<span class="hljs-number"><span class="hljs-number">2</span></span>); $maxDiff = floor(<span class="hljs-number"><span class="hljs-number">32</span></span> - floor($x)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($maxSize &lt; $maxDiff){ $maxSize = $maxDiff; } $ip = long2ip($start); array_push($result, <span class="hljs-string"><span class="hljs-string">"$ip/$maxSize"</span></span>); $start += pow(<span class="hljs-number"><span class="hljs-number">2</span></span>, (<span class="hljs-number"><span class="hljs-number">32</span></span>-$maxSize)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $result; } $getIpList = ipList(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($getIpList <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $item) { $cidr = iprange2cidr($ip[<span class="hljs-number"><span class="hljs-number">0</span></span>], $ip[<span class="hljs-number"><span class="hljs-number">1</span></span>]); }</code> </pre> <br></div></div><br>  Nachdem wir IP herausgefunden haben, m√ºssen wir unsere gesamte Datenbank leider ohne Einschr√§nkungen √ºber die Reverse-Lookup-Dienste ausf√ºhren - dies ist mit Ausnahme des Geldes unm√∂glich. <br><br>  Von den Diensten, die daf√ºr gro√üartig und bequem zu verwenden sind, m√∂chte ich zwei erw√§hnen: <br><br><ol><li>  VirusTotal - Begrenzung der H√§ufigkeit von Aufrufen von einem API-Schl√ºssel </li><li>  Hackertarget.com (ihre API) - Begrenzung der Anzahl der Treffer von einer IP </li></ol><br>  Unter Umgehung der Grenzwerte wurden folgende Optionen erhalten: <br><br><ul><li>  Im ersten Fall besteht eines der Szenarien darin, Zeit√ºberschreitungen von 15 Sekunden zu √ºberstehen. Insgesamt werden 4 Anrufe pro Minute ausgef√ºhrt, was sich stark auf unsere Geschwindigkeit auswirken kann. In dieser Situation ist es n√ºtzlich, 2-3 solcher Tasten zu verwenden, und ich w√ºrde empfehlen, auf dieselben zur√ºckzugreifen zum Proxy und zum √Ñndern des Benutzeragenten. </li><li>  Im zweiten Fall habe ich ein Skript zum automatischen Parsen der Proxy-Datenbank basierend auf √∂ffentlich verf√ºgbaren Informationen, deren Validierung und anschlie√üender Verwendung geschrieben (aber sp√§ter habe ich diese Option verlassen, da VirusTotal im Wesentlichen auch ausreichte). </li></ul><br>  Wir gehen weiter und gehen reibungslos zu den E-Mail-Adressen.  Sie k√∂nnen auch eine Quelle n√ºtzlicher Informationen sein, aber wo k√∂nnen sie gesammelt werden?  Es dauerte nicht lange, eine L√∂sung zu finden.  Benutzer halten wenig in unserem Segment pers√∂nlicher Websites, und die meisten von ihnen sind Organisationen - Profilwebsites wie Online-Shop-Verzeichnisse, Foren und bedingte Marktpl√§tze werden zu uns passen. <br><br>  Eine schnelle √úberpr√ºfung einer dieser Websites ergab beispielsweise, dass viele Benutzer ihre E-Mails direkt zu ihrem √∂ffentlichen Profil hinzuf√ºgen. Dementsprechend kann dieses Unternehmen f√ºr die zuk√ºnftige Verwendung sorgf√§ltig analysiert werden. <br><br><div class="spoiler">  <b class="spoiler_title">Einer der Parser</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python3 import sys, threading, time, os, urllib, re, requests, pymysql from html.parser import HTMLParser from urllib import request from bs4 import BeautifulSoup # HEADERS CONFIG headers = { 'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 11.9; rv:42.0) Gecko/20200202 Firefox/41.0' } file = open('dat.html', 'w') def parseMails(uid): page = 'https://profile.onliner.by/user/'+str(uid)+'' cookie = {'onl_session': 'YOUR_SESSION_COOOKIE_HERE'} r = requests.get(page, headers = headers, cookies = cookie) data = BeautifulSoup(r.text) userinfo = data.find_all('dl', {'class': 'uprofile-info'}) find_email = [] for item in userinfo: find_email += str(item.find('a')) get_mail = ''.join(find_email) detect_email = re.compile(".+?&gt;(.+@.+?)&lt;/a&gt;").search(get_mail) file.write("&lt;li&gt;('"+detect_email.group(1)+"'),&lt;/li&gt;") for uid in range(1, 10000): t = threading.Thread(target=parseMails, args=(uid,)) t.start() time.sleep(0.3)</span></span></code> </pre><br></div></div><br>  Ich werde nicht n√§her auf das Parsen der einzelnen Websites eingehen. An einem Ort ist es bequemer, die Benutzer-ID mit brutaler Gewalt zu erraten. An einem Ort ist es einfacher, eine Sitemap zu analysieren, Informationen zu Unternehmensseiten abzurufen und dann Adressen von diesen zu sammeln.  Nach dem Sammeln der Adressen m√ºssen wir noch einige einfache Vorg√§nge ausf√ºhren, um sie sofort nach der Dom√§nenzone zu sortieren, die ‚ÄûSchw√§nze‚Äú beizubehalten und sie auszuf√ºhren, um Duplikate aus der vorhandenen Datenbank auszuschlie√üen. <br><br>  In diesem Stadium glaube ich, dass wir mit der Bildung des Anwendungsbereichs enden und zur Intelligenz √ºbergehen k√∂nnen.  Wie wir bereits wissen, kann es zwei Arten von Intelligenz geben - in unserem Fall aktiv und passiv -, wobei der passive Ansatz am relevantesten ist.  Andererseits ist es durchaus legitim, auf die Site √ºber Port 80 oder 443 ohne b√∂swillige Belastung zuzugreifen und Schwachstellen auszunutzen.  Unser Interesse gilt Serverantworten auf eine einzelne Anfrage. In einigen F√§llen kann es zwei Anfragen geben (Umleitung von http zu https), in selteneren F√§llen sogar drei (wenn www verwendet wird). <br><br><h2>  Intelligenz </h2><br>  Mit solchen Informationen als Domain k√∂nnen wir die folgenden Daten sammeln: <br><br><ul><li>  DNS-Eintr√§ge (NS, MX, TXT) </li><li>  Beantworten Sie Header </li><li>  Identifizieren Sie den verwendeten Technologie-Stack </li><li>  Verstehen Sie, nach welchem ‚Äã‚ÄãProtokoll die Site funktioniert. </li><li>  Versuchen Sie, offene Ports (basierend auf der Shodan / Censys-Datenbank) ohne direktes Scannen zu identifizieren </li><li>  Versuchen Sie, Schwachstellen anhand der Korrelation von Informationen aus Shodan / Censys mit der Vulners-Datenbank zu identifizieren </li><li>  Befindet es sich in der Malware-Datenbank von Google Safe Browsing? </li><li>  Sammeln Sie E-Mail-Adressen nach Domain sowie die bereits gefundenen √úbereinstimmungen und √ºberpr√ºfen Sie sie zus√§tzlich durch Verweisen auf soziale Netzwerke </li><li>  Eine Domain ist in einigen F√§llen nicht nur das Gesicht des Unternehmens, sondern auch das Produkt seiner Aktivit√§ten, E-Mail-Adressen f√ºr die Registrierung von Diensten usw. Sie k√∂nnen auf Ressourcen wie GitHub, Pastebin, Google Dorks (Google CSE) nach Informationen suchen, die mit ihnen verkn√ºpft sind ) </li></ul><br>  Sie k√∂nnen jederzeit Masscan oder nmap, zmap als Option verwenden und diese zuerst √ºber Tor einrichten, indem Sie sie zu einem zuf√§lligen Zeitpunkt oder sogar aus mehreren Instanzen heraus starten. Wir haben jedoch andere Ziele und der Name impliziert, dass ich keine direkten Scans durchgef√ºhrt habe. <br><br>  Wir sammeln DNS-Eintr√§ge, pr√ºfen die M√∂glichkeit der Verst√§rkung von Anfragen und Konfigurationsfehlern wie AXFR: <br><br><div class="spoiler">  <b class="spoiler_title">Ein Beispiel f√ºr das Sammeln von NS-Serverdatens√§tzen</b> <div class="spoiler_text"><pre> <code class="bash hljs">dig ns +short <span class="hljs-variable"><span class="hljs-variable">$domain</span></span> | sed <span class="hljs-string"><span class="hljs-string">'s/\.$//g'</span></span> | awk <span class="hljs-string"><span class="hljs-string">'{print $1}'</span></span></code> </pre> <br></div></div><br>  Beispiel f√ºr die Sammlung von MX-Datens√§tzen (siehe NS, ersetzen Sie einfach 'ns' durch 'mx' <br><br><div class="spoiler">  <b class="spoiler_title">Suchen Sie nach AXFR (hier gibt es viele L√∂sungen, hier ist eine andere Kr√ºcke, aber keine Sicherheit, die zum Anzeigen der Ausgaben verwendet wird).</b> <div class="spoiler_text"><pre> <code class="php hljs"> $digNs = trim(shell_exec(<span class="hljs-string"><span class="hljs-string">"dig ns +short $domain | sed 's/\.$//g' | awk '{print $1}'"</span></span>)); $ns = explode(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>, $digNs); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($ns <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $target) { $axfr = trim(shell_exec(<span class="hljs-string"><span class="hljs-string">"dig -t axfr $domain @$target | awk '{print $1}' | sed 's/\.$//g'"</span></span>)); $axfr = preg_replace(<span class="hljs-string"><span class="hljs-string">"/\;/"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, $axfr); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(trim($axfr))) { $axfr = preg_replace(<span class="hljs-string"><span class="hljs-string">"/\;/"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, $axfr); $res = json_encode(explode(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>, trim($axfr)));</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">√úberpr√ºfen Sie die DNS-Verst√§rkung</b> <div class="spoiler_text"><pre> <code class="bash hljs">dig +short test.openresolver.com TXT @<span class="hljs-variable"><span class="hljs-variable">$dns</span></span></code> </pre> <br>  In meinem Fall wurden die NS-Server aus der Datenbank entnommen, sodass Sie am Ende der Variablen tats√§chlich nur jeden Server ersetzen k√∂nnen.  In Bezug auf die Richtigkeit der Ergebnisse dieses Dienstes kann ich nicht sicher sein, dass dort alles reibungslos funktioniert und die Ergebnisse immer g√ºltig sind, aber ich hoffe, dass die meisten Ergebnisse echt sind. <br></div></div><br>  Wenn wir f√ºr irgendeinen Zweck eine vollst√§ndige endg√ºltige URL zur Site behalten m√ºssen, habe ich daf√ºr cURL verwendet: <br><br><pre> <code class="bash hljs">curl -I -L <span class="hljs-variable"><span class="hljs-variable">$target</span></span> | awk <span class="hljs-string"><span class="hljs-string">'/Location/{print $2}'</span></span></code> </pre> <br>  Er selbst wird die gesamte Weiterleitung durchlaufen und die letzte anzeigen, d. H.  aktuelle Site-URL.  In meinem Fall war es √§u√üerst n√ºtzlich f√ºr die sp√§tere Verwendung von Tools wie WhatWeb. <br><br>  Warum sollten wir es benutzen?  Um das Betriebssystem, den Webserver, die verwendete CMS-Site, einige Header, zus√§tzliche Module wie JS / HTML-Bibliotheken / Frameworks sowie den Site-Titel zu bestimmen, nach dem Sie sp√§ter versuchen k√∂nnen, nach demselben Aktivit√§tsfeld zu filtern. <br><br>  In diesem Fall besteht eine sehr bequeme Option darin, die Ergebnisse des Betriebs des Tools im XML-Format f√ºr die nachfolgende Analyse zu exportieren und in die Datenbank zu importieren, wenn das Ziel besteht, alles sp√§ter zu verarbeiten. <br><br><pre> <code class="bash hljs">whatweb --no-errors https://www.mywebsite.com --<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>-xml=results.xml</code> </pre> <br>  F√ºr mich selbst habe ich JSON als Ergebnis der Ausgabe erstellt und es bereits in die Datenbank gestellt. <br><br>  Apropos Header: Mit einer normalen cURL k√∂nnen Sie fast dasselbe tun, indem Sie eine Abfrage des Formulars ausf√ºhren: <br><br><pre> <code class="bash hljs">curl -I https://www.mywebsite.com</code> </pre> <br>  Abrufen von Informationen zu CMS und Webservern in den Headern beispielsweise mithilfe regul√§rer Ausdr√ºcke. <br><br>  Zus√§tzlich zu dem n√ºtzlichen k√∂nnen wir auch die M√∂glichkeit hervorheben, Informationen √ºber offene Ports mit Shodan zu sammeln und dann anhand der bereits erhaltenen Daten die Vulners-Datenbank mithilfe ihrer API zu √ºberpr√ºfen (Links zu Diensten finden Sie im Header).  Nat√ºrlich kann es in diesem Szenario zu Problemen mit der Genauigkeit kommen, aber dies ist kein direkter Scan mit manueller Validierung, sondern ein banales ‚ÄûJonglieren‚Äú von Daten aus Quellen von Drittanbietern, aber zumindest ist es besser als gar nichts. <br><br><div class="spoiler">  <b class="spoiler_title">PHP-Funktion f√ºr Shodan</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shodanHost</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($host)</span></span></span><span class="hljs-function"> </span></span>{ $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, <span class="hljs-string"><span class="hljs-string">"https://api.shodan.io/shodan/host/"</span></span>.$host.<span class="hljs-string"><span class="hljs-string">"?key=&lt;YOUR_API_KEY&gt;"</span></span>); curl_setopt($ch, CURLOPT_HEADER, <span class="hljs-number"><span class="hljs-number">0</span></span>); curl_setopt($ch, CURLOPT_USERAGENT,<span class="hljs-string"><span class="hljs-string">'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.13) Gecko/20080311 Firefox/2.0.0.13'</span></span>); curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); $shodanResponse = curl_exec($ch); curl_close ($ch); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json_decode($shodanResponse); }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Ein Beispiel f√ºr eine solche vergleichende Analyse # 1</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ha/fv/7q/hafv7qlzupcsueqn_qwe_0qyo7y.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Beispiel 2</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/9x/0c/jx/9x0cjxkltuscladnh9rd4nshsga.png"><br></div></div><br>  Ja, da sie angefangen haben, √ºber die API zu sprechen, haben Vulner Einschr√§nkungen und die optimalste L√∂sung w√§re die Verwendung ihres Python-Skripts. Alles wird ohne Torsions-Twists gut funktionieren. Im Fall von PHP bin ich auf einige kleine Schwierigkeiten gesto√üen (wieder hinzuf√ºgen). Timeouts haben die Situation gerettet). <br><br>  Einer der neuesten Tests - Wir werden die Informationen zur Firewall untersuchen, die mit einem Skript wie "wafw00f" verwendet wird.  Beim Testen dieses wunderbaren Tools fiel mir eine interessante Sache auf: Es war nicht immer das erste Mal, dass der verwendete Firewall-Typ bestimmt werden konnte. <br><br>  Um zu sehen, welche Arten von Firewalls wafw00f m√∂glicherweise erkennen kann, k√∂nnen Sie den folgenden Befehl eingeben: <br><br><pre> <code class="bash hljs">wafw00f -l</code> </pre> <br>  Um den Firewall-Typ zu bestimmen, analysiert wafw00f die Server-Antwortheader nach dem Senden einer Standardanforderung an die Site. Wenn dieser Versuch nicht ausreicht, wird eine zus√§tzliche einfache Testanforderung generiert. Wenn dies nicht erneut ausreicht, verarbeitet die dritte Methode die Daten nach den ersten beiden Versuchen . <br><br>  Weil  F√ºr Statistiken ben√∂tigen wir nicht die gesamte Antwort. Wir schneiden den gesamten √úberschuss mit einem regul√§ren Ausdruck ab und belassen nur den Namen Firewall: <br><br><pre> <code class="php hljs">/is\sbehind\sa\s(.+?)\n/</code> </pre> <br>  Nun, wie ich bereits geschrieben habe - zus√§tzlich zu Informationen √ºber die Domain und die Site wurden die Informationen √ºber E-Mail-Adressen und soziale Netzwerke auch im passiven Modus aktualisiert: <br><br><div class="spoiler">  <b class="spoiler_title">Statistiken per E-Mail basierend auf der Domain definiert</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/f-/lq/fj/f-lqfjqylimkrb3l8ham2yxo8f4.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Ein Beispiel f√ºr die Bestimmung der Bindung sozialer Netzwerke an die E-Mail-Adresse</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/an/pw/dq/anpwdqniobeopkdhnyq5pd5ejgk.png"><br></div></div><br>  Der einfachste Weg war die Adressvalidierung auf Twitter (2 Wege), bei Facebook (1 Weg) stellte sich diesbez√ºglich aufgrund eines etwas komplizierteren Systems zum Generieren einer echten Benutzersitzung als etwas komplizierter heraus. <br><br><h2>  Fahren wir mit der Trockenstatistik fort. </h2><br><h4>  DNS-Statistiken </h4><br><img src="https://habrastorage.org/webt/uk/md/m1/ukmdm1eoizu6sjvxaf7nld8kdgi.png"><br><br>  <b>Anbieter - wie viele Websites</b> <br>  ns1.tutby.com: 10899 <br>  ns2.tutby.com: 10899 <br>  ns1.neolocation.com: 4877 <br>  ns2.neolocation.com: 4873 <br>  ns3.neolocation.com: 4572 <br>  ns1.activeby.net: 4231 <br>  ns2.activeby.net: 4229 <br>  u1.hoster.by: 3382 <br>  u2.hoster.by: 3378 <br><br>  Eindeutiger DNS gefunden: 2462 <br>  Einzigartige MX (Mail) -Server: 9175 (zus√§tzlich zu den beliebten Diensten gibt es eine ausreichende Anzahl von Administratoren, die ihre eigenen Mail-Dienste verwenden.) <br>  Betroffen von der DNS-Zonen√ºbertragung: 1011 <br>  Betroffen von der DNS-Verst√§rkung: 531 <br>  Nur wenige CloudFlare-Fans: 375 (basierend auf verwendeten NS-Datens√§tzen) <br><br><h4>  CMS-Statistiken </h4><br><img src="https://habrastorage.org/webt/oz/zp/0k/ozzp0kkl6kof-gomjiesmgoju_y.png"><br><br>  <b>CMS - Menge</b> <br>  WordPress: 5118 <br>  Joomla: 2722 <br>  Bitrix: 1757 <br>  Drupal: 898 <br>  OpenCart: 235 <br>  DataLife: 133 <br>  Magento: 32 <br><br><ul><li>  Potenziell anf√§llige WordPress-Installationen: 2977 </li><li>  Potenziell gef√§hrdete Installationen von Joomla: 212 </li><li>  Mit dem Google SafeBrowsing-Dienst konnten potenziell gef√§hrliche oder infizierte Websites identifiziert werden: etwa 10.000 (zu unterschiedlichen Zeiten wurde jemand repariert, jemand ist anscheinend pleite, Statistiken sind nicht ganz objektiv). </li><li>  √úber HTTP und HTTPS - weniger als die H√§lfte der Sites des gefundenen Volumes verwenden letzteres, aber unter Ber√ºcksichtigung der Tatsache, dass meine Datenbank nicht vollst√§ndig ist, sondern nur 40% der Gesamtzahl, ist es durchaus m√∂glich, dass die meisten Sites aus der zweiten H√§lfte √ºber HTTPS kommunizieren k√∂nnen . </li></ul><br><h4>  Firewall-Statistiken: </h4><br><img src="https://habrastorage.org/webt/1o/pf/qc/1opfqck9bluf4aa2xvjt2aivaks.png"><br><br>  <b>Firewall - Nummer</b> <br>  ModSecurity: 4354 <br>  IBM Web App Security: 126 <br>  Bessere WP-Sicherheit: 110 <br>  CloudFlare: 104 <br>  Imperva SecureSphere: 45 <br>  Juniper WebApp Secure: 45 <br><br><h4>  Webserver-Statistiken </h4><br><img src="https://habrastorage.org/webt/k1/ru/ut/k1ruutqumvvmoism9bafmdp8oko.png"><br><br>  <b>Webserver - Nummer</b> <br>  Nginx: 31752 <br>  Apache: 4042 <br>  IIS: 959 <br><br>  Veraltete und potenziell anf√§llige Installationen von Nginx: 20966 <br>  Veraltete und m√∂glicherweise anf√§llige Installationen von Apache: 995 <br><br>  Trotz der Tatsache, dass hoster.by beispielsweise bei Domains und Hosting im Allgemeinen f√ºhrend ist, wurde auch Open Contact ausgezeichnet, aber die Wahrheit liegt in der Anzahl der Websites auf einer IP: <br><br><img src="https://habrastorage.org/webt/mq/gu/wj/mqguwjm8_1ggvfo_o5vam20tjto.png"><br><br>  <b>IP - Sites</b> <br>  93.84.119.243: 556 <br>  93.125.99.83: 399 <br>  193.232.92.25: 386 <br><br><img src="https://habrastorage.org/webt/h0/us/nk/h0usnka_tsv0yqqa5jb8vd5wy_k.png"><br><br>  Per E-Mail entschieden sich die detaillierten Statistiken wirklich daf√ºr, nicht abgerufen und nicht nach der Domain-Zone sortiert zu werden. Vielmehr war es interessant, den Standort der Benutzer bei bestimmten Anbietern zu sehen: <br><br><ul><li>  Auf dem TUT.BY-Dienst: 38282 </li><li>  Auf dem Yandex-Dienst (von | ru): 28127 </li><li>  Auf dem Google Mail-Dienst: 33452 </li><li>  An Facebook gebunden: 866 </li><li>  An Twitter gebunden: 652 </li><li>  Gekennzeichnet in Lecks gem√§√ü HIBP: 7844 </li><li>  Passive Intelligenz half dabei, mehr als 13.000 E-Mail-Adressen zu identifizieren </li></ul><br>  Wie Sie sehen, ist das Gesamtbild recht positiv, insbesondere die aktive Nutzung von Nginx seitens der Hosting-Anbieter.  M√∂glicherweise liegt dies haupts√§chlich an dem bei normalen Benutzern beliebten Shared-Hosting-Typ. <br><br>  Aufgrund der Tatsache, dass es mir nicht wirklich gefallen hat, gibt es eine ausreichende Anzahl von Hosting-Anbietern der mittleren Hand, die Fehler wie AXFR bemerkt, veraltete Versionen von SSH und Apache und einige andere kleinere Probleme verwendet haben.  Hier k√∂nnte nat√ºrlich durch die aktive Phase mehr Licht auf die Situation geworfen werden, aber im Moment scheint es mir aufgrund unserer Gesetzgebung unm√∂glich zu sein, und ich m√∂chte mich nicht wirklich in die Reihen der Sch√§dlinge f√ºr solche Angelegenheiten eintragen. <br><br>  Das E-Mail-Bild ist im Allgemeinen ziemlich rosig, wenn man es so nennen kann.  Oh ja, wo der TUT.BY-Anbieter angegeben ist - das bedeutete, die Domain zu benutzen, weil  Dieser Service basiert auf Yandex. <br><br><h2>  Fazit </h2><br>  Abschlie√üend kann ich eines sagen: Selbst mit den verf√ºgbaren Ergebnissen k√∂nnen Sie schnell verstehen, dass Spezialisten, die Websites von Viren reinigen, WAF einrichten und verschiedene CMS konfigurieren / hinzuf√ºgen, viel Arbeit ben√∂tigen. <br><br>  Nun, im Ernst, wie in den beiden vorhergehenden Artikeln, sehen wir, dass die Probleme in absolut allen Segmenten des Internets und in den L√§ndern auf absolut unterschiedlichen Ebenen bestehen und einige von ihnen auch dann auftauchen, wenn sie das Problem aus der Ferne untersuchen, ohne beleidigende Methoden usw. e.  Verwendung √∂ffentlich zug√§nglicher Informationen, um zu sammeln, welche besonderen F√§higkeiten nicht erforderlich sind. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de446022/">https://habr.com/ru/post/de446022/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de445992/index.html">Nauchpop am Minimum: optische T√§uschungen</a></li>
<li><a href="../de445998/index.html">So machen Sie Freunde Progress OpenEdge und Oracle DBMS</a></li>
<li><a href="../de446000/index.html">Was ist los mit Yandex.Music? UX / UI-Analyse</a></li>
<li><a href="../de446006/index.html">Intel - klingt neu</a></li>
<li><a href="../de446008/index.html">Open Source Tool zur absichtsbasierten Validierung der Suchqualit√§t</a></li>
<li><a href="../de446024/index.html">Installieren und konfigurieren Sie einen Ripple-Knoten</a></li>
<li><a href="../de446028/index.html">Bausteine ‚Äã‚Äãverteilter Anwendungen. Nulln√§herung</a></li>
<li><a href="../de446030/index.html">Startups auf dem Gebiet der Anti-Aging-Biotechnologie, die 2019 relevant sein werden</a></li>
<li><a href="../de446032/index.html">Zoomen Sie 1080P-Videos auf 4K, oder wie ich gelernt habe, mir keine Sorgen zu machen, und das Hochskalieren mithilfe neuronaler Netze liebte</a></li>
<li><a href="../de446036/index.html">Oracle Application Express. Anwendungen und Seiten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>