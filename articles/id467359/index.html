<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö∂ üìì üë©‚Äçüé§ PVS-Studio pergi ke awan: Azure DevOps üë©üèæ‚Äçü§ù‚Äçüë©üèº üì≥ üêò</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ini adalah artikel kedua tentang menggunakan analisa statis PVS-Studio dalam sistem cloud CI, dan kali ini kita akan mempertimbangkan platform Azure D...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PVS-Studio pergi ke awan: Azure DevOps</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/467359/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b53/5ba/6e6/b535ba6e6cf6250ad0c89d5315918d38.png" alt="Gambar 9"></div><br>  Ini adalah artikel kedua tentang menggunakan analisa statis PVS-Studio dalam sistem cloud CI, dan kali ini kita akan mempertimbangkan platform Azure DevOps - solusi cloud CI \ CD dari Microsoft.  Sebagai proyek yang dianalisis kali ini, pertimbangkan ShareX. <br><a name="habracut"></a><br>  Kami membutuhkan tiga komponen.  Yang pertama adalah analisa statis PVS-Studio.  Yang kedua adalah Azure DevOps, yang dengannya kami akan mengintegrasikan alat analisa.  Yang ketiga adalah proyek yang akan kami periksa untuk menunjukkan kemampuan PVS-Studio saat bekerja di cloud.  Jadi mari kita mulai. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PVS-Studio</a> adalah penganalisa kode statis untuk mencari kesalahan dan cacat keamanan.  Melakukan analisis kode dalam C, C ++, C # dan Java. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Azure DevOps</a> .  Platform Azure DevOps mencakup alat-alat seperti Azure Pipeline, Azure Board, Azure Artifacts, dan lainnya untuk mempercepat proses pembuatan perangkat lunak dan meningkatkan kualitasnya. <br><br>  ShareX adalah aplikasi gratis yang memungkinkan Anda menangkap dan merekam bagian mana pun dari layar.  Proyek ini ditulis dalam C # dan bagus untuk menunjukkan bagaimana menjalankan analisa statis.  Kode sumber untuk proyek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tersedia di GitHub</a> . <br><br>  Output dari perintah cloc untuk proyek ShareX: <br><div class="scrollable-table"><table><tbody><tr><td>  Bahasa <br></td><td>  file <br></td><td>  kosong <br></td><td>  komentar <br></td><td>  Kode <br></td></tr><tr><td>  C # <br></td><td>  696 <br></td><td>  20658 <br></td><td>  24423 <br></td><td>  102565 <br></td></tr><tr><td>  Skrip MSBuild <br></td><td>  11 <br></td><td>  1 <br></td><td>  77 <br></td><td>  5859 <br></td></tr></tbody></table></div>  Dengan kata lain, proyek ini kecil, tetapi cukup memadai untuk menunjukkan karya PVS-Studio dalam hubungannya dengan platform cloud. <br><br><h2>  Mari mengatur </h2><br>  Untuk memulai di Azure DevOps, klik <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautan</a> dan klik tombol "Mulai gratis dengan GitHub". <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0dc/3d3/8d0/0dc3d38d0375af0a89db1b7be1b4f284.png" alt="Gambar 2"></div><br>  Memberikan akses aplikasi Microsoft ke data akun GitHub. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b38/543/12b/b3854312bb046df2c1dd50d2025a0b25.png" alt="Gambar 1"></div><br>  Untuk menyelesaikan pendaftaran harus membuat akun Microsoft. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8f5/7a9/878/8f57a9878354a257a8ca68261b5b472a.png" alt="Gambar 12"></div><br>  Setelah mendaftar, buat proyek: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e69/a61/59a/e69a6159ac5c51089e075c37fc5e2465.png" alt="Gambar 5"></div><br>  Selanjutnya, kita perlu pergi ke bagian "Pipeline" - "Builds" dan membuat pipeline Build baru <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2fa/4d2/751/2fa4d27513aaf869962e11b9ea37214b.png" alt="Gambar 8"></div><br>  Untuk pertanyaan di mana kode kami berada, kami akan menjawab - GitHub. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a80/787/363/a80787363d8b260b9aac0ac64c66aeaf.png" alt="Gambar 13"></div><br>  Kami mengotorisasi aplikasi Azure Pipelines dan memilih repositori dengan proyek yang akan kami konfigurasikan peluncuran analisis statis. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c1/df6/47e/1c1df647e46b8445c43b9cf39968d7ed.png" alt="Gambar 7"></div><br>  Di jendela pemilihan template, pilih "Pipeline pemula". <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8ac/11d/09f/8ac11d09f180433fe9e14a6279f2a059.png" alt="Gambar 17"></div><br>  Kami dapat menjalankan analisis statis kode proyek dalam dua cara: menggunakan agen yang dihosting oleh Microsoft atau di-hosting sendiri <br><br>  Dalam versi pertama, kami akan menggunakan agen yang dihosting oleh Microsoft.  Agen tersebut adalah mesin virtual biasa yang dimulai ketika kami memulai saluran pipa kami dan dihapus setelah tugas selesai.  Menggunakan agen semacam itu memungkinkan Anda untuk tidak membuang waktu mendukung dan memperbarui mereka, tetapi memberlakukan beberapa pembatasan, misalnya, ketidakmungkinan menginstal perangkat lunak tambahan yang digunakan untuk membangun proyek. <br><br>  Ganti konfigurasi default kami dengan yang berikut untuk menggunakan agen yang dihosting oleh Microsoft: <br><br><pre><code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#    #      master- trigger: - master #         # ,   Docker-, #      Windows Server 1803 pool: vmImage: 'win1803' container: microsoft/dotnet-framework:4.7.2-sdk-windowsservercore-1803 steps: #    - task: PowerShell@2 inputs: targetType: 'inline' script: 'Invoke-WebRequest -Uri https://files.viva64.com/PVS-Studio_setup.exe -OutFile PVS-Studio_setup.exe' - task: CmdLine@2 inputs: workingDirectory: $(System.DefaultWorkingDirectory) script: | #      nuget restore .\ShareX.sln #  ,        md .\PVSTestResults #   PVS-Studio_setup.exe /VERYSILENT /SUPPRESSMSGBOXES /NORESTART /COMPONENTS=Core #        "C:\Program Files (x86)\PVS-Studio\PVS-Studio_Cmd.exe" credentials -u $(PVS_USERNAME) -n $(PVS_KEY) #        html. "C:\Program Files (x86)\PVS-Studio\PVS-Studio_Cmd.exe" -t .\ShareX.sln -o .\PVSTestResults\ShareX.plog "C:\Program Files (x86)\PVS-Studio\PlogConverter.exe" -t html -o .\PVSTestResults\ .\PVSTestResults\ShareX.plog #    - task: PublishBuildArtifacts@1 inputs: pathToPublish: PVSTestResults artifactName: PVSTestResults</span></span></code> </pre> <br>  <b>Catatan:</b> menurut <a href="">dokumentasi</a> , wadah yang digunakan harus di-cache dalam gambar mesin virtual, tetapi pada saat penulisan artikel ini tidak berfungsi dan wadah diunduh setiap kali tugas dimulai, yang secara negatif mempengaruhi waktu eksekusi. <br><br>  Simpan pipeline dan buat variabel yang akan digunakan untuk membuat file lisensi.  Untuk melakukan ini, buka jendela pengeditan pipa dan di sudut kanan atas klik tombol "Variabel". <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/be8/bc0/e1c/be8bc0e1c3555c6375eac94465d27b9d.png" alt="Gambar 14"></div><br>  Tambahkan dua variabel - <i>PVS_USERNAME</i> dan <i>PVS_KEY</i> , masing-masing berisi nama pengguna dan kunci lisensi.  Saat membuat variabel <i>PVS_KEY</i> , <i>jangan</i> lupa untuk memeriksa item ‚ÄúRahasiakan nilai ini‚Äù untuk mengenkripsi nilai variabel dengan kunci RSA 2048-bit, serta menekan output dari nilai variabel ke log eksekusi tugas. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/996/1e3/35e/9961e335e18b368820d930f14f01d796.png" alt="Gambar 15"></div><br>  Kami menyimpan variabel dan mulai pipa dengan tombol "Run". <br><br>  Opsi kedua untuk menjalankan analisis adalah menggunakan agen yang di-host-sendiri.  Agen yang diinangi sendiri adalah agen yang kami konfigurasikan dan kelola sendiri.  Agen tersebut memberikan lebih banyak peluang untuk menginstal perangkat lunak, yang diperlukan untuk perakitan dan pengujian produk perangkat lunak kami. <br><br>  Sebelum menggunakan agen tersebut, mereka harus dikonfigurasi sesuai dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">instruksi</a> , dan penganalisa statis harus diinstal dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dikonfigurasi</a> . <br><br>  Untuk memulai tugas pada agen yang di-host-sendiri, kami mengganti konfigurasi default yang diusulkan dengan yang berikut: <br><br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#    #    master- trigger: - master #    self-hosted    'MyPool' pool: 'MyPool' steps: - task: CmdLine@2 inputs: workingDirectory: $(System.DefaultWorkingDirectory) script: | #      nuget restore .\ShareX.sln #  ,        md .\PVSTestResults #        html. "C:\Program Files (x86)\PVS-Studio\PVS-Studio_Cmd.exe" -t .\ShareX.sln -o .\PVSTestResults\ShareX.plog "C:\Program Files (x86)\PVS-Studio\PlogConverter.exe" -t html -o .\PVSTestResults\ .\PVSTestResults\ShareX.plog #    - task: PublishBuildArtifacts@1 inputs: pathToPublish: PVSTestResults artifactName: PVSTestResults</span></span></code> </pre> <br>  Setelah menyelesaikan tugas, arsip dengan laporan analisis dapat diunduh pada tab Ringkasan, atau kita dapat menggunakan ekstensi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kirim Surat</a> , yang memungkinkan Anda mengonfigurasi pengiriman email, atau mencari alat yang lebih nyaman bagi kami di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Marketplace</a> . <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/529/df2/932/529df29320ae9e253462e42fe2bfd596.png" alt="Gambar 21"></div><br><h2>  Tentang hasil analisis </h2><br>  Sekarang mari kita lihat beberapa kesalahan yang ditemukan dalam proyek yang diperiksa - ShareX. <br><br>  <b>Cek berlebihan</b> <br><br>  Untuk melakukan pemanasan, mari kita mulai dengan kelemahan sederhana dalam kode, yaitu dengan pemeriksaan berlebihan: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PbThumbnail_MouseMove</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, MouseEventArgs e</span></span></span><span class="hljs-function">)</span></span> { .... IDataObject dataObject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataObject(DataFormats.FileDrop, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] { Task.Info.FilePath }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dataObject != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Program.MainForm.AllowDrop = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; dragBoxFromMouseDown = Rectangle.Empty; pbThumbnail.DoDragDrop(dataObject, DragDropEffects.Copy | DragDropEffects.Move); Program.MainForm.AllowDrop = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } .... }</code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Peringatan</a> <b>PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3022</a> [CWE-571] Ekspresi 'dataObject! = Null' selalu benar.  TaskThumbnailPanel.cs 415 <br><br>  Perhatikan memeriksa variabel <i>dataObject</i> untuk <i>null</i> .  Untuk apa dia di sini?  <i>dataObject</i> tidak bisa <i>nol</i> dalam hal ini, karena ini diinisialisasi dengan referensi ke objek yang dibuat.  Akibatnya, kami memiliki verifikasi yang berlebihan.  Apakah ini penting?  Tidak.  Tampak ringkas?  Tidak.  Pemeriksaan ini jelas lebih baik dihapus agar tidak mengacaukan kode. <br><br>  Mari kita lihat bagian lain dari kode, di mana Anda dapat membuat komentar serupa: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Image </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDIBImage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MemoryStream ms</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bitmap(bmp); .... } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gcHandle != IntPtr.Zero) { GCHandle.FromIntPtr(gcHandle).Free(); } } .... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Image </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetImageAlternative</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MemoryStream ms = dataObject.GetData(format) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> MemoryStream) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ms != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Image img = GetDIBImage(ms); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (img != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> img; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { DebugHelper.WriteException(e); } } } .... }</code> </pre> <br>  <b>Peringatan PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3022</a> [CWE-571] Ekspresi 'img! = Null' selalu benar.  ClipboardHelpers.cs 289 <br><br>  Metode <i>GetImageAlternative</i> lagi memeriksa bahwa variabel <i>img</i> tidak <i>nol</i> segera setelah membuat instance baru dari kelas <i>Bitmap</i> .  Perbedaan dari contoh sebelumnya di sini adalah bahwa untuk menginisialisasi variabel <i>img</i> , kita tidak menggunakan konstruktor, tetapi metode <i>GetDIBImage</i> .  Pembuat kode mengasumsikan bahwa pengecualian dapat terjadi dalam metode ini, tetapi menyatakan hanya <i>mencoba</i> dan <i>akhirnya</i> memblokir, menghilangkan <i>tangkapan</i> .  Oleh karena itu, jika pengecualian terjadi, metode pemanggilan <i>-</i> <i>GetImageAlternative</i> <i>-</i> tidak akan menerima referensi ke objek bertipe <i>Bitmap,</i> tetapi akan dipaksa untuk menangani pengecualian dalam <i>blok</i> <i>tangkapnya</i> sendiri.  Dalam kasus ini, variabel <i>img</i> tidak akan diinisialisasi, dan utas eksekusi bahkan tidak akan mencapai centang <i>img! = Null</i> , tetapi akan segera jatuh ke dalam <i>blok tangkap</i> .  Oleh karena itu, penganalisa memang menunjukkan validasi berlebihan. <br><br>  Pertimbangkan contoh peringatan berikut dengan kode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3022</a> : <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btnCopyLink_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lvClipboardFormats.SelectedItems.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) { url = lvClipboardFormats.Items[<span class="hljs-number"><span class="hljs-number">0</span></span>].SubItems[<span class="hljs-number"><span class="hljs-number">1</span></span>].Text; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lvClipboardFormats.SelectedItems.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { url = lvClipboardFormats.SelectedItems[<span class="hljs-number"><span class="hljs-number">0</span></span>].SubItems[<span class="hljs-number"><span class="hljs-number">1</span></span>].Text; } .... }</code> </pre> <br>  <b>Peringatan PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3022</a> [CWE-571] Ekspresi 'lvClipboardFormats.SelectedItems.Count&gt; 0' selalu benar.  AfterUploadForm.cs 155 <br><br>  Mari kita lihat ekspresi kondisional kedua.  Di sana kami memeriksa nilai properti <i>Hitung</i> baca-saja.  Properti ini menunjukkan jumlah elemen dalam instance koleksi <i>SelectedItems</i> .  Kondisi terpenuhi hanya jika properti <i>Hitung</i> lebih besar dari nol.  Semuanya akan baik-baik saja, tetapi itu hanya di luar <i>jika pernyataan</i> bahwa <i>Hitungan</i> sudah diperiksa.  Turunan dari koleksi <i>SelectedItems</i> tidak dapat memiliki jumlah elemen kurang dari nol, oleh karena itu, <i>Count</i> mengambil nilai yang sama dengan nol atau lebih besar dari nol.  Karena kami telah melakukan pemeriksaan pada pernyataan pertama <i>jika pernyataan</i> bahwa <i>Count</i> adalah nol, dan ternyata salah, tidak masuk akal untuk menulis cek lain pada cabang lain bahwa <i>Count</i> lebih besar dari nol. <br><br>  Contoh terakhir dari nomor kesalahan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3022</a> adalah fragmen kode berikut: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawCursorGraphics</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Graphics g</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cursorOffsetX = <span class="hljs-number"><span class="hljs-number">10</span></span>, cursorOffsetY = <span class="hljs-number"><span class="hljs-number">10</span></span>, itemGap = <span class="hljs-number"><span class="hljs-number">10</span></span>, itemCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; Size totalSize = Size.Empty; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> magnifierPosition = <span class="hljs-number"><span class="hljs-number">0</span></span>; Bitmap magnifier = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Options.ShowMagnifier) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (itemCount &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) totalSize.Height += itemGap; .... } .... }</code> </pre> <br>  <b>Peringatan PVS-Studio</b> : Ekspresi V3022 'itemCount&gt; 0' selalu salah.  RegionCaptureForm.cs 1100. <br><br>  Penganalisis memperhatikan bahwa <i>itemCount</i> kondisi <i>&gt; 0</i> akan selalu salah, karena sedikit deklarasi yang lebih tinggi dilakukan dan variabel <i>itemCount diatur ke</i> nol pada saat yang sama.  Hingga kondisi tersebut, variabel ini tidak digunakan di mana pun dan tidak berubah, oleh karena itu, penganalisa membuat kesimpulan yang benar tentang ekspresi kondisional, yang nilainya selalu salah. <br><br>  Baiklah, sekarang mari kita lihat sesuatu yang sangat menarik. <br><br>  <b>Cara terbaik untuk memahami bug adalah dengan memvisualisasikan bug.</b> <br><br>  Sepertinya kami menemukan kesalahan yang agak menarik di tempat ini: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pixelate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Bitmap bmp, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pixelSize</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> r = <span class="hljs-number"><span class="hljs-number">0</span></span>, g = <span class="hljs-number"><span class="hljs-number">0</span></span>, b = <span class="hljs-number"><span class="hljs-number">0</span></span>, a = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> weightedCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y2 = y; y2 &lt; yLimit; y2++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x2 = x; x2 &lt; xLimit; x2++) { ColorBgra color = unsafeBitmap.GetPixel(x2, y2); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pixelWeight = color.Alpha / <span class="hljs-number"><span class="hljs-number">255</span></span>; r += color.Red * pixelWeight; g += color.Green * pixelWeight; b += color.Blue * pixelWeight; a += color.Alpha * pixelWeight; weightedCount += pixelWeight; } } .... ColorBgra averageColor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ColorBgra((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(b / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(g / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(r / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(a / pixelCount)); .... }</code> </pre> <br>  Saya tidak ingin segera mengungkapkan semua kartu dan menunjukkan apa yang ditemukan oleh analis kami di sini, jadi mari kita tunda sejenak untuk saat ini. <br><br>  Dengan nama metode, mudah untuk menebak apa yang dilakukannya - Anda mengirimkan gambar atau potongan gambar sebagai input, dan melakukan pixelasinya.  Kode metode ini cukup panjang, jadi kami tidak akan memberikannya di sini secara keseluruhan, tetapi cukup mencoba menjelaskan algoritmanya dan menjelaskan bug apa yang ditemukan oleh PVS-Studio di sini. <br><br>  Metode ini menerima dua parameter sebagai input: objek bertipe <i>Bitmap</i> dan nilai bertipe <i>int</i> , yang menunjukkan ukuran piksel.  Algoritma operasi cukup sederhana: <br><br>  1) Kami memecah fragmen gambar yang diterima pada input ke dalam kotak dengan sisi yang sama dengan ukuran pixelation.  Sebagai contoh, jika kita memiliki ukuran pixelisasi 15, maka kita mendapatkan persegi yang berisi 15x15 = 225 piksel. <br><br>  2) Selanjutnya, kita berkeliling setiap piksel dalam kuadrat ini dan mengakumulasikan nilai-nilai bidang <i>Merah</i> , <i>Hijau</i> , <i>Biru</i> dan <i>Alpha</i> menjadi variabel perantara, dan sebelumnya mengalikan nilai warna yang sesuai dan nilai kanal alfa dengan variabel <i>pixelWeight</i> , diperoleh dengan membagi nilai <i>Alpha</i> dengan 255 (variabel <i>Alpha</i> memiliki ketik <i>byte</i> ).  Juga, ketika melintasi piksel, kami menjumlahkan nilai yang direkam dalam <i>pixelWeight</i> ke dalam variabel yang disebut <i>weightedCount</i> . <br><br>  Cuplikan kode yang melakukan langkah-langkah di atas adalah sebagai berikut: <br><br><pre> <code class="cs hljs">ColorBgra color = unsafeBitmap.GetPixel(x2, y2); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pixelWeight = color.Alpha / <span class="hljs-number"><span class="hljs-number">255</span></span>; r += color.Red * pixelWeight; g += color.Green * pixelWeight; b += color.Blue * pixelWeight; a += color.Alpha * pixelWeight; weightedCount += pixelWeight;</code> </pre> <br>  Omong-omong, perhatikan bahwa jika nilai variabel <i>Alpha</i> adalah nol, maka <i>pixelWeight</i> tidak akan menambahkan nilai apa pun ke variabel <i>WeightedCount</i> untuk piksel ini.  Kami akan membutuhkan ini di masa depan. <br><br>  3) Setelah kami melewati semua piksel dalam kuadrat saat ini, kami dapat membuat warna "rata-rata" umum untuk kuadrat ini.  Kode yang melakukan tindakan ini adalah sebagai berikut: <br><br><pre> <code class="cs hljs">ColorBgra averageColor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ColorBgra((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(b / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(g / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(r / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(a / pixelCount));</code> </pre> <br>  4) Sekarang kita memiliki warna akhir dan <i>menuliskannya</i> ke variabel <i>averageColor</i> , kita dapat kembali berkeliling setiap pixel di dalam kotak dan memberikan nilai dari <i>averageColor</i> . <br><br>  5) Kami kembali ke langkah 2 selama masih ada kotak mentah. <br><br>  Sekali lagi, kami mencatat bahwa variabel <i>weightedCount</i> tidak sama dengan jumlah semua piksel yang dikuadratkan.  Misalnya, jika piksel yang benar-benar transparan muncul di gambar (nilainya nol pada saluran alfa), maka variabel <i>pixelWeight</i> akan menjadi nol untuk piksel ini ( <i>0/255</i> = 0), oleh karena itu, piksel ini tidak akan memberikan kontribusi apa pun pada pembentukan nilai variabel <i>weightedCount</i> .  Ini logis - tidak masuk akal untuk memperhitungkan warna-warna piksel yang benar-benar transparan. <br><br>  Segalanya tampak cukup masuk akal - pixelation harus bekerja dengan benar.  Dan itu bekerja dengan baik.  Itu tidak untuk gambar png yang memiliki piksel dengan nilai di saluran alpha kurang dari 255 dan tidak sama dengan nol.  Perhatikan gambar pixelated di bawah ini: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/460/17b/7b5/46017b7b58a5206d0a51620fcce1a16f.png" alt="Gambar 3"></div><br><br>  Apakah Anda melihat pikselasi?  Dan kita tidak.  Nah, sekarang mari kita ungkapkan intrik kecil ini dan jelaskan di mana sebenarnya bug itu tersembunyi dalam metode ini.  Kesalahan merayap ke baris untuk menghitung nilai variabel <i>pixelWeight</i> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pixelWeight = color.Alpha / <span class="hljs-number"><span class="hljs-number">255</span></span>;</code> </pre> <br>  Faktanya adalah bahwa pembuat kode, menyatakan variabel <i>pixelWeight sebagai</i> <i>float</i> , menyiratkan bahwa ketika membagi bidang <i>Alpha</i> dengan 255, selain nol dan satu, angka fraksional harus diperoleh.  Di sinilah masalahnya, karena variabel <i>Alpha</i> adalah tipe <i>byte</i> , dan ketika kita membaginya dengan 255, kita mendapatkan nilai integer, dan hanya kemudian akan secara implisit dilemparkan ke <i>float</i> , oleh karena itu, bagian fraksional hilang. <br><br>  Ketidakmampuan untuk pixelize gambar PNG yang memiliki tingkat transparansi mudah untuk dijelaskan.  Karena nilai kanal alfa untuk piksel ini terletak pada rentang 0 &lt;Alpha &lt;255, saat membagi variabel <i>Alpha</i> dengan 255, kami akan selalu mendapatkan 0. Oleh karena itu, nilai <i>pikselBerat</i> , <i>r</i> , <i>g</i> , <i>b</i> , <i>a</i> , variabel Variabel <i>berbobot</i> juga selalu akan menjadi nol.  Hasilnya, rata-rata warna rata-rata kami akan dengan nilai nol di semua saluran: merah - 0, biru - 0, hijau - 0, alfa - 0. Mengisi kotak dengan warna ini, kami tidak mengubah warna asli piksel, karena rata-rata <i>Warna</i> benar-benar transparan .  Untuk memperbaiki kesalahan ini, Anda hanya perlu secara eksplisit melemparkan bidang <i>Alpha</i> ke tipe <i>float</i> .  Baris kode yang diperbaiki mungkin terlihat seperti ini: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pixelWeight = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)color.Alpha / <span class="hljs-number"><span class="hljs-number">255</span></span>;</code> </pre> <br>  Dan inilah saatnya mengutip pesan yang diberikan PVS-Studio ke kode yang salah: <br><br>  <b>Peringatan PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3041</a> [CWE-682] Ekspresi ini secara implisit dilemparkan dari tipe 'int' ke tipe 'float'.  Pertimbangkan untuk menggunakan pemeran tipe eksplisit untuk menghindari hilangnya bagian fraksional.  Contoh: double A = (double) (X) / Y;  ImageHelpers.cs 1119. <br><br>  Dan sebagai perbandingan, kami memberikan tangkapan layar gambar yang benar-benar pixelated yang diperoleh pada versi tetap aplikasi: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/977/0bc/e73/9770bce73229e72b6781f0349128aa3e.png" alt="Gambar 6"></div><br>  <b>Potensi NullReferenceException</b> <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddMetadata</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Image img, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> text</span></span></span><span class="hljs-function">)</span></span> { .... pi.Value = bytesText; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pi != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { img.SetPropertyItem(pi); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } .... }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3095</a> [CWE-476] Objek 'pi' digunakan sebelum diverifikasi terhadap null.  Periksa baris: 801, 803. ImageHelpers.cs 801 <br><br>  Fragmen kode ini menunjukkan bahwa pembuatnya mengharapkan variabel <i>pi</i> menjadi <i>nol</i> , itulah sebabnya pemeriksaan <i>pi! = Null</i> dilakukan sebelum memanggil metode <i>SetPropertyItem</i> .  Sungguh aneh bahwa sebelum pemeriksaan ini, array byte ditugaskan ke properti <i>pi.Value</i> , karena jika <i>pi</i> <i>nol</i> , pengecualian tipe <i>NullReferenceException</i> akan dibuang. <br><br>  Situasi serupa terlihat di tempat lain: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Task_TaskCompleted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WorkerTask task</span></span></span><span class="hljs-function">)</span></span> { .... task.KeepImage = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (task != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (task.RequestSettingUpdate) { Program.MainForm.UpdateCheckStates(); } .... } .... }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3095</a> [CWE-476] Objek 'tugas' digunakan sebelum diverifikasi terhadap nol.  Periksa baris: 268, 270. TaskManager.cs 268 <br><br>  PVS-Studio menemukan kesalahan serupa lainnya.  Artinya masih sama, jadi tidak ada kebutuhan besar untuk memberikan fragmen kode, kami membatasi diri pada pesan penganalisa. <br><br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3095</a> [CWE-476] Objek 'Config.PhotobucketAccountInfo' digunakan sebelum diverifikasi dengan null.  Periksa baris: 216, 219. UploadersConfigForm.cs 216 <br><br>  <b>Nilai pengembalian yang sama</b> <br><br>  Sepotong kode yang mencurigakan ditemukan dalam metode <i>EvalWindows</i> dari kelas <i>WindowsList</i> , yang mengembalikan <i>true</i> dalam keadaan apa pun: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WindowsList</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;IntPtr&gt; IgnoreWindows { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WindowsList</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { IgnoreWindows = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;IntPtr&gt;(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WindowsList</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IntPtr ignoreWindow</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { IgnoreWindows.Add(ignoreWindow); } .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EvalWindows</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IntPtr hWnd, IntPtr lParam</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IgnoreWindows.Any(window =&gt; hWnd == window)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } windows.Add(new WindowInfo(hWnd)); return true; // &lt;= } }</span></span></code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3009</a> Aneh bahwa metode ini selalu mengembalikan nilai yang sama dan 'benar'.  WindowsList.cs 82 <br><br>  Tampaknya logis bahwa jika sebuah pointer dengan nilai yang sama dengan <i>hWnd</i> ditemukan dalam daftar dengan nama <i>IgnoreWindows</i> , maka metode tersebut harus mengembalikan <i>false</i> . <br><br>  Daftar <i>IgnoreWindows</i> dapat diisi baik dengan memanggil konstruktor <i>WindowsList (IntPtr ignWindow)</i> , atau langsung melalui akses ke properti, karena bersifat publik.  Salah satu cara atau yang lain, menurut Visual Studio, pada saat ini dalam kode daftar ini tidak diisi dengan cara apa pun.  Ini adalah tempat aneh lain dari metode ini. <br><br>  <b>Panggilan tidak aman ke penangan acara</b> <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNewsLoaded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (NewsLoaded != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { NewsLoaded(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, EventArgs.Empty); } }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3083</a> [CWE-367] Doa yang tidak aman dari acara 'NewsLoaded', NullReferenceException dimungkinkan.  Pertimbangkan menugaskan acara ke variabel lokal sebelum menjalankannya.  NewsListControl.cs 111 <br><br>  Dalam kasus ini, situasi tidak menyenangkan berikut ini dapat terjadi: setelah memeriksa variabel <i>NewsLoaded</i> untuk ketidaksetaraan <i>nol</i> , metode yang memproses acara tersebut dapat <i>dibatalkan</i> berlangganan, misalnya, di utas lain, dan ketika kita masuk ke tubuh <i>pernyataan</i> conditional <i>if</i> , variabel <i>NewsLoaded</i> sudah <i>akan</i> menjadi sama dengan <i>nol</i> .  Mencoba memanggil pelanggan pada acara <i>NewsLoaded</i> yang <i>nol</i> akan melempar <i>NullReferenceException</i> .  Jauh lebih aman menggunakan operator kondisional nol dan menulis ulang kode di atas sebagai berikut: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNewsLoaded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { NewsLoaded?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, EventArgs.Empty); }</code> </pre> <br>  Alat analisis menunjukkan <b>68</b> tempat lebih mirip.  Kami tidak akan menjelaskannya di sini - pola panggilan acara di dalamnya serupa. <br><br>  <b>Kembalikan null dari ToString</b> <br><br>  Belum lama ini, dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>artikel</u></a> rekan yang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>menarik,</u></a> saya menemukan bahwa Microsoft tidak merekomendasikan pengembalian <i>nol</i> dari metode <i>ToString yang</i> ditimpa.  PVS-Studio sangat menyadari hal ini: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (loggerLock) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sbMessages != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; sbMessages.Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sbMessages.ToString(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3108</a> Tidak disarankan untuk mengembalikan 'null' dari metode 'ToSting ()'.  Logger.cs 167 <br><br>  <b>Mengapa pantas jika tidak menggunakan?</b> <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> SeafileCheckAccInfoResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAccountInfo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> url = URLHelpers.FixPrefix(APIURL); url = URLHelpers.CombineURL(APIURL, <span class="hljs-string"><span class="hljs-string">"account/info/?format=json"</span></span>); .... }</code> </pre> <br>  <b>PVS-Studio Warning:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3008 Variabel</a> 'url' diberi nilai dua kali berturut-turut.  Mungkin ini sebuah kesalahan.  Periksa baris: 197, 196. Seafile.cs 197 <br><br>  Seperti yang Anda lihat dari contoh, ketika mendeklarasikan variabel <i>url</i> , ia diberi nilai yang dikembalikan dari metode <i>FixPrefix</i> .  Di baris berikutnya, kami "menggiling" nilai yang dihasilkan, bahkan tanpa menggunakannya di mana pun.  Kami mendapatkan sesuatu yang mirip dengan "kode mati" - itu berfungsi, tidak mempengaruhi hasil akhir.  Kesalahan ini kemungkinan besar merupakan hasil dari copy-paste, karena fragmen kode seperti itu ditemukan di 9 metode lainnya. <br>  Sebagai contoh, kami memberikan dua metode dengan baris pertama yang serupa: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckAuthToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> url = URLHelpers.FixPrefix(APIURL); url = URLHelpers.CombineURL(APIURL, <span class="hljs-string"><span class="hljs-string">"auth/ping/?format=json"</span></span>); .... } .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckAPIURL</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> url = URLHelpers.FixPrefix(APIURL); url = URLHelpers.CombineURL(APIURL, <span class="hljs-string"><span class="hljs-string">"ping/?format=json"</span></span>); .... }</code> </pre> <br><h2>  Total </h2><br>  Seperti yang dapat kita lihat, kerumitan pengaturan verifikasi otomatis oleh alat analisis tidak bergantung pada sistem CI yang dipilih - hanya dalam 15 menit dan beberapa klik mouse, kami mengatur verifikasi kode proyek kami dengan alat analisis statis. <br><br>  Sebagai kesimpulan, kami sarankan Anda <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mengunduh dan mencoba penganalisa</a> pada proyek Anda. <br><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a> </p><br><br>  Jika Anda ingin berbagi artikel ini dengan audiens yang berbahasa Inggris, silakan gunakan tautan ke terjemahan: Oleg Andreev, Ilya Gainulin.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PVS-Studio di Awan: Azure DevOps</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id467359/">https://habr.com/ru/post/id467359/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id467347/index.html">Buku ‚ÄúMembuat kontrak pintar Solidity untuk blockchain Ethereum. Panduan Praktis</a></li>
<li><a href="../id467349/index.html">Memindahkan seorang programmer ke Estonia: bekerja, uang, dan biaya hidup</a></li>
<li><a href="../id467353/index.html">Metode Optimasi Kode untuk Redd. Bagian 1: efek cache</a></li>
<li><a href="../id467355/index.html">Wawancara dengan peneliti pasar dan tren pengembangan perangkat lunak di Eropa Tengah dan Timur, Eugene Schwab-Chesaru</a></li>
<li><a href="../id467357/index.html">PVS-Studio di Awan: Azure DevOps</a></li>
<li><a href="../id467361/index.html">Kami lupa tentang delegasi dalam JavaScript. Delegasi acara di bereaksi</a></li>
<li><a href="../id467363/index.html">Menggunakan fungsi kehilangan kustom dan metrik kualitas pembelajaran di Keras</a></li>
<li><a href="../id467365/index.html">Relai pemantauan voltase perumahan</a></li>
<li><a href="../id467369/index.html">RubyRussia 2019. Mikhail Pronyakin: apakah Ruby aman?</a></li>
<li><a href="../id467371/index.html">Parsing Wawancara Kerja Google: Menemukan Hubungan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>