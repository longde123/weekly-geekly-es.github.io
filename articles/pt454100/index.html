<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ≥Ô∏è üôãüèª üôÜüèª Problemas comuns de c√≥digo em microsservi√ßos üé∑ üßñüèø ü§üüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° pessoal! 

 Recentemente, em uma confer√™ncia da PGConf em Moscou, um dos palestrantes demonstrou uma arquitetura de "microsservi√ßo", mencionando d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Problemas comuns de c√≥digo em microsservi√ßos</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454100/"> Ol√° pessoal! <br><br>  Recentemente, em uma confer√™ncia da PGConf em Moscou, um dos palestrantes demonstrou uma arquitetura de "microsservi√ßo", mencionando de passagem que todos os microsservi√ßos herdam de uma classe base comum.  Embora n√£o houvesse explica√ß√µes para a implementa√ß√£o, parecia que nesta empresa o termo ‚Äúmicrosservi√ßos‚Äù n√£o era entendido da mesma maneira que os cl√°ssicos pareciam nos ensinar.  Hoje, lidaremos com um dos problemas interessantes - qual pode ser o c√≥digo comum em microsservi√ßos e se √© que pode ser? <br><a name="habracut"></a><br>  O que √© um microsservi√ßo?  Este √© um aplicativo independente.  N√£o √© um m√≥dulo, n√£o √© um processo, n√£o √© algo que √© simplesmente implementado separadamente, mas um aplicativo completo, real e separado.  Ele tem sua pr√≥pria fun√ß√£o principal, seu pr√≥prio reposit√≥rio no git, seus pr√≥prios testes, sua pr√≥pria API, seu pr√≥prio servidor da web, seu pr√≥prio arquivo README, seu pr√≥prio banco de dados, sua pr√≥pria vers√£o, seus pr√≥prios desenvolvedores. <br><br>  Assim como os cont√™ineres, os microsservi√ßos come√ßaram a ser usados ‚Äã‚Äãquando o poder de computa√ß√£o do HW e a confiabilidade das redes atingiram um n√≠vel tal que voc√™ pode pagar uma chamada de fun√ß√£o que dura 100 vezes mais do que antes, o consumo de mem√≥ria √© 100 vezes maior, o luxo instalar cada "av√≥" n√£o apenas em um "apartamento" separado, mas em uma "casa" separada.  Como qualquer solu√ß√£o arquitetural, a arquitetura dos microsservi√ßos mais uma vez sacrifica o desempenho, ganhando a capacidade de manuten√ß√£o do c√≥digo para os desenvolvedores.  Mas como a pessoa e a velocidade de sua rea√ß√£o continuaram as mesmas, os sistemas continuam a satisfazer os requisitos. <br><br>  Por que dividir em aplicativos separados?  Porque distribu√≠mos parte da complexidade do sistema j√° no n√≠vel da arquitetura do sistema.  Geralmente, o processo de programa√ß√£o √© um "passo inicial" da grande "parte da complexidade" inicial, e a decomposi√ß√£o (em classes, m√≥dulos, fun√ß√µes e, no nosso caso, aplicativos inteiros) √© a implementa√ß√£o de parte dessa complexidade na forma de uma estrutura.  Quando dividimos o sistema em microsservi√ßos, tomamos uma decis√£o arquitetural (bem-sucedida ou n√£o), que os desenvolvedores n√£o precisam mais tomar no futuro ao implementar partes espec√≠ficas da funcionalidade.  Sabe-se que esse microsservi√ßo espec√≠fico √© respons√°vel pelo envio de e-mails, e este - para autoriza√ß√£o, j√° foi estabelecido; portanto, todos os meus novos recursos "caem" nesse padr√£o sem discuss√£o. <br><br>  Um aspecto importante dos microsservi√ßos √© a falta de conectividade.  Os microsservi√ßos devem ser independentes da palavra "completamente".  Eles n√£o possuem estruturas de dados comuns e cada microsservi√ßo pode / deve ter sua pr√≥pria arquitetura, tecnologia, m√©todo de montagem (e assim por diante).  Por defini√ß√£o.  Porque √© uma aplica√ß√£o independente.  Altera√ß√µes no c√≥digo de um microsservi√ßo n√£o devem afetar os outros de nenhuma maneira, a menos que a API seja afetada.  Se eu tiver N microsservi√ßos escritos em Java, n√£o deve haver nenhum fator constrangedor para n√£o gravar o microsservi√ßo N + 1 em Python, se for subitamente lucrativo por algum motivo.  Eles s√£o fracamente acoplados e, portanto, um desenvolvedor que come√ßa a trabalhar com um microsservi√ßo espec√≠fico: <br><br>  a) Monitora com muita sensibilidade sua API, porque √© o √∫nico componente vis√≠vel do lado de fora; <br>  b) sente-se completamente livre na refatora√ß√£o; <br>  c) Entenda o prop√≥sito do microsservi√ßo (lembramos aqui sobre SRP) e implemente uma nova fun√ß√£o de acordo; <br>  d) Seleciona o m√©todo de persist√™ncia mais adequado; <br>  etc. <br><br>  Tudo isso √© bom e soa l√≥gico e harmonioso, como muitas ideologias e teorias (e aqui o te√≥rico ideol√≥gico p√µe fim e vai jantar), mas estamos praticando.  O c√≥digo n√£o precisa ser escrito em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">martinfowler.com</a> .  E mais cedo ou mais tarde nos deparamos com o fato de que todos os microsservi√ßos: <br><br><ul><li>  informa√ß√µes de log; </li><li>  conter autoriza√ß√£o; </li><li>  Acessar agentes de mensagens </li><li>  retorne as mensagens de erro corretas; </li><li>  deve, de alguma maneira, entender as entidades gerais do sistema, se houver; </li><li>  deve trabalhar com um formato de mensagem comum (e protocolo); </li></ul><br>  e fa√ßa de forma id√™ntica. <br><br>  E, em algum momento, o arquiteto ideol√≥gico come√ßa a trabalhar de manh√£ e descobre que uma ‚Äúbiblioteca‚Äù apareceu no sistema √† noite - um novo reposit√≥rio com um c√≥digo comum usado em muitos microsservi√ßos.  Um arquiteto deveria estar horrorizado? <br><br>  Isso depende <br><br>  Para avaliar corretamente a situa√ß√£o, devemos retornar √† id√©ia principal: microsservi√ßos s√£o uma cole√ß√£o de aplicativos independentes que interagem entre si por meio de uma API (de rede).  Nisto, vemos a principal vantagem e simplicidade da arquitetura.  E n√£o queremos perder essa vantagem sob nenhuma circunst√¢ncia.  O c√≥digo geral que foi colocado na "biblioteca" interfere nisso?  Vejamos alguns exemplos. <br><br>  1. A classe de usu√°rio (ou alguma outra entidade comercial) mora na biblioteca. <br><br><ul><li>  isto √©  uma entidade comercial n√£o est√° encapsulada em um microsservi√ßo, mas se espalha de maneira diferente (caso contr√°rio, por que coloc√°-la em uma biblioteca de c√≥digos compartilhada?); </li><li>  isto √©  os microsservi√ßos se conectam atrav√©s dessa entidade comercial, alterando a l√≥gica de trabalhar com uma entidade afetar√° v√°rios microsservi√ßos; </li><li>  √© ruim, muito ruim, n√£o s√£o microsservi√ßos, embora n√£o seja "grande bola de lama", mas muito rapidamente a vis√£o de mundo da equipe levar√° a "grande bola de lama distribu√≠da"; </li><li>  mas os microsservi√ßos no sistema trabalham com os mesmos conceitos, e os conceitos geralmente s√£o entidades ou apenas estruturas com campos, o que devo fazer?  Leia DDD, √© exatamente como encapsular entidades dentro de microsservi√ßos para que eles n√£o "voem" pela API. </li></ul><br>  Infelizmente, qualquer l√≥gica comercial colocada em uma biblioteca compartilhada ter√° esse efeito.  As bibliotecas de c√≥digos gerais tendem a crescer, resultando no meio do sistema formando um "tumor" l√≥gico que n√£o pertence a nenhum microsservi√ßo espec√≠fico, e a arquitetura falha.  O "centro de gravidade l√≥gica" do sistema come√ßa a se transformar em um reposit√≥rio com um c√≥digo comum, e temos uma mistura infernal de mon√≥lito e microsservi√ßos, e n√£o precisamos ir at√© l√°. <br><br>  2. O c√≥digo de an√°lise para o formato da mensagem √© colocado na biblioteca. <br><br><ul><li>  O c√≥digo √© mais prov√°vel em Java se todos os microsservi√ßos forem gravados em Java; </li><li>  Se amanh√£ eu escrever um servi√ßo em Python, n√£o poderei usar o analisador, mas parece que n√£o h√° nenhum problema, escreverei uma vers√£o em Python; </li><li>  Ponto-chave: se estou escrevendo um novo microsservi√ßo em Java, preciso usar esse analisador?  Sim, provavelmente n√£o.  Talvez eu n√£o seja obrigado, embora, como desenvolvedor de microsservi√ßos, possa ser muito √∫til.  Bem, como se eu tivesse encontrado algo √∫til no Reposit√≥rio Maven. </li></ul><br>  Um analisador de mensagens, um logger aprimorado ou um cliente agrupado para enviar dados para o RabbitMQ - √© como auxiliares, componentes auxiliares.  Eles est√£o a par das bibliotecas padr√£o do NuGet, Maven ou NPM.  O desenvolvedor do microsservi√ßo √© sempre o rei; ele decide se deve usar a biblioteca padr√£o ou criar seu pr√≥prio c√≥digo novo ou usar o c√≥digo da biblioteca auxiliar compartilhada.  Como ser√° mais conveniente para ele, porque ele escreve um APP SEPARADO E INDEPENDENTE.  Um ajudante em particular pode evoluir?  Talvez ele provavelmente tenha vers√µes.  Deixe o desenvolvedor se referir a uma vers√£o espec√≠fica em seu servi√ßo, ningu√©m o obriga a atualizar o servi√ßo; ao atualizar os auxiliares, essa √© uma pergunta para quem suporta o servi√ßo. <br><br>  3. Interface Java, classe base abstrata, caracter√≠stica. <br><br><ul><li>  Ou outra pe√ßa da categoria de "c√≥digo rasgado"; </li><li>  I.e.  Estou aqui, independente e independente, e um peda√ßo do meu f√≠gado est√° em outro lugar; </li><li>  Aqui a coer√™ncia dos microsservi√ßos no n√≠vel do c√≥digo √© exibida, portanto n√£o a recomendamos; </li><li>  Nos est√°gios iniciais, isso provavelmente n√£o trar√° problemas tang√≠veis, mas a ess√™ncia do projeto arquitet√¥nico √© a garantia de conforto (ou desconforto) nos pr√≥ximos anos. </li></ul><br>  A equipe que come√ßa a trabalhar em um novo produto estabelece as bases da arquitetura e exerce a maior influ√™ncia sobre as tend√™ncias que o produto ter√°.  Se os princ√≠pios de SRP, decomposi√ß√£o bem-sucedida, baixa conectividade etc. forem inicialmente incorporados ao sistema, ele poder√° continuar a se desenvolver corretamente.  Caso contr√°rio, a acelera√ß√£o centr√≠fuga dos "fatores do tempo" (outra equipe, pouco tempo, corre√ß√µes urgentes, falta de documenta√ß√£o) lan√ßar√° esse sistema mais √† margem, mais r√°pido do que parece. <br><br>  A quest√£o de um c√≥digo comum em microsservi√ßos permanece dif√≠cil porque est√° associada a algum tipo de compensa√ß√£o: ponderamos o que ser√° mais lucrativo no futuro - o grau de independ√™ncia dos microsservi√ßos, menos repeti√ß√µes no c√≥digo, as qualifica√ß√µes dos engenheiros, a simplicidade do sistema etc.  Cada vez, essas s√£o reflex√µes e discuss√µes, que podem levar a diferentes decis√µes arquitet√¥nicas espec√≠ficas.  No entanto, vamos resumir algumas das recomenda√ß√µes: <br><br>  Recomenda√ß√£o 0: N√£o chame microsservi√ßos de nada que esteja dividido em partes existentes independentemente.  Nem toda tabela com colunas √© uma matriz, vamos usar os termos corretamente. <br><br>  Recomenda√ß√£o 1: √â altamente desej√°vel que os microsservi√ßos n√£o possuam c√≥digo comum. <br><br>  Recomenda√ß√£o 2: Se ainda houver um c√≥digo comum, seja uma cole√ß√£o (biblioteca) de "auxiliares" opcionais.  O desenvolvedor do servi√ßo decide se deve us√°-los ou escrever seu pr√≥prio c√≥digo. <br><br>  Recomenda√ß√£o 3: Sob nenhuma circunst√¢ncia deve haver l√≥gica comercial no c√≥digo comum.  Toda a l√≥gica de neg√≥cios √© encapsulada em microsservi√ßos. <br><br>  Recomenda√ß√£o 4: Deixe a biblioteca de c√≥digos comum ser projetada como um pacote padr√£o (NuGet, Maven, NPM, etc), com a op√ß√£o de versionamento (ou, melhor ainda, v√°rios pacotes separados). <br><br>  Recomenda√ß√£o 5: O "centro de gravidade l√≥gica" do sistema deve sempre permanecer nos pr√≥prios microsservi√ßos, e n√£o no c√≥digo comum. <br><br>  Recomenda√ß√£o 6: se voc√™ planeja escrever no formato de microsservi√ßos, reconcilie antecipadamente que o c√≥digo entre eles √†s vezes ser√° duplicado.  At√© certo ponto, nosso "instinto SECO" natural deve ser suprimido. <br><br>  Agradecemos sua aten√ß√£o e microsservi√ßos bem-sucedidos. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt454100/">https://habr.com/ru/post/pt454100/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt454084/index.html">Diretrizes ao vivo - MDX e outras estruturas</a></li>
<li><a href="../pt454086/index.html">O que o RIT ++ 2019 lembrou</a></li>
<li><a href="../pt454088/index.html">Vota√ß√£o de relat√≥rios na reuni√£o de bricolage de ver√£o no grupo Mail.ru em 16 de junho</a></li>
<li><a href="../pt454096/index.html">Resumo dos eventos de TI em junho</a></li>
<li><a href="../pt454098/index.html">A fus√£o de duas an√£s brancas pode terminar com o advento de uma nova estrela de n√™utrons</a></li>
<li><a href="../pt454102/index.html">Usando um or√°culo aleat√≥rio no exemplo de uma loteria</a></li>
<li><a href="../pt454104/index.html">Servi√ßos na nuvem para jogar em PCs fracos, relevantes em 2019</a></li>
<li><a href="../pt454110/index.html">Desenvolvimento de uma loja online para preservar a natureza de Kamchatka</a></li>
<li><a href="../pt454112/index.html">Duke Nukem Level Design History (com esbo√ßos de Levelord)</a></li>
<li><a href="../pt454114/index.html">Experi√™ncia no uso do Starwind VSAN e do EMC ScaleIO (VxFlexOS) + dicas para o armazenamento mini Enterprise (1 parte)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>