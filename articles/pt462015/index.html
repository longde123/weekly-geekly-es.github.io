<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéâ üà≤ üêØ Universo de relat√≥rios SAP üßíüèΩ üëì üò∑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="H√° cerca de quatro anos, mudamos nosso sistema de relat√≥rios do Oracle para o SAP Hana. Hoje, ele armazena cerca de 10.000 tabelas, 38.000 pessoas a u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Universo de relat√≥rios SAP</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mvideo/blog/462015/"><img src="https://habrastorage.org/webt/nf/96/da/nf96daardoyhax1e_lj6oy2wk9o.jpeg"><br><br>  H√° cerca de quatro anos, mudamos nosso sistema de relat√≥rios do Oracle para o SAP Hana.  Hoje, ele armazena cerca de 10.000 tabelas, 38.000 pessoas a usam e mais de 5.000 processos de carregamento ocorrem diariamente.  No momento, nosso complexo, no qual o sistema funciona, consiste em 8 servidores com 14 TB de mem√≥ria.  Todos os dias, o sistema de relat√≥rios processa 1,5 pb de dados.  Ao mesmo tempo, Hana era cerca de 20 vezes mais produtivo que Oracle, DB2 e MySQL.  E hoje quero dizer como, no √¢mbito da integra√ß√£o da M.Video e Eldorado, aumentamos ainda mais o desempenho do sistema de relat√≥rios, que otimiza√ß√µes fizemos. <br><a name="habracut"></a><br><h2>  Carregar </h2><br>  Hoje, dos milhares de relat√≥rios criados pelo sistema, apenas 10 geram 70% da carga total.  O relat√≥rio mais pesado no banco de dados Hana √© o Weekly Bussines Review.  Ele dura 30 minutos e consome 4 TB de mem√≥ria.  90% de todos os relat√≥rios s√£o gerados pelo contact center: criamos um servi√ßo que, quando um cliente liga por seu n√∫mero de telefone, abre automaticamente um relat√≥rio e mostra ao operador todo o hist√≥rico de compras do chamador e sua intera√ß√£o com a empresa. <br><br><h2>  Modelo de dados </h2><br>  O modelo de dados chave no qual a maior parte dos relat√≥rios √© criada cont√©m 1.500 tabelas.  A maioria deles s√£o tabelas de refer√™ncia.  Usando esse modelo, voc√™ pode analisar qualquer dire√ß√£o da empresa.  Um exemplo √© a visualiza√ß√£o de um modelo de dados criado usando o designer do Universe.  √â verdade que reflete apenas um d√©cimo do nosso sistema. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/054/47a/9d3/05447a9d3d7447a41a4732c49a7b205d.png"><br><br><h2>  Desempenho </h2><br>  No momento da fus√£o da M.Video e da Eldorado, a quantidade de dados nos dois sistemas de relat√≥rio era de aproximadamente 10 TB: 7 TB no BW no sistema HANA M.Video, 2 TB no BW no HANA Eldorado e 1 TB dados adicionais no HADOOP (dados hist√≥ricos).  Ao combinar os sistemas, t√≠nhamos limita√ß√µes de hardware: o complexo M. Video consistia em 6 n√≥s (2 TB cada), incluindo um backup.  Este sistema pode ser expandido para um m√°ximo de 8 n√≥s, dos quais um backup. <br><br>  Em prepara√ß√£o para a fus√£o, assumimos que a quantidade total de todos os dados chegaria a 13 TB.  Portanto, com base nas recomenda√ß√µes da SAP, precis√°vamos de um sistema de 16 n√≥s de 2 TB cada, incluindo dois n√≥s de backup.  Al√©m disso, um n√≥ precisava ser alocado como n√≥ principal, o qual, com esse volume de informa√ß√µes, assumiria as fun√ß√µes de gerenciamento.  Ou seja, para a opera√ß√£o correta, foi necess√°rio implantar 13 n√≥s. <br><br>  Como voc√™ pode ver, os recursos dispon√≠veis categoricamente n√£o s√£o suficientes.  E esse foi o primeiro desafio. <br><br>  A segunda principal dificuldade antes da fus√£o foi que a velocidade do sistema geralmente n√£o atendia √†s necessidades dos neg√≥cios.  O principal motivo foi o grande n√∫mero de chamadas simult√¢neas no banco de dados.  Do ponto de vista do sistema, parecia uma bola de neve, o que poderia levar ao congelamento e √† interrup√ß√£o de parte dos processos, ou at√© a despejos globais de ‚Äúfalta de mem√≥ria‚Äù nos n√≥s. <br><br>  Ficou claro que, sem melhorias significativas, um aumento duplo na quantidade de dados nos relat√≥rios (para duas marcas) levaria a um agravamento aproximadamente duplo da situa√ß√£o. <br><br>  Portanto, decidimos otimizar o sistema nas seguintes √°reas: <br><br><ul><li>  <b>Relat√≥rios</b>  Acelera√ß√£o dos relat√≥rios mais cr√≠ticos e com mais recursos e revis√£o do modelo de dados. <br></li><li>  <b>Reposit√≥rio</b> .  Otimiza√ß√£o de arquivamento e armazenamento. <br></li><li>  <b>Downloads</b> .  Simplifique o procedimento e altere a programa√ß√£o de download. <br></li></ul><br>  A abordagem geral da otimiza√ß√£o foi a seguinte: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1aa/534/20d/1aa53420d809464c7d3f28bd9761e411.png"><br><br>  Primeiro, realizamos uma an√°lise em todas as dire√ß√µes, identificamos as causas dos problemas e, em seguida, analisamos os recursos do sistema com os recursos necess√°rios.  Tamb√©m tentamos imediatamente automatizar esse processo o m√°ximo poss√≠vel para que, no futuro, possamos identificar rapidamente as causas dos problemas e restaurar rapidamente o desempenho. <br><br>  O que fizemos: <br><br><ul><li>  Mudou a configura√ß√£o dos servidores de aplicativos ABAP: o n√∫mero de inst√¢ncias, o uso efetivo da tecnologia NUMA e o n√∫mero ideal de fluxos de trabalho. <br></li><li>  Aplicamos os par√¢metros ideais do HANA e do sistema operacional Linux. <br></li><li>  Analisamos a diminui√ß√£o no consumo de CPU. <br></li><li>  Analisamos o consumo de RAM em todo o intervalo de tempo observado. <br></li><li>  Analisamos a ocorr√™ncia de OOM no HANA. <br></li><li>  Analisamos a ocorr√™ncia de bloqueios no sistema e a disponibilidade de recursos do sistema para opera√ß√µes de espera (espera). <br></li><li>  Analisamos o equil√≠brio dos dados, levando em considera√ß√£o a redistribui√ß√£o e reparti√ß√£o dos dados para a solu√ß√£o SCANA-OUT HANA. <br></li><li>  Analisamos as causas dos lix√µes ABAP que afetam a opera√ß√£o de cadeias cr√≠ticas. <br></li></ul><br>  Com base nos resultados, foram compilados relat√≥rios de desempenho e instru√ß√µes para que, no futuro, fosse poss√≠vel determinar independentemente gargalos no sistema e intervalos de tempo de pico. <br><br>  Que resultados foram alcan√ßados: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/82a/e7e/382/82ae7e3826abf0a8eaf2cafb2c10d27b.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d5a/b6e/221/d5ab6e221145f19b6f385738f57d9dca.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a5e/a35/4d2/a5ea354d258baaed8ef8176ad0a0ad45.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/1dc/654/1f7/1dc6541f7d68c70012d8203e92182775.png"><br><br>  V√°rios relat√≥rios otimizados O SAP BO come√ßou a trabalhar <b>muitas vezes mais rapidamente</b> e consumir <b>centenas de vezes menos mem√≥ria</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7fc/ed2/3c7/7fced23c7b586cf2334745b265245447.png"><br><br>  Aqui est√£o alguns exemplos impressionantes de como o sistema atende incorretamente √†s condi√ß√µes de sele√ß√£o e como criar consultas corretamente no HANA. <br><br>  Os problemas foram revelados ao filtrar por objetos n√£o materializados, especialmente (!) Ao usar indicadores <code>COUNT DISTINCT</code> (um CD pode ser gravado no n√≠vel do Universo e em uma fun√ß√£o no CV). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c2c/25c/e8c/c2c25ce8cab11363b6dd1958c9b1c25a.png"><br><br>  Mesmo se voc√™ excluir o CD da consulta, a primeira op√ß√£o ainda ser√° executada 20 vezes mais lenta que a segunda e, com um CD, a velocidade √© mais de 500 vezes maior. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1dc/f0b/6a3/1dcf0b6a38e4053829e20a531d67c45a.png"><br><br>  Um caso especial de uso de objetos n√£o materializados em filtros: filtros compostos de dois ou mais objetos, por exemplo, colando uma semana e um ano: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cda/a3a/d8e/cdaa3ad8e73905c217346b6b00004dd0.png"><br><br>  As consultas com filtros colados n√£o funcionam t√£o lentamente quanto a convers√£o para uma data, mas ainda diminuem as consultas (cerca de 2 a 3 vezes). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cec/182/9d6/cec1829d65a06d6d73f53b2110cfc4e3.png"><br><br>  Para coletar estat√≠sticas sobre a opera√ß√£o do sistema de relat√≥rios, carregando processos e cadeias, desenvolvemos o seguinte esquema: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9fc/3c5/d8a/9fc3c5d8aab834bca29c4988592f25f8.png"><br><br>  Ao mesmo tempo, adicionamos um coment√°rio especial aos relat√≥rios com o nome do relat√≥rio.  Assim, podemos comparar a carga de diferentes partes do sistema e comparar o per√≠odo com o per√≠odo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/14e/665/69b/14e66569bb4292fb4e66364fe51de6be.png"><br><br><h2>  <font color="#ec2028">Planos</font> </h2><br>  Temos muitos planos para o desenvolvimento da funcionalidade comercial e uma revis√£o substancial da ferramenta de visualiza√ß√£o de dados.  A tend√™ncia global em que estamos participando ativamente √© integrar o sistema de relat√≥rios ao paradigma da transforma√ß√£o digital. <br><br>  Como assim? <br><br>  Quando nosso sistema de relat√≥rios era jovem, os usu√°rios costumavam nos procurar com solicita√ß√µes semelhantes: "Automatize a constru√ß√£o de um relat√≥rio que mostre quanto lucro l√≠quido esta ou aquela loja ou toda a empresa receberam". <br><br>  Ent√£o eles come√ßaram a nos procurar com pedidos de um algoritmo que constru√≠sse um plano ou previs√£o de lucro l√≠quido, dependendo de fatores espec√≠ficos. <br><br>  E hoje chegamos √† conclus√£o de que os usu√°rios desejam conhecer a previs√£o exata do lucro l√≠quido.  Temos todos os dados necess√°rios para o desenvolvimento de algoritmos de previs√£o e existem especialistas em an√°lise de dados que podem criar modelos de aprendizado de m√°quina.  Como voc√™ sabe, isso requer quantidades realmente grandes de dados; portanto, uma das principais tend√™ncias no desenvolvimento de nosso sistema de relat√≥rios √© a transi√ß√£o para a an√°lise e cria√ß√£o de modelos baseados em big data. <br><br><h2>  <font color="#ec2028">Algumas palavras sobre nossa equipe</font> </h2><br>  Hoje, as grandes empresas est√£o cada vez mais introduzindo sistemas de previs√£o baseados em algoritmos de aprendizado de m√°quina desenvolvidos pelo pr√≥prio sistema.  H√° dois anos, criamos um centro de compet√™ncia no campo de an√°lise de dados do Digital Retail Data Science Center, e este ano temos um grupo de engenheiros de dados.  Estamos introduzindo um novo sistema para processar e analisar big data.  E precisamos de pessoas da equipe nos departamentos de suporte, desenvolvimento e an√°lise de dados aplicada. <br><br>  Se voc√™ estiver interessado nessas √°reas, se sentir a for√ßa em si mesmo - seja bem-vindo!  Voc√™ encontrar√° trabalhos interessantes e dif√≠ceis, √†s vezes estressantes, mas sempre criativos. <img src="https://habrastorage.org/files/fa7/d16/199/fa7d16199fca4fee89c0b96fa9919513.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt462015/">https://habr.com/ru/post/pt462015/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt462005/index.html">Recursos do Google PageSpeed: melhor classifica√ß√£o do site e classifica√ß√£o da pesquisa</a></li>
<li><a href="../pt462007/index.html">Desenvolvendo scripts Python robustos</a></li>
<li><a href="../pt462009/index.html">Tend√™ncias de programa√ß√£o: o que se pode esperar em 2020?</a></li>
<li><a href="../pt462011/index.html">Servi√ßos geogr√°ficos da Web. Vis√£o geral de solu√ß√µes modernas</a></li>
<li><a href="../pt462013/index.html">Hist√≥rico de problemas de migra√ß√£o do Docker storage (docker root)</a></li>
<li><a href="../pt462021/index.html">Como parar de fazer a mesma coisa</a></li>
<li><a href="../pt462023/index.html">Cascadeur: O Futuro da Anima√ß√£o de Jogos</a></li>
<li><a href="../pt462025/index.html">Modelo de dados de rede relacional</a></li>
<li><a href="../pt462027/index.html">Como o Dark implanta c√≥digo de 50ms</a></li>
<li><a href="../pt462029/index.html">19 recursos √∫teis do arquivo .htaccess</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>