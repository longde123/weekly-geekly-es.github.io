<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏾‍💼 🔣 👩‍👩‍👧‍👦 虚拟现实及其周围的WebRTC流 🎤 🧘🏻 🛩️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="这些天，虚拟现实正在兴起。 以前是独家保留的设备  疯狂的科学家  有大钱的怪胎  来自国防部  回到“割草机人”时代，目前普通百姓负担得起； 那些口袋空了的人可以根据许多食谱，用纸板和智能手机组装一个VR头戴式耳机。 


 VR可以带来比3-4-5-6-7-something-D电影院更多的收益...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>虚拟现实及其周围的WebRTC流</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flashphoner/blog/482270/"><p><img src="https://habrastorage.org/webt/jw/qo/v9/jwqov9cav_juhuolm3cwf8xm-aw.jpeg"></p><br><p> 这些天，虚拟现实正在兴起。 以前是独家保留的设备 <del> 疯狂的科学家 </del> 有大钱的怪胎 <del> 来自国防部 </del> 回到“割草机人”时代，目前普通百姓负担得起； 那些口袋空了的人可以根据许多食谱，用纸板和智能手机组装一个VR头戴式耳机。 </p><a name="habracut"></a><br><p>  VR可以带来比3-4-5-6-7-something-D电影院更多的收益。 假设您居住在芝加哥，并且想将诚实赚取的资源投资到房地产上-佛罗里达州沿海的某个地方。 如您所知，最好选择自己居住和当场居住，但是如果您不能花足够的时间去做呢？ 这是需要虚拟现实的地方。 试想一下：特工在房间里设置了一个特殊的摄像头，您不用离开自己喜欢的椅子就可以检查这个房间，转过头，甚至可以欣赏带有18世纪壁画的“希腊诸神开派对！”的天花板。 </p><br><p> 然后，仍然没有离开这个地方，您可能想知道您的孩子在幼儿园做什么。 再说一次：相机在游戏室中，通过检查孩子所处的所有角落，您可以获得身临其境的感官体验 <del> 隐藏 </del>  。 </p><br><p> 现在，我们将弄清楚如何确保一切正常，并且 <del> 房地产经纪人 </del> 孩子们不要分散。 </p><br><h2 id="the-nuances-of-vr-picture">  VR图片的细微差别 </h2><br><p> 从技术上讲，VR媒体流与普通媒体没有区别。 它是视频轨道和音频轨道。 但是有细微差别。 </p><br><p>  VR流假定为立体声图像。 一台特殊的相机用两个视角观察世界 <del> 眼睛 </del> 镜头像机器人一样张开（180度）。 </p><br><p><img src="https://habrastorage.org/webt/yv/wq/gc/yvwqgcgjjnblruhtjnhduw3_xwq.jpeg"></p><br><p> 图片合并在一帧中 </p><br><p><img src="https://habrastorage.org/webt/ot/mn/li/otmnli2-vsrodo4wcjplsdmuw50.png"></p><br><p> 因此，应在观看者的设备上安装特殊的播放器，以制作两张图片。 如您所见，帧的纵横比为2：1，从而为每只眼睛制作了FullHD图片。 </p><br><h2 id="the-nuances-of-vr-broadcast">  VR广播的细微差别 </h2><br><p> 因此，我们正在谈论以高比特率广播4K流。 我们有什么？ 我们有RTMP和WebRTC。 </p><br><p>  RTMP是 <del> 便宜的 </del> 可靠实用。 它使用TCP，在通道不太理想的情况下很有用。 为发布客户提供了各种软件解决方案，包括付费和免费的。 但是，尽管有很多优点，RTMP仍具有较高的延迟。 在之前的一篇文章中，我们注意到720p流中的延迟为2-3秒。 在某些情况下，延迟是可以接受的，但是VR会落后于现实，孩子们肯定会分散。 </p><br><p>  WebRTC真的很棒。 有了良好的渠道，延迟的测量单位是毫秒，而现实将依然存在。 但是有细微差别。 </p><br><p> 首先，默认情况下，WebRTC在UDP上运行，这将导致信道质量下降至少一点的损失。 对于4K数据流，通道上的任何小东西都已经恶化。 这可以通过切换到TCP传输来解决，但是在这种情况下... </p><br><p>其次，WebRTC是通过浏览器广播的，我们都知道哪种浏览器当前是全球最受欢迎的（破坏者-不是IE6）。 在此流行的浏览器中，引擎级别的最大发布比特率是2500 kbps。 <del> 正如谷歌认为 </del>  ，对于FullHD而言已足够，但对于4K而言则不足。 如果比特率未加快到5-10 Mbps，则观看者将看到移动的水彩斑点，而不是虚拟现实。 幸运的是，有一些特殊设置可以超频工作的比特率 <del> 差不多 </del>  Chromium引擎上的所有浏览器。 然后，克服这一障碍，我们将遇到... </p><br><p> 第三，我们将遇到信道带宽。 要发布和播放具有上述比特率的VR图片，客户端需要使用20+ Mbit或更好的50，甚至更好的100+ Mbit的频道进行下载和上传。 在这种情况下，这些不应是提供商在广告手册中谈论的参数，而应是从客户端到服务器的实际带宽。 顺便说一下，阅读如何在<a href="https://flashphoner.com/channel-quality-indicator-for-server-webrtc-over-tcp/">不使用iperf和命令行的情况下</a>进行<a href="https://flashphoner.com/channel-quality-indicator-for-server-webrtc-over-tcp/">测量</a> 。 相应地，在服务器端，如果设想到大量流，则希望具有10 Gb。 </p><br><p> 第四是对渠道的要求。 对4K流进行转码将占用服务器上过多的处理器资源。 因此，您必须选择昂贵的特大服务器，或者在昂贵的视频卡上使用编码，或者避免转码。 也就是说，在广播过程中，请勿更改流的分辨率，帧速率和比特率。 </p><br><h2 id="lets-try-to-do-this"> 让我们尝试这样做 </h2><br><p> 让我们来： </p><br><ul><li> 专用相机； </li><li> 一个特殊的球员； </li><li> 可以<a href="https://flashphoner.com/browser-online-broadcasting-from-a-web-cam/">从浏览器广播WebRTC</a>的服务器 </li></ul><br><p> 将相机安装在桌子或三脚架上 </p><br><p><img src="https://habrastorage.org/webt/q-/bo/tw/q-botwt5-af0pl19umr-zphiez0.jpeg"></p><br><p> 与外部驱动器一样，通过具有1A电源的USB 3.0将其连接到PC </p><br><p><img src="https://habrastorage.org/webt/kh/4p/bp/kh4pbpwvvpvceliez14mgn0ocjc.jpeg"></p><br><p> 请注意，相机对设备非常敏感，如果笔记本电脑具有2个USB 3.0端口，则可能会拒绝使用其中之一。 确保不要使用廉价的中文连接电缆； 标准提供的所有引脚都应安装到位。 即使连接完美，相机也会产生毛刺，就像雷雨中的旧电视一样。 唯一积极的一点是Windows 10不需要驱动程序。 这是一个诚实的即插即用型连接。 </p><br><p> 我们将在服务器端设置必要的比特率限制 </p><br><pre><code class="plaintext hljs">webrtc_cc_min_bitrate=5000000 webrtc_cc_max_bitrate=10000000</code> </pre> <br><p> 在Chrome中，打开示例<a href="https://demo.flashphoner.com:8888/client2/examples/demo/streaming/media_devices_manager/media_device_manager.html">页面</a> ，允许设置必要的参数以捕获来自相机的流，然后进行设置 </p><br><ul><li> 分辨率3072x1536 </li><li>  FPS 24（从浏览器广播时，相机仅支持此FPS） </li><li>  TCP传输 </li></ul><br><p> 并配置SDP设置，以使浏览器不会降低客户端的比特率 </p><br><pre> <code class="javascript hljs">x-google-max-bitrate=<span class="hljs-number"><span class="hljs-number">10000</span></span>;x-google-min-bitrate=<span class="hljs-number"><span class="hljs-number">5000</span></span></code> </pre> <br><p> 或服务器端（在这种情况下，设置将对所有发布客户端均有效） </p><br><pre> <code class="plaintext hljs">webrtc_sdp_min_bitrate_bps=5000000 webrtc_sdp_max_bitrate_bps=10000000</code> </pre> <br><p><img src="https://habrastorage.org/webt/ae/6z/r7/ae6zr7vxhkeeh65bp144sjklxfg.png"></p><br><p> 让我们发布相机中的视频流 </p><br><p><img src="https://habrastorage.org/webt/hq/-r/hu/hq-rhunttdvkc4cff_o9uurcbec.png"></p><br><p> 现在，让我们尝试使用普通的WebRTC播放器播放流 </p><br><p><img src="https://habrastorage.org/webt/ot/mn/li/otmnli2-vsrodo4wcjplsdmuw50.png"></p><br><p> 一切都很好。 虚拟性不是真正的虚拟性。 现在，让我们在页面上嵌入的特殊播放器中播放相同的流 </p><br><p><img src="https://habrastorage.org/webt/ij/ki/m-/ijkim-0dccwdgyeccgirdcusgec.png"></p><br><p> 现在好了（我们也养猫了）。 如果您在移动设备或VR眼镜上播放视频流，则可以转头，我们将在PC的浏览器中移动鼠标。 这个房间里某个地方藏着一个孩子。 让我们向左看 </p><br><p><img src="https://habrastorage.org/webt/gc/dm/df/gcdmdflghc1jm1wxnleffttk-he.png"></p><br><p> 现在在右边 </p><br><p><img src="https://habrastorage.org/webt/ct/iy/gl/ctiyglkgyc2wb987mj6pzpgqdji.png"></p><br><p> 现在起来 </p><br><p><img src="https://habrastorage.org/webt/nd/j8/3m/ndj83milhj9weql0x1ifufccuou.png"></p><br><p> 孩子在哪 他在那里，躲在窗帘后面。 但是猫看见了他！ </p><br><h2 id="we-need-more-code"> 我们需要更多代码！ </h2><br><p> 客户端的代码很少。 </p><br><p> 让我们从浏览器页面发布流 </p><br><pre> <code class="javascript hljs">session.createStream({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: streamName, <span class="hljs-attr"><span class="hljs-attr">display</span></span>: localVideo, <span class="hljs-attr"><span class="hljs-attr">cacheLocalResources</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">transport</span></span>: <span class="hljs-string"><span class="hljs-string">"TCP"</span></span>, <span class="hljs-attr"><span class="hljs-attr">sdpHook</span></span>: rewriteSdp, <span class="hljs-attr"><span class="hljs-attr">constraints</span></span>: { <span class="hljs-attr"><span class="hljs-attr">audio</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">video</span></span>: { <span class="hljs-attr"><span class="hljs-attr">width</span></span>: <span class="hljs-number"><span class="hljs-number">3072</span></span>, <span class="hljs-attr"><span class="hljs-attr">height</span></span>: <span class="hljs-number"><span class="hljs-number">1536</span></span>, <span class="hljs-attr"><span class="hljs-attr">frameRate</span></span>: <span class="hljs-number"><span class="hljs-number">24</span></span> } } }).publish();</code> </pre> <br><p>  SDP浏览器覆盖功能 </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rewriteSdp</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">sdp</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sdpStringFind = <span class="hljs-string"><span class="hljs-string">"a=fmtp:(.*) (.*)"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sdpStringReplace = <span class="hljs-string"><span class="hljs-string">"a=fmtp:$1 $2;x-google-max-bitrate=10000;x-google-min-bitrate=5000"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newSDP = sdp.sdpString.toString(); newSDP = newSDP.replace(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">RegExp</span></span>(sdpStringFind,<span class="hljs-string"><span class="hljs-string">"g"</span></span>), sdpStringReplace); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> newSDP; }</code> </pre> <br><p> 一个带有VR播放器的页面示例 </p><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>WebRTC Delight<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"viewport"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width=device-width, initial-scale=1.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"../../../../flashphoner.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"../../dependencies/jquery/jquery-1.12.0.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"../../dependencies/js/utils.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dl8-player.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">async</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dl8-custom-format"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{"name": "STEREO_TERPON","base":"STEREO_MESH","params":{"uri": "03198702.json"}}'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width: 50%;"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dl8-live-video</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"remoteVideo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">format</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"STEREO_TERPON"</span></span></span><span class="hljs-tag">&gt;</span></span> \<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dl8-live-video</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"playStream"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Stream Name"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"playBtn"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-default"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span><span class="hljs-tag">&gt;</span></span>Play<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stopBtn"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-default"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span><span class="hljs-tag">&gt;</span></span>Stop<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> Flashphoner.init({</span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">flashMediaProviderSwfLocation</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'../../../../media-provider.swf'</span></span></span><span class="javascript">}); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> SESSION_STATUS = Flashphoner.constants.SESSION_STATUS; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> STREAM_STATUS = Flashphoner.constants.STREAM_STATUS; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> STREAM_STATUS_INFO = Flashphoner.constants.STREAM_STATUS_INFO; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> playBtn = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementById(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'playBtn'</span></span></span><span class="javascript">); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> display = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementById(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'display'</span></span></span><span class="javascript">); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> dl8video = </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">null</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> url = setURL(); </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.addEventListener(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'x-dl8-evt-ready'</span></span></span><span class="javascript">, </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> (</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ dl8video = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementById(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'remoteVideo'</span></span></span><span class="javascript">); $(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#playBtn'</span></span></span><span class="javascript">).prop(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'disabled'</span></span></span><span class="javascript">, </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">false</span></span></span><span class="javascript">).click(</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ playStream(); }); }); </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">playStream</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ $(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#playBtn'</span></span></span><span class="javascript">).prop(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'disabled'</span></span></span><span class="javascript">, </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">true</span></span></span><span class="javascript">); $(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#stopBtn'</span></span></span><span class="javascript">).prop(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'disabled'</span></span></span><span class="javascript">, </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">false</span></span></span><span class="javascript">); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> video = dl8video.contentElement; Flashphoner.createSession({</span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">urlServer</span></span></span><span class="javascript">: url}).on(SESSION_STATUS.ESTABLISHED, </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> (</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">session</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> session = Flashphoner.getSessions()[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">]; session.createStream({ </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementById(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'playStream'</span></span></span><span class="javascript">).value, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">display</span></span></span><span class="javascript">: display, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">remoteVideo</span></span></span><span class="javascript">: video, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">transport</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"TCP"</span></span></span><span class="javascript"> }).on(STREAM_STATUS.PLAYING, </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> (</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">stream</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ dl8video.start(); $(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#stopBtn'</span></span></span><span class="javascript">).prop(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'disabled'</span></span></span><span class="javascript">, </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">false</span></span></span><span class="javascript">).click(</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ $(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#playBtn'</span></span></span><span class="javascript">).prop(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'disabled'</span></span></span><span class="javascript">, </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">false</span></span></span><span class="javascript">); $(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#stopBtn'</span></span></span><span class="javascript">).prop(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'disabled'</span></span></span><span class="javascript">, </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">true</span></span></span><span class="javascript">); stream.stop(); dl8video.exit(); }); }).play(); }) } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> 通常，在为播放器创建流时（查询<code>session.createStream()</code> ），我们传递div元素，视频元素将安装到div元素中，以通过WebRTC播放流。 但是VR播放器使用自己的视频元素，我们需要以某种方式将其转发到所用API的代码中。 为此，我们将带有<code>remoteVideo</code>参数的第三方播放器的video元素直接传递给session.createStream（） </p><br><p>  demo.flashphoner.com用作服务器端； 以下链接提供了Web应用程序示例。 </p><br><p> 在您的VR事业中祝您好运！ 直播愉快！ </p><br><h2 id="links"> 友情链接 </h2><br><ol><li>  <a href="https://flashphoner.com/channel-quality-indicator-for-server-webrtc-over-tcp/">服务器WebRTC over TCP的通道质量指示器</a> -客户端到服务器通道的质量控制 </li><li>  <a href="https://flashphoner.com/browser-online-broadcasting-from-a-web-cam/">来自浏览器或移动设备的网络摄像机的视频广播</a> -来自浏览器的WebRTC流 </li><li>  <a href="https://docs.flashphoner.com/display/WCS52EN/In%2Ba%2Bbrowser%2Bwith%2BDelight%2BPlayer">WCS与VR播放器一起使用的文档</a> </li><li>  <a href="https://flashphoner.com/">WCS-</a>用于通过WebRTC传输VR 360视频的服务器 </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN482270/">https://habr.com/ru/post/zh-CN482270/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN482258/index.html">神经网络如何工作以及为什么它们开始带来巨额资金</a></li>
<li><a href="../zh-CN482260/index.html">TelegramBot。 基本功能。 贴纸和图释。 （第3部分）</a></li>
<li><a href="../zh-CN482262/index.html">如何登录Talend Open Studio</a></li>
<li><a href="../zh-CN482264/index.html">巴西，黑魔法，真人快打，火星和15,000人。 Ontiko年业绩</a></li>
<li><a href="../zh-CN482268/index.html">未来的巨型结构：戴森球，恒星引擎和“黑洞炸弹”</a></li>
<li><a href="../zh-CN482272/index.html">为普罗米修斯选择数据仓库：Thanos vs VictoriaMetrics</a></li>
<li><a href="../zh-CN482274/index.html">在ASP.NET中停止使用System.Drawing的5个原因</a></li>
<li><a href="../zh-CN482276/index.html">GOST R57580。从趋势到高效自动化</a></li>
<li><a href="../zh-CN482280/index.html">角色扮演如何完成。 艾萨克·克拉克（Isaac Clarke）的《死亡空间2》中的高级套装服装</a></li>
<li><a href="../zh-CN482284/index.html">“ 50种棕色阴影”或“我们如何做到这一点”</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>