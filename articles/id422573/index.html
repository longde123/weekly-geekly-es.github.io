<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßìüèø üë©üèº‚Äçüé§ üôãüèª Rekayasa terbalik dari rendering The Witcher 3 üß° üõ´ üÜñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Baru-baru ini, saya mulai berurusan dengan rendering The Witcher 3. Game ini memiliki teknik rendering yang luar biasa. Selain itu, ia luar biasa dala...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Rekayasa terbalik dari rendering The Witcher 3</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422573/">  Baru-baru ini, saya mulai berurusan dengan rendering The Witcher 3.  Game ini memiliki teknik rendering yang luar biasa.  Selain itu, ia luar biasa dalam hal plot / musik / gameplay. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e5b/54e/95e/e5b54e95e53d14c22be446c3de24f8c3.jpg"></div><br><br>  Pada artikel ini saya akan berbicara tentang solusi yang digunakan untuk membuat The Witcher 3. Ini tidak akan komprehensif seperti analisis grafis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GTA V</a> oleh Adrian Correger, setidaknya untuk saat ini. <br><br>  Kami akan mulai dengan rekayasa terbalik koreksi nada. <br><a name="habracut"></a><br><h2>  Bagian 1: koreksi nada </h2><br>  Di sebagian besar game AAA modern, salah satu langkah render adalah tentu koreksi nada. <br><br>  Biarkan saya mengingatkan Anda bahwa dalam kehidupan nyata ada rentang kecerahan yang agak luas, sedangkan pada layar komputer sangat terbatas (8 bit per piksel, yang memberi kita 0-255).  Di sinilah tonemapping datang untuk menyelamatkan, memungkinkan Anda untuk menyesuaikan rentang yang lebih luas ke dalam interval pencahayaan terbatas.  Biasanya, ada dua sumber data dalam proses ini: gambar HDR dengan titik mengambang, nilai warna yang melebihi 1,0, dan pencahayaan rata-rata pemandangan (yang terakhir dapat dihitung dalam beberapa cara, bahkan dengan mempertimbangkan adaptasi mata untuk mensimulasikan perilaku mata manusia, tetapi itu tidak masalah di sini). <br><br>  Langkah selanjutnya (dan terakhir) adalah untuk mendapatkan kecepatan rana, menghitung warna dengan kecepatan rana dan memprosesnya menggunakan kurva koreksi nada.  Dan di sini semuanya menjadi sangat membingungkan, karena konsep baru muncul, seperti "titik putih" (titik putih) dan "abu-abu tengah" (abu-abu tengah).  Setidaknya ada beberapa kurva populer, dan beberapa di antaranya tercakup dalam Matt Pettineo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">'s A Closer Look at Tone Mapping</a> . <br><br>  Jujur, saya selalu punya masalah dengan implementasi koreksi nada yang benar dalam kode saya sendiri.  Setidaknya ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">beberapa</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">contoh</a> online yang bermanfaat bagi saya ... sampai batas tertentu.  Beberapa dari mereka memperhitungkan kecerahan HDR / titik putih / abu-abu sedang, yang lain tidak - karena itu mereka tidak benar-benar membantu.  Saya ingin menemukan implementasi yang "teruji pertempuran". <br><br>  Kami akan bekerja di RenderDoc dengan menangkap kerangka salah satu pencarian utama Novigrad ini.  Semua pengaturan maksimal: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/406/c2d/e21/406c2de21d4e934e0f25d0e6331fd272.jpg"></div><br>  Setelah mencari sedikit, saya menemukan panggilan untuk koreksi nada!  Seperti yang saya sebutkan di atas, ada penyangga warna HDR (nomor tekstur 0, resolusi penuh) dan kecerahan rata-rata adegan (nomor tekstur 1, 1x1, titik mengambang, dihitung sebelumnya oleh compute shader). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9fe/836/3bd/9fe8363bdeda3b9e7336f0f67fc41dc3.jpg"></div><br>  Mari kita lihat kode assembler untuk pixel shader: <br><br><pre><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">ps_5_0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_globalFlags</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">refactoringAllowed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_constantbuffer</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">immediateIndexed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_resource_texture2d</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_resource_texture2d</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">t1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_input_ps_siv</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">v0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">position</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_output</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_temps</span></span> 4 0: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ld_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0, 0, 0, 0), <span class="hljs-selector-tag"><span class="hljs-selector-tag">t1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 1: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[4]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 2: <span class="hljs-selector-tag"><span class="hljs-selector-tag">min</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[4]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 3: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.000100</span></span>) 4: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>) 5: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 6: <span class="hljs-selector-tag"><span class="hljs-selector-tag">log</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 7: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 8: <span class="hljs-selector-tag"><span class="hljs-selector-tag">exp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 9: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 10: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 11: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ftou</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">v0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 12: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0, 0, 0, 0) 13: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ld_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.wxyz</span></span> 14: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzwy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 15: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span> 16: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[8]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzyy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[8]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 17: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span> 18: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 19: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.wwww</span></span> 20: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 21: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 22: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span> 23: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 24: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[8]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[8]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 25: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 26: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0, 0, 0, 0) 27: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span> 28: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 29: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 30: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 31: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span> 32: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0) 33: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.wwww</span></span> 34: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 35: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ret</span></span></code> </pre> <br>  Ada beberapa poin yang perlu diperhatikan.  Pertama, kecerahan yang dimuat tidak harus sama dengan yang digunakan, karena terbatas (panggilan maks / mnt) dalam nilai yang dipilih oleh artis (dari buffer konstan).  Ini nyaman karena memungkinkan Anda untuk menghindari kecepatan rana terlalu tinggi atau rendah.  Langkah ini sepertinya lumrah, tetapi saya belum pernah melakukannya sebelumnya.  Kedua, seseorang yang terbiasa dengan kurva koreksi nada akan langsung mengenali nilai "11.2" ini, karena sebenarnya ini adalah nilai titik putih dari kurva <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">koreksi nada</a> John Hable's <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Uncharted2</a> . <br><br>  Parameter AF diambil dari cbuffer. <br><br>  Jadi, kami memiliki tiga parameter lagi: cb3_v16.x, cb3_v16.y, cb3_v16.z.  Kita dapat memeriksa maknanya: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a52/975/78b/a5297578b0069fdded06bd3e82f2fadf.jpg"></div><br>  Firasat saya: <br><br>  Saya percaya bahwa "x" adalah semacam "skala putih" atau abu-abu sedang, karena dikalikan dengan 11.2 (baris 4), dan setelah itu digunakan sebagai pembilang dalam menghitung pengaturan kecepatan rana (baris 10). <br><br>  "Y" - Saya menyebutnya "faktor pembilang u2," dan segera Anda akan melihat alasannya. <br><br>  "Z" adalah "parameter eksponensial", karena digunakan dalam triple log / mul / exp (pada kenyataannya, dalam eksponensial). <br><br>  Tetapi perlakukan nama-nama variabel ini dengan tingkat skeptisisme! <br><br>  Juga: <br><br>  cb3_v4.yz - nilai min / maks dari kecerahan yang diizinkan, <br>  cb3_v7.xyz - parameter AC dari kurva Uncharted2, <br>  cb3_v8.xyz - Parameter DF pada kurva Uncharted2. <br><br>  Sekarang mari kita turun ke bagian yang sulit - kita akan menulis shader HLSL yang akan memberi kita kode assembler yang persis sama. <br><br>  Ini bisa sangat sulit, dan semakin lama shader, semakin sulit tugasnya.  Untungnya, beberapa waktu lalu saya menulis alat untuk dengan cepat menelusuri hlsl-&gt; asm. <br><br>  Hadirin sekalian ... selamat datang D3DShaderDisassembler! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/394/463/6ec/3944636ec3737e5e1ff5463e7b89d49f.jpg"></div><br>  Setelah bereksperimen dengan kode, saya mendapat <b><i>koreksi nada</i></b> HLSL siap pakai <b><i>The Witcher 3</i></b> : <br><br><pre> <code class="hljs pgsql"> cbuffer cBuffer : register (b3) { <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v0; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v1; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v2; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v3; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v4; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v5; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v6; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v7; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v8; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v9; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v10; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v11; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v12; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v13; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v14; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v15; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v16, cb3_v17; } Texture2D TexHDRColor : register (t0); Texture2D TexAvgLuminance : register (t1); struct VS_OUTPUT_POSTFX { <span class="hljs-type"><span class="hljs-type">float4</span></span> Position : SV_Position; }; float3 U2Func( <span class="hljs-type"><span class="hljs-type">float</span></span> A, <span class="hljs-type"><span class="hljs-type">float</span></span> B, <span class="hljs-type"><span class="hljs-type">float</span></span> C, <span class="hljs-type"><span class="hljs-type">float</span></span> D, <span class="hljs-type"><span class="hljs-type">float</span></span> E, <span class="hljs-type"><span class="hljs-type">float</span></span> F, float3 x ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F)) - E/F; } float3 ToneMapU2Func( <span class="hljs-type"><span class="hljs-type">float</span></span> A, <span class="hljs-type"><span class="hljs-type">float</span></span> B, <span class="hljs-type"><span class="hljs-type">float</span></span> C, <span class="hljs-type"><span class="hljs-type">float</span></span> D, <span class="hljs-type"><span class="hljs-type">float</span></span> E, <span class="hljs-type"><span class="hljs-type">float</span></span> F, float3 color, <span class="hljs-type"><span class="hljs-type">float</span></span> numMultiplier ) { float3 numerator = U2Func( A, B, C, D, E, F, color ); numerator = max( numerator, <span class="hljs-number"><span class="hljs-number">0</span></span> ); numerator.rgb *= numMultiplier; float3 denominator = U2Func( A, B, C, D, E, F, <span class="hljs-number"><span class="hljs-number">11.2</span></span> ); denominator = max( denominator, <span class="hljs-number"><span class="hljs-number">0</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> numerator / denominator; } <span class="hljs-type"><span class="hljs-type">float4</span></span> ToneMappingPS( VS_OUTPUT_POSTFX <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>) : SV_Target0 { <span class="hljs-type"><span class="hljs-type">float</span></span> avgLuminance = TexAvgLuminance.<span class="hljs-keyword"><span class="hljs-keyword">Load</span></span>( int3(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) ); avgLuminance = clamp( avgLuminance, cb3_v4.y, cb3_v4.z ); avgLuminance = max( avgLuminance, <span class="hljs-number"><span class="hljs-number">1e-4</span></span> ); <span class="hljs-type"><span class="hljs-type">float</span></span> scaledWhitePoint = cb3_v16.x * <span class="hljs-number"><span class="hljs-number">11.2</span></span>; <span class="hljs-type"><span class="hljs-type">float</span></span> luma = avgLuminance / scaledWhitePoint; luma = pow( luma, cb3_v16.z ); luma = luma * scaledWhitePoint; luma = cb3_v16.x / luma; float3 HDRColor = TexHDRColor.<span class="hljs-keyword"><span class="hljs-keyword">Load</span></span>( uint3(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>.Position.xy, <span class="hljs-number"><span class="hljs-number">0</span></span>) ).rgb; float3 color = ToneMapU2Func( cb3_v7.x, cb3_v7.y, cb3_v7.z, cb3_v8.x, cb3_v8.y, cb3_v8.z, luma*HDRColor, cb3_v16.y); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">float4</span></span>(color, <span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre> <br>  Tangkapan layar dari utilitas saya untuk mengonfirmasi ini: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f9c/1e9/70a/f9c1e970a743cac54c9129261514c3e1.jpg"></div><br>  Voila! <br><br>  Saya percaya ini adalah implementasi koreksi nada TW3 yang cukup akurat, setidaknya dalam hal kode assembler.  Saya sudah menerapkannya dalam kerangka kerja saya dan ini bekerja dengan sangat baik! <br><br>  Saya mengatakan "cukup" karena saya <i>tidak tahu</i> mengapa penyebut di ToneMapU2Func menjadi maksimum pada nol.  Saat membaginya dengan 0, Anda seharusnya tidak terdefinisi? <br><br>  Ini bisa diselesaikan, tetapi hampir secara tidak sengaja saya menemukan dalam bingkai ini versi lain dari shader nada TW3, digunakan untuk matahari terbenam yang indah (menarik bahwa digunakan dengan pengaturan grafis minimal!) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/292/25b/bea/29225bbeae55c97c5a83e3461f7f24a7.jpg"></div><br>  Mari kita periksa.  Pertama, kode assembler untuk shader: <br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ps_5_0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_globalFlags</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">refactoringAllowed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_constantbuffer</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[18]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">immediateIndexed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_resource_texture2d</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_resource_texture2d</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">t1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_input_ps_siv</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">v0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">position</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_output</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_temps</span></span> 5 0: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ld_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0, 0, 0, 0), <span class="hljs-selector-tag"><span class="hljs-selector-tag">t1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 1: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[9]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 2: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[4]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 3: <span class="hljs-selector-tag"><span class="hljs-selector-tag">min</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[4]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 4: <span class="hljs-selector-tag"><span class="hljs-selector-tag">min</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[9]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 5: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.000100</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000100</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 6: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>) 7: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 8: <span class="hljs-selector-tag"><span class="hljs-selector-tag">log</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 9: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 10: <span class="hljs-selector-tag"><span class="hljs-selector-tag">exp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 11: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 12: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 13: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ftou</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">v0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 14: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0, 0, 0, 0) 15: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ld_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 16: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxyz</span></span> 17: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[11]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzwy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[11]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span> 18: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[12]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzyy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[12]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 19: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzwy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span> 20: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[11]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[11]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 21: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[11]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzwy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.wwww</span></span> 22: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 23: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxyz</span></span> 24: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[11]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span> 25: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 26: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[12]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[12]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 27: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 28: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0, 0, 0, 0) 29: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span> 30: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[11]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[11]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 31: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 32: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 33: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span> 34: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0) 35: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.wwww</span></span> 36: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>) 37: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span> 38: <span class="hljs-selector-tag"><span class="hljs-selector-tag">log</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 39: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 40: <span class="hljs-selector-tag"><span class="hljs-selector-tag">exp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 41: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 42: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 43: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 44: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span> 45: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[8]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzyy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[8]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 46: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span> 47: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 48: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 49: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 50: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 51: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 52: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 53: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[8]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[8]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 54: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.wwww</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 55: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0, 0, 0, 0) 56: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span> 57: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 58: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 59: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 60: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 61: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0) 62: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 63: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzwy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 64: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[13]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 65: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 66: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ret</span></span></code> </pre> <br>  Pada awalnya, kode tersebut mungkin terlihat menakutkan, tetapi pada kenyataannya, tidak semuanya buruk.  Setelah analisis singkat, Anda akan melihat bahwa ada dua panggilan ke fungsi Uncharted2 dengan set data input yang berbeda (AF, kecerahan minimum / min ...).  Saya belum pernah melihat keputusan seperti itu sebelumnya. <br><br>  Dan HLSL: <br><br><pre> <code class="hljs pgsql"> cbuffer cBuffer : register (b3) { <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v0; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v1; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v2; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v3; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v4; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v5; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v6; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v7; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v8; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v9; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v10; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v11; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v12; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v13; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v14; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v15; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v16, cb3_v17; } Texture2D TexHDRColor : register (t0); Texture2D TexAvgLuminance : register (t1); float3 U2Func( <span class="hljs-type"><span class="hljs-type">float</span></span> A, <span class="hljs-type"><span class="hljs-type">float</span></span> B, <span class="hljs-type"><span class="hljs-type">float</span></span> C, <span class="hljs-type"><span class="hljs-type">float</span></span> D, <span class="hljs-type"><span class="hljs-type">float</span></span> E, <span class="hljs-type"><span class="hljs-type">float</span></span> F, float3 x ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F)) - E/F; } float3 ToneMapU2Func( <span class="hljs-type"><span class="hljs-type">float</span></span> A, <span class="hljs-type"><span class="hljs-type">float</span></span> B, <span class="hljs-type"><span class="hljs-type">float</span></span> C, <span class="hljs-type"><span class="hljs-type">float</span></span> D, <span class="hljs-type"><span class="hljs-type">float</span></span> E, <span class="hljs-type"><span class="hljs-type">float</span></span> F, float3 color, <span class="hljs-type"><span class="hljs-type">float</span></span> numMultiplier ) { float3 numerator = U2Func( A, B, C, D, E, F, color ); numerator = max( numerator, <span class="hljs-number"><span class="hljs-number">0</span></span> ); numerator.rgb *= numMultiplier; float3 denominator = U2Func( A, B, C, D, E, F, <span class="hljs-number"><span class="hljs-number">11.2</span></span> ); denominator = max( denominator, <span class="hljs-number"><span class="hljs-number">0</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> numerator / denominator; } struct VS_OUTPUT_POSTFX { <span class="hljs-type"><span class="hljs-type">float4</span></span> Position : SV_Position; }; <span class="hljs-type"><span class="hljs-type">float</span></span> getExposure(<span class="hljs-type"><span class="hljs-type">float</span></span> avgLuminance, <span class="hljs-type"><span class="hljs-type">float</span></span> minLuminance, <span class="hljs-type"><span class="hljs-type">float</span></span> maxLuminance, <span class="hljs-type"><span class="hljs-type">float</span></span> middleGray, <span class="hljs-type"><span class="hljs-type">float</span></span> powParam) { avgLuminance = clamp( avgLuminance, minLuminance, maxLuminance ); avgLuminance = max( avgLuminance, <span class="hljs-number"><span class="hljs-number">1e-4</span></span> ); <span class="hljs-type"><span class="hljs-type">float</span></span> scaledWhitePoint = middleGray * <span class="hljs-number"><span class="hljs-number">11.2</span></span>; <span class="hljs-type"><span class="hljs-type">float</span></span> luma = avgLuminance / scaledWhitePoint; luma = pow( luma, powParam); luma = luma * scaledWhitePoint; <span class="hljs-type"><span class="hljs-type">float</span></span> exposure = middleGray / luma; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> exposure; } <span class="hljs-type"><span class="hljs-type">float4</span></span> ToneMappingPS( VS_OUTPUT_POSTFX <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>) : SV_Target0 { <span class="hljs-type"><span class="hljs-type">float</span></span> avgLuminance = TexAvgLuminance.<span class="hljs-keyword"><span class="hljs-keyword">Load</span></span>( int3(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) ); <span class="hljs-type"><span class="hljs-type">float</span></span> exposure1 = getExposure( avgLuminance, cb3_v9.y, cb3_v9.z, cb3_v17.x, cb3_v17.z); <span class="hljs-type"><span class="hljs-type">float</span></span> exposure2 = getExposure( avgLuminance, cb3_v4.y, cb3_v4.z, cb3_v16.x, cb3_v16.z); float3 HDRColor = TexHDRColor.<span class="hljs-keyword"><span class="hljs-keyword">Load</span></span>( uint3(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>.Position.xy, <span class="hljs-number"><span class="hljs-number">0</span></span>) ).rgb; float3 color1 = ToneMapU2Func( cb3_v11.x, cb3_v11.y, cb3_v11.z, cb3_v12.x, cb3_v12.y, cb3_v12.z, exposure1*HDRColor, cb3_v17.y); float3 color2 = ToneMapU2Func( cb3_v7.x, cb3_v7.y, cb3_v7.z, cb3_v8.x, cb3_v8.y, cb3_v8.z, exposure2*HDRColor, cb3_v16.y); float3 finalColor = lerp( color2, color1, cb3_v13.x ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">float4</span></span>(finalColor, <span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre> <br>  Faktanya, kami memiliki dua set parameter kontrol, kami menghitung dua warna dengan koreksi nada, dan pada akhirnya kami menginterpolasi mereka.  Keputusan cerdas! <br><br><h2>  Bagian 2: adaptasi mata </h2><br>  Bagian kedua akan jauh lebih sederhana. <br><br>  Pada bagian pertama, saya menunjukkan bagaimana koreksi nada dilakukan di TW3.  Menjelaskan latar belakang teoretis, saya secara singkat menyebutkan adaptasi mata.  Dan tahukah Anda?  Pada bagian ini saya akan berbicara tentang bagaimana adaptasi mata ini direalisasikan. <br><br>  Tapi tunggu, apa itu adaptasi mata dan mengapa kita membutuhkannya?  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Wikipedia</a> tahu segalanya tentang hal itu, tetapi saya akan menjelaskan: bayangkan Anda berada di ruangan gelap (ingat Hidup itu Aneh) atau di dalam gua, dan pergi ke luar di tempat yang terang.  Misalnya, sumber utama penerangan mungkin matahari. <br><br>  Dalam kegelapan, pupil mata kita melebar sehingga lebih banyak cahaya memasuki retina melalui mereka.  Ketika menjadi ringan, pupil mata kita berkurang dan kadang-kadang kita menutup mata karena "sakit". <br><br>  Perubahan ini tidak terjadi secara instan.  Mata harus beradaptasi dengan perubahan kecerahan.  Itu sebabnya kami melakukan adaptasi mata dalam rendering waktu-nyata. <br><br>  Contoh yang baik ketika kurangnya adaptasi mata terlihat adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">HDRToneMappingCS11</a> dari DirectX SDK.  Perubahan tajam kecerahan sedang agak tidak menyenangkan dan tidak wajar. <br><br>  Ayo mulai!  Demi konsistensi, kami akan menganalisis kerangka yang sama dari Novigrad. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/406/c2d/e21/406c2de21d4e934e0f25d0e6331fd272.jpg"></div><br>  Sekarang kita akan masuk jauh ke dalam program frame capture RenderDoc.  Adaptasi mata biasanya dilakukan tepat sebelum koreksi nada, dan The Witcher 3 tidak terkecuali. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8ed/fde/eec/8edfdeeec29fef781801b94948c90e6f.png"></div><br>  Mari kita lihat keadaan pixel shader: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e68/2fd/2f4/e682fd2f410f32eb8661c2476c8a2294.jpg"></div><br>  Kami memiliki dua sumber input - 2 tekstur, R32_FLOAT, 1x1 (satu piksel).  tekstur0 berisi kecerahan rata-rata adegan dari bingkai sebelumnya.  tekstur1 berisi kecerahan rata-rata adegan dari bingkai saat ini (dihitung segera sebelum penghitung komputasi ini - saya menandai ini dengan warna biru). <br><br>  Diharapkan ada satu output - R32_FLOAT, 1x1.  Mari kita lihat pixel shader. <br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ps_5_0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_globalFlags</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">refactoringAllowed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_constantbuffer</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[1]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">immediateIndexed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_sampler</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">mode_default</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_sampler</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">s1</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">mode_default</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_resource_texture2d</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_resource_texture2d</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">t1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_output</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_temps</span></span> 1 0: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0, 0, 0, 0), <span class="hljs-selector-tag"><span class="hljs-selector-tag">t1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s1</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0) 1: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0, 0, 0, 0), <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yxzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0) 2: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ge</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 3: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 4: <span class="hljs-selector-tag"><span class="hljs-selector-tag">movc</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 5: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span> 6: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ret</span></span></code> </pre> <br>  Wow, sederhana sekali!  Hanya 7 baris kode assembler.  Apa yang sedang terjadi di sini?  Saya akan menjelaskan setiap baris: <br><br>  0) Dapatkan kecerahan rata-rata bingkai saat ini. <br>  1) Dapatkan kecerahan rata-rata dari bingkai sebelumnya. <br>  2) Lakukan pemeriksaan: apakah kecerahan saat ini kurang dari atau sama dengan kecerahan frame sebelumnya? <br>  Jika ya, maka kecerahan berkurang, jika tidak, maka kecerahan meningkat. <br>  3) Hitung perbedaannya: <i>perbedaan = currentLum - previousLum.</i> <br>  4) Transfer bersyarat ini (movc) memberikan faktor kecepatan dari buffer konstan.  Dua nilai berbeda dapat ditetapkan dari baris 2, tergantung pada hasil pemeriksaan.  Ini adalah langkah cerdas, karena dengan cara ini Anda bisa mendapatkan kecepatan adaptasi yang berbeda untuk menurunkan dan meningkatkan kecerahan.  Namun dalam kerangka yang dipelajari, kedua nilai tersebut sama dan bervariasi dari 0,11 hingga 0,3. <br>  5) Perhitungan akhir kecerahan teradaptasi: <i>adaptedLuminance = speedFactor * perbedaan + priorLuminance.</i> <br>  6) Akhir shader <br><br>  Ini diimplementasikan dalam HLSL cukup sederhana: <br><br><pre> <code class="hljs pgsql"> // The Witcher <span class="hljs-number"><span class="hljs-number">3</span></span> eye adaptation shader cbuffer cBuffer : register (b3) { <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v0; } struct VS_OUTPUT_POSTFX { <span class="hljs-type"><span class="hljs-type">float4</span></span> Position : SV_Position; }; SamplerState samplerPointClamp : register (s0); SamplerState samplerPointClamp2 : register (s1); Texture2D TexPreviousAvgLuminance : register (t0); Texture2D TexCurrentAvgLuminance : register (t1); <span class="hljs-type"><span class="hljs-type">float4</span></span> TW3_EyeAdaptationPS(VS_OUTPUT_POSTFX <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>) : SV_TARGET { // <span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">current</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> previous luminance. <span class="hljs-type"><span class="hljs-type">float</span></span> currentAvgLuminance = TexCurrentAvgLuminance.SampleLevel( samplerPointClamp2, float2(<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span> ); <span class="hljs-type"><span class="hljs-type">float</span></span> previousAvgLuminance = TexPreviousAvgLuminance.SampleLevel( samplerPointClamp, float2(<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span> ); // Difference <span class="hljs-keyword"><span class="hljs-keyword">between</span></span> <span class="hljs-keyword"><span class="hljs-keyword">current</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> previous luminance. <span class="hljs-type"><span class="hljs-type">float</span></span> difference = currentAvgLuminance - previousAvgLuminance; // Scale factor. Can be different <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">both</span></span> falling down <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> rising up <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> luminance. // It affects speed <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> adaptation. // Small conditional test <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> performed here, so different speed can be <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> differently <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">both</span></span> these cases. <span class="hljs-type"><span class="hljs-type">float</span></span> adaptationSpeedFactor = (currentAvgLuminance &lt;= previousAvgLuminance) ? cb3_v0.x : cb3_v0.y; // Calculate adapted luminance. <span class="hljs-type"><span class="hljs-type">float</span></span> adaptedLuminance = adaptationSpeedFactor * difference + previousAvgLuminance; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> adaptedLuminance; }</code> </pre> <br>  Baris-baris ini memberi kita kode assembler yang sama.  Saya hanya menyarankan mengganti tipe output dengan <i>float4</i> dengan <i>float</i> .  Tidak perlu membuang-buang bandwidth.  Inilah cara Witcher 3 mengimplementasikan adaptasi mata.  Cukup sederhana, bukan? <br><br>  PS.  Terima kasih banyak kepada Baldur Karlsson (Twitter: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">@baldurk</a> ) untuk RenderDoc.  Program ini sangat bagus. <br><br><h2>  Bagian 3: penyimpangan berwarna </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Aberasi kromatik</a> adalah efek terutama ditemukan di lensa murah.  Ini terjadi karena lensa memiliki indeks bias yang berbeda untuk panjang cahaya tampak yang berbeda.  Sebagai akibatnya, distorsi yang terlihat muncul.  Namun, tidak semua orang menyukainya.  Untungnya, dalam Witcher 3 efek ini sangat halus, dan karenanya tidak mengganggu dalam gameplay (setidaknya saya).  Tapi Anda bisa mematikannya jika mau. <br><br>  Mari kita perhatikan contoh adegan dengan aberasi kromatik dan tanpa itu: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a5e/078/853/a5e0788530c688f849013ff3ed64134f.png"></div><br>  <i>Termasuk penyimpangan kromatik</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d8d/20f/ee7/d8d20fee7a901301b9f2e5f67a2f56be.png"></div><br>  <i>Penyimpangan kromatik dinonaktifkan</i> <br><br>  Apakah Anda melihat ada perbedaan di dekat tepi?  Aku juga.  Mari kita coba adegan lain: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cff/9a3/b41/cff9a3b41c135e4c43cd3065328dc235.png"></div><br>  <i>Penyimpangan kromatik disertakan.</i>  <i>Perhatikan sedikit distorsi "merah" di area yang ditunjukkan.</i> <br><br>  Ya, jauh lebih baik!  Di sini kontras antara area gelap dan terang lebih kuat, dan di sudut kita melihat sedikit distorsi.  Seperti yang Anda lihat, efek ini sangat lemah.  Namun, saya bertanya-tanya bagaimana penerapannya.  Mari kita beralih ke bagian yang paling aneh: kode! <br><br>  <b>Implementasi</b> <br><br>  Hal pertama yang harus dilakukan adalah menemukan panggilan draw yang tepat dengan pixel shader.  Faktanya, chromatic aberration adalah bagian dari pixel shader "post-processing" besar, yang terdiri dari chromatic aberration, vignetting, dan koreksi gamma.  Semua ini ada di dalam shader piksel tunggal.  Mari kita lihat lebih dekat kode assembler untuk pixel shader: <br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ps_5_0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_globalFlags</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">refactoringAllowed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_constantbuffer</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[18]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">immediateIndexed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_sampler</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">s1</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">mode_default</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_resource_texture2d</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_input_ps_siv</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">v0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">position</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_input_ps</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">linear</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">v1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zw</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_output</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_temps</span></span> 4 0: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">v0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span> 1: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">v0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxy</span></span> 2: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxy</span></span> 3: <span class="hljs-selector-tag"><span class="hljs-selector-tag">dp2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span> 4: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sqrt</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 5: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 6: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul_sat</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 7: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s1</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0) 8: <span class="hljs-selector-tag"><span class="hljs-selector-tag">lt</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 9: <span class="hljs-selector-tag"><span class="hljs-selector-tag">if_nz</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 10: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 11: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 12: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.000100</span></span>) 13: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 14: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 15: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzw</span></span> 16: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(2<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 2<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 17: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s1</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0) 18: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">v0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span> 19: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s1</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0) 20: <span class="hljs-selector-tag"><span class="hljs-selector-tag">endif</span></span> ...</code> </pre> <br>  Dan untuk nilai cbuffer: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7d9/e1d/6b6/7d9e1d6b60039074712ea0e60dba2ae0.jpg"></div><br>  Jadi, mari kita coba memahami apa yang terjadi di sini.  Bahkan, cb3_v17.xy adalah pusat penyimpangan kromatik, sehingga baris pertama menghitung vektor 2d dari koordinat texel (cb3_v17.zw = kebalikan dari ukuran viewport) ke "pusat penyimpangan kromatik" dan panjangnya, kemudian melakukan perhitungan, verifikasi, dan percabangan lainnya .  Saat menerapkan aberasi kromatik, kami menghitung perpindahan menggunakan nilai-nilai tertentu dari buffer konstan dan mendistorsi saluran R dan G. Secara umum, semakin dekat ke tepi layar, semakin kuat efeknya.  Baris 10 cukup menarik karena membuat piksel "bergerak lebih dekat", terutama ketika kita membesar-besarkan penyimpangan.  Saya dengan senang hati akan berbagi dengan Anda realisasi saya tentang efeknya.  Seperti biasa, ambillah nama variabel dengan bagian skeptisisme (solid).  Dan perhatikan bahwa efeknya diterapkan <i>sebelum</i> koreksi gamma. <br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> ChromaticAberration( float2 uv, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> float3 color ) { // <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>-defined params float2 chromaticAberrationCenter = float2(<span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> chromaticAberrationCenterAvoidanceDistance = <span class="hljs-number"><span class="hljs-number">0.2</span></span>; <span class="hljs-type"><span class="hljs-type">float</span></span> fA = <span class="hljs-number"><span class="hljs-number">1.25</span></span>; <span class="hljs-type"><span class="hljs-type">float</span></span> fChromaticAbberationIntensity = <span class="hljs-number"><span class="hljs-number">30</span></span>; <span class="hljs-type"><span class="hljs-type">float</span></span> fChromaticAberrationDistortionSize = <span class="hljs-number"><span class="hljs-number">0.75</span></span>; // Calculate vector float2 chromaticAberrationOffset = uv - chromaticAberrationCenter; chromaticAberrationOffset = chromaticAberrationOffset / chromaticAberrationCenter; <span class="hljs-type"><span class="hljs-type">float</span></span> chromaticAberrationOffsetLength = length(chromaticAberrationOffset); // <span class="hljs-keyword"><span class="hljs-keyword">To</span></span> avoid applying chromatic aberration <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> center, subtract small <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> // just calculated length. <span class="hljs-type"><span class="hljs-type">float</span></span> chromaticAberrationOffsetLengthFixed = chromaticAberrationOffsetLength - chromaticAberrationCenterAvoidanceDistance; <span class="hljs-type"><span class="hljs-type">float</span></span> chromaticAberrationTexel = saturate(chromaticAberrationOffsetLengthFixed * fA); <span class="hljs-type"><span class="hljs-type">float</span></span> fApplyChromaticAberration = (<span class="hljs-number"><span class="hljs-number">0.0</span></span> &lt; chromaticAberrationTexel); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fApplyChromaticAberration) { chromaticAberrationTexel *= chromaticAberrationTexel; chromaticAberrationTexel *= fChromaticAberrationDistortionSize; chromaticAberrationOffsetLength = max(chromaticAberrationOffsetLength, <span class="hljs-number"><span class="hljs-number">1e-4</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> fMultiplier = chromaticAberrationTexel / chromaticAberrationOffsetLength; chromaticAberrationOffset *= fMultiplier; chromaticAberrationOffset *= g_Viewport.zw; chromaticAberrationOffset *= fChromaticAbberationIntensity; float2 offsetUV = -chromaticAberrationOffset * <span class="hljs-number"><span class="hljs-number">2</span></span> + uv; color.r = TexColorBuffer.SampleLevel(samplerLinearClamp, offsetUV, <span class="hljs-number"><span class="hljs-number">0</span></span>).r; offsetUV = uv - chromaticAberrationOffset; color.g = TexColorBuffer.SampleLevel(samplerLinearClamp, offsetUV, <span class="hljs-number"><span class="hljs-number">0</span></span>).g; } }</code> </pre> <br>  Saya menambahkan "fChromaticAberrationIntensity" untuk meningkatkan ukuran offset, dan karenanya kekuatan efeknya, seperti namanya (TW3 = 1.0).  Intensitas = 40: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/864/69e/aea/86469eaea28862b558fa90784b8c4585.png"></div><br>  Itu saja!  Semoga Anda menikmati bagian ini. <br><br><h2>  Bagian 4: vignetting </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Vignetting</a> adalah salah satu efek post-processing yang paling umum digunakan dalam gim.  Ia juga populer dalam fotografi.  Sudut yang sedikit teduh dapat menciptakan efek yang indah.  Ada beberapa jenis vignetting.  Misalnya, <a href="">Unreal Engine 4</a> menggunakan natural.  Tetapi kembali ke The Witcher 3. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Klik di sini</a> untuk melihat perbandingan interaktif frame dengan dan tanpa sketsa.  Perbandingan ini diambil dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">panduan kinerja NVIDIA untuk The Witcher 3</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b27/b52/986/b27b52986e845f39a32710276adc9fa8.png"></div><br>  <i>Cuplikan layar dari "The Witcher 3" dengan vignetting dihidupkan.</i> <br><br>  Perhatikan bahwa sudut kiri atas (langit) tidak seteduh bagian gambar lainnya.  Nanti kita akan kembali ke ini. <br><br>  <b>Detail Implementasi</b> <br><br>  Pertama, ada sedikit perbedaan antara sketsa yang digunakan dalam versi asli The Witcher 3 (yang dirilis pada 19 Mei 2015) dan dalam The Witcher 3: Blood and Wine.  Dalam yang pertama, "inverse gradient" dihitung di dalam pixel shader, dan yang terakhir, itu pra-dihitung ke dalam tekstur 2D 256x256: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/455/0b4/c1d/4550b4c1d1a0ae80923cd75cd63c3e7f.jpg"></div><br>  Tekstur 256x256, digunakan sebagai "gradien terbalik" dalam komplemen "Darah dan anggur." <br><br>  Saya akan menggunakan shader dari "Blood and Wine" (permainan yang hebat, omong-omong).  Seperti di sebagian besar gim lain, vignetting Witcher 3 dihitung dalam pixel shader dari pemrosesan akhir.  Lihatlah kode assembler: <br><br><pre> <code class="hljs css"> ... 44: <span class="hljs-selector-tag"><span class="hljs-selector-tag">log</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 45: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.454545</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.454545</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.454545</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 46: <span class="hljs-selector-tag"><span class="hljs-selector-tag">exp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 47: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[9]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 48: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">v1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzwx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s2</span></span> 49: <span class="hljs-selector-tag"><span class="hljs-selector-tag">log</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 50: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(2<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>, 2<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>, 2<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 51: <span class="hljs-selector-tag"><span class="hljs-selector-tag">exp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 52: <span class="hljs-selector-tag"><span class="hljs-selector-tag">dp3</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[6]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 53: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add_sat</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 54: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[6]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span> 55: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul_sat</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span> 56: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[9]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 57: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.wwww</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> ...</code> </pre> <br>  Menarik!  Tampaknya gamma (baris 46) dan spasi linear (baris 51) digunakan untuk menghitung sketsa.  Pada baris 48, kami mencicipi tekstur "gradien terbalik."  cb3 [9] .xyz tidak terkait dengan vignetting.  Dalam setiap frame yang diperiksa, ditetapkan nilai float3 (1.0, 1.0, 1.0), yaitu, mungkin merupakan filter akhir yang digunakan dalam efek fade-in / fade-out.  Ada tiga parameter utama untuk vignetting di TW3: <br><br><ul><li>  Opacity (cb3 [6] .w) - memengaruhi kekuatan vignetting.  0 - tanpa vignetting, 1 - vignetting maksimal.  Menurut pengamatan saya, di pangkalan The Witcher 3 itu sekitar 1,0, sementara di Darah dan Anggur berfluktuasi sekitar 0,15. </li><li>  Warna (cb3 [7] .xyz) - fitur unggulan dari sketsa TW3 adalah kemampuan untuk mengubah warnanya.  Tidak harus hitam, tetapi dalam praktiknya ... Biasanya memiliki nilai float3 (3.0 / 255.0, 4.0 / 255.0, 5.0 / 255.0) dan seterusnya - dalam kasus umum, ini adalah kelipatan 0,00392156 = 1.0 / 255.0 </li><li>  Bobot (cb3 [6] .xyz) adalah parameter yang sangat menarik.  Saya selalu melihat sketsa "datar", misalnya seperti: </li></ul><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a25/9e8/7f9/a259e87f9e5bbfc3edf6b4ff30aea90d.png"></div><br>  <i>Topeng vignetting yang khas</i> <br><br>  Tetapi menggunakan bobot (baris 52), Anda bisa mendapatkan hasil yang sangat menarik: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6c0/c88/6c0/6c0c886c0175635ba609ef61e61b3ea3.png"></div><br>  <i>Topeng vignetting TW3 dihitung menggunakan bobot</i> <br><br>  Bobotnya mendekati 1,0.  Lihatlah data buffer konstanta untuk satu frame dari Darah dan Anggur (dunia magis dengan pelangi): inilah mengapa vignetting tidak memengaruhi piksel terang langit di atas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/68a/2a9/9e5/68a2a99e54b0c8cf9e71561001315a34.png"></div><br>  <b>Kode</b> <br><br>  Berikut ini adalah implementasi vignetting TW3 saya di HLSL. <br><br>  GammaToLinear = pow (warna, 2.2) <br><br><pre> <code class="hljs pgsql"> <span class="hljs-comment"><span class="hljs-comment">/* // The Witcher 3 vignette. // // Input color is in gamma space // Output color is in gamma space as well. */</span></span> float3 Vignette_TW3( <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> float3 gammaColor, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> float3 vignetteColor, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> float3 vignetteWeights, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-type"><span class="hljs-type">float</span></span> vignetteOpacity, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Texture2D texVignette, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> float2 texUV ) { // <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> coloring vignette float3 vignetteColorGammaSpace = -gammaColor + vignetteColor; // Calculate vignette amount based <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> color <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> *LINEAR* color space <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> vignette weights. <span class="hljs-type"><span class="hljs-type">float</span></span> vignetteWeight = dot( GammaToLinear( gammaColor ), vignetteWeights ); // We need <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> keep vignette weight <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span>] range vignetteWeight = saturate( <span class="hljs-number"><span class="hljs-number">1.0</span></span> - vignetteWeight ); // Multiply <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> opacity vignetteWeight *= vignetteOpacity; // Obtain vignette mask (here <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> texture; you can <span class="hljs-keyword"><span class="hljs-keyword">also</span></span> calculate your custom mask here) <span class="hljs-type"><span class="hljs-type">float</span></span> sampledVignetteMask = texVignette.Sample( samplerLinearClamp, texUV ).x; // Final (inversed) vignette mask <span class="hljs-type"><span class="hljs-type">float</span></span> finalInvVignetteMask = saturate( vignetteWeight * sampledVignetteMask ); // final composite <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> gamma space float3 Color = vignetteColorGammaSpace * finalInvVignetteMask + gammaColor.rgb; // * uncomment <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">debug</span></span> vignette mask: // <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1.0</span></span> - finalInvVignetteMask; // <span class="hljs-keyword"><span class="hljs-keyword">Return</span></span> final color <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Color; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya harap Anda menikmatinya. </font><font style="vertical-align: inherit;">Anda juga dapat mencoba </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HLSLexplorer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> saya </font><font style="vertical-align: inherit;">, yang banyak membantu saya dalam memahami kode assembler HLSL. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seperti sebelumnya, ambil nama variabel dengan tingkat skeptisisme - TW3 shader diproses oleh D3DStripShader, jadi sebenarnya saya hampir tidak tahu apa-apa tentang mereka, saya hanya bisa menebak. </font><font style="vertical-align: inherit;">Selain itu, saya tidak bertanggung jawab atas kerusakan yang disebabkan oleh peralatan Anda oleh shader ini;) </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonus: menghitung gradien</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dalam The Witcher 3, dirilis pada 2015, gradien terbalik dihitung dalam pixel shader, daripada mengambil sampel tekstur yang sudah dihitung sebelumnya. </font><font style="vertical-align: inherit;">Lihatlah kode assembler:</font></font><br><br><pre> <code class="hljs css"> 35: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">v1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.500000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.500000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 36: <span class="hljs-selector-tag"><span class="hljs-selector-tag">dp2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 37: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sqrt</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span> 38: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(2<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.550000</span></span>) 39: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul_sat</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(1<span class="hljs-selector-class"><span class="hljs-selector-class">.219512</span></span>) 40: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span> 41: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzz</span></span> 42: <span class="hljs-selector-tag"><span class="hljs-selector-tag">dp4</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.100000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.105000</span></span>, 1<span class="hljs-selector-class"><span class="hljs-selector-class">.120000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.090000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 43: <span class="hljs-selector-tag"><span class="hljs-selector-tag">min</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.940000</span></span>)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untungnya bagi kami, ini cukup sederhana. </font><font style="vertical-align: inherit;">Pada HLSL, akan terlihat seperti ini:</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> TheWitcher3_2015_Mask( <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> float2 uv ) { <span class="hljs-type"><span class="hljs-type">float</span></span> distanceFromCenter = length( uv - float2(<span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>) ); <span class="hljs-type"><span class="hljs-type">float</span></span> x = distanceFromCenter * <span class="hljs-number"><span class="hljs-number">2.0</span></span> - <span class="hljs-number"><span class="hljs-number">0.55</span></span>; x = saturate( x * <span class="hljs-number"><span class="hljs-number">1.219512</span></span> ); // <span class="hljs-number"><span class="hljs-number">1.219512</span></span> = <span class="hljs-number"><span class="hljs-number">100</span></span>/<span class="hljs-number"><span class="hljs-number">82</span></span> <span class="hljs-type"><span class="hljs-type">float</span></span> x2 = x * x; <span class="hljs-type"><span class="hljs-type">float</span></span> x3 = x2 * x; <span class="hljs-type"><span class="hljs-type">float</span></span> x4 = x2 * x2; <span class="hljs-type"><span class="hljs-type">float</span></span> outX = dot( <span class="hljs-type"><span class="hljs-type">float4</span></span>(x4, x3, x2, x), <span class="hljs-type"><span class="hljs-type">float4</span></span>(<span class="hljs-number"><span class="hljs-number">-0.10</span></span>, <span class="hljs-number"><span class="hljs-number">-0.105</span></span>, <span class="hljs-number"><span class="hljs-number">1.12</span></span>, <span class="hljs-number"><span class="hljs-number">0.09</span></span>) ); outX = min( outX, <span class="hljs-number"><span class="hljs-number">0.94</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> outX; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artinya, kita cukup menghitung jarak dari pusat ke tekstil, lakukan sihir dengannya (perkalian, jenuh ...), dan kemudian ... hitung polinomialnya! </font><font style="vertical-align: inherit;">Luar biasa.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/25d/79c/e67/25d79ce679f05a53946b475c6c152cc4.png"></div><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bagian 5: efek keracunan </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mari kita lihat bagaimana game "The Witcher 3: Wild Hunt" menerapkan efek mabuk. </font><font style="vertical-align: inherit;">Jika Anda belum memainkannya, </font></font><strike><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jatuhkan semuanya, beli dan mainkan,</font></font></strike><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tonton video: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sore:</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Gy_B2V0QaqA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Malam: </font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/CXu3e7LWkjE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pertama, kita melihat gambar ganda dan berputar-putar, sering muncul ketika Anda minum dalam kehidupan nyata. </font><font style="vertical-align: inherit;">Semakin jauh piksel dari pusat gambar, semakin kuat efek rotasi. </font><font style="vertical-align: inherit;">Saya sengaja memposting video kedua dengan malam itu, karena Anda dapat dengan jelas melihat rotasi ini pada bintang-bintang (lihat 8 poin terpisah?) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagian kedua dari efek keracunan, yang mungkin tidak segera terlihat, adalah sedikit perubahan pada zoom. </font><font style="vertical-align: inherit;">Itu terlihat dekat pusat. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mungkin jelas bahwa efek ini adalah tipikal pemrosesan pasca (pixel shader). </font><font style="vertical-align: inherit;">Namun, lokasinya di jalur render mungkin tidak begitu jelas. </font><font style="vertical-align: inherit;">Ternyata efek keracunan diterapkan segera </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setelah</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> koreksi tonal dan tepat sebelum blur (gambar "mabuk" adalah input untuk blur gerak).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mari kita mulai gim dengan kode assembler: </font></font><br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ps_5_0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_globalFlags</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">refactoringAllowed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_constantbuffer</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb0</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[2]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">immediateIndexed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_constantbuffer</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[3]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">immediateIndexed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_sampler</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">mode_default</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_resource_texture2d</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_input_ps_siv</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">v1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">position</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_output</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_temps</span></span> 8 0: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.100000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 1: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[1]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxyx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.050000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.050000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 2: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">v1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb0</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[1]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[2]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 3: <span class="hljs-selector-tag"><span class="hljs-selector-tag">dp2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 4: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sqrt</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span> 5: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(10<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 6: <span class="hljs-selector-tag"><span class="hljs-selector-tag">min</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 7: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 8: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzz</span></span> 9: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 10: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 11: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxy</span></span> 12: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[2]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxy</span></span> 13: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[2]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxy</span></span> 14: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 15: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(5<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 16: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzw</span></span> 17: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 18: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 19: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 20: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 21: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 22: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 23: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 24: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 25: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 26: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 27: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 28: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 29: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 30: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 31: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 32: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 33: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 34: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 35: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 36: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.062500</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.062500</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.062500</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.062500</span></span>) 37: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzw</span></span> 38: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 39: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 40: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 41: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzw</span></span> 42: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 43: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 44: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 45: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 46: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzw</span></span> 47: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 48: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 49: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 50: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 51: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 52: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 53: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 54: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 55: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 56: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.062500</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.062500</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.062500</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.062500</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 57: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(8<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 58: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span> 59: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[1]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.020000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 60: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxy</span></span> 61: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[2]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 62: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 63: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span> 64: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(2<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 2<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 65: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 66: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 67: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 68: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 69: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 70: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 71: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>) 72: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.wwww</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 73: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 74: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ret</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dua buffer konstan terpisah digunakan di sini. Mari kita periksa nilainya:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d7e/ce2/eb8/d7ece2eb8b0acf421cffd93222dd6821.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/832/ef8/941/832ef8941e9b4b6a38ad24b0c2e84cfa.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami tertarik pada beberapa di antaranya: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb0_v0.x -&gt; waktu yang berlalu (dalam detik) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb0_v1.xyzw - ukuran viewport dan kebalikan dari ukuran viewport (alias "ukuran pixel") </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb3_v0.x - rotasi di sekitar pixel, selalu memiliki nilai 1,0. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb3_v0.y - besarnya efek keracunan. Setelah dihidupkan, itu tidak bekerja dengan kekuatan penuh, tetapi secara bertahap meningkat dari 0,0 ke 1,0. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cv3_v1.xy - offset piksel (lebih lanjut tentang ini di bawah). Ini adalah pasangan sin / cos, sehingga Anda dapat menggunakan sincos (waktu) di shader jika Anda mau. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb3_v2.xy adalah pusat dari efek, biasanya float2 (0,5, 0,5). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Di sini kami ingin fokus untuk memahami apa yang terjadi, dan tidak hanya menulis ulang shader secara membuta. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami akan mulai dengan baris pertama:</font></font><br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ps_5_0</span></span> 0: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.100000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 1: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[1]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxyx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.050000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.050000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 2: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">v1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb0</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[1]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[2]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 3: <span class="hljs-selector-tag"><span class="hljs-selector-tag">dp2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 4: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sqrt</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya menyebut jalur 0 "rasio zoom" dan Anda akan segera melihat alasannya. </font><font style="vertical-align: inherit;">Segera setelah itu (baris 1), kami menghitung "perpindahan rotasi". </font><font style="vertical-align: inherit;">Ini hanya input dosa / cos pasangan data dikalikan dengan 0,05. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Baris 2-4: Pertama, kami menghitung vektor dari pusat efek ke koordinat UV tekstur. </font><font style="vertical-align: inherit;">Kemudian kita menghitung kuadrat jarak (3) dan jarak sederhana (4) (dari pusat ke texel)</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Koordinat tekstur zoom </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mari kita lihat kode assembler berikut: </font></font><br><br><pre> <code class="hljs css"> 8: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzz</span></span> 9: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 10: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 11: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxy</span></span> 12: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[2]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxy</span></span> 13: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[2]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxy</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Karena mereka dikemas dengan cara ini, kita hanya dapat menganalisis sepasang float. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sebagai permulaan, r0.yz adalah "offset rotasi," r1.z adalah jarak dari pusat ke texel, r1.xy adalah vektor dari pusat ke texel, r0.x adalah "faktor zoom". </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk memahami ini, mari kita asumsikan untuk sekarang bahwa zoomFactor = 1.0, yaitu, Anda dapat menulis yang berikut:</font></font><br><br><pre> <code class="hljs powershell"> <span class="hljs-number"><span class="hljs-number">8</span></span>: mul r2.xyzw, r0.yzyz, r1.zzzz <span class="hljs-number"><span class="hljs-number">9</span></span>: mad r2.xyzw, r1.xyxy, r0.xxxx, <span class="hljs-literal"><span class="hljs-literal">-r2</span></span>.xyzw <span class="hljs-number"><span class="hljs-number">13</span></span>: add r2.xyzw, r2.xyzw, cb3[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyxy r2.xy = (texel - center) * zoomFactor - rotationOffsets * distanceFromCenter + center;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tapi zoomFactor = 1.0: </font></font><br><br><pre> <code class="hljs markdown"> r2.xy = texel - center - rotationOffsets <span class="hljs-bullet"><span class="hljs-bullet">* distanceFromCenter + center; r2.xy = texel - rotationOffsets *</span></span> distanceFromCenter;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Demikian pula untuk r3.xy: </font></font><br><br><pre> <code class="hljs cs"> <span class="hljs-number"><span class="hljs-number">10</span></span>: mul r3.xy, r0.xxxx, r1.xyxx <span class="hljs-number"><span class="hljs-number">11</span></span>: mad r3.xyzw, r0.yzyz, r1.zzzz, r3.xyxy <span class="hljs-number"><span class="hljs-number">12</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> r3.xyzw, r3.xyzw, cb3[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyxy r3.xy = rotationOffsets * distanceFromCenter + zoomFactor * (texel - center) + center</code> </pre> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tapi zoomFactor = 1.0: </font><font style="vertical-align: inherit;">Hebat. </font><font style="vertical-align: inherit;">Artinya, saat ini kita pada dasarnya memiliki TextureUV (texel) ¬± rotasi offset saat ini, tetapi bagaimana dengan zoomFactor? </font><font style="vertical-align: inherit;">Lihat baris 0. Faktanya, zoomFactor = 1.0 - 0.1 * drunkAmount. </font><font style="vertical-align: inherit;">Untuk drunkAmount maksimum, nilai zoomFactor harus 0,9, dan koordinat tekstur dengan zoom sekarang dihitung sebagai berikut:</font></font><br><br> <code>r3.xy = rotationOffsets * distanceFromCenter + texel - <strike>center</strike> + <strike>center</strike> r3.xy = texel + rotationOffsets * distanceFromCenter</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><pre> <code class="hljs markdown"> baseTexcoordsA = 0.9 <span class="hljs-bullet"><span class="hljs-bullet">* texel + 0.1 *</span></span> center + rotationOffsets <span class="hljs-bullet"><span class="hljs-bullet">* distanceFromCenter baseTexcoordsB = 0.9 *</span></span> texel + 0.1 <span class="hljs-bullet"><span class="hljs-bullet">* center - rotationOffsets *</span></span> distanceFromCenter</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mungkin penjelasan seperti itu akan lebih intuitif: itu hanya interpolasi linier oleh beberapa faktor antara koordinat tekstur normal dan pusat. </font><font style="vertical-align: inherit;">Ini adalah gambar "zoom-in". </font><font style="vertical-align: inherit;">Untuk memahami ini, yang terbaik adalah bereksperimen dengan nilai-nilai. </font><font style="vertical-align: inherit;">Berikut ini </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tautan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ke Shadertoy, tempat Anda dapat melihat efeknya dalam aksi.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Offset tekstur </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Seluruh fragmen dalam kode assembler: </font></font><br><br><pre> <code class="hljs powershell"> <span class="hljs-number"><span class="hljs-number">2</span></span>: mad r1.xy, v1.xyxx, cb0[<span class="hljs-number"><span class="hljs-number">1</span></span>].zwzz, <span class="hljs-literal"><span class="hljs-literal">-cb3</span></span>[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyxx <span class="hljs-number"><span class="hljs-number">3</span></span>: dp2 r0.w, r1.xyxx, r1.xyxx <span class="hljs-number"><span class="hljs-number">5</span></span>: mul r0.w, r0.w, l(<span class="hljs-number"><span class="hljs-number">10.000000</span></span>) <span class="hljs-number"><span class="hljs-number">6</span></span>: min r0.w, r0.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">7</span></span>: mul r0.w, r0.w, cb3[<span class="hljs-number"><span class="hljs-number">0</span></span>].y <span class="hljs-number"><span class="hljs-number">14</span></span>: mul r0.x, r0.w, cb3[<span class="hljs-number"><span class="hljs-number">0</span></span>].x <span class="hljs-number"><span class="hljs-number">15</span></span>: mul r0.x, r0.x, l(<span class="hljs-number"><span class="hljs-number">5.000000</span></span>) // texcoords offset intensity <span class="hljs-number"><span class="hljs-number">16</span></span>: mul r4.xyzw, r0.xxxx, cb3[<span class="hljs-number"><span class="hljs-number">0</span></span>].zwzw // texcoords offset</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menciptakan gradien tertentu, sebut saja "topeng intensitas perpindahan". </font><font style="vertical-align: inherit;">Padahal, itu memberi dua makna. </font><font style="vertical-align: inherit;">Yang pertama di r0.w (kita akan menggunakannya nanti) dan yang kedua adalah 5 kali lebih kuat di r0.x (baris 15). </font><font style="vertical-align: inherit;">Yang terakhir sebenarnya berfungsi sebagai faktor ukuran texel, sehingga memengaruhi gaya bias. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sampling-related Sampling</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Selanjutnya, serangkaian sampling tekstur dilakukan. </font><font style="vertical-align: inherit;">Bahkan, 2 seri 8 sampel digunakan, satu untuk setiap "sisi". </font><font style="vertical-align: inherit;">Di HLSL, Anda dapat menulis ini sebagai berikut:</font></font><br><br><pre> <code class="hljs powershell"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> const float2 pointsAroundPixel<span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-number"><span class="hljs-function"><span class="hljs-number">8</span></span></span><span class="hljs-function">] = { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">float2</span></span></span></span>(<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>), float2(<span class="hljs-literal"><span class="hljs-literal">-1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>), float2(<span class="hljs-number"><span class="hljs-number">0.707</span></span>, <span class="hljs-number"><span class="hljs-number">0.707</span></span>), float2(<span class="hljs-literal"><span class="hljs-literal">-0</span></span>.<span class="hljs-number"><span class="hljs-number">707</span></span>, <span class="hljs-literal"><span class="hljs-literal">-0</span></span>.<span class="hljs-number"><span class="hljs-number">707</span></span>), float2(<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>), float2(<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-literal"><span class="hljs-literal">-1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>), float2(<span class="hljs-literal"><span class="hljs-literal">-0</span></span>.<span class="hljs-number"><span class="hljs-number">707</span></span>, <span class="hljs-number"><span class="hljs-number">0.707</span></span>), float2(<span class="hljs-number"><span class="hljs-number">0.707</span></span>, <span class="hljs-literal"><span class="hljs-literal">-0</span></span>.<span class="hljs-number"><span class="hljs-number">707</span></span>) }; float4 colorA = <span class="hljs-number"><span class="hljs-number">0</span></span>; float4 colorB = <span class="hljs-number"><span class="hljs-number">0</span></span>; int i=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">unroll</span></span></span><span class="hljs-function">] </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">for</span></span></span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">8</span></span>; i++) { colorA += TexColorBuffer.Sample( samplerLinearClamp, baseTexcoordsA + texcoordsOffset * pointsAroundPixel<span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">i</span></span></span><span class="hljs-function">] ); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">colorA</span></span></span></span> /= <span class="hljs-number"><span class="hljs-number">16.0</span></span>; <span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">unroll</span></span></span><span class="hljs-function">] </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">for</span></span></span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">8</span></span>; i++) { colorB += TexColorBuffer.Sample( samplerLinearClamp, baseTexcoordsB + texcoordsOffset * pointsAroundPixel[<span class="hljs-type"><span class="hljs-type">i</span></span>] ); } colorB /= <span class="hljs-number"><span class="hljs-number">16.0</span></span>; float4 rotationPart = colorA + colorB;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caranya adalah kita menambahkan ke baseTexcoordsA / B offset tambahan yang terletak pada lingkaran unit, dikalikan dengan "intensitas pergeseran koordinat tekstur" yang disebutkan sebelumnya. </font><font style="vertical-align: inherit;">Semakin jauh dari pusat piksel, semakin besar jari-jari lingkaran di sekitar piksel - kita sampel 8 kali, yang terlihat jelas pada bintang-bintang. </font><font style="vertical-align: inherit;">Nilai PointsAroundPixel (kelipatan 45 derajat):</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0cb/5d0/5b4/0cb5d05b44fd9d2969af0416684d4b77.jpg"></div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lingkaran tunggal </font></font></a> <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengambilan sampel terkait zoom</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bagian kedua dari efek mabuk di The Witcher 3 adalah zoom dengan zoom in dan zoom out. </font><font style="vertical-align: inherit;">Mari kita lihat kode assembler yang melakukan tugas ini:</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-number"><span class="hljs-number">56</span></span>: mad r2.xyzw, r3.xyzw, l(<span class="hljs-number"><span class="hljs-number">0.062500</span></span>, <span class="hljs-number"><span class="hljs-number">0.062500</span></span>, <span class="hljs-number"><span class="hljs-number">0.062500</span></span>, <span class="hljs-number"><span class="hljs-number">0.062500</span></span>), r2.xyzw // the rotation part <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> stored <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> r2 register <span class="hljs-number"><span class="hljs-number">57</span></span>: mul r0.x, cb3[<span class="hljs-number"><span class="hljs-number">0</span></span>].y, l(<span class="hljs-number"><span class="hljs-number">8.000000</span></span>) <span class="hljs-number"><span class="hljs-number">58</span></span>: mul r0.xy, r0.xxxx, cb3[<span class="hljs-number"><span class="hljs-number">0</span></span>].zwzz <span class="hljs-number"><span class="hljs-number">59</span></span>: mad r0.z, cb3[<span class="hljs-number"><span class="hljs-number">1</span></span>].y, l(<span class="hljs-number"><span class="hljs-number">0.020000</span></span>), l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">60</span></span>: mul r1.zw, r0.zzzz, r1.xxxy <span class="hljs-number"><span class="hljs-number">61</span></span>: mad r1.xy, r1.xyxx, r0.zzzz, cb3[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyxx <span class="hljs-number"><span class="hljs-number">62</span></span>: mad r3.xy, r1.zwzz, r0.xyxx, r1.xyxx <span class="hljs-number"><span class="hljs-number">63</span></span>: mul r0.xy, r0.xyxx, r1.zwzz <span class="hljs-number"><span class="hljs-number">64</span></span>: mad r0.xy, r0.xyxx, l(<span class="hljs-number"><span class="hljs-number">2.000000</span></span>, <span class="hljs-number"><span class="hljs-number">2.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>), r1.xyxx <span class="hljs-number"><span class="hljs-number">65</span></span>: sample_indexable(texture2d)(<span class="hljs-type"><span class="hljs-type">float</span></span>,<span class="hljs-type"><span class="hljs-type">float</span></span>,<span class="hljs-type"><span class="hljs-type">float</span></span>,<span class="hljs-type"><span class="hljs-type">float</span></span>) r1.xyzw, r1.xyxx, t0.xyzw, s0 <span class="hljs-number"><span class="hljs-number">66</span></span>: sample_indexable(texture2d)(<span class="hljs-type"><span class="hljs-type">float</span></span>,<span class="hljs-type"><span class="hljs-type">float</span></span>,<span class="hljs-type"><span class="hljs-type">float</span></span>,<span class="hljs-type"><span class="hljs-type">float</span></span>) r4.xyzw, r0.xyxx, t0.xyzw, s0 <span class="hljs-number"><span class="hljs-number">67</span></span>: sample_indexable(texture2d)(<span class="hljs-type"><span class="hljs-type">float</span></span>,<span class="hljs-type"><span class="hljs-type">float</span></span>,<span class="hljs-type"><span class="hljs-type">float</span></span>,<span class="hljs-type"><span class="hljs-type">float</span></span>) r3.xyzw, r3.xyxx, t0.xyzw, s0 <span class="hljs-number"><span class="hljs-number">68</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> r1.xyzw, r1.xyzw, r3.xyzw <span class="hljs-number"><span class="hljs-number">69</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> r1.xyzw, r4.xyzw, r1.xyzw</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kita melihat bahwa ada tiga panggilan tekstur yang terpisah, yaitu, tiga koordinat tekstur yang berbeda. </font><font style="vertical-align: inherit;">Mari kita menganalisis bagaimana koordinat tekstur dihitung darinya. </font><font style="vertical-align: inherit;">Tetapi pertama-tama, kami menunjukkan input untuk bagian ini:</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> zoomInOutScalePixels = drunkEffectAmount * <span class="hljs-number"><span class="hljs-number">8.0</span></span>; // <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-number"><span class="hljs-number">57</span></span> float2 zoomInOutScaleNormalizedScreenCoordinates = zoomInOutScalePixels * texelSize.xy; // <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-number"><span class="hljs-number">58</span></span> <span class="hljs-type"><span class="hljs-type">float</span></span> zoomInOutAmplitude = <span class="hljs-number"><span class="hljs-number">1.0</span></span> + <span class="hljs-number"><span class="hljs-number">0.02</span></span>*cos(<span class="hljs-type"><span class="hljs-type">time</span></span>); // <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-number"><span class="hljs-number">59</span></span> float2 zoomInOutfromCenterToTexel = zoomInOutAmplitude * fromCenterToTexel; // <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-number"><span class="hljs-number">60</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beberapa kata tentang input. </font><font style="vertical-align: inherit;">Kami menghitung offset dalam texels (misalnya, ukuran 8.0 * texel), yang kemudian ditambahkan ke koordinat dasar uv. </font><font style="vertical-align: inherit;">Amplitudo hanya berkisar antara 0,98 dan 1,02 untuk memberikan rasa zoom, seperti halnya zoomFactor pada bagian yang melakukan rotasi. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mari kita mulai dengan pasangan pertama - r1.xy (baris 61)</font></font><br><br><pre> <code class="hljs markdown"> r1.xy = fromCenterToTexel <span class="hljs-bullet"><span class="hljs-bullet">* amplitude + center r1.xy = (TextureUV - Center) *</span></span> amplitude + Center // you can insert here zoomInOutfromCenterToTexel r1.xy = TextureUV <span class="hljs-bullet"><span class="hljs-bullet">* amplitude - Center *</span></span> amplitude + Center r1.xy = TextureUV <span class="hljs-bullet"><span class="hljs-bullet">* amplitude + Center *</span></span> 1.0 - Center <span class="hljs-bullet"><span class="hljs-bullet">* amplitude r1.xy = TextureUV *</span></span> amplitude + Center * (1.0 - amplitude) r1.xy = lerp( TextureUV, Center, amplitude);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Itu adalah: </font></font><br><br><pre> <code class="hljs lisp">float2 zoomInOutBaseTextureUV = lerp(<span class="hljs-name"><span class="hljs-name">TextureUV</span></span>, Center, amplitude)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mari kita periksa pasangan kedua - r3.xy (baris 62) </font></font><br><br><pre> <code class="hljs markdown"> r3.xy = (amplitude <span class="hljs-bullet"><span class="hljs-bullet">* fromCenterToTexel) *</span></span> zoomInOutScaleNormalizedScreenCoordinates + zoomInOutBaseTextureUV</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Itu adalah: </font></font><br><br><pre> <code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">float2</span></span> zoomInOutAddTextureUV0 = zoomInOutBaseTextureUV + zoomInOutfromCenterToTexel*zoomInOutScaleNormalizedScreenCoordinates;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mari kita periksa pasangan ketiga - r0.xy (baris 63-64) </font></font><br><br><pre> <code class="hljs markdown"> r0.xy = zoomInOutScaleNormalizedScreenCoordinates <span class="hljs-bullet"><span class="hljs-bullet">* (amplitude *</span></span> fromCenterToTexel) * 2.0 + zoomInOutBaseTextureUV</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Itu adalah: </font></font><br><br><pre> <code class="hljs markdown"> float2 zoomInOutAddTextureUV1 = zoomInOutBaseTextureUV + 2.0<span class="hljs-emphasis"><span class="hljs-emphasis">*zoomInOutfromCenterToTexel*</span></span>zoomInOutScaleNormalizedScreenCoordinates</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ketiga kueri tekstur ditambahkan bersama-sama, dan hasilnya disimpan dalam register r1. </font><font style="vertical-align: inherit;">Perlu dicatat bahwa pixel shader ini menggunakan sampler pengalamatan terbatas. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menyatukan semuanya</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Jadi, saat ini kami memiliki hasil rotasi dalam register r2 dan tiga permintaan zoom yang dilipat dalam register r1. </font><font style="vertical-align: inherit;">Mari kita lihat baris terakhir kode assembler:</font></font><br><br><pre> <code class="hljs css"> 70: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 71: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>) 72: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.wwww</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 73: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 74: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ret</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tentang input tambahan: r0.w diambil dari baris 7, ini adalah topeng intensitas kami, dan cb3 [0] .y adalah besarnya efek intoksikasi. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mari kita lihat cara kerjanya. </font><font style="vertical-align: inherit;">Pendekatan pertama saya adalah brute force:</font></font><br><br><pre> <code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">float4</span></span> finalColor = intensityMask * (rotationPart - zoomingPart); <span class="hljs-attribute"><span class="hljs-attribute">finalColor</span></span> = drunkIntensity * finalColor + zoomingPart; <span class="hljs-attribute"><span class="hljs-attribute">return</span></span> finalColor;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tapi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apa-apaan, tidak ada yang menulis shader seperti itu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Saya mengambil pensil dengan kertas dan menulis formula ini:</font></font><br><br><pre> <code class="hljs powershell"> finalColor = effectAmount * [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span><span class="hljs-type"><span class="hljs-type">ensityMask</span></span> * (<span class="hljs-type"><span class="hljs-type">rotationPart</span></span> - <span class="hljs-type"><span class="hljs-type">zoomPart</span></span>)] + zoomPart finalColor = effectAmount * intensityMask * rotationPart - effectAmount * intensityMask * zoomPart + zooomPart</code> </pre> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Di mana t = effectAmount * intensityMask </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jadi, kita mendapatkan:</font></font><br><br><pre> <code class="hljs lisp"> finalColor = <span class="hljs-literal"><span class="hljs-literal">t</span></span> * rotationPart - <span class="hljs-literal"><span class="hljs-literal">t</span></span> * zoomPart + zoomPart finalColor = <span class="hljs-literal"><span class="hljs-literal">t</span></span> * rotationPart + zoomPart - <span class="hljs-literal"><span class="hljs-literal">t</span></span> * zoomPart finalColor = <span class="hljs-literal"><span class="hljs-literal">t</span></span> * rotationPart + (<span class="hljs-number"><span class="hljs-number">1.0</span></span> - <span class="hljs-literal"><span class="hljs-literal">t</span></span>) * zoomPart finalColor = lerp( <span class="hljs-name"><span class="hljs-name">zoomingPart</span></span>, rotationPart, <span class="hljs-literal"><span class="hljs-literal">t</span></span> )</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dan kita sampai pada hal berikut: </font></font><br><br><pre> <code class="hljs lisp"> finalColor = lerp(<span class="hljs-name"><span class="hljs-name">zoomingPart</span></span>, rotationPart, intensityMask * drunkIntensity);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ya, bagian artikel ini ternyata sangat rinci, tetapi akhirnya kami selesai! </font><font style="vertical-align: inherit;">Secara pribadi, saya belajar sesuatu dalam proses penulisan, saya harap Anda juga! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika Anda tertarik, sumber HLSL lengkap tersedia di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Saya mengujinya dengan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HLSLexplorer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> saya </font><font style="vertical-align: inherit;">, dan meskipun tidak ada korespondensi satu-ke-satu langsung dengan shader asli, perbedaannya sangat kecil (satu baris lebih sedikit) sehingga saya dapat mengatakan dengan keyakinan bahwa itu berfungsi. </font><font style="vertical-align: inherit;">Terima kasih sudah membaca!</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id422573/">https://habr.com/ru/post/id422573/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id422555/index.html">Arsitektur multi-modul Android. A hingga Z</a></li>
<li><a href="../id422561/index.html">Bagaimana Yandex menerapkan visi komputer untuk meningkatkan kualitas siaran video. Teknologi DeepHD</a></li>
<li><a href="../id422565/index.html">Webmaster Skillbox Friday: Semuanya untuk Programer dan Desainer</a></li>
<li><a href="../id422569/index.html">Setiap jam, aplikasi pelacakan waktu</a></li>
<li><a href="../id422571/index.html">Menyejajarkan tugas dengan dependensi - .NET contoh</a></li>
<li><a href="../id422575/index.html">Entri telepon langka</a></li>
<li><a href="../id422577/index.html">Salinan dan hak cipta: bagaimana paten dan hak cipta memengaruhi pengembangan pencetakan 3D</a></li>
<li><a href="../id422581/index.html">Sakelar kuantum gaya Schr√∂dinger</a></li>
<li><a href="../id422583/index.html">Tough Middling: Ulasan Telepon IP Snom D735</a></li>
<li><a href="../id422585/index.html">Penggunaan praktis dari jaringan saraf</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>