<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>โป๏ธ ๐๐ฝ ๐จ ูู ุจุถุจุท OpenStack ุชุญุช ุงูุญูู ุงูุนุงูู ๐ฉ๐ผโ๐ โ๏ธ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุฑุญุจูุง ุ ุงุณูู ููุณูู ุ ูุฃูุง ูุณุคูู ูุธุงู. ููุฐ ุซูุงุซ ุณููุงุช ุ ุจุฏุฃุช ุฃูุง ูุฒููุงุฆู ูู ููู ุงูููุชุฌุงุช ุฅูู ุงูุฎุฏูุงุช ุงูุตุบูุฑุฉ ุ ููุฑุฑูุง ุงุณุชุฎุฏุงู Openstack ูููุตุฉ ุ ููุงุฌูู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูู ุจุถุจุท OpenStack ุชุญุช ุงูุญูู ุงูุนุงูู</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yamoney/blog/427569/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูุฑุญุจูุง ุ ุงุณูู ููุณูู ุ ูุฃูุง ูุณุคูู ูุธุงู.  ููุฐ ุซูุงุซ ุณููุงุช ุ ุจุฏุฃุช ุฃูุง ูุฒููุงุฆู ูู ููู ุงูููุชุฌุงุช ุฅูู ุงูุฎุฏูุงุช ุงูุตุบูุฑุฉ ุ ููุฑุฑูุง ุงุณุชุฎุฏุงู Openstack ูููุตุฉ ุ ููุงุฌููุง ุนุฏุฏูุง ูู ุงูููุงุจุณ ุบูุฑ ุงููุงุถุญุฉ ุนูุฏ ุฃุชูุชุฉ ุฏูุงุฆุฑ ุงูุงุฎุชุจุงุฑ.  ุชุฏูุฑ ูุฐู ุงููุดุงุฑูุฉ ุญูู ุงููุฑูู ุงูุฏูููุฉ ูู ุฅุนุฏุงุฏ OpenStack ุ ูุงูุชู ุจุงููุงุฏ ูููู ุงูุนุซูุฑ ุนูููุง ูู ุงูุตูุญุฉ ุงูุฎุงูุณุฉ ูู ูุชุงุฆุฌ ูุญุฑู ุงูุจุญุซ (ุฃู ุฃูุถู ุ ููู ุณููุฉ ูู ุงูุตูุญุฉ ุงูุฃููู). </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/mq/7k/0o/mq7k0oanmmzmtasnicu6ra237po.png"><br>  <em>ุงูุญูู ุนูู ุงูููู: ูุงู - ุฃุตุจุญ</em> </p><br><h3 id="nat" style=";text-align:right;direction:rtl">  NAT </h3><br><p style=";text-align:right;direction:rtl">  ูู ุจุนุถ ุงูุญุงูุงุช ุ ูุณุชุฎุฏู Dualstack.  ูุฐุง ุนูุฏูุง ูุชููู ุงูุฌูุงุฒ ุงูุธุงูุฑู ุนููุงููู ูู ููุช ูุงุญุฏ - IPv4 ู IPv6.  ุฃููุงู ุ ุชุฃูุฏูุง ูู ุชุนููู ุนููุงู ุงูุฅุตุฏุงุฑ 4 "ุงูุนุงุฆู" ูู ุงูุดุจูุฉ ุงูุฏุงุฎููุฉ ูู ุฎูุงู NAT ุ ูุชููู ุงูุฌูุงุฒ ุงูุฅุตุฏุงุฑ 6 ูู ุฎูุงู BGP ุ ูููู ููุงู ุนุฏุฉ ูุดุงูู ูู ูุฐุง ุงูุฃูุฑ. </p><br><p style=";text-align:right;direction:rtl">  NAT - ุนูุฏุฉ ุฅุถุงููุฉ ูู ุงูุดุจูุฉ ุ ุญูุซ ุญุชู ุจุฏูููุง ุชุญุชุงุฌ ุฅูู ูุฑุงูุจุฉ ุชูุฒูุน ุงูุญูู ุงูุนุงุฏู.  ุบุงูุจูุง ูุง ูุคุฏู ุธููุฑ NAT ุนูู ุงูุดุจูุฉ ุฅูู ุตุนูุจุงุช ูู ุชุตุญูุญ ุงูุฃุฎุทุงุก - ุนูู ุนููุงู IP ุงูุฎุงุต ุจุงููุถูู ุ ูู ูุงุนุฏุฉ ุจูุงูุงุช ุฃุฎุฑู ุ ููุตุจุญ ูู ุงูุตุนุจ ุชุชุจุน ุงูุทูุจ.  ุชุจุฏุฃ ุนูููุงุช ุงูุจุญุซ ุงูุฌูุงุนูุฉ ุ ูุณูุธู ุงูุญู ุฏุงุฎู OpenStack. </p><br><p style=";text-align:right;direction:rtl">  ูุง ูุฒุงู NAT ูุง ูุณูุญ ุจุฅุฌุฑุงุก ุชูุณูู ุทุจูุนู ูููุตูู ุจูู ุงููุดุงุฑูุน.  ุชุญุชูู ุฌููุน ุงููุดุงุฑูุน ุนูู ุดุจูุงุช ูุฑุนูุฉ ุฎุงุตุฉ ุจูุง ุ ูุชูุชูู ุนูุงููู IP ุงูุนุงุฆูุฉ ุจุงุณุชูุฑุงุฑ ุ ููุน NAT ูุตุจุญ ูู ุงููุณุชุญูู ุชูุงููุง ุฅุฏุงุฑุฉ ุฐูู.  ุชุชุญุฏุซ ุจุนุถ ุนูููุงุช ุงูุชุซุจูุช ุนู ุงุณุชุฎุฏุงู NAT 1 ูู 1 (ูุง ูุฎุชูู ุงูุนููุงู ุงูุฏุงุฎูู ุนู ุงูุนููุงู ุงูุฎุงุฑุฌู) ุ ูููู ูุฐุง ูุง ูุฒุงู ูุชุฑู ุฑูุงุจุท ุบูุฑ ุถุฑูุฑูุฉ ูู ุณูุณูุฉ ุงูุชูุงุนู ูุน ุงูุฎุฏูุงุช ุงูุฎุงุฑุฌูุฉ.  ุชูุตููุง ุฅูู ุงุณุชูุชุงุฌ ููุงุฏู ุฃู ุงูุฎูุงุฑ ุงูุฃูุถู ุจุงููุณุจุฉ ููุง ูู ุดุจูุฉ BGP. </p><a name="habracut"></a><br><h2 id="chem-prosche-tem-luchshe" style=";text-align:right;direction:rtl">  ูููุง ูุงู ุฐูู ุฃุจุณุท ูููุง ูุงู ุฐูู ุฃูุถู </h2><br><p style=";text-align:right;direction:rtl">  ููุฏ ุฌุฑุจูุง ุงูุนุฏูุฏ ูู ุฃุฏูุงุช ุงูุฃุชูุชุฉ ุ ูููููุง ุงุณุชูุฑูุง ุนูู Ansible.  ูุฐู ุฃุฏุงุฉ ุฌูุฏุฉ ุ ูููู ูุธููุชูุง ุงูููุงุณูุฉ (ุญุชู ูุน ูุฑุงุนุงุฉ ุงููุญุฏุงุช ุงูุฅุถุงููุฉ) ูุฏ ูุง ุชููู ูุงููุฉ ูู ุจุนุถ ุงูููุงูู ุงูุตุนุจุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุนูู ุณุจูู ุงููุซุงู ุ ูู ุฎูุงู ุงููุญุฏุฉ ุงูููุทูุฉ Ansible ุ ูุง ููููู ุชุญุฏูุฏ ุนูุงููู ุงูุดุจูุฉ ุงููุฑุนูุฉ ุงูุชู ุณูุชู ุชุฎุตูุตูุง ูููุง.  ุฃู ุฃูู ููููู ุชุญุฏูุฏ ุดุจูุฉ ุ ูููู ูุง ููููู ุชุนููู ุชุฌูุน ุนูุงููู ูุญุฏุฏ.  ุณูุณุงุนุฏ ุงูุฃูุฑ shell ุงูุฐู ููุดุฆ IP ุงูุนุงุฆู ููุง: </p><br><pre style=";text-align:right;direction:rtl"><code class="bash hljs">openstack floating ip create -c floating_ip_address -f value -project \ {{ project name }} โsubnet private-v4 CLOUD_NET</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุซุงู ุขุฎุฑ ุนูู ุงููุธุงุฆู ุงูููููุฏุฉ: ูุธุฑูุง ููุงุฒุฏูุงุฌ ุงููุฒุฏูุฌ ุ ูุง ูููููุง ุฅูุดุงุก ุฌูุงุฒ ุชูุฌูู ุจุดูู ุตุญูุญ ุจูููุฐูู ูู v4 ู v6.  ูุฐุง ูู ุงูููุงู ุงูุฐู ูููู ููู ูุต bash ูููุฏูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#! /bin/bash # $1 - router_name # $2 - router_project # $3 - router_network # echo "${@:4}" - private subnet lists FIXED4_SUBNET="subnet-bgp-nexthop-v4" FIXED6_SUBNET="subnet-bgp-nexthop-v6" openstack --os-project-name $2 router show $1 if [ $? -eq 0 ] then echo "router is exist" exit 0 fi openstack --os-project-name $2 router create --project $2 $1 for subnet in "${@:4}"; do openstack --os-project-name $2 router add subnet $1 $subnet done openstack --os-project-name $2 router set $1 --external-gateway $3 --fixed-ip subnet=$FIXED4_SUBNET --fixed-ip subnet=$FIXED6_SUBNET</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ุงูุจุฑูุงูุฌ ุงููุตู ุจุฅูุดุงุก ุฌูุงุฒ ุชูุฌูู ุ ูุฅุถุงูุฉ ุงูุดุจูุงุช ุงููุฑุนูุฉ v4 ู v6 ุฅููู ุ ูุชุนููู ุจูุงุจุฉ ุฎุงุฑุฌูุฉ. </p><br><h3 id="retry" style=";text-align:right;direction:rtl">  ุฃุนุฏ ุงููุญุงููุฉ </h3><br><p style=";text-align:right;direction:rtl">  ูู ุฃู ุญุงูุฉ ุบูุฑ ูููููุฉ - ุฅุนุงุฏุฉ ุงูุชุดุบูู.  ุญุงูู ูุฑุฉ ุฃุฎุฑู ุ ูู ุจุฅูุดุงุก ูุซูู ุฃู ุฌูุงุฒ ุชูุฌูู ุฃู ุณุฌู DNS ุ ูุฃูู ูุง ุชููู ุฏุงุฆููุง ูุง ูู ูุดููุชู ุจุณุฑุนุฉ.  ูููู ุฃู ุชุคุฏู ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุฅูู ุชุฃุฎูุฑ ุชุฏููุฑ ุงูุฎุฏูุฉ ุ ููู ูุฐุง ุงูููุช ููููู ุญู ุงููุดููุฉ ุจูุฏูุก ูุจุฏูู ุฃุนุตุงุจ. </p><br><p style=";text-align:right;direction:rtl">  ุฌููุน ุงููุตุงุฆุญ ุฃุนูุงู ุชุนูู ุจุดูู ุฌูุฏ ูุน Terraform ู Puppet ูุฃู ุดูุก ุขุฎุฑ. </p><br><h2 id="vsemu-svoyo-mesto" style=";text-align:right;direction:rtl">  ูู ุดูุก ูู ููุงูู </h2><br><p style=";text-align:right;direction:rtl">  ุฃู ุฎุฏูุฉ ูุจูุฑุฉ (OpenStack ููุณุช ุงุณุชุซูุงุก) ุชุฌูุน ุจูู ุงูุนุฏูุฏ ูู ุงูุฎุฏูุงุช ุงูุฃุตุบุฑ ุงูุชู ูููู ุฃู ุชุชุฏุงุฎู ูุน ุนูู ุจุนุถูุง ุงูุจุนุถ.  ููุง ูุซุงู. </p><br><p style=";text-align:right;direction:rtl">  ูููู ุงูุดุจูุฉ Neutron-L2-agent ูุณุคูู ุนู ุงุชุตุงู ุงูุดุจูุฉ ูู OpenStack.  ุฅุฐุง ูุงูุช ุฌููุน ุงูุนูุงูู ุงูุฃุฎุฑู ููุฌูุฏุฉ ุจุดูู ุฌุฒุฆู ุนูู ูุญุฏุงุช ุงูุชุญูู ุ ูุฅู L2 ุ ุจุณุจุจ ุงูุชูุงุตูู ุ ููุฌูุฏุฉ ูู ูู ููุงู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ae/dx/uh/aedxuhggl2u8fyrtqgwkfphjjle.png"><br>  <em>ููุฐุง ุจุฏุช ุจููุชูุง ุงูุชุญุชูุฉ ูู ุงูุจุฏุงูุฉ ุ ุญุชู ุชุฌุงูุฒ ุนุฏุฏ ุงููุฎุทุทุงุช 50</em> </p><br><p style=";text-align:right;direction:rtl">  ุนูุฏ ูุฐู ุงูููุทุฉ ุ ุฃุฏุฑููุง ุฃูู ุจุณุจุจ ูุฐุง ุงูุชุฑุชูุจ ููุนูุงูู ุ ูู ุชุชููู ูุญุฏุงุช ุงูุชุญูู ูู ุงูุชุนุงูู ูุน ุงูุญูู ุ ูููููุง ุงูุนูุงูู ูุญุณุงุจ ุงูุนูุฏ.  ููู ุฃููู ูู ูุญุฏุงุช ุงูุชุญูู ุ ูุฅูู ุฌุงูุจ ุฐูู ุ ููุณ ูู ุงูุถุฑูุฑู ุฃู ุชุชุนุงูู ูุญุฏุฉ ุงูุชุญูู ูุน ูุนุงูุฌุฉ ูู ุดูุก - ูุฌุจ ุฃู ุชุนุทู ุงููููุฉ ุฅูู ุงูุนูุฏุฉ ุงููููุฐุฉ ุ ูุณุชููู ุงูุนูุฏุฉ ุจุชูููุฐูุง. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/63/mh/8v/63mh8vrzvrqv3w5exan5tw8npba.png"><br>  <em>ูููุงุก ุงููุญููุฉ ูุญุณุงุจ ุงูุนูุฏ</em> </p><br><p style=";text-align:right;direction:rtl">  ููุน ุฐูู ุ ูู ููู ูุฐุง ูุงูููุง ุ ูุฃู ูุซู ูุฐุง ุงูุชุฑุชูุจ ูุงู ูู ุชุฃุซูุฑ ุณูุฆ ุนูู ุฃุฏุงุก ุงูุฃุฌูุฒุฉ ุงูุงูุชุฑุงุถูุฉ.  ูุน ูุซุงูุฉ 14 ูุฑูุฒูุง ุงูุชุฑุงุถููุง ููู ูุงุฏุฉ ูุนููุฉ ุ ุฅุฐุง ุจุฏุฃ ูููู ุดุจูุฉ ูุงุญุฏ ูู ุชุญููู ุงูุฏูู ุ ููุฏ ูุคุซุฑ ุฐูู ุนูู ุงูุนุฏูุฏ ูู ุงูุฃุฌูุฒุฉ ุงูุงูุชุฑุงุถูุฉ ูู ููุช ูุงุญุฏ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/br/z5/zi/brz5ziy4mpmlr2ijectmrezvgtw.png"><br>  <em>ุงูุชูุฑุงุฑ ุงูุซุงูุซ.</em>  <em>ุธูุฑุช ุงูุนูุฏ ุงููุฎุชุงุฑุฉ.</em> </p><br><p style=";text-align:right;direction:rtl">  ููุฑูุง ูููููุง ุงููููุงุก ููุตู ุนูุฏ ุงูุดุจูุฉ.  ุงูุขู ุ ุชุจูู ุฎุฏูุงุช ุงูุฃุฌูุฒุฉ ุงูุธุงูุฑูุฉ ููุท ุนูู ุนููุฏ ุงูุญูุณุจุฉ ุ ููุนูู ุฌููุน ุงููููุงุก ุนูู ุนููุฏ ุงูุดุจูุฉ ุ ููุธู ูููุงุก bgp ุงูุฐูู ูุชุนุงูููู ูุน ุดุจูุฉ v6 ููุท ุนูู ูุญุฏุงุช ุงูุชุญูู (ุญูุซ ูููู ูุนุงูู bgp ุฃู ูุฎุฏู ููุนูุง ูุงุญุฏูุง ููุท ูู ุงูุดุจูุฉ).  ุจูู L2 ูู ูู ููุงู ุ ูุฃูู ุจุฏููู ุ ููุง ูุชุจูุง ุฃุนูุงู ุ ูู ูููู ููุงู ุงุชุตุงู ุนูู ุงูุดุจูุฉ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/pu/yg/ie/puygieqmiyz9zi8dlovcu_j88ma.png"><br>  <em>ูู ุจุชุญููู ุงูุฑุณู ุงูุจูุงูู ููุนูุฏ ุงูุญุณุงุจูุฉ ูุจู ุฎูุท ูู ุดูุก.</em>  <em>ูุงู ุญูุงูู 60 ูช ุ ููู ุงูุญูู ุงูุฎูุถ ุจุดูู ุทููู</em> </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/y5/im/t2/y5imt2_c5e-7xoha7crtboepbd4.png"><br>  <em>ุงูุญูู ุนูู softirq ูุจู ุนููุงุก ุงูุดุจูุฉ ุฅุฒุงูุฉ ุงูุนูุฏ ุญุณุงุจ.</em>  <em>ุจููุช 3 ููู ูุญููุฉ.</em>  <em>ูู ุฐูู ุงูููุช ุ ุงุนุชูุฏูุง ุฃูู ุฃูุฑ ุทุจูุนู</em> </p><br><h2 id="code-asdocumentation" style=";text-align:right;direction:rtl">  ููุฏ ุงูุชูุซูู </h2><br><p style=";text-align:right;direction:rtl">  ูู ุจุนุถ ุงูุฃุญูุงู ูุญุฏุซ ุฃู ุงูุฑูุฒ ูู ุงูุชูุซูู ุ ุฎุงุตุฉ ูู ุงูุฎุฏูุงุช ุงููุจูุฑุฉ ูุซู OpenStack.  ูุน ุฏูุฑุฉ ุฅุตุฏุงุฑ ูุฏุชูุง ุณุชุฉ ุฃุดูุฑ ุ ููุณู ุงููุทูุฑูู ุฃู ุจุจุณุงุทุฉ ููุณ ูุฏููู ุงูููุช ูุชูุซูู ุจุนุถ ุงูุฃุดูุงุก ุ ูุชุจูู ููุง ูู ุงูุญุงู ูู ุงููุซุงู ุฃุฏูุงู. </p><br><h4 id="pro-taymauty" style=";text-align:right;direction:rtl">  ุญูู ุงููููุงุช </h4><br><p style=";text-align:right;direction:rtl">  ุจูุฌุฑุฏ ุฃู ุฑุฃููุง ุฃู ููุงููุงุช Neutron ุฅูู Open vSwitch ูุง ุชุตูุญ ูู ุฎูุณ ุซูุงูู ูุชูุชูู ุงููููุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">127.0.0.1:29696: no response to inactivity probe after 10 seconds, disconnecting neutron.agent.ovsdb.native.commands TimeoutException: Commands [DbSetCommand(table=Port, col_values=((<span class="hljs-string"><span class="hljs-string">'tag'</span></span>, 11),), record=qtoq69a81c6-e2)] exceeded timeout 5 seconds</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุงูุทุจุน ุ ุงูุชุฑุถูุง ุฃูู ุชู ุฅุตูุงุญ ูุฐุง ูู ููุงู ูุง ูู ุงูุฅุนุฏุงุฏุงุช.  ููุฏ ุจุญุซูุง ูู ุญุฒูุฉ ุงูุชููุฆุฉ ูุงููุซุงุฆู ูุงูุฏููู ุ ููููู ูู ุงูุจุฏุงูุฉ ูู ูุฌุฏูุง ุฃู ุดูุก.  ููุชูุฌุฉ ูุฐูู ุ ุชู ุงูุนุซูุฑ ุนูู ูุตู ุงูุฅุนุฏุงุฏ ุงููุทููุจ ูู ุงูุตูุญุฉ ุงูุฎุงูุณุฉ ูู ูุชุงุฆุฌ ุงูุจุญุซ - ุฑุงุฌุนูุง ุงูุฑูุฒ ูุฑุฉ ุฃุฎุฑู ููุฌุฏูุง ุงูููุงู ุงูุตุญูุญ.  ุงูุฅุนุฏุงุฏ ูู ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">ovs_vsctl_timeout = 30</code> </pre> <br><p style=";text-align:right;direction:rtl">  <em>ูุถุนูุงูุง ููุฏุฉ 30 ุซุงููุฉ (ูุงูุช 5) ุ ูุจุฏุฃ ูู ุดูุก ูุนูู ุจุดูู ุฃูุถู ููููุงู.</em> </p><br><p style=";text-align:right;direction:rtl">  ุฅููู ุฃูุฑ ุขุฎุฑ ุบูุฑ ูุงุถุญ - ุนูุฏ ุฅุนุงุฏุฉ ุชุดุบูู ููููุงุช ุงูุดุจูุฉ ุ ูุฏ ุชุชู ุฅุนุงุฏุฉ ุชุนููู ุจุนุถ ุฅุนุฏุงุฏุงุช Open vSwitch.  ูุญุฏุซ ูุฐุง ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุน ุนุฏู ูุดุงุท ovs-vsctl.  ูุฐุง ุฃูุถูุง ูููุฉ ุ ููููู ูุคุซุฑ ุนูู ููุงููุงุช ovs-vsctl ููุณูุง ุฅูู ูุงุนุฏุฉ ุจูุงูุงุชู.  ุฃุถููุงูุง ุฅูู systemd init ุ ููุง ุณูุญ ููุง ุจุจุฏุก ุฌููุน ุงูููุงุชูุญ ุจุงููุนููุงุช ุงูุชู ูุญุชุงุฌูุง ุนูุฏ ุจุฏุก ุงูุชุดุบูู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">ovs-vsctl <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> Controller <span class="hljs-string"><span class="hljs-string">"br-int"</span></span> inactivity_probe=30000</code> </pre> <br><h4 id="pro-nastroyki-setevogo-steka" style=";text-align:right;direction:rtl">  ุญูู ุฅุนุฏุงุฏุงุช ููุฏุณ ุงูุดุจูุฉ </h4><br><p style=";text-align:right;direction:rtl">  ูุงู ุนูููุง ุฃูุถูุง ุงูุงุจุชุนุงุฏ ููููุงู ุนู ุงูุฅุนุฏุงุฏุงุช ุงูููุจููุฉ ุจุดูู ุนุงู ูู ุญุฒูุฉ ุงูุดุจูุฉ ุ ูุงูุชู ูุณุชุฎุฏููุง ุนูู ุฎูุงุฏููุง ุงูุฃุฎุฑู. </p><br><p style=";text-align:right;direction:rtl">  ูููุง ููู ุฅุนุฏุงุฏ ุงููุฏุฉ ุงูุชู ูุณุชุบุฑููุง ุชุฎุฒูู ุณุฌูุงุช ARP ูู ุฌุฏูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">net.ipv4.neigh.default.base_reachable_time = 60 net.ipv4.neigh.default.gc_stale_time=60</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ูู ููู ูุงุญุฏ.  ุจุดูู ุนุงู ุ ูููู ุฃู ูุนูุด ูุฎุทุท ูุงุญุฏ ูุจุถุนุฉ ุฃุณุงุจูุน ุ ูููู ููุฏุฉ ููู ูุงุญุฏ ุ ูููู ุฅุนุงุฏุฉ ุฅูุดุงุก ุงููุฎุทุทุงุช 4-6 ูุฑุงุช ุ ุจูููุง ุชุชุบูุฑ ูุฑุงุณูุงุช ุนููุงู MAC ูุนููุงู IP ุจุงุณุชูุฑุงุฑ.  ุญุชู ูุง ุชุชุฑุงูู ุงูููุงูุฉ ุ ูุถุจุท ุงูููุช ุนูู ุฏูููุฉ ูุงุญุฏุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">net.ipv4.conf.default.arp_notify = 1 net.nf_conntrack_max = 1000000 (default 262144) net.netfilter.nf_conntrack_max = 1000000 (default 262144)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุฃุฌุจุฑูุง ุนูู ุฅุฑุณุงู ุฅุฎุทุงุฑุงุช ARP ุนูุฏ ุฑูุน ูุงุฌูุฉ ุงูุดุจูุฉ.  ูููุง ุฃูุถูุง ุจุฒูุงุฏุฉ ุฌุฏูู conntrack ุ ูุฃูู ุนูุฏ ุงุณุชุฎุฏุงู NAT ู ip ุงูุนุงุฆู ุ ูู ููู ูุฏููุง ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ.  ุงุฑุชูุน ุฅูู ููููู (ูุน ุงูุงูุชุฑุงุถู ูู 262144) ุ ุฃุตุจุญ ูู ุดูุก ุฃูุถู. </p><br><p style=";text-align:right;direction:rtl">  ูููู ุจุชุตุญูุญ ุญุฌู ุฌุฏูู MAC ูู Open vSwitch ููุณู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">ovs-vsctl <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> bridge bt-int other-config:mac-table-size=50000 (default 2048)</code> </pre> <br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/px/oi/px/pxoipxvpkzuou-twlr5uf0r28k8.png"><br>  <em>ุจุนุฏ ูู ุงูุฅุนุฏุงุฏุงุช ุ ุชุญูู 40ูช ูู ุงูุญูู ุฅูู ุตูุฑ ุชูุฑูุจูุง</em> </p><br><h4 id="rx-flow-hash" style=";text-align:right;direction:rtl">  ุชุฌุฒุฆุฉ ุชุฏูู rx </h4><br><p style=";text-align:right;direction:rtl">  ูุชูุฒูุน ูุนุงูุฌุฉ ุญุฑูุฉ ูุฑูุฑ UDP ุจูู ุฌููุน ููุงุฆู ุงูุงูุชุธุงุฑ ูุณูุงุณู ุงูุนูููุงุช ุ ูููุง ุจุชุถููู ุชุฌุฒุฆุฉ ุชุฏูู rx.  ูู ุจุทุงูุงุช ุดุจูุฉ Intel ุ ุฃู ูู ุจุฑูุงูุฌ ุชุดุบูู i40e ุ ูุชู ุชุนุทูู ูุฐุง ุงูุฎูุงุฑ ุงูุชุฑุงุถููุง.  ูุฏููุง hypervisors ูุน 72 ููุงุฉ ูู ุจููุชูุง ุงูุชุญุชูุฉ ุ ูุฅุฐุง ูุงู ูุงุญุฏ ููุท ูุดุบูููุง ุ ููุฐุง ููุณ ุงูุฃูุซู. </p><br><p style=";text-align:right;direction:rtl">  ูุชู ุฐูู ุนูู ุงููุญู ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">ethtool -N eno50 rx-flow-hash udp4 sdfn</code> </pre> <br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/zj/qp/16/zjqp16xvvxmawd1irfjbwaeia9q.png"></p><br><p style=";text-align:right;direction:rtl">  <strong>ุงุณุชูุชุงุฌ ููู: ููููู ุชูููู ูู ุดูุก ุนูู ุงูุฅุทูุงู.</strong>  ุณูุชูุงุณุจ ุงูุชูููู ุงูุงูุชุฑุงุถู ูู ููุช ูุง (ููุง ูุนููุง) ุ ูููู ูุดููุฉ ุงููููุงุช ุฌุนูุช ุงูุจุญุซ ุถุฑูุฑููุง.  ููุฐุง ุฃูุฑ ุทุจูุนู. </p><br><h3 id="pravila-bezopasnosti" style=";text-align:right;direction:rtl">  ููุงุนุฏ ุงูุณูุงูุฉ </h3><br><p style=";text-align:right;direction:rtl">  ููููุง ููุชุทูุจุงุช ุฎุฏูุฉ ุงูุฃูู ุ ูุฅู ุฌููุน ุงููุดุงุฑูุน ุฏุงุฎู ุงูุดุฑูุฉ ูุฏููุง ููุงุนุฏ ุดุฎุตูุฉ ูุนุงูููุฉ - ููุงู ุงููุซูุฑ ูููุง.  ุนูุฏูุง ุงูุชูููุง ุฅูู ุงูุฎุงุฑุฌ ูู 300 ุขูุฉ ุงูุชุฑุงุถูุฉ ุฅูู ุจุฑูุงูุฌ ูุฑุงูุจุฉ ุงูุชุฑุงุถู ูุงุญุฏ ุ ุชุฏูู ูู ูุฐุง ุฅูู 80 ุฃูู ูุงุนุฏุฉ ูู iptables.  ุจุงููุณุจุฉ ุฅูู iptables ููุณูุง ุ ูุฐู ููุณุช ูุดููุฉ ุ ููู Neutron ูููู ุจุชุญููู ูุฐู ุงูููุงุนุฏ ูู RabbitMQ ูู ุฏูู ูุงุญุฏ (ูุฃูู ููุชูุจ ูู Python ุ ููู ุดูุก ุญุฒูู ูุน ุชุนุฏุฏ ุงูููุงูุงุช ููุงู).  ูุชุฌูุฏ ูููู ุงููููุชุฑูู ููููุฏ ุงูุงุชุตุงู ูุน RabbitMQ ูุฑุฏ ูุนู ูุชุณูุณู ูู ุงููููุงุช ุ ูุจุนุฏ ุงูุงุณุชุฑุฏุงุฏ ุ ูุทูุจ ูููุชุฑูู ูุฑุฉ ุฃุฎุฑู ุฌููุน ุงูููุงุนุฏ ุ ููุจุฏุฃ ุงูุชุฒุงูู ุ ููุจุฏุฃ ูู ุดูุก ูู ุฌุฏูุฏ. </p><br><p style=";text-align:right;direction:rtl">  ุฅูู ุฌุงูุจ ุฐูู ุ ุฒุงุฏ ููุช ุฅูุดุงุก ุงููุฏุฑุฌุงุช ูู 20 ุฅูู 40 ุฏูููุฉ ุ ูู ุฃูุถู ุงูุฃุญูุงู ุ ุฅูู ุณุงุนุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุจุฏุงูุฉ ุ ูููุง ููุชู ุจูู ูู ุดูุก ูุน ุงูุงุณุชุฑุฏุงุฏ (ุฃุฏุฑููุง ุจุงููุนู ูู ูุฐู ุงููุฑุญูุฉ ุฃูู ูุง ูููู ุญู ุงููุดููุฉ ุจูุฐู ุงูุณุฑุนุฉ) ุ ุซู ุจุฏุฃูุง ูู ุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">FWaaS</a> .  ูุน ุฐูู ุ ูููุง ุจุฅุฒุงูุฉ ููุงุนุฏ ุงูุฃูุงู ูุน ุงูุนูุฏ ุงูุญุณุงุจูุฉ ููุตู ุนูุฏ ุงูุดุจูุฉ ุญูุซ ููุฌุฏ ุฌูุงุฒ ุงูุชูุฌูู ููุณู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ou/dg/r_/oudgr_riwann3smyytraqiommpe.png"><br>  <em>ุงููุตุฏุฑ - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">docs.openstack.org</a></em> </p><br><p style=";text-align:right;direction:rtl">  ูุจุงูุชุงูู ุ ููุฌุฏ ุฏุงุฎู ุงููุดุฑูุน ูุตูู ูุงูู ุฅูู ูู ูุง ูู ูุทููุจ ุ ููุชู ุชุทุจูู ููุงุนุฏ ุงูุฃูุงู ุนูู ุงูุงุชุตุงูุงุช ุงูุฎุงุฑุฌูุฉ.  ูุฐุง ููููุง ุงูุญูู ุนูู ุงููููุชุฑูู ูุนุงุฏูุง ุฅูู 20-30 ุฏูููุฉ ูุฎูู ุจูุฆุฉ ุงุฎุชุจุงุฑ. </p><br><h2 id="itog" style=";text-align:right;direction:rtl">  ุงูููุฎุต </h2><br><p style=";text-align:right;direction:rtl">  OpenStack ูู ุดูุก ุฑุงุฆุน ุญูุซ ููููู ุฅุนุงุฏุฉ ุชุฏููุฑ ุงูุญุฏูุฏ ูุฅูุดุงุก ุณุญุงุจุฉ ุฏุงุฎููุฉ ูุฅูุดุงุก ุดูุก ุขุฎุฑ ุจูุงุกู ุนููู.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ููุงู ูุฌุชูุน ูุจูุฑ ููุฌููุนุฉ ูุดุทุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู Telegram</a> ุ ุญูุซ ุฏูุนููุง ุญูู ุงููููุงุช. </p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูู ุดูุก.  ุงุทุฑุญ ุงูุฃุณุฆูุฉ ุ ุฃูุง ูุฒููุงุฆู ุนูู ุงุณุชุนุฏุงุฏ ููุฅุฌุงุจุฉ ุนู ุชุฌุฑุจุชูุง ููุดุงุฑูุชูุง. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar427569/">https://habr.com/ru/post/ar427569/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar427557/index.html">ููุฎุต ุฃุญุฏุงุซ ุชูููููุฌูุง ุงููุนูููุงุช ูู ููููุจุฑ (ุงูุฌุฒุก ุงูุฃูู)</a></li>
<li><a href="../ar427561/index.html">ุงูุญู ูู ุงูุฅุตูุงุญ: ุงูุฎุทูุงุช ุงูุฃููู ูู ุงูุงุชุฌุงู ุงูุตุญูุญ ูู ููุชูุฑููุง</a></li>
<li><a href="../ar427563/index.html">ุชู ุชูููุฐ ูุนูุงุฑ SNI ุงููุดูุฑ ูู Firefox Nightly</a></li>
<li><a href="../ar427565/index.html">"ุฅูุฌุงุฒู ูู ุฃููู ุนุงุฏุฉ ูุง ุนุงุฏุช ุฅูู ุงููููุฉ" - 10 ุฃุณุฆูุฉ ูููุจุฑูุฌ ุ ุงูุนุฏุฏ 10</a></li>
<li><a href="../ar427567/index.html">ุฎุฑุงุฆุท ูุณุฏุณ ูู ุงููุญุฏุฉ: ุฏูุฑุฉ ุงูููุงู ุ ุงูุชุขูู ุ ุงูููุงุทู ุงูุฃุญูุงุฆูุฉ ุ ุฎุฑูุทุฉ ุฃุณุทูุงููุฉ</a></li>
<li><a href="../ar427571/index.html">ุงุชุญุงุฏ R ู PostgreSQL. ูููู ุจุชุญููู ุนูู ุงููุทุงุฑุงุช ูุญุณุงุจ ุงููุนุงุดุงุช</a></li>
<li><a href="../ar427573/index.html">ุญููู ุฃู ุญูุงุฉ: ูุงูููู ูุณุจุจ ูุฌุฐุจ ุทููู ุฅูู ุงูุนูู</a></li>
<li><a href="../ar427575/index.html">ููุงุฐุง ูู ุชุนูู Wi-Fi ููุง ูู ูุฎุทุท ููุง ุ ูููุงุฐุง ุชุนุฑู ุงููุงุชู ุงูุฐู ูุณุชุฎุฏูู ุงูููุธู</a></li>
<li><a href="../ar427577/index.html">ุงูุชุนูู ุงูุขูู ููุงุจู ุชุญููู ุงูุชูููุน ุนูุฏ ุงูุชุดุงู ุงููุฌูุงุช ุนูู ุชุทุจูู ููุจ</a></li>
<li><a href="../ar427579/index.html">ุชูุฒูุน ุงูุชุทุจููุงุช ููุธุงู iOS ุฏุงุฎู ุงูุดุฑูุฉ (Enterprise Distribute iOS App ูู ุงูููุฒู)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>