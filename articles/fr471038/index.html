<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîÅ üå∫ üåá Fichier descripteur Linux avec des exemples ü§≤ üñïüèø üò∞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Une fois, dans une interview, ils m'ont demand√© ce que vous feriez si vous trouvez un service qui ne fonctionne pas parce que le disque est √† court d'...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fichier descripteur Linux avec des exemples</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471038/"> Une fois, dans une interview, ils m'ont demand√© ce que vous feriez si vous trouvez un service qui ne fonctionne pas parce que le disque est √† court d'espace? <br><br>  Bien s√ªr, j'ai r√©pondu que je verrais ce que cet endroit √©tait occup√© et, si possible, je nettoyerais l'endroit. <br>  L'enqu√™teur a ensuite demand√© s'il n'y avait pas d'espace libre sur la section, mais vous ne voyez pas non plus les fichiers qui occuperaient toute la place? <br><br>  Pour cela, j'ai dit que vous pouvez toujours regarder les descripteurs de fichiers ouverts, par exemple avec la commande lsof et comprendre quelle application a pris tout l'espace disponible, puis vous pouvez proc√©der selon les circonstances, selon que les donn√©es sont n√©cessaires ou non. <br><br>  L'intervieweur m'a interrompu au dernier mot, ajoutant ma question: "Supposons que nous n'ayons pas besoin des donn√©es, c'est juste un journal de d√©bogage, mais l'application ne fonctionne pas car elle ne peut pas enregistrer le d√©bogage"? <br><br>  "D'accord," ai-je r√©pondu, "nous pouvons d√©sactiver le d√©bogage dans la configuration de l'application et la red√©marrer." <br>  L'intervieweur s'est oppos√©: ¬´Non, nous ne pouvons pas red√©marrer l'application, des donn√©es importantes sont toujours stock√©es dans notre m√©moire, et des clients importants sont connect√©s au service lui-m√™me, que nous ne pouvons pas forcer √† se reconnecter¬ª. <br><br>  ¬´Eh bien, ai-je dit, si nous ne pouvons pas red√©marrer l'application et que les donn√©es ne sont pas importantes pour nous, nous pouvons simplement effacer ce fichier ouvert via le fichier descripteur, m√™me si nous ne le voyons pas dans la commande ls sur le syst√®me de fichiers.¬ª <br><br>  L'intervieweur √©tait content, mais pas moi. <br><br>  Alors j'ai pens√©, pourquoi la personne qui teste mes connaissances ne creuse pas plus profond√©ment?  Mais que se passe-t-il si les donn√©es sont toujours importantes?  Et si nous ne pouvons pas red√©marrer le processus, et en m√™me temps ce processus √©crit dans le syst√®me de fichiers dans une section sur laquelle il n'y a pas d'espace libre?  Et si nous ne pouvons pas perdre non seulement les donn√©es d√©j√† enregistr√©es, mais aussi les donn√©es que ce processus √©crit ou tente d'enregistrer? <br><a name="habracut"></a><br><h3>  Tuzik </h3><br>  Au d√©but de ma carri√®re, j'ai essay√© de cr√©er une petite application dans laquelle il fallait stocker des informations sur les utilisateurs.  Et puis j'ai pens√©, comment puis-je mapper l'utilisateur √† ses donn√©es.  Par exemple, j'ai Ivan Ivanov Ivanich, et il a des donn√©es, mais comment se faire des amis avec eux?  Je peux indiquer directement que le chien nomm√© "Tuzik" appartient √† ce m√™me Ivan.  Mais que se passe-t-il s'il change de nom et qu'Ivan devient, par exemple, Olya?  Ensuite, il s'av√®re que notre Olya Ivanovna Ivanova n'aura plus de chien, et notre Tuzik appartiendra toujours √† l'Ivan inexistant.  Cette base de donn√©es a √©t√© aid√©e par une base de donn√©es qui a donn√© √† chaque utilisateur un identifiant (ID) unique, et mon Tuzik √©tait attach√© √† cet ID, qui, en fait, n'√©tait qu'un num√©ro ordinal.  Ainsi, le propri√©taire du tuzik √©tait avec le num√©ro d'identification 2, et √† un moment donn√©, Ivan √©tait sous ce num√©ro, puis Olya est devenu le m√™me num√©ro.  Le probl√®me de l'humanit√© et de l'√©levage est pratiquement r√©solu. <br><br><h3>  Descripteur de fichier </h3><br>  Le probl√®me du fichier et du programme fonctionnant avec ce fichier est √† peu pr√®s le m√™me que celui de notre chien et de notre personne.  Supposons que j'ouvre un fichier sous le nom ivan.txt et que je commence √† y √©crire le mot tuzik, mais que je ne parvienne √† √©crire que la premi√®re lettre ¬´t¬ª dans le fichier, et ce fichier a √©t√© renomm√© par quelqu'un, par exemple, olya.txt.  Mais le fichier est rest√© le m√™me, et je veux toujours y √©crire mon as.  Chaque fois que j'ouvre un fichier avec l'appel syst√®me ouvert dans n'importe quel langage de programmation, j'obtiens un ID unique qui me pointe vers un fichier, cet ID est un descripteur de fichier.  Et peu importe ce que quelqu'un fera ensuite avec ce fichier, ils peuvent le supprimer, ils peuvent le renommer, ils peuvent changer le propri√©taire ou retirer les autorisations de lecture et d'√©criture, j'y aurai toujours acc√®s, car au moment o√π le fichier est ouvert, J'avais le droit de le lire et / ou de l'√©crire, et j'ai r√©ussi √† commencer √† travailler avec lui, ce qui signifie que je dois continuer √† le faire. <br><br>  Sous Linux, la biblioth√®que libc s'ouvre pour chaque fichier descripteur d'application (processus) 3 en cours d'ex√©cution, avec les nombres 0,1,2.  Vous pouvez trouver plus d'informations sur les liens <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">man stdio</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">man stdout</a> <br><br><ul><li>  Le descripteur de fichier 0 est appel√© STDIN et est associ√© √† une entr√©e de donn√©es de l'application </li><li>  Le descripteur de fichier 1 est appel√© STDOUT et est utilis√© par les applications pour sortir des donn√©es, par exemple, des commandes d'impression </li><li>  Le descripteur de fichier 2 est appel√© STDERR et est utilis√© par les applications pour produire des donn√©es de rapport d'erreurs. </li></ul><br>  Si dans votre programme vous ouvrez un fichier en lecture ou en √©criture, vous obtiendrez tr√®s probablement le premier identifiant gratuit et ce sera le num√©ro 3. <br><br>  Une liste de fichiers descripteurs peut √™tre consult√©e √† partir de n'importe quel processus si vous connaissez son PID. <br><br>  Par exemple, ouvrez une console avec bash et voyez le PID de notre processus <br><br><pre><code class="bash hljs">[user@localhost ]$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> $$ 15771</code> </pre> <br>  Dans la deuxi√®me console, ex√©cutez <br><br><pre> <code class="bash hljs">[user@localhost ]$ ls -lah /proc/15771/fd/ total 0 dr-x------ 2 user user 0 Oct 7 15:42 . dr-xr-xr-x 9 user user 0 Oct 7 15:42 .. lrwx------ 1 user user 64 Oct 7 15:42 0 -&gt; /dev/pts/21 lrwx------ 1 user user 64 Oct 7 15:42 1 -&gt; /dev/pts/21 lrwx------ 1 user user 64 Oct 7 15:42 2 -&gt; /dev/pts/21 lrwx------ 1 user user 64 Oct 7 15:42 255 -&gt; /dev/pts/21</code> </pre><br>  Vous pouvez ignorer en toute s√©curit√© le descripteur de fichier num√©ro 255 dans le cadre de cet article; il a √©t√© ouvert pour vos besoins par bash lui-m√™me, et non par une biblioth√®que li√©e. <br><br>  Maintenant, les 3 fichiers descripteurs sont associ√©s au p√©riph√©rique pseudo-terminal <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">/ dev / pts</a> , mais nous pouvons toujours les manipuler, par exemple, les ex√©cuter dans la deuxi√®me console <br><br><pre> <code class="bash hljs">[user@localhost ]$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"hello world"</span></span> &gt; /proc/15771/fd/0</code> </pre><br>  Et dans la premi√®re console, nous verrons <br><br><pre> <code class="bash hljs">[user@localhost ]$ hello world</code> </pre><br><h3>  Rediriger et diriger </h3><br>  Vous pouvez facilement remplacer ces 3 fichiers descripteurs dans n'importe quel processus, y compris dans bash, par exemple, via un canal reliant deux processus, voir <br><br><pre> <code class="bash hljs">[user@localhost ]$ cat /dev/zero | sleep 10000</code> </pre><br>  Vous pouvez ex√©cuter cette commande vous-m√™me avec <i>strace -f</i> et voir ce qui se passe √† l'int√©rieur, mais je vais vous le dire bri√®vement. <br><br>  Notre processus parent bash avec PID 15771 analyse notre commande et comprend exactement combien de commandes nous voulons ex√©cuter, dans notre cas il y en a deux: cat et sleep.  Bash sait qu'il doit cr√©er deux processus enfants et les combiner avec un seul tuyau.  Total bash aura besoin de 2 processus enfants et d'un canal. <br><br>  Avant de cr√©er des processus enfants, bash lance l'appel syst√®me de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">canal</a> et re√ßoit de nouveaux descripteurs de fichier pour le tampon de canal temporaire, mais ce tampon ne lie pas encore nos deux processus enfants. <br><br>  Pour le processus parent, il semble que le canal existe d√©j√†, et il n'y a pas encore de processus enfant: <br><br><pre> <code class="bash hljs">PID <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> 15771 bash lrwx------ 1 user user 64 Oct 7 15:42 0 -&gt; /dev/pts/21 lrwx------ 1 user user 64 Oct 7 15:42 1 -&gt; /dev/pts/21 lrwx------ 1 user user 64 Oct 7 15:42 2 -&gt; /dev/pts/21 lrwx------ 1 user user 64 Oct 7 15:42 3 -&gt; pipe:[253543032] lrwx------ 1 user user 64 Oct 7 15:42 4 -&gt; pipe:[253543032] lrwx------ 1 user user 64 Oct 7 15:42 255 -&gt; /dev/pts/21</code> </pre><br>  Ensuite, √† l'aide d'un appel syst√®me, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">clone</a> bash cr√©e deux processus enfants, et nos trois processus ressembleront √† ceci: <br><br><pre> <code class="bash hljs">PID <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> 15771 bash lrwx------ 1 user user 64 Oct 7 15:42 0 -&gt; /dev/pts/21 lrwx------ 1 user user 64 Oct 7 15:42 1 -&gt; /dev/pts/21 lrwx------ 1 user user 64 Oct 7 15:42 2 -&gt; /dev/pts/21 lrwx------ 1 user user 64 Oct 7 15:42 3 -&gt; pipe:[253543032] lrwx------ 1 user user 64 Oct 7 15:42 4 -&gt; pipe:[253543032] lrwx------ 1 user user 64 Oct 7 15:42 255 -&gt; /dev/pts/21 PID <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> 9004 bash lrwx------ 1 user user 64 Oct 7 15:57 0 -&gt; /dev/pts/21 lrwx------ 1 user user 64 Oct 7 15:57 1 -&gt; /dev/pts/21 lrwx------ 1 user user 64 Oct 7 15:57 2 -&gt; /dev/pts/21 lrwx------ 1 user user 64 Oct 7 15:57 3 -&gt; pipe:[253543032] lrwx------ 1 user user 64 Oct 7 15:57 4 -&gt; pipe:[253543032] lrwx------ 1 user user 64 Oct 7 15:57 255 -&gt; /dev/pts/21 PID <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> 9005 bash lrwx------ 1 user user 64 Oct 7 15:57 0 -&gt; /dev/pts/21 lrwx------ 1 user user 64 Oct 7 15:57 1 -&gt; /dev/pts/21 lrwx------ 1 user user 64 Oct 7 15:57 2 -&gt; /dev/pts/21 lrwx------ 1 user user 64 Oct 7 15:57 3 -&gt; pipe:[253543032] lrwx------ 1 user user 64 Oct 7 15:57 4 -&gt; pipe:[253543032] lrwx------ 1 user user 64 Oct 7 15:57 255 -&gt; /dev/pts/21</code> </pre><br>  N'oubliez pas que le clone clone le processus avec tous les descripteurs de fichiers, ils seront donc les m√™mes dans le processus parent et dans les enfants.  La t√¢che du processus parent avec le PID 15771 est de surveiller les processus enfants, il attend donc simplement une r√©ponse des processus enfants. <br><br>  Par cons√©quent, il n'a pas besoin de pipe et ferme les descripteurs de fichiers avec les num√©ros 3 et 4. <br><br>  Dans le premier processus enfant bash avec PID 9004, l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">appel</a> syst√®me <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dup2</a> change notre descripteur de fichier STDOUT num√©ro 1 en descripteur de fichier pointant vers pipe, dans notre cas c'est le num√©ro 3. Ainsi, tout ce que le premier processus enfant avec PID 9004 √©crira dans STDOUT tombera automatiquement dans le tampon du tuyau. <br><br>  Dans le deuxi√®me processus enfant avec PID 9005, bash modifie le descripteur de fichier STDIN avec le num√©ro 0 en utilisant dup2. Maintenant, tout ce que notre deuxi√®me bash avec PID 9005 lira lira √† partir du canal. <br><br>  Apr√®s cela, les descripteurs avec les nombres 3 et 4 sont √©galement ferm√©s dans les processus enfants, car ils ne sont plus utilis√©s. <br><br>  J'ignore d√©lib√©r√©ment le descripteur de fichier 255, il utilise bash pour les besoins internes et sera √©galement ferm√© dans les processus enfants. <br><br>  De plus, dans le premier processus enfant avec PID 9004, bash d√©marre le fichier ex√©cutable que nous avons sp√©cifi√© sur la ligne de commande avec l'appel syst√®me <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">exec</a> , dans notre cas c'est / usr / bin / cat. <br><br>  Dans le deuxi√®me processus enfant avec PID 9005, bash d√©marre le deuxi√®me fichier ex√©cutable que nous avons sp√©cifi√©, dans notre cas, il s'agit de / usr / bin / sleep. <br><br>  L'appel syst√®me exec ne ferme pas les descripteurs de fichiers s'ils n'ont pas √©t√© ouverts avec l'indicateur O_CLOEXEC pendant l'appel ouvert.  Dans notre cas, apr√®s avoir ex√©cut√© les fichiers ex√©cutables, tous les descripteurs de fichiers actuels seront enregistr√©s. <br><br>  V√©rifiez dans la console: <br><br><pre> <code class="bash hljs">[user@localhost ]$ pgrep -P 15771 9004 9005 [user@localhost ]$ ls -lah /proc/15771/fd/ total 0 dr-x------ 2 user user 0 Oct 7 15:42 . dr-xr-xr-x 9 user user 0 Oct 7 15:42 .. lrwx------ 1 user user 64 Oct 7 15:42 0 -&gt; /dev/pts/21 lrwx------ 1 user user 64 Oct 7 15:42 1 -&gt; /dev/pts/21 lrwx------ 1 user user 64 Oct 7 15:42 2 -&gt; /dev/pts/21 lrwx------ 1 user user 64 Oct 7 15:42 255 -&gt; /dev/pts/21 [user@localhost ]$ ls -lah /proc/9004/fd total 0 dr-x------ 2 user user 0 Oct 7 15:57 . dr-xr-xr-x 9 user user 0 Oct 7 15:57 .. lrwx------ 1 user user 64 Oct 7 15:57 0 -&gt; /dev/pts/21 l-wx------ 1 user user 64 Oct 7 15:57 1 -&gt; pipe:[253543032] lrwx------ 1 user user 64 Oct 7 15:57 2 -&gt; /dev/pts/21 lr-x------ 1 user user 64 Oct 7 15:57 3 -&gt; /dev/zero [user@localhost ]$ ls -lah /proc/9005/fd total 0 dr-x------ 2 user user 0 Oct 7 15:57 . dr-xr-xr-x 9 user user 0 Oct 7 15:57 .. lr-x------ 1 user user 64 Oct 7 15:57 0 -&gt; pipe:[253543032] lrwx------ 1 user user 64 Oct 7 15:57 1 -&gt; /dev/pts/21 lrwx------ 1 user user 64 Oct 7 15:57 2 -&gt; /dev/pts/21 [user@localhost ]$ ps -up 9004 USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND user 9004 0.0 0.0 107972 620 pts/21 S+ 15:57 0:00 cat /dev/zero [user@localhost ]$ ps -up 9005 USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND user 9005 0.0 0.0 107952 360 pts/21 S+ 15:57 0:00 sleep 10000</code> </pre><br>  Comme vous pouvez le voir, le nombre unique de nos tuyaux est le m√™me dans les deux processus.  Nous avons donc une connexion entre deux processus diff√©rents avec un parent. <br><br>  Pour ceux qui ne connaissent pas les appels syst√®me utilis√©s par bash, je recommande vivement d'ex√©cuter les commandes via strace et de voir ce qui se passe √† l'int√©rieur, par exemple, comme ceci: <br><br><pre> <code class="bash hljs">strace -s 1024 -f bash -c <span class="hljs-string"><span class="hljs-string">"ls | grep hello"</span></span></code> </pre><br>  Revenons √† notre probl√®me de manque d'espace disque et d'essayer d'enregistrer les donn√©es sans red√©marrer le processus.  √âcrivons un petit programme qui √©crit sur le disque environ 1 m√©gaoctet par seconde.  De plus, si pour une raison quelconque, nous ne pouvions pas √©crire de donn√©es sur le disque, nous l'ignorerions simplement et tenterions de r√©√©crire les donn√©es apr√®s une seconde.  Dans l'exemple que j'utilise Python, vous pouvez utiliser n'importe quel autre langage de programmation. <br><br><pre> <code class="python hljs">[user@localhost ]$ cat openforwrite.py <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time mystr=<span class="hljs-string"><span class="hljs-string">"a"</span></span>*<span class="hljs-number"><span class="hljs-number">1024</span></span>*<span class="hljs-number"><span class="hljs-number">1024</span></span>+<span class="hljs-string"><span class="hljs-string">"\n"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">"123.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"w"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: f.write(str(datetime.datetime.now())) f.write(mystr) f.flush() time.sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre><br>  Ex√©cutez le programme et regardez les descripteurs de fichiers <br><br><pre> <code class="bash hljs">[user@localhost ]$ python openforwrite.py &amp; [1] 3762 [user@localhost ]$ ps axuf | grep [o]penforwrite user 3762 0.0 0.0 128600 5744 pts/22 S+ 16:28 0:00 | \_ python openforwrite.py [user@localhost ]$ ls -la /proc/3762/fd total 0 dr-x------ 2 user user 0 Oct 7 16:29 . dr-xr-xr-x 9 user user 0 Oct 7 16:29 .. lrwx------ 1 user user 64 Oct 7 16:29 0 -&gt; /dev/pts/22 lrwx------ 1 user user 64 Oct 7 16:29 1 -&gt; /dev/pts/22 lrwx------ 1 user user 64 Oct 7 16:29 2 -&gt; /dev/pts/22 l-wx------ 1 user user 64 Oct 7 16:29 3 -&gt; /home/user/123.txt</code> </pre><br>  Comme vous pouvez le voir, nous avons nos 3 descripteurs de fichiers standard et un autre que nous avons ouvert.  V√©rifiez la taille du fichier: <br><br><pre> <code class="bash hljs">[user@localhost ]$ ls -lah 123.txt -rw-rw-r-- 1 user user 117M Oct 7 16:30 123.txt</code> </pre><br>  des donn√©es sont en cours d'√©criture, essayez de modifier les autorisations du fichier: <br><br><pre> <code class="bash hljs">[user@localhost ]$ sudo chown root: 123.txt [user@localhost ]$ ls -lah 123.txt -rw-rw-r-- 1 root root 168M Oct 7 16:31 123.txt [user@localhost ]$ ls -lah 123.txt -rw-rw-r-- 1 root root 172M Oct 7 16:31 123.txt</code> </pre><br>  Nous constatons que les donn√©es sont toujours en cours d'√©criture, bien que notre utilisateur n'ait pas le droit d'√©crire dans le fichier.  Essayons de le supprimer: <br><br><pre> <code class="bash hljs">[user@localhost ]$ sudo rm 123.txt [user@localhost ]$ ls 123.txt ls: cannot access 123.txt: No such file or directory</code> </pre><br>  O√π sont √©crites les donn√©es?  Et sont-ils √©crits du tout?  Nous v√©rifions: <br><br><pre> <code class="bash hljs">[user@localhost ]$ ls -la /proc/3762/fd total 0 dr-x------ 2 user user 0 Oct 7 16:29 . dr-xr-xr-x 9 user user 0 Oct 7 16:29 .. lrwx------ 1 user user 64 Oct 7 16:29 0 -&gt; /dev/pts/22 lrwx------ 1 user user 64 Oct 7 16:29 1 -&gt; /dev/pts/22 lrwx------ 1 user user 64 Oct 7 16:29 2 -&gt; /dev/pts/22 l-wx------ 1 user user 64 Oct 7 16:29 3 -&gt; /home/user/123.txt (deleted)</code> </pre><br>  Oui, notre fichier descripteur existe toujours, et nous pouvons travailler avec ce fichier descripteur comme avec notre ancien fichier, nous pouvons le lire, le nettoyer et le copier. <br><br>  Nous regardons la taille du fichier: <br><br><pre> <code class="bash hljs">[user@localhost ]$ lsof | grep 123.txt python 31083 user 3w REG 8,5 19923457 2621522 /home/user/123.txt</code> </pre><br>  Taille du fichier 19923457. Essayer d'effacer le fichier: <br><br><pre> <code class="bash hljs">[user@localhost ]$ truncate -s 0 /proc/31083/fd/3 [user@localhost ]$ lsof | grep 123.txt python 31083 user 3w REG 8,5 136318390 2621522 /home/user/123.txt</code> </pre><br>  Comme vous pouvez le voir, la taille du fichier ne fait qu'augmenter et notre trankate n'a pas fonctionn√©.  Reportez-vous √† la documentation de l'appel syst√®me <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ouvert</a> .  Si, lors de l'ouverture d'un fichier, nous utilisons l'indicateur O_APPEND, chaque fois que le syst√®me d'exploitation v√©rifie la taille du fichier et √©crit des donn√©es √† la toute fin du fichier, il le fait de mani√®re atomique.  Cela permet √† plusieurs threads ou processus d'√©crire dans le m√™me fichier.  Mais dans notre code, nous n'utilisons pas ce drapeau.  Nous pouvons voir une taille de fichier diff√©rente dans lsof apr√®s trankate uniquement si nous ouvrons le fichier pour un enregistrement suppl√©mentaire, ce qui signifie qu'au lieu de dans notre code <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">"123.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"w"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f:</code> </pre><br>  nous devons mettre <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">"123.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"a"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f:</code> </pre><br>  V√©rification avec le drapeau ¬´w¬ª <br><br><pre> <code class="bash hljs">[user@localhost ]$ strace -e trace=open python openforwrite.py 2&gt;&amp;1| grep 123.txt open(<span class="hljs-string"><span class="hljs-string">"123.txt"</span></span>, O_WRONLY|O_CREAT|O_TRUNC, 0666) = 3</code> </pre><br>  et avec le drapeau "a" <br><br><pre> <code class="bash hljs">[user@localhost ]$ strace -e trace=open python openforwrite.py 2&gt;&amp;1| grep 123.txt open(<span class="hljs-string"><span class="hljs-string">"123.txt"</span></span>, O_WRONLY|O_CREAT|O_APPEND, 0666) = 3</code> </pre><br><h3>  Programmer un processus d√©j√† en cours </h3><br>  Souvent, les programmeurs utilisent des d√©bogueurs (par exemple GDB) ou diff√©rents niveaux de journalisation dans l'application lors de la cr√©ation et du test de programmes.  Linux offre la possibilit√© d'√©crire et de modifier r√©ellement un programme d√©j√† en cours d'ex√©cution, par exemple, en modifiant les valeurs des variables, en d√©finissant un point d'arr√™t, etc., etc. <br><br>  Revenant √† la question d'origine avec un espace disque insuffisant pour √©crire le fichier, nous allons essayer d'√©muler le probl√®me. <br><br>  Cr√©ez un fichier pour notre partition, que nous monterons comme un disque s√©par√©: <br><br><pre> <code class="bash hljs">[user@localhost ~]$ dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=/dev/zero of=~/tempfile_for_article.dd bs=1M count=10 10+0 records <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 10+0 records out 10485760 bytes (10 MB) copied, 0.00525929 s, 2.0 GB/s [user@localhost ~]$</code> </pre><br>  Cr√©ez un syst√®me de fichiers: <br><br><pre> <code class="bash hljs">[user@localhost ~]$ mkfs.ext4 ~/tempfile_for_article.dd mke2fs 1.42.9 (28-Dec-2013) /home/user/tempfile_for_article.dd is not a block special device. Proceed anyway? (y,n) y ... Writing superblocks and filesystem accounting information: <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> [user@localhost ~]$</code> </pre><br>  Montez le syst√®me de fichiers: <br><br><pre> <code class="bash hljs">[user@localhost ~]$ sudo mount ~/tempfile_for_article.dd /mnt/ [sudo] password <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> user: [user@localhost ~]$ df -h | grep mnt /dev/loop0 8.7M 172K 7.9M 3% /mnt</code> </pre><br>  Cr√©ez un annuaire avec notre propri√©taire: <br><br><pre> <code class="bash hljs">[user@localhost ~]$ sudo mkdir /mnt/logs [user@localhost ~]$ sudo chown user: /mnt/logs</code> </pre><br>  Nous ouvrons le fichier en √©criture uniquement dans notre programme: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">"/mnt/logs/123.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"w"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f:</code> </pre><br>  Nous lan√ßons <br><br><pre> <code class="bash hljs">[user@localhost ]$ python openforwrite.py</code> </pre><br>  Attendre quelques secondes <br><br><pre> <code class="bash hljs">[user@localhost ~]$ df -h | grep mnt /dev/loop0 8.7M 8.0M 0 100% /mnt</code> </pre><br>  Nous avons donc rencontr√© le probl√®me d√©crit au d√©but de cet article.  Espace libre 0, occup√© √† 100%. <br><br>  Nous nous souvenons que selon les conditions de la t√¢che, nous essayons d'enregistrer des donn√©es tr√®s importantes qui ne peuvent pas √™tre perdues.  Et en m√™me temps, nous devons r√©parer le service sans red√©marrer le processus. <br><br>  Supposons que nous ayons encore de l'espace disque, mais dans une partition diff√©rente, par exemple dans / home. <br><br>  Essayons de "reprogrammer √† la vol√©e" notre code. <br><br>  Nous regardons le PID de notre processus, qui a consomm√© tout l'espace disque: <br><br><pre> <code class="bash hljs">[user@localhost ~]$ ps axuf | grep [o]penfor user 10078 27.2 0.0 128600 5744 pts/22 R+ 11:06 0:02 | \_ python openforwrite.py</code> </pre><br>  Nous nous connectons au processus via gdb <br><br><pre> <code class="bash hljs">[user@localhost ~]$ gdb -p 10078 ... (gdb)</code> </pre><br>  Nous regardons les descripteurs de fichiers ouverts: <br><br><pre> <code class="bash hljs">(gdb) shell ls -lah /proc/10078/fd/ total 0 dr-x------ 2 user user 0 Oct 8 11:06 . dr-xr-xr-x 9 user user 0 Oct 8 11:06 .. lrwx------ 1 user user 64 Oct 8 11:09 0 -&gt; /dev/pts/22 lrwx------ 1 user user 64 Oct 8 11:09 1 -&gt; /dev/pts/22 lrwx------ 1 user user 64 Oct 8 11:06 2 -&gt; /dev/pts/22 l-wx------ 1 user user 64 Oct 8 11:09 3 -&gt; /mnt/logs/123.txt</code> </pre><br>  Nous regardons les informations sur le descripteur de fichier avec le num√©ro 3, ce qui nous int√©resse <br><br><pre> <code class="bash hljs">(gdb) shell cat /proc/10078/fdinfo/3 pos: 8189952 flags: 0100001 mnt_id: 482</code> </pre><br>  En se souvenant du type d'appel syst√®me que Python fait (voir ci-dessus, o√π nous avons ex√©cut√© strace et trouv√© l'appel ouvert), en traitant notre code pour ouvrir le fichier, nous faisons la m√™me chose en notre nom, mais nous avons besoin des bits O_WRONLY | O_CREAT | O_TRUNC remplacer par une valeur num√©rique.  Pour ce faire, ouvrez les sources du noyau, par exemple, <a href="">ici</a> et voyez quels drapeaux sont responsables de quoi <br><br>  #define O_WRONLY 00000001 <br>  #define O_CREAT 00000100 <br>  #define O_TRUNC 00001000 <br><br>  Nous combinons toutes les valeurs en une seule, nous obtenons 00001101 <br><br>  Ex√©cutez notre appel depuis gdb <br><br><pre> <code class="bash hljs">(gdb) call open(<span class="hljs-string"><span class="hljs-string">"/home/user/123.txt"</span></span>, 00001101,0666) <span class="hljs-variable"><span class="hljs-variable">$1</span></span> = 4</code> </pre><br>  Nous avons donc obtenu un nouveau fichier descripteur avec le num√©ro 4 et un nouveau fichier ouvert sur une autre section, v√©rifiez: <br><br><pre> <code class="bash hljs">(gdb) shell ls -lah /proc/10078/fd/ total 0 dr-x------ 2 user user 0 Oct 8 11:06 . dr-xr-xr-x 9 user user 0 Oct 8 11:06 .. lrwx------ 1 user user 64 Oct 8 11:09 0 -&gt; /dev/pts/22 lrwx------ 1 user user 64 Oct 8 11:09 1 -&gt; /dev/pts/22 lrwx------ 1 user user 64 Oct 8 11:06 2 -&gt; /dev/pts/22 l-wx------ 1 user user 64 Oct 8 11:09 3 -&gt; /mnt/logs/123.txt l-wx------ 1 user user 64 Oct 8 11:15 4 -&gt; /home/user/123.txt</code> </pre><br>  Nous nous souvenons de l'exemple de pipe - comment bash change les descripteurs de fichiers, et nous avons d√©j√† appris l'appel syst√®me dup2. <br><br>  Nous essayons de remplacer un descripteur de fichier par un autre <br><br><pre> <code class="bash hljs">(gdb) call dup2(4,3) <span class="hljs-variable"><span class="hljs-variable">$2</span></span> = 3</code> </pre><br>  Nous v√©rifions: <br><br><pre> <code class="bash hljs">(gdb) shell ls -lah /proc/10078/fd/ total 0 dr-x------ 2 user user 0 Oct 8 11:06 . dr-xr-xr-x 9 user user 0 Oct 8 11:06 .. lrwx------ 1 user user 64 Oct 8 11:09 0 -&gt; /dev/pts/22 lrwx------ 1 user user 64 Oct 8 11:09 1 -&gt; /dev/pts/22 lrwx------ 1 user user 64 Oct 8 11:06 2 -&gt; /dev/pts/22 l-wx------ 1 user user 64 Oct 8 11:09 3 -&gt; /home/user/123.txt l-wx------ 1 user user 64 Oct 8 11:15 4 -&gt; /home/user/123.txt</code> </pre><br>  Nous fermons le descripteur de fichier 4, car nous n'en avons pas besoin: <br><br><pre> <code class="bash hljs">(gdb) call close (4) <span class="hljs-variable"><span class="hljs-variable">$1</span></span> = 0</code> </pre><br>  Et quittez gdb <br><br><pre> <code class="bash hljs">(gdb) quit A debugging session is active. Inferior 1 [process 10078] will be detached. Quit anyway? (y or n) y Detaching from program: /usr/bin/python2.7, process 10078</code> </pre><br>  V√©rifiez le nouveau fichier: <br><br><pre> <code class="bash hljs">[user@localhost ~]$ ls -lah /home/user/123.txt -rw-rw-r-- 1 user user 5.1M Oct 8 11:18 /home/user/123.txt [user@localhost ~]$ ls -lah /home/user/123.txt -rw-rw-r-- 1 user user 7.1M Oct 8 11:18 /home/user/123.txt</code> </pre><br>  Comme vous pouvez le voir, les donn√©es sont √©crites dans un nouveau fichier, nous v√©rifions l'ancien: <br><br><pre> <code class="bash hljs">[user@localhost ~]$ ls -lah /mnt/logs/123.txt -rw-rw-r-- 1 user user 7.9M Oct 8 11:08 /mnt/logs/123.txt</code> </pre><br>  Les donn√©es ne sont pas perdues, l'application fonctionne, les journaux sont √©crits dans un nouvel emplacement. <br><br><h3>  Compliquons un peu la t√¢che </h3><br>  Imaginez que les donn√©es soient importantes pour nous, mais nous n'avons pas d'espace disque dans aucune des sections et nous ne pouvons pas connecter le disque. <br><br>  Ce que nous pouvons faire, c'est rediriger nos donn√©es quelque part, par exemple vers le tube, et les donn√©es du tube, √† leur tour, sont redirig√©es vers le r√©seau via un programme, par exemple netcat. <br>  Nous pouvons cr√©er un canal nomm√© avec la commande mkfifo.  Il cr√©era un pseudo-fichier sur le syst√®me de fichiers, m√™me s'il n'y a pas d'espace libre dessus. <br><br>  Nous red√©marrons l'application et v√©rifions: <br><br><pre> <code class="bash hljs">[user@localhost ]$ python openforwrite.py [user@localhost ~]$ ps axuf | grep [o]pen user 5946 72.9 0.0 128600 5744 pts/22 R+ 11:27 0:20 | \_ python openforwrite.py [user@localhost ~]$ ls -lah /proc/5946/fd total 0 dr-x------ 2 user user 0 Oct 8 11:27 . dr-xr-xr-x 9 user user 0 Oct 8 11:27 .. lrwx------ 1 user user 64 Oct 8 11:28 0 -&gt; /dev/pts/22 lrwx------ 1 user user 64 Oct 8 11:28 1 -&gt; /dev/pts/22 lrwx------ 1 user user 64 Oct 8 11:27 2 -&gt; /dev/pts/22 l-wx------ 1 user user 64 Oct 8 11:28 3 -&gt; /mnt/logs/123.txt [user@localhost ~]$ df -h | grep mnt /dev/loop0 8.7M 8.0M 0 100% /mnt</code> </pre><br>  Il n'y a pas d'espace disque, mais nous y avons r√©ussi √† cr√©er un canal nomm√©: <br><br><pre> <code class="bash hljs">[user@localhost ~]$ mkfifo /mnt/logs/megapipe [user@localhost ~]$ ls -lah /mnt/logs/megapipe prw-rw-r-- 1 user user 0 Oct 8 11:28 /mnt/logs/megapipe</code> </pre><br>  Maintenant, nous devons en quelque sorte envelopper toutes les donn√©es qui entrent dans ce canal vers un autre serveur via le r√©seau, pour cela, tout le m√™me netcat fera. <br><br>  Sur le serveur remote-server.example.com, ex√©cutez <br><br><pre> <code class="bash hljs">[user@localhost ~]$ nc -l 7777 &gt; 123.txt</code> </pre><br>  Sur notre serveur √† probl√®mes, ex√©cutez dans un terminal s√©par√© <br><br><pre> <code class="bash hljs">[user@localhost ~]$ nc remote-server.example.com 7777 &lt; /mnt/logs/megapipe</code> </pre><br>  Maintenant, toutes les donn√©es qui entrent dans le canal iront automatiquement √† stdin dans netcat, qui les enverra au r√©seau sur le port 7777. <br><br>  Tout ce que nous avons √† faire est de commencer √† √©crire nos donn√©es dans ce canal nomm√©. <br><br>  Nous avons d√©j√† une application en cours d'ex√©cution: <br><br><pre> <code class="bash hljs">[user@localhost ~]$ ps axuf | grep [o]pen user 5946 99.8 0.0 128600 5744 pts/22 R+ 11:27 169:27 | \_ python openforwrite.py [user@localhost ~]$ ls -lah /proc/5946/fd total 0 dr-x------ 2 user user 0 Oct 8 11:27 . dr-xr-xr-x 9 user user 0 Oct 8 11:27 .. lrwx------ 1 user user 64 Oct 8 11:28 0 -&gt; /dev/pts/22 lrwx------ 1 user user 64 Oct 8 11:28 1 -&gt; /dev/pts/22 lrwx------ 1 user user 64 Oct 8 11:27 2 -&gt; /dev/pts/22 l-wx------ 1 user user 64 Oct 8 11:28 3 -&gt; /mnt/logs/123.txt</code> </pre><br>  De tous les indicateurs, nous n'avons besoin que de O_WRONLY car le fichier existe d√©j√† et nous n'avons pas besoin de l'effacer <br><br><pre> <code class="bash hljs">[user@localhost ~]$ gdb -p 5946 ... (gdb) call open(<span class="hljs-string"><span class="hljs-string">"/mnt/logs/megapipe"</span></span>, 00000001,0666) <span class="hljs-variable"><span class="hljs-variable">$1</span></span> = 4 (gdb) shell ls -lah /proc/5946/fd total 0 dr-x------ 2 user user 0 Oct 8 11:27 . dr-xr-xr-x 9 user user 0 Oct 8 11:27 .. lrwx------ 1 user user 64 Oct 8 11:28 0 -&gt; /dev/pts/22 lrwx------ 1 user user 64 Oct 8 11:28 1 -&gt; /dev/pts/22 lrwx------ 1 user user 64 Oct 8 11:27 2 -&gt; /dev/pts/22 l-wx------ 1 user user 64 Oct 8 11:28 3 -&gt; /mnt/logs/123.txt l-wx------ 1 user user 64 Oct 8 14:20 4 -&gt; /mnt/logs/megapipe (gdb) call dup2(4,3) <span class="hljs-variable"><span class="hljs-variable">$2</span></span> = 3 (gdb) shell ls -lah /proc/5946/fd total 0 dr-x------ 2 user user 0 Oct 8 11:27 . dr-xr-xr-x 9 user user 0 Oct 8 11:27 .. lrwx------ 1 user user 64 Oct 8 11:28 0 -&gt; /dev/pts/22 lrwx------ 1 user user 64 Oct 8 11:28 1 -&gt; /dev/pts/22 lrwx------ 1 user user 64 Oct 8 11:27 2 -&gt; /dev/pts/22 l-wx------ 1 user user 64 Oct 8 11:28 3 -&gt; /mnt/logs/megapipe l-wx------ 1 user user 64 Oct 8 14:20 4 -&gt; /mnt/logs/megapipe (gdb) call close(4) <span class="hljs-variable"><span class="hljs-variable">$3</span></span> = 0 (gdb) shell ls -lah /proc/5946/fd total 0 dr-x------ 2 user user 0 Oct 8 11:27 . dr-xr-xr-x 9 user user 0 Oct 8 11:27 .. lrwx------ 1 user user 64 Oct 8 11:28 0 -&gt; /dev/pts/22 lrwx------ 1 user user 64 Oct 8 11:28 1 -&gt; /dev/pts/22 lrwx------ 1 user user 64 Oct 8 11:27 2 -&gt; /dev/pts/22 l-wx------ 1 user user 64 Oct 8 11:28 3 -&gt; /mnt/logs/megapipe (gdb) quit A debugging session is active. Inferior 1 [process 5946] will be detached. Quit anyway? (y or n) y Detaching from program: /usr/bin/python2.7, process 5946</code> </pre><br>  V√©rification du serveur distant remote-server.example.com <br><br><pre> <code class="bash hljs">[user@localhost ~]$ ls -lah 123.txt -rw-rw-r-- 1 user user 38M Oct 8 14:21 123.txt</code> </pre><br>  Les donn√©es vont, nous v√©rifions un serveur probl√®me <br><br><pre> <code class="bash hljs">[user@localhost ~]$ ls -lah /mnt/logs/ total 7.9M drwxr-xr-x 2 user user 1.0K Oct 8 11:28 . drwxr-xr-x 4 root root 1.0K Oct 8 10:55 .. -rw-rw-r-- 1 user user 7.9M Oct 8 14:17 123.txt prw-rw-r-- 1 user user 0 Oct 8 14:22 megapipe</code> </pre><br>  Donn√©es enregistr√©es, probl√®me r√©solu. <br><br>  J'en profite pour transmettre mes salutations √† mes coll√®gues de Degiro. <br>  √âcoutez les podcasts de Radio T. <br><br>  Bon √† tous. <br><br>  En guise de devoirs, je propose de penser √† ce qui sera dans les descripteurs de fichiers du processus chat et sleep si vous ex√©cutez cette commande: <br><br><pre> <code class="bash hljs">[user@localhost ~]$ cat /dev/zero 2&gt;/dev/null| sleep 10000</code> </pre></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr471038/">https://habr.com/ru/post/fr471038/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr471026/index.html">TypeScript Puissance jamais</a></li>
<li><a href="../fr471028/index.html">Chariot de camion ROS. Partie 6. Odom√©trie avec encodeurs de roue, plan de salle, lidar</a></li>
<li><a href="../fr471032/index.html">Photo invisible</a></li>
<li><a href="../fr471034/index.html">Entretien avec Pornhub Web Developer</a></li>
<li><a href="../fr471036/index.html">Vivez et apprenez. Partie 5. Auto-√©ducation: ressaisissez-vous</a></li>
<li><a href="../fr471040/index.html">[signet] Version PDF et ePUB du manuel React</a></li>
<li><a href="../fr471042/index.html">R√©solution de probl√®mes avec pwnable.kr 25 - otp. Limite de taille de fichier Linux</a></li>
<li><a href="../fr471044/index.html">Sass MediaScreen - D√©finition des p√©riph√©riques CSS</a></li>
<li><a href="../fr471046/index.html">Avalonia √©l√©gant</a></li>
<li><a href="../fr471048/index.html">React + Mobx: √† quoi √ßa sert?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>