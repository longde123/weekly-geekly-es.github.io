<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõë üõÄüèº üîû PHP GR8: Verbessert JIT die Leistung von PHP 8 ‚ñ™Ô∏è üéÄ ü§µüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PHP ist eine der wichtigsten Entwicklungssprachen bei Badoo. In unseren Rechenzentren sind Tausende von Prozessorkernen damit besch√§ftigt, Millionen v...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PHP GR8: Verbessert JIT die Leistung von PHP 8</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/448622/"><img src="https://habrastorage.org/webt/bw/fj/lk/bwfjlk2iy2btywbt8rqmlsok_-i.jpeg"><br><br>  <i>PHP ist eine der wichtigsten Entwicklungssprachen bei Badoo.</i>  <i>In unseren Rechenzentren sind Tausende von Prozessorkernen damit besch√§ftigt, Millionen von Zeilen PHP-Code auszuf√ºhren.</i>  <i>Wir verfolgen die Nachrichten genau und suchen aktiv nach M√∂glichkeiten zur Verbesserung der Produktivit√§t, da bereits eine geringf√ºgige Optimierung unserer Mengen zu erheblichen Ressourceneinsparungen f√ºhrt.</i>  <i>Eine der wichtigsten Neuigkeiten zur PHP-Leistung ist das Erscheinen von JIT in der achten Version der Sprache.</i>  <i>Dies konnte nat√ºrlich nicht ohne unsere Aufmerksamkeit bleiben, und wir √ºbersetzten einen Artikel dar√ºber, was JIT ist, wie es in PHP implementiert wird, warum es beschlossen wurde und was von ihm zu erwarten ist.</i> <br><br>  Wenn Sie die H√∂hle nicht verlassen haben oder nicht aus der Vergangenheit stammen (in diesem Fall willkommen), wissen Sie bereits, dass PHP 8 JIT haben wird: Neulich war die Abstimmung ruhig und friedlich und die √ºberwiegende Mehrheit der Teilnehmer stimmte f√ºr die Implementierung. Das ist also alles entschieden . <br><br>  In einem Anfall von Freude k√∂nnen Sie sogar mehrere verr√ºckte Bewegungen wie auf dem Foto darstellen (dies wird √ºbrigens als "Detroit JIT" bezeichnet: <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/ip/gp/gk/ipgpgk3stro-ora0on1jhgbxg-y.jpeg"><br><br>  Setzen Sie sich jetzt und lesen Sie diesen Mythos entlarvenden Artikel.  Ich m√∂chte das Missverst√§ndnis kl√§ren, das damit verbunden ist, was JIT ist und wie es n√ºtzlich ist, und dar√ºber sprechen, wie es funktioniert (aber nicht zu detailliert, damit Sie sich nicht langweilen). <br><br>  Da ich nicht wei√ü, wer den Artikel lesen wird, gehe ich von einfachen zu komplexen Fragen √ºber.  Wenn Sie die Antwort auf die Frage im Titel bereits kennen, k√∂nnen Sie das entsprechende Kapitel sicher √ºberspringen. <br><br><h1>  Was ist JIT? </h1><br>  PHP wird auf Basis einer virtuellen Maschine implementiert (wir nennen es Zend VM).  Die Sprache kompiliert den PHP-Quellcode in Anweisungen, die die virtuelle Maschine versteht (dies wird als Kompilierungsphase bezeichnet).  Die in der Kompilierungsphase erhaltenen Anweisungen f√ºr virtuelle Maschinen werden als Opcodes bezeichnet.  Zur Laufzeit f√ºhrt die Zend VM die Opcodes aus und f√ºhrt damit die erforderliche Arbeit aus. <br><br>  Diese Schaltung funktioniert super.  Dar√ºber hinaus speichern Tools wie APC (vorher) und OpCache (heute) die Ergebnisse der Kompilierungsphase zwischen, sodass diese Phase nur bei Bedarf ausgef√ºhrt wird. <br><br>  Kurz gesagt, JIT ist eine Just-in-Time-Kompilierungsstrategie (zum richtigen Zeitpunkt), bei der der Code zun√§chst in eine Zwischendarstellung √ºbersetzt wird, die dann w√§hrend der Ausf√ºhrung in einen architekturabh√§ngigen Maschinencode umgewandelt wird. <br><br>  In PHP bedeutet dies, dass JIT die Anweisungen f√ºr die virtuelle Maschine, die in der Kompilierungsphase empfangen wurden, als Zwischendarstellung betrachtet und Maschinencode ausgibt, der nicht mehr von der Zend VM, sondern direkt vom Prozessor ausgef√ºhrt wird. <br><br><h1>  Warum braucht PHP JIT? </h1><br>  Kurz vor dem Aufkommen von PHP 7.0 lag der Schwerpunkt des PHP-Teams auf der Sprachleistung.  Die meisten wesentlichen √Ñnderungen in PHP 7.0 betrafen den PHPNG-Patch, der die Art und Weise, wie PHP Speicher und Prozessor verwendet, erheblich verbesserte.  Seitdem muss jeder von uns einen Blick auf die Leistung der Sprache werfen. <br><br>  Nach der Ver√∂ffentlichung von PHP 7.0 wurden die Leistungsverbesserungen fortgesetzt: Eine Hash-Tabelle (die Hauptdatenstruktur in PHP) wurde optimiert, die Spezialisierung bestimmter Opcodes in Zend VM und die Spezialisierung bestimmter Sequenzen im Compiler wurden implementiert, das Optimierungsprogramm (OpCache-Komponente) wurde st√§ndig verbessert und viele andere √Ñnderungen wurden implementiert. <br><br>  Die harte Wahrheit ist, dass wir uns aufgrund all dieser Optimierungen schnell der Grenze der M√∂glichkeiten zur Produktivit√§tsverbesserung n√§hern. <br><br>  Bitte beachten Sie: Mit ‚ÄûBegrenzung der Verbesserungsm√∂glichkeiten‚Äú meine ich die Tatsache, dass die Kompromisse, die f√ºr weitere Verbesserungen getroffen werden m√ºssen, nicht mehr attraktiv aussehen.  Wenn es um die Optimierung der Leistung geht, sprechen wir immer √ºber Kompromisse.  Oft m√ºssen wir aus Gr√ºnden der Produktivit√§t auf Einfachheit verzichten.  Jeder w√ºrde gerne denken, dass der einfachste Code auch der schnellste ist, aber in der modernen Welt der C-Programmierung ist dies nicht der Fall.  Am schnellsten ist der Code, der bereit ist, die interne Struktur der Architektur oder die in die Plattform / den Compiler integrierten Strukturen zu nutzen.  Einfachheit allein garantiert keine bessere Leistung. <br><br>  Daher ist zu diesem Zeitpunkt die Implementierung von JIT der beste Weg, um noch mehr Leistung aus PHP herauszuholen. <br><br><h1>  Wird JIT meine Website beschleunigen? </h1><br>  H√∂chstwahrscheinlich unbedeutend. <br><br>  Dies ist m√∂glicherweise nicht die Antwort, die Sie erwartet haben.  Tatsache ist, dass PHP-Anwendungen im Allgemeinen durch Eingabe / Ausgabe (E / A-gebunden) begrenzt sind und JIT am besten mit Code funktioniert, der durch den Prozessor begrenzt ist (CPU-gebunden). <br><br><h1>  Was bedeutet "durch E / A und Prozessor begrenzt"? </h1><br>  Um die Merkmale der Gesamtleistung eines Codes oder einer Anwendung zu beschreiben, verwenden wir die Begriffe "begrenzt durch Eingabe-Ausgabe" und "begrenzt durch Prozessor". <br><br>  Die einfachste Definition: <br><br><ul><li>  Durch E / A begrenzter Code funktioniert viel schneller, wenn wir einen Weg finden, die durchgef√ºhrten E / A-Operationen zu verbessern (zu reduzieren, zu optimieren). <br></li><li>  Prozessor-begrenzter Code funktioniert viel schneller, wenn wir einen Weg finden, die vom Prozessor ausgef√ºhrten Anweisungen zu verbessern (zu reduzieren, zu optimieren) oder die Prozessortaktrate auf magische Weise zu erh√∂hen. <br></li></ul><br>  Code und Anwendung k√∂nnen durch E / A, Prozessor oder beides eingeschr√§nkt werden. <br><br>  Im Allgemeinen sind PHP-Anwendungen in der Regel durch E / A eingeschr√§nkt: Ihr Hauptengpass sind h√§ufig E / A-Vorg√§nge - Verbinden, Lesen und Schreiben in die Datenbank, Caches, Dateien, Sockets usw. <br><br><h1>  Wie sieht prozessorbeschr√§nkter PHP-Code aus? </h1><br>  M√∂glicherweise sind einige PHP-Programmierer aufgrund der Natur der meisten PHP-Anwendungen neu in prozessorbeschr√§nktem Code: Sie fungieren normalerweise als Verkn√ºpfung zur Datenbank oder zum Cache, erfassen und produzieren kleine Mengen von HTML / JSON / XML-Antworten. <br><br>  Sie k√∂nnen sich Ihre Codebasis ansehen und viel Code finden, der nichts mit E / A zu tun hat. Code, der Funktionen aufruft, die nichts mit E / A zu tun haben.  Und Sie k√∂nnen verwirrt sein, dass dies Ihre Anwendung nicht durch den Prozessor einschr√§nkt, obwohl der Code mehr Zeilen enth√§lt, die nicht mit E / A funktionieren als funktionieren. <br><br>  Tatsache ist, dass PHP eine der am schnellsten interpretierten Sprachen ist.  Es gibt keinen merklichen Unterschied zwischen dem Aufrufen einer Funktion, die keine E / A in Zend VM verwendet, und im Maschinencode.  Nat√ºrlich gibt es einige Unterschiede, aber sowohl der Maschinencode als auch die Zend-VM verwenden die Aufrufkonvention. Es spielt also keine Rolle, <code>-___()</code> Sie <code>-___()</code> in den Opcodes oder im Maschinencode <code>-___()</code> - dies hat keine sp√ºrbaren Auswirkungen auf die Leistung der gesamten Anwendung, die den Anruf t√§tigt. <br><br>  <i>Hinweis: In einfachen Worten ist eine Aufrufkonvention eine Folge von Anweisungen, die <b>vor der</b> Eingabe einer anderen Funktion ausgef√ºhrt werden.</i>  <i>In beiden F√§llen √ºbergibt die aufrufende Konvention Argumente an den Stapel.</i> <br><br>  Sie fragen: "Was ist mit Loops, Tail Calls und mehr?"  PHP ist intelligent genug - und wenn Optimizer von OpCache aktiviert ist, wird Ihr Code auf magische Weise in eine effizientere Version Ihrer Texte konvertiert. <br><br>  Hierbei ist zu beachten, dass JIT die Zend VM-Aufrufkonventionen nicht √§ndert.  Dies geschieht, weil PHP jederzeit zwischen JIT- und VM-Modus wechseln kann (daher haben sie beschlossen, die aktuellen Konventionen beizubehalten).  Infolgedessen funktionieren Anrufe, die Sie √ºberall mit JIT sehen, nicht viel schneller. <br><br>  Wenn Sie sehen m√∂chten, wie prozessorbeschr√§nkter PHP-Code aussieht, schauen Sie hier: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/php/php-src/blob/master/Zend/bench.php</a> .  Dies ist ein extremes Beispiel, aber es zeigt, dass die ganze Pracht der JIT in der Mathematik offenbart wird. <br><br><h1>  Musste einen so extremen Kompromiss eingehen, um mathematische Berechnungen in PHP zu beschleunigen? </h1><br>  Nein.  Wir haben dies getan, um den Anwendungsbereich der Sprache zu erweitern (und signifikant zu erweitern). <br><br>  Wir wollen nicht prahlen, aber PHP dominiert das Web.  Wenn Sie sich mit Webentwicklung besch√§ftigen und nicht in Betracht ziehen, PHP in Ihrem n√§chsten Projekt zu verwenden, dann machen Sie etwas falsch (laut einem sehr voreingenommenen PHP-Entwickler). <br><br>  Auf den ersten Blick scheint die Beschleunigung mathematischer Berechnungen in PHP eine sehr enge Anwendung zu haben.  Dies er√∂ffnet uns jedoch beispielsweise den Weg zum maschinellen Lernen, 3D-Rendering, 2D-Rendering (GUI) und Datenanalyse. <br><br><h1>  Warum kann dies nicht in PHP 7.4 implementiert werden? </h1><br>  Oben habe ich JIT als extremen Kompromiss bezeichnet, und ich denke wirklich: Dies ist eine der schwierigsten Kompilierungsstrategien unter allen existierenden, wenn nicht die schwierigste.  Die Implementierung von JIT erh√∂ht die Komplexit√§t erheblich. <br><br>  Wenn Sie Dmitry, den Autor von JIT, fragen, ob er PHP kompliziert gemacht hat, antwortet er: ‚ÄûNein, ich hasse Komplexit√§t‚Äú (dies ist ein Zitat). <br><br>  Im Wesentlichen bedeutet "komplex" "das, was wir nicht verstehen".  Und heute verstehen nur wenige Sprachentwickler die bestehende Implementierung von JIT wirklich. <br><br>  Die Arbeit an PHP 7.4 schreitet z√ºgig voran, und die Einf√ºhrung von JIT in dieser Version wird dazu f√ºhren, dass nur wenige die Sprache debuggen, reparieren und verbessern k√∂nnen.  Dies ist nicht akzeptabel f√ºr diejenigen, die in PHP 7.4 gegen JIT gestimmt haben. <br><br>  Vor der Ver√∂ffentlichung von PHP 8 werden viele von uns die JIT-Implementierung verstehen.  Es gibt Funktionen, die wir implementieren m√∂chten, und Tools, die wir f√ºr die achte Version neu schreiben m√∂chten. Daher m√ºssen wir zuerst die JIT verstehen.  Wir brauchen diese Zeit und sind sehr dankbar, dass die Mehrheit daf√ºr gestimmt hat, sie uns zu geben. <br><br>  Komplex ist nicht gleichbedeutend mit dem Schrecklichen.  Komplexit√§t kann so sch√∂n sein wie ein Sternnebel, und hier geht es nur um JIT.  Mit anderen Worten, selbst wenn 20 Personen in unserem Team beginnen, JIT nicht schlechter als Dmitry zu verstehen, wird dies die Komplexit√§t der Natur von JIT nicht √§ndern. <br><br><h1>  Wird sich die PHP-Entwicklung verlangsamen? </h1><br>  Es gibt keinen Grund, dies zu glauben.  Wir haben genug Zeit, daher kann argumentiert werden, dass es bis zur Fertigstellung von PHP 8 genug unter uns geben wird, die JIT genug beherrschen, um nicht weniger effizient als heute zu arbeiten, wenn es darum geht, Fehler zu beheben und PHP zu entwickeln. <br><br>  Wenn Sie versuchen, dies mit der Idee der urspr√ºnglichen Komplexit√§t von JIT in Verbindung zu bringen, denken Sie daran, dass die meiste Zeit, die wir f√ºr die Einf√ºhrung neuer Funktionen aufwenden, damit verbracht wird, diese zu diskutieren.  Wenn Sie an Funktionen arbeiten und Fehler beheben, dauert das Schreiben eines Codes meistens Minuten oder Stunden, und Diskussionen dauern Wochen oder Monate.  In seltenen F√§llen muss der Code stunden- oder tagelang geschrieben werden, aber selbst dann dauern Diskussionen immer l√§nger. <br><br>  Das ist alles was ich sagen wollte. <br><br><blockquote>  Und da wir √ºber Leistung sprechen, lade ich meinen Kollegen Pavel Murzakov zu dem Bericht am 17. Mai auf der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PHP Russia-</a> Konferenz ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">.</a>  Pascha wei√ü, wie man die letzte CPU-Sekunde aus dem PHP-Code herausdr√ºckt! </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de448622/">https://habr.com/ru/post/de448622/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de448606/index.html">Sidorin: Bei KnowledgeConf geht es darum, wie Wissen mit einer durchschnittlichen Arbeitsdauer an einem Ort in 2-3 Jahren aufrechterhalten werden kann</a></li>
<li><a href="../de448608/index.html">Wie mache ich die ersten Schritte in der Robotik?</a></li>
<li><a href="../de448610/index.html">DIY: Wie wir einen Live-Zeitplan f√ºr Codefest X erstellt haben</a></li>
<li><a href="../de448612/index.html">Was beim Feature Freeze 2019 eingefroren wurde. Teil I. JSONPath</a></li>
<li><a href="../de448618/index.html">Douglas-Pecker-Algorithmus</a></li>
<li><a href="../de448624/index.html">Daten anzeigen? Nein. Also ich sehe nicht, aber sie sind. Wir zerst√∂ren Daten auf SSD-Laufwerken und stellen sogar die Geschwindigkeit wieder her</a></li>
<li><a href="../de448626/index.html">DDoS hilft: wie wir Stress und Stresstests durchf√ºhren</a></li>
<li><a href="../de448628/index.html">Sowjetische technische √Ñsthetik und Technologie</a></li>
<li><a href="../de448632/index.html">Java ist jetzt bezahlt? Ger√ºchte entlarven (oder nicht?)</a></li>
<li><a href="../de448634/index.html">Ukrainischunterricht</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>