<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∏üèΩ üåª üë©üèª‚Äç‚úàÔ∏è Arquitectura de IU de componentes en la aplicaci√≥n iOS üö¢ üë©üèΩ‚Äçüöí üë®üèΩ‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! 

 Mi nombre es Valera, y durante dos a√±os he estado desarrollando una aplicaci√≥n para iOS como parte del equipo de Badoo. Una de nuestras ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arquitectura de IU de componentes en la aplicaci√≥n iOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/421559/"><img src="https://habrastorage.org/webt/x8/bs/so/x8bsso8hy3rdfn3ostzyohesvyc.jpeg"><br><br>  Hola Habr! <br><br>  Mi nombre es Valera, y durante dos a√±os he estado desarrollando una aplicaci√≥n para iOS como parte del equipo de Badoo.  Una de nuestras prioridades es el c√≥digo f√°cil de mantener.  Debido a la gran cantidad de nuevas caracter√≠sticas que caen en nuestras manos semanalmente, primero debemos pensar en la arquitectura de la aplicaci√≥n, de lo contrario ser√° extremadamente dif√≠cil agregar una nueva caracter√≠stica al producto sin romper las existentes.  Obviamente, esto tambi√©n se aplica a la implementaci√≥n de la interfaz de usuario (UI) independientemente de si esto se hace usando c√≥digo, Xcode (XIB) o un enfoque mixto.  En este art√≠culo describir√© algunas t√©cnicas de implementaci√≥n de UI que nos permiten simplificar el desarrollo de la interfaz de usuario, haci√©ndola flexible y conveniente para las pruebas.  Tambi√©n hay una versi√≥n en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ingl√©s</a> de este art√≠culo. <br><br><h2>  Antes de comenzar ... </h2><br>  Considerar√© las t√©cnicas de implementaci√≥n de la interfaz de usuario utilizando una aplicaci√≥n de ejemplo escrita en Swift.  La aplicaci√≥n con solo hacer clic en un bot√≥n muestra una lista de amigos. <br><br>  Consta de tres partes: <br><br><ol><li>  <b>Los componentes</b> son componentes de interfaz de usuario personalizados, es decir, c√≥digo relacionado solo con la interfaz de usuario. </li><li>  <b>Aplicaci√≥n de</b> demostraci√≥n: modelos de vista de demostraci√≥n y otras entidades de interfaz de usuario que solo tienen dependencias de la interfaz de usuario. </li><li>  <b>La aplicaci√≥n real</b> es ver modelos y otras entidades que pueden contener dependencias espec√≠ficas y l√≥gica. </li></ol><br>  ¬øPor qu√© hay tal separaci√≥n?  Contestar√© esta pregunta a continuaci√≥n, pero por ahora, consulte la interfaz de usuario de nuestra aplicaci√≥n: <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nr/vt/gl/nrvtglcxbhadi2ag4ohcuazdhqk.gif" height="600"></div><br>  Esta es una vista emergente con contenido encima de otra vista de pantalla completa.  Todo es simple <br><br>  El c√≥digo fuente completo del proyecto est√° disponible en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GitHub</a> . <br><br>  Antes de profundizar en el c√≥digo de la interfaz de usuario, quiero presentarles la clase auxiliar Observable utilizada aqu√≠.  Su interfaz se ve as√≠: <br><br><pre><code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> value: <span class="hljs-type"><span class="hljs-type">T</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">observe</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> closure: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"> old: T, </span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"> new: T)</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">ObserverProtocol</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">observeNewAndCall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> closure: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"> new: T)</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">ObserverProtocol</span></span></code> </pre> <br>  Simplemente notifica a todos los observadores firmados previamente de los cambios, por lo que esta es una especie de alternativa a KVO (observaci√≥n de valor clave) o, si lo desea, programaci√≥n reactiva.  Aqu√≠ hay un ejemplo de uso: <br><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.observers.append(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.viewModel.items.observe { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] (_, newItems) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>?.state = newItems.isEmpty ? .zeroCase(type: .empty) : .normal   <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>?.collectionView.reloadSections(IndexSet(integer: <span class="hljs-number"><span class="hljs-number">0</span></span>)) })</code> </pre> <br>  El controlador se suscribe a los cambios en la propiedad <code>self.viewModel.items</code> y, cuando se produce el cambio, el controlador ejecuta la l√≥gica empresarial.  Por ejemplo, actualiza el estado de la vista y vuelve a cargar la vista de la colecci√≥n con nuevos elementos. <br><br>  Ver√° m√°s ejemplos de uso a continuaci√≥n. <br><br><h2>  Metodolog√≠as </h2><br>  En esta secci√≥n hablar√© sobre cuatro t√©cnicas de desarrollo de UI que se usan en Badoo: <br><br>  1. Implementaci√≥n de la interfaz de usuario en c√≥digo. <br><br>  2. Uso de anclajes de dise√±o. <br><br>  3. Componentes: divide y vencer√°s. <br><br>  4. Separaci√≥n de la interfaz de usuario y la l√≥gica. <br><br><h3>  # 1: Implementando la interfaz de usuario en c√≥digo </h3><br>  En Badoo, la mayor√≠a del inter√©s del usuario se implementa en el c√≥digo.  ¬øPor qu√© no usamos XIB o guiones gr√°ficos?  Pregunta justa  La raz√≥n principal es la conveniencia de mantener el c√≥digo para un equipo de tama√±o mediano, a saber: <br><br><ul><li>  los cambios en el c√≥digo son claramente visibles, lo que significa que no hay necesidad de analizar el archivo XML storyboard / XIB para encontrar los cambios realizados por un colega; <br></li><li>  Los sistemas de control de versiones (por ejemplo, Git) son mucho m√°s f√°ciles de trabajar con c√≥digo que con archivos XLM "pesados", especialmente durante conflictos moderados;  tambi√©n se tiene en cuenta que el contenido de los archivos XIB / storyboard cambia cada vez que se guardan, incluso si la interfaz no ha cambiado (aunque escuch√© que en Xcode 9 este problema ya se ha solucionado); <br></li><li>  puede ser dif√≠cil cambiar y mantener algunas propiedades en Interface Builder (IB), por ejemplo, propiedades CALayer durante el proceso de retransmisi√≥n de vistas secundarias (subvistas de dise√±o), lo que puede conducir a varias fuentes de verdad para el estado de vista; <br></li><li>  Interface Builder no es la herramienta m√°s r√°pida, y a veces es mucho m√°s r√°pido trabajar directamente con el c√≥digo. <br></li></ul><br>  Eche un vistazo al siguiente controlador (FriendsListViewController): <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FriendsListViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> backgroundColor: <span class="hljs-type"><span class="hljs-type">UIColor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cornerRadius: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> infoView: <span class="hljs-type"><span class="hljs-type">FriendsListView!</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> viewModel: <span class="hljs-type"><span class="hljs-type">FriendsListViewModelProtocol</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> viewConfig: <span class="hljs-type"><span class="hljs-type">ViewConfig</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(viewModel: <span class="hljs-type"><span class="hljs-type">FriendsListViewModelProtocol</span></span>, viewConfig: <span class="hljs-type"><span class="hljs-type">ViewConfig</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.viewModel = viewModel <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.viewConfig = viewConfig <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(nibName: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, bundle: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">required</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>?(coder aDecoder: <span class="hljs-type"><span class="hljs-type">NSCoder</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">fatalError</span></span>(<span class="hljs-string"><span class="hljs-string">"init(coder:) has not been implemented"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.setupContainerView() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupContainerView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.backgroundColor = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.viewConfig.backgroundColor <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> infoView = <span class="hljs-type"><span class="hljs-type">FriendsListView</span></span>( frame: .zero, viewModel: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.viewModel, viewConfig: .defaultConfig) infoView.backgroundColor = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.viewConfig.backgroundColor <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.addSubview(infoView) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.infoView = infoView infoView.translatesAutoresizingMaskIntoConstraints = <span class="hljs-literal"><span class="hljs-literal">false</span></span> infoView.leadingAnchor.constraint(equalTo: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.leadingAnchor).isActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> infoView.trailingAnchor.constraint(equalTo: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.trailingAnchor).isActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> infoView.topAnchor.constraint(equalTo: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.topAnchor).isActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> infoView.bottomAnchor.constraint(equalTo: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.bottomAnchor).isActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶. }</span></span></code> </pre> <br>  Este ejemplo muestra que puede crear un controlador de vista solo proporcionando un modelo de vista y una configuraci√≥n de vista.  Puede leer m√°s sobre los modelos de presentaci√≥n, es decir, el modelo de dise√±o MVVM (Model-View-ViewModel) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  Dado que la configuraci√≥n de la vista es una entidad estructural simple (entidad de estructura) que define el dise√±o y el estilo de la vista, es decir, sangr√≠as, tama√±os, colores, fuentes, etc., considero apropiado proporcionar una configuraci√≥n est√°ndar como esta: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FriendsListViewController</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewConfig</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> defaultConfig: <span class="hljs-type"><span class="hljs-type">FriendsListViewController</span></span>.<span class="hljs-type"><span class="hljs-type">ViewConfig</span></span> {       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">FriendsListViewController</span></span>.<span class="hljs-type"><span class="hljs-type">ViewConfig</span></span>(backgroundColor: .white,                                                   cornerRadius: <span class="hljs-number"><span class="hljs-number">16</span></span>)   } }</code> </pre> <br>  Toda la inicializaci√≥n de la vista ocurre en el m√©todo <code>setupContainerView</code> , que se llama solo una vez desde viewDidLoad cuando la vista ya est√° creada y cargada, pero a√∫n no se dibuja en la pantalla, es decir, todos los elementos necesarios (subvistas) simplemente se agregan a la jerarqu√≠a de la vista, y luego se aplica el marcado (dise√±o) y estilos. <br><br>  As√≠ es como se ve el controlador de vista ahora: <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FriendsListPresenter</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FriendsListPresenterProtocol {   // ‚Ä¶   func presentFriendsList</span></span></span></span>(from presentingViewController: UIViewController) {       let controller = Class.createFriendsListViewController( presentingViewController: presentingViewController,           headerViewModel: self.headerViewModel,           contentViewModel: self.contentViewModel)       controller.modalPresentationStyle = .overCurrentContext       controller.modalTransitionStyle = .crossDissolve       presentingViewController.present(controller, animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, completion: nil)   }   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">createFriendsListViewController</span></span></span></span>( presentingViewController: UIViewController, headerViewModel: FriendsListHeaderViewModelProtocol,       contentViewModel: FriendsListContentViewModelProtocol) -&gt; FriendsListContainerViewController {      let dismissViewControllerBlock: VoidBlock = { [weak presentingViewController] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>           presentingViewController?.dismiss(animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, completion: nil)       }       let infoViewModel = FriendsListViewModel( headerViewModel: headerViewModel,           contentViewModel: contentViewModel)       let containerViewModel = FriendsListContainerViewModel(onOutsideContentTapAction: dismissViewControllerBlock)       let friendsListViewController = FriendsListViewController( viewModel: infoViewModel, viewConfig: .defaultConfig)       let controller = FriendsListContainerViewController( contentViewController: friendsListViewController,           viewModel: containerViewModel,           viewConfig: .defaultConfig)       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> controller   } }</code> </pre> <br>  Puede ver una clara <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">separaci√≥n de responsabilidades</a> , y este concepto no es mucho m√°s complicado que llamar a segue en un gui√≥n gr√°fico. <br><br>  Crear un controlador de vista es bastante simple, dado que tenemos su modelo y simplemente puede usar la configuraci√≥n de vista est√°ndar: <br><br><pre> <code class="hljs lisp">let friendsListViewController = FriendsListViewController( <span class="hljs-name"><span class="hljs-name">viewModel</span></span>: infoViewModel, viewConfig: .defaultConfig)</code> </pre><br><h3>  # 2: uso de anclas de dise√±o </h3><br>  Aqu√≠ est√° el c√≥digo de dise√±o: <br><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.addSubview(infoView) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.infoView = infoView infoView.translatesAutoresizingMaskIntoConstraints = <span class="hljs-literal"><span class="hljs-literal">false</span></span> infoView.leadingAnchor.constraint(equalTo: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.leadingAnchor).isActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> infoView.trailingAnchor.constraint(equalTo: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.trailingAnchor).isActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> infoView.topAnchor.constraint(equalTo: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.topAnchor).isActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> infoView.bottomAnchor.constraint(equalTo: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.bottomAnchor).isActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre><br>  En pocas palabras, este c√≥digo coloca <code>infoView</code> dentro de la vista principal (supervista), en las coordenadas (0, 0) relativas al tama√±o original de la supervista. <br><br>  ¬øPor qu√© usamos anclas de dise√±o?  Es rapido y facil.  Por supuesto, puede configurar UIView.frame manualmente y calcular todas las posiciones y tama√±os sobre la marcha, pero a veces puede resultar un c√≥digo demasiado confuso y / o voluminoso. <br><br>  Tambi√©n puede usar un formato de texto para el marcado, como se describe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> , pero a menudo esto conduce a errores, porque necesita seguir estrictamente el formato, y Xcode no verifica el texto de descripci√≥n del marcado en la etapa de escribir / compilar el c√≥digo, y no puede usar la Gu√≠a de dise√±o de √°rea segura: <br><br><pre> <code class="hljs perl">NSLayoutConstraint.constraints( withVisualFormat: <span class="hljs-string"><span class="hljs-string">"V:|-(\(topSpace))-[headerView(headerHeight@200)]-[collectionView(collectionViewHeight@990)]|"</span></span>,   options: [],   metrics: metrics,   views: views)</code> </pre><br>  Es bastante f√°cil cometer un error o un error tipogr√°fico en la cadena de texto que define el marcado, ¬øverdad? <br><br><h3>  # 3: Componentes - Divide y vencer√°s </h3><br>  Nuestra interfaz de usuario de ejemplo se divide en componentes, cada uno de los cuales realiza una funci√≥n espec√≠fica, no m√°s. <br><br>  Por ejemplo: <br><br><ol><li>  <code>FriendsListHeaderView</code> : muestra informaci√≥n sobre amigos y el bot√≥n Cerrar. </li><li>  <code>FriendsListContentView</code> : muestra una lista de amigos con celdas en las que se puede hacer clic, el contenido se carga din√°micamente cuando llega al final de la lista. </li><li>  <code>FriendsListView</code> : un contenedor para las dos vistas anteriores. </li></ol><br>  Como se mencion√≥ anteriormente, en Badoo amamos el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">principio de responsabilidad exclusiva</a> cuando cada componente es responsable de una funci√≥n separada.  Esto ayuda no solo en el proceso de correcci√≥n de errores (que, quiz√°s, no es la parte m√°s interesante del trabajo del desarrollador de iOS), sino tambi√©n durante el desarrollo de una nueva funcionalidad, porque este enfoque ampl√≠a significativamente las posibilidades de reutilizar el c√≥digo en el futuro. <br><br><h3>  # 4: Separar la interfaz de usuario y la l√≥gica </h3><br>  Y el √∫ltimo, pero no menos importante punto, es la separaci√≥n de la interfaz de usuario y la l√≥gica.  Una t√©cnica que puede ahorrarle tiempo y nervios a su equipo.  En el sentido literal: un proyecto separado para la interfaz de usuario y otro para la l√≥gica de negocios. <br><br>  Volvamos a nuestro ejemplo.  Como recordar√°n, la esencia de la presentaci√≥n (presentador) se ve as√≠: <br><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">presentFriendsList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(from presentingViewController: UIViewController)</span></span></span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> controller = <span class="hljs-type"><span class="hljs-type">Class</span></span>.createFriendsListViewController( presentingViewController: presentingViewController,       headerViewModel: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.headerViewModel,       contentViewModel: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.contentViewModel)   controller.modalPresentationStyle = .overCurrentContext   controller.modalTransitionStyle = .crossDissolve   presentingViewController.present(controller, animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, completion: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) }</code> </pre> <br>  Solo necesita proporcionar modelos de vista para el t√≠tulo y el contenido.  El resto est√° oculto dentro de la implementaci√≥n anterior de los componentes de la interfaz de usuario. <br><br>  El protocolo del modelo de vista de encabezado se ve as√≠: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FriendsListHeaderViewModelProtocol</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> friendsCountIcon: <span class="hljs-type"><span class="hljs-type">UIImage?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> }   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> closeButtonIcon: <span class="hljs-type"><span class="hljs-type">UIImage?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> }   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> friendsCount: <span class="hljs-type"><span class="hljs-type">Observable</span></span>&lt;<span class="hljs-type"><span class="hljs-type">String</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> }   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> onCloseAction: <span class="hljs-type"><span class="hljs-type">VoidBlock?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> } }</code> </pre> <br>  Ahora imagine que est√° agregando pruebas visuales para la interfaz de usuario: es tan simple como pasar modelos de c√≥digo auxiliar para los componentes de la interfaz de usuario. <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FriendsListHeaderDemoViewModel</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FriendsListHeaderViewModelProtocol</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> friendsCountIcon: <span class="hljs-type"><span class="hljs-type">UIImage?</span></span> = <span class="hljs-type"><span class="hljs-type">UIImage</span></span>(named: <span class="hljs-string"><span class="hljs-string">"ic_friends_count"</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> closeButtonIcon: <span class="hljs-type"><span class="hljs-type">UIImage?</span></span> = <span class="hljs-type"><span class="hljs-type">UIImage</span></span>(named: <span class="hljs-string"><span class="hljs-string">"ic_close_cross"</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> friendsCount: <span class="hljs-type"><span class="hljs-type">Observable</span></span>&lt;<span class="hljs-type"><span class="hljs-type">String</span></span>&gt;   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> onCloseAction: <span class="hljs-type"><span class="hljs-type">VoidBlock?</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>() {       <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> friendsCountString = <span class="hljs-string"><span class="hljs-string">"\(Int.random(min: 1, max: 5000))"</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.friendsCount = <span class="hljs-type"><span class="hljs-type">Observable</span></span>(friendsCountString)   } }</code> </pre> <br>  Se ve simple, ¬øverdad?  Ahora queremos agregar l√≥gica empresarial a los componentes de nuestra aplicaci√≥n, lo que puede requerir proveedores de datos, modelos de datos, etc. <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FriendsListHeaderViewModel</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FriendsListHeaderViewModelProtocol</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> friendsCountIcon: <span class="hljs-type"><span class="hljs-type">UIImage?</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> closeButtonIcon: <span class="hljs-type"><span class="hljs-type">UIImage?</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> friendsCount: <span class="hljs-type"><span class="hljs-type">Observable</span></span>&lt;<span class="hljs-type"><span class="hljs-type">String</span></span>&gt; = <span class="hljs-type"><span class="hljs-type">Observable</span></span>(<span class="hljs-string"><span class="hljs-string">"0"</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> onCloseAction: <span class="hljs-type"><span class="hljs-type">VoidBlock?</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dataProvider: <span class="hljs-type"><span class="hljs-type">FriendsListDataProviderProtocol</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> observers: [<span class="hljs-type"><span class="hljs-type">ObserverProtocol</span></span>] = []   <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(dataProvider: <span class="hljs-type"><span class="hljs-type">FriendsListDataProviderProtocol</span></span>,        friendsCountIcon: <span class="hljs-type"><span class="hljs-type">UIImage?</span></span>,        closeButtonIcon: <span class="hljs-type"><span class="hljs-type">UIImage?</span></span>) {       <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.dataProvider = dataProvider       <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.friendsCountIcon = friendsCountIcon       <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.closeButtonIcon = closeButtonIcon       <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.setupDataObservers()   }   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupDataObservers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {       <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.observers.append(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.dataProvider.totalItemsCount.observeNewAndCall { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] (newCount) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>           <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>?.friendsCount.value = <span class="hljs-string"><span class="hljs-string">"\(newCount)"</span></span>       })   } }</code> </pre> <br>  ¬øQu√© podr√≠a ser m√°s f√°cil?  Simplemente implemente el proveedor de datos, ¬°y listo! <br><br>  La implementaci√≥n del modelo de contenido parece un poco m√°s complicada, pero la separaci√≥n de responsabilidades a√∫n simplifica enormemente la vida.  Aqu√≠ hay un ejemplo de c√≥mo crear instancias y mostrar una lista de amigos con solo hacer clic en un bot√≥n: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">presentRealFriendsList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> avatarPlaceholderImage = <span class="hljs-type"><span class="hljs-type">UIImage</span></span>(named: <span class="hljs-string"><span class="hljs-string">"avatar-placeholder"</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> itemFactory = <span class="hljs-type"><span class="hljs-type">FriendsListItemFactory</span></span>(avatarPlaceholderImage: avatarPlaceholderImage)   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dataProvider = <span class="hljs-type"><span class="hljs-type">FriendsListDataProvider</span></span>(itemFactory: itemFactory)   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> viewModelFactory = <span class="hljs-type"><span class="hljs-type">FriendsListViewModelFactory</span></span>(dataProvider: dataProvider)   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> headerViewModel = viewModelFactory.makeHeaderViewModel()   headerViewModel.onCloseAction = { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>?.dismiss(animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, completion: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)   }   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> contentViewModel = viewModelFactory.makeContentViewModel()   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> presenter = <span class="hljs-type"><span class="hljs-type">FriendsListPresenter</span></span>( headerViewModel: headerViewModel,       contentViewModel: contentViewModel)   presenter.presentFriendsList(from: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) }</code> </pre> <br>  Esta t√©cnica ayuda a aislar la interfaz de usuario de la l√≥gica empresarial.  Adem√°s, esto le permite cubrir toda la interfaz de usuario con pruebas visuales, ¬°pasando datos de prueba a los componentes!  Por lo tanto, la separaci√≥n de la interfaz de usuario y la l√≥gica de negocios relacionada es cr√≠tica para el √©xito del proyecto, ya sea un inicio o un producto ya terminado. <br><br><h2>  Conclusi√≥n </h2><br>  Por supuesto, estas son solo algunas de las t√©cnicas utilizadas en Badoo, y no son una soluci√≥n universal para todos los casos posibles.  Por lo tanto, √∫selos despu√©s de evaluar si son adecuados para usted y sus proyectos. <br><br>  Existen otros m√©todos, por ejemplo, componentes de interfaz de usuario configurables por XIB que usan Interface Builder (se describen en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nuestro</a> otro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> ), pero por diversas razones no se usan en Badoo.  Recuerde que todos tienen su propia opini√≥n y visi√≥n del panorama general, por lo tanto, para desarrollar un proyecto exitoso, debe llegar a un consenso en el equipo y elegir el enfoque m√°s adecuado para la mayor√≠a de los escenarios. <br><br>  ¬°Que Swift te acompa√±e! <br><br>  Fuentes <br><br><ul><li>  C√≥digo completo del proyecto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en GitHub</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Versi√≥n en ingl√©s de este art√≠culo</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Crear componentes de IU personalizados</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Plantillas arquitect√≥nicas de iOS</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Estado de modelado en Swift</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Principios S√ìLIDOS en Swift</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">NSLayoutAnchor</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Crear restricciones mediante programaci√≥n</a> <br></li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es421559/">https://habr.com/ru/post/es421559/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es421549/index.html">Estamos escribiendo documentaci√≥n t√©cnica: una gu√≠a para el profano</a></li>
<li><a href="../es421551/index.html">Dominando Vuex - De cero a h√©roe</a></li>
<li><a href="../es421553/index.html">Compartimos contenido tecnol√≥gico: hemos reunido todos nuestros materiales en un solo sitio</a></li>
<li><a href="../es421555/index.html">Proyecto WideNES: vaya m√°s all√° de los l√≠mites de la pantalla NES</a></li>
<li><a href="../es421557/index.html">Lecci√≥n abierta "Programaci√≥n asincr√≥nica en Java"</a></li>
<li><a href="../es421563/index.html">Es posible que deba sentarse de manera diferente para deshacerse del dolor de espalda.</a></li>
<li><a href="../es421565/index.html">C√≥mo los robots humanoides groseros pueden enga√±arte</a></li>
<li><a href="../es421567/index.html">Discusi√≥n: ac√∫stica port√°til inusual: un auto deportivo, radio retro y ‚Äúbotas de audio‚Äù</a></li>
<li><a href="../es421569/index.html">Lo m√°s importante con Gamescom 2018: Nvidia RTX, Cyberpunk 2077, Metro Exodus</a></li>
<li><a href="../es421571/index.html">Kivy Xamarin Reaccionar nativo. Tres marcos: un experimento (parte 3)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>