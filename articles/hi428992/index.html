<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСитАНЁЯОд ЁЯХЮ ЁЯМжя╕П рдкрдбрд╡рди рдФрд░ рдХреАрдиреЗрдЯрд┐рдХ рдУрдПрд╕ рдлрд░реНрдорд╡реЗрдпрд░ рдХреЗ рд╕рд╛рде рд░рд╛рдЙрдЯрд░ рдкрд░ рддрд╛рд▓реЗ рдХрд╛ рдЪрдпрдирд╛рддреНрдордХ рдмрд╛рдИрдкрд╛рд╕ ЁЯН╜я╕П ЁЯУЮ ЁЯжЗ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдЕрд╡рд░реБрджреНрдз рдЗрдВрдЯрд░рдиреЗрдЯ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рджрд░рдХрд┐рдирд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд╕рд╛рде рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдирд┐рд░реНрджреЗрд╢ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд┐рдП рдЧрдП рд╣реИрдВред рд▓реЗрдХрд┐рди рд╡рд┐рд╖рдп рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХрддрд╛ рдирд╣реАрдВ рдЦреЛрддрд╛ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдкрдбрд╡рди рдФрд░ рдХреАрдиреЗрдЯрд┐рдХ рдУрдПрд╕ рдлрд░реНрдорд╡реЗрдпрд░ рдХреЗ рд╕рд╛рде рд░рд╛рдЙрдЯрд░ рдкрд░ рддрд╛рд▓реЗ рдХрд╛ рдЪрдпрдирд╛рддреНрдордХ рдмрд╛рдИрдкрд╛рд╕</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428992/"> рдЕрд╡рд░реБрджреНрдз рдЗрдВрдЯрд░рдиреЗрдЯ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рджрд░рдХрд┐рдирд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд╕рд╛рде рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдирд┐рд░реНрджреЗрд╢ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд┐рдП рдЧрдП рд╣реИрдВред  рд▓реЗрдХрд┐рди рд╡рд┐рд╖рдп рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХрддрд╛ рдирд╣реАрдВ рдЦреЛрддрд╛ рд╣реИред  рдФрд░ рднреА рдЕрдзрд┐рдХ, рд╡рд┐рдзрд╛рдпреА рд╕реНрддрд░ рдкрд░ рд▓реЗрдЦреЛрдВ рдХреЛ рдмрд╛рдИрдкрд╛рд╕ рддрд╛рд▓реЗ рдХреЗ рддрд░реАрдХреЛрдВ рдкрд░ рд▓реЗрдЦреЛрдВ рдХреЛ рдЕрд╡рд░реБрджреНрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реБрдирд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИред  рдФрд░ рдРрд╕реА рдЕрдлрд╡рд╛рд╣реЗрдВ рдереАрдВ рдХрд┐ рд░реЛрд╕рдХреЛрдореНрдирд╛рдбрдЬрд╝реЛрд░ рдХреЛ рдХрд░рджрд╛рддрд╛рдУрдВ рдХреЗ рдкреИрд╕реЗ рдХрд╛ рдПрдХ рдФрд░ рдкреИрдХреЗрдЯ "рдмреЗрд╣рддрд░" рддрд╛рд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдорд┐рд▓реЗрдЧрд╛ред  рдЕрдиреБрднрд╡реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд▓реЗрдЦ рд╕реЗ рдХреБрдЫ рднреА рдирдпрд╛ рдпрд╛ рдЙрдкрдпреЛрдЧреА рдирд╣реАрдВ рд╕реАрдЦреЗрдВрдЧреЗред  рд▓реЗрдХрд┐рди рджреВрд╕рд░реЛрдВ рдХреЛ рдкрдбрд╛рд╡рди рдФрд░ рдХреАрдиреЗрдЯрд┐рдХ рдлрд░реНрдорд╡реЗрдпрд░ рдХреЗ рд╕рд╛рде рд▓реЛрдХрдкреНрд░рд┐рдп рд░рд╛рдЙрдЯрд░ рдкрд░ рддрд╛рд▓реЗ рдХреЗ рд╕рд░рд▓ рдФрд░ рдкреНрд░рднрд╛рд╡реА рдЪрдпрдирд╛рддреНрдордХ рдмрд╛рдИрдкрд╛рд╕ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдХрд┐рдП рдЧрдП рдХрджрдо-рджрд░-рдЪрд░рдг рдирд┐рд░реНрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рд╣реЛрдВрдЧреЗред <br><br><img src="https://habrastorage.org/webt/is/kb/td/iskbtdxuaisqiyg3r4tsrjhj6aw.jpeg"><br><a name="habracut"></a><br><h1>  рд╕рд╛рдордЧреНрд░реА </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд░рд┐рдЪрдп</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЖрдк рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рдмрд╛рдж рддрд╛рд▓реЗ рдХреЛ рдХреИрд╕реЗ рдмрд╛рдпрдкрд╛рд╕ рдХрд░реЗрдВрдЧреЗ?</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрд╛рд░реНрдп рд╕рд┐рджреНрдзрд╛рдВрдд</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдХ рдкрдбрд╡рди рд░рд╛рдЙрдЯрд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреАрдиреЗрдЯрд┐рдХ рдУрдПрд╕ рдХреЗ рд╕рд╛рде рдПрдХ рд░рд╛рдЙрдЯрд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рдмрд╛рдж рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЗ рдирд┐рджрд╛рди рдХреЗ рд▓рд┐рдП рдмреБрдирд┐рдпрд╛рджреА рддрд░реАрдХреЗ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░рджрд╛рддрд╛ рджреНрд╡рд╛рд░рд╛ DNS рдкреНрд░рд╢реНрдиреЛрдВ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрддрд┐рд░рд┐рдХреНрдд рдмрд╛рдИрдкрд╛рд╕</a> </li></ul><br><a name="con1"></a><h1>  рдкрд░рд┐рдЪрдп </h1><br>  рдореИрдВрдиреЗ рд▓рдЧрднрдЧ рджреЛ рд╕рд╛рд▓ рддрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Zolg</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓реЙрдХ рдмрд╛рдпрдкрд╛рд╕ рд╡рд┐рдХрд▓реНрдк рдХрд╛</a> рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред  рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдХрдИ рдирд┐рд░реНрджреЗрд╢ рдЗрд╕ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИрдВред  рдореЗрд░рд╛ рд╕рд╣рд┐рддред <br><br>  рд╕рдм рдХреБрдЫ рдЕрдЪреНрдЫрд╛ рдерд╛, рд▓реЗрдХрд┐рди "рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рд╣рдореЗрд╢рд╛ рдЕрдЪреНрдЫреЗ рдХрд╛ рджреБрд╢реНрдорди рд╣реЛрддрд╛ рд╣реИред"  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдХреБрдЫ рдирдП рдХрд╛рд░реНрдпрдХреНрд░рдо рдмрд╣реБрдд "рд╕реНрдорд╛рд░реНрдЯ" рд╣реЛ рдЧрдП рд╣реИрдВ рдФрд░ рд░рд╛рдЙрдЯрд░ рдХреЗ DNS рд╕рд░реНрд╡рд░ рдХреЛ рджрд░рдХрд┐рдирд╛рд░ рдХрд░рддреЗ рд╣реБрдП рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рддрд░реАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЛрдореЗрди рдХреЛ рд╣рд▓ рдХрд░реЗрдВрдЧреЗред  рдпрд╣ рд░рд╛рдЙрдЯрд░ рдкрд░ dnsmasq рдХреЛ рдЕрдирд▓реЙрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП ipset рд╕реЗрдЯ рдкрд░ рдкрддрд╛ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИ рдФрд░ рдПрдХ рддрд╛рд░реНрдХрд┐рдХ рдкрд░рд┐рдгрд╛рдо рдХреА рдУрд░ рдЬрд╛рддрд╛ рд╣реИ - рд╕рдВрд╕рд╛рдзрди рд▓реЙрдХ рд░рд╣рддрд╛ рд╣реИред  рдПрдВрдбреНрд░реЙрдЗрдб 9 рдореЗрдВ, рдбреАрдПрдирдПрд╕-рдУрд╡рд░-рдЯреАрдПрд▓рдПрд╕ рдХреЗ рд▓рд┐рдП рдореВрд▓ рд╕рдорд░реНрдерди, рдЕрд░реНрдерд╛рддред  рд▓реЙрдХ рдХреЛ рджрд░рдХрд┐рдирд╛рд░ рдХрд░рдиреЗ рдХреА рдпрд╣ рд╡рд┐рдзрд┐ рдХрд╛рдо рдХрд░рдирд╛ рдмрдВрдж рдХрд░ рджреЗрддреА рд╣реИ (рдпрджрд┐ рдЕрдиреНрдп рдбрд┐рд╡рд╛рдЗрд╕ рдиреЗ dnsmasq рдХреЛ рдкрд╣рд▓реЗ рдПрдХреНрд╕реЗрд╕ рдирд╣реАрдВ рдХрд┐рдпрд╛ рд╣реИ)ред  рджреВрд╕рд░реЗ, рдПрдВрдЯреАрдЬрд╝рд╛рдкреНрд░реЗрдЯ рд╕реЗ рд╕рдВрдкреВрд░реНрдг рдбреЛрдореЗрди рд╕реВрдЪреА рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рд╕реЗ рд╣рд░ рдмрд╛рд░ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рдкрд░рд┐рдгрд╛рдо рд╕рд╛рдордиреЗ рдЖрддреЗ рд╣реИрдВред  рд╕реВрдЪреА рдореЗрдВ рдРрд╕реЗ рдбреЛрдореЗрди рд╢рд╛рдорд┐рд▓ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЕрд╡рд░реБрджреНрдз рдирд╣реАрдВ рд╣реИрдВ, рдФрд░ рдЬрд┐рдирдХрд╛ рд╕рдВрдЪрд╛рд▓рди рдореБрдЦреНрдп рдЪреИрдирд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред  рдЖрдкрдХреЛ рд▓рдЧрд╛рддрд╛рд░ рдЕрд▓рд░реНрдЯ рдкрд░ рд░рд╣рдиреЗ рдФрд░ рдЕрдкрдиреЗ рд╣рд╛рдереЛрдВ рд╕реЗ рдЙрддреНрдкрдиреНрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рддреАрд╕рд░рд╛, рдореИрдВ рд╣рдЬрд╛рд░реЛрдВ рдХреИрд╕рд┐рдиреЛ рдФрд░ рдЗрд╕ рддрд░рд╣ рдХреЗ рджрд╕рд┐рдпреЛрдВ рдбреЛрдореЗрди рдХреА рдПрдХ рд╡рд┐рд╢рд╛рд▓ рд╕реВрдЪреА рдХреЗ рд╕рд╛рде "рдШрд╕реАрдЯрддрд╛ рд╣реВрдВ" рдердХ рдЧрдпрд╛ рд╣реВрдВ, рдЬрд┐рдирдХреА рдмрд╕ рдЬрд░реВрд░рдд рдирд╣реАрдВ рд╣реИред  рд╕рдордп рдХреЗ рд╕рд╛рде, рдореБрдЭреЗ рдПрд╣рд╕рд╛рд╕ рд╣реБрдЖ рдХрд┐ рдореБрдЭреЗ рдЕрд╡рд░реБрджреНрдз рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреА рдХреЗрд╡рд▓ рдПрдХ рдЫреЛрдЯреА рд╕реА рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реВрдЪреА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br>  рдЗрд╕рд▓рд┐рдП рдПрдХ рд╕рд╛рд▓ рд╕реЗ рдореИрдВ рдереЛрдбрд╝рд╛ рд╕рдВрд╢реЛрдзрд┐рдд рдЕрдирд▓реЙрдХ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реВрдВ, рдЬрд┐рд╕рд╕реЗ рдореИрдВ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рдВрддреБрд╖реНрдЯ рд╣реВрдВ: <br><br><ul><li>  рд╕рд╛рджрдЧреА рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдореЗрдВ рдЖрд╕рд╛рдиреА (рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рдмрд╛рдж)ред </li><li>  рдЖрдкрдХреЛ рдХрд┐рди рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдЕрдирд▓реЙрдХ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЗрд╕ рдкрд░ рдкреВрд░реНрдг рдирд┐рдпрдВрддреНрд░рдгред </li><li>  рдкреНрд░реЛрд╕реЗрд╕рд░ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдФрд░ рд░рд╛рдЙрдЯрд░ рд░реИрдо рдХреЗ рд▓рд┐рдП рдиреНрдпреВрдирддрдо рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВред </li><li>  рддрд╛рд▓реЗ рдХреЛ рджрд░рдХрд┐рдирд╛рд░ рдХрд░рддреЗ рд╣реБрдП рдмрд╛рд░реАрдХрд┐рдпреЛрдВ рдХреА рд╡реНрдпрд╛рдкрдХ рдХрд╡рд░реЗрдЬред </li></ul><br>  рдпрд╣ рдиреЛрдЯ рдХрд░рдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдореЗрд░реЗ рд╡рд┐рдХрд▓реНрдк рдХрд╛ рдЗрд░рд╛рджрд╛ рдЙрд╕ рдорд╛рдорд▓реЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рд╣реИ рдЬрдм рдЖрдкрдХреЛ рд╕реИрдХрдбрд╝реЛрдВ рдФрд░ рд╣рдЬрд╛рд░реЛрдВ рдбреЛрдореЗрди рдЕрдирд▓реЙрдХ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдХреНрдпреЛрдВрдХрд┐ рдЬрдм рд░рд╛рдЙрдЯрд░ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рджреА рдЧрдИ рд╕реВрдЪреА рдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдбреЛрдореЗрди рдХреЛ рд╣рд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕реВрдЪреА рдореЗрдВ рдЬрд┐рддрдиреЗ рдЕрдзрд┐рдХ рдбреЛрдореЗрди рд╣реЛрдВрдЧреЗ, рдЕрдирд▓реЙрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ ipset рдХреА рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╕рдВрдЦреНрдпрд╛ рд╣реЛрдЧреАред <br><br>  рддрд╛рд▓реЗ рдХреЛ рджрд░рдХрд┐рдирд╛рд░ рдХрд░рдиреЗ рдХрд╛ рдЖрдзрд╛рд░ рдПрдХ рд╣реА рд╣реИ - рдЯреЛрд░ рдиреЗрдЯрд╡рд░реНрдХред  рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рджреЛ рд╕рд░рд▓ рдХрд╛рд░рдХреЛрдВ рдХреЗ рдХрд╛рд░рдг рд╣реЛрддрд╛ рд╣реИ - рдирд┐: рд╢реБрд▓реНрдХ рдФрд░ рдХрд┐рд╕реА рд╡реАрдкреАрдПрди рд╕реЗрд╡рд╛ рдХреЗ рд╡рд┐рдкрд░реАрдд, рд░реВрд╕ рдореЗрдВ рдЯреЙрд░ рдХреЛ рдЕрд╡рд░реБрджреНрдз рд╣реЛрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╢реВрдиреНрдп рдХреЗ рдХрд░реАрдм рд╣реИред  рдЯреЛрд░ рд░реВрд╕ рдореЗрдВ рдордзреНрдп рд╕реЗ рд▓реЗрдХрд░ рдиреАрдЪреЗ рддрдХ рдорд╛рджрдХ рдкрджрд╛рд░реНрдереЛрдВ рдХреА рддрд╕реНрдХрд░реА рдХреА рдиреАрдВрд╡ рд╣реИред  рд▓реЙрдХрд┐рдВрдЧ рдЯреЙрд░ рдмрд╛рдЬрд╛рд░ рдХреЗ рд▓рд┐рдП рдирдП рдЙрдкрдХрд░рдгреЛрдВ рдХреА рдЦреЛрдЬ рдХрд╛ рдиреЗрддреГрддреНрд╡ рдХрд░реЗрдЧрд╛ рдФрд░ рдЧреБрдордирд╛рдореА рдХреЗ рд╕реНрддрд░ рдХреЛ рдХрдо рдХрд░реЗрдЧрд╛, рдЬреЛ рд╕реНрдерд╛рдиреАрдп рдХрд╛рдиреВрди рдкреНрд░рд╡рд░реНрддрди рдПрдЬреЗрдВрд╕рд┐рдпреЛрдВ рдХреЗ рдХрд╛рдо рдХреА рд╕рдлрд▓ рд╕рдХреНрд░рд┐рдпрддрд╛ рдХреЛ рдмрдврд╝рд╛рдПрдЧрд╛ред  рдЕрдВрддрддрдГ, рдпрд╣, рдПрдХ рд╡рд╛рдпрд░рд╕ рдХреА рддрд░рд╣, рдКрдкрд░реА рд▓рд┐рдВрдХ рдХреЛ рдирдХрд╛рд░рд╛рддреНрдордХ рд░реВрдк рд╕реЗ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджреЗрдЧрд╛ред  рд░реВрд╕ рдореЗрдВ рд╡реИрд╢реНрд╡рд┐рдХ рдорд╛рджрдХ рдкрджрд╛рд░реНрдереЛрдВ рдХреА рддрд╕реНрдХрд░реА рдХреЗ рд╕рд╛рде рд╡рд░рд┐рд╖реНрда рд╕рд░рдХрд╛рд░реА рдЕрдзрд┐рдХрд╛рд░рд┐рдпреЛрдВ рдХреЗ рд╕рдВрдмрдВрдз рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдирд╡реАрдирддрдо рдЖрд╢реНрдЪрд░реНрдпрдЬрдирдХ рд╕рдорд╛рдЪрд╛рд░реЛрдВ рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП, рд░реВрд╕ рдореЗрдВ рдЯреЙрд░ рдХреЛ рд░реЛрдХрдирд╛ рдХреЗрд╡рд▓ рдПрдХ рд╡рд░реНрдЬрд┐рдд рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рддреБрдЪреНрдЫ рд╣реИред  рд░реЛрд╕рдХреЛрдореНрдирд╛рдбрдЬрд╝реЛрд░ рди рддреЛ рдЗрд╕ рдПрдЬреЗрдВрд╕реА рдХреЛ рдХрд┐рддрдиреЗ рдмрд┐рд▓ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рди рдХрд┐ рд░реВрд╕ рдХреА рдПрдХ рднреА рдЕрджрд╛рд▓рдд рдиреЗ рдЯреЛрд░ рдХреЛ рдмреНрд▓реЙрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП "рдКрдкрд░ рд╕реЗ" рдЕрдиреБрдорддрд┐ рджреА рд╣реИред  рдФрд░ рдпрд╣ рдХрд┐рд╕реА рдХреЛ рднреА рдЖрд╢реНрдЪрд░реНрдпрдЪрдХрд┐рдд рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ рдпрд╛ рдХрд┐рд╕реА рдХреЛ рднреА рдбрд░рд╛рдПрдЧрд╛, рднрд▓реЗ рд╣реА рд░реВрд╕ рдХреЗрд╡рд▓ рдбреНрд░рдЧреНрд╕ рдореЗрдВ рдбреВрдм рд░рд╣рд╛ рд╣реЛ (рдХрд┐рд╕реА рднреА рд╕реНрдХреВрд▓реА рдмрдЪреНрдЪреЗ рдХреЛ рдкрддрд╛ рд╣реИ рдХрд┐ рд╡рд╣ рдХреНрдпрд╛ рдХрд░рдиреЗ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, рдФрд░ 30 рдорд┐рдирдЯ рдХреЗ рдмрд╛рдж рдХрд┐рд╕реА рднреА рд╢рд╣рд░ рдореЗрдВ 10 рд╣рдЬрд╛рд░ рд▓реЛрдЧреЛрдВ рдХреА рдЖрдмрд╛рджреА рдХреЗ рд╕рд╛рде рд╕реНрд╡рддрдВрддреНрд░ рд░реВрдк рд╕реЗ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рд░реВрдк рд╕реЗ рдХрд┐рд╕реА рднреА рдбреНрд░рдЧреНрд╕ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред рдХрд┐рд╕реА рднреА рдорд╛рддреНрд░рд╛ рдореЗрдВ - рдЬреАрд╡рди рдХрд╛ рдРрд╕рд╛ рджреБрд╖реНрдЯ рд╕рддреНрдп)ред  рд╡рд░реНрддрдорд╛рди рдореЛрдб рдореЗрдВ, рдЯреЛрд░ рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рдЕрд╡рд░реБрджреНрдз рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣рд░реНрдорд┐рдЯреЗрдЬ рд╕рдВрдЧреНрд░рд╣рд╛рд▓рдп рд╕рд╛рдЗрдЯ рдХреЛ рдЕрд╡рд░реБрджреНрдз рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╕реЗ рдХрдо рд╣реИред <br><br>  рджрд┐рдП рдЧрдП рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЛ OpenWrt рдХреЗ рд╕рд╛рде рд░рд╛рдЙрдЯрд░ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЫреЛрдЯреЗ рдмрджрд▓рд╛рд╡реЛрдВ рд╕реЗ Tor рдХреЛ OpenVPN рдХреЗ рд╕рд╛рде рдмрджрд▓рдирд╛ рдЖрд╕рд╛рди рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред <br><br><a name="con11"></a><h1>  рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рдмрд╛рдж рдЖрдк рд▓реЙрдХ рдХреЛ рдХреИрд╕реЗ рдмрд╛рдпрдкрд╛рд╕ рдХрд░реЗрдВрдЧреЗ? </h1><br>  рд╕рдм рдХреБрдЫ рдмрд╣реБрдд рд╕рд░рд▓ рд╣реИред  рдЖрдкрдХреЗ рдкрд╛рд╕ рдлрд╝рд╛рдЗрд▓ /opt/etc/unblock.txt - рдЕрдирд▓реЙрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд░рд▓ рд╕реВрдЪреА рд╣реИред  рдЖрдк рдПрдХ рдбреЛрдореЗрди, рдЖрдИрдкреА рдПрдбреНрд░реЗрд╕, рдПрдбреНрд░реЗрд╕ рд░реЗрдВрдЬ рдпрд╛ CIDR рдЕрдирд▓реЙрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдПрдХ рдкрдВрдХреНрддрд┐ - рдПрдХ рддрддреНрд╡ред  рдЦрд╛рд▓реА рд▓рд╛рдЗрдиреЛрдВ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ, рдФрд░ рдЖрдк рдЙрдкреЗрдХреНрд╖рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд▓рд╛рдЗрди рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ # рдЪрд░рд┐рддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br><div class="spoiler">  <b class="spoiler_title">рдпрд╣рд╛рдБ рдореЗрд░реА рд╡реНрдпрдХреНрддрд┐рдЧрдд рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ</b> <div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">###- rutracker.org rutor.info rutor.is mega-tor.org kinozal.tv nnm-club.me nnm-club.ws tfile.me tfile-home.org tfile1.cc megatfile.cc megapeer.org megapeer.ru tapochek.net tparser.org tparser.me rustorka.com uniongang.tv fast-torrent.ru ###    rezka.ag hdrezka.ag hdrezka.me filmix.co filmix.cc seasonvar.ru ### lib.rus.ec flibusta.is flibs.me flisland.net flibusta.site ### telegram.org tdesktop.com tdesktop.org tdesktop.info tdesktop.net telesco.pe telegram.dog telegram.me t.me telegra.ph web.telegram.org desktop.telegram.org updates.tdesktop.com venus.web.telegram.org flora.web.telegram.org vesta.web.telegram.org pluto.web.telegram.org aurora.web.telegram.org 149.154.160.0/20 91.108.4.0/22 91.108.8.0/22 91.108.12.0/22 91.108.16.0/22 91.108.56.0/22 109.239.140.0/24 67.198.55.0/24 ### 7-zip.org edem.tv 4pna.com 2019.vote ### Tor check.torproject.org ###   IP ( #   ) #195.82.146.214 ###   CIDR ( #   ) #103.21.244.0/22 ###    ( #   ) #100.100.100.200-100.100.100.210</span></span></code> </pre> <br></div></div><br>  рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдк рдмрд╕ рдирдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╣реИрдВ: <br><br><pre> <code class="bash hljs">unblock_update.sh</code> </pre> <br>  рд░рд╛рдЙрдЯрд░ рдХреЛ рдкреБрдирд░рд╛рд░рдВрдн рдХрд░рдиреЗ рдХреЗ рдмрд┐рдирд╛, рдЕрдирдмреНрд▓реЙрдХ рд╕реЗ рд╕рднреА рд╕рдВрд╕рд╛рдзрди рдЕрдирд▓реЙрдХ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред <br><br><a name="con12"></a><h1>  рдХрд╛рд░реНрдп рд╕рд┐рджреНрдзрд╛рдВрдд </h1><br><ul><li>  рд░рд╛рдЙрдЯрд░ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ ipset IP рдкрддреЛрдВ рдХрд╛ рдПрдХ рдЦрд╛рд▓реА рд╕реЗрдЯ рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдЕрдирдмреНрд▓реЙрдХ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред </li><li>  рдлрд╝рд╛рдпрд░ рд╕рд░реНрд╡рд┐рд╕ рдореЗрдВ рдЕрдирдмреНрд▓реЙрдХ рд╕реЗ рд▓реЗрдХрд░ рдЯреЛрд░ рд╕рд░реНрд╡рд┐рд╕ рддрдХ рдХреЗ рд╕рднреА рдкреИрдХреЗрдЯреЛрдВ рдХреЛ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд░рдиреЗ рдХрд╛ рдирд┐рдпрдо рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рд╣реИред </li><li>  рдЯреЛ рд╕реЗрд╡рд╛ рдкрд╛рд░рджрд░реНрд╢реА рдкреНрд░реЙрдХреНрд╕реА рдореЛрдб рдореЗрдВ рд╢реБрд░реВ рд╣реЛрддреА рд╣реИред </li><li>  рд╡рд┐рд╢реЗрд╖ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЕрдирдмреНрд▓реЙрдХ_рд╢рд┐рдкрд╕реЗрдЯред S рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ рдЕрдирдмреНрд▓реЙрдХред Txt рд╕реЗ рд╕рднреА рдбреЛрдореЗрди рдХреЛ рд╣рд▓ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЕрдкрдиреЗ рдЖрдИрдкреА рдкрддреЗ рдХреЛ рдЕрдирдмреНрд▓реЙрдХ рд╕реЗрдЯ рдореЗрдВ рдЬреЛрдбрд╝рддрд╛ рд╣реИред  рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЗ IP рдкрддреЗ, рд░реЗрдВрдЬ рдФрд░ CIDR рднреА рдЕрдирдмреНрд▓реЙрдХ рдореЗрдВ рдЬреЛрдбрд╝реЗ рдЬрд╛рддреЗ рд╣реИрдВред </li><li>  Dnsmasq рдХреЛ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓, рдЕрдирд╡рд░реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред Unns.dnsmasq, рдЬреЛ рдХрд┐ Result.txt рд╕реЗ рдбреЛрдореЗрди рдЖрдИрдкреА рдкрддреЗ рдХреЗ рдЬреЛрдбрд╝ рдХреЛ рд╣рд▓ рдХрд░рддреЗ рд╕рдордп рдЕрдирдмреНрд▓реЙрдХ рд╕реЗрдЯ рдкрд░ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИред </li><li>  рдХреНрд░реЛрди рдЕрдирдмреНрд▓реЙрдХ рдХреЗ рд╕рд╛рде рд╕рдВрднрд╛рд╡рд┐рдд рдорд╛рдорд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдЖрдВрд╢рд┐рдХ рд░реВрдк рд╕реЗ рдХреНрд╖рддрд┐рдкреВрд░реНрддрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдЖрд╡реГрддреНрддрд┐ рдХреЗ рд╕рд╛рде рдЕрдирдмреНрд▓реЙрдХ_рд╢рд┐рдк рдХрд░реЗрдВред </li><li>  рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ рдкреНрд░рджрд╛рддрд╛ рд╕реЗ рдбреАрдПрдирдПрд╕ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдиреЗ рдкрд░ рд╕рднреА рдбреЛрдореЗрди рдЕрдирдмреНрд▓реЙрдХ.txt (рдФрд░ рдХреЗрд╡рд▓ рдЙрдиреНрд╣реЗрдВ) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ dnscrypt- рдкреНрд░реЙрдХреНрд╕реА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣рд▓ рдХрд░рддреЗ рд╣реИрдВред </li></ul><br><a name="con2"></a><h1>  рдПрдХ рдкрдбрд╡рди рд░рд╛рдЙрдЯрд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ </h1><br>  рдЖрдкрдХреЗ рдкрд╛рд╕ рд╕реНрдерд╛рдкрд┐рдд рдкрдбрд╡рди рдлрд░реНрдорд╡реЗрдпрд░ рдФрд░ рдкрд╣рд▓реЗ рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдПрдВрдЯрд░рд╡реЗрдпрд░ рдкреИрдХреЗрдЬ рдореИрдиреЗрдЬрд░ рд╡рд╛рд▓рд╛ рдПрдХ рд░рд╛рдЙрдЯрд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред  рд╡рд┐рдВрдбреЛрдЬ рдкрд░, рдЖрдк SSH рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд░рд╛рдЙрдЯрд░ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">PuTTY</a> рдХреНрд▓рд╛рдЗрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЖрдк Entware рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рди рдХрд┐ рд╡рд┐рд░рд╛рд╕рдд Entware-ng рдХрд╛ред  / рдСрдкреНрдЯ / var / opkg-рд╕реВрдЪрд┐рдпреЛрдВ рдлрд╝реЛрд▓реНрдбрд░ рдХреА рд╕рд╛рдордЧреНрд░реА рджреЗрдЦреЗрдВред  рдЗрд╕рдореЗрдВ рдПрдХ рдПрдВрдЯрд░рд╡реЗрдпрд░ рдпрд╛ рдПрдВрдЯрд░рд╡реЗрдпрд░-рдПрдирдЬреА рдлрд╛рдЗрд▓ рд╣реЛрдЧреАред  рджреВрд╕рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрдкрдХреЛ рдЕрдкрдиреЗ рд░рд╛рдЙрдЯрд░ рдХреЗ рдкрдбрд╡рди рдлрд░реНрдорд╡реЗрдпрд░ рдХреЛ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдФрд░ рдПрдВрдЯрд╡реЗрдпрд░ рдкреИрдХреЗрдЬ рдореИрдиреЗрдЬрд░ рдХреЛ рдлрд┐рд░ рд╕реЗ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рддрднреА рдЪрд░рдг-рджрд░-рдЪрд░рдг рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рд╕рд╛рде рдЖрдЧреЗ рдмрдврд╝реЗрдВред <br><br>  рдЬреИрд╕рд╛ рдХрд┐ рд╕рдореАрдХреНрд╖рд╛ рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдЬрд┐рдирдХреЗ рдкрд╛рд╕ рдПрдВрдЯрд╡реЗрдпрд░ рд╣реИ, рд╡реЗ рд╢реБрд░реВ рдореЗрдВ рдЧрд▓рдд рддрд░реАрдХреЗ рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд╣реИрдВ (рдпрд╛рдиреА, init.d рд╕реЗ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд▓реЛрдб рдирд╣реАрдВ рд╣реБрдИ рд╣реИрдВ) рд░рд╛рдЙрдЯрд░ рдХреА рдЖрдВрддрд░рд┐рдХ рдореЗрдореЛрд░реА рдореЗрдВред  рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ Xiaomi Mi Router 3 рдпрд╛ 3G рд╣реИ, рдФрд░ рдЖрдкрдХреЛ рдпрдХреАрди рдирд╣реАрдВ рд╣реИ рдХрд┐ рдЖрдкрдХреА рдЖрдВрддрд░рд┐рдХ рдореЗрдореЛрд░реА рдореЗрдВ Entware рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ (рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд╢реБрд░реБрдЖрдд), рддреЛ рдмрд╕ рдлрд┐рд░ рд╕реЗ рд╕рдм рдХреБрдЫ рд╕реЗрдЯ рдХрд░реЗрдВред  PROMETHEUS рдХреЛ рд▓реЗрдВред  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рддрд╛ рд╣реИ (1)ред  рд╕реНрд░реЛрдд рдХреЛрдб (2) рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВред  рд▓реАрдЬрд┐рдП рдФрд░ рд╕рдмрд╕реЗ рд╡рд░реНрддрдорд╛рди рдлрд░реНрдорд╡реЗрдпрд░ (4) рдлреНрд▓реИрд╢ред  рдлрд░реНрдорд╡реЗрдпрд░ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ (NVRAM рдФрд░ рдлрд╝рд╛рдЗрд▓ рд╕реНрдЯреЛрд░реЗрдЬ) рд░реАрд╕реЗрдЯ рдХрд░реЗрдВ - рдЙрдиреНрдирдд&gt; рдкреНрд░рд╢рд╛рд╕рди&gt; рд╕реЗрдЯрд┐рдВрдЧреНрд╕ред  рд░рд╛рдЙрдЯрд░ рдкрд░ рдЗрдВрдЯрд░рдиреЗрдЯ рдПрдХреНрд╕реЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ рдФрд░ SSH рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВред  PROMETHEUS рдлрд░реНрдорд╡реЗрдпрд░&gt; RWFS рд╕реНрд╡рд░реВрдкрдг рдореЗрдВ рдкреНрд░рджрд░реНрд╢рди рдХрд░реЗрдВред  рдЙрдиреНрдирдд&gt; рдкреНрд░рд╢рд╛рд╕рди&gt; рд╕реЗрдЯрд┐рдВрдЧ&gt; рдЖрд░ / рдбрдмреНрд▓реНрдпреВ рдЕрдиреБрднрд╛рдЧ&gt; рдпреВрдмреАрдЖрдИрдПрдлрдПрд╕ рдореЗрдВ рдорд╛рдЙрдВрдЯ рдлрд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдЪреБрдиреЗрдВред  рд░рд╛рдЙрдЯрд░ рдХреЛ рд░рд┐рдмреВрдЯ рдХрд░реЗрдВред  рдЖрдВрддрд░рд┐рдХ рдореЗрдореЛрд░реА рд╕реЗ рд╕рднреА рд╡рд░реНрддрдорд╛рди рдПрдВрдЯрд╡реЗрдпрд░ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдкрдВрдЬреАрдХреГрдд рд╣реЛрдВрдЧреЗ, рдФрд░ рд╕рдм рдХреБрдЫ рдПрдХ рдШрдбрд╝реА рдХреА рддрд░рд╣ рдХрд╛рдо рдХрд░реЗрдЧрд╛ред <br><br>  рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ рдирд╡реАрдирддрдо рдлрд░реНрдорд╡реЗрдпрд░ - 32a93bb рдХреЗ рд╕рд╛рде рд▓реЛрдХрдкреНрд░рд┐рдп Xiaomi Mi Router 3G (рдЗрдВрдЯрд░рдирд▓ рдореЗрдореЛрд░реА рдореЗрдВ рдЗрдирд╕реНрдЯреЙрд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред  рд╕рдм рдХреБрдЫ $ 10 рдХреЗ рд▓рд┐рдП рдкреМрд░рд╛рдгрд┐рдХ рдмрдЪреНрдЪреЗ WT3020 AD / F / H рдкрд░ рднреА рдХрд╛рдо рдХрд░реЗрдЧрд╛ред <br><br><img src="https://habrastorage.org/webt/th/kf/2k/thkf2kvtt2rhtnbxvmx0qri7dsk.jpeg"><br><br><h3>  1. рд░рд╛рдЙрдЯрд░ рдкрд░ рдЖрд╡рд╢реНрдпрдХ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ </h3><br><pre> <code class="bash hljs">opkg update opkg install mc tor tor-geoip <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span>-dig cron</code> </pre> <br>  <b>mc</b> - рдорд┐рдбрдирд╛рдЗрдЯ рдХрдорд╛рдВрдбрд░ рдлрд╝рд╛рдЗрд▓ рдореИрдиреЗрдЬрд░ред  рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдореИрдбрд┐рдЯ рдПрдбрд┐рдЯрд░ рдХреА рд╡рдЬрд╣ рд╕реЗ рд╣реА рдЗрд╕рдХреА рдЬрд░реВрд░рдд рд╣реИред  рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рдЕрдиреНрдп рдкрд╛рда рд╕рдВрдкрд╛рджрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рддреЛ mc рд╕реНрдерд╛рдкрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br>  <b>Tor</b> - Tor рд╕реЗрд╡рд╛ред <br>  <b>Tor-geoip</b> - Tor рдХреЗ рд▓рд┐рдП рдЬрд┐рдпреЛ-рдЖрдИрдкреА рдбреЗрдЯрд╛рдмреЗрд╕ред <br>  <b>рдмрд╛рдЗрдВрдб-рдбрд┐рдЧ</b> - DNS рдХреНрд▓рд╛рдЗрдВрдЯ (nslookup рдФрд░ рд╣реЛрд╕реНрдЯ рдХрд╛ рдПрдирд╛рд▓реЙрдЧ)ред <br>  <b>рдХреНрд░реЛрди</b> - рдХрд╛рд░реНрдп рдЕрдиреБрд╕реВрдЪрдХред <br><cut></cut><br><h3>  2. рдкреНрд░рд╛рд░рдВрднрд┐рдХ ipset, рдХрдИ рдЕрдирдмреНрд▓реЙрдХ рдЖрдИрдкреА рдкрддреЗ рдмрдирд╛рдПрдВ (start_script.sh) </h3><br>  рдЖрд╡рд╢реНрдпрдХ рдореЙрдбреНрдпреВрд▓ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ рдФрд░ рд░рд╛рдЙрдЯрд░ рдХреЗ рдмреВрдЯ рд╣реЛрдиреЗ рдкрд░ <b>рдЕрдирдмреНрд▓реЙрдХ</b> рдирд╛рдо рд╕реЗ рдкрддреЛрдВ рдХрд╛ рдПрдХ рдЦрд╛рд▓реА рд╕реЗрдЯ рдмрдирд╛рдПрдВред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕рдВрдкрд╛рджрдХ рдореЗрдВ <b>/etc/storage/start_script.sh</b> рдлрд╝рд╛рдЗрд▓ рдЦреЛрд▓реЗрдВ: <br><br><pre> <code class="bash hljs">mcedit /etc/storage/start_script.sh</code> </pre> <br>  рдЕрдВрдд рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ: <br><br><pre> <code class="bash hljs">modprobe ip_set modprobe ip_set_hash_ip modprobe ip_set_hash_net modprobe ip_set_bitmap_ip modprobe ip_set_list_set modprobe xt_set ipset create unblock <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span>:net</code> </pre> <br>  рдмрдлрд░ рд╕реЗ рдЪрд┐рдкрдХрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, Shift + Insert, рд╕рд╣реЗрдЬреЗрдВ - F2, рдирд┐рдХрд╛рд╕ - F10 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред <br><br><img src="https://habrastorage.org/webt/tr/zp/cq/trzpcqqnadbonhsb0x3ebe7ltpo.png"><br><br>  рдпрджрд┐ рдЖрдк рдЪрд╛рд╣реЗрдВ, рддреЛ рдЖрдк рд░рд╛рдЙрдЯрд░ рдХреЗ рд╡реЗрдм рдЗрдВрдЯрд░рдлреЗрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ start_script.sh рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ - "рдЙрдиреНрдирдд"&gt; "рдирд┐рдЬреАрдХрд░рдг"&gt; "рд▓рд┐рдкрд┐рдпреЛрдВ"&gt; "рд░рд╛рдЙрдЯрд░ рдХреЛ рдЖрд░рдВрднреАрдХреГрдд рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЪрд▓рд╛рдПрдБред"  рд╕рдВрдкрд╛рджрди рдХреЗ рдмрд╛рдж, "рд▓рд╛рдЧреВ рдХрд░реЗрдВ" рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред <br><br><img src="https://habrastorage.org/webt/yr/aa/8q/yraa8qgcfwu-vesrp3wvvne2vui.png"><br><br><h3>  3. рдЯреЛрд░ рд╕реЗрдЯрдЕрдк </h3><br>  рдЯреЛрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рд╣рдЯрд╛рдПрдВ: <br><br><pre> <code class="bash hljs">cat /dev/null &gt; /opt/etc/tor/torrc</code> </pre> <br>  рдЯреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдЦреЛрд▓реЗрдВ: <br><br><pre> <code class="bash hljs">mcedit /opt/etc/tor/torrc</code> </pre> <br>  рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЪрд┐рдкрдХрд╛рдПрдБ (Shift + рдбрд╛рд▓реЗрдВ): <br><br><pre> <code class="bash hljs">User admin PidFile /opt/var/run/tor.pid ExcludeExitNodes {RU},{UA},{AM},{KG},{BY} StrictNodes 1 TransPort 192.168.0.1:9141 ExitRelay 0 ExitPolicy reject *:* ExitPolicy reject6 *:* GeoIPFile /opt/share/tor/geoip GeoIPv6File /opt/share/tor/geoip6 DataDirectory /opt/var/lib/tor</code> </pre> <br>  рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ <b>192.168.0.1</b> рдХреЛ рдЕрдкрдиреЗ рд░рд╛рдЙрдЯрд░ (LAN) рдХреЗ рдЖрдВрддрд░рд┐рдХ рдкрддреЗ рд╕реЗ рдмрджрд▓реЗрдВред  рд╕рдВрдХреНрд╖рд┐рдкреНрдд рд╡рд┐рдиреНрдпрд╛рд╕ рд╡рд┐рд╡рд░рдг: <br><br><ul><li>  рдЖрдЙрдЯрдкреБрдЯ рдиреЛрдбреНрд╕ рдХреЛ рдмрд╛рд╣рд░ рдХрд░реЗрдВ: рд░реВрд╕, рдпреВрдХреНрд░реЗрди, рдЖрд░реНрдореЗрдирд┐рдпрд╛ рдХрд┐рд░реНрдЧрд┐рдЬрд╝рд╕реНрддрд╛рди, рдмреЗрд▓рд╛рд░реВрд╕ред </li><li>  192.168.0.1, рдкреЛрд░реНрдЯ 9141 рдкрддреЗ рдкрд░ рдПрдХ рдкрд╛рд░рджрд░реНрд╢реА рдкреНрд░реЙрдХреНрд╕реА рд▓рдЯрдХрд╛рдПрдВред </li><li>  рдПрдХ рдирд┐рдХрд╛рд╕ рдмрд┐рдВрджреБ рд╣реЛрдиреЗ рд╕реЗ рдЗрдирдХрд╛рд░ рдХрд░рддреЗ рд╣реИрдВред </li></ul><br><h3>  4. рдбреЛрдореЗрди рдХреА рд╕реВрдЪреА (рдФрд░ рди рдХреЗрд╡рд▓) рд▓реЙрдХ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП (рдЕрдирд╡рд░реЛрдзрд┐рддред Txt) </h3><br>  рдЕрдирд╡рд░реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд░рд▓ рд╕реВрдЪреА рд╣реИред  рдЖрдк рдПрдХ рдбреЛрдореЗрди, рдЖрдИрдкреА рдПрдбреНрд░реЗрд╕, рд░реЗрдВрдЬ рдпрд╛ CIDR рдЕрдирд▓реЙрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдПрдХ рдкрдВрдХреНрддрд┐ - рдПрдХ рддрддреНрд╡ред  рд░рд┐рдХреНрдд рд╕реНрдерд╛рди (рд░рд┐рдХреНрдд рд╕реНрдерд╛рди рдФрд░ рдЯреИрдм рд╕рд╣рд┐рдд) рдХреА рдЙрдкреЗрдХреНрд╖рд╛ рдХреА рдЬрд╛рддреА рд╣реИред  рдЖрдк рдЗрд╕реЗ рдЕрдирджреЗрдЦрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкрдВрдХреНрддрд┐ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ # рдЪрд░рд┐рддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдВ / рдЪреБрдиреЗрдВ <b>/etc/unblock.txt</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/etc/unblock.txt</code> </pre> <br>  рдкреНрд░рддреНрдпреЗрдХ рдкрдВрдХреНрддрд┐ рдореЗрдВ рдПрдХ рдбреЛрдореЗрди рдирд╛рдо, IP рдкрддрд╛, рд╢реНрд░реЗрдгреА рдпрд╛ CIDR рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рдЖрдк рд▓рд╛рдЗрдиреЛрдВ рдкрд░ рдЯрд┐рдкреНрдкрдгреА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП # рд╡рд░реНрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br><div class="spoiler">  <b class="spoiler_title">рдпрд╣рд╛рдБ рдореЗрд░реА рд╡реНрдпрдХреНрддрд┐рдЧрдд рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">###- rutracker.org rutor.info rutor.is mega-tor.org kinozal.tv nnm-club.me nnm-club.ws tfile.me tfile-home.org tfile1.cc megatfile.cc megapeer.org megapeer.ru tapochek.net tparser.org tparser.me rustorka.com uniongang.tv fast-torrent.ru ###    rezka.ag hdrezka.ag hdrezka.me filmix.co filmix.cc seasonvar.ru ### lib.rus.ec flibusta.is flibs.me flisland.net flibusta.site ### telegram.org tdesktop.com tdesktop.org tdesktop.info tdesktop.net telesco.pe telegram.dog telegram.me t.me telegra.ph web.telegram.org desktop.telegram.org updates.tdesktop.com venus.web.telegram.org flora.web.telegram.org vesta.web.telegram.org pluto.web.telegram.org aurora.web.telegram.org 149.154.160.0/20 91.108.4.0/22 91.108.8.0/22 91.108.12.0/22 91.108.16.0/22 91.108.56.0/22 109.239.140.0/24 67.198.55.0/24 ### 7-zip.org edem.tv 4pna.com 2019.vote ### Tor check.torproject.org ###   IP ( #   ) #195.82.146.214 ###   CIDR ( #   ) #103.21.244.0/22 ###    ( #   ) #100.100.100.200-100.100.100.210</span></span></code> </pre> <br></div></div><br><h3>  5. рдбреЛрдореЗрди рдХреА рджреА рдЧрдИ рд╕реВрдЪреА рдХреА рдЕрдирдмреНрд▓реЙрдХ IP рдкрддреЛрдВ рдХреЗ рдПрдХ рд╕рдореВрд╣ рдХреЛ рдкреЙрдкреНрдпреБрд▓реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ (рдЕрдирд╡рд░реЛрдзрд┐рдд_ipset.sh) </h3><br>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдмрдирд╛рдПрдВ / <b>рдЕрдкрдирд╛рдПрдВ /bin/unblock_ipset.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_ipset.sh</code> </pre> <br>  рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЪрд┐рдкрдХрд╛рдПрдБ (Shift + рдбрд╛рд▓реЗрдВ): <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh until ADDRS=$(dig +short google.com @localhost) &amp;&amp; [ -n "$ADDRS" ] &gt; /dev/null 2&gt;&amp;1; do sleep 5; done while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue cidr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/[0-9]{1,2}') if [ ! -z "$cidr" ]; then ipset -exist add unblock $cidr continue fi range=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}-[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$range" ]; then ipset -exist add unblock $range continue fi addr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$addr" ]; then ipset -exist add unblock $addr continue fi dig +short $line @localhost | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | awk '{system("ipset -exist add unblock "$1)}' done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br>  рдирд┐рд╖реНрдкрд╛рджрди рдЕрдзрд┐рдХрд╛рд░ рджреЗрдВ: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_ipset.sh</code> </pre> <br>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛рдлреА рд╕рд░рд▓ рд╣реИ, рдЗрд╕рдХреЗ рдХрд╛рдо рдХрд╛ рд╕рд╛рд░ ... рд╣рдо рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП google.com рдбреЛрдореЗрди рд░рд┐рдЬрд╝реЙрд▓реНрдпреВрд╢рди рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░ рд░рд╣реЗ рд╣реИрдВ (рдпрджрд┐ рдРрд╕рд╛ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд░рд╛рдЙрдЯрд░ рдмреВрдЯ рд╣реЛрдиреЗ рдкрд░ рдмрд╣реБрдд рд╕реА рдЕрдирдмреНрд▓реЙрдХ рдирд╣реАрдВ рднрд░реА рдЬрд╛рдПрдЧреА, рдХреНрдпреЛрдВрдХрд┐ рд░рд╛рдЙрдЯрд░ рдЕрднреА рднреА рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╣реЛрдЧрд╛)ред  рд╣рдо рдЕрдирдмреНрд▓реЙрдХред рдЯреЗрдХреНрд╕реНрдЯ рдлрд╝рд╛рдЗрд▓ рдХреА рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рдкрдврд╝рддреЗ рд╣реИрдВред  рд╢реБрд░реБрдЖрдд рдФрд░ рдЕрдВрдд рдореЗрдВ рд░рд┐рдХреНрдд рд╕реНрдерд╛рди рдФрд░ рдЯреИрдм рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╣рдЯрд╛рдПрдВ рд▓рд╛рдЗрдиреЗрдВ рдкрдврд╝реЗрдВред  рдЦрд╛рд▓реА рд▓рд╛рдЗрдиреЛрдВ рдХреЛ рдЫреЛрдбрд╝ рджреЗрдВред  # рд╡рд░реНрдг рд╕реЗ рд╢реБрд░реВ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рд░реЗрдЦрд╛рдУрдВ рдХреЛ рдЫреЛрдбрд╝реЗрдВред  рд╣рдо рд▓рд╛рдЗрди CIDR рдореЗрдВ рджреЗрдЦ рд░рд╣реЗ рд╣реИрдВред  рдпрджрд┐ CIDR рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдЕрдирдмреНрд▓реЙрдХ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВред  рд╣рдо рд╕реНрдЯреНрд░рд┐рдВрдЧ рдореЗрдВ рдПрдХ рд╕реАрдорд╛ рдХреА рддрд▓рд╛рд╢ рдХрд░ рд░рд╣реЗ рд╣реИрдВред  рдпрджрд┐ рдпрд╣ рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдЕрдирдмреНрд▓реЙрдХ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВред  рд╣рдо рд╕реНрдЯреНрд░рд┐рдВрдЧ рдореЗрдВ рдЖрдИрдкреА рдкрддреЗ рдХреА рддрд▓рд╛рд╢ рдХрд░ рд░рд╣реЗ рд╣реИрдВред  рдпрджрд┐ рдЖрдИрдкреА рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдЕрдирдмреНрд▓реЙрдХ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВред  рдЪрд▓реЛ рдЦреБрджрд╛рдИ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рд░реЗрдЦрд╛ рдХреЛ рд╣рд▓ рдХрд░рддреЗ рд╣реИрдВред  рдкрд░рд┐рдгрд╛рдо рдХреЗ рд╕рднреА рдЖрдИрдкреА рдкрддреЗ рдЕрдирдмреНрд▓реЙрдХ рдореЗрдВ рдЬреЛрдбрд╝реЗ рдЬрд╛рддреЗ рд╣реИрдВред <br><br><h3>  6. рдбреЛрдореЗрди рдХреА рджреА рдЧрдИ рд╕реВрдЪреА рд╕реЗ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд dnsmasq рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ (рдЕрдирд╡рд░реЛрдзрд┐рдд_dnsmasq.sh) </h3><br>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдмрдирд╛рдПрдВ / <b>рдЕрдкрдирд╛рдПрдВ /bin/unblock_dnsmasq.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_dnsmasq.sh</code> </pre> <br>  рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЪрд┐рдкрдХрд╛рдПрдБ (Shift + рдбрд╛рд▓реЗрдВ): <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh cat /dev/null &gt; /opt/etc/unblock.dnsmasq while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue echo $line | grep -Eq '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' &amp;&amp; continue echo "ipset=/$line/unblock" &gt;&gt; /opt/etc/unblock.dnsmasq done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br>  рдирд┐рд╖реНрдкрд╛рджрди рдЕрдзрд┐рдХрд╛рд░ рджреЗрдВ: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_dnsmasq.sh</code> </pre> <br>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛рдлреА рд╕рд░рд▓ рд╣реИ, рдЗрд╕рдХреЗ рдХрд╛рдо рдХрд╛ рд╕рд╛рд░ ... рд╣рдордиреЗ рдХреНрд░рдорд┐рдХ рд░реВрдк рд╕реЗ /opt/etc/unblock.txt рд╕реЗ рд▓рд╛рдЗрдиреЗрдВ рдкрдврд╝реА рд╣реИрдВред  рд╢реБрд░реБрдЖрдд рдФрд░ рдЕрдВрдд рдореЗрдВ рд░рд┐рдХреНрдд рд╕реНрдерд╛рди рдФрд░ рдЯреИрдм рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╣рдЯрд╛рдПрдВ рд▓рд╛рдЗрдиреЗрдВ рдкрдврд╝реЗрдВред  рдЦрд╛рд▓реА рд▓рд╛рдЗрдиреЛрдВ рдХреЛ рдЫреЛрдбрд╝ рджреЗрдВред  # рд╕реЗ рд╢реБрд░реВ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рд▓рд╛рдЗрдиреЛрдВ рдХреЛ рдЫреЛрдбрд╝ рджреЗрдВред  рд╣рдо рдЙрди рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рдЫреЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВ рдЬрд┐рдирдореЗрдВ IP рдкрддрд╛ (IP, рд╢реНрд░реЗрдгреА, CIDR) рд╣реЛрддрд╛ рд╣реИ, рдЕрд░реНрдерд╛рдд  рд╣рдо рдХреЗрд╡рд▓ рдбреЛрдореЗрди рдирд╛рдо рдХреЗ рд╕рд╛рде рддрд╛рд░ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВред  рдлрд╝рд╛рдЗрд▓ /opt/etc/unblock.dnsmasq рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╣рдо "ipset = / domain_name / рдЕрдирд╡рд░реЛрдзрд┐рдд рдХрд░реЗрдВ" рдлрд╝реЙрд░реНрдо рдХреА рдкрдВрдХреНрддрд┐рдпрд╛рдБ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рдбреЛрдореЗрди рдХреЗ рдЖрдИрдкреА рдкрддреЗ рдХрд╛ рдирд┐рд░реНрдзрд╛рд░рдг рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╡реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЕрдирдмреНрд▓реЙрдХ рд╕реЗрдЯ рдореЗрдВ рдЬреБрдбрд╝ рдЬрд╛рдПрдВрдЧреЗред <br><br>  рдЕрдирд╡рд░реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВред <br><br><pre> <code class="bash hljs">unblock_dnsmasq.sh</code> </pre> <br>  рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реЗрдВ рдХрд┐ unblock.dnsmasq рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдИ рдЧрдИ рд╣реИ: <br><br><pre> <code class="bash hljs">cat /opt/etc/unblock.dnsmasq</code> </pre> <br><h3>  7. рдбреЛрдореЗрди рдХреА рд╕реВрдЪреА рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореИрдиреБрдЕрд▓ рдХреА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдордЬрдмреВрд░ рдХрд░рдирд╛ (рдЕрдирд╡рд░реЛрдзрд┐рдд_рдЕрдкрдбреЗрдЯ)ред </h3><br>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдмрдирд╛рдПрдВ / <b>рдЕрдкрдирд╛рдПрдВ /bin/unblock_update.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_update.sh</code> </pre> <br>  рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЪрд┐рдкрдХрд╛рдПрдБ (Shift + рдбрд╛рд▓реЗрдВ): <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh ipset flush unblock /opt/bin/unblock_dnsmasq.sh restart_dhcpd sleep 3 /opt/bin/unblock_ipset.sh &amp;</span></span></code> </pre> <br>  рдирд┐рд╖реНрдкрд╛рджрди рдЕрдзрд┐рдХрд╛рд░ рджреЗрдВ: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_update.sh</code> </pre> <br><h3>  8. рд░рд╛рдЙрдЯрд░ рдХреЛ рдмреВрдЯ рдХрд░рддреЗ рд╕рдордп рдЕрдирдмреНрд▓реЙрдХ рдХрд╛ рдПрдХ рд╕реЗрдЯ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдкреЙрдкреНрдпреБрд▓реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдХреНрд░рд┐рдкреНрдЯ (S99unblock) </h3><br>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдмрдирд╛рдПрдВ / <b>рдЕрдкрдирд╛рдПрдВ /etc/init.d/S99unblock</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/etc/init.d/S99unblock</code> </pre> <br>  рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЪрд┐рдкрдХрд╛рдПрдБ (Shift + рдбрд╛рд▓реЗрдВ): <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh [ "$1" != "start" ] &amp;&amp; exit 0 /opt/bin/unblock_ipset.sh &amp;</span></span></code> </pre><br>  рдирд┐рд╖реНрдкрд╛рджрди рдЕрдзрд┐рдХрд╛рд░ рджреЗрдВ: <br><br><pre> <code class="bash hljs">chmod +x /opt/etc/init.d/S99unblock</code> </pre> <br><h3>  9. рдЕрдирдмреНрд▓реЙрдХ рд╕реЗ рдЯреЛрд░ рддрдХ рдХреЗ рдкреЛрд╕реНрдЯ рдХреЗ рд╕рд╛рде рдкреИрдХреЗрдЯ рдЕрдЧреНрд░реЗрд╖рд┐рдд рдХрд░рдирд╛ (post_iptables_script.sh) </h3><br>  рд╕рдВрдкрд╛рджрдХ рдореЗрдВ рдлрд╝рд╛рдЗрд▓ <b>/etc/storage/post_iptables_script.sh</b> рдЦреЛрд▓реЗрдВ: <br><br><pre> <code class="bash hljs">mcedit /etc/storage/post_iptables_script.sh</code> </pre> <br>  рдЕрдВрдд рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ: <br><br><pre> <code class="bash hljs">iptables -t nat -A PREROUTING -i br0 -p tcp -m <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> --match-set unblock dst -j REDIRECT --to-port 9141</code> </pre> <br><img src="https://habrastorage.org/webt/af/u2/dl/afu2dld3v0nrhtjwfekvo6i-wsi.png"><br><br>  рдпрджрд┐ рдЖрдк рдЪрд╛рд╣реЗрдВ, рддреЛ рдЖрдк рд░реВрдЯрд░ рдХреЗ рд╡реЗрдм рдЗрдВрдЯрд░рдлреЗрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ post_iptables_script.sh рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ - "рдЙрдиреНрдирдд"&gt; "рдирд┐рдЬреАрдХрд░рдг"&gt; "рд╕реНрдХреНрд░рд┐рдкреНрдЯ"&gt; "рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдореЛрдВ рдХреЛ рдлрд┐рд░ рд╕реЗ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЪрд▓рд╛рдПрдБ"ред  рд╕рдВрдкрд╛рджрди рдХреЗ рдмрд╛рдж, "рд▓рд╛рдЧреВ рдХрд░реЗрдВ" рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред <br><br><img src="https://habrastorage.org/webt/pv/be/ot/pvbeotspo0xhzrukgp3dgvu5aws.png"><br><br>  рдЖрдк рдмрд╛рд╣рд░реА рдкреЛрд░реНрдЯ 53 рд╕реЗ рдЕрдкрдиреЗ рдЖрдк рдХреЛ рд╕рднреА рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╣реА рдлрд╝рд╛рдЗрд▓ рдореЗрдВ (рдпрд╣ рд╡реИрдХрд▓реНрдкрд┐рдХ рд╣реИ) рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рддрд╛рдХрд┐ рд╕реНрдерд╛рдиреАрдп рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдХреНрд▓рд╛рдЗрдВрдЯ рддреГрддреАрдп-рдкрдХреНрд╖ DNS рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рди рдХрд░реЗрдВред  рдЕрдиреБрд░реЛрдз рдирд┐рдпрдорд┐рдд DNS рд╕рд░реНрд╡рд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬрд╛рдПрдВрдЧреЗред <br><br><pre> <code class="bash hljs">iptables -t nat -I PREROUTING -i br0 -p udp --dport 53 -j DNAT --to 192.168.0.1 iptables -t nat -I PREROUTING -i br0 -p tcp --dport 53 -j DNAT --to 192.168.0.1</code> </pre> <br>  рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ <b>192.168.0.1</b> рдХреЛ рдЕрдкрдиреЗ рд░рд╛рдЙрдЯрд░ (LAN) рдХреЗ рдЖрдВрддрд░рд┐рдХ рдкрддреЗ рд╕реЗ рдмрджрд▓реЗрдВред <br><br><h3>  10. рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЛ dnsmasq рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдирд╛ </h3><br>  рд╣рдореЗрдВ рдмрдирд╛рдИ рдЧрдИ рдЕрдирдмреНрд▓реЙрдХ.dnsmasq рдлрд╝рд╛рдЗрд▓ рдХреЛ dnsmasq рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕рдВрдкрд╛рджрдХ рдореЗрдВ рдлрд╝рд╛рдЗрд▓ <b>/etc/storage/dnsmasq/dnsmasq.conf</b> рдЦреЛрд▓реЗрдВ: <br><br><pre> <code class="bash hljs">mcedit /etc/storage/dnsmasq/dnsmasq.conf</code> </pre> <br>  рдЕрдВрдд рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ: <br><br><pre> <code class="bash hljs">conf-file=/opt/etc/unblock.dnsmasq</code> </pre> <br>  рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ (рдпрд╣ рд╡реИрдХрд▓реНрдкрд┐рдХ рд╣реИ), рддреЛ рдЖрдк рд░рд┐рдЬрд╝реЙрд▓реНрдпреВрд╢рди рдФрд░ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕рд░реНрд╡рд░ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><pre> <code class="bash hljs">server=8.8.8.8</code> </pre> <br>  рдпрджрд┐ рдЖрдк рдЪрд╛рд╣реЗрдВ, рддреЛ рдЖрдк рд░реВрдЯрд░ рдХреЗ рд╡реЗрдм рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ dnsmasq.conf рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ - "рдЙрдиреНрдирдд"&gt; "LAN"&gt; "рдбреАрдПрдЪрд╕реАрдкреА рд╕рд░реНрд╡рд░"&gt; "рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ dnsmasq.conf"ред  рд╕рдВрдкрд╛рджрди рдХреЗ рдмрд╛рдж, "рд▓рд╛рдЧреВ рдХрд░реЗрдВ" рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред <br><br><img src="https://habrastorage.org/webt/x0/ar/4c/x0ar4cm6v9pgsluqabh74qck-s0.png"><br><br><h3>  11. рд╕рдордп-рд╕рдордп рдкрд░ рдЕрдирдмреНрд▓реЙрдХ рд╕реЗрдЯ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд░реЛрди рдкрд░ рдПрдХ рдХрд╛рд░реНрдп рдЬреЛрдбрд╝рдирд╛ </h3><br>  рдпрд╣ рдЕрддрд┐рд░рд┐рдХреНрдд рдмреАрдорд╛ рд╣реИ рдпрджрд┐ рдкреНрд░реЛрдЧреНрд░рд╛рдо / рдбрд┐рд╡рд╛рдЗрд╕ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рд░рд┐рдЬрд╝реЙрд▓реНрдпреВрд╢рди рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдбреЛрдореЗрди рдЖрдИрдкреА рдкрддрд╛ рдмрджрд▓ рдЧрдпрд╛ рд╣реИред  рдЖрдкрдХреЛ рдХреЗрд╡рд▓ рд╡рд╛рдВрдЫрд┐рдд рдЖрд╡реГрддреНрддрд┐ рдкрд░ рдЕрдирдмреНрд▓реЙрдХ_рд▓рд┐рдкреНрд╕.рд╢ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдо рд╣рд░ рджрд┐рди рд╕реБрдмрд╣ 6 рдмрдЬреЗ рд▓реЙрдиреНрдЪ рдХрд░реЗрдВрдЧреЗред <br><br>  рдХреНрд░реЛрди рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдХреЗ рд╕рд╛рде рд░реВрдЯ рдирд╛рдо рдмрджрд▓реЗрдВ: <br><br><pre> <code class="bash hljs">sed -i <span class="hljs-string"><span class="hljs-string">'s/root/admin/g'</span></span> /opt/etc/crontab</code> </pre> <br>  рдлрд╝рд╛рдЗрд▓ рдЦреЛрд▓реЗрдВ <b>/</b> рд╕рдВрдкрд╛рджрдХ рдореЗрдВ <b>/ etc / crontab</b> рдЦреЛрд▓реЗрдВ: <br><br><pre> <code class="bash hljs">mcedit /opt/etc/crontab</code> </pre> <br>  рдЕрдВрдд рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ: <br><br><pre> <code class="bash hljs">00 06 * * * admin /opt/bin/unblock_ipset.sh</code> </pre> <br>  рдпрджрд┐ рдЖрдк рдЪрд╛рд╣реЗрдВ, рддреЛ рдЖрдк рдЕрдиреНрдп рд╕рднреА рдЯреЗрдореНрдкрд▓реЗрдЯ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдЯрд┐рдкреНрдкрдгреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣рд╛рдБ рдХреНрдпрд╛ рдЖрдкрдХреЗ crontab рдлрд╝рд╛рдЗрд▓ рдХреА рддрд░рд╣ рджрд┐рдЦреЗрдЧрд╛: <br><br><img src="https://habrastorage.org/webt/hf/lb/fc/hflbfcv04lpvzlrjmehoc3l51ts.png"><br><br><h3>  12. рд░рд╛рдЙрдЯрд░ рдХреЛ рд░рд┐рдмреВрдЯ рдХрд░рдирд╛ </h3><br>  рдХрдорд╛рдВрдб рдЪрд▓рд╛рдПрдБ: <br><br><pre> <code class="bash hljs">reboot</code> </pre> <br>  рд░рд┐рдмреВрдЯ рдХреЗ рдмрд╛рдж, рдЕрдкрдиреЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ check.torproject.org рд╡реЗрдмрд╕рд╛рдЗрдЯ рдЦреЛрд▓реЗрдВ (рдЗрд╕реЗ рдЕрдирдмреНрд▓реЙрдХ.txt рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП)ред  рдпрджрд┐ рдЖрдкрдиреЗ рд╕рдм рдХреБрдЫ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд┐рдпрд╛ рд╣реИ, рддреЛ рдЖрдк рд╢рд┐рд▓рд╛рд▓реЗрдЦ "рдмрдзрд╛рдИ" рджреЗрдЦреЗрдВрдЧреЗред  рдпрд╣ рдмреНрд░рд╛рдЙрдЬрд╝рд░ Tor рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред ": <br><br><img src="https://habrastorage.org/webt/wa/19/dz/wa19dzxbu8qtldwrvkeijfqna7q.png"><br><br><br><a name="con3"></a><h1>  рдХреАрдиреЗрдЯрд┐рдХ рдУрдПрд╕ рдХреЗ рд╕рд╛рде рдПрдХ рд░рд╛рдЙрдЯрд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ </h1><br>  рдЖрдкрдХреЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП Entware Package Manager (OPKG) рдХреЗ рд╕рд╛рде рдПрдХ рдХреАрдиреЗрдЯрд┐рдХ / Zyxel рд░рд╛рдЙрдЯрд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрд╣рд╛рдВ рдХреБрдЫ рд░рд╛рдЙрдЯрд░реНрд╕ рдХреА рдПрдХ рд╕реВрдЪреА рджреА рдЧрдИ рд╣реИ рдЬреЛ рдПрдВрдЯрд╡реЗрдпрд░ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреЗ рд╣реИрдВ: рдХреАрдиреЗрдЯрд┐рдХ II, рдХреАрдиреЗрдЯрд┐рдХ III, рдЕрддрд┐рд░рд┐рдХреНрдд, рдЕрддрд┐рд░рд┐рдХреНрдд II, рдЧреАрдЧрд╛ II, рдЧреАрдЧрд╛ III, рдУрдордиреА, рдУрдордиреА II, рдЪрд┐рд░рд╛рдпреБ, рдЕрд▓реНрдЯреНрд░рд╛, рдЕрд▓реНрдЯреНрд░рд╛ II, рдУрдордиреА (KN-1410), рдЕрддрд┐рд░рд┐рдХреНрдд (KN -1710), рдЧреАрдЧрд╛ (KN-1010), рдЕрд▓реНрдЯреНрд░рд╛ (KN-1810), рд╡рд┐рд╡рд╛ (KN-1910), DSL (KN-2010), рдбреБрдУ (KN-2110)ред  рдПрдВрдЯрд░рд╡реЗрдпрд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рдирд┐рд░реНрджреЗрд╢ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдВ</a> (10 рдЕрдВрдХ рддрдХ) рдорд┐рд▓ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдпрджрд┐ рдкрд╣рд▓реЗ (2.07 рдХреЗ рддрд╣рдд рдлрд░реНрдорд╡реЗрдпрд░ рдХреЗ рд╕рд╛рде) рдЖрдкрдиреЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдВрдЯрд╡реЗрдпрд░ рд╕рдорд░реНрдерди рдЬреЛрдбрд╝рд╛ рд╣реИ, рддреЛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЖрдк <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреБрд░рд╛рдиреЗ рдПрдВрдЯрд╡реЗрдпрд░-рдПрдирдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ</a> рдХрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд░рд╣реЗ рд╣реИрдВ</a> ред <br><br>  "рдиреЗрдЯрдлрд┐рд▓реНрдЯрд░ рд╕рдмрд╕рд┐рд╕реНрдЯрдо рдХрд░реНрдиреЗрд▓ рдореЙрдбреНрдпреВрд▓" рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдирд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ - рд╕рд╛рдорд╛рдиреНрдп рд╕реЗрдЯрд┐рдВрдЧреНрд╕&gt; рдШрдЯрдХ рд╕реЗрдЯ рдмрджрд▓реЗрдВред  рдпрджрд┐ рдпрд╣ рдЙрдкрд▓рдмреНрдз рд▓реЛрдЧреЛрдВ рдХреА рд╕реВрдЪреА рдореЗрдВ рдирд╣реАрдВ рд╣реИ, рддреЛ рдкрд╣рд▓реЗ IPv6 рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдШрдЯрдХ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред  рдпрджрд┐ рдЗрд╕рдХреЗ рдмрд╛рдж рджрд┐рдЦрд╛рдИ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИ, рддреЛ рдЗрд╕рдХреЗ рдмрд┐рдирд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рдЕрддреНрдпрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдЖрдк рд░реЗрдВрдЬ рдФрд░ CIDR рджреНрд╡рд╛рд░рд╛ рдЕрдирд▓реЙрдХ рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗ (рдХреНрдпреЛрдВрдХрд┐ рд╣реИрд╢: рдиреЗрдЯ рд╕реЗрдЯ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рд╕рдорд░реНрдерди рдирд╣реАрдВ рд╣реЛрдЧрд╛)ред <br><br><img src="https://habrastorage.org/webt/vv/dh/hi/vvdhhirhcktuefrgbxh3fkx5i0i.png"><br><br>  рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ рдирд╡реАрдирддрдо рдлрд░реНрдорд╡реЗрдпрд░ - 2.14.C.0.0-4 рдХреЗ рд╕рд╛рде рдХреАрдиреЗрдЯрд┐рдХ рдЕрд▓реНрдЯреНрд░рд╛ (KN-1810) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред <br><br>  <u>рдорд╣рддреНрд╡рдкреВрд░реНрдг рдиреЛрдЯред</u>  <u>рдЖрдкрдХреЛ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдирд┐рдпрдорд┐рдд DNS рд╕рд░реНрд╡рд░ рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рд╣рдо рдЗрд╕рдХреЗ рдмрдЬрд╛рдп dnsmasq рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред</u>  <u>рдЖрдк рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рд▓рд┐рдП рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ DNS рд╕реЗрд╡рд╛рдУрдВ (Yandex.DNS / SkyDNS / AdGuard DNS) рдХреЛ рдЕрд╕рд╛рдЗрди рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдЦреЛ рджреЗрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ рддреЛ рдЖрдк dnsmasq рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдиреНрд╣реЗрдВ рд╡рд┐рд╢реНрд╡ рд╕реНрддрд░ рдкрд░ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</u> <br><br><h3>  1. рд░рд╛рдЙрдЯрд░ рдкрд░ рдЖрд╡рд╢реНрдпрдХ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ </h3><br><pre> <code class="bash hljs">opkg update opkg install mc tor tor-geoip <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span>-dig cron dnsmasq-full ipset iptables</code> </pre> <br>  <b>mc</b> - рдорд┐рдбрдирд╛рдЗрдЯ рдХрдорд╛рдВрдбрд░ рдлрд╝рд╛рдЗрд▓ рдореИрдиреЗрдЬрд░ред  рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдореИрдбрд┐рдЯ рдПрдбрд┐рдЯрд░ рдХреА рд╡рдЬрд╣ рд╕реЗ рд╣реА рдЗрд╕рдХреА рдЬрд░реВрд░рдд рд╣реИред  рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рдЕрдиреНрдп рдкрд╛рда рд╕рдВрдкрд╛рджрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рддреЛ mc рд╕реНрдерд╛рдкрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br>  <b>Tor</b> - Tor рд╕реЗрд╡рд╛ред <br>  <b>Tor-geoip</b> - Tor рдХреЗ рд▓рд┐рдП рдЬрд┐рдпреЛ-рдЖрдИрдкреА рдбреЗрдЯрд╛рдмреЗрд╕ред <br>  <b>рдмрд╛рдЗрдВрдб-рдбрд┐рдЧ</b> - DNS рдХреНрд▓рд╛рдЗрдВрдЯ (nslookup рдФрд░ рд╣реЛрд╕реНрдЯ рдХрд╛ рдПрдирд╛рд▓реЙрдЧ)ред <br>  <b>рдХреНрд░реЛрди</b> - рдХрд╛рд░реНрдп рдЕрдиреБрд╕реВрдЪрдХред <br>  <b>dnsmasq-full</b> - DNS рд╕рд░реНрд╡рд░ред <br>  <b>ipset рдФрд░ iptables ipset рдФрд░ iptables</b> рдХрдВрд╕реЛрд▓ рдЙрдкрдпреЛрдЧрд┐рддрд╛рдУрдВ рд╣реИрдВ (рд╡реЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕рд┐рд╕реНрдЯрдо рдкрд░ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЬрд╝рд░реВрд░рдд рдирд╣реАрдВ рд╣реИ, рдореИрдВрдиреЗ рдЙрдиреНрд╣реЗрдВ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП рдЬреЛрдбрд╝рд╛)ред <br><br><h3>  2. рдкреНрд░рд╛рд░рдВрднрд┐рдХ ipset, рдХрдИ рдЕрдирдмреНрд▓реЙрдХ рдЖрдИрдкреА рдкрддреЗ рдмрдирд╛рдПрдВ (100-ipset.sh) </h3><br>  рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдЖрдкрдХрд╛ рд░рд╛рдЙрдЯрд░ рд╕рд┐рд╕реНрдЯрдо рдмрд╣реБрдд рд╕реЗ рд╣реИрд╢ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ: рдиреЗрдЯ (рдЬреИрд╕рд╛ рдХрд┐ рдпрд╣ рдирд┐рдХрд▓рд╛, рд╕рднреА рдХреАрдиреЗрдЯрд┐рдХ рд░рд╛рдЙрдЯрд░ рдХреЗ рдкрд╛рд╕ рдирд╣реАрдВ рд╣реИ): <br><br><pre> <code class="bash hljs">ipset create <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span>:net</code> </pre> <br>  рдпрджрд┐ рдЯреАрдо рдиреЗ рдХреЛрдИ рддреНрд░реБрдЯрд┐ рдпрд╛ рд╕рдВрджреЗрд╢ рдирд╣реАрдВ рджрд┐рдпрд╛, рддреЛ рд╕рдорд░реНрдерди рд╣реИ, рдФрд░ рдЖрдЧреЗ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВред  рдЕрдиреНрдпрдерд╛ (рдирд┐рдореНрди рдореЗрдВ рдХреЛрдИ рддреНрд░реБрдЯрд┐ рд╣реИ) рдирд┐рдореНрди рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ, рдЖрдкрдХреЛ <b>рд╣реИрд╢: рдиреЗрдЯ</b> рдХреЛ <b>рд╣реИрд╢: рдЖрдИрдкреА</b> рд╕реЗ рдмрджрд▓рдирд╛ рд╣реЛрдЧрд╛ред  рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдЖрдк рд░реЗрдВрдЬ рдФрд░ CIDR рдХреЛ рдЕрдирд▓реЙрдХ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдЦреЛ рджреЗрддреЗ рд╣реИрдВред <br><br>  рд░рд╛рдЙрдЯрд░ рдХреЗ рдмреВрдЯ рд╣реЛрдиреЗ рдкрд░ <b>рдЕрдирдмреНрд▓реЙрдХ</b> рдирд╛рдордХ рдкрддреЛрдВ рдХрд╛ рдПрдХ рдЦрд╛рд▓реА рд╕реЗрдЯ рдмрдирд╛рдПрдВред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдлрд╝рд╛рдЗрд▓ <b>/opt/etc/ndm/fs.d/100-ipset.sh рдмрдирд╛рдПрдБ</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/etc/ndm/fs.d/100-ipset.sh</code> </pre> <br>  рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЪрд┐рдкрдХрд╛рдПрдБ (Shift + рдбрд╛рд▓реЗрдВ): <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh [ "$1" != "start" ] &amp;&amp; exit 0 ipset create unblock hash:net -exist exit 0</span></span></code> </pre> <br>  рдмрдлрд░ рд╕реЗ рдЪрд┐рдкрдХрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, Shift + Insert, рд╕рд╣реЗрдЬреЗрдВ - F2, рдирд┐рдХрд╛рд╕ - F10 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред <br><br>  рдирд┐рд╖реНрдкрд╛рджрди рдЕрдзрд┐рдХрд╛рд░ рджреЗрдВ: <br><br><pre> <code class="bash hljs">chmod +x /opt/etc/ndm/fs.d/100-ipset.sh</code> </pre> <br><h3>  3. рдЯреЛрд░ рд╕реЗрдЯрдЕрдк </h3><br>  рдЯреЛрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рд╣рдЯрд╛рдПрдВ: <br><br><pre> <code class="bash hljs">cat /dev/null &gt; /opt/etc/tor/torrc</code> </pre> <br>  рдЯреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдЦреЛрд▓реЗрдВ: <br><br><pre> <code class="bash hljs">mcedit /opt/etc/tor/torrc</code> </pre> <br>  рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЪрд┐рдкрдХрд╛рдПрдБ (Shift + рдбрд╛рд▓реЗрдВ): <br><br><pre> <code class="bash hljs">User root PidFile /opt/var/run/tor.pid ExcludeExitNodes {RU},{UA},{AM},{KG},{BY} StrictNodes 1 TransPort 192.168.0.1:9141 ExitRelay 0 ExitPolicy reject *:* ExitPolicy reject6 *:* GeoIPFile /opt/share/tor/geoip GeoIPv6File /opt/share/tor/geoip6 DataDirectory /opt/var/lib/tor</code> </pre> <br>  рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ <b>192.168.0.1</b> рдХреЛ рдЕрдкрдиреЗ рд░рд╛рдЙрдЯрд░ (LAN) рдХреЗ рдЖрдВрддрд░рд┐рдХ рдкрддреЗ рд╕реЗ рдмрджрд▓реЗрдВред  рд╕рдВрдХреНрд╖рд┐рдкреНрдд рд╡рд┐рдиреНрдпрд╛рд╕ рд╡рд┐рд╡рд░рдг: <br><br><ul><li>  рдЖрдЙрдЯрдкреБрдЯ рдиреЛрдбреНрд╕ рдХреЛ рдмрд╛рд╣рд░ рдХрд░реЗрдВ: рд░реВрд╕, рдпреВрдХреНрд░реЗрди, рдЖрд░реНрдореЗрдирд┐рдпрд╛ рдХрд┐рд░реНрдЧрд┐рдЬрд╝рд╕реНрддрд╛рди, рдмреЗрд▓рд╛рд░реВрд╕ред </li><li>  192.168.0.1, рдкреЛрд░реНрдЯ 9141 рдкрддреЗ рдкрд░ рдПрдХ рдкрд╛рд░рджрд░реНрд╢реА рдкреНрд░реЙрдХреНрд╕реА рд▓рдЯрдХрд╛рдПрдВред </li><li>  рдПрдХ рдирд┐рдХрд╛рд╕ рдмрд┐рдВрджреБ рд╣реЛрдиреЗ рд╕реЗ рдЗрдирдХрд╛рд░ рдХрд░рддреЗ рд╣реИрдВред </li></ul><br><h3>  4. рдбреЛрдореЗрди рдХреА рд╕реВрдЪреА (рдФрд░ рди рдХреЗрд╡рд▓) рд▓реЙрдХ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП (рдЕрдирд╡рд░реЛрдзрд┐рддред Txt) </h3><br>  рдЕрдирд╡рд░реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд░рд▓ рд╕реВрдЪреА рд╣реИред  рдЖрдк рдПрдХ рдбреЛрдореЗрди, рдЖрдИрдкреА рдПрдбреНрд░реЗрд╕, рд░реЗрдВрдЬ рдпрд╛ CIDR рдЕрдирд▓реЙрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдПрдХ рдкрдВрдХреНрддрд┐ - рдПрдХ рддрддреНрд╡ред  рд░рд┐рдХреНрдд рд╕реНрдерд╛рди (рд░рд┐рдХреНрдд рд╕реНрдерд╛рди рдФрд░ рдЯреИрдм рд╕рд╣рд┐рдд) рдХреА рдЙрдкреЗрдХреНрд╖рд╛ рдХреА рдЬрд╛рддреА рд╣реИред  рдЖрдк рдЗрд╕реЗ рдЕрдирджреЗрдЦрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкрдВрдХреНрддрд┐ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ # рдЪрд░рд┐рддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдВ / рдЪреБрдиреЗрдВ <b>/etc/unblock.txt</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/etc/unblock.txt</code> </pre> <br>  рдкреНрд░рддреНрдпреЗрдХ рдкрдВрдХреНрддрд┐ рдореЗрдВ рдПрдХ рдбреЛрдореЗрди рдирд╛рдо, IP рдкрддрд╛, рд╢реНрд░реЗрдгреА рдпрд╛ CIDR рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рдЖрдк рд▓рд╛рдЗрдиреЛрдВ рдкрд░ рдЯрд┐рдкреНрдкрдгреА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП # рд╡рд░реНрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br><div class="spoiler">  <b class="spoiler_title">рдпрд╣рд╛рдБ рдореЗрд░реА рд╡реНрдпрдХреНрддрд┐рдЧрдд рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">###- rutracker.org rutor.info rutor.is mega-tor.org kinozal.tv nnm-club.me nnm-club.ws tfile.me tfile-home.org tfile1.cc megatfile.cc megapeer.org megapeer.ru tapochek.net tparser.org tparser.me rustorka.com uniongang.tv fast-torrent.ru ###    rezka.ag hdrezka.ag hdrezka.me filmix.co filmix.cc seasonvar.ru ### lib.rus.ec flibusta.is flibs.me flisland.net flibusta.site ### telegram.org tdesktop.com tdesktop.org tdesktop.info tdesktop.net telesco.pe telegram.dog telegram.me t.me telegra.ph web.telegram.org desktop.telegram.org updates.tdesktop.com venus.web.telegram.org flora.web.telegram.org vesta.web.telegram.org pluto.web.telegram.org aurora.web.telegram.org 149.154.160.0/20 91.108.4.0/22 91.108.8.0/22 91.108.12.0/22 91.108.16.0/22 91.108.56.0/22 109.239.140.0/24 67.198.55.0/24 ### 7-zip.org edem.tv 4pna.com 2019.vote ### Tor check.torproject.org ###   IP ( #   ) #195.82.146.214 ###   CIDR ( #   ) #103.21.244.0/22 ###    ( #   ) #100.100.100.200-100.100.100.210</span></span></code> </pre> <br></div></div><br><h3>  5. рдбреЛрдореЗрди рдХреА рджреА рдЧрдИ рд╕реВрдЪреА рдХреА рдЕрдирдмреНрд▓реЙрдХ IP рдкрддреЛрдВ рдХреЗ рдПрдХ рд╕рдореВрд╣ рдХреЛ рдкреЙрдкреНрдпреБрд▓реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ (рдЕрдирд╡рд░реЛрдзрд┐рдд_ipset.sh) </h3><br>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдмрдирд╛рдПрдВ / <b>рдЕрдкрдирд╛рдПрдВ /bin/unblock_ipset.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_ipset.sh</code> </pre> <br>  рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЪрд┐рдкрдХрд╛рдПрдБ (Shift + рдбрд╛рд▓реЗрдВ): <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh until ADDRS=$(dig +short google.com @localhost) &amp;&amp; [ -n "$ADDRS" ] &gt; /dev/null 2&gt;&amp;1; do sleep 5; done while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue cidr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/[0-9]{1,2}') if [ ! -z "$cidr" ]; then ipset -exist add unblock $cidr continue fi range=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}-[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$range" ]; then ipset -exist add unblock $range continue fi addr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$addr" ]; then ipset -exist add unblock $addr continue fi dig +short $line @localhost | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | awk '{system("ipset -exist add unblock "$1)}' done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br>  рдирд┐рд╖реНрдкрд╛рджрди рдЕрдзрд┐рдХрд╛рд░ рджреЗрдВ: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_ipset.sh</code> </pre> <br>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛рдлреА рд╕рд░рд▓ рд╣реИ, рдЗрд╕рдХреЗ рдХрд╛рдо рдХрд╛ рд╕рд╛рд░ ... рд╣рдо рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП google.com рдбреЛрдореЗрди рд░рд┐рдЬрд╝реЙрд▓реНрдпреВрд╢рди рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░ рд░рд╣реЗ рд╣реИрдВ (рдпрджрд┐ рдРрд╕рд╛ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд░рд╛рдЙрдЯрд░ рдмреВрдЯ рд╣реЛрдиреЗ рдкрд░ рдмрд╣реБрдд рд╕реА рдЕрдирдмреНрд▓реЙрдХ рдирд╣реАрдВ рднрд░реА рдЬрд╛рдПрдЧреА, рдХреНрдпреЛрдВрдХрд┐ рд░рд╛рдЙрдЯрд░ рдЕрднреА рднреА рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╣реЛрдЧрд╛)ред  рд╣рдо рдЕрдирдмреНрд▓реЙрдХред рдЯреЗрдХреНрд╕реНрдЯ рдлрд╝рд╛рдЗрд▓ рдХреА рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рдкрдврд╝рддреЗ рд╣реИрдВред  рд╢реБрд░реБрдЖрдд рдФрд░ рдЕрдВрдд рдореЗрдВ рд░рд┐рдХреНрдд рд╕реНрдерд╛рди рдФрд░ рдЯреИрдм рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╣рдЯрд╛рдПрдВ рд▓рд╛рдЗрдиреЗрдВ рдкрдврд╝реЗрдВред  рдЦрд╛рд▓реА рд▓рд╛рдЗрдиреЛрдВ рдХреЛ рдЫреЛрдбрд╝ рджреЗрдВред  # рд╡рд░реНрдг рд╕реЗ рд╢реБрд░реВ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рд░реЗрдЦрд╛рдУрдВ рдХреЛ рдЫреЛрдбрд╝реЗрдВред  рд╣рдо рд▓рд╛рдЗрди CIDR рдореЗрдВ рджреЗрдЦ рд░рд╣реЗ рд╣реИрдВред  рдпрджрд┐ CIDR рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдЕрдирдмреНрд▓реЙрдХ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВред  рд╣рдо рд╕реНрдЯреНрд░рд┐рдВрдЧ рдореЗрдВ рдПрдХ рд╕реАрдорд╛ рдХреА рддрд▓рд╛рд╢ рдХрд░ рд░рд╣реЗ рд╣реИрдВред  рдпрджрд┐ рдпрд╣ рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдЕрдирдмреНрд▓реЙрдХ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВред  рд╣рдо рд╕реНрдЯреНрд░рд┐рдВрдЧ рдореЗрдВ рдЖрдИрдкреА рдкрддреЗ рдХреА рддрд▓рд╛рд╢ рдХрд░ рд░рд╣реЗ рд╣реИрдВред  рдпрджрд┐ рдЖрдИрдкреА рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдЕрдирдмреНрд▓реЙрдХ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВред  рдЪрд▓реЛ рдЦреБрджрд╛рдИ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рд░реЗрдЦрд╛ рдХреЛ рд╣рд▓ рдХрд░рддреЗ рд╣реИрдВред  рдкрд░рд┐рдгрд╛рдо рдХреЗ рд╕рднреА рдЖрдИрдкреА рдкрддреЗ рдЕрдирдмреНрд▓реЙрдХ рдореЗрдВ рдЬреЛрдбрд╝реЗ рдЬрд╛рддреЗ рд╣реИрдВред <br><br><h3>  6. рдбреЛрдореЗрди рдХреА рджреА рдЧрдИ рд╕реВрдЪреА рд╕реЗ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд dnsmasq рд╡рд┐рдиреНрдпрд╛рд╕ рдлрд╛рдЗрд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ (рдЕрдирд╡рд░реЛрдзрд┐рдд_dnsmasq.sh) </h3><br>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдмрдирд╛рдПрдВ / <b>рдЕрдкрдирд╛рдПрдВ /bin/unblock_dnsmasq.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_dnsmasq.sh</code> </pre> <br>  рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЪрд┐рдкрдХрд╛рдПрдБ (Shift + рдбрд╛рд▓реЗрдВ): <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh cat /dev/null &gt; /opt/etc/unblock.dnsmasq while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue echo $line | grep -Eq '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' &amp;&amp; continue echo "ipset=/$line/unblock" &gt;&gt; /opt/etc/unblock.dnsmasq done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br>  рдирд┐рд╖реНрдкрд╛рджрди рдЕрдзрд┐рдХрд╛рд░ рджреЗрдВ: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_dnsmasq.sh</code> </pre> <br>  рдкрдЯрдХрдерд╛ рдХрд╛рдлреА рд╕рд░рд▓ рд╣реИред  рд╣рдо рдХреНрд░рдорд┐рдХ рд░реВрдк рд╕реЗ /opt/etc/unblock.txt рд╕реЗ рд▓рд╛рдЗрдиреЗрдВ рдкрдврд╝рддреЗ рд╣реИрдВред  рд╢реБрд░реБрдЖрдд рдФрд░ рдЕрдВрдд рдореЗрдВ рд░рд┐рдХреНрдд рд╕реНрдерд╛рди рдФрд░ рдЯреИрдм рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╣рдЯрд╛рдПрдВ рд▓рд╛рдЗрдиреЗрдВ рдкрдврд╝реЗрдВред  рдЦрд╛рд▓реА рд▓рд╛рдЗрдиреЛрдВ рдХреЛ рдЫреЛрдбрд╝ рджреЗрдВред  # рд╕реЗ рд╢реБрд░реВ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рд▓рд╛рдЗрдиреЛрдВ рдХреЛ рдЫреЛрдбрд╝ рджреЗрдВред  рдЙрди рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рдЫреЛрдбрд╝ рджреЗрдВ рдЬрд┐рдирдореЗрдВ рдПрдХ IP рдкрддрд╛ (IP рдпрд╛ CIDR) рд╣реЛрддрд╛ рд╣реИ, рдЕрд░реНрдерд╛рдд  рд╣рдо рдХреЗрд╡рд▓ рдбреЛрдореЗрди рдирд╛рдо рдХреЗ рд╕рд╛рде рддрд╛рд░ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВред  рдлрд╝рд╛рдЗрд▓ /opt/etc/unblock.dnsmasq рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╣рдо "ipset = / domain_name / рдЕрдирд╡рд░реЛрдзрд┐рдд рдХрд░реЗрдВ" рдлрд╝реЙрд░реНрдо рдХреА рдкрдВрдХреНрддрд┐рдпрд╛рдБ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рдбреЛрдореЗрди рдХреЗ рдЖрдИрдкреА рдкрддреЗ рдХрд╛ рдирд┐рд░реНрдзрд╛рд░рдг рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╡реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЕрдирдмреНрд▓реЙрдХ рд╕реЗрдЯ рдореЗрдВ рдЬреБрдбрд╝ рдЬрд╛рдПрдВрдЧреЗред <br><br>  рдЕрдирд╡рд░реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВред <br><br><pre> <code class="bash hljs">unblock_dnsmasq.sh</code> </pre> <br>  рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реЗрдВ рдХрд┐ unblock.dnsmasq рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдИ рдЧрдИ рд╣реИ: <br><br><pre> <code class="bash hljs">cat /opt/etc/unblock.dnsmasq</code> </pre> <br><h3>  7. рдбреЛрдореЗрди рдХреА рд╕реВрдЪреА рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореИрдиреБрдЕрд▓ рдХреА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдордЬрдмреВрд░ рдХрд░рдирд╛ (рдЕрдирд╡рд░реЛрдзрд┐рдд_рдЕрдкрдбреЗрдЯ)ред </h3><br>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдмрдирд╛рдПрдВ / <b>рдЕрдкрдирд╛рдПрдВ /bin/unblock_update.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_update.sh</code> </pre> <br>  рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЪрд┐рдкрдХрд╛рдПрдБ (Shift + рдбрд╛рд▓реЗрдВ): <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh ipset flush unblock /opt/bin/unblock_dnsmasq.sh /opt/etc/init.d/S56dnsmasq restart /opt/bin/unblock_ipset.sh &amp;</span></span></code> </pre> <br>  рдирд┐рд╖реНрдкрд╛рджрди рдЕрдзрд┐рдХрд╛рд░ рджреЗрдВ: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_update.sh</code> </pre> <br><h3>  8. рд░рд╛рдЙрдЯрд░ рдХреЛ рдмреВрдЯ рдХрд░рддреЗ рд╕рдордп рдЕрдирдмреНрд▓реЙрдХ рдХрд╛ рдПрдХ рд╕реЗрдЯ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдкреЙрдкреНрдпреБрд▓реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдХреНрд░рд┐рдкреНрдЯ (S99unblock) </h3><br>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдмрдирд╛рдПрдВ / <b>рдЕрдкрдирд╛рдПрдВ /etc/init.d/S99unblock</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/etc/init.d/S99unblock</code> </pre> <br>  рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЪрд┐рдкрдХрд╛рдПрдБ (Shift + рдбрд╛рд▓реЗрдВ): <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh [ "$1" != "start" ] &amp;&amp; exit 0 /opt/bin/unblock_ipset.sh &amp;</span></span></code> </pre><br>  рдирд┐рд╖реНрдкрд╛рджрди рдЕрдзрд┐рдХрд╛рд░ рджреЗрдВ: <br><br><pre> <code class="bash hljs">chmod +x /opt/etc/init.d/S99unblock</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9. рдЕрдирдмреНрд▓реЙрдХ рд╕реЗ рдЯреЛрд░ рддрдХ рдХреЗ рдЧрдВрддрд╡реНрдпреЛрдВ рдХреЗ рд╕рд╛рде рдкреИрдХреЗрдЯ рдЕрдЧреНрд░реЗрд╖рд┐рдд рдХрд░рдирд╛ (100-redirect.sh) </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдлрд╝рд╛рдЗрд▓ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/opt/etc/ndm/netfilter.d/100-redirect.sh рдмрдирд╛рдПрдБ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="bash hljs">mcedit /opt/etc/ndm/netfilter.d/100-redirect.sh</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЪрд┐рдкрдХрд╛рдПрдБ (Shift + рдбрд╛рд▓реЗрдВ): </font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh [ "$type" == "ip6tables" ] &amp;&amp; exit 0 if [ -z "$(iptables-save 2&gt;/dev/null | grep unblock)" ]; then ipset create unblock hash:net -exist iptables -w -t nat -A PREROUTING -i br0 -p tcp -m set --match-set unblock dst -j REDIRECT --to-port 9141 fi exit 0</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдкрдиреЗ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИрд╢ рдХрд╛</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рд╣реИ </font><b><font style="vertical-align: inherit;">:</font></b><font style="vertical-align: inherit;"> рдЪрд░рдг 2 рдореЗрдВ </font><b><font style="vertical-align: inherit;">рдЖрдИрдкреА</font></b><font style="vertical-align: inherit;"> рдФрд░ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИрд╢: рдиреЗрдЯ рдирд╣реАрдВ рд╣реИ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , рддреЛ рд╣реИрд╢ рдХреЛ рдмрджрд▓реЗрдВ: рд╣реИрд╢ рдХреЗ рд╕рд╛рде рдиреЗрдЯ: рдЖрдИрдкреАред рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╣рдо рдЕрддрд┐рд░рд┐рдХреНрдд рд░реВрдк рд╕реЗ 2 рдЪрд░рдгреЛрдВ рд╕реЗ рдЕрдирдмреНрд▓реЙрдХ рдХрд╛ рдПрдХ рд╕реЗрдЯ рдмрдирд╛рдиреЗ рдХреЗ рдХрд╛рд░реНрдп рдХреЛ рджреЛрд╣рд░рд╛рддреЗ рд╣реИрдВред рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рдЕрдЧрд░ fs.d рд╕реЗ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЕрднреА рддрдХ рдЪрд▓рдирд╛ рд╢реБрд░реВ рдирд╣реАрдВ рд╣реБрдИ рд╣реИрдВ, рдФрд░ netfilter.d рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЪрд▓ рд░рд╣реА рд╣реИрдВред рдпрд╣ рдареАрдХ рд╣реИ рдЕрдЧрд░ рдкрд╣рд▓реЗ рд╣реА рдЕрдирдмреНрд▓реЙрдХ рд╣реЛ рдЪреБрдХрд╛ рд╣реИ, рддреЛ рдХрдорд╛рдВрдб рдХреЛ рдХреЗрд╡рд▓ рдирдЬрд░рдЕрдВрджрд╛рдЬ рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдк рдмрд╛рд╣рд░реА рдкреЛрд░реНрдЯ 53 рд╕реЗ рдЕрдкрдиреЗ рдЖрдк рдХреЛ рд╕рднреА рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╣реА рдлрд╝рд╛рдЗрд▓ рдореЗрдВ (рдпрд╣ рд╡реИрдХрд▓реНрдкрд┐рдХ рд╣реИ) рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рддрд╛рдХрд┐ рд╕реНрдерд╛рдиреАрдп рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдХреНрд▓рд╛рдЗрдВрдЯ рддреГрддреАрдп-рдкрдХреНрд╖ DNS рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рди рдХрд░реЗрдВред рдЕрдиреБрд░реЛрдз рдирд┐рдпрдорд┐рдд DNS рд╕рд░реНрд╡рд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬрд╛рдПрдВрдЧреЗред рдЕрдВрддрд┐рдо рдирд┐рдХрд╛рд╕ рд╕реЗ рдкрд╣рд▓реЗ, рдЬреЛрдбрд╝реЗрдВ:</font></font><br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(iptables-save 2&gt;/dev/null | grep "udp \-\-dport 53 \-j DNAT")</span></span></span><span class="hljs-string">"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> iptables -w -t nat -I PREROUTING -i br0 -p udp --dport 53 -j DNAT --to 192.168.0.1 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(iptables-save 2&gt;/dev/null | grep "tcp \-\-dport 53 \-j DNAT")</span></span></span><span class="hljs-string">"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> iptables -w -t nat -I PREROUTING -i br0 -p tcp --dport 53 -j DNAT --to 192.168.0.1 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.0.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛ рдЕрдкрдиреЗ рд░рд╛рдЙрдЯрд░ (LAN) рдХреЗ рдЖрдВрддрд░рд┐рдХ рдкрддреЗ рд╕реЗ </font><font style="vertical-align: inherit;">рдмрджрд▓реЗрдВ </font><font style="vertical-align: inherit;">ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рд╖реНрдкрд╛рджрди рдЕрдзрд┐рдХрд╛рд░ рджреЗрдВ:</font></font><br><br><pre> <code class="bash hljs">chmod +x /opt/etc/ndm/netfilter.d/100-redirect.sh</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 10. dnsmasq рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ рдФрд░ dnsmasq рдореЗрдВ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рд╕рдВрд▓рдЧреНрди рдХрд░рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dnsmasq рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рд╣рдЯрд╛рдПрдВ: </font></font><br><br><pre> <code class="bash hljs">cat /dev/null &gt; /opt/etc/dnsmasq.conf</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dnsmasq рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдЦреЛрд▓реЗрдВ: </font></font><br><br><pre> <code class="bash hljs">mcedit /opt/etc/dnsmasq.conf</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЪрд┐рдкрдХрд╛рдПрдБ (Shift + рдбрд╛рд▓реЗрдВ): </font></font><br><br><pre> <code class="bash hljs">user=nobody bogus-priv no-negcache clear-on-reload <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span>-dynamic listen-address=192.168.0.1 listen-address=127.0.0.1 min-port=4096 cache-size=1536 expand-hosts <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>-async conf-file=/opt/etc/unblock.dnsmasq server=8.8.8.8</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.0.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛ рдЕрдкрдиреЗ рд░рд╛рдЙрдЯрд░ (LAN) рдХреЗ рдЖрдВрддрд░рд┐рдХ рдкрддреЗ рд╕реЗ </font><font style="vertical-align: inherit;">рдмрджрд▓реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 11. рд╕рдордп-рд╕рдордп рдкрд░ рдЕрдирдмреНрд▓реЙрдХ рд╕реЗрдЯ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд░реЛрди рдкрд░ рдПрдХ рдХрд╛рд░реНрдп рдЬреЛрдбрд╝рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдЕрддрд┐рд░рд┐рдХреНрдд рдмреАрдорд╛ рд╣реИ рдпрджрд┐ рдкреНрд░реЛрдЧреНрд░рд╛рдо / рдбрд┐рд╡рд╛рдЗрд╕ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рд░рд┐рдЬрд╝реЙрд▓реНрдпреВрд╢рди рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдбреЛрдореЗрди рдЖрдИрдкреА рдкрддрд╛ рдмрджрд▓ рдЧрдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдкрдХреЛ рдХреЗрд╡рд▓ рд╡рд╛рдВрдЫрд┐рдд рдЖрд╡реГрддреНрддрд┐ рдкрд░ рдЕрдирдмреНрд▓реЙрдХ_рд▓рд┐рдкреНрд╕.рд╢ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдо рд╣рд░ рджрд┐рди рд╕реБрдмрд╣ 6 рдмрдЬреЗ рд▓реЙрдиреНрдЪ рдХрд░реЗрдВрдЧреЗред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд╝рд╛рдЗрд▓ рдЦреЛрд▓реЗрдВ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдВрдкрд╛рджрдХ рдореЗрдВ </font><b><font style="vertical-align: inherit;">/ etc / crontab</font></b><font style="vertical-align: inherit;"> рдЦреЛрд▓реЗрдВ </font><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="bash hljs">mcedit /opt/etc/crontab</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдВрдд рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ: </font></font><br><br><pre> <code class="bash hljs">00 06 * * * root /opt/bin/unblock_ipset.sh</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдк рдЪрд╛рд╣реЗрдВ, рддреЛ рдЖрдк рдЕрдиреНрдп рд╕рднреА рдЯреЗрдореНрдкрд▓реЗрдЯ рдХрд╛рд░реНрдпреЛрдВ рдкрд░ рдЯрд┐рдкреНрдкрдгреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣рд╛рдБ рдХреНрдпрд╛ рдЖрдкрдХреЗ crontab рдлрд╝рд╛рдЗрд▓ рдХреА рддрд░рд╣ рджрд┐рдЦреЗрдЧрд╛:</font></font><br><br><img src="https://habrastorage.org/webt/le/y5/sl/ley5slcvjfvs-9odj9air9qdd8s.png"><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 12. рдирд┐рдпрдорд┐рдд DNS рд╕рд░реНрд╡рд░ рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдирд╛ рдФрд░ рд░рд╛рдЙрдЯрд░ рдХреЛ рд░рд┐рдмреВрдЯ рдХрд░рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"рдПрд╕рдПрд╕рдПрдЪ рд╕рд░реНрд╡рд░" рдШрдЯрдХ рдХреЛ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ </font><font style="vertical-align: inherit;">рд╣реИ рддреЛ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреАрдиреЗрдЯрд┐рдХ рд░рд╛рдЙрдЯрд░ рд╕реАрдПрд▓рдЖрдИ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (рдЯреЗрд▓рдиреЗрдЯ рдХреЗ рд▓рд┐рдП рдкреЛрд░реНрдЯ 23 рдФрд░ рдПрд╕рдПрд╕рдПрдЪ рдХреЗ рд▓рд┐рдП 22) рд╕реЗ </font><font style="vertical-align: inherit;">рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрдорд╛рдВрдб рдЪрд▓рд╛рдПрдБ:</font></font><br><br><pre> <code class="bash hljs">opkg dns-override system configuration save system reboot</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд░реНрдорд╡реЗрдпрд░ рдореЗрдВ рдирд┐рд░реНрдорд┐рдд DNS рд╕рд░реНрд╡рд░ рдХреЛ рдмрдВрдж рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдФрд░ рдПрдВрдЯрд╡реЗрдпрд░ рд╕реЗ dnsmasq рдХрд╛ рдЙрдкрдпреЛрдЧ рдЗрд╕рдХреЗ рдмрдЬрд╛рдп рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </font><font style="vertical-align: inherit;">рд░рд╛рдЙрдЯрд░, рдмреВрдЯ рдкрд░, рдпрд╣ рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдХрд┐ рдСрдкреНрдЯ рдлрд╝реЛрд▓реНрдбрд░ рдорд╛рдЙрдВрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ (рдХреНрдпрд╛ рдПрдВрдЯрд░рд╡реЗрдпрд░ рдХреЗ рд╕рд╛рде рдПрдХ рдпреВрдПрд╕рдмреА рдлреНрд▓реИрд╢ рдбреНрд░рд╛рдЗрд╡ / рдбреНрд░рд╛рдЗрд╡ рд╣реИ)ред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╣реИ, рддреЛ рдПрдХ рдирд┐рдпрдорд┐рдд DNS рд╕рд░реНрд╡рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдирд╣реАрдВ, рддреЛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред</font></font> рдпрд╛рдиреА<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлреНрд▓реИрд╢ рдбреНрд░рд╛рдЗрд╡ рдХреЛ рдирд┐рдХрд╛рд▓рдирд╛ рдФрд░ рд░рд╛рдЙрдЯрд░ рдХреЛ рд░рд┐рдмреВрдЯ рдХрд░рдирд╛, рд╕рдм рдХреБрдЫ рдЖрдкрдХреЗ рд▓рд┐рдП рдХрд╛рдо рдХрд░реЗрдЧрд╛, рдЬреИрд╕реЗ рдкрд╣рд▓реЗ (рд╕реЗрдЯ рдЕрдк рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ)ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рд┐рдмреВрдЯ рдХреЗ рдмрд╛рдж, рдЕрдкрдиреЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ check.torproject.org рд╡реЗрдмрд╕рд╛рдЗрдЯ рдЦреЛрд▓реЗрдВ (рдЗрд╕реЗ рдЕрдирдмреНрд▓реЙрдХ.txt рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП)ред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдкрдиреЗ рд╕рдм рдХреБрдЫ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд┐рдпрд╛ рд╣реИ, рддреЛ рдЖрдк рд╢рд┐рд▓рд╛рд▓реЗрдЦ "рдмрдзрд╛рдИ" рджреЗрдЦреЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдпрд╣ рдмреНрд░рд╛рдЙрдЬрд╝рд░ Tor рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред ":</font></font><br><br><img src="https://habrastorage.org/webt/wa/19/dz/wa19dzxbu8qtldwrvkeijfqna7q.png"><br><br><br><a name="con31"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рдмрд╛рдж рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЗ рдирд┐рджрд╛рди рдХреЗ рд▓рд┐рдП рдмреБрдирд┐рдпрд╛рджреА рддрд░реАрдХреЗ </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рд╕рд╛рдЗрдЯ check.torproject.org (рдЗрд╕реЗ рдЕрдирдмреНрд▓реЙрдХ.рдЯреИрдХреНрд╕ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП) рдХреЗ рд╕рд╛рде рдЪреЗрдХ рдкрд╛рд╕ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдкреНрд░рджрд╛рддрд╛ рд╕реЗ рд╕реНрдЯрдм рдЕрдиреНрдп рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдЦреБрд▓рд╛ рд░рд╣рддрд╛ рд╣реИ (рдпрд╛ рдирд╣реАрдВ рдЦреБрд▓рддрд╛ рд╣реИ), рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдкреНрд░рджрд╛рддрд╛ DNS рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЗ рд╕рд╛рде рд╣рд╕реНрддрдХреНрд╖реЗрдк рдХрд░реЗрдЧрд╛, рдЬрд╡рд╛рдм рдмрджрд▓ рджреЗрдЧрд╛ - рдЖрдк рдЖрдкрдХреЛ DNS рдХреНрд╡реЗрд░реАрдЬрд╝ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рдмрд╛рдж рдХреБрдЫ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ рдЬреИрд╕рд╛ рдХрд┐ рдЗрд╕реЗ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рд╕рдорд╕реНрдпрд╛ рдЪрд░рдг рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд░рд▓ рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдирдмреНрд▓реЙрдХ рд╕реЗрдЯ рдХреА рд╕рд╛рдордЧреНрд░реА рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдВ:</font></font><br><br><pre> <code class="bash hljs">ipset list unblock</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рд╕рд┐рд╕реНрдЯрдо рд░рд┐рдкреЛрд░реНрдЯ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЗрд╕ рддрд░рд╣ рдХреЗ рдХреЛрдИ рд╕реЗрдЯ рдирд╣реАрдВ рд╣реИрдВ, рддреЛ рдЪрд░рдг 2 рдореЗрдВ рддреНрд░реБрдЯрд┐ рд╣реИ рдпрд╛ рдЖрдкрдиреЗ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдиреЗрдЯрдлрд┐рд▓реНрдЯрд░ рдореЙрдбреНрдпреВрд▓ (рдХреАрдиреЗрдЯрд┐рдХ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ) рдХреЛ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рдХрд┐рдпрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рд╕реЗрдЯ рдЦрд╛рд▓реА рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЕрдирдмреНрд▓реЙрдХ_рд╢рд┐рдкрд╕реЗрдЯ.рд╢ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддреА рд╣реИ, рдЬрд┐рд╕реЗ рдмрджрд▓реЗ рдореЗрдВ S99unblock start рд╕реНрдХреНрд░рд┐рдкреНрдЯ рджреНрд╡рд╛рд░рд╛ рд╢реБрд░реВ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдЗрд╕ рдЕрдирдмреНрд▓реЙрдХ_рд╢рд┐рдк рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдЪрд▓рд╛рдПрдБред рдпрджрд┐ рд╕реЗрдЯ рднрд░рд╛ рд╣реБрдЖ рд╣реИ, рддреЛ рддреНрд░реБрдЯрд┐ рдЪрд░рдг 8 рдкрд░ рд╣реИред рдпрджрд┐ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ, рдпрд╣ google.com рд░рд┐рдЬрд╝реЙрд▓реНрдпреВрд╢рди рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░ рд░рд╣рд╛ рд╣реИ), рддреЛ рддреНрд░реБрдЯрд┐ рдХрд╣реАрдВ DNS рд╕рд░реНрд╡рд░ рдХреА рддрд░рдл рд╣реИ, рд╕рдВрднрд╡рддрдГ рдЪрд░рдг 10 рдпрд╛ 6 рдкрд░ </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред iptables рдореЗрдВ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХреЗ рд▓рд┐рдП рдЬрд╛рдБрдЪ рдХрд░реЗрдВ :</font></font><br><br><pre> <code class="bash hljs">iptables-save 2&gt;/dev/null | grep unblock</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдпрд╣ рдирд╣реАрдВ рд╣реИ, рддреЛ рддреНрд░реБрдЯрд┐ рдЪрд░рдг 9 рдкрд░ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рд╕рднреА рд╕рд╛рдЗрдЯреЗрдВ рдмрд┐рд▓реНрдХреБрд▓ рднреА рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддреА рд╣реИрдВ, рдЕрд░реНрдерд╛рддреНред </font><font style="vertical-align: inherit;">DNS рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рддреНрд░реБрдЯрд┐ рдХрд╣реАрдВ рдЪрд░рдг 6 рдпрд╛ 10 рдореЗрдВ рд╣реИред рд╢рд╛рдпрдж, рдЪрд░рдг 9 рдореЗрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдЕрдирдмреНрд▓реЙрдХ рд╕реЗ рд╕рднреА рд╕рд╛рдЗрдЯреЗрдВ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддреА рд╣реИрдВред (рд╕рдордп рд╕рдорд╛рдкреНрдд рд╣реЛ рдЧрдпрд╛ рд╣реИ) рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддреА рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдиреНрдп рд╕рднреА рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╕рдорд╕реНрдпрд╛ рдЯреЛрд░ рдХреА рддрд░рдл рдХрд╣реАрдВ рд╣реИ, рддреНрд░реБрдЯрд┐ рд╕реНрдЯреЗрдЬ 3 рдкрд░ред</font></font><br><br><br><a name="con4"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреНрд░рджрд╛рддрд╛ рджреНрд╡рд╛рд░рд╛ DNS рдкреНрд░рд╢реНрдиреЛрдВ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрддрд┐рд░рд┐рдХреНрдд рдмрд╛рдИрдкрд╛рд╕ </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдХреЛрдИ рдкреНрд░рджрд╛рддрд╛ рдЕрд╡рд░реБрджреНрдз рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдХреЗ DNS рдЯреНрд░реИрдлрд╝рд┐рдХ рдореЗрдВ рд╣рд╕реНрддрдХреНрд╖реЗрдк рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рд▓рд┐рдП рд╣рдо dnscrypt- рдкреНрд░реЙрдХреНрд╕реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдк рдЪрд╛рд╣реЗрдВ рдФрд░ рдЕрдиреБрднрд╡ рдХрд░реЗрдВ, рддреЛ рдЖрдк рдЖрд╕рд╛рдиреА рд╕реЗ dnscrypt рдХреЛ stubby (DNS over TLS) рд╕реЗ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреЗрд╡рд▓ рдЕрдирд╡рд░реЛрдзрд┐рдд рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдбреЛрдореЗрди рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЕрдиреНрдп рд╕рднреА рдХреНрд╡реЗрд░реАрдЬрд╝ рдирд┐рдпрдорд┐рдд DNS рд╕рд░реНрд╡рд░реЛрдВ рд╕реЗ рдЧреБрдЬрд░реЗрдВрдЧреАред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдк рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рд╣реИрдВ рдХрд┐ рдЖрдкрдХрд╛ рдкреНрд░рджрд╛рддрд╛ DNS рдкреНрд░рд╢реНрдиреЛрдВ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдпрд╣ рдЕрддрд┐рд░рд┐рдХреНрдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдкрдХреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдКрдкрд░ рд╡рд░реНрдгрд┐рдд рддрд╛рд▓реЗ рдХреЗ рдмрд╛рдИрдкрд╛рд╕ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдкрдбрд╡рди рдФрд░ рдХреАрдиреЗрдЯрд┐рдХ рдУрдПрд╕ рдХреЗ рд▓рд┐рдП рд╕рдорд╛рди рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рд╛рдЙрдЯрд░ рдкрд░ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ:</font></font><br><br><pre> <code class="bash hljs">opkg update opkg install dnscrypt-proxy2</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dnscrypt- рдкреНрд░реЙрдХреНрд╕реА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдЦреЛрд▓реЗрдВ: </font></font><br><br><pre> <code class="bash hljs">mcedit /opt/etc/dnscrypt-proxy.toml</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Listen_addresses, fallback_resolver, рдХреИрд╢ рдкреИрд░рд╛рдореАрдЯрд░ рдЦреЛрдЬреЗрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдмрджрд▓реЗрдВ: </font></font><br><br><pre> <code class="bash hljs">listen_addresses = [<span class="hljs-string"><span class="hljs-string">'127.0.0.1:9153'</span></span>] fallback_resolver = <span class="hljs-string"><span class="hljs-string">'77.88.8.8:1253'</span></span> cache = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">77.88.8.8:1253 рдПрдХ рдЧреИрд░-рдорд╛рдирдХ рдкреЛрд░реНрдЯ рдХреЗ рд╕рд╛рде рдпрд╛рдВрдбреЗрдХреНрд╕ DNS рд╕рд░реНрд╡рд░ рдкрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдПрдХ рдмреИрдХрдЕрдк рд╣реИ рдпрджрд┐ dnscrypt- рдкреНрд░реЙрдХреНрд╕реА рдореЗрдВ рдХреЛрдИ рд╕рдорд╕реНрдпрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рди dnscrypt- рдкреНрд░реЙрдХреНрд╕реА:</font></font><br><br><pre> <code class="bash hljs">/opt/etc/init.d/S09dnscrypt-proxy2 start</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ dnscrypt- рдкреНрд░реЙрдХреНрд╕реА рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИ (рдЖрдкрдХреЛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ IP рдкрддреЛрдВ рдХреА рдПрдХ рд╕реВрдЪреА рджреЗрдЦрдиреА рдЪрд╛рд╣рд┐рдП): </font></font><br><br><pre> <code class="bash hljs">dig +short google.com @localhost -p 9153</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЦреЛрд▓реЗрдВ / рд╕рдВрдкрд╛рджрдХ рдореЗрдВ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/bin/unblock_ipset.sh</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЦреЛрд▓реЗрдВ </font><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_ipset.sh</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЗрд╕рдХреЗ рд╕рд╛рде рдмрджрд▓реЗрдВ: </font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh until ADDRS=$(dig +short google.com @localhost -p 9153) &amp;&amp; [ -n "$ADDRS" ] &gt; /dev/null 2&gt;&amp;1; do sleep 5; done while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue cidr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/[0-9]{1,2}') if [ ! -z "$cidr" ]; then ipset -exist add unblock $cidr continue fi range=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}-[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$range" ]; then ipset -exist add unblock $range continue fi addr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$addr" ]; then ipset -exist add unblock $addr continue fi dig +short $line @localhost -p 9153 | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | awk '{system("ipset -exist add unblock "$1)}' done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдордиреЗ рдПрдХ рдЫреЛрдЯрд╛ рдкрд░рд┐рд╡рд░реНрддрди рдХрд┐рдпрд╛ - рдЕрдм рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЦреБрджрд╛рдИ рдПрдХ рдирд┐рдпрдорд┐рдд DNS рд╕рд░реНрд╡рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдкреЛрд░реНрдЯ 9153 рдХреЗ рд╕рд╛рде dnscrypt </font><b><font style="vertical-align: inherit;">-xy</font></b></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред рд╕рдВрдкрд╛рджрдХ рдореЗрдВ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/opt/bin/unblock_dnsmasq.sh</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЦреЛрд▓реЗрдВ </font><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_dnsmasq.sh</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЗрд╕рдХреЗ рд╕рд╛рде рдмрджрд▓реЗрдВ: </font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh cat /dev/null &gt; /opt/etc/unblock.dnsmasq while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue echo $line | grep -Eq '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' &amp;&amp; continue echo "ipset=/$line/unblock" &gt;&gt; /opt/etc/unblock.dnsmasq echo "server=/$line/127.0.0.1#9153" &gt;&gt; /opt/etc/unblock.dnsmasq done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдордиреЗ рдПрдХ рдЫреЛрдЯрд╛ рд╕рд╛ рдкрд░рд┐рд╡рд░реНрддрди рдХрд┐рдпрд╛ рд╣реИ - рдЕрдм рдЬрдм рдЕрдирдмреНрд▓реЙрдХред рдбреЗрдЯрд╛ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЬреЗрдирд░реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ "рд╕рд░реНрд╡рд░ = / domain_name / 127.0.0.1 # 9153" рдЬреИрд╕реА рдЕрддрд┐рд░рд┐рдХреНрдд рд▓рд╛рдЗрдиреЗрдВ рдЬреЛрдбрд╝реА рдЬрд╛рддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рд╕реВрдЪреА рд╕реЗ рдбреЛрдореЗрди рдХреЛ рд╣рд▓ рдХрд░рдирд╛ dnscrypt- рдкреНрд░реЙрдХреНрд╕реА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣реЛрдЧрд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдирдмреНрд▓реЙрдХ_рдЕрдкрдбреЗрдЯ рдЪрд▓рд╛рдПрдВ:</font></font><br><br><pre> <code class="bash hljs">unblock_update.sh</code> </pre> <br>  рд╣реЛ рдЧрдпрд╛ред<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рднреА рдЬрдЯрд┐рд▓ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдкреАрдЫреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЕрдм рдЖрдк рдХреЗрд╡рд▓ рдЕрдирдмреНрд▓реЙрдХ.рдЯреИрдХреНрд╕ рд╕реВрдЪреА рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЗрдВрдЧреЗ, рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ рдЗрд╕рдореЗрдВ рд╕реЗ рдЕрдирд▓реЙрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбреЛрдореЗрди рдпрд╛ рдЖрдИрдкреА рдкрддреЗ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЕрдирдмреНрд▓реЙрдХ_рдЕрдкрдбреЗрдЯ рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде рдХрд┐рдП рдЧрдП рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPDATE 04/01/2019</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font><font style="vertical-align: inherit;">рдЕрдХреНрд╕рд░ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рд╡рд╛рд▓реЛрдВ рдХреЗ рд╕рд╛рде рд▓реЗрдЦ рдкрд░ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд╕рдВрджреЗрд╢ рдЖрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдореИрдВ рдпрд╣рд╛рдВ рд╕рдмрд╕реЗ рдЖрдо рдЬрд╡рд╛рдм рджреВрдВрдЧрд╛ред </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдкрд▓рдмреНрдз .onion рдбреЛрдореЗрди рдЬрд╝реЛрди рд╕рд╛рдЗрдЯреЛрдВ рдХреЛ рдХреИрд╕реЗ рдЙрдкрд▓рдмреНрдз рдХрд░реЗрдВ? </font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Torrc add рдореЗрдВ:</font></font><br><pre> <code class="bash hljs">VirtualAddrNetwork 10.254.0.0/16 DNSPort 127.0.0.1:9053 AutomapHostsOnResolve 1</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреНрдпрд╛рдЬ рдХреНрд╖реЗрддреНрд░ рдХреЗ рд╕рднреА рдбреЛрдореЗрди рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП dnsmasq.conf рдЬреЛрдбрд╝реЗрдВ: </font></font><br><pre> <code class="bash hljs">server=/onion/127.0.0.1<span class="hljs-comment"><span class="hljs-comment">#9053 ipset=/onion/unblock</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдпрджрд┐ рдЖрдк рдкреНрдпрд╛рдЬ рдХреНрд╖реЗрддреНрд░ рдХреЗ рд╕рднреА рдбреЛрдореЗрди рддрдХ рдирд╣реАрдВ рдкрд╣реБрдВрдЪрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдХреЗрд╡рд▓ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд▓реЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП, рддреЛ dnsmasq.conf рдореЗрдВ рдирд┐рдореНрди рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпрд╛рдБ рдЬреЛрдбрд╝реЗрдВ: </font></font><br><pre> <code class="bash hljs">server=/rutorc6mqdinc4cz.onion/127.0.0.1<span class="hljs-comment"><span class="hljs-comment">#9053 ipset=/rutorc6mqdinc4cz.onion/unblock server=/nnmclub5toro7u65.onion/127.0.0.1#9053 ipset=/nnmclub5toro7u65.onion/unblock server=/flibustahezeous3.onion/127.0.0.1#9053 ipset=/flibustahezeous3.onion/unblock</span></span></code> </pre> <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рд░рд╛рдЙрдЯрд░ рдкрд░ рдЪрд▓рдиреЗ рд╡рд╛рд▓реЗ рд╡реАрдкреАрдПрди рд╕рд░реНрд╡рд░ рдХреЗ рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЗ рд▓рд┐рдП рддрд╛рд▓реЗ рдХреЛ рдХреИрд╕реЗ рдмрд╛рдпрдкрд╛рд╕ рдХрд░реЗрдВ? </font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Torrc рдореЗрдВ, TransPort рдХреЗ рд╕рд╛рде рд▓рд╛рдЗрди рдХреЛ рдмрджрд▓реЗрдВ:</font></font><br><pre> <code class="bash hljs">TransPort 0.0.0.0:9141</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЖрд╡рд╢реНрдпрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ (INTERFACE - VPN рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕) рдХреЗ рд╕рд╛рде рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдЬреЛрдбрд╝реЗрдВ: </font></font><br><pre> <code class="bash hljs">iptables -t nat -A PREROUTING -i  -p tcp -m <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> --match-set unblock dst -j REDIRECT --to-port 9141</code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi428992/">https://habr.com/ru/post/hi428992/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi428982/index.html">рдПрдЖрд░рдПрдо рдкрд░ рдбреА рдХреИрд╕реЗ рд▓рд┐рдЦреЗрдВ</a></li>
<li><a href="../hi428984/index.html">рдЬреВрд▓рд┐рдпрд╛ рдФрд░ рдЪрд░рдг рдЧрддрд┐рд╢реАрд▓ рдкреНрд░рдгрд╛рд▓рд┐рдпреЛрдВ рдХреЗ рдЪрд┐рддреНрд░</a></li>
<li><a href="../hi428986/index.html">рдЦрд╛рд░реНрдХреЛрд╡ рдореЗрдВ рдерд┐рдВрдХрдЬрд╡рд╛ рд╕рдореНрдореЗрд▓рди # 8</a></li>
<li><a href="../hi428988/index.html">рдкреНрд░рдХреГрддрд┐ рдХреА рдпреБрдХреНрддрд┐рдпрд╛рдБ - рдмрд╛рджрд▓ рд░рд╛рдд рдХреА рд░реЛрд╢рдиреА</a></li>
<li><a href="../hi428990/index.html">рдорд╛рд░реНрдЧрдкрд░рд┐рд╡рд░реНрддрдирдХрд░реНрддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ UIViewControllers рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЙрджрд╛рд╣рд░рдг</a></li>
<li><a href="../hi428994/index.html">Corutin рдФрд░ Retrofit рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Android рдореЗрдВ рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ</a></li>
<li><a href="../hi428996/index.html">рдХреНрд▓рдм рдСрдл рдЕрдирд╛рдо рд╕рд╛рдВрддрд╛ рдХреНрд▓реЙрдЬ 2018-2019 рд╣рдмрд░рд╛рдмреНрд░ рдкрд░</a></li>
<li><a href="../hi428998/index.html">рд░рд┐рдПрдХреНрдЯ рдореЗрдВ рдирдП рдкреНрд░рд╛рдпреЛрдЧрд┐рдХ рдкреНрд░реЛрдлрд╛рдЗрд▓рд░ рд╕реБрд╡рд┐рдзрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВ</a></li>
<li><a href="../hi429000/index.html">рдХреНрдпреЛрдВ рдмрд┐рд▓ рдЧреЗрдЯреНрд╕ рдиреЗ $ 233 рдмрд┐рд▓рд┐рдпрди рдореЗрдВ рд╢реМрдЪрд╛рд▓рдп рдХрд╛ рдЖрд╡рд┐рд╖реНрдХрд╛рд░ рдХрд┐рдпрд╛</a></li>
<li><a href="../hi429006/index.html">рдЪреАрди: "рд╡рд░реНрд▓реНрдб рдЕрд╕реЗрдВрдмрд▓реА рд╢реЙрдк" рдЙрддрдирд╛ рд╕рд░рд▓ рдирд╣реАрдВ рд╣реИ рдЬрд┐рддрдирд╛ рд▓рдЧрддрд╛ рд╣реИ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>