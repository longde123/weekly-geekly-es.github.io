<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üà∏ ü•ö ü§úüèª Nous commen√ßons √† √©tudier les microcontr√¥leurs en utilisant l'exemple de STM32F030f4p6 üë≤üèΩ üßòüèº ‚úãüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="0. Avant de lire l'article 
 Cet article a les objectifs suivants: 



1. montrer comment travailler sp√©cifiquement avec ce forum; 
2. montrer l'appro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nous commen√ßons √† √©tudier les microcontr√¥leurs en utilisant l'exemple de STM32F030f4p6</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437234/"><img src="https://habrastorage.org/webt/ex/dh/0-/exdh0-6tdd7sj-4usxbip9chsz0.jpeg"><br><br><h1>  0. Avant de lire l'article </h1><br>  Cet article a les objectifs suivants: <br><br><ol><li>  montrer comment travailler sp√©cifiquement avec ce forum; </li><li>  montrer l'approche par laquelle vous pouvez √©crire un programme LED clignotant, en vous appuyant uniquement sur la documentation et la logique; </li><li>  pr√©senter le mat√©riel dans un langage compr√©hensible pour une personne peu famili√®re avec les microcontr√¥leurs. </li></ol><br>  Le code se r√©v√©lera minimaliste en termes d'utilisation de fichiers suppl√©mentaires - nous n'inclurons pas un seul fichier, √† l'exception de ceux qui sont n√©cessaires pour construire un firmware vide, mais valide.  C'est-√†-dire  bas√© sur le code du firmware, qui fonctionne, mais ne fait rien d'utile. <br><a name="habracut"></a><br>  Nous aurons besoin de la documentation suivante: <br><br><ol><li>  Fiche technique STM32F030x4 (j'utilise le document de janvier 2017 DocID024849 Rev 3); </li><li>  RM0360 Manuel de r√©f√©rence STM32F030x4 / x6 / x8 / xC (j'utilise le document d'avril 2017 DocID025023 Rev 4); </li><li>  carte de circuit imprim√©. </li></ol><br>  Vous pouvez t√©l√©charger ces documents depuis le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cloud</a> . <br>  La minuterie de l'article <i>ne</i> sera <i>pas prise</i> en compte et <i>ne</i> sera <i>pas</i> impliqu√©e dans le code. <br>  Le programmeur ST-LINK n'a <i>pas</i> √©t√© utilis√©.  Pour travailler avec la carte, un adaptateur USB-COM (RS232 bas√© sur PL2303HX) a √©t√© utilis√©, qui √©mule un port COM. <br><br><div class="spoiler">  <b class="spoiler_title">Adaptateur photo</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/wp/em/u8/wpemu8n1juvbuipavxu-mzfa2eq.jpeg"></div></div><br>  Tout a √©t√© collect√© sur une machine virtuelle Windows XP Professionnel 2002 SP3 ex√©cut√©e via VirtualBox version 5.2.22r126460 sur un h√¥te Windows X. <br><br><h1>  1. Installation du pilote pour l'adaptateur USB-COM </h1><br>  Windows n'est pas une aide, t√©l√©chargez √† partir du site officiel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Prolific</a> (le premier lien vers la requ√™te "prolific driver" dans Google) USB vers UART / Serial / Printer <b>PL2303 Windows Driver</b> (vous avez besoin de celui qui <i>pilote Standard</i> ).  Ou vous pouvez t√©l√©charger depuis mon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cloud</a> . <br><br>  Installez le pilote, red√©marrez et voyez le nouveau port COM. <br><br><div class="spoiler">  <b class="spoiler_title">Capture d'√©cran avec le nom du programme d'installation et le nouveau port COM</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/tq/tt/dh/tqttdhvov6eiov75df-pqcycz0s.png"></div></div><br>  Les param√®tres de port sont rest√©s standard.  Vous pouvez modifier le num√©ro de port COM √† votre discr√©tion.  D'apr√®s mon exp√©rience, une seule fois dans ma vie, j'ai vu un programme ne voir que les 4 premiers ports COM, si je ne me trompe pas, c'√©tait une sorte de terminal Bluetooth sous Windows. <br><br><div class="spoiler">  <b class="spoiler_title">Param√®tres du port COM</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ak/ad/ep/akadepan2w3tldshsr6sys69jo4.png"><br></div></div><br><h1>  2. Remplissage du firmware sur et hors de la carte </h1><br><h2>  2.0 Utilitaire de t√©l√©chargement pour travailler avec la carte </h2><br>  Nous t√©l√©chargeons l' <b>utilitaire FLASHER-STM32 √†</b> partir du site Web de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">STM</a> (dans la description, il s'agit du d√©monstrateur de chargeur Flash STM32 (UM0462)), vous devrez vous inscrire pour cela, mais ce n'est pas effrayant - au final, nous d√©poserons l'archive zip avec le programme d'installation;  Suivant-&gt; Suivant-&gt; Suivant ... et tout est install√©.  Pour plus de commodit√©, je cr√©e un raccourci vers cette application dans le dossier de travail. <br><br><div class="spoiler">  <b class="spoiler_title">Voici l'utilitaire (capture d'√©cran du site)</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/oa/4a/xz/oa4axzxm4eljcbpzubyspqghcbe.png"><br></div></div><br>  Par d√©faut, le chemin d'acc√®s √† l'utilitaire <i>C: Program Files \ STMicroelectronics \ Software \ Flash Loader Demo \ STMFlashLoader Demo.exe</i> . <br><br><h2>  2.1 Nuance BOOT </h2><br>  Il y a un cavalier BOOT sur la carte. <br><br><ul><li>  Lorsque le cavalier est <b>ferm√©</b> , le microcontr√¥leur charge les instructions de sa m√©moire (c'est-√†-dire un programme √©crit par un programmeur). </li><li>  Lorsque le cavalier est <b>ouvert</b> , le microcontr√¥leur re√ßoit des informations sur les lignes RX et TX, c'est-√†-dire  Il sera flash√© depuis le port COM (depuis l'adaptateur dans mon cas). </li></ul><br><h2>  2.2 Configuration de l'utilitaire </h2><br><img src="https://habrastorage.org/webt/pu/oc/h3/puoch3mqjkqfryjvcnxfg9zeycq.png"><br><br>  Ex√©cutez cette application, c'est en fait la plus simple (contient un minimum de param√®tres).  Dans la premi√®re fen√™tre, s√©lectionnez: <br><br><ol><li>  interface (j'ai COM-3); </li><li>  la vitesse avec laquelle l'ordinateur et le microcontr√¥leur communiqueront (IMHO, 9600 valeur normale); </li><li>  le nombre de bits de donn√©es (pour une raison quelconque, cette fen√™tre n'est pas disponible pour moi, mais jusqu'√† pr√©sent, ce n'est pas important); </li><li>  parit√© (je n'ai pas de parit√©, c'est-√†-dire aucune); </li><li>  √©cho (j'ai d√©sactiv√©); </li><li>  temps d'attente (j'ai 10 secondes). </li></ol><br>  Cliquez sur Suivant, et si tout est en ordre, alors nous verrons un feu vert et "La cible est lisible";  si nous voyons une lumi√®re rouge, l'ordinateur n'a pas pu se connecter. <br><br><div class="spoiler">  <b class="spoiler_title">La cible est lisible si le microcontr√¥leur est d√©tect√© avec succ√®s</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/gd/9y/hw/gd9yhwnpu15asiupizayeozvsfo.png"><br></div></div><br>  L'ordre des √©tapes qui aident toujours: <br><br><ol><li>  Tout d'abord, vous devez v√©rifier si le cavalier BOOT de la carte est ferm√©. </li><li>  Deuxi√®mement, dans tous les cas, coupez l'alimentation du microcontr√¥leur et de pr√©f√©rence les lignes TX et RX provenant de l'adaptateur √† la carte (vous ne pouvez pas d√©connecter la masse). </li><li>  Troisi√®mement, dans le programme, appuyez sur Retour √† la fin, c'est-√†-dire  √† la premi√®re page, ou m√™me la fermer et la red√©marrer (en g√©n√©ral, elle se bloque parfois).  Il est important de toujours commencer √† partir de la premi√®re page avant chaque connexion √† la carte via ce programme. </li><li>  Quatri√®mement, ramassez les fils de l'adaptateur √† la carte et essayez de vous reconnecter dans le programme (assurez-vous d√®s la premi√®re page!). </li></ol><br>  Si tout le reste √©choue, vous pouvez essayer de tout √©teindre, red√©marrer l'ordinateur et essayer de vous reconnecter √† la carte. <br><br>  Parce que  Je travaille via une machine virtuelle, je dois reconnecter l'adaptateur USB-COM plusieurs fois pour qu'il soit d√©tect√© par la machine virtuelle, et la machine h√¥te n'a pas le temps d'installer des pilotes cass√©s. <br><br>  Une autre option que j'ai trouv√©e utile en √©crivant cet article est d'appuyer sur un bouton du tableau au lieu de tirer constamment sur les fils.  Cependant, vous devrez dans tous les cas fermer et ouvrir le cavalier BOOT.  Cette option fonctionne car le bouton est plac√© au pied de la r√©initialisation <abbr title="rapport externe">NRST</abbr> externe. <br><br>  Dans la fen√™tre suivante, s√©lectionnez le p√©riph√©rique cible Cible.  √Ä propos, parfois ici, vous pouvez voir (peut-√™tre un bug) le p√©riph√©rique gauche en g√©n√©ral, par exemple, au lieu de STM32 voir STM8 - quelque part il y a eu une sorte d'√©chec, la proc√©dure de traitement est d√©crite ci-dessus.  Par cons√©quent, √† cette √©tape, vous ne pouvez pas vous pr√©cipiter pour cliquer sur Suivant, mais faites toujours attention au fait que le p√©riph√©rique souhait√© est s√©lectionn√© dans Target. <br><br><div class="spoiler">  <b class="spoiler_title">S√©lection du p√©riph√©rique cible</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/zz/p8/83/zzp88341ayrb95ymtn1bf3-elvq.png"><br></div></div><br>  Comment d√©terminer quel appareil nous avons?  - nous regardons la puce et r√©√©crivons tout ce qui y est √©crit.  Nous ouvrons la fiche <i>technique</i> sur notre puce, la section <i>Informations de commande</i> d√©crit quelle lettre est responsable de quoi.  Dans mon cas c'est: <br><br><img src="https://habrastorage.org/webt/pa/kn/ga/pakngat6l5tahlk-y75nledccuy.png"><img src="https://habrastorage.org/webt/f0/fb/jk/f0fbjkrbe8a-g5uqbjdovxzr_fc.png"><br><br><div class="spoiler">  <b class="spoiler_title">Je s√©lectionne ma puce (16K) dans Target et je continue.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/qs/u4/v2/qsu4v2uhtvft1sj1uhp2bnount4.png"><br></div></div><br>  Un choix de 4 actions avec une puce est propos√©: <br><br><ol><li>  effacer la m√©moire (enti√®re ou s√©lectionner une zone sp√©cifique); </li><li>  √©crire le firmware sur l'appareil; </li><li>  lire le firmware de l'appareil; </li><li>  activer / d√©sactiver la protection en √©criture ou en lecture. </li></ol><br><h2>  2.3 Lire le firmware depuis la carte </h2><br>  Lorsque j'ai connect√© la carte pour la toute premi√®re fois, j'ai d√©cid√© de conserver le firmware d'origine, une sorte de sauvegarde - nous le ferons maintenant.  Il sera n√©cessaire d'indiquer o√π sauvegarder ce firmware et quelles pages de m√©moire sauvegarder, il est √©galement propos√© d'utiliser un format de fichier <i>hex</i> , <i>bin</i> ou <i>s19</i> au <i>choix</i> . <br><br><div class="spoiler">  <b class="spoiler_title">S√©lectionnez les pages m√©moire √† lire</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/b_/vs/yq/b_vsyqyslqo1sib02nymmymvy_m.png"><br></div></div><br>  Si vous t√©l√©chargez simplement le micrologiciel sur la carte ou lisez le micrologiciel √† partir de la carte, il n'y a pas de diff√©rence entre ces formats de fichier.  Ce qui suit est une page de progression, sur laquelle parfois le processus se bloque pendant 99% pendant longtemps (pas n√©cessairement 99), mais apr√®s quelques secondes, il se termine normalement avec succ√®s - en fait, apr√®s cela, la carte n'a pas donn√© le comportement qui correspondrait au firmware charg√©.  Autrement dit, vous devez tout reconnecter et recharger le firmware, il n'y a rien de critique √† ce sujet. <br><br>  Le fichier du micrologiciel a √©t√© enregistr√© et, √† l'avenir, il pourra √™tre t√©l√©charg√© sur la carte. <br><br>  Cependant, si la protection en lecture est install√©e, le micrologiciel ne peut pas √™tre lu. <br><br><div class="spoiler">  <b class="spoiler_title">Fen√™tre de progression</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/nb/ta/rs/nbtarsmjtb1-ylmcxaesykldlv0.png"><br></div></div><br><h2>  2.4 Flasher le tableau </h2><br>  Remplissez maintenant le fichier du firmware dont l'√©criture du code source est donn√©e ci-dessous.  Pour l'avenir, je dirai que nous allons t√©l√©charger des fichiers <i>bin</i> et <i>hex</i> , car  l'environnement de d√©veloppement les d√©livrera.  Les param√®tres suppl√©mentaires pour les fichiers <i>s19</i> et <i>hex</i> sont identiques;  contrairement √† eux, dans le fichier <i>bin</i> , vous pouvez s√©lectionner l'adresse √† partir de laquelle le firmware sera enregistr√©, par d√©faut dans l'utilitaire c'est 8000000 (adapt√© pour nous). <br><br><div class="spoiler">  <b class="spoiler_title">Pr√©paration √† l'enregistrement</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/1k/u8/cf/1ku8cfxnzt_bjob1szyix3u2xpw.png"><br></div></div><br>  Avant l'enregistrement, vous pouvez effacer la m√©moire flash du microcontr√¥leur en choisissant l'une des trois options: <br><br><ul><li>  Effacer les pages n√©cessaires (effacer les sections de m√©moire n√©cessaires); </li><li>  Pas d'effacement (sans purification); </li><li>  Effacement global (nettoyage complet). </li></ul><br>  En fait, le nettoyage est le processus d'√©criture de z√©ros dans la m√©moire. <br><br>  Il y a encore des octets facultatifs, mais jusqu'√† pr√©sent, vous ne pouvez pas les toucher.  Cliquez sur Suivant, attendez la fin du processus et vous avez termin√©. <br><br>  Si vous souhaitez enregistrer mon firmware, vous pouvez le trouver dans le cloud, le fichier <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">blink.bin</a></i> .  Lorsque vous utilisez ce micrologiciel, le voyant int√©gr√© clignotant du pied PA4 devrait clignoter. <br><br><h1>  3. √âcriture de code </h1><br><h2>  3.0 Installation de l'environnement de d√©veloppement CooCox CoIDE </h2><br>  Vous pouvez t√©l√©charger l'IDE √† partir du site Web <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SoftPedia.com</a> , avant de pouvoir le t√©l√©charger √† partir du site Web de la STM et du site Web IDE lui-m√™me, mais depuis que les IDE ont cess√© de prendre en charge, il est devenu impossible.  Il n'y a rien de critique que l'IDE ne soit plus pris en charge, non, car  pour √©crire du code, l'essentiel est le compilateur.  J'ai t√©l√©charg√© les deux versions, mais j'utilise la version 1.7.8. <br>  Le premier lancement de l'environnement est bien d√©crit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> , Suivant-&gt; Suivant-&gt; Suivant ... et rien de compliqu√©.  J'ajouterai seulement qu'il est pr√©f√©rable de cr√©er un projet, puis tout le reste. <br><br>  Et pourtant, si vous avez perdu l'onglet R√©f√©rentiel, vous pouvez le trouver dans le menu <i>Affichage -&gt; R√©f√©rentiel</i> . <br>  Vous pouvez t√©l√©charger des outils (compilateur) pour l'environnement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> ou demander √† Google "gnu tools for arm";  J'ai t√©l√©charg√© une option contenant sha1.exe √† la fin. <br><br><h2>  3.1 Cadre source </h2><br>  Donc, le projet a √©t√© cr√©√©, la puce a √©t√© s√©lectionn√©e, maintenant nous allons ajouter le minimum de sources au projet, sans lequel il ne pourra pas vivre du tout. <br><br><div class="spoiler">  <b class="spoiler_title">Voici √† quoi devrait ressembler le projet √† sa cr√©ation, c'est-√†-dire</b>  <b class="spoiler_title">il n'y a que le fichier principal main.c et rien de plus</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/db/rf/qh/dbrfqhef0pg7j3perjtzm3b3okc.png"><br></div></div><br>  <b>S√©lectionnez CMSIS BOOT</b> et l'environnement <b>s√©lectionnera</b> automatiquement <b>M0 Cmsis Core</b> , car  les d√©pendances l'exigent. <br><br><div class="spoiler">  <b class="spoiler_title">Maintenant, nous obtenons l'ensemble minimum de sources</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/fk/u8/qt/fku8qtl8uhcttxq_xswbovf-10c.png"><br></div></div><br>  Assemblez le projet (ic√¥ne Build ou touche F7).  Pour des raisons que je ne connais pas, le fichier hexad√©cimal n'a pas √©t√© collect√© (il y a un avertissement dans la console);  J'ai r√©install√© l'IDE et le compilateur plusieurs fois, recr√©√© le projet, mais pour une raison quelconque, un tel r√©sultat sur la machine virtuelle;  sur un autre ordinateur (pas virtuel, mais r√©el), tout est en t√™te-√†-t√™te et la sortie fonctionne en hexad√©cimal.  Heureusement, il y a bin. <br><br><div class="spoiler">  <b class="spoiler_title">Le projet a √©t√© assembl√© avec succ√®s</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ap/zn/ct/apznctscxqdbgullp11rzqxtyj4.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Je vous conseille de faire attention √† la taille du fichier, il peut √™tre vu √† la fin de la sortie dans la console, ou vous pouvez le voir par des moyens standard (ici, au fait, vous pouvez voir que l'hex est vide);</b>  <b class="spoiler_title">En m√™me temps, cette capture d'√©cran montre que les fichiers du firmware se trouvent dans le dossier du projet, puis Debug / bin /</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ho/ue/wd/houewdyn-cyjvmn-js5sbah-yru.png"><br></div></div><br>  Bien que le code ne fasse rien, je le t√©l√©charge sur la carte afin de m'assurer que vous pouvez le t√©l√©charger (ce qui, par exemple, l'utilitaire ne le rejette pas).  Je conseille au lecteur de le faire.  Si cela ne fonctionne pas, r√©essayez encore et √©crivez des commentaires. <br><br><h2>  3.2 Algorithme de doigt </h2><br>  Pour commencer, nous d√©crivons un algorithme comment, d'un point de vue humain, le microcontr√¥leur clignotera une LED.  Et pour cela un petit raisonnement. <br><br>  Chaque √©quipement fonctionne en raison de l'√©nergie stock√©e, par exemple, certains moteurs peuvent fonctionner avec diff√©rents types de carburant, mais pour cela, le moteur doit √™tre ajust√© au type de carburant avec lequel nous allons le nourrir.  De m√™me, le microcontr√¥leur doit √™tre ajust√© (r√©gl√©) pour la source d'√©nergie - ce sera le <i>premier bloc de l'</i> algorithme. <br>  Nous raisonnons plus loin.  L'ordinateur de bureau a un moniteur, des haut-parleurs, un clavier, une souris ... et vous pouvez voir que certains appareils nous fournissent des informations, et avec l'aide d'autres, nous fournissons des informations √† l'ordinateur, mais ils sont tous connect√©s √† une bo√Æte commune √† tous (l'unit√© centrale).  Vous pouvez deviner que le microcontr√¥leur peut recevoir et donner des informations, ce qui signifie que ses jambes peuvent recevoir un signal ou √©mettre un signal - ce sera le <i>prochain bloc de l'</i> algorithme. <br><br>  Ensuite, le microcontr√¥leur doit allumer la LED, attendre un moment, √©teindre la LED, attendre un moment et l'allumer-attendre-√©teindre ... <br><br>  En cons√©quence, l'algorithme ressemblera √† ceci <br><br><img src="https://habrastorage.org/webt/h1/m4/oo/h1m4oou5txdafrybbwobj69vahm.png" height="361" width="192"><br><br>  Le but de cet organigramme est de montrer clairement ce que fait l'algorithme;  Tout d'abord, le sch√©ma est √©crit pour vous-m√™me, donc tout le monde est libre de l'√©crire / le dessiner comme il veut (pour lui-m√™me).  Je crois que le sch√©ma devrait viser √† √™tre aussi simple, lisible et intuitif que possible, √† avoir un niveau d'abstraction √©lev√©. <br><br>  Conform√©ment √† cet algorithme, nous √©crirons du code. <br><br><h2>  3.3 Travailler avec la documentation </h2><br>  Je recommande de lire cette partie de l'article avec le fichier ouvert <i>stm32f0xx.h</i> , qui se trouve dans le dossier <i>cmsis_boot</i> de notre projet, et la documentation ouverte. <br><br><h3>  3.3.1 S√©lection d'une source d'horloge </h3><br>  Tout d'abord, vous devez alimenter le microcontr√¥leur.  Le microcontr√¥leur re√ßoit 5 Volts de l'adaptateur (mesur√© avec un multim√®tre), mais la question se pose de ¬´√† quelle fr√©quence le microcontr√¥leur travaille-t-il¬ª, car il est connu que l'√©lectronique fonctionne √† diff√©rentes fr√©quences.  Tout d'abord, ouvrez la <i>fiche technique</i> , dans le contenu, vous pouvez voir deux sections pertinentes: <i>Gestion de l'alimentation</i> , <i>Horloges et d√©marrage</i> .  Le premier concerne les modes de tension et de faible puissance.  La deuxi√®me section cache ce qui nous int√©resse en ce moment.  D√©j√† dans la toute premi√®re phrase, il est dit ¬´l'oscillateur interne RC 8 MHz est s√©lectionn√© comme horloge CPU par d√©faut lors de la r√©initialisation¬ª, ce qui signifie que <i>par d√©faut apr√®s la r√©initialisation du MC, la cha√Æne RC interne 8 MHz</i> est s√©lectionn√©e comme <i>source d'horloge principale</i> . <br>  Vient ensuite un sch√©ma d'arbre d'horloge incompr√©hensible, que nous examinerons un peu plus tard. <br><a name="Clock_tree"></a><br><br><div class="spoiler">  <b class="spoiler_title">Arbre d'horloge</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/sg/nl/ul/sgnlul1krp_mdiqntf5it8a0eni.png"></div></div><br>  √Ä strictement parler, vous pouvez vous fier √† l'expression "par d√©faut apr√®s r√©initialisation du MK ..." et lire cette partie de l'article en diagonale. <br><br>  Maintenant, vous devez vous laisser distraire par la carte et rechercher la LED interne.  Je sais que les diodes dans les circuits sont d√©sign√©es par <i>D1</i> , <i>D2</i> ..., c'est-√†-dire  <i>D == diode</i> , sur ma carte pr√®s de la r√©sistance <i>R7 se</i> trouve la diode <i>D1</i> . <br><br><div class="spoiler">  <b class="spoiler_title">Photo du tableau</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ma/ze/ke/mazekeve26x9-imexuqb2k1knb8.png" width="462" height="330"><br></div></div><br>  Peut-√™tre, apr√®s avoir soigneusement examin√© la carte, vous pouvez d√©terminer √† quelle jambe la diode est accroch√©e, mais je vais me tourner vers la carte de circuit imprim√©.  Malheureusement, les √©l√©ments de la carte ne correspondent pas exactement aux √©l√©ments du circuit √† leur emplacement;  mais je suis content d'avoir trouv√© un tel sch√©ma sur Internet (sinon je n'ai rien trouv√© pendant longtemps). <br><br><img src="https://habrastorage.org/webt/id/gz/tw/idgztwbtwraskhguvq-9alkrp18.png"><br><br>  Dans le diagramme, nous voyons que la cathode de la diode est connect√©e √† la masse via le cavalier <i>J2</i> , et l'anode est connect√©e √† la broche <i>PA4</i> via une r√©sistance.  <i>PA4</i> signifie la 4√®me sortie du port <i>A</i> , ce qui signifie que pour allumer et √©teindre la LED, il sera n√©cessaire de fournir une tension √† la sortie de <i>PA4</i> . <br><br>  Ensuite, vous devez d√©terminer comment appliquer une tension √† cette sortie.  Ce n'√©tait pas du tout intuitif pour moi, et pendant longtemps j'ai parcouru la documentation dans le sens de la longueur et √† travers jusqu'√† ce que je tombe sur le <b>diagramme</b> dans la section <i>Description</i> au tout d√©but de la fiche technique.  Et dedans, j'ai vu la piste pr√©cieuse <i>PA [15: 0] &lt;=&gt; Port GPIO A &lt;=&gt; D√©codeur AHB &lt;=&gt; Matrice de bus &lt;=&gt; Cortex-M0</i> , c'est <i>-√†-</i> dire  Le port <i>A</i> est un port d'E / S √† usage g√©n√©ral et est connect√© au bus <abbr title="Bus avanc√© hautes performances"><i>AHB</i></abbr> . <br><br><div class="spoiler">  <b class="spoiler_title">Sch√©ma fonctionnel</b> <div class="spoiler_text">  (L'image est cliquable) <br> <a href=""><img src="https://habrastorage.org/webt/_e/hf/d0/_ehfd0kdf5v87xxud5yj4abp3xu.png"></a> <br></div></div><br>  Je note qu'en √©lectronique, il est habituel de casser les sorties du microcontr√¥leur en ports, et g√©n√©ralement le port a 16 sorties.  Le diagramme montre que les ports <i>A</i> , <i>B</i> et <i>C</i> n'en ont que 16, mais les ports <i>D</i> et <i>F en</i> ont moins (moins de 16 broches peuvent l'√™tre, plus - non). <br><br>  Revenons au sch√©ma de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">arbre d'horloge</a> et trouvons la sortie sign√©e par <i>AHB</i> .  Nous d√©terminerons √† quelle fr√©quence cette sortie fonctionne.  Pour l' <i>AHB est</i> le signal <i>HCLK</i> , qui quitte le diviseur <i>HPRE</i> .  Ce diviseur re√ßoit le signal <abbr title="SYST√àME CLOCK"><i>SYSCLK</i></abbr> du commutateur <abbr title="Horloge syst√®me sWitch"><i>SW</i></abbr> .  Lequel des signaux √† l'entr√©e <i>SW</i> sera utilis√© car <i>SYSCLK</i> est <i>d√©fini par programme</i> - nous le <i>d√©finirons</i> ensuite dans le code.  Le choix est offert: <br><br><ol><li>  <i><abbr title="Interne haute vitesse">HSI</abbr></i> - un signal provenant d'un g√©n√©rateur haute fr√©quence interne, il est produit par un r√©sonateur √† quartz de 8 MHz, que j'ai soud√© avant de travailler avec cette carte; </li><li>  <i><abbr title="Boucle de verrouillage de phase CLocK">PLLCLK</abbr></i> - signal provenant du multiplicateur de fr√©quence <i>PLLMUL</i> ; </li><li>  <i><abbr title="Haute vitesse externe">HSE</abbr></i> - signal provenant d'un g√©n√©rateur haute fr√©quence externe. </li></ol><br>  Toute option convient √† notre t√¢che, je sugg√®re de choisir la plus simple et la plus abordable d'entre elles - <i>HSI</i> . <br><br>  Nous allons entrer dans le <i>manuel de r√©f√©rence</i> et ouvrir la section <i>7 R√©initialisation et contr√¥le d'horloge (RCC)</i> , en particulier <i>7.2.6 S√©lection de l'horloge syst√®me</i> , o√π une fois encore nous rencontrons un libell√© similaire trouv√© dans la fiche technique: "apr√®s une r√©initialisation du syst√®me, l'oscillateur <i>HSI</i> est s√©lectionn√© comme syst√®me horloge "- c'est-√†-dire  nous n'avons m√™me rien √† faire, MK commencera sur <i>HSI</i> . <br><br>  Pour m'assurer que MK fonctionnera vraiment √† partir de cette source, je l'√©crirai explicitement dans le programme;  Faites d√©filer jusqu'aux registres responsables de la r√©initialisation et de la synchronisation (section <i>7.4 Registres RCC</i> ).  Le premier registre d√©crit dans la documentation est <b>le registre de contr√¥le d'horloge (RCC_CR)</b> ;  Voici une description des bits, qui est responsable de quoi. <br><br><div class="spoiler">  <b class="spoiler_title">Registre de contr√¥le d'horloge</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/qq/i4/ll/qqi4llshdqrtgidy2_x-hxx9yhe.png"><br></div></div><br>  Nous nous int√©ressons au bit z√©ro <i>HSION</i> , qui est responsable de la mise en marche du r√©sonateur ( <i>0</i> - d√©sactiv√©, <i>1</i> - <i>activ√©</i> ). <br><br>  Ainsi, il sera n√©cessaire d'en √©crire un dans le registre <i>RCC_CR</i> .  (z√©ro bit est un, ou 2 <sup>0</sup> = 1). <br><br>  Maintenant, nous trouvons dans le fichier <i>stm32f0xx.h</i> la d√©finition de <b>RCC</b> ( <i>#define RCC</i> ). <br><br><div class="spoiler">  <b class="spoiler_title">RCC-&gt; RC</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/vn/ej/0x/vnej0xmqlqnrgeprbgyjo9cpjt8.png"><br></div></div><br>  Comme vous pouvez le voir, il s'agit de la structure situ√©e √† <i>RCC_BASE</i> ;  adresse <i>0x40021000</i> , si vous d√©veloppez tout <i>d√©finir</i> , la m√™me adresse peut √™tre vue dans le <i>manuel de r√©f√©rence</i> dans la section <i>2.2.2 Carte m√©moire et enregistrer les adresses de limite</i> et dans la fiche technique dans la section <i>5 Cartographie m√©moire</i> (zone <i>AHB</i> ). <br><br>  Pour √©crire une unit√© pour activer <i>HSI</i> dans le registre <i>CR du</i> bloc <i>RCC</i> , vous avez besoin d'une ligne de code <br><br><pre><code class="plaintext hljs">RCC-&gt;CR |= 0x1;</code> </pre> <br><h3>  3.3.2 R√©glage des jambes </h3><br>  L'envoi d'un signal √† la jambe du microcontr√¥leur pour allumer la LED et arr√™ter le signal pour que la LED s'√©teigne sont des actions simples, et donc cela se r√©f√®re aux fonctions <i><abbr title="Entr√©es / sorties √† usage g√©n√©ral">GPIO</abbr></i> (ports d'entr√©e-sortie √† usage g√©n√©ral). <br><br>  Par d√©faut, les jambes MK ne sont pas connect√©es, c'est-√†-dire  la sortie est l'incertitude.  Il est n√©cessaire de connecter un port, dont la jambe alimentera la LED.  Plus t√¥t, nous avons d√©termin√© que les ports <i>GPIO</i> sont connect√©s au bus <i>AHB</i> - vous devez prendre ce bus.  En continuant √† parcourir la section <i>7.4 Registres RCC</i> ( <i>registres de</i> commande de contr√¥le et de r√©initialisation), nous trouvons la section <i>7.4.6 Registre d'activation d'horloge p√©riph√©rique AHB</i> ( <b>RCC_AHBENR</b> , <i>registre d'activation d'horloge de</i> bus <i>AHB</i> ).  Plus t√¥t, j'ai d√©termin√© que ma LED est connect√©e √† la jambe <i>PA4</i> - en cons√©quence, j'ai besoin d'√©crire une unit√© sur le 17e bit du registre afin de clouer le port <i>A.</i> <br><br><div class="spoiler">  <b class="spoiler_title">Registre d'activation de l'horloge p√©riph√©rique AHB</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/u7/s5/vs/u7s5vsoduvggexg9chpopozlzdw.png"><br></div></div><br>  En cons√©quence, le code devrait √™tre <br><br><pre> <code class="plaintext hljs">RCC-&gt;AHBENR |= (1 &lt;&lt; 17);</code> </pre> <br>  ou, c'est la m√™me chose <br><br><pre> <code class="plaintext hljs">RCC-&gt;AHBENR |= 0x20000;</code> </pre> <br>  soit en utilisant le fichier <i>#define</i> <i>stm32f0xx.h en</i> √©criture <br><br><pre> <code class="plaintext hljs">RCC-&gt;AHBENR |= RCC_AHBENR_GPIOAEN;</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">RCC-&gt; AHBENR</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/19/ex/ke/19exkey4g-yyfkz4pmvrrgilnlk.png"><br></div></div><br>  Nous avons aliment√© le port <i>A</i> , nous devons maintenant informer MK que <i>PA4</i> fonctionnera √† la <i>sortie</i> - nous lirons la section <i>8 E / S √† usage g√©n√©ral (GPIO)</i> ;  l'introduction de la section dit d√©j√† "Chaque port d'E / S √† usage g√©n√©ral a quatre registres de configuration 32 bits ( <b>GPIOx_MODER</b> , <b>GPIOx_OTYPER</b> , <b>GPIOx_OSPEEDR</b> et <b>GPIOx_PUPDR</b> ), deux registres de donn√©es 32 bits ( <b>GPIOx_IDR</b> et <b>GPIOx_ODR</b> ) ..." - <i>pour chaque GPIO Il y a 4 registres de r√©glage et 2 registres de donn√©es dans le port</i> - c'est ce dont nous avons besoin (configurer le port <i>A</i> , ou plut√¥t la sortie <i>PA4</i> , et lui envoyer p√©riodiquement <i>0</i> et <i>1</i> ).  Pour une meilleure compr√©hension (th√©orie) de ce qui se passe, vous pouvez lire cette section, mais je fais d√©filer jusqu'√† la section <i>8.4 Registres GPIO</i> et configurer le port conform√©ment aux descriptions. <br><br><ol><li>  <b>mode</b> port - quitter.  Conform√©ment √† la documentation, il est n√©cessaire d'√©crire <i>01</i> dans la zone correspondante ( <i>MODER4</i> ) du registre correspondant ( <i>GPIOA_MODER</i> ), c'est-√†-dire  bits <i>9</i> et <i>8</i> : dans le 9√®me bit doit √™tre nul, dans la 8√®me unit√©: <br><br><pre> <code class="plaintext hljs">GPIOA-&gt;MODER |= (1 &lt;&lt; 8); // </code> </pre> <br><pre> <code class="plaintext hljs">GPIOA-&gt;MODER |= 0x100; // </code> </pre> <br><pre> <code class="plaintext hljs">GPIOA-&gt;MODER |= GPIO_MODER_MODER4_0;</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Registre du mode de port GPIO</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/tv/xf/vt/tvxfvtoiw91rguuz-rtmgcrk8fo.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">GPIOA-&gt; MODER</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/co/df/x5/codfx50xu4hopklififyeecpiqu.png"><br></div></div><br></li><li>  <b>type de</b> sortie.  Honn√™tement, je n'ai toujours pas compl√®tement compris les circuits de cette affaire (je comprendrai, relirai les forums, etc.), mais √©tudier d'autres ressources sur la configuration de la sortie MK, ainsi que la logique et l'intuition, sugg√®re qu'il devrait y avoir une <b>pouss√©e -pull</b> et ensuite devrait √™tre <i>pull-up</i> .  Dans tous les cas, le code est √©crit, tout fonctionne et rien ne br√ªle.  Il existe un risque r√©el de br√ªlure si vous s√©lectionnez le type √† <b>drain ouvert</b> et court-circuitez cette sortie avec un autre appareil, comme  Il s'agit d'une sortie ouverte et n'est prot√©g√©e par rien.  De plus, nous avons une r√©sistance de limitation de courant devant la diode - elle ne br√ªlera certainement pas ici. <br><br>  Suite √† la documentation, il est n√©cessaire d'√©crire z√©ro dans le 4√®me bit;  la documentation indique √©galement qu'apr√®s la r√©initialisation, il y aura z√©ro. <br><br><pre> <code class="plaintext hljs">GPIOA-&gt;OTYPER &amp;= ~(1 &lt;&lt; 4); // </code> </pre> <br><pre> <code class="plaintext hljs">GPIOA-&gt;OTYPER &amp;= ~0x10; // </code> </pre> <br><pre> <code class="plaintext hljs">GPIOA-&gt;OTYPER &amp;= ~GPIO_OTYPER_OT_4;</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Registre du type de sortie du port GPIO</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ii/3k/ch/ii3kcht4jvsbnd7yybouiilgmhk.png"><br></div></div><br></li><li>  <b>vitesse de</b> sortie.  Dans notre cas, cela n'a pas d'importance, mais pour des raisons de fid√©lit√©, je vais √©crire ici z√©ro. <br><br><pre> <code class="plaintext hljs">GPIOA-&gt;OSPEEDR &amp;= ~(1 &lt;&lt; 8); // </code> </pre> <br><pre> <code class="plaintext hljs">GPIOA-&gt;OSPEEDR &amp;= ~0x100; // </code> </pre> <br><pre> <code class="plaintext hljs">GPIOA-&gt;OSPEEDR &amp;= ~GPIO_OSPEEDER_OSPEEDR4_0;</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Registre de vitesse de sortie du port GPIO</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/47/xg/fr/47xgfrtfqdl5ai0eztsrqej1i1k.png"><br></div></div><br></li><li>  <b>un ascenseur</b> .  Parce que  la sortie alimentera la LED, vous devez la tirer √† la puissance, c'est-√†-dire  <b>pull-up</b> . <br><br>  Il est n√©cessaire de serrer la 4√®me broche du port <i>A</i> ;  la documentation indique que pour cela, il est n√©cessaire d'√©crire respectivement z√©ro et un sur <i>9</i> et <i>8</i> bits. <br><br><pre> <code class="plaintext hljs">GPIOA-&gt;PUPDR |= (1 &lt;&lt; 8); // </code> </pre> <br><pre> <code class="plaintext hljs">GPIOA-&gt;PUPDR |= 0x100; // </code> </pre> <br><pre> <code class="plaintext hljs">GPIOA-&gt;PUPDR |= GPIO_PUPDR_PUPDR4_0;</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Registre pull-up / pull-down du port GPIO</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/pg/pa/zk/pgpazkwfltwme4jy0wwrhp9imqi.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">GPIOA-&gt; PUPDR</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/bo/ee/na/boeenaff6fxjiemjuiky9ukhb6w.png"><br></div></div><br></li></ol><br><h3>  3.3.3 LED on / off et retard </h3><br>  Plus t√¥t, nous lisons que chaque port a des registres, y compris des registres de donn√©es <i><abbr title="Registre de donn√©es d'entr√©e">IDR</abbr></i> et <i><abbr title="Registre des donn√©es de sortie">ODR</abbr></i> - registres de donn√©es d'entr√©e et de sortie, respectivement.  Z√©ros logiques et uns sur la jambe MK - ces donn√©es sont-elles?  - oui, les donn√©es.  Les donn√©es peuvent provenir de l'ext√©rieur du microcontr√¥leur (√™tre <i>entr√©es</i> ) et sortir du microcontr√¥leur et aller vers un autre appareil (√™tre <i>sorties</i> ).  L'unit√© sur la jambe MK est la pr√©sence d'un niveau de haute tension, c'est-√†-dire  si vous en apportez un √† la sortie, alors il y aura de la tension, et cette LED peut alimenter notre LED.  La sortie d'une unit√© vers le pied du microcontr√¥leur est autre chose que l'√©criture de cette unit√© dans le registre de sortie <i>ODR</i> . <br><br><div class="spoiler">  <b class="spoiler_title">Registre de donn√©es de sortie du port GPIO</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/or/vw/el/orvwel6seyhwvx6pbxdcow6ufpm.png"><br></div></div><br>  Selon la documentation, nous voyons que pour chaque port ( <i>A</i> , <i>B</i> , <i>C</i> , <i>D</i> , <i>F</i> ) il y a cependant un registre 32 bits.  le port ne peut pas avoir plus de 16 broches, alors seuls les 16 premiers bits du registre sont utilis√©s.  Chaque bit correspond √† un num√©ro de port (broche).  Pour sortir une unit√© sur la jambe <i>PA4</i> , il faut √©crire une unit√© sur le 4e bit, pour sortir un z√©ro - √©crire un z√©ro sur le 4e bit, c'est-√†-dire  supprimer la tension de la sortie. <br><br><img src="https://habrastorage.org/webt/pr/0n/pr/pr0npr4jplwjahmcflj_nlksq5i.png" width="400" height="156"><br><br><div class="spoiler">  <b class="spoiler_title">GPIOA-&gt; ODR</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/hs/yy/v4/hsyyv4z5u2kf6fkqqe5wk9t6ti4.png"><br></div></div><br>  Le code pour allumer la LED ressemblera √† ceci <br><br><pre> <code class="plaintext hljs">GPIOA-&gt;ODR |= (1 &lt;&lt; 4); // </code> </pre> <br><pre> <code class="plaintext hljs">GPIOA-&gt;ODR |= 0x10; // </code> </pre> <br><pre> <code class="plaintext hljs">GPIOA-&gt;ODR |= GPIO_ODR_4;</code> </pre> <br>  Code pour √©teindre la LED <br><br><pre> <code class="plaintext hljs">GPIOA-&gt;ODR &amp;= ~(1 &lt;&lt; 4); // </code> </pre> <br><pre> <code class="plaintext hljs">GPIOA-&gt;ODR &amp;= ~0x10; // </code> </pre> <br><pre> <code class="plaintext hljs">GPIOA-&gt;ODR &amp;= ~GPIO_ODR_4;</code> </pre> <br>  Mais si vous √©crivez la ligne pour √©teindre la LED apr√®s la ligne pour l'allumer, la LED ne clignotera pas (si vous √™tes int√©ress√© par ce qui se passe - vous pouvez essayer; rien ne br√ªlera, cela a d√©j√† √©t√© discut√© ci-dessus) - alors vous devez faire un retard.  Les minuteries sont utilis√©es pour le retard, mais les minuteries sont dignes d'un article s√©par√© (en raison de la complexit√©), nous allons donc faire un retard de b√©quille: nous allons conduire le cycle de ralenti.  Il y a un point: <b>si l'optimisation du compilateur est activ√©e</b> , le <b>compilateur coupera</b> notre cycle d'inactivit√© et il n'y aura pas de retard.  Assurez-vous que l'optimisation n'est pas activ√©e.  Pour ce faire, entrons dans la configuration du projet (clic droit sur le nom du projet dans l'arborescence du projet) et v√©rifions la ligne <i>Compiler Control String</i> dans l'onglet <i>Compiler</i> : elle doit avoir l'argument <i>-O0</i> (¬´environ z√©ro¬ª signifie que l'optimisation est d√©sactiv√©e).  Si vous avez tout collect√© selon mes instructions, vous aurez probablement aussi <i>-O0</i> , car  c'√©tait par d√©faut et je n'ai rien touch√© ici.  Les arguments <i>-O1 -O2 -O3</i> signifient que l'optimisation du niveau correspondant est activ√©e. <br><br><div class="spoiler">  <b class="spoiler_title">V√©rification de l'optimisation du compilateur</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/vc/ps/pu/vcpspuz5xfupw1pa5n-e5at9_nm.png"><br></div></div><br>  Un cycle inactif peut s'√©crire comme ceci: <br><br><pre> <code class="plaintext hljs">int t = 4000000; while(t &gt; 0) t--;</code> </pre><br>  Je n'ai pas d√©fini la valeur de <i>t en</i> tant que telle, j'ai raisonn√© comme suit: si le microcontr√¥leur fonctionne √† 8 MHz, il ex√©cutera environ 8 000 000 d'instructions en une seconde, si vous exag√©rez profond√©ment, puis pendant une demi-seconde, vous devrez ex√©cuter le cycle 4 000 000 fois. <br>  Le cycle de veille devra √™tre ex√©cut√© apr√®s avoir allum√© la LED et apr√®s l'avoir √©teinte, et tout cela en boucle. <br><br><h3>  3.4 √âcriture de code et ex√©cution </h3><br>  Mettons ensemble toutes les lignes de code que nous avons √©crites auparavant.  Vous devez √©galement inclure le fichier d'en-t√™te <i>stm32f0xx.h</i> , comme  nous nous y sommes appuy√©s et en avons tir√© des d√©finitions des structures, des adresses et des valeurs.  Le r√©sultat devrait √™tre: <br><br><pre> <code class="plaintext hljs">#include "stm32f0xx.h" int main(void) { int t; //  '' RCC-&gt;CR |= 0x1; //   HSI RCC-&gt;AHBENR |= RCC_AHBENR_GPIOAEN; //   A GPIOA-&gt;MODER |= GPIO_MODER_MODER4_0; // PA4   GPIOA-&gt;OTYPER &amp;= ~GPIO_OTYPER_OT_4; //  push-pull  PA4 GPIOA-&gt;OSPEEDR &amp;= ~GPIO_OSPEEDER_OSPEEDR4_0; //    PA4 GPIOA-&gt;PUPDR |= GPIO_PUPDR_PUPDR4_0; //  pull-up  PA4 while(1) { GPIOA-&gt;ODR |= GPIO_ODR_4; //    PA4 t = 4000000; while(t &gt; 0) t--; //  GPIOA-&gt;ODR &amp;= ~GPIO_ODR_4; //    PA4 t = 4000000; while(t &gt; 0) t--; //  } }</code> </pre><br>  Cliquez sur Reconstruire et remplissez le code sur la carte via l'utilitaire. <br><br><img src="https://habrastorage.org/webt/fo/rr/1d/forr1d6ruw6sohn7eyomgs4yb_g.png"><br><br>  Pour que la carte lance un nouveau firmware, n'oubliez pas de fermer le cavalier BOOT et de faire une r√©initialisation (RESET). <br><br><h1>  4. Conclusion </h1><br>  Le code est √©crit, tout fonctionne.  Les forces ont d√©pens√© sans mesure.  Je suis heureux que sur la base de la documentation, il se soit av√©r√© √©crire du code de travail, principalement en raison du fait que STM dispose d'une documentation de haute qualit√©. <br><br>  Les plans sont d'√©crire un article sur la fa√ßon de tout assembler √† la main, sans IDE, via la console, <i>vrai oldschool</i> , id√©alement pour que tout cela puisse se faire sous Linux.  Maintenant, je travaille sur PWM et ADC (√©galement sur cette carte) - je vais aussi √©crire un article dessus. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr437234/">https://habr.com/ru/post/fr437234/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr437224/index.html">Traduction de mod√®les Dust en JSX</a></li>
<li><a href="../fr437226/index.html">Ombre √† point Kelvin</a></li>
<li><a href="../fr437228/index.html">Le bitcoin, en tant que monnaie, entra√Ænera une crise √©conomique</a></li>
<li><a href="../fr437230/index.html">Une telle publicit√© en ligne diff√©rente. Trois axes vs AI, Ad Tech et DOOH</a></li>
<li><a href="../fr437232/index.html">Psto bon</a></li>
<li><a href="../fr437236/index.html">ESET: une analyse des nouveaux composants de Zebrocy</a></li>
<li><a href="../fr437238/index.html">Orange Pi 3 est sorti - un mini-pc complet √† 30 $ sous Linux</a></li>
<li><a href="../fr437240/index.html">Comment int√©grer Zimbra Collaboration Suite avec Active Directory</a></li>
<li><a href="../fr437242/index.html">Ma√Ætrise du chef de produit. Demandes de fonctionnalit√©s</a></li>
<li><a href="../fr437244/index.html">Google apprend aux utilisateurs √† reconna√Ætre les e-mails de phishing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>