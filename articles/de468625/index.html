<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ©Ô∏è üîØ üëâüèº Serverlos: 15% langsamer und achtmal teurer ü¶è üßîüèΩ üëê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich habe k√ºrzlich beschlossen, mit der API auf unserer CardGames.io- Website zu experimentieren und das Serverless- Framework auszuprobieren . In den ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Serverlos: 15% langsamer und achtmal teurer</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468625/">  Ich habe k√ºrzlich beschlossen, mit der API auf unserer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CardGames.io-</a> Website zu experimentieren und das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Serverless-</a> Framework <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auszuprobieren</a> .  In den letzten Jahren ist es ein hei√ües Thema in der Welt der Technologie geworden, und ich habe <s>gez√∂gert</s> , meine technischen F√§higkeiten auf dem neuesten Stand zu halten und etwas Neues auszuprobieren.  Aus diesem Grund habe ich mich entschlossen, mehrere Stunden mit Serverless zu verbringen und zu pr√ºfen, ob eine solche API-Platzierung sinnvoll ist. <br><br><h4>  Aktuelle Konfiguration </h4><br>  CardGames.io l√§uft unter AWS.  Alle HTML-Seiten, CSS, JavaScript und Bilder werden in S3 gespeichert.  Wir haben eine C # -API, die auf Elastic Beanstalk gehostet wird und auf Linux-Servern ausgef√ºhrt wird, auf denen .NET Core mit Docker ausgef√ºhrt wird.  Schlie√ülich verwenden wir CloudFront CDN vor der Statik auf S3 und API.  Unten ist der EC2-Score f√ºr August 2019.  Wir haben mehrere andere Instanzen, aber die APIs funktionieren auf m1.small (ja, t2.small funktioniert wahrscheinlich besser) mit klassischem Lastausgleich.  Wenn Sie das rot hervorgehobene zusammenfassen, kommen 164,21 USD pro Monat heraus, nicht schlecht.  Ich habe dort sogar EBS aufgenommen, da ich nicht sicher bin, wie ich diese Ausgaben aufteilen soll. Wir haben mehrere Projekte zu EC2. <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/682/96b/05e/68296b05e1d7b07d57e0e2683d129c49.png" width="550"></div><br>  <i><font color="gray">AWS-Konto f√ºr elastische Bohnenstange</font></i> <br><br>  Wir haben zwei Umgebungen mit jeweils 1-3 Instanzen: aktiv und inaktiv, da die .NET Core-Bereitstellung in Docker unter AWS einige Minuten dauert. Wir tun dies also in einer inaktiven Umgebung und wechseln dann die CNAME-Datens√§tze zu der k√ºrzlich bereitgestellten.  Langsame Bereitstellung war einer der Gr√ºnde, warum ich etwas Neues ausprobieren wollte.  Wir haben mehrere Server mit node.js-Anwendungen auf Beanstalk - und diese werden in Sekunden bereitgestellt.  Ich wollte, dass es f√ºr die API dasselbe ist. <br><br><h4>  Wechseln zu Serverless </h4><br>  Ich habe ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">sehr gutes</a> ASP.NET-Web-API-Hosting- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tutorial</a> mit dem Serverless-Framework studiert und festgestellt, dass Sie einem vorhandenen API-Projekt nur eine einfache Konfigurationsdatei, eine Abh√§ngigkeit und eine kleine Startklasse hinzuf√ºgen m√ºssen.  Die Bereitstellung dauerte ungef√§hr zwanzig Sekunden - viel besser als in Beanstalk.  Ich denke, dank der integrierten Unterst√ºtzung f√ºr .NET Core in Lambda (jedoch nur 2.2), w√§hrend es in Beanstalk nur unterst√ºtzt wird, wenn Sie ein unabh√§ngiges Docker verwenden.  Auf jeden Fall war ich gl√ºcklich, ohne an automatische Skalierungsgruppen, maximale Instanzen und dergleichen zu denken. <br><br><h4>  Leistungstests </h4><br>  Serverless unter AWS ist Lambda, das Ihre Funktionen wirklich hostet, und die Front Gateway-API, mit der Sie Dinge wie Geschwindigkeitsbegrenzungen, API-Schl√ºssel und mehr hinzuf√ºgen k√∂nnen.  Ich habe die Lambda-Funktionen in der Region us-west-2 gehostet, in der sich die Beanstalk-Server befinden.  Dann habe ich die CloudFront-Instanz so konfiguriert, dass Anforderungen von einem unserer Spiele an die neue serverlose Konfiguration und das andere an die alte Beanstalk-Konfiguration weitergeleitet werden.  Dann startete er einen einfachen Test f√ºr zwei URLs: eine Serverless, die andere Beanstalk.  Beide URLs haben dieselbe API aufgerufen und dasselbe Ereignis in der Datenbank gespeichert.  Ich habe jeweils 100 Abfragen ausgef√ºhrt. Hier sind die Ergebnisse: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d7/e34/859/3d7e34859e2a409510c6a5a85db837c1.png"></div><br>  <i><font color="gray">Leistungsvergleich</font></i> <br><br>  In mehreren L√§ufen war die serverlose Konfiguration um <b>15% langsamer</b> (wenn √ºberhaupt, habe ich sie von Island aus ausgef√ºhrt, daher der gro√üe Ping).  Die Geschwindigkeit war eine Entt√§uschung, aber sie blieb ziemlich hoch - ich erkannte, dass die API-Gateway-Front vor unserer API einen gewissen Overhead hat: Es gibt zu viele Funktionen, auch wenn wir sie nicht verwenden.  Also traurig, aber nicht kritisch! <br><br><h1>  Preise </h1><br>  Ehrlich gesagt habe ich zuerst nicht √ºber Preise nachgedacht.  Ich habe gerade entschieden, dass das Bezahlen f√ºr den tats√§chlichen Gebrauch wahrscheinlich billiger ist als das Bezahlen f√ºr Instanzen rund um die Uhr.  Daher konnte die neue serverlose Installation mehrere Tage lang ausgef√ºhrt werden und begann dann, Konten zu √ºberpr√ºfen.  Ups!  Die Rechnung f√ºr Lambda + API Gateway hat bereits einhundert Dollar √ºberschritten!  Zuerst fing ich an, am Lambda-Setup zu basteln und weniger Speicher f√ºr das Speichern zuzuweisen, aber als ich mir ansah, was gut lief, wurde klar, dass das Problem im Gateway lag.  Hier sind die API-Gateway-Raten: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/df3/05c/3a5/df305c3a5d69a5ee4de51dbcaef9307b.png" width="550"></div><br>  <i><font color="gray">Gateway-API-Preise</font></i> <br><br>  Unsere API akzeptiert ungef√§hr 10 Millionen Anfragen pro Tag.  Dies sind nur ungef√§hr 35 US-Dollar pro Gateway <b>pro Tag</b> .  Dar√ºber hinaus kostet Lambda etwa 10 US-Dollar pro Tag, obwohl dies durch die Zuweisung von weniger Speicher reduziert werden kann.  Zusammen ergibt sich ein Preis von 45 US-Dollar pro Tag oder <b>1350 US-Dollar pro Monat</b> gegen√ºber <b>164 US-Dollar pro Monat</b> bei Elastic Beanstalk.  <b>Achtmal teurer</b> !  Ich mag neue Technologien und eine schnelle Bereitstellung, aber ich werde daf√ºr keine zus√§tzlichen 1200 USD pro Monat zahlen.  Zur√ºck zu Beanstalk! <br><br><h4>  Fazit </h4><br>  Wahrscheinlich h√§tte ich mich im Voraus mit den Preisen vertraut machen und einige mathematische Berechnungen anstellen sollen!  Aber dann m√ºsste ich nat√ºrlich echte Arbeit leisten und keine wertvollen technischen F√§higkeiten erlernen!  Ich bin sicher, dass in einigen Situationen die Gateway- und Lambda-APIs besser sind als die Elastic Beanstalk.  Es ist einfach nicht unser Fall.  Wenn Sie API-Schl√ºssel, Geschwindigkeitsbegrenzungen und andere API-Gateway-Funktionen verwenden, ist es m√∂glicherweise sinnvoll, 3,50 USD pro Million Anfragen zu zahlen.  Wir sollten besser einen normalen Load Balancer vor Lambda stellen.  Soweit ich wei√ü, ist dies nicht m√∂glich. F√ºr den http-Zugriff auf Lambda ist eine Gateway-API erforderlich. <br><br>  Aber selbst wenn wir nur f√ºr Lambda bezahlt h√§tten, w√§ren bei 10 USD pro Tag 300 USD pro Monat statt 164 USD herausgekommen.  Wir haben viele Abfragen, aber jede Abfrage macht sehr wenig: Grunds√§tzlich ein DB-Aufruf pro Abfrage.  M√∂glicherweise sind schwerere Abfragen, die mehr Rechenzeit ben√∂tigen, besser f√ºr Lambda geeignet, bei dem Sie f√ºr 100 ms Rechenzeit bezahlen.  Unten finden Sie einen Bericht f√ºr eine Anfrage.  Wie Sie sehen k√∂nnen, verwenden wir 3,50 ms Rechenzeit, aber die Rechnung ist auf 100 ms eingestellt, dies ist keine schwache Rundung. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d28/6d9/f84/d286d9f841b7aae30794ee34e2eab86e.png"></div><br>  <i><font color="gray">Lambda-Bericht f√ºr eine Anfrage</font></i> <br><br>  Schlie√ülich kritisiere ich Gateway-, Lambda- oder Serverless-APIs √ºberhaupt nicht.  Nur um zu zeigen, dass sie f√ºr einige Workloads viel teurer sind als die langweiligen alten EC2 und Elastic Beanstalk.  Auf was wir bleiben werden.  Es ist auch wahrscheinlich, dass es eine viel bessere oder effizientere M√∂glichkeit gibt, das System zu konfigurieren. Ich bin kein AWS-Experte. Wenn Sie also offensichtliche Fehler sehen, geben Sie dies unbedingt in den Kommentaren an. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de468625/">https://habr.com/ru/post/de468625/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de468609/index.html">Die unverst√§ndliche Leistung der Mehrfachplanung</a></li>
<li><a href="../de468611/index.html">.NET-Multithreading: Wenn die Leistung fehlt</a></li>
<li><a href="../de468615/index.html">Die Top 10 Sprachen f√ºr die App-Lokalisierung</a></li>
<li><a href="../de468621/index.html">Wir √ºbersetzen das Heimnetzwerk in DoH oder einen weiteren Klick auf die Filternase</a></li>
<li><a href="../de468623/index.html">Ich m√∂chte Bewertungen zu Habr</a></li>
<li><a href="../de468627/index.html">ADAM-6200 E / A-Module</a></li>
<li><a href="../de468629/index.html">Wie ich einen Filter erstellt habe, der das Bild auch nach einer Million L√§ufen nicht besch√§digt - Teil 2</a></li>
<li><a href="../de468631/index.html">Testen von Flatteranwendungen. Starten Sie</a></li>
<li><a href="../de468635/index.html">√úbergangsmetall-Dichalkogenide: Enth√ºllung der Geheimnisse des WS2-Kristallwachstums</a></li>
<li><a href="../de468637/index.html">Umgang mit gro√üen Datenmengen in Pandas. Wir arbeiten mit der FIAS-Datenbank unter Verwendung von Python und 8 GB Speicher</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>