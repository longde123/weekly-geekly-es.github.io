<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>◾️ 🏩 🛐 Menulis klien Telegram itu mudah 👩🏼‍💼 🍾 👨🏿‍🚒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apa perbedaan antara Telegram dan utusan populer lainnya? Dia terbuka! 
 Utusan lain juga memiliki API, tetapi untuk beberapa alasan, apakah telegram ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Menulis klien Telegram itu mudah</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424245/"><p><img src="https://habrastorage.org/webt/74/05/en/7405endgngr3x59c7slog56gha0.png"></p><br><p>  Apa perbedaan antara Telegram dan utusan populer lainnya?  Dia terbuka! <br>  Utusan lain juga memiliki API, tetapi untuk beberapa alasan, apakah telegram dikenal sebagai yang paling terbuka dan paling populer? </p><br><p>  Untuk mulai dengan, Telegram memiliki klien yang benar-benar sepenuhnya terbuka <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kode</a> .  Sayangnya, kami tidak melihat komitmen setiap hari secara langsung di GitHub, tetapi kami memiliki kode di bawah lisensi terbuka.  Arsitektur Telegram menyiratkan bahwa Bot dan API memiliki metode yang hampir sama - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://core.telegram.org/methods</a> . </p><br><p>  Bahkan, Telegram bukan hanya messenger chat, tetapi platform sosial, akses yang terbuka untuk berbagai jenis aplikasi.  Mereka dapat memberikan chip tambahan kepada pengguna, alih-alih menggunakan jaringan pengguna dan server yang sudah jadi untuk pengiriman pesan.  Kedengarannya sangat menarik sehingga kami ingin mencoba menulis "klien" kami untuk Telegrams. </p><a name="habracut"></a><br><h3 id="sut-prilozheniya">  Inti dari aplikasi </h3><br><p>  Kami terutama berurusan dengan peta dan navigasi, jadi kami segera melihat sesuatu yang berkaitan dengan geolokasi.  Saya sangat suka itu di Telegram, sebelum semua aplikasi lain, ada cara mudah untuk berbagi lokasi Anda secara real time ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://telegram.org/blog/live-locations</a> ) dan saya sering menggunakannya: bantu saya mengorientasikan diri, menunjukkan jalan dan yang paling penting adalah menjawab pertanyaan utama "Kapan Anda akan menjadi?".  Pada prinsipnya, ini sudah cukup bagi kebanyakan orang, tetapi seperti biasa ada skenario ketika peluang sederhana tidak cukup.  Misalnya, dapat berupa grup lebih dari 10 orang, dengan perangkat yang berbeda (beberapa perangkat mungkin bukan ponsel) dan orang yang berbeda.  Akan lebih mudah bagi orang-orang ini untuk bertukar pesan dalam sebuah grup, serta melihat satu sama lain bergerak di peta. </p><br><p>  Kami fokus pada tugas menciptakan nilai tambahan untuk Telegram, dan tidak mencoba menggunakannya untuk tujuan lain.  Kami tidak ingin orang yang tidak memiliki klien Telegram khusus untuk melihat kekacauan pesan dalam obrolan atau sesuatu yang tidak dapat dipahami.  Orang-orang dengan klien yang "ditingkatkan" memiliki peluang tambahan, misalnya: </p><br><ol><li>  Manajemen waktu yang lebih baik saat mengirim lokasi dalam waktu nyata untuk mengobrol. </li><li>  Lihat lokasi kontak di peta. </li><li>  Menghubungkan ke obrolan perangkat suar melalui API eksternal (Bot). </li></ol><br><h3 id="kak-my-eto-delali">  Bagaimana kami melakukannya? </h3><br><p>  Untungnya, semua kode yang kita tulis adalah Open-Source, jadi saya bisa langsung memberikan tautan ke implementasinya - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Implementasi</a> <a href="">Bot</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Implementasi Telegram Client di Kotlin</a> . </p><br><h5 id="bot---osnovy">  Bot - dasar-dasarnya </h5><br><p>  Ada banyak dokumentasi dan contoh tentang implementasi Bot, tetapi saya masih ingin membahas tentang beberapa jebakan.  Untuk memulainya, kami menulis sisi server <br>  di Jawa dan memilih perpustakaan org.telegram: telegrambots.  Karena server kami adalah SpringBoot biasa, inisialisasi sangat sederhana: </p><br><pre><code class="hljs coffeescript"><span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Gradle implementation <span class="hljs-string"><span class="hljs-string">"org.telegram:telegrambots:3.6"</span></span> TelegramBotsApi telegramBotsApi = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TelegramBotsApi(); telegramBotsApi.registerBot(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TelegramLongPollingBot() {...});</code> </pre> <br><p>  Fitur utama dari transfer lokasi adalah bahwa itu perlu sering diperbarui, dan bot perlu mengedit pesan yang sudah dikirim.  Jika tidak ada kesempatan seperti itu, Bot hanya akan melakukan spam pada obrolan dan tentu saja itu adalah Kegagalan Epik.  Alhamdulillah Telegram memberi bot hak untuk mengedit pesan selama 24 jam (minimum, mungkin lebih lama). </p><br><p>  Ada banyak cara untuk mengirim pesan.  Ada jenis Teks Biasa, Tempat, Lokasi, Permainan, Kontak, Faktur, dll.  Tampaknya Lokasi sempurna untuk tugas kami, tetapi fitur yang tidak menyenangkan terungkap.  Lokasi hanya dapat ditransfer dari satu perangkat ke satu akun atau bot sekaligus!  Bayangkan Anda memiliki 2 ponsel dan dari dua ponsel Anda mengirim Lokasi Anda dalam satu obrolan.  Jadi, kesalahan akan terjadi di server dan Berbagi Lokasi pertama hanya akan berhenti.  Tampaknya ini jelas kasus neural, tetapi bayangkan Anda memiliki banyak suar China yang dapat mengirim Lokasi ke URL yang diberikan, tetapi mereka tidak dapat mengirim langsung ke Telegram.  Anda menulis Bot, yang mengambil dari server dan mendorong telegram.  Di sinilah keluar bahwa Bot tidak akan dapat mengirim lebih dari satu pesan suar dengan tipe Lokasi.  Ternyata ini bagus untuk pengiriman satu kali, tetapi tidak cocok untuk Lokasi Langsung. </p><br><p>  Solusinya sederhana - mengirim pesan teks, dan klien akan menguraikan teks dan menunjukkan lokasi di peta.  Sayangnya, hanya pesan teks yang akan terlihat di klien Telegram standar, tetapi Anda dapat memasukkan tautan di sana untuk membuka peta. </p><br><h5 id="bot---podvodnye-kamni">  Bot - Perangkap </h5><br><p>  Sayangnya, Bot harus menulis ulang sebanyak 2,5 kali.  Masalah utama adalah desain komunikasi yang salah. </p><br><ol><li>  Untuk beberapa alasan, pada awalnya sepertinya ide yang baik jika bot akan menjadi peserta penuh dalam obrolan dan mengirim pesan.  Tapi, ini buruk baik dalam hal privasi korespondensi dan dalam hal interaksi dengan bot.  Keputusan yang tepat, gunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bot Inline</a> .  Dengan demikian, dijamin bahwa bot tidak melihat apa pun selain Lokasinya dan dapat digunakan dalam obrolan apa pun.  Berbicara secara manusiawi, tidak sopan untuk menyeret bot Anda ke beberapa jenis obrolan umum, tetapi Anda perlu berbicara dengan bot satu per satu dan mengonfigurasinya, dan kemudian ia akan dapat mengirim pesan yang diperlukan ke obrolan terpilih mana pun. </li><li>  Secara historis ada 2 jenis interaksi di API Pesan Telegram: tombol di bawah teks ((tombol sebaris) [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://core.telegram.org/bots/2-0-intro#switch-to-inline-buttons</a> ]) dan menjawab bot secara langsung teks.  Secara umum, jawaban dengan bot sudah usang.  Tombol sedikit lebih rumit dari sudut pandang implementasi, tetapi ini sepenuhnya dibayar oleh kemudahan penggunaan dan mereka harus digunakan untuk semua input non-teks. </li><li>  Sebagai contoh bot, Anda dapat melihat @vote_bot populer atau @osmand_bot kami. </li></ol><br><h5 id="telegram-client">  Klien Telegram </h5><br><p>  Kami tidak dapat menemukan contoh klien telegram siap pakai, kecuali yang utama, tetapi struktur tdlib yang agak sederhana membantu kami membuat klien dasar hanya dalam beberapa hari. </p><br><div class="spoiler">  <b class="spoiler_title">Penyiapan gradle:</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">task downloadTdLibzip { doLast { ant.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(src: <span class="hljs-string"><span class="hljs-string">'https://core.telegram.org/tdlib/tdlib.zip'</span></span>, dest: <span class="hljs-string"><span class="hljs-string">'tdlib.zip'</span></span>, skipexisting: <span class="hljs-string"><span class="hljs-string">'true'</span></span>) ant.unzip(src: <span class="hljs-string"><span class="hljs-string">'tdlib.zip'</span></span>, dest: <span class="hljs-string"><span class="hljs-string">'tdlib/'</span></span>) } } task copyNativeLibs(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Copy</span></span>) { dependsOn downloadTdLibzip <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> "tdlib/libtd/src/main/libs" <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> "libs" } task copyJavaSources(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Copy</span></span>) { dependsOn downloadTdLibzip <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> "tdlib/libtd/src/main/java/org/drinkless/td" <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> "src/org/drinkless/td" } dependencies { implementation fileTree(dir: <span class="hljs-string"><span class="hljs-string">'libs'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>: [<span class="hljs-string"><span class="hljs-string">'*.jar'</span></span>]) }</code> </pre> </div></div><br><p>  Hampir semua internal Telegram ditulis dalam C ++ dan dari sudut pandang Android, hanya kelas API yang terlihat pada metode proksi 1,5 MB <a href="">TdApi.java</a> .  Dengan membandingkan dokumentasi bot dan nama metode, Anda bisa mencari tahu ke mana harus pindah. </p><br><div class="spoiler">  <b class="spoiler_title">Inisialisasi pelanggan dengan penangan global:</b> <div class="spoiler_text"><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (libraryLoaded) { <span class="hljs-comment"><span class="hljs-comment">// create client client = Client.create(UpdatesHandler(), null, null) true } else { false } }</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Permintaan foto pengguna:</b> <div class="spoiler_text"><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">requestUserPhoto</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(user: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TdApi</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">User</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> remotePhoto = user.profilePhoto?.small?.remote <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (remotePhoto != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; remotePhoto.id.isNotEmpty()) { downloadUserFilesMap[remotePhoto.id] = user client!!.send(TdApi.GetRemoteFile(remotePhoto.id, <span class="hljs-literal"><span class="hljs-literal">null</span></span>)) { obj -&gt; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (obj.<span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>) { TdApi.Error.CONSTRUCTOR -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> error = obj <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TdApi.Error <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> code = error.code <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (code != IGNORED_ERROR_CODE) { listener?.onTelegramError(code, error.message) } } TdApi.File.CONSTRUCTOR -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> file = obj <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TdApi.File client!!.send(TdApi.DownloadFile(file.id, <span class="hljs-number"><span class="hljs-number">10</span></span>), defaultHandler) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; listener?.onTelegramError(-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"Receive wrong response from TDLib: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$obj</span></span></span><span class="hljs-string">"</span></span>) } } } }</code> </pre> </div></div><br><h5 id="telegram-client---podvodnye-kamni">  Klien Telegram - jebakan </h5><br><ol><li>  Registrasi / Masuk dan Keluar.  Saat mendaftar, perlu mempertimbangkan berbagai skenario akun: ketika kode akses dikirim melalui SMS atau ke klien telegram lain, otorisasi dua faktor, dll.  Tantangan terbesar adalah pengujian.  Otorisasi apa pun lebih dari 3 kali menyebabkan pemblokiran akun selama 24 jam, jadi pengujian Keluar sangat menyenangkan.  Terlepas dari kenyataan bahwa pendaftaran hanya diperlukan sekali, ini mungkin merupakan bagian paling sulit dari integrasi. </li><li>  Tentukan bagaimana dan bagaimana cara membaca pesan.  Setiap klien memiliki akses ke semua pesan di semua obrolan, tetapi mereka harus dibaca secara berurutan.  Dalam kasus kami, 99% dari pesan harus dibuang.  Pertama, karena suatu alasan, kami membaca semua pesan selama 3 hari terakhir dengan login, tetapi kemudian hanya menyebabkan masalah dan ketika kami memulai kembali, pesan-pesan itu hilang.  Karenanya, sekarang kami hanya membaca pesan baru, dan untuk pesan yang kami butuhkan, kami menyimpan id di basis data internal. </li></ol><br><h3 id="chto-poluchilos">  Apa yang terjadi </h3><br><p>  Mungkin, mengetahui semua jebakan, seseorang bisa melakukan segalanya berkali-kali lebih cepat, tetapi ternyata sekitar 1-2 bulan untuk tiga orang.  Aplikasi terakhir dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Google Play</a> . </p><br><p><img src="https://habrastorage.org/webt/gf/o0/zs/gfo0zsgavbn09pkswyzurjoibik.png"></p><br><p>  Pertanyaan utama dalam cerita ini adalah seberapa tepat interaksi ini dari sudut pandang Telegram dan apakah pengguna menyukai jenis integrasi ini.  Bagaimanapun, ide itu sendiri adalah ceruk dan telah menemukan pelanggan individu. </p><br><p>  Saya akan dengan senang hati menjawab pertanyaan Anda. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id424245/">https://habr.com/ru/post/id424245/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id424235/index.html">Cara menggunakan STATSPACK bukannya AWR di Oracle Standard Edition</a></li>
<li><a href="../id424237/index.html">Isi daya otak Anda secara langsung! Runtimes, kompiler dan kinerja di Joker 2018</a></li>
<li><a href="../id424239/index.html">Seminar Musim Gugur IBM - Kontainer, Visi Komputer, Transformasi Digital</a></li>
<li><a href="../id424241/index.html">Cetak duniamu</a></li>
<li><a href="../id424243/index.html">5 cara mudah untuk meningkatkan komunikasi dengan pelanggan</a></li>
<li><a href="../id424247/index.html">KotlinConf 2018 Live - tonton siarannya 4-5 Oktober</a></li>
<li><a href="../id424249/index.html">Materi dari pertemuan #RuPostgres - video, presentasi, analisis kuis, dan laporan foto</a></li>
<li><a href="../id424251/index.html">Kami mempertimbangkan statistik percobaan di hh.ru</a></li>
<li><a href="../id424255/index.html">Cara menggunakan analisis statis dengan benar</a></li>
<li><a href="../id424257/index.html">Hexagon Maps in Unity: Bagian 1-3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>