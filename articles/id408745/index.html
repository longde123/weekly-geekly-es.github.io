<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤙 🧓 🌸 Hands Free, tetapi bukan ponsel. Rumah yang taat ketika tidak ada cukup tangan 📆 👏🏽 🙋🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Komunitas! 

 Saya memiliki keinginan untuk mengutak-atik mikrokontroler lagi dan melakukan sesuatu yang bermanfaat. Tujuannya terbentuk segera,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hands Free, tetapi bukan ponsel. Rumah yang taat ketika tidak ada cukup tangan</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/408745/">  Halo, Komunitas! <br><br>  Saya memiliki keinginan untuk mengutak-atik mikrokontroler lagi dan melakukan sesuatu yang bermanfaat.  Tujuannya terbentuk segera, ketika sesuatu mengganggu saya di apartemen. <br><br>  Seperti yang Anda ketahui, meja komputer adalah meja makan untuk menonton Drobyshevsky atau membaca Giktayms / Green Cat / dll.  bersamaan dengan makan malam.  Tapi ada masalah - saya biasanya keluar dari dapur dengan <b>kedua</b> tangan yang sibuk, dan kembali <b>juga</b> , <s>karena cangkir ditumpuk menjadi 3 bagian.</s>  Nyalakan dan matikan lampu di dapur (triple switch - dapur / kamar mandi / toilet) adalah bahu, hidung, kelingking.  Artinya, tidak nyaman dengan cara apa pun, tetapi tidak mungkin mengaturnya kembali.  Ada tugas untuk mengelola entah bagaimana dari jarak jauh. <br><br>  Semua sensor kehadiran dan jalur segera diberhentikan - bukan akurasi itu, tidak ada kontrol atas kehendak pemilik.  Solusinya ditemukan dalam kontrol suara, suara.  Saya akan segera mengatakan bahwa saya tidak berencana untuk melakukan pengenalan suara, tidak diperlukan di sini.  Lampu yang dinyalakan oleh pop dijelaskan di Radio 80-an, tetapi saya tidak ingin melakukan itu.  Ternyata semacam handsfree ketika tangan sibuk.  Detailnya aktif. <br><a name="habracut"></a><br><h3>  Bagian perangkat keras. </h3><br>  Ada papan dengan Atmega32 dengan kuarsa dan peripheral <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SEM0007M-32A</a> dan hamburan elektronik. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/65f/1a8/7e9/65f1a87e9d6aad209f747a4419cab7ad.jpg" width="40%" alt="gambar"></div><br>  Ada mikrofon dan penguat operasional.  Untuk output, ada transistor dalam paket sot32 di papan, ada juga 7 amp relay.  Semuanya dirangkai didorong ke dalam kotak untuk kartu nama, relay diparalelkan dengan sakelar, mikrofon disembunyikan di bawah outlet.  Skema itu biasa, saya bahkan tidak menggambarnya.  Hanya satu input analog dan satu output MK diskrit yang digunakan.  SEM berlebihan, tetapi untuk sekarang biarkan saja. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/3c0/69f/b83/3c069fb831046a304627595be0730b70.jpg" width="350" alt="gambar"></div>  <i>Papan dan kabel yang belum dirakit.</i>  <i>Lalu dia merapikannya dengan lebih akurat.</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/7ed/8ee/f59/7ed8eef59421665c5cef7009768a8a46.jpg" width="300" alt="gambar"></div>  <i>Saklar itu sendiri, mikrofon tidak terlihat di bawah outlet yang dibongkar.</i> <br><br><h3>  Cari suatu algoritma. </h3><br>  Tujuan: sensor harus merespons kata, misalnya, " <i>cahaya!</i>  »Dengan kode minimal. <br>  Tugas: mengidentifikasi kata perintah dengan kemungkinan kebisingan, ketukan, klik dengan sakelar yang sama.  Artinya, hanya analisis amplitudo tidak cocok, dan analisis spektral menunjukkan bahwa ada terlalu banyak harmonik dalam kata dan tentu saja mereka berubah.  Oleh karena itu, perlu untuk mencari solusi sederhana, tetapi dengan kekebalan kebisingan yang dapat diterima.  Anda dapat membuat beberapa filter frekuensi waktu dan perbandingan dengan sampel kata, tetapi Anda tidak perlu berurusan dengan pengakuan.  Diputuskan untuk menganalisis keberadaan hanya suara vokal, misalnya, suara "E" atau "E". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/a55/5e2/6cf/a555e26cf616bfab31872bce1794d612.png" alt="gambar"></div>  <i>Suara itu "E".</i>  <i>Banyak harmonik terlihat, karena ini analisisnya sulit.</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/18e/d5c/ab8/18ed5cab8307bf96a2fb8d2ae77e64dd.png" alt="gambar"></div>  <i>Suara itu adalah "A."</i>  <i>Spektrum terlihat lebih bersih, ada frekuensi utama.</i> <br><br><h3>  Bagian perangkat lunak </h3><br>  Untuk mengetahui komponen spektral sinyal, Anda dapat menggunakan filter digital.  Ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">program yang bagus di</a> Internet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">untuk membangun filter FIR dan IIR digital</a> dan menghitung koefisiennya - jelas di sana dan kode C dihasilkan secara otomatis. <br><br><div class="spoiler">  <b class="spoiler_title">Tapi saya menolak filter digital</b> <div class="spoiler_text">  Untuk penyaringan yang dapat diterima (4 pesanan atau lebih), banyak koefisien diperoleh, dan bahkan float.  Seperti ini, ditambah semua perhitungan filter dalam float: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> ACoef[NCoef+<span class="hljs-number"><span class="hljs-number">1</span></span>] = { <span class="hljs-number"><span class="hljs-number">0.00000347268864059354</span></span>, <span class="hljs-number"><span class="hljs-number">0.00000000000000000000</span></span>, <span class="hljs-number"><span class="hljs-number">-0.00001389075456237415</span></span>, <span class="hljs-number"><span class="hljs-number">0.00000000000000000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.00002083613184356122</span></span>, <span class="hljs-number"><span class="hljs-number">0.00000000000000000000</span></span>, <span class="hljs-number"><span class="hljs-number">-0.00001389075456237415</span></span>, <span class="hljs-number"><span class="hljs-number">0.00000000000000000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.00000347268864059354</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> BCoef[NCoef+<span class="hljs-number"><span class="hljs-number">1</span></span>] = { <span class="hljs-number"><span class="hljs-number">1.00000000000000000000</span></span>, <span class="hljs-number"><span class="hljs-number">-7.09708794063733790000</span></span>, <span class="hljs-number"><span class="hljs-number">22.77454294680684300000</span></span>, <span class="hljs-number"><span class="hljs-number">-43.03321836036351300000</span></span>, <span class="hljs-number"><span class="hljs-number">52.29813665034108500000</span></span>, <span class="hljs-number"><span class="hljs-number">-41.84199842886619100000</span></span>, <span class="hljs-number"><span class="hljs-number">21.53121088556695300000</span></span>, <span class="hljs-number"><span class="hljs-number">-6.52398963450972500000</span></span>, <span class="hljs-number"><span class="hljs-number">0.89383378261285684000</span></span> };</code> </pre> <br>  Mikrokontroler mungkin telah menanganinya, tetapi akan ada masalah dengan debugging - tidak mudah untuk mendorong batas filter - ini adalah koefisien baru untuk dihitung. </div></div><br>  Setelah beberapa pencarian, saya menetap pada transformasi Fourier frekuensi tunggal online.  Artinya, transformasi Fourier diskrit klasik, dilakukan pada kedatangan setiap sampel sinyal dengan frekuensi sampling (1600 Hz), tidak ada frekuensi yang melewati, hanya ada satu frekuensi, sehingga mudah untuk mengkonfigurasinya melalui RS-232 selama commissioning.  Akibatnya, analisis dilakukan untuk frekuensi 128 Hz. <br><br>  Karena sampel pendek (blok) dan jendela persegi panjang, resolusi frekuensi rendah, yang memberikan sensitivitas selektif dalam kisaran 114 ... 140 Hz, <u>dan ini adalah P-filter yang ingin saya dapatkan.</u> <br><br>  Pertama, Anda perlu memahami di mana sinyal perintah suara mulai <s>menjerit</s> .  Untuk melakukan ini, pertama, tingkat sinyal nol dihitung, melalui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pemulusan eksponensial</a> dengan konstanta pemulusan 1/64.  Kode di bawah. <br><br><div class="spoiler">  <b class="spoiler_title">Bagian dari kode penghitung waktu untuk pemrosesan sinyal.</b>  <b class="spoiler_title">Timer Frekuensi 1600 Hz</b> <div class="spoiler_text">  Sinyal menormalkan rata-rata.  Untuk menentukan tingkat intensitas suara, nilai absolut dari sinyal juga dirata-ratakan dengan konstanta 1/16, untuk penyaringan high-pass dari setengah gelombang sinyal individual (ini adalah analog RMS, tetapi lebih mudah untuk dihitung).  Melampaui level ini di atas ambang batas adalah awal dari perintah suara, dan analisis berurutan dari 5 blok dari 135 sampel (84,3 ms) dimulai. <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Timer 0 output compare interrupt service routine interrupt [TIM0_COMP] void timer0_comp_isr(void) { a = adc_data[0] &lt;&lt; 2 ; //       4   . a0 = (a0*63 + a+ 63) &gt;&gt; 6; // .   "0".   10%  150  ae = (int)(a - a0); // a = ae; //      . ae = abs(ae); if (ae &lt; 32) { //      ae = 0; }; d = (int)((15 * (long int) d + ae + 15) &gt;&gt; 4); //  .  //   10%  35  if (d &gt; 100) { //    if (snd == 0) { Yz=0; snd++; } //    PORTB.1 = 1; //      }; .....</span></span></code> </pre></div></div><br>  Gambar di bawah ini menunjukkan sinyal, level sinyal, ambang batas dan 5 blok. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/bc9/b82/572/bc9b82572bd90ddb993e5933489e5f5b.png" alt="gambar"></div><br><h3>  Perlindungan gangguan </h3><br>  Sinyal dibagi menjadi beberapa blok untuk melindungi dari impuls - bunyi klik atau ketukan.  Denyut nadi, seperti yang Anda ketahui, memiliki respons frekuensi yang seragam, yaitu, dalam pita frekuensi apa pun akan ada hasil yang tidak nol dan mungkin di atas ambang batas.  Tetapi <s>rambut itu panjang, tetapi</s> dorongan <s>pikiran itu</s> pendek.  Artinya, tidak akan ada lagi pulsa di blok berikutnya, yang berarti bahwa level dalam pita frekuensi akan di bawah ambang batas.  Bersamaan dengan keuntungan ini, blok pendek memberikan <u>resolusi</u> frekuensi rendah.  Oleh karena itu, beberapa perbedaan frekuensi dalam sinyal masih masuk ke dalam jalur frekuensi yang dipilih. <br><br><h3>  Konversi frekuensi </h3><br>  Di setiap blok, transformasi Fourier frekuensi tunggal dilakukan untuk satu frekuensi f. <br><br>  Secara tradisional, untuk mempercepat perhitungan, fungsi sin dan cos ditabulasi dan diskalakan ke -127 .. + 127. <br>  Indeks <code>ps</code> dari array <code>si(ps)</code> dihitung dari argumen sin (2 * π * f * t / T), tentu saja dengan loopback di dalam periode yang sama.  Indeks <code>pc</code> untuk cos (2 * π * f * t / T) cukup didorong 12 posisi ke depan dalam array <code>si</code> sama. <br><br>  Hasil <b>Y</b> - tingkat garis spektral diperoleh sebagai jumlah dari nilai absolut dari bagian nyata dan imajiner selama satu blok. <div class="spoiler">  <b class="spoiler_title">Jadi</b> <div class="spoiler_text">  dengan cara yang benar, Anda perlu melakukan jumlah kuadrat, dan root, tapi ini mengerikan untuk MK 8-bit. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Dalam timer yang sama:</b> <div class="spoiler_text"><pre> <code class="cs hljs"> a_si = (<span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) (a * si[ps]) &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-comment"><span class="hljs-comment">// a*sin a_co = (long int) (a * si[pc]) &gt;&gt; 4; // a*cos Ysi = Ysi + a_si ; // Yco = Yco + a_co; Y = (labs(Ysi) + labs(Yco)) &gt;&gt; 7; //   128    int    rs-232.</span></span></code> </pre></div></div><br>  Pada akhir setiap blok, <b>Y</b> dibandingkan dengan ambang batas, jumlah blok dihitung yang melebihi ambang batas pemicu blok.  Setelah percobaan, ternyata jumlah minimum blok yang dipicu adalah 3 dari 5. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/499/6b1/cbe/4996b1cbe7750d3b010e9b430f391e67.png" alt="gambar"></div>  <i>Contoh intensitas spektral dalam blok dengan perintah suara.</i>  <i>Tim telah lulus.</i> <br><br>  Tiga atau lebih blok yang dipicu ditafsirkan sebagai perintah yang diterima dengan benar.  Sinyal pada keluaran diskrit dari MK terbalik, menyalakan atau mematikan lampu.  Karena keseluruhan analisis terjadi di dalam blok, tidak ada penundaan dalam operasi setelah blok terakhir. <br><br>  Waktu komputasi sekitar 1600 siklus, timer dipanggil setiap 9000 siklus, sehingga beban MK rendah - ada ruang untuk percobaan lebih lanjut dengan pengakuan.  Atau Anda dapat membuat solusi lengkap untuk ukuran yang lebih kecil dan pada MK yang lemah. <br><br>  Ketepatan algoritma dikendalikan melalui pertukaran variabel yang diperlukan (log) melalui RS-232 dengan program di VBasic.  Frekuensi f dan ambang batas disimpan dalam eeprom. <br><br>  Hasilnya: sensor ternyata sangat nyaman, ia merespons kata-kata dari " <i>A</i> ", misalnya, <b>" <i>Waaau</i> ", " <i>Taaam</i> ", " <i>Laite</i> ", " <i>Laaa</i> ", " <i>Miaaa</i> ", " <i>Yao-Yao</i> "</b> .  Volume umum digunakan untuk percakapan manusia.  Kata " <i>Lit</i> " dengan keras kepala menolak untuk mendengarkan.  Klik, mengetuk pintu, langkah, menuangkan air mengabaikan.  Sekarang Anda bisa berjalan dengan tangan penuh gelas dan piring)). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id408745/">https://habr.com/ru/post/id408745/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id408735/index.html">Robot humanoid seharga $ 800 itu bukan seukuran manusia. Maaf ...</a></li>
<li><a href="../id408737/index.html">Timbangan pintar QardioBase 2: menjadi lebih baik dan lebih baik</a></li>
<li><a href="../id408739/index.html">Fotosintesis superkonduktor atau bagaimana kuda vakum bola</a></li>
<li><a href="../id408741/index.html">Pelopor prosesor Qualcomm Centriq 2400. Intel killer?</a></li>
<li><a href="../id408743/index.html">Laptop gaming GPD WIN terkecil - Apa yang mampu dan siapa yang membutuhkannya?</a></li>
<li><a href="../id408747/index.html">Munculnya rover baru, penerbangan pertama Falcon Heavy, meragukan keandalan Dragon dan Starliner</a></li>
<li><a href="../id408749/index.html">Selamat ulang tahun, mouse komputer</a></li>
<li><a href="../id408751/index.html">Amazon Memperkenalkan Platform Pengembangan 3D, VR, dan AR</a></li>
<li><a href="../id408753/index.html">Pesan untuk Kecerdasan Buatan yang Tidak Ramah</a></li>
<li><a href="../id408755/index.html">Bagaimana merencanakan hari kerja yang sempurna tergantung pada bagaimana Anda tidur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>