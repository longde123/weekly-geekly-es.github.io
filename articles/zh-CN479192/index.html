<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ™Œ ğŸ¥ ğŸš¢ ç±»å›ºé†‡ç®¡ç†ç¨‹åºï¼šFreeBSD + ZFS + cbsd ğŸ¤½ğŸ¼ ğŸ•’ ğŸ“©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘æƒ³é˜æ˜åœ¨æœåŠ¡å™¨ç¯å¢ƒä¸­ï¼ˆåœ¨ç§Ÿç”¨çš„ç¡¬ä»¶ä¸Šæˆ–åœ¨æ‚¨è‡ªå·±çš„æ•°æ®ä¸­å¿ƒä¸­ï¼‰æ‰‹åŠ¨æˆ–ä½¿ç”¨è¯¸å¦‚Ansibleä¹‹ç±»çš„ç¼–æ’å·¥å…·æ¥å®‰è£…FreeBSDå¤šä¹ˆå®¹æ˜“å’Œä¼˜é›…ã€‚ ç£ç›˜åŠ å¯†ï¼Œæ–¹ä¾¿çš„ç©ºé—´ç®¡ç†ï¼Œç”¨äºå®¹å™¨å’Œå®Œæ•´VMçš„è™šæ‹Ÿæœºç®¡ç†ç¨‹åºï¼Œæ–¹ä¾¿ä¸”ç›´è§‚çš„é˜²ç«å¢™-ä»…æ­¤è€Œå·²ï¼Œä¸ä»…å¯ä»¥ç«‹å³ä½¿ç”¨ï¼Œè€Œä¸”åªéœ€å¾ˆå°‘çš„æ—¶é—´å³å¯ä½¿ç”¨æ­£ç¡®çš„æ–¹æ³•...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ç±»å›ºé†‡ç®¡ç†ç¨‹åºï¼šFreeBSD + ZFS + cbsd</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479192/"><p> åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘æƒ³é˜æ˜åœ¨æœåŠ¡å™¨ç¯å¢ƒä¸­ï¼ˆåœ¨ç§Ÿç”¨çš„ç¡¬ä»¶ä¸Šæˆ–åœ¨æ‚¨è‡ªå·±çš„æ•°æ®ä¸­å¿ƒä¸­ï¼‰æ‰‹åŠ¨æˆ–ä½¿ç”¨è¯¸å¦‚Ansibleä¹‹ç±»çš„ç¼–æ’å·¥å…·æ¥å®‰è£…FreeBSDå¤šä¹ˆå®¹æ˜“å’Œä¼˜é›…ã€‚ ç£ç›˜åŠ å¯†ï¼Œæ–¹ä¾¿çš„ç©ºé—´ç®¡ç†ï¼Œç”¨äºå®¹å™¨å’Œå®Œæ•´VMçš„è™šæ‹Ÿæœºç®¡ç†ç¨‹åºï¼Œæ–¹ä¾¿ä¸”ç›´è§‚çš„é˜²ç«å¢™-ä»…æ­¤è€Œå·²ï¼Œä¸ä»…å¯ä»¥ç«‹å³ä½¿ç”¨ï¼Œè€Œä¸”åªéœ€å¾ˆå°‘çš„æ—¶é—´å³å¯ä½¿ç”¨æ­£ç¡®çš„æ–¹æ³•è¿›è¡Œé…ç½®ã€‚ </p><a name="habracut"></a><br><h4 id="ustanovka"> å®‰è£…æ–¹å¼ </h4><br><p> è®©æˆ‘ä»¬ä»æœ€ç®€å•çš„åœºæ™¯å¼€å§‹ã€‚ æˆ‘ä»¬æœ‰ä¸€å—é“æˆ–æœ‰ä¸€å—é“ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨CD-ROMä¸Šæˆ–ä½¿ç”¨IPMIè¾“å…¥.isoï¼ˆæˆ–.imgï¼‰ã€‚ ç”šè‡³æ›´ç®€å•-æ‰˜ç®¡ç¨‹åºç›´æ¥ä»ç•Œé¢æä¾›mfsbsdæ˜ åƒã€‚ æ— è®ºå¦‚ä½•ï¼Œè¯·ä»<a href="https://mfsbsd.vx.sk/" rel="nofollow">mfsbsd</a>å¼•å¯¼ã€‚ </p><br><h4 id="linux-rescue-cd">  Linuxæ•‘æ´CD </h4><br><p> ç¢°å·§çš„æ˜¯ï¼Œæ‰˜ç®¡äººæ²¡æœ‰ä»¥ä»»ä½•å½¢å¼æä¾›FreeBSDï¼Œè€Œæ˜¯æä¾›Linux Rescueã€‚ æˆ‘ä»¬å¯åŠ¨åˆ°Linuxï¼Œä¸‹è½½mfsbsdç£ç›˜æ˜ åƒå¹¶å°†å…¶æ»šåŠ¨åˆ°ç¡¬ç›˜ä¸Šï¼š </p><br><p><code>root@rescue:~# wget https://mfsbsd.vx.sk/files/images/12/amd64/mfsbsd-12.1-RELEASE-amd64.img</code> </p> <br><pre> <code class="plaintext hljs">root@rescue:~# dd if=mfsbsd-12.1-RELEASE-amd64.img of=/dev/sda bs=4M 22+1 records in 22+1 records out 92307456 bytes (92 MB) copied, 0.386325 s, 239 MB/s</code> </pre> <br><p> <code>root@rescue:~# reboot</code> </p> <br><h4 id="nastroyka-setevogo-adaptera"> ç½‘ç»œé€‚â€‹â€‹é…å™¨è®¾ç½® </h4><br><p> å½“æˆ‘ä»¬å¯ä»¥ç›´æ¥è®¿é—®ç›‘è§†å™¨æˆ–é€šè¿‡IPMI / VNC / Webé€šè¿‡ç½‘ç»œæ¥æ”¶ä¿¡å·æ—¶ï¼Œä¸€åˆ‡éƒ½å¾ˆå¥½ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ²¡æœ‰è¿™ç§å¯èƒ½æ€§å¹¶ä¸”åªèƒ½è¿›è¡Œç½‘ç»œè¿æ¥æ€ä¹ˆåŠï¼Ÿ ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå·²ç»è®¾ç½®äº†ç½‘ç»œè®¾ç½®çš„mfsbsdæ˜ åƒã€‚ è®©æˆ‘ä»¬ä½¿ç”¨ç½‘ç»œé€‚é…å™¨å’ŒSSHå®ˆæŠ¤ç¨‹åºçš„è®¾ç½®æ”¶é›†å•ä¸ªæ˜ åƒã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦æŸç§FreeBSDä¸»æœºæ¥æ„å»ºæ˜ åƒã€‚ </p><br><p> ä¸‹è½½åŸå§‹çš„.iso </p><br><p> <code>root@ns312777:~ # fetch https://download.freebsd.org/ftp/releases/amd64/amd64/ISO-IMAGES/12.0/FreeBSD-12.0-RELEASE-amd64-dvd1.iso</code> </p> <br><p>  Mountim </p><br><p>  <code>root@ns312777:~ # mount -t cd9660 /dev/</code> mdconfig -f FreeBSD-12.0-RELEASE-amd64-dvd1.iso <code>/root/cd-rom</code> </p><br><p> ä¸‹è½½mfsbsd </p><br><p> <code>root@ns312777:~ # fetch https://github.com/mmatuska/mfsbsd/archive/master.zip</code> </p> <br><p> <code>root@ns312777:~ # unzip master.zip &amp;&amp; cd mfsbsd-master</code> </p> <br><p> æˆ‘ä»¬æ›´æ”¹é…ç½®æ–‡ä»¶ã€‚ å¯¹äºIPé…ç½®ï¼Œåªéœ€æ›´æ”¹ä»<code>conf/rc.conf.sample</code>åˆ›å»º<code>conf/rc.conf</code> ã€‚ æ‚¨è¿˜åº”è¯¥åˆ›å»º<code>conf/authorized_keys</code>å¹¶æ·»åŠ å¯†é’¥ã€‚ </p><br><p> <code>root@ns312777:~/mfsbsd-master # ls -la conf/</code> </p> <br><pre> <code class="plaintext hljs">total 55 drwxr-xr-x 2 root wheel 13 Dec 8 10:06 . drwxr-xr-x 7 root wheel 13 Dec 8 10:11 .. -rw-r--r-- 1 root wheel 451 Dec 8 10:06 authorized_keys -rw-r--r-- 1 root wheel 50 Nov 30 22:54 authorized_keys.sample -rw-r--r-- 1 root wheel 3 Nov 30 22:54 boot.config.sample -rw-r--r-- 1 root wheel 156 Nov 30 22:54 hosts.sample -rw-r--r-- 1 root wheel 592 Nov 30 22:54 interfaces.conf.sample -rw-r--r-- 1 root wheel 1310 Nov 30 22:54 loader.conf.sample -rw-r--r-- 1 root wheel 739 Dec 8 10:06 rc.conf -rw-r--r-- 1 root wheel 689 Nov 30 22:54 rc.conf.sample -rw-r--r-- 1 root wheel 40 Nov 30 22:54 rc.local.sample -rw-r--r-- 1 root wheel 108 Nov 30 22:54 resolv.conf.sample -rw-r--r-- 1 root wheel 898 Nov 30 22:54 ttys.sample</code> </pre> <br><p> å¥½å§ï¼Œèµ°å§ï¼ </p><br><p> <code>root@ns312777:~/mfsbsd-master # make BASE=/root/cd-rom/usr/freebsd-dist</code> </p> <br><pre> <code class="plaintext hljs">Extracting base and kernel ... done Removing selected files from distribution ... done Installing configuration scripts and files ... done Generating SSH host keys ... done Configuring boot environment ...x ./ x ./linker.hints x ./kernel done Installing pkgng ... done Compressing usr ... done Creating and compressing mfsroot ... done Creating image file ...87072+0 records in 87072+0 records out 89161728 bytes transferred in 0.905906 secs (98422727 bytes/sec) 87040+0 records in 87040+0 records out 89128960 bytes transferred in 0.877165 secs (101610229 bytes/sec) md3 created md3p1 added partcode written to md3p1 bootcode written to md3 md3p2 added Calculated size of `./mfsbsd-12.0-RELEASE-p10-amd64.img.a47DUe1j': 80281600 bytes, 65 inodes Extent size set to 32768 ./mfsbsd-12.0-RELEASE-p10-amd64.img.a47DUe1j: 76.6MB (156800 sectors) block size 32768, fragment size 4096 using 1 cylinder groups of 76.56MB, 2450 blks, 256 inodes. super-block backups (for fsck -b #) at: 64, Populating `./mfsbsd-12.0-RELEASE-p10-amd64.img.a47DUe1j' Image `./mfsbsd-12.0-RELEASE-p10-amd64.img.a47DUe1j' complete 612+1 records in 612+1 records out 80281600 bytes transferred in 36.018812 secs (2228880 bytes/sec) done</code> </pre><br><h4 id="pochemu-mfsbsd"> ä¸ºä»€ä¹ˆè¦ä½¿ç”¨mfsbsdï¼Ÿ </h4><br><p> è¿™æ˜¯FreeBSD OSçš„ç´§å‡‘ç»„ä»¶ï¼Œå¯ç›´æ¥åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ‰€æœ‰å¯ç”¨åª’ä½“è‡ªç”±åœ°æ‰§è¡Œæˆ‘ä»¬æƒ³è¦çš„æ“ä½œã€‚ ç±»ä¼¼äºLinuxæ•‘æ´CDã€‚ è¯¥ç¨‹åºé›†çš„å…¨éƒ¨é­…åŠ›åœ¨äºï¼Œå®ƒä½¿æ‚¨å¯ä»¥é€šè¿‡ä¸€æ¡å‘½ä»¤ä»å­—é¢ä¸Šå®‰è£…FreeBSDã€‚ </p><br><p>  Linuxæ•‘æ´CDæˆ–ä».iso / .imgå¼•å¯¼åï¼Œæˆ‘ä»¬è¿›å…¥mfsbsd shellã€‚ </p><br><p> <code>root@mfsbsd:~ # cd bin/</code> </p> <br><p> æˆ‘ä»¬æ¸…ç†ç£ç›˜ </p><br><pre> <code class="plaintext hljs">root@mfsbsd:~/bin # gpart destroy -F /dev/ada0 root@mfsbsd:~/bin # gpart destroy -F /dev/ada1</code> </pre> <br><p> æˆ– </p><br><p> <code>root@mfsbsd:~/bin # ./destroygeom -d /dev/ada0 -d /dev/ada1</code> </p> <br><pre> <code class="plaintext hljs">Destroying geom ada0: Deleting partition 1 ... done Deleting partition 2 ... done Destroying geom ada1: Deleting partition 1 ... done Deleting partition 2 ... done</code> </pre> <br><p> ç„¶åå®‰è£…æˆ‘ä»¬çš„ç³»ç»Ÿã€‚ </p><br><pre> <code class="plaintext hljs">root@mfsbsd:~/bin # ./zfsinstall Usage: ./zfsinstall [-h] -d geom_provider [-d geom_provider ...] [ -u dist_url ] [-r mirror|raidz] [-m mount_point] [-p zfs_pool_name] [-s swap_partition_size] [-z zfs_partition_size] [-c] [-C] [-l] [-4] [-A]</code> </pre> <br><p> å› ä¸º åœ¨æœ€å¤šå…·æœ‰3ä¸ªç£ç›˜çš„ä¸»æœºä¸Šï¼Œæˆ‘æ›´å–œæ¬¢å°†ç³»ç»Ÿæ”¾åœ¨å°åˆ†åŒºä¸Šæ‰€æœ‰ç£ç›˜ä¸Šçš„é•œåƒä¸­ã€‚ å€ŸåŠ©ZFSï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦é…ç½®å‰©ä½™ç©ºé—´ï¼Œä½†ç¨åä¼šè¿›è¡Œæ›´å¤šé…ç½®ã€‚ åœ¨è¿™é‡Œï¼Œå¥¹æ˜¯å”¯ä¸€å®‰è£…æ•´ä¸ªç³»ç»Ÿçš„å›¢é˜Ÿã€‚ </p><br><p> <code>root@mfsbsd:~/bin # ./zfsinstall -d /dev/ada0 -d /dev/ada1 -d /dev/ada2 -r mirror -p zsys -z 25G</code> </p> <br><p> åœ¨é•œåƒçš„ä¸‰ä¸ªç£ç›˜ä¸Šå®‰è£…ç³»ç»Ÿ </p><br><pre> <code class="plaintext hljs">Fetching base files from: ftp://ftp.freebsd.org/pub/FreeBSD/releases/amd64/12.0-RELEASE /tmp/base.txz 147 MB 3670 kBps 41s /tmp/kernel.txz 39 MB 2344 kBps 18s Creating GUID partitions on ada0 ... done Configuring ZFS bootcode on ada0 ... done =&gt; 40 937703008 ada0 GPT (447G) 40 472 1 freebsd-boot (236K) 512 52428800 2 freebsd-zfs (25G) 52429312 885273736 - free - (422G) Creating GUID partitions on ada1 ... done Configuring ZFS bootcode on ada1 ... done =&gt; 40 937703008 ada1 GPT (447G) 40 472 1 freebsd-boot (236K) 512 52428800 2 freebsd-zfs (25G) 52429312 885273736 - free - (422G) Creating GUID partitions on ada2 ... done Configuring ZFS bootcode on ada2 ... done =&gt; 40 937703008 ada2 GPT (447G) 40 472 1 freebsd-boot (236K) 512 52428800 2 freebsd-zfs (25G) 52429312 885273736 - free - (422G) Creating ZFS pool zsys on ada0p2 ada1p2 ada2p2 ... done Creating zsys root partition: ... done Creating zsys partitions: var tmp ... done Setting bootfs for zsys to zsys/root ... done NAME USED AVAIL REFER MOUNTPOINT zsys 712K 23.7G 88K none zsys/root 264K 23.7G 88K /mnt zsys/root/tmp 88K 23.7G 88K /mnt/tmp zsys/root/var 88K 23.7G 88K /mnt/var Extracting FreeBSD distribution ... done Writing /boot/loader.conf... done Writing /etc/fstab...Writing /etc/rc.conf... done Copying /boot/zfs/zpool.cache ... done Installation complete. The system will boot from ZFS with clean install on next reboot You may make adjustments to the installed system using chroot: chroot /mnt Some adjustments may require a mounted devfs: mount -t devfs devfs /mnt/dev WARNING - Don't export ZFS pool "zsys"!</code> </pre><br><p> å®‰è£…åï¼Œå·²å®‰è£…çš„OSçš„æ–‡ä»¶ç³»ç»Ÿä½äº<code>/mnt/</code> ï¼Œå› æ­¤æˆ‘ä»¬åœ¨é‡æ–°å¼•å¯¼ä¹‹å‰è¿›è¡Œä¸€äº›é…ç½®ï¼š </p><br><p> å°†å·²ç»æ·»åŠ åˆ°mfsbsdæ˜ åƒä¸­çš„å¯†é’¥å¤åˆ¶åˆ°ç³»ç»Ÿä¸­ </p><br><p> <code>root@mfsbsd:~/bin # mkdir /mnt/root/.ssh &amp;&amp; cp /root/.ssh/authorized_keys /mnt/root/.ssh/</code> </p> <br><p> æˆ‘ä»¬ç¼–è¾‘SSHé…ç½®ï¼ˆä¾‹å¦‚ï¼Œæ›´æ”¹ç«¯å£å’Œ <del> å…è®¸ç™»å½•root </del>  ï¼‰ </p><br><p> <code>root@mfsbsd:~/bin # ee /mnt/etc/ssh/sshd_config</code> </p> <br><p> ç¼–è¾‘ç³»ç»Ÿå¼•å¯¼ç¨‹åºæ–‡ä»¶ </p><br><p> <code>root@mfsbsd:~/bin # ee /mnt/etc/rc.conf</code> </p> <br><pre> <code class="plaintext hljs">zfs_enable="YES" sshd_enable="YES" hostname="hyper.bitbsd.org" # # You need a gateway defined for a working network setup defaultrouter="37.79.8.254" ifconfig_em0="inet 37.79.8.111 netmask 255.255.255.0"</code> </pre> <br><p>  <em>è¯·æ³¨æ„æ‚¨ç½‘ç»œç†Ÿç»ƒçš„åˆ¶é€ å•†ï¼Œå› ä¸º</em>  <em>æ¥å£çš„åç§°å–å†³äºå®ƒã€‚</em>  <em>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥è¿™æ ·åšï¼š</em> </p><br><p>  <code>/etc/rc.conf</code> <code>ifconfig_DEFAULT="DHCP"</code> </p><br><p> æˆ‘ä»¬å…¬å¼€DNS </p><br><p> <code>root@mfsbsd:~/bin # ee /mnt/etc/resolv.conf</code> </p> <br><pre> <code class="plaintext hljs">nameserver 8.8.8.8</code> </pre> <br><p> å¥½å§ï¼Œä½ é€šå¸¸å¯ä»¥è¿™æ ·åš </p><br><p> <code>root@mfsbsd:~ # chroot /mnt</code> </p> <br><p> å¹¶æ·»åŠ ç”¨æˆ·ï¼Œå¹¶ä¸”é€šå¸¸å¯ä»¥åœ¨æ–°å®‰è£…çš„OSç¯å¢ƒä¸­è¿›è¡Œæ‰€æœ‰æ“ä½œã€‚ </p><br><p> å¥½å§ï¼Œæˆ‘ä»¬ç»§ç»­å‰è¿› </p><br><p> <code>root@mfsbsd:~ # reboot</code> </p> <br><h4 id="bolshe-krasnoglaziya"> æ›´çº¢çœ¼ </h4><br><p> åœ¨ç»§ç»­é…ç½®å·²å®‰è£…çš„OSä¹‹å‰ï¼Œæˆ‘æƒ³è¯´æ˜å¦å¤–ä¸¤ç§å¼•å¯¼åˆ°mfsbsdçš„æ–¹æ³•ã€‚ </p><br><p> æ ‡å‡†çš„FreeBSDå®‰è£…ç¨‹åºï¼š </p><br><p><img src="https://habrastorage.org/webt/kg/kc/em/kgkcemg0hh8naobvnrlk7sipfsg.png"></p><br><p> é€‰æ‹©Live CD </p><br><p> åˆ›å»º<a href="https://www.freebsd.org/doc/handbook/disks-virtual.html" rel="nofollow">å†…å­˜ç£ç›˜</a> </p><br><pre> <code class="plaintext hljs"># mdconfig -a -t swap -s 2g -u 9 # newfs -U md9 # mount /dev/md9 /tmp # cd /tmp</code> </pre> <br><p> ä½¿ç”¨mfsbsdæ–‡ä»¶ä¸éœ€è¦ä½¿ç”¨å†…å­˜ä¸­çš„ç£ç›˜ï¼›æ­¤å¤–ï¼Œmfsbsdåœ¨å®‰è£…æœŸé—´ä½¿ç”¨<code>/tmp/</code> ï¼Œå› æ­¤é‚£é‡Œåº”è¯¥æœ‰è¶³å¤Ÿçš„å¯ç”¨ç©ºé—´ã€‚ </p><br><p> <code># fetch https://github.com/mmatuska/mfsbsd/archive/master.zip</code> </p> <br><p> <code># unzip master.zip &amp;&amp; cd mfsbsd-master/tools</code> </p> <br><p> å¥½å§ï¼Œé‚£ä¹ˆåŒæ ·çš„äº‹æƒ…<code>./destroygeom</code>å’Œ<code>./zfsinstall</code> </p><br><p> ä»é¢„è£…çš„Linuxæ˜ åƒè¿›è¡Œå®‰è£…ï¼š </p><br><p> å¦‚æœæœåŠ¡å™¨æä¾›å•†ä¸ºæ‚¨æä¾›äº†å·²ç»å®‰è£…çš„Linuxï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡<a href="https://forums.freebsd.org/threads/tip-booting-mfsbsd-iso-file-from-grub2-depenguination.46480/" rel="nofollow">æ›´æ”¹GRUB bootloaderçš„é…ç½®ä»¥</a>è‡ªå·±çš„æ–¹å¼â€œå®‰è£…â€ã€‚ ä¸ºæ­¤ï¼Œå°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ°å½“å‰ç³»ç»Ÿä¸Šçš„grub.cfgä¸­ï¼š </p><br><pre> <code class="plaintext hljs">menuentry "mfsbsd-10.0-RELEASE-amd64.iso" { # Path to the iso set isofile=/boot/boot-isos/mfsbsd-12.0-RELEASE-amd64.iso # (hd0,1) here may need to be adjusted of course depending where the partition is loopback loop (hd0,1)$isofile kfreebsd (loop)/boot/kernel/kernel.gz -v # kfreebsd_loadenv (loop)/boot/device.hints # kfreebsd_module (loop)/boot/kernel/geom_uzip.ko kfreebsd_module (loop)/boot/kernel/ahci.ko kfreebsd_module (loop)/mfsroot.gz type=mfs_root set kFreeBSD.vfs.root.mountfrom="ufs:/dev/md0" set kFreeBSD.mfsbsd.autodhcp="YES" # Define a new root password # set kFreeBSD.mfsbsd.rootpw="foobar" # Alternatively define hashed root password # set kFreeBSD.mfsbsd.rootpwhash="" }</code> </pre> <br><p> å¥½å§ï¼Œå°†.isoç›¸åº”åœ°æ”¾åœ¨<code>/boot/boot-isos/</code> </p><br><p> æˆ‘ä»æ¥æ²¡æœ‰è‡ªå·±åšè¿‡ï¼Œæ‰€ä»¥å¦‚æœæ‚¨å‘ç°é…ç½®ä¸­çš„é”™è¯¯æˆ–ç¼ºé™·ï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚ </p><br><p> æˆ‘ä¸çŸ¥é“ï¼Œä¹Ÿè®¸æˆ‘è¿˜èƒ½æ€ä¹ˆèº²é¿å®‰è£…FreeBSDã€‚ </p><br><h4 id="konfiguraciya-sistemy"> ç³»ç»Ÿé…ç½® </h4><br><p> å¥½äº†ï¼Œæˆ‘ä»¬å·²ç»å®‰è£…ï¼ŒåŠ è½½äº†æ‰€æœ‰ä¸œè¥¿â€¦â€¦é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…å’Œé…ç½®ç½‘ç»œ-åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œ <a href="https://www.freebsd.org/doc/handbook/firewalls-pf.html" rel="nofollow">pf</a>å°†èµ·ä¸»è¦ä½œç”¨ï¼Œæˆ‘å–œæ¬¢æ­¤è§£å†³æ–¹æ¡ˆçš„ç®€æ´æ€§å’Œæ¸…æ™°åº¦ã€‚ æˆ‘ä»¬éœ€è¦é…ç½®æœåŠ¡å™¨æ–‡ä»¶ç³»ç»Ÿ-æˆ‘ä»¬ä½¿ç”¨<a href="https://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/zfs-quickstart.html" rel="nofollow">ZFSï¼Œ</a>å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªéå¸¸çµæ´»å’Œé«˜æ•ˆçš„æ–‡ä»¶ç³»ç»Ÿã€‚ é…ç½®ç½‘ç»œå’ŒFSåï¼Œæˆ‘ä»¬å°†å®‰è£…è™šæ‹Ÿæœºç›‘æ§ç¨‹åºã€‚ å¦‚æœéœ€è¦æé«˜å®‰å…¨æ€§ï¼Œåˆ™å¯ä»¥<a href="https://habr.com/ru/post/477124/">é…ç½®å…¶ä»–å®ç”¨ç¨‹åº</a> ï¼Œåœ¨æœ¬æ•™ç¨‹ä¸­å°†çœç•¥å…¶è¯´æ˜ã€‚ ä¸ºäº†è¯´æ˜ZFSçš„çµæ´»æ€§ï¼Œæˆ‘å°†æè¿°ä¸¤å°æœåŠ¡å™¨çš„é…ç½®ï¼Œå…¶ä¸­ä¸€å°æœ‰2ä¸ªç£ç›˜ï¼Œä¸€å°æœ‰3ä¸ªç£ç›˜ã€‚ å¦å¤–ï¼Œä¸è¦å¿˜è®°åœ¨å®‰è£…å<a href="https://www.freebsd.org/doc/handbook/updating-upgrading-freebsdupdate.html" rel="nofollow">å‡çº§ç³»ç»Ÿ</a> ï¼Œæœ‰æ—¶ä¼šå‘ç°åªæœ‰å¤è€çš„ä¸œè¥¿å¯ç”¨äºå®‰è£…ã€‚ </p><br><p> <code>freebsd-update -r 12.1-RELEASE upgrade</code> </p> <br><p>  <em>åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œæœ€æ–°ç‰ˆæœ¬ä¸º12.1ã€‚</em> </p><br><p>  <em>åŒç£ç›˜æœåŠ¡å™¨</em> </p><br><p> æˆ‘ä»¬åœ¨ä»¥ä¸‹é…ç½®ä¸­åˆ›å»ºäº†å®ƒï¼š </p><br><pre> <code class="plaintext hljs">root@:~ # gpart show /dev/ada0 =&gt; 40 5860533088 ada0 GPT (2.7T) 40 472 1 freebsd-boot (236K) 512 8388608 2 freebsd-swap (4.0G) 8389120 167772160 3 freebsd-zfs (80G) 176161280 2097152000 4 freebsd-zfs (1.0T) 2273313280 3587219848 5 freebsd-zfs (1.7T) root@:~ # gpart show /dev/ada1 =&gt; 40 5860533088 ada1 GPT (2.7T) 40 472 1 freebsd-boot (236K) 512 8388608 2 freebsd-swap (4.0G) 8389120 167772160 3 freebsd-zfs (80G) 176161280 2097152000 4 freebsd-zfs (1.0T) 2273313280 3587219848 5 freebsd-zfs (1.7T)</code> </pre><br><pre> <code class="plaintext hljs">root@:~ # zpool status pool: appdata state: ONLINE scan: none requested config: NAME STATE READ WRITE CKSUM appdata ONLINE 0 0 0 mirror-0 ONLINE 0 0 0 ada0p4.eli ONLINE 0 0 0 ada1p4.eli ONLINE 0 0 0 errors: No known data errors pool: miscdata state: ONLINE scan: none requested config: NAME STATE READ WRITE CKSUM miscdata ONLINE 0 0 0 ada0p5.eli ONLINE 0 0 0 ada1p5.eli ONLINE 0 0 0 errors: No known data errors pool: zsys state: ONLINE scan: none requested config: NAME STATE READ WRITE CKSUM zsys ONLINE 0 0 0 mirror-0 ONLINE 0 0 0 ada0p3 ONLINE 0 0 0 ada1p3 ONLINE 0 0 0 errors: No known data errors</code> </pre><br><p> è¿™ä¸€åˆ‡æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ æˆ‘ä»¬æœ‰ä¸€å—å¸¦æœ‰ä¸¤ä¸ªç£ç›˜çš„é“ç‰‡ï¼Œè¿™ä¸¤ä¸ªç£ç›˜å¤§å°å‡ä¸º3 TBã€‚ æˆ‘ä»¬å°†åœ¨æœåŠ¡å™¨ä¸Šå¯åŠ¨å¤šä¸ªåº”ç”¨ç¨‹åºï¼Œå…¶ä¸­ä¸€äº›æ˜¯æœ‰æ¡ä»¶çš„ï¼Œä¸€äº›æ˜¯â€œåœ¨ç©â€çš„ï¼Œå› æ­¤ä¸¢å¤±æ•°æ®å¹¶ä¸å¯æƒœã€‚ ç”¨äºæœ€æœ‰æ•ˆçš„ç£ç›˜ç©ºé—´é…ç½®ã€‚ çŸ­ä¿ƒçš„æ“ä½œä¼šå¾—åˆ°ä»€ä¹ˆï¼Ÿ </p><br><pre> <code class="plaintext hljs">root@:~ # zfs list NAME USED AVAIL REFER MOUNTPOINT appdata 75.5K 961G 23K /appdata miscdata 75.5K 3.21T 23K /miscdata zsys 2.02G 75.0G 88K none zsys/root 2.02G 75.0G 1.18G / zsys/root/tmp 88K 75.0G 88K /tmp zsys/root/var 862M 75.0G 862M /var</code> </pre><br><p> è‡³å…³é‡è¦çš„åº”ç”¨ç¨‹åºæ•°æ®çš„appdataæ± ï¼ˆæ¥è‡ª/dev/ada0p4.eliå’Œ/dev/ada1p4.eliçš„é•œåƒï¼‰ï¼Œmiscdataæ± ï¼ˆâ€œæ¡å¸¦â€ï¼Œå³/dev/ada0p5.eliå’Œ/ä¸Šçš„æ•°æ®ï¼‰ dev / ada1p5.eliï¼‰ã€‚ è¿˜æœ‰ä¸€ä¸ªç³»ç»Ÿæ± å’Œäº¤æ¢ï¼Œå®ƒä»¬ä¹Ÿæ˜¯æ¥è‡ªä¸¤ä¸ªç£ç›˜åˆ†åŒºçš„é•œåƒã€‚ </p><br><p> å¯¹äºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè€Œè¨€ï¼Œæ€»å…±æœ‰1TBçš„é•œåƒç©ºé—´å’Œ3.2TBçš„å®éªŒç©ºé—´ã€‚ </p><br><p> å¦‚ä½•è®¾ç½®å‘¢ï¼Ÿ å¾ˆç®€å• åˆå§‹å®‰è£…åï¼Œæˆ‘ä»¬çš„ç£ç›˜å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="plaintext hljs">root@:~ # gpart show /dev/ada0 =&gt; 40 5860533088 ada0 GPT (2.7T) 40 472 1 freebsd-boot (236K) 512 8388608 2 freebsd-swap (4.0G) 8389120 167772160 3 freebsd-zfs (80G) 176161280 684371848 free (2.7T)</code> </pre> <br><p> æˆ‘ä»¬å°†éƒ¨åˆ†æ·»åŠ åˆ°ç£ç›˜ï¼Œé¦–å…ˆæˆ‘ä»¬å°†å¯¹å…¶è¿›è¡Œé•œåƒ </p><br><p> <code>root@:~ # gpart add -t freebsd-zfs -s 1000g /dev/ada0</code> </p> <br><p> <code>root@:~ # gpart add -t freebsd-zfs -s 1000g /dev/ada1</code> </p> <br><p> ç„¶åå…¶ä»–çš„ä¸€åˆ‡ </p><br><p> <code>root@:~ # gpart add -t freebsd-zfs /dev/ada0</code> </p> <br><p> <code>root@:~ # gpart add -t freebsd-zfs /dev/ada1</code> </p> <br><p> æˆ‘ä»¬ç°åœ¨æœ‰/ dev / ada0p4ï¼Œ/ dev / ada0p5ï¼Œ/ dev / ada1p4å’Œ/ dev / ada0p5åˆ†åŒºã€‚ å› ä¸º æˆ‘ä»¬å¯¹DCä¸»æœºä¸Šçš„æœåŠ¡å™¨æ²¡æœ‰ç‰©ç†è®¿é—®æƒé™ï¼Œå»ºè®®ä½¿ç”¨æˆ‘ä»¬çš„æ•°æ®å¯¹éƒ¨åˆ†è¿›è¡ŒåŠ å¯†ã€‚ </p><br><p> <code>root@:~ # geli init /dev/ada0p4</code> </p> <br><p> <code>root@:~ # geli init /dev/ada0p5</code> </p> <br><p> <code>root@:~ # geli init /dev/ada1p4</code> </p> <br><p> <code>root@:~ # geli init /dev/ada1p5</code> </p> <br><p> è¾“å…¥åŠ å¯†å¯†ç ï¼Œç„¶åè§£å¯†ä»¥ä¸‹éƒ¨åˆ†ï¼š </p><br><p> <code>root@:~ # geli attach /dev/ada0p4</code> </p> <br><p> <code>root@:~ # geli attach /dev/ada0p5</code> </p> <br><p> <code>root@:~ # geli attach /dev/ada1p4</code> </p> <br><p> <code>root@:~ # geli attach /dev/ada1p5</code> </p> <br><p> ç°åœ¨æˆ‘ä»¬æœ‰/dev/ada0p4.eliã€/dev/ada0p5.eliã€/dev/ada1p4.eliå’Œ/dev/ada0p5.eliéƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥ä»è¿™äº›éƒ¨åˆ†<a href="https://www.freebsd.org/doc/handbook/zfs-zpool.html" rel="nofollow">æ„å»ºæ± </a> </p><br><p> æ‚¨å¯ä»¥ç¼–å†™ä»¥ä¸‹è„šæœ¬ï¼š </p><br><pre> <code class="plaintext hljs">root@:~ # cat /root/attach_disks.sh #!/bin/sh geli attach /dev/ada0p4 geli attach /dev/ada0p5 geli attach /dev/ada1p4 geli attach /dev/ada1p5</code> </pre> <br><p> <code>root@:~ # zpool create appdata mirror /dev/ada0p4.eli /dev/ada1p4.eli</code> </p> <br><p> å¯¹äºæ²¡æœ‰é•œåƒçš„æ•°æ® </p><br><p> <code>root@:~ # zpool create miscdata /dev/ada0p5.eli /dev/ada1p5.eli</code> </p> <br><p> å¥½äº†ï¼Œæˆ‘ä»¬çš„æœåŠ¡å™¨å·²ç»å‡†å¤‡å¥½æˆ˜æ–—äº†ã€‚ æˆ‘ä»¬æ‹¥æœ‰ä¸€äº›æ± ï¼Œä»¥åå¯ä»¥é€šè¿‡å¢åŠ æ± æ¥æ‰©å±•ã€‚ é©±åŠ¨å™¨ã€‚ è¿˜æœ‰å¿«ç…§ï¼Œå¦‚ä½•ä½¿ç”¨å¿«ç…§ï¼Œæˆ‘å°†å¯¹æ­¤è¿›è¡Œä»‹ç»ã€‚ </p><br><p>  <em>å…·æœ‰ä¸‰ä¸ªé©±åŠ¨å™¨çš„æœåŠ¡å™¨</em> </p><br><p> è¿™é‡Œçš„é…ç½®ç•¥æœ‰ä¸åŒã€‚ æˆ‘ä»¬æœ‰ä¸€å—å¸¦æœ‰ä¸‰ä¸ª450GB SSDçš„ç¡¬ä»¶ã€‚ è¯¥æœåŠ¡å™¨å°†ä¸»è¦ç”¨äºå®Œå…¨è™šæ‹ŸåŒ–ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°½å¯èƒ½å¤šçš„ç©ºé—´ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨ä¸¢å¤±ä¸€ä¸ªç£ç›˜ä¹‹åç»§ç»­å·¥ä½œã€‚ åˆå§‹å®‰è£…åï¼Œæˆ‘ä»¬çš„ç£ç›˜å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><p> <code>root@:~ # gpart show /dev/ada[0-9]</code> </p> <br><pre> <code class="plaintext hljs">=&gt; 40 937703008 ada0 GPT (447G) 40 472 1 freebsd-boot (236K) 512 52428800 2 freebsd-zfs (25G) 52429312 885273736 - free - (422G) =&gt; 40 937703008 ada1 GPT (447G) 40 472 1 freebsd-boot (236K) 512 52428800 2 freebsd-zfs (25G) 52429312 885273736 - free - (422G) =&gt; 40 937703008 ada2 GPT (447G) 40 472 1 freebsd-boot (236K) 512 52428800 2 freebsd-zfs (25G) 52429312 885273736 - free - (422G)</code> </pre><br><p> æˆ‘ä»¬åˆ›å»º420 GBçš„åˆ†åŒºï¼ˆç›´åˆ°ä¸åˆ›å»ºç£ç›˜çš„æœ«å°¾ï¼Œå› ä¸ºåœ¨æ›´æ¢ç£ç›˜æ—¶ï¼Œå…¶å®é™…å¤§å°å¯èƒ½ä¼šç•¥æœ‰ä¸åŒï¼‰ </p><br><pre> <code class="plaintext hljs">root@hyper:~ # gpart add -t freebsd-zfs -s 420g /dev/ada0 ada0p3 added root@hyper:~ # gpart add -t freebsd-zfs -s 420g /dev/ada1 ada1p3 added root@hyper:~ # gpart add -t freebsd-zfs -s 420g /dev/ada2 ada2p3 added</code> </pre> <br><p> æˆ‘ä»¬åŠ å¯† </p><br><pre> <code class="plaintext hljs">root@hyper:~ # geli init /dev/ada0p3 Enter new passphrase: Reenter new passphrase: Metadata backup for provider /dev/ada0p3 can be found in /var/backups/ada0p3.eli and can be restored with the following command: # geli restore /var/backups/ada0p3.eli /dev/ada0p3 root@hyper:~ # geli init /dev/ada1p3 Enter new passphrase: Reenter new passphrase: Metadata backup for provider /dev/ada1p3 can be found in /var/backups/ada1p3.eli and can be restored with the following command: # geli restore /var/backups/ada1p3.eli /dev/ada1p3 root@hyper:~ # geli init /dev/ada2p3 Enter new passphrase: Reenter new passphrase: Metadata backup for provider /dev/ada2p3 can be found in /var/backups/ada2p3.eli and can be restored with the following command: # geli restore /var/backups/ada2p3.eli /dev/ada2p3</code> </pre> <br><p>  <em>ä»€ä¹ˆæ˜¯å…ƒæ•°æ®å¤‡ä»½ï¼Ÿ</em> </p><br><p> è¯¥æ–‡ä»¶å¯ç”¨äºå°†åŠ å¯†å¯†ç é‡ç½®ä¸ºæˆ‘ä»¬è¾“å…¥çš„å¯†ç ã€‚ å¥½å§ï¼Œä»¥é˜²ä¸‡ä¸€æˆ‘åæ¥æ”¹å˜è€Œå¿˜äº†ã€‚ æ— è®ºå¦‚ä½•ï¼Œå€¼å¾—ç‰¢è®°è¿™ä¸€ç»†å¾®å·®åˆ«ã€‚ </p><br><p> é™„åŠ ç£ç›˜å¹¶åˆ›å»ºæ±  </p><br><pre> <code class="plaintext hljs">root@hyper:~ # geli attach /dev/ada0p3 Enter passphrase: root@hyper:~ # geli attach /dev/ada1p3 Enter passphrase: root@hyper:~ # geli attach /dev/ada2p3 Enter passphrase: root@hyper:~ # zpool create safestore raidz1 /dev/ada0p3.eli /dev/ada1p3.eli /dev/ada2p3.eli</code> </pre> <br><p> åœ¨è¾“å‡ºå¤„ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªå…·æœ‰820 GBç£ç›˜ç©ºé—´çš„æ±  </p><br><pre> <code class="plaintext hljs">root@hyper:~ # zfs list NAME USED AVAIL REFER MOUNTPOINT safestore 89.2K 810G 29.3K /safestore ...</code> </pre> <br><p> æ‚¨å¯ä»¥æ ¹æ®éœ€è¦æ”¶é›†ZFSæ± å’Œå…·æœ‰ä¸åŒé…ç½®çš„ä¸åŒç£ç›˜ã€‚ è¿™æ˜¯ä¸€ç§å¯ä»¥æ°¸ä¹…æ‰©å±•çš„å­˜å‚¨è®¾è®¡å™¨ã€‚  ZFSåœ¨è®¾å¤‡ä¸Šåˆ›å»ºäº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œä½¿æ‚¨å¯ä»¥å®ç°æä¸ºæƒŠäººçš„é…ç½®ã€‚ </p><br><p>  <strong>ç®¡ç†ç¨‹åºçš„å®‰è£…å’Œé…ç½®</strong> </p><br><p>  FreeBSDæä¾›äº†ä¸¤ç§ç°æˆçš„æ¥å®¾OSè§£å†³æ–¹æ¡ˆ-jailså’Œbhyveã€‚ æœ‰<a href="https://bsdstore.ru/" rel="nofollow">cbsd</a> ï¼Œå®ƒæ˜¯FreeBSD Jailsï¼Œbhyveå’ŒXENçš„åŒ…è£…ã€‚ åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘å°†ä¸æ¶‰åŠåè€…ï¼Œå› ä¸º æˆ‘è‡ªå·±ä»æœªä½¿ç”¨è¿‡ã€‚ </p><br><p> å•å…ƒæ˜¯FreeBSDç³»ç»Ÿçš„å…‹éš†ã€‚ ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„éš”ç¦»è¿‡ç¨‹çš„å·¥å…·ã€‚ ä¸»æœºç³»ç»Ÿå¯ä»¥æ‰˜ç®¡ä½äºå…¶è‡ªèº«ç‰ˆæœ¬çš„ä»»ä½•ç‰ˆæœ¬çš„å•å…ƒã€‚ å•å…ƒå¯ä»¥åœ¨ä¸»æœºä¹‹é—´ä¼ è¾“ï¼Œå¿«ç…§å’Œå›æ»šï¼Œç”šè‡³å¯ä»¥éšæ—¶å›æ»šã€‚ å°½å¯èƒ½ä½¿ç”¨klektkiæ˜¯å€¼å¾—çš„ï¼Œå› æ­¤å¯ä»¥æœ€ä½³åœ°ä½¿ç”¨ç³»ç»Ÿèµ„æºï¼Œè€Œä¸ç”¨èŠ±åœ¨å®Œå…¨è™šæ‹ŸåŒ–ä¸Šã€‚ </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/95c/817/901/95c8179015447a58c383f4a4a81a510d.gif" alt="å›¾ç‰‡"></p><br><p> åè¿‡æ¥ï¼Œbhyveæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„è™šæ‹Ÿæœºç®¡ç†ç¨‹åºï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥å¼•å‘å„ç§Ubuntuå’Œdockersã€‚ </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ffd/cb6/219/ffdcb6219c701e2e114100d9601e9fea.gif" alt="å›¾ç‰‡"></p><br><p> <code>root@:~ # pkg install cbsd</code> </p> <br><p> å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œcbsdä»…æå–11ä¸ªå¤§å°ä¸º35 MBçš„ä¾èµ–é¡¹ã€‚ </p><br><pre> <code class="plaintext hljs">New packages to be INSTALLED: cbsd: 12.1.2 sudo: 1.8.28 gettext-runtime: 0.20.1 indexinfo: 0.3.1 libssh2: 1.8.2,3 ca_root_nss: 3.47.1 rsync: 3.1.3_1 libiconv: 1.14_11 pkgconf: 1.6.3,1 libedit: 3.1.20190324,1 sqlite3: 3.29.0 readline: 8.0.0 Number of packages to be installed: 12 The process will require 33 MiB more space. 8 MiB to be downloaded. Proceed with this action? [y/N]: y</code> </pre><br><p> åœ¨æ± ä¸Šä¸ºå•å…ƒåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„éƒ¨åˆ† </p><br><p> <code>root@:~ # zfs create miscdata/jails</code> </p> <br><p> åˆå§‹åŒ–cbsd </p><br><p> <code>root@:~ # env workdir="/miscdata/jails" /usr/local/cbsd/sudoexec/initenv</code> </p> <br><div class="spoiler">  <b class="spoiler_title">è¯ºåŠ å¸ƒå¡å¤«</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">-------[CBSD v.12.1.2]------- This is install/upgrade scripts for CBSD. Don't forget to backup. ----------------------------- Do you want prepare or upgrade hier environment for CBSD now? [yes(1) or no(0)] 1 &gt;&gt;&gt; Installing or upgrading [Stage 1: account &amp; dir hier] * Check hier and permission... ./.rssh missing (created) ./.ssh missing (created) ./.ssh/sockets missing (created) ./basejail missing (created) ./etc missing (created) ./etc/defaults missing (created) ./export missing (created) ./ftmp missing (created) ./import missing (created) ./jails missing (created) ./jails-data missing (created) ./jails-fstab missing (created) ./jails-rcconf missing (created) ./jails-system missing (created) ./share missing (created) ./share/dialog missing (created) ./share/helpers missing (created) ./share/FreeBSD-jail-puppet-skel missing (created) ./share/FreeBSD-jail-skel missing (created) ./share/FreeBSD-jail-vnet-skel missing (created) ./share/emulators missing (created) ./src missing (created) ./tmp missing (created) ./var missing (created) ./var/cron missing (created) ./var/cron/tabs missing (created) ./var/db missing (created) ./var/log missing (created) ./var/mail missing (created) ./var/run missing (created) ./var/spool missing (created) * write directory id: jaildatadir * write directory id: jailsysdir * write directory id: jailrcconfdir * write directory id: dbdir [Stage 2: build tools] Shall i add cbsd user into /usr/local/etc/sudoers.d/cbsd_sudoers sudo file to obtain root privileges for the most cbsd commands? [yes(1) or no(0)] 1 [Stage 3: local settings] Shall i modify the /etc/rc.conf to sets cbsd_workdir="/miscdata/jails"?: [yes(1) or no(0)] 1 /etc/rc.conf: cbsd_workdir: -&gt; /miscdata/jails [Stage 4: update default skel resolv.conf] [Stage 5: refreshing inventory] nodename: CBSD Nodename for this host eg the hostname. Warning: this operation will recreate the ssh keys in /miscdata/jails/.ssh dir: hostname.org Empty inventory database created: /miscdata/jails/var/db/inv.hostname.org.sqlite nodeip: Node management IPv4 or IPv6 address (used for node interconnection), eg: 151.106.27.106 jnameserver: Jails default DNS name-server (for jails resolv.conf), eg: 9.9.9.9,149.112.112.112 8.8.8.8,8.8.4.4 nodeippool: Jail pool IP address range (networks for jails) Hint: use space as delimiter for multiple networks, eg: 10.0.0.0/16 151.106.27.106/24 192.168.0.0/24 nat_enable: Enable NAT for RFC1918 networks? [yes(1) or no(0)] 0 fbsdrepo: Use official FreeBSD repository? When no (0) the repository of CBSD is preferred (useful for stable=1) for fetching base/kernel? [yes(1) or no(0)] 1 zfsfeat: You are running on a ZFS-based system. Enable ZFS feature? [yes(1) or no(0)] 1 parallel: Parallel mode stop/start ? (0 - no parallel or positive value (in seconds) as timeout for next parallel sequence) eg: 5 0 stable: Use STABLE branch instead of RELEASE by default? Attention: only the CBSD repository has a binary base for STABLE branch ? (STABLE_X instead of RELEASE_X_Y branch for base/kernel will be used), eg: 0 (use release) 0 sqlreplica: Enable sqlite3 replication to remote nodes ? (0 - no replica, 1 - try to replicate all local events to remote nodes) eg: 1 0 statsd_bhyve_enable: Configure CBSD statsd services for collect RACCT bhyve statistics? ? (EXPERIMENTAL FEATURE)? eg: 0 0 statsd_jail_enable: Configure CBSD statsd services for collect RACCT jail statistics? ? (EXPERIMENTAL FEATURE)? eg: 0 0 statsd_hoster_enable: Configure CBSD statsd services for collect RACCT hoster statistics? ? (EXPERIMENTAL FEATURE)? eg: 0 0 [Stage 6: authentication keys] Generating public/private rsa key pair. Your identification has been saved in /miscdata/jails/.ssh/8a3574aa0ec0ad3056e7dcf0f48adb01.id_rsa. Your public key has been saved in /miscdata/jails/.ssh/8a3574aa0ec0ad3056e7dcf0f48adb01.id_rsa.pub. The key fingerprint is: SHA256:bZM/lo6lx40vE48MxZea1KQMKYIBq3HyPWQrF0xn980 root@hostname.org The key's randomart image is: +---[RSA 2048]----+ | ..ooo . . | | +.o....oo . | |oo = . ..+E+ . | | * + o . .* + | |. o = S =o + | | o . ..o+. | | +** | | *Oo | | o..+. | +----[SHA256]-----+ [Stage 7: modules] Installing module pkg.d cmd: pkg Installing module bsdconf.d cmd: tzsetup Installing module bsdconf.d cmd: ssh Installing module bsdconf.d cmd: ftp Installing module bsdconf.d cmd: adduser Installing module bsdconf.d cmd: passwd Installing module bsdconf.d cmd: service Installing module bsdconf.d cmd: sysrc Installing module bsdconf.d cmd: userlist Installing module bsdconf.d cmd: grouplist Installing module bsdconf.d cmd: adduser-tui Installing module bsdconf.d cmd: pw Installing module bsdconf.d cmd: cloudinit Installing module zfsinstall.d cmd: zfsinstall [Stage 9: cleanup] * Remove obsolete files... Configure RSYNC services for jail migration? [yes(1) or no(0)] 0 cbsdrsyncd_enable: -&gt; YES Do you want to enable RACCT feature for resource accounting? [yes(1) or no(0)] 0 Shall i modify the /etc/rc.conf to sets cbsdd_enable=YES ? [yes(1) or no(0)] 0 cbsdd_enable: -&gt; NO Shall i modify the /etc/rc.conf to sets rcshutdown_timeout="900"? [yes(1) or no(0)] 0 rcshutdown_timeout: 90 -&gt; 900 [Stage X: upgrading] * Insert default topology into vm_cpu_topology table * Insert small1 group into vmpackage table &gt;&gt;&gt; Done First CBSD initialization complete. Now your can run: service cbsdd start to run CBSD services. For change initenv settings in next time, use: cbsd initenv-tui Also don't forget to execute: cbsd initenv every time when you upgrade CBSD version. preseedinit: Would you like a config for "cbsd init" preseed to be printed? [yes(1) or no(0)] 0</code> </pre> </div></div><br><p> è¿è¡Œcbsdå®ˆæŠ¤ç¨‹åºã€‚ æˆ‘ä»¬ä»å¼€å§‹ æˆ‘ä»¬æ²¡æœ‰å°†cbsdæ·»åŠ åˆ°ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œï¼Œå› ä¸º åŒ…å«æ¥å®¾OSæ•°æ®çš„éƒ¨åˆ†å·²åŠ å¯†ã€‚ </p><br><p> <code>root@:~ # service cbsdd onestart</code> </p> <br><p> æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œæ‚¨éœ€è¦é€šè¿‡SSHè¿æ¥åˆ°æœåŠ¡å™¨ï¼ˆè¿™å°±æ˜¯ç³»ç»Ÿåˆ†åŒºæœªåŠ å¯†çš„åŸå› ï¼Œè¿™æ ·ç³»ç»Ÿå°±å¯ä»¥åœ¨æ²¡æœ‰ä»»ä½•VNC / IPMIå¯†ç è¾“å…¥çš„æƒ…å†µä¸‹æˆåŠŸå¯åŠ¨ï¼‰ï¼Œå¹¶ä½¿ç”¨<code>./root/attach_disks.sh</code>è„šæœ¬è§£å¯†æˆ‘ä»¬çš„ç£ç›˜åˆ†åŒºã€‚ </p><br><p> åˆå§‹åŒ–cbsdæ—¶ï¼Œæˆ‘ä»¬æŒ‡ç¤º192.168.0.0/24æ˜¯æˆ‘ä»¬å•å…ƒçš„å­ç½‘ã€‚ æˆ‘è®¡åˆ’å°†åŒä¸€å­ç½‘ç”¨äºå®Œå…¨è™šæ‹ŸåŒ–ã€‚ æˆ‘ä»¬æ‰­æ›²äº†ä¸»æœºä¸Šçš„å‡ ä¸ªå•å…ƒï¼Œä½†æ˜¯åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬è®¾ç½®äº†é˜²ç«å¢™ï¼Œä»¥ä½¿è¿™äº›å•å…ƒçš„NATé€šè¿‡ä¸»æœºå·¥ä½œã€‚ </p><br><pre> <code class="plaintext hljs">root@:~ # sysrc pf_enable=YES pf_enable: NO -&gt; YES root@:~ # service pf start /etc/rc.d/pf: WARNING: /etc/pf.conf is not readable.</code> </pre> <br><p> ä¸ºé˜²ç«å¢™åˆ›å»ºè§„åˆ™æ–‡ä»¶ </p><br><p> <code>root@:~ # ee /etc/pf.conf</code> </p> <br><pre> <code class="plaintext hljs">IF_PUBLIC="igb0" IP_PUBLIC="XXXX" JAIL_IP_POOL="192.168.0.0/24" icmp_types="echoreq" set limit { states 100000, frags 20000, src-nodes 20000 } set skip on lo0 scrub in all #NAT for others nat pass on $IF_PUBLIC from $JAIL_IP_POOL to any -&gt; $IP_PUBLIC ## Jail HTTP/S port forward IP_JAIL="192.168.0.2" PORT_JAIL="{ 80, 443 }" rdr pass on $IF_PUBLIC proto tcp from any to $IP_PUBLIC port $PORT_JAIL -&gt; $IP_JAIL</code> </pre><br><p> åŠ è½½è§„åˆ™ </p><br><pre> <code class="plaintext hljs">root@:~ # service pf start Enabling pf. root@:~ # pfctl -f /etc/pf.conf</code> </pre> <br><p> å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬åˆ›å»ºå•å…ƒ </p><br><p> <code>root@:~ # cbsd jconstruct-tui</code> </p> <br><p><img src="https://habrastorage.org/webt/md/kz/9x/mdkz9xlo12s5ausfki4zzi3gxzq.png"></p><br><p> é€‰æ‹©ä»åŸºæœ¬å­˜å‚¨åº“ä¸­ä¸‹è½½å•å…ƒ </p><br><p><img src="https://habrastorage.org/webt/1l/iy/om/1liyomcjdsmqvqjn1ged3oztnfo.png"></p><br><p> é€šè¿‡<code>root@:~ # cbsd jconstruct-tui</code>å’Œå¦å¤–ä¸¤ä¸ªå•å…ƒæ ¼<code>root@:~ # cbsd jconstruct-tui</code> </p><br><p> ç„¶åæˆ‘ä»¬å¼€å§‹ç»†èƒ </p><br><p> <code>root@:~ # cbsd jstart webapp</code> </p> <br><p> åœ¨å†…éƒ¨ï¼Œæˆ‘ä»¬å·²ç»åšäº†æˆ‘ä»¬æƒ³è¦çš„ </p><br><p> <code>root@:~ # cbsd jlogin webapp</code> </p> <br><div class="spoiler">  <b class="spoiler_title">ä¾‹å¦‚å®‰è£…nginx</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">webapp:/root@[12:58] # pkg install nginx Updating FreeBSD repository catalogue... FreeBSD repository is up to date. All repositories are up to date. Updating database digests format: 100% The following 2 package(s) will be affected (of 0 checked): New packages to be INSTALLED: nginx: 1.16.1_4,2 pcre: 8.43_2 Number of packages to be installed: 2 The process will require 8 MiB more space. 2 MiB to be downloaded. Proceed with this action? [y/N]: y [webapp.host.org] [1/2] Fetching nginx-1.16.1_4,2.txz: 100% 442 KiB 452.8kB/s 00:01 [webapp.host.org] [2/2] Fetching pcre-8.43_2.txz: 100% 1 MiB 638.0kB/s 00:02 Checking integrity... done (0 conflicting) [webapp.host.org] [1/2] Installing pcre-8.43_2... [webapp.host.org] [1/2] Extracting pcre-8.43_2: 100% [webapp.host.org] [2/2] Installing nginx-1.16.1_4,2... ===&gt; Creating groups. Using existing group 'www'. ===&gt; Creating users Using existing user 'www'. [webapp.host.org] [2/2] Extracting nginx-1.16.1_4,2: 100% ===== Message from nginx-1.16.1_4,2: -- Recent version of the NGINX introduces dynamic modules support. In FreeBSD ports tree this feature was enabled by default with the DSO knob. Several vendor's and third-party modules have been converted to dynamic modules. Unset the DSO knob builds an NGINX without dynamic modules support. To load a module at runtime, include the new `load_module' directive in the main context, specifying the path to the shared object file for the module, enclosed in quotation marks. When you reload the configuration or restart NGINX, the module is loaded in. It is possible to specify a path relative to the source directory, or a full path, please see https://www.nginx.com/blog/dynamic-modules-nginx-1-9-11/ and http://nginx.org/en/docs/ngx_core_module.html#load_module for details. Default path for the NGINX dynamic modules is /usr/local/libexec/nginx. webapp:/root@[12:59] # sysrc nginx_enable=YES nginx_enable: -&gt; YES webapp:/root@[12:59] # service nginx start Performing sanity check on nginx configuration: nginx: the configuration file /usr/local/etc/nginx/nginx.conf syntax is ok nginx: configuration file /usr/local/etc/nginx/nginx.conf test is successful Starting nginx. webapp:/root@[DING!] # sockstat -l4 USER COMMAND PID FD PROTO LOCAL ADDRESS FOREIGN ADDRESS www nginx 27982 6 tcp4 192.168.0.2:80 *:* root nginx 27981 6 tcp4 192.168.0.2:80 *:* root sendmail 25361 4 tcp4 192.168.0.2:25 *:* webapp:/root@[13:00] #</code> </pre></div></div><br><p> è¿™æ˜¯å…¸å‹çš„ç»†èƒåŠ¨ç‰©å›­ï¼š </p><br><pre> <code class="plaintext hljs">root@:~ # jls JID IP Address Hostname Path 1 192.168.0.1 tor.host.org /miscdata/jails/jails/tor 2 192.168.0.2 webapp.host.org /miscdata/jails/jails/webapp 3 192.168.0.3 bitcoind.host.org /miscdata/jails/jails/bitcoind 4 192.168.0.4 ethd.host.org /miscdata/jails/jails/ethd</code> </pre> <br><p>  webapp     <code>nginx</code> ,          <code>/etc/pf.conf</code> </p><br><p> <strong> </strong> </p><br><p>      .  .       </p><br><p>  <code>/etc/rc.conf</code>             </p><br><pre> <code class="plaintext hljs">ifconfig_igb0_alias="inet 192.168.0.1 netmask 255.255.255.0" gateway_enable="YES"</code> </pre> <br><pre> <code class="plaintext hljs">root@hyper:~ # echo 'vmm_load="YES"' &gt;&gt; /boot/loader.conf root@hyper:~ # echo 'kld_list="vmm if_tap if_bridge nmdm"' &gt;&gt; /etc/rc.conf root@hyper:~ # reboot</code> </pre> <br><p>   ,        . </p><br><div class="spoiler"> <b class="spoiler_title">/etc/pf.conf</b> <div class="spoiler_text"><p> IF_PUBLIC="igb0" <br> IP_PUBLIC="YYYY" </p><br><p> JAIL_IP_POOL="192.168.0.0/24" </p><br><p> icmp_types="echoreq" </p><br><p> set limit { states 100000, frags 20000, src-nodes 20000 } <br> set skip on lo0 <br> scrub in all </p><br><h1 id="nat-for-others"> NAT for others </h1><br><p> nat pass on $IF_PUBLIC from $JAIL_IP_POOL to any -&gt; $IP_PUBLIC </p><br><h2 id="jail-https-port-forward"> Jail HTTP/S port forward </h2><br><p> IP_JAIL="192.168.0.2" <br> PORT_JAIL="{ 80, 443 }" <br> rdr pass on $IF_PUBLIC proto tcp from any to $IP_PUBLIC port $PORT_JAIL -&gt; $IP_JAIL </p></div></div><br><pre> <code class="plaintext hljs">root@hyper:~ # sysrc pf_enable=YES pf_enable: NO -&gt; YES root@hyper:~ # service pf start Enabling pf.</code> </pre> <br><p> ,    </p><br><p> <code>root@hyper:~ # cbsd bconstruct-tui</code> </p> <br><p><img src="https://habrastorage.org/webt/ik/zb/_e/ikzb_einlgwc9i-tbfl560s03ww.png"></p><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><p> root@hyper:~ # cbsd bstart debian <br> init_systap: waiting for link: igb0 <br> Looks like /safestore/jails/vm/debian/dsk1.vhd is empty. <br> May be you want to boot from CD? <br> [yes(1) or no(0)] <br>  1ä¸ª <br> Temporary boot device: cd <br> vm_iso_path: iso-debian-10.1.0-amd64-DVD-1.iso <br> No such media: /safestore/jails/src/iso/cbsd-iso-debian-10.1.0-amd64-DVD-1.iso in /safestore/jails/src/iso <br> Shall i download it from: <a href="https://ftp.acc.umu.se/debian-cd/current/amd64/iso-dvd/" rel="nofollow">https://ftp.acc.umu.se/debian-cd/current/amd64/iso-dvd/</a> <a href="http://debian-cd.repulsive.eu/10.1.0/amd64/iso-dvd/" rel="nofollow">http://debian-cd.repulsive.eu/10.1.0/amd64/iso-dvd/</a> <a href="https://gensho.ftp.acc.umu.se/debian-cd/current/amd64/iso-dvd/" rel="nofollow">https://gensho.ftp.acc.umu.se/debian-cd/current/amd64/iso-dvd/</a> <a href="http://cdimage.debian.org/cdimage/release/10.1.0/amd64/iso-dvd/" rel="nofollow">http://cdimage.debian.org/cdimage/release/10.1.0/amd64/iso-dvd/</a> <a href="http://debian.mirror.cambrium.nl/debian-cd/10.1.0/amd64/iso-dvd/" rel="nofollow">http://debian.mirror.cambrium.nl/debian-cd/10.1.0/amd64/iso-dvd/</a> <a href="http://mirror.overthewire.com.au/debian-cd/10.1.0/amd64/iso-dvd/" rel="nofollow">http://mirror.overthewire.com.au/debian-cd/10.1.0/amd64/iso-dvd/</a> <a href="http://ftp.crifo.org/debian-cd/10.1.0/amd64/iso-dvd/" rel="nofollow">http://ftp.crifo.org/debian-cd/10.1.0/amd64/iso-dvd/</a> <a href="http://debian.cse.msu.edu/debian-cd/10.1.0/amd64/iso-dvd/" rel="nofollow">http://debian.cse.msu.edu/debian-cd/10.1.0/amd64/iso-dvd/</a> ? <br> [yes(1) or no(0)] <br>  1ä¸ª <br> Download to: /safestore/jails/src/iso/cbsd-iso-debian-10.1.0-amd64-DVD-1.iso <br> Scanning for fastest mirrorâ€¦ <br> Mirror source: Bytes per 3sec: </p><br><ul><li> [ 1/14 ] <a href="http://cbsd.lifec0re.net/iso/" rel="nofollow">http://cbsd.lifec0re.net/iso/</a> : 8036352 </li></ul></div></div><br><p>      VNC    5900,       SSH </p><br><p> <code>ssh hyperhost -L 5900:localhost:5900</code> </p> <br><p><img src="https://habrastorage.org/webt/aq/tr/ll/aqtrllbz9wryvpnsccxxlbiwbei.png"></p><br><p>  . IP    -  192.168.0.100. </p><br><p>   <code>/etc/pf.conf</code>  SSH </p><br><pre> <code class="plaintext hljs">## VM SSH port forward IP_VM="192.168.0.100" PORT_VM="{ 22100 }" rdr pass on $IF_PUBLIC proto tcp from any to $IP_PUBLIC port $PORT_VM -&gt; $IP_VM port 22</code> </pre> <br><p>        .   ,   . </p><br><pre> <code class="plaintext hljs">root@hyper:~ # zfs list NAME USED AVAIL REFER MOUNTPOINT safestore 5.89G 804G 29.3K /safestore safestore/jails 5.89G 804G 4.46G /safestore/jails safestore/jails/debian 920M 804G 208K /safestore/jails/vm/debian safestore/jails/debian/dsk1.vhd 919M 804G 919M - safestore/jails/linuxjail 329M 804G 329M /safestore/jails/jails-data/linuxjail-data safestore/jails/nginx 89.2M 804G 89.2M /safestore/jails/jails-data/nginx-data safestore/jails/tor 117M 804G 117M /safestore/jails/jails-data/tor-data zsystem 1.85G 21.9G 88K none zsystem/root 1.85G 21.9G 1.20G / zsystem/root/tmp 120K 21.9G 120K /tmp zsystem/root/var 662M 21.9G 662M /var</code> </pre><br><p> <code>root@hyper:~ # zfs snap safestore/jails/debian/dsk1.vhd@fresh</code> </p> <br><p>      .    . </p><br><h4 id="chaynaya-pauza---ansible">   â€” Ansible </h4><br><p>          3,   1300 .         . </p><br><div class="spoiler"> <b class="spoiler_title">/etc/ansible/hosts</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">[hyper-debian-group] hyper-debian [hyper-group] hyper [hyper-group:vars] ansible_python_interpreter=/usr/local/bin/python3.7</code> </pre> </div></div><br><div class="spoiler"> <b class="spoiler_title">~/.ssh/config</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Host hyper Hostname YYYY User root Port 33696 Host hyper-debian Hostname YYYY User root Port 22100</code> </pre></div></div><br><div class="spoiler"> <b class="spoiler_title">~/deploy-docker.yml</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">- hosts: hyper-debian gather_facts: no tasks: - name: Install a list of misc packages apt: update_cache: yes pkg: - apt-transport-https - ca-certificates - curl - gnupg2 - software-properties-common - name: Add Docker repo shell: curl -fsSL https://download.docker.com/linux/debian/gpg | apt-key add - - name: Add Docker repo shell: apt-key fingerprint 0EBFCD88 - name: Do some linux repo magic shell: add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/debian $(lsb_release -cs) stable" - name: Install Docker CE suite &amp; composer apt: update_cache: yes pkg: - docker-ce - docker-ce-cli - containerd.io - docker-compose - name: Update all packages to the latest version apt: upgrade: dist</code> </pre> </div></div><br><div class="spoiler"> <b class="spoiler_title">~/rollback-debian.yml</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">- hosts: hyper gather_facts: no tasks: - name: stop debian shell: cbsd bstop debian - name: list ZFS datasets shell: zfs list | grep debian register: zfslist - debug: var=zfslist.stdout_lines - name: rollback debian shell: zfs rollback safestore/jails/debian/dsk1.vhd@fresh - name: list ZFS datasets shell: zfs list | grep debian register: zfslist - debug: var=zfslist.stdout_lines - name: start debian shell: cbsd bstart debian</code> </pre> </div></div><br><p> <strong>     ,   TerraForm</strong> </p><br><p>        </p><br><pre> <code class="plaintext hljs">[user@localhost ~]$ ansible-playbook deploy-docker.yml PLAY [hyper-debian] ******************************************************************************************************* TASK [Install a list of misc packages] ********************************************************************************************* changed: [hyper-debian] TASK [Add Docker repo] ******************************************************************************************************** changed: [hyper-debian] TASK [Add Docker repo] ******************************************************************************************************** changed: [hyper-debian] TASK [Do some linux repo magic] ********************************************************************************************************changed: [hyper-debian] TASK [Install Docker CE suite &amp; composer] ********************************************************************************************************changed: [hyper-debian] TASK [Update all packages to the latest version] ********************************************************************************************************ok: [hyper-debian] PLAY RECAP ********************************************************************************************************hyper-debian : ok=6 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0</code> </pre><br><p>              ,    iRedMail. </p><br><pre> <code class="plaintext hljs">docker run --privileged -p 80:80 -p 443:443 \ -e "DOMAIN=example.com" -e "HOSTNAME=mail" \ -e "MYSQL_ROOT_PASSWORD=password" \ -e "SOGO_WORKERS=1" \ -e "TIMEZONE=Europe/Prague" \ -e "POSTMASTER_PASSWORD=password" \ -e "IREDAPD_PLUGINS=['reject_null_sender', 'reject_sender_login_mismatch', 'greylisting', 'throttle', 'amavisd_wblist', 'sql_alias_access_policy']" \ -v PATH/mysql:/var/lib/mysql \ -v PATH/vmail:/var/vmail \ -v PATH/clamav:/var/lib/clamav \ --name=iredmail lejmr/iredmail:mysql-latest</code> </pre> <br><p>       ?       -    Debian. </p><br><pre> <code class="plaintext hljs">[user@localhost ~]$ ansible-playbook rollback-debian.yml PLAY [hyper] ******************************************************************************************************** TASK [stop debian] ********************************************************************************************************changed: [hyper] TASK [list ZFS datasets] ********************************************************************************************************changed: [hyper] TASK [debug] ********************************************************************************************************ok: [hyper] =&gt; { "zfslist.stdout_lines": [ "safestore/jails/debian 2.65G 803G 206K /safestore/jails/vm/debian", "safestore/jails/debian/dsk1.vhd 2.65G 803G 2.34G -" ] } TASK [rollback debian] ********************************************************************************************************changed: [hyper] TASK [list ZFS datasets] ********************************************************************************************************changed: [hyper] TASK [debug] ********************************************************************************************************ok: [hyper] =&gt; { "zfslist.stdout_lines": [ "safestore/jails/debian 920M 804G 206K /safestore/jails/vm/debian", "safestore/jails/debian/dsk1.vhd 919M 804G 919M -" ] } TASK [start debian] ********************************************************************************************************changed: [hyper] PLAY RECAP ********************************************************************************************************hyper : ok=7 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0</code> </pre><br><p>            ,          . </p><br><p>       ,   ,    <a href="https://sochain.com/address/BTC/1baysxTdXkwZnBosDdL1veb2zWDo6DC5b" rel="nofollow">1baysxTdXkwZnBosDdL1veb2zWDo6DC5b</a> </p><br><p>   ! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN479192/">https://habr.com/ru/post/zh-CN479192/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN479180/index.html">åœ¨.NET Coreä¸Šåˆ›å»ºDiscord-botå¹¶å°†å…¶éƒ¨ç½²åˆ°VPSæœåŠ¡å™¨</a></li>
<li><a href="../zh-CN479182/index.html">åœ¨Ankiç¨‹åºä¸­å‡†å¤‡å¸¦æœ‰å£°éŸ³çš„å¤–è¯­å•è¯ä»¥è¿›è¡Œè®°å¿†çš„åšæ³•</a></li>
<li><a href="../zh-CN479184/index.html">ä½¿ç”¨pwnable.kr 26è§£å†³é—®é¢˜-ascii_easyã€‚ æˆ‘ä»¬ä»å¤´å¼€å§‹ä¸€åŠ³æ°¸é€¸åœ°å¤„ç†ROPå°å·¥å…·</a></li>
<li><a href="../zh-CN479186/index.html">å…³äºå¹¶è¡Œè®¡ç®—çš„ç»“æ„æˆ–åå¯¹â€œ Goâ€è¿ç®—ç¬¦çš„å‚æ•°</a></li>
<li><a href="../zh-CN479188/index.html">æ‰€æœ‰è‡ªç„¶æ•°çš„æ€»å’Œï¼š1 + 2 + 3 + 4 +...ã€‚ ç¬¬äºŒéƒ¨åˆ†</a></li>
<li><a href="../zh-CN479200/index.html">åˆ†å½¢å›¾åƒå‹ç¼©</a></li>
<li><a href="../zh-CN479202/index.html">C ++å’Œæ•°å€¼æ–¹æ³•ï¼šè¿‘ä¼¼ç‰›é¡¿-ç§‘èŒ¨ç§¯åˆ†</a></li>
<li><a href="../zh-CN479210/index.html">è‡ª2020å¹´1æœˆ1æ—¥èµ·ï¼Œå¤–å›½åœ¨çº¿å•†åº—çš„è´­ä¹°å°†å‘ç”Ÿä»€ä¹ˆ</a></li>
<li><a href="../zh-CN479214/index.html">è«æ–¯ç§‘ï¼ƒ2å¼€å‘äººå‘˜å³å°†åˆ°æ¥çš„å…è´¹æ´»åŠ¨ç²¾é€‰</a></li>
<li><a href="../zh-CN479216/index.html">ç¬¬äºŒæ¬¡é£Pandora DXL 3000æˆ–æˆ‘å¦‚ä½•å›ºå®šè‡ªå·±çš„é¥æµ‹</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>