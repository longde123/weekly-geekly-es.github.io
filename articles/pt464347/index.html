<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚≠ïÔ∏è üë©‚Äçüé® üè§ M√≥dulos de inje√ß√£o de depend√™ncia, JavaScript e ES6 üìû üëô üë´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Outra implementa√ß√£o da Inje√ß√£o de Depend√™ncia no JavaScript √© com m√≥dulos ES6, com a capacidade de usar o mesmo c√≥digo em um navegador e em nodejs e n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>M√≥dulos de inje√ß√£o de depend√™ncia, JavaScript e ES6</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464347/"><p>  Outra implementa√ß√£o da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Inje√ß√£o</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Depend√™ncia no JavaScript</a> √© com m√≥dulos ES6, com a capacidade de usar o mesmo c√≥digo em um navegador e em nodejs e n√£o usar transpilers. </p><br><p><img src="https://habrastorage.org/webt/cm/yd/it/cmyditgokfobpp0llt2opzsflts.jpeg" alt="imagem"></p><br><p>  Sob o corte est√° minha vis√£o sobre o DI, seu lugar em aplicativos da Web modernos, a implementa√ß√£o fundamental de um cont√™iner de DI que pode criar objetos na frente e no verso, al√©m de uma explica√ß√£o do que Michael Jackson tem a ver com isso. </p><a name="habracut"></a><br><p>  Pe√ßo fortemente aos que consideram trivial no artigo que n√£o se estuprem e n√£o leiam at√© o fim, para que mais tarde, quando estiverem desapontados, n√£o fa√ßam um "sinal de menos".  Eu n√£o sou contra os "menos" - mas apenas se o menos for acompanhado por um coment√°rio, o que exatamente na publica√ß√£o causou uma rea√ß√£o negativa.  Este √© um artigo t√©cnico, portanto, tente ser condescendente com o estilo de apresenta√ß√£o e critique com precis√£o o componente t√©cnico acima.  Obrigada </p><br><h1 id="obekty-v-prilozhenii">  Objetos no aplicativo </h1><br><p>  Eu realmente respeito a programa√ß√£o funcional, mas dediquei a maior parte da minha atividade profissional √† cria√ß√£o de aplicativos que consistem em objetos.  O JavaScript me impressiona com o fato de que as fun√ß√µes nele tamb√©m s√£o objetos.  Ao criar aplicativos, penso em objetos, essa √© minha deforma√ß√£o profissional. </p><br><p>  De acordo com a vida √∫til, os objetos no aplicativo podem ser divididos nas seguintes categorias: </p><br><ul><li>  <strong>permanente</strong> - surgem em algum est√°gio do pedido e s√£o destru√≠dos somente quando o pedido √© conclu√≠do; </li><li>  <strong>tempor√°rio</strong> - surgem quando √© necess√°rio executar alguma opera√ß√£o e s√£o destru√≠dos quando essa opera√ß√£o √© conclu√≠da; </li></ul><br><p>  A esse respeito, na programa√ß√£o, existem padr√µes de design como: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">singleton</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">f√°brica abstrata</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">construtor</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">piscina</a> , ... </li></ul><br><p>  Ou seja, do meu ponto de vista, o aplicativo consiste em solit√°rios permanentemente existentes que executam as opera√ß√µes necess√°rias ou geram objetos tempor√°rios para execut√°-las. </p><br><h1 id="konteyner-obektov">  Cont√™iner de Objetos </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A inje√ß√£o de depend√™ncia</a> √© uma abordagem que facilita a cria√ß√£o de objetos em um aplicativo.  Ou seja, no aplicativo h√° um objeto especial que "sabe" como criar todos os outros objetos.  Esse objeto √© chamado de Cont√™iner de Objetos (√†s vezes, um Gerenciador de Objetos). </p><br><p>  O Cont√™iner de Objetos n√£o √© um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Objeto Divino</a> , porque  sua tarefa √© apenas criar objetos significativos do aplicativo e fornecer acesso a outros objetos para eles.  A grande maioria dos objetos de aplicativo, gerados pelo Container e localizados nele, n√£o tem id√©ia do pr√≥prio Container.  Eles podem ser colocados em qualquer outro ambiente, com as depend√™ncias necess√°rias, e tamb√©m funcionar√£o maravilhosamente l√° (os testadores sabem o que quero dizer). </p><br><h1 id="mesto-vnedreniya">  Local de implementa√ß√£o </h1><br><p>  Em geral, existem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">duas maneiras</a> de injetar depend√™ncias em um objeto: </p><br><ul><li>  atrav√©s do construtor; </li><li>  atrav√©s de uma propriedade (ou seu acessador); </li></ul><br><p>  Basicamente, usei a primeira abordagem, portanto continuarei a descri√ß√£o com o ponto de vista da inje√ß√£o de depend√™ncia por meio do construtor. </p><br><p>  Digamos que temos um aplicativo composto por tr√™s objetos: </p><br><p><img src="https://habrastorage.org/webt/lv/5n/w4/lv5nw4nv1bperu7mgoxtn4luss4.png" alt="imagem"></p><br><p>  No PHP (esta linguagem com tradi√ß√µes DI de longa data, atualmente tenho bagagem ativa, passarei para o JS um pouco mais tarde), uma situa√ß√£o semelhante pode ser refletida desta maneira: </p><br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $config; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Config $config)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;config = $config; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $config; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $service; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Config $config, Service $service)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;config = $config; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;service = $service; } }</code> </pre> <br><p>  Essas informa√ß√µes devem ser suficientes para que um cont√™iner de DI (por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">liga / cont√™iner</a> ), se configurado adequadamente, tamb√©m possa criar suas depend√™ncias de <code>Service</code> e <code>Config</code> mediante solicita√ß√£o, para criar um objeto <code>Application</code> e pass√°-los para o construtor do objeto <code>Application</code> . </p><br><h1 id="identifikatory-zavisimostey">  Identificadores de depend√™ncia </h1><br><p>  Como o Cont√™iner de Objetos entende que o construtor do objeto <code>Application</code> requer dois objetos de <code>Config</code> e <code>Service</code> ?  Analisando o objeto por meio da API de reflex√£o ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Java</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PHP</a> ) ou analisando o c√≥digo do objeto diretamente (anota√ß√µes de c√≥digo).  Ou seja, no caso geral, podemos determinar os nomes das vari√°veis ‚Äã‚Äãque o construtor de objetos espera ver na entrada e, se a linguagem for tip√°vel, tamb√©m podemos obter os tipos dessas vari√°veis. </p><br><p>  Assim, como identificadores de objetos, o Container pode operar com os nomes dos par√¢metros de entrada do construtor ou com os tipos de par√¢metros de entrada. </p><br><h1 id="sozdanie-obektov">  Criar objetos </h1><br><p>  O objeto pode ser criado explicitamente pelo programador e colocado no container sob o identificador correspondente (por exemplo, "configura√ß√£o") </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \League\Container\Container $container */</span></span> $container-&gt;add(<span class="hljs-string"><span class="hljs-string">"configuration"</span></span>, $config);</code> </pre> <br><p>  e pode ser criado pelo cont√™iner de acordo com certas regras espec√≠ficas.  Essas regras, em geral, se resumem a corresponder o identificador do objeto ao seu c√≥digo.  As regras podem ser definidas explicitamente (mapeamento na forma de c√≥digo, XML, JSON, ...) </p><br><pre> <code class="json hljs">[ [<span class="hljs-string"><span class="hljs-string">"object_id_1"</span></span>, <span class="hljs-string"><span class="hljs-string">"/path/to/source1.php"</span></span>], [<span class="hljs-string"><span class="hljs-string">"object_id_2"</span></span>, <span class="hljs-string"><span class="hljs-string">"/path/to/source2.php"</span></span>], ... ]</code> </pre> <br><p>  ou na forma de algum algoritmo: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{. <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"/path/to/source/${id}.php"</span></span>; }</code> </pre> <br><p>  No PHP, as regras para corresponder um nome de classe a um arquivo com seu c√≥digo-fonte s√£o padronizadas ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PSR-4</a> ); em Java, a correspond√™ncia √© feita no n√≠vel de configura√ß√£o da JVM ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">carregador de classes</a> ).  Se o Cont√™iner fornecer uma pesquisa autom√°tica de fontes ao criar objetos, os nomes das classes ser√£o bons identificadores suficientes para objetos em um Cont√™iner. </p><br><h1 id="namespaces">  Namespaces </h1><br><p>  Geralmente em um projeto, al√©m de seu pr√≥prio c√≥digo, tamb√©m s√£o utilizados m√≥dulos de terceiros.  Com o advento dos gerenciadores de depend√™ncia (maven, compositor, npm), o uso de m√≥dulos foi bastante simplificado e o n√∫mero de m√≥dulos em projetos aumentou muito.  Os espa√ßos para nome permitem que elementos de c√≥digo com o mesmo nome existam em um √∫nico projeto a partir de v√°rios m√≥dulos (classes, fun√ß√µes, constantes). </p><br><p>  Existem idiomas nos quais o espa√ßo para nome √© constru√≠do inicialmente (Java): </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> vendor.project.<span class="hljs-keyword"><span class="hljs-keyword">module</span></span>.folder;</code> </pre> <br><p>  Existem idiomas nos quais o espa√ßo para nome foi adicionado durante o desenvolvimento da linguagem (PHP): </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Vendor</span></span>\<span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">Module</span></span>\<span class="hljs-title"><span class="hljs-title">Folder</span></span>;</code> </pre> <br><p>  Uma boa implementa√ß√£o de namespace permite endere√ßar inequivocamente qualquer elemento do c√≥digo: </p><br><pre> <code class="php hljs">\Doctrine\Common\Annotations\Annotation\Attribute::$name</code> </pre> <br><p>  O espa√ßo para nome resolve o problema de organizar muitos elementos de software em um projeto, e a estrutura do arquivo resolve o problema de organizar arquivos no disco.  Portanto, n√£o h√° muito em comum entre eles, e √†s vezes muito - em Java, por exemplo, uma classe p√∫blica no espa√ßo para nome deve ser unida exclusivamente a um arquivo com o c√≥digo dessa classe. </p><br><p>  Portanto, usar o identificador de uma classe de objeto no namespace do projeto como identificadores de objeto no Container √© uma boa id√©ia e pode servir como base para criar regras para a detec√ß√£o autom√°tica de c√≥digos-fonte ao criar o objeto desejado. </p><br><pre> <code class="php hljs">$container-&gt;add(\Vendor\Project\Module\ObjectType::class, $obj);</code> </pre> <br><h1 id="avtozagruzka-koda">  Inicializa√ß√£o de c√≥digo </h1><br><p>  No PHP <code>composer</code> espa√ßo para nome <code>composer</code> m√≥dulo √© mapeado para o sistema de arquivos dentro do m√≥dulo no descritor do m√≥dulo <code>composer.json</code> : </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"autoload"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"psr-4"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Doctrine\\Common\\Annotations\\"</span></span>: <span class="hljs-string"><span class="hljs-string">"lib/Doctrine/Common/Annotations"</span></span> } }</code> </pre> <br><p>  A comunidade JS poderia fazer um mapeamento semelhante no <code>package.json</code> se houvesse espa√ßos para nome no JS. </p><br><h1 id="identifikatory-zavisimostey-v-js">  Identificadores de depend√™ncia JS </h1><br><p>  Acima, indiquei que o Container pode usar os nomes dos par√¢metros de entrada do construtor ou os tipos de par√¢metros de entrada como identificadores.  O problema √© que: </p><br><ol><li>  JS √© uma linguagem com digita√ß√£o din√¢mica e n√£o especifica tipos ao declarar uma fun√ß√£o. </li><li>  JS usa minificadores que podem renomear par√¢metros de entrada. </li></ol><br><p>  Os desenvolvedores do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cont√™iner</a> DI do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">awilix</a> sugerem o uso do objeto como o √∫nico par√¢metro de entrada para o construtor, e as propriedades desse objeto como depend√™ncias: </p><br><pre> <code class="plaintext hljs">class UserController { constructor(opts) { this.userService = opts.userService } }</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O identificador de</a> propriedade do objeto em JS pode consistir em caracteres alfanum√©ricos, "_" e "$" e n√£o pode come√ßar com um d√≠gito. </p><br><p>  Como precisaremos mapear identificadores de depend√™ncia para o caminho para suas fontes no sistema de arquivos para carregamento autom√°tico, √© melhor abandonar o uso de "$" e usar a experi√™ncia do PHP.  Antes que o operador de <code>namespace</code> aparecesse em algumas estruturas (por exemplo, no Zend 1), os seguintes nomes foram usados ‚Äã‚Äãpara classes: </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Zend_Config_Writer_Json</span></span></span><span class="hljs-class"> </span></span>{...}</code> </pre> <br><p>  Assim, poder√≠amos refletir nossa aplica√ß√£o de tr√™s objetos ( <code>Application</code> , <code>Config</code> , <code>Service</code> ) em JS, algo como isto: </p><br><pre> <code class="plaintext hljs">class Vendor_Project_Config { constructor() { } } class Vendor_Project_Service { constructor({Vendor_Project_Config}) { this.config = Vendor_Project_Config; } } class Vendor_Project_Application { constructor({Vendor_Project_Config, Vendor_Project_Service}) { this.config = Vendor_Project_Config; this.service = Vendor_Project_Service; } }</code> </pre> <br><p>  Se publicarmos o c√≥digo de cada classe: </p><br><pre> <code class="plaintext hljs">export default class Vendor_Project_Application { constructor({Vendor_Project_Config, Vendor_Project_Service}) { this.config = Vendor_Project_Config; this.service = Vendor_Project_Service; } }</code> </pre> <br><p>  no seu arquivo dentro do nosso m√≥dulo de projeto: </p><br><ul><li> <code>./src/</code> <br> <ul><li> <code>./Application.js</code> </li> <li> <code>./Config.js</code> </li> <li> <code>./Service.js</code> </li> </ul></li></ul><br><p>  Em seguida, podemos conectar o diret√≥rio raiz do m√≥dulo ao "namespace" raiz do m√≥dulo na configura√ß√£o do Container: </p><br><pre> <code class="plaintext hljs">const ns = "Vendor_Project"; const path = path.join(module_root, "src"); container.addSourceMapping(ns, path);</code> </pre> <br><p>  e, a partir dessas informa√ß√µes, construa o caminho para as fontes correspondentes ( <code>${module_root}/src/Config.js</code> ) com base no identificador de depend√™ncia ( <code>${module_root}/src/Config.js</code> ). </p><br><h1 id="es6-moduli">  M√≥dulos ES6 </h1><br><p>  O ES6 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">oferece um</a> design geral para carregar m√≥dulos ES6: </p><br><pre> <code class="plaintext hljs">import { something } from 'path/to/source/with/something';</code> </pre> <br><p>  Como precisamos anexar um objeto (classe) a um arquivo, faz sentido na fonte exportar essa classe por padr√£o: </p><br><pre> <code class="plaintext hljs">export default class Vendor_Project_Path_To_Source_With_Something {...}</code> </pre> <br><p>  Em princ√≠pio, √© poss√≠vel n√£o escrever um nome t√£o longo para a classe, apenas <code>Something</code> funcionar√° tamb√©m, mas no Zend 1 eles escreveram e n√£o quebraram, e a exclusividade do nome da classe no projeto afeta positivamente os recursos do IDE (avisos de preenchimento autom√°tico e contextual), portanto e ao depurar: </p><br><p><img src="https://habrastorage.org/webt/qc/vj/wg/qcvjwg4lkvdwbg0nwcbmotantby.png" alt="imagem"></p><br><p>  A importa√ß√£o de uma classe e a cria√ß√£o de um objeto, neste caso, s√£o assim: </p><br><pre> <code class="plaintext hljs">import Something from 'path/to/source/with/something'; const something = new Something();</code> </pre> <br><h1 id="front--back-import">  Importa√ß√£o frontal e traseira </h1><br><p>  A importa√ß√£o funciona no navegador e no nodejs, mas h√° nuances.  Por exemplo, o navegador n√£o entende a importa√ß√£o dos m√≥dulos nodejs: </p><br><pre> <code class="plaintext hljs">import path from "path";</code> </pre> <br><p>  Ocorreu um erro no navegador: </p><br><pre> <code class="plaintext hljs">Failed to resolve module specifier "path". Relative references must start with either "/", "./", or "../".</code> </pre> <br><p>  Ou seja, se queremos que nosso c√≥digo funcione no navegador <strong>e no</strong> nodejs, n√£o podemos usar constru√ß√µes que o navegador <strong>ou o</strong> nodejs n√£o entendem.  Eu me concentro especificamente nisso, porque essa conclus√£o √© natural demais para pensar sobre isso.  Como respirar. </p><br><h1 id="mesto-di-v-sovremennyh-web-prilozheniyah">  O lugar da DI em aplica√ß√µes web modernas </h1><br><p>  Esta √© apenas a minha opini√£o pessoal, devido √† minha experi√™ncia pessoal, como tudo nesta publica√ß√£o. </p><br><p>  Em aplicativos da Web, o JS praticamente ocupa seu lugar na frente, no navegador, quase sem alternativa.  No lado do servidor, Java, PHP, .Net, Ruby, python, cavaram densamente ... Mas com o advento do nodejs, o JavaScript tamb√©m penetrou no servidor.  E as tecnologias usadas em outros idiomas, incluindo DI, come√ßaram a penetrar no JS do lado do servidor. </p><br><p>  O desenvolvimento do JavaScript √© devido ao comportamento ass√≠ncrono do c√≥digo no navegador.  A assincronia n√£o √© uma caracter√≠stica excepcional do JS, mas sim inata.  Agora, a presen√ßa de JS no servidor e na frente n√£o surpreende ningu√©m, mas incentiva o uso das mesmas abordagens nas duas extremidades do aplicativo da web.  E o mesmo c√≥digo.  Obviamente, a frente e a parte de tr√°s s√£o muito diferentes em ess√™ncia e nas tarefas a serem resolvidas para usar o mesmo c√≥digo l√° e ali.  Mas podemos assumir que em um aplicativo mais ou menos complexo haver√° navegador, servidor e c√≥digo geral. </p><br><p>  O DI j√° est√° em uso na frente, no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RequireJS</a> : </p><br><pre> <code class="plaintext hljs">define( ["./config", "./service"], function App(Config, Service) {} );</code> </pre> <br><p>  √â verdade que aqui os identificadores de depend√™ncias s√£o escritos expl√≠cita e imediatamente na forma de links para as fontes (voc√™ pode configurar o mapeamento de identificadores na configura√ß√£o do gerenciador de inicializa√ß√£o). </p><br><p>  Em aplicativos modernos da Web, o DI existe n√£o apenas no lado do servidor, mas tamb√©m no navegador. </p><br><h1 id="pri-chyom-tut-maykl-dzhekson">  O que Michael Jackson tem a ver com isso? </h1><br><p>  Quando voc√™ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ativa o</a> suporte ao m√≥dulo ES no nodejs (sinalizador <code>--experimental-modules</code> ), o mecanismo identifica o conte√∫do dos arquivos com a <code>*.mjs</code> como m√≥dulos EcmaScript (diferentemente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dos m√≥dulos comuns</a> com a <code>*.cjs</code> ). </p><br><p>  Essa abordagem √†s vezes √© chamada de " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Solu√ß√£o de Michael Jackson</a> " e os scripts s√£o chamados de scripts de Michael Jackson ( <code>*.mjs</code> ). </p><br><p>  Concordo que a intriga com o KDPV foi resolvida, mas ... o camon dos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">caras, Michael Jackson ...</a> </p><br><h1 id="yet-another-di-implementation">  Mais uma implementa√ß√£o de DI </h1><br><p>  Bem, como esperado, o seu pr√≥prio <del>  a bicicleta </del>  M√≥dulo DI - <a href="">@ teqfw / di</a> </p><br><p>  Esta n√£o √© uma solu√ß√£o pronta para o combate, mas uma implementa√ß√£o fundamental.  Todas as depend√™ncias devem ser m√≥dulos ES e usar recursos comuns para o navegador e o nodejs. </p><br><p>  Para resolver depend√™ncias, o m√≥dulo usa a abordagem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">awilix</a> : </p><br><pre> <code class="plaintext hljs">constructor(spec) { /** @type {Vendor_Module_Config} */ const _config = spec.Vendor_Module_Config; /** @type {Vendor_Module_Service} */ const _service = spec.Vendor_Module_Service; }</code> </pre> <br><p>  Para executar o exemplo anterior: </p><br><pre> <code class="plaintext hljs">import Container from "./src/Container.mjs"; const container = new Container(); container.addSourceMapping("Vendor_Module", "../example"); container.get("Vendor_Module_App") .then((app) =&gt; { app.run(); });</code> </pre> <br><p>  no servidor: </p><br><pre> <code class="plaintext hljs">$ node --experimental-modules main.mjs</code> </pre> <br><p>  Para executar o exemplo da frente ( <code>example.html</code> ): </p><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>DI in Browser<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"module"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"./main.mjs"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>Load main script './main.mjs', create new DI container, then get object by ID from container.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>Open browser console to see output.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  voc√™ precisa colocar o m√≥dulo no servidor e abrir a p√°gina <code>example.html</code> no navegador (ou usar os recursos do IDE).  Se voc√™ abrir <code>example.html</code> diretamente, o erro no Chrom √©: </p><br><pre> <code class="plaintext hljs">Access to script at 'file:///home/alex/work/teqfw.di/main.mjs' from origin 'null' has been blocked by CORS policy: Cross origin requests are only supported for protocol schemes: http, data, chrome, chrome-extension, https.</code> </pre> <br><p>  Se tudo correu bem, no console (navegador ou nodejs) haver√° algo como isto: </p><br><pre> <code class="plaintext hljs">Create object with ID 'Vendor_Module_App'. Create object with ID 'Vendor_Module_Config'. There is no dependency with id 'Vendor_Module_Config' yet. 'Vendor_Module_Config' instance is created. Create object with ID 'Vendor_Module_Service'. There is no dependency with id 'Vendor_Module_Service' yet. 'Vendor_Module_Service' instance is created (deps: [Vendor_Module_Config]). 'Vendor_Module_App' instance is created (deps: [Vendor_Module_Config, Vendor_Module_Service]). Application 'Vendor_Module_Config' is running.</code> </pre> <br><h1 id="rezyume">  Sum√°rio </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">AMD, CommonJS, UMD?</a> </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ESM</a> ! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt464347/">https://habr.com/ru/post/pt464347/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt464331/index.html">Benef√≠cios In√∫teis: S√≠ntese de Produtos Qu√≠micos Absorventes de UV a partir de Castanhas de Caju</a></li>
<li><a href="../pt464333/index.html">Acompanhamento do ciclo de vida dos usu√°rios sem alicate e fita isolante</a></li>
<li><a href="../pt464335/index.html">Testes de unidade no DBMS - como fazemos no Sportmaster, parte um</a></li>
<li><a href="../pt464337/index.html">Como ignorar o captcha: rede neural no Tensorflow, Keras, python v num√©rico noisy captcha</a></li>
<li><a href="../pt464345/index.html">5 raz√µes para abrir uma startup de TI na Alemanha</a></li>
<li><a href="../pt464351/index.html">C√¢meras IP PoE, requisitos especiais e opera√ß√£o sem problemas - reunindo tudo</a></li>
<li><a href="../pt464353/index.html">1C: ERP VS 1C: KA 2.0. O que os fabricantes de alimentos devem escolher?</a></li>
<li><a href="../pt464355/index.html">Como um quadro √© renderizado no Shadow Fight 3</a></li>
<li><a href="../pt464357/index.html">Blockchain aleat√≥rio da RSA</a></li>
<li><a href="../pt464359/index.html">Recursos de teste de aplicativos da Web m√≥veis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>