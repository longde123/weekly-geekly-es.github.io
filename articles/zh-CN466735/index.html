<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📑 🏷️ 🍯 在家庭自动化系统（“智能家居”）中创建语音警报的简便方法 🏓 👨🏻‍✈️ 🧓🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在测试了控制台SIP客户端Linphonec之后，我发现其中有一种简单快捷的方法可以用于家庭自动化系统的手机语音提示。 

 我认为这种方法适用于许多DIY家庭自动化系统，我会给出自己的版本。 

 我有一个安装在Raspberry Pi单板计算机（运行Raspbian（Debian 9））上的Ma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>在家庭自动化系统（“智能家居”）中创建语音警报的简便方法</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466735/"> 在测试了控制台SIP客户端Linphonec之后，我发现其中有一种简单快捷的方法可以用于家庭自动化系统的手机语音提示。 <br><br> 我认为这种方法适用于许多DIY家庭自动化系统，我会给出自己的版本。 <br><br> 我有一个安装在Raspberry Pi单板计算机（运行Raspbian（Debian 9））上的MajorDoMo智能家居自动化系统。 <br><br> 我们将创造从MajorDoMo通知到智能手机的可能性，而无需使用其他设备和VoIP服务器。 <br><br> 警报的简要原理：发生严重事故时（每个人都可以确定他们自己的事故清单），自动化系统将管理控制台VoIP客户端并通过SIP协议呼叫所有者，在响应之后它将播放先前记录的带有事故消息的声音文件。 <br><a name="habracut"></a><br> 首先，我们需要来自SIP提供商的两个帐户，这些帐户在网络内具有免费的入站/出站功能。 例如，使用Zadarma.com云电话服务。 <br><br> 第一步：我们在访问您的个人帐户和SIP帐户的同时向提供商注册。 我们可以向多个邮箱注册，但是可以补充帐户并获取其他号码。 无论如何，我们应该有2个数字（帐户）和一个密码。 <br><br> 在智能手机上（它在Androd OS上对我有效），我们从市场上安装了一个移动应用程序，任何SIP客户端都可以。 为了方便起见并最小化初始设置，我们可以将专有应用程序用于Zadarma调用，但我们可以提供更多功能。 <br> 安装后，我们通过输入您的号码和密码进行注册，从而完成了智能手机的设置。 因此，我们使用了一个数字。 <br><br> 在Raspberry Home Automation Server上，我们需要一个Linphonec SIP终端客户端。 从Raspbian存储库安装时，会安装较旧的3.6.1版本，该版本无法在ALSA声音系统上正常工作，但是由于不需要直接使用声音，因此让我们继续简单的方法。 <br><br>  <i>在上一篇文章中描述了安装没有用于Debian 9的图形界面的当前版本的Linphone软件包（3.12.0），我在上一篇文章中进行了介绍： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">DIY呼叫按钮。</a></i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Raspberry Pi，MajorDoMo，Freeswitch和Linphonec</a> 。</i>  <i>您可以在此处找到有关安装Raspberry Pi的USB声卡和声音设置的信息。</i> <br><br> 在终端中，执行以下命令： <br><br><pre><code class="plaintext hljs">sudo apt-get install linphone-nogtk</code> </pre> <br> 执行控制台客户端实用程序li​​nphonec和linphonecsh的安装-一个管理程序，用于管理在/ usr / bin目录中后台运行的linphonec。 <br> 让我们通过键入以下内容进行第一次运行： <br><br><pre> <code class="plaintext hljs">linphonec</code> </pre> <br> 我们启动它，SIP客户在ALSA发誓，我们对此并不关注。 <br><br> 我们在zadarma服务器上执行客户端注册命令（Linphonec），指定您的第二个数字和密码： <br><br><pre> <code class="plaintext hljs">register sip:xxxxxx@sip.zadarma.com sip.zadarma.com PASSWORD</code> </pre> <br> 如果输入正确，那么我们将看到有关成功注册的答案： <br><br><img src="https://habrastorage.org/webt/sd/jj/wc/sdjjwcmmgdfsfklr4flza5tcnp8.png" alt="图片"><br><br> 我们退出客户端（Ctrl + c，而客户端将设置保存到当前用户的.linphonerc文件中，在我的情况下为目录/ home / pi /。下一次SIP启动时，客户端会自动在提供程序的服务器上注册。 <br><br> 我们记录一条语音消息（例如：“系统的注意事项已重新启动，状态现在正在运行”： <br><br><pre> <code class="plaintext hljs">arecord -D plughw:1,0 -f cd /home/pi/alarm_restart.wav</code> </pre><br> 要在守护程序模式下运行和控制Linphonec，请使用Linphonecsh实用程序。 最初，在启动时，需要初始化linphonecsh -init客户端。 执行此命令后，控制台客户端将启动，而不会加载配置文件。 <br><br> 为了在启动时读取配置，请使用带有以下标志的运行： <br><br><pre> <code class="plaintext hljs"> linphonecsh init -c /home/pi/.linphonerc</code> </pre><br> 现在，我们可以从终端管理控制台客户端。 <br><br><div class="spoiler">  <b class="spoiler_title">Linphonecsh命令列表</b> <div class="spoiler_text"><pre> <code class="xml hljs">Usage: linphonecsh <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag">&gt;</span></span> [arguments] where action is one of init : spawn a linphonec daemon (first step to make other actions) followed by the arguments sent to linphonec generic : sends a generic command to the running linphonec daemon followed by the generic command surrounded by quotes, for example "call sip:joe@example.net" register : register; arguments are --host <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> --username <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">username</span></span></span><span class="hljs-tag">&gt;</span></span> --password <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span> unregister : unregister dial : dial <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sip</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uri</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">or</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">number</span></span></span><span class="hljs-tag">&gt;</span></span> status : can be 'status register', 'status autoanswer' or 'status hook' soundcard : can be 'soundcard capture', 'soundcard playback', 'soundcard ring', followed by an optional number representing the index of the soundcard, in which case the soundcard is set instead of just read. exit : make the linphonec daemon to exit.</code> </pre> <br><br></div></div><br> 让我们尝试以下命令： <br><br><pre> <code class="plaintext hljs">linphonecsh generic 'soundcard use files'</code> </pre> <br><pre> <code class="plaintext hljs">linphonecsh generic 'play alarm.wav'</code> </pre> <br><pre> <code class="plaintext hljs">linphonecsh dial sip:@sip.zadarma.com</code> </pre> <br>  Linphonec程序本身的团队是通用的。  XXXXXX是我们安装在智能手机上的SIP号码。 <br><br> 在这种情况下，接听电话时会发生呼叫-您可以意外听到以前录制的文件的播放。 <br><br> 手动工作。 例如，要与基于MajorDoMo的家庭自动化系统集成，请紧急重启服务器。 <br> 我们在crontab中编写以下行（在加载PC时，控制台客户端将加载： <br><br><pre> <code class="plaintext hljs">crontab -e</code> </pre> <br><pre> <code class="xml hljs">@reboot sudo -u pi linphonecsh init -c /home/pi/.linphonerc</code> </pre> <br> 接下来，转到DD系统的网页，转到“ <b>控制面板”-“脚本”-“事件”-“启动”。</b>  。 <br><br><img src="https://habrastorage.org/webt/3i/ui/ec/3iuiec-as4d75jtddxvsmdgbgme.png"><br><br> 脚本是用PHP编程语言实现的。 代码中已经有一行在启动系统时用服务器IP地址发音一个短语。 <br><br> 再添加一些： <br><br><pre> <code class="php hljs">exec (<span class="hljs-string"><span class="hljs-string">"sudo -u pi linphonecsh generic 'soundcard use files'"</span></span>);</code> </pre> <br><pre> <code class="php hljs">exec (<span class="hljs-string"><span class="hljs-string">"sudo -u pi linphonecsh generic 'play alarm.wav'"</span></span>);</code> </pre> <br><pre> <code class="php hljs">exec (<span class="hljs-string"><span class="hljs-string">"sudo -u pi linphonecsh dial sip:576935@sip.zadarma.com "</span></span>);</code> </pre> <br> 保存<i>后</i>安装<i>执行</i> ，保存，同时手机上有通话。 <br><br> 我们通过<b>Service-Reboot / shutdown</b>重新启动MajorDoMo系统。 <br> 重新启动后，语音通知会到达电话。 对于另一个对您至关重要的事故，可以执行相同的操作算法。 <br><br> 稍作更改后，您就可以在家庭自动化系统中安装自己的IP电话服务器（Asterisk，Freeswitch等），将VoIP网关连接到该网关，然后直接访问移动运营商或PSTN。 此选项功能更强大，功能更多，但还需要大量的材料和系统安装成本。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN466735/">https://habr.com/ru/post/zh-CN466735/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN466725/index.html">匕首2是基础（第1部分）</a></li>
<li><a href="../zh-CN466727/index.html">延迟升级：PostgreSQL 12如何提高性能</a></li>
<li><a href="../zh-CN466729/index.html">《数据挖掘》一书。 从Facebook，Twitter，LinkedIn，Instagram，GitHub检索信息»</a></li>
<li><a href="../zh-CN466731/index.html">盛会。 九月升起</a></li>
<li><a href="../zh-CN466733/index.html">欢迎来到9月18日的DINS Java EVENING</a></li>
<li><a href="../zh-CN466737/index.html">为什么Google+社交网络失败</a></li>
<li><a href="../zh-CN466739/index.html">最好是好人的敌人</a></li>
<li><a href="../zh-CN466741/index.html">最好是好人的敌人</a></li>
<li><a href="../zh-CN466745/index.html">第一个工作场所或如何开始在Node.js上开发API</a></li>
<li><a href="../zh-CN466747/index.html">Redmadrobot的Mitap iOS开发人员</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>