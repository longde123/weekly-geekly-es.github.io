<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌀 😍 🍁 Print Server Windows yang toleran 👗 👨🏾‍🤝‍👨🏼 ⏬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Admin sungguhan dapat tidur nyenyak hanya ketika semuanya dicadangkan, dipantau, dan digandakan. Atau ketika dia bekerja di tim yang baik, di mana And...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Print Server Windows yang toleran</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414369/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/7x/lk/zl/7xlkzlpjw2oft9qotypwjalwdmy.png"></a> <br>  Admin sungguhan dapat tidur nyenyak hanya ketika semuanya dicadangkan, dipantau, dan digandakan.  <s>Atau ketika dia bekerja di tim yang baik, di mana Anda selalu bisa menyalahkan orang lain.</s> <br>  Kebetulan saya terutama menggunakan produk Microsoft dalam pekerjaan saya dan saya dapat mengatakan bahwa perusahaan ini serius untuk membuat cadangan layanannya: Active Directory, Exchange DAG, SQL Always On, DFSR, dll.  Seperti di tempat lain, ada implementasi yang sangat elegan dan sukses, serta yang jelas tidak nyaman dan sulit.  Ada juga solusi untuk layanan cetak, tetapi membutuhkan pengelompokan berbasis Hyper-V.  Dan saya menginginkan solusi sederhana "out of the box", yang tidak memerlukan dana tambahan.  Windows 2012 R2 diambil sebagai dasar, tetapi kemungkinan besar skema yang sama akan bekerja tanpa masalah pada versi server apa pun dimulai dengan Windows 2008, dan bahkan sistem operasi klien dari Vista dan lebih tinggi (halo untuk penggemar menghemat anggaran!).  Siapa yang peduli - saya minta kucing. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Penafian</b> <div class="spoiler_text">  <s>Untuk menghormati karya orang India</s> , karena pemirsa Habr terutama berbahasa Rusia dan untuk memudahkan administrator pemula, contoh-contohnya menggunakan antarmuka Windows versi Rusia.  Tautan, jika memungkinkan, juga mengarah ke sumber daya berbahasa Rusia. <br></div></div><br><br><h2>  Sedikit teori </h2><br>  Siapa pun yang tidak suka teori dan ingin mengklik lebih cepat dengan mouse dan keyboard dapat langsung ke bagian selanjutnya. <br>  Seperti disebutkan di atas, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">rekomendasi resmi</a> hari ini adalah solusi menggunakan pengelompokan dan virtualisasi Hyper-V.  Juga, tidak ada yang mencegah toleransi kesalahan layanan cetak pada tingkat sistem virtualisasi, dan tidak harus Hyper-V, tetapi solusi semacam itu membutuhkan biaya. <br>  Saya benar-benar menginginkan sesuatu yang mirip dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">DHCP Failover</a> , tetapi untuk peran server cetak. <br>  Tidak ada yang cocok ditemukan di Internet secara umum dan pada Habr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pada khususnya</a> - dan saya harus menciptakannya sendiri. <br><br>  <b>Esensi gagasan dalam satu paragraf</b> <br>  Solusi yang dijelaskan di bawah ini didasarkan pada utilitas BrintBrm, yang merupakan bagian dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">distribusi</a> Windows standar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dan telah datang untuk menggantikan printmig</a> . <br>  Server siaga bekerja dalam mode siaga dan menyinkronkan pengaturan dengan server utama dengan frekuensi yang ditentukan menggunakan utilitas ini.  Untuk klien, CNAME dengan TTL kecil dibuat dalam DNS, merujuk server utama.  Jika terjadi kegagalan pada server utama, administrator memperbaiki CNAME dengan mengalihkan klien ke server cadangan.  Faktanya, itu saja. <br>  Jika topiknya menarik dan saya ingin berkenalan dengan benjolan-benjolan yang sudah diisi dengan saya dan cara-cara untuk memotong penggaruk, silakan ikuti berikutnya. <br><br><h2>  Sebelum Anda mulai, atau apa yang perlu Anda ketahui tentang PrintBrm </h2><br>  Jadi, apa itu, utilitas PrintBrm ini, yang tujuan utamanya adalah melayani server cetak? <br><ul><li>  Terawat dengan baik.  Ini memiliki implementasi GUI yang disebut <i>Print Migration</i> dan dapat diluncurkan dari snap-in <i>Print Management</i> .  Versi GUI kurang fungsional dan memiliki masalah dengan port porting. </li><li>  Penuh perhatian  Secara default, ini menangani ACL printer dari server cetak.  Dengan kata lain, jika Anda mengizinkan pencetakan ke printer \\ printserver \ printer1 hanya untuk karyawan yang merupakan anggota grup AD <i>Akuntansi</i> , maka pembatasan ini akan diperhitungkan untuk impor / ekspor.  Atau tidak, jika Anda memasukkan kunci <i>-NOACL</i> .  Namun, ACL dari server cetak itu sendiri tidak diproses terlepas dari tombol apa. </li><li>  Moody.  Pada saat mengimpor parameter dari file, server target harus memiliki setidaknya satu printer yang dipakai bersama, jika tidak, Anda akan mendapatkan kesalahan. </li><li>  Lembut.  Kehilangan ruang melihat di jalur file.  Saat melihat tanda kutip membingkai jalan seperti itu, dia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kesal</a> dan memberikan kesalahan 0x8007007b. </li><li>  Sederhana  Jika file yang ditentukan sudah ada saat mencoba untuk mengekspor pengaturan, itu tidak dapat menimpanya, ia malu untuk bertanya dan juga diakhiri dengan kesalahan. </li><li>  Misterius.  Selalu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mengembalikan kode keluar 0</a> .  Ternyata, program yang sempurna. <br></li><li>  Apt untuk berpikir.  Dapat membeku pada tahap 100% menit selama 5, dan kadang-kadang lebih.  Tapi kemudian dia berpikir dan menyelesaikan pekerjaannya (kecuali, tentu saja, Anda memiliki kesabaran untuk tidak menekan Ctrl + C). </li><li>  Tiba-tiba dan saling bertentangan.  Dapat mengatur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kejutan seperti itu</a> . </li><li>  Pintar  Dapat menugaskan kembali driver sumber ke orang lain.  Misalnya, menggunakan file XML, Anda dapat menentukan bahwa semua driver HP Universal Printing PCL 5 dalam file yang disimpan di server tujuan harus dipindahkan ke HP Universal Printing PCL 6. Saya belum menggunakannya dalam praktiknya, tetapi ini dapat berguna bagi seseorang. </li><li>  Tidak patuh.  Saya tidak bisa menggunakannya untuk mentransfer pengaturan antara domain tanpa kepercayaan, bahkan dengan saklar -NOACL.  Entah dia tidak bisa melakukannya secara prinsip, atau sihirku tidak cukup kuat. </li><li>  Anda bisa mengenal lebih baik di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> dan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> , tetapi bagi mereka yang berani yang tidak ragu untuk bertanya langsung, ada kunci /? <br></li></ul><br><br>  Saya akui bahwa beberapa fitur yang tidak saya abaikan.  Mungkin di Windows 10/2016 dia mulai berperilaku berbeda.  Jika ada informasi, silakan bagikan. <br><br><h2>  Persiapan lingkungan </h2><br>  Diasumsikan bahwa Anda telah menggunakan Active Directory dan Anda tahu setidaknya 3 cara untuk menonaktifkannya dan setidaknya 2 dari mereka telah diuji dalam praktik. <br><br><div class="spoiler">  <b class="spoiler_title">Beberapa lirik</b> <div class="spoiler_text">  Berangkat dari topik artikel, saya perhatikan bahwa saya suka pesanannya, dan saya yakin bahwa setiap printer jaringan dan MFP memiliki stiker yang sesuai dengan nama jaringannya.  Ini menyederhanakan pekerjaan karyawan TI ketika mereka mencoba mencari tahu dari pengguna yang laporan analitik penting printer <s>foto</s> kucing dicetak dalam nada asam toksik daripada yang pistachio halus.  <s>Lebih baik menempelkan stiker semacam itu di bagian bawah printer, sehingga semua orang akan lebih tertarik dan lebih menyenangkan.</s> <br>  Saya juga suka ketika setiap printer jaringan terdaftar di zona DNS internal.  Server DHCP berbasis Windows <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dapat dengan mudah melakukan</a> ini. <br>  Misalnya, nama printer bisa dalam format msk-prn001 atau sale-printer023, dan nama port untuk printer ini di server cetak dinamai sama persis.  Tapi ini preferensi pribadi saya, saya siap mendengar keberatan dalam komentar. <br></div></div><br>  Kami akan menganggap bahwa semua printer berjaringan dan tersedia untuk dicetak dari server cetak utama dan cadangan.  Biarkan server ini disebut masing <i>-</i> masing <i>prn-srv01</i> dan <i>prn-srv02</i> . <br>  Server domain pada Windows Server tidak lebih rendah dari 2008 cocok sebagai server cetak. Pada prinsipnya, OS klien yang dimulai dengan Vista juga cocok, jika Anda benar-benar ingin menghemat uang.  Contohnya menggunakan Windows 2012 R2.  Sangat disarankan untuk menginstal semua pembaruan yang diperlukan dari sistem operasi sebelum menyiapkan server dan mesin klien. <br><br>  Anda sendiri, tentu saja, mengerti, tetapi batasannya masih membutuhkan perhatian: jika server cetak virtual, maka mereka harus didistribusikan ke server fisik yang berbeda, jika tidak, failover kita akan berubah menjadi gagal. <br><br>  Pada <i>prn-srv01</i> dan <i>prn-srv02</i> , peran server cetak harus ditambahkan.  Lebih nyaman bagi saya untuk menggunakan cmdlet PowerShell: <br> <code>Install-WindowsFeature Print-Services</code> <br> <br>  Juga, tweak registri harus diterapkan pada server cetak, yang memperbaiki <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kesalahan 0 × 00000709</a> ketika mesin klien mengakses server cetak melalui CNAME.  Anda dapat melakukan ini dengan perintah dari artikel di tautan di atas: <br> <code>reg add HKLM\SYSTEM\CurrentControlSet\Control\Print /v DnsOnWire /t REG_DWORD /d 1</code> <br>  Setelah menerapkan perintah, Anda harus memulai kembali layanan <i>Print Manager</i> . <br>  Saya sarankan Anda mengalokasikan OU terpisah untuk server cetak dan mendistribusikan pengaturan ini <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menggunakan GPP</a> . <br><br>  Kami memulai snap-in DNS pada pengontrol domain dan mengaktifkan tampilan yang diperluas: <br><div class="spoiler">  <b class="spoiler_title">klik</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/t_/sg/w1/t_sgw1pf6fazbhihj-4yjxzivfc.png"><br></div></div><br>  Pemetaan lanjutan diperlukan untuk dapat mengatur TTL untuk catatan yang dibuat. <br>  Di DNS, buat catatan <i>cetak</i> CNAME yang merujuk <i>prn-srv01</i> dengan nilai TTL 5 menit: <br><div class="spoiler">  <b class="spoiler_title">klik</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/bx/oe/0y/bxoe0yjyj5pmar4utycfqjfnnba.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">klik</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/w_/tz/dj/w_tzdj66enutsmeuw5wwajzmrww.png"><br></div></div><br>  Nama ini harus digunakan oleh mesin klien untuk terhubung ke server cetak.  Yaitu  klien akan terhubung ke alamat \\ print \ printer01, \\ print \ printer02, dll. <br>  Semakin rendah nilai TTL, semakin sering klien memperbarui catatan dan semakin cepat “memahami” bahwa mereka perlu beralih ke server cetak lain.  5 menit sudah cukup untukku. <br>  Dengan menetapkan nilai terlalu rendah, Anda menghasilkan lalu lintas DNS di jaringan Anda, <s>dan dengan menentukan satu atau dua jam, Anda menekankan toleransi stres dan saraf yang kuat</s> . <br>  Cara alternatif untuk menambahkan catatan CNAME menggunakan PowerShell: <br> <code>Import-Module DnsServer <br> Add-DnsServerResourceRecordCName -Name "print" -HostNameAlias "prn-srv01.lab.net" -ZoneName "lab.net" -TimeToLive 00:05:00 <br></code> <br>  (Tentu saja, kami mengubah lab.net ke contoso.local Anda atau apa pun itu) <br><br>  Perlu diingat bahwa jika Anda memiliki beberapa situs AD, memperbarui catatan DNS di semua lokasi akan memakan waktu lebih lama karena replikasi lintas-situs.  Anda dapat memaksa proses dengan perintah <i>repadmin / syncall</i> . <br><br>  Menggunakan Kebijakan Grup, kami mengizinkan pengguna biasa untuk menginstal driver dari server cetak.  Cara melakukan ini dijelaskan secara rinci di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Buat akun layanan dalam AD (Saya menamakannya svc-printsync) dengan kedaluwarsa kata sandi tak terbatas: <br><div class="spoiler">  <b class="spoiler_title">klik</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/aw/b8/-i/awb8-irvpqwtgz7_hqh5zziclxu.png"><br></div></div><br>  Menurut persyaratan PrintBrm, akun ini harus memiliki hak penuh pada server cetak, jadi kami menambahkannya ke <s>domain admin sehingga semuanya berfungsi dengan pasti dan kami menulis kata sandi di bidang deskripsi agar tidak melupakan</s> grup <i>Administrator</i> lokal di <i>prn-srv01</i> dan <i>prn-srv02</i> ( misalnya, menggunakan snap- <i>in Manajemen Komputer</i> ). <br><br><h2>  Konfigurasikan server pertama </h2><br>  Jika semua printer yang diperlukan pada printer utama telah ditambahkan, maka Anda dapat langsung melanjutkan ke bagian mengkonfigurasi server kedua. <br><br>  Menggunakan snap-in <i>Print Management</i> , kami menambahkan driver untuk printer yang diperlukan ke server: <br><div class="spoiler">  <b class="spoiler_title">klik</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/c0/_b/fl/c0_bflidme6egcqqpjsu8fmhkay.png"><br></div></div><br>  Wisaya instalasi driver diluncurkan.  Ini intuitif, Anda bisa mengetahuinya sendiri.  Saya hanya akan memperhatikan momen dengan kedalaman sedikit. <br>  Karena  Karena Windows 2012R2 hanya tersedia dalam versi x64, drivernya juga harus x64.  Jika klien dengan versi Windows x86 akan terhubung ke server cetak, jangan lupa untuk mencentang kotak yang sesuai: <br><div class="spoiler">  <b class="spoiler_title">klik</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/kk/1r/be/kk1rbe46et1lxpumhlwjt4dgqvu.png"><br></div></div><br>  Beberapa kit driver berisi inf-file umum untuk sistem x86 dan x64, sementara yang lain memiliki pemisahan. <br><br><div class="spoiler">  <b class="spoiler_title">Beberapa lirik lagi</b> <div class="spoiler_text">  Banyak driver datang dalam bentuk installer, tetapi mengingat bahwa installer ini menempatkan banyak sampah bersama dengan driver, saya mencoba mengikuti prinsip "perlu dan cukup" dan menambahkan driver secara manual, seperti dijelaskan di atas. <br>  Juga, demi konsistensi, saya berusaha keras untuk menggunakan driver versi Universal secara maksimal (hampir semua vendor normal memilikinya).  Namun terkadang itu bisa menjadi masalah.  Jadi, begitu saya bertemu bug di salah satu versi HP Universal Printing PCL 6, di mana dokumen PDF melalui EasyPrint dalam sesi RDP dicetak mirror-to-left dari kanan ke kanan. <br>  Anda juga dapat melihat ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">driver v4</a> . <br></div></div><br><br>  Ketika semua driver yang diperlukan ditambahkan, kami akan berurusan dengan port dan printer.  Anda bisa menambahkannya secara manual dari snap-in yang sama, tetapi saya sarankan membuat file CSV di Excel dan mengumpankannya ke skrip PowerShell.  Tentu saja, tidak ada yang mencegah Excel menggunakan editor spreadsheet atau notepad lainnya secara umum.  Hal utama adalah bahwa pemisah dan pengkodean yang ditentukan dalam skrip sesuai dengan pemisah dan pengkodean dalam file CSV. <br>  Perhatikan juga bahwa nama driver dalam file CSV harus persis sama dengan yang ditentukan dalam snap-in <i>Manajemen</i> Cetak. <br><div class="spoiler">  <b class="spoiler_title">Salin-tempel ke penyelamatan</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/lt/-u/k3/lt-uk31frw4ashg6sqfxptrx6us.png"><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Contoh file CSV</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/f9/wp/cj/f9wpcjsmlydppavwxh9ed4bn51m.png"><br></div></div><br><br>  Meskipun saya menulis di atas bahwa saya suka ketika semua printer memiliki nama jaringan yang disatukan, contoh (bidang <i>alamat printer</i> ) menggunakan vinaigrette alamat IP dan nama jika Anda <s>tidak</s> memiliki pesanan di jaringan Anda beberapa saat kemudian. <br><br>  Simpan tabel ini dalam format CSV: <br><div class="spoiler">  <b class="spoiler_title">klik</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/1e/qq/4i/1eqq4iw3hfbsjfge8mcetyerlfg.png"><br>  <i><b>Catatan</b></i>  <i>Terlepas dari kenyataan bahwa koma diindikasikan sebagai pemisah di bidang "Jenis file", Excel telah membuat tanda titik koma sebagai pemisah.</i>  <i>Mungkin menjadi lebih menarik dan lebih menyenangkan.</i> <br></div></div><br>  Dan ini skripnya sendiri: <br><div class="spoiler">  <b class="spoiler_title">BuatPrintersFromCsv.ps1</b> <div class="spoiler_text"><pre> <code class="hljs mel">#    $InputFile = <span class="hljs-string"><span class="hljs-string">'C:\Scripts\Printers.csv'</span></span> #      CSV- $Printers = (Import-Csv $InputFile -Delimiter <span class="hljs-string"><span class="hljs-string">";"</span></span> -Encoding Default) #          ForEach ($Printer <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $Printers) { #       $PrinterName = $Printer.<span class="hljs-string"><span class="hljs-string">' '</span></span> $ShareName = $Printer.<span class="hljs-string"><span class="hljs-string">'  '</span></span> $DriverName = $Printer.<span class="hljs-string"><span class="hljs-string">' '</span></span> $PrinterAddr = $Printer.<span class="hljs-string"><span class="hljs-string">' '</span></span> $Comment = $Printer.<span class="hljs-string"><span class="hljs-string">''</span></span> $Location = $Printer.<span class="hljs-string"><span class="hljs-string">''</span></span> #  Add-PrinterPort -Name $PrinterAddr -PrinterHostAddress $PrinterAddr -SNMP <span class="hljs-number"><span class="hljs-number">1</span></span> -SNMPCommunity <span class="hljs-string"><span class="hljs-string">'public'</span></span> #  Add-Printer -Name $PrinterName -DriverName $DriverName -PortName $PrinterAddr -Comment $Comment -Location $Location #   Set-Printer -Name $PrinterName -Shared $True -Published $False -ShareName $ShareName }</code> </pre><br></div></div><br>  Jika karakter tab digunakan sebagai pembatas di CSV Anda, maka dalam skrip Anda perlu mengatur <i>-Delimiter "` t "</i> <br><br>  Harap dicatat bahwa jika printer tidak tersedia dari server saat skrip berjalan, menambahkannya ke server cetak akan lebih lama (2-3 menit, bukan beberapa detik) <br><br>  Hasil skrip: <br><div class="spoiler">  <b class="spoiler_title">klik</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/fj/jd/-t/fjjd-tcfaowketxq9u7av7yzfzk.png"><br></div></div><br><br>  Untuk memastikan bahwa semuanya berfungsi pada tahap ini, tambahkan printer bersama ke salah satu mesin klien dari server cetak utama menggunakan CNAME yang dibuat sebelumnya (misalnya, \\ print \ printer01), dan cobalah untuk mencetak sesuatu di atasnya.  <s>Untuk tujuan ini, frasa "Preved, I am a secarik kertas", diketik dalam huruf tebal Arial dengan ukuran ke-200, paling cocok untuk tujuan ini.</s> <br><br><h2>  Konfigurasikan server kedua </h2><br><blockquote>  Un artista copia, un gran artista roba (Pablo Picasso) </blockquote><br>  <i>Prn-srv02 kami</i> belum mencapai level gran artista, jadi kami akan membatasi diri untuk menyalin.  <s>Meskipun ... itu mungkin dengan gerakan pergelangan tangan ...</s> <br><br>  Kami membuat dan membagikan setidaknya satu printer, jika tidak PrintBrm akan memberikan kesalahan.  Anda dapat membuat palsu, tetapi penting untuk tidak memilih driver atau port yang salah.  Misalnya, printer dengan driver Microsoft XPS Document Writer atau port FILE tidak dapat dibagikan. <br><br>  Kami membuat skrip sinkronisasi sederhana.  Saya lebih suka PowerShell, tetapi tidak ada yang melarang membuat file batch tabung hangat. <br><br><div class="spoiler">  <b class="spoiler_title">PrintSync.ps1</b> <div class="spoiler_text"><pre> <code class="hljs mel">#   PrintBrm $ProgramPath = <span class="hljs-string"><span class="hljs-string">'C:\Windows\System32\Spool\Tools\PrintBrm.exe'</span></span> #    $SourceServer = <span class="hljs-string"><span class="hljs-string">'prn-srv01'</span></span> $DestServer = <span class="hljs-string"><span class="hljs-string">'prn-srv02'</span></span> #,   .     , ..  PrintBrm       $ConfigFilePath = <span class="hljs-string"><span class="hljs-string">'C:\Scripts\prn-config.printerExport'</span></span> #    $Arguments = <span class="hljs-string"><span class="hljs-string">"-s $SourceServer -f $ConfigFilePath -b"</span></span> Start-process $ProgramPath -ArgumentList $Arguments -Wait -PassThru #    $Arguments = <span class="hljs-string"><span class="hljs-string">"-s $DestServer -f $ConfigFilePath -r -o force"</span></span> Start-process $ProgramPath -ArgumentList $Arguments -Wait -PassThru #   Del $ConfigFilePath</code> </pre><br></div></div><br><br>  Kami menempatkan skrip di tempat terpencil (dalam contoh <i>skrip</i> adalah <i>C: \ Script</i> ) dan membuat tugas di Penjadwal. <br>  Kami akan lari dari akun svc-printsync yang sebelumnya dibuat dengan izin tertinggi: <br><div class="spoiler">  <b class="spoiler_title">klik</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/sp/ax/9w/spax9w_u6llu5ekhxh6ezfq8zdi.png"><br></div></div><br>  Tentukan frekuensi eksekusi untuk Anda sendiri.  Cukup untuk saya sekali sehari: <br><div class="spoiler">  <b class="spoiler_title">klik</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/m8/a5/hm/m8a5hm3qm5dosyvvd8uivsrdeaq.png"><br></div></div><br>  Pada tab Tindakan, buat tindakan peluncuran PowerShell baru: <br> <code>C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</code> <br>  Sebagai argumen, kami menetapkan jalur ke skrip dengan parameter berikut: <br> <code>C:\Scripts\PrintSync.ps1 -NonInteractive -WindowStyle Hidden -ExecutionPolicy Bypass</code> <br> <div class="spoiler">  <b class="spoiler_title">klik</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/c2/dw/zi/c2dwzipe2ifr6vstp2qgpvr-cc4.png"><br></div></div><br>  Kami membiarkan parameter tugas lainnya pada tab <i>Kondisi</i> dan <i>Parameter</i> secara default. <br>  Saat menyimpan tugas, kata sandi akan diminta untuk <i>akun svc-printsync</i> .  Anda tidak melupakannya?  Jika Anda sudah lupa (artikelnya panjang), maka <s>semuanya dilakukan dengan sia-sia dan hidup tidak berhasil.Reset</s> ulang menggunakan ADUC snap-in atau dengan cara lain yang mudah <s>dan tentukan itu sudah di bidang deskripsi untuk membuatnya lebih tenang</s> . <br><br><div class="spoiler">  <b class="spoiler_title">Catatan</b> <div class="spoiler_text">  Pekerjaan tidak harus dijalankan pada server cetak cadangan.  Jika Anda memiliki server terpisah untuk menjalankan rutinitas, Anda dapat membuat tugas di atasnya.  Dalam hal ini, <i>akun svc-printsync</i> harus memiliki hak untuk masuk sebagai pekerjaan batch di server ini.  Secara default, grup <i>Operator Cadangan</i> lokal memiliki hak ini, dan jika ini tidak diubah di lingkungan Anda, maka cukup sertakan akun layanan dalam grup operator arsip server di mana tugas akan dijalankan. <br></div></div><br><br>  Untuk pertama kalinya, kami memulai tugas secara manual dan menunggu penyelesaiannya. <br>  Untuk kebun binatang saya, di mana ada sekitar 50 printer dari berbagai jenis, baik yang terancam punah maupun yang baru saja dibesarkan, prosedur sinkronisasi membutuhkan waktu sekitar 10 menit.  File pada saat yang sama memiliki berat hampir 1GB. <br>  Untuk mempercepat proses impor / ekspor, Anda dapat menggunakan <i>sakelar -NOBIN</i> , yang bertanggung jawab untuk menyalin driver.  Masuk akal ketika armada printer terdiri dari model yang sama dan driver yang diperlukan diinstal pada semua server. <br><br>  Setelah selesai, jalankan snap- <i>in Peraga Peristiwa</i> , buka bagian <i>Aplikasi dan Log Layanan</i> , buka <i>log</i> <i>Microsoft \ Microsoft \ PrintBRM \ Administrator</i> dan analisis untuk kesalahan dan peringatan.  <s>Dan jika jumlahnya terlalu banyak, maka kita cenderung membersihkan majalah agar mata kita tidak kalus.</s> <br><br>  Saya menemukan kode 20, 22, 80 dan 81. Misalnya, <br><div class="spoiler">  <b class="spoiler_title">seperti itu</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/be/sx/7u/besx7uy6lxapuzrxj3_mrsg9agc.png"><br></div></div><br>  Seperti yang jelas dari teks, ada masalah dalam mentransfer driver tertentu.  Melihat melalui log, kami membuat daftar driver yang bermasalah dan meletakkannya di server cadangan dengan tangan kami, atau menggantinya dengan yang lain yang tidak suka bepergian.  Saya hanya memiliki masalah dengan HP, Kyocera dan Konica Minolta, tidak ada kesalahan yang terdeteksi untuk driver dari produsen lain (mungkin karena mereka lebih baik, atau mungkin karena kami tidak memilikinya). <br>  Akibatnya, Anda harus mencapai daftar printer yang sama di server utama dan cadangan dan tidak ada kesalahan dan peringatan di log. <br><br><h2>  Beralih ke cadangan </h2><br>  <s>Di bawah ketukan kapak dan gerinda garpu, kami membarikade pintu kantor kami dan mematikan telepon.</s>  Jalankan snap-in DNS dan edit data CNAME sehingga mengarah ke server cadangan: <br><div class="spoiler">  <b class="spoiler_title">klik</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/3n/kh/p5/3nkhp5g6apvxj1ejoheth9hlcfu.png"><br></div></div><br>  Setelah beberapa saat (apa yang Anda masukkan ke TTL di sana?), <s>Teriakan mengancam akan mereda,</s> mesin klien akan beralih ke prn-srv02 <s>dan pintu dengan telepon dapat dibuka</s> . <br><br><h2>  Kembali </h2><br>  Jika selama pemulihan server utama pada cadangan ada perubahan konfigurasi yang perlu disimpan, kami mulai sinkronisasi ke arah yang berlawanan.  Untuk melakukan ini, dalam skrip <i>PrintSync.ps1 di</i> atas <i>,</i> kita menukar nilai variabel <i>$ SourceServer</i> dan <i>$ DestServer</i> .  Setelah mentransfer perubahan, jangan lupa untuk mengembalikan nilai-nilai ini kembali, jika tidak semua perubahan dalam konfigurasi printer pada <i>prn-srv01</i> tanpa ampun akan <i>disapu</i> setiap malam oleh kehendak jahat nasib. <br>  Dalam snap-in DNS, atur <i>cetak</i> ke catatan CNAME dengan nilai node akhir prn-srv01 - dan semuanya kembali ke titik awal. <br><br><h2>  Apa hasilnya? </h2><br>  Tepuk tangan meriah dari pimpinan, melemparkan admin di lengannya, menaikkan gaji (ke penulis artikel - jujur ​​10% dari kenaikan) ... <br>  Nah, beberapa pemikiran ke arah bimbingan kecantikan lebih lanjut. <br><br>  Sayangnya, tidak ada cukup mukjizat untuk semua orang, dan solusi ini bukan kegagalan total.  Jika pada saat runtuhnya server cetak utama ada antrian cetak tidak kosong di atasnya, maka isinya kemungkinan besar akan menghilang ke udara dan seseorang harus mengulangi mengirimnya untuk dicetak. <br><br>  Tetapi akan sangat nyaman bagi pengguna untuk melakukan pemeliharaan rutin server cetak secara transparan. <br><div class="spoiler">  <b class="spoiler_title">Anda mengikuti rekomendasi Microsoft?</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/s9/dr/bm/s9drbmkdazxkxaswuw4flitnsoi.jpeg"><br></div></div><br><br>  Penggemar otomasi dapat melangkah lebih jauh dan membuat skrip yang menerima nama server dengan interval sinkronisasi pada input dan melakukan sisa pengaturan itu sendiri: membuat akun layanan jika perlu, tugas dalam penjadwal, dll. <br><br>  Pemantauan guru akan menambah pemantauan tugas sinkronisasi dan kesalahan dalam log. <br><br>  Pecinta menggali lebih dalam dapat memikirkan sinkronisasi dua arah dalam semangat replikasi AD dengan perubahan pelacakan waktu untuk setiap printer.  PrintBrm tidak akan membantu di sini, tetapi tidak ada yang membatalkan PowerShell! <br><br>  Ceri pada kue akan menjadi instalasi otomatis printer pada mesin klien menggunakan GPP, menargetkan grup AD.  Tambahkan pengguna ke grup - dan printer yang diinginkan terbang kepadanya.  Benar, ini adalah kisah lain yang melampaui ruang lingkup artikel. <br><br>  Saya berharap bagi seseorang publikasi saya akan bermanfaat.  Saya berharap semua orang tidak mengalami gangguan dan menantikan pertanyaan dan saran di komentar. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id414369/">https://habr.com/ru/post/id414369/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id414357/index.html">Kami menggunakan Web Bluetooth API untuk menghubungkan monitor detak jantung dan mengembangkan aplikasi menggunakan Vue.js</a></li>
<li><a href="../id414359/index.html">Interaksi dengan server melalui API di iOS pada Swift 3. Bagian 1</a></li>
<li><a href="../id414361/index.html">Unity3D: Arsitektur Game, ScriptableObjects, Singletones</a></li>
<li><a href="../id414363/index.html">Intisari bahan-bahan segar dari dunia front-end untuk minggu terakhir No. 319 (11-17 Juni 2018)</a></li>
<li><a href="../id414367/index.html">Berderap dalam tiga tahun: apa yang menarik untuk dibaca kembali di blog HashFlare</a></li>
<li><a href="../id414371/index.html">Kelas sekolah dan sketsa kecil rekayasa sosial</a></li>
<li><a href="../id414373/index.html">Desain async / menunggu JavaScript: kekuatan, jebakan, dan pola penggunaan</a></li>
<li><a href="../id414375/index.html">Perintah untuk bekerja dengan konsol JavaScript di browser dan meningkatkan produktivitas programmer</a></li>
<li><a href="../id414377/index.html">Inovasi literal objek dalam JavaScript ES6</a></li>
<li><a href="../id414379/index.html">"Mereka yang bersedia bertukar kebebasan untuk keamanan tidak layak dengan kebebasan atau keamanan" (sumber asli)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>