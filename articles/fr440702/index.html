<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèúÔ∏è üïâÔ∏è üë©üèª‚Äçüè≠ Attention - GAZ! ou comment nous avons fait des contrats intelligents non gaz√©ifi√©s üë©üèΩ‚Äç‚öïÔ∏è üìÉ üóûÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La blockchain et les contrats intelligents sont toujours un sujet br√ªlant chez les d√©veloppeurs et les techniciens. Il y a beaucoup de recherches et d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Attention - GAZ! ou comment nous avons fait des contrats intelligents non gaz√©ifi√©s</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/waves/blog/440702/"><p><img src="https://habrastorage.org/webt/ps/lh/d4/pslhd4hgoxgjskexszwtn40mivo.png"></p><br><p>  La blockchain et les contrats intelligents sont toujours un sujet br√ªlant chez les d√©veloppeurs et les techniciens.  Il y a beaucoup de recherches et de discussions sur leur avenir et o√π tout va et o√π cela m√®nera.  Chez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Waves Platform,</a> nous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">avons</a> notre propre opinion sur ce que devraient √™tre les contrats intelligents, et dans cet article, je vous dirai comment nous les avons fait, quels probl√®mes nous avons rencontr√©s et pourquoi ils ne sont pas comme les contrats intelligents d'autres projets de blockchain (tout d'abord Ethereum). </p><br><p>  Cet article est √©galement un guide pour ceux qui veulent comprendre le fonctionnement des contrats intelligents dans le r√©seau Waves, essayer d'√©crire votre propre contrat et vous familiariser avec les outils dont les d√©veloppeurs disposent d√©j√†. </p><a name="habracut"></a><br><h2 id="kak-my-doshli-do-zhizni-takoy">  Comment en sommes-nous arriv√©s √† une telle vie? </h2><br><p>  On nous a souvent demand√© quand avons-nous obtenu des contrats intelligents, car les d√©veloppeurs ont appr√©ci√© la facilit√© de travailler avec le r√©seau, la vitesse du r√©seau (gr√¢ce √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Waves NG</a> ) et le faible niveau de commissions.  Cependant, les contrats intelligents offrent beaucoup plus de place √† l'imagination. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les contrats intelligents</a> sont devenus tr√®s populaires ces derni√®res ann√©es en raison de la propagation de la blockchain.  Ceux qui ont rencontr√© la technologie blockchain dans leur travail, lorsqu'ils mentionnent les contrats intelligents, pensent g√©n√©ralement √† Ethereum et Solidity.  Mais il existe de nombreuses plates-formes blockchain avec des contrats intelligents, et la plupart d'entre elles ont simplement r√©p√©t√© ce qu'Ethereum a fait (machine virtuelle + leur propre langage de contrat).  Une liste int√©ressante avec diff√©rentes langues et approches se trouve dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ce r√©f√©rentiel</a> . </p><br><h2 id="chto-takoe-smart-kontrakt">  Qu'est-ce qu'un contrat intelligent? </h2><br><p>  Au sens large, un contrat intelligent est un protocole con√ßu pour soutenir, v√©rifier et faire respecter les termes d'une transaction ou l'ex√©cution de contrats entre des parties.  L'id√©e a √©t√© propos√©e pour la premi√®re fois en 1996 par Nick Szabo, mais les contrats intelligents ne sont devenus populaires que ces derni√®res ann√©es. </p><br><p>  D'un point de vue technique (qui nous int√©resse davantage), un contrat intelligent est un algorithme (code) qui est ex√©cut√© non pas sur un seul serveur ou ordinateur, mais sur de nombreux (ou tous) n≈ìuds du r√©seau de la blockchain, c'est-√†-dire  d√©centralis√©. </p><br><h2 id="kak-eto-rabotaet">  Comment √ßa marche? </h2><br><p>  Le premier prototype d'un contrat intelligent sur la blockchain est correctement consid√©r√© comme un script Bitcoin - incomplet par Turing, un langage bas√© sur la pile sur le r√©seau Bitcoin.  Il n'y a pas de concept de compte dans Bitcoin, mais des entr√©es et des sorties.  Dans Bitcoin, lors d'une transaction (cr√©ation d'une sortie), il est n√©cessaire de se r√©f√©rer √† la transaction de r√©ception (entr√©e).  Si vous √™tes int√©ress√© par les d√©tails techniques de l'appareil Bitcoin, je vous recommande de lire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cette s√©rie d'articles</a> .  Puisqu'il n'y a pas de compte dans Bitcoin, Bitcoin Script d√©termine dans quel cas l'une ou l'autre sortie peut √™tre d√©pens√©e. </p><br><p> Ethereum offre beaucoup plus de fonctionnalit√©s, comme  Fournit Solidity, un langage complet de Turing qui s'ex√©cute dans une machine virtuelle √† l'int√©rieur de chaque n≈ìud.  Une grande puissance s'accompagne d'une grande responsabilit√© et d'un large √©ventail de possibilit√©s - un nombre assez important de restrictions, dont nous parlerons plus tard. </p><br><h1 id="smart-kontrakty-waves">  Contrats intelligents Waves </h1><br><p>  Comme je l'ai √©crit ci-dessus, on nous a souvent pos√© des questions sur les contrats intelligents, mais nous ne voulions pas faire ¬´comme √† l'antenne¬ª ou ¬´comme dans n'importe quel nom de cha√Æne¬ª, et il y a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plusieurs raisons √† cela</a> .  Par cons√©quent, nous avons analys√© les cas existants pour les contrats et comment nous pouvons aider √† r√©soudre de vrais probl√®mes avec leur aide. </p><br><p>  Apr√®s avoir analys√© les sc√©narios d'utilisation, nous avons d√©couvert qu'il existe 2 grandes cat√©gories de t√¢ches qui sont g√©n√©ralement r√©solues √† l'aide de contrats intelligents: </p><br><ol><li>  T√¢ches simples et directes comme multisig, swaps atomiques ou s√©questre. </li><li>  dApps, applications d√©centralis√©es √† part enti√®re avec logique utilisateur.  Pour √™tre plus pr√©cis, il s'agit d'un backend pour les applications d√©centralis√©es.  Les exemples les plus frappants sont Cryptokitties ou Bancor. </li></ol><br><p>  Il existe √©galement un troisi√®me type de contrat, le plus populaire - les jetons.  Sur le r√©seau Ethereum, par exemple, la grande majorit√© des contrats de travail sont des jetons standard ERC20.  Dans Waves, pour cr√©er des jetons, il n'est pas n√©cessaire de cr√©er des contrats intelligents, car  ils font partie de la blockchain elle-m√™me, et pour √©mettre un jeton (avec la possibilit√© de l'√©changer imm√©diatement sur un √©change d√©centralis√© (DEX)), il suffit d'envoyer une transaction du type d'√©mission (transaction d'√©mission). </p><br><p>  Pour les deux types de t√¢ches ci-dessus (pour des raisons de simplicit√©, nous appellerons des cas simples et complexes) les exigences concernant la langue, les contrats et les concepts sont tr√®s diff√©rentes.  Oui, nous pouvons dire qu'avoir un langage complet de Turing peut r√©soudre √† la fois des probl√®mes simples et complexes, mais il y a une condition importante: le langage devrait aider √† √©viter les erreurs.  Cette exigence est √©galement importante pour les langues ordinaires et pour les langues des contrats intelligents, elle est particuli√®rement importante, car  les op√©rations sont financi√®rement li√©es, et les contrats sont souvent immuables, et il n'y a aucun moyen de corriger une erreur rapidement et facilement. </p><br><p>  Compte tenu des types de t√¢ches d√©crites ci-dessus, nous avons d√©cid√© de progresser progressivement et de donner un outil pour r√©soudre des probl√®mes simples comme premi√®re √©tape, et de donner un langage qui puisse facilement impl√©menter n'importe quelle logique utilisateur comme √©tape suivante.  En cons√©quence, le syst√®me s'est av√©r√© √™tre beaucoup plus puissant que nous ne l'imaginions au d√©but du voyage. </p><br><h2 id="sdelaem-akkaunty-umnymi">  Rendons les comptes intelligents </h2><br><p>  Progressivement, nous sommes arriv√©s au concept de comptes intelligents, qui sont con√ßus pour r√©soudre des t√¢ches principalement simples.  Leur id√©e est tr√®s similaire √† Bitcoin Script: des r√®gles suppl√©mentaires peuvent √™tre ajout√©es au compte qui d√©terminent la validit√© de la transaction sortante.  Les principales exigences pour les comptes intelligents √©taient: </p><br><ol><li>  S√©curit√© maximale.  Presque chaque mois, vous pouvez trouver des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nouvelles</a> qu'une autre vuln√©rabilit√© a √©t√© trouv√©e dans les contrats mod√®les Ethereum.  Nous voulions √©viter cela. </li><li>  Pas besoin de gaz, donc la commission est fixe.  Pour ce faire, le script doit √™tre ex√©cut√© dans un d√©lai pr√©visible et avoir des limites de taille assez strictes. </li></ol><br><p>  Avant de passer aux d√©tails techniques de la mise en ≈ìuvre et de la r√©daction des contrats, nous d√©crivons certaines caract√©ristiques de la blockchain Waves qui seront importantes pour une meilleure compr√©hension: </p><br><ol><li>  La blockchain Waves compte actuellement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">13 types de transactions diff√©rents.</a> </li></ol><br><p><img src="https://habrastorage.org/webt/dx/to/mz/dxtomzcjjyp7jgwa9wcsmfana1u.png"></p><br><ol><li>  Dans la blockchain Waves, pas les entr√©es et sorties (comme dans Bitcoin), mais les comptes (comme, par exemple, dans Nxt).  Une transaction est effectu√©e pour le compte d'un compte sp√©cifique. </li><li>  Par d√©faut, l'exactitude d'une transaction est d√©termin√©e par l'√©tat actuel de la blockchain et la validit√© de la signature au nom de laquelle la transaction est envoy√©e.  La repr√©sentation JSON de la transaction semble assez simple: </li></ol><br><p><img src="https://habrastorage.org/webt/gl/0a/m-/gl0am-s8dyjwnsgnksk0tf1fzyu.png"></p><br><p> √âtant donn√© que nous avons d√©j√† diff√©rents types de transactions dans la blockchain, nous avons d√©cid√© de ne pas cr√©er une entit√© distincte en tant que compte intelligent, mais d'ajouter une nouvelle transaction qui transforme un compte r√©gulier en un compte intelligent.  Tout compte peut devenir un compte intelligent avec des r√®gles de validation de transaction modifi√©es, pour cela, le compte doit simplement envoyer une transaction du type <code>SetScriptTransaction</code> , qui contient le contrat compil√©. </p><br><p>  Dans le cas d'un compte intelligent, le contrat est une r√®gle de validation pour chaque _ transaction sortante. </p><br><h2 id="a-chto-tam-s-gazom">  Et le gaz? </h2><br><p>  L'une des principales t√¢ches que nous nous sommes fix√©es est de nous d√©barrasser du gaz pour des op√©rations simples.  Cela ne signifie pas qu'il n'y aura pas de commission.  Il est n√©cessaire pour que les mineurs aient int√©r√™t √† ex√©cuter des scripts.  Nous avons abord√© la question du c√¥t√© pratique et d√©cid√© de proc√©der √† des tests de performance et de calculer la vitesse des diff√©rentes op√©rations.  Pour cela, des benchmarks utilisant JMH ont √©t√© d√©velopp√©s.  Les r√©sultats peuvent √™tre vus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Les limitations qui en r√©sultent sont: </p><br><ol><li>  Le script doit s'ex√©cuter plus rapidement que 20 op√©rations de v√©rification de signature, ce qui signifie que les v√©rifications pour un compte intelligent ne seront pas plus de 20 fois plus lentes que pour un compte normal.  La taille du script ne doit pas d√©passer 8 Ko. </li><li>  Pour rendre rentable pour les mineurs l'ex√©cution de contrats intelligents, nous avons fix√© une commission suppl√©mentaire minimale pour les comptes intelligents d'un montant de 0,004 ONDES.  La commission minimale dans le r√©seau Waves pour une transaction est de 0,001 WAVES, dans le cas d'un compte intelligent - 0,005 WAVES. </li></ol><br><h1 id="yazyk-dlya-smart-kontraktov">  Langage pour les contrats intelligents </h1><br><p>  L'une des t√¢ches les plus difficiles a √©t√© la cr√©ation de leur propre langage de contrats intelligents.  Prendre n'importe quel langage existant et l'adapter (d√©couper) pour nos t√¢ches semble tirer √† partir d'un canon sur des moineaux: en plus de cela, d√©pendre de la base de code de quelqu'un d'autre dans un projet de blockchain est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">extr√™mement risqu√©</a> . </p><br><p>  Essayons d'imaginer quel devrait √™tre le langage id√©al pour les contrats intelligents.  √Ä mon avis, tout langage de programmation devrait forcer √† √©crire du code "correct" et s√ªr, c'est-√†-dire  id√©alement, il ne devrait y avoir qu'une seule bonne fa√ßon.  Oui, si vous le souhaitez, vous pouvez √©crire du code compl√®tement illisible et non pris en charge dans n'importe quelle langue, mais cela devrait √™tre plus difficile que de l'√©crire correctement (bonjour PHP et JavaScript).  Dans le m√™me temps, le langage devrait √™tre pratique pour le d√©veloppement.  √âtant donn√© que le langage s'ex√©cute sur tous les n≈ìuds du r√©seau, il est n√©cessaire qu'il soit aussi efficace que possible - une ex√©cution paresseuse peut √©conomiser beaucoup de ressources.  J'aimerais aussi avoir un syst√®me de typage puissant dans la langue, de pr√©f√©rence alg√©brique, car il permet de d√©crire le contrat le plus clairement possible et de se rapprocher du r√™ve de "Code is law".  Si nous formalisons un peu plus nos exigences, nous obtenons les param√®tres de langue suivants: </p><br><ol><li>  Soyez strictement et statiquement tap√©.  Un typage fort √©limine automatiquement de nombreuses erreurs de programmation potentielles. </li><li>  Ayez un syst√®me de frappe puissant pour vous emp√™cher de vous tirer une balle dans le pied. </li><li>  Soyez paresseux pour ne pas perdre de pr√©cieux cycles de traitement. </li><li>  Avoir des fonctions sp√©cifiques dans la biblioth√®que standard pour travailler avec la blockchain, par exemple, les hachages.  Dans le m√™me temps, la biblioth√®que de langues standard ne doit pas √™tre surcharg√©e, car il doit toujours y avoir une bonne fa√ßon. </li><li>  Ne pas avoir d'exceptions lors de l'ex√©cution. </li></ol><br><p>  Dans notre langage RIDE, nous avons essay√© de prendre en compte ces fonctionnalit√©s importantes, et comme nous d√©veloppons beaucoup sur Scala et comme la programmation fonctionnelle, le langage est √† certains √©gards similaire √† Scala et F #. </p><br><p>  Les plus gros probl√®mes dans la mise en ≈ìuvre dans la pratique se sont pos√©s avec la derni√®re exigence, car si vous n'avez pas d'exceptions dans la langue, alors, par exemple, l'op√©ration d'ajout devra renvoyer une <em>option</em> , qui devra √™tre v√©rifi√©e pour le d√©bordement, ce qui sera certainement g√™nant pour les d√©veloppeurs.  Les exceptions √©taient un compromis, mais sans possibilit√© de les intercepter - s'il y avait une exception, la transaction n'√©tait pas valide.  Un autre probl√®me √©tait de transf√©rer dans la langue tous les mod√®les de donn√©es que nous avons dans la blockchain.  J'ai d√©j√† d√©crit que dans Waves, il existe 13 types de transactions diff√©rents qui doivent √™tre pris en charge dans la langue et avoir acc√®s √† tous leurs domaines. </p><br><p>  Des informations compl√®tes sur les op√©rations disponibles et les types de donn√©es dans RIDE se trouvent sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la page de description du langage</a> .  Parmi les caract√©ristiques int√©ressantes de la langue, nous pouvons √©galement souligner le fait que la langue est bas√©e sur l'expression, c'est-√†-dire que tout est expression, ainsi que la pr√©sence d'une correspondance de mod√®le, ce qui vous permet de d√©crire facilement les conditions de diff√©rents types de transactions: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">match</span></span> tx { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> t:<span class="hljs-type"><span class="hljs-type">TransferTransaction</span></span> =&gt; t.recepient <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> t:<span class="hljs-type"><span class="hljs-type">MassTransferTransaction</span></span> =&gt; t.transfers <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> }</code> </pre> <br><p>  Toute personne int√©ress√©e √† apprendre comment fonctionne le code RIDE vaut la peine de consulter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le livre blanc</a> , qui d√©crit toutes les √©tapes de l'utilisation d'un contrat: analyse, compilation, d√©s√©rialisation, calcul de la complexit√© et de l'ex√©cution du script.  Les deux premi√®res √©tapes - l'analyse et la compilation sont effectu√©es hors cha√Æne, seul le contrat compil√© en base64 entre dans la blockchain.  La d√©s√©rialisation, le calcul de la complexit√© et l'ex√©cution se font en cha√Æne et plusieurs fois √† diff√©rentes √©tapes: </p><br><ol><li>  Lorsque vous recevez une transaction et l'ajoutez √† UTX, sinon il y aura une situation o√π la transaction sera accept√©e par le n≈ìud de la cha√Æne de blocs, par exemple via l'API REST, mais n'entrera jamais dans le bloc. </li><li>  Lorsqu'un bloc est form√©, le n≈ìud d'exploration de donn√©es valide les transactions et le script est requis. </li><li>  D√®s r√©ception par les n≈ìuds non miniers d'un bloc et validation des transactions qui y sont incluses. </li></ol><br><p>  Chaque optimisation dans l'utilisation des contrats devient pr√©cieuse, car elle est effectu√©e plusieurs fois sur de nombreux n≈ìuds de r√©seau.  D√©sormais, les n≈ìuds Waves s'ex√©cutent silencieusement sur des machines virtuelles pour 15 $ chez DigitalOcean, malgr√© l'augmentation des charges de travail apr√®s la publication des comptes intelligents. </p><br><h2 id="a-chto-v-itoge">  Quel est le r√©sultat? </h2><br><p>  Voyons maintenant ce que nous avons obtenu √† Waves.  Nous r√©digerons notre premier contrat, que ce soit un contrat multisig 2-of-3 standard.  Pour r√©diger un contrat, vous pouvez utiliser l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">IDE en ligne</a> (r√©glage de la langue - un sujet pour un article s√©par√©).  Cr√©ez un nouveau contrat vide (Nouveau ‚Üí Contrat vide). </p><br><p>  Tout d'abord, nous annoncerons les cl√©s publiques d'Alice, Bob et Cooper, qui contr√¥leront le compte.  Vous aurez besoin de 2 de leurs 3 signatures: </p><br><pre> <code class="scala hljs">let alicePubKey = base58<span class="hljs-symbol"><span class="hljs-symbol">'B1Yz7fH1bJ2gVDjyJnuyKNTdMFARkKEp</span></span>V' let bobPubKey = base58<span class="hljs-symbol"><span class="hljs-symbol">'7hghYeWtiekfebgAcuCg9ai2NXbRreNz</span></span>c' let cooperPubKey = base58<span class="hljs-symbol"><span class="hljs-symbol">'BVqYXrapgJP9atQccdBPAgJPwHDKkh6A</span></span>8'</code> </pre> <br><p>  La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation d√©crit</a> la fonction <code>sigVerify</code> , qui vous permet de v√©rifier la signature de la transaction: </p><br><p><img src="https://habrastorage.org/webt/fw/am/py/fwampygopgdhgrmb9v4z67mkszq.png"></p><br><p>  Les arguments de la fonction sont le corps de la transaction, la signature v√©rifi√©e et la cl√© publique.  Un objet <code>tx</code> est disponible dans le contrat dans la port√©e globale, dans lequel les informations de transaction sont stock√©es.  Cet objet a un champ <code>tx.bodyBytes</code> qui contient les octets de la transaction envoy√©e.  Il existe √©galement un tableau de <code>tx.proofs</code> , qui stocke des signatures, qui peuvent aller jusqu'√† 8. Il convient de noter qu'en fait, vous pouvez envoyer non seulement des signatures √† <code>tx.proofs</code> , mais toute autre information pouvant √™tre utilis√©e par le contrat. </p><br><p>  Nous pouvons nous assurer que toutes les signatures sont pr√©sent√©es et qu'elles sont dans le bon ordre en utilisant 3 lignes simples: </p><br><pre> <code class="scala hljs">let aliceSigned = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">0</span></span>], alicePubKey )) then <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> let bobSigned = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">1</span></span>], bobPubKey )) then <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> let cooperSigned = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">2</span></span>], cooperPubKey )) then <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p>  Eh bien, la derni√®re √©tape sera de v√©rifier qu'au moins 2 signatures sont soumises. </p><br><pre> <code class="scala hljs">aliceSigned + bobSigned + cooperSigned &gt;= <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br><p>  L'ensemble du contrat de multi-signature 2 sur 3 ressemble √† ceci: </p><br><pre> <code class="scala hljs">#    let alicePubKey = base58<span class="hljs-symbol"><span class="hljs-symbol">'B1Yz7fH1bJ2gVDjyJnuyKNTdMFARkKEp</span></span>V' let bobPubKey = base58<span class="hljs-symbol"><span class="hljs-symbol">'7hghYeWtiekfebgAcuCg9ai2NXbRreNz</span></span>c' let cooperPubKey = base58<span class="hljs-symbol"><span class="hljs-symbol">'BVqYXrapgJP9atQccdBPAgJPwHDKkh6A</span></span>8' #       let aliceSigned = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">0</span></span>], alicePubKey )) then <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> let bobSigned = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">1</span></span>], bobPubKey )) then <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> let cooperSigned = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">2</span></span>], cooperPubKey )) then <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> # ,      <span class="hljs-number"><span class="hljs-number">2</span></span>   aliceSigned + bobSigned + cooperSigned &gt;= <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br><p>  Remarque: il n'y a pas de mots-cl√©s comme <code>return</code> dans le code, car la derni√®re ligne ex√©cut√©e est consid√©r√©e comme le r√©sultat du script, et c'est pourquoi il doit toujours retourner <code>true</code> ou <code>false</code> </p><br><p>  En comparaison, le contrat multi-signature Ethereum commun <a href="">semble beaucoup plus compliqu√©</a> .  M√™me des variantes relativement simples ressemblent √† ceci: </p><br><pre> <code class="plaintext hljs"> pragma solidity ^0.4.22; contract SimpleMultiSig { uint public nonce; // (only) mutable state uint public threshold; // immutable state mapping (address =&gt; bool) isOwner; // immutable state address[] public ownersArr; // immutable state // Note that owners_ must be strictly increasing, in order to prevent duplicates constructor(uint threshold_, address[] owners_) public { require(owners_.length &lt;= 10 &amp;&amp; threshold_ &lt;= owners_.length &amp;&amp; threshold_ &gt;= 0); address lastAdd = address(0); for (uint i = 0; i &lt; owners_.length; i++) { require(owners_[i] &gt; lastAdd); isOwner[owners_[i]] = true; lastAdd = owners_[i]; } ownersArr = owners_; threshold = threshold_; } // Note that address recovered from signatures must be strictly increasing, in order to prevent duplicates function execute(uint8[] sigV, bytes32[] sigR, bytes32[] sigS, address destination, uint value, bytes data) public { require(sigR.length == threshold); require(sigR.length == sigS.length &amp;&amp; sigR.length == sigV.length); // Follows ERC191 signature scheme: https://github.com/ethereum/EIPs/issues/191 bytes32 txHash = keccak256(byte(0x19), byte(0), this, destination, value, data, nonce); address lastAdd = address(0); // cannot have address(0) as an owner for (uint i = 0; i &lt; threshold; i++) { address recovered = ecrecover(txHash, sigV[i], sigR[i], sigS[i]); require(recovered &gt; lastAdd &amp;&amp; isOwner[recovered]); lastAdd = recovered; } // If we make it here all signatures are accounted for. // The address.call() syntax is no longer recommended, see: // https://github.com/ethereum/solidity/issues/2884 nonce = nonce + 1; bool success = false; assembly { success := call(gas, destination, value, add(data, 0x20), mload(data), 0, 0) } require(success); } function () payable public {} }</code> </pre> <br><p>  L'IDE a une console int√©gr√©e qui vous permet de compiler imm√©diatement un contrat, de le d√©ployer, de cr√©er des transactions et de voir le r√©sultat de l'ex√©cution.  Et si vous voulez travailler s√©rieusement avec les contrats, je vous recommande de regarder les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">biblioth√®ques pour diff√©rents langages</a> et le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plugin pour Visual Studio Code</a> . </p><br><p>  Si vos mains vous d√©mangent, √† la fin de l'article, il y a les liens les plus importants avec lesquels commencer la plong√©e. </p><br><h2 id="sistema-moschnee-chem-yazyk">  Le syst√®me est plus puissant que la langue </h2><br><p>  La blockchain Waves a des types de donn√©es sp√©ciaux pour stocker des donn√©es - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Transactions de donn√©es</a> .  Ils fonctionnent comme un stockage de valeur-cl√© associ√© √† un compte, c'est-√†-dire, dans un sens, c'est l'√©tat du compte. </p><br><p><img src="https://habrastorage.org/webt/3o/oh/4h/3ooh4hitfov4sdfhobfhglpec98.png"></p><br><p>  La date de transaction peut contenir des cha√Ænes, des nombres, des valeurs bool√©ennes et des tableaux d'octets jusqu'√† 32 Ko par cl√©.  Un exemple d'utilisation des transactions de donn√©es, qui vous permet d'envoyer une transaction uniquement si le stockage de valeurs-cl√©s du compte contient d√©j√† le num√©ro 42 sur la <code>key</code> : </p><br><pre> <code class="scala hljs">let keyName = <span class="hljs-string"><span class="hljs-string">"key"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> (tx) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> tx:<span class="hljs-type"><span class="hljs-type">DataTransaction</span></span> =&gt; let x = extract(getInteger(tx.sender, keyName)) x == <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre> <br><blockquote>  Gr√¢ce √† Data Transaction, les comptes intelligents deviennent un outil extr√™mement puissant qui vous permet de travailler avec des oracles, de g√©rer l'√©tat et de d√©crire facilement les comportements. </blockquote><p><img src="https://habrastorage.org/webt/ew/ce/gf/ewcegfy0nsj4s8t34c6sn2v7hew.png"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cet article</a> d√©crit comment vous pouvez impl√©menter des NFT (jetons non fongibles) √† l'aide de transactions de donn√©es et d'un contrat intelligent qui contr√¥le l'√©tat.  Par cons√©quent, le style du compte contiendra des entr√©es du formulaire: </p><br><pre> <code class="plaintext hljs">+------------+-----------------------------------------------+ | Token Name | Owner Publc Key | +------------+-----------------------------------------------+ | "Token #1" | "6iQaHazE9NVAJfAjMpHifDXMfr1euWcy8fmW6rNcdhr" | | "Token #2" | "3tNLxyJnyxLzDkMkqiZmUjRqXe1UuwFeSyQ14GRYnGL" | | "Token #3" | "3wH7rENpbS78uohErXHq77yKzQwRyKBYhzCR9nKU17q" | | "Token #4" | "6iQaHazE9NVAJfAjMpHifDXMfr1euWcy8fmW6rNcdhr" | | "Token #5" | "6iQaHazE9NVAJfAjMpHifDXMfr1euWcy8fmW6rNcdhr" | +------------+-----------------------------------------------+</code> </pre> <br><p>  Le contrat NFT lui-m√™me semble extr√™mement simple: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">match</span></span> tx { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> dt: <span class="hljs-type"><span class="hljs-type">DataTransaction</span></span> =&gt; let oldOwner = extract(getString(dt.sender, dt.data[<span class="hljs-number"><span class="hljs-number">0</span></span>].key)) let newOwner = getBinary(dt.data, <span class="hljs-number"><span class="hljs-number">0</span></span>) size(dt.data) == <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; sigVerify(dt.bodyBytes, dt.proofs[<span class="hljs-number"><span class="hljs-number">0</span></span>], fromBase58String(oldOwner)) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre> <br><h1 id="a-chto-dalshe">  Et ensuite? </h1><br><p>  Le d√©veloppement ult√©rieur des contrats intelligents Waves est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ride4DApps</a> , qui permettra d'appeler des contrats sur d'autres comptes, et un langage (ou syst√®me) complet de Turing qui vous permettra de r√©soudre tous les types de t√¢ches, de d√©clencher d'autres t√¢ches, etc. </p><br><p>  Une autre direction int√©ressante pour le d√©veloppement de contrats intelligents dans l'√©cosyst√®me Waves est Smart Assets, qui fonctionne sur un principe similaire - les contrats de Turing incomplets qui se rapportent au jeton.  Le contrat contr√¥le les conditions dans lesquelles les transactions de jetons peuvent √™tre effectu√©es.  Par exemple, avec leur aide, il sera possible de geler les jetons √† une certaine hauteur de blockchain ou d'interdire le trading de jetons p2p.  Vous pouvez en savoir plus sur les actifs intelligents <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans le blog</a> . </p><br><p>  Eh bien, √† la fin, je vais √† nouveau vous donner une liste de ce qui sera n√©cessaire pour commencer √† travailler avec des contrats intelligents sur le r√©seau Waves. </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La documentation</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">IDE avec console</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Livre blanc pour les plus curieux</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr440702/">https://habr.com/ru/post/fr440702/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr440692/index.html">Quel est le probl√®me avec les tests A / B</a></li>
<li><a href="../fr440694/index.html">Cr√©ez une sc√®ne de base dans A-Frame</a></li>
<li><a href="../fr440696/index.html">Bo√Æte √† outils de refactorisation de base de donn√©es: Flyway vs. Liquibase</a></li>
<li><a href="../fr440698/index.html">6 id√©es d'applications de r√©alit√© augment√©e (RA) int√©ressantes</a></li>
<li><a href="../fr440700/index.html">¬´Forces sp√©ciales¬ª de Data Science en interne</a></li>
<li><a href="../fr440706/index.html">InoThings ++ Professional IoT Conference - Ce qui √©tait et ce qui sera</a></li>
<li><a href="../fr440708/index.html">Webinaire ouvert "Travail: le sien et celui d'un autre"</a></li>
<li><a href="../fr440710/index.html">Deux aspects de WebView: d√©marrage rapide de projets et vol de donn√©es personnelles</a></li>
<li><a href="../fr440712/index.html">Le cloud n'est que l'ordinateur de quelqu'un</a></li>
<li><a href="../fr440714/index.html">Comment la baisse du taux d'acquisition nous affecte (titulaires de carte)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>