<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✍️ 🌒 🧚🏿 引擎，脚本语言和视觉小说-45小时内 🧢 ⛳️ 🍴</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="问候。 碰巧的是，连续三年，作为给某些人的新年礼物，我一直在做游戏。 在2018年，这是一个带有谜题元素的平台游戏，我在集线器上写道 在2019年-两名球员的网络即时战略（RTS），对此我什么都没写。 最后，在2020年-一个视觉上的短故事，将在非常有限的时间内创建，稍后将进行讨论。 


 在本文...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>引擎，脚本语言和视觉小说-45小时内</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483818/"><p><img src="https://habrastorage.org/webt/k-/q6/7j/k-q67jnxvm1knkh3qfvqjyhbira.png" alt="视觉小说，引擎和脚本语言长达45小时"></p><br><p> 问候。 碰巧的是，连续三年，作为给某些人的新年礼物，我一直在做游戏。 在2018年，这是一个带有谜题元素的平台游戏，我在集线器上<a href="https://habr.com/ru/post/345958/">写道</a> 在2019年-两名球员的网络即时战略（RTS），对此我什么都没写。 最后，在2020年-一个视觉上的短故事，将在非常有限的时间内创建，稍后将进行讨论。 </p><br><p> 在本文中： </p><br><ul><li> 视觉短篇小说引擎的设计和实现， </li><li> 在8小时内有非线性情节的游戏， </li><li> 以自己的语言删除脚本中的游戏逻辑。 </li></ul><br><p> 有意思吗 然后欢迎猫。 </p><br><p>  <em>小心：有很多文字和〜3.5mb图片</em> </p><a name="habracut"></a><br><p> 内容： </p><br><p>  0.开发引擎的理由。 </p><br><ol><li> 平台的选择。 </li><li> 引擎架构及其实现： <br>  2.1。 问题陈述。 <br>  2.2。 体系结构和实现。 </li><li> 脚本语言： <br>  3.1。 语言 <br>  3.2。 口译员 </li><li> 游戏开发： <br>  4.1。 游戏逻辑的历史和发展。 <br>  4.2。 图形 </li><li> 统计和结果。 </li></ol><br><p>  <em>注意：如果由于某种原因您对技术细节不感兴趣，则可以跳至步骤4“游戏开发”，但是您将跳过大部分内容</em> </p><br><h2 id="0-obosnovanie-razrabotki-dvizhka">  0.开发引擎的理由 </h2><br><p> 当然，有很多现成的用于视觉短篇小说的引擎，毫无疑问，它们比下面描述的解决方案要好。 但是，无论我是哪种类型的程序员，如果我没有编写另一种。 因此，让我们假装其开发是合理的。 </p><br><h2 id="1-vybor-platformy">  1.平台选择 </h2><br><p> 实际上，选择是很小的：Java还是C ++。 无需三思而后行，我决定用Java实现我的计划，因为 为了快速开发，它提供了所有可能性（即：与C ++相比，自动内存管理和更高的简便性，因为它隐藏了许多低级细节，因此，可以减少对语言本身的强调，而仅考虑业务逻辑），并提供开箱即用的窗口，图形和音频支持。 </p><br><p> 选择Swing来实现图形界面，因为我使用了Java 13，在Java 13中JavaFX不再是库的一部分，并且由于它过于懒惰而添加了数十兆的OpenJFX。 也许这不是最好的解决方案，但是。 </p><br><p>  <em>问题可能出现了：它是哪种游戏引擎，但没有硬件加速？</em>  <em>答案在于缺乏处理OpenGL的时间，以及它的绝对毫无意义：FPS对于视觉小说并不重要（无论如何，动画和图形的数量与这种情况一样）。</em> </p><br><h2 id="2-arhitektura-dvizhka-i-ego-realizaciya">  2.引擎的架构及其实现 </h2><br><h3 id="21-postanovka-zadachi">  2.1问题陈述 </h3><br><p> 为了决定如何做某事，您需要决定为什么。 这是我关于问题的陈述，因为 该体系结构不是通用的，但根据定义，“特定于域的”引擎直接取决于预期的游戏。 </p><br><p> 通过通用引擎，我了解支持相对较低级别概念（例如“游戏对象”，“场景”，“组件”）的引擎。 决定使其不是通用引擎，因为这将大大减少开发时间。 </p><br><p> 按照计划，游戏应包括以下部分： </p><br><p><img src="https://habrastorage.org/webt/w9/fh/l5/w9fhl5dhsu2tiua2kd9d8n5lfdq.png" alt="视觉小说游戏的结构"></p><br><p> 也就是说，每个场景都有一个背景，主要文本以及一个供用户输入的文本字段（视觉小说是在任意用户输入的情况下精确想到的，而不是像通常那样从建议的选项中进行选择。稍后我将告诉您为什么它很糟糕决定）。 该图还显示游戏中可能有多个场景，因此可以在它们之间进行转换。 </p><br><p>  <em>注意：场景是游戏的逻辑部分。</em>  <em>在这一部分中，场景的标准可以是相同的背景。</em> </p><br><p> 对引擎的要求还包括播放音频和显示消息的能力（具有可选的用户输入功能）。 </p><br><p> 也许最重要的愿望不是写游戏逻辑，而是用某种简单的声明性语言来编写游戏逻辑。 </p><br><p> 还希望实现过程动画的可能性，即图像的基本运动，以便在Java级别上可以确定考虑当前运动速度的函数（例如，速度图是直接的，正弦的或其他形式的）。 </p><br><p> 按照计划，所有用户交互都将通过对话系统完成。 在这种情况下，对话被认为不一定与NPC或类似的对话，而是通常是对注册了相应处理程序的任何用户输入的反应。 不清楚 它将很快变得更加清晰。 </p><br><h3 id="22-arhitektura-i-realizaciya">  2.2。 架构与实施 </h3><br><p> 鉴于以上所有内容，您可以将引擎分为三个相对较大的部分，分别对应于相同的Java包： </p><br><ol><li> <code>display</code> -包含所有与向用户输出任何信息（图形，文本和声音）以及从用户接收输入有关的内容。 一种（视图），如果我们谈论MVC / MVP /等。 </li><li>  <code>initializer</code> -包含在其中初始化和启动引擎的类。 </li><li>  <code>sl</code>包含用于使用脚本语言的工具（以下称为SL）。 </li></ol><br><p> 在这一段中，我将考虑前两个部分。 我将从第二个开始。 </p><br><p> 初始值设定项类有两个主要方法： <code>initialize()</code>和<code>run()</code> 。 最初，控制权来自启动器类，在该类<code>initialize()</code>调用<code>initialize()</code> 。 调用之后，初始化程序将分析传递给程序的参数（包含任务的目录路径和要运行的任务的名称），加载所选任务的清单（稍后再进行介绍），初始化显示，检查数据是否支持该任务所需的语言版本（SL）解释器，最后为开发人员控制台启动一个单独的线程。 </p><br><p> 之后，如果一切顺利，启动器将调用<code>run()</code>方法，该方法将启动任务的实际加载。 首先，所有与下载的任务相关的脚本（关于下面的任务文件结构）都被馈送到分析器，分析器的结果被提供给解释器。 然后，开始所有场景的初始化，并且初始化程序完成其流的执行，最后将Enter键处理程序挂在显示器上。 因此，当用户按Enter键时，将加载第一个场景，但稍后会加载更多场景。 </p><br><p> 任务的文件结构如下： </p><br><p><img src="https://habrastorage.org/webt/3l/xo/nr/3lxonrfkeik_hwids4tire50dge.png" alt="任务的文件结构"></p><br><p> 有一个单独的任务文件夹，其根目录是清单，还有三个其他文件夹： <code>audio</code> -声音， <code>graphics</code> -视觉部分和<code>scenes</code> -描述场景的脚本。 </p><br><p> 我想简要介绍一下宣言。 它包含以下字段： </p><br><ul><li>  <code>sl_version_req</code>启动任务所需的SL版本， </li><li>  <code>init_scene</code>任务开始的场景名称， </li><li>  <code>quest_name</code>出现在窗口标题中的漂亮任务名称， </li><li>  <code>resolution</code> -任务所针对的屏幕的分辨率（稍后对此进行说明）， </li><li>  <code>font_size</code>所有文本的字体大小， </li><li>  <code>font_name</code>是所有文本的字体名称。 </li></ul><br><p> 值得注意的是，在显示初始化期间，除其他事项外，还执行了渲染分辨率的计算：也就是说，所需的分辨率是从清单中获取的，并挤入了可用于窗口的空间中，以便： </p><br><ul><li> 长宽比与清单中的分辨率相同， </li><li> 所有可用空间在宽度或高度上都被占用。 <br> 因此，任务的开发者可以确定他的图像（例如16：9）将以该比例显示在任何屏幕上。 </li></ul><br><p> 同样，在初始化显示时，光标会隐藏，因为它不参与游戏。 </p><br><p> 简而言之，关于开发者控制台。 开发它的原因如下： </p><br><ol><li> 用于调试。 </li><li> 如果游戏过程中出现问题，则可以通过开发者控制台进行修复。 <br> 它仅实现了一些命令，即：输出特定类型及其状态的描述符，输出工作线程，重新启动显示以及最重要的命令<code>exec</code> ，它们允许在当前场景中执行任何SL代码。 </li></ol><br><p> 这样就结束了初始化程序和相关内容的描述，我们可以继续进行显示的描述。 </p><br><p> 其最终结构如下： </p><br><p><img src="https://habrastorage.org/webt/zz/qb/-1/zzqb-15nrxzhechuggvxgzoo-hg.png" alt="显示结构"></p><br><p> 从问题的陈述中，我们可以得出结论，要做的就是绘制图像，绘制文本，播放音频。 </p><br><p> 通常如何在通用引擎及其他引擎中绘制文本/图像？ 有一种类型为<code>update()</code>的方法，该方法在每个刻度/步/帧/渲染/帧/等中都被调用，并且其中有一个对<code>drawText()</code> / <code>drawImage()</code>类型的方法的调用-这可确保文本/图像在此帧中的外观。 但是，一旦停止调用此类方法，相应事物的呈现就会停止。 </p><br><p> 就我而言，决定做一些不同的事情。 由于对于视觉小说而言，文本和图像是相对永久的，并且几乎也是用户看到的所有内容（也就是说，它们足够重要），因此它们是作为游戏对象制成的-也就是说，您只需要生成就不会消失的东西。直到你问他们。 另外，该解决方案简化了实施。 </p><br><p> 描述文本/图像的对象（从OOP的角度来看）称为描述符。 也就是说，对于API引擎的用户来说，只有可以添加到显示状态并从显示状态中删除的描述符。 因此，在显示的最终版本中，存在以下描述符（它们对应于相同名称的类）： </p><br><div class="scrollable-table"><table><thead><tr><th> 描述符名称： </th><th> 描述符描述： </th></tr></thead><tbody><tr><td> <code>ImageDescriptor</code> </td> <td> 图像描述符：包含图像（ <code>BufferedImage</code> ），屏幕上的位置以及带有高度的宽度。 但是，在创建时，仅指定宽度-高度是与原始高度成比例地计算的（并且无法手动不成比例地拉伸/压缩图像，因此这是一个错误的决定）。 </td></tr><tr><td> <code>TextDescriptor</code> </td> <td> 文本描述符：包含文本，其位置和大小。 此外，文本不会在宽度和高度上按比例缩放，但是在超出边界时会被截断。 可以通过音节和空白字符来传输文本，还可以按行滚动文本。 </td></tr><tr><td> <code>AudioDescriptor</code> </td> <td> 可以播放音频（一次或循环播放），暂停并删除音频的音频描述符。 </td></tr><tr><td> <code>AnimationDescriptor</code> </td> <td> 可以像音频一样循环播放动画手柄。 包含一个实现动画的对象，以及一个为其播放动画的图像描述符。 主要方法是<code>update(long)</code> ，它花费了自上次<code>update(long)</code>调用以来经过的毫秒数。 它们的编号用于计算动画的当前状态。 </td></tr><tr><td> <code>InputDescriptor</code> </td> <td> 输入描述符：是一个文本字段，其中光标始终位于文本的末尾。 还应注意的是，通过隐式创建的文本描述符执行来自输入描述符的文本的存储和渲染，以免重复逻辑。  <em>有趣的是，我考虑了按Backspace键的可能性，但没有考虑Delete键。</em>  <em>当在游戏过程中仍然按Delete键时，由于没有对Delete进行任何处理且角色试图显示为文本，因此in出现在字段中。</em> </td></tr><tr><td> <code>KeyAwaitDescriptor</code> </td> <td> 传递了必要键的句柄（来自<code>KeyEvent</code> ），以及带有某些逻辑的回调，当按下相应的键时将启动该逻辑。 </td></tr><tr><td> <code>PostWorkDescriptor</code> </td> <td> 接受回调的句柄，该回调将在处理每个刻度后被调用。 </td></tr></tbody></table></div><br><p> 该显示还包含用于当前输入接收器（输入描述符）的字段，以及一个字段，该字段指示当前哪个文本描述符具有焦点，以及哪个文本描述符将在用户方面的相应动作下滚动。 </p><br><p> 游戏周期如下所示： </p><br><ol><li> 音频处理-在音频描述符上调用<code>update()</code>方法，该方法检查音频的当前状态，释放内存（如有必要），并进行其他技术工作。 </li><li> 处理击键-将输入的字符传输到描述符以接收输入，处理滚动键的击键（上下箭头）和Backspace。 </li><li> 动画处理。 </li><li> 清除渲染缓冲区中的背景（以<code>BufferedImage</code>作为缓冲区）。 </li><li> 绘图图像。 </li><li> 文字渲染。 </li><li> 输入的绘图字段。 </li><li> 缓冲区的输出到屏幕。 </li><li> 处理<code>PostWorkDescriptor</code> 。 </li><li> 关于替换显示状态的一些工作，我将在后面（在SL解释器的部分中）进行讨论。 </li><li> 停止流以动态计算时间，以使FPS等于指定值（默认为30）。 </li></ol><br><p>  <em>注意：也许会出现一个问题，“如果为输入字段创建了适当的文本描述符，为什么会更早地渲染它们，为什么还要渲染输入字段？”</em>  <em>实际上，第7段中的呈现不会发生-只有<code>InputDescriptor</code>的参数与<code>InputDescriptor</code>的参数同步-例如屏幕可见性，位置，大小等。</em>  <em>如上所述，这样做是因为用户不直接使用文本描述符控制相应的输入描述符，并且通常对此一无所知。</em> </p><br><p> 值得注意的是，屏幕上元素的大小和位置不是以像素为单位，而是以相对大小设置-从0到1的数字（下图）。 也就是说，渲染的整个宽度为1，整个高度为1（它们不相等，我忘记了几次，后来感到遗憾）。 也应该使（0,0）为中心，并且宽度/高度应等于2，但是出于某种原因，我忘记了/没考虑过。 但是，即使宽度/高度等于1的选项也简化了任务开发人员的生命。 </p><br><p><img src="https://habrastorage.org/webt/ay/ay/zy/ayayzykqpewkfcggqoxxz3mtcse.png" alt="相对坐标系"></p><br><p> 关于释放内存的系统的几句话。 </p><br><p> 每个描述符都有一个<code>setDoFree(boolean)</code>方法，如果用户要销毁给定的描述符，则必须调用该方法。 处理某种类型的所有描述符之后，立即进行了某种类型的描述符的垃圾收集。 另外，播放一次后播放的音频会在播放结束后自动删除。 与非循环动画完全相同。 </p><br><p> 因此，目前您可以绘制任何想要的东西，但这不是上面的图片，上面只有背景，主要文本和输入字段。 接下来是显示上方的包装器，它对应于类<code>DefaultDisplayToolkit</code> 。 </p><br><p> 初始化后，它仅将背景，文本等的描述符添加到显示器，还知道如何显示带有可选图标，输入字段和回调的消息。 </p><br><p>  <em>然后出现了一个小错误，要对其进行全面纠正，需要重做一半的渲染系统：如果您查看游戏循环中的渲染顺序，则可以看到首先绘制图像，然后才绘制文本。</em>  <em>同时，当工具箱显示图像时，它会将其宽度和<strong>高度</strong>放置在屏幕中间。</em>  <em>并且，如果消息中包含很多文本，则它应该与场景的主要文本部分重叠。</em>  <em>但是，由于消息背景是图像（完全是黑色，但仍然是黑色），并且图像是在文本之前绘制的，因此一个文本会叠加在另一个文本上（下面的屏幕截图）。</em>  <em>通过不在屏幕上而是在正文<strong>上方的</strong>区域中垂直居中，部分解决了该问题。</em>  <em>完整的解决方案包括引入深度参数，并从单词“完全”重做渲染器。</em> </p><br><div class="spoiler">  <b class="spoiler_title">叠加演示</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/la/t1/yn/lat1ynb6f3ivjxdvnhi4bsbjfvc.png" alt="文字重叠"></p></div></div><br><p> 最后，也许这与显示器有关。 您可以继续使用该语言， <code>sl</code>软件包中包含使用该语言的整个API。 </p><br><h2 id="3-skriptovyy-yazyk">  3.脚本语言 </h2><br><p>  <em>注意：如果尊敬的USERNAME％在这里读过它，那他做得很好，我要他不要停止这样做：现在，它会比以前有趣得多。</em> </p><br><h3 id="31-yazyk">  3.1。 语言能力 </h3><br><p> 最初，我想使用一种声明性语言，只需要指示场景所需的所有必要参数即可，仅此而已。 引擎将采取所有逻辑。 但是，最后，我使用了过程语言，即使使用OOP元素（几乎没有区别），这也是一个很好的解决方案，因为与声明性选项相比，它在游戏逻辑上具有更大的灵活性。 </p><br><p> 考虑到语言语法，以便在给定可用时间量的情况下，语法分析尽可能简单。 </p><br><p> 因此，代码存储在扩展名为SSF的文本文件中。 每个文件都包含一个或多个场景的描述； 每个场景包含零个或多个动作； 每个动作包含零个或多个运算符。 </p><br><p> 有关条款的一些解释。 动作只是一个过程，不可能传递参数（决不会阻止游戏的发展）。 运算符显然不是普通单词（+，-，/，*）中该词的含义，但形式是相同的：运算符是其名称及其所有参数的总和。 </p><br><p> 也许您渴望最终看到SL的源代码，这里是： </p><br><pre> <code class="plaintext hljs">scene dungeon { action init { load_image "background" "dungeon/background.png" load_image "key" "dungeon/key.png" load_audio "background" "dungeon/background.wav" load_audio "got_key" "dungeon/got_key.wav" } action first_come { play "background" loop set_background "background" set_text "some text" add_dialog "(||(|) (||-))" "dial_look_around" dial_look_around on } //some comment action dial_look_around { play "got_key" once show "some text 2" "key" none tag "key" switch_dialog "dial_look_around" off } }</code> </pre> <br><p> 现在可以清楚地知道操作员是什么。 还可以看到每个动作都是一个语句块（一个语句可以是一个语句块），以及支持单行注释的事实（输入多行注释没有任何意义，此外，我没有使用单行注释）。 </p><br><p> 为了简化起见，该语言未引入“变量”这样的概念； 结果，代码中使用的所有值都是文字。 根据类型，区分以下文字： </p><br><div class="scrollable-table"><table><thead><tr><th> 文字名称： </th><th> 注意事项： </th></tr></thead><tbody><tr><td> 字符串文字 </td><td> 包括转义引号和斜杠（\\）的功能，也可以在文本中插入连字符 </td></tr><tr><td> 整数文字 </td><td> 支持负数 </td></tr><tr><td> 浮点文字 </td><td> 支持负数 </td></tr><tr><td> 没有文字 </td><td> 该代码表示​​为<code>none</code> </td></tr><tr><td> 布尔文字 </td><td> 在代码中-分别为true / false的<code>on</code> / <code>off</code> </td></tr><tr><td> 一般文字 </td><td> 如果文字不属于上述任何一种类型，并且由英文字母，数字和下划线组成，则为一般文字。 </td></tr></tbody></table></div><br><p> 关于语言解析的几句话。 有多个级别的“加载”代码（如下图）： </p><br><ol><li> 标记器是用于将源代码分解为标记（语言的最小语义单元）的模块化类。 每种令牌都与一个数字相关联-它的类型。 为什么模块化？ 因为令牌生成器中检查源代码的任何部分是否为某种类型的令牌的那些部分与令牌生成器隔离，并从外部下载（从第二段下载）。 </li><li>  tokenizer附加组件是一个类，用于定义SL中每种类型的令牌的外观； 在较低级别使用标记器。 这里也是对空间令牌的筛选和对单行注释的省略。 输出给出了干净的令牌流，用于... </li><li>  ...解析器（它也是模块化的），在输出时生成抽象语法树。 模块化-因为它本身只能解析场景和动作，但不知道如何分析操作员。 因此，将模块加载到其中（实际上，他本人将其加载到构造函数中，这不是很好），它可以解析其每个运算符。 </li></ol><br><p><img src="https://habrastorage.org/webt/3c/vz/u-/3cvzu-qk5wgwwtgpn_dndl3aan8.png" alt="脚本语言解析管道"></p><br><p> 现在，简要介绍一下运算符，以便出现一种语言功能的想法。 最初有11个运营商，然后在思考游戏的过程中，其中一些合并为一个，进行了一些更改，然后添加了9个。 这是汇总表： </p><br><div class="scrollable-table"><table><thead><tr><th> 操作员姓名： </th><th> 注意事项： </th></tr></thead><tbody><tr><td> <code>load_image</code> </td> <td> 将图像加载到内存中 </td></tr><tr><td> <code>load_audio</code> </td> <td> 将音频加载到内存中 </td></tr><tr><td> <code>set_text</code> </td> <td> 设置场景的主要文本。 </td></tr><tr><td> <code>set_background</code> </td> <td> 设置场景的背景。 </td></tr><tr><td> <code>play</code> </td> <td> 播放音频（可以播放一次或循环播放） </td></tr><tr><td> <code>show</code> </td> <td> 显示带有回调（在SL中）和可选图像的消息（在用户关闭消息后调用） </td></tr><tr><td> <code>tag</code> </td> <td> 设置标签（标签）。 可以将其视为具有指定名称的全局变量，该名称不存储任何值。 这在不同的情况下很有用：例如，您可以通过这种方式标记玩家是否找到了门的钥匙，他是否已经在此位置等。 </td></tr><tr><td>  <code>if_tag</code> / <code>if_tag_n</code> </td><td> 分支运算符，使您可以根据是否安装了相应的标记来执行某些操作。 支持<code>else</code>分支。 如果设置了标签，则执行<code>if_tag</code> ；如果是<code>if_tag</code>则执行<code>if_tag_n</code>反之亦然 </td></tr><tr><td> <code>add_dialog</code> </td> <td> 允许您向场景添加对话。 稍后再介绍他们 </td></tr><tr><td> <code>goto</code> </td> <td> 过渡到另一个场景 </td></tr><tr><td> <code>call</code> </td> <td> 自定义动作通话 </td></tr><tr><td> <code>call_extern</code> </td> <td> 从另一个场景调用动作。 </td></tr><tr><td> <code>stop_all</code> </td> <td> 停止播放所有声音/音乐 </td></tr><tr><td> <code>show_motion</code> </td> <td> 在指定的时间（持续时间）内显示图像并将其从一个点移动到另一点（在移动结束时调用可选回调） </td></tr><tr><td> <code>animate</code> </td> <td> 对先前通过<code>show_motion</code>显示的图像进行<code>show_motion</code> 。 从选项中：您可以指定动画的类型<code>v_motion</code> / <code>h_motion</code> （按功能进行垂直/水平移动） <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>2</mn><msup><mi>t</mi><mn>3</mn></msup><mo>&amp;#x2212;</mo><mn>3</mn><msup><mi>t</mi><mn>2</mn></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.953ex" height="2.539ex" viewBox="0 -935.7 3854.8 1093.4" role="img" focusable="false" style="vertical-align: -0.366ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/483818/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhh_kMPOJvnfUY1frP_8VCg6p-PQBg#MJMAIN-32" x="0" y="0"></use><g transform="translate(500,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/483818/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhh_kMPOJvnfUY1frP_8VCg6p-PQBg#MJMATHI-74" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/483818/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhh_kMPOJvnfUY1frP_8VCg6p-PQBg#MJMAIN-33" x="511" y="513"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/483818/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhh_kMPOJvnfUY1frP_8VCg6p-PQBg#MJMAIN-2212" x="1538" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/483818/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhh_kMPOJvnfUY1frP_8VCg6p-PQBg#MJMAIN-33" x="2538" y="0"></use><g transform="translate(3039,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/483818/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhh_kMPOJvnfUY1frP_8VCg6p-PQBg#MJMATHI-74" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/483818/&amp;xid=17259,15700023,15700186,15700191,15700259,15700271&amp;usg=ALkJrhh_kMPOJvnfUY1frP_8VCg6p-PQBg#MJMAIN-32" x="511" y="513"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><msup><mi>t</mi><mn>3</mn></msup><mo>−</mo><mn>3</mn><msup><mi>t</mi><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-1"> 2t ^ 3-3t ^ 2 </script>  ），循环播放的可能性，动画播放的时间（持续时间）的指示。 可以将一个数值（一个，因为无法传递可变数量的参数，因此部分是拐杖）传递给动画（对于每个动画，它意味着不同的东西）和可选的回调（在播放动画时调用）。 </td></tr></tbody></table></div><br><p> 用于计数器的运算符-特定于场景的整数变量。 </p><br><div class="scrollable-table"><table><thead><tr><th> 操作员姓名： </th><th> 注意事项： </th></tr></thead><tbody><tr><td> <code>counter_set</code> </td> <td> 创建一个计数器并用一些值初始化它 </td></tr><tr><td> <code>counter_add</code> </td> <td> 向计数器添加值 </td></tr><tr><td> <code>if_counter &lt;modifier&gt;</code> </td> <td> 能够比较两个计数器/数字/一个计数器的值。  <code>&lt;modifier&gt;</code>是通用文字，其形式为<code>eq/gr/ls[_n]</code> ，其中<code>eq</code>相等， <code>gr</code>大于， <code>ls</code>小于， <code>_n</code>是<code>gr_n</code> （例如， <code>gr_n</code>不大于）。 如您所见，一切都已尽可能简化。 </td></tr></tbody></table></div><br><p> 还曾考虑过引入<code>return</code> （甚至在解释器的核心级别上添加了相应的功能），但我忘了，它没有用。 </p><br><p>           ,      ,     :  <code>show_motion</code>      (, , 0.01)         <code>duration</code> . </p><br><p>          ,   (lookup)  (  ):      ///,        <code>load_audio</code> / <code>load_image</code> / <code>counter_set</code> / <code>add_dialog</code> .   ,       ,   ,    , — . .        ,     . , : " <code>scene_coast.dialog_1</code> " —  <code>dialog_1</code>   <code>scene_coast</code> . </p><br><p>           SL-,   . , ,       , —       .     :       (-, ),   ,       <code>lookup</code> ', ,  ,  .      ,            <code>goto</code>  <code>lookup</code> ',        . </p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><p>    -      — - ,        ,       <code>n</code>  ( )    .             ,     ,       <code>n</code>   .   ,  . </p></div></div><br><p>   .     : </p><br><pre> <code class="plaintext hljs">add_dialog "regexp" "dialog_name" callback on/off</code> </pre> <br><p>     ,                  . ,     :     ,   ,      ,     ( ). </p><br><p>  ,    ,        ( )    ( )   ,    ( ).         :         ,    ,     , ""   "". </p><br><p><img src="https://habrastorage.org/webt/qw/nk/y6/qwnky6dhlw8amlkbhcnb3ex4tvs.png" alt="dialogs system work"></p><br><p> <em>,       ( ,  )</em> </p><br><p>     ,  "": </p><br><pre> <code class="plaintext hljs">(||((|||) ( )?(||)?)|(||)( )?|  )</code> </pre> <br><p>  *** </p><br><p>   ,     :  — ,      ,   — . </p><br><p> <em>,       :      </em> </p><br><h3 id="32-interpretator"> 3.2.  </h3><br><p>      :   ,  —  ""  (   ).  <em></em>           . </p><br><p>   SL    ,     - .  : </p><br><ol><li> <code>init</code> —           ,    (  ,      , ,     ). </li><li> <code>first_come</code> — ,      .     ,  ,     . </li><li>       ,     : <code>come</code> —    ,     ( ). </li></ol><br><p> <em>: <code>init</code>  <code>first_come</code> —     ,          .</em> </p><br><p>         .     :      ,    ,    <strong></strong>  <code>init</code> -.  ,  <strong></strong>    (   )    . </p><br><p>  ,     <code>n</code> ,        <code>first_come</code> - (  -       -     ).       .  ,   :       ,        ,  <code>first_come</code>  <code>come</code> ,   <code>come</code> ( ).    :        ,             ,         ,       . </p><br><p>          (,    "", " ", "  "  . .).  ,      ,   -    - .    ,             ( ),          . </p><br><p>              (, ,    ).   :        ?       ,        ,      .      <code>provideState</code>  ,        ;  <strong></strong>           ,      . </p><br><p> <em>      ,  ,     ,     ,    (    ,    ),         (, ,      ,    ).</em> </p><br><h2 id="4-razrabotka-igry"> 4.   </h2><br><p>          .   2019-  2018-,      ,  ,    . </p><br><h3 id="41-istoriya-i-razrabotka-logiki-igry"> 4.1.      </h3><br><p>     ,  ,    , —  .             ,      .      (  ),      , <del>  </del>     - , 9  (),      -  (   ,     ( , , )  . </p><br><p>  ,   :     ,       ,   ,     .           ,       ,     . </p><br><p>  ,        25% (5)  ,  :  ,   ;   ( <code>animate</code> ),      ( <code>call_extern</code> ). </p><br><p>   ,     -     ( ),      (,   ,   —  ,  "You won"). </p><br><p><img src="https://habrastorage.org/webt/0g/la/gv/0glagv3q6tcjirb_qezojplz8tc.png" alt="demo visual novel"></p><br><h3 id="42-grafika"> 4.2.  </h3><br><p>          ,     : </p><br><p><img src="https://habrastorage.org/webt/pz/fw/qi/pzfwqi8pkcr7le0xjkjmkd8w-h8.png" alt="stubs for graphics"></p><br><p>      ,    ,    -   -    " ".     : </p><br><ul><li>      (4x2.23''),         . </li><li>       : ,    , —     . </li><li>            ////etc. </li></ul><br><p><img src="https://habrastorage.org/webt/e9/ry/rv/e9ryrv-13waaticfbp04vhwq5tu.png" alt="usage of art brushes"></p><br><ul><li>    ,    ,     . </li></ul><br><p><img src="https://habrastorage.org/webt/th/hj/jm/thhjjmkujbdjdo4eqvksclai7pq.png" alt="a character from the visual novel"></p><br><ul><li> ,        .      ,     , ,       .     . </li></ul><br><h2 id="5-statistika-i-itogi"> 5.    </h2><br><p>        ( 11 )    30  40 .    9    4  55 .     (  )  7  41 .   — ~4-6  (    45   ). </p><br><p> <em>:      "Darkyen's Time Tracker"   JetBrains (  ).</em> <br> <em>:       2    ,    —     .   45        8 .</em> </p><br><p>      : 4777,   ( ) — 637. </p><br><p> <em>:     <code>cloc</code> .</em> </p><br><p>    30   .    (  ) :  — ~8 ,      — ~24 ,   (     ) — ~8 .     . </p><br><p>   — 232  (  - ,   WAV). </p><br><div class="spoiler"> <b class="spoiler_title"> WAV?</b> <div class="spoiler_text"><p>       <code>javax.sound.sampled.AudioSystem</code> ,    WAV  AU ,    WAV. </p></div></div><br><p>   28  (  3  ).          —           17  /. </p><br><p>         -  :        ,        .  , ,   "   ",     " ".     (,   ),          (     ""/""  - ). </p><br><div class="spoiler"> <b class="spoiler_title">      ?</b> <div class="spoiler_text"><p>   —      ,    .      :        . . ,       ,       ""    :        NPC,      ,       (,    —    ..). </p></div></div><br><p>   ,      :  ,      . </p><br><p>    —  .     ,  :  ,  ,  ,   .              . ,        ,     , , , . </p><br><p>   .       (        ),    : </p><br><ul><li>  .  .  . </li><li>     .              ,    . </li><li>   ,       . </li></ul><br><p> <em>,             ,  .</em> </p><br><p>           <a href="https://github.com/wcobalt/stepper" rel="nofollow">GitHub</a> . </p><br><p>        (assets)  <a href="https://github.com/wcobalt/stepper/releases" rel="nofollow"> "Releases"</a>   "v1.0"  . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN483818/">https://habr.com/ru/post/zh-CN483818/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN483798/index.html">如何在Google Ads中自动撰写广告</a></li>
<li><a href="../zh-CN483800/index.html">不要睡觉！ 我们如何学会每晚发布12,000张门票优惠</a></li>
<li><a href="../zh-CN483802/index.html">如果您是开发人员，如何独自发布产品：Laravel创作者Taylor Otvel的提示。 第1部分：受众</a></li>
<li><a href="../zh-CN483804/index.html">理查德·汉明 “不存在的章节”：据我们所知（40分中的11-20分钟）</a></li>
<li><a href="../zh-CN483814/index.html">亚伯拉罕·Flexner：无用知识的实用性（1939）</a></li>
<li><a href="../zh-CN483820/index.html">什么影响信贷的发行。 房屋信贷违约风险竞赛概述</a></li>
<li><a href="../zh-CN483822/index.html">5个JavaScript功能，如果没有这些功能，我将无法编写代码</a></li>
<li><a href="../zh-CN483824/index.html">在研究了我的五个规则后，如何实现梦想，积极思考并继续前进？</a></li>
<li><a href="../zh-CN483826/index.html">使用Vo模拟输出连接MH-Z19B型CO2传感器</a></li>
<li><a href="../zh-CN483828/index.html">闪耀与贫困原子交换</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>