<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕺🏽 😉 📑 Pengemasan Paket dalam Gradle 💪🏻 🍭 ✍🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam artikel saya, saya ingin berbicara tentang trik lain yang dapat dengan mudah diimplementasikan menggunakan paket perpustakaan pengemasan ulang G...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pengemasan Paket dalam Gradle</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472002/"><p>  Dalam artikel saya, saya ingin berbicara tentang trik lain yang dapat dengan mudah diimplementasikan menggunakan paket perpustakaan pengemasan ulang Gradle.  Setiap orang yang bahkan bekerja sedikit dengan sistem build ini tahu bahwa secara otomatis tahu cara menyelesaikan konflik dari berbagai versi perpustakaan, dan jika Anda mau, Anda dapat memengaruhi ini, misalnya, memperbaiki versi perpustakaan tertentu: </p><br><pre><code class="java hljs">configurations.all { resolutionStrategy { force <span class="hljs-string"><span class="hljs-string">"org.ow2.asm:asm:7.2"</span></span> } }</code> </pre> <br><p>  Sayangnya, ini tidak selalu membantu menyelesaikan masalah konflik versi.  Misalnya, ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">masalah</a> yang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">diketahui</a> bahwa beberapa perangkat htc dalam firmware sudah memiliki pustaka gson, dan jika versi gson Anda berbeda dari yang terpasang, maka masalah dapat terjadi, karena ClassLoader akan memuat hanya satu kelas ke dalam memori, dan dalam hal ini akan menjadi satu sistem. </p><br><p>  Masalah ini juga dapat terjadi ketika mengembangkan perpustakaan.  Jika Anda menghubungkan 2 perpustakaan ke proyek Anda yang menggunakan perpustakaan pihak ketiga yang sama dari versi yang berbeda, misalnya 1 dan 2, maka Gradle akan menyelesaikan dan mengambil versi terbaru, yang kedua.  Tetapi jika tidak ada kompatibilitas ke belakang di perpustakaan pihak ketiga ini dan versi kedua tidak bisa hanya digunakan bukan yang pertama, maka akan ada masalah yang pasti akan sangat sulit untuk dilacak dengan jejak.  Perpustakaan yang menunggu versi pertama akan menerima kelas kedua dan hanya crash. </p><br><p>  Saya mengalami konflik versi ketika menulis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">plugin grad</a> , ia menggunakan pustaka <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">asm</a> , yang bertentangan.  Setelah menulis plugin, saya memeriksa kinerjanya pada proyek uji: semuanya baik-baik saja, diperiksa pada proyek hewan peliharaan, semuanya baik-baik saja juga, tetapi ketika saya menghubungkannya ke proyek kerja nyata dengan sekelompok dependensi pihak ketiga, saya mengalami masalah. </p><br><p><img src="https://habrastorage.org/webt/ln/ed/ar/lnedary9es3gxlyadwfs1yn5xqg.png"></p><br><p>  Solusi untuk masalah di bawah luka. </p><a name="habracut"></a><br><h2 id="vse-zhe-rabotalo-chto-poshlo-ne-tak">  Namun berhasil, apa yang salah? </h2><br><p>  Kami mendapatkan jejak kesalahan penuh: </p><br><p><img src="https://habrastorage.org/webt/v6/xa/9h/v6xa9hz9b1ajpbztmtlbbowrbko.png"></p><br><p>  Kita melihat bahwa kesalahan dalam konstruktor pustaka <code>ClassVisitor</code> asm ada di baris 79.  Mari kita lihat di sana, tetapi ketika mencoba membuka <code>ClassVisitor</code> , studio menawarkan 2 opsi </p><br><p><img src="https://habrastorage.org/webt/hv/v5/hw/hvv5hwcacmqoj7nompdir2xpxlk.png"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Plugin saya</a> menggunakan asm versi <code>7.2</code> , jadi kami pergi ke sana dan pada baris 79 kita melihat yang berikut: </p><br><p><img src="https://habrastorage.org/webt/rp/88/uj/rp88ujzc58f15b-qwwqtvyikvze.png"></p><br><p>  Ini jelas bukan yang kita butuhkan.  Sekarang, masuk ke <code>ClassVisitor</code> versi 6: </p><br><p><img src="https://habrastorage.org/webt/tb/gw/j9/tbgwj9rxcgnfpmeururnlpwftoe.png"></p><br><p>  Hanya <code>IllegalArgumentException</code> kami tanpa pesan.  Plugin saya menggunakan versi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ASM api 7 dari</a> <code>Opcodes.ASM7</code> , dan dalam versi 6 perpustakaan api ini belum ada, oleh karena itu, <code>IllegalArgumentException</code> di lalat konstruktor.  Kita dapat menyimpulkan bahwa plugin menerima versi pustaka yang salah. </p><br><p>  Pertanyaan sampah, saya pikir, dan melakukan ini: </p><br><pre> <code class="java hljs">configurations.all { resolutionStrategy { force <span class="hljs-string"><span class="hljs-string">"org.ow2.asm:asm:7.2"</span></span> } }</code> </pre> <br><p>  Saya menyesal, ini sama sekali tidak berpengaruh.  Saya masih tidak dapat menemukan alasan yang tepat mengapa tidak mungkin untuk memperbaiki versi asm, meskipun perintah <code>./gradlew app:dependencies</code> perintah <code>./gradlew app:dependencies</code> menunjukkan bahwa versi tersebut telah diganti dengan 7.2.  Jika seseorang memiliki pemikiran atau asumsi, saya akan senang mendengar pendapat. </p><br><h2 id="problemu-nado-kak-to-reshat">  Masalahnya harus dipecahkan entah bagaimana </h2><br><p>  Serangkaian googling dan pendalaman ke dalam pekerjaan hujan es dimulai.  Akibatnya, saya pergi ke situs web asm, mungkin mereka tahu sesuatu tentang ini.  Ternyata mereka benar-benar tahu, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">jawaban pertanyaan saya</a> ada di bagian FAQ.  Mereka mengatakan untuk mengganti paket asm dengan yang lain, mereka bahkan menawarkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">utilitas</a> untuk ini.  Ok, ayo coba.  Anda hanya perlu menghubungkan plug-in dan melakukan sedikit pengaturan: </p><br><pre> <code class="java hljs">apply plugin: <span class="hljs-string"><span class="hljs-string">'org.anarres.jarjar'</span></span> ... dependencies { <span class="hljs-function"><span class="hljs-function">implementation </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fileTree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dir: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'build/jarjar'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, include: [</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'*.jar'</span></span></span></span><span class="hljs-function"><span class="hljs-params">])</span></span></span><span class="hljs-function"> implementation jarjar.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">repackage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'asm'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ from <span class="hljs-string"><span class="hljs-string">'org.ow2.asm:asm:7.2'</span></span> classRename <span class="hljs-string"><span class="hljs-string">"org.objectweb.asm.**"</span></span>, <span class="hljs-string"><span class="hljs-string">"stater.org.objectweb.asm.@1"</span></span> } }</code> </pre> <br><p>  <code>build/jarjar</code> dalam hal ini, direktori di mana file jar asm library dengan paket-paket yang di-bungkus akan dihasilkan, jadi Anda perlu membuka akses ketergantungan ke direktori ini melalui <code>fileTree</code> .  Perpustakaan sekarang akan tersedia dengan import <code>stater.org.objectweb.asm.*</code> Alih-alih <code>org.objectweb.asm.*</code> .  Plugin ini memiliki berbagai pengaturan, tetapi dalam contoh saya, hanya mengubah paket sudah cukup. </p><br><p>  Selanjutnya, periksa seluruh proyek dan ubah impor di mana-mana dari <code>org.objectweb.asm</code> ke <br>  <code>stater.org.objectweb.asm</code> .  Menurut pendapat saya, utilitas yang sangat nyaman, berkali-kali lebih mudah daripada melakukannya dengan tangan, terutama ketika memperbarui perpustakaan, kami hanya mengubah <code>from 'org.ow2.asm:asm:7.2'</code> ke versi baru dan nama panggilan jar yang dikemas dengan versi baru akan dihasilkan di mesin otomatis. </p><br><p>  Jika Anda hanya memiliki proyek (bukan perpustakaan), maka ini sudah cukup bagi Anda untuk menyelesaikan konflik yang tidak terpecahkan, seperti gson yang disebutkan di awal artikel.  Tetapi jika Anda, seperti saya, menulis perpustakaan, maka itu belum semuanya. </p><br><p>  Kami memecahkan masalah pengemasan ulang, tetapi sekarang <code>asm</code> terhubung ke proyek bukan melalui ketergantungan pada repositori maven jarak jauh, tetapi melalui file jar lokal, yang akan hilang begitu saja ketika perpustakaan Anda digunakan dan akan ada kesalahan <code>NoClassDefFoundError</code> .  Tetapi masalah ini cukup sederhana untuk dipecahkan: </p><br><ol><li><p>  Di file gradle kami, buat konfigurasi baru: </p><br><pre> <code class="java hljs">configurations { extraLibs implementation.extendsFrom(extraLibs) }</code> </pre> <br></li><li><p>  Selanjutnya kita berubah </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">implementation </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fileTree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dir: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'build/jarjar'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, include: [</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'*.jar'</span></span></span></span><span class="hljs-function"><span class="hljs-params">])</span></span></span></span></code> </pre> <br><p>  pada </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">extraLibs </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fileTree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dir: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'build/jarjar'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, include: [</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'*.jar'</span></span></span></span><span class="hljs-function"><span class="hljs-params">])</span></span></span></span></code> </pre> <br></li><li><p>  Tetapkan ulang tugas yang bertanggung jawab untuk mengumpulkan file jar terakhir Anda dan tulis semua perpustakaan dengan konfigurasi baru kami di nama panggilan jar terakhir: </p><br><pre> <code class="plaintext hljs">jar { from { configurations.extraLibs.collect { it.isDirectory() ? it : zipTree(it) } } }</code> </pre> <br></li></ol><br><p>  Itu saja, gunakan plugin kami seperti sebelumnya, terhubung ke proyek di mana ada konflik yang tidak dapat diselesaikan dan semuanya berfungsi dengan baik. <br>  Pengemasan ulang seperti itu membuat perpustakaan kami lebih toleran terhadap kesalahan ketika terhubung ke berbagai jenis proyek dengan perpustakaan lain. </p><br><h3 id="a-esli-prosto-podklyuchit-jar-fayl-konfliktuyuschey-biblioteki-k-plaginu-bez-pereupakovki">  Dan jika Anda hanya menghubungkan file jar perpustakaan yang bertentangan ke plugin tanpa mengemas ulang? </h3><br><p>  Gagasan buruk, itu tidak akan mengarah pada sesuatu yang baik.  Dalam proses membangun proyek, ada <code>check...DuplicateClasses</code> tugas yang menarik <code>check...DuplicateClasses</code> , yang hanya memotong file dengan paket yang sama.  Yaitu, file yang diperoleh dari file jar perpustakaan yang terhubung dan file dari perpustakaan yang sama yang terhubung melalui repositori jarak jauh.  Hasilnya adalah kesalahan ini: </p><br><p><img src="https://habrastorage.org/webt/9-/jo/y7/9-joy7dsnaqekwwqseztj_7hgsm.png"></p><br><p>  Itu saja.  Terima kasih untuk semua orang yang membaca! </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tulsa untuk dikemas ulang</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Plugin contoh</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id472002/">https://habr.com/ru/post/id472002/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id471990/index.html">Tata bahasa meta untuk pengurai PEG</a></li>
<li><a href="../id471992/index.html">Menerapkan fitur PEG yang tersisa</a></li>
<li><a href="../id471994/index.html">Bekerja pada PEG pada Core Developer Sprint</a></li>
<li><a href="../id471998/index.html">F # 10: Daftar</a></li>
<li><a href="../id472000/index.html">“Sangat penting bagi masyarakat untuk menetapkan standar”: Marchin Moskala tentang Kotlin</a></li>
<li><a href="../id472004/index.html">Tingkatkan. Spirit, atau Tambahkan "Spiritualitas" ke Daftar Filter</a></li>
<li><a href="../id472006/index.html">Mengapa berguna untuk menemukan kembali roda</a></li>
<li><a href="../id472012/index.html">Kanban dalam setengah jam</a></li>
<li><a href="../id472014/index.html">OTUS. Kesalahan favorit kami</a></li>
<li><a href="../id472018/index.html">Sistem kontrol perpustakaan pada Flask-Potion, Bagian 0: menyiapkan semua yang Anda butuhkan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>