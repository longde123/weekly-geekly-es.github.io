<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèÇüèª üè° üëáüèΩ Reduzieren Sie die Erstellungszeit Ihrer Android-Projekte üë©‚Äç‚öïÔ∏è üë©üèΩ‚Äçüé§ ‚õ≤Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Guten Morgen! Wir beginnen den Montag mit Material, dessen √úbersetzung speziell f√ºr Studenten des Kurses "Android-Entwickler" erstellt wurde. Fortgesc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Reduzieren Sie die Erstellungszeit Ihrer Android-Projekte</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/457374/">  Guten Morgen!  Wir beginnen den Montag mit Material, dessen √úbersetzung speziell f√ºr Studenten des Kurses <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">"Android-Entwickler" erstellt wurde.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fortgeschrittenenkurs</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚Äú</a> <br><br><img src="https://habrastorage.org/webt/cq/gh/9u/cqgh9uzb-qlhdgfjiv_ayajrqde.png"><br><br>  Ich habe k√ºrzlich die Android-Codebasis auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kure</a> auf AndroidX migriert.  Es schien mir, dass dies eine gro√üartige Gelegenheit ist, an der Geschwindigkeit der Montage des Projekts zu arbeiten.  Gradle hatte aufgrund der Langsamkeit und des Ressourcenverbrauchs immer einen schlechten Ruf, aber ich war sehr √ºberrascht, dass geringf√ºgige √Ñnderungen an der Baugruppenkonfiguration die Geschwindigkeit erheblich steigern konnten. <br><a name="habracut"></a><br>  Sehen Sie sich die Assembly-Scan-Metriken vor / nach der Optimierung an <br><br><img src="https://habrastorage.org/webt/2k/yw/2w/2kyw2wlroiairpx8iiriwjdbejq.jpeg"><br>  <i>vor der Optimierung</i> <br><br><img src="https://habrastorage.org/webt/ef/ss/u6/efssu62faz4yoi92zvmssa1pf0m.jpeg"><br>  <i>nach der Optimierung Ô∏èÔ∏è</i> <br><br>  Von 5,5 Minuten auf <b>17 Sekunden</b> verringert <b>?</b>  <b>Verr√ºckt werden!</b> <br><br>  Es ist nicht so schwierig, es mit einer Optimierung zu √ºbertreiben, um die Montagezeit weiter zu verk√ºrzen.  Um den Beitrag f√ºr Anf√§nger verst√§ndlich zu machen, werde ich mich bewusst auf die geringf√ºgigen, schmerzlosen Ma√ünahmen konzentrieren, die ich ergriffen habe, um diesem Indikator n√§her zu kommen. <br><br><h2>  Vor allem! </h2><br>  Bevor Sie mit der Optimierung beginnen, ist es wichtig, unser Projekt zu testen, um herauszufinden, wie lange es dauert, es zu erstellen.  Gradle verf√ºgt √ºber eine praktische Scanoption, mit der Sie die Leistung Ihrer Aufgabe analysieren k√∂nnen.  Starten Sie das Terminal in Android Studio und f√ºhren Sie den folgenden Befehl aus: <br><br><pre><code class="kotlin hljs">./gradlew assembleDebug --scan</code> </pre> <br>  Nach erfolgreichem Abschluss der Montage werden Sie aufgefordert, die Nutzungsbedingungen zum Herunterladen der Scanergebnisse zu akzeptieren.  Geben Sie <b>yes ein,</b> um fortzufahren.  Nach Abschluss der Ver√∂ffentlichung erhalten Sie einen Link zum Terminal, um den Scan zu √ºberpr√ºfen.  √ñffne es. <br><br>  <i>Es gibt einige Optionen auf der Website, aber der K√ºrze halber werden wir nur das ber√ºcksichtigen, was am wichtigsten ist.</i> <br><br>  Zusammenfassung zeigt zusammenfassende Informationen zu abgeschlossenen Aufgaben und deren Abschlusszeit an.  Was uns hier aber interessiert, ist der Bereich <b>Performance</b> .  Es wird eine detailliertere Aufschl√ºsselung der gesamten Erstellungszeit vorgenommen, wie unten gezeigt. <br><br><img src="https://habrastorage.org/webt/on/n_/he/onn_he0w_k-i5nkwr7jagda9mx4.jpeg"><br><br>  Im Abschnitt Leistung gibt es eine Registerkarte <b>Einstellungen und Vorschl√§ge</b> , die Empfehlungen zur Verbesserung der Erstellungsgeschwindigkeit enth√§lt.  Schauen wir sie uns an. <br><br><img src="https://habrastorage.org/webt/g0/l0/bu/g0l0buxdn5wy1pfkxnuc0f9i0gc.jpeg"><br><br>  In diesem Abschnitt finden Sie einige einfache Korrekturen zur Verbesserung der Geschwindigkeit.  Fahren wir also fort und wenden diese Korrekturen in unserem Projekt an. <br><br><h2>  Schritt 1: Upgrade-Tools </h2><br>  Das Android-Team verbessert und entwickelt das Build-System st√§ndig weiter.  In den meisten F√§llen k√∂nnen Sie daher eine erhebliche Verbesserung erzielen, indem Sie einfach die neueste Version des Toolkits installieren. <br><br>  W√§hrend dieses Refactorings befand sich unser Projekt in <b>Version 3.2.1 des</b> Gradle-Plugins f√ºr Android Studio ( <i>mehrere Versionen √§lter als die letzte Version</i> ). <br><br>  Sie k√∂nnen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesem Link</a> folgen, um die neueste Version des Gradle Plugins zu erhalten.  Zum Zeitpunkt dieses Schreibens war die neueste <b>Version 3.4.0.</b> <br><br>  Aber hier gibt es einen Haken, an den wir uns erinnern m√ºssen: <br><br><img src="https://habrastorage.org/webt/v0/b9/j9/v0b9j9xfqws0eknr0khchb4aoi0.jpeg"><br><br>  <i>( <b>Hinweis:</b> Bei Verwendung von Gradle Version 5.0 oder h√∂her wird die Standardgr√∂√üe des Gradle-D√§mons von 1 GB auf 512 MB reduziert. Dies kann zu einer schlechten Build-Leistung f√ºhren. Um diese Standardeinstellung zu √ºberschreiben, geben Sie die Speichergr√∂√üe f√ºr den Gradle-D√§mon in gradle.properties an Ihr Projekt.)</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://developer.android.com/studio/releases/gradle-plugin</a> <br><br>  <i>Bei Verwendung von <b>Gradle 5.0 und h√∂her m√ºssen</b> wir die Speichergr√∂√üe explizit erh√∂hen, damit sich unsere Erstellungsgeschwindigkeit nicht verschlechtert.</i>  <i>Wir werden gleich darauf zur√ºckkommen.</i> <br><br>  √ñffnen Sie die Datei <b>build.gradle</b> der obersten Ebene, die Sie im Stammverzeichnis Ihres Projekts finden, und f√ºgen Sie <b>dem Abh√§ngigkeitsabschnitt</b> die folgende Zeile hinzu: <br><br> <code>classpath 'com.android.tools.build:gradle:3.4.0'</code> <br> <br>  Sie m√ºssen auch die <b>Verteilungs-URL</b> in der Eigenschaftendatei von Gradle Wrapper unter <code><b>gradle/wrapper/gradle-wrapper.properties</b></code> .  Aktualisieren Sie die URL wie folgt. <br><br>  ( <i>Dieser Link wird auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">der Android Gradle-Plugin-Seite</a> verf√ºgbar sein.</i> ) <br><br> <code>distributionUrl=https\://services.gradle.org/distributions/gradle-5.1.1-all.zip</code> <br> <br>  Bei der Verwendung von Kotlin tritt ein Fehler auf, wenn die Version des Kotlin Gradle-Plugins kleiner als <b>1.3.0 ist.</b>  Verwenden Sie in diesem <b>Fall</b> den IDE-Tooltip, um das Gradle-Plugin f√ºr Kotlin auf die neueste Version zu aktualisieren (zum Zeitpunkt dieses Schreibens ist dies <b>Version 1.3.31</b> ). <br><br>  Ok, lassen Sie uns den Build erneut vom Terminal aus ausf√ºhren, um zu sehen, ob wir Verbesserungen vorgenommen haben. <br><br><img src="https://habrastorage.org/webt/gg/lg/kf/gglgkfxrbccatt7ygkyswjrky28.jpeg"><br><br><h2>  Schritt 2: Konfigurationen aktualisieren </h2><br>  Wir konnten also ungef√§hr 2,5 Minuten von der Bauzeit einsparen, aber das ist immer noch nicht gut genug.  Nachdem ich die Build-Protokolle im Terminal studiert hatte, stie√ü ich auf eine Zeile, die uns interessieren wird: <br><br><img src="https://habrastorage.org/webt/gr/fo/pv/grfopv6dg9wjtertgdxun5danku.jpeg"><br><br>  <i>(&gt; Aufgabe: App: compileDevelopDebugJavawithJavac</i> <i><br><br></i>  <i>Gradle kann die inkrementelle Kompilierung deaktivieren, da die folgenden Anmerkungsprozessoren nicht inkrementell sind: butterknife-compiler-10.1.0.jar (com.jakewharton: butterknife-compiler: 10.1.0), dagger-compiler-2.9.jar (com.google). Dolch: Dolch-Compiler: 2.9).</i> <i><br><br></i>  <i>Setzen Sie das experimentelle Flag android.enableSeparateAnnotationProcessing-true in der Datei gradle.properties, um die Annotationsverarbeitung in einer separaten Aufgabe zu starten und eine inkrementelle Kompilierung durchzuf√ºhren.)</i> <br><br>  Die inkrementelle Kompilierung verhindert grunds√§tzlich die verschwenderische Kompilierung des gesamten Satzes von Quelldateien und kompiliert stattdessen nur die Dateien, die ge√§ndert wurden.  Aus den Protokollen geht hervor, dass wir diese Funktion nicht verwenden.  Er schl√§gt vor, dass wir <code><b>android.enableSeparateAnnotationProcessing=true</b></code> , aber auf keinen Fall sollten wir die Konfiguration <i>"annotationProcessor"</i> verwenden, da Kotlin in unserem Projekt verwendet wird. <br><br>  Gl√ºcklicherweise bietet <b>Version 1.3.30 von</b> Kotlin Unterst√ºtzung f√ºr die schrittweise Verarbeitung von Anmerkungen. <br><br><img src="https://habrastorage.org/webt/hq/ud/_r/hqud_rdvrv8fzj2z4fadmqbqtqc.jpeg"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://kotlinlang.org/docs/reference/kapt.html</a> <br><br><h4>  (Inkrementelle Verarbeitung von Anmerkungen (ab 1.3.30) </h4><br>  Ab Version 1.3.30 unterst√ºtzt <code>kapt</code> die inkrementelle Annotationsverarbeitung als experimentelle Funktion.  Derzeit kann die Annotationsverarbeitung nur inkrementell ausgef√ºhrt werden, wenn alle verwendeten Annotationsprozessoren inkrementell sind. <br>  <code>gradle.properties</code> Sie diese Zeile zur Datei <code>gradle.properties</code> hinzu, um die Verarbeitung inkrementeller Anmerkungen zu <code>gradle.properties</code> : <br><br> <code>kapt.incremental.apt=true</code> <br> <br>  Beachten Sie, dass f√ºr die inkrementelle Annotationsverarbeitung auch die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">inkrementelle Kompilierung</a> aktiviert sein muss.) <br><br>  Fangen wir also an: <br><br><ol><li>  1. √Ñndern Sie die <b>annotationProcessor-</b> Konfiguration in <b>kapt</b> </li><li>  2. Aktivieren Sie das Flag f√ºr die experimentelle <b>Verarbeitung inkrementeller Anmerkungen</b> </li></ol><br>  √ñffnen Sie die Datei <code><b>build.gradle</b></code> Ihres Moduls und f√ºgen Sie die folgende Zeile oben in die Datei ein: <br><br> <code>apply plugin: 'kotlin-kapt'</code> <br> <br>  √Ñndern Sie dann alle annotationProcessor-Konfigurationen im Abschnitt "Abh√§ngigkeiten", um kapt zu verwenden.  Zum Beispiel: <br><br> <code>// <br> annotationProcessor 'com.google.dagger:dagger-compiler:2.9' <br> // <br> kapt 'com.google.dagger:dagger-compiler:2.9'</code> <br> <br>  √ñffnen Sie nun die Datei <b>gradle.properties</b> im Stammverzeichnis Ihres Projekts und f√ºgen Sie die folgende Zeile hinzu: <br><br> <code>kapt.incremental.apt=true</code> <br> <br>  Lassen Sie uns den Build erneut ausf√ºhren. <br><br><img src="https://habrastorage.org/webt/wl/bg/xk/wlbgxkwt2nlgrhbf6a-nxj5_jkw.jpeg"><br><br>  Nun, es sieht so aus, als h√§tten wir einige Fortschritte gemacht. <br><br><h2>  Schritt 3: Gradle-Eigenschaften </h2><br>  Wir sind in der letzten Phase.  Erinnern Sie sich an den Trick, auf den wir beim Aktualisieren der Version des Gradle-Plugins gesto√üen sind?  Es stellt sich heraus, dass neuere Versionen von Gradle die Gr√∂√üe des verwendeten Speichers auf 512 MB reduzieren.  Dies soll sicherstellen, dass schwache Maschinen nicht zu viel Speicher belegen.  Ich habe einen Computer mit 16 Gigabyte RAM, daher kann ich es mir leisten, dem Gradle-Daemon etwa 2-3 Gigs zuzuf√ºhren, aber Ihre Anzahl kann variieren. <br><br>  √ñffnen Sie die Datei <b>gradle.properties</b> im Stammverzeichnis Ihres Projekts und f√ºgen Sie die folgende Zeile hinzu.  Stellen Sie sicher, dass Sie die Gr√∂√üe ausw√§hlen, die Ihren Anforderungen und Computerspezifikationen entspricht. <br><br> <code>org.gradle.jvmargs=-Xmx3072m -XX:MaxPermSize=512m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8</code> <br> <br>  Lassen Sie uns dabei auch parallele Assemblys und On-Demand-Optimierungen in den Eigenschaften aktivieren. <br><br>  So <code><b>gradle.properties</b></code> meine endg√ºltige Version der Datei <code><b>gradle.properties</b></code> : <br><br><pre> <code class="kotlin hljs">org.gradle.jvmargs=-Xmx3072m -XX:MaxPermSize=<span class="hljs-number"><span class="hljs-number">512</span></span>m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-<span class="hljs-number"><span class="hljs-number">8</span></span> org.gradle.parallel=<span class="hljs-literal"><span class="hljs-literal">true</span></span> org.gradle.configureondemand=<span class="hljs-literal"><span class="hljs-literal">true</span></span> kapt.incremental.apt=<span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br><br><ul><li>  <code>org.gradle.parallel</code> - Mit diesem Flag kann Gradle Module innerhalb eines Projekts parallel und nicht nacheinander zusammenstellen.  Dies ist nur f√ºr Projekte mit mehreren Modulen n√ºtzlich. </li><li>  <code>org.gradle.configureondemand</code> - Dieses Flag konfiguriert nur die Module, die f√ºr das Projekt erforderlich sind, und sammelt nicht alle. </li></ul><br>  Nachdem wir dies getan haben, wollen wir sehen, was wir jetzt die Montagegeschwindigkeitsanzeigen haben: <br><br><img src="https://habrastorage.org/webt/42/g0/mu/42g0mugmqkhqo2ok7ynl-pqcf3e.jpeg"><br><img src="https://habrastorage.org/webt/3h/rb/p8/3hrbp8uyadmxzrzxioj6u6ghob4.jpeg"><br><br>  So! <br><br><h2>  Schlussbemerkungen </h2><br>  Dies ist keineswegs eine umfassende Abdeckung aller M√∂glichkeiten zur Optimierung der Montagegeschwindigkeit.  Es gibt viele andere Dinge, die ich in diesem Beitrag nicht behandelt habe, wie die Verwendung von minSdk 21 bei Verwendung von MultiDex, das Vorindizieren von Bibliotheken, das Deaktivieren der PNG-Komprimierung usw. sind nur einige davon. <br><br>  Die meisten dieser Konfigurationen erfordern jedoch ein tieferes Verst√§ndnis des Android-Build-Systems und Erfahrung in der Arbeit mit gro√üen Projekten mit mehreren Modulen (bei denen die Vorteile am offensichtlichsten sind).  Die oben genannten Schritte k√∂nnen selbst von den Nachwuchsentwicklern problemlos implementiert werden und haben erhebliche Vorteile.  Ich hoffe, dies hilft Ihnen dabei, die Build-Geschwindigkeit zu erh√∂hen! <br><br>  Bis zum n√§chsten Mal, Friede sei mit dir! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de457374/">https://habr.com/ru/post/de457374/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de457350/index.html">Warum ben√∂tigt das Oszilloskop Kryptografieunterst√ºtzung?</a></li>
<li><a href="../de457352/index.html">Abschluss von Informationen auf dem Display des K√§ufers</a></li>
<li><a href="../de457354/index.html">Datenverschleierung f√ºr Leistungstests</a></li>
<li><a href="../de457362/index.html">Promotion von RUVDS: Bereiten Sie den Server im Sommer vor</a></li>
<li><a href="../de457366/index.html">Ein Fanatiker, ein St√ºck Eisen oder ein Zuschauer - was f√ºr ein Spieler bist du?</a></li>
<li><a href="../de457378/index.html">Wie id Software Wolfenstein 3D basierend auf der Technologie von Commander Keen erstellt hat</a></li>
<li><a href="../de457380/index.html">Ultramodernes OpenGL. Teil 2</a></li>
<li><a href="../de457382/index.html">7 Gewohnheiten von Hochleistungsprogrammierern</a></li>
<li><a href="../de457386/index.html">Einf√ºhrung in virtuelle Linux-Schnittstellen: Tunnel</a></li>
<li><a href="../de457390/index.html">Madagaskar - Insel der Kontraste</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>