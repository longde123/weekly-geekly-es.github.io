<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéã üì∂ üíÜüèø Autonome Wetterstation auf dem ATMEGA328P-Controller und batteriebetrieben mit einem drahtlosen Fernbedienungssensor ‚úãüèº üíÖüèø ‚òÄÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Um meinen Raumthermostat zu verbessern , √ºber den ich bereits geschrieben habe , habe ich mich vorgenommen, ihn durch einen drahtlosen Temperatursenso...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Autonome Wetterstation auf dem ATMEGA328P-Controller und batteriebetrieben mit einem drahtlosen Fernbedienungssensor</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470381/"><p>  Um meinen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Raumthermostat zu</a> verbessern <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">, √ºber den ich bereits geschrieben habe</a> , habe ich mich vorgenommen, ihn durch einen drahtlosen Temperatursensor zur Messung der Au√üenlufttemperatur zu erg√§nzen, einen batteriebetriebenen Thermostat zusammenzubauen und die Sender-Empf√§nger-Module RF 433MHz durch ein anderes Paar Funkmodule mit einer l√§ngeren Kommunikationsreichweite bei einer Versorgungsspannung zu ersetzen mehr als 3V.  Im Zuge der L√∂sung dieser Probleme entstand eine autonome Wetterstation, auf die weiter unten eingegangen wird. </p><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dd/vj/6r/ddvj6rih_mxyi4izpiz4iplozik.gif"></div><br><p>  Die Wetterstation besteht aus zwei Knoten, die wir der Einfachheit halber als Analysator und Thermometer bezeichnen.  Kommunikation zwischen Knoten - drahtlos, drahtlos. </p><br><p>  Der Analysator basiert auf dem ATMEGA328P-Controller und misst die Temperatur und Luftfeuchtigkeit im Raum (Temperatur- und Feuchtigkeitssensor DHT22) sowie die Versorgungsspannung des Analysators, die von zwei 1,5-V-AA-Batterien bereitgestellt wird.  Die Steuerung empf√§ngt ein Signal vom LoRa-Empf√§nger, das Informationen vom Thermometer (Fernbedienungssensor) √ºber Funk empf√§ngt.  Informationen von der Steuerung werden auf dem LCD des NOKIA 5110 angezeigt. </p><br><p>  Das ebenfalls am ATMEGA328P-Controller montierte Thermometer misst die Au√üentemperatur (Temperatursensor DS18B20) und die Versorgungsspannung der Fernbedienung, die auf zwei 1,5-V-AA-Batterien aufgebaut ist. Der LoRa-Messumformer dieser Einheit √ºbertr√§gt die Temperatur und die Versorgungsspannung an den Analysator. </p><br><p>  Der ATMEGA328P-Controller und der LoRa-Sender des Thermometers werden in den Ruhemodus versetzt, um nach den Messungen Batteriestrom zu sparen und Informationen zu senden.  Die Versorgungsspannung des DS18B20-Sensors wird nur f√ºr die Dauer der Temperaturmessung programmgesteuert angelegt.  Das Messen und Senden von Daten vom Thermometer erfolgt in einem Zeitraum von etwa einer Minute. </p><br><p>  Im gleichen Work-Sleep-Modus arbeitet auch der Analysator.  Die Dauer der Steuerung und des Empf√§ngeranalysators f√ºr einige Sekunden l√§nger als eine Minute.  Dies geschieht, um das Signal vom Thermometer sicher zu empfangen - schlie√ülich sind der Betrieb des Thermometers und des Analysators nicht synchronisiert.  Anschlie√üend werden der ATMEGA328P und der LoRa-Empf√§nger f√ºr 14 Minuten in den Ruhemodus versetzt, bevor sie aufwachen und den n√§chsten Zyklus starten.  DHT22 liefert nur Strom w√§hrend der Messung. </p><br><p>  Zum Programmieren des Ruhemodus der ATMEGA328P-Controller wird die Bibliothek LowPower.h verwendet. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mit dem Entladen der Batterien nimmt der Spannungswert auf ihnen ab.</a> </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/ob/hi/6z/obhi6ztutl3wckifbjzbg0p-pcs.png"></div><br><p>  Die untere Grenze der Betriebsspannung f√ºr den ATMEGA328P-Controller betr√§gt 1,8 V.  Gleichzeitig wurde die Werkseinstellung der Sicherung ATMEGA328P durchgef√ºhrt, um den Schwellenwert der Versorgungsspannung von 2,7 V zu √ºberwachen. Daher m√ºssen die Werkseinstellungen der Sicherung auf den √úberwachungsschwellenwert von 1,8 V ge√§ndert werden, um den Betrieb des Controllers bei Stromverbrauch entladener Batterien zu gew√§hrleisten. </p><br><p>  Der interne Reglergenerator startet m√∂glicherweise nicht bei einer Frequenz von 16 MHz mit einer Versorgungsspannung von 3 V oder etwas niedriger.  Beide Controller arbeiten mit 16 MHz Quarz bei einer reduzierten Versorgungsspannung von 2,7 ... 2,8 V, daher habe ich den 16 MHz Quarz nicht auf 8 MHz ge√§ndert. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/or/kl/rf/orklrfdoalqoh5d3gsqxde-9x_c.jpeg"></div><br><p>  F√ºr die Montage des Ger√§ts ben√∂tigen Sie Komponenten, deren Liste und deren gesch√§tzte Kosten zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AliExpress-</a> Website-Preisen in der Tabelle aufgef√ºhrt sind. </p><br><table border="1"><tbody><tr><td>  <strong>Komponente</strong> </td><td>  <strong>Preis, $</strong> </td></tr><tr><td colspan="2">  <em>Analysator</em> </td></tr><tr><td>  ATMEGA328P-PU-Controller </td><td>  1,59 </td></tr><tr><td>  Temperatur- und Feuchtigkeitssensor DHT22 </td><td>  2,34 </td></tr><tr><td>  LoRa Ra-01 Sender </td><td>  3,95 </td></tr><tr><td>  LCD NOKIA 5110 </td><td>  1,91 </td></tr><tr><td>  Steckbrett (Montage), Montagekabel, AA-Batterien, 16-MHz-Quarzresonator, Widerst√§nde usw. </td><td>  4.00 </td></tr><tr><td colspan="2">  <em>Thermometer</em> </td></tr><tr><td>  ATMEGA328P-PU-Controller </td><td>  1,59 </td></tr><tr><td>  Temperatursensor DS18B20 </td><td>  0,63 </td></tr><tr><td>  LoRa Ra-01 Sender </td><td>  3,95 </td></tr><tr><td>  Entwicklungsplatine (Glasfaser), Montagekabel, AA-Batterien, 16-MHz-Quarzresonator, Widerst√§nde usw. </td><td>  4.00 </td></tr><tr><td>  <strong>Insgesamt (ungef√§hr):</strong> </td><td>  <strong>24</strong> </td></tr></tbody></table><br><p></p><h4>  Analysator </h4><br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/of/fu/xd/offuxdrjbzlmia_xnnsfqeliisc.jpeg"></div><br><p>  Das Gehirn des Analysators ist ein ATMEGA328P-Controller.  Es empf√§ngt Signale vom DHT22-Sensor und kommuniziert √ºber das SPI-Protokoll mit dem LoRa-Empf√§nger und dem NOKIA 5110-Display. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/b3/wl/9b/b3wl9b2zijmxgg8yso3xxt1faxq.png"></div><br><p></p><p>  Im Internet gibt es viele Beschwerden √ºber die geringe Genauigkeit des DHT22.  Heute gibt es eine Alternative: modernere Temperatur- und Feuchtigkeitssensoren <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">HTU21 (GY21)</a> , (Vcc = 3 ... 5 V), <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Si7021</a> , (Vcc = 1,9 ... 3,6 V), <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SHT21</a> , (Vcc = 2,1 .... 3,6 V). </p><br><p>  Ich verwende DHT22, da die Diskrepanz zwischen den Feuchtigkeitswerten meiner Probe dieses Sensors und dem im Handel erh√§ltlichen LaCrosse WS-9024IT-Thermo-Hygrometer nicht mehr als 8 Einheiten betr√§gt, was f√ºr Haushaltszwecke durchaus akzeptabel ist.  Die Diskrepanz zwischen den Feuchtigkeitswerten nimmt stark zu, wenn die Versorgungsspannung des DHT22 unter 3 V liegt.  Dies ist verst√§ndlich, da die Versorgungsspannung von DHT22 innerhalb von 3 ... 5V liegen sollte.  Zusammenfassend l√§sst sich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">sagen</a> , dass der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Si7021-</a> Sensor idealerweise unter diesen Bedingungen in die Analysatorschaltung passt. </p><br><p>  Im Bild unten - die Pinbelegung der Elemente der Wetterstation. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/gq/ut/go/gqutgob1fbq1hd85xtnovdvphfw.png"></div><br><p></p><p>  Fusion und viele weitere Steuerungen, einschlie√ülich ATMEGA328P, k√∂nnen mit dem Dienstprogramm SinaProg gelesen und bearbeitet werden.  Wenn Sie dieses Programm zum ersten Mal kennenlernen, versuchen Sie trotz der intuitiven Benutzeroberfl√§che nicht, nach der Installation der Anwendung mit der Arbeit zu beginnen.  Lesen Sie zuerst <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesen Artikel,</a> in dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">HWman</a> die erforderlichen SinaProg-Add-Ons bereitstellt, wenn Sie das Arduino UNO-Board als Bootloader verwenden. </p><br><p>  Ich empfehle Ihnen, zuerst die Werkseinstellungen des Fusion ATMEGA328P zu lesen und deren Werte zu speichern, um im Fehlerfall zu ihnen zur√ºckzukehren.  In meinen Controllern sind die Werkseinstellungen f√ºr das Sicherungsbit: <strong>LOW: 0xFF, HIGH: 0xDE, EXTENDED: 0x05</strong> (Vcc = 2,7 V, BODLEVEL = 101).  Neue Sicherungen zur √úberwachung des 1,8-V-Schwellenwerts, den Sie einstellen m√∂chten: <strong>LOW: 0xFF, HIGH: 0xDE, EXTENDED: 0x06</strong> (Vcc = 1,8 V, BODLEVEL = 110). </p><br><p>  Die Analysatorskizze zum Laden in den ATMEGA328P befindet sich unter dem Spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">Analysatorskizze</b> <div class="spoiler_text">  `` `cpp <br>  / * <br>  Autonome Wetterstation auf dem ATMEGA328P-Controller und batteriebetrieben mit einem drahtlosen Fernbedienungssensor, Analysator <br>  https://habr.com/de/post/470381/ <br>  * / <br><br>  #include &lt;SPI.h&gt; <br>  #include &lt;LoRa.h&gt; <br><br>  #include &lt;DHT.h&gt; <br>  #define DHTPIN 3 // Mit welchem ‚Äã‚Äãdigitalen Pin wir verbunden sind <br>  #define DHTTYPE DHT22 // DHT 22 (AM2302), AM2321 <br>  DHT dht (DHTPIN, DHTTYPE); <br><br>  float tin = 0; <br>  int Hin = 0; <br>  float BatteryInLevel;  // Basisbatteriespannung <br>  String LoRaData, Tout_str, BatteryInLevel_str, BatteryOutLevel_str; <br><br>  // schlafen <br>  #include &lt;LowPower.h&gt; <br>  #define PowerDHT (4) // DHT22 Power Pin <br>  unsigned int sleepCounter; <br><br>  // Nokia 5110 <br>  #include &lt;SPI.h&gt; <br>  #include &lt;Adafruit_GFX.h&gt; //https://esp8266.ru/forum/threads/esp8266-5110-nokia-lcd.1143/#post-16942 <br>  #include &lt;Adafruit_PCD8544.h&gt; //https://esp8266.ru/forum/threads/esp8266-5110-nokia-lcd.1143/#post-16942 <br><br>  // Timer <br>  #include &lt;SimpleTimer.h&gt; <br>  SimpleTimer Timer; <br><br>  Adafruit_PCD8544 display = Adafruit_PCD8544 (5, 7, 6); <br><br>  void sendSensor () { <br>  digitalWrite (PowerDHT, 1); <br>  Verz√∂gerung (2000); <br>  Hin = dht.readHumidity (); <br>  Tin = dht.readTemperature (); <br><br>  / * if (isnan (Hin) || isnan (Tin)) { <br>  // Serial.println ("Fehler beim Lesen vom DHT-Sensor!"); <br>  zur√ºck <br>  } * / <br><br>  digitalWrite (PowerDHT, 0); <br><br>  // Batteriespannungsmessung: <br>  analogReference (INTERN); <br>  int sensorValue = analogRead (A4); <br>  BatteryInLevel = (sensorValue * 3.2 / 1024); <br>  }} <br><br>  void draw () { <br>  display.clearDisplay (); <br>  // Zinn <br>  { <br>  display.setTextSize (2); <br>  display.setCursor (8, 0); <br>  display.println (Tin, 1);  // eine Dezimalstelle <br>  display.setCursor (68, 0); <br>  display.println ("C"); <br>  }} <br>  // hin <br>  { <br>  display.setTextSize (2); <br>  display.setCursor (8, 16); <br>  display.println (String (Hin) + "%"); <br>  }} <br>  // Tout <br>  { <br>  char chr_Tout [12]; <br><br>  Tout_str.toCharArray (chr_Tout, 5); <br>  display.setTextSize (1); <br>  display.setCursor (50, 16); <br>  display.println (String (chr_Tout) + "C"); <br>  }} <br>  // Batteriestand <br>  { <br>  char chr_BatteryOutLevel [12]; <br><br>  BatteryOutLevel_str.toCharArray (chr_BatteryOutLevel, 4); <br>  display.setTextSize (1); <br>  display.setCursor (2, 32); <br>  display.println ("BAT Out:" + String (chr_BatteryOutLevel) + "V"); <br>  }} <br>  // Batterie in F√ºllstand <br>  { <br>  display.setTextSize (1); <br>  display.setCursor (2, 40); <br>  display.println ("BAT In:‚Äû); <br>  display.setCursor (56, 40); <br>  display.println (BatteryInLevel, 1);  // eine Dezimalstelle <br>  display.setCursor (74, 40); <br>  display.println ("V"); <br>  }} <br><br>  display.display (); <br>  / * <br>  Serial.println ("Tin:" + String (Tin) + "* C"); <br>  Serial.println ("Hin:" + String (Hin) + "%"); <br>  Serial.println ("Tout:" + String (Tout_str) + "* C"); <br>  Serial.println ("BAT_In:" + String (BatteryInLevel) + "V"); <br>  Serial.println ("BAT_Out:" + String (BatteryOutLevel_str) + "V"); <br>  Serial.println ("......"); <br>  * / <br>  }} <br><br>  void sleepDevice () { <br>  // sleepCounter = 65 - 10 min <br>  // sleepCounter = 91 - 14 min <br>  f√ºr (sleepCounter = 91; sleepCounter&gt; 0; sleepCounter--) // 91 !!! <br>  { <br>  LoRa.sleep (); <br>  LowPower.powerDown (SLEEP_8S, ADC_OFF, BOD_OFF); <br>  }} <br>  LoRa.sleep (); <br>  }} <br><br>  void SignalReception () { <br>  // versuche das Paket zu analysieren <br>  int packetSize = LoRa.parsePacket (); <br>  if (packetSize) { <br>  // Paket lesen <br>  while (LoRa.available ()) { <br>  LoRaData = LoRa.readString (); <br>  // Serial.println ("Accepted:" + (LoRaData)); <br>  }} <br>  int pos1 = LoRaData.indexOf ('#'); <br>  Tout_str = LoRaData.substring (0, pos1); <br>  BatteryOutLevel_str = LoRaData.substring (pos1 + 1, LoRaData.length ()); <br>  }} <br>  }} <br><br>  void setup () { <br>  //Serial.begin(9600); <br>  PinMode (PowerDHT, OUTPUT); <br><br>  // Anzeige initialisieren und l√∂schen <br>  display.begin (); <br>  display.clearDisplay (); <br>  display.display (); <br>  display.setContrast (60);  // Kontrast einstellen <br><br>  display.clearDisplay (); <br>  display.setTextSize (2); <br>  display.setCursor (12, 16); <br>  display.println ("&gt;&gt;&gt;&gt;&gt;");  // Anzeige des Arbeitsbeginns beim Einschalten <br>  display.display (); <br><br>  dht.begin (); <br>  sendSensor (); <br>  draw (); <br><br>  while (! LoRa.begin (433E6)) { <br>  //Serial.println ("."); <br>  Verz√∂gerung (500); <br>  }} <br>  // Der Bereich f√ºr das Synchronisationswort liegt zwischen "0 - 0xFF". <br>  LoRa.setSyncWord (0xF3); <br>  //Serial.println (wonLoRa Initializing "); <br>  timer.setInterval (20000, sendSensor); <br>  timer.setInterval (5000, draw); <br>  timer.setInterval (65000, sleepDevice); <br>  }} <br><br>  void loop () { <br>  SignalReception (); <br>  timer.run (); <br>  }} <br>  `` `` </div></div><br><br><p>  Um mit den ATMEGA328P-Controllern zu arbeiten, verwende ich die Arduino UNO-Karte als Programmierer.  Auf Youtube gibt es ein gutes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Video √ºber die Installation des Bootloaders</a> und das Herunterladen von Skizzen auf den ATMEGA328-Controller mithilfe der Arduino UNO-Karte. </p><br><p>  In der Skizze wurden die Befehle zur Ausgabe an den Serial Port Monitor (Serial) auskommentiert.  Gegebenenfalls auskommentieren. </p><br><p>  Der Zyklus beginnt mit dem Abh√∂ren der Sendung und dem Empfangen von Informationen durch den LoRa-Empf√§nger.  Der Timer stellt die H√∂rzeit auf 65 Sekunden ein.  Zu diesem Zeitpunkt werden die Informationen auf dem NOKIA-Display mit einem Zeitraum von 5 Sekunden aktualisiert. Mit einem Zeitraum von 20 Sekunden (3 Mal) misst der DHT22-Sensor Temperatur, Luftfeuchtigkeit und den Spannungspegel der Batterien √ºber einen der Analogeing√§nge des Controllers.  Die Versorgungsspannung zum DHT22 wird nur bei Messungen mit einer Mindestverz√∂gerung von 2 Sekunden angelegt, bei denen der Sensor noch arbeitet.  Der Ausgang des ADC in der Skizze wird auf die Spannung der neuen Batterien skaliert, die 3,2 V (1,6 V x 2) betr√§gt.  Die Abh√∂rzeit der Luft wurde etwas mehr als 1 Minute gew√§hlt, um sicher ein Paket von einem Thermometer zu empfangen, das bei einer √úbertragung mit einer Dauer von 1 Minute arbeitet, aber mehr dazu weiter unten.  Dann werden in der 62. Sekunde die Steuerung und der Empf√§nger in den Ruhemodus versetzt, der ungef√§hr 14 Minuten dauert, d.h.  Die Dauer des Arbeits- / Schlafzyklus des Analysators betr√§gt ca. 15 Minuten.  Ich stelle fest, dass der Schlafmodus im Analyseger√§t eine erzwungene Ma√ünahme ist, mit der der Verbrauch erheblich gesenkt werden soll. </p><br><p>  Zum Vergleich zeigt die folgende Tabelle die Eigenschaften des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">LaCrosse WS-9024IT-Thermohygrometers</a> und des Analysators aus diesem Projekt. </p><br><p></p><table border="1"><tbody><tr><td>  <strong>Parameter</strong> </td><td>  <strong>LaCrosse WS-9024IT</strong> </td><td>  <strong>SadilTM</strong> </td></tr><tr><td>  Ern√§hrung </td><td>  2xAA, 3B, Durasell </td><td>  2xAA, 3V, GP Ultra +, 1800 mAh </td></tr><tr><td>  Schlafkonsum </td><td></td><td>  350 ŒºA (10 ŒºA) </td></tr><tr><td>  Schlafdauer </td><td></td><td>  14 min </td></tr><tr><td>  Betriebsverbrauch </td><td>  &lt;200 ŒºA </td><td>  12-18 mA </td></tr><tr><td>  Arbeitsdauer </td><td></td><td>  ca. 1 min </td></tr><tr><td>  Arbeits- / Schlafzyklusperiode </td><td></td><td>  15 min </td></tr><tr><td>  Betriebszeit </td><td>  ungef√§hr 2 Jahre </td><td>  etwa 2,5 Monate </td></tr></tbody></table><br><p>  Der aktuelle Verbrauch von LaCrosse tanzt sehr stark.  In der Tabelle habe ich den gemessenen Spitzenwert angegeben, um die Reihenfolge des Verbrauchs anzuzeigen: nicht mehr als zweihundert Mikroampere. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tg/h0/ke/tgh0kev0vv-b_tmlefcjddxmqlg.gif"></div><br><p>  Ich wollte die Tabelle mit den Ergebnissen √§hnlicher Amateurentwicklungen erg√§nzen, fand aber nichts.  Wahrscheinlich, weil die meisten Amateure Informationen von Sensoren an einen Computer, ein Tablet, ein Smartphone oder auf dem Weg zu einem der Dienste im Netzwerk ausgeben, bei denen das Problem der Einsparung der Akkulaufzeit einfach nicht besteht. </p><br><p>  Der Hauptfaktor f√ºr den Schlaf des Analysators (350 ŒºA) ist das LCD.  Wenn Sie es ausschalten, sinkt der Verbrauch auf 10 ŒºA.  Der Spitzenverbrauch von 18 mA tritt auf, wenn der LoRa-Empf√§nger das Signal vom Sender empf√§ngt, das Signal jedoch einige Mikrosekunden dauert.  Diese Zeit ist sehr kurz im Vergleich zu der Minute, in der sich der Empf√§nger im H√∂rmodus befindet, und dem Verbrauch von 10 mA. Daher habe ich diesen kurzfristigen Spitzenwert bei der Berechnung der Betriebszeit f√ºr einen Batteriesatz nicht ber√ºcksichtigt. </p><br><p>  Berechnung der Arbeitszeit. <br>  Durchschnittliche Stromaufnahme: 10 mA / 15 + 0,35 mA = 1,0 mA, wobei 15 das Tastverh√§ltnis ist.  Betriebszeit: 1800 mA * Stunde / 1,0 mA = 1800 Stunden (2,5 Monate). <br>  Ich werde klarstellen: <br>  - Die Berechnung ist sehr ungef√§hr. <br>  - Die Betriebszeiten von LaCrosse basieren auf meinen eigenen Erfahrungen.  Ich habe dieses Ger√§t f√ºr eine lange Zeit gehabt. <br></p><br><h4>  Thermometer </h4><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/rp/tb/nx/rptbnxv-nlwql3ap7i1rcjdf_wk.jpeg"></div><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die Kapazit√§t und Spannung von Batterien bei kaltem Wetter werden stark reduziert</a> .  Um die Batterien und das Ger√§t insgesamt keinen so starken Tests auszusetzen, habe ich nur den Temperatursensor DS18B20 au√üerhalb des Raums herausgenommen, und das Ger√§t und die Batterien befinden sich im Raum.  Der DS18B20 wird √ºber ein d√ºnnes dreiadriges Kabel mit der Host-Karte verbunden.  Ich habe diese L√∂sung in meiner seriellen Wetterstation entdeckt - die Entwickler sind sich sicher, dass es in der Wohnung immer eine L√ºcke zum Verlegen von Dr√§hten mit einem Durchmesser von mehreren Millimetern geben wird. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/ic/vq/me/icvqmeepxsfgd9ut_hhcais3xle.jpeg"></div><br><p>  Die Sicherungen f√ºr das Thermometer ATMEGA328P sind die gleichen wie f√ºr das Analyseger√§t. </p><br><p>  Die Thermometerbaugruppe basiert ebenfalls auf dem ATMEGA328P-Controller.  Es empf√§ngt das Signal vom DS18B20-Sensor, misst die Versorgungsspannung und steuert den LoRa-Sender. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/0d/ie/ww/0diewwzov4r4gwbrojlrvbyzbrq.png"></div><br><p></p><p>  Die Thermometerskizze befindet sich unter dem Spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">Thermometer-Skizze</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*     ATMEGA328P        ,  https://habr.com/ru/post/470381/ */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;OneWire.h&gt; OneWire ds(7); //pin 13, Atmega328P #include &lt;SPI.h&gt; #include &lt;LoRa.h&gt; #include &lt;LowPower.h&gt; #define PowerDS18B20 (6) //pin 12 (Atmega328P), e DS18B20 unsigned int sleepCounter; // ,    float Tout; // int i; //         (20   1 ) String messageTout; // LoRa- float batteryLevel; //   const int batteryPin = A0; // pin 23 (Atmega328P),        void Measurement () { //  byte data[2]; digitalWrite(PowerDS18B20, 1); ds.reset(); ds.write(0xCC); //     (1 ) ds.write(0x44); //    delay(700); ds.reset(); ds.write(0xCC); ds.write(0xBE); //      data[0] = ds.read(); data[1] = ds.read(); Tout = ((data[1] &lt;&lt; 8) | data[0]) * 0.0625; // Serial.println("Tout= "+ String(Tout)); digitalWrite(PowerDS18B20, 0); //   : analogReference(INTERNAL); int sensorValue = analogRead(A0); batteryLevel = (sensorValue * 3.2 / 1024); // Serial.println("BAT= "+ String(batteryLevel)); } void SetSynchLoRa () { int counter = 0; while (!LoRa.begin(433E6) &amp;&amp; counter &lt; 10) { // Serial.print("."); counter++; delay(500); } LoRa.setTxPower(4); //  2-20  /* if (counter == 10) { // Serial.println("Failed to initialize ..."); }*/ LoRa.setSyncWord(0xF3); } void SendMessage () { //   (,  ) messageTout = String(Tout) + "#" + String(batteryLevel); // Serial.println(messageTout); delay(250); LoRa.beginPacket(); LoRa.print(messageTout); LoRa.endPacket(); } void setup() { //Serial.begin(9600); // Serial.println("Initializing ..."); pinMode(PowerDS18B20, OUTPUT); SetSynchLoRa (); } void loop() { //Serial.println(""); //Serial.println("i = " + String(i)); if (i &gt;= 30) { // i &gt;= 30 (1 ) ‚Äî   (,  ‚Äî 1 /1 ) for (sleepCounter = 5; sleepCounter &gt; 0; sleepCounter--) { LoRa.sleep (); LowPower.powerDown(SLEEP_8S, ADC_OFF, BOD_OFF); } Measurement (); SendMessage (); LoRa.sleep (); } else { //   1 ,  ‚Äî 1 /2  Measurement (); SendMessage (); delay (1000); } i++; if (i &gt;= 30) i = 30; //    }</span></span></span></span></code> </pre> </div></div><br><p>  Ein Paar LoRa-Sender-Empf√§nger bietet eine stabile Kommunikation in einer Entfernung von 1,5 km mit direkter Sicht und bis zu 300 m in st√§dtischen Gebieten, nat√ºrlich bei maximaler oder nahezu maximaler Sendeleistung: 17-20 dB.  F√ºr eine stabile Verbindung innerhalb der Wohnung reichten 4 dB aus. </p><br><p>  Wenn die Stromversorgung angeschlossen ist, arbeitet das Thermometer zun√§chst eine Minute lang im Intensivmodus.  Es misst die Temperatur und Spannung der Batterien und sendet ihre Werte alle 2 Sekunden in die Luft.  Dies dient der Bequemlichkeit.  Angenommen, Sie m√ºssen keine Minute warten, wenn Sie Batterien austauschen oder Fehler beheben.  Informationen vom Sensor werden in den ersten Sekunden nach dem Anschlie√üen der Batterien des Thermometers und des Analysators auf dem Analysator-Display angezeigt.  Nat√ºrlich sollten Sie sich beeilen und zwischen dem Anschlie√üen der Batterien an beiden Knoten keine Zeitspanne von mehr als einer Minute einlegen. </p><br><p>  Dann geht der Fernbedienungssensor in den normalen Modus.  Nach dem Messen und Senden von Informationen, die etwas l√§nger als die erste Sekunde dauern, werden die Steuerung und der Sender f√ºr ca. 1 Minute in den Software-Ruhemodus versetzt. </p><br><p>  Berechnung der Arbeitszeit. <br>  Durchschnittliche Stromaufnahme: 14 mA / 60 + 0,005 mA = 0,24 mA, wobei 60 das Tastverh√§ltnis ist.  Betriebszeit: 1800 mA * Stunde / 0,24 mA = 7500 Stunden (10 Monate). <br>  Bisherige Klarstellungen zur Genauigkeit der berechneten Betriebszeit eines einzelnen Batteriesatzes bleiben g√ºltig. <br></p><br><p>  Und eine Vergleichstabelle.  Es enth√§lt die Ergebnisse einiger √§hnlicher Projekte aus dem Internet. </p><br><table border="1"><tbody><tr><td>  <strong>Parameter</strong> </td><td>  <strong>LaCrosse WS-9024IT</strong> </td><td>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Maniacbug</a></strong> </td><td>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">avs24rus</a></strong> </td><td>  <strong>SadilTM</strong> </td></tr><tr><td>  Ern√§hrung </td><td>  2xAAA, 3B, Durasell </td><td>  3 V, CR2450 Renata, 540 mAh </td><td>  3 V, CR2450, 550-610 mAh </td><td>  2xAA, 3V, GP Ultra +, 1800 mAh </td></tr><tr><td>  Schlafkonsum </td><td></td><td>  0,14 mA (&amp; agr;) </td><td>  14 ŒºA </td><td>  5 ŒºA </td></tr><tr><td>  Schlafdauer </td><td></td><td></td><td></td><td>  1 min </td></tr><tr><td>  Betriebsverbrauch </td><td>  &lt;700 ŒºA </td><td>  13,57 mA </td><td>  16 - 18 mA </td><td>  14 mA </td></tr><tr><td>  Arbeitsdauer </td><td></td><td>  0,027 Sek </td><td></td><td>  1 Sek </td></tr><tr><td>  Arbeits- / Schlafzyklusperiode </td><td></td><td>  1 min </td><td>  10 min </td><td>  1 min </td></tr><tr><td>  Betriebszeit </td><td>  ungef√§hr 2 Jahre </td><td></td><td>  mehr als 0,5 Jahre </td><td>  etwa 10 Monate </td></tr></tbody></table><br><p>  Wenn die Knoten fehlerfrei zusammengesetzt sind, sehen wir auf dem Display das folgende Bild: </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/vm/ry/-9/vmry-9owzy-rtsulc5mz5ghzh2g.png"></div><br><p>  Aus den Vergleichstabellen ist ersichtlich, dass der Spitzenverbrauch von Amateurger√§ten um eine Gr√∂√üenordnung h√∂her ist als bei den analogen Funktionen des industriellen LaCrosse.  Zum Beispiel 14 mA gegen√ºber 700 ŒºA f√ºr den Fernsensor und 10 ... 18 mA gegen√ºber 200 ŒºA f√ºr den Analysator.  Ein derart auff√§lliger Unterschied im Maximalverbrauch erkl√§rt sich meiner Meinung nach dadurch, dass die Steuerungen in Amateurschaltungen mit der Arduino IDE-Plattform, schweren Funktionen und Bibliotheken sowie in Industrieprodukten programmiert werden - h√∂chstwahrscheinlich in einer der Low-Level-Sprachen oder beispielsweise in C. ++ (√ºbrigens die Basissprache von Arduino) oder C (C).  Wenn Sie diese Sprachen verwenden, k√∂nnen Sie sicher einen Verbrauch erzielen, der mit Industriedesigns vergleichbar ist.  Dies wurde jedoch von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">HWman</a> in seiner Ver√∂ffentlichung ‚Äû <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Warum viele Arduino nicht m√∂gen</a> ‚Äú sehr √ºberzeugend experimentell gezeigt.  Das Ausf√ºhren der einfachsten Skizze von bis zu einem Dutzend Zeilen (Blink), die in der Arduino IDE in einem Fall und in einem anderen ausgef√ºhrt wird - ‚Äûeinfaches C‚Äú, wie der Autor im Video sagt, f√ºhrt zu einem 26-fachen Leistungsverlust.  Kurz gesagt, ein erh√∂hter Ressourcenverbrauch ist eine Geb√ºhr f√ºr Komfort und ein geringer Aufwand seitens des Programmierers - der Rest wird von den ‚Äûgefr√§√üigen‚Äú Funktionen der Entwicklungsumgebung f√ºr ihn in Arduino erledigt.  Ich gehe davon aus, dass Sie zumindest die Grundlagen von C / C ++, dessen Funktionen von der Arduino IDE kompiliert werden, belasten und beherrschen m√ºssen. </p><br><h4>  Schlussfolgerungen </h4><br><p>  ‚Ä¢ Zusammengebaute Analysatoren und Thermometer verbrauchen im Vergleich zu Industriedesigns zu viel Strom. </p><br><p>  ‚Ä¢ Ein Drittel bietet sich f√ºr die beiden Batterien in den Stromkreisen an, dann werden die folgenden Probleme automatisch gel√∂st: Die Sicherung muss nicht neu installiert werden, die Steuerung arbeitet mit einer Frequenz von 16 MHz, die Sensoren DHT22, DS18B20 sind weit von der unteren Schwelle ihrer Versorgungsspannung entfernt.  Letzteres ist wichtig, da die Versorgungsspannung nicht direkt an die Sensoren geliefert wird, sondern programmgesteuert √ºber den Schl√ºssel vom Pin des Controllers, auf den sie um etwa 1 V abf√§llt. </p><br><p>  ‚Ä¢ Durch die Verwendung von LoRa-Funkmodulen mit einer programmierbaren Sendeleistung von 4 dB konnte eine stabile Verbindung innerhalb der Wohnung mit der Stromversorgung der Module aus zwei AA-Batterien hergestellt werden. </p><br><h4>  Verwandte Links </h4><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Niedrigenergie-Funksensor</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Drahtloser Beleuchtungssensor CR2450</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Drahtloser Temperatur-, Feuchtigkeits- und Atmosph√§rendrucksensor am nRF52832</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Drahtloses Thermometer</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Verwandeln Sie Arduino in einen vollwertigen AVRISP-Programmierer</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Lora und schlaf</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Erfahren Sie mehr √ºber die ATmega328P-Konfigurationsbits und deren Verwendung mit einem externen Quarzkristall</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AVR Fusion Rechner</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Warum viele Leute Arduino nicht m√∂gen</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Grand Batterietest</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Batterien in der K√§lte</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de470381/">https://habr.com/ru/post/de470381/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de470365/index.html">Arbeiten mit USB Custom HID unter Android</a></li>
<li><a href="../de470367/index.html">Food Design Digest, September 2019</a></li>
<li><a href="../de470373/index.html">PHP Digest Nr. 165 (23. September - 7. Oktober 2019)</a></li>
<li><a href="../de470375/index.html">Wenn Tests und Autotests ben√∂tigt werden, schauen Sie aus dem Supersystem</a></li>
<li><a href="../de470379/index.html">Das Problem der drei Berge, die schwer fassbare Theorie des Geistes und das Problem der Periodisierung der kindlichen Entwicklung</a></li>
<li><a href="../de470385/index.html">Der Goldene Schnitt in der Wirtschaft - 2</a></li>
<li><a href="../de470387/index.html">Entschuldigung, MacOS-Benutzer, aber Apple ist zu weit gegangen</a></li>
<li><a href="../de470393/index.html">Cleverness Brille - Eindr√ºcke von Pegasi Dream Glasses</a></li>
<li><a href="../de470395/index.html">OWASP API-Sicherheit Top 10 RC</a></li>
<li><a href="../de470399/index.html">Wie man Kinder in die IT einf√ºhrt und wie man mit ML in .NET arbeitet: ein Interview mit Dmitry Soshnikov (Microsoft)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>