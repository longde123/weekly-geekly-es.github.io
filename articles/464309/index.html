<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö∂üèª üåæ üé® Bot√≥n de llamada de bricolaje. Raspberry Pi, MajorDoMo, Freeswitch y Linphonec üëçüèΩ üë®üèº‚Äçü§ù‚Äçüë®üèª üë©üèº‚Äçü§ù‚Äçüë©üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hace alg√∫n tiempo, tuve la necesidad de comunicarme con una persona despu√©s de una enfermedad que no pod√≠a usar el tel√©fono f√≠sicamente. Se necesitaba...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bot√≥n de llamada de bricolaje. Raspberry Pi, MajorDoMo, Freeswitch y Linphonec</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464309/">  Hace alg√∫n tiempo, tuve la necesidad de comunicarme con una persona despu√©s de una enfermedad que no pod√≠a usar el tel√©fono f√≠sicamente.  Se necesitaba un dispositivo de llamada simple, se realiz√≥ una llamada de voz con solo tocar un bot√≥n.  Sin embargo, la necesidad desapareci√≥, habiendo visitado el hospital √©l mismo, mirando a los pacientes, se pens√≥ que tal soluci√≥n podr√≠a ser √∫til. <br>  Ahora veo el uso personal de este dispositivo como un timbre SIP. <br><br>  Quiz√°s con peque√±as alteraciones, la combinaci√≥n de telefon√≠a VoIP con un sistema de automatizaci√≥n del hogar.  Como opciones de uso: timbre SIP, intercomunicador, sistema de comunicaci√≥n por voz (personal del cliente, director-secretario), etc. <br><br><img src="https://habrastorage.org/webt/lr/x1/5g/lrx15gxymgjqei5tsqgkgzxtaiy.jpeg"><br><br>  Toda la decisi√≥n se toma sobre software libre y de c√≥digo abierto: sistema operativo - Raspbian Stretch (Debian 9), sistema de automatizaci√≥n del hogar - MajorDoMo, servidor VoIP - Freeswitch, cliente de software de telefon√≠a IP con la capacidad de trabajar en modo terminal Linphonec. <br><br>  En esta parte, debajo del corte, hablaremos principalmente sobre la instalaci√≥n del cliente SIP de la consola Linphonec. <br><a name="habracut"></a><br>  Necesitaremos: <br><br><ol><li>  Raspberry Pi - Computadora de placa √∫nica (tengo un modelo Raspberry Pi 3B) </li><li>  Tarjeta de memoria Micro SD de al menos 16 GB, cargador USB, carcasa. </li><li>  Tarjeta de sonido USB (una de las m√°s baratas, Gembird utilizada), micr√≥fono, altavoz (auriculares). </li><li>  Bot√≥n y un par de puentes BBJ para pines GPIO. </li></ol><br>  1. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Primer paso: instalar una imagen de MajorDoMo para RPI</a> <br>  Actualmente, la versi√≥n actual de la imagen para Raspberry Pi es v.  3.40  Aqu√≠ hay una breve descripci√≥n de las im√°genes y los cambios de MajorDoMo: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">Im√°genes b√°sicas de MajorDoMo para Raspberry Pi</a> <br><br>  Despu√©s de la instalaci√≥n y cuando se inicia el sistema, conectando los altavoces al conector 3.5, escucharemos los mensajes del sistema y la direcci√≥n IP de Raspberry. <br><br>  El nombre de usuario predeterminado es: pi contrase√±a: frambuesa. <br><br>  2. Instale FREESWITCH, <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Instalaci√≥n del servidor FRESWITCH VoIP para Raspberry</a> <br><br>  Despu√©s de eso, procedemos a la instalaci√≥n de los componentes necesarios.  Un paso opcional, pero posiblemente √∫til m√°s tarde. <br><br><h4>  Instalar RPi-Monitor </h4><br>  Instale una utilidad de monitor RPI peque√±a pero √∫til que muestra los recursos de nuestro Raspberry PI. <br><br>  RPi-Monitor es un software de monitoreo de placa Raspberry Pi basado en la web.  Esta herramienta puede ser √∫til para controlar el uso de espacio en disco, carga de CPU, memoria y tr√°fico de red, temperatura.  RPI-Monitor es bastante simple de instalar y muestra visualmente informaci√≥n sobre el sistema. <br><br>  En primer lugar, le dar√© un enlace a la fuente: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">RPi-Monitor</a> . <br><br>  Instale la clave p√∫blica RPi-Monitor y agr√©guela a los repositorios de confianza: <br><br><pre><code class="plaintext hljs">sudo apt-get install dirmngr sudo apt-key adv --recv-keys --keyserver keyserver.ubuntu.com 2C0D3C0F sudo wget http://goo.gl/vewCLL -O /etc/apt/sources.list.d/rpimonitor.list</code> </pre> <br>  Luego, actualice el sistema e instale el monitor RPI: <br><br><pre> <code class="plaintext hljs">sudo apt-get update sudo apt-get install rpimonitor</code> </pre><br>  Abra la IP de su computadora en el navegador con el puerto: 8888, en el que se ejecuta el monitor, y vea el estado de RPI. <br><br><img src="https://habrastorage.org/webt/97/xd/rb/97xdrbtse_r_tukes5aqhdz5c_8.png"><br><br><h4>  Instalar una tarjeta de audio USB y configurar el sonido en el sistema operativo Raspberry Pi </h4><br>  Desafortunadamente, nuestra mini computadora Raspberry no tiene su propio micr√≥fono y entrada incorporados.  Por lo tanto, para conectar un micr√≥fono, deber√° usar una tarjeta de sonido USB externa.  Conectamos la tarjeta al puerto USB de Raspberry y ejecutamos el comando (que muestra los dispositivos de sonido en el sistema): <br><br><pre> <code class="plaintext hljs">cat /proc/asound/cards</code> </pre> <br>  Vemos la respuesta con dos tarjetas, bcm2835 - incorporado, externo, definido como dispositivo de audio USB: <br><br>  <i>0 [ALSA]: bcm2835_alsa - bcm2835 ALSA</i> <i><br></i>  <i>bcm2835 ALSA</i> <i><br></i>  <i>1 [Dispositivo]: USB-Audio - Dispositivo de audio USB</i> <i><br></i>  <i>Dispositivo de audio USB GeneralPlus en usb-3f980000.usb-1.4, velocidad m√°xima</i> <br>  El sistema operativo ve nuestra tarjeta de sonido, pero a√∫n no est√° registrada en el sistema. <br><br>  Crea un archivo: <br><br><pre> <code class="plaintext hljs">sudo nano /etc/modprobe.d/alsa-base.conf</code> </pre> <br>  Escribimos (pegamos) la siguiente l√≠nea: <br><br>  <i>opciones snd-usb-audio index = 1</i> <br><br>  Guardar (en el editor Ctrl + X). <br><br>  Crea otro archivo: <br><br><pre> <code class="plaintext hljs">sudo nano /etc/asound.conf</code> </pre> <br>  A√±adir contenido: <br><br><div class="spoiler">  <b class="spoiler_title">contenido del archivo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">pcm.!default { type plug slave { pcm "hw:1,0" } } ctl.!default { type hw card 1 }</code> </pre> <br></div></div><br>  Editamos el siguiente archivo de configuraci√≥n: <br><br><pre> <code class="plaintext hljs">sudo nano /usr/share/alsa/alsa.conf</code> </pre> <br>  Cambie la tarjeta de sonido predeterminada de 0 a 1 (tarjeta USB). Obviamente, 0 por defecto es la salida de sonido incorporada de la minicomputadora, configure los siguientes par√°metros en 2 l√≠neas: <br><br><pre> <code class="plaintext hljs">defaults.ctl.card 1 defaults.pcm.card 1</code> </pre> <br>  Los cambios surtir√°n efecto, despu√©s de reiniciar, sobrecargamos escribiendo en la consola: <br><br><pre> <code class="plaintext hljs">sudo reboot</code> </pre> <br>  Conectamos un micr√≥fono y altavoces (auriculares) a una tarjeta de audio externa.  Despu√©s de reiniciar, ejecute la utilidad de configuraci√≥n de sonido Alsamixer. <br><br><pre> <code class="plaintext hljs">alsamixer</code> </pre> <br>  Vemos nuestros dispositivos que definimos en el sistema por defecto: <br><br><img src="https://habrastorage.org/webt/bx/em/kt/bxemktswfv1xvsofnautaly542i.png"><br><br>  Use las teclas del cursor hacia la izquierda y hacia la derecha, seleccione el dispositivo deseado, arriba y abajo, ajuste, preste atenci√≥n a los s√≠mbolos debajo del dispositivo seleccionado: <br><br>  xOOx: el dispositivo est√° encendido, xMMx: el dispositivo est√° apagado.  Como puede ver en la captura de pantalla, mi micr√≥fono estaba apagado por defecto en el sistema. <br>  Para encender / apagar el dispositivo, debe presionar <b>M</b> en el teclado. <br>  Salga de alsamixer (salga ctr + C). <br>  Comprobando el sonido en el sistema.  Los altavoces y un micr√≥fono est√°n conectados a las salidas USB correspondientes de la tarjeta de sonido. <br><br>  Le damos el comando: <br><br><pre> <code class="plaintext hljs">arecord -D plughw:1,0 -f cd /home/pi/test_record.wav</code> </pre> <br>  Con este comando, se graba un archivo de sonido a trav√©s del micr√≥fono en el directorio apropiado (en nuestro caso, la pi de inicio del usuario).  Dejar de grabar <b>Ctrl + c</b> . <br><br>  Verifique el archivo grabado: <br><br><pre> <code class="plaintext hljs">aplay /home/pi/test_record.wav</code> </pre> <br>  Realizaremos un mejor control m√°s tarde. <br><br><h4>  Instalaci√≥n del cliente de VoIP de la consola Linphonec </h4><br>  No hay tantos programas que puedan funcionar en el sistema operativo sin una interfaz gr√°fica; me decid√≠ por el paquete Linphone. <br><br>  El paquete es bastante grande, tiene muchas caracter√≠sticas potenciales, pero hasta ahora solo necesitamos una peque√±a utilidad Linphonec que pueda funcionar en el terminal y tenga la funci√≥n de respuesta autom√°tica (respuesta autom√°tica). <br><br>  Para ella, se realizar√°n las siguientes acciones. <br><br>  Observo que cuando instalo desde el repositorio Raspbian, se instala una versi√≥n 3.6.1 bastante antigua, que no funciona correctamente con el sistema de sonido ALSA, tuve una p√©rdida de sonido, el programa se bloque√≥ varias veces. <br><br>  Por lo tanto, usar√© una versi√≥n m√°s actual. <br><br>  Para el autoensamblaje del paquete desde las fuentes, instalamos dependencias adicionales: <br><br><pre> <code class="plaintext hljs">sudo apt-get install cmake automake autoconf libtool intltool yasm libasound2-dev libpulse-dev libv4l-dev nasm git libglew-dev</code> </pre><br>  Vaya al directorio de inicio: <br><br><pre> <code class="plaintext hljs">cd /home/pi/</code> </pre> <br>  Descargue el paquete Linphone en s√≠, la descarga tard√≥ unos 20 minutos. <br><br><pre> <code class="plaintext hljs">git clone git://git.linphone.org/linphone-desktop.git --recursive</code> </pre> <br>  No pude compilar y compilar el paquete Linphone desde la primera o incluso la segunda vez.  Por lo tanto, dar√© mi algoritmo de acci√≥n. <br><br>  Paramos casi todos los servicios actualmente en ejecuci√≥n, pero actualmente no utilizados, utilizando el sistema de gesti√≥n de servicios systemctl. <br><br>  Hubo errores durante el ensamblaje, nuestra mini PC simplemente no tiene suficientes recursos.  Lib√©ralos para la instalaci√≥n. <br><br><div class="spoiler">  <b class="spoiler_title">Detener servicios</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">sudo systemctl stop freeswitch.service sudo systemctl stop majordomo.service sudo systemctl stop avahi-daemon.socket sudo systemctl stop avahi-daemon.service sudo systemctl stop mosquitto.service sudo systemctl stop mysql sudo systemctl stop mpd.service sudo systemctl stop mpd.socket sudo systemctl stop homebridge.service sudo systemctl stop nginx.service sudo systemctl stop bluetooth.target sudo systemctl stop bluetooth.service</code> </pre><br></div></div><br>  Por si acaso, podemos hacer un archivo de intercambio temporal (antes de reiniciar) (espacio en el disco duro), que el sistema operativo utiliza en caso de RAM insuficiente. <br>  Para verificar si el archivo de intercambio est√° incluido en nuestra instalaci√≥n Raspbian (Debian) escribiendo: <br><br><pre> <code class="plaintext hljs">sudo swapon --show</code> </pre> <br>  La salida est√° vac√≠a, lo que significa que el sistema no tiene un archivo de intercambio. <br>  Agregue 1G swap y cree un archivo: <br><br><pre> <code class="plaintext hljs">sudo fallocate -l 1G /swapfile</code> </pre> <br>  Solo el usuario root puede leer y escribir en el archivo de p√°gina, por lo que establecemos los permisos correctos: <br><br><pre> <code class="plaintext hljs">sudo chmod 600 /swapfile</code> </pre> <br>  Utilizamos la herramienta mkswap para configurar el √°rea de intercambio de Linux en el archivo y activarlo escribiendo los siguientes comandos: <br><br><pre> <code class="plaintext hljs">sudo mkswap /swapfile sudo swapon /swapfile</code> </pre><br>  Vaya al directorio creado cuando descargue el paquete: <br><br><pre> <code class="plaintext hljs">cd linphone-desktop</code> </pre> <br>  Preparamos para la instalaci√≥n de una versi√≥n sin interfaz gr√°fica: <br><br><pre> <code class="plaintext hljs">sudo ./prepare.py no-ui -DENABLE_OPENH264=ON -DENABLE_WEBRTC_AEC=OFF -DENABLE_UNIT_TESTS=OFF -DENABLE_MKV=OFF -DENABLE_FFMPEG=ON -DENABLE_CXX_WRAPPER=OFF -DENABLE_NON_FREE_CODECS=ON -DENABLE_VCARD=OFF -DENABLE_BV16=OFF -DENABLE_V4L=OFF</code> </pre><br>  Compila utilizando el atributo ‚Äìj4 (es decir, compila 4 hilos al mismo tiempo). <br><br><pre> <code class="plaintext hljs">sudo make -j4</code> </pre> <br>  Al instalar, podemos ver el estado de nuestra computadora en RPI-Monitor: <br><br><img src="https://habrastorage.org/webt/mo/av/vx/moavvxkzq01wxkp5hxayi-oip2y.png"><br><br>  El tiempo de construcci√≥n para m√≠ fue de aproximadamente 30-40 minutos. <br><br>  Los archivos de programa compilados aparecieron en el directorio OUTPUT / no-ui / bin.  Para ejecutar el programa, veamos: <br><br><pre> <code class="plaintext hljs">cd OUTPUT/no-ui/bin</code> </pre> <br>  Verifique la versi√≥n del programa: <br><br><pre> <code class="plaintext hljs">./linphonec -v</code> </pre> <br>  Obtenemos el resultado: versi√≥n: 3.12.0 <br>  Sobrecargando nuestra Frambuesa <br>  Al reiniciar, el archivo de intercambio desaparece, todos los servicios en ejecuci√≥n registrados en el inicio se restauran. <br><br><h4>  Una peque√±a configuraci√≥n inicial de Freeswitch. </h4><br>  El servidor FREESWITCH se instala por defecto en el directorio / usr / local / freeswitch /.  La carpeta conf contiene archivos de configuraci√≥n.  De manera predeterminada, se instala la configuraci√≥n de prueba de vainilla, que en su mayor parte sirve para familiarizarse con la posibilidad de un servidor VoIP y contiene una gran cantidad de ejemplos que son claramente redundantes para uso dom√©stico.  Primero, veamos la configuraci√≥n lista para usar del servidor VoIP. <br><br>  Edite el archivo de configuraci√≥n vars.xml <br><br><pre> <code class="plaintext hljs">sudo nano /usr/local/freeswitch/conf/vars.xml</code> </pre> <br>  En primer lugar, cambie la contrase√±a predeterminada 1234 a un valor diferente, digamos 1111. Si no hace esto, antes de cada llamada se establece una pausa antes de marcar 10 segundos. <br><br>  Por defecto, como escrib√≠ en un art√≠culo anterior, tenemos 20 n√∫meros de suscriptor 1001-1020.  Dialplan tambi√©n se instala por defecto. <br><br>  Por alguna raz√≥n, en estos momentos, en comparaci√≥n con hace seis meses, cuando el m√≥dulo mod_xml_rpc estaba encendido, el servidor se bloqueaba constantemente. <br><br>  Dialplan FreeSWITCH hace un uso extensivo de expresiones regulares.  El plan de marcado predeterminado es responsable de procesar las llamadas, la siguiente secci√≥n del archivo Local_Extension es responsable de enviar a nuestros n√∫meros locales.  Comente algunas l√≠neas: <br><br><pre> <code class="plaintext hljs">sudo nano /usr/local/freeswitch/conf/dialplan/defaults.xml</code> </pre> <br>  Edici√≥n de di√°logo, inserte un s√≠mbolo de comentario en esta secci√≥n: <br><br><div class="spoiler">  <b class="spoiler_title">Edici√≥n de di√°logo de n√∫meros 1001-1019</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Local_Extension"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">condition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">field</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"destination_number"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">expression</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"^(10[01][0-9])$"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">application</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"export"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dialed_extension=$1"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- &lt;action application="bind_meta_app" data="1 bs execute_extension::dx XML features"/&gt; &lt;action application="bind_meta_app" data="2 bs record_session::$${recordings_dir}/${caller_id_number}.${strftime(%Y-%m-%d-%H-%M-%S)}.wav"/&gt; &lt;action application="bind_meta_app" data="3 bs execute_extension::cf XML features"/&gt; &lt;action application="bind_meta_app" data="4 bs execute_extension::att_xfer XML features"/&gt; --&gt;</span></span></code> </pre><br></div></div><br>  <i>Una peque√±a digresi√≥n, en mi opini√≥n, a pesar de la capacidad de trabajo de FS, despu√©s de varios cambios, es mejor rehacer los archivos de configuraci√≥n de FS para usted, incluyendo</i>  <i>suscripci√≥n, plan de marcado, etc., pero no puede incluir todo en un art√≠culo, por lo que recurrimos a nuestro cliente terminal.</i> <br><br><h4>  Configure e inicie el cliente de terminal Linphonec </h4><br>  Ejecute Linphonec en modo de respuesta autom√°tica desde el usuario pi actual: <br><br><pre> <code class="plaintext hljs">/home/pi/linphone-desktop/OUTPUT/no-ui/bin/linphonec -a</code> </pre> <br>  En el primer lanzamiento, Linphonec intenta crear un archivo de base de datos y un archivo de configuraci√≥n.  Sin embargo, el lanzamiento es un error. <br><br><div class="spoiler">  <b class="spoiler_title">errores al iniciar linphonec</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">2019-08-02 18:02:58:715 mediastreamer-error-Connection to the pulseaudio server failed 2019-08-02 18:02:58:946 belle-sip-error-udp bind() failed for ::0 port 5060: Address already in use 2019-08-02 18:02:58:947 belle-sip-error-TCP bind() failed for ::0 port 5060: Address already in use 2019-08-02 18:02:59:126 liblinphone-fatal-Unable to open linphone database. Aborted</code> </pre> <br></div></div><br>  Inicialmente, trataremos con el √∫ltimo error, abriendo el archivo de la base de datos. <br><br>  El archivo de base de datos se crea en el directorio de inicio a lo largo de la siguiente ruta: /home/pi/.local/share/linphone <br>  Un archivo (o directorio) de Linux se considera oculto si su nombre comienza con un punto ".".  Por ejemplo, ".myfile".  Por lo general, las aplicaciones utilizan dichos archivos para almacenar configuraciones, configuraciones y otra informaci√≥n que debe ocultarse al usuario. <br>  Crear un directorio desde el usuario actual (pi) <br><pre> <code class="plaintext hljs">mkdir /home/pi/.local mkdir /home/pi/.local/share mkdir /home/pi/.local/share/linphone</code> </pre> <br>  Iniciamos el programa, el programa comenz√≥, pero da un error: <br><div class="spoiler">  <b class="spoiler_title">Error de apertura de puerto</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">2019-08-07 11:29:32:780 mediastreamer-error-Connection to the pulseaudio server failed 2019-08-07 11:29:32:866 belle-sip-error-udp bind() failed for ::0 port 5060: Address already in use 2019-08-07 11:29:32:866 belle-sip-error-TCP bind() failed for ::0 port 5060: Address already in use</code> </pre> <br></div></div><br>  Descubrimos el primer problema de crear una base de datos; en el lanzamiento inicial, el programa gener√≥ un archivo de base de datos. <br><br>  El error asociado con el sistema de sonido Pulseaudio - no interfiere con el funcionamiento del programa, planeo usar ALSA, si es necesario, siempre se puede instalar un servidor de sonido antes. <br><br>  El segundo: los puertos 5060 est√°n ocupados.  Estos puertos son com√∫nmente utilizados por las aplicaciones SIP.  Podemos salir del programa y dar el comando: <br><br><pre> <code class="plaintext hljs">sudo netstat -tulpn | grep LISTEN</code> </pre> <br>  Veremos que el puerto 5060 usa nuestro servidor VoIP FREESWITCH.  Bueno, usaremos puertos libres. <br><br>  Volvemos al programa linphonec.  Y haz una peque√±a configuraci√≥n. <br><br>  En primer lugar, cambie el puerto para Linfon, luego indique el registro en el servidor VoIP, verifique el estado de registro y mire la lista de tarjetas de sonido, la tarjeta utilizada y config√∫rela en un USB externo (con el √≠ndice en el programa Linphone - 2): <br><br><pre> <code class="plaintext hljs">ports sip 5062 register sip:1001@192.168.15.13 192.168.15.13 1111 linphonec&gt; help register status register soundcard list soundcard show soundcard use 2 soundcard show</code> </pre><br><img src="https://habrastorage.org/webt/o3/1u/3d/o31u3dvxihunuxmqclxmbfkwfng.png"><br><br>  En el equipo de registro, utilizamos el siguiente formato: ID de usuario Sip: de forma predeterminada, tenemos 20 suscriptores con los n√∫meros 1001-1019.  Estos n√∫meros son los nombres de usuario de los suscriptores: inicio de sesi√≥n del suscriptor @ [nombre de dominio] - nombre de dominio - direcci√≥n IP de nuestra Raspberry.  Sip proxy: coincide con la direcci√≥n IP de RPI y, al final, la contrase√±a del usuario que configuramos recientemente 1111. <br><br>  Salga del programa (Ctrl + x), la configuraci√≥n no siempre se aplica sobre la marcha.  Despu√©s de salir en el directorio de inicio / home / pi, apareci√≥ el archivo de configuraci√≥n del cliente de la consola: .linphonerc. <br>  Ya podemos hacer cambios editando el archivo de configuraci√≥n del cliente SIP. <br>  En una nueva consola de lanzamiento de cliente SIP. <br>  Paralelamente a la sesi√≥n SSH actual, abra una nueva, inicie sesi√≥n con su nombre de usuario y contrase√±a. <br>  Comenzamos alsamixer.  En una sesi√≥n, tenemos Linphonec, en la segunda, una utilidad de ajuste de sonido. <br>  Realizamos la configuraci√≥n de la llamada desde el cliente SIP en un tel√©fono inteligente o PC (como se describe en el art√≠culo sobre la instalaci√≥n de FREESWITCH) cambiando la contrase√±a predeterminada a la suya y marcando un n√∫mero, en nuestro caso 1001. Podemos ir al portal freswitch en IP_Raspberry: 8080, ver el registro de suscriptores, estado llamada, etc. <br><br><img src="https://habrastorage.org/webt/wu/qq/ta/wuqqta-dhsd0j8nr_mixybesqam.png"><br><br>  Usando alsamixer, ajustamos el sonido.  Los cambios de sonido se aplican sobre la marcha, sin salir de los programas. <br><br>  Desafortunadamente, debido al uso de una tarjeta de audio barata, no pude lograr un sonido aceptable, se escuch√≥ un eco en los altavoces.  Puede minimizarse un poco, pero eliminarse por completo; no tuve √©xito. <br><br>  Por lo tanto, dado que no fue posible eliminarlo de una manera, lo eliminamos de otra. <br>  Cierre Linphonec, edite el archivo de configuraci√≥n: <br><br><pre> <code class="plaintext hljs">sudo nano /home/pi/.linphonerc</code> </pre> <br>  En la secci√≥n de sonido, traemos las √∫ltimas tres l√≠neas a este formulario: <br><br><div class="spoiler">  <b class="spoiler_title">Secci√≥n de sonido de Linphonerc</b> <div class="spoiler_text"><pre> <code class="xml hljs">[sound] remote_ring=/home/pi/linphone-desktop/OUTPUT/no-ui/share/sounds/linphone/ringback.wav playback_gain_db=0.000000 mic_gain_db=0.000000 ringer_dev_id=ALSA: bcm2835 ALSA playback_dev_id=ALSA: bcm2835 ALSA capture_dev_id=ALSA: USB Audio Device</code> </pre><br></div></div><br>  De esta manera, forzamos el timbre y el dispositivo de salida de sonido para que funcionen en el conector de frambuesa 3.5 incorporado, y el dispositivo de grabaci√≥n, el micr√≥fono para trabajar a trav√©s de una tarjeta de sonido externa, desapareci√≥ el eco. <br><br>  Cambia los altavoces al conector de la frambuesa. <br><br>  Tenemos en cuenta el siguiente momento: cuando se carga y, en algunos casos, el sistema dom√©stico inteligente reproduce sus mensajes del sistema a trav√©s de esta salida de audio. <br><br>  Ap√°galos.  Pasamos IP_Rasberry a la p√°gina principal, abriendo el sistema de automatizaci√≥n del hogar MajorDoMo. <br><br>  Ingresamos al panel de control - el objeto Computadora (expande el dispositivo) - ThisComputer en la pesta√±a Propiedades y establecemos los valores: <br><br><pre> <code class="plaintext hljs"> ThisComputer.minMsgLevel 100 ThisComputer.volumeLevel 0</code> </pre> <br><img src="https://habrastorage.org/webt/tr/to/tj/trtotjj9oalk1kj-3tddund0ggi.png"><br><br>  Agregue una entrada a cron (un programa demonio dise√±ado para realizar tareas en un momento espec√≠fico o en ciertos intervalos. La utilidad crontab se usa para editar tareas): <br><br><pre> <code class="plaintext hljs">crontab ‚Äìe</code> </pre> <br>  Noto que estamos haciendo esto desde debajo del usuario pi. <br><br>  Inserte la l√≠nea al final: <br><br><pre> <code class="xml hljs">@reboot /home/pi/linphone-desktop/OUTPUT/no-ui/bin/linphonec ‚Äìa</code> </pre> <br>  Al reiniciar, encender la computadora, esta l√≠nea inicia el programa Linphonec en modo de respuesta autom√°tica. <br>  Volver a MajorDoMo: <br>  Vayamos a la p√°gina principal, en la secci√≥n de servicio: <br>  En el men√∫ de esta secci√≥n, se crean botones para reiniciar (apagar) la computadora. <br>  El hecho es que para guardar los recursos de la tarjeta de memoria SD, los cambios se registran en el sistema de "casa inteligente" despu√©s de un cierto tiempo (15 minutos).  Por lo tanto, si necesita sobrecargar las frambuesas, entonces es mejor hacerlo bien.  Reiniciamos el sistema. <br><br><img src="https://habrastorage.org/webt/bn/wl/dg/bnwldg1njtqrveligvtgmkm9iya.png"><br><br>  Despu√©s de reiniciar, vaya a la p√°gina principal de MajorDoMo, vaya al panel de control y, como en el √∫ltimo art√≠culo, realizamos una llamada desde la consola con el siguiente formato: <br><br><pre> <code class="xml hljs">GetURL("http://freeswitch:works@192.168.1.103:8080/webapi/originate?user/1001%201003%20XML%20default")</code> </pre> <br>  Siguiendo el comando, Linphonec levanta autom√°ticamente el tel√©fono.  En el altavoz RPI, se est√° reproduciendo un archivo de sonido, se est√° enviando una llamada al segundo softphone (PC / tel√©fono inteligente).  Despu√©s de levantar el auricular (presionando el bot√≥n de respuesta en el programa), se establece la conexi√≥n. <br><br><img src="https://habrastorage.org/webt/ry/4p/qk/ry4pqktur2kidele7g7hvs0mgou.png"><br><br>  Sobre esto, termino esta parte.  Tratar√© de describir un poco m√°s tarde sobre el bot√≥n en s√≠ usando GPIO y configurando llamadas fuera de mi red local. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/464309/">https://habr.com/ru/post/464309/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../464295/index.html">Ejemplos de uso de algunas funciones nuevas de JavaScript</a></li>
<li><a href="../464299/index.html">0, 0, 1, 0, 2, 0, 2, 2, 1, 6, 0, 5, 0, 2, 6, 5, 4, 0, 5, 3, 0, 3, 2, 9, 0, 4, 9, 3, 6, 14, 0, 6, 3, 5, 15, 0, 5, 3, 5 ...</a></li>
<li><a href="../464303/index.html">Datos de series de tiempo en un DBMS relacional. Extensiones TimescaleDB y PipelineDB para PostgreSQL</a></li>
<li><a href="../464305/index.html">Peque√±o, si. Unboxing del petardo microvirtual</a></li>
<li><a href="../464307/index.html">Pruebas de integraci√≥n de microservicios en Scala</a></li>
<li><a href="../464315/index.html">La pel√≠cula en la que hab√≠a tierra. Investigaci√≥n de Yandex y una breve historia de b√∫squeda por significado</a></li>
<li><a href="../464317/index.html">Proyecto Konbanwa</a></li>
<li><a href="../464325/index.html">C√≥mo Scrumban une lo mejor de las metodolog√≠as Kanban y Scrum</a></li>
<li><a href="../464327/index.html">Comparaci√≥n del uso de memoria de diferentes GUI de kit de herramientas</a></li>
<li><a href="../464331/index.html">Beneficios in√∫tiles: s√≠ntesis de productos qu√≠micos absorbentes de UV a partir de anacardos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>