<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚴🏼 😴 👧🏿 为XMars UI创建带有波纹效果的按钮 🗒️ 👩🏿‍🤝‍👨🏾 👲🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="大家好，今天我将告诉您如何为XMars UI项目开发按钮。 哦，是的，这是一件小事，但是有话要说。 我将省略与向开源项目中添加新组件相关的详细信息。 我将在另一篇文章中更详细地讨论该项目。 
 引言 


 XMars UI是我的新开源项目之一。 一个简单的UI组件库，用于HTML / CSS和Re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>为XMars UI创建带有波纹效果的按钮</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484554/"><p><img src="https://habrastorage.org/webt/qb/fw/za/qbfwzabrpaxjd5t8yzbqojymgwg.jpeg"></p><br><p>大家好，今天我将告诉您如何为<a href="http://bit.ly/2RAsroW" rel="nofollow">XMars UI</a>项目开发按钮。 哦，是的，这是一件小事，但是有话要说。 我将省略与向开源项目中添加新组件相关的详细信息。 我将在另一篇文章中更详细地讨论该项目。 </p><br><h3 id="vvedenie"> 引言 </h3><br><p>  <a href="http://bit.ly/2RbfuDn" rel="nofollow">XMars UI</a>是我的新开源项目之一。 一个简单的UI组件库，用于HTML / CSS和React。 将来，我计划支持Vue。 到目前为止，它只有一个按钮和图标:) </p><br><p> 该项目是在Telegram Contest的框架中诞生的，其实质是开发客户端的Web版本。 我们决定与同事一起，为什么不参加呢。 共享角色是为了让我有一个布局，并且当一位同事理解授权后，我将连接到编写组件。 一切都会好起来的，但是登录电报并不是那么简单。 结果，我们没有发送任何东西，但是我赶上了一堆东西，结果却是徒劳的。 但是正如Varlamov所说，您的项目已经值得了，因为您花了很多时间在上面。 很难不同意这一点，因为如果您花费大量时间和金钱，那么仅在项目开始时就设置Webpack不再是免费的。 考虑到所有这些耻辱，我决定必须以某种方式将其投入开源。 使用哪个单一的引导程序？ 我想要自己的其他项目的UI框架。 </p><a name="habracut"></a><br><h3 id="the-button"> 按钮 </h3><br><p> 界面中的按钮也许是用户与应用程序交互的主要元素。 因此，这是任何UI框架/库的第一个组件。 </p><br><p> 在Telegram的设计中，按钮没有太多变化： </p><br><p><img src="https://habrastorage.org/webt/6h/g7/t6/6hg7t6irtlvoinmtwbgu7t1zezu.png"></p><br><p> 我突出显示了3个主要（默认，重音，主要），带有一个图标和绿色的圆形。 仍然是半透明的，但请放下它。 在大多数情况下，我尝试从需求着手开发<a href="http://bit.ly/2tr72a0" rel="nofollow">XMars UI</a> ，但我还没有弄清楚在何处需要透明按钮。 </p><br><p>库用户应该习惯使用CSS类。 我不喜欢BEM这样的命名系统。 我喜欢Bootstrap命名类的方式。 但我会简化一点。 代替<code>.btn .btn-primary</code> ，而只是<code>.btn .primary</code> 。 对于React组件，它看起来像这样： </p><br><pre> <code class="javascript hljs">&lt;Button primary&gt;Hey&lt;<span class="hljs-regexp"><span class="hljs-regexp">/Button&gt;</span></span></code> </pre> <br><p> 相同的按钮但是有波纹效果： </p><br><pre> <code class="javascript hljs">&lt;Button primary ripple&gt;Hey&lt;<span class="hljs-regexp"><span class="hljs-regexp">/Button&gt;</span></span></code> </pre> <br><h3 id="html--css">  HTML / CSS </h3><br><p>  UI库不应绑定到任何UI框架。 将来，我计划在<code>Vue</code>组件上扩展布局。 让我们开始使用简单的HTML / CSS。 </p><br><p> 在<a href="http://bit.ly/364UK4g" rel="nofollow">Tailwindcss</a>项目的内部，这是一个实用程序优先的CSS框架，即为您提供实用程序而不是成熟组件的框架。 </p><br><p><img src="https://habrastorage.org/webt/by/c_/rk/byc_rkdkrpk4-igmro0h4wnbkli.png"></p><br><p> 除Tailwindcss外，PostCSS还用于<a href="https://github.com/postcss/postcss-mixins" rel="nofollow">mixins</a> ， <a href="https://github.com/postcss/postcss-custom-properties" rel="nofollow">变量</a>和<a href="https://github.com/postcss/postcss-nested" rel="nofollow">嵌套样式。</a> </p><br><p> 关于使用这种框架以及如何配置项目的更多详细信息，我将在另一篇文章中讲述。 在这个阶段，拥有如此强大的工具包并充分使用它所使用的组件就足够了。 </p><br><p>  <code>&lt;button&gt;</code>具有许多我们需要删除或重新定义的默认样式。 </p><br><p><img src="https://habrastorage.org/webt/rq/uw/ad/rquwad-pftcaam8vqie3bwhsmew.png"></p><br><p> 对于Tailwindcss，button标记具有以下样式： </p><br><p><img src="https://habrastorage.org/webt/ok/c9/2c/okc92cjctwgo5v8nf0qes8_dcvu.png"></p><br><p> 默认情况下将所有不必要的内容删除。 您可以雕刻自己想要的东西，而不必担心默认边框会在某些状态下消失。 但请注意，默认<code>outline</code>仍需添加： </p><br><p><img src="https://habrastorage.org/webt/6d/7w/d7/6d7wd77y15peye0xdl8luutiscq.png"></p><br><p>  <a href="http://bit.ly/30yxc6C" rel="nofollow">XMars UI</a>中的按钮具有<code>.btn</code>类： </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn"</span></span></span><span class="hljs-tag">&gt;</span></span>Button<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> 将此类添加到我们的样式中： </p><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.btn</span></span> { @apply text-black text-base leading-snug; @apply py-3 px-4 border-none rounded-lg; @apply inline-block cursor-pointer no-underline; &amp;:focus { @apply outline-none; } }</code> </pre> <br><p> 除了Tailwindcss提供了可以使用的类之外​​，它还提供了一种<code>mixins</code> 。  <code>@apply</code>不是SCSS或PostCSS的某种插件。 这是Tailwindcss本身的语法。 从名称上通常可以清楚地应用所应用的样式。  <code>py-3</code>和<code>px-4</code>可能会引起问题。 第一个是沿y填充，即垂直<code>padding-top: 0.75rem;</code> ，即<code>padding-top: 0.75rem;</code> <code>padding-bottom: 0.75rem;</code>  。 因此， <code>px-4</code>水平为<code>padding-right: 1rem;</code>  ， <code>padding-left: 1rem;</code>  。 </p><br><p>  Telegram提供的将其轻描淡写的设计记录不佳， <code>border-radius</code>按钮之类的东西必须直接用标尺从图像中获取。 有没有想过<code>border-radius</code>值的确切含义是什么？ </p><br><p><img src="https://habrastorage.org/webt/t1/61/sp/t161sp5vhq_sw2hwtb56ibfylgs.gif"></p><br><p> 这实际上是角落中所得圆的半径。 如果是集体农场，则可以如上图所示更改标尺。 因此，我确实在Gimp中使用了矩形选择。 </p><br><p><img src="https://habrastorage.org/webt/9b/-x/bk/9b-xbkbj3mbmrmsgttlhpzx2nbc.png"></p><br><p> 设计中按钮<code>border-radius</code>为10 <code>8px</code> ，但是不幸的是，在Tailwindcss框中没有此类，但是从视觉<code>8px</code> ，默认字体大小（rem）为8 <code>8px</code> <code>rounded-lg</code> 。 </p><br><p> 这是目前发生的情况，我将按钮涂成灰色，以便可以看到边缘： </p><br><p><img src="https://habrastorage.org/webt/a2/tz/z-/a2tzz-khw1guvggfgjz0vjecfnm.png"></p><br><p> 接下来，我们需要对以下内容产生影响<code>:hover</code> 。 然后，Telegram的设计师决定对一些颜色进行照明，并从<code>#707579</code>颜色指示为0.08％。 我看到两个选择，只需用吸管上色或按照记录进行即可。 第一种选择较为简单，但将来并非最佳选择。 事实是，如果背景不同于白色，那么在上<code>:hover</code>我们将获得特定的颜色，失去按钮的“亮度”和透明度。 为此，最好遵循文档并进行Alpha测试 <del> 男 </del> 频道。 这可以以无数种方式完成，例如使用SCSS颜色功能。 但是该项目中没有SCSS，而且由于颜色相同，我不想将任何插件连接到PostCSS，我们将使一切变得非常简单。 在Chrome中，有一个colopaker可让您将颜色转换成不同的系统，在其中驱动十六进制颜色<code>#707579</code> ，将其转换为<code>rgba</code>并设置alpha通道-0.08％。 </p><br><p><img src="https://habrastorage.org/webt/tx/oe/hv/txoehvpf_ams30-5kvkur8q-2bc.png"></p><br><p> 瞧！ 东西突然闪过我的照片： </p><br><p><img src="https://habrastorage.org/webt/9g/nc/7b/9gnc7bjgm-uljw_rwbxn8cve71c.png"></p><br><p> 我们<code>rgba(112, 117, 121, 0.08)</code> 。 </p><br><p><img src="https://habrastorage.org/webt/vn/hc/kh/vnhckhj8plbr9_rmbvr0ug9eawm.png"><br>  （：悬停） </p><br><p> 进一步的无聊和不费力气，我添加了其余状态： </p><br><pre> <code class="css hljs"> &amp;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:hover</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--grey04); } &amp;<span class="hljs-selector-class"><span class="hljs-selector-class">.accent</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--blue01); } &amp;<span class="hljs-selector-class"><span class="hljs-selector-class">.primary</span></span> { @apply text-white; <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--blue01); &amp;:hover { <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">var</span></span>(--blue02); } }</code> </pre> <br><h3 id="react-komponent"> 反应组件 </h3><br><p> 最初，该按钮是为Telegram竞赛准备的，无法使用任何框架。 我必须在纯JS上实现波纹效果。 我真的很希望这样，但是当您独自完成项目时，就必须牺牲一些东西。 </p><br><p> 需要某种逻辑（例如纹波效应）的组件将被实现，并且只能作为React组件使用。 </p><br><p> 在React组件中包装按钮并不困难： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { FunctionComponent } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface ButtonProps { } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Button: FunctionComponent&lt;ButtonProps&gt; = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"btn"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">props.children</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Button;</code> </pre> <br><p> 该按钮将以指定的样式显示，但实际上没有什么用。 我们需要使用户能够自定义按钮，添加自定义样式，挂起事件处理程序等。 </p><br><p> 为了使用户能够传输所有必要的内容，首先您需要克服Typescript，否则，即使<code>onClick</code>也不允许您正常传输。  <code>ButtonProps</code>稍微编辑<code>ButtonProps</code>界面，我们解决了这个问题： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface ButtonProps extends ButtonHTMLAttributes&lt;HTMLButtonElement&gt;</code> </pre> <br><p> 之后，我们可以安全地破坏<code>props</code> ： </p><br><pre> <code class="javascript hljs">&lt;button className=<span class="hljs-string"><span class="hljs-string">"btn"</span></span> {...props}&gt;props.children&lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt;</span></span></code> </pre> <br><p> 该按钮的类似用法将达到预期的效果： </p><br><pre> <code class="javascript hljs">&lt;Button onClick={() =&gt; alert()}&gt;Hey&lt;<span class="hljs-regexp"><span class="hljs-regexp">/Button&gt;</span></span></code> </pre> <br><p><img src="https://habrastorage.org/webt/-_/aq/qb/-_aqqbmdkzkmdf2sr8lodd_wy-o.png"></p><br><p> 接下来，我们添加按钮样式和注册自定义（突然有人需要）类的功能。  npm <a href="https://www.npmjs.com/package/classnames" rel="nofollow">classnames</a>软件包非常适合这些目的。 </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface ButtonProps extends ButtonHTMLAttributes&lt;HTMLButtonElement&gt; { primary?: boolean, accent?: boolean, additionalClass?: string, } ... const classNames = classnames( <span class="hljs-string"><span class="hljs-string">'btn'</span></span>, { primary }, { accent }, additionalClass ); ... &lt;button className={classNames} {...props}&gt;props.children&lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt;</span></span></code> </pre> <br><p> 始终设置<code>btn</code>类，但仅在<code>true</code>设置<code>primary</code>和<code>accent</code> 。 如果类名具有逻辑<code>true</code>值，则添加类，使用缩写ES6，我们得到一个简单的条目<code>{ primary }</code> ，而不是<code>{ primary: true }</code> 。 </p><br><p>  <code>additionalClass</code>是一个字符串，如果为空或未定义，则它对我们没有特殊作用，只会向元素添加任何内容。 </p><br><p> 首先，我分配了以下<code>props</code> ： </p><br><pre> <code class="javascript hljs">{...omit(props, [<span class="hljs-string"><span class="hljs-string">'additionalClass'</span></span>, <span class="hljs-string"><span class="hljs-string">'primary'</span></span>])}</code> </pre> <br><p> 省略所有不适用于button元素的<code>props</code>的内容，但这不是必需的，因为React不会渲染太多。 </p><br><h3 id="ripple-effect"> 涟漪效应 </h3><br><p><img src="https://habrastorage.org/webt/36/ys/8w/36ys8wseofyhctlp1cm5r5kiwqo.gif"></p><br><p> 实际上这是它的外观，但是希望“波”与点击位置发散。 <br> 制作动画的方法有无数种，就像关于<a href="https://css-tricks.com/blue-box/" rel="nofollow">蓝色方块</a>的笑话一样。 </p><br><p> 但是google通过查看codepen上的示例，可以清楚地看到，在大多数情况下，“波”是通过子元素实现的，该子元素会扩展和消失。 </p><br><p> 根据点击的坐标，它位于按钮内。 在<a href="http://bit.ly/2RbcVRD" rel="nofollow">XMars UI中</a> ，目前我决定不像Material UI那样在<code>onPress</code>上实现此效果，但我计划在将来进行<code>onPress</code> 。 到目前为止，只有<code>onClick</code> 。 </p><br><p><img src="https://habrastorage.org/webt/dr/rr/wy/drrrwydtouv_xhq3fi6pyahyaye.png"></p><br><p> 上图是所有魔术。 点击会创建一个子按钮元素，该元素绝对位于该点击的中心并展开。  <code>overflow: hidden</code>属性<code>overflow: hidden</code> wave超出按钮。 必须在动画末尾删除该项目。 </p><br><p> 首先，我们将尽可能地使用Tailwindcss定义样式： </p><br><pre> <code class="plaintext hljs">.with-ripple { @apply relative overflow-hidden; @keyframes ripple { to { @apply opacity-0; transform: scale(2.5); } } .ripple { @apply absolute; z-index: 1; border-radius: 50%; background-color: var(--grey04); transform: scale(0); animation: ripple 0.6s linear; } &amp;.primary { .ripple { background-color: var(--black02); } } }</code> </pre> <br><p> 负责效果的元素将分配为<code>.ripple</code>类。 <code>border-radius: 50%;</code> 等于一个圆（角为50％的圆角* 2），该按钮具有相对位置， <code>.ripple</code>按钮具有绝对位置。 动画非常简单，增加的波在0.6秒内变得透明。 背景颜色与相同<code>:hover</code>和折叠，两种透明的“波浪”颜色和按钮可为我们提供所需的结果。 在蓝色的<code>.primary</code>按钮上，这并不是很重要，您可以在其中使用非透明的颜色。 </p><br><p> 点击时，您需要创建“ wave”元素。 因此，我们为此业务创建了一个状态，并向按钮添加了适当的单击处理程序，但这种方式不会干扰自定义onClick。 </p><br><pre> <code class="javascript hljs">... const [rippleElements, setRippleElements] = useState&lt;JSX.Element[]&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">); ... </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">renderRippleElements</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">rippleElements</span></span></span><span class="hljs-function">; } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;button className={classNames} {...props} onClick={(event</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (props.onClick) { props.onClick(event); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ripple) { onRippleClick(event); } }} &gt; {children} {renderRippleElements()} &lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt; );</span></span></code> </pre> <br><p>  <code>rippleElements</code>元素-一组JSX元素，此处的render函数可能看起来是多余的，但这更多的是样式和将来的合并问题。 </p><br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onRippleClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event: React.MouseEvent&lt;HTMLButtonElement, MouseEvent&gt;</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rect = event.currentTarget.getBoundingClientRect(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> d = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.max(event.currentTarget.clientWidth, event.currentTarget.clientHeight); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> left = event.clientX - rect.left - d/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-string"><span class="hljs-string">'px'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> top = event.clientY - rect.top - d/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-string"><span class="hljs-string">'px'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rippleElement = newRippleElement(d, left, top); setRippleElements([...rippleElements, rippleElement]); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newRippleElement</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d: number, left: string, top: string</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> key = uuid(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div key={key} className=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"ripple"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> style={{width: d, height: d, left, top}} onAnimationEnd={(</span></span></span><span class="hljs-function">) =&gt;</span></span> onAnimationEnd(key)} &gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }</code> </pre> <br><p> 创建“波浪”的<code>onRippleClick</code>处理程序。 通过单击按钮，我们可以找到用于正确定位圆的按钮的大小，然后将所有必需的内容传递给<code>newRippleElement</code>函数<code>newRippleElement</code>该函数依次简单地创建带有<code>ripple</code>类的<code>div</code>元素，从而创建必要的定位样式。 </p><br><p> 其中值得重点<code>onAnimationEnd</code>的主要内容<code>onAnimationEnd</code> 。 我们需要此事件以从已使用的元素中清除DOM。 </p><br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAnimationEnd</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key: string</span></span></span><span class="hljs-function">) </span></span>{ setRippleElements(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">rippleElements</span></span></span><span class="hljs-function"> =&gt;</span></span> rippleElements.filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">element</span></span></span><span class="hljs-function"> =&gt;</span></span> element.key !== key)); }</code> </pre> <br><p> 重要的是不要忘记，将当前的<code>rippleElements</code>传递给参数，否则您将获得具有旧值的数组，并且所有操作均无法按预期进行。 </p><br><p> 全按钮代码： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { FunctionComponent, ButtonHTMLAttributes, useState } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> uuid <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'uuid/v4'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> classnames <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'classnames'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface ButtonProps extends ButtonHTMLAttributes&lt;HTMLButtonElement&gt; { primary?: boolean, accent?: boolean, circle?: boolean, ripple?: boolean, additionalClass?: string, } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Button: FunctionComponent&lt;ButtonProps&gt; = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [rippleElements, setRippleElements] = useState&lt;JSX.Element[]&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> {</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">primary</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">accent</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">circle</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ripple</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">additionalClass</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">children</span></span></span><span class="hljs-function">} = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">classNames</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">classnames</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'btn'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, { primary }, { </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'with-ripple'</span></span></span></span><span class="hljs-function"><span class="hljs-params">: ripple }, { circle }, { accent }, additionalClass </span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">onAnimationEnd</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key: string</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">setRippleElements</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">rippleElements =&gt; rippleElements.filter(element =&gt; element.key !== key</span></span></span><span class="hljs-function">)); } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">onRippleClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event: React.MouseEvent&lt;HTMLButtonElement, MouseEvent&gt;</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">var</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">rect</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">currentTarget</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">getBoundingClientRect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">max</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event.currentTarget.clientWidth, event.currentTarget.clientHeight</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">rect</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">left</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">/2 + '</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">px</span></span></span><span class="hljs-function">'; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">rect</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">top</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">/2 + '</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">px</span></span></span><span class="hljs-function">'; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">rippleElement</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newRippleElement</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d, left, top</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">setRippleElements</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[...rippleElements, rippleElement]</span></span></span><span class="hljs-function">); } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newRippleElement</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d: number, left: string, top: string</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uuid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div key={key} className=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"ripple"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> style={{width: d, height: d, left, top}} onAnimationEnd={(</span></span></span><span class="hljs-function">) =&gt;</span></span> onAnimationEnd(key)} &gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">renderRippleElements</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rippleElements; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;button className={classNames} {...props} onClick={(event</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (props.onClick) { props.onClick(event); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ripple) { onRippleClick(event); } }} &gt; {children} {renderRippleElements()} &lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt; ); } export default Button;</span></span></code> </pre> <br><p> 最终结果可以在<a href="https://ui.xmars.io/docs/components/buttons" rel="nofollow">这里</a>报告<a href="https://ui.xmars.io/docs/components/buttons" rel="nofollow">。</a> </p><br><h3 id="zaklyuchenie"> 结论 </h3><br><p> 省略了很多内容，例如，如何设置项目，如何编写文档，测试项目中的新组件。 我将尝试用单独的出版物介绍这些主题。 </p><br><p>  <a href="http://bit.ly/36dT1JM" rel="nofollow">XMars UI Github存储库</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN484554/">https://habr.com/ru/post/zh-CN484554/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN484544/index.html">几个有趣的Console对象方法</a></li>
<li><a href="../zh-CN484546/index.html">10个常见的TypeScript面试问题（简短答案）</a></li>
<li><a href="../zh-CN484548/index.html">Citrix NetScaler CVE-2019-19781严重漏洞如何暴露隐藏的IT行业问题</a></li>
<li><a href="../zh-CN484550/index.html">在IT公司中需要狂欢吗：利弊</a></li>
<li><a href="../zh-CN484552/index.html">速读：有关音频技术的10种材料-音乐曲目，高清记录和8D声音的排列方式</a></li>
<li><a href="../zh-CN484556/index.html">那么什么时候仍然可以使用！重要吗？</a></li>
<li><a href="../zh-CN484564/index.html">我们为趣味和利润编写笔记本电脑驱动程序，或者即使您是傻瓜也如何提交内核</a></li>
<li><a href="../zh-CN484568/index.html">哈克盒子-演练播放器。 FFmpeg漏洞利用，JWT和各种网站列表</a></li>
<li><a href="../zh-CN484572/index.html">我使用VSCode的时间/任务管理方法</a></li>
<li><a href="../zh-CN484574/index.html">没有滴答声！ 植物与莱姆病载体</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>