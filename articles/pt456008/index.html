<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äçüî¨ üë£ üë©üèº‚Äçüíª Desenvolvimento de programas para o processador central Redd no exemplo de acesso ao FPGA üôÖüèæ üé∂ ü•ü</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em um artigo anterior, eu disse que √© hora de seguirmos para os protocolos de streaming. Mas, tendo come√ßado a preparar uma hist√≥ria sobre eles, perce...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Desenvolvimento de programas para o processador central Redd no exemplo de acesso ao FPGA</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456008/">  Em um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo anterior,</a> eu disse que √© hora de seguirmos para os protocolos de streaming.  Mas, tendo come√ßado a preparar uma hist√≥ria sobre eles, percebi que estou nadando em um t√≥pico muito importante.  Como j√° observamos, meu relacionamento com o Linux √© bastante peculiar.  Em geral, percebi que eu pr√≥prio n√£o posso criar do zero um aplicativo C ++ que satisfizesse todos os princ√≠pios de programa√ß√£o do Redd.  Voc√™ pode pedir a algu√©m para fazer isso e depois usar o modelo pronto, mas a s√©rie de artigos foi projetada para ensinar a todos como se desenvolver no Redd do zero.  Por isso, perguntei ao meu chefe (um grande especialista em Linux) e ele me explicou em que clicar.  Depois, repensei levemente suas palavras e agora considero necess√°rio consertar todo o conhecimento por escrito.  Isso salvar√° pessoas como eu de pensamentos dolorosos: "Ent√£o ... O que ele fez √© compreens√≠vel, mas como posso repetir isso?"  Em geral, qualquer pessoa que trabalha no Linux pode executar as duas se√ß√µes a seguir na diagonal.  √â improv√°vel que voc√™ encontre algo novo l√° (voc√™ encontrar√° mais).  E quanto ao resto, ofere√ßo uma escolha de dois m√©todos de desenvolvimento que correspondem aos princ√≠pios declarados de trabalho sob Redd: baixos custos de m√£o-de-obra para desenvolvimento e depura√ß√£o remota. <br><br><img src="https://habrastorage.org/webt/kb/sk/5c/kbsk5cbh98eftndkgneifjnzgao.jpeg"><br><a name="habracut"></a><br>  Todos os artigos do ciclo: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Desenvolvimento do ‚Äúfirmware‚Äù mais simples para FPGAs instalados no Redd e depura√ß√£o usando o teste de mem√≥ria como exemplo</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Desenvolvimento do ‚Äúfirmware‚Äù mais simples para FPGAs instalados em Redd.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 2. C√≥digo do Programa</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Desenvolvimento de n√∫cleo pr√≥prio para incorpora√ß√£o em um sistema de processador baseado em FPGA</a> </li></ol><br><h2>  Trabalhar com ferramentas do Visual Studio </h2><br>  Acontece que voc√™ pode conduzir o desenvolvimento do Linux remoto, sem t√™-lo em sua m√°quina local e sem instalar nenhuma ferramenta de software que n√£o seja da Microsoft.  Aqui, √© mostrado como ele √© colocado no Visual Studio (eu o instalei na vers√£o 2019, mas aparentemente apareceu em 2015) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">docs.microsoft.com/ru-ru/cpp/linux/download-install-and-setup- the-linux-development-workload? view = vs-2019</a> <br><br>  E aqui est√° a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">teoria do trabalho</a> . <br><br>  Bem, voc√™ pode andar pelas guias, muita teoria e tudo em russo. <br><br>  √ìtimo!  Vamos tentar usar o conhecimento adquirido para acessar o chip FT2232H, atrav√©s do qual o processador central Redd est√° conectado ao FPGA.  √â este canal no futuro que formar√° a base do nosso trabalho de streaming.  Abra o Visual Studio, selecione "Criar Projeto".  Nos filtros, selecione "Idioma - C ++", "Plataforma - Linux", "Tipo de projeto - Console".  Vou mostrar onde isso j√° est√° localizado para o tipo de projeto.  Pelo que fomos filtrados, selecionamos o "Aplicativo de console": <br><br><img src="https://habrastorage.org/webt/ao/5x/h4/ao5xh4h5fwoldpjdn_-rpx8ay2a.png"><br><br>  Vamos cham√°-lo, digamos, SimpleConsole.  Criamos um c√≥digo fonte espartano: <br><br><pre><code class="plaintext hljs">#include &lt;cstdio&gt; int main() { printf("hello from SimpleConsole!\n"); return 0; }</code> </pre> <br>  Vamos tentar coletar.  E nos fazem uma pergunta muito interessante sobre como estabelecer uma conex√£o.  Esse √© um recurso de desenvolvimento no Visual Studio.  O ambiente n√£o cont√©m um compilador cruzado e nenhuma biblioteca.  Ele simplesmente cria um diret√≥rio de origem na m√°quina remota, ap√≥s o qual, para cada compila√ß√£o, copia os arquivos atualizados e inicia a compila√ß√£o nele.  √â por isso que a conex√£o com a m√°quina remota n√£o deve ser estabelecida para iniciar, mas j√° para a montagem normal do projeto. <br><br>  N√≥s preenchemos os par√¢metros para o usu√°rio Redd, em nome de quem o trabalho ser√° realizado no projeto. <br><br><img src="https://habrastorage.org/webt/jd/sx/hk/jdsxhkvvklw29zjoecvrr1svvda.png"><br><br>  Se alguma coisa - os par√¢metros podem ser alterados aqui neste local secreto (n√£o tente alterar as propriedades do projeto, isso n√£o levar√° a nada de bom): <br><br><img src="https://habrastorage.org/webt/dn/xe/yd/dnxeydmzx11e50rtxzjayuleto0.png"><br><br><img src="https://habrastorage.org/webt/ow/k-/le/owk-leapmriognn1l-kk4tavvyc.png"><br><br>  Na verdade, voc√™ pode colocar um ponto de interrup√ß√£o em uma √∫nica linha e verificar se o projeto inicia e funciona.  Mas isso √© trivial.  Portanto, passamos a uma tarefa mais interessante - trabalhar com o FT2232.  Surge a pergunta: onde obter as bibliotecas necess√°rias?  Para Linux, tudo est√° inclu√≠do no pacote de drivers.  H√° o pr√≥prio driver, bibliotecas e exemplos de aplicativos para trabalhar com eles, e at√© uma breve instru√ß√£o.  Em geral, dirigimos para o mecanismo de pesquisa: <br><br><pre> <code class="plaintext hljs">FTDI D2XX drivers</code> </pre> <br>  Ele mostrar√° onde eles podem ser baixados.  Verdade, especificamente, tudo foi ruim para mim.  Meu provedor bloqueia o site da FTDI (assim como reprap, 7zip e at√© osronline), referindo-se ao RosKomNadzor.  A ILV, em resposta a declara√ß√µes, envia cancelamentos de inscri√ß√£o, dizendo que n√£o estamos bloqueando nada, mas que voc√™ mesmo deve lidar com o provedor.  Onde somente nessas pessoas que n√£o se inscreveram eles n√£o me ofereceram a ajuda, nem mesmo para a pol√≠cia.  Eles s√£o muito desinscritos.  As tentativas de reclamar sobre a ina√ß√£o do ILV acabam sendo encaminhadas para o ILV, de onde v√™m os pr√≥ximos cancelamentos.  Em geral, pode acontecer que o seu provedor tamb√©m bloqueie o acesso.  N√£o se assuste, basta procurar outras maneiras de baixar, gastando tempo com isso.  E ent√£o eles ficam surpresos que o desenvolvimento de m√≠sseis esteja atrasado por d√©cadas ... Comecei a correspond√™ncia com o ILV em novembro passado, agora √© junho, exceto os cancelamentos de inscri√ß√£o - nenhuma a√ß√£o ... Mas fiquei distra√≠do. <br><br>  Como usar os drivers podem ser encontrados no arquivo leia-me, no pr√≥prio pacote.  Voc√™ tamb√©m pode encontrar o documento <b>AN_220 FTDI Drivers Installation Guide for Linux</b> .  Por fim, voc√™ pode encontrar no YouTube um v√≠deo do <b>Guia de Instala√ß√£o do Driver Linux d2xx dos</b> chips FTDI.  Um link para ele tamb√©m est√° na p√°gina de download do driver.  Em geral, o FTDI n√£o restringiu as op√ß√µes para informar os usu√°rios.  Na verdade, se voc√™ recebeu um pacote Redd pronto, os drivers j√° est√£o instalados e configurados nele.  E estaremos interessados ‚Äã‚Äãem arquivos de cabe√ßalho e exemplos. <br><br>  Vamos inserir um exemplo de fatia <b>\ release \ examples \ EEPROM \ read</b> .  O in√≠cio da fun√ß√£o <b>principal</b> , onde o dispositivo √© aberto e seu tipo √© utilizado.  Isso ser√° suficiente para garantir que tudo funcione.  Eu odeio r√≥tulos, mas como arrastamos e soltamos rapidamente o c√≥digo que dura 10 minutos, arrastarei o r√≥tulo que estava no exemplo original para economizar tempo.  Acontece assim: <br><br><pre> <code class="plaintext hljs">#include &lt;cstdio&gt; #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;sys/time.h&gt; #include "ftd2xx.h" int main(int argc, char* argv[]) { printf("hello from ConsoleApplication1!\n"); FT_STATUS ftStatus; FT_HANDLE ftHandle0; int iport; static FT_PROGRAM_DATA Data; static FT_DEVICE ftDevice; DWORD libraryVersion = 0; int retCode = 0; ftStatus = FT_GetLibraryVersion(&amp;libraryVersion); if (ftStatus == FT_OK) { printf("Library version = 0x%x\n", (unsigned int)libraryVersion); } else { printf("Error reading library version.\n"); return 1; } if (argc &gt; 1) { sscanf(argv[1], "%d", &amp;iport); } else { iport = 0; } printf("Opening port %d\n", iport); ftStatus = FT_Open(iport, &amp;ftHandle0); if (ftStatus != FT_OK) { /* This can fail if the ftdi_sio driver is loaded use lsmod to check this and rmmod ftdi_sio to remove also rmmod usbserial */ printf("FT_Open(%d) failed\n", iport); return 1; } printf("FT_Open succeeded. Handle is %p\n", ftHandle0); ftStatus = FT_GetDeviceInfo(ftHandle0, &amp;ftDevice, NULL, NULL, NULL, NULL); if (ftStatus != FT_OK) { printf("FT_GetDeviceType FAILED!\n"); retCode = 1; goto exit; } printf("FT_GetDeviceInfo succeeded. Device is type %d.\n", (int)ftDevice); exit: return 0; }</code> </pre><br>  Tentando coletar - n√£o indo.  Arquivos de cabe√ßalho insuficientes. <br><br><pre> <code class="plaintext hljs">1&gt;main.cpp 1&gt;D:\Work\SimpleConsole\SimpleConsole\main.cpp(5,20): error : ftd2xx.h:      1&gt;D:\Work\SimpleConsole\SimpleConsole\main.cpp(5,20): error : #include "ftd2xx.h" 1&gt;D:\Work\SimpleConsole\SimpleConsole\main.cpp(5,20): error : ^ 1&gt;D:\Work\SimpleConsole\SimpleConsole\main.cpp(5,20): error : compilation terminated.</code> </pre><br>  Mas eu os coloco a seguir!  Tudo √© simples.  Localmente, eles est√£o pr√≥ximos, mas a montagem est√° sendo feita remotamente.  Para que o Studio os transfira para uma m√°quina remota, voc√™ precisa adicion√°-los ao projeto.  Al√©m disso, no arquivo <b>main.cpp</b> eu adiciono apenas <b>ftd2xx.h</b> , mas ele ainda <b>puxa o WinTypes.h em tr√¢nsito</b> .  Voc√™ precisa adicionar os dois. <br><br><img src="https://habrastorage.org/webt/gy/-2/-j/gy-2-jt8ej_mbavcpupdsphb5g8.png"><br><br><img src="https://habrastorage.org/webt/kp/ye/l1/kpyel11pdcxgnd5ojt39rhkkslk.png"><br><br>  Agora o vinculador jura. <br><br><pre> <code class="plaintext hljs">1&gt;  1&gt;D:\Work\SimpleConsole\SimpleConsole\obj\x64\Debug\main.o : error : In function `main': 1&gt;D:\Work\SimpleConsole\SimpleConsole\main.cpp(18): error : undefined reference to `FT_GetLibraryVersion' 1&gt;D:\Work\SimpleConsole\SimpleConsole\main.cpp(37): error : undefined reference to `FT_Open' 1&gt;D:\Work\SimpleConsole\SimpleConsole\main.cpp(55): error : undefined reference to `FT_GetDeviceInfo' 1&gt;collect2 : error : ld returned 1 exit status</code> </pre><br>  √â claro que n√£o h√° biblioteca suficiente.  Inspecionando os <b>makefiles do</b> exemplo, percebi que precisava adicionar alguns par√¢metros √†s configura√ß√µes do vinculador: <br><br><img src="https://habrastorage.org/webt/xy/zm/2i/xyzm2igciaxlmevvppuug4vk2go.png"><br><br><img src="https://habrastorage.org/webt/xd/p2/f1/xdp2f1nxqd3bue69dqx8m-dgabc.png"><br><br>  Agora o projeto est√° indo com sucesso.  Colocamos um ponto de interrup√ß√£o na √∫ltima linha, tentamos correr.  Vemos o seguinte texto: <br><br><pre> <code class="plaintext hljs">hello from ConsoleApplication1! Library version = 0x10408 Opening port 0 FT_Open succeeded. Handle is 0x555555768540 FT_GetDeviceInfo succeeded. Device is type 10.</code> </pre><br>  No geral - n√£o √© ruim.  Algo abriu, at√© algum dispositivo foi encontrado.  O que √© o tipo 10?  No arquivo de cabe√ßalho da FTDI, encontramos: <br><br><pre> <code class="plaintext hljs">enum { FT_DEVICE_BM, FT_DEVICE_AM, FT_DEVICE_100AX, FT_DEVICE_UNKNOWN, FT_DEVICE_2232C, FT_DEVICE_232R, FT_DEVICE_2232H, FT_DEVICE_4232H, FT_DEVICE_232H, FT_DEVICE_X_SERIES, FT_DEVICE_4222H_0, FT_DEVICE_4222H_1_2, FT_DEVICE_4222H_3, FT_DEVICE_4222_PROG, };</code> </pre><br>  Contamos o dedo de cima para baixo - √† nossa frente est√° o FT4222H.  Sim, Redd tem muitos dispositivos FTDI.  Agora vou dizer brevemente que precisamos classificar o n√∫mero do dispositivo passado para a fun√ß√£o <b>FT_Open ()</b> , esse n√∫mero √© passado para a fun√ß√£o <b>main ()</b> como argumento.  Pode ser definido nas propriedades de depura√ß√£o do projeto. <br><br>  √â √∫til colocar um prato com problemas t√≠picos.  Geralmente, ele diz "configure Redd" em qualquer lugar, sem detalhes.  O fato √© que os complexos ser√£o distribu√≠dos de forma personalizada, para que todos os leitores n√£o precisem de regras de configura√ß√£o.  Em caso de problemas, os administradores geralmente lidam com a configura√ß√£o.  Portanto, √© claro que voc√™ pode descrever as regras de configura√ß√£o, mas isso ocupar√° muito espa√ßo.  Faz sentido gastar energia nisso apenas se algu√©m realmente precisar.  Ent√£o, aqui vou me limitar apenas a indicar problemas, e como corrigi-los, descreverei se existem aplicativos no feedback. <br><br><div class="scrollable-table"><table><tbody><tr><th>  Sintoma </th><th>  Raz√£o </th></tr><tr><td>  Nenhum dispositivo √© aberto. </td><td>  Por padr√£o, o Linux requer direitos de administrador para abrir dispositivos USB, mas o usu√°rio que faz login para depura√ß√£o n√£o os possui.  Voc√™ deve configurar as portas para que possam ser usadas por um usu√°rio normal. </td></tr><tr><td>  Apenas alguns dispositivos abertos, ambos FT4222H. </td><td>  Por padr√£o, um driver de porta COM virtual padr√£o √© instalado no controlador FT2232H.  Voc√™ deve dizer ao sistema operacional para n√£o fazer isso. </td></tr><tr><td>  Nenhuma biblioteca encontrada. </td><td>  Os drivers D2XX n√£o est√£o instalados no sistema operacional do dispositivo Redd. </td></tr></tbody></table></div><br>  √ìtimo.  Estamos prontos para conquistas usando exclusivamente ferramentas da Microsoft.  Em geral, isso pode ser suficiente, mas, por via das d√∫vidas, falarei sobre uma alternativa que meu chefe me ensinou. <br><br><h2>  Trabalhando com Linux executando em uma m√°quina virtual </h2><br>  A principal desvantagem do m√©todo anterior √© a montagem remota.  Voc√™ pode pensar em mil e uma raz√µes pelas quais a montagem deve ser feita localmente, e apenas o arquivo bin√°rio final ser√° transferido para a m√°quina remota.  Existem todos os tipos de restri√ß√µes paran√≥icas (embora os arquivos sejam transferidos usando um protocolo seguro e voc√™ possa separar seu armazenamento de outros usu√°rios com pol√≠ticas de seguran√ßa), este √© apenas o cuidado para que a unidade Redd n√£o transborde de todos os tipos de bibliotecas, tamb√©m √© a relut√¢ncia em registrar cada arquivo de cabe√ßalho, se houver milhares deles ... Bem, e muito, muito mais.  Em geral, a t√©cnica de montagem local pode ser √∫til, ent√£o considere-a. <br><br>  Primeiro, colocamos o programa VirtualBox da Oracle na m√°quina local.  Se houver algum problema de licenciamento (eu o uso gratuitamente, como indiv√≠duo, mas n√£o sei exatamente o que est√° acontecendo com entidades legais), selecione uma m√°quina f√≠sica separada e coloque o Linux l√°.  Qual?  √â mais f√°cil para mim, eu entendo todos eles da mesma forma.  Quero dizer, eu quase n√£o entendo um.  Portanto, o chefe me disse que voc√™ precisa usar o Debian, eu instalei o Debian.  Voc√™ pode seguir o mesmo caminho (use o princ√≠pio "Por que n√£o?").  Pelo menos no futuro, vou confiar em trabalhar com ele. <br><br>  Ao trabalhar com Linux, voc√™ deve aderir a duas regras que facilitam muito a vida: <br><br><ol><li>  Se, em resposta a um comando, eles nos dizem que n√£o h√° direitos suficientes, vale a pena repeti-lo, adicionando o feiti√ßo <b>sudo</b> ao in√≠cio. </li><li>  Se em resposta a um comando nos √© dito que n√£o existe, vale a pena tentar instal√°-lo lan√ßando o feiti√ßo <b>apt-get install &lt;falta de coisa&gt;</b> . </li></ol><br>  Ent√£o  Acabamos de instalar o sistema operacional.  Adicione imediatamente o suporte ao C ++ instalando o compilador g ++ e o depurador gdb.  Como  Ent√£o, usando a regra 2: <br><br>  <b>apt-get install g ++</b> <b><br></b>  <b>apt-get install gdb</b> <br><br>  N√£o deu?  √ìtimo!  Repita usando a regra 1: <br><br>  <b>sudo apt-get install g + +</b> <b><br></b>  <b>sudo apt-get install gdb</b> <br><br>  Agora vamos para a Internet, no mecanismo de busca, digite: <br><br>  <b>IDE do Eclipse</b> <br><br>  Encontramos um link para eclipse.org, onde as primeiras op√ß√µes s√£o para Java, encontramos e baixamos uma op√ß√£o para C / C ++: <br><br><img src="https://habrastorage.org/webt/96/qw/qk/96qwqkb0litad1r1tujou2a9bae.png"><br><br>  Fa√ßa o download e descompacte, digamos, em casa. <br><br>  Na verdade, nenhuma instala√ß√£o √© necess√°ria.  V√° para o diret√≥rio em que tudo acabou de ser descompactado e execute o arquivo eclipse: <br><br><img src="https://habrastorage.org/webt/ir/70/5r/ir705r0y6iwxnnixuxatl8ajg5m.png"><br><br>  Estamos em um ambiente de desenvolvimento.  Bem, se voc√™ j√° trabalhou com microcontroladores e at√© n√∫cleos de processador para FPGAs, provavelmente j√° sabe o que √© o Eclipse.  Coisas t√£o familiares est√£o quase completas.  Come√ßamos a procurar coisas mais ou menos familiares.  Criamos o projeto C ++.  Devo dizer imediatamente que existem duas maneiras.  Um levar√° ao sucesso, o segundo a um beco sem sa√≠da.  Portanto, siga atentamente o caminho que trilho: <br><br><img src="https://habrastorage.org/webt/pn/p2/am/pnp2amrhevvek40jz7nqsocol5g.png"><br><br><img src="https://habrastorage.org/webt/a_/ge/sx/a_gesxu9d6u_hhbocj0mqah5xik.png"><br><br><img src="https://habrastorage.org/webt/14/zg/b0/14zgb0day-st8r8cyejyvxahtsk.png"><br><br>  Criamos um projeto que est√° indo bem.  Para configurar sua depura√ß√£o, v√° para as propriedades do GDB: <br><br><img src="https://habrastorage.org/webt/zd/zf/tz/zdzftzvpbfwkbs1mphkqdyrfv1a.png"><br><br>  Crie uma configura√ß√£o do Aplicativo Remoto do tipo C / C ++, no grupo Conex√£o, clique em Novo: <br><br><img src="https://habrastorage.org/webt/u1/dy/wb/u1dywbnrislxi82tujf7k3crbks.png"><br><br>  Escolha uma conex√£o como SSH: <br><br><img src="https://habrastorage.org/webt/j8/nt/td/j8nttddgczes40njsbis01oamzi.png"><br><br>  Preenchemos as propriedades da conex√£o alternando o bot√£o de op√ß√£o do tipo de autoriza√ß√£o para autoriza√ß√£o de senha: <br><br><img src="https://habrastorage.org/webt/i_/we/l1/i_wel1jpfgrjiale5pgsh7un8mg.png"><br><br>  Na verdade, o sistema est√° pronto para depura√ß√£o.  Depois de garantir que o texto de boas-vindas seja realmente exibido, tentamos transferir o c√≥digo do exemplo anterior (que estava no Visual Studio) aqui.  Para registrar bibliotecas adicionais, selecione as propriedades do projeto: <br><br><img src="https://habrastorage.org/webt/9i/b0/7r/9ib07rvhf55tqf7hvkewqsqbqau.png"><br><br>  Al√©m disso, como o assembly est√° acontecendo localmente, as bibliotecas tamb√©m devem estar no diret√≥rio local usr / local / lib.  Lembro que as bibliotecas foram baixadas com o driver, e como instal√°-las √© leia-me, bem como v√≠deos AN220 e YouTube, para obter detalhes, consulte a se√ß√£o no Visual Studio. <br><br>  Depois de toda essa prepara√ß√£o, temos as linhas familiares.  Ou seja, o c√≥digo completamente id√™ntico ao considerado na se√ß√£o anterior √© executado n√£o menos de forma id√™ntica. <br><br>  S√≥ isso.  Agora, dependendo da situa√ß√£o, podemos executar o c√≥digo pelo Visual Studio e por uma m√°quina virtual.  Como voc√™ pode ver, puramente em termos de configura√ß√µes, o Visual Studio √© mais simples, portanto, ceteris paribus, eu o escolherei.  Mas √© melhor possuir as duas tecnologias, pois o trabalho no Studio tem suas desvantagens relacionadas ao fato de que n√£o apenas a depura√ß√£o, mas tamb√©m a montagem √© remota. <br><br><h2>  Medi√ß√£o de velocidade de grava√ß√£o FPGA via FT2232H </h2><br>  Bem o que.  Vamos corrigir as habilidades adquiridas em um projeto mais ou menos real.  √â claro que come√ßar algo muito s√©rio n√£o √© mais poss√≠vel; todos j√° est√£o cansados.  Mas obtemos algum resultado mais ou menos pr√°tico.  Por exemplo, medimos com que velocidade m√°xima podemos transferir dados para o FPGA atrav√©s do chip FT2232H.  O protocolo n√£o √© o mais f√°cil, por isso n√£o o transmitiremos pelos dois lados, mas nos restringiremos a transmitir de n√≥s para o canal, na outra extremidade da qual o FPGA est√° instalado.  O documento <b>AN_130 FT2232H usado no modo FIFO s√≠ncrono estilo FT245</b> nos ajudar√° com isso, pois no complexo o controlador √© ativado precisamente neste modo (FIFO s√≠ncrono).  Este documento tamb√©m cont√©m uma descri√ß√£o das conclus√µes, na forma em que s√£o usadas nesse modo, diagramas de tempo e at√© exemplos de c√≥digo, dos quais nos inspiraremos. <br><br>  Ent√£o  Queremos gravar no FIFO usando o controlador.  O que vir√° de n√≥s?  Eu tentei, eu sei.  Ser√£o necess√°rios 1 kilobyte de dados, ap√≥s o que o controlador travar√°.  Ele se recusar√° a aceitar dados adicionais.  A quest√£o √© que um kilobyte √© do tamanho de seu buffer interno.  Embora seja poss√≠vel, os dados ser√£o obtidos do USB e armazenados neste espa√ßo.  Mas, para que eles acessem o canal s√≠ncrono, ele deve informar sobre a disponibilidade para receb√™-los.  N√≥s olhamos para o improvisado correspondente. <br><br><img src="https://habrastorage.org/webt/qq/9x/lj/qq9xljp4ma4jlpcprp5emofdraa.png"><br><br>  Ent√£o  Quando o controlador possui dados em FIFO, ele baixa o sinal RXF.  Em resposta a isso, devemos primeiro descartar o sinal de OE e mant√™-lo em zero por pelo menos um ciclo de clock (isso segue mais da descri√ß√£o para o diagrama do que do pr√≥prio diagrama).  Seremos dados no barramento, devemos confirmar sua recep√ß√£o com um baixo n√≠vel de sinal RD.  E assim - para todo o quadro.  Quando o controlador eleva a linha RXF, devemos remover o OE e o RD.  N√£o usaremos os dados hoje.  Para medir a velocidade, apenas simule o recebimento de dados no FPGA do FT2232H.  Bem ent√£o.  Para uma opera√ß√£o t√£o simples, nenhum sistema de processador √© necess√°rio.  Basta fazer um aut√¥mato degenerado, cujo desenvolvimento levar√° muito menos tempo do que apenas mexer na prepara√ß√£o do processador e no programa para ele.  Portanto, criamos um projeto que cont√©m apenas um arquivo SystemVerilog com o seguinte conte√∫do: <br><br><pre> <code class="plaintext hljs">module JustRead( input logic clk, input logic rxf_n, output logic oe_n, output logic rd_n ); enum {IDLE,TRANSFER} state = IDLE; always @ (posedge clk) begin oe_n &lt;= 1; rd_n &lt;= 1; case (state) IDLE: begin if (rxf_n == 0) begin oe_n &lt;= 0; state &lt;= TRANSFER; end end TRANSFER: begin if (rxf_n == 0) begin oe_n &lt;= 0; rd_n &lt;= 0; end else begin state &lt;= IDLE; end end endcase end endmodule</code> </pre><br>  A m√°quina possui dois estados.  Nesse caso, a dura√ß√£o do sinal OE √© determinada pelo fato de que ele √© engatilhado imediatamente ap√≥s o pulso do rel√≥gio e √© mantido at√© o pr√≥ximo.  Isso pode ser verificado usando o seguinte modelo: <br><br><pre> <code class="plaintext hljs">module JustReadTB( output logic clk, output logic rxf_n, input logic oe_n, input logic rd_n ); JustRead dut ( .clk, .rxf_n, .oe_n, .rd_n ); always begin clk = 1; #16; clk = 0; #16; end initial begin rxf_n = 1; #120; rxf_n = 0; #120; rxf_n = 1; end endmodule</code> </pre><br>  O tempo que levei foi o primeiro dispon√≠vel, √© a sequ√™ncia de comuta√ß√£o que √© anexada ao sinal do rel√≥gio que √© importante.  Temos o seguinte diagrama de tempo: <br><br> <a href=""><img src="https://habrastorage.org/webt/ps/kw/jw/pskwjww-komvozbyogvdndsukq8.png"></a> <br><br>  Numa primeira aproxima√ß√£o, isso corresponde ao que o documento exige.  Mas n√£o processaremos os dados reais de qualquer maneira. <br><br>  A atribui√ß√£o das pernas do FPGA neste projeto tamb√©m n√£o causa dificuldades, mesmo para editar atrav√©s de uma tabela (levar√° mais tempo para transferir atribui√ß√µes do arquivo * .QSF, e enfatizo constantemente que ao desenvolver sistemas de um dia no Redd, economizar tempo √© uma coisa priorit√°ria). <br><br><img src="https://habrastorage.org/webt/kp/8s/wq/kp8swq3ni8n0x02znmnexvjpfsk.png"><br><br>  N√≥s coletamos, preenchemos, antes de desligar a energia do complexo, voc√™ pode trabalhar com o programa, ele n√£o ser√° mais interrompido ap√≥s um estouro de buffer. <br><br>  No programa, eu fiz duas fun√ß√µes.  A primeira pesquisa e abre o dispositivo.  Peguei algo do √∫ltimo teste, peguei emprestado algo do <b>AN130</b> : <br><br><pre> <code class="plaintext hljs">FT_HANDLE OpenFT2232H() { FT_HANDLE ftHandle0; static FT_DEVICE ftDevice; //      int nDevice = 0; while (true) { //     if (FT_Open(nDevice, &amp;ftHandle0) != FT_OK) { //  ,      return 0; } //     ? if (FT_GetDeviceInfo(ftHandle0, &amp;ftDevice, NULL, NULL, NULL, NULL) == FT_OK) { // ,    if (ftDevice == FT_DEVICE_2232H) { // ,     AN130 FT_SetBitMode(ftHandle0, 0xff, 0x00); usleep(1000000); //Sync FIFO mode FT_SetBitMode(ftHandle0, 0xff, 0x40); FT_SetLatencyTimer(ftHandle0, 2); FT_SetUSBParameters(ftHandle0, maxBlockSize, maxBlockSize); return ftHandle0; } } //    FT_Close(ftHandle0); //    nDevice += 1; } }</code> </pre><br>  Como f√£ do Windows, tive que escrever a fun√ß√£o de medi√ß√£o de velocidade, verificando constantemente a Internet, pois normalmente uso os temporizadores cl√°ssicos de alta resolu√ß√£o da API do WIN32.  Talvez voc√™ possa escrever com mais efici√™ncia, mas este √© um programa de um dia. <br><br><pre> <code class="plaintext hljs">const int maxBlockSize = 0x100000; uint8_t buf[maxBlockSize]; ‚Ä¶ //   BlockSize ,  1 double TestSpeed(FT_HANDLE ftHandle0,int totalSize, int blockSize) { if (blockSize &gt; maxBlockSize) { return -1; } DWORD dwWrittenTotal = 0; timespec before; clock_gettime(CLOCK_REALTIME, &amp;before); for (int i = 0; i &lt; totalSize; i += blockSize) { DWORD dwWritten; FT_Write(ftHandle0, buf, blockSize, &amp;dwWritten); //     dwWrittenTotal += dwWritten; } timespec after; clock_gettime(CLOCK_REALTIME, &amp;after); if (dwWrittenTotal &lt; (DWORD)totalSize) { return -2; } //     uint64_t nsBefore = before.tv_nsec; uint64_t nsAfter = after.tv_nsec; //      nsAfter += (after.tv_sec - before.tv_sec) * 1000000000; //   nsAfter -= nsBefore; //      double res = ((double)nsAfter)/((double)1000000000); //   -    return ((double)dwWrittenTotal) / res; }</code> </pre><br>  Bem, o c√≥digo que executa a funcionalidade b√°sica ficou assim: <br><br><pre> <code class="plaintext hljs">int main(int argc, char* argv[]) { FT_HANDLE ftHandle0 = OpenFT2232H(); if (ftHandle0 == 0) { printf("Cannot open device\n"); return -1; } const int totalSize = 0x100000; static const int blockSizes[] = { 0x10,0x20,0x40,0x80,0x100,0x200,0x400,0x800,0x1000,0x2000, 0x4000,0x8000,0x10000,0x20000,0x40000,0x80000,0 }; for (int i = 0; blockSizes[i] != 0; i++) { double speed = TestSpeed(ftHandle0, totalSize, blockSizes[i]); printf("%d,%d\n", blockSizes[i], (int)(speed/1000.)); int stop = 0; } // ,    FT_Close(ftHandle0); return 0; }</code> </pre><br>  Eu sei que em USB, a velocidade depende muito do tamanho do bloco que est√° sendo enviado, ent√£o eu verifico a velocidade para v√°rias op√ß√µes.  A enumera√ß√£o linear quase n√£o √© necess√°ria.  Acabei de apresentar uma lista de tamanhos t√≠picos.  Eu produzo os dados em kilobytes por segundo.  Bytes s√£o desconfort√°veis ‚Äã‚Äãpara os olhos, megabytes t√™m uma baixa resolu√ß√£o com um tamanho de bloco pequeno.  Kilobytes por segundo √© um compromisso razo√°vel.  Obtemos os seguintes resultados: <br><pre> <code class="plaintext hljs">16,59 32,110 64,237 128,490 256,932 512,1974 1024,3760 2048,5594 4096,10729 8192,16109 16384,20170 32768,24248 65536,26664 131072,28583 262144,29370 524288,29832</code> </pre><br>  N√≥s os salvamos em um arquivo * .csv, os carregamos no Excel, constru√≠mos um gr√°fico da velocidade versus tamanho do bloco. <br><br><img src="https://habrastorage.org/webt/_o/ep/xe/_oepxe_wz65g7otcfeo3qete8xa.png"><br><br>  O limite √© de 30 megabytes por segundo.  At√© um m√°ximo te√≥rico de 52 MB / s agora.  Talvez voc√™ possa de alguma forma acelerar, mas deixe para os leitores na forma de trabalho pr√°tico.  O principal √© que dominamos todas as etapas do trabalho com o canal e estamos prontos para conectar o FPGA ao processador central em um √∫nico sistema. <br><br>  Enquanto o artigo estava sendo <b>compilado</b> , foi encontrado o documento <b>AN_165</b> , que dizia que a velocidade m√°xima no modo FIFO s√≠ncrono √© de 35 MB / s.  Ou seja, espa√ßo para crescimento - at√© um determinado tamanho.  Mas ainda est√° l√°. <br><br><h2>  Conclus√£o </h2><br>  N√≥s nos familiarizamos com duas estrat√©gias para desenvolver e depurar o c√≥digo do programa executado no processador central do complexo Redd (usando as ferramentas do Microsoft Visual Studio e em uma m√°quina virtual com o Linux OS).  Tamb√©m adquirimos habilidades pr√°ticas ao trabalhar com o canal atrav√©s do qual o processador central do complexo se comunica com o FPGA. <br><br>  Aparentemente, agora nada nos impede de transmitir dados significativos da CPU para o FPGA e vice-versa (embora no √∫ltimo artigo eu tenha escrito essas palavras). <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um exemplo que cont√©m o "firmware" mais simples para FPGAs e um programa que mede a velocidade de grava√ß√£o no USB pode ser </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">baixado aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt456008/">https://habr.com/ru/post/pt456008/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt455996/index.html">Transforma√ß√£o digital da publicidade no varejo de rede. Seguindo os passos do Video Analytics no varejo</a></li>
<li><a href="../pt456000/index.html">Criando um jogo Tic-Tac-Toe com TypeScript, React e Mocha</a></li>
<li><a href="../pt456002/index.html">Mem√≥ria dedicada da lareira e interven√ß√£o OOM Killer</a></li>
<li><a href="../pt456004/index.html">Convidamos voc√™ para uma reuni√£o de desenvolvimento front-end em servi√ßos altamente carregados</a></li>
<li><a href="../pt456006/index.html">Aumente sua receita usando compras no aplicativo</a></li>
<li><a href="../pt456010/index.html">Como o Java 10 muda a maneira como voc√™ usa classes internas an√¥nimas</a></li>
<li><a href="../pt456014/index.html">Sobre localiza√ß√£o de produtos. Parte 2: como √© formado o pre√ßo?</a></li>
<li><a href="../pt456016/index.html">Protocolo para comunica√ß√£o entre iframe e a janela principal</a></li>
<li><a href="../pt456018/index.html">Como implementar uma implanta√ß√£o do GitHub em um servidor de produ√ß√£o usando o Webhook</a></li>
<li><a href="../pt456020/index.html">Preparando-se para dominar o mundo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>