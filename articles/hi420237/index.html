<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯХН ЁЯЫАЁЯП┐ тЬКЁЯП┐ C ++ рдореЗрдВ gRPC рдврд╛рдВрдЪреЗ рдХреЗ рдЖрд╕рдкрд╛рд╕ Qt рдЖрд╡рд░рдг ЁЯТТ ЁЯШЫ ЁЯдг</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╕рднреА рдХреЛ рдирдорд╕реНрдХрд╛рд░ред рдЖрдЬ рд╣рдо рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рдЖрдк C ++ рдФрд░ Qt рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдореЗрдВ gRPC рдлреНрд░реЗрдорд╡рд░реНрдХ рдХреЛ рдХреИрд╕реЗ рд▓рд┐рдВрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рд▓реЗрдЦ рдЬреАрдЖрд░рдкреАрд╕реА рдореЗрдВ рд╕рднреА рдЪрд╛рд░ рдЗрдВрдЯрд░реИрдХреНрд╢рди рдореЛрдб рдХреЗ рдЙрдкрдпреЛрдЧ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C ++ рдореЗрдВ gRPC рдврд╛рдВрдЪреЗ рдХреЗ рдЖрд╕рдкрд╛рд╕ Qt рдЖрд╡рд░рдг</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420237/"><p>  рд╕рднреА рдХреЛ рдирдорд╕реНрдХрд╛рд░ред  рдЖрдЬ рд╣рдо рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рдЖрдк C ++ рдФрд░ Qt рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдореЗрдВ gRPC рдлреНрд░реЗрдорд╡рд░реНрдХ рдХреЛ рдХреИрд╕реЗ рд▓рд┐рдВрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд▓реЗрдЦ рдЬреАрдЖрд░рдкреАрд╕реА рдореЗрдВ рд╕рднреА рдЪрд╛рд░ рдЗрдВрдЯрд░реИрдХреНрд╢рди рдореЛрдб рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЛ рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рдХреЛрдб рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдХ рдХреЛрдб рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдХреНрдпреВрдЖрд░ рд╕рд┐рдЧреНрдирд▓ рдФрд░ рд╕реНрд▓реЙрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬреАрдЖрд░рдкреАрд╕реА рдХреЗ рдЙрдкрдпреЛрдЧ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рдЖрд▓реЗрдЦ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ Qt рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЗ рд▓рд┐рдП рдмреНрдпрд╛рдЬ рдХреА рд╣реЛ рд╕рдХрддреА рд╣реИ рдЬреЛ gRPC рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВред  рдлрд┐рд░ рднреА, рдЬреАрдЖрд░рдкреАрд╕реА рдХреЗ рдЪрд╛рд░ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рдореЛрдб рдХрд╛ рдПрдХ рд╕рд╛рдорд╛рдиреНрдпреАрдХрд░рдг рдХреНрдпреВрдЯреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдмрд┐рдирд╛ рд╕реА ++ рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ рдЙрди рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ рдЬреЛ рдХреЛрдб рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрдпреВрдЯреА рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдирд╣реАрдВ рд╣реИрдВред  рдореИрдВ рд╣рд░ рдХрд┐рд╕реА рд╕реЗ рдмрд┐рд▓реНрд▓реА рдХреЗ рдиреАрдЪреЗ рджрд┐рд▓рдЪрд╕реНрдкреА рд▓реЗрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рддрд╛ рд╣реВрдВред </p><a name="habracut"></a><br><h2>  рдкреНрд░рд╛рдЧрд┐рддрд┐рд╣рд╛рд╕ </h2><br><p>  рд▓рдЧрднрдЧ рдЫрд╣ рдорд╣реАрдиреЗ рдкрд╣рд▓реЗ, рджреЛ рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдиреЗ рдореБрдЭ рдкрд░ рд▓рдЯрдХрд╛ рджрд┐рдпрд╛, рдЬреАрдЖрд░рдкреАрд╕реА рдХреЗ рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ рд╕рд░реНрд╡рд░ рднрд╛рдЧреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред  рджреЛрдиреЛрдВ рдкрд░рд┐рдпреЛрдЬрдирд╛рдПрдВ рдЙрддреНрдкрд╛рджрди рдореЗрдВ рдЧрд┐рд░ рдЧрдИрдВред  рдЗрди рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдХреЛ рдбреЗрд╡рд▓рдкрд░реНрд╕ рджреНрд╡рд╛рд░рд╛ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рдерд╛ рдЬреЛ рдкрд╣рд▓реЗ рд╣реА рдЫреЛрдбрд╝ рдЪреБрдХреЗ рд╣реИрдВред  рдХреЗрд╡рд▓ рдЕрдЪреНрдЫреА рдЦрдмрд░ рдпрд╣ рдереА рдХрд┐ рдореИрдВрдиреЗ рдЬреАрдЖрд░рдкреАрд╕реА рд╕рд░реНрд╡рд░ рдФрд░ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛрдб рд▓рд┐рдЦрдиреЗ рдореЗрдВ рд╕рдХреНрд░рд┐рдп рднрд╛рдЧ рд▓рд┐рдпрд╛ред  рд▓реЗрдХрд┐рди рд╡реЛ рдХрд░реАрдм рдПрдХ рд╕рд╛рд▓ рдкрд╣рд▓реЗ рдХреА рдмрд╛рдд рд╣реИред  рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣, рдореБрдЭреЗ рдЦрд░реЛрдВрдЪ рд╕реЗ рд╕рдм рдХреБрдЫ рд╕реЗ рдирд┐рдкрдЯрдирд╛ рдкрдбрд╝рд╛ред </p><br><p>  рдЬреАрдЖрд░рдкреАрд╕реА рд╕рд░реНрд╡рд░ рдХреЛрдб рдЗрд╕ рдЕрдкреЗрдХреНрд╖рд╛ рдХреЗ рд╕рд╛рде рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рдерд╛ рдХрд┐ рдпрд╣ .proto рдлрд╝рд╛рдЗрд▓ рджреНрд╡рд╛рд░рд╛ рдЖрдЧреЗ рдЙрддреНрдкрдиреНрди рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдХреЛрдб рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рдерд╛ред  рд╣рд╛рд▓рд╛рдБрдХрд┐, рд╕рд░реНрд╡рд░ рдореЗрдВ рдПрдХ рдмрдбрд╝реА рдЦрд╛рдореА рдереА: рдХреЗрд╡рд▓ рдПрдХ рдЧреНрд░рд╛рд╣рдХ рдЗрд╕рд╕реЗ рдЬреБрдбрд╝ рд╕рдХрддрд╛ рдерд╛ред </p><br><p>  GRPC рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рдмрд╣реБрдд рднрдпрд╛рдирдХ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рдерд╛ред </p><br><p>  рдореБрдЭреЗ рдХреБрдЫ рджрд┐рдиреЛрдВ рдмрд╛рдж рд╣реА рдЧреНрд░рд╛рд╣рдХ рдФрд░ рд╕рд░реНрд╡рд░ рдХреЛрдб gRPC рдХрд╛ рдкрддрд╛ рдЪрд▓рд╛ред  рдФрд░ рдореБрдЭреЗ рдПрд╣рд╕рд╛рд╕ рд╣реБрдЖ рдХрд┐ рдЕрдЧрд░ рдореИрдВрдиреЗ рдХреБрдЫ рд╣рдлрд╝реНрддреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рд▓рд┐рдпрд╛, рддреЛ рдореБрдЭреЗ рд╕рд░реНрд╡рд░ рдФрд░ рдЬреАрдЖрд░рдкреАрд╕реА рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реЗ рдлрд┐рд░ рд╕реЗ рдирд┐рдкрдЯрдирд╛ рд╣реЛрдЧрд╛ред </p><br><p>  рдпрд╣ рддрдм рдерд╛ рдЬрдм рдореИрдВрдиреЗ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ рдХрд┐ рдпрд╣ рд▓рд┐рдЦрдиреЗ рдХрд╛ рд╕рдордп рдерд╛ рдФрд░ рдЬреАрдЖрд░рдкреАрд╕реА рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ рд╕рд░реНрд╡рд░ рдХреЛ рдбреАрдмрдЧ рдХрд░рдирд╛ рдерд╛ рддрд╛рдХрд┐: </p><br><ul><li><p>  рдЖрдк рд░рд╛рдд рдХреЛ рдЪреИрди рд╕реЗ рд╕реЛ рд╕рдХрддреЗ рдереЗ; </p></li><li><p>  рдпрд╣ рдпрд╛рдж рд░рдЦрдиреЗ рдХреА рдХреЛрдИ рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рдереА рдХрд┐ рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдЬрдм рднреА рдЖрдкрдХреЛ рдХреНрд▓рд╛рдЗрдВрдЯ рдпрд╛ рдЬреАрдЖрд░рдкреАрд╕реА рд╕рд░реНрд╡рд░ рд▓рд┐рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ; </p></li><li><p>  рдЖрдк рдЕрдиреНрдп рдкреНрд░реЛрдЬреЗрдХреНрдЯреНрд╕ рдореЗрдВ рд▓рд┐рдЦрд┐рдд gRPC рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ рд╕рд░реНрд╡рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p></li></ul><br><p>  рдХреЛрдб рд▓рд┐рдЦрддреЗ рд╕рдордп, рдореБрдЭреЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛: </p><br><ul><li><p>  рдЬреАрдЖрд░рдкреАрд╕реА рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ рд╕рд░реНрд╡рд░ рджреЛрдиреЛрдВ рд╣реА рдХреНрдпреВрдЯреА рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд╕рд┐рдЧреНрдирд▓ рдФрд░ рд╕реНрд▓реЙрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдкреНрд░рд╛рдХреГрддрд┐рдХ рддрд░реАрдХреЗ рд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ; </p></li><li><p>  рдЬреАрдЖрд░рдкреАрд╕реА рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ рд╕рд░реНрд╡рд░ рдХреЛрдб рдХреЛ .proto рдлрд╝рд╛рдЗрд▓ рдХреЛ рдмрджрд▓рддреЗ рд╕рдордп рдареАрдХ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ; </p></li><li><p>  рдЬреАрдЖрд░рдкреАрд╕реА рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛрдб рдХреЛ рд╕рд░реНрд╡рд░ рд╕реЗ рдХрдиреЗрдХреНрд╢рди рдХреА рд╕реНрдерд┐рддрд┐ рдмрддрд╛рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </p></li></ul><br><p>  рд▓реЗрдЦ рдХреА рд╕рдВрд░рдЪрдирд╛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛрдб рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рдкрд░рд┐рдгрд╛рдореЛрдВ рдФрд░ рдЗрд╕рдХреЗ рдХреБрдЫ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдгреЛрдВ рдХрд╛ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдЕрд╡рд▓реЛрдХрди рд╣реЛрдЧрд╛ред  рд╕рдореАрдХреНрд╖рд╛ рдХреЗ рдЕрдВрдд рдореЗрдВ, рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХрд╛ рдПрдХ рд▓рд┐рдВрдХред  рдЖрдЧреЗ рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдкрд░ рд╕рд╛рдорд╛рдиреНрдп рдЪреАрдЬреЗрдВ рд╣реЛрдВрдЧреАред  рдлрд┐рд░ рд╕рд░реНрд╡рд░ рдФрд░ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛрдб (рд╣реБрдб рдХреЗ рдиреАрдЪреЗ рдХреНрдпрд╛ рд╣реИ) рдФрд░ рдПрдХ рдирд┐рд╖реНрдХрд░реНрд╖ рдХрд╛ рд╡рд░реНрдгрдиред </p><br><h2>  рд╕рдВрдХреНрд╖рд┐рдкреНрдд рд╕рдореАрдХреНрд╖рд╛ </h2><br><p>  рд╕рд░рд▓рддрдо pingproto.proto рдлрд╝рд╛рдЗрд▓ рдХреЛ .proto рдлрд╝рд╛рдЗрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рдерд╛, рдЬрд┐рд╕рдореЗрдВ рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреЗ рдЗрдВрдЯрд░реИрдХреНрд╢рди рдХреЗ RPC рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛: </p><br><pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">syntax</span></span> = <span class="hljs-string"><span class="hljs-string">"proto3"</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">package</span></span> pingpong; <span class="hljs-attribute"><span class="hljs-attribute">service</span></span> ping { <span class="hljs-attribute"><span class="hljs-attribute">rpc</span></span> SayHello (PingRequest) returns (PingReply) {} <span class="hljs-attribute"><span class="hljs-attribute">rpc</span></span> GladToSeeMe(PingRequest) returns (stream PingReply){} <span class="hljs-attribute"><span class="hljs-attribute">rpc</span></span> GladToSeeYou(stream PingRequest) returns (PingReply){} <span class="hljs-attribute"><span class="hljs-attribute">rpc</span></span> BothGladToSee(stream PingRequest) returns (stream PingReply){} } <span class="hljs-attribute"><span class="hljs-attribute">message</span></span> PingRequest { <span class="hljs-attribute"><span class="hljs-attribute">string</span></span> name = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">string</span></span> message = <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-attribute"><span class="hljs-attribute">message</span></span> PingReply { <span class="hljs-attribute"><span class="hljs-attribute">string</span></span> message = <span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Pingpong.proto</a> рдлрд╝рд╛рдЗрд▓ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдирд░рдХ рд╕реЗ рд╕реА ++ рдореЗрдВ рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ gRPC рдореЛрдб</a> рдкрд░ рд▓реЗрдЦ рд╕реЗ helloworld.proto рдлрд╝рд╛рдЗрд▓ рджреЛрд╣рд░рд╛рддреА рд╣реИред </p><br><p>  рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдПрдХ рд▓рд┐рдЦрд┐рдд рд╕рд░реНрд╡рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЗрд╕ рддрд░рд╣ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: </p><br><pre> <code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> QObject { Q_OBJECT; QpingServerService pingservice; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: A() { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> is_ok; is_ok = connect(&amp;pingservice, SIGNAL(SayHelloRequest(SayHelloCallData*)), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, SLOT(onSayHello(SayHelloCallData*))); assert(is_ok); is_ok = connect(&amp;pingservice, SIGNAL(GladToSeeMeRequest(GladToSeeMeCallData*)), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, SLOT(onGladToSeeMe(GladToSeeMeCallData*))); assert(is_ok); is_ok = connect(&amp;pingservice, SIGNAL(GladToSeeYouRequest(GladToSeeYouCallData*)), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, SLOT(onGladToSeeYou(GladToSeeYouCallData*))); assert(is_ok); is_ok = connect(&amp;pingservice, SIGNAL(BothGladToSeeRequest(BothGladToSeeCallData*)), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, SLOT(onBothGladToSee(BothGladToSeeCallData*))); assert(is_ok); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> slots: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSayHello</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SayHelloCallData* cd)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"["</span></span> &lt;&lt; cd-&gt;peer() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"][11]: request: "</span></span> &lt;&lt; cd-&gt;request.name() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; cd-&gt;reply.set_message(<span class="hljs-string"><span class="hljs-string">"hello "</span></span> + cd-&gt;request.name()); cd-&gt;Finish(); } <span class="hljs-comment"><span class="hljs-comment">//etc. };</span></span></code> </pre><br><p>  рдЬрдм рдХреЛрдИ рдХреНрд▓рд╛рдЗрдВрдЯ RPC рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ, рддреЛ gRPC рд╕рд░реНрд╡рд░ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛрдб (рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдХреНрд▓рд╛рд╕ рдП) рдХреЛ рдЙрдЪрд┐рдд рд╕рд┐рдЧреНрдирд▓ рдХреЗ рд╕рд╛рде рд╕реВрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИред </p><br><p>  GRPC рдХреНрд▓рд╛рдЗрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЗрд╕ рддрд░рд╣ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> B : <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> QObject { Q_OBJECT QpingClientService pingPongSrv; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>: B() { <span class="hljs-type"><span class="hljs-type">bool</span></span> c = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; c = <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>(&amp;pingPongSrv, SIGNAL(SayHelloResponse(SayHelloCallData*)), this, SLOT(onSayHelloResponse(SayHelloCallData*))); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span>(c); c = <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>(&amp;pingPongSrv, SIGNAL(GladToSeeMeResponse(GladToSeeMeCallData*)), this, SLOT(onGladToSeeMeResponse(GladToSeeMeCallData*))); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span>(c); c = <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>(&amp;pingPongSrv, SIGNAL(GladToSeeYouResponse(GladToSeeYouCallData*)), this, SLOT(onGladToSeeYouResponse(GladToSeeYouCallData*))); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span>(c); c = <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>(&amp;pingPongSrv, SIGNAL(BothGladToSeeResponse(BothGladToSeeCallData*)), this, SLOT(onBothGladToSeeResponse(BothGladToSeeCallData*))); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span>(c); c = <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>(&amp;pingPongSrv, SIGNAL(channelStateChanged(<span class="hljs-type"><span class="hljs-type">int</span></span>, <span class="hljs-type"><span class="hljs-type">int</span></span>)), this, SLOT(onPingPongStateChanged(<span class="hljs-type"><span class="hljs-type">int</span></span>, <span class="hljs-type"><span class="hljs-type">int</span></span>))); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span>(c); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">usage</span></span>() { //Unary PingRequest request; request.set_name("user"); request.set_message("user"); pingPongSrv.SayHello(request); //<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span> streaming PingRequest request2; request2.set_name("user"); pingPongSrv.GladToSeeMe(request2); //etc. } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> slots: <span class="hljs-type"><span class="hljs-type">void</span></span> SayHelloResponse(SayHelloCallData* response) { std::cout &lt;&lt; "[11]: reply: " &lt;&lt; response-&gt;reply.message() &lt;&lt; std::endl; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (response-&gt;CouldBeDeleted()) <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> response; } //etc. };</code> </pre><br><p>  рдЬреАрдЖрд░рдкреАрд╕реА рдЧреНрд░рд╛рд╣рдХ рдЖрдкрдХреЛ рд╕реАрдзреЗ рдЖрд░рдкреАрд╕реА рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдФрд░ рдЙрдЪрд┐рдд рд╕рдВрдХреЗрддреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рд░реНрд╡рд░ рдХреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреА рд╕рджрд╕реНрдпрддрд╛ рд▓реЗрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </p><br><p>  GRPC рдХреНрд▓рд╛рдЗрдВрдЯ рдХрд╛ рднреА рдПрдХ рд╕рдВрдХреЗрдд рд╣реИ: <br><br></p><pre> <code class="hljs objectivec">channelStateChanged(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>);</code> </pre><br>  рдЬреЛ рдкрд┐рдЫрд▓реЗ рдФрд░ рд╡рд░реНрддрдорд╛рди рд╕рд░реНрд╡рд░ рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдкрд░ рд░рд┐рдкреЛрд░реНрдЯ рдХрд░рддрд╛ рд╣реИред  рд╕рднреА <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдирдореВрдирд╛</a> рдХреЛрдб <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">qgrpc рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рд╣реИ</a> ред <br><br><h2>  рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ </h2><br><p>  рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ gRPC рд╕рд░реНрд╡рд░ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдХрд╛ рд╕рд┐рджреНрдзрд╛рдВрдд рдЪрд┐рддреНрд░ рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i3/h9/ad/i3h9ad3c3joddotb7akq1iagpnc.jpeg"></div><br><p>  .Pro рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ, .proto рдлрд╝рд╛рдЗрд▓ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХреА рдЬрд╛рддреА рд╣реИрдВ, рдЬрд┐рд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░ gRPC рдХрд╛рдо рдХрд░реЗрдЧреАред  Grpc.pri рдлрд╝рд╛рдЗрд▓ рдореЗрдВ gRPC рдФрд░ QgRPC рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрджреЗрд╢ рд╣реИрдВред  рдкреНрд░реЛрдЯреЛрдХ рдХрдВрдкрд╛рдЗрд▓рд░ gRPC рдлрд╛рдЗрд▓реНрд╕ [protofile] .grpc.pb.h рдФрд░ [protofile] .grpc.pb.cc рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред  [рдкреНрд░реЛрдЯреЛрдлрд╛рдЗрд▓] .proto рдлрд╛рдЗрд▓ рдХрд╛ рдирд╛рдо рд╣реИ рдЬреЛ рдХрдВрдкрд╛рдЗрд▓рд░ рдЗрдирдкреБрдЯ рдореЗрдВ рдЬрд╛рддреА рд╣реИред </p><br><p>  QgRPC рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдкреАрдврд╝реА [рдкреНрд░реЛрдЯреЙрдлрд╝рд╛рдЗрд▓] .qgrpcред [рд╡рд┐рдиреНрдпрд╛рд╕] .h рдХреЛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ genQGrpc.py рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  [рд╡рд┐рдиреНрдпрд╛рд╕] рдпрд╛ рддреЛ "рд╕рд░реНрд╡рд░" рдпрд╛ "рдХреНрд▓рд╛рдЗрдВрдЯ" рд╣реИред <br><br>  рдЬреЗрдирд░реЗрдЯ рдХреА рдЧрдИ QgRPC рдлрд╛рдЗрд▓реЛрдВ рдореЗрдВ gRPC рдХреНрд▓рд╛рд╕реЗрд╕ рдХреЗ рдЖрд╕рдкрд╛рд╕ Qt рдЖрд╡рд░рдг рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реА рд╕рд┐рдЧреНрдирд▓ рдХреЗ рд╕рд╛рде рдХреЙрд▓ рд╣реЛрддреЗ рд╣реИрдВред  рдкрд┐рдЫрд▓реЗ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдореЗрдВ, QpingServerService рдФрд░ QpingClientService рдХрдХреНрд╖рд╛рдПрдВ рдХреНрд░рдорд╢рдГ рдЙрддреНрдкрдиреНрди рдлрд╝рд╛рдЗрд▓реЛрдВ pingpong.qgrpc.server.h рдФрд░ pingpong.qgrpc.client.h рдореЗрдВ рдШреЛрд╖рд┐рдд рдХреА рдЬрд╛рддреА рд╣реИрдВред  рдЙрддреНрдкрдиреНрди QgRPC рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ moc рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  рдЙрддреНрдкрдиреНрди QgRPC рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ, QGrpc [config] .h рдлрд╛рдЗрд▓реЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ рд╕рднреА рдореБрдЦреНрдп рдХрд╛рд░реНрдп рд╣реЛрддреЗ рд╣реИрдВред  рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдиреАрдЪреЗ рдкрдврд╝реЗрдВред </p><br><p>  рдЗрд╕ рд╕рднреА рдирд┐рд░реНрдорд╛рдг рдХреЛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ .pri рдлрд╝рд╛рдЗрд▓ рдХреЛ .pro рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдФрд░ рддреАрди рдЪрд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  GRPC рд╡реИрд░рд┐рдПрдмрд▓ .proto рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдкреНрд░реЛрдЯреЛрдХ рдХрдВрдкрд╛рдЗрд▓рд░ рдФрд░ genQGrpc.py рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рдЗрдирдкреБрдЯ рдкрд░ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рд╣реЛ рдЬрд╛рдПрдВрдЧреЗред  QGRPC_CONFIG рдЪрд░ рдЙрддреНрдкрдиреНрди QgRPC рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдорд╛рди рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдореЗрдВ "рд╕рд░реНрд╡рд░" рдпрд╛ "рдХреНрд▓рд╛рдЗрдВрдЯ" рдорд╛рди рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред  рдЖрдк рдЬреАрдЖрд░рдкреАрд╕реА рдХреЗ рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡реИрдХрд▓реНрдкрд┐рдХ GRPC_VERSION рдЪрд░ рдХреЛ рднреА рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рд╕рдм рдХреБрдЫ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП, grpc.pri рдлрд╝рд╛рдЗрд▓ рдФрд░ .pro рдЙрджрд╛рд╣рд░рдг рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдкрдврд╝реЗрдВред </p><br><h2>  рд╕рд░реНрд╡рд░ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ </h2><br><p>  рд╕рд░реНрд╡рд░ рд╡рд░реНрдЧ рдЖрд░реЗрдЦ рдЪрд┐рддреНрд░ рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nd/ec/ae/ndecaezqpvmh1kn9iviw6yuic9i.jpeg"></div><br><p>  рдореЛрдЯреЗ рддреАрд░ рд╡рд░реНрдЧ рд╡рдВрд╢рд╛рдиреБрдХреНрд░рдо рдХреЗ рдкрджрд╛рдиреБрдХреНрд░рдо рдХреЛ рджрд┐рдЦрд╛рддреЗ рд╣реИрдВ, рдФрд░ рдкрддрд▓реЗ рддреАрд░ рдХрдХреНрд╖рд╛рдУрдВ рдореЗрдВ рд╕рджрд╕реНрдпреЛрдВ рдФрд░ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреА рд╕рджрд╕реНрдпрддрд╛ рджрд┐рдЦрд╛рддреЗ рд╣реИрдВред  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, Q [servicename] ServerService рд╡рд░реНрдЧ рд╕реЗрд╡рд╛ рдХреЗ рд▓рд┐рдП рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИ, рдЬрд╣рд╛рдБ servicename .proto рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдШреЛрд╖рд┐рдд рд╕реЗрд╡рд╛ рдХрд╛ рдирд╛рдо рд╣реИред  RPCCallData рд╕реЗрд╡рд╛ рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ RPC рдХреЗ рд▓рд┐рдП рдЙрддреНрдкрдиреНрди рдирд┐рдпрдВрддреНрд░рдг рд╕рдВрд░рдЪрдирд╛рдПрдБ рд╣реИрдВред  QpingServerService рд╡рд░реНрдЧ рдХреЗ рдирд┐рд░реНрдорд╛рддрд╛ рдореЗрдВ, рдмреЗрд╕ рдХреНрд▓рд╛рд╕ QGrpcServerService рдХреЛ gRPC pingpong :: ping :: AsyncService рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рд╕реЗрд╡рд╛ рдХреЗ рд╕рд╛рде рдЖрд░рдВрднреАрдХреГрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕реЗрд╡рд╛ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдкрддрд╛ рдФрд░ рдкреЛрд░реНрдЯ рдХреЗ рд╕рд╛рде рд╕реНрдЯрд╛рд░реНрдЯ () рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдЬрд┐рд╕ рдкрд░ рд╕реЗрд╡рд╛ рдЪрд▓реЗрдЧреАред  рдкреНрд░рд╛рд░рдВрдн () рдлрд╝рдВрдХреНрд╢рди рд╕реЗрд╡рд╛ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рдирдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИред </p><br><p>  рдкреНрд░рд╛рд░рдВрдн () рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдЕрдВрдд рдореЗрдВ, рд╢реБрджреНрдз рд╡рд░реНрдЪреБрдЕрд▓ рдлрд╝рдВрдХреНрд╢рди рдореЗрдХрдПрд░реЗрдкрд┐рд╕реНрдЯреНрд╕ () рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдХрд┐ рдЬреЗрдирд░реЗрдЯрд┐рдВрдЧ QpingServerService рд╡рд░реНрдЧ рдореЗрдВ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: </p><br><pre> <code class="hljs xml">void makeRequests() { needAnotherCallData<span class="hljs-tag"><span class="hljs-tag">&lt; </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SayHello_RPCtypes</span></span></span><span class="hljs-tag">, </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SayHelloCallData</span></span></span><span class="hljs-tag"> &gt;</span></span>(); needAnotherCallData<span class="hljs-tag"><span class="hljs-tag">&lt; </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">GladToSeeMe_RPCtypes</span></span></span><span class="hljs-tag">, </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">GladToSeeMeCallData</span></span></span><span class="hljs-tag"> &gt;</span></span>(); needAnotherCallData<span class="hljs-tag"><span class="hljs-tag">&lt; </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">GladToSeeYou_RPCtypes</span></span></span><span class="hljs-tag">, </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">GladToSeeYouCallData</span></span></span><span class="hljs-tag"> &gt;</span></span>(); needAnotherCallData<span class="hljs-tag"><span class="hljs-tag">&lt; </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BothGladToSee_RPCtypes</span></span></span><span class="hljs-tag">, </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BothGladToSeeCallData</span></span></span><span class="hljs-tag"> &gt;</span></span>(); }</code> </pre><br><p>  NeedAnotherCallData рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рджреВрд╕рд░рд╛ рдЯреЗрдореНрдкрд▓реЗрдЯ рдкреИрд░рд╛рдореАрдЯрд░ рдЙрддреНрдкрдиреНрди RPCCallData рд╕рдВрд░рдЪрдирд╛ рд╣реИред  рд╕рдорд╛рди рд╕рдВрд░рдЪрдирд╛рдПрдВ рд╕реЗрд╡рд╛ рдХреЗ рдЙрддреНрдкрдиреНрди рдХреНрдпреВрдЯреА рд╡рд░реНрдЧ рдореЗрдВ рд╕рдВрдХреЗрддреЛрдВ рдХреЗ рдкреИрд░рд╛рдореАрдЯрд░ рд╣реИрдВред </p><br><p>  рдЙрддреНрдкрдиреНрди RPCCallData рд╕рдВрд░рдЪрдирд╛ ServerCallData рд╡рд░реНрдЧ рд╕реЗ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдорд┐рд▓реАред  рдмрджрд▓реЗ рдореЗрдВ, ServerCallData рд╡рд░реНрдЧ рд╕рд░реНрд╡рд░Responder рдЙрддреНрддрд░рджрд╛рддрд╛ рд╕реЗ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдорд┐рд▓рд╛ рд╣реИред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╕реБрд╕рдВрдЧрдд рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреА рдПрдХ рд╡рд╕реНрддреБ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдПрдХ рдкреНрд░рддреНрдпреБрддреНрддрд░ рд╡рд╕реНрддреБ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреА рдУрд░ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  ServerCallData рд╡рд░реНрдЧ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрдорд╛рддрд╛ рджреЛ рдкреИрд░рд╛рдореАрдЯрд░ рд▓реЗрддрд╛ рд╣реИ: signal_func рдФрд░ request_funcред  signal_func рдПрдХ рдЙрддреНрдкрдиреНрди рд╕рдВрдХреЗрдд рд╣реИ рдЬрд┐рд╕реЗ рдХрддрд╛рд░ рд╕реЗ рдЯреИрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  request_func рдПрдХ рдРрд╕рд╛ рдлрдВрдХреНрд╢рди рд╣реИ рдЬрд┐рд╕реЗ рдПрдХ рдирдпрд╛ рд░реЗрд╕реНрдкреЛрдВрдбрд░ рдмрдирд╛рддреЗ рд╕рдордп рдХрд╣рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдпрд╣ RequestSayHello () рдлрд╝рдВрдХреНрд╢рди рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  Request_func рдХреЙрд▓ рдХреА рдЬрд░реВрд░рдд рд╣реИрдЕрдиреЛрдереЗрд░рд┐рдХрдбрд╛рд▓рдбрд╛рдЯрд╛ () рдлрд╝рдВрдХреНрд╢рди рдореЗрдВред  рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╕реЗрд╡рд╛ рдореЗрдВ рдЙрддреНрддрд░рджрд╛рддрд╛рдУрдВ (рдирд┐рд░реНрдорд╛рдг рдФрд░ рд╡рд┐рд▓реЛрдкрди) рдХрд╛ рдкреНрд░рдмрдВрдзрди рд╣реЛ рд╕рдХреЗред </p><br><p>  NeedAnotherCallData () рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдХреЛрдб рдореЗрдВ рдПрдХ рд░реЗрд╕реНрдкреЛрдВрдбрд░ рдСрдмреНрдЬреЗрдХреНрдЯ рдмрдирд╛рдиреЗ рдФрд░ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рд░реЗрд╕реНрдкреЙрдиреНрдбрд░ рдХреЛ рдПрдХ рдЖрд░рдкреАрд╕реА рдХреЙрд▓ рд╕реЗ рдЬреЛрдбрд╝рддрд╛ рд╣реИ: </p><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RPCCallData</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RPCTypes</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">needAnotherCallData</span></span></span><span class="hljs-class">() {</span></span> RPCCallData* cd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RPCCallData(); <span class="hljs-comment"><span class="hljs-comment">//... RequestRPC&lt;RPCTypes::kind, ...&gt; (service_, cd-&gt;request_func_, cd-&gt;responder, ..., (void*)cd); }</span></span></code> </pre><br><p>  RequestRPC () рдлрд╝рдВрдХреНрд╢рди рдЪрд╛рд░ рдкреНрд░рдХрд╛рд░ рдХреЗ рдЗрдВрдЯрд░реИрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдЯреЗрдореНрдкрд▓реЗрдЯ рдлрд╝рдВрдХреНрд╢рдВрд╕ рд╣реИрдВред  рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП RequestRPC () рдЙрдмрд▓рддрд╛ рд╣реИ: </p><br><pre> <code class="hljs lisp">service_-&gt;(<span class="hljs-name"><span class="hljs-name">cd-&gt;request_func_</span></span>)(...,cd-&gt;responder, (<span class="hljs-name"><span class="hljs-name">void*</span></span>)cd)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre><br><p>  рдЬрд╣рд╛рдБ рд╕реЗрд╡рд╛_ gRPC рд╕реЗрд╡рд╛ рд╣реИред  рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдпрд╣ pingpong :: ping :: AsyncService рд╣реИред </p><br><p>  рд╕рд┐рдВрдХреНрд░реЛрдирд╛рдЗрдЬрд╝ рдпрд╛ рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕рд▓реА рдИрд╡реЗрдВрдЯ рдХрддрд╛рд░ рдХреА рдЬрд╛рдБрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдХреНрд░рдорд╢рдГ CheckCQ () рдпрд╛ AsyncCheckCQ () рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  CheckCQ () рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдХреЛрдб рдХрддрд╛рд░ рд╕реЗ рддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдЯреИрдЧ рдФрд░ рдЗрд╕ рдЯреИрдЧ рдХреЗ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд▓рд┐рдП рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдиреАрдЪреЗ рдЖрддрд╛ рд╣реИ: </p><br><pre> <code class="hljs pgsql">virtual <span class="hljs-type"><span class="hljs-type">void</span></span> CheckCQ() override { <span class="hljs-type"><span class="hljs-type">void</span></span>* tag; <span class="hljs-type"><span class="hljs-type">bool</span></span> ok; server_cq_-&gt;Next(&amp;tag, &amp;ok); //tagActions_ <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!tag) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; AbstractCallData* cd = (AbstractCallData*)tag; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!started_.<span class="hljs-keyword"><span class="hljs-keyword">load</span></span>()) { destroyCallData(cd); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } cd-&gt;cqReaction(this, ok); }</code> </pre><br><p>  рдХрддрд╛рд░ рд╕реЗ рдЯреИрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЯреИрдЧ рдФрд░ рд╕рд░реНрд╡рд░ рдкреНрд░рд╛рд░рдВрдн рдХреА рд╡реИрдзрддрд╛ рдХреА рдЬрд╛рдБрдЪ рдХреА рдЬрд╛рддреА рд╣реИред  рдпрджрд┐ рд╕рд░реНрд╡рд░ рдмрдВрдж рд╣реИ, рддреЛ рдЯреИрдЧ рдХреА рдЕрдм рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ - рдЗрд╕реЗ рд╣рдЯрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЙрд╕рдХреЗ рдмрд╛рдж, ServerCallData рд╡рд░реНрдЧ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд cqReaction () рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ: </p><br><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cqReaction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QGrpcServerService* service_, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ok)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!first_time_reaction_) { first_time_reaction_ = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; service_-&gt;needAnotherCallData&lt;RPC, RPCCallData&gt;(); } <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> genRpcCallData = <span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;RPCCallData*&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* tag = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>*&gt;(genRpcCallData); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;CouldBeDeleted()) { service_-&gt;destroyCallData(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;processEvent(tag, ok)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-comment"><span class="hljs-comment">//call generated service signal with generated call data argument service_-&gt;(*signal_func_)(genRpcCallData); }</span></span></code> </pre><br><p>  First_time_reaction_ рдзреНрд╡рдЬ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ RPC рдХреЗ рд▓рд┐рдП рдПрдХ рдирдпрд╛ рдкреНрд░рддреНрдпреБрддреНрддрд░ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдлрд╝рдВрдХреНрд╢рдВрд╕ рд╕рдХрддреЗ рд╣реИрдВрдмреЗрдбрд▓реЗрдЯ () рдФрд░ ProcessEvent () рд╕рдВрдмрдВрдзрд┐рдд ServerResponder рдЙрддреНрддрд░рджрд╛рддрд╛ рд╡рд░реНрдЧ рд╕реЗ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдорд┐рд▓реЗ рд╣реИрдВред  CanBeDeleted () рдлрд╝рдВрдХреНрд╢рди рдПрдХ рд╕рдВрдХреЗрдд рджреЗрддрд╛ рд╣реИ рдХрд┐ рдкреНрд░рддреНрдпреБрддреНрддрд░ рдСрдмреНрдЬреЗрдХреНрдЯ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  ProcessEvent () рдлрд╝рдВрдХреНрд╢рди рдЯреИрдЧ рдФрд░ рдУрдХреЗ рдлреНрд▓реИрдЧ рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рдкреНрд░рдХрд╛рд░ рдХреЗ рдЙрддреНрддрд░рджрд╛рддрд╛ рдХреЗ рд▓рд┐рдП, рдлрд╝рдВрдХреНрд╢рди рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ: </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processEvent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tag, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ok</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;tag_ = tag; read_mode_ = ok; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre><br><p>  ProcessEvent () рдлрд╝рдВрдХреНрд╢рди, рдкреНрд░рддреНрдпреБрддреНрддрд░ рдХреЗ рдкреНрд░рдХрд╛рд░ рдХреА рдкрд░рд╡рд╛рд╣ рдХрд┐рдП рдмрд┐рдирд╛, рд╣рдореЗрд╢рд╛ рд╕рдЪ рд╣реЛрддрд╛ рд╣реИред  рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рд░рд┐рдЯрд░реНрди рдорд╛рди рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЗ рд╕рдВрднрд╛рд╡рд┐рдд рд╡рд┐рд╕реНрддрд╛рд░ рдХреЗ рд▓рд┐рдП рдФрд░ рд╕реИрджреНрдзрд╛рдВрддрд┐рдХ рд░реВрдк рд╕реЗ рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЛ рдЦрддреНрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЫреЛрдбрд╝ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  рдШрдЯрдирд╛ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдХреЙрд▓ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ: <br><br></p><pre> <code class="hljs lisp">service_-&gt;(<span class="hljs-name"><span class="hljs-name">*signal_func_</span></span>)(<span class="hljs-name"><span class="hljs-name">genRpcCallData</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre><br><p>  рд╡реЗрд░рд┐рдПрдмрд▓ рд╕рд░реНрд╡рд┐рд╕_ рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдХреНрдпреВрдкрд┐рдВрдЧрд╕рд░реНрд╡рд░ рд╕рд░реНрд╡рд┐рд╕ рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рд╕рд░реНрд╡рд┐рд╕ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИред  рд╡реИрд░рд┐рдПрдмрд▓ рд╕рд┐рдЧреНрдирд▓_рдлреБрдирдХ_ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЖрд░рдкреАрд╕реА рдХреЗ рдЕрдиреБрд░реВрдк рд╕реЗрд╡рд╛ рд╕рд┐рдЧреНрдирд▓ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, SayHelloRequest ()ред  рдЪрд░ genRpcCallData рдЗрд╕реА рдкреНрд░рдХрд╛рд░ рдХрд╛ рдПрдХ рдЙрддреНрддрд░рджрд╛рддрд╛ рд╡рд╕реНрддреБ рд╣реИред  рдХреЙрд▓рд┐рдВрдЧ рдХреЛрдб рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, рдЪрд░ genRpcCallData рдЙрддреНрдкрдиреНрди RPCCallataata рд╕рдВрд░рдЪрдирд╛рдУрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдХрд╛ рдПрдХ рдЙрджреНрджреЗрд╢реНрдп рд╣реИред <br></p><br><h2>  рдЧреНрд░рд╛рд╣рдХ рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ </h2><br><p>  рдЬрдм рднреА рд╕рдВрднрд╡ рд╣реЛ, рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рд╡рд░реНрдЧреЛрдВ рдФрд░ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдирд╛рдо рд╕рд░реНрд╡рд░ рдХреЗ рд╡рд░реНрдЧреЛрдВ рдФрд░ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдирд╛рдо рд╕реЗ рдореЗрд▓ рдЦрд╛рддреЗ рд╣реИрдВред  рдХреНрд▓рд╛рдЗрдВрдЯ рдХреНрд▓рд╛рд╕ рдЖрд░реЗрдЦ рдЪрд┐рддреНрд░ рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4u/ak/xe/4uakxee1iettn1zm_7fooerdosc.jpeg"></div><br><p>  рдореЛрдЯреЗ рддреАрд░ рд╡рд░реНрдЧ рд╡рдВрд╢рд╛рдиреБрдХреНрд░рдо рдХреЗ рдкрджрд╛рдиреБрдХреНрд░рдо рдХреЛ рджрд┐рдЦрд╛рддреЗ рд╣реИрдВ, рдФрд░ рдкрддрд▓реЗ рддреАрд░ рдХрдХреНрд╖рд╛рдУрдВ рдореЗрдВ рд╕рджрд╕реНрдпреЛрдВ рдФрд░ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреА рд╕рджрд╕реНрдпрддрд╛ рджрд┐рдЦрд╛рддреЗ рд╣реИрдВред  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рд╕реЗрд╡рд╛ рдХреЗ рд▓рд┐рдП, рдХреНрдпреВ [рд╕рд░реНрд╡рд┐рд╕рд┐рдХрдирд╛рдо] рдХреНрд▓рд╛рдпрдВрдЯрд╕реЗрд╡рд╛ рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИ, рдЬрд╣рд╛рдБ рд╕рд░реНрд╡рд┐рд╕ рдирд╛рдо .pro рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдШреЛрд╖рд┐рдд рд╕реЗрд╡рд╛ рдХрд╛ рдирд╛рдо рд╣реИред  RPCCallData рд╕реЗрд╡рд╛ рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ RPC рдХреЗ рд▓рд┐рдП рдЙрддреНрдкрдиреНрди рдирд┐рдпрдВрддреНрд░рдг рд╕рдВрд░рдЪрдирд╛рдПрдБ рд╣реИрдВред  RPC рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЙрддреНрдкрдиреНрди рд╡рд░реНрдЧ рдлрд╝рдВрдХреНрд╢рдВрд╕ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬрд┐рдирдХреЗ рдирд╛рдо .pro рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдШреЛрд╖рд┐рдд RPC рд╕реЗ рдмрд┐рд▓реНрдХреБрд▓ рдореЗрд▓ рдЦрд╛рддреЗ рд╣реИрдВред  рд╣рдорд╛рд░реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, .pro RPC рдлрд╝рд╛рдЗрд▓ рдореЗрдВ SayHello () рдХреЗ рд░реВрдк рдореЗрдВ рдШреЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ: <br><br></p><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">rpc </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SayHello</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PingRequest</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PingReply</span></span></span><span class="hljs-function">)</span></span> {}</code> </pre><br><p>  рдЙрддреНрдкрдиреНрди QpingClientService рд╡рд░реНрдЧ рдореЗрдВ, рдЗрд╕реА RPC рдлрд╝рдВрдХреНрд╢рди рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ: </p><br><pre> <code class="hljs vbscript">void SayHello(PingRequest <span class="hljs-built_in"><span class="hljs-built_in">request</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!connected()) return; SayHelloCallData* <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SayHelloCallData; <span class="hljs-keyword"><span class="hljs-keyword">call</span></span>-&gt;<span class="hljs-built_in"><span class="hljs-built_in">request</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">request</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">call</span></span>-&gt;responder = stub_-&gt;AsyncSayHello(&amp;<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>-&gt;context, <span class="hljs-built_in"><span class="hljs-built_in">request</span></span>, &amp;cq_); <span class="hljs-keyword"><span class="hljs-keyword">call</span></span>-&gt;responder-&gt;Finish(&amp;<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>-&gt;reply, &amp;<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>-&gt;status, (void*)<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>); }</code> </pre><br><p>  рдЙрддреНрдкрдиреНрди RPCCallData рд╕рдВрд░рдЪрдирд╛рдПрдВ, рдЬреИрд╕рд╛ рдХрд┐ рд╕рд░реНрд╡рд░ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ, рдЕрдВрддрддрдГ ClientResponder рд╡рд░реНрдЧ рд╕реЗ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдорд┐рд▓реА рд╣реИрдВред  рдЗрд╕рд▓рд┐рдП, рдЙрддреНрдкрдиреНрди рд╕рдВрд░рдЪрдирд╛ рдХреА рдПрдХ рд╡рд╕реНрддреБ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдПрдХ рдкреНрд░рддреНрдпреБрддреНрддрд░ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреА рдУрд░ рдЬрд╛рддрд╛ рд╣реИред  рд░реЗрд╕реНрдкреЛрдВрдбрд░ рдмрдирд╛рдиреЗ рдХреЗ рдмрд╛рдж, RPC рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рд░рд┐рд╕реНрдкреЛрдВрдбрд░ рдХреЛ рд╕рд░реНрд╡рд░ рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдШрдЯрдирд╛ рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИред  рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛрдб рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ, рдПрдХ RPC рдХреЙрд▓ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ: </p><br><pre> <code class="hljs vbscript">void ToSayHello() { PingRequest <span class="hljs-built_in"><span class="hljs-built_in">request</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">request</span></span>.set_name(<span class="hljs-string"><span class="hljs-string">"user"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">request</span></span>.set_message(<span class="hljs-string"><span class="hljs-string">"user"</span></span>); pingPongSrv.SayHello(<span class="hljs-built_in"><span class="hljs-built_in">request</span></span>); }</code> </pre><br><p>  рдЬреЗрдирд░реЗрдЯрд┐рдВрдЧ QpingServerService рд╕рд░реНрд╡рд░ рд╡рд░реНрдЧ рдХреЗ рд╡рд┐рдкрд░реАрдд, QpingClientService рд╡рд░реНрдЧ рджреЛ рдЯреЗрдореНрдкреНрд▓реЗрдЯ рд╡рд░реНрдЧреЛрдВ рд╕реЗ рдЗрдирд╣реЗрд░рд┐рдЯ рдХрд░рддрд╛ рд╣реИ: рдХрдиреЗрдХреНрдЯрд┐рд╡рд┐рдЯреАрдлреНрд░реАрдЪрд░ рдФрд░ рдореЙрдирд┐рдЯрд░рдлреНрд░реАрдЪрд░ред </p><br><p>  ConnectivityFeatures рд╡рд░реНрдЧ рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рд░реНрд╡рд░ рдХрдиреЗрдХреНрд╢рди рдХреА рд╕реНрдерд┐рддрд┐ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИ рдФрд░ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рддреАрди рдлрд╝рдВрдХреНрд╢рди рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ: grpc_connect (), grpc_disconnect (), grpc_reconnect ()ред  Grpc_disconnect () рдлрд╝рдВрдХреНрд╢рди рдХреЗрд╡рд▓ рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╕рднреА рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреЛ рд╣рдЯрд╛ рджреЗрддрд╛ рд╣реИред  Grpc_connect рдХреЗ рдХреЙрд▓ рдХреЛ grpc_connect_ () рдлрд╝рдВрдХреНрд╢рди рдкрд░ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдо рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдирд┐рдпрдВрддреНрд░рдг рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреЛ рдмрдирд╛рддрд╛ рд╣реИ: </p><br><pre> <code class="hljs php">void grpc_connect_() { channel_ = grpc::CreateChannel(target_, creds_); stub_ = GRPCService::NewStub(channel_); channelFeatures_ = std::make_unique&lt;ChannelFeatures&gt;(channel_); channelFeatures_-&gt;checkChannelState(); }</code> </pre><br><p>  ChannelFeatures рд╡рд░реНрдЧ рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде <em>Channel_</em> рдЪреИрдирд▓ рд╕рдВрдЪрд╛рд░ рдХреА рд╕реНрдерд┐рддрд┐ рдкрд░ рдирдЬрд╝рд░ рд░рдЦрддрд╛ рд╣реИред  рдХрдиреЗрдХреНрдЯрд┐рд╡рд┐рдЯреАрдлрд╛рдЗрдЯреНрд╕ рд╡рд░реНрдЧ ChannelFeatures рд╡рд░реНрдЧ рдХреА рдПрдХ рд╡рд╕реНрддреБ рдХреЛ рдПрдирдХреИрдкреНрд╕реБрд▓реЗрдЯ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕ рдСрдмреНрдЬреЗрдХреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдмреНрд╕реНрдЯреНрд░реИрдХреНрдЯ рдлрд╝рдВрдХреНрд╢рдВрд╕ ChannelState (), checkChannelState (), рдФрд░ рдХрдиреЗрдХреНрдЯреЗрдб () рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИред  ChannelState () рдлрд╝рдВрдХреНрд╢рди рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде рд╕рдВрдЪрд╛рд░ рдЪреИрдирд▓ рдХреЗ рдЕрдВрддрд┐рдо рджреЗрдЦреЗ рдЧрдП рд░рд╛рдЬреНрдп рдХреЛ рд╡рд╛рдкрд╕ рдХрд░рддрд╛ рд╣реИред  CheckChannelState () рдлрд╝рдВрдХреНрд╢рди, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдЪреИрдирд▓ рдХреА рд╡рд░реНрддрдорд╛рди рд╕реНрдерд┐рддрд┐ рдХреЛ рд▓реМрдЯрд╛рддрд╛ рд╣реИред  рдХрдиреЗрдХреНрдЯреЗрдб () рдлрд╝рдВрдХреНрд╢рди рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рд╕рд░реНрд╡рд░ рд╕реЗ рдХрдиреЗрдХреНрдЯ рд╣реЛрдиреЗ рдХреЗ рд╕рдВрдХреЗрдд рджреЗрддрд╛ рд╣реИред <br></p><br><p>  рдореЙрдирд┐рдЯрд░рдлреНрд░реАрдЪрд░ рд╡рд░реНрдЧ рд╕рд░реНрд╡рд░ рд╕реЗ рдШрдЯрдирд╛рдУрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИ рдФрд░ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдЪреЗрдХрд╕реАрдХреНрдпреВ () рдлрд╝рдВрдХреНрд╢рди рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ: </p><br><pre> <code class="hljs ruby">bool CheckCQ() { auto service<span class="hljs-number"><span class="hljs-number">_</span></span> = dynamic_cast&lt; SERVICE* &gt;(this); <span class="hljs-regexp"><span class="hljs-regexp">//connection</span></span> state auto old_state = conn<span class="hljs-number"><span class="hljs-number">_</span></span>-&gt;channelState(); auto new_state = conn<span class="hljs-number"><span class="hljs-number">_</span></span>-&gt;checkChannelState(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (old_state != new_state) service-&gt;*channelStateChangedSignal<span class="hljs-number"><span class="hljs-number">_</span></span>(old_state, new_state); <span class="hljs-regexp"><span class="hljs-regexp">//end</span></span> of connection state void* tag; bool ok = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; grpc::CompletionQueue::NextStatus st; st = cq<span class="hljs-number"><span class="hljs-number">_</span></span>.AsyncNext(&amp;tag, &amp;ok, deadlineFromMSec(<span class="hljs-number"><span class="hljs-number">100</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((st == grpc::CompletionQueue::SHUTDOWN) <span class="hljs-params"><span class="hljs-params">||</span></span> (st == grpc::CompletionQueue::TIMEOUT)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; (AbstractCallData&lt; SERVICE &gt;*)(tag)-&gt;cqActions(service<span class="hljs-number"><span class="hljs-number">_</span></span>, ok); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre><br><p>  рдХреЛрдб рд╕рдВрд░рдЪрдирд╛ рд╕рд░реНрд╡рд░ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рд╕рдорд╛рди рд╣реИред  рд╕рд░реНрд╡рд░ рдХреЗ рд╡рд┐рдкрд░реАрдд, рд╡рд░реНрддрдорд╛рди рд╕реНрдерд┐рддрд┐ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рдПрдХ рдХреЛрдб рдмреНрд▓реЙрдХ рдХреНрд▓рд╛рдЗрдВрдЯ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрджрд┐ рд╕рдВрдЪрд╛рд░ рдЪреИрдирд▓ рдХреА рд╕реНрдерд┐рддрд┐ рдмрджрд▓ рдЧрдИ рд╣реИ, рддреЛ рд╕рд┐рдЧреНрдирд▓ рдЪреИрдирд▓рд╕реНрдЯреЗрдЯрдиреЗрдЯреЗрдбрд╕рд┐рдЧреНрдирд▓_ () рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕рднреА рдЙрддреНрдкрдиреНрди рд╕реЗрд╡рд╛рдУрдВ рдореЗрдВ, рдпрд╣ рдПрдХ рд╕рдВрдХреЗрдд рд╣реИ: <br><br></p><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">channelStateChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span></span><span class="hljs-function">)</span></span>;</code> </pre><br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕рд░реНрд╡рд░ рдХреЗ рд╡рд┐рдкрд░реАрдд, AsyncNext () рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ Next () рдХреЗ рдмрдЬрд╛рдп рдпрд╣рд╛рдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдРрд╕рд╛ рдХрдИ рдХрд╛рд░рдгреЛрдВ рд╕реЗ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, AsyncNext () рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп, рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛрдб рдореЗрдВ рд╕рдВрдЪрд╛рд░ рдЪреИрдирд▓ рдХреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрддреА рд╣реИред  рджреВрд╕рд░реЗ, AsyncNext () рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп, рдЧреНрд░рд╛рд╣рдХ рдХреЛрдб рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди RPC рдХреЛ рдХрд┐рд╕реА рднреА рд╕рдордп рдХреЙрд▓ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдиреЗрдХреНрд╕реНрдЯ () рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдереНрд░реЗрдб рдХреЛ рддрдм рддрдХ рдмреНрд▓реЙрдХ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдЬрдм рддрдХ рдХрд┐ рдПрдХ рдШрдЯрдирд╛ рдХрддрд╛рд░ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рди рд╣реЛ рдЬрд╛рдП рдФрд░, рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рджреЛ рд╡рд░реНрдгрд┐рдд рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ рдЦреЛ рджреЗрдЧрд╛ред <br><br><p>  рдХрддрд╛рд░ рд╕реЗ рдШрдЯрдирд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЬреИрд╕рд╛ рдХрд┐ рд╕рд░реНрд╡рд░ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдХреНрд▓рд╛рдЗрдВрдЯрдХреЙрд▓рдбреЗрдЯрд╛ рдХреНрд▓рд╛рд╕ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд cRReaction () рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ: </p><br><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cqActions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RPC::Service* service, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ok)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> response = <span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;RPCCallData*&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* tag = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>*&gt;(response); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;processEvent(tag, ok)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; service-&gt;*func_( response ); }</code> </pre><br><p>  рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде рдХреЗ рд░реВрдк рдореЗрдВ, processEvent () рдлрд╝рдВрдХреНрд╢рди рдЯреИрдЧ рдФрд░ рдУрдХреЗ рдлреНрд▓реИрдЧ рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╣рдореЗрд╢рд╛ рд╕рдЪ рд╣реЛрддрд╛ рд╣реИред  рдЬреИрд╕рд╛ рдХрд┐ рд╕рд░реНрд╡рд░ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдШрдЯрдирд╛ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЙрддреНрдкрдиреНрди рд╕реЗрд╡рд╛ рдХрд╛ рд╕рдВрдХреЗрдд рдХрд╣рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдПрдХ рд╣реА рдирд╛рдо рдХреЗ рд╕рд░реНрд╡рд░ рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рджреЛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЕрдВрддрд░ рд╣реИрдВред  рдкрд╣рд▓рд╛ рдЕрдВрддрд░ рдпрд╣ рд╣реИ рдХрд┐ рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдЙрддреНрддрд░рджрд╛рддрд╛ рдирд╣реАрдВ рдмрдирд╛рдП рдЧрдП рд╣реИрдВред  рдЙрддреНрддрд░рджрд╛рддрд╛рдУрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг, рдЬреИрд╕рд╛ рдХрд┐ рдКрдкрд░ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддрдм рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдЖрд░рдкреАрд╕реА рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  рджреВрд╕рд░рд╛ рдЕрдВрддрд░ рдпрд╣ рд╣реИ рдХрд┐ рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдЙрддреНрддрд░рджрд╛рддрд╛рдУрдВ рдХреЛ рд╣рдЯрд╛рдпрд╛ рдирд╣реАрдВ рдЬрд╛рддрд╛ рд╣реИред  рдЙрддреНрддрд░рджрд╛рддрд╛рдУрдВ рдХреЛ рд╣рдЯрд╛рдиреЗ рдХрд╛ рдЕрднрд╛рд╡ рджреЛ рдХрд╛рд░рдгреЛрдВ рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛрдб рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдкреНрд░рдпреЛрдЬрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрддреНрдкрдиреНрди RPCCallData рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИред  рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛрдб рд╕реЗ рдЫрд┐рдкреЗ рдЗрд╕ рдкреЙрдЗрдВрдЯрд░ рджреНрд╡рд╛рд░рд╛ рд╕рд╛рдордЧреНрд░реА рдХреЛ рд╣рдЯрд╛рдиреЗ рд╕реЗ рдЕрдкреНрд░рд┐рдп рдкрд░рд┐рдгрд╛рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред  рджреВрд╕рд░реЗ, рдкреНрд░рддреНрдпреБрддреНрддрд░ рдХреЛ рд╣рдЯрд╛рдиреЗ рд╕реЗ рддрдереНрдп рдпрд╣ рд╣реЛрдЧрд╛ рдХрд┐ рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рдПрдХ рд╕рдВрдХреЗрдд рдЙрддреНрдкрдиреНрди рдирд╣реАрдВ рд╣реЛрдЧрд╛ред  рдЗрд╕рд▓рд┐рдП, рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛрдб рдХреЛ рдЕрдВрддрд┐рдо рд╕рд░реНрд╡рд░ рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рд╣реЛрдЧрд╛ред  рд╕рдВрдХреЗрддрд┐рдд рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдореЗрдВ рд╕реЗ, рдЧреНрд░рд╛рд╣рдХ рдХреЛрдб рдХреЗ рд▓рд┐рдП рдЙрддреНрддрд░рджрд╛рддрд╛ (рдЙрддреНрдкрдиреНрди рд╕рдВрд░рдЪрдирд╛рдУрдВ) рдХреЛ рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрдгрдп рд▓рд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╕рд┐рдЧреНрдирд▓ рд╣реИрдВрдбрд▓рд░ рдлрд╝рдВрдХреНрд╢рди (рд╕реНрд▓реЙрдЯ) рдореЗрдВ рдирд┐рдореНрди рдХреЛрдб рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП: </p><br><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResponseHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RPCCallData* response)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (response-&gt;CouldBeDeleted()) <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> response; <span class="hljs-comment"><span class="hljs-comment">//process response }</span></span></code> </pre><br><p>  рдЧреНрд░рд╛рд╣рдХ рдХреЛрдб рдореЗрдВ рдЙрддреНрддрд░рджрд╛рддрд╛ рдХреЗ рдирд┐рд╖реНрдХрд╛рд╕рди рдХреА рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐ рди рдХреЗрд╡рд▓ рдПрдХ рд╕реНрдореГрддрд┐ рд░рд┐рд╕рд╛рд╡ рдХреА рдУрд░ рд▓реЗ рдЬрд╛рдПрдЧреА, рдмрд▓реНрдХрд┐ рд╕рдВрдЪрд╛рд░ рдЪреИрдирд▓ рдХреЗ рд╕рд╛рде рд╕рдВрднрд╛рд╡рд┐рдд рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рднреА рд╣рд▓ рдХрд░реЗрдЧреАред  рдирдореВрдирд╛ рдХреЛрдб рдореЗрдВ рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреЗ рдЖрд░рдкреАрд╕реА рдЗрдВрдЯрд░реИрдХреНрд╢рди рдХреЗ рд╕рд┐рдЧреНрдирд▓ рд╣реИрдВрдбрд▓рд░ рд▓рд╛рдЧреВ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред </p><br><h2>  рдирд┐рд╖реНрдХрд░реНрд╖ </h2><br><p>  рдЕрдВрдд рдореЗрдВ, рд╣рдо рджреЛ рдмрд┐рдВрджреБрдУрдВ рдкрд░ рдзреНрдпрд╛рди рдЖрдХрд░реНрд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВред  рдкрд╣рд▓рд╛ рдмрд┐рдВрджреБ рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ рд╕рд░реНрд╡рд░ рдХреЗ рдЪреЗрдХрдХреНрдпреВ () рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИред  рд╡реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рдЬреИрд╕рд╛ рдХрд┐ рдКрдкрд░ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдПрдХ рд╕рд┐рджреНрдзрд╛рдВрдд рдХреЗ рдЕрдиреБрд╕рд╛рд░: рдпрджрд┐ рдХрддрд╛рд░ рдореЗрдВ рдХреЛрдИ рдШрдЯрдирд╛ рд╣реЛрддреА рд╣реИ, рддреЛ рд╕рдВрдмрдВрдзрд┐рдд рдЙрддреНрдкрдиреНрди RPCCallData рд╕рдВрд░рдЪрдирд╛ рдХреЗ рд╕рд╛рде рдПрдХ рд╕рдВрдХреЗрдд "рдЙрддреНрд╕рд░реНрдЬрд┐рдд" рд╣реЛрддрд╛ рд╣реИред  рдЖрдк рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдХрд┐рд╕реА рдИрд╡реЗрдВрдЯ рдХреЗ рд▓рд┐рдП (рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ) рдЪреЗрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рд╢реБрд░реВ рдореЗрдВ рдЬреАрдЖрд░рдкреАрд╕реА рд╕реЗ рдЬреБрдбрд╝реЗ рдкреВрд░реЗ рдиреЗрдЯрд╡рд░реНрдХ рд╣рд┐рд╕реНрд╕реЗ рдХреЛ рджреВрд╕рд░реЗ рдзрд╛рдЧреЗ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХрд╛ рд╡рд┐рдЪрд╛рд░ рдерд╛ред  рдЗрди рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП, gRPC рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП рд╕рд╣рд╛рдпрдХ рд╡рд░реНрдЧ QGrpcSrvMonitor рдФрд░ GRPC рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рд▓рд┐рдП QGrpcCliServer рд▓рд┐рдЦреЗ рдЧрдП рдереЗред  рджреЛрдиреЛрдВ рд╡рд░реНрдЧ рдПрдХ рд╣реА рд╕рд┐рджреНрдзрд╛рдВрдд рдкрд░ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ: рд╡реЗ рдПрдХ рдЕрд▓рдЧ рд╕реНрдЯреНрд░реАрдо рдмрдирд╛рддреЗ рд╣реИрдВ, рдЗрд╕ рд╕реНрдЯреНрд░реАрдо рдореЗрдВ рдЬреЗрдирд░реЗрдЯ рдХреА рдЧрдИ рд╕рд░реНрд╡рд┐рд╕ рдХреЛ рд▓рдЧрд╛рддреЗ рд╣реИрдВ рдФрд░ рд╕рдордп-рд╕рдордп рдкрд░ рдЗрд╕ рд╕рд░реНрд╡рд┐рд╕ рдХреЗ рдЪреЗрдХрд╕реАрдХреНрдпреВ () рдлрдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рджреЛрдиреЛрдВ рд╕рд╣рд╛рдпрдХ рдХрдХреНрд╖рд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп, рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛрдб рдореЗрдВ CheckCQ () рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред  рдЙрддреНрдкрдиреНрди рд╕реЗрд╡рд╛ рдХреЗ рд╕рдВрдХреЗрдд, рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдПрдХ рдЕрдиреНрдп рдзрд╛рд░рд╛ рд╕реЗ "рдЖрддреЗ рд╣реИрдВ"ред  рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ рд╕рд░реНрд╡рд░ рдХреЗ рдЙрджрд╛рд╣рд░рдг рдЗрди рд╕рд╣рд╛рдпрдХ рд╡рд░реНрдЧреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред </p><br><p>  рджреВрд╕рд░рд╛ рдмрд┐рдВрджреБ рдЙрди рдЕрдзрд┐рдХрд╛рдВрд╢ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреА рдЪрд┐рдВрддрд╛ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЕрдкрдиреЗ рдХрд╛рдо рдореЗрдВ рдХреНрдпреВрдЯреА рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред  QgRPC рдореЗрдВ Qt рд╡рд░реНрдЧ рдФрд░ рдореИрдХреНрд░реЛрдЬрд╝ рдХреЗрд╡рд▓ рджреЛ рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ: рдЬрдирд░реЗрдЯ рдХреА рдЧрдИ рд╕реЗрд╡рд╛ рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ, рдФрд░ рд╕рд╣рд╛рдпрдХ рдХрдХреНрд╖рд╛рдУрдВ рд╡рд╛рд▓реА рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ: QGrpcServerMonitor.h рдФрд░ QGrpcClientMonitor.hред  Qt рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд╡рд╛рд▓реА рд╢реЗрд╖ рдлрд╛рдЗрд▓реЗрдВ рдХрд┐рд╕реА рднреА рддрд░рд╣ рд╕реЗ рдЬреБрдбрд╝реА рдирд╣реАрдВ рд╣реИрдВред  рдпрд╣ рд╕реАрдореЗрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рдзрд╛рдирд╕рднрд╛ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдФрд░ рдХреБрдЫ рдХреНрдпреВрдЯреА рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЛ рд╕реНрдЯрдм рдХрд░рдиреЗ рдХреА рдпреЛрдЬрдирд╛ рдмрдирд╛рдИ рдЧрдИ рдереАред  рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, QObject рд╡рд░реНрдЧ рдФрд░ Q_OBJECT рдореИрдХреНрд░реЛред  рд▓реЗрдХрд┐рди рд╣рд╛рдереЛрдВ рдХреЛ рдпрд╣ рдирд╣реАрдВ рдорд┐рд▓рд╛ред  рдЗрд╕рд▓рд┐рдП, рдХрд┐рд╕реА рднреА рд╕реБрдЭрд╛рд╡ рдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИред </p><br><p>  рд╡рд╣ рд╕рдм рд╣реИред  рдЖрдк рд╕рднреА рдХреЛ рдзрдиреНрдпрд╡рд╛рдж! </p><br><h2>  рд╕рдВрджрд░реНрдн </h2><br><ul><li><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">QgRPC рдХреЛрдб рдХреЗ рд╕рд╛рде рднрдВрдбрд╛рд░</a> </p></li><li><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">C ++ рдореЗрдВ рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ gRPC</a> </p></li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi420237/">https://habr.com/ru/post/hi420237/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi420225/index.html">рдкреНрд░рд╛рдЗрдо рдирдВрдмрд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЕрдирдВрдд рдПрд▓реНрдЧреЛрд░рд┐рдердо рдореЗрд▓реЛрдбреА</a></li>
<li><a href="../hi420227/index.html">рддреБрд░реНрдХреА рдХреЗ рд░рд╛рд╖реНрдЯреНрд░рдкрддрд┐ рдиреЗ рдЗрд▓реЗрдХреНрдЯреНрд░реЙрдирд┐рдХреНрд╕ рдХреЗ рдЕрдореЗрд░рд┐рдХреА рдЖрдпрд╛рдд рдкрд░ рдкреНрд░рддрд┐рдмрдВрдз рдХреА рдШреЛрд╖рдгрд╛ рдХреА</a></li>
<li><a href="../hi420229/index.html">рдХреНрдпрд╛ рдЧрд╛рдБрд╡ рдХреЗ рдмрдЪреНрдЪреЗ рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдмрди рд╕рдХрддреЗ рд╣реИрдВ рдпрджрд┐ рдкрд╛рд╕ рдореЗрдВ рд╡реЗ рдХреЗрд╡рд▓ рд░реЗрд▓рд╡реЗ рдХрд░реНрдордЪрд╛рд░рд┐рдпреЛрдВ рдХреЛ рдкрдврд╝рд╛рддреЗ рд╣реИрдВред "рд╕рд░реНрдХрд▓" рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд</a></li>
<li><a href="../hi420233/index.html">UE4 | рдорд▓реНрдЯреАрдкреНрд▓реЗрдпрд░ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг # 5 | рд╕рд░реНрд╡рд░ рдФрд░ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рдмреАрдЪ рд╕реВрдЪрдирд╛ рд╣рд╕реНрддрд╛рдВрддрд░рдг</a></li>
<li><a href="../hi420235/index.html">Zenject: рдХреИрд╕реЗ рдПрдХ IoC рдХрдВрдЯреЗрдирд░ рдЖрдкрдХреА рдкрд░рд┐рдпреЛрдЬрдирд╛ рдкрд░ рдирд┐рд░реНрднрд░рддрд╛ рдЗрдВрдЬреЗрдХреНрд╢рди рдХреЛ рдорд╛рд░ рд╕рдХрддрд╛ рд╣реИ</a></li>
<li><a href="../hi420239/index.html">рдореЛрдмрд╛рдЗрд▓ рдХрд╛ рд╡рд┐рдХрд╛рд╕ред рд╕реНрд╡рд┐рдлреНрдЯ: рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХрд╛ рд░рд╣рд╕реНрдп</a></li>
<li><a href="../hi420243/index.html">рдирд┐рд░реНрдгрд╛рдпрдХ рдкрд░реЛрдкрдХрд╛рд░: рдорд╛рдирд╡реАрдп рдирд┐рд░реНрдгрд╛рдпрдХ рдкрд░рд┐рдпреЛрдЬрдирд╛рдПрдВ</a></li>
<li><a href="../hi420245/index.html">рдЬрд╛рд╡рд╛ рд╕рдВрдЧреНрд░рд╣ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп рдореЗрдореЛрд░реА рдУрд╡рд░рд░рди рдХреЛ рдХреИрд╕реЗ рд░реЛрдХреЗрдВ</a></li>
<li><a href="../hi420251/index.html">Apple рдХрд╛ рджрд╛рд╡рд╛ рд╣реИ рдХрд┐ рдХрдВрдкрдиреА рдХреЗ рдореБрдЦреНрдпрд╛рд▓рдп рдХреА рд▓рд╛рдЧрдд $ 200 рд╣реИ</a></li>
<li><a href="../hi420253/index.html">рдХреИрд╕реЗ рдЦреБрд▓реЗ рдмреИрдВрдХрд┐рдВрдЧ рдПрдкреАрдЖрдИ рд╡рд┐рддреНрддреАрдп рджреБрдирд┐рдпрд╛ рдХреЛ рдмрджрд▓ рд░рд╣реЗ рд╣реИрдВ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>