<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏙️ ⤵️ 🍮 智能“公寓” 📕 🧒🏽 🤠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="大家好！ 最后，公寓的大修已经结束，在这方面，我想与您分享实施的智能公寓项目，该项目具有控制照明，加热地板下供暖，控制室温和湿度以及其他优点的基本功能。 描述性部分将以手册的形式制作（更易于陈述或其他内容）。 



 配套设备 
 考虑到以下事实：我原则上希望将所有自动化组装到执行器和控制设备的现...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>智能“公寓”</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/409179/"> 大家好！ 最后，公寓的大修已经结束，在这方面，我想与您分享实施的智能公寓项目，该项目具有控制照明，加热地板下供暖，控制室温和湿度以及其他优点的基本功能。 描述性部分将以手册的形式制作（更易于陈述或其他内容）。 <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/c22/6aa/1e1/c226aa1e19859982e8a075181dd469e2.png" alt="图片"><br><a name="habracut"></a><br><h3> 配套设备 </h3><br> 考虑到以下事实：我原则上希望将所有自动化组装到执行器和控制设备的现成的，但预算决定中，因此（一个人）做出了一个一致的决定，以使用以下设备清单： <br><br> 管理服务器-Raspberry Pi 3 + OpenHAB 2-1pc（3000 rub。） <br> 多功能控制器-MegaD-2561-1pc（3480擦。） <br> 具有14个继电器输出的执行单元-MegaD-14-R-1个（4480卢布） <br> 温湿度传感器DHT22（AM2303）-4个（1960擦） <br> 温度传感器1-Wire DS18B20防水-2个（180擦） <br> 电源12V DR-60-12-1pc（1420擦。） <br>  Dsen-Box传感器的外壳-4个（1000擦） <br> 用于管理和显示参数的平板电脑-已经存在（3000-10000r。） <br> 大多数列表可以在ALI上购买。 <br><br><h3> 介绍性 </h3><br> 自动化系统运行的基本原理之一是不间断运行和功能冗余。 就是说，即使所有的低电流自动化都被烧死了，我们也不应失去控制照明和其他重要的执行设备的功能。 因此，照明控制解决方案将在所谓的“步行系统”上实施。 房间中的开关将通过漫游，第二个开关的作用将由MegaD-14-R执行单元中的继电器承担。 当然，前提是卷轴本身不会烧坏，如果自动化单元发生故障，我们也不会失去功能。 因此，通过所有2通和2键的Legrand Etika交换机安装在所有房间中（与Valenoy相比，它们看上去不错）。 <br><br><h3> 连接方式 </h3><br>  DHT22温度和湿度传感器安装在Dsen-Box机柜中，距离每个房间的地面约2米。 不要忘记对公寓进行了大修，并且所有电线都从屏蔽层到传感器和设备的位置都经过精心布置。 <br> 电缆几乎被SFTP 4x2x0.5屏蔽了。  DS18B20温度传感器是在安装地暖时安装的。 <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/ff7/53d/d39/ff753dd391699bd917a45e082a7072de.jpg" alt="图片"><br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/38e/822/1c1/38e8221c177f239b8c5db595ac01fe79.jpg" alt="图片"><br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/a3f/66f/295/a3f66f2954549b24e76074101e45e821.jpg" alt="图片"><br><br> 我们将MegaD设备安装在仪表板上，将它们与34pin本地电缆配对，然后连接到以太网。 我们以192.168.0.14/sec的速度进入Web界面。 在“配置”部分中，设置所需的地址或将其保留为默认值，请确保指定Openhab服务器的地址（我们稍后将在树莓派上部署Openhab映像或立即将其写入并在树莓派上进行更改时会发现）。 我们根据同一条线连接开关中的所有传感器和电线。 <br><img src="https://habrastorage.org/getpro/geektimes/post_images/5ab/d1e/d77/5abd1ed77f8c992b17cab9071ba90a25.png" alt="图片"><br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/a9e/64e/488/a9e64e488c0197f9aaf996890cd4d8ae.png" alt="图片"><br><br> 在MegaD设备的端口设置中，设置类型（OUT-如果是继电器，IN或Dsen-如果传感器输入）。 如果您在连接的传感器的端口上指示正确的类型，那么我们将立即看到当前读数。 <br><img src="https://habrastorage.org/getpro/geektimes/post_images/a9c/272/b5f/a9c272b5fba119ca9279ada08c68f2f0.jpg" alt="图片"><br><br><h3> 伺服器 </h3><br> 我们收集服务器。 覆盆子的外壳由有故障的电源制成，可方便地安装在DIN导轨上（当然，有一种特殊情况，但这与我们无关））。 不要忘记自然地插入USB闪存驱动器和以太网电缆。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">为了</a>避免安装<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">麻烦</a> ，我决定下载完整的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">OpenHabian</a>映像-在那里详细描述了安装和配置服务器的整个过程，并归结为将映像部署到USB闪存驱动器，启动树莓派并等待15-45分钟。  （是），在第一个配置中。  OpenHab准备好了！ <br><br> 如果我们不想更改服务器配置中的任何内容（有关如何打开设置的详细信息，请参见openhab.org），请连接到Openhab <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">openhabianpi</a> ：8080，选择Paper UI图形界面，然后开始雕刻所需的一切。 <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/97c/a58/3de/97ca583de20bd40f86e8a67accef97c2.png" alt="图片"><br><br><h3> 客制化 </h3><br><h4> 绑定 </h4><br> 首先，您需要连接OH服务器（openhab）和MegaD。 使用设备定义的协议和规则将服务器上的设备集成到现成的文件中，即所谓的“绑定”。 下载<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MegaD</a>设备的最新绑定。 我们将其拖放到服务器上的/ srv / openhab2-addons文件夹中（可以使用WinSCP），因此我们将在“绑定”纸张UI中看到此绑定。 <br><br> 此外，在“收件箱”中，我们创建了桥接MegaD传入服务器适配器，它就像服务器与设备之间的虚拟通信桥一样。 我们写下所需的端口（服务器地址和端口必须在MegaD设备本身的“ Config”中注册）。 <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/256/2bd/cda/2562bdcdafb8ae0bb36517ba783a7c3b.png" alt="图片"><br><br><h4> 东西 </h4><br> 创建桥之后，我们也在“收件箱”部分中创建“ MegaD绑定物”。 单独的“事物”-这是在服务器上定义特定物理设备（传感器或继电器）的方式，我们将在创建的网桥的帮助下与之交互。 在其中，我们特别规定了MegaD设备的IP地址，访问密码和设备端口（这是连接传感器的输入端口或用于设备控制的输出端口）。 <br> 为了方便按位置分配，在“位置”字段中指示位置-大厅，厨房...创建这些“事物”后，它们将出现在“配置/事物”中。 我们进入创建的“事物”，然后单击所需的类型（我们必须在MegaD设备的端口设置中指定它），将其附加到“项目”，从而创建新的“创建新项目”。 <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/2fe/f37/93a/2fef3793a758fbd82abcd65d15b4dc9e.png" alt="图片"><br><br><h4> 物品 </h4><br> 在服务器上和图形界面中，分别获取“项目”-这是一个元素，用作控制按钮或从传感器和其他功能输出数据。 <br><br>  “名称”字段应为连续的拉丁字母，但“标签”称为我们想要的。 在“项目”设置中，您需要指定类型（如果是继电器，则-SWITCH，如果是传感器，则-NUMBER，依此类推。 <br><br> 如果我们想将某些Item组合成组（这对于在移动应用程序中或使用Basic UI界面方便分发和查看来说是最必要的），则在“ Group”字段中指示所需的组，必须首先在“ Items”部分中创建指定“组”的类型。 完成这些操作后，我们将在Paper UI的“控件”部分中看到非常创建的“项目”，如果一切正确完成，则在单击“开关”类型的创建的“项目”时，将单击连接的设备（MegaD继电器）。 <br><br> 我们对所有开关和传感器执行类似的操作，正确命名它们并进行设置。 <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/aa6/848/fc9/aa6848fc9fd154341a0abb8c4449958b.png" alt="图片"><br><br><h4> 用户界面 </h4><br> 现在，所有这些当然都可以很好地工作，但并不美观且不舒服。 <br><br> 我们拿起平板电脑，通过<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">openhabianpi</a>浏览器：8080，选择Habpanel GUI并开始自定义以满足您的需求。 <br><br> 单击右上角的设置齿轮，单击“高级设置”，然后在设置的左侧进行必要的设置（主题，名称...），稍后在创建完成的界面后，将其保存为“将当前配置保存到新的面板配置” 。 <br><br> 我们从设置返回，使用滑块在界面中选择所需的瓷砖列数，然后单击“添加新的仪表板”。 在磁贴设置中，指定配色方案并显示图标。 使用这些磁贴，我们将确定设备的位置或组（例如，在我的情况下，这些是房间）。 <br><br> 接下来，在创建位置之后，通过单击图块转到该位置，然后在图块名称旁边的顶部单击铅笔，然后将其排列在“项目”系统中创建的图块。 点击右上角的“添加新的小部件”。 选择所需的图块类型（将鼠标悬停在光标上时，将出现提示）“ Switch”（如果是开关），“ Dummy”（如果是传感器...等）。 在创建的图块的设置中，我们将其绑定到现有的“项目”系统并配置显示-图标，颜色，大小...创建所有必要的“项目”图块后，单击左上角的“运行”，从而保存设置并启动显示模式。 这就是我们为自己创建Habpanel界面的方式。 配置完成后，如果是在Chrome中完成的，那么从浏览器设置中将Habpanel页面添加到平板电脑的桌面非常方便。 <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/e16/2fd/91c/e162fd91ccb215acfcc4fb177af1ec58.png" alt="图片"><br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/6c0/056/59b/6c005659be274c302458e186dbdfd1c3.png" alt="图片"><br><br><h4> 规则 </h4><br> 规则（规则）-用于实现单个设备的功能或多个设备之间的交互逻辑的相同规则（脚本）。 <br><br> 我们实现了浴室内抽油烟机的自动控制。 <br><br> 为此，我们必须在系统中创建一个虚拟的“编号”类型的“项目”，在其中记录所需的湿度水平值。 另一个“开关”类型的“项目”触发自动湿度控制。 好吧，实际上是规则本身，它将处理从浴室中的传感器获得的湿度值，并检查我们设置的设定值并控制引擎盖。 <br><br> 要创建规则，我们需要在服务器/ etc / openhab2 / rules的文件夹中创建一个扩展名为.rules的文件，其中包含javascript内容。 这是内容的示例： <br><br><div class="spoiler">  <b class="spoiler_title">Auto_air.rules</b> <div class="spoiler_text"> 规则“ Auto_air” <br> 什么时候 <br> 项目Hum_H_T_sens已收到更新 <br> 然后 <br> 如果 <br>  （Hum_H_T_sens.state&gt; Set_hum.state &amp;&amp; Air_H_T_switch.state == OFF &amp;&amp; Set_auto_air.state == ON）{ <br>  Air_H_T_switch.sendCommand（开启） <br>  } <br> 别的 <br> 如果 <br>  （Hum_H_T_sens.state &lt;Set_hum.state &amp;&amp; Air_H_T_switch.state == ON &amp;&amp; Set_auto_air.state == ON）{ <br>  Air_H_T_switch.sendCommand（关闭） <br>  } <br> 结束 <br></div></div><br> 好吧，实际上，您需要在Habpanel的仪表板屏幕上显示创建的“ Item-s”。 对于湿度级别的“项目”设置，应用“滑块”类型。 <br><br><h4> 图表 </h4><br> 该系统的另一个不错的功能是将数据统计收集到数据库中并以图形显示。 <br><br> 创建图形！ 首先，您需要配置数据库。 <br><br> 默认情况下，OpenHab提供与Rrd4j数据库一起使用的功能，但是我无法正常配置它。 因此，我开始使用MySQL（某种程度上更熟悉）。 <br><br> 要使用数据库，您必须在系统中安装插件。 在Paper UI的“附加组件”选项卡的“持久性”部分中，选择“ MySQL持久性（安装）”。 <br><br> 我们创建的基础现在正在配置。 <br><br> 为此，我们必须在服务器上的文件夹中创建一个文件（如果缺少）：/etc/openhab2/persistence/mysql.persist，在其中必须指定数据收集策略（例如每小时，每天，每周...），并指定“ ”关于将存储哪种策略。 例如，这里是内容： <br><br><div class="spoiler">  <b class="spoiler_title">mysql.persist</b> <div class="spoiler_text">  //持久性策略具有名称和定义，在“项目”部分中进行了引用 <br> 策略{ <br>  //如果未为以下项目指定策略，则将使用默认列表 <br>  everyMinute：“ 0 * * * *？” <br> 每5分钟：“ 0 * / 5 * * *？” <br>  everyHour：“ 0 0 * * *？” <br> 每天：“ 0 0 0 * *？” <br> 默认值= everyChange <br>  } <br><br>  / * <br>  *本节中的每一行均确定应针对哪些商品和策略进行应用。 <br>  *您可以列出单个项目，对所有项目使用“ *”，对于组中的所有成员使用“ groupitem *” <br>  *项目（不包括组项目本身）。 <br>  * / <br><br> 物品{ <br>  //每天保存一次所有元素，并在每次更改时从启动时从数据库中还原它们 <br>  // *：strategy = everyChange，everyDay，restoreOnStartup <br><br>  //此外，每小时还会保存所有温度和天气值 <br>  Weather_Temperature，Temp_H_LR_sens，Temp_H_BR_sens，Temp_H_T_sens，Temp_H_KT_sens，TP_H_H_sens，TP_H_KT_sens，Weather_Humidity，Hum_H_LR_sens，Hum_H_BR_sens，Hum_H_T_sens，Hum_H_KT_sens：战略= everyMinute，restoreOnStartup <br>  } <br></div></div><br> 创建文件后，系统将已经开始收集数据。 我们需要配置Habpanel仪表板以显示图形。 <br><br> 我们返回到Habpanel GUI，转到所需的位置，然后通过选择“图表”类型添加新的小部件。 根据需要调用，在“类型”中选择“ n3-line-chart（交互式）”，在“服务提供者”中-mysql，在“期间”中显示一天（D）。 在“系列”标签中-我们附上所需的“项目”。 瞧！ 我们有一个美丽的时间表！ <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/134/534/ee0/134534ee0ae6072ef65782ccf9dac91d.png" alt="图片"><br><br> 好吧，那么纯正的主动权-我们将平板电脑安装在墙上！  O_o，为此，我拿了两张em-marin格式的磁卡（非常薄的磁卡），并在卡的边缘上粘了两个钕磁铁（Uhu）。 我们将此类带有磁铁的平台附着到平板电脑背面和墙上的双面胶带（厚度很薄）上。 顺便说一下，预先在插座中安装了带有microUSB电缆的MeanWell 5V电源。 平板电脑在墙上！ <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/63b/726/00a/63b72600a8bd3f3299e5cc808f635ec2.jpg" alt="图片"><br><br> 对于材料介绍的特殊性，我深表歉意（我以前从未写过类似的东西）。 如果该帖子至少会受欢迎，那么在下面，我将描述设置移动应用程序的功能。 我希望它派上用场。 所有智能家居））） </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN409179/">https://habr.com/ru/post/zh-CN409179/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN409165/index.html">博弈论，老鼠大惊小怪和轮胎漏气</a></li>
<li><a href="../zh-CN409167/index.html">事实并非如此！ 关于超频“铁”的5个主要误解</a></li>
<li><a href="../zh-CN409169/index.html">如何读妆</a></li>
<li><a href="../zh-CN409171/index.html">如何组装智能猫喂食器</a></li>
<li><a href="../zh-CN409173/index.html">个人使用的AI：帮助进行教育，工作和计划</a></li>
<li><a href="../zh-CN409181/index.html">丰田将与“氢”汽车一起制造电动汽车</a></li>
<li><a href="../zh-CN409183/index.html">Nvidia停止支持所有32位驱动程序</a></li>
<li><a href="../zh-CN409185/index.html">中本聪是世界上50位最富有的人之一</a></li>
<li><a href="../zh-CN409187/index.html">癌症：神话和误解</a></li>
<li><a href="../zh-CN409189/index.html">为什么不能通过音量的大小来比较耳机放大器的功率？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>