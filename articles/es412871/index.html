<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ¥Ô∏è üç± üöå Eclair - Biblioteca de registro declarativo Java Spring üîò üë©üèø‚Äçüéì üßùüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hay muchas preguntas sobre el trabajo de los servicios en las etapas de desarrollo, prueba y soporte, y todas son, a primera vista, diferentes de: "¬øQ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Eclair - Biblioteca de registro declarativo Java Spring</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/412871/"><img src="https://habrastorage.org/webt/c5/hp/zh/c5hpzhb2lfd56lwayott-mqlusi.jpeg"><br><br>  Hay muchas preguntas sobre el trabajo de los servicios en las etapas de desarrollo, prueba y soporte, y todas son, a primera vista, diferentes de: <i>"¬øQu√© pas√≥?"</i>  , <i>"¬øHubo una solicitud?"</i>  , <i>"¬øCu√°l es el formato de fecha?"</i>  , <i>"¬øPor qu√© el servicio no responde?"</i>  etc. <br><br>  Un registro correctamente compilado podr√° responder en detalle estas y muchas otras preguntas de forma absolutamente aut√≥noma sin la participaci√≥n de los desarrolladores.  En la b√∫squeda de un objetivo tan tentador, naci√≥ la biblioteca de registro Eclair, dise√±ada para entablar un di√°logo con todos los participantes en el proceso sin tirar demasiadas mantas. <br><br>  Sobre la manta y las caracter√≠sticas de la soluci√≥n, a continuaci√≥n. <br><a name="habracut"></a><br><h2>  ¬øCu√°l es el problema del registro? </h2><br><blockquote>  Si no est√° muy interesado en comprender las premisas, puede proceder inmediatamente a la descripci√≥n de nuestra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">soluci√≥n</a> . </blockquote><br><ul><li>  El registro de la aplicaci√≥n es su coartada. <br>  Muy a menudo, solo √©l puede demostrar el √©xito de la aplicaci√≥n.  No hay estado en un microservicio; los sistemas adyacentes son m√≥viles y delicados.  ‚ÄúRepetir‚Äù, ‚Äúrecrear‚Äù, ‚Äúverificar dos veces‚Äù: todo esto es dif√≠cil y / o imposible.  El registro debe ser lo suficientemente informativo como para responder la pregunta: <i>"¬øQu√© pas√≥?"</i> En cualquier momento <i>.</i>  .  El registro debe ser claro para todos: el desarrollador, el probador, a veces el analista, a veces el administrador, a veces la primera l√≠nea de soporte, sucede cualquier cosa. </li><li>  Los microservicios se tratan de subprocesos m√∫ltiples. <br>  Las solicitudes que llegan al servicio (o los datos solicitados por el servicio) se procesan con mayor frecuencia por varios subprocesos.  El registro de todos los hilos suele ser mixto.  ¬øDesea distinguir entre hilos paralelos y distinguir entre hilos "secuenciales"?  El mismo flujo se reutiliza para el procesamiento secuencial de solicitudes, ejecutando una y otra vez su propia l√≥gica para diferentes conjuntos de datos.  Estos flujos "secuenciales" desde otro plano, pero sus l√≠mites deben ser claros para el lector. </li><li>  El registro debe guardar el formato de datos original. <br>  Si en realidad los servicios son intercambiados por XML, entonces el registro correspondiente debe almacenar XML.  No siempre es compacto y no siempre es hermoso (pero conveniente).  Es m√°s f√°cil ver el √©xito, m√°s f√°cil analizar el fracaso.  En algunos casos, el registro se puede usar para reproducir o reprocesar manualmente la solicitud. </li><li>  Parte de los datos en el registro requiere una relaci√≥n especial. <br>  Los datos entrantes (solicitudes), los datos salientes (respuestas), las solicitudes a sistemas de terceros y las respuestas de ellos a menudo deben almacenarse por separado.  Est√°n sujetos a requisitos especiales: por vida √∫til o confiabilidad.  Adem√°s, estos datos pueden tener una cantidad impresionante en comparaci√≥n con una l√≠nea de registro t√≠pica. </li><li>  Parte de los datos no es para el registro. <br>  Por lo general, lo siguiente debe excluirse del registro regular: datos binarios (conjuntos de bytes, base64, ..), datos personales de clientes / socios / otras personas y entidades jur√≠dicas.  Siempre es una historia individual, pero sistem√°tica y no se presta al control manual. </li></ul><br><h2>  ¬øPor qu√© no las manos? </h2><br>  Tome <code>org.slf4j.Logger</code> ( <code>org.slf4j.Logger</code> a iniciar sesi√≥n con Appenders de cualquier palo) y escriba todo lo que se requiere en el registro.  Las entradas a los m√©todos principales, salidas, si es necesario, reflejan errores detectados, algunos datos.  ¬øEs esto necesario?  S√≠, pero: <br><br><ul><li>  La cantidad de c√≥digo est√° creciendo de manera irrazonable (inusualmente).  Al principio, esto no es muy sorprendente, si registra solo los m√°s b√°sicos (soporte exitoso, por cierto, con este enfoque). </li><li>  Llamar al registrador con las manos r√°pidamente se convierte en pereza.  Declarar un campo <code>static</code> con un registrador es demasiado vago (bueno, Lombok puede hacer esto por nosotros).  Los desarrolladores somos flojos.  Y escuchamos nuestra pereza, esto es noble pereza: est√° cambiando constantemente el mundo para mejor. </li><li>  Los microservicios no son buenos en todos los lados.  S√≠, son peque√±os y bonitos, pero hay un lado negativo: ¬°hay muchos!  Una sola aplicaci√≥n de principio a fin a menudo es escrita por un desarrollador.  El legado no se cierne ante sus ojos.  Feliz, no cargado de reglas impuestas, el desarrollador considera que es un deber inventar su propio formato de registro, su principio y sus propias reglas.  Entonces, implementa brillantemente la invenci√≥n.  Cada clase es diferente.  ¬øEs esto un problema?  Colosal. </li><li>  Refactorizar romper√° su registro.  Incluso la idea omnipotente no lo salvar√°.  Actualizar el registro es tan imposible como actualizar el Javadoc.  Al mismo tiempo, al menos Javadoc es le√≠do solo por los desarrolladores (no, nadie lee), pero la audiencia de registros es mucho m√°s amplia y el equipo de desarrollo no est√° limitado. </li><li>  MDC (Mapped Diagnostic Context) es una parte integral de una aplicaci√≥n multiproceso.  El llenado manual del MDC requiere una limpieza oportuna al final del trabajo en la secuencia.  De lo contrario, corre el riesgo de vincular un <code>ThreadLocal</code> a datos no relacionados.  Las manos y los ojos para controlar esto, me atrevo a decir, es imposible. </li></ul><br>  Y as√≠ es como resolvemos estos problemas en nuestras aplicaciones. <br><a name="eclair-decision"></a><br><h2>  ¬øQu√© es Eclair y qu√© puede hacer? </h2><br>  Eclair es una herramienta que simplifica la escritura del c√≥digo registrado.  Ayuda a recopilar la metainformaci√≥n necesaria sobre el c√≥digo fuente, asociarla con los datos que vuelan en la aplicaci√≥n en tiempo de ejecuci√≥n y enviarla al repositorio de registro habitual, mientras genera un m√≠nimo de c√≥digo. <br><br>  El objetivo principal es hacer que el registro sea comprensible para todos los participantes en el proceso de desarrollo.  Por lo tanto, la conveniencia de escribir c√≥digo, los beneficios de Eclair no terminan, sino que solo comienzan. <br><br>  Eclair registra m√©todos y par√°metros anotados: <br><br><ul><li>  registra la entrada / salida del m√©todo del m√©todo / excepciones / argumentos / valores devueltos por el m√©todo </li><li>  filtra las excepciones para registrarlas espec√≠ficamente en tipos: <i>solo cuando sea necesario</i> </li><li>  var√≠a el "detalle" del registro, en funci√≥n de la configuraci√≥n de la aplicaci√≥n para la ubicaci√≥n actual: <i>por ejemplo, en el caso m√°s detallado, imprime los valores de los argumentos (todos o algunos), en la versi√≥n m√°s corta, solo el hecho de ingresar el m√©todo</i> </li><li>  imprime datos como JSON / XML / en cualquier otro formato (listo para trabajar con Jackson, JAXB fuera de la caja): <i>comprende qu√© formato es m√°s preferible para un par√°metro en particular</i> </li><li>  entiende el SpEL (Spring Expression Language) para la instalaci√≥n declarativa y la limpieza autom√°tica de MDC </li><li>  escribe en N loggers, el "logger" en la comprensi√≥n de Eclair es un bean en el contexto que implementa la interfaz <code>EclairLogger</code> : puede <i>especificar el registrador que debe procesar la anotaci√≥n por nombre, por alias o por defecto</i> </li><li>  le informa al programador acerca de algunos errores al usar anotaciones: <i>por ejemplo, Eclair sabe que funciona en proxies din√°micos (con todas las funciones que le siguen), por lo tanto, puede sugerir que la anotaci√≥n en el m√©todo <code>private</code> nunca funcionar√°</i> </li><li>  acepta meta anotaciones (como Spring las llama): <i>puede definir sus anotaciones para iniciar sesi√≥n, utilizando algunas anotaciones b√°sicas, para reducir el c√≥digo</i> </li><li>  capaz de enmascarar datos "confidenciales" al imprimir: <i>fuera de la caja XPath-shielding XML</i> </li><li>  escribe un registro en el modo "manual", define el invocador y "expande" los argumentos que implementan el <code>Supplier</code> : <i>dando la oportunidad de inicializar los argumentos "perezosamente"</i> </li></ul><br><h2>  C√≥mo conectar Eclair </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El c√≥digo fuente se publica en GitHub</a> bajo la licencia Apache 2.0. <br><br>  Para conectarse, necesita Java 8, Maven y Spring Boot 1.5+.  Artefacto alojado por el dep√≥sito central de Maven: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>ru.tinkoff<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>eclair-spring-boot-starter<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.8.3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  El iniciador contiene una implementaci√≥n est√°ndar de <code>EclairLogger</code> , que utiliza un sistema de registro inicializado por Spring Boot con alg√∫n conjunto verificado de configuraciones. <br><br><h2>  Ejemplos </h2><br>  Aqu√≠ hay algunos ejemplos del uso t√≠pico de la biblioteca.  Primero, se proporciona un fragmento de c√≥digo, luego el registro correspondiente, dependiendo de la disponibilidad de un cierto nivel de registro.  Se puede encontrar un conjunto m√°s completo de ejemplos en el Wiki del proyecto en la secci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ejemplos</a> . <br><br><h3>  Ejemplo m√°s simple </h3><br>  El nivel predeterminado es DEBUG. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Log</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">simple</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ }</code> </pre><table><tbody><tr><th>  Si el nivel est√° disponible </th><th>  ... entonces el registro ser√° as√≠ </th></tr><tr><td> <code>TRACE <br> DEBUG</code> </td> <td> <code>DEBUG [] rteeExample.simple &gt; <br> DEBUG [] rteeExample.simple &lt;</code> </td> </tr><tr><td> <code>INFO <br> WARN <br> ERROR</code> </td> <td> <code>-</code> </td> </tr></tbody></table><h3>  Los detalles del registro dependen del nivel de registro disponible. </h3><br>  El nivel de registro disponible en la ubicaci√≥n actual afecta los detalles del registro.  Cuanto menor sea el nivel disponible (es decir, cuanto m√°s cerca est√© de TRACE), m√°s detallado ser√° el registro. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Log</span></span>(INFO) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">verbose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String s, Integer i, Double d)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; }</code> </pre><table><tbody><tr><th>  Nivel </th><th>  Registro </th></tr><tr><td> <code>TRACE <br> DEBUG</code> </td> <td> <code>INFO [] rteeExample.verbose &gt; s="s", i=4, d=5.6 <br> INFO [] rteeExample.verbose &lt; false</code> </td> </tr><tr><td> <code>INFO</code> </td> <td> <code>INFO [] rteeExample.verbose &gt; <br> INFO [] rteeExample.verbose &lt;</code> </td> </tr><tr><td> <code>WARN <br> ERROR</code> </td> <td> <code>-</code> </td> </tr></tbody></table><h3>  Ajuste fino del registro de excepciones </h3><br>  Se pueden filtrar los tipos de excepciones registradas.  Las excepciones seleccionadas y sus descendientes se comprometer√°n.  En este ejemplo, <code>NullPointerException</code> se registrar√° en el nivel WARN, <code>Exception</code> en el nivel ERROR (por defecto), y <code>Error</code> no se registrar√° en absoluto (porque el <code>Error</code> no <code>Error</code> incluido en el filtro de la primera anotaci√≥n <code>@Log.error</code> y est√° expl√≠citamente excluido del filtro de la segunda anotaci√≥n). <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Log</span></span>.error(level = WARN, ofType = {NullPointerException.class, IndexOutOfBoundsException.class}) <span class="hljs-meta"><span class="hljs-meta">@Log</span></span>.error(exclude = Error.class) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">filterErrors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Throwable throwable)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Throwable </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> throwable; } <span class="hljs-comment"><span class="hljs-comment">//       filterErrors(new NullPointerException()); filterErrors(new Exception()); filterErrors(new Error());</span></span></code> </pre><table><tbody><tr><th>  Nivel </th><th>  Registro </th></tr><tr><td> <code>TRACE <br> DEBUG <br> INFO <br> WARN</code> </td> <td> <code>WARN  [] rteeExample.filterErrors ! java.lang.NullPointerException <br> java.lang.NullPointerException: null <br> at rteeExampleTest.filterErrors(ExampleTest.java:0) <br> .. <br> ERROR [] rteeExample.filterErrors ! java.lang.Exception <br> java.lang.Exception: null <br> at rteeExampleTest.filterErrors(ExampleTest.java:0) <br> .. <br></code> </td></tr><tr><td> <code>ERROR</code> </td> <td> <code>ERROR [] rteeExample.filterErrors ! java.lang.Exception <br> java.lang.Exception: null <br> at rteeExampleTest.filterErrors(ExampleTest.java:0) <br> ..</code> </td> </tr></tbody></table><h3>  Establecer cada par√°metro por separado </h3><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Log</span></span>.in(INFO) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parameterLevels</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Log(INFO)</span></span></span><span class="hljs-function"> Double d, @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DEBUG)</span></span></span><span class="hljs-function"> String s, @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TRACE)</span></span></span><span class="hljs-function"> Integer i) </span></span>{ }</code> </pre><table><tbody><tr><th>  Nivel </th><th>  Registro </th></tr><tr><td> <code>TRACE</code> </td> <td> <code>INFO [] rteeExample.parameterLevels &gt; d=9.4, s="v", i=7</code> </td> </tr><tr><td> <code>DEBUG</code> </td> <td> <code>INFO [] rteeExample.parameterLevels &gt; d=9.4, s="v"</code> </td> </tr><tr><td> <code>INFO</code> </td> <td> <code>INFO [] rteeExample.parameterLevels &gt; 9.4</code> </td> </tr><tr><td> <code>WARN <br> ERROR</code> </td> <td> <code>-</code> </td> </tr></tbody></table><h3>  Seleccionar y personalizar el formato de impresi√≥n </h3><br>  Las "impresoras" responsables del formato de impresi√≥n pueden configurarse mediante preprocesadores y postprocesadores.  En el ejemplo anterior, <code>maskJaxb2Printer</code> configurado para que los elementos que coinciden con la expresi√≥n XPath <code>"//s"</code> se enmascaren con <code>"********"</code> .  Al mismo tiempo, <code>jacksonPrinter</code> imprime <code>Dto</code> "tal cual". <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Log</span></span>.out(printer = <span class="hljs-string"><span class="hljs-string">"maskJaxb2Printer"</span></span>) <span class="hljs-function"><span class="hljs-function">Dto </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Log(printer = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"maskJaxb2Printer"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> Dto xml, @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(printer = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"jacksonPrinter"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> Dto json, Integer i) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> xml; }</code> </pre><table><tbody><tr><th>  Nivel </th><th>  Registro </th></tr><tr><td> <code>TRACE <br> DEBUG</code> </td> <td> <code>DEBUG [] rteeExample.printers &gt; <br> xml=&lt;dto&gt;&lt;i&gt;5&lt;/i&gt;&lt;s&gt;********&lt;/s&gt;&lt;/dto&gt;, json={"i":5,"s":"password"} <br> DEBUG [] rteeExample.printers &lt; <br> &lt;dto&gt;&lt;i&gt;5&lt;/i&gt;&lt;s&gt;********&lt;/s&gt;&lt;/dto&gt;</code> </td> </tr><tr><td> <code>INFO <br> WARN <br> ERROR</code> </td> <td> <code>-</code> </td> </tr></tbody></table><h3>  M√∫ltiples registradores en contexto </h3><br>  El m√©todo se registra utilizando varios registradores al mismo tiempo: registrador predeterminado (anotado con <code>@Primary</code> ) y <code>auditLogger</code> auditLogger.  Puede definir varios registradores si desea separar los eventos registrados no solo por nivel (TRACE - ERROR), sino tambi√©n enviarlos a diferentes almacenes.  Por ejemplo, el registrador principal puede escribir un registro en un archivo en el disco usando slf4j, y <code>auditLogger</code> puede escribir un segmento de datos especial en un excelente almacenamiento (por ejemplo, en Kafka) en su propio formato espec√≠fico. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Log</span></span> <span class="hljs-meta"><span class="hljs-meta">@Log</span></span>(logger = <span class="hljs-string"><span class="hljs-string">"auditLogger"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">twoLoggers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ }</code> </pre><br><h3>  MDC Management </h3><br>  Los MDC configurados con anotaciones se eliminan autom√°ticamente despu√©s de salir del m√©todo anotado.  Un valor de registro MDC se puede calcular din√°micamente usando SpEL.  Los siguientes son ejemplos: una cadena est√°tica percibida por una constante, evaluando la expresi√≥n <code>1 + 1</code> , llamando al <code>jacksonPrinter</code> , llamando al m√©todo <code>static</code> <code>randomUUID</code> . <br>  Los MDC con el atributo <code>global = true</code> no se eliminan despu√©s de salir del m√©todo: como puede ver, el √∫nico registro que queda en el MDC hasta el final del registro es la <code>sum</code> . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Log</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">outer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ self.mdc(); } <span class="hljs-meta"><span class="hljs-meta">@Mdc</span></span>(key = <span class="hljs-string"><span class="hljs-string">"static"</span></span>, value = <span class="hljs-string"><span class="hljs-string">"string"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Mdc</span></span>(key = <span class="hljs-string"><span class="hljs-string">"sum"</span></span>, value = <span class="hljs-string"><span class="hljs-string">"1 + 1"</span></span>, global = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Mdc</span></span>(key = <span class="hljs-string"><span class="hljs-string">"beanReference"</span></span>, value = <span class="hljs-string"><span class="hljs-string">"@jacksonPrinter.print(new ru.tinkoff.eclair.example.Dto())"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Mdc</span></span>(key = <span class="hljs-string"><span class="hljs-string">"staticMethod"</span></span>, value = <span class="hljs-string"><span class="hljs-string">"T(java.util.UUID).randomUUID()"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Log</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mdc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ self.inner(); } <span class="hljs-meta"><span class="hljs-meta">@Log</span></span>.<span class="hljs-function"><span class="hljs-function">in </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ }</code> </pre><br>  Inicie sesi√≥n al ejecutar el c√≥digo anterior: <br> <code>DEBUG [] rteeExample.outer &gt; <br> DEBUG [beanReference={"i":0,"s":null}, sum=2, static=string, staticMethod=01234567-89ab-cdef-ghij-klmnopqrstuv] rteeExample.mdc &gt; <br> DEBUG [beanReference={"i":0,"s":null}, sum=2, static=string, staticMethod=01234567-89ab-cdef-ghij-klmnopqrstuv] rteeExample.inner &gt; <br> DEBUG [beanReference={"i":0,"s":null}, sum=2, static=string, staticMethod=01234567-89ab-cdef-ghij-klmnopqrstuv] rteeExample.mdc &lt; <br> DEBUG [sum=2] rteeExample.outer &lt;</code> <br> <br><h3>  Instalaci√≥n de MDC basada en par√°metros </h3><br>  Si especifica el MDC utilizando la anotaci√≥n en el par√°metro, el par√°metro anotado est√° disponible como el objeto ra√≠z del contexto de evaluaci√≥n.  Aqu√≠ <code>"s"</code> es un campo de clase <code>Dto</code> con tipo <code>String</code> . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Log</span></span>.<span class="hljs-function"><span class="hljs-function">in </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mdcByArgument</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Mdc(key = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"dto"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, value = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"#this"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Mdc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"length"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, value = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"s.length()"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> Dto dto) </span></span>{ }</code> </pre><br>  Inicie sesi√≥n al ejecutar el c√≥digo anterior: <br> <code>DEBUG [length=8, dto=Dto{i=12, s='password'}] rteeExample.mdcByArgument &gt; dto=Dto{i=12, s='password'}</code> <br> <br><h3>  Registro manual </h3><br>  Para el registro "manual", es suficiente implementar la implementaci√≥n de <code>ManualLogger</code> .  Los argumentos aprobados que implementan el <code>Supplier</code> interfaz se "expandir√°n" solo si es necesario. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ManualLogger logger; <span class="hljs-meta"><span class="hljs-meta">@Log</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">manual</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ logger.info(<span class="hljs-string"><span class="hljs-string">"Eager logging: {}"</span></span>, Math.PI); logger.debug(<span class="hljs-string"><span class="hljs-string">"Lazy logging: {}"</span></span>, (Supplier) () -&gt; Math.PI); }</code> </pre><table><tbody><tr><th>  Nivel </th><th>  Registro </th></tr><tr><td> <code>TRACE <br> DEBUG</code> </td> <td> <code>DEBUG [] rteeExample.manual &gt; <br> INFO  [] rteeExample.manual - Eager logging: 3.141592653589793 <br> DEBUG [] rteeExample.manual - Lazy logging: 3.141592653589793 <br> DEBUG [] rteeExample.manual &lt;</code> </td> </tr><tr><td> <code>INFO</code> </td> <td> <code>INFO [] rteeExample.manual - Eager logging: 3.141592653589793</code> </td> </tr><tr><td> <code>WARN <br> ERROR</code> </td> <td> <code>-</code> </td> </tr></tbody></table><h2>  ¬øQu√© no hace Eclair? </h2><br>  Eclair no sabe d√≥nde almacenar√° sus registros, por cu√°nto tiempo y en detalle.  Eclair no sabe c√≥mo planea usar su registro.  Eclair extrae cuidadosamente de su aplicaci√≥n toda la informaci√≥n que necesita y la redirige al almacenamiento que configur√≥. <br><br>  Un ejemplo de configuraci√≥n de <code>EclairLogger</code> dirige un registro a un registrador Logback con un Appender espec√≠fico: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> EclairLogger </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eclairLogger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ LoggerFacadeFactory factory = loggerName -&gt; { ch.qos.logback.classic.LoggerContext context = (LoggerContext) LoggerFactory.getILoggerFactory(); ch.qos.logback.classic.Logger logger = context.getLogger(loggerName); <span class="hljs-comment"><span class="hljs-comment">// Appender&lt;ILoggingEvent&gt; appender = ? // logger.addAppender(appender); return new Slf4JLoggerFacade(logger); }; return new SimpleLogger(factory, LoggingSystem.get(SimpleLogger.class.getClassLoader())); }</span></span></code> </pre><br><h2>  Esta soluci√≥n no es para todos. </h2><br>  Antes de comenzar a usar Eclair como la herramienta principal para iniciar sesi√≥n, debe familiarizarse con una serie de caracter√≠sticas de esta soluci√≥n.  Estas "caracter√≠sticas" se deben al hecho de que Eclair se basa en el mecanismo proxy est√°ndar para Spring. <br><br>  - La velocidad de ejecuci√≥n del c√≥digo envuelto en el pr√≥ximo proxy es insignificante, pero caer√°.  Para nosotros, estas p√©rdidas rara vez son significativas.  Si surge la pregunta de reducir el tiempo de entrega, existen muchas medidas de optimizaci√≥n efectivas.  Rechazar un registro informativo conveniente puede considerarse como una de las medidas, pero no en primer lugar. <br><br>  - StackTrace "hincha" un poco m√°s.  Si no est√°s acostumbrado a la larga pila de Trax de Spring, esto puede ser una molestia para ti.  Por una raz√≥n igualmente obvia, la depuraci√≥n de las clases proxy ser√° dif√≠cil. <br><br>  - <b>No todas las clases y todos los m√©todos pueden ser representados</b> : <code>private</code> m√©todos <code>private</code> no pueden ser representados, necesitar√° registrar la cadena de m√©todos en un bean, no puede representar cualquier cosa que no sea un bean, etc. <br><br><h2>  Al final </h2><br>  Est√° completamente claro que esta herramienta, como cualquier otra, debe poder utilizarse para beneficiarse de ella.  Y este material solo ilumina superficialmente el lado en el que decidimos movernos en busca de la soluci√≥n perfecta. <br><br>  Cr√≠ticas, pensamientos, sugerencias, enlaces: ¬°acojo con benepl√°cito su participaci√≥n en la vida del proyecto!  Me encantar√≠a que Eclair sea √∫til para sus proyectos. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es412871/">https://habr.com/ru/post/es412871/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es412861/index.html">Crear un mapa de ruta de usuario para dummies</a></li>
<li><a href="../es412863/index.html">Dialogflower - Google Dialogflow para Yandex Alice</a></li>
<li><a href="../es412865/index.html">C√≥mo disparar una c√°mara Motion Eye en el Sony Xperia XZ2</a></li>
<li><a href="../es412867/index.html">C√≥mo compilar un archivo COM de DOS con el compilador GCC</a></li>
<li><a href="../es412869/index.html">Entrevista con un experto en ingenier√≠a de tejidos y medicina regenerativa, el profesor Tal Tal Dvir</a></li>
<li><a href="../es412873/index.html">Discos duros estropeados por el sonido de los altavoces comunes</a></li>
<li><a href="../es412877/index.html">Rutenio (Ru): el cuarto elemento con propiedades ferromagn√©ticas a temperatura ambiente</a></li>
<li><a href="../es412879/index.html">Problema n. ¬∞ 24: capacitaci√≥n en TI: problemas y desaf√≠os actuales de compa√±√≠as l√≠deres</a></li>
<li><a href="../es412881/index.html">Bj√∂rn Straustrup: problema con la programaci√≥n</a></li>
<li><a href="../es412885/index.html">Ciencia patol√≥gica</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>