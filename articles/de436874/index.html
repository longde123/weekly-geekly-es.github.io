<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•à ü•î ü•• Neujahrst√§nze rund um den FC-Adapter oder eine Geschichte dar√ºber, wie weit die Ursachen des Problems von den Symptomen entfernt sind üë©üèø üë®üèΩ‚Äçüè≠ ‚ö™Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Am 4. Januar, um 7:15 Uhr, l√∂sche ich meine Augen aus dem Schlaf und finde ein B√ºndel einer Nachricht in der Telegrammgruppe vom Zabbix-Server, dass d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Neujahrst√§nze rund um den FC-Adapter oder eine Geschichte dar√ºber, wie weit die Ursachen des Problems von den Symptomen entfernt sind</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436874/"><p>  Am 4. Januar, um 7:15 Uhr, l√∂sche ich meine Augen aus dem Schlaf und finde ein B√ºndel einer Nachricht in der Telegrammgruppe vom Zabbix-Server, dass die CPU-Auslastung auf einem der Virtualisierungsserver gestiegen ist: </p><br><p><img src="https://habrastorage.org/webt/mb/6o/wz/mb6owzivk1hb0e_mfwe5_ycsobk.png"><a name="habracut"></a><cut></cut><br>  Nachdem ich mir die Geschichte in Zabbix angesehen habe, klettere ich auf den Server und schaue in dmesg, wo ich Folgendes finde: </p><br><pre><code class="plaintext hljs">[  3 20:05:18 2019] qla2xxx [0000:21:00.1]-015b:10: Disabling adapter. [  3 20:05:28 2019] sd 10:0:0:1: rejecting I/O to offline device [  3 20:05:28 2019] sd 10:0:0:1: rejecting I/O to offline device [  3 20:05:28 2019] sd 10:0:0:1: rejecting I/O to offline device [  3 20:05:28 2019] sd 10:0:0:1: rejecting I/O to offline device [  3 20:05:28 2019] sd 10:0:0:1: rejecting I/O to offline device</code> </pre> <br><p>  Ich klettere in den Speicher, in dem sich der QLogic FC-Adapter befindet. Ich sehe, dass am 1. Januar um 19:54 Uhr eines der Laufwerke im Speicher au√üer Betrieb genommen wurde, das Ersatzlaufwerk abgeholt wurde und das Resilvering am 2. Januar um 9:11 Uhr endete: </p><br><p><img src="https://habrastorage.org/webt/ub/9-/jg/ub9-jgtho_qzgy6payivxhvmwqs.png"></p><br><p>  Ich dachte: Vielleicht kam etwas aus dem Repository oder dem FC-Switch, was dazu f√ºhrte, dass der Treiber √ºber den QLogic-Adapter w√ºtend wurde. </p><br><p>  Erstellte eine Aufgabe im Tracker, startete den Server neu, alles funktionierte auf den ersten Blick wieder wie es sollte. </p><br><p>  In diesem Zusammenhang verschob er weitere Ma√ünahmen bis zum Ende der Neujahrsferien. </p><br><p>  Mit Beginn der Arbeitswoche am 9. Januar begann er, die Ursache des Versagens zu kl√§ren. </p><br><p>  Seit der Nachricht: </p><br><pre> <code class="plaintext hljs">[  3 20:05:18 2019] qla2xxx [0000:21:00.1]-015b:10: Disabling adapter.</code> </pre> <br><p>  nicht zu informativ, stieg in die Treiberquelle. </p><br><p>  Dem Treibercode nach zu urteilen, wird eine Nachricht ausgegeben, wenn der Treiber aufgrund eines Fehlers auf der PCI entladen wird (linux / drivers / scsi / qla2xxx / qla_os.c (Kernel v4.15)): </p><br><pre> <code class="plaintext hljs">qla2x00_disable_board_on_pci_error(struct work_struct *work) { struct qla_hw_data *ha = container_of(work, struct qla_hw_data, board_disable); struct pci_dev *pdev = ha-&gt;pdev; scsi_qla_host_t *base_vha = pci_get_drvdata(ha-&gt;pdev); /* * if UNLOAD flag is already set, then continue unload, * where it was set first. */ if (test_bit(UNLOADING, &amp;base_vha-&gt;dpc_flags)) return; ql_log(ql_log_warn, base_vha, 0x015b, "Disabling adapter.\n");</code> </pre> <br><p>  Ich fing an weiter zu graben, stieg in BMC ein und schaute in das Ereignisprotokoll: </p><br><p><img src="https://habrastorage.org/webt/kd/w_/rm/kdw_rm1wokwi6sblbx-jdvfxj9u.png"></p><br><p>  Es stellt sich heraus, dass sich einer der beiden CPU-Knoten in der Plattform erw√§rmt und drosselt, und die Zeit der Meldung zum Entladen des Treibers des FC-Adapters korreliert mit der Startzeit der Drosselung. </p><br><p>  Hier ist anzumerken, dass die Serverplattform, die wir hier haben, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://www.supermicro.com/Aplus/system/2U/2123/AS-2123BT-HNC0R.cfm</a> mit zwei EPYC 7601 f√ºr jeden Knoten ist: </p><br><p><img src="https://habrastorage.org/webt/4g/qj/_m/4gqj_mauh8b6ogspym5sau493oi.jpeg"></p><br><p>  Ich habe es in das Rechenzentrum verschoben, den Knoten vom Server entfernt, die W√§rmeleitpaste ge√§ndert, sie zur√ºckgeklebt, aber sie heizt sich immer noch auf. </p><br><p>  Wir haben festgestellt, dass der Luftstrom in einem Teil des Servers nicht so stark ist wie im anderen.  Nachdem alle Knoten leicht mit Stress belastet wurden, wurde deutlich, dass die Knotenprozessoren auf der rechten Seite der Plattform nicht richtig durchbrennen und die Temperatur der zweiten CPU in zwei Knoten sehr schnell kritisch wird. </p><br><p>  Nach dem Versuch, die Blasparameter in BMC zu √§ndern, stellte sich heraus, dass sie keine Auswirkung hatten: </p><br><p><img src="https://habrastorage.org/webt/q5/e-/ng/q5e-ngkv2nevpw9bz2aod-rbgum.png"></p><br><p>  Ein Neustart von BMC hatte ebenfalls keine Auswirkungen. </p><br><p>  Nachdem ich mir die Sensorwerte angesehen hatte, sah ich, dass auf einem von 53 Sensoren nur 4 erkannt wurden und auf dem anderen nur 6: </p><br><p><img src="https://habrastorage.org/webt/dn/47/d3/dn47d3mxpac_i_gktmyjql3rn7u.png"></p><br><p>  Und dann erinnerte ich mich, dass ich beim Flashen einer neuen BIOS-Version und eines neuen BMC in Knoten vor ein oder zwei Monaten auf zwei Knoten die BMC-Konfiguration nicht auf die werkseitigen Parameter zur√ºckgesetzt habe (um einen bestimmten Fall der Optimierung zu √ºberpr√ºfen). </p><br><p>  Nach dem Zur√ºcksetzen des BMC auf die werkseitigen Parameter wurden alle 53 Sensoren erneut erkannt, die Steuerung der L√ºftergeschwindigkeit funktionierte erneut und die Prozessoren h√∂rten auf zu erw√§rmen. </p><br><p>  Die Tatsache, dass die Ursache f√ºr das Entladen des QLogic-Treibers die √úberhitzung des Prozessors ist, ist nicht genau, aber ich habe keine anderen engen Korrelationen gefunden. </p><br><p>  Schlussfolgerungen: </p><br><ol><li>  Auch nach der BMC-Firmware lohnt es sich, die Werkseinstellungen zur√ºckzusetzen, auch wenn auf den ersten Blick alles einwandfrei funktioniert. </li><li>  Nat√ºrlich m√ºssen die Temperatur- und Kernelfehlermeldungen √ºberwacht werden, und dies ist in den Pl√§nen nat√ºrlich, aber nicht auf einmal. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de436874/">https://habr.com/ru/post/de436874/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de436862/index.html">AMD Ryzen Matisse der 3. Generation: Octa-Core Zen 2 mit PCIe 4.0 f√ºr Desktop</a></li>
<li><a href="../de436864/index.html">So testen Sie Ihre eigene Betriebssystemverteilung</a></li>
<li><a href="../de436866/index.html">Wie man gef√§lschte agile Projekte erkennt</a></li>
<li><a href="../de436868/index.html">Betten Sie statische Analysen in den Prozess ein und suchen Sie nicht nach Fehlern</a></li>
<li><a href="../de436872/index.html">PGConf.Russia 2019 kommt bald</a></li>
<li><a href="../de436876/index.html">[SAP] SAPUI5 f√ºr Dummies Teil 1: Eine vollst√§ndige Schritt-f√ºr-Schritt-√úbung</a></li>
<li><a href="../de436878/index.html">BERT ist ein hochmodernes Sprachmodell f√ºr 104 Sprachen. Tutorial zum lokalen Starten von BERT und in Google Colab</a></li>
<li><a href="../de436880/index.html">Grundlagen der C ++ - Vorlage: Funktionsvorlagen</a></li>
<li><a href="../de436884/index.html">Wir beherrschen Async / Warten auf ein echtes Beispiel</a></li>
<li><a href="../de436886/index.html">Verwenden von Babel und Webpack zum Einrichten eines React-Projekts von Grund auf neu</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>