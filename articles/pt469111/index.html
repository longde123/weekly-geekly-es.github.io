<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôÜ üöã üßñüèæ Substitua Object por var: o que poderia dar errado? üë©üèº‚ÄçüöÄ üì∂ üåü</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recentemente, deparei-me com uma situa√ß√£o em que a substitui√ß√£o de Object por var em um programa Java 10 gera uma exce√ß√£o em tempo de execu√ß√£o. Fiquei...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Substitua Object por var: o que poderia dar errado?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469111/"><p> Recentemente, deparei-me com uma situa√ß√£o em que a substitui√ß√£o de Object por var em um programa Java 10 gera uma exce√ß√£o em tempo de execu√ß√£o.  Fiquei interessado em quantas maneiras diferentes de obter esse efeito e resolvi esse problema para a comunidade: </p><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1174191219620089856"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br><p>  Acabou que voc√™ pode conseguir o efeito de maneiras diferentes.  Embora todos sejam um pouco complicados, √© interessante recordar as v√°rias sutilezas do idioma com o exemplo de uma tarefa desse tipo.  Vamos ver quais m√©todos foram encontrados. </p><a name="habracut"></a><br><h2 id="uchastniki">  Deputados </h2><br><p>  Entre os entrevistados, havia muitas pessoas famosas e n√£o muito.  Este √© Sergey <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">bsideup</a> Egorov, funcion√°rio da Pivotal, palestrante, um dos criadores dos cont√™ineres de teste.  Este √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Victor Polishchuk</a> , famoso por relatos sobre o maldito empreendimento.  Tamb√©m observou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Nikita Artyushov,</a> do Google;  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Dmitry Mikhailov</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Maccimo</a> .  Mas fiquei especialmente satisfeito com a chegada de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Wouter Coekaerts</a> .  Ele √© conhecido por seu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo no ano passado</a> , onde percorreu o sistema de tipos Java e contou como ele estava irremediavelmente quebrado.  Parte deste artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">jbaruch</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">eu</a> at√© usamos no quarto lan√ßamento do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Java Puzzlers</a> . </p><br><h2 id="zadacha-i-resheniya">  Tarefa e solu√ß√µes </h2><br><p> Portanto, a ess√™ncia da nossa tarefa √© esta: existe um programa Java no qual h√° uma declara√ß√£o de uma vari√°vel no formato <code>Object x = ...</code> (padr√£o honesto <code>java.lang.Object</code> , sem substitui√ß√µes de tipo).  O programa compila, executa e imprime algo como "Ok".  Substitu√≠mos <code>Object</code> por <code>var</code> , exigindo infer√™ncia autom√°tica de tipo, ap√≥s o qual o programa continua a compilar, mas trava no lan√ßamento com uma exce√ß√£o. </p><br><p>  As solu√ß√µes podem ser divididas em dois grupos.  No primeiro, depois de substituir por var, a vari√°vel se torna primitiva (ou seja, era originalmente a caixa autom√°tica).  O segundo tipo permanece objeto, mas mais espec√≠fico que <code>Object</code> .  Aqui voc√™ pode destacar um subgrupo interessante que usa gen√©ricos. </p><br><h3 id="boksing">  Boxe </h3><br><p>  Como distinguir um objeto de um primitivo?  Existem muitas maneiras diferentes.  O mais f√°cil √© verificar a identidade.  Esta solu√ß√£o foi proposta por Nikita: </p><br><pre> <code class="java hljs">Object x = <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x == <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Integer(<span class="hljs-number"><span class="hljs-number">1000</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Error(); System.out.println(<span class="hljs-string"><span class="hljs-string">"Ok"</span></span>);</code> </pre> <br><p>  Quando <code>x</code> √© um objeto, certamente n√£o pode ser igual por refer√™ncia ao novo objeto <code>new Integer(1000)</code> .  E se for um primitivo, de acordo com as regras da linguagem, o <code>new Integer(1000)</code> se desdobra imediatamente tamb√©m em um primitivo, e os n√∫meros s√£o comparados como primitivos. </p><br><p>  Outra maneira s√£o os m√©todos sobrecarregados.  Voc√™ pode escrever o seu pr√≥prio, mas Sergey criou uma op√ß√£o mais elegante: use a biblioteca padr√£o.  O m√©todo <code>List.remove</code> √© <code>List.remove</code> , sobrecarregado e pode remover <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um elemento por √≠ndice</a> se uma primitiva for passada ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um elemento por valor</a> se um objeto for passado.  Isso levou repetidamente a erros em programas reais se voc√™ usar a <code>List&lt;Integer&gt;</code> .  Para nossa tarefa, a solu√ß√£o pode ser assim: </p><br><pre> <code class="java hljs">Object x = <span class="hljs-number"><span class="hljs-number">1000</span></span>; List&lt;?&gt; list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); list.remove(x); System.out.println(<span class="hljs-string"><span class="hljs-string">"Ok"</span></span>);</code> </pre> <br><p>  Agora estamos tentando remover o elemento inexistente 1000 da lista vazia, esta √© apenas uma a√ß√£o in√∫til.  Mas se substituirmos <code>Object</code> por <code>var</code> , chamaremos outro m√©todo que remove o elemento com o √≠ndice 1000. E isso j√° leva a <code>IndexOutOfBoundsException</code> . </p><br><p>  O terceiro m√©todo √© o operador de convers√£o de tipos.  Podemos converter com √™xito outra primitiva em um tipo primitivo, mas um objeto √© convertido apenas se houver um inv√≥lucro sobre o mesmo tipo para o qual iremos converter (o anboxing acontecer√°).  Na verdade, precisamos do efeito oposto: uma exce√ß√£o √© no caso de um primitivo, e n√£o no de um objeto, mas usar try-catch √© f√°cil de conseguir, que Viktor usou: </p><br><pre> <code class="java hljs">Object x = <span class="hljs-number"><span class="hljs-number">40</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Error(<span class="hljs-string"><span class="hljs-string">"Oops :"</span></span> + (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>)x); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ClassCastException e) { System.out.println(<span class="hljs-string"><span class="hljs-string">"Ok"</span></span>); }</code> </pre> <br><p>  Aqui, <code>ClassCastException</code> √© o comportamento esperado, o programa sai normalmente.  Mas depois de usar <code>var</code> essa exce√ß√£o desaparece e lan√ßamos outra coisa.  Gostaria de saber se isso √© inspirado no c√≥digo real da empresa sangrenta? </p><br><p>  Outra op√ß√£o de convers√£o de tipo foi proposta por Wouter.  Voc√™ pode usar a estranha l√≥gica do operador <code>?:</code> .  √â verdade que o c√≥digo fornece apenas resultados diferentes, ent√£o voc√™ precisa modific√°-lo de alguma forma para que haja uma exce√ß√£o.  Ent√£o, parece-me, com bastante eleg√¢ncia: </p><br><pre> <code class="java hljs">Object x = <span class="hljs-number"><span class="hljs-number">1.0</span></span>; System.out.println(String.valueOf(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span> ? x : <span class="hljs-number"><span class="hljs-number">100000000000L</span></span>).substring(<span class="hljs-number"><span class="hljs-number">12</span></span>) + <span class="hljs-string"><span class="hljs-string">"Ok"</span></span>);</code> </pre> <br><p>  A diferen√ßa entre esse m√©todo √© que n√£o usamos o valor de <code>x</code> diretamente, mas o tipo <code>x</code> afeta o tipo da express√£o <code>false ? x : 100000000000L</code>  <code>false ? x : 100000000000L</code> .  Se <code>x</code> √© um <code>Object</code> , o tipo de express√£o inteira √© <code>Object</code> e, em seguida, temos apenas o boxe, <code>String.valueOf()</code> sequ√™ncia de <code>100000000000</code> , para a qual a <code>substring(12)</code> √© uma sequ√™ncia vazia.  Se voc√™ usar <code>var</code> , o tipo <code>x</code> se tornar√° <code>double</code> e, portanto, o tipo <code>false ? x : 100000000000L</code>  <code>false ? x : 100000000000L</code> tamb√©m <code>false ? x : 100000000000L</code> <code>double</code> , ou seja, <code>100000000000L</code> se transformar√° em <code>1.0E11</code> , com menos de 12 caracteres, portanto, chamar <code>substring</code> leva a uma <code>StringIndexOutOfBoundsException</code> . </p><br><p>  Finalmente, aproveitamos o fato de que uma vari√°vel pode realmente ser alterada ap√≥s a cria√ß√£o.  E na vari√°vel de objeto, diferente da primitiva, voc√™ pode colocar <code>null</code> .  Colocar <code>null</code> em uma vari√°vel √© f√°cil; existem v√°rias maneiras.  Mas aqui, Wouter tamb√©m adotou uma abordagem criativa usando o rid√≠culo m√©todo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>Integer.getInteger</code></a> : </p><br><pre> <code class="java hljs">Object x = <span class="hljs-number"><span class="hljs-number">1</span></span>; x = Integer.getInteger(<span class="hljs-string"><span class="hljs-string">"moo"</span></span>); System.out.println(<span class="hljs-string"><span class="hljs-string">"Ok"</span></span>);</code> </pre> <br><p>  Nem todo mundo sabe que esse m√©todo l√™ uma propriedade do sistema chamada <code>moo</code> e, se houver, tenta convert√™-la em um n√∫mero, caso contr√°rio, ele retorna <code>null</code> .  Se n√£o houver propriedade, atribu√≠mos <code>null</code> silenciosamente ao objeto, mas ca√≠mos de <code>NullPointerException</code> ao tentar atribu√≠-lo a um primitivo (ocorre o anboxing autom√°tico).  Poderia ter sido mais f√°cil, √© claro.  Vers√£o aproximada <code>x = null;</code>  ele n√£o rastreia - n√£o √© compilado, mas o compilador o engolir√° agora: </p><br><pre> <code class="java hljs">Object x = <span class="hljs-number"><span class="hljs-number">1</span></span>; x = (Integer)<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; System.out.println(<span class="hljs-string"><span class="hljs-string">"Ok"</span></span>);</code> </pre> <br><h3 id="obektnyy-tip">  Tipo de objeto </h3><br><p>  Suponha que voc√™ n√£o possa mais jogar com primitivas.  O que mais voc√™ pode pensar? </p><br><p>  Bem, primeiro, o m√©todo mais simples de sobrecarga proposto por Dmitry: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Object x = <span class="hljs-string"><span class="hljs-string">"Ok"</span></span>; sayWhat(x); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sayWhat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object x)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(x); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sayWhat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String x)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Error(); }</code> </pre> <br><p>  A vincula√ß√£o de m√©todos sobrecarregados em Java ocorre estaticamente, no est√°gio de compila√ß√£o.  O m√©todo sayWhat <code>sayWhat(Object)</code> √© <code>sayWhat(Object)</code> , mas se inferirmos o tipo <code>x</code> automaticamente, a <code>String</code> <code>sayWhat(String)</code> e, portanto, o m√©todo <code>sayWhat(String)</code> mais espec√≠fico ser√° vinculado. </p><br><p>  Outra maneira de fazer uma chamada amb√≠gua em Java √© usando argumentos vari√°veis ‚Äã‚Äã(varargs).  Wouter lembrou isso novamente: </p><br><pre> <code class="java hljs">Object x = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object[] {}; Arrays.asList(x).get(<span class="hljs-number"><span class="hljs-number">0</span></span>); System.out.println(<span class="hljs-string"><span class="hljs-string">"Ok"</span></span>);</code> </pre> <br><p>  Quando o tipo de vari√°vel √© <code>Object</code> , o compilador pensa que √© um argumento vari√°vel e agrupa a matriz em outra matriz de um elemento, para que <code>get()</code> conclu√≠do com √™xito.  Se voc√™ usa <code>var</code> , o tipo <code>Object[]</code> exibido e n√£o haver√° quebra autom√°tica.  Dessa forma, obtemos uma lista vazia e a chamada <code>get()</code> falhar√°. </p><br><p>  Maccimo optou pelo hardcore: ele decidiu chamar <code>println</code> atrav√©s da API MethodHandle: </p><br><pre> <code class="java hljs">Object x = <span class="hljs-string"><span class="hljs-string">"Ok"</span></span>; MethodHandles.Lookup lookup = MethodHandles.lookup(); MethodHandle mh = lookup.findVirtual( PrintStream.class, <span class="hljs-string"><span class="hljs-string">"println"</span></span>, MethodType.methodType(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>.class, Object.class)); mh.invokeExact(System.out, x);</code> </pre> <br><p>  O m√©todo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>invokeExact</code></a> e v√°rios outros m√©todos do <code>java.lang.invoke</code> possuem a chamada "assinatura polim√≥rfica".  Embora seja declarado como o m√©todo usual vararg <code>invokeExact(Object... args)</code> , ele n√£o ocorre no empacotamento padr√£o da matriz.  Em vez disso, uma assinatura √© gerada no bytecode que corresponde aos tipos de argumentos realmente transmitidos.  O m√©todo <code>invokeExact</code> projetado para uma chamada super-r√°pida de identificadores de m√©todo, portanto, n√£o realiza nenhuma transforma√ß√£o de argumento padr√£o, como convers√£o ou boxe.  O tipo de m√©todo do identificador deve corresponder exatamente √† assinatura da chamada.  Isso √© verificado no tempo de execu√ß√£o e, como no caso de <code>var</code> correspond√™ncia √© interrompida, obtemos uma <code>WrongMethodTypeException</code> . </p><br><h3 id="dzheneriki">  Gen√©ricos </h3><br><p>  Obviamente, a parametriza√ß√£o de tipos pode adicionar um brilho a qualquer tarefa em Java.  Dmitry trouxe uma solu√ß√£o semelhante ao c√≥digo que me deparei inicialmente.  A decis√£o de Dmitry √© detalhada, ent√£o mostrarei o meu: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Object x = foo(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder()); System.out.println(x); } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T x)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T)<span class="hljs-string"><span class="hljs-string">"Ok"</span></span>; }</code> </pre> <br><p>  O tipo <code>T</code> √© produzido como <code>StringBuilder</code> , mas nesse c√≥digo o compilador n√£o √© necess√°rio para inserir uma verifica√ß√£o de tipo no dial-peer no bytecode.  √â suficiente para ele que <code>StringBuilder</code> possa ser atribu√≠do a <code>Object</code> , o que significa que est√° tudo bem.  Ningu√©m √© contra o fato de que o m√©todo com o valor de retorno <code>StringBuilder</code> realmente retornou a string se voc√™ atribuiu o resultado a uma vari√°vel do tipo <code>Object</code> qualquer maneira.  O compilador avisa honestamente que voc√™ tem um elenco n√£o verificado, o que significa que ele lava as m√£os.  No entanto, ao substituir <code>x</code> por <code>var</code> tipo <code>x</code> tamb√©m √© exibido como <code>StringBuilder</code> , e n√£o √© mais poss√≠vel sem a verifica√ß√£o de tipo, porque atribuir algo mais √† vari√°vel de tipo <code>StringBuilder</code> √© in√∫til.  Como resultado, ap√≥s alterar para <code>var</code> programa trava com seguran√ßa com uma <code>ClassCastException</code> . </p><br><p>  Wouter sugeriu uma variante desta solu√ß√£o usando m√©todos padr√£o: </p><br><pre> <code class="java hljs">Object o = ((List&lt;String&gt;)(List)List.of(<span class="hljs-number"><span class="hljs-number">1</span></span>)).get(<span class="hljs-number"><span class="hljs-number">0</span></span>); System.out.println(<span class="hljs-string"><span class="hljs-string">"Ok"</span></span>);</code> </pre> <br><p>  Por fim, outra op√ß√£o da Wouter: </p><br><pre> <code class="java hljs">Object x = <span class="hljs-string"><span class="hljs-string">""</span></span>; TreeSet&lt;?&gt; set = Stream.of(x) .collect(toCollection(() -&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TreeSet&lt;&gt;((a, b) -&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>))); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (set.contains(<span class="hljs-number"><span class="hljs-number">1</span></span>)) { System.out.println(<span class="hljs-string"><span class="hljs-string">"Ok"</span></span>); }</code> </pre> <br><p>  Aqui, dependendo do uso de <code>var</code> ou <code>Object</code> o tipo de fluxo √© exibido como <code>Stream&lt;Object&gt;</code> ou como <code>Stream&lt;String&gt;</code> .  Assim, o tipo <code>TreeSet</code> e o tipo lambda do comparador s√£o exibidos.  No caso de <code>var</code> , as strings devem chegar ao lambda, portanto, ao gerar uma representa√ß√£o de tempo de execu√ß√£o lambda, uma convers√£o de tipo √© inserida automaticamente, o que fornece uma <code>ClassCastException</code> ao tentar converter uma unidade em uma string. </p><br><p>  Em geral, o resultado foi muito chato.  Se voc√™ pode encontrar m√©todos fundamentalmente diferentes para quebrar o <code>var</code> , escreva nos coment√°rios. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt469111/">https://habr.com/ru/post/pt469111/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt469095/index.html">Lan√ßadas atualiza√ß√µes do ML.NET e do Model Builder: O que h√° de novo</a></li>
<li><a href="../pt469097/index.html">Servidor web CentOS 8 com php7, node.js e redis</a></li>
<li><a href="../pt469099/index.html">Tarefas de teste na entrevista do desenvolvedor - isso faz sentido?</a></li>
<li><a href="../pt469101/index.html">Aprendendo ingl√™s: como aprender a falar como falante nativo</a></li>
<li><a href="../pt469109/index.html">Brinquedos de madeira, parte tr√™s - 1989</a></li>
<li><a href="../pt469115/index.html">Guia Discovery.js: In√≠cio r√°pido</a></li>
<li><a href="../pt469117/index.html">Programa√ß√£o sob BC 0010 em 2019</a></li>
<li><a href="../pt469119/index.html">Os endere√ßos IPv4 no RIPE terminaram. Completamente terminado ...</a></li>
<li><a href="../pt469125/index.html">Tema sombrio do Thunderbird como um motivo para executar um analisador de c√≥digo</a></li>
<li><a href="../pt469127/index.html">Otimiza√ß√£o ou como n√£o dar um tiro no pr√≥prio p√©</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>