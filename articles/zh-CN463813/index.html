<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’” ğŸ•Œ ğŸš¶ Mikrotik RouterOSä¸Šçš„å¤šå¢è´§è½¦å’Œè·¯ç”± ğŸ¦† ğŸ‘©ğŸ¼â€ğŸ¤â€ğŸ‘¨ğŸ¿ ğŸ…ğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æ›´æ­£å’Œæ·»åŠ 02/11/2020 
 å¼•è¨€ 
 é™¤äº†è™šè£å¿ƒå¤–ï¼Œä¿„è¯­ç”µæŠ¥ç¤¾åŒºçš„ç›¸å…³ç¾¤ä½“å¯¹æ­¤ä¸»é¢˜çš„æé—®ä¹Ÿä»¤äººæ²®ä¸§ï¼Œè¿™ä¿ƒä½¿æˆ‘ç€çœ¼äºè¿™ç¯‡æ–‡ç« ã€‚ æœ¬æ–‡é’ˆå¯¹Mikrotik RouterOSï¼ˆä»¥ä¸‹ç®€ç§°ROSï¼‰çš„æ–°æ‰‹ç®¡ç†å‘˜ã€‚ å®ƒåªè€ƒè™‘äº†å¤šå¢è´§è½¦ï¼Œä¾§é‡äºè·¯ç”±ã€‚ å¥–é‡‘åŒ…æ‹¬æœ€ä½é™åº¦çš„è®¾ç½®ï¼Œä»¥ç¡®ä¿å®‰å…¨ä¾¿æ·çš„æ“ä½œã€‚ é‚£äº›å¸Œæœ›...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mikrotik RouterOSä¸Šçš„å¤šå¢è´§è½¦å’Œè·¯ç”±</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463813/"> æ›´æ­£å’Œæ·»åŠ 02/11/2020 <br><h4> å¼•è¨€ </h4><br> é™¤äº†è™šè£å¿ƒå¤–ï¼Œä¿„è¯­ç”µæŠ¥ç¤¾åŒºçš„ç›¸å…³ç¾¤ä½“å¯¹æ­¤ä¸»é¢˜çš„æé—®ä¹Ÿä»¤äººæ²®ä¸§ï¼Œè¿™ä¿ƒä½¿æˆ‘ç€çœ¼äºè¿™ç¯‡æ–‡ç« ã€‚ æœ¬æ–‡é’ˆå¯¹Mikrotik RouterOSï¼ˆä»¥ä¸‹ç®€ç§°ROSï¼‰çš„æ–°æ‰‹ç®¡ç†å‘˜ã€‚ å®ƒåªè€ƒè™‘äº†å¤šå¢è´§è½¦ï¼Œä¾§é‡äºè·¯ç”±ã€‚ å¥–é‡‘åŒ…æ‹¬æœ€ä½é™åº¦çš„è®¾ç½®ï¼Œä»¥ç¡®ä¿å®‰å…¨ä¾¿æ·çš„æ“ä½œã€‚ é‚£äº›å¸Œæœ›å…¬å¼€è¿™äº›é˜Ÿåˆ—ï¼Œè´Ÿè½½å¹³è¡¡ï¼ŒVLANï¼Œç½‘æ¡¥ï¼Œå¯¹é€šé“çŠ¶å†µè¿›è¡Œå¤šé˜¶æ®µæ·±å…¥åˆ†æçš„äººå‘˜ç­‰-ä¸ä¼šæµªè´¹æ—¶é—´å’Œç²¾åŠ›ã€‚ <br><a name="habracut"></a><br><h4> æºæ•°æ® </h4><br> ä½œä¸ºæµ‹è¯•å¯¹è±¡ï¼Œé€‰æ‹©äº†å…·æœ‰ROSç‰ˆæœ¬6.45+çš„äº”ç«¯å£Mikrotikè·¯ç”±å™¨ã€‚ å®ƒå°†åœ¨ä¸¤ä¸ªå±€åŸŸç½‘ï¼ˆLAN1å’ŒLAN2ï¼‰å’Œä¸‰ä¸ªæä¾›å•†ï¼ˆISP1ï¼ŒISP2ï¼ŒISP3ï¼‰ä¹‹é—´è·¯ç”±é€šä¿¡ã€‚ åˆ°ISP1çš„é€šé“å…·æœ‰é™æ€çš„â€œç°è‰²â€åœ°å€ï¼Œé€šè¿‡DHCPæ¥æ”¶åˆ°çš„ISP2ä¸ºâ€œç™½è‰²â€ï¼Œå…·æœ‰PPPoEèº«ä»½éªŒè¯çš„ISP3ä¸ºâ€œç™½è‰²â€ã€‚ è¿æ¥å›¾å¦‚å›¾æ‰€ç¤ºï¼š <br><br><img src="https://habrastorage.org/webt/pd/di/mv/pddimv_vbwqmityow2oe2oxngam.jpeg"><br><br> ä»»åŠ¡æ˜¯æ ¹æ®è¯¥æ–¹æ¡ˆé…ç½®MTKè·¯ç”±å™¨ï¼Œä»¥ä¾¿ï¼š <br><br><ol><li> æä¾›è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ä»½æä¾›ç¨‹åºçš„åŠŸèƒ½ã€‚ ä¸»è¦æä¾›è€…æ˜¯ISP2ï¼Œç¬¬ä¸€ä¸ªä¿ç•™è€…æ˜¯ISP1ï¼Œç¬¬äºŒä¸ªä¿ç•™è€…æ˜¯ISP3ã€‚ </li><li> ç»„ç»‡ä»…é€šè¿‡ISP1è®¿é—®Internetçš„LAN1ã€‚ </li><li> æä¾›åŸºäºåœ°å€åˆ—è¡¨é€šè¿‡é€‰å®šçš„æä¾›ç¨‹åºå°†æµé‡ä»æœ¬åœ°ç½‘ç»œè·¯ç”±åˆ°Internetçš„åŠŸèƒ½ã€‚ </li><li> æä¾›ä»å±€åŸŸç½‘åˆ°Internetï¼ˆDSTNATï¼‰å‘å¸ƒæœåŠ¡çš„å¯èƒ½æ€§ </li><li> é…ç½®é˜²ç«å¢™è¿‡æ»¤å™¨ï¼Œä»¥ä»Internetæä¾›æœ€ä½é™åº¦çš„è¶³å¤Ÿå®‰å…¨æ€§ã€‚ </li><li> è·¯ç”±å™¨å¯ä»¥é€šè¿‡ä¸‰ä¸ªæä¾›å•†ä¸­çš„ä»»ä½•ä¸€ä¸ªå‘å‡ºè‡ªå·±çš„æµé‡ï¼Œå…·ä½“å–å†³äºæ‰€é€‰çš„æºåœ°å€ã€‚ </li><li> æä¾›å“åº”æ•°æ®åŒ…åˆ°å®ƒä»¬æ¥è‡ªçš„é€šé“çš„è·¯ç”±ï¼ˆåŒ…æ‹¬LANï¼‰ã€‚ </li></ol><br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i>æˆ‘ä»¬å°†â€œä»å¤´å¼€å§‹â€é…ç½®è·¯ç”±å™¨ï¼Œä»¥ç¡®ä¿åœ¨ä¸åŒç‰ˆæœ¬ä¹‹é—´â€œå¼€ç®±å³ç”¨â€å¯åŠ¨é…ç½®æ—¶ä¸ä¼šå‡ºç°æ„å¤–ã€‚</i>  <i>Winboxè¢«é€‰ä¸ºé…ç½®å·¥å…·ï¼Œæ›´æ”¹å°†åœ¨å…¶ä¸­ç›´è§‚æ˜¾ç¤ºã€‚</i>  <i>è®¾ç½®æœ¬èº«å°†é€šè¿‡Winboxç»ˆç«¯ä¸­çš„å‘½ä»¤è¿›è¡Œè®¾ç½®ã€‚</i>  <i>ç”¨äºé…ç½®çš„ç‰©ç†è¿æ¥æ˜¯é€šè¿‡ä¸Ether5æ¥å£çš„ç›´æ¥è¿æ¥ã€‚</i> <br><br><h4> å…³äºä»€ä¹ˆæ˜¯å¤šå¢è´§è½¦ï¼Œæ˜¯ä¸€ä¸ªé—®é¢˜è¿˜æ˜¯ç‹¡çŒ¾çš„èªæ˜äººåœ¨å‘¨å›´ä¸²è°‹ç½‘ç»œçš„ç®€çŸ­è®¨è®º </h4><br> ä¸€ä¸ªå¥½å¥‡è€Œä¸“å¿ƒçš„ç®¡ç†å‘˜ï¼Œè‡ªå·±å»ºç«‹äº†è¿™æ ·çš„è®¡åˆ’ï¼Œçªç„¶çªç„¶æ„è¯†åˆ°å®ƒåœ¨æ­£å¸¸å·¥ä½œã€‚ æ˜¯çš„ï¼Œæ˜¯çš„ï¼Œæ²¡æœ‰è¿™äº›æ‚¨çš„è‡ªå®šä¹‰è·¯ç”±è¡¨å’Œå…¶ä»–è·¯ç”±è§„åˆ™ï¼Œæœ‰å…³è¯¥ä¸»é¢˜çš„å¤§å¤šæ•°æ–‡ç« éƒ½åŒ…å«å…¶ä¸­ã€‚ çœ‹çœ‹å—ï¼Ÿ <br><br> æˆ‘ä»¬å¯ä»¥åœ¨æ¥å£å’Œé»˜è®¤ç½‘å…³ä¸Šé…ç½®å¯»å€å—ï¼Ÿ æ˜¯çš„ï¼š <br><br> åœ¨ISP1ä¸Šæ³¨å†Œäº†<b>è·ç¦»= 2</b>å’Œ<b>check-gateway = ping</b>çš„åœ°å€å’Œç½‘å…³<b>ã€‚</b> <br> åœ¨ISP2ä¸Šï¼Œå®¢æˆ·ç«¯çš„é»˜è®¤dhcpè®¾ç½®åˆ†åˆ«æ˜¯è·ç¦»ï¼Œç­‰äº1ã€‚ <br> åœ¨ISP3çš„å®¢æˆ·ç«¯çš„pppoeè®¾ç½®ä¸­ï¼Œä½¿ç”¨<b>add-default-route = yes</b>è®¾ç½®<b>default-route-distance = 3</b> ã€‚ <br><br> ä¸è¦å¿˜è®°ä¸ºè¾“å‡ºæ³¨å†ŒNATï¼š <br><br>  <b>/ ipé˜²ç«å¢™natæ·»åŠ æ“ä½œ=ä¼ªè£…é“¾= srcnatå‡ºæ¥å£åˆ—è¡¨= WAN</b> <br><br> ç»“æœï¼ŒLANçš„ç”¨æˆ·å¯ä»¥é€šè¿‡ä¸»è¦çš„ISP2æä¾›ç¨‹åºæ¥åŠ è½½å¯†å°ä¿¡æ¯ï¼Œå¹¶ä¸”ä½¿ç”¨<b>æ£€æŸ¥ç½‘å…³</b>æœºåˆ¶ä¿ç•™äº†é€šé“ï¼ˆ <sup>è¯·å‚é˜…æ³¨1ï¼‰ã€‚</sup> <br><br> ä»»åŠ¡çš„ç¬¬1ç‚¹å·²å®ç°ã€‚ å¸¦æœ‰æ ‡ç­¾çš„å¤šå¢è´§è½¦åœ¨å“ªé‡Œï¼Ÿ ä¸... <br><br> å†è¿œä¸€ç‚¹ æ‚¨éœ€è¦é€šè¿‡ISP1ä»LANé‡Šæ”¾ç‰¹å®šçš„å®¢æˆ·ç«¯ï¼š <br><br>  <b>/ ipé˜²ç«å¢™mangleæ·»åŠ æ“ä½œ=è·¯ç”±é“¾=è·¯ç”±dst-address-list =ï¼BOGONS \</b> <b><br></b>  <b>passthrough =æ˜¯route-dst = 100.66.66.1 src-address-list = Via_ISP1</b> <b><br></b>  <b>/ ipé˜²ç«å¢™mangleæ·»åŠ æ“ä½œ=è·¯ç”±é“¾=è·¯ç”±dst-address-list =ï¼BOGONS \</b> <b><br></b>  <b>passthrough =æ— è·¯ç”±-dst = 100.66.66.1 srcåœ°å€= 192.168.88.0 / 24</b> <br><br> ä»»åŠ¡çš„é¡¹ç›®2å’Œ3å·²å®æ–½ã€‚ æ ‡ç­¾ï¼Œé‚®ç¥¨ï¼Œè·¯çº¿è§„åˆ™ï¼Œæ‚¨åœ¨å“ªé‡Œï¼Ÿï¼ <br><br> æ˜¯å¦éœ€è¦ä¸ºæ¥è‡ªInternetçš„å®¢æˆ·ç«¯æˆäºˆæ‚¨æœ€å–œæ¬¢çš„OpenVPNæœåŠ¡å™¨ï¼ˆåœ°å€ä¸º172.17.17.17ï¼‰çš„è®¿é—®æƒé™ï¼Ÿ è¯·ï¼š <br><br>  <b>/ ip cloud set ddns-enabled = yes</b> <br><br> æˆ‘ä»¬å°†è¾“å‡ºç»“æœä½œä¸ºç››å®´æä¾›ç»™å®¢æˆ·ç«¯ï¼šâ€œ <b>ï¼šput [ip cloud get dns-name]</b> â€ <br><br> æˆ‘ä»¬ä»Internetæ³¨å†Œç«¯å£è½¬å‘ï¼š <br><br>  <b>/ ipé˜²ç«å¢™natæ·»åŠ æ“ä½œ= dst-naté“¾= dstnat dst-port = 1194 \</b> <b><br></b>  <b>è¾“å…¥æ¥å£åˆ—è¡¨= WANåè®®= udpåˆ°åœ°å€= 172.17.17.17</b> <br><br> ç‚¹4å‡†å¤‡å°±ç»ªã€‚ <br><br> æˆ‘ä»¬ä¸ºç¬¬5ç‚¹è®¾ç½®äº†é˜²ç«å¢™å’Œå…¶ä»–å®‰å…¨ä¿æŠ¤æªæ–½ï¼Œä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬å¾ˆé«˜å…´ä¸€åˆ‡éƒ½å¯¹ç”¨æˆ·æœ‰æ•ˆï¼Œå¹¶ä¸”æ­£åœ¨ä¸ºè£…æœ‰å–œæ¬¢çš„é¥®æ–™çš„å®¹å™¨æœåŠ¡â€¦â€¦ <br> å•Šï¼ éš§é“ä»ç„¶è¢«é—å¿˜ã€‚ <br><br> æ ¹æ®googledæ–‡ç« é…ç½®çš„l2tpå®¢æˆ·ç«¯ä¸Šå‡åˆ°äº†æœ€å—æ¬¢è¿çš„è·å…°VDSï¼Ÿ æ˜¯çš„ <br> å…·æœ‰IPsecçš„l2tpæœåŠ¡å™¨ä¸Šå‡äº†ï¼Œè€Œæ¥è‡ªIP Cloudçš„DNSåç§°çš„å®¢æˆ·ç«¯ï¼ˆè¯·å‚è§ä¸Šæ–‡ï¼‰æ˜¯å¦åšæŒï¼Ÿ æ˜¯çš„ <br> å‘åå€¾æ–œï¼Œå–ä¸€å°å£é¥®æ–™ï¼Œæˆ‘ä»¬æ— æ‰€äº‹äº‹åœ°æ£€æŸ¥äº†é—®é¢˜çš„ç¬¬å…­å’Œç¬¬ä¸ƒé¡¹ã€‚ æˆ‘ä»¬è®¤ä¸º-æˆ‘ä»¬éœ€è¦å—ï¼Ÿ ä¸€åˆ‡éƒ½åœ¨é‚£æ ·å·¥ä½œ...å› æ­¤ï¼Œå¦‚æœæ²¡æœ‰å¿…è¦ï¼Œé‚£å°±è¶³å¤Ÿäº†ã€‚ å®æ–½Multivanã€‚ <br><br>  <b>ä»€ä¹ˆæ˜¯å¤šå¢è´§è½¦ï¼Ÿ</b>  <b>è¿™æ˜¯å‡ ä¸ªInterneté€šé“åˆ°ä¸€ä¸ªè·¯ç”±å™¨çš„è¿æ¥ã€‚</b> <br><br> æ‚¨æ— æ³•è¿›ä¸€æ­¥é˜…è¯»è¯¥æ–‡ç« ï¼Œå› ä¸ºé™¤äº†ç‚«è€€å¯åº”ç”¨æ€§ä¹‹å¤–ï¼Œè¿˜æœ‰ä»€ä¹ˆï¼Ÿ <br><br> ä¸å‰©ä¸‹çš„ï¼Œå¯¹ä»»åŠ¡çš„ç¬¬6ç‚¹å’Œç¬¬7ç‚¹æ„Ÿå…´è¶£å¹¶ä¸”è¿˜æ„Ÿåˆ°å®Œç¾ä¸»ä¹‰ä¹‹ç—’çš„äººä»¬ä¸€èµ·ï¼Œæˆ‘ä»¬ä¼šæ›´æ·±å…¥åœ°å­¦ä¹ ã€‚ <br><br> å®æ–½å¤šå¢è´§è½¦çš„æœ€é‡è¦ä»»åŠ¡æ˜¯æ­£ç¡®çš„äº¤é€šè·¯çº¿ã€‚ å³ï¼šæ— è®ºåœ¨å“ªä¸ªï¼ˆæˆ–å“ªä¸ªï¼‰ <sup>æ³¨é‡Š3ä¸­ï¼Œ</sup>æä¾›å•†çš„é€šé“æŸ¥çœ‹æˆ‘ä»¬è·¯ç”±å™¨ä¸Šçš„é»˜è®¤è·¯ç”±ï¼Œéƒ½åº”å°†ç­”æ¡ˆå‡†ç¡®åœ°è¿”å›åˆ°æ•°æ®åŒ…æ‰€æ¥è‡ªçš„é€šé“ã€‚ ä»»åŠ¡å¾ˆæ˜ç¡®ã€‚ é—®é¢˜å‡ºåœ¨å“ªé‡Œï¼Ÿ ç¡®å®ï¼Œåœ¨ç®€å•çš„æœ¬åœ°ç½‘ç»œä¸­ï¼Œä»»åŠ¡æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯æ²¡æœ‰äººä¼šæ‹…å¿ƒå…¶ä»–è®¾ç½®ï¼Œä¹Ÿä¸ä¼šæ„Ÿåˆ°éº»çƒ¦ã€‚ åŒºåˆ«åœ¨äºï¼ŒInternetä¸Šçš„ä»»ä½•è·¯ç”±èŠ‚ç‚¹éƒ½å¯ä»¥é€šè¿‡æˆ‘ä»¬çš„æ¯ä¸ªé€šé“è®¿é—®ï¼Œè€Œä¸æ˜¯åƒåœ¨ç®€å•çš„LANä¸­é‚£æ ·é€šè¿‡ä¸¥æ ¼ç‰¹å®šçš„é€šé“è®¿é—®ã€‚ ä½†æ˜¯â€œéº»çƒ¦â€æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ”¶åˆ°äº†å¯¹ISP3 IPåœ°å€çš„è¯·æ±‚ï¼Œé‚£ä¹ˆåœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œç­”æ¡ˆå°†é€šè¿‡ISP2é€šé“ï¼Œå› ä¸ºé»˜è®¤ç½‘å…³æŒ‡å‘é‚£é‡Œã€‚ å®ƒä¼šç¦»å¼€å¹¶è¢«æä¾›è€…è§†ä¸ºä¸æ­£ç¡®è€Œä¸¢å¼ƒã€‚ æˆ‘ä»¬å†³å®šäº†è¿™ä¸ªé—®é¢˜ã€‚ æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ <br><br> è§£å†³æ–¹æ¡ˆåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š <br><br><ol><li>  <b>é¢„é…ç½®</b> åœ¨æ­¤é˜¶æ®µï¼Œå°†è®¾ç½®è·¯ç”±å™¨çš„åŸºæœ¬è®¾ç½®ï¼šå±€åŸŸç½‘ï¼Œé˜²ç«å¢™ï¼Œåœ°å€åˆ—è¡¨ï¼Œå‘å¤¹å¼NATç­‰ã€‚ </li><li>  <b>å¤šå¢è´§è½¦ã€‚</b> åœ¨æ­¤é˜¶æ®µï¼Œå¿…è¦çš„è¿æ¥å°†æ ¹æ®è·¯ç”±è¡¨è¿›è¡Œæ ‡è®°å’Œæ’åºã€‚ </li><li>  <b>è¿æ¥åˆ°ISPã€‚</b> åœ¨æ­¤é˜¶æ®µï¼Œå°†é…ç½®æä¾›Internetè¿æ¥çš„æ¥å£ï¼Œå°†æ¶‰åŠè·¯ç”±å’ŒInterneté€šé“çš„é¢„ç•™æœºåˆ¶ã€‚ </li></ol><br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i>ä¸“é—¨é€‰æ‹©äº†ä¸‰ç§ä¸åŒç±»å‹çš„ISPè¿æ¥ï¼Œä»¥æ˜¾ç¤ºè®¾ç½®å…·æœ‰åŠ¨æ€åœ°å€çš„å¤šå¢è´§è½¦å¹¶æ²¡æœ‰è§£å†³ä»»ä½•é—®é¢˜ï¼Œå¹¶æ¼”ç¤ºäº†è§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚</i> <br>  <u><b>é‡è¦ï¼</b></u> è¦æ ¹æ®ä½¿ç”¨<b>è·ç¦»</b>è·¯ç”±æˆæœ¬æŒ‡å®šçš„ç®—æ³•åˆ‡æ¢é¢‘é“ï¼Œ <b>è¯·</b>ä½¿ç”¨<b>æ£€æŸ¥ç½‘å…³</b>æœºåˆ¶<b>ã€‚</b>  <sup>è§æ³¨1</sup> <br> æœ¬æ–‡ä¸­ç»™å‡ºçš„è„šæœ¬ä¸é€šé“ä¿ç•™æ— å…³ã€‚ <br><br><h4>  1.é¢„è®¾ </h4><br>  1.1ã€‚ æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¸…é™¤è·¯ç”±å™¨é…ç½®ï¼š <br><br><pre><code class="plaintext hljs">/system reset-configuration skip-backup=yes no-defaults=yes</code> </pre> <br> åŒæ„â€œ <b>å±é™©ï¼</b>  <b>ä»è¦é‡ç½®å—ï¼Ÿ</b>  <b>[y / N]ï¼š</b> â€ï¼Œé‡æ–°å¯åŠ¨åï¼Œæˆ‘ä»¬é€šè¿‡MACè¿æ¥åˆ°Winboxã€‚ åœ¨æ­¤é˜¶æ®µï¼Œå°†æ¸…é™¤é…ç½®å’Œç”¨æˆ·ç¾¤ã€‚ <br><br>  1.2ã€‚ åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·ï¼š <br><br><pre> <code class="plaintext hljs">/user add group=full name=knight password=ultrasecret comment="Not horse"</code> </pre> <br> åœ¨å…¶ä¸‹ç™»å½•å¹¶åˆ é™¤é»˜è®¤è®¾ç½®ï¼š <br><br><pre> <code class="plaintext hljs">/user remove admin</code> </pre> <br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i>ä½œè€…è®¤ä¸ºæ›´å®‰å…¨å¹¶å»ºè®®ä½¿ç”¨é»˜è®¤ç”¨æˆ·ï¼Œè€Œä¸æ˜¯æ–­å¼€è¯¥é»˜è®¤ç”¨æˆ·çš„è¿æ¥ã€‚</i> <br><br>  1.3ã€‚ æˆ‘ä»¬åˆ›å»ºåŸºæœ¬æ¥å£åˆ—è¡¨æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨é˜²ç«å¢™ï¼Œå‘ç°è®¾ç½®å’Œå…¶ä»–MACæœåŠ¡å™¨ä¸­è¿›è¡Œæ“ä½œï¼š <br><br><pre> <code class="plaintext hljs">/interface list add name=WAN comment="For Internet" /interface list add name=LAN comment="For Local Area"</code> </pre> <br> æˆ‘ä»¬ç”¨è¯„è®ºç­¾ç½²ç•Œé¢ <br><br><pre> <code class="plaintext hljs">/interface ethernet set ether1 comment="to ISP1" /interface ethernet set ether2 comment="to ISP2" /interface ethernet set ether3 comment="to ISP3" /interface ethernet set ether4 comment="to LAN1" /interface ethernet set ether5 comment="to LAN2"</code> </pre> <br> å¹¶å¡«å†™æ¥å£åˆ—è¡¨ï¼š <br><br><pre> <code class="plaintext hljs">/interface list member add interface=ether1 list=WAN comment=ISP1 /interface list member add interface=ether2 list=WAN comment=ISP2 /interface list member add interface=ether3 list=WAN comment="to ISP3" /interface list member add interface=ether4 list=LAN comment="LAN1" /interface list member add interface=ether5 list=LAN comment="LAN2"</code> </pre><br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i>ç¼–å†™æ¸…æ™°çš„æ³¨é‡Šå€¼å¾—æ‚¨èŠ±æ—¶é—´åœ¨æ­¤ä¸Šï¼Œå¹¶ä¸”æå¤§åœ°ç®€åŒ–äº†æ•…éšœæ’é™¤å’Œäº†è§£é…ç½®çš„è¿‡ç¨‹ã€‚</i> <i><br><br></i>  <i>å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä½œè€…è®¤ä¸ºæœ‰å¿…è¦å°†ether3æ¥å£æ·»åŠ åˆ°æ¥å£åˆ—è¡¨â€œ WANâ€ï¼Œå°½ç®¡ipåè®®ä¸ä¼šé€šè¿‡å®ƒã€‚</i> <i><br><br></i>  <i>ä¸è¦å¿˜è®°ï¼Œåœ¨ether3ä¸Šå¼•å‘PPPæ¥å£åï¼Œè¿˜éœ€è¦å°†å…¶æ·»åŠ åˆ°â€œ WANâ€æ¥å£åˆ—è¡¨ä¸­</i> <br><br>  1.4ã€‚ æˆ‘ä»¬é€šè¿‡MACä»æä¾›å•†ç½‘ç»œçš„é‚»è¿‘æ£€æµ‹å’Œæ§åˆ¶ä¸­éšè—è·¯ç”±å™¨ï¼š <br><br><pre> <code class="plaintext hljs">/ip neighbor discovery-settings set discover-interface-list=!WAN /tool mac-server set allowed-interface-list=LAN /tool mac-server mac-winbox set allowed-interface-list=LAN</code> </pre> <br>  1.5ã€‚ æˆ‘ä»¬åˆ›å»ºä¸€ç»„æœ€å°‘çš„é˜²ç«å¢™è¿‡æ»¤å™¨è§„åˆ™æ¥ä¿æŠ¤è·¯ç”±å™¨ï¼š <br><br><pre> <code class="plaintext hljs">/ip firewall filter add action=accept chain=input \ comment="Related Established Untracked Allow" \ connection-state=established,related,untracked</code> </pre> <br>  ï¼ˆè¯¥è§„åˆ™ä¸ºä»è¿æ¥çš„ç½‘ç»œå’Œè·¯ç”±å™¨æœ¬èº«å¯åŠ¨çš„å·²å»ºç«‹å’Œç›¸å…³çš„è¿æ¥æä¾›è®¸å¯ï¼‰ <br><br><pre> <code class="plaintext hljs">/ip firewall filter add action=accept chain=input \ comment="ICMP from ALL" protocol=icmp</code> </pre> <br>  ï¼ˆpingä¸ä»…æ˜¯pingã€‚æ‰€æœ‰icmpéƒ½å¯ä»¥è¾“å…¥ã€‚è¿™å¯¹äºæŸ¥æ‰¾MTUé—®é¢˜éå¸¸æœ‰ç”¨ï¼‰ <br><br><pre> <code class="plaintext hljs">/ip firewall filter add action=drop chain=input comment="All other WAN Drop" \ in-interface-list=WAN</code> </pre> <br>  ï¼ˆå…³é—­è¾“å…¥é“¾çš„è§„åˆ™ç¦æ­¢æ¥è‡ªInternetçš„æ‰€æœ‰å…¶ä»–å†…å®¹ï¼‰ <br><br><pre> <code class="plaintext hljs">/ip firewall filter add action=accept chain=forward \ comment="Established, Related, Untracked allow" \ connection-state=established,related,untracked</code> </pre> <br>  ï¼ˆè¯¥è§„åˆ™å…è®¸å»ºç«‹å’Œç›¸å…³çš„è¿æ¥é€šè¿‡è·¯ç”±å™¨ï¼‰ <br><br><pre> <code class="plaintext hljs">/ip firewall filter add action=drop chain=forward comment="Invalid drop" \ connection-state=invalid</code> </pre> <br>  ï¼ˆè¯¥è§„åˆ™ä¼šä¸¢å¼ƒé€šè¿‡è·¯ç”±å™¨çš„è¿æ¥ï¼Œä¸”è¿æ¥çŠ¶æ€=æ— æ•ˆã€‚Mikrotikå¼ºçƒˆå»ºè®®ä½¿ç”¨è¯¥è¿æ¥ï¼Œä½†åœ¨æå°‘æ•°æƒ…å†µä¸‹ï¼Œå®ƒä¼šé˜»æ­¢æœ‰ç”¨çš„æµé‡ï¼‰ <br><br><pre> <code class="plaintext hljs">/ip firewall filter add action=drop chain=forward \ comment="Drop all from WAN not DSTNATed" connection-nat-state=!dstnat \ connection-state=new in-interface-list=WAN</code> </pre> <br>  ï¼ˆè¯¥è§„åˆ™ç¦æ­¢æ¥è‡ªInternetä¸”æœªé€šè¿‡dstnatç¨‹åºé€šè¿‡è·¯ç”±å™¨çš„æ•°æ®åŒ…ã€‚è¿™å°†ä¿æŠ¤æœ¬åœ°ç½‘ç»œå…å—å…¥ä¾µè€…çš„ä¾µå®³ï¼Œè¿™äº›å…¥ä¾µè€…ä¸æˆ‘ä»¬çš„å¤–éƒ¨ç½‘ç»œä½äºåŒä¸€å¹¿æ’­åŸŸä¸­ï¼Œå¹¶å°†æˆ‘ä»¬çš„å¤–éƒ¨IPæ³¨å†Œä¸ºç½‘å…³ï¼Œå› æ­¤ï¼Œè¯·å°è¯•â€œæ¢ç´¢â€æˆ‘ä»¬çš„å±€åŸŸç½‘ã€‚ï¼‰ <br><br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i>è®©æˆ‘ä»¬å‡è®¾LAN1å’ŒLAN2æ˜¯å—ä¿¡ä»»çš„ç½‘ç»œï¼Œå®ƒä»¬ä¹‹é—´ä»¥åŠæ¥è‡ªå®ƒä»¬ä¹‹é—´çš„é€šä¿¡æ²¡æœ‰è¢«è¿‡æ»¤ã€‚</i> <br><br>  1.6ã€‚ åˆ›å»ºä¸€ä¸ªåŒ…å«ä¸å¯è·¯ç”±ç½‘ç»œåˆ—è¡¨çš„åˆ—è¡¨ï¼š <br><br><pre> <code class="plaintext hljs">/ip firewall address-list add address=0.0.0.0/8 comment="\"This\" Network" list=BOGONS add address=10.0.0.0/8 comment="Private-Use Networks" list=BOGONS add address=100.64.0.0/10 comment="Shared Address Space. RFC 6598" list=BOGONS add address=127.0.0.0/8 comment=Loopback list=BOGONS add address=169.254.0.0/16 comment="Link Local" list=BOGONS add address=172.16.0.0/12 comment="Private-Use Networks" list=BOGONS add address=192.0.0.0/24 comment="IETF Protocol Assignments" list=BOGONS add address=192.0.2.0/24 comment=TEST-NET-1 list=BOGONS add address=192.168.0.0/16 comment="Private-Use Networks" list=BOGONS add address=198.18.0.0/15 comment="Network Interconnect Device Benchmark Testing"\ list=BOGONS add address=198.51.100.0/24 comment=TEST-NET-2 list=BOGONS add address=203.0.113.0/24 comment=TEST-NET-3 list=BOGONS add address=224.0.0.0/4 comment=Multicast list=BOGONS add address=192.88.99.0/24 comment="6to4 Relay Anycast" list=BOGONS add address=240.0.0.0/4 comment="Reserved for Future Use" list=BOGONS add address=255.255.255.255 comment="Limited Broadcast" list=BOGONS</code> </pre> <br>  ï¼ˆè¿™æ˜¯æœªè·¯ç”±åˆ°Internetçš„åœ°å€å’Œç½‘ç»œçš„åˆ—è¡¨ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿå°†éµå¾ªæ­¤åˆ—è¡¨ã€‚ï¼‰ <br><br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i>è¯¥åˆ—è¡¨å¯èƒ½ä¼šæ›´æ”¹ï¼Œå› æ­¤æˆ‘å»ºè®®æ‚¨å®šæœŸæ£€æŸ¥ç›¸å…³æ€§ã€‚</i> <br><br>  1.7ã€‚ ä¸ºè·¯ç”±å™¨æœ¬èº«é…ç½®DNSï¼š <br><br><pre> <code class="plaintext hljs">/ip dns set servers=1.1.1.1,8.8.8.8</code> </pre> <br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i>åœ¨å½“å‰ç‰ˆæœ¬çš„ROSä¸­ï¼ŒåŠ¨æ€æœåŠ¡å™¨ä¼˜å…ˆäºé™æ€å®šä¹‰çš„æœåŠ¡å™¨ã€‚</i>  <i>åç§°è§£æè¯·æ±‚å°†æŒ‰ç…§åˆ—è¡¨ä¸­çš„é¡ºåºå‘é€åˆ°ç¬¬ä¸€å°æœåŠ¡å™¨ã€‚</i>  <i>å½“å‰æœåŠ¡å™¨ä¸å¯ç”¨æ—¶ï¼Œå°†è½¬æ¢åˆ°ä¸‹ä¸€å°æœåŠ¡å™¨ã€‚</i>  <i>å¤§è¶…æ—¶-è¶…è¿‡5ç§’ã€‚</i>  <i>æ¢å¤â€œä¸‹é™çš„æœåŠ¡å™¨â€åä¸ä¼šè‡ªåŠ¨è¿”å›ã€‚</i>  <i>è€ƒè™‘åˆ°è¯¥ç®—æ³•å’Œå¤šå¢è´§è½¦çš„å­˜åœ¨ï¼Œä½œè€…å»ºè®®ä¸è¦ä½¿ç”¨æä¾›å•†æä¾›çš„æœåŠ¡å™¨ã€‚</i> <br><br>  1.8ã€‚ é…ç½®æœ¬åœ°ç½‘ç»œã€‚ <br>  1.8.1ã€‚ åœ¨LANæ¥å£ä¸Šé…ç½®é™æ€IPåœ°å€ï¼š <br><br><pre> <code class="plaintext hljs">/ip address add interface=ether4 address=192.168.88.254/24 comment="LAN1 IP" /ip address add interface=ether5 address=172.16.1.0/23 comment="LAN2 IP"</code> </pre> <br>  1.8.2ã€‚ æˆ‘ä»¬é€šè¿‡ä¸»è·¯ç”±è¡¨è®¾ç½®åˆ°æœ¬åœ°ç½‘ç»œçš„è·¯ç”±è§„åˆ™ï¼š <br><br><pre> <code class="plaintext hljs">/ip route rule add dst-address=192.168.88.0/24 table=main comment="to LAN1" /ip route rule add dst-address=172.16.0.0/23 table=main comment="to LAN2"</code> </pre> <br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i>è¿™æ˜¯ä½¿ç”¨è·¯ç”±å™¨æ¥å£çš„å¤–éƒ¨IPåœ°å€è®¿é—®æœ¬åœ°ç½‘ç»œåœ°å€çš„æœ€ç®€å•ï¼Œæœ€å¿«çš„æ–¹æ³•ä¹‹ä¸€ï¼Œé»˜è®¤è·¯ç”±ä¸ä¼šé€šè¿‡è¯¥åœ°å€é€šè¿‡ã€‚</i> <br><br>  1.8.3ã€‚ å¦‚æœ‰å¿…è¦ï¼Œä¸ºLAN1å’ŒLAN2å¯ç”¨Hairpin NATï¼š <br><br><pre> <code class="plaintext hljs">/ip firewall nat add action=src-nat chain=srcnat comment="Hairpin to LAN1" \ out-interface=ether4 src-address=192.168.88.0/24 to-addresses=192.168.88.254 /ip firewall nat add action=src-nat chain=srcnat comment="Hairpin to LAN2" \ out-interface=ether5 src-address=172.16.0.0/23 to-addresses=172.16.1.0</code> </pre> <br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i>è¿™å…è®¸LAN1å’ŒLAN2ä¸­çš„ç”¨æˆ·é€šè¿‡å¤–éƒ¨IPï¼ˆdstnatï¼‰è®¿é—®ä¸ä½äºåŒä¸€ç½‘æ®µä¸­çš„ç”¨æˆ·æ‰€åœ¨çš„æœåŠ¡å™¨ã€‚</i> <br><br><h4>  2.å®é™…ä¸Šï¼Œå®æ–½æ­£ç¡®çš„å¤šå¢è´§è½¦ </h4><br> ä¸ºäº†è§£å†³â€œåœ¨å“ªé‡Œå›ç­”ä»–ä»¬çš„é—®é¢˜â€çš„é—®é¢˜ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸¤ä¸ªROSå·¥å…·ï¼š <b>è¿æ¥æ ‡è®°</b>å’Œ<b>è·¯ç”±æ ‡è®°</b> ã€‚  <b>è¿æ¥æ ‡è®°</b>å…è®¸æ‚¨æ ‡è®°æ‰€éœ€çš„è¿æ¥ï¼Œå¹¶ç»§ç»­ä½¿ç”¨è¯¥æ ‡ç­¾ä½œä¸ºåº”ç”¨<b>è·¯ç”±æ ‡è®°</b>çš„æ¡ä»¶ã€‚ å¹¶ä¸”å·²ç»æœ‰äº†<b>è·¯ç”±æ ‡è®°</b> ï¼Œå°±å¯ä»¥ä½¿ç”¨<b>ipè·¯ç”±</b>å’Œ<b>è·¯ç”±è§„åˆ™</b> ã€‚ æˆ‘ä»¬æ‰¾åˆ°äº†å·¥å…·ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦ç¡®å®šè¦æ ‡è®°çš„è¿æ¥-ä¸€ä¸ªï¼Œç¡®åˆ‡æ ‡è®°çš„ä½ç½®-ä¸¤ä¸ªã€‚ <br><br> é¦–å…ˆï¼Œä¸€åˆ‡éƒ½å¾ˆç®€å•-æˆ‘ä»¬å¿…é¡»æ ‡è®°é€šè¿‡é€‚å½“çš„é€šé“ä»Internetåˆ°è·¯ç”±å™¨çš„æ‰€æœ‰è¿æ¥ã€‚ åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œè¿™å°†æ˜¯ä¸‰ä¸ªæ ‡ç­¾ï¼ˆæ ¹æ®é€šé“æ•°ï¼‰ï¼šâ€œ conn_isp1â€ï¼Œâ€œ conn_isp2â€å’Œâ€œ conn_isp3â€ã€‚ <br><br> ä¸ç¬¬äºŒç§æ–¹å¼çš„ç»†å¾®å·®åˆ«åœ¨äºï¼Œä¼ å…¥çš„è¿æ¥å°†æœ‰ä¸¤ç§ç±»å‹ï¼šè½¬æ¥å’Œç”¨äºè·¯ç”±å™¨æœ¬èº«çš„é‚£äº›ã€‚ è¿æ¥æ ‡è®°æœºåˆ¶åœ¨<b>mangle</b>è¡¨ä¸­èµ·ä½œç”¨ã€‚ åœ¨ç®€åŒ–çš„å›¾è¡¨ä¸Šè€ƒè™‘åŒ…è£…çš„ç§»åŠ¨æƒ…å†µï¼Œè¯¥å›¾è¡¨æ˜¯ç”±èµ„æºmikrotik-trainings.comçš„ä¸“å®¶ï¼ˆä¸æ˜¯å¹¿å‘Šï¼‰æ”¶é›†çš„ï¼š <br><br><img src="https://habrastorage.org/webt/gg/yc/u4/ggycu4_z4ps93z-crahvri9pshw.jpeg"><br><br> æ²¿ç€ç®­å¤´ï¼Œæˆ‘ä»¬çœ‹åˆ°åˆ°è¾¾â€œ <b>è¾“å…¥æ¥å£</b> â€çš„æ•°æ®åŒ…é€šè¿‡â€œ <b>é¢„è·¯ç”±</b> â€é“¾ï¼Œç„¶åæ‰åœ¨â€œ <b>è·¯ç”±å†³ç­–</b> â€å—ä¸­åˆ†ä¸ºä¼ è¾“å’Œæœ¬åœ°ã€‚ å› æ­¤ï¼Œè¦ç”¨ä¸€å—çŸ³å¤´æ€æ­»ä¸¤åªé¸Ÿï¼Œè¯·ä½¿ç”¨â€œ <b>é¢„å¸ƒçº¿â€</b>é“¾çš„â€œ <b>ç¼ ç»“é¢„å¸ƒçº¿â€</b>è¡¨ä¸­çš„â€œ <b>è¿æ¥æ ‡è®°â€</b> ã€‚ <br><br>  <i><b>å¤‡æ³¨</b> ã€‚</i>  <i>åœ¨ROSä¸­ï¼Œâ€œè·¯ç”±æ ‡è®°â€æ ‡ç­¾åœ¨â€œ Ip /è·¯ç”±/è§„åˆ™â€éƒ¨åˆ†ä¸­è¡¨ç¤ºä¸ºâ€œè¡¨æ ¼â€ï¼Œåœ¨å…¶ä½™éƒ¨åˆ†ä¸­è¡¨ç¤ºä¸ºâ€œè·¯ç”±æ ‡è®°â€ã€‚</i>  <i>è¿™å¯èƒ½ä¼šå¯¼è‡´ç†è§£ä¸Šçš„æ··ä¹±ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸åŒçš„é—®é¢˜ï¼Œå¹¶ä¸”æ˜¯Linuxä¸Šiproute2ä¸­rt_tablesçš„ç±»ä¼¼ç‰©ã€‚</i> <br><br>  2.1ã€‚ æˆ‘ä»¬æ ‡è®°æ¯ä¸ªæä¾›å•†çš„ä¼ å…¥è¿æ¥ï¼š <br><br><pre> <code class="plaintext hljs">/ip firewall mangle add action=mark-connection chain=prerouting \ comment="Connmark in from ISP1" connection-mark=no-mark in-interface=ether1 \ new-connection-mark=conn_isp1 passthrough=no /ip firewall mangle add action=mark-connection chain=prerouting \ comment="Connmark in from ISP2" connection-mark=no-mark in-interface=ether2 \ new-connection-mark=conn_isp2 passthrough=no /ip firewall mangle add action=mark-connection chain=prerouting \ comment="Connmark in from ISP3" connection-mark=no-mark in-interface=pppoe-isp3 \ new-connection-mark=conn_isp3 passthrough=no</code> </pre> <br>  <i><b>å¤‡æ³¨ã€‚</b></i> <i><br></i>  <i>é‚£äº›å°è¯•æŒ‰å­—é¢æ„æ€å¹¶æŒ‰é˜…è¯»é¡ºåºé‡å¤é˜…è¯»æ–‡ç« ä¸­å»ºè®®çš„è®¾ç½®çš„è¯»è€…ï¼Œå½“è¾“å…¥ç¬¬ä¸‰ä¸ªå‘½ä»¤æ—¶ï¼Œä»–ä»¬å°†é‡åˆ°é”™è¯¯ï¼šâ€œè¾“å…¥ä¸æ¥å£çš„ä»»ä½•å€¼éƒ½ä¸åŒ¹é…â€ã€‚</i>  <i>è¿™æ˜¯ç”±äºç¼ºå°‘â€œ pppoe-isp3â€æ¥å£ï¼Œè¯¥æ¥å£å°†åœ¨ç¬¬3.3.2èŠ‚ä¸­è¿›è¡Œé…ç½®ã€‚</i>  <i>æ­¤æ—¶ï¼Œæ‚¨å¯ä»¥è¾“å…¥â€œ ether3â€è€Œä¸æ˜¯â€œ pppoe-isp3â€ã€‚</i>  <i>åœ¨å®Œæˆç¬¬3.3.2èŠ‚ä¹‹åï¼Œæ‚¨åº”è¯¥è¿”å›å¹¶æ”¾ç½®æ¥å£çš„å½“å‰åç§°ã€‚</i> <i><br><br></i>  <i>ä¸ºäº†ä¸æ ‡è®°å·²æ ‡è®°çš„è¿æ¥ï¼Œæˆ‘ä½¿ç”¨æ¡ä»¶connection-mark = no-markè€Œä¸æ˜¯connection-state = newã€‚</i> <i><br><br></i>  <i>passthrough = no-å› ä¸ºåœ¨æ­¤å®ç°æ–¹æ³•ä¸­ï¼Œæ’é™¤äº†é‡æ–°æ ‡è®°ï¼Œå¹¶ä¸”ä¸ºäº†åŠ å¿«é€Ÿåº¦ï¼Œæ‚¨å¯ä»¥åœ¨ç¬¬ä¸€æ¬¡åŒ¹é…åä¸­æ–­è§„åˆ™çš„æšä¸¾ã€‚</i> <br><br> åº”è¯¥è®°ä½ï¼Œæˆ‘ä»¬ä»ç„¶ä¸å¹²æ‰°è·¯ç”±ã€‚ ç°åœ¨åªæœ‰å‡†å¤‡é˜¶æ®µã€‚ å®æ–½çš„ä¸‹ä¸€é˜¶æ®µå°†æ˜¯å¤„ç†ä¼ è¾“æµé‡ï¼Œè¯¥ä¼ è¾“æµé‡æ˜¯é€šè¿‡æœ¬åœ°ç½‘ç»œä¸­æ”¶ä»¶äººçš„ç¨³å®šè¿æ¥è¿”å›çš„ã€‚ å³ é‚£äº›ç©¿è¿‡è·¯ç”±å™¨çš„æ•°æ®åŒ…ï¼ˆè§å›¾ï¼‰ï¼š <br><br>  <b>â€œè¾“å…¥æ¥å£â€ =&gt;â€œé¢„è·¯ç”±â€ =&gt;â€œè·¯ç”±å†³ç­–â€ =&gt;â€œè½¬å‘â€ =&gt;â€œåè·¯ç”±â€ =&gt;â€œè¾“å‡ºæ¥å£â€ï¼Œ</b>å¹¶åˆ°è¾¾æœ¬åœ°ç½‘ç»œä¸Šçš„ç›®çš„åœ°ã€‚ <br><br>  <u><b>é‡è¦ï¼</b></u> åœ¨ROSä¸­ï¼Œæ²¡æœ‰å°†é€»è¾‘åˆ’åˆ†ä¸ºå¤–éƒ¨å’Œå†…éƒ¨æ¥å£ã€‚ å¦‚æœæˆ‘ä»¬åœ¨ä¸‹å›¾ä¸­è·Ÿè¸ªå“åº”æ•°æ®åŒ…çš„è·¯å¾„ï¼Œå®ƒå°†éµå¾ªä¸è¯·æ±‚ç›¸åŒçš„é€»è¾‘è·¯å¾„ï¼š <br><br>  <b>â€œè¾“å…¥æ¥å£â€ =&gt;â€œé¢„è·¯ç”±â€ =&gt;â€œè·¯ç”±å†³ç­–â€ =&gt;â€œè½¬å‘â€ =&gt;â€œåè·¯ç”±â€ =&gt;â€œè¾“å‡ºæ¥å£â€</b>ä»…é’ˆå¯¹è¯·æ±‚â€œ <b>è¾“å…¥æ¥å£</b> â€æœ‰ä¸€ä¸ªISPæ¥å£ï¼Œè€Œç­”æ¡ˆæ˜¯å±€åŸŸç½‘ <br><br>  2.2ã€‚ æˆ‘ä»¬å°†å›ç¨‹è¿è¾“æµé‡å®šå‘åˆ°ç›¸åº”çš„è·¯ç”±è¡¨ï¼š <br><br><pre> <code class="plaintext hljs">/ip firewall mangle add action=mark-routing chain=prerouting \ comment="Routemark transit out via ISP1" connection-mark=conn_isp1 \ dst-address-type=!local in-interface-list=!WAN new-routing-mark=to_isp1 passthrough=no /ip firewall mangle add action=mark-routing chain=prerouting \ comment="Routemark transit out via ISP2" connection-mark=conn_isp2 \ dst-address-type=!local in-interface-list=!WAN new-routing-mark=to_isp2 passthrough=no /ip firewall mangle add action=mark-routing chain=prerouting \ comment="Routemark transit out via ISP3" connection-mark=conn_isp3 \ dst-address-type=!local in-interface-list=!WAN new-routing-mark=to_isp3 passthrough=no</code> </pre> <br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i><b>in-interface-list =ï¼WAN-æˆ‘ä»¬ä»…å¤„ç†æ¥è‡ªæœ¬åœ°ç½‘ç»œå’Œdst-address-type =ï¼localçš„æµé‡ï¼Œè€Œæ²¡æœ‰è·¯ç”±å™¨æœ¬èº«çš„æ¥å£åœ°å€çš„ç›®æ ‡åœ°å€ã€‚</b></i> <i><b><br></b></i> <br><br> å¯¹äºæ²¿é€”åˆ°è¾¾è·¯ç”±å™¨çš„æœ¬åœ°æ•°æ®åŒ…ä¹Ÿæ˜¯å¦‚æ­¤ï¼š <br><br>  <b>â€œè¾“å…¥æ¥å£â€ =&gt;â€œé¢„è·¯ç”±â€ =&gt;â€œè·¯ç”±å†³ç­–â€ =&gt;â€œè¾“å…¥â€ =&gt;â€œæœ¬åœ°è¿‡ç¨‹â€</b> <br><br>  <u><b>é‡è¦ï¼</b></u> ç­”æ¡ˆå°†éµå¾ªä»¥ä¸‹è·¯å¾„ï¼š <br><br>  <b>â€œæœ¬åœ°è¿‡ç¨‹â€ =&gt;â€œè·¯ç”±å†³ç­–â€ =&gt;â€œè¾“å‡ºâ€ =&gt;â€œåè·¯ç”±â€ =&gt;â€œè¾“å‡ºæ¥å£â€</b> <b><br></b> <br>  2.3ã€‚ æˆ‘ä»¬å°†å“åº”æœ¬åœ°æµé‡å®šå‘åˆ°ç›¸åº”çš„è·¯ç”±è¡¨ï¼š <br><br><pre> <code class="plaintext hljs">/ip firewall mangle add action=mark-routing chain=output \ comment="Routemark local out via ISP1" connection-mark=conn_isp1 \ dst-address-type=!local new-routing-mark=to_isp1 passthrough=no /ip firewall mangle add action=mark-routing chain=output \ comment="Routemark local out via ISP2" connection-mark=conn_isp2 \ dst-address-type=!local new-routing-mark=to_isp2 passthrough=no /ip firewall mangle add action=mark-routing chain=output \ comment="Routemark local out via ISP3" connection-mark=conn_isp3 \ dst-address-type=!local new-routing-mark=to_isp3 passthrough=no</code> </pre> <br> åœ¨æ­¤é˜¶æ®µï¼Œå‡†å¤‡å°†å“åº”å‘é€åˆ°è¯·æ±‚æ‰€æ¥è‡ªçš„Interneté€šé“çš„ä»»åŠ¡å¯ä»¥è§†ä¸ºå·²è§£å†³ã€‚ ä¸€åˆ‡éƒ½å·²æ ‡è®°ï¼Œæ ‡è®°å¹¶å‡†å¤‡è·¯ç”±ã€‚ <br> æ­¤é…ç½®çš„ä¸€ä¸ªå‡ºè‰²çš„â€œå‰¯ä½œç”¨â€æ˜¯èƒ½å¤ŸåŒæ—¶è½¬å‘æ¥è‡ªä¸¤ä¸ªï¼ˆISP2ï¼ŒISP3ï¼‰æä¾›å•†çš„DSNATç«¯å£ã€‚ å®Œå…¨æ²¡æœ‰ï¼Œå› ä¸ºåœ¨ISP1ä¸Šæˆ‘ä»¬æ²¡æœ‰å¯è·¯ç”±çš„åœ°å€ã€‚ ä¾‹å¦‚ï¼Œå¯¹äºå…·æœ‰ä¸¤ä¸ªMXä¸”æŸ¥çœ‹ä¸åŒInterneté€šé“çš„é‚®ä»¶æœåŠ¡å™¨ï¼Œæ­¤æ•ˆæœéå¸¸é‡è¦ã€‚ <br><br> ä¸ºäº†æ¶ˆé™¤ä½¿ç”¨å¤–éƒ¨IPè·¯ç”±å™¨å·¥ä½œæœ¬åœ°ç½‘ç»œçš„ç»†å¾®å·®åˆ«ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å„èŠ‚ä¸­çš„è§£å†³æ–¹æ¡ˆã€‚  1.8.2å’Œ3.1.2.6ã€‚ <br><br> æ­¤å¤–ï¼Œæ‚¨å¯ä»¥å°†å·¥å…·ä¸æ ‡è®°ä¸€èµ·ä½¿ç”¨å¹¶è§£å†³é—®é¢˜çš„ç¬¬3æ®µã€‚ æˆ‘ä»¬è¿™æ ·å®ç°ï¼š <br><br>  2.4ã€‚ æˆ‘ä»¬å°†æœ¬åœ°å®¢æˆ·ç«¯çš„æµé‡ä»è·¯ç”±åˆ—è¡¨å®šå‘åˆ°ç›¸åº”çš„è¡¨ï¼š <br><br><pre> <code class="plaintext hljs">/ip firewall mangle add action=mark-routing chain=prerouting \ comment="Address List via ISP1" dst-address-list=!BOGONS new-routing-mark=to_isp1 \ passthrough=no src-address-list=Via_ISP1 /ip firewall mangle add action=mark-routing chain=prerouting \ comment="Address List via ISP2" dst-address-list=!BOGONS new-routing-mark=to_isp2 \ passthrough=no src-address-list=Via_ISP2 /ip firewall mangle add action=mark-routing chain=prerouting \ comment="Address List via ISP3" dst-address-list=!BOGONS new-routing-mark=to_isp3 \ passthrough=no src-address-list=Via_ISP3</code> </pre> <br> ç»“æœï¼Œå®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼ˆå›¾ç‰‡æ˜¯å¯ç‚¹å‡»çš„ï¼‰ï¼š <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/webt/jw/bt/of/jwbtofiohmdeunznqgpnamyuhrm.jpeg"></a> <br><br><h4>  3.é…ç½®ISPè¿æ¥å¹¶å¯ç”¨åŸºäºå“ç‰Œçš„è·¯ç”± </h4><br>  3.1ã€‚ é…ç½®ä¸ISP1çš„è¿æ¥ï¼š <br>  3.1.1ã€‚ é…ç½®é™æ€IPåœ°å€ï¼š <br><br><pre> <code class="plaintext hljs">/ip address add interface=ether1 address=100.66.66.2/30 comment="ISP1 IP"</code> </pre> <br>  3.1.2ã€‚ é…ç½®é™æ€è·¯ç”±ï¼š <br>  3.1.2.1ã€‚ æ·»åŠ é»˜è®¤çš„ç´§æ€¥è·¯çº¿ï¼š <br><br><pre> <code class="plaintext hljs">/ip route add comment="Emergency route" distance=254 type=blackhole</code> </pre> <br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i>è¯¥è·¯ç”±å…è®¸æ¥è‡ªæœ¬åœ°è¿›ç¨‹çš„æµé‡é€šè¿‡â€œè·¯ç”±å†³ç­–â€é˜¶æ®µï¼Œè€Œä¸ç®¡ä»»ä½•æä¾›è€…çš„é€šé“çŠ¶æ€å¦‚ä½•ã€‚</i>  <i>å¤–å‡ºæœ¬åœ°æµé‡çš„ç»†å¾®å·®åˆ«åœ¨äºï¼Œä¸ºäº†ä½¿æ•°æ®åŒ…è‡³å°‘ç§»åŠ¨åˆ°æŸä¸ªåœ°æ–¹ï¼Œåˆ°é»˜è®¤ç½‘å…³çš„æ´»åŠ¨è·¯ç”±å¿…é¡»å­˜åœ¨äºä¸»è·¯ç”±è¡¨ä¸­ã€‚</i>  <i>å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆåŒ…è£…å°†è¢«ç®€å•åœ°é”€æ¯ã€‚</i> <br><br> ä½œä¸º<b>æ£€æŸ¥ç½‘å…³</b>å·¥å…·çš„æ‰©å±•ï¼Œ <b>å¯ä»¥</b>å¯¹é€šé“çŠ¶æ€è¿›è¡Œæ›´æ·±å…¥çš„åˆ†æï¼Œæˆ‘å»ºè®®ä½¿ç”¨é€’å½’è·¯ç”±æ–¹æ³•ã€‚ è¯¥æ–¹æ³•çš„æœ¬è´¨æ˜¯ï¼Œæˆ‘ä»¬å‘Šè¯‰è·¯ç”±å™¨ä¸ç›´æ¥è€Œæ˜¯é€šè¿‡ä¸­é—´ç½‘å…³æœç´¢é€šå¾€å…¶ç½‘å…³çš„è·¯å¾„ã€‚ ä½œä¸ºæ­¤ç±»â€œæµ‹è¯•â€ç½‘å…³ï¼Œå°†åˆ†åˆ«ä¸ºISP1ï¼ŒISP2å’ŒISP3é€‰æ‹©4.2.2.1ã€4.2.2.2å’Œ4.2.2.3ã€‚ <br><br>  3.1.2.2ã€‚ è½¬åˆ°â€œéªŒè¯â€åœ°å€ï¼š <br><br><pre> <code class="plaintext hljs">/ip route add check-gateway=ping comment="For recursion via ISP1" \ distance=1 dst-address=4.2.2.1 gateway=100.66.66.1 scope=10</code> </pre> <br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i>ä½œç”¨åŸŸå€¼åœ¨ROSç›®æ ‡ä½œç”¨åŸŸä¸­å‡å°ä¸ºé»˜è®¤å€¼ï¼Œä»¥ä¾¿è¿›ä¸€æ­¥ä½¿ç”¨4.2.2.1ä½œä¸ºé€’å½’ç½‘å…³ã€‚</i>  <i>æˆ‘å¼ºè°ƒï¼šåˆ°è¾¾â€œéªŒè¯â€åœ°å€çš„è·¯ç”±èŒƒå›´åº”å°äºæˆ–ç­‰äºå¼•ç”¨éªŒè¯çš„è·¯ç”±ç›®æ ‡èŒƒå›´ã€‚</i> <br><br>  3.1.2.3ã€‚ ä¸å¸¦è·¯ç”±æ ‡è®°çš„æµé‡çš„é»˜è®¤é€’å½’è·¯ç”±ï¼š <br><br><pre> <code class="plaintext hljs">/ip route add check-gateway=ping comment="Unmarked via ISP1" \ distance=2 gateway=4.2.2.1</code> </pre> <br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i>ä½¿ç”¨è·ç¦»= 2çš„å€¼æ˜¯å› ä¸ºæ ¹æ®ä»»åŠ¡æ¡æ¬¾ï¼ŒISP1è¢«å£°æ˜ä¸ºç¬¬ä¸€ä¸ªå¤‡ç”¨æ•°æ®åº“ã€‚</i> <br><br>  3.1.2.4ã€‚ è·¯ç”±æ ‡è®°ä¸ºâ€œ to_isp1â€çš„æµé‡çš„é»˜è®¤é€’å½’è·¯ç”±ï¼š <br><br><pre> <code class="plaintext hljs">/ip route add comment="Marked via ISP1 Main" distance=1 gateway=4.2.2.1 \ routing-mark=to_isp1</code> </pre> <br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i>å®é™…ä¸Šï¼Œæˆ‘ä»¬ç»ˆäºåœ¨è¿™é‡Œå¼€å§‹ä½¿ç”¨ç¬¬2æ®µä¸­è¿›è¡Œçš„å‡†å¤‡å·¥ä½œçš„æˆæœã€‚</i> <i><br><br></i>  <i>åœ¨æ­¤è·¯ç”±ä¸Šï¼Œæ‰€æœ‰æ ‡è®°ä¸ºâ€œ to_isp1â€è·¯ç”±çš„æµé‡éƒ½å°†å®šå‘åˆ°ç¬¬ä¸€ä¸ªæä¾›ç¨‹åºçš„ç½‘å…³ï¼Œè€Œä¸ç®¡ä¸»è¡¨çš„é»˜è®¤ç½‘å…³å½“å‰å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚</i> <br><br>  3.1.2.5ã€‚ æ¥è‡ªISP2å’ŒISP3æä¾›è€…çš„å¸¦æ ‡è®°æµé‡çš„ç¬¬ä¸€ä¸ªåå¤‡é»˜è®¤é€’å½’è·¯ç”±ï¼š <br><br><pre> <code class="plaintext hljs">/ip route add comment="Marked via ISP2 Backup1" distance=2 gateway=4.2.2.1 \ routing-mark=to_isp2 /ip route add comment="Marked via ISP3 Backup1" distance=2 gateway=4.2.2.1 \ routing-mark=to_isp3</code> </pre> <br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i>ä»æœ¬åœ°ç½‘ç»œä¿ç•™æµé‡ä¹Ÿéœ€è¦è¿™äº›è·¯ç”±ï¼Œæœ¬åœ°ç½‘ç»œæ˜¯åœ°å€åˆ—è¡¨â€œ to_isp *â€çš„æˆå‘˜</i> <br><br>  3.1.2.6ã€‚ æˆ‘ä»¬ç¼–å†™é€šè¿‡ISP1åˆ°Internetçš„æœ¬åœ°è·¯ç”±å™¨æµé‡çš„è·¯ç”±ï¼š <br><br><pre> <code class="plaintext hljs">/ip route rule add comment="From ISP1 IP to Inet" src-address=100.66.66.2 table=to_isp1</code> </pre> <br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i>ç»“åˆç¬¬1.8.2èŠ‚ä¸­çš„è§„åˆ™ï¼Œæä¾›äº†å…·æœ‰ç»™å®šæºçš„æ‰€éœ€é€šé“çš„å‡ºå£ã€‚</i>  <i>è¿™å¯¹äºæŒ‡å®šæœ¬åœ°IPåœ°å€ï¼ˆEoIPï¼ŒIP-IPï¼ŒGREï¼‰çš„éš§é“çš„å»ºè®¾è‡³å…³é‡è¦ã€‚</i>  <i>ç”±äºip routeè§„åˆ™ä¸­çš„è§„åˆ™æ˜¯ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œçš„ï¼Œç›´åˆ°æ¡ä»¶é¦–æ¬¡åŒ¹é…æ—¶ï¼Œæ­¤è§„åˆ™åº”åœ¨ç¬¬1.8.2èŠ‚ä¸­çš„è§„åˆ™ä¹‹åã€‚</i> <br><br>  3.1.3ã€‚ æˆ‘ä»¬ä¸ºä¼ å‡ºæµé‡ç¼–å†™NATè§„åˆ™ï¼š <br><br><pre> <code class="plaintext hljs">/ip firewall nat add action=src-nat chain=srcnat comment="NAT via ISP1" \ ipsec-policy=out,none out-interface=ether1 to-addresses=100.66.66.2</code> </pre> <br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i>é™¤äº†å®ƒå±äºIPsecç­–ç•¥å¤–ï¼ŒNATå°±æ˜¯ä¸€åˆ‡ã€‚</i>  <i>é™¤éç»å¯¹å¿…è¦ï¼Œå¦åˆ™æˆ‘å°½é‡ä¸è¦ä½¿ç”¨action = masqueradeã€‚</i>  <i>å®ƒæ¯”src-naté€Ÿåº¦æ…¢ä¸”èµ„æºå ç”¨å¤§ï¼Œå› ä¸ºå®ƒä¼šä¸ºæ¯ä¸ªæ–°è¿æ¥è®¡ç®—NATåœ°å€ã€‚</i> <br><br>  3.1.4ã€‚ æˆ‘ä»¬å°†ä»åˆ—è¡¨ä¸­å°†ç¦æ­¢é€šè¿‡å…¶ä»–æä¾›ç¨‹åºé€€å‡ºçš„å®¢æˆ·ç«¯ç›´æ¥å‘é€åˆ°ISP1æä¾›ç¨‹åºç½‘å…³ã€‚ <br><br><pre> <code class="plaintext hljs">/ip firewall mangle add action=route chain=prerouting \ comment="Address List via ISP1 only" dst-address-list=!BOGONS passthrough=no \ route-dst=100.66.66.1 src-address-list=Via_only_ISP1 place-before=0</code> </pre> <br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i>action =è·¯ç”±å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œå¹¶ä¸”æ¯”å…¶ä»–è·¯ç”±è§„åˆ™æ›´æ—©åœ°åº”ç”¨ã€‚</i> <i><br><br></i>  <i>place-before = 0-å°†æˆ‘ä»¬çš„è§„åˆ™æ”¾åœ¨åˆ—è¡¨çš„ç¬¬ä¸€ä½ã€‚</i> <br><br>  3.2ã€‚ æˆ‘ä»¬é…ç½®åˆ°ISP2çš„è¿æ¥ã€‚ <br><br> ç”±äºISP2æä¾›ç¨‹åºé€šè¿‡DHCPä¸ºæˆ‘ä»¬æä¾›è®¾ç½®ï¼Œå› æ­¤åˆç†çš„åšæ³•æ˜¯ä½¿ç”¨è§¦å‘DHCPå®¢æˆ·ç«¯æ—¶å¯åŠ¨çš„è„šæœ¬è¿›è¡Œå¿…è¦çš„æ›´æ”¹ï¼š <br><br><pre> <code class="plaintext hljs">/ip dhcp-client add add-default-route=no disabled=no interface=ether2 script=":if (\$bound=1) do={\r\ \n /ip route remove [ find gateway=\"4.2.2.2\" ]; /ip route remove \ [ find where dst-address ~\"4.2.2.2\" ]\r\ \n /ip route add check-gateway=ping comment=\"For recursion via ISP2\" \ distance=1 dst-address=4.2.2.2/32 gateway=\$\"gateway-address\" scope=10\r\ \n /ip route add check-gateway=ping comment=\"Unmarked via ISP2\" \ distance=1 gateway=4.2.2.2\r\ \n /ip route add comment=\"Marked via ISP2 Main\" distance=1 gateway=4.2.2.2 \ routing-mark=to_isp2\r\ \n /ip route add comment=\"Marked via ISP1 Backup1\" distance=2 \ gateway=4.2.2.2 routing-mark=to_isp1\r\ \n /ip route add comment=\"Marked via ISP3 Backup2\" distance=3 \ gateway=4.2.2.2 routing-mark=to_isp3\r\ \n /ip firewall nat add action=src-nat chain=srcnat ipsec-policy=out,none \ out-interface=\$\"interface\" to-addresses=\$\"lease-address\" \ comment=\"NAT via ISP2\"\r\ \n /ip route rule add comment=\"From ISP2 IP to Inet\" \ src-address=\$\"lease-address\" table=to_isp2 \r\ \n} else={\r\ \n /ip route remove [ find gateway=\"4.2.2.2\" ]; /ip route remove \ [ find where dst-address ~\"4.2.2.2\" ]\r\ \n /ip firewall nat remove [find comment=\"NAT via ISP2\"]\r\ \n /ip route rule remove [find comment=\"From ISP2 IP to Inet\"]\r\ \n}\r\ \n" use-peer-dns=no use-peer-ntp=no</code> </pre> <br>  Winboxçª—å£ä¸­çš„è„šæœ¬æœ¬èº«ï¼ˆå¯å•å‡»ï¼‰ï¼š <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/webt/dz/_f/hh/dz_fhhyltpdet5oush5wqwpud2e.jpeg"></a> <br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i>è„šæœ¬çš„ç¬¬ä¸€éƒ¨åˆ†åœ¨æˆåŠŸæ”¶åˆ°ç§Ÿçº¦æ—¶è§¦å‘ï¼Œç¬¬äºŒéƒ¨åˆ†-é‡Šæ”¾ç§Ÿçº¦åè§¦å‘ã€‚</i>  <sup>è§æ³¨2</sup> <br><br>  3.3ã€‚ æˆ‘ä»¬é…ç½®åˆ°ISP3æä¾›ç¨‹åºçš„è¿æ¥ã€‚ <br><br> ç”±äºé…ç½®æä¾›ç¨‹åºä½¿æˆ‘ä»¬å…·æœ‰åŠ¨æ€æ€§ï¼Œå› æ­¤å¯ä»¥åˆç†åœ°å¯¹è„šæœ¬è¿›è¡Œå¿…è¦çš„æ›´æ”¹ï¼Œè¿™äº›è„šæœ¬åœ¨pppæ¥å£çš„ä¸Šå‡å’Œä¸‹é™ä¹‹åå¼€å§‹ã€‚ <br><br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i>å¯ä»¥å°†pppæ¥å£æŒ‡å®šä¸ºç½‘å…³ï¼Œè€Œä¸æ˜¯IPåœ°å€ã€‚</i>  <i>ä½†æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ— æ³•æ¿€æ´»é€’å½’è·¯ç”±ã€‚</i>  <i>å› æ­¤ï¼Œæˆ‘ä»¬å°†æä¾›è€…ç«¯çš„IPåœ°å€æ”¾å…¥å˜é‡ä¸­ï¼Œå¹¶ä»¥ä¸å…¶ä»–æä¾›è€…ç›¸åŒçš„æ–¹å¼è¿›ä¸€æ­¥ä½¿ç”¨å®ƒ</i> <br><br>  3.3.1ã€‚ é¦–å…ˆï¼Œé…ç½®é…ç½®æ–‡ä»¶ï¼š <br><br><pre> <code class="plaintext hljs">/ppp profile add comment="for PPPoE to ISP3" interface-list=WAN name=isp3_client \ on-down="/ip route remove [ find gateway=\"4.2.2.3\" ]\r\ \n/ip route remove [ find where dst-address ~\"4.2.2.3\" ]\r\ \n/ip firewall nat remove [find comment=\"NAT via ISP3\"]\r\ \n/ip route rule remove [find comment=\"From ISP3 IP to Inet\"]" \ on-up="/ip route remove [ find gateway=\"4.2.2.3\" ]; /ip route remove \ [ find where dst-address ~\"4.2.2.3\" ]\r\ \n/ip route add check-gateway=ping comment=\"For recursion via ISP3\" distance=1 \ dst-address=4.2.2.3/32 gateway=\$\"remote-address\" scope=10\r\ \n/ip route add check-gateway=ping comment=\"Unmarked via ISP3\" distance=3 \ gateway=4.2.2.3\r\ \n/ip route add comment=\"Marked via ISP3 Main\" distance=1 gateway=4.2.2.3 \ routing-mark=to_isp3\r\ \n/ip route add comment=\"Marked via ISP1 Backup2\" distance=3 gateway=4.2.2.3 \ routing-mark=to_isp1\r\ \n/ip route add comment=\"Marked via ISP2 Backup2\" distance=3 gateway=4.2.2.3 \ routing-mark=to_isp2\r\ \n/ip firewall mangle set [find comment=\"Connmark in from ISP3\"] \ in-interface=\$\"interface\"\r\ \n/ip firewall nat add action=src-nat chain=srcnat ipsec-policy=out,none \ out-interface=\$\"interface\" to-addresses=\$\"local-address\" \ comment=\"NAT via ISP3\"\r\ \n/ip route rule add comment=\"From ISP3 IP to Inet\" \ src-address=\$\"local-address\" table=to_isp3 "</code> </pre><br>  Winboxçª—å£ä¸­çš„è„šæœ¬æœ¬èº«ï¼ˆå¯å•å‡»ï¼‰ï¼š <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/webt/oz/tz/it/oztzitzzxgl5jz0g9jxskvtf3us.jpeg"></a> <br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i>å¼¦ä¹</i> <i><br></i>  <i><b>/ ipé˜²ç«å¢™mangleè®¾ç½®[æŸ¥æ‰¾æ³¨é‡Š=â€œä»ISP3ä¸­çš„è¿æ¥æ ‡è®°â€] in-interface = $â€œ interfaceâ€;</b></i> <i><br></i>  <i>å…è®¸æ‚¨æ­£ç¡®å¤„ç†æ¥å£çš„é‡å‘½åï¼Œå› ä¸ºå®ƒä½¿ç”¨å…¶ä»£ç è€Œä¸æ˜¯æ˜¾ç¤ºåç§°ã€‚</i> <br><br>  3.3.2ã€‚ ç°åœ¨ï¼Œä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œåˆ›å»ºä¸€ä¸ªpppè¿æ¥ï¼š <br><br><pre> <code class="plaintext hljs">/interface pppoe-client add allow=mschap2 comment="to ISP3" disabled=no \ interface=ether3 name=pppoe-isp3 password=isp3_pass profile=isp3_client \ user=isp3_client</code> </pre> <br><br>  <i><b>å¤‡æ³¨ã€‚</b></i>  <i>ä¸€äº›æä¾›ç¨‹åºâ€œå¿˜è®°â€æä¾›â€œè¿œç¨‹åœ°å€â€å‚æ•°ã€‚</i>  <i>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿æ¥åï¼Œé…ç½®è„šæœ¬å°†æ— æ³•æ­£å¸¸å·¥ä½œï¼Œå¹¶ä¸”åœ¨æ—¥å¿—ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°ä»¥ä¸‹é”™è¯¯ï¼š</i> <i><br></i>  <i>pppoeï¼Œpppï¼Œä¿¡æ¯pppoe-isp3ï¼šæ— æ³•ç¡®å®šè¿œç¨‹åœ°å€ï¼Œä½¿ç”¨xxx.xxx.xxx.xxx</i> <i><br></i>  <i>è¦è§£å†³æ­¤é—®é¢˜ï¼Œæ‚¨éœ€è¦åœ¨pppé…ç½®æ–‡ä»¶ä¸­æ‰‹åŠ¨è®¾ç½®åœ°å€ï¼ˆä»»ä½•è™šæ‹Ÿï¼‰ï¼š</i> <i><br></i> <pre> <i><code class="plaintext hljs">/ppp profile set isp3_client remote-address=169.254.69.96</code></i> </pre> <i><br></i>  <i>å¼¦ä¹</i> <i><br></i>  <i><b>/ ipé˜²ç«å¢™mangleè®¾ç½®[æŸ¥æ‰¾æ³¨é‡Š=â€œä»ISP3ä¸­çš„è¿æ¥æ ‡è®°â€] in-interface = $â€œ interfaceâ€;</b></i> <i><br></i>  <i>å…è®¸æ‚¨æ­£ç¡®å¤„ç†æ¥å£çš„é‡å‘½åï¼Œå› ä¸ºå®ƒä½¿ç”¨å…¶ä»£ç è€Œä¸æ˜¯æ˜¾ç¤ºåç§°ã€‚</i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æœ€åï¼Œè®¾ç½®æ—¶é’Ÿï¼š </font></font><br><br><pre> <code class="plaintext hljs">/system ntp client set enabled=yes \ server-dns-names=0.pool.ntp.org,1.pool.ntp.org,2.pool.ntp.org</code> </pre> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¯¹äºé‚£äº›è¯»åˆ°æœ€åçš„äºº </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æå‡ºçš„å®æ–½å¤šå¢è´§è½¦çš„æ–¹æ³•æ˜¯ä½œè€…çš„ä¸ªäººå–œå¥½ï¼Œå¹¶éå”¯ä¸€å¯è¡Œçš„æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">ROSå·¥å…·åŒ…å…·æœ‰å¹¿æ³›è€Œçµæ´»çš„ç‰¹æ€§ï¼Œä¸€æ–¹é¢ç»™åˆå­¦è€…å¸¦æ¥äº†å›°éš¾ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿä¸ºæ™®åŠæä¾›äº†ç†ç”±ã€‚</font><font style="vertical-align: inherit;">æ¢ç´¢ï¼Œå°è¯•ï¼Œå‘ç°æ–°çš„å·¥å…·å’Œè§£å†³æ–¹æ¡ˆã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œä½œä¸ºæ‰€å­¦çŸ¥è¯†çš„åº”ç”¨ï¼Œåœ¨è¿™ç§å¤š</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¢è´§è½¦çš„</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®æ–½ä¸­ï¼Œæœ‰å¯èƒ½</font><font style="vertical-align: inherit;">ç”¨</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Netwatchçš„</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€’å½’è·¯ç”±</font><font style="vertical-align: inherit;">æ›¿æ¢</font><b><font style="vertical-align: inherit;">check-gateway</font></b><font style="vertical-align: inherit;">å·¥å…·</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ³¨æ„äº‹é¡¹ </font></font></h4><br><ol><li> <i><b>Check-gateway</b> â€” ,             .     10 ,   . ,       20-30 .       â€”     <b>Netwatch</b> ,      . <br>  <b>Check-gateway</b>        . <br><br> <u><b>!</b></u>          ,    .     <b>check-gateway=ping</b>  .</i> </li><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¢°å·§DHPæ“ä½œæœºåˆ¶å‘ç”Ÿæ•…éšœï¼Œè¿™çœ‹èµ·æ¥åƒå®¢æˆ·ç«¯å¤„äºç»­è®¢çŠ¶æ€ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè„šæœ¬çš„ç¬¬äºŒéƒ¨åˆ†å°†æ— æ³•å·¥ä½œï¼Œä½†æ˜¯æµé‡ä¸ä¼šæŸå®³æ­£å¸¸è¡Œèµ°ï¼Œå› ä¸ºçŠ¶æ€ä¼šç›‘è§†ç›¸åº”çš„é€’å½’è·¯ç”±ã€‚</font></font></i> </li><li> <i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ECMPï¼ˆç­‰ä»·å¤šè·¯å¾„ï¼‰</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -ROSèƒ½å¤ŸæŒ‡å®šå…·æœ‰å¤šä¸ªç½‘å…³ä¸”è·ç¦»ç›¸åŒçš„è·¯ç”±ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†ä½¿ç”¨å¾ªç¯ç®—æ³•æ ¹æ®æŒ‡å®šç½‘å…³çš„æ•°é‡å°†è¿æ¥åˆ†å¸ƒåœ¨é€šé“ä¸Šã€‚</font></font></i> </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†æ¨åŠ¨æ’°å†™æœ¬æ–‡ï¼Œè¯·å¸®åŠ©å¡‘é€ æ–‡ç« çš„ç»“æ„å¹¶å¼ºè°ƒé‡ç‚¹-æ„Ÿè°¢Eugene </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@jscar</font></font></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN463813/">https://habr.com/ru/post/zh-CN463813/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN463799/index.html">æˆ‘å¯¹Windows 10ä¸æ»¡æ„çš„åœ°æ–¹</a></li>
<li><a href="../zh-CN463801/index.html">æˆåŠŸçš„äº§å“ç»ç†çš„ä¸‰é¡¹å…³é”®ç´ è´¨ï¼šAnton Stozhko</a></li>
<li><a href="../zh-CN463803/index.html">æˆ‘ä¸Haikuçš„ç¬¬äº”å¤©ï¼šè®©æˆ‘ä»¬ç§»æ¤ä¸€äº›ç¨‹åº</a></li>
<li><a href="../zh-CN463805/index.html">æƒ³è¦æˆä¸ºæ¸¸æˆè®¾è®¡å¸ˆçš„ä¸ƒæœ¬ä¹¦</a></li>
<li><a href="../zh-CN463811/index.html">ä¸ºAndroid Qå‡†å¤‡åº”ç”¨ç¨‹åºã€‚ç¬¬1éƒ¨åˆ†</a></li>
<li><a href="../zh-CN463815/index.html">ä¸ºä»€ä¹ˆå¤–å›½é“¶è¡Œå¯¹æ‚¨çš„èµ„é‡‘æ¥æºæ„Ÿå…´è¶£ï¼Ÿ</a></li>
<li><a href="../zh-CN463817/index.html">20ä½äº§å“ç»ç†å’Œæ‰€æœ‰æœ€å¤šçš„å¤šç»´çŸ©é˜µç»“æ„ã€‚ ä¸Skyengçš„å¯¹è¯</a></li>
<li><a href="../zh-CN463819/index.html">PostgreSQLé”ï¼š2.å­—ç¬¦ä¸²é”</a></li>
<li><a href="../zh-CN463821/index.html">AMOï¼ŒBitrixï¼Œ1Cç­‰ï¼šå¦‚ä½•é€‰æ‹©ä»å“ªé‡Œå¼€å§‹ï¼Ÿ</a></li>
<li><a href="../zh-CN463823/index.html">Rust 1.37.0ç‰ˆæœ¬ï¼šé…ç½®æ–‡ä»¶å¼•å¯¼çš„ä¼˜åŒ–ï¼Œæœªå‘½åçš„å¸¸é‡å’Œè´§ç‰©ä¾›åº”å•†</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>