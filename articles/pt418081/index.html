<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•´ üë∏üèº üçû Organiza√ß√£o de testes seguros na produ√ß√£o. Parte 1 üöµüèº üôéüèΩ ü¶â</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este artigo discute v√°rios tipos de testes em produ√ß√£o e as condi√ß√µes sob as quais cada um deles √© mais √∫til e tamb√©m descreve como organizar testes s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Organiza√ß√£o de testes seguros na produ√ß√£o. Parte 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/funcorp/blog/418081/"><img src="https://habrastorage.org/webt/0q/az/yt/0qazyteu8a-cel_dnpcbmyckzsk.jpeg"><br><br>  Este artigo discute v√°rios tipos de testes em produ√ß√£o e as condi√ß√µes sob as quais cada um deles √© mais √∫til e tamb√©m descreve como organizar testes seguros de v√°rios servi√ßos em produ√ß√£o. <a name="habracut"></a><br><br>  Vale ressaltar que o conte√∫do deste artigo se aplica somente a esses <b>servi√ßos</b> , cuja implanta√ß√£o √© controlada pelos desenvolvedores.  Al√©m disso, voc√™ deve avisar imediatamente que o uso de qualquer um dos tipos de testes descritos aqui n√£o √© uma tarefa f√°cil, que geralmente requer altera√ß√µes s√©rias no design, desenvolvimento e teste de sistemas.  E, apesar do t√≠tulo do artigo, n√£o acho que nenhum dos tipos de teste em produ√ß√£o seja absolutamente confi√°vel.  Existe apenas uma opini√£o de que esses testes podem reduzir significativamente o n√≠vel de riscos no futuro, e os custos de investimento ser√£o justificados. <br><br>  <i><b>(Nota: como o artigo original √© Longrid, para conveni√™ncia dos leitores, √© dividido em duas partes).</b></i> <br><br><h2>  Por que o teste de produ√ß√£o √© necess√°rio se pode ser feito na prepara√ß√£o? </h2><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="974530841190608897"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  A import√¢ncia do cluster de prepara√ß√£o (ou ambiente de prepara√ß√£o) por diferentes pessoas √© percebida de maneira diferente.  Para muitas empresas, a implanta√ß√£o e o teste de um produto no preparo s√£o um est√°gio integral que antecede seu lan√ßamento final. <br><br>  Muitas organiza√ß√µes conhecidas percebem a prepara√ß√£o como uma c√≥pia em miniatura do ambiente de trabalho.  Nesses casos, √© necess√°rio garantir a sincroniza√ß√£o m√°xima.  Nesse caso, geralmente √© necess√°rio garantir a opera√ß√£o de diferentes inst√¢ncias de sistemas com estado, como bancos de dados, e sincronizar regularmente os dados do ambiente de produ√ß√£o com a prepara√ß√£o.  A exce√ß√£o s√£o apenas informa√ß√µes confidenciais que permitem estabelecer a identidade do usu√°rio (isso √© necess√°rio para atender aos requisitos do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GDPR</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PCI</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">HIPAA</a> e outros regulamentos). <br><br>  O problema com essa abordagem (na minha experi√™ncia) √© que a diferen√ßa n√£o est√° apenas no uso de uma inst√¢ncia separada do banco de dados que cont√©m os dados reais do ambiente de produ√ß√£o.  Muitas vezes, a diferen√ßa se estende aos seguintes aspectos: <br><br><ul><li>  O tamanho do cluster de armazenamento tempor√°rio (se voc√™ pode cham√°-lo de "cluster" - √†s vezes, √© apenas um servidor disfar√ßado de cluster); </li><li>  O fato de a prepara√ß√£o geralmente usar um cluster muito menor tamb√©m significa que as defini√ß√µes de configura√ß√£o para quase <i>todos os</i> servi√ßos variam.  Isso se aplica a configura√ß√µes de balanceadores de carga, bancos de dados e filas, por exemplo, o n√∫mero de descritores de arquivos abertos, o n√∫mero de conex√µes de bancos de dados abertos, o tamanho do conjunto de encadeamentos, etc. Se a configura√ß√£o estiver armazenada em um banco de dados ou em um armazenamento de dados com valor-chave (por exemplo, Zookeeper ou Consul), esses sistemas auxiliares tamb√©m devem estar presentes no ambiente de prepara√ß√£o; </li><li>  O n√∫mero de conex√µes online processadas pelo servi√ßo sem estado ou o m√©todo de reutiliza√ß√£o de conex√µes TCP por um servidor proxy (se este procedimento for realizado); </li><li>  Falta de monitoramento na prepara√ß√£o.  Mas, mesmo que o monitoramento seja realizado, alguns sinais podem se mostrar completamente imprecisos, pois um ambiente diferente daquele em funcionamento √© monitorado.  Por exemplo, mesmo se voc√™ monitorar a lat√™ncia da consulta MySQL ou o tempo de resposta, √© dif√≠cil determinar se o novo c√≥digo cont√©m uma consulta que pode iniciar uma verifica√ß√£o completa da tabela no MySQL, j√° que √© <i>muito</i> mais r√°pido (e √†s vezes at√© prefer√≠vel) executar uma verifica√ß√£o completa da pequena tabela usada no teste um banco de dados em vez de um banco de dados de produ√ß√£o, em que uma consulta pode ter um perfil de desempenho completamente diferente. </li></ul><br>  Embora seja justo supor que todas as diferen√ßas acima n√£o sejam argumentos s√©rios contra o uso da prepara√ß√£o como tal, diferentemente dos antipadr√µes que devem ser evitados.  Ao mesmo tempo, o desejo de fazer tudo certo muitas vezes exige os enormes custos de m√£o-de-obra dos engenheiros na tentativa de garantir um ambiente consistente.  A produ√ß√£o est√° constantemente mudando e √© influenciada por v√°rios fatores, portanto, tentar alcan√ßar essa combina√ß√£o √© como ir a lugar nenhum. <br><br>  Al√©m disso, mesmo que as condi√ß√µes no preparo sejam o mais semelhante poss√≠vel ao ambiente de trabalho, existem outros tipos de teste que s√£o melhores para usar com base em informa√ß√µes reais de produ√ß√£o.  Um bom exemplo seria o teste de imers√£o, no qual a confiabilidade e a estabilidade de um servi√ßo s√£o testadas por um longo per√≠odo de tempo em n√≠veis reais de multitarefa e carga.  √â usado para detectar vazamentos de mem√≥ria, determinar a dura√ß√£o das pausas no GC, o n√≠vel de carga do processador e outros indicadores por um determinado per√≠odo de tempo. <br><br>  Nenhuma das op√ß√µes acima sugere que a prepara√ß√£o √© <i>completamente</i> in√∫til (isso se tornar√° aparente ap√≥s a leitura da se√ß√£o sobre duplica√ß√£o de sombra de dados ao testar servi√ßos).  Isso indica apenas que muitas vezes eles dependem da prepara√ß√£o em maior extens√£o do que o necess√°rio e, em muitas organiza√ß√µes, continua sendo o <i>√∫nico</i> tipo de teste executado antes da libera√ß√£o completa do produto. <br><br><h2>  A arte de testar em produ√ß√£o </h2><br>  Aconteceu historicamente que o conceito de "teste em produ√ß√£o" est√° associado a certos estere√≥tipos e conota√ß√µes negativas ("programa√ß√£o de guerrilha", falta ou aus√™ncia de testes de unidade e integra√ß√£o, neglig√™ncia ou desaten√ß√£o √† percep√ß√£o do produto pelo usu√°rio final). <br><br>  Os testes de produ√ß√£o certamente merecer√£o tal reputa√ß√£o se forem realizados de maneira descuidada e ruim.  Ele <i>n√£o substitui de</i> forma alguma os testes na fase de pr√©-produ√ß√£o e, sob nenhuma circunst√¢ncia, √© uma <i>tarefa simples</i> .  Al√©m disso, defendo que os testes <i>bem</i> - <i>sucedidos</i> e <i>seguros</i> na produ√ß√£o requerem um n√≠vel significativo de automa√ß√£o, uma boa compreens√£o das pr√°ticas estabelecidas e o design de sistemas com uma orienta√ß√£o inicial para esse tipo de teste. <br><br>  Para organizar um processo abrangente e seguro de teste eficaz dos servi√ßos em produ√ß√£o, √© importante n√£o consider√°-lo um termo generalizado que denota um conjunto de diferentes ferramentas e t√©cnicas.  Infelizmente, esse erro tamb√©m foi cometido por mim - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no meu artigo anterior,</a> n√£o foi apresentada uma classifica√ß√£o cient√≠fica dos m√©todos de teste e, na se√ß√£o "Testes em produ√ß√£o", v√°rias metodologias e ferramentas foram agrupadas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2h/bo/od/2hboodum_vrej99d2xm911ifecw.png"></div><br>  <i>Na nota Testando microsservi√ßos, o caminho s√£o ("Uma abordagem inteligente para testar microsservi√ßos")</i> <br><br>  Desde a publica√ß√£o da nota no final de dezembro de 2017, discuti seu conte√∫do e, geralmente, o t√≥pico de testes em produ√ß√£o com v√°rias pessoas. <br><br>  No decorrer dessas discuss√µes, e tamb√©m ap√≥s uma s√©rie de conversas separadas, ficou claro para mim que o t√≥pico de teste em produ√ß√£o n√£o pode ser reduzido a v√°rios pontos listados acima. <br><br>  O conceito de "teste em produ√ß√£o" inclui toda uma gama de t√©cnicas aplicadas <i>em tr√™s est√°gios diferentes</i> .  Quais - vamos entender. <br><br><img src="https://habrastorage.org/webt/6a/wc/5-/6awc5-yiregc_-2pzrk4i7gjxx0.jpeg"><br><br><h2>  Tr√™s est√°gios de produ√ß√£o </h2><br>  Geralmente, as discuss√µes sobre produ√ß√£o s√£o conduzidas apenas no contexto da implanta√ß√£o de c√≥digo na produ√ß√£o, no monitoramento ou em situa√ß√µes de emerg√™ncia quando algo d√° errado. <br><br>  At√© agora, eu mesmo utilizei termos como "implanta√ß√£o", "libera√ß√£o", "entrega" etc., como sin√¥nimos, com pouco pensamento sobre seu significado.  Alguns meses atr√°s, todas as tentativas de distinguir esses termos seriam rejeitadas por mim como algo insignificante. <br>  Depois de pensar nisso, cheguei √† ideia de que <i>h√° uma</i> necessidade real de distinguir entre as v√°rias etapas da produ√ß√£o. <br><br><h3>  Etapa 1. Implanta√ß√£o </h3><br>  Quando o teste (mesmo em produ√ß√£o) √© uma verifica√ß√£o da obten√ß√£o dos <i>melhores indicadores poss√≠veis</i> , a precis√£o do teste (e, de fato, de qualquer verifica√ß√£o) √© garantida apenas com a condi√ß√£o de que o m√©todo de execu√ß√£o dos testes seja o mais pr√≥ximo poss√≠vel da maneira como o servi√ßo √© realmente usado na produ√ß√£o. <br><br>  Em outras palavras, os testes precisam ser executados em um ambiente que <i>melhor simule um ambiente de trabalho</i> . <br><br>  E a <i>melhor imita√ß√£o do</i> ambiente de trabalho √© ... o pr√≥prio ambiente de trabalho.  Para executar o n√∫mero m√°ximo poss√≠vel de testes em um ambiente de produ√ß√£o, √© necess√°rio que o resultado malsucedido de qualquer um deles n√£o afete o usu√°rio final. <br><br>  Isso, por sua vez, √© poss√≠vel apenas se, <b>ao implantar o servi√ßo em um ambiente de produ√ß√£o, os usu√°rios n√£o obtiverem acesso direto a esse servi√ßo</b> . <br><br>  Neste artigo, decidi usar a terminologia do artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Deploy! = Release</a> escrito por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Turbine Labs</a> .  Ele define o termo "implanta√ß√£o" da seguinte maneira: <br><br>  ‚ÄúA implanta√ß√£o √© a instala√ß√£o por um grupo de trabalho de uma nova vers√£o do c√≥digo do programa de servi√ßo na infraestrutura de produ√ß√£o.  Quando dizemos que uma nova vers√£o do software foi <b>implantada</b> , queremos dizer que ele roda em algum lugar dentro da estrutura da infraestrutura de trabalho.  Pode ser uma nova inst√¢ncia do EC2 na AWS ou um cont√™iner do Docker em execu√ß√£o no cora√ß√£o de um cluster Kubernetes.  O servi√ßo foi iniciado com √™xito, passou em uma verifica√ß√£o de integridade e est√° pronto (voc√™ espera!) Para processar dados do ambiente de produ√ß√£o, mas na verdade pode n√£o receber dados.  Este √© um ponto importante, enfatizo novamente: <b>para implanta√ß√£o, n√£o √© necess√°rio que os usu√°rios obtenham acesso √† nova vers√£o do seu servi√ßo</b> .  Dada essa defini√ß√£o, a implanta√ß√£o pode ser chamada de processo com risco quase zero. ‚Äù <br><br>  As palavras "processo de risco zero" s√£o simplesmente um b√°lsamo para a alma de muitas pessoas que sofreram implanta√ß√µes malsucedidas.  A capacidade de instalar o software <i>em um ambiente real</i> sem permitir que os usu√°rios tenham uma s√©rie de vantagens quando se trata de teste. <br>  Em primeiro lugar, a necessidade de manter ambientes separados para desenvolvimento, teste e prepara√ß√£o, que inevitavelmente precisam ser sincronizados com a produ√ß√£o, √© minimizada (e pode at√© desaparecer completamente). <br><br>  Al√©m disso, no est√°gio de design de servi√ßos, torna-se necess√°rio isol√°-los um do outro, para que a falha em testar uma inst√¢ncia espec√≠fica do servi√ßo na produ√ß√£o <i>n√£o</i> leve a uma cascata ou afete os usu√°rios pela falha de outros servi√ßos.  Uma solu√ß√£o para isso pode ser o design de um modelo de dados e esquema de banco de dados no qual consultas n√£o idempotentes (principalmente <i>opera√ß√µes de grava√ß√£o</i> ) podem: <br><br><ul><li>  A ser executado em rela√ß√£o ao banco de dados do ambiente de produ√ß√£o durante qualquer lan√ßamento de teste do servi√ßo em produ√ß√£o (eu prefiro essa abordagem); </li><li>  Ser rejeitado com seguran√ßa no n√≠vel do aplicativo at√© que eles atinjam o n√≠vel de grava√ß√£o ou grava√ß√£o; </li><li>  Seja alocado ou isolado no registro ou salve o n√≠vel de alguma maneira (por exemplo, armazenando metadados adicionais). </li></ul><br><h3>  Etapa 2. Lan√ßamento </h3><br>  Nota <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Implantar! = Release</a> define o termo release da seguinte maneira: <br><br>  ‚ÄúQuando dizemos que o <b>lan√ßamento da vers√£o do</b> servi√ßo ocorreu, queremos dizer que ele fornece processamento de dados no ambiente de produ√ß√£o.  Em outras palavras, uma <b>libera√ß√£o</b> √© um processo que direciona os dados do ambiente de produ√ß√£o para uma nova vers√£o do software.  Com essa defini√ß√£o em mente, todos os riscos que associamos ao envio de novos fluxos de dados (interrup√ß√µes no trabalho, insatisfa√ß√£o do cliente, notas t√≥xicas no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">The Register</a> ) est√£o relacionados ao <b>lan√ßamento de um</b> novo software e n√£o √† sua implanta√ß√£o (em algumas empresas, esse est√°gio tamb√©m √© chamado de <b>release)</b> . Neste artigo, usaremos o termo <b>release</b> ) ". <br><br>  No livro do Google sobre SRE, o termo "release" √© usado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cap√≠tulo sobre organiza√ß√£o de um release de software para descrev√™-lo</a> . <br><br>  ‚ÄúUma <b>quest√£o √© um elemento l√≥gico do trabalho que consiste em uma ou mais tarefas separadas.</b>  <b>Nosso objetivo √© coordenar o processo de implanta√ß√£o com o perfil de risco desse servi√ßo</b> . <br><br>  Em ambientes de desenvolvimento ou pr√©-produ√ß√£o, podemos construir a cada hora e distribuir automaticamente os lan√ßamentos ap√≥s a aprova√ß√£o de todos os testes.  Para grandes servi√ßos orientados ao usu√°rio, podemos iniciar a libera√ß√£o com um cluster e aumentar sua escala at√© atualizar todos os clusters.  <b>Para elementos importantes de infraestrutura, podemos estender o per√≠odo de implementa√ß√£o para v√°rios dias e execut√°-lo em diferentes regi√µes geogr√°ficas. ‚Äù</b> <br><br>  Nesta terminologia, as palavras "release" e "release" significam o que o vocabul√°rio geral se refere a "deploy", e os termos frequentemente usados ‚Äã‚Äãpara descrever v√°rias estrat√©gias de <i>implanta√ß√£o</i> (por exemplo, implanta√ß√£o azul esverdeada ou implanta√ß√£o can√°ria) referem-se √† <i>libera√ß√£o de um</i> novo software. <br><br>  Al√©m disso, uma <i>libera√ß√£o</i> malsucedida <i>de</i> aplicativos pode causar interrup√ß√µes parciais ou significativas no trabalho.  Nesse est√°gio, uma <i>revers√£o</i> ou <i>hotfix</i> tamb√©m √© executada se a nova vers√£o do servi√ßo <i>lan√ßada</i> for inst√°vel. <br><br>  O processo de <i>libera√ß√£o</i> funciona melhor quando √© automatizado e √© executado de forma <i>incremental</i> .  Da mesma forma, uma <i>revers√£o</i> ou <i>hotfix de um</i> servi√ßo √© mais √∫til quando a taxa de erro e a frequ√™ncia de solicita√ß√£o s√£o automaticamente correlacionadas √† linha de base. <br><br><h3>  Etapa 3. Ap√≥s o lan√ßamento </h3><br>  Se o lan√ßamento <i>ocorreu sem problemas</i> e a nova vers√£o do servi√ßo processa os dados do ambiente de produ√ß√£o sem problemas √≥bvios, podemos consider√°- <i>los</i> bem <i>-</i> sucedidos.  Um lan√ßamento bem-sucedido √© seguido por um est√°gio que pode ser chamado de "p√≥s-lan√ßamento". <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-1" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="961811607759159296"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  Qualquer sistema suficientemente complexo estar√° <i>sempre</i> em um estado de perda gradual de desempenho.  Isso n√£o significa que <i>√© necess√°ria</i> uma <i>revers√£o</i> ou <i>hotfix</i> .  Em vez disso, √© necess√°rio monitorar essa deteriora√ß√£o (para v√°rios fins operacionais e operacionais) e depurar, se necess√°rio.  Por esse motivo, testar ap√≥s o lan√ßamento n√£o √© mais como rotinas, mas <i>depurar</i> ou coletar dados anal√≠ticos. <br><br>  Em geral, acredito que todos os componentes do sistema devem ser criados, levando em considera√ß√£o o fato de que nem um √∫nico sistema grande funciona perfeitamente a 100% e que as avarias devem ser reconhecidas e levadas em considera√ß√£o nas etapas de design, desenvolvimento, teste, implanta√ß√£o e monitoramento do software. fornecendo. <br><br><hr><br>  Agora que identificamos os tr√™s est√°gios de produ√ß√£o, vejamos os v√°rios mecanismos de teste dispon√≠veis em cada um deles.  Nem todo mundo tem a oportunidade de trabalhar em novos projetos ou reescrever c√≥digo do zero.  Neste artigo, tentei identificar claramente os m√©todos que funcionar√£o melhor no desenvolvimento de novos projetos, al√©m de falar sobre o que mais podemos fazer para tirar proveito dos m√©todos propostos sem fazer altera√ß√µes significativas nos projetos em funcionamento. <br><br><h2>  Teste de implanta√ß√£o </h2><br>  Separamos os est√°gios de implanta√ß√£o e lan√ßamento e agora consideraremos alguns tipos de teste que podem ser aplicados ap√≥s a implanta√ß√£o do c√≥digo no ambiente de produ√ß√£o. <br><br><h3>  Teste de integra√ß√£o </h3><br>  Normalmente, o teste de integra√ß√£o √© executado por um servidor de integra√ß√£o cont√≠nua em um ambiente de teste isolado para cada filial do Git.  Uma c√≥pia de <i>toda a</i> topologia de servi√ßo (incluindo bancos de dados, filas, proxies etc.) √© implementada para conjuntos de testes de <i>todos os</i> servi√ßos que funcionar√£o juntos. <br><br>  Eu acredito que isso n√£o √© particularmente eficaz por v√°rias raz√µes.  Primeiro, o ambiente de teste, como o ambiente de prepara√ß√£o, n√£o pode ser implantado de forma que seja <i>id√™ntico ao</i> ambiente de produ√ß√£o real, <i>mesmo se os</i> testes forem executados no mesmo cont√™iner Docker que ser√° usado na produ√ß√£o.  Isso √© especialmente verdade quando a <i>√∫nica coisa</i> executada em um ambiente de teste s√£o os pr√≥prios testes. <br><br>  Independentemente de o teste ser executado como um cont√™iner do Docker ou um processo POSIX, √© mais prov√°vel que voc√™ fa√ßa <i>uma</i> ou mais conex√µes com um servi√ßo, banco de dados ou cache superior, o que √© raro se o servi√ßo estiver em um ambiente de produ√ß√£o em que possa simultaneamente processar v√°rias conex√µes simult√¢neas, geralmente reutilizando conex√µes TCP inativas (isso √© chamado reutilizando conex√µes HTTP). <br><br>  Al√©m disso, o problema √© causado pelo fato de que a maioria dos testes em cada inicializa√ß√£o cria uma nova tabela de banco de dados ou espa√ßo de chave em cache no <i>mesmo n√≥ em</i> que esse teste √© executado (dessa maneira, os testes s√£o isolados de falhas na rede).  Esse tipo de teste, na melhor das hip√≥teses, pode mostrar que o sistema funciona corretamente com uma solicita√ß√£o muito espec√≠fica.  Raramente √© eficaz na simula√ß√£o de tipos graves e bem distribu√≠dos de falhas, sem mencionar os diferentes tipos de falhas parciais.  Existem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">estudos</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=http://">abrangentes</a> que confirmam que os sistemas distribu√≠dos geralmente exibem <i>comportamentos imprevis√≠veis</i> que n√£o podem ser previstos por an√°lises realizadas de maneira diferente da de todo o sistema. <br><br>  Mas isso n√£o significa que o teste de integra√ß√£o seja, <i>em princ√≠pio,</i> in√∫til.  S√≥ podemos dizer que a implementa√ß√£o de testes de integra√ß√£o em um ambiente <i>artificial e completamente isolado</i> , por via de regra, n√£o faz sentido.  O teste de integra√ß√£o ainda deve ser executado para verificar se a nova vers√£o do servi√ßo: <br><br><ul><li>  N√£o interfere na intera√ß√£o com servi√ßos upstream ou downstream; </li><li>  N√£o afeta adversamente as metas e objetivos dos servi√ßos superiores ou inferiores. </li></ul><br>  O primeiro pode ser fornecido at√© certo ponto atrav√©s de testes de contrato.  <i>Devido</i> ao fato de as <i>interfaces</i> entre os servi√ßos funcionarem corretamente, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">teste de contrato</a> √© um m√©todo eficaz para desenvolver e testar servi√ßos individuais no <i>est√°gio de pr√©-produ√ß√£o</i> , o que n√£o exige a implanta√ß√£o de toda a topologia de servi√ßo. <br><br>  Atualmente, as plataformas de teste de contrato orientadas para o cliente, como o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pact</a> , oferecem suporte apenas √† interoperabilidade entre servi√ßos por meio do RESTful JSON RPC, embora seja prov√°vel que haja <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">trabalho em andamento para oferecer suporte √† intera√ß√£o ass√≠ncrona atrav√©s de soquetes da Web, aplicativos que n√£o sejam servidores e filas de mensagens</a> .  √â prov√°vel que o suporte aos protocolos gRPC e GraphQL seja adicionado no futuro, mas agora ainda n√£o est√° dispon√≠vel. <br><br>  No entanto, antes do <i>lan√ßamento de uma</i> nova vers√£o, pode ser necess√°rio verificar n√£o apenas a opera√ß√£o correta das <i>interfaces</i> .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E, por exemplo, verifique se a dura√ß√£o da chamada RPC entre os dois servi√ßos cai dentro do limite permitido ao alterar a interface entre eles. </font><font style="vertical-align: inherit;">Tamb√©m √© necess√°rio verificar se a taxa de acertos no cache permanece constante, por exemplo, ao adicionar um par√¢metro adicional √† solicita√ß√£o de entrada. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como se viu, o teste de integra√ß√£o n√£o √© </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opcional</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , seu objetivo √© garantir que as altera√ß√µes testadas n√£o levem a </font><font style="vertical-align: inherit;">tipos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">graves e generalizados</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de falha do sistema (geralmente aqueles para os quais os alertas s√£o atribu√≠dos). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A esse respeito, surge a pergunta: como </font><font style="vertical-align: inherit;">realizar </font><font style="vertical-align: inherit;">com </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seguran√ßa</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> os testes de integra√ß√£o na produ√ß√£o?</font></font><br><br>     .    ‚Äì ,       :    -   - ( C)   MySQL ( D)       memcache ( B). <br><br>   ,      (    ),  stateful-  stateless-        . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xl/nc/4e/xlnc4eni3elyx3huaw3trxs5uyc.jpeg"></div><br>  <i></i>  <i></i> ,     <i></i>      . <br><br>  service discovery        <i></i> ( ),      <i></i>  <i></i>        .         <i></i>   . <br><br> ,   <i></i>    C  . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ze/8y/yp/ze8yypuxevqszd_krd3cls4hrqc.jpeg"></div><br>  ,  <i></i>   ,        ,       .      ,       ,       .  ,     <i></i> ,        . <br><br>   Google     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Just Say No to More End-to-End Tests</a> (¬´      ¬ª),      : <br><br> ¬´ <i>       ( )      .       ,    ?           ,      </i> . <b>     ,     ,      ,     ¬ª.</b> <br><br>    ,          :       <i></i>       .               ,       A        . <br><br>     ,     <i></i>   C     MySQL,     . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/c4/bu/qc/c4buqc8zz2dt4e3pyr6svjnyguc.jpeg"></div><br>  <i> </i>       (   ,   ,         ¬´¬ª ,  <i></i> ).     <i></i>   MySQL   ,    ,      . <br><br>   ‚Äî        -.      ,      .              -,          . <br><br>    ,   -     <i></i>     ,   /: <br><br><ul><li>       C     /   ; </li><li>         ,   ¬´¬ª   . </li></ul><br>       <i>  </i>    ,             (,   ). <br><br>           ,    ,   <i></i>  .      IP- ,   ,    ,    ,       , ,  ,    ,    . <br><br> ,   ,     ,    ,       .      .     Facebook,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Kraken</a> ,  : <br><br> ¬´ <i>   ‚Äî     ,         .   -      ,    .        ,        .</i> <b>           -     ,     ,     ,       ¬ª.</b> <br><br>   ,      ,       ,     ,         ,  . <br><br>     -     .    service mesh             .        -.        -,  ,  ,    : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uk/kv/cj/ukkvcjxlzn3hdcpt-mxsep3pojm.jpeg"></div><br>  Se testarmos o servi√ßo B, seu servidor proxy de sa√≠da poder√° ser configurado para adicionar um cabe√ßalho especial <code>X-ServiceB-Test</code> a cada solicita√ß√£o de teste.  Nesse caso, o servidor proxy de entrada do servi√ßo superior C poder√°: <br><br><ul><li>  Detecte esse cabe√ßalho e envie uma resposta padr√£o ao servi√ßo B; </li><li>  Informe ao Servi√ßo C que a solicita√ß√£o √© um <i>teste</i> . </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3s/mr/-n/3smr-n7k-_87j3jjpirb02hkaja.jpeg"></div><br>  <i>Teste de integra√ß√£o da intera√ß√£o da vers√£o implantada do servi√ßo B com a vers√£o lan√ßada do servi√ßo C, em que as opera√ß√µes de grava√ß√£o nunca chegam ao banco de dados</i> <br><br>  A execu√ß√£o de testes de integra√ß√£o dessa maneira tamb√©m permite testar a intera√ß√£o do servi√ßo B com servi√ßos mais altos <i>quando eles processam dados normais do ambiente de produ√ß√£o</i> - provavelmente √© uma imita√ß√£o mais pr√≥xima de como o servi√ßo B se comportar√° quando <i>lan√ßado</i> na produ√ß√£o. <br><br>  Tamb√©m seria bom se cada servi√ßo nessa arquitetura suportasse chamadas reais da API no modo de teste ou simula√ß√£o, permitindo testar a execu√ß√£o de contratos de servi√ßo com servi√ßos downstream sem alterar os dados reais.  Isso equivale a contratar testes, mas no n√≠vel da rede. <br><br><h3>  Duplica√ß√£o de dados de sombra (teste de fluxo de dados escuro ou espelhamento) </h3><br>  A duplica√ß√£o de sombra (no artigo no blog do Google √© chamada de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">lan√ßamento escuro</a> , e o termo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">espelhamento</a> √© usado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Istio</a> ) em muitos casos, tem mais vantagens do que o teste de integra√ß√£o. <br><br>  Os <a href="http://">Princ√≠pios da Engenharia do Caos</a> afirmam o seguinte: <br><br>  ‚ÄúOs <i>sistemas se comportam de maneira diferente, dependendo do ambiente e do esquema de transfer√™ncia de dados.</i>  <i>Como o modo de uso pode mudar a qualquer momento</i> , a <b>amostragem de dados reais √© a √∫nica maneira confi√°vel de corrigir o caminho da solicita√ß√£o. ‚Äù</b> <br><br>  A duplica√ß√£o de dados de sombra √© um m√©todo pelo qual o fluxo de dados do ambiente de produ√ß√£o que entra em um determinado servi√ßo √© capturado e reproduzido em uma nova vers√£o <i>implementada</i> do servi√ßo.  Esse processo pode ser executado em tempo real, quando o fluxo de dados recebidos √© dividido e enviado para as vers√µes <i>lan√ßada</i> e <i>implantada</i> do servi√ßo ou de forma ass√≠ncrona, quando uma c√≥pia dos dados capturados anteriormente √© reproduzida no servi√ßo <i>implantado</i> . <br><br>  Quando trabalhei na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">imgix</a> (uma startup com uma equipe de 7 engenheiros, dos quais apenas quatro eram engenheiros de sistema), fluxos de dados escuros eram usados ‚Äã‚Äãativamente para testar altera√ß√µes em nossa infraestrutura de visualiza√ß√£o de imagens.  Registramos uma certa porcentagem de todas as solicita√ß√µes recebidas e as enviamos ao cluster Kafka - passamos os logs de acesso HAProxy para o pipeline <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">heka</a> , que, por sua vez, passou o fluxo de solicita√ß√£o analisado para o cluster Kafka.  Antes do est√°gio de <i>lan√ßamento, uma</i> nova vers√£o do nosso aplicativo de processamento de imagens era testada em um fluxo de dados escuro capturado - isso tornava poss√≠vel verificar se as solicita√ß√µes foram processadas corretamente.  No entanto, nosso sistema de visualiza√ß√£o de imagens era em geral um servi√ßo sem estado que era particularmente adequado para esse tipo de teste. <br><br>  Algumas empresas preferem capturar n√£o parte do fluxo de dados, mas transmitem uma <i>c√≥pia completa</i> desse fluxo para a nova vers√£o do aplicativo.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O McRouter do Facebook</a> (proxy memcached) suporta esse tipo de duplica√ß√£o de sombra do fluxo de dados do memcache. <br><br>  ‚Äú <i>Ao testar uma nova instala√ß√£o para o cache, achamos muito conveniente redirecionar uma c√≥pia completa do fluxo de dados dos clientes.</i>  <i>McRouter suporta configura√ß√µes flex√≠veis de duplica√ß√£o de sombra.</i>  <i>√â poss√≠vel executar a duplica√ß√£o de sombra de um pool de v√°rios tamanhos (armazenando em cache novamente o espa√ßo de chaves), copiar apenas parte do espa√ßo de chaves ou alterar par√¢metros dinamicamente durante a opera√ß√£o</i> . ‚Äù <br><br>  O aspecto negativo da duplica√ß√£o de sombra de todo o fluxo de dados para um servi√ßo <i>implantado</i> em um ambiente de produ√ß√£o √© que, se for executado no momento de m√°xima intensidade de transfer√™ncia de dados, poder√° exigir o dobro de energia. <br>  Proxies como o Envoy oferecem suporte √† duplica√ß√£o de sombra do fluxo de dados para outro cluster no modo disparar e esquecer.  Sua <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> diz: <br><br>  ‚Äú <i>Um roteador pode executar duplica√ß√£o de sombra do fluxo de dados de um cluster para outro.</i>  <i>Atualmente, o modo disparar e esquecer √© implementado, no qual o servidor proxy Envoy n√£o espera por uma resposta do cluster de sombra antes de retornar uma resposta do cluster principal.</i>  <i>Para o cluster de sombra, todas as estat√≠sticas usuais s√£o coletadas, o que √© √∫til para fins de teste.</i>  <i>Com duplica√ß√£o de sombra, a op√ß√£o <code>-shadow</code> √© adicionada ao <code>-shadow</code> do host / autoridade.</i>  <i>Isso √© √∫til para o log.</i>  <i>Por exemplo, <code>cluster1</code> transforma em <code>cluster1-shadow</code></i> . " <br><br>  No entanto, muitas vezes √© impratic√°vel ou imposs√≠vel criar uma r√©plica de um cluster sincronizado com a produ√ß√£o para teste (pelo mesmo motivo que √© problem√°tico organizar um cluster de armazenamento tempor√°rio sincronizado).  Se a duplica√ß√£o de sombra for usada para testar um novo servi√ßo <i>implantado</i> que possui muitas depend√™ncias, ele poder√° iniciar altera√ß√µes imprevistas no estado dos servi√ßos de n√≠vel superior em rela√ß√£o ao testado.  A duplica√ß√£o de sombra do volume di√°rio de registros do usu√°rio na vers√£o <i>implantada</i> do servi√ßo com grava√ß√£o no banco de dados de produ√ß√£o pode levar a um aumento na taxa de erro de at√© 100%, devido ao fato de que o fluxo de dados de sombra ser√° percebido como repetidas tentativas de registro e rejei√ß√£o. <br><br>  Minha experi√™ncia pessoal sugere que a duplica√ß√£o de sombra √© mais adequada para testar solicita√ß√µes n√£o idempotentes ou servi√ßos sem estado com stubs do lado do servidor.  Nesse caso, a duplica√ß√£o de dados de sombra √© mais frequentemente usada para testar a carga, a estabilidade e as configura√ß√µes.  Ao mesmo tempo, com a ajuda do teste ou teste de integra√ß√£o, voc√™ pode testar como o servi√ßo interage com um servidor com estado ao trabalhar com solicita√ß√µes n√£o-idempotentes. <br><br><h3>  Compara√ß√£o TAP </h3><br>  A √∫nica men√ß√£o a esse termo est√° em um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo</a> do blog do Twitter dedicado ao lan√ßamento de servi√ßos com alto n√≠vel de qualidade de servi√ßo. <br><br>  <i>‚ÄúPara verificar a corre√ß√£o da nova implementa√ß√£o do sistema existente, usamos um m√©todo chamado <b>de compara√ß√£o de deriva√ß√£o</b> .</i>  <i>Nossa ferramenta de compara√ß√£o de toques reproduz os dados de produ√ß√£o da amostra no novo sistema e compara as respostas recebidas com os resultados do antigo.</i>  <i>Os resultados obtidos nos ajudaram a encontrar e corrigir erros no sistema antes mesmo que os usu√°rios finais os encontrassem. ‚Äù</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Outra</a> postagem no blog do Twitter define compara√ß√µes de toque da seguinte forma: <br><br>  <i>"Enviando solicita√ß√µes para inst√¢ncias de servi√ßo, tanto em ambientes de produ√ß√£o quanto em teste, <b>verificando os resultados</b> e avaliando as caracter√≠sticas de desempenho".</i> <br><br>  A diferen√ßa entre compara√ß√£o de toque e duplica√ß√£o de sombra √© que, no primeiro caso, a resposta retornada pela vers√£o <i>lan√ßada</i> √© comparada com a resposta retornada pela vers√£o <i>implantada</i> e, no segundo, a solicita√ß√£o √© duplicada para a vers√£o <i>implantada</i> no modo offline, como acionar e esquecer. <br><br>  Outra ferramenta para trabalhar nessa √°rea √© a biblioteca de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cientistas</a> , dispon√≠vel no GitHub.  Essa ferramenta foi desenvolvida para testar o c√≥digo Ruby, mas foi portada para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">v√°rios outros idiomas</a> .  √â √∫til para alguns tipos de teste, mas tem v√°rios problemas n√£o resolvidos.  Aqui est√° o que um desenvolvedor do GitHub escreveu em uma comunidade profissional do Slack: <br><br>  <i>‚ÄúEssa ferramenta simplesmente executa duas ramifica√ß√µes de c√≥digo e compara os resultados.</i>  <i>Voc√™ deve ter cuidado com o c√≥digo dessas ramifica√ß√µes.</i>  <i>√â necess√°rio garantir que as consultas ao banco de dados n√£o sejam duplicadas se isso resultar em problemas.</i>  <i>Eu acho que isso se aplica n√£o apenas a um cientista, mas tamb√©m a qualquer situa√ß√£o em que voc√™ fa√ßa algo duas vezes e depois compare os resultados.</i>  <i>A ferramenta cientista foi criada para verificar se o novo sistema de permiss√£o funciona da mesma forma que o antigo e, em determinados momentos, era usado para comparar os dados t√≠picos de praticamente todas as solicita√ß√µes do Rails.</i>  <i>Eu acho que o processo levar√° mais tempo, j√° que o processamento √© realizado sequencialmente, mas esse √© um problema do Ruby no qual os threads n√£o s√£o usados.</i> <i><br><br></i>  <i>Na maioria dos casos conhecidos por mim, a ferramenta cientista foi usada para trabalhar com opera√ß√µes de leitura em vez de grava√ß√£o, por exemplo, para descobrir se novas consultas e esquemas de permiss√£o aprimorados recebem a mesma resposta que os antigos.</i>  <i>Ambas as op√ß√µes s√£o executadas em um ambiente de produ√ß√£o (em r√©plicas).</i>  <i>Se os recursos testados tiverem efeitos colaterais, acho que os testes ter√£o que ser feitos no n√≠vel do aplicativo. ‚Äù</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Diffy</a> √© uma ferramenta de c√≥digo aberto escrita Scala, introduzida pelo Twitter em 2015.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Um artigo</a> do blog do Twitter intitulado <b>Testando sem escrever testes</b> √© provavelmente o melhor recurso para entender como as compara√ß√µes de toques funcionam na pr√°tica. <br><br>  <i>‚ÄúO Diffy detecta poss√≠veis erros no servi√ßo ao lan√ßar simultaneamente uma vers√£o nova e antiga do c√≥digo.</i>  <i>Essa ferramenta funciona como um servidor proxy e envia todas as solicita√ß√µes recebidas para cada uma das inst√¢ncias em execu√ß√£o.</i>  <i>Ele ent√£o compara as respostas das inst√¢ncias e relata todos os desvios encontrados durante a compara√ß√£o.</i>  <i>Diffy baseia-se na seguinte id√©ia:</i> <b>se duas implementa√ß√µes de um servi√ßo retornam as mesmas respostas com um conjunto de solicita√ß√µes suficientemente grande e variado, essas duas implementa√ß√µes podem ser consideradas equivalentes e as mais novas sem degrada√ß√£o no desempenho.</b>  <i>A t√©cnica inovadora de redu√ß√£o de ru√≠do de Diffy o diferencia de outras ferramentas de an√°lise de regress√£o comparativa. "</i> <br><br>  A compara√ß√£o de toque √© √≥tima quando voc√™ precisa verificar se duas vers√µes apresentam os mesmos resultados.  De acordo com Mark McBride, <br><br>  <i>‚ÄúA ferramenta Diffy era frequentemente usada no redesenho de sistemas.</i>  <i>No nosso caso, dividimos a base de c√≥digo-fonte do Rails em v√°rios servi√ßos criados usando o Scala, e um grande n√∫mero de clientes de API utilizou fun√ß√µes de maneira diferente da esperada.</i>  <i>Fun√ß√µes como formata√ß√£o de data eram especialmente perigosas. ‚Äù</i> <br><br>  A compara√ß√£o por toque n√£o √© a melhor op√ß√£o para testar a atividade do usu√°rio ou a identidade do comportamento de duas vers√µes do servi√ßo com carga m√°xima.  Como na duplica√ß√£o de sombra, os efeitos colaterais continuam sendo um problema n√£o resolvido, especialmente quando a vers√£o implantada e a vers√£o de produ√ß√£o gravam dados no mesmo banco de dados.  Como nos testes de integra√ß√£o, uma maneira de contornar esse problema √© usar testes de compara√ß√£o de toque com apenas um conjunto limitado de contas. <br><br><h3>  Teste de carga </h3><br>  Para aqueles que n√£o est√£o familiarizados com o teste de estresse, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">este artigo</a> pode servir como um bom ponto de partida.  N√£o faltam ferramentas e plataformas para teste de carga de c√≥digo aberto.  Os mais populares deles s√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=http://">Apache Bench</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Gatling</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">wrk2</a> , <a href="http://">Tsung</a> , escritos em Erlang, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Siege</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Iago</a> , do Twitter, escritos em Scala (que reproduz os logs de um servidor HTTP, servidor proxy ou analisador de pacotes de rede em uma inst√¢ncia de teste).  Alguns especialistas acreditam que a melhor ferramenta para gerar carga √© o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mzbench</a> , que suporta uma variedade de protocolos, incluindo MySQL, Postgres, Cassandra, MongoDB, TCP, etc. O <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">NDBench</a> da Netflix √© outra ferramenta de c√≥digo aberto para carregar data warehouses de teste. , que suporta a maioria dos protocolos conhecidos. <br><br>  O blog oficial do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Iago no</a> Twitter descreve com mais detalhes quais recursos um bom gerador de carga deve ter: <br><br>  <i>‚ÄúSolicita√ß√µes sem bloqueio s√£o geradas em uma determinada frequ√™ncia com base em uma distribui√ß√£o estat√≠stica personalizada interna ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o processo de Poisson √©</a> modelado por padr√£o).</i>  <i>A frequ√™ncia das solicita√ß√µes pode ser alterada conforme necess√°rio, por exemplo, para preparar o cache antes do trabalho em carga m√°xima.</i> <i><br><br></i>  <i>Em geral, a principal aten√ß√£o √© dada √† frequ√™ncia das solicita√ß√µes, de acordo com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a lei de Little</a> , e n√£o ao n√∫mero de usu√°rios simult√¢neos, que podem variar dependendo da quantidade de atraso inerente a este servi√ßo.</i>  <i>Por esse motivo, surgem novas oportunidades para comparar os resultados de v√°rios testes e evitar a deteriora√ß√£o do servi√ßo, retardando a opera√ß√£o do gerador de carga.</i> <i><br><br></i>  <i>Em outras palavras, a ferramenta Iago procura simular um sistema no qual as solicita√ß√µes s√£o recebidas, independentemente da capacidade do seu servi√ßo em process√°-las.</i>  <i>Nisto, difere dos geradores de carga que simulam sistemas fechados nos quais os usu√°rios trabalham pacientemente com o atraso existente.</i>  <i>Essa diferen√ßa nos permite modelar com precis√£o os modos de falha que podem ser encontrados na produ√ß√£o ".</i> <br><br>  Outro tipo de teste de carga √© o teste de estresse, redistribuindo o fluxo de dados.  Sua ess√™ncia √© a seguinte: todo o fluxo de dados do ambiente de produ√ß√£o √© direcionado para um cluster menor que o preparado para o servi√ßo;  se houver problemas, o fluxo de dados √© transferido de volta para o cluster maior.  Essa t√©cnica √© usada pelo Facebook, conforme descrito em um dos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigos em seu blog oficial</a> : <br><br>  <i>‚ÄúRedirecionamos especificamente um fluxo maior de dados para clusters ou n√≥s individuais, medimos o consumo de recursos nesses n√≥s e determinamos os limites da estabilidade do servi√ßo.</i>  <i>Esse tipo de teste, em particular, √© √∫til para determinar os recursos da CPU necess√°rios para suportar o n√∫mero m√°ximo de transmiss√µes simult√¢neas do Facebook Live. ‚Äù</i> <br><br>  Aqui est√° o que um ex-engenheiro do LinkedIn na comunidade profissional do Slack escreve: <br><br>  <i>‚ÄúO LinkedIn tamb√©m usou testes de redline na produ√ß√£o - os servidores foram removidos do balanceador de carga at√© que a carga atingisse os valores limite ou os erros come√ßaram a ocorrer.‚Äù</i> <br><br>  De fato, uma pesquisa no Google fornece um link para um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">white paper completo</a> e um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo de</a> blog do LinkedIn sobre este t√≥pico: <br><br>  <i>‚ÄúA solu√ß√£o Redliner para medi√ß√µes utiliza um fluxo de dados real do ambiente de produ√ß√£o, o que evita erros que impedem medi√ß√µes precisas de desempenho em laborat√≥rio.</i> <i><br><br></i>  <i>O Redliner redireciona parte do fluxo de dados para o servi√ßo em teste e analisa em tempo real seu desempenho.</i>  <i>Essa solu√ß√£o foi implementada em centenas de servi√ßos internos do LinkedIn e √© usada diariamente para v√°rios tipos de an√°lise de desempenho.</i> <i><br><br></i>  <i>O Redliner suporta a execu√ß√£o de testes paralelos para inst√¢ncias de can√°rio e produ√ß√£o.</i>  <b>Isso permite que os engenheiros transfiram a mesma quantidade de dados para duas inst√¢ncias de servi√ßo diferentes: 1) uma inst√¢ncia de servi√ßo que cont√©m inova√ß√µes, como novas configura√ß√µes, propriedades ou novo c√≥digo;</b>  <b>2) uma inst√¢ncia de servi√ßo da vers√£o atual de trabalho.</b> <br><br>  <i>"Os resultados do teste de carga s√£o levados em considera√ß√£o ao tomar decis√µes e ajudam a impedir a implanta√ß√£o do c√≥digo, o que pode levar a um desempenho ruim".</i> <br><br>  O Facebook levou o teste de carga usando fluxos de dados reais a um n√≠vel totalmente novo, gra√ßas ao sistema Kraken, e sua <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">descri√ß√£o</a> tamb√©m merece ser lida. <br>  O teste √© implementado redistribuindo o fluxo de dados ao alterar os valores de peso (lidos no armazenamento de configura√ß√£o distribu√≠do) para dispositivos de borda e clusters na configura√ß√£o do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Proxygen</a> (balanceador de carga do Facebook).  Esses valores determinam o volume de dados reais enviados, respectivamente, para cada cluster e regi√£o em um determinado ponto de presen√ßa. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wk/0e/by/wk0ebyvdpznpgdgqcc_6zbu1g6g.png"></div><br>  <i>Dados do white paper da Kraken</i> <br><br>  O sistema de monitoramento ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Gorilla</a> ) exibe indicadores de v√°rios servi√ßos (como mostrado na tabela acima).  Com base nos dados e limites de monitoramento, √© tomada uma decis√£o sobre o envio de dados adicionais de acordo com os valores de peso ou se √© necess√°rio reduzir ou at√© parar completamente a transfer√™ncia de dados para um cluster espec√≠fico. <br><br><h2>  Testes de configura√ß√£o </h2><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-2" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="916383043933192192"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  Uma nova onda de ferramentas de infraestrutura de c√≥digo aberto tornou a captura de todas as altera√ß√µes na infraestrutura na forma de c√≥digo n√£o apenas poss√≠vel, mas tamb√©m relativamente <i>f√°cil</i> .  Tamb√©m se tornou poss√≠vel, em graus variados, <i>testar</i> essas altera√ß√µes, embora a maioria dos testes de infraestrutura como c√≥digo no est√°gio de pr√©-produ√ß√£o s√≥ possa confirmar as especifica√ß√µes e a sintaxe corretas. <br><br>  Al√©m disso, a recusa em testar a nova configura√ß√£o antes do <i>lan√ßamento do</i> c√≥digo tornou-se a causa de um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">n√∫mero significativo de interrup√ß√µes</a> . <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-3" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="963093541575581696"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  Para testes hol√≠sticos de altera√ß√µes de configura√ß√£o, √© importante distinguir entre diferentes tipos de configura√ß√µes.  Fred Hebert sugeriu uma vez usar o seguinte quadrante: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yv/fi/4i/yvfi4ioub6pkvt1mtzxvz2xuvnk.png"></div><br>  Essa op√ß√£o, √© claro, n√£o √© universal, mas essa distin√ß√£o permite que voc√™ decida qual a melhor forma de testar cada uma das configura√ß√µes e em que est√°gio faz√™-lo.  A configura√ß√£o do tempo de compila√ß√£o faz sentido se voc√™ puder garantir a repetibilidade real das montagens.  Nem todas as configura√ß√µes s√£o est√°ticas, mas nas plataformas modernas uma mudan√ßa din√¢mica na configura√ß√£o √© inevit√°vel (mesmo se estivermos lidando com uma "infraestrutura permanente"). <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-4" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1005924617981005824"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>       ,   ,       blue-green ,        .   ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jamie Wilkinson</a> ),  Google  , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> : <br><br> <i>¬´        ,   ,   ,  -     .    .</i> <b>    -  ,         ‚Äî  ,       ,   .        .</b> <br><br> <i>            ,  .     ,    , ‚Äî    ¬ª.</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  Facebook</a>             : <br><br> <i>¬´           .    ‚Äî  ,              .             .        ,      .</i> <br><br><ul><li> <b>   </b> <br><br>             .  Facebook ,          .             ,     . </li><li> <b>   </b> <br><br>         (,  JSON).           ,           .          . <br><br>   (,  Facebook  Thrift)      .   ,           . </li><li> <b> </b> <br><br>         ,     ,    - .       .   ‚Äî A/B-,        1 % .     A/B-,        .      A/B-    . ,  ,                 ,       ,     .  , A/B-    .      ,    A/B-.     Facebook        . <br><br> ,     A/B-  1% ,   1%     ,          (   ¬´  ¬ª).          ,         .               ,      . </li><li> <b>  </b> <br><br>   Facebook            .       ,        .    ,              ,     .   ,  ,           . </li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cancelamento simples e conveniente de altera√ß√µes</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Em alguns casos, apesar de todas as medidas preventivas, a implanta√ß√£o de uma configura√ß√£o inoperante √© realizada. </font><font style="vertical-align: inherit;">Encontrar e reverter rapidamente as altera√ß√µes √© fundamental para resolver esse problema. </font><font style="vertical-align: inherit;">"As ferramentas de controle de vers√£o est√£o dispon√≠veis em nosso sistema de configura√ß√£o, o que facilita muito a desfazer altera√ß√µes."</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para ser continuado! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD: continuou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt418081/">https://habr.com/ru/post/pt418081/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt418069/index.html">Resolvendo palavras cruzadas em cores japonesas na velocidade da luz</a></li>
<li><a href="../pt418071/index.html">Setor de TI para o povo: TechTrain Festival em S√£o Petersburgo</a></li>
<li><a href="../pt418075/index.html">As 5 principais coisas que podem ser impressas em uma impressora 3D [v√≠deo]</a></li>
<li><a href="../pt418077/index.html">Acidentes de ‚Äún√£o assista‚Äù: uma justificativa estat√≠stica para o modo operacional de suporte t√©cnico 24/7</a></li>
<li><a href="../pt418079/index.html">As linguagens de programa√ß√£o mais populares - 2018</a></li>
<li><a href="../pt418083/index.html">Servidor simples com GraphQL em vez de REST, implementa√ß√£o em java</a></li>
<li><a href="../pt418085/index.html">Usando promessas em JavaScript</a></li>
<li><a href="../pt418087/index.html">80% dos check-outs de autoatendimento est√£o em risco</a></li>
<li><a href="../pt418089/index.html">Vis√£o geral da fresadora CNC SolidCraft</a></li>
<li><a href="../pt418091/index.html">Lista de artigos e literatura sobre NAS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>