<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👶🏿 🚵🏿 🕟 Paket R tidyr dan fungsi pivot_longer dan pivot_wider yang baru 🙋 🙌🏻 🐐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Paket tidyr adalah bagian dari inti dari salah satu perpustakaan paling populer dalam bahasa R - tidyverse . 
 Tujuan utama dari paket ini adalah untu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Paket R tidyr dan fungsi pivot_longer dan pivot_wider yang baru</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444622/"><p>  Paket <strong>tidyr</strong> adalah bagian dari inti dari salah satu perpustakaan paling populer dalam bahasa R - <strong>tidyverse</strong> . <br>  Tujuan utama dari paket ini adalah untuk membawa data ke tampilan yang rapi. </p><br><p>  Sudah ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">publikasi</a> tentang Habré yang didedikasikan untuk paket ini, tetapi sudah ada sejak tahun 2015.  Dan saya ingin memberi tahu Anda tentang perubahan yang paling relevan, yang beberapa hari lalu diumumkan oleh penulisnya, Hadley Wickham. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/21a/cf9/6f5/21acf96f56c9b005b125708f5b122a2b.png" alt="gambar"><br><blockquote> <b>SJK</b> : <b>Apakah fungsi</b> kumpulkan () dan menyebar () ditinggalkan? <br><br>  <b>Hadley Wickham</b> : Sampai batas tertentu.  Kami akan berhenti merekomendasikan penggunaan fungsi-fungsi ini dan memperbaiki kesalahan di dalamnya, tetapi mereka akan terus hadir dalam paket dalam keadaan saat ini. </blockquote><a name="habracut"></a><br><h2 id="soderzhanie">  Isi </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Konsep TidyData</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Fungsi utama termasuk dalam paket rapi</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Konsep baru untuk mengkonversi data dari format lebar ke format panjang dan sebaliknya</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Menginstal versi terbaru dari tidyr 0.8.3.9000</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Beralih ke fitur baru</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Contoh sederhana konversi data dari format lebar ke format panjang</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Spesifikasi</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Spesifikasi menggunakan beberapa nilai (.value)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mengonversi Frame Tanggal dari Panjang ke Lebar</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Contoh paling sederhana dari casting tabel ke format lebar</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Menghasilkan nama kolom dari beberapa variabel sumber</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Beberapa contoh canggih bekerja dengan konsep tidyr baru</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Membawa data ke tampilan yang rapi menggunakan dataset sensus pendapatan dan sewa AS sebagai contoh</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bank Dunia</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Daftar kontak</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kesimpulan</a> </li></ul><br><h2 id="koncepciya-tidydata">  Konsep TidyData </h2><br><p>  Tujuan dari <strong>Tidyr</strong> adalah untuk membantu Anda membawa data ke tampilan yang disebut rapi.  Data akurat adalah data di mana: </p><br><ul><li>  Setiap variabel ada di kolom. </li><li>  Setiap pengamatan adalah garis. </li><li>  Setiap nilai adalah sel. </li></ul><br><p>  Data yang diberikan untuk merapikan data jauh lebih sederhana dan lebih nyaman untuk digunakan selama analisis. </p><br><h2 id="osnovnye-funkcii-vhodyaschie-v-paket-tidyr">  Fungsi utama termasuk dalam paket rapi </h2><br><p>  tidyr berisi sekumpulan fungsi untuk mengubah tabel: </p><br><ul><li> <code>fill()</code> - mengisi nilai yang hilang di kolom dengan nilai sebelumnya; </li><li>  <code>separate()</code> - membagi satu bidang menjadi beberapa melalui pemisah; </li><li>  <code>unite()</code> - melakukan operasi menggabungkan beberapa bidang menjadi satu, kebalikan dari fungsi <code>separate()</code> ; </li><li>  <code>pivot_longer()</code> - fungsi yang mengubah data dari format lebar ke format panjang; </li><li>  <code>pivot_wider()</code> - fungsi yang mengubah data dari format panjang menjadi format lebar.  Operasi adalah kebalikan dari yang dilakukan oleh fungsi <code>pivot_longer()</code> . </li><li>  <code>gather()</code> <strong>usang</strong> - suatu fungsi yang mengubah data dari format lebar ke yang panjang; </li><li>  <code>spread()</code> <strong>usang</strong> - fungsi yang mengubah data dari format panjang ke format lebar.  Operasi terbalik dari fungsi yang <code>gather()</code> lakukan. </li></ul><br><h2 id="novaya-koncepciya-preobrazovaniya-dannyh-iz-shirokogo-formata-v-dlinnyy-i-naoborot">  Konsep baru untuk mengkonversi data dari format lebar ke format panjang dan sebaliknya </h2><br><p>  Sebelumnya, fungsi <code>gather()</code> dan <code>spread()</code> digunakan untuk transformasi semacam ini.  Selama bertahun-tahun keberadaan fungsi-fungsi ini, menjadi jelas bahwa bagi sebagian besar pengguna, termasuk penulis paket, nama-nama fungsi ini dan argumen mereka tidak begitu jelas, dan menyebabkan kesulitan dalam menemukan mereka dan memahami fungsi mana yang membawa kerangka tanggal dari lebar ke panjang format dan sebaliknya. </p><br><p>  Dalam hubungan ini, dua fungsi penting baru ditambahkan ke <strong>tidyr</strong> , yang dirancang untuk mengubah kerangka tanggal. </p><br><p>  Fungsi baru <code>pivot_longer()</code> dan <code>pivot_wider()</code> terinspirasi oleh beberapa fungsi dalam paket <strong>cdata</strong> yang dibuat oleh John Mount dan Nina Zumel. </p><br><h3 id="ustanovka-naibolee-aktualnoy-versii-tidyr-0839000">  Menginstal versi terbaru dari tidyr 0.8.3.9000 </h3><br><p>  Untuk menginstal <em>paket</em> <strong>Tidyr 0.8.3.9000</strong> versi terbaru dan terbaru, di mana fungsi-fungsi baru tersedia, gunakan kode berikut. </p><br><p> <code>devtools::install_github("tidyverse/tidyr")</code> </p> <br><p>  Pada saat penulisan, fungsi-fungsi ini hanya tersedia dalam versi dev dari paket di GitHub. </p><br><h3 id="perehod-na-novye-funkcii">  Beralih ke fitur baru </h3><br><p>  Sebenarnya, tidak sulit untuk mentransfer skrip lama untuk bekerja dengan fungsi-fungsi baru, untuk pemahaman yang lebih baik, saya akan mengambil contoh dari dokumentasi fungsi-fungsi lama dan menunjukkan bagaimana operasi yang sama dilakukan menggunakan fungsi <code>pivot_*()</code> . </p><br><p>  Konversi lebar ke format panjang. </p><br><div class="spoiler">  <b class="spoiler_title">Kode sampel dari dokumentasi fungsi kumpulkan</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># example library(dplyr) stocks &lt;- data.frame( time = as.Date('2009-01-01') + 0:9, X = rnorm(10, 0, 1), Y = rnorm(10, 0, 2), Z = rnorm(10, 0, 4) ) # old stocks_gather &lt;- stocks %&gt;% gather(key = stock, value = price, -time) # new stocks_long &lt;- stocks %&gt;% pivot_longer(cols = -time, names_to = "stock", values_to = "price")</code> </pre></div></div><br><p>  Mengubah format panjang menjadi lebar. </p><br><div class="spoiler">  <b class="spoiler_title">Kode sampel dari dokumentasi fungsi penyebaran</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># old stocks_spread &lt;- stocks_gather %&gt;% spread(key = stock, value = price) # new stock_wide &lt;- stocks_long %&gt;% pivot_wider(names_from = "stock", values_from = "price")</code> </pre></div></div><br><p>  Karena  dalam contoh di atas bekerja dengan <code>pivot_longer()</code> dan <code>pivot_wider()</code> , dalam tabel sumber <em>saham</em> tidak ada kolom yang tercantum dalam <em>argumen names_to</em> dan <em>values_to,</em> nama mereka harus ditunjukkan dalam tanda kutip. </p><br><p>  Tabel dengan bantuan yang paling mudah Anda pikirkan bagaimana beralih ke bekerja dengan konsep <strong>tidyr</strong> baru. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/127/fc7/70a/127fc770a8175c98168864954e498199.png" alt="gambar"></p><br><h2 id="primechanie-ot-avtora">  Catatan dari penulis </h2><br><blockquote>  Semua teks di bawah ini adaptif, saya bahkan akan mengatakan terjemahan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sketsa gratis</a> dari situs resmi perpustakaan yang rapi. </blockquote><br><h2 id="prostoy-primer-preobrazovaniya-dannyh-iz-shirokogo-formata-v-dlinnyy">  Contoh sederhana konversi data dari format lebar ke format panjang </h2><br><p>  <code>pivot_longer ()</code> - membuat set data lebih lama dengan mengurangi jumlah kolom dan meningkatkan jumlah baris. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/760/8bb/c5d/7608bbc5d0873682bb5cb8ad3fb9857e.png" alt="gambar"></p><br><p>  Untuk menjalankan contoh yang disajikan dalam artikel, Anda harus terlebih dahulu menghubungkan paket yang diperlukan: </p><br><pre> <code class="plaintext hljs">library(tidyr) library(dplyr) library(readr)</code> </pre> <br><p>  Misalkan kita memiliki tabel dengan hasil survei di mana (antara lain) orang ditanya tentang agama dan pendapatan tahunan mereka: </p><br><pre> <code class="plaintext hljs">#&gt; # A tibble: 18 x 11 #&gt; religion `&lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k` #&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; #&gt; 1 Agnostic 27 34 60 81 76 137 #&gt; 2 Atheist 12 27 37 52 35 70 #&gt; 3 Buddhist 27 21 30 34 33 58 #&gt; 4 Catholic 418 617 732 670 638 1116 #&gt; 5 Don't k… 15 14 15 11 10 35 #&gt; 6 Evangel… 575 869 1064 982 881 1486 #&gt; 7 Hindu 1 9 7 9 11 34 #&gt; 8 Histori… 228 244 236 238 197 223 #&gt; 9 Jehovah… 20 27 24 24 21 30 #&gt; 10 Jewish 19 19 25 25 30 95 #&gt; # … with 8 more rows, and 4 more variables: `$75-100k` &lt;dbl&gt;, #&gt; # `$100-150k` &lt;dbl&gt;, `&gt;150k` &lt;dbl&gt;, `Don't know/refused` &lt;dbl&gt;</code> </pre> <br><p>  Tabel ini berisi data agama responden dalam baris, dan tingkat pendapatan tersebar di seluruh nama kolom.  Jumlah responden dari masing-masing kategori disimpan dalam nilai-nilai sel di persimpangan tingkat agama dan pendapatan.  Untuk membawa tabel ke format yang rapi dan benar, cukup gunakan <code>pivot_longer()</code> : </p><br><pre> <code class="plaintext hljs">pew %&gt;% pivot_longer(cols = -religion, names_to = "income", values_to = "count")</code> </pre> <br><pre> <code class="plaintext hljs">pew %&gt;% pivot_longer(cols = -religion, names_to = "income", values_to = "count") #&gt; # A tibble: 180 x 3 #&gt; religion income count #&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; #&gt; 1 Agnostic &lt;$10k 27 #&gt; 2 Agnostic $10-20k 34 #&gt; 3 Agnostic $20-30k 60 #&gt; 4 Agnostic $30-40k 81 #&gt; 5 Agnostic $40-50k 76 #&gt; 6 Agnostic $50-75k 137 #&gt; 7 Agnostic $75-100k 122 #&gt; 8 Agnostic $100-150k 109 #&gt; 9 Agnostic &gt;150k 84 #&gt; 10 Agnostic Don't know/refused 96 #&gt; # … with 170 more rows</code> </pre> <br><p>  Argumen untuk <code>pivot_longer()</code> </p><br><ul><li>  Argumen pertama, <em>cols</em> , menjelaskan kolom mana yang akan digabung.  Dalam hal ini, semua kolom kecuali <em>waktu</em> . </li><li>  Argumen <em>names_to</em> memberikan nama variabel yang akan dibuat dari nama kolom yang kita gabungkan. </li><li>  <em>values_to</em> memberikan nama variabel yang akan dibuat dari data yang disimpan dalam nilai sel kolom yang digabungkan. </li></ul><br><h2 id="specifikacii">  Spesifikasi </h2><br><p>  Ini adalah fungsionalitas baru dari paket <strong>tidyr</strong> , yang sebelumnya tidak tersedia ketika bekerja dengan fungsi-fungsi usang. </p><br><p>  Spesifikasi adalah bingkai data, setiap baris yang sesuai dengan satu kolom dalam bingkai tanggal keluaran baru, dan dua kolom khusus yang dimulai dengan: </p><br><ul><li>  <em>.name</em> berisi nama asli kolom. </li><li>  <em>.value</em> berisi nama kolom tempat nilai sel akan pergi. </li></ul><br><p>  Kolom yang tersisa dari spesifikasi mencerminkan bagaimana nama kolom yang dapat dikompresi dari <em>.name</em> akan ditampilkan di kolom baru. </p><br><p>  Spesifikasi menjelaskan metadata yang disimpan dalam nama kolom, dengan satu baris untuk setiap kolom dan satu kolom untuk setiap variabel dikombinasikan dengan nama kolom, mungkin definisi ini tampak membingungkan sekarang, tetapi setelah mempertimbangkan beberapa contoh semuanya akan menjadi lebih jelas. </p><br><p>  Arti spesifikasinya adalah Anda dapat mengambil, memodifikasi, dan mengatur metadata baru untuk kerangka data yang dikonversi. </p><br><p>  Fungsi <code>pivot_longer_spec()</code> untuk bekerja dengan spesifikasi saat mengonversi tabel dari format lebar ke format panjang. </p><br><p>  Cara kerja fungsi ini, dibutuhkan kerangka tanggal apa pun, dan menghasilkan metadata-nya seperti dijelaskan di atas. </p><br><p>  Sebagai contoh, mari kita ambil dataset siapa yang datang dengan paket <strong>tidyr</strong> .  Dataset ini berisi informasi yang disediakan oleh organisasi kesehatan internasional tentang kejadian TBC. </p><br><pre> <code class="plaintext hljs">who #&gt; # A tibble: 7,240 x 60 #&gt; country iso2 iso3 year new_sp_m014 new_sp_m1524 new_sp_m2534 #&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; #&gt; 1 Afghan… AF AFG 1980 NA NA NA #&gt; 2 Afghan… AF AFG 1981 NA NA NA #&gt; 3 Afghan… AF AFG 1982 NA NA NA #&gt; 4 Afghan… AF AFG 1983 NA NA NA #&gt; 5 Afghan… AF AFG 1984 NA NA NA #&gt; 6 Afghan… AF AFG 1985 NA NA NA #&gt; 7 Afghan… AF AFG 1986 NA NA NA #&gt; 8 Afghan… AF AFG 1987 NA NA NA #&gt; 9 Afghan… AF AFG 1988 NA NA NA #&gt; 10 Afghan… AF AFG 1989 NA NA NA #&gt; # … with 7,230 more rows, and 53 more variables</code> </pre> <br><p>  Kami membangun spesifikasinya. </p><br><pre> <code class="plaintext hljs">spec &lt;- who %&gt;% pivot_longer_spec(new_sp_m014:newrel_f65, values_to = "count")</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 56 x 3 #&gt; .name .value name #&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; #&gt; 1 new_sp_m014 count new_sp_m014 #&gt; 2 new_sp_m1524 count new_sp_m1524 #&gt; 3 new_sp_m2534 count new_sp_m2534 #&gt; 4 new_sp_m3544 count new_sp_m3544 #&gt; 5 new_sp_m4554 count new_sp_m4554 #&gt; 6 new_sp_m5564 count new_sp_m5564 #&gt; 7 new_sp_m65 count new_sp_m65 #&gt; 8 new_sp_f014 count new_sp_f014 #&gt; 9 new_sp_f1524 count new_sp_f1524 #&gt; 10 new_sp_f2534 count new_sp_f2534 #&gt; # … with 46 more rows</code> </pre> <br><p>  Negara isian, <em>iso2</em> , <em>iso3</em> sudah menjadi variabel.  Tugas kami adalah membalik kolom dari <em>new_sp_m014</em> ke <em>newrel_f65</em> . </p><br><p>  Nama-nama kolom ini menyimpan informasi berikut: </p><br><ul><li>  Awalan <code>new_</code> menunjukkan bahwa kolom berisi data tentang kasus baru tuberkulosis, kerangka tanggal saat ini hanya berisi informasi tentang penyakit baru, oleh karena itu awalan ini dalam konteks saat ini tidak membawa makna apa pun. </li><li>  <code>sp</code> / <code>rel</code> / <code>sp</code> / <code>ep</code> menjelaskan suatu metode untuk mendiagnosis suatu penyakit. </li><li>  <code>m</code> / <code>f</code> jenis kelamin pasien. </li><li>  <code>014</code> rentang usia pasien. </li></ul><br><p>  Kita dapat memisahkan kolom-kolom ini menggunakan fungsi <code>extract()</code> menggunakan ekspresi reguler. </p><br><pre> <code class="plaintext hljs">spec &lt;- spec %&gt;% extract(name, c("diagnosis", "gender", "age"), "new_?(.*)_(.)(.*)")</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 56 x 5 #&gt; .name .value diagnosis gender age #&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; #&gt; 1 new_sp_m014 count sp m 014 #&gt; 2 new_sp_m1524 count sp m 1524 #&gt; 3 new_sp_m2534 count sp m 2534 #&gt; 4 new_sp_m3544 count sp m 3544 #&gt; 5 new_sp_m4554 count sp m 4554 #&gt; 6 new_sp_m5564 count sp m 5564 #&gt; 7 new_sp_m65 count sp m 65 #&gt; 8 new_sp_f014 count sp f 014 #&gt; 9 new_sp_f1524 count sp f 1524 #&gt; 10 new_sp_f2534 count sp f 2534 #&gt; # … with 46 more rows</code> </pre> <br><p>  Perhatikan bahwa kolom <em>.name</em> harus tetap tidak berubah, karena ini adalah indeks kami dalam nama kolom dari dataset sumber. </p><br><p>  Jenis kelamin dan usia ( <em>jenis kelamin</em> dan <em>usia</em> ) memiliki nilai-nilai tetap dan diketahui, oleh karena itu disarankan untuk mengubah kolom ini menjadi faktor: </p><br><pre> <code class="plaintext hljs">spec &lt;- spec %&gt;% mutate( gender = factor(gender, levels = c("f", "m")), age = factor(age, levels = unique(age), ordered = TRUE) )</code> </pre> <br><p>  Akhirnya, untuk menerapkan spesifikasi yang kami buat ke tanggal asli bingkai <em>siapa</em> , kita perlu menggunakan argumen <em>spesifikasi</em> dalam fungsi <code>pivot_longer()</code> . </p><br><p> <code>who %&gt;% pivot_longer(spec = spec)</code> </p> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 405,440 x 8 #&gt; country iso2 iso3 year diagnosis gender age count #&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;fct&gt; &lt;ord&gt; &lt;int&gt; #&gt; 1 Afghanistan AF AFG 1980 sp m 014 NA #&gt; 2 Afghanistan AF AFG 1980 sp m 1524 NA #&gt; 3 Afghanistan AF AFG 1980 sp m 2534 NA #&gt; 4 Afghanistan AF AFG 1980 sp m 3544 NA #&gt; 5 Afghanistan AF AFG 1980 sp m 4554 NA #&gt; 6 Afghanistan AF AFG 1980 sp m 5564 NA #&gt; 7 Afghanistan AF AFG 1980 sp m 65 NA #&gt; 8 Afghanistan AF AFG 1980 sp f 014 NA #&gt; 9 Afghanistan AF AFG 1980 sp f 1524 NA #&gt; 10 Afghanistan AF AFG 1980 sp f 2534 NA #&gt; # … with 405,430 more rows</code> </pre> <br><p>  Segala sesuatu yang baru saja kita lakukan dapat digambarkan secara skematis sebagai berikut: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/90c/84b/16d/90c84b16d3e4c9860b8ced6e411757b3.png" alt="gambar"></p><br><h2 id="specifikaciya-s-ispolzovaniem-neskolkih-znacheniyvalue">  Spesifikasi menggunakan beberapa nilai (.value) </h2><br><p>  Dalam contoh di atas, kolom spesifikasi <em>.value</em> hanya berisi satu nilai, dalam banyak kasus hal ini terjadi. </p><br><p>  Tetapi kadang-kadang situasi mungkin muncul ketika Anda perlu mengumpulkan data dari kolom dengan tipe data yang berbeda dalam nilai.  Menggunakan fungsi <code>spread()</code> digunakan lagi, ini akan cukup sulit. </p><br><p>  Contoh berikut dipinjam dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sketsa</a> untuk paket <strong>data.table</strong> . </p><br><p>  Mari kita buat kerangka data pelatihan. </p><br><pre> <code class="plaintext hljs">family &lt;- tibble::tribble( ~family, ~dob_child1, ~dob_child2, ~gender_child1, ~gender_child2, 1L, "1998-11-26", "2000-01-29", 1L, 2L, 2L, "1996-06-22", NA, 2L, NA, 3L, "2002-07-11", "2004-04-05", 2L, 2L, 4L, "2004-10-10", "2009-08-27", 1L, 1L, 5L, "2000-12-05", "2005-02-28", 2L, 1L, ) family &lt;- family %&gt;% mutate_at(vars(starts_with("dob")), parse_date)</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 5 x 5 #&gt; family dob_child1 dob_child2 gender_child1 gender_child2 #&gt; &lt;int&gt; &lt;date&gt; &lt;date&gt; &lt;int&gt; &lt;int&gt; #&gt; 1 1 1998-11-26 2000-01-29 1 2 #&gt; 2 2 1996-06-22 NA 2 NA #&gt; 3 3 2002-07-11 2004-04-05 2 2 #&gt; 4 4 2004-10-10 2009-08-27 1 1 #&gt; 5 5 2000-12-05 2005-02-28 2 1</code> </pre> <br><p>  Kerangka tanggal yang dibuat di setiap baris berisi data tentang anak-anak dari satu keluarga.  Keluarga dapat memiliki satu atau dua anak.  Untuk setiap anak, data tentang tanggal lahir dan jenis kelamin disediakan, dan data untuk setiap anak dalam kolom terpisah, tugas kami adalah membawa data ini ke format yang benar untuk dianalisis. </p><br><p>  Harap dicatat bahwa kami memiliki dua variabel dengan informasi tentang setiap anak: jenis kelamin dan tanggal lahirnya (kolom dengan awalan <em>dop</em> berisi tanggal lahir, kolom dengan awalan <em>gender</em> berisi jenis kelamin anak).  Dalam hasil yang diharapkan, mereka harus masuk dalam kolom terpisah.  Kita dapat melakukan ini dengan membuat spesifikasi di mana kolom <code>.value</code> akan memiliki dua nilai yang berbeda. </p><br><pre> <code class="plaintext hljs">spec &lt;- family %&gt;% pivot_longer_spec(-family) %&gt;% separate(col = name, into = c(".value", "child"))%&gt;% mutate(child = parse_number(child))</code> </pre><br><pre> <code class="plaintext hljs">#&gt; # A tibble: 4 x 3 #&gt; .name .value child #&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; #&gt; 1 dob_child1 dob 1 #&gt; 2 dob_child2 dob 2 #&gt; 3 gender_child1 gender 1 #&gt; 4 gender_child2 gender 2</code> </pre> <br><p>  Jadi, mari kita melangkah melalui langkah-langkah yang dilakukan oleh kode di atas. </p><br><ul><li>  <code>pivot_longer_spec(-family)</code> - buat spesifikasi yang memampatkan semua kolom yang tersedia kecuali kolom keluarga. </li><li>  <code>separate(col = name, into = c(".value", "child"))</code> - pisahkan kolom <em>.name</em> , yang berisi nama-nama bidang sumber, garis bawah dan masukkan nilainya ke dalam kolom <em>.value</em> dan <em>child</em> . </li><li>  <code>mutate(child = parse_number(child))</code> - mengonversi nilai-nilai bidang <em>anak</em> dari teks ke tipe data numerik. </li></ul><br><p>  Sekarang kita bisa menerapkan spesifikasi yang diterima ke bingkai data awal, dan membawa tabel ke formulir yang diinginkan. </p><br><pre> <code class="plaintext hljs">family %&gt;% pivot_longer(spec = spec, na.rm = T)</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 9 x 4 #&gt; family child dob gender #&gt; &lt;int&gt; &lt;dbl&gt; &lt;date&gt; &lt;int&gt; #&gt; 1 1 1 1998-11-26 1 #&gt; 2 1 2 2000-01-29 2 #&gt; 3 2 1 1996-06-22 2 #&gt; 4 3 1 2002-07-11 2 #&gt; 5 3 2 2004-04-05 2 #&gt; 6 4 1 2004-10-10 1 #&gt; 7 4 2 2009-08-27 1 #&gt; 8 5 1 2000-12-05 2 #&gt; 9 5 2 2005-02-28 1</code> </pre> <br><p>  Kami menggunakan argumen <code>na.rm = TRUE</code> , karena formulir data saat ini memaksa kami untuk membuat baris tambahan untuk pengamatan yang tidak ada.  Karena  keluarga 2 hanya memiliki satu anak, <code>na.rm = TRUE</code> memastikan bahwa keluarga 2 akan memiliki satu baris dalam output. </p><br><h2 id="preobrazovanie-data-freymov-iz-dlinnogo-formata-k-shirokomu">  Mengonversi Frame Tanggal dari Panjang ke Lebar </h2><br><p>  <code>pivot_wider()</code> - adalah transformasi terbalik, dan sebaliknya meningkatkan jumlah kolom dalam tanggal bingkai dengan mengurangi jumlah baris. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b0d/a51/f47/b0da51f47f968a49e485989eba044914.png" alt="gambar"></p><br><p>  Transformasi semacam ini jarang digunakan untuk membawa data ke tampilan yang rapi, namun teknik ini dapat berguna untuk membuat tabel pivot yang digunakan dalam presentasi, atau untuk integrasi dengan alat lain. </p><br><p>  Bahkan, fungsi <code>pivot_longer()</code> dan <code>pivot_wider()</code> simetris, dan mereka melakukan tindakan yang berlawanan, yaitu: <code>df %&gt;% pivot_longer(spec = spec) %&gt;% pivot_wider(spec = spec)</code> dan <code>df %&gt;% pivot_wider(spec = spec) %&gt;% pivot_longer(spec = spec)</code> akan mengembalikan df asli. </p><br><h3 id="prosteyshiy-primer-privedeniya-tablicy-k-shirokomu-formatu">  Contoh paling sederhana dari casting tabel ke format lebar </h3><br><p>  Untuk mendemonstrasikan operasi fungsi <code>pivot_wider()</code> , kami akan menggunakan <em>dataset fish_encounters</em> , yang menyimpan informasi tentang bagaimana berbagai stasiun merekam pergerakan ikan di sepanjang sungai. </p><br><pre> <code class="plaintext hljs">#&gt; # A tibble: 114 x 3 #&gt; fish station seen #&gt; &lt;fct&gt; &lt;fct&gt; &lt;int&gt; #&gt; 1 4842 Release 1 #&gt; 2 4842 I80_1 1 #&gt; 3 4842 Lisbon 1 #&gt; 4 4842 Rstr 1 #&gt; 5 4842 Base_TD 1 #&gt; 6 4842 BCE 1 #&gt; 7 4842 BCW 1 #&gt; 8 4842 BCE2 1 #&gt; 9 4842 BCW2 1 #&gt; 10 4842 MAE 1 #&gt; # … with 104 more rows</code> </pre> <br><p>  Dalam kebanyakan kasus, tabel ini akan lebih informatif dan nyaman digunakan jika Anda memberikan informasi untuk setiap stasiun dalam kolom terpisah. </p><br><p> <code>fish_encounters %&gt;% pivot_wider(names_from = station, values_from = seen)</code> </p> <br><pre> <code class="plaintext hljs">fish_encounters %&gt;% pivot_wider(names_from = station, values_from = seen) #&gt; # A tibble: 19 x 12 #&gt; fish Release I80_1 Lisbon Rstr Base_TD BCE BCW BCE2 BCW2 MAE #&gt; &lt;fct&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; #&gt; 1 4842 1 1 1 1 1 1 1 1 1 1 #&gt; 2 4843 1 1 1 1 1 1 1 1 1 1 #&gt; 3 4844 1 1 1 1 1 1 1 1 1 1 #&gt; 4 4845 1 1 1 1 1 NA NA NA NA NA #&gt; 5 4847 1 1 1 NA NA NA NA NA NA NA #&gt; 6 4848 1 1 1 1 NA NA NA NA NA NA #&gt; 7 4849 1 1 NA NA NA NA NA NA NA NA #&gt; 8 4850 1 1 NA 1 1 1 1 NA NA NA #&gt; 9 4851 1 1 NA NA NA NA NA NA NA NA #&gt; 10 4854 1 1 NA NA NA NA NA NA NA NA #&gt; # … with 9 more rows, and 1 more variable: MAW &lt;int&gt;</code> </pre> <br><p>  Kumpulan data ini mencatat informasi hanya ketika ikan terdeteksi oleh stasiun, mis.  jika ada ikan yang tidak diperbaiki oleh beberapa stasiun, maka data ini tidak akan ada dalam tabel.  Ini berarti bahwa output akan diisi oleh NA. </p><br><p>  Namun, dalam kasus ini, kita tahu bahwa tidak adanya catatan berarti bahwa ikan tidak diperhatikan, sehingga kita dapat menggunakan argumen <em>values_fill</em> dalam fungsi <code>pivot_wider()</code> dan mengisi nilai-nilai yang hilang ini dengan nol: </p><br><pre> <code class="plaintext hljs">fish_encounters %&gt;% pivot_wider( names_from = station, values_from = seen, values_fill = list(seen = 0) )</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 19 x 12 #&gt; fish Release I80_1 Lisbon Rstr Base_TD BCE BCW BCE2 BCW2 MAE #&gt; &lt;fct&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; #&gt; 1 4842 1 1 1 1 1 1 1 1 1 1 #&gt; 2 4843 1 1 1 1 1 1 1 1 1 1 #&gt; 3 4844 1 1 1 1 1 1 1 1 1 1 #&gt; 4 4845 1 1 1 1 1 0 0 0 0 0 #&gt; 5 4847 1 1 1 0 0 0 0 0 0 0 #&gt; 6 4848 1 1 1 1 0 0 0 0 0 0 #&gt; 7 4849 1 1 0 0 0 0 0 0 0 0 #&gt; 8 4850 1 1 0 1 1 1 1 0 0 0 #&gt; 9 4851 1 1 0 0 0 0 0 0 0 0 #&gt; 10 4854 1 1 0 0 0 0 0 0 0 0 #&gt; # … with 9 more rows, and 1 more variable: MAW &lt;int&gt;</code> </pre> <br><h3 id="generaciya-imeni-stolbca-iz-neskolkih-ishodnyh-peremennyh">  Menghasilkan nama kolom dari beberapa variabel sumber </h3><br><p>  Bayangkan kita memiliki tabel yang berisi kombinasi produk, negara, dan tahun.  Untuk menghasilkan tanggal bingkai uji, Anda dapat menjalankan kode berikut: </p><br><pre> <code class="plaintext hljs">df &lt;- expand_grid( product = c("A", "B"), country = c("AI", "EI"), year = 2000:2014 ) %&gt;% filter((product == "A" &amp; country == "AI") | product == "B") %&gt;% mutate(value = rnorm(nrow(.)))</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 45 x 4 #&gt; product country year value #&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; #&gt; 1 A AI 2000 -2.05 #&gt; 2 A AI 2001 -0.676 #&gt; 3 A AI 2002 1.60 #&gt; 4 A AI 2003 -0.353 #&gt; 5 A AI 2004 -0.00530 #&gt; 6 A AI 2005 0.442 #&gt; 7 A AI 2006 -0.610 #&gt; 8 A AI 2007 -2.77 #&gt; 9 A AI 2008 0.899 #&gt; 10 A AI 2009 -0.106 #&gt; # … with 35 more rows</code> </pre> <br><p>  Tugas kami adalah memperluas kerangka tanggal sehingga satu kolom berisi data untuk setiap kombinasi produk dan negara.  Untuk melakukan ini, cukup lewati vektor yang berisi nama-nama bidang yang akan digabungkan ke argumen <em>names_from</em> . </p><br><pre> <code class="plaintext hljs">df %&gt;% pivot_wider(names_from = c(product, country), values_from = "value")</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 15 x 4 #&gt; year A_AI B_AI B_EI #&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; #&gt; 1 2000 -2.05 0.607 1.20 #&gt; 2 2001 -0.676 1.65 -0.114 #&gt; 3 2002 1.60 -0.0245 0.501 #&gt; 4 2003 -0.353 1.30 -0.459 #&gt; 5 2004 -0.00530 0.921 -0.0589 #&gt; 6 2005 0.442 -1.55 0.594 #&gt; 7 2006 -0.610 0.380 -1.28 #&gt; 8 2007 -2.77 0.830 0.637 #&gt; 9 2008 0.899 0.0175 -1.30 #&gt; 10 2009 -0.106 -0.195 1.03 #&gt; # … with 5 more rows</code> </pre> <br><p>  Anda juga dapat menerapkan spesifikasi ke fungsi <code>pivot_wider()</code> .  Tetapi ketika dipasok ke <code>pivot_wider()</code> spesifikasi melakukan kebalikan dari <code>pivot_longer()</code> : kolom yang ditentukan dalam <em>.name</em> dibuat menggunakan nilai dari <em>.value</em> dan kolom lainnya. </p><br><p>  Untuk rangkaian data ini, Anda dapat membuat spesifikasi pengguna jika Anda ingin setiap kombinasi negara dan produk yang mungkin memiliki kolom sendiri, dan bukan hanya yang ada dalam data: </p><br><pre> <code class="plaintext hljs">spec &lt;- df %&gt;% expand(product, country, .value = "value") %&gt;% unite(".name", product, country, remove = FALSE)</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 4 x 4 #&gt; .name product country .value #&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; #&gt; 1 A_AI A AI value #&gt; 2 A_EI A EI value #&gt; 3 B_AI B AI value #&gt; 4 B_EI B EI value</code> </pre> <br><pre> <code class="plaintext hljs">df %&gt;% pivot_wider(spec = spec) %&gt;% head()</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 6 x 5 #&gt; year A_AI A_EI B_AI B_EI #&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; #&gt; 1 2000 -2.05 NA 0.607 1.20 #&gt; 2 2001 -0.676 NA 1.65 -0.114 #&gt; 3 2002 1.60 NA -0.0245 0.501 #&gt; 4 2003 -0.353 NA 1.30 -0.459 #&gt; 5 2004 -0.00530 NA 0.921 -0.0589 #&gt; 6 2005 0.442 NA -1.55 0.594</code> </pre> <br><h2 id="neskolko-prodvinutyh-primerov-raboty-s-novoy-koncepciey-tidyr">  Beberapa contoh canggih bekerja dengan konsep tidyr baru </h2><br><h3 id="privedenie-dannyh-k-akkuratnomu-vidu-na-primere-nabora-dannyh-o-perepisi-dohoda-i-arendnoy-platy-v-ssha">  Membawa data ke tampilan yang rapi menggunakan dataset sensus pendapatan dan sewa AS sebagai contoh </h3><br><p>  <em>Dataset us_rent_income</em> berisi informasi tentang pendapatan rata-rata dan sewa untuk setiap negara bagian di Amerika Serikat untuk 2017 (dataset tersedia dalam paket <strong>tidycensus</strong> ). </p><br><pre> <code class="plaintext hljs">us_rent_income #&gt; # A tibble: 104 x 5 #&gt; GEOID NAME variable estimate moe #&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; #&gt; 1 01 Alabama income 24476 136 #&gt; 2 01 Alabama rent 747 3 #&gt; 3 02 Alaska income 32940 508 #&gt; 4 02 Alaska rent 1200 13 #&gt; 5 04 Arizona income 27517 148 #&gt; 6 04 Arizona rent 972 4 #&gt; 7 05 Arkansas income 23789 165 #&gt; 8 05 Arkansas rent 709 5 #&gt; 9 06 California income 29454 109 #&gt; 10 06 California rent 1358 3 #&gt; # … with 94 more rows</code> </pre> <br><p>  Sangat tidak nyaman untuk bekerja dengan mereka dalam bentuk penyimpanan data di us_rent_income, jadi kami ingin membuat kumpulan data dengan kolom: <em>rent</em> , <em>rent_moe</em> , <em>come</em> , <em>income_moe</em> .  Ada banyak cara untuk membuat spesifikasi ini, tetapi yang utama adalah kita perlu menghasilkan setiap kombinasi dari nilai variabel dan <em>estimasi / moe</em> , dan kemudian menghasilkan nama kolom. </p><br><pre> <code class="plaintext hljs"> spec &lt;- us_rent_income %&gt;% expand(variable, .value = c("estimate", "moe")) %&gt;% mutate( .name = paste0(variable, ifelse(.value == "moe", "_moe", "")) )</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 4 x 3 #&gt; variable .value .name #&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; #&gt; 1 income estimate income #&gt; 2 income moe income_moe #&gt; 3 rent estimate rent #&gt; 4 rent moe rent_moe</code> </pre> <br><p>  Memberikan spesifikasi ini ke <code>pivot_wider()</code> memberi kami hasil yang kami cari: </p><br><p> <code>us_rent_income %&gt;% pivot_wider(spec = spec)</code> </p> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 52 x 6 #&gt; GEOID NAME income income_moe rent rent_moe #&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; #&gt; 1 01 Alabama 24476 136 747 3 #&gt; 2 02 Alaska 32940 508 1200 13 #&gt; 3 04 Arizona 27517 148 972 4 #&gt; 4 05 Arkansas 23789 165 709 5 #&gt; 5 06 California 29454 109 1358 3 #&gt; 6 08 Colorado 32401 109 1125 5 #&gt; 7 09 Connecticut 35326 195 1123 5 #&gt; 8 10 Delaware 31560 247 1076 10 #&gt; 9 11 District of Columbia 43198 681 1424 17 #&gt; 10 12 Florida 25952 70 1077 3 #&gt; # … with 42 more rows</code> </pre> <br><h3 id="vsemirnyy-bank">  Bank Dunia </h3><br><p>  Terkadang membawa set data ke formulir yang tepat membutuhkan beberapa langkah. <br>  <em>Dataset</em> world_bank_pop berisi data dari Bank Dunia tentang populasi setiap negara dari 2000 hingga 2018. </p><br><pre> <code class="plaintext hljs">#&gt; # A tibble: 1,056 x 20 #&gt; country indicator `2000` `2001` `2002` `2003` `2004` `2005` `2006` #&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; #&gt; 1 ABW SP.URB.T… 4.24e4 4.30e4 4.37e4 4.42e4 4.47e+4 4.49e+4 4.49e+4 #&gt; 2 ABW SP.URB.G… 1.18e0 1.41e0 1.43e0 1.31e0 9.51e-1 4.91e-1 -1.78e-2 #&gt; 3 ABW SP.POP.T… 9.09e4 9.29e4 9.50e4 9.70e4 9.87e+4 1.00e+5 1.01e+5 #&gt; 4 ABW SP.POP.G… 2.06e0 2.23e0 2.23e0 2.11e0 1.76e+0 1.30e+0 7.98e-1 #&gt; 5 AFG SP.URB.T… 4.44e6 4.65e6 4.89e6 5.16e6 5.43e+6 5.69e+6 5.93e+6 #&gt; 6 AFG SP.URB.G… 3.91e0 4.66e0 5.13e0 5.23e0 5.12e+0 4.77e+0 4.12e+0 #&gt; 7 AFG SP.POP.T… 2.01e7 2.10e7 2.20e7 2.31e7 2.41e+7 2.51e+7 2.59e+7 #&gt; 8 AFG SP.POP.G… 3.49e0 4.25e0 4.72e0 4.82e0 4.47e+0 3.87e+0 3.23e+0 #&gt; 9 AGO SP.URB.T… 8.23e6 8.71e6 9.22e6 9.77e6 1.03e+7 1.09e+7 1.15e+7 #&gt; 10 AGO SP.URB.G… 5.44e0 5.59e0 5.70e0 5.76e0 5.75e+0 5.69e+0 4.92e+0 #&gt; # … with 1,046 more rows, and 11 more variables: `2007` &lt;dbl&gt;, #&gt; # `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;, `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, #&gt; # `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;, `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;</code> </pre> <br><p>  Tujuan kami adalah untuk membuat dataset yang rapi di mana setiap variabel berada di kolom terpisah.  Belum jelas langkah mana yang diperlukan, tetapi kami akan mulai dengan masalah yang paling jelas: tahun didistribusikan di beberapa kolom. </p><br><p>  Untuk memperbaikinya, Anda harus menggunakan fungsi <code>pivot_longer()</code> . </p><br><pre> <code class="plaintext hljs">pop2 &lt;- world_bank_pop %&gt;% pivot_longer(`2000`:`2017`, names_to = "year")</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 19,008 x 4 #&gt; country indicator year value #&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; #&gt; 1 ABW SP.URB.TOTL 2000 42444 #&gt; 2 ABW SP.URB.TOTL 2001 43048 #&gt; 3 ABW SP.URB.TOTL 2002 43670 #&gt; 4 ABW SP.URB.TOTL 2003 44246 #&gt; 5 ABW SP.URB.TOTL 2004 44669 #&gt; 6 ABW SP.URB.TOTL 2005 44889 #&gt; 7 ABW SP.URB.TOTL 2006 44881 #&gt; 8 ABW SP.URB.TOTL 2007 44686 #&gt; 9 ABW SP.URB.TOTL 2008 44375 #&gt; 10 ABW SP.URB.TOTL 2009 44052 #&gt; # … with 18,998 more rows</code> </pre> <br><p>   —   indicator. <br> <code>pop2 %&gt;% count(indicator)</code> </p> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 4 x 2 #&gt; indicator n #&gt; &lt;chr&gt; &lt;int&gt; #&gt; 1 SP.POP.GROW 4752 #&gt; 2 SP.POP.TOTL 4752 #&gt; 3 SP.URB.GROW 4752 #&gt; 4 SP.URB.TOTL 4752</code> </pre> <br><p>  SP.POP.GROW —  , SP.POP.TOTL —   ,  SP.URB. *  ,     .       : area —  (total  urban)      (population  growth): </p><br><pre> <code class="plaintext hljs">pop3 &lt;- pop2 %&gt;% separate(indicator, c(NA, "area", "variable"))</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 19,008 x 5 #&gt; country area variable year value #&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; #&gt; 1 ABW URB TOTL 2000 42444 #&gt; 2 ABW URB TOTL 2001 43048 #&gt; 3 ABW URB TOTL 2002 43670 #&gt; 4 ABW URB TOTL 2003 44246 #&gt; 5 ABW URB TOTL 2004 44669 #&gt; 6 ABW URB TOTL 2005 44889 #&gt; 7 ABW URB TOTL 2006 44881 #&gt; 8 ABW URB TOTL 2007 44686 #&gt; 9 ABW URB TOTL 2008 44375 #&gt; 10 ABW URB TOTL 2009 44052 #&gt; # … with 18,998 more rows</code> </pre> <br><p>       variable   : </p><br><pre> <code class="plaintext hljs">pop3 %&gt;% pivot_wider(names_from = variable, values_from = value)</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 9,504 x 5 #&gt; country area year TOTL GROW #&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; #&gt; 1 ABW URB 2000 42444 1.18 #&gt; 2 ABW URB 2001 43048 1.41 #&gt; 3 ABW URB 2002 43670 1.43 #&gt; 4 ABW URB 2003 44246 1.31 #&gt; 5 ABW URB 2004 44669 0.951 #&gt; 6 ABW URB 2005 44889 0.491 #&gt; 7 ABW URB 2006 44881 -0.0178 #&gt; 8 ABW URB 2007 44686 -0.435 #&gt; 9 ABW URB 2008 44375 -0.698 #&gt; 10 ABW URB 2009 44052 -0.731 #&gt; # … with 9,494 more rows</code> </pre> <br><h3 id="spisok-kontaktov">   </h3><br><p>  , ,      ,       -: </p><br><pre> <code class="plaintext hljs">contacts &lt;- tribble( ~field, ~value, "name", "Jiena McLellan", "company", "Toyota", "name", "John Smith", "company", "google", "email", "john@google.com", "name", "Huxley Ratcliffe" )</code> </pre> <br><p>        ,    ,   ,     .    , ,          ("name"),      ,       ,    field   “name”: </p><br><pre> <code class="plaintext hljs">contacts &lt;- contacts %&gt;% mutate( person_id = cumsum(field == "name") ) contacts</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 6 x 3 #&gt; field value person_id #&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; #&gt; 1 name Jiena McLellan 1 #&gt; 2 company Toyota 1 #&gt; 3 name John Smith 2 #&gt; 4 company google 2 #&gt; 5 email john@google.com 2 #&gt; 6 name Huxley Ratcliffe 3</code> </pre> <br><p> ,         ,        : </p><br><pre> <code class="plaintext hljs">contacts %&gt;% pivot_wider(names_from = field, values_from = value)</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 3 x 4 #&gt; person_id name company email #&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; #&gt; 1 1 Jiena McLellan Toyota &lt;NA&gt; #&gt; 2 2 John Smith google john@google.com #&gt; 3 3 Huxley Ratcliffe &lt;NA&gt; &lt;NA&gt;</code> </pre> <br><h2 id="zaklyuchenie">  Kesimpulan </h2><br><p>   ,    <strong>tidyr</strong>    ,        <code>spread()</code>  <code>gather()</code> .        <code>pivot_longer()</code>  <code>pivot_wider()</code> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id444622/">https://habr.com/ru/post/id444622/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id444610/index.html">Statistik dan pemantauan skrip PHP secara real time. ClickHouse dan Grafana pergi untuk membantu Pinba</a></li>
<li><a href="../id444612/index.html">Kerugian makro untuk kode C ++</a></li>
<li><a href="../id444614/index.html">Seluruh sejarah Linux. Bagian II: pasang surut perusahaan</a></li>
<li><a href="../id444616/index.html">Membuat Perekam Suara Android Anda Sendiri Menggunakan Kotlin</a></li>
<li><a href="../id444620/index.html">Menggunakan File Urutan Kernel Linux</a></li>
<li><a href="../id444624/index.html">Mobil listrik terbakar dan mandi</a></li>
<li><a href="../id444630/index.html">Meja informasi: inisiatif Internet global</a></li>
<li><a href="../id444634/index.html">Epic Games memberi pengembang $ 100 juta</a></li>
<li><a href="../id444636/index.html">Mengapa saya tidak dapat tumbuh demi uang</a></li>
<li><a href="../id444638/index.html">QA pada CodeFest. Otomasi, manajemen, infrastruktur, penjualan kue di toko</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>