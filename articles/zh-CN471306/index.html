<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¦… ğŸ”­ ğŸ•£ ç”¨äºSailfish OSçš„Continent-AP VPNæ’ä»¶çš„å¼€å‘ ğŸ˜  ğŸ§—ğŸ¿ ğŸ¤›ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¼•è¨€ 
 æˆ‘åœ¨Security Codeå…¬å¸çš„ç§»åŠ¨å¹³å°å®‰å…¨å·¥å…·çš„å¼€å‘å’Œæµ‹è¯•éƒ¨é—¨æ‹…ä»»ç¨‹åºå‘˜ã€‚ ç§»åŠ¨å¼€å‘å›¢é˜Ÿçš„ä»»åŠ¡æ˜¯ç§»æ¤è®¢æˆ·ç«™çš„Continent-APè·¨å¹³å°åº“ï¼Œè¯¥åº“å·²åœ¨IOSå’ŒAndroidä¸ŠæˆåŠŸè¿è¡Œã€‚ ä¸»è¦é—®é¢˜æ˜¯Sailfish OSçš„æ–‡æ¡£è®°å½•ä¸å¦‚Androidæˆ–IOSï¼Œä½†è¦æ„Ÿè°¢å…±äº«æ–‡æ¡£çš„Open ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ç”¨äºSailfish OSçš„Continent-AP VPNæ’ä»¶çš„å¼€å‘</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471306/"><h3> å¼•è¨€ </h3><br> æˆ‘åœ¨Security Codeå…¬å¸çš„ç§»åŠ¨å¹³å°å®‰å…¨å·¥å…·çš„å¼€å‘å’Œæµ‹è¯•éƒ¨é—¨æ‹…ä»»ç¨‹åºå‘˜ã€‚ ç§»åŠ¨å¼€å‘å›¢é˜Ÿçš„ä»»åŠ¡æ˜¯ç§»æ¤è®¢æˆ·ç«™çš„Continent-APè·¨å¹³å°åº“ï¼Œè¯¥åº“å·²åœ¨IOSå’ŒAndroidä¸ŠæˆåŠŸè¿è¡Œã€‚ ä¸»è¦é—®é¢˜æ˜¯Sailfish OSçš„æ–‡æ¡£è®°å½•ä¸å¦‚Androidæˆ–IOSï¼Œä½†è¦æ„Ÿè°¢å…±äº«æ–‡æ¡£çš„Open Mobile Platformsçš„äººå‘˜ã€‚ <br><a name="habracut"></a><br><h3>  Sailfish OSä¸­çš„VPN APIæ¶æ„ </h3><br> å¯¹äºSailfish OSä¸­çš„æ‰€æœ‰ç½‘ç»œè¿æ¥ï¼ŒConnManæœåŠ¡è´Ÿè´£ï¼š <br><br><ul><li> æ‰«æWi-Fiç½‘ç»œå’Œèœ‚çªç½‘ç»œå¹¶è¿æ¥åˆ°å®ƒä»¬ï¼› </li><li> å…±äº«è¿æ¥ï¼ˆWi-Fiçƒ­ç‚¹ï¼‰ï¼› </li><li> ç¿»è¯‘ï¼Œè¾“å‡ºä¸é£è¡Œæ¨¡å¼çš„è¿æ¥ï¼› </li><li>  VPNè¿æ¥ç®¡ç†ã€‚ </li></ul><br> æˆ‘å°†æ›´è¯¦ç»†åœ°è®¨è®ºæœ€åä¸€ç‚¹ã€‚  ConnManæœ‰å‡ ç§ç±»å‹çš„é¢„å®šä¹‰VPNæ’ä»¶ã€‚ ç”¨äºåˆ›å»ºå’Œé…ç½®è¿æ¥çš„QMLå°éƒ¨ä»¶å·²é›†æˆåˆ°å›ºä»¶ä¸­ã€‚ <br><br><img src="https://habrastorage.org/webt/v7/2d/es/v72desnzu4zeyymbx3wea1sddie.jpeg" alt="å›¾ç‰‡"><br>  <i>å›¾</i>  <i>1ä¸ªç”¨äºé…ç½®å’Œç®¡ç†VPNè¿æ¥çš„Sailfish OSç³»ç»Ÿèœå•</i> <br><br> æˆ‘ä»¬çš„VPNå®¢æˆ·ç«¯çš„ç”¨æˆ·ç•Œé¢æ˜¯RPMè½¯ä»¶åŒ…ï¼Œåœ¨å®‰è£…è¿‡ç¨‹ä¸­ä¸ä¼šé›†æˆåˆ°â€œè®¾ç½®â€éƒ¨åˆ†çš„â€œ VPNç³»ç»Ÿâ€çª—å£ä¸­ï¼Œè€Œæ˜¯ä¸€ä¸ªå•ç‹¬çš„åº”ç”¨ç¨‹åºã€‚ å¯èƒ½ä¼šæœ‰å•ç‹¬çš„æ–‡ç« ä»‹ç»UIçš„å¼€å‘ï¼Œå› æ­¤ä¸‹ä¸€ä¸ªæ•…äº‹æ˜¯æœ‰å…³C / C ++ä¸­ConnManæ’ä»¶çš„å¼€å‘çš„ã€‚ <br><br><img src="https://habrastorage.org/webt/-r/ln/rr/-rlnrrdy51kputzfnk6nj-r-bs0.jpeg" alt="å›¾ç‰‡"><br>  <i>å›¾</i>  <i>2ä¸ªSailfishçš„Continent-AP GUI</i> <br><br>  VPN-api Sailfishæ“ä½œç³»ç»ŸåŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼Œæˆ‘ä»¬å°†ä»¥æˆ‘ä»¬çš„VPNå®¢æˆ·ç«¯ç¤ºä¾‹è¿›è¡Œå±•ç¤ºï¼š <br><br><ol><li>  ConnManæ˜¯åœ¨Sailfish OSå¯åŠ¨æ—¶å¯åŠ¨çš„è¿‡ç¨‹ã€‚ </li><li>  connman-vpndæ˜¯ç”±ConnManå¯åŠ¨çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œç”¨äºç®¡ç†å„ç§æä¾›ç¨‹åºçš„VPNè¿æ¥ï¼Œåˆå§‹åŒ–å’Œå–æ¶ˆåˆå§‹åŒ–tunæ¥å£ï¼Œä»¥åŠå°†é€šè¿‡DBusæ¥æ”¶çš„ç½‘ç»œè®¾ç½®ï¼ˆIPåœ°å€ï¼Œè·¯ç”±ï¼ŒDNSæœåŠ¡å™¨ï¼‰åˆ†é…ç»™å®ƒã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œä¸€ä¸ªæä¾›è€…åä¸ºå¤§æ´²ã€‚ </li><li>  continent-proto-plugin.so VPNæ’ä»¶æ˜¯ä¸€ä¸ªåº“ï¼Œè¯¥åº“å…·æœ‰ç”¨äºåŠ è½½åˆ°è¿è¡Œæ—¶çš„å®å£°æ˜ä»¥åŠåœ¨è°ƒç”¨net.connman.vpn.Connectionæ¥å£æ–¹æ³•æ—¶è°ƒç”¨çš„å‡½æ•°ã€‚ </li><li> åå°åº”ç”¨ç¨‹åºï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶/ usr / sbin / continentï¼‰æ˜¯ä¸€ä¸ªæ§åˆ¶å°å®¢æˆ·ç«¯ï¼Œç”¨äºè¿æ¥åˆ°CDï¼ˆContinent Access Serverï¼‰ï¼Œå¹¶ä»ä¸­æ¥æ”¶ç½‘ç»œè®¾ç½®ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™connman-vpndã€‚ </li><li>  ConnMan Taskæ˜¯ç”¨äºå¯åŠ¨ï¼Œåœæ­¢å’Œç›‘è§†æ­£åœ¨è¿è¡Œçš„æ§åˆ¶å°å®¢æˆ·ç«¯çš„è¿‡ç¨‹ã€‚ </li><li>  DBus-api-ä»£è¡¨connman-vpndï¼Œå³net.connman.vpnï¼Œå…¶æ¥å£ä¸ºnet.connman.vpn.Managerï¼Œnet.connman.vpn.Connectionã€‚ </li></ol><br><img src="https://habrastorage.org/webt/lk/lt/gg/lkltggz6cpyn9dor5rpcacd-_kq.jpeg" alt="å›¾ç‰‡"><br>  <i>å›¾</i>  <i>3â€œ Continent-APâ€æ——é±¼ä¸­ç»„ä»¶ä¹‹é—´çš„ç›¸äº’ä½œç”¨</i> <br><br><h3>  VPNæ’ä»¶ </h3><br> æ‰€æœ‰ä¸å±äºConnManå‘è¡Œç‰ˆçš„ç¬¬ä¸‰æ–¹æ’ä»¶éƒ½ä»£è¡¨è¯¥åº“ï¼Œå¹¶ä¸”åœ¨é€šè¿‡è½¯ä»¶åŒ…ç®¡ç†å™¨è¿›è¡Œå®‰è£…æ—¶ï¼Œåº”å°†å…¶æ”¾ç½®åœ¨/ usr / lib / connman / plugins-vpn /ä¸­ã€‚ <br><br> æ’ä»¶å¯èƒ½å…·æœ‰é…ç½®æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­æˆ‘ä»¬æŒ‡ç¤ºä»å“ªä¸ªç”¨æˆ·è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶è§„å®šå…¶æƒé™ã€‚ è¯¥æ–‡ä»¶åº”ä½äº/etc/connman/vpn-plugin/continent.confè·¯å¾„ä¸‹çš„ç³»ç»Ÿä¸­ï¼Œå…¶åç§°åº”ä¸æˆ‘ä»¬çš„æä¾›è€…çš„åç§°ç›¸å¯¹åº”ï¼Œåœ¨æœ¬ä¾‹ä¸­ä¸ºcontinent.confã€‚ <br><br> æ–‡ä»¶å†…å®¹ä¾‹å¦‚ï¼š <br><br><pre><code class="plaintext hljs">[VPN Binary] User = nemo Group = vpn SupplementaryGroups = inet,net_admin</code> </pre> <br> ä½¿ç”¨å®CONNMAN_PLUGIN_DEFINEï¼ˆåç§°ï¼Œæè¿°ï¼Œç‰ˆæœ¬ï¼Œinitï¼Œexitï¼‰æ³¨å†ŒConnManä¸­çš„continent-proto-plugin.soæ’ä»¶ï¼Œåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œå®è°ƒç”¨å°†å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="cpp hljs">CONNMAN_PLUGIN_DEFINE(continent, <span class="hljs-string"><span class="hljs-string">"continent VPN plugin"</span></span>, CONNMAN_VERSION, CONNMAN_PLUGIN_PRIORITY_DEFAULT, continent_init, continent_exit);</code> </pre><br> åç§°ï¼ˆå¤§é™†ï¼‰å‚æ•°å¿…é¡»ä¸å¸¦å¼•å·ã€‚ ä¾‹å¦‚ï¼Œå½“åœ¨RPMå®‰è£…è¿‡ç¨‹ä¸­è°ƒç”¨systemctl restart connmanæ—¶ï¼Œå°†åœ¨åŠ è½½å’Œå¸è½½æ’ä»¶æ—¶è°ƒç”¨continent_initï¼Œcontinent_exitå‡½æ•°ã€‚  continent_initå‡½æ•°å¯è°ƒç”¨vpn_registerå’Œconnman_dbus_get_connectionå‡½æ•°ã€‚ <br><br><pre> <code class="plaintext hljs">vpn_register(name, driver, binary_path)</code> </pre> <br> åç§°-æ­£åœ¨æ³¨å†Œçš„æä¾›è€…çš„åç§°ï¼Œåœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ä¸ºâ€œå¤§é™†â€ï¼› <br>  driver-struct vpn_driverç»“æ„ï¼ŒåŒ…å«æŒ‡å‘å›è°ƒå‡½æ•°çš„æŒ‡é’ˆï¼Œä¾‹å¦‚ï¼Œé€šè¿‡DBusè®¿é—®æ’ä»¶æ—¶ï¼› <br>  binary_path-äºŒè¿›åˆ¶æ–‡ä»¶çš„è·¯å¾„ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯â€œ / usr / sbin / continentâ€ã€‚ <br><br>  connman_dbus_get_connectionå‡½æ•°å…è®¸æ‚¨è·å–å·²å»ºç«‹çš„DBusè¿æ¥DBusConnection *è¿æ¥ã€‚ <br><br> éœ€è¦ä½¿ç”¨continent_exitå‡½æ•°æ‰èƒ½åœ¨ConnManä¸­æ³¨é”€æ’ä»¶å¹¶å…³é—­DBusè¿æ¥ã€‚ <br><br> å½“DBusè°ƒç”¨net.connman.vpn.Manager.Createæ–¹æ³•æ—¶ï¼Œå°†åˆ›å»ºä¸€ä¸ªVPNæä¾›ç¨‹åºå®ä¾‹ï¼Œå¹¶åœ¨/var/lib/connman/provider_${Hostasket_{VPN.Domain}ç›®å½•ä¸­ä¸ºå…¶è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªè®¾ç½®æ–‡ä»¶ã€‚ é€šè¿‡è°ƒç”¨net.connman.vpn.Manager.Removeåˆ é™¤æä¾›ç¨‹åºã€‚ è°ƒç”¨net.connman.vpn.Connection.Connectæ–¹æ³•æ—¶ï¼Œè®¾ç½®å°†åŠ è½½åˆ°åˆ›å»ºçš„struct vpn_provider *æä¾›ç¨‹åºä¸­ã€‚ <br><br> æˆ‘ä¹Ÿæƒ³è°ˆè°ˆstruct vpn_driverä¸­çš„ä¸€äº›åŠŸèƒ½ï¼Œå…¶ä¸­ä¸€äº›åŠŸèƒ½æ˜¯å®ç°æ‰€å¿…éœ€çš„ã€‚ <br><br>  connect-é€šè¿‡DBusä½¿ç”¨DBuså¯¹è±¡çš„ç›¸åº”åœ°å€è°ƒç”¨net.connman.vpn.Connection.Connectæ—¶è°ƒç”¨çš„å›è°ƒï¼Œå…¶ç­¾åä¸ºï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">continent_connect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( struct vpn_provider *provider, struct connman_task *task, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *if_name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">vpn_provider_connect_cb_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cb, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *dbus_sender, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *user_data)</span></span></span></span></code> </pre><br> æ­¤å›è°ƒçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯struct connman_task *ä»»åŠ¡ï¼Œå®ƒå°†è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½†æ˜¯æ‚¨éœ€è¦åœ¨å¯åŠ¨ä¹‹å‰ä¼ é€’å‚æ•°ï¼Œä¾‹å¦‚ï¼ŒæœåŠ¡å™¨çš„ä¸»æœºå’Œç«¯å£ï¼š <br><br><pre> <code class="cpp hljs">connman_task_add_argument(task, <span class="hljs-string"><span class="hljs-string">"--host"</span></span>, value); connman_task_add_argument(task, <span class="hljs-string"><span class="hljs-string">"--port"</span></span>, value);</code> </pre> <br> æˆ‘ä»¬å°†ä¸€äº›å‚æ•°å­˜å‚¨åœ¨æä¾›ç¨‹åºå¯¹è±¡å®ä¾‹çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œå¹¶é€šè¿‡è°ƒç”¨vpn_provider_get_stringå‡½æ•°æ¥è·å–å®ƒï¼Œä¾‹å¦‚ï¼š <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> * value = vpn_provider_get_string(provider , â€œHostâ€)</code> </pre> <br> å…¶ä¸­provideræ˜¯struct vpn_providerçš„å®ä¾‹ã€‚ <br><br><pre> <code class="cpp hljs">connman_task_add_argument(task, <span class="hljs-string"><span class="hljs-string">"--dev-name"</span></span>, if_name).</code> </pre> <br> ä¸Šé¢çš„è¡Œè¯´æ˜äº†ConnMan-vpndåˆå§‹åŒ–çš„è™šæ‹Ÿæ¥å£çš„åç§°ï¼Œå¹¶æä¾›äº†ä»ä¸ºVPNæä¾›ç¨‹åºçš„å½“å‰å®ä¾‹å¼•å‘çš„TUNæ¥å£å®ä¾‹è¯»å–å’Œå†™å…¥IPæ•°æ®åŒ…çš„åŠŸèƒ½ã€‚ åœ¨åå°è¿‡ç¨‹ä¸­ï¼Œæ‰“å¼€è®¾å¤‡å¹¶è·å¾—ç”¨äºè¯»å–/å†™å…¥çš„æ–‡ä»¶æè¿°ç¬¦ä»ç„¶æ˜¯æˆ‘ä»¬çš„å·¥ä½œã€‚ <br><br> ç®€çŸ­è¯´æ˜ï¼šåœ¨æ’ä»¶å¼€å‘æœŸé—´ï¼Œäº‹å®è¯æ˜TUNæ¥å£è¢«æå‡ä¸ºé»˜è®¤è·¯ç”±æ¥å£ã€‚ <br><br><pre> <code class="cpp hljs">connman_task_add_argument(task, <span class="hljs-string"><span class="hljs-string">"--dbus-busname"</span></span>, dbus_bus_get_unique_name(connection)); connman_task_add_argument(task, <span class="hljs-string"><span class="hljs-string">"--dbus-interface"</span></span>, CONNMAN_TASK_INTERFACE); connman_task_add_argument(task, <span class="hljs-string"><span class="hljs-string">"--dbus-path"</span></span>, connman_task_get_path(task));</code> </pre> <br> ä¸ºäº†åœ¨åå°åº”ç”¨ç¨‹åºå’ŒVPNæ’ä»¶ä¹‹é—´æä¾›åé¦ˆï¼Œæˆ‘ä»¬å°†ConnManTask DBusåœ°å€å’Œè·¯å¾„ä¼ é€’åˆ°å½“å‰å®ä¾‹ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åˆå§‹åŒ–å‡½æ•°ä¸­è°ƒç”¨connman_dbus_get_connectionã€‚ <br><br> æˆ‘ä»¬å¼€å§‹åå°è¿‡ç¨‹ï¼š <br><br><pre> <code class="cpp hljs">err = connman_task_run(task, continent_died, data, &amp;data-&gt;stdin_fd, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>);</code> </pre> <br>  continent_died-åå°è¿›ç¨‹ç»ˆæ­¢æ—¶è°ƒç”¨çš„å›è°ƒã€‚ åœ¨å…¶ä¸­ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†ç»ˆæ­¢è¿›ç¨‹ï¼Œéƒ¨ç½²å†…å­˜ï¼Œåˆ é™¤æ·»åŠ çš„è·¯ç”±çš„é”™è¯¯ä»£ç ã€‚ <br><br>  notify-å›è°ƒï¼Œå½“é€šè¿‡DBusè°ƒç”¨net.connman.Task.notifyæ—¶è°ƒç”¨ï¼Œå…¶ä¸­æˆ‘ä»¬ä»æ­£åœ¨è¿è¡Œçš„åå°åº”ç”¨ç¨‹åºæ¥æ”¶DBusæ¶ˆæ¯ã€‚ æœ€ä¸»è¦çš„æ˜¯ç½‘ç»œå‚æ•°çš„ä¼ è¾“ï¼šTUNæ¥å£çš„åœ°å€ï¼Œè™šæ‹Ÿç½‘ç»œä¸­çš„DNSæœåŠ¡å™¨ç­‰ã€‚ ç½‘ç»œå‚æ•°ä»¥å­—å…¸çš„å½¢å¼æ‰“åŒ…åœ¨DBusMessageä¸­ï¼Œç„¶åä¼ è¾“åˆ°ConnMan Taskï¼Œåœ¨å…¶ä¸­å¯åŠ¨åå°åº”ç”¨ç¨‹åºæ—¶å‘é€Dbuså‚æ•°ã€‚ <br><br> åœ¨notifyå‡½æ•°ä¸­åˆå§‹åŒ–TUNæ¥å£çš„ç¤ºä¾‹ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">connman_ipaddress</span></span></span><span class="hljs-class"> * </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ipaddress</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">connman_ipaddress_alloc</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AF_INET</span></span></span><span class="hljs-class">);</span></span> connman_ipaddress_set_ipv4(ipaddress, address, netmask, remote_server_ip); connman_ipaddress_set_peer(ipaddress, peer); vpn_provider_set_ipaddress(provider, ipaddress); vpn_provider_set_nameservers(provider, â€œ<span class="hljs-number"><span class="hljs-number">8.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span>â€); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> VPN_STATE_CONNECT;</code> </pre> <br> æˆ‘ä»¬è¿˜ä¼ é€’ä¸­é—´å€¼ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³é€šè¿‡å†™å…¥å½“å‰è¿æ¥çš„å±æ€§æ¥é€šçŸ¥UIäº‹ä»¶ï¼ŒUIå¯ä»¥ä»net.connman.vpn.Connection.GetPropertiesæ–¹æ³•ä¸­å­¦åˆ°ï¼Œå½“æ›´æ”¹Propertiesæ—¶ï¼ŒConnManå‘é€DBusä¿¡å·PropertyChangedï¼Œä¾‹å¦‚ï¼švpn_provider_set_string ï¼ˆæä¾›è€…ï¼Œé”®ï¼Œå€¼ï¼‰ã€‚ <br><br> æ–­å¼€è¿æ¥-é€šè¿‡DBusè°ƒç”¨net.connman.vpn.Connection.Disconnectæ—¶è°ƒç”¨çš„å›è°ƒ <br> é€šè¿‡å‘é€SIGTERMä¿¡å·è¿›è¡Œåœæ­¢è¿‡ç¨‹ï¼Œå¦‚æœ3ç§’é’Ÿå†…æ²¡æœ‰æ–­å¼€è¿æ¥ï¼Œåˆ™å‘é€SIGKILLä¿¡å·ã€‚ <br><br><h3> å¼€å‘å’Œè°ƒè¯•VPNæ’ä»¶ </h3><br>  Continent-AP VPNæ’ä»¶åŠå…¶ç»„ä»¶çš„ç»„è£…åœ¨Sailfish Build Engine OSè™šæ‹Ÿæœºï¼ˆVirtual Boxï¼‰ä¸Šæ‰§è¡Œï¼Œè¯¥è™šæ‹Ÿæœºæ˜¯Sailfish SDKçš„ä¸€éƒ¨åˆ†ã€‚ è¦æ„å»ºæ’ä»¶ï¼Œæ‚¨éœ€è¦ä»¥ä¸‹åº“ï¼šconnman-develï¼Œdbus-1ï¼Œglibs-2.0ï¼Œæˆ‘ä»¬é€šè¿‡sshç™»å½•æ¥å®‰è£…å®ƒä»¬ï¼š <br><br><pre> <code class="plaintext hljs">ssh -p 2222 -i ~/SailfishOS/vmshare/ssh/private_keys/engine/mersdk mersdk@localhost</code> </pre> <br> æˆ‘ä»¬ä½¿ç”¨sb2å®ç”¨ç¨‹åºï¼ˆScratchbox 2ï¼‰-äº¤å‰ç¼–è¯‘å·¥å…·åŒ…ã€‚ æˆ‘ä»¬ä¸ºi486å’Œarmv7hlå¹³å°å®‰è£…äº†å¿…è¦çš„è½¯ä»¶åŒ…ï¼š <br><br><pre> <code class="plaintext hljs">sb2 -t SailfishOS-3.0.1.11-i486 -m sdk-install -R zypper -n in cmake patchelf chrpath connman-devel systemd-compat-libs systemd-devel</code> </pre> <br><pre> <code class="plaintext hljs">sb2 -t SailfishOS-3.0.1.11-armv7hl -m sdk-install -R zypper -n in cmake patchelf chrpath connman-devel systemd-compat-libs systemd-devel</code> </pre> <br> éœ€è¦ä½¿ç”¨sd_journal_printå‡½æ•°å°†systemd-compat-libså’Œsystemd-develè¾“å‡ºåˆ°ç³»ç»Ÿæ—¥å¿—ã€‚ æˆ‘ä»¬å®‰è£…äº†Cmakeï¼Œå› ä¸ºæˆ‘ä»¬çš„é¡¹ç›®ä½¿ç”¨å®ƒï¼Œæ‰€ä»¥å¤§å¤§ç®€åŒ–äº†ä¸åŒå¹³å°çš„ç»„è£…ã€‚ <br><br> æˆ‘ä»¬é€šè¿‡sb2 sdk-buildå¼€å§‹VPNæ’ä»¶åŠå…¶ç»„ä»¶çš„ç»„è£…ï¼š <br><br><pre> <code class="plaintext hljs">sb2 -t SailfishOS-3.0.1.11-armv7hl -m sdk-build cmake . &amp;&amp; make sb2 -t SailfishOS-3.0.1.11-i486 -m sdk-build cmake . &amp;&amp; make</code> </pre> <br><br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ”¶é›†åˆ°çš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œåº“æ”¾å…¥æˆ‘ä»¬çš„UIé¡¹ç›®ï¼Œè¯¥é¡¹ç›®åŒ…å«ä¸€ä¸ªSPECæ–‡ä»¶ï¼Œç”¨äºç”ŸæˆContinent-AP Sailfishåˆ†å‘RPMè½¯ä»¶åŒ…ï¼Œå¹¶ç¨ç¨è°ƒæ•´äº†å°†æ–‡ä»¶å®‰è£…åˆ°SPECæ–‡ä»¶ä¸­çš„è®¾å¤‡ç³»ç»Ÿæ–‡ä»¶å¤¹ä¸­çš„éƒ¨åˆ†ï¼Œä¾‹å¦‚ï¼š <br><br><pre> <code class="plaintext hljs">%files %defattr(-,root,root,-) %{_sbindir}/continent %{_libdir}/connman/plugins-vpn/continent-proto-plugin.so</code> </pre> <br> è¯¥æ’ä»¶æ˜¯ä¸ä»¿çœŸå™¨çš„UIåˆ†å¼€å¼€å‘çš„ï¼Œåè€…æ˜¯Sailfish SDKçš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”åœ¨æ’å®šæ—¥å¿—è¾“å‡ºæ¨¡å¼ä¸‹ï¼Œå¸¦æœ‰-fé€‰é¡¹çš„gdbuså’Œjournalctlä½œä¸ºè°ƒè¯•å·¥å…·å¾ˆæœ‰ç”¨ã€‚ <br><br> ä¾‹å¦‚ï¼Œä½¿ç”¨gdbusåˆ›å»ºæä¾›ç¨‹åºçš„å®ä¾‹ï¼š <br><br><pre> <code class="plaintext hljs">gdbus call --system --dest=net.connman.vpn --object-path / --method net.connman.vpn.Manager.Create "{ 'Type': &lt;'continent'&gt;, â€¦ }"</code> </pre><br> æµ‹è¯•è®¾å¤‡æ˜¯INOI R7ï¼ˆç”µè¯ï¼‰ï¼ŒINOI T8ï¼ˆå¹³æ¿ç”µè„‘ï¼‰å’ŒåŸºäºVirtualBoxçš„ä»¿çœŸå™¨ <br><br><h3> æœ‰ç”¨çš„é“¾æ¥ï¼š </h3><br><ol><li> å¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨æ­¤å¤„æ‰¾åˆ°</a>é€‚ç”¨äºSailfishçš„ConnManæºä»£ç ã€‚ </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">éª¨æ¶-æ’ä»¶é¡¹ç›®</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">sailfishos.org/wiki</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN471306/">https://habr.com/ru/post/zh-CN471306/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN471296/index.html">ç²¾ç›Šåˆ¶é€ -æ•ˆç‡å·¥å…·</a></li>
<li><a href="../zh-CN471298/index.html">æ¯”ä¼¯å’Œç¢§å…°æŒ¥ç¬”ã€‚ AIç°åœ¨æ­£åœ¨å”±æ­Œ</a></li>
<li><a href="../zh-CN471300/index.html">ååº”ï¼šæå‡çŠ¶æ€å°†æ€æ­»æ‚¨çš„åº”ç”¨ç¨‹åº</a></li>
<li><a href="../zh-CN471302/index.html">ä¸­å›½çš„ç”¨æˆ·éªŒè¯å’Œç¤¾ä¼šä¿¡ç”¨</a></li>
<li><a href="../zh-CN471304/index.html">å¸å›½ERPã€‚ å¨±ä¹ä¼šè®¡ï¼šæ€»è´¦ï¼Œç§‘ç›®ï¼Œä½™é¢</a></li>
<li><a href="../zh-CN471310/index.html">æˆ‘å¯¹ä¸“ä¸šçš„çœ‹æ³•éå¸¸ä¸»è§‚ï¼Œè€Œä¸ä»…ä»…æ˜¯ITæ•™è‚²</a></li>
<li><a href="../zh-CN471312/index.html">å‡†å¤‡æ˜¥å­£ä¸“ä¸šè®¤è¯ã€‚ æ˜¥å­£é´</a></li>
<li><a href="../zh-CN471318/index.html">ä¹æœˆæœºå™¨å­¦ä¹ å’Œäººå·¥æ™ºèƒ½æ–°é—»æ‘˜è¦</a></li>
<li><a href="../zh-CN471320/index.html">é€‚ç”¨äºè½¯ä»¶å¼€å‘äººå‘˜çš„å·¥å…·ï¼šå¼€æ”¾æ¡†æ¶å’Œæœºå™¨å­¦ä¹ åº“</a></li>
<li><a href="../zh-CN471324/index.html">ç¥ç»ç½‘ç»œæ˜¯å¦æ¢¦æƒ³ç€è’™å¨œä¸½èï¼Ÿ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>