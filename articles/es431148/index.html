<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõÉ üç† üëºüèº El nuevo iOS Mobile Enterprise. Parte # 1: Generaci√≥n de c√≥digo para recursos üçº üê∞ üë®üèø‚Äç‚öñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! 


 Me llamo Dmitry Dio la casualidad de que soy un l√≠der de equipo en un equipo de 13 desarrolladores de iOS durante los √∫ltimos dos a√±...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>El nuevo iOS Mobile Enterprise. Parte # 1: Generaci√≥n de c√≥digo para recursos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/431148/"><h4 id="vsem-privet">  Hola a todos! </h4><br><p>  Me llamo Dmitry  Dio la casualidad de que soy un l√≠der de equipo en un equipo de 13 desarrolladores de iOS durante los √∫ltimos dos a√±os.  Y juntos estamos trabajando en la aplicaci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tinkoff Business</a> . </p><br><p>  Quiero compartir con ustedes nuestra experiencia sobre c√≥mo lanzar la aplicaci√≥n en un momento inesperado con el conjunto m√°ximo de caracter√≠sticas o correcciones de errores y a√∫n no ponerse gris. </p><br><p>  Le contar√© sobre las pr√°cticas y los enfoques que ayudaron al equipo a acelerar significativamente el desarrollo y las pruebas y reducir significativamente la cantidad de estr√©s, errores, problemas con una liberaci√≥n no programada o urgente.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">#MakeReleaseWithoutStress</a> . </p><br><h4 id="poehali">  Vamos! </h4><a name="habracut"></a><br><h2 id="opisanie-problemy">  Descripci√≥n del problema </h2><br><p>  Imagina la siguiente situaci√≥n. </p><br><p>  Hay otro lanzamiento.  Fue precedido por pruebas de regresi√≥n, los evaluadores encontraron nuevamente un lugar donde, en lugar de texto en la aplicaci√≥n, se muestra la ID de l√≠nea. </p><br><img src="https://habrastorage.org/webt/s6/-u/qv/s6-uqv5rwcnqkxwlyzdhrphfamu.png" alt="Error de localizaci√≥n" width="100%"><br><p>  Este fue uno de nuestros problemas m√°s frecuentes que encontramos. </p><br><p>  Es posible que no encuentre este problema si no tiene la aplicaci√≥n localizada en otro idioma, o si toda la localizaci√≥n se escribe en l√≠neas directamente en el c√≥digo sin usar el archivo Localizable.strings. </p><br><p>  Pero puede encontrar otros problemas que le ayudaremos a resolver: </p><br><ul><li>  La aplicaci√≥n se bloquea porque especific√≥ incorrectamente el nombre de la imagen y forz√≥ el desenvolvimiento forzado <br><pre><code class="plaintext hljs">UIImage(named: "NotExist")!</code> </pre> </li><li>  La aplicaci√≥n se bloquea si el gui√≥n gr√°fico no se agrega al destino </li><li>  La aplicaci√≥n se bloquea si crea un controlador desde un gui√≥n gr√°fico con una ID inexistente </li><li>  La aplicaci√≥n se bloquea si crea un controlador desde el gui√≥n gr√°fico con una ID existente, pero se env√≠a a la clase incorrecta </li><li>  Comportamiento impredecible si usa una fuente en el c√≥digo que no se agrega a info.plist, o si el archivo de fuente no est√° marcado con target: es posible un bloqueo, o es posible obtener simplemente una fuente est√°ndar en lugar de la que necesita.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Desarrollador Apple: Fuentes personalizadas</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Stackoverflow: crash</a> </li><li>  La aplicaci√≥n se bloquea si los guiones gr√°ficos indican al controlador una clase que no existe </li><li>  Un mont√≥n de c√≥digo mon√≥tono que crea √≠conos, fuentes, controladores, vistas </li><li>  No hay im√°genes, iconos en tiempo de ejecuci√≥n, aunque el nombre de la imagen est√° en el gui√≥n gr√°fico, pero no en los activos </li><li>  El gui√≥n gr√°fico utiliza una fuente que no est√° en info.plist </li><li>  Las ID de fila aparecen en la aplicaci√≥n, en lugar de localizar en lugares inesperados, debido a la eliminaci√≥n de l√≠neas en Localizable.strings (se pens√≥ que no se utilizaron) </li><li>  Algo m√°s que olvid√© mencionar, o que a√∫n no hemos encontrado. </li></ul><br><h2 id="prichina--sledstvie">  Raz√≥n ‚Üí Efecto </h2><br><p>  ¬øPor qu√© est√° pasando todo esto? </p><br><p>  Hay un c√≥digo de programa que compila.  Si escribi√≥ algo incorrecto (sint√°cticamente, o el nombre de la funci√≥n es incorrecto cuando se lo llama), entonces su proyecto simplemente no se ensamblar√°.  Esto es comprensible, obvio y l√≥gico. </p><br><p>  ¬øPero qu√© pasa con cosas como los recursos? </p><br><p>  No se compilan, simplemente se agregan al paquete despu√©s de compilar el c√≥digo.  A este respecto, pueden ocurrir una gran cantidad de problemas en tiempo de ejecuci√≥n, por ejemplo, el caso descrito anteriormente, con cadenas en la localizaci√≥n. </p><br><h2 id="poisk-resheniya">  Busca una soluci√≥n </h2><br><p>  Pensamos en c√≥mo se resuelven tales problemas en general, y c√≥mo podemos solucionarlo.  Record√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">una de las conferencias de Cocoaheads en mail.ru.</a>  Se habl√≥ sobre la comparaci√≥n de herramientas de generaci√≥n de c√≥digo. </p><br><p>  Despu√©s de ver una vez m√°s de qu√© se tratan estas herramientas (bibliotecas / marcos), finalmente encontramos lo que se necesitaba. </p><br><p>  Al mismo tiempo, los desarrolladores de Android han utilizado un enfoque similar durante a√±os.  Google pens√≥ en ellos y los convirti√≥ en una herramienta fuera de la caja.  Pero Apple, incluso Xcode estable, no puede hacernos ... </p><br><p>  Todo lo que quedaba era averiguar qu√© instrumento elegir: ¬ø <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Natalie</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SwiftGen</a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">R.swift</a> ? </p><br><p>  Natalie no ten√≠a soporte de localizaci√≥n, se decidi√≥ abandonarlo inmediatamente.  SwiftGen y R.swift ten√≠an capacidades muy similares.  Optamos por R.swift, simplemente en funci√≥n del n√∫mero de estrellas, sabiendo que en cualquier momento podemos cambiar a SwiftGen. </p><br><h2 id="kak-rabotaet-rswift">  C√≥mo funciona R.swift </h2><br><p>  Se inicia un script de fase de compilaci√≥n previa a la compilaci√≥n, se ejecuta a trav√©s de la estructura del proyecto y genera un archivo llamado <code>R.generated.swift</code> , que deber√° agregarse al proyecto (le diremos m√°s sobre c√≥mo hacerlo al final). </p><br><p>  El archivo tiene la siguiente estructura: </p><br><pre> <code class="plaintext hljs">import Foundation import Rswift import UIKit /// This `R` struct is generated and contains references to static resources. struct R: Rswift.Validatable { fileprivate static let applicationLocale = hostingBundle.preferredLocalizations.first.flatMap(Locale.init) ?? Locale.current fileprivate static let hostingBundle = Bundle(for: R.Class.self) static func validate() throws { try intern.validate() } // ... /// This `R.string` struct is generated, and contains static references to 2 localization tables. struct string { /// This `R.string.localizable` struct is generated, and contains static references to 1196 localization keys. struct localizable { /// en translation:  Apple Pay /// /// Locales: en, ru static let card_actions_activate_apple_pay = Rswift.StringResource(key: "card_actions_activate_apple_pay", tableName: "Localizable", bundle: R.hostingBundle, locales: ["en", "ru"], comment: nil) // ... /// en translation:  Apple Pay /// /// Locales: en, ru static func card_actions_activate_apple_pay(_: Void = ()) -&gt; String { return NSLocalizedString("card_actions_activate_apple_pay", bundle: R.hostingBundle, comment: "") } } } }</code> </pre> <br><p>  Uso: </p><br><pre> <code class="plaintext hljs">let str = R.string.localizable.card_actions_activate_apple_pay() print(str) &gt;  Apple Pay</code> </pre> <br><p>  ‚Äú¬øPor qu√© necesitamos <code>Rswift.StringResource</code> ?‚Äù, Preguntas.  Yo mismo no entiendo por qu√© generarlo, pero, como explican los autores, es necesario para lo siguiente: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enlace</a> . </p><br><h2 id="primenenie-v-realnyh-usloviyah">  Aplicaci√≥n del mundo real </h2><br><p>  Una peque√±a explicaci√≥n del contenido a continuaci√≥n: </p><br><p>  * Lo fue: usaron el enfoque por un tiempo, al final, lo dejaron <br>  * Se ha convertido en el enfoque que usamos al escribir c√≥digo nuevo <br>  * No lo era, pero puede tenerlo: un enfoque que nunca existi√≥ en nuestra aplicaci√≥n, pero lo conoc√≠ en varios proyectos, en aquellos tiempos lejanos, cuando a√∫n no hab√≠a trabajado en Tinkoff.ru. </p><br><h4 id="localization">  Localizaci√≥n </h4><br><p>  Comenzamos a usar <code>R.swift</code> para la localizaci√≥n, nos salv√≥ de los problemas sobre los que escribimos al principio.  Ahora, si la identificaci√≥n en la localizaci√≥n ha cambiado, el proyecto no se ensamblar√°. </p><br><p>  * Esto solo funciona si cambia la identificaci√≥n en todas las localizaciones a otra.  Si una cadena permanece en cualquiera de las localizaciones, en la compilaci√≥n habr√° una advertencia de que esta identificaci√≥n no est√° localizada en todos los idiomas. </p><br><img src="https://habrastorage.org/webt/b4/ab/mh/b4abmhdhewhco-azpem4ab-ochy.png" alt="Advertencia" width="40%"><br><br><div class="spoiler">  <b class="spoiler_title">No est√° all√≠, pero es posible que tenga:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">final class NewsViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() titleLabel.text = NSLocalizedString("news_title", comment: "News title") } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Fue:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">extension String { public func localized(in bundle: Bundle = .main, value: String = "", comment: String = "") -&gt; String { return NSLocalizedString(self, tableName: nil, bundle: bundle, value: value, comment: comment) } } final class NewsViewController: UIViewController { private enum Localized { static let newsTitle = "news_title".localized() } override func viewDidLoad() { super.viewDidLoad() titleLabel.text = Localized.newsTitle } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Se convirti√≥ en:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">titleLabel.text = R.string.localizable.newsTitle()</code> </pre> </div></div><br><h4 id="images">  Im√°genes </h4><br><p>  Ahora, si cambiamos el nombre de algo en * .xcassets y no cambiamos el c√≥digo, entonces el proyecto simplemente no se ensamblar√°. </p><br><div class="spoiler">  <b class="spoiler_title">Fue:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">imageView.image = UIImage(named: "NotExist") //     imageView.image = UIImage(named: "NotExist")! // crash imageView.image = #imageLiteral(resourceName: "NotExist") // crash</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Se convirti√≥ en:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">imageView.image = R.image.tinkoffLogo() //    </code> </pre> </div></div><br><h4 id="storyboards">  Storyboards </h4><br><div class="spoiler">  <b class="spoiler_title">Fue:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">let someStoryboardName = "SomeStoryboard" // Change to something else (eg: "somestoryboard") - get nil or crash in else let someVCIdentifier = "SomeViewController" // Change to something else (eg: "someviewcontroller") - get nil or crash in else let storyboard = UIStoryboard(name: someStoryboardName, bundle: .main) let _vc = storyboard.instantiateViewController(withIdentifier: someVCIdentifier) guard let vc = _vc as? SomeViewController else { //    -  ,  Fabric  Firebase //    fatalError() ¬Ø\_(„ÉÑ)_/¬Ø}</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Se convirti√≥ en:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">guard let vc = R.storyboard.someStoryboard.someViewController() else { //    -  ,  Fabric  Firebase //    fatalError() ¬Ø\_(„ÉÑ)_/¬Ø }</code> </pre> </div></div><br><p>  Y as√≠ sucesivamente. </p><br><h4 id="validaciya-storyboard">  Validaci√≥n Storyboard </h4><br><p>  <a href="">R.validate ()</a> es una herramienta maravillosa que se <a href="">da la</a> mano (o m√°s bien, simplemente arroja un error en un bloque catch) si hiciste algo mal en el gui√≥n gr√°fico o en los archivos xib. <br>  Por ejemplo: </p><br><ul><li>  Indica el nombre de la imagen, que no est√° en el proyecto. </li><li>  Indicaron la fuente y luego dejaron de usarla y la eliminaron del proyecto (de info.plist) </li></ul><br><p>  Uso: </p><br><pre> <code class="plaintext hljs">final class AppDelegate: UIResponder { func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]? = nil) -&gt; Bool { #if DEBUG do { try R.validate() } catch { //   fatalError      //        debug        //  -   ,                 production fatalError(error.localizedDescription) } #endif return true } }</code> </pre> <br><h4 id="i-vot-vy-uzhe-gotovy-kupit-dva">  ¬°Y ahora est√°s listo para comprar dos! </h4><br><img src="https://habrastorage.org/webt/7x/m3/4q/7xm34quvznbr0zo761iqdhs7jgu.jpeg" alt="¬°C√°llate y toma mi dinero!" width="40%"><br><br><h2 id="kak-vnedryat">  ¬øC√≥mo implementar? </h2><br><p>  * Sistema basado en componentes: un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">wiki</a> , un concepto de desarrollo de c√≥digo en el que los componentes (un conjunto de pantallas / m√≥dulos interconectados) se desarrollan en un entorno cerrado (en nuestro caso, en m√≥dulos locales) para reducir la coherencia de la base del c√≥digo.  Muchas personas conocen el enfoque en el backend, que se basa en este concepto: microservicios. </p><br><p>  * Monolith - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">wiki</a> , el concepto de desarrollo de c√≥digo, en el que toda la base de c√≥digo se encuentra en un repositorio, y el c√≥digo est√° estrechamente relacionado.  Este concepto es adecuado para peque√±os proyectos con un conjunto finito de funciones. </p><br><p>  Si est√° desarrollando una aplicaci√≥n monol√≠tica o utilizando dependencias de terceros, entonces tiene suerte (pero esto no es exacto).  Tome el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tutorial</a> y haga todo estrictamente al respecto. </p><br><p>  Este no fue nuestro caso.  Nos involucramos  Como utilizamos un sistema basado en componentes, <code></code> incorporar R.swift en la aplicaci√≥n principal, decidimos incorporarlo en m√≥dulos locales (que son componentes). </p><br><p>  Debido a la actualizaci√≥n constante de localizaciones, im√°genes y todos los elementos que afectan el archivo R.generated.swift, existen muchos conflictos en el archivo generado cuando se fusionan con la rama com√∫n.  Y para evitar esto, debe eliminar R.generated.swift del repositorio de git.  El autor tambi√©n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">recomienda hacer esto</a> . </p><br><p>  Agregue las siguientes l√≠neas a <code>.gitignore</code> . </p><br><pre> <code class="plaintext hljs"># R.Swift generated files *.generated.swift</code> </pre> <br><p>  Adem√°s, si no desea generar c√≥digo para algunos recursos, siempre puede usar ignorando archivos individuales o carpetas completas: </p><br><pre> <code class="plaintext hljs">"${PODS_ROOT}/R.swift/rswift" generate "${SRCROOT}/Example" "--rswiftignore" "Example/.rswiftignore"</code> </pre> <br><p>  <a href="">descripci√≥n de .rswiftignore</a> </p><br><p>  Al igual que en el proyecto principal, era importante para nosotros no agregar archivos R.generated.swift de pods locales al repositorio git.  Comenzamos a considerar opciones sobre c√≥mo podr√≠a hacerse esto: </p><br><ul><li>  alias en R.generated.swift para que el archivo (alias, por ejemplo: R.swift) se agregue al proyecto y luego, al compilar por referencia, el archivo real est√© disponible.  Pero los cocoapodos son inteligentes, y no se les permite hacerlo </li><li>  en podspec en la fase de precompilaci√≥n, agregue el archivo R.generated.swift al proyecto mismo usando scripts, pero luego se agregar√° simplemente como un archivo en el sistema de archivos, y el archivo no aparecer√° en el proyecto </li><li>  otras opciones m√°s o menos ordenadas </li><li><p>  magia en podfile </p><br><div class="spoiler">  <b class="spoiler_title">Magia</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/jk/fg/lt/jkfgltwqbhucchythactmnyrnrk.jpeg" alt="Magia" width="40%"><br><br><pre> <code class="ruby hljs">pre_install <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|installer|</span></span> installer.pod_targets.flat_map <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|pod_target|</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pod_target.pod_target_srcroot.<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>? <span class="hljs-string"><span class="hljs-string">'LocalPods'</span></span> <span class="hljs-comment"><span class="hljs-comment">#           LocalPods,     ,   pod_target_srcroot = pod_target.pod_target_srcroot #   pod_target_path = pod_target_srcroot.sub('${PODS_ROOT}/..', '.') #       pod_target_sources_path = pod_target_path + '/' + pod_target.name + '/Sources' #     Sources generated_file_path = pod_target_sources_path + '/R.generated.swift' #     R.generated.swift File.new(generated_file_path, 'w') #    R.generated.swift      end end end</span></span></code> </pre> <br></div></div><br></li></ul><br><ul><li>  y otra opci√≥n ... todav√≠a agregue R.generated.swift a git </li></ul><br><p>  Nos decidimos temporalmente por la opci√≥n: "magia en el Podfile", a pesar de que ten√≠a una serie de deficiencias: </p><br><ul><li>  Solo se pudo iniciar desde la ra√≠z del proyecto (aunque los cocoapods se pueden iniciar desde casi cualquier carpeta del proyecto) </li><li>  Todos los pods deben tener una carpeta llamada Fuentes (aunque esto no es cr√≠tico si los pods est√°n en orden) </li><li>  Era extra√±o e incomprensible, pero tarde o temprano tendr√≠a que apoyar (esto todav√≠a es una muleta) </li><li>  Si alguna biblioteca de terceros est√° en una carpeta con "LocalPods" en su ruta, entonces intentar√° agregar el archivo R.generated.swift all√≠ o se bloquear√° con un error </li></ul><br><h4 id="prepare_command">  prepare_command </h4><br><p>  Viviendo un tiempo con un gui√≥n y sufriendo, decid√≠ estudiar este tema m√°s ampliamente y encontr√© otra opci√≥n. <br>  En Podspec hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">prepare_command</a> , que est√° destinado solo a crear y modificar las fuentes, que luego se agregar√°n al proyecto. </p><br><p>  * Noticias: el nombre del pod, que debe reemplazarse con el nombre de su pod local <br>  * touch - comando para crear un archivo.  El argumento es la ruta relativa al archivo (incluido el nombre del archivo con la extensi√≥n) </p><br><p>  A continuaci√≥n haremos fraudes con News.podspec </p><br><p>  Este script se llama la primera vez que <code>pod install</code> ejecuta la <code>pod install</code> y agrega el archivo que necesitamos a la carpeta de origen en el hogar. </p><br><pre> <code class="ruby hljs">Pod::Spec.new <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|s|</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... generated_file_path = "News/Sources/R.generated.swift" s.prepare_command = &lt;&lt;-CMD touch "#{generated_file_path}" CMD # ... end</span></span></code> </pre> <br><p>  El siguiente es otro "finta con orejas": tenemos que hacer una llamada al gui√≥n R.swift para hogares locales. </p><br><pre> <code class="ruby hljs">Pod::Spec.new <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|s|</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... s.dependency 'R.swift' r_swift_script = '"${PODS_ROOT}/R.swift/rswift" generate "${PODS_TARGET_SRCROOT}/News/Sources"' s.script_phases = [ { :name =&gt; 'R.swift', :script =&gt; r_swift_script, :execution_position =&gt; :before_compile } ] end</span></span></code> </pre> <br><p>  Es cierto, hay un "pero".  <code>prepare_command</code> no funciona con pods locales, o m√°s bien funciona, pero en algunos casos especiales.  Hay una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">discusi√≥n sobre este tema en Github</a> . </p><br><h4 id="fatality">  Fatalidad </h4><br><p>  * Fatality - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">wiki</a> , el golpe final en Mortal Kombat. </p><br><p>  Despu√©s de un poco m√°s de investigaci√≥n, encontr√© otra soluci√≥n: un h√≠brido de enfoques c <code>prepare_command</code> y <code>pre_install</code> . </p><br><p>  Una peque√±a modificaci√≥n de la magia del Podfile: </p><br><pre> <code class="ruby hljs">pre_install <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|installer|</span></span> <span class="hljs-comment"><span class="hljs-comment"># map development pods installer.development_pod_targets.each do |target| # get only main spec and exclude subspecs spec = target.non_test_specs.first # get full podspec file path podspec_file_path = spec.defined_in_file # get podspec dir path pod_directory = podspec_file_path.parent # check if path contains local pods directory # exclude development but non local pods local_pods_directory_name = "LocalPods" if pod_directory.to_s.include? local_pods_directory_name # go to pod root directorty and run prepare command in sub-shell system("cd \"#{pod_directory}\"; #{spec.prepare_command}") end end end</span></span></code> </pre> <br><p>  Y el mismo script que no se ejecut√≥ para hogares locales </p><br><pre> <code class="ruby hljs">Pod::Spec.new <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|s|</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... s.dependency 'R.swift' generated_file_path = "News/Sources/R.generated.swift" s.prepare_command = &lt;&lt;-CMD touch "#{generated_file_path}" CMD r_swift_script = '"${PODS_ROOT}/R.swift/rswift" generate "${PODS_TARGET_SRCROOT}/News/Sources"' s.script_phases = [ { :name =&gt; 'R.swift', :script =&gt; r_swift_script, :execution_position =&gt; :before_compile } ] end</span></span></code> </pre> <br><p>  Al final, funciona como esperamos. </p><br><p>  Por fin! </p><br><p>  PD: </p><br><p>  Trat√© de hacer otro comando personalizado en lugar de <code>prepare_command</code> , pero <code>pod lib lint</code> (un comando para validar el contenido de podspec y el propio hogar) jura sobre variables adicionales y no pasa. </p><br><h4 id="nelokalnye-pody">  Hogares no locales </h4><br><p>  En los pods remotos (aquellos que est√°n en su propio repositorio) no necesita toda esta magia de scripting, que se describe anteriormente, porque all√≠ la base del c√≥digo est√° estrictamente vinculada a la versi√≥n de dependencia. </p><br><p>  Es suficiente simplemente incrustar el Ejemplo (un proyecto generado despu√©s de que el pod lib cree el comando &lt;Nombre&gt;) el script R.swift y agregar R.generated.swift al paquete de la biblioteca (abajo).  Si el proyecto no tiene Ejemplo, entonces tendr√° que escribir scripts que ser√°n similares a los que he citado. </p><br><p>  PD: </p><br><p>  Hay una peque√±a aclaraci√≥n: <br>  R.swift + Xcode 10 + nuevo sistema de compilaci√≥n + compilaci√≥n incremental! = &lt;3 <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">M√°s informaci√≥n sobre el problema en la p√°gina principal de la biblioteca</a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠.</a> <br>  R.swift v4.0.0 no funciona con cocoapods 1.6.0 :( <br>  Creo que pronto todos los problemas ser√°n corregidos. </p><br><h2 id="vyvod">  Conclusi√≥n </h2><br><p>  Siempre debe mantener la barra de calidad lo m√°s alta posible.  Esto es especialmente importante para aplicaciones que funcionan con finanzas. </p><br><p>  En este caso, no necesita sobrecargar las pruebas y encontrar errores lo antes posible.  En nuestro caso, esto ocurre en el momento en que el desarrollador compil√≥ el c√≥digo o en la ejecuci√≥n de prueba para Solicitudes de extracci√≥n.  Por lo tanto, encontramos la falta de localizaci√≥n no por la mirada atenta de los evaluadores o por pruebas automatizadas, sino por el proceso habitual de construcci√≥n de la aplicaci√≥n. </p><br><p>  Tambi√©n debe tener en cuenta el hecho de que esta es una herramienta de terceros que est√° vinculada a la estructura del proyecto y analiza su contenido.  Si la estructura del archivo del proyecto cambia, entonces la herramienta deber√° cambiarse. <br>  Asumimos este riesgo y, en cuyo caso, siempre estamos listos para cambiar esta herramienta por otra o escribir la suya propia. </p><br><p>  Y la ganancia de R.swift es una gran cantidad de horas hombre que el equipo puede dedicar a cosas mucho m√°s importantes: nuevas caracter√≠sticas, nuevas soluciones t√©cnicas, mejora de la calidad, etc.  R.swift devolvi√≥ completamente la cantidad de tiempo que se dedic√≥ a su integraci√≥n, incluso teniendo en cuenta el posible reemplazo en el futuro con otra soluci√≥n similar. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">R.swift</a> </p><br><h2 id="bonus">  Bono </h2><br><p>  Puede jugar con un ejemplo para ver de inmediato con sus propios ojos el beneficio de la generaci√≥n de c√≥digo para los recursos.  El c√≥digo fuente del proyecto "para jugar": <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GitHub</a> . </p><br><h4 id="spasibo-ogromnoe-chto-prochitali-statyu-ili-zhe-prosto-dolistali-do-etogo-mesta-mne-v-lyubom-sluchae-priyatno">  Muchas gracias por leer el art√≠culo o simplemente hojear este lugar, de todos modos estoy satisfecho) </h4><br><h4 id="thats-all">  Eso es todo </h4></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es431148/">https://habr.com/ru/post/es431148/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es431138/index.html">Biometr√≠a con la clave Rostelecom: c√≥mo el FSB lanz√≥ por primera vez la criptograf√≠a rusa en las tiendas de aplicaciones</a></li>
<li><a href="../es431140/index.html">Informe de la metapa de Go in Production: video, fotos, presentaciones</a></li>
<li><a href="../es431142/index.html">¬øC√≥mo ejecutar SQL Profiler Trace en la noche, a una hora espec√≠fica?</a></li>
<li><a href="../es431144/index.html">Micr√≥fono Far Fields (matriz de micr√≥fonos): h√©roe discreto en una columna inteligente</a></li>
<li><a href="../es431146/index.html">1. An√°lisis de registro de Check Point: la aplicaci√≥n oficial de Check Point para Splunk</a></li>
<li><a href="../es431152/index.html">Metro 4 es un viaje de 6 a√±os. Una breve historia de Metro UI CSS</a></li>
<li><a href="../es431154/index.html">Las deficiencias en las misiones de Fallout 76 permitieron a los jugadores hacer un infierno nuclear</a></li>
<li><a href="../es431156/index.html">SHOCK! Nuevo software de phishing gana segundo factor</a></li>
<li><a href="../es431158/index.html">M√°s caf√©, menos cafe√≠na: Intel 9th ‚Äã‚ÄãGen (parte 2)</a></li>
<li><a href="../es431160/index.html">Ni una sola oportunidad para el oponente: adoptamos el teclado ultrarr√°pido HyperX Alloy FPS RGB</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>