<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘Ÿ ğŸ™‰ ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘¨ Ã€ propos de l'abus de l'utilisation du systÃ¨me d'exploitation dans les projets de microcontrÃ´leurs ğŸ‘‹ğŸ½ ğŸ¤¾ğŸ¼ ğŸ«</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les microcontrÃ´leurs modernes ont des performances assez Ã©levÃ©es et cela donne Ã  de nombreux programmeurs la possibilitÃ© de penser approximativement d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ã€ propos de l'abus de l'utilisation du systÃ¨me d'exploitation dans les projets de microcontrÃ´leurs</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461265/">  Les microcontrÃ´leurs modernes ont des performances assez Ã©levÃ©es et cela donne Ã  de nombreux programmeurs la possibilitÃ© de penser approximativement dans la veine suivante: - Â«Ce n'est pas grave si 1 Ã  5% des performances vont Ã  la maintenance du systÃ¨me d'exploitation.  Mais mon code sera facilement dÃ©boguÃ© et explicite! Â»  Ces rÃ©flexions sont soutenues par une grande quantitÃ© de mÃ©moire non volatile (flash) pour stocker le code du systÃ¨me d'exploitation et une mÃ©moire opÃ©rationnelle (RAM / SRAM) pour allouer sa propre pile Ã  chaque tÃ¢che.  Cependant, dans la plupart des cas, cette idÃ©e est erronÃ©e.  Et dans cet article, je vais vous expliquer pourquoi. <a name="habracut"></a><br><br><h2>  Ã€ propos des projets avec lesquels je travaille </h2><br>  Dans ma pratique, je dois souvent travailler avec un Â«designerÂ».  J'ai dÃ©crit cette approche en dÃ©tail dans mon prÃ©cÃ©dent article sur l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">utilisation de C ++ dans les microcontrÃ´leurs</a> .  Ensuite, je n'ai pas dit la chose la plus importante.  La plupart des Â«blocsÂ» de ce Â«constructeurÂ» sont en quelque sorte liÃ©s Ã  un systÃ¨me d'exploitation en temps rÃ©el.  La plupart des Â«blocsÂ» ont leur propre flux (tÃ¢che, en termes de systÃ¨me d'exploitation en temps rÃ©el FreeRTOS utilisÃ©).  Et que, en moyenne, le projet a environ 10-15 tÃ¢ches.  Parfois, cette valeur atteint 35-40. <br><br><h2>  O so tant? </h2><br>  Voici une courte liste des tÃ¢ches rencontrÃ©es <b>dans chaque</b> projet: <ul><li>  Maintenance ADC (chaque module est desservi par son propre flux); </li><li>  maintenance wdt (si le systÃ¨me d'exploitation tombe en panne, la tÃ¢che ne le rÃ©initialisera pas et l'appareil redÃ©marrera); </li><li>  travailler avec des pages de paramÃ¨tres (un flux sÃ©parÃ© contrÃ´le le travail avec la mÃ©moire flash); </li><li>  maintenance du protocole d'interaction avec le monde extÃ©rieur (en aval de l'interface. Par exemple, uart); </li></ul><br>  Ensuite, il y a dÃ©jÃ  des choses spÃ©cifiques pour chaque appareil, comme un flux pour l'entretien des thermistances (recevoir des donnÃ©es du flux de mesure ADC et convertir ces donnÃ©es en tempÃ©rature), interroger les pÃ©riphÃ©riques externes, etc. <br><br><h2>  SimplicitÃ© apparente </h2><br>  MalgrÃ© le fait qu'il existe de nombreuses tÃ¢ches dans le projet, chacune d'entre elles est Â«cachÃ©eÂ» Ã  l'intÃ©rieur d'un objet de la classe correspondante (rappelez-vous que le constructeur est en C ++, mais cela peut Ã©galement Ãªtre imitÃ© en C en utilisant Â«la programmation en C dans un style orientÃ© objetÂ». Mais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">il vaut mieux ne pas nÃ©cessaire</a> ).  Ã‰tant donnÃ© que les objets de ce Â«constructeurÂ» sont globaux et FreeRTOS 9 est utilisÃ© dans les projets, qui prend en charge la crÃ©ation de leurs propres entitÃ©s dans des tampons allouÃ©s par l'utilisateur, l'utilisation de la mÃ©moire peut Ãªtre contrÃ´lÃ©e mÃªme au stade de la construction.  Donc, du point de vue de la surveillance des fuites de mÃ©moire - tout est plus ou moins normal.  Mais il y a les nuances suivantes: <br><ul><li>  il faut bien comprendre combien une pile est nÃ©cessaire pour chaque thread.  Dans ce cas: <ul><li>  les cas critiques doivent Ãªtre pris en compte (par exemple, l'imbrication avec un certain comportement); </li><li>  si des fonctions de bibliothÃ¨ques standard sont utilisÃ©es, sachez Ã©galement comment elles sont organisÃ©es, ou du moins ayez une idÃ©e de la quantitÃ© qu'elles utiliseront la pile; </li></ul></li></ul><br>  En dehors de ce fait, il semble que l'utilisation du systÃ¨me d'exploitation ne fera qu'amÃ©liorer la logique du code et le rendre plus clair. <br><br><h2>  Utilisation abusive des fonctionnalitÃ©s du systÃ¨me d'exploitation </h2><br>  Les principaux problÃ¨mes commencent au moment oÃ¹ vous commencez Ã  oublier ce que vous Ã©crivez spÃ©cifiquement pour le microcontrÃ´leur.  Le systÃ¨me d'exploitation impose ses coÃ»ts de travail avec ses propres entitÃ©s (telles que les sÃ©maphores, les mutex, les files d'attente).  Voici un exemple de <a href="">classe UART pour implÃ©menter une fonction de terminal</a> .  Dans l'interruption, un octet est reÃ§u, aprÃ¨s quoi, s'il dÃ©passe la plage par des caractÃ¨res d'entrÃ©e valides, il est ajoutÃ© Ã  la file d'attente avec les remplacements correspondants (par exemple, '\ n' change la sÃ©quence "\ n \ r").  Cela a Ã©tÃ© fait afin de sÃ©curiser le port pour l'envoi (car le port peut fonctionner non seulement comme un terminal. Les donnÃ©es du journal peuvent Ã©galement Ãªtre envoyÃ©es via celui-ci).  D'une part, cela garantit que la rÃ©ponse sera envoyÃ©e dÃ¨s que possible et n'interfÃ©rera pas avec l'envoi de donnÃ©es de prioritÃ© plus Ã©levÃ©e (en outre, tandis que des donnÃ©es de prioritÃ© plus Ã©levÃ©e sont envoyÃ©es, elles s'accumulent dans le tampon, ce qui permet d'utiliser le DMA pour envoyer la rÃ©ponse).  Cependant, Ã  partir de ce moment, vous arrivez sur une piste glissante.  Au lieu d'Ã©crire un groupe dans la file d'attente, on pourrait simplement configurer correctement l'interruption sur un tampon non vide qui ne fonctionne pas actuellement sur l'UART et Ã  la fin du DMA.  Cette approche nÃ©cessite une comprÃ©hension claire du fonctionnement des pÃ©riphÃ©riques.  Cependant, cela rÃ©duit les coÃ»ts Ã  un minimum absolu, rendant la nÃ©cessitÃ© d'une telle solution nulle. <br><br><h2>  Ignorer la fonctionnalitÃ© matÃ©rielle du microcontrÃ´leur </h2><br>  Dans ma pratique, j'ai rencontrÃ© un projet avec 18 minuteries logicielles de systÃ¨me d'exploitation rÃ©glÃ©es sur la mÃªme frÃ©quence.  Dans le mÃªme temps, il y avait environ 10 temporisateurs dans le microcontrÃ´leur, dont seul le systic Ã©tait utilisÃ©.  Pour synchroniser le planificateur du systÃ¨me d'exploitation.  Cette dÃ©cision s'explique par le manque de volontÃ© de "jouer avec le matÃ©riel" du microcontrÃ´leur.  En mÃªme temps, environ 10 kb ont Ã©tÃ© allouÃ©s Ã  la pile pour la fonction appelÃ©e par le temporisateur logiciel.  En fait, environ 1 ko a Ã©tÃ© utilisÃ© (court).  Cela Ã©tait dÃ» Ã  Â«l'ambiguÃ¯tÃ© de ce qui se passe Ã  l'intÃ©rieur des bibliothÃ¨ques appelÃ©esÂ». <br>  Dans ce cas, il Ã©tait possible de sÃ©lectionner en toute sÃ©curitÃ© TIM6 (dans le cas de l'utilisation de stm32f4), ce qui gÃ©nÃ©rerait une interruption avec une frÃ©quence donnÃ©e et Ã  l'intÃ©rieur, il appellerait simplement les fonctions requises. <br><br><h2>  Utiliser une boucle infinie au lieu d'une machine Ã  Ã©tats </h2><br>  En tant que colonne distincte, je soulignerais l'incapacitÃ© de certains programmeurs Ã  Ã©crire des machines compactes Ã  Ã©tats finis, et Ã  la place crÃ©er un flux dans lequel il y a une boucle infinie qui commence son travail en obtenant quelque chose de la file d'attente.  Fait intÃ©ressant, comment crÃ©er des machines Ã  Ã©tats finis compactes au moyen du langage lui-mÃªme est Ã©crit dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cet article</a> . <br><br><h2>  Ignorer le "planificateur matÃ©riel" </h2><br>  De nombreux microcontrÃ´leurs 32 bits ont un contrÃ´leur d'interruption bien pensÃ© avec un systÃ¨me de prioritÃ© personnalisable.  Dans le cas de stm32f4, il porte le nom NVIC et a la possibilitÃ© de dÃ©finir des prioritÃ©s d'interruption avec 16 niveaux (sans tenir compte des sous-niveaux). <br>  La plupart des applications sous FreeRTOS que j'ai dÃ» traiter pouvaient Ãªtre Ã©crites comme des machines Ã  Ã©tats appelÃ©es en interruptions avec des prioritÃ©s correctement configurÃ©es.  Et au cas oÃ¹ le processeur reviendrait Ã  "exÃ©cution normale" - passez en "veille".  Dans ce cas, il ne serait pas nÃ©cessaire de bloquer l'accÃ¨s Ã  la plupart des ressources (variables et autres).  Les applications perdraient un niveau d'abstraction supplÃ©mentaire.  Et dans ce cas - loin d'Ãªtre gratuit.  Cependant, cette approche nÃ©cessite une planification architecturale rÃ©flÃ©chie pour chaque projet.  Dans les projets, les Â«concepteursÂ» - toutes les interruptions ont une prioritÃ© et, en fait, sont nÃ©cessaires pour Â«filtrerÂ» les donnÃ©es.  Ensuite, placez les restes dans la file d'attente, d'oÃ¹ le flux d'objets de la classe correspondante les rÃ©cupÃ©rera. <br><br><h2>  RÃ©sumÃ© </h2><br>  Dans cet article, j'ai parlÃ© des problÃ¨mes de base auxquels vous devez faire face lors de l'utilisation du systÃ¨me d'exploitation dans des projets de microcontrÃ´leurs, et j'ai Ã©galement examinÃ© les cas courants d'utilisation du systÃ¨me d'exploitation lorsque cela aurait pu Ãªtre Ã©vitÃ© sans perdre la lisibilitÃ© et la logique du code. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr461265/">https://habr.com/ru/post/fr461265/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr461253/index.html">Comment se tirer une balle dans le pied en C et C ++. Haiku OS Cookbook</a></li>
<li><a href="../fr461255/index.html">Comment se tirer une balle dans le pied en C et C ++. Collection de recettes Haiku OS</a></li>
<li><a href="../fr461257/index.html">Comment calculer le retour sur investissement Ã  partir de l'automatisation des tests avec Selenium?</a></li>
<li><a href="../fr461259/index.html">FÃªte de stockage, 8 aoÃ»t, Moscou</a></li>
<li><a href="../fr461261/index.html">Liste de contrÃ´le des webinaires RRC utiles sur les produits RRC</a></li>
<li><a href="../fr461267/index.html">Nouvelles technologies Intel pour le conditionnement des puces</a></li>
<li><a href="../fr461269/index.html">La solution de travail avec pwnable.kr 08 est leg et 10 est shellshock. Assembleur ARM. VulnÃ©rabilitÃ© Bash</a></li>
<li><a href="../fr461271/index.html">Comment promouvoir une application mobile en 2019: 4 faÃ§ons pratiques + outils utiles</a></li>
<li><a href="../fr461273/index.html">Approche gourmande et machines Ã  sous. Analyse des tÃ¢ches de la piste ML du championnat de programmation</a></li>
<li><a href="../fr461277/index.html">PrÃ©sentation de l'outil gratuit SQLIndexManager</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>