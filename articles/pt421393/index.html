<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÉüèø üòΩ üìä Cesta de Mailchimp abandonada: um guia para os pregui√ßosos üëäüèø üíà üç©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Primeiro, um pouco ofensivo :) Cedo ou tarde, qualquer loja online tem a quest√£o de montar uma cesta abandonada. As estat√≠sticas e a sensa√ß√£o de perda...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cesta de Mailchimp abandonada: um guia para os pregui√ßosos</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421393/">  Primeiro, um pouco ofensivo :) Cedo ou tarde, qualquer loja online tem a quest√£o de montar uma cesta abandonada.  As estat√≠sticas e a sensa√ß√£o de perda de dinheiro sugando o est√¥mago n√£o poupam ningu√©m. <br><br><h4>  Porcentagem de cestas abandonadas de 2006 a 2017 </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/a39/77d/91a/a3977d91a0ebd3217886009fec230985.jpg" alt="Porcentagem de cestas abandonadas de 2006 a 2017"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fonte</a></i> <br><br>  Porcentagem de cestas abandonadas no primeiro trimestre de 2018 por setor: <br><img src="https://habrastorage.org/getpro/habr/post_images/633/2b5/be6/6332b5be64d04bbd4ca0d1defe9e7b14.jpg" alt="Porcentagem de cestas abandonadas no primeiro trimestre de 2018 por setor"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fonte</a></i> <br><br>  Ao mesmo tempo, apesar das estat√≠sticas geralmente dispon√≠veis, a maioria das lojas on-line n√£o usa os recursos dispon√≠veis e n√£o conecta uma cesta abandonada.  Um recente estudo "em casa" da EmailSoldiers mostra claramente que a maioria das lojas n√£o se preocupa com isso. <br><a name="habracut"></a><br><h4>  Estat√≠sticas atuais de cestas abandonadas conectadas </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/fd4/b56/83f/fd4b5683f724d5004046e14523b95f69.jpg" alt="Pesquisa de Soldados"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fonte</a></i> <br><br>  Ao mesmo tempo, todos (e n√≥s tamb√©m n√£o somos santos) acompanham o tr√°fego, exibem an√∫ncios e criativos, mas nem tentam devolver a pessoa que quebrou no √∫ltimo momento. <br><br>  Por√©m, na primeira itera√ß√£o, voc√™ pode obter um aumento de pedidos usando uma carta sem conte√∫do din√¢mico, basta configur√°-la.  Fa√ßa um esfor√ßo apenas uma vez para que, em segundo plano, traga dinheiro - isso n√£o √© um conto de fadas? <br><br>  Naturalmente, uma carta com conte√∫do din√¢mico no qual os produtos da cesta s√£o puxados pode funcionar melhor.  Ou talvez outro gatinho com olhos tristes seja mais influente para o seu p√∫blico.  Ou voc√™ puxa as mercadorias recomendadas para as que est√£o na cesta e v√™ que elas s√£o compradas com mais frequ√™ncia por meio de cartas e aumenta a verifica√ß√£o m√©dia.  Ou ent√£o, voc√™ poder√° criar uma s√©rie de cartas a partir das quais a convers√£o ser√° ainda maior. <br><br>  Voc√™ pode melhorar e testar letras de uma cesta abandonada para um ideal inating√≠vel, mas qualquer letra configurada j√° √© incomparavelmente melhor que nada. <br><br><h4>  Convers√£o para uma cesta abandonada de acordo com RetailRocket </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/df2/2f9/684/df22f968450761e23695591fcd2931af.jpg" alt="RetailRocket convers√£o de cesta abandonada"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fonte</a></i> <br><br>  E assim, o camarada <a href="">Artem Aleksandrov e eu</a> come√ßamos a introdu√ß√£o da cesta por dois lados. <br><br><h2>  Implementa√ß√£o t√©cnica </h2><br><h4>  TOR para integra√ß√£o </h4><br>  Descreva brevemente a ess√™ncia da tarefa. <br><br>  Tarefa: conectar um carrinho abandonado para o site xxx.xx ao servi√ßo de correio Mailchimp <br><br>  Distribu√≠mos todos os materiais necess√°rios. <br><br>  Chave da API: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-usXX <br><br>  Onde conseguir a chave? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f9f/511/fc0/f9f511fc0d1ff7d44d41d19463cd362e.jpg" alt="Onde conseguir a chave?"><br><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Damos um link para a documenta√ß√£o</a> <br><br>  ID da planilha √† qual conectamos a Loja: XXXXXXXXXX <br><br>  Onde posso obter o ID da planilha? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/215/996/6cb/2159966cb62dc60e25079b86c5905aca.jpg" alt="Onde posso obter o ID da planilha?"><br><br>  Um servi√ßo de correio deve ser criado com anteced√™ncia.  Assim que a solicita√ß√£o da API √© recebida pelo servi√ßo de correspond√™ncia, a mensagem √© gerada automaticamente e o destinat√°rio √© adicionado √† fila para envio. <br><br>  Para o nosso caso, escolhemos a seguinte l√≥gica para enviar uma cesta abandonada: <br>  Se um usu√°rio autorizado no site adicionar mercadorias √† cesta, n√£o concluir a transa√ß√£o e n√£o concluir o pedido, a cesta permanecer√° inalterada por 1 hora.  Depois disso, uma solicita√ß√£o √© enviada ao Mailchimp, no qual s√£o transmitidos o email, a composi√ß√£o do pedido do usu√°rio, imagens do produto, pre√ßo dos produtos e um link para a cesta do usu√°rio. <br><br><h4>  Modelo de Layout </h4><br>  Ao criar automa√ß√£o para uma cesta abandonada, o mailchim pergunta imediatamente se haver√° uma letra ou v√°rias e sugere a escolha de uma loja conectada. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/12d/288/b80/12d288b80aed84cc9ac1b3b81b4d3d6d.jpg" alt="Criar automa√ß√£o para um carrinho abandonado no Mailchimp"><br><br>  Nos modelos b√°sicos, o mch oferece tr√™s op√ß√µes de escolha: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7f2/402/d62/7f2402d625f7174f3a18f42849080bea.jpg" alt="Selecione letras para uma cesta abandonada do Mailchimp"><br><ol><li>  Cesta abandonada com mercadorias din√¢micas </li><li>  Cesta abandonada com recomenda√ß√µes de compras (precisa ser configurada separadamente) </li><li>  Cesta abandonada sem mercadorias (apenas uma carta) </li></ol><br>  Nas melhores tradi√ß√µes, se tiver tempo, voc√™ mesmo pode fazer a cesta. <br><br>  Os produtos din√¢micos sem estilos s√£o mais ou menos assim (esque√ßa a indenta√ß√£o, eles s√£o mostrados aqui): <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> *|ABANDONED_CART:[$total=3]|* <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*|CART:URL|*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*|PRODUCT:TITLE|*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">target</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_blank"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*|PRODUCT:IMAGE_URL|*"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> *|PRODUCT:TITLE|* ‚Äî *|PRODUCT:PRICE|* <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> *|END:ABANDONED_CART|* <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> *|END:ABANDONED_CART|* <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Parece que se voc√™ alterar o n√∫mero na vari√°vel <b>* | ABANDONED_CART: [$ total = 3] | *</b> , a letra exibir√° uma quantidade diferente de mercadorias, mas n√£o, coloque pelo menos 5, pelo menos 100, o mch se recusar√° a mostrar outra quantidade. <br><br>  E, o que tamb√©m √© um pouco estranho, a vari√°vel <b>* | PRODUCT: PRICE | *</b> √© substitu√≠da pelos valores de formato RUB288 e, por algum motivo, tamb√©m √© imposs√≠vel mudar isso, mas mais adiante. <br><br>  Para variar, tentamos substituir vari√°veis ‚Äã‚Äãpelo n√∫mero de jogos e pelo custo total do pedido, que transmitimos via API, mas o mailchimp aqui disse que n√£o.  Bem, que assim seja. <br><br><h4>  Uma palavra para o programador :) </h4><br>  Com o mailchimp, houve uma experi√™ncia hist√≥rica de integra√ß√£o com o mandril de servi√ßo de terceiros, tudo √© simples e claro l√°.  Documenta√ß√£o muito amig√°vel (√© claro, em ingl√™s), mas n√£o havia arestas e funcionou desde o primeiro chute. <br><br>  Al√©m disso, um mecanismo de inscri√ß√£o atrav√©s de formul√°rios especiais foi introduzido em nosso site.  Aqui, sentimos plenamente o eufemismo e a ambiguidade da documenta√ß√£o do mailchimp.  O ingl√™s n√£o √© um problema para um desenvolvedor experiente, mas o conhecimento do dialeto klingon n√£o est√° impl√≠cito por padr√£o. <br><br>  Os dados iniciais s√£o: a linguagem php7 e a estrutura yii2, que j√° cresceu muito com seu ecossistema.  I.e.  J√° temos seis pequenos projetos que est√£o tentando usar componentes comuns no backend e no front-end.  Consequentemente, a implementa√ß√£o de qualquer tarefa requer a solu√ß√£o independente de seu projeto, mas isso n√£o implica independ√™ncia da estrutura, porque  voc√™ tem que pagar por isso com horas humanas, das quais h√° sempre uma escassez. <br><br>  Tendo recebido a tarefa de integra√ß√£o, devemos primeiro olhar em volta.  O que nos √© dado?  Em primeiro lugar, o servi√ßo mailchimp com o qual voc√™ precisa fazer amizade.  Vamos ao github e vemos que existem muitas implementa√ß√µes.  Mas a escolha √© simples - o pacote mais popular de 1,5 mil estrelas ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">drewm / mailchimp-api</a> ). <br><br>  O pacote fornece um inv√≥lucro simples sobre a intera√ß√£o restante com um chimp de correio.  S√≥ podemos adquirir isso com nossa l√≥gica. <br><br>  Em segundo lugar, recebemos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> .  Com base na documenta√ß√£o, temos um recurso de loja com recursos aninhados: regra de carrinho, cliente, pedido, produto e promo√ß√£o.  Para uma cesta abandonada sem produtos recomendados, precisamos apenas de Produto, Carrinho e Cliente.  O carrinho, por sua vez, consiste no conjunto de linhas do carrinho e o produto cont√©m variantes do produto. <br><br>  Decompusemos a tarefa da seguinte maneira: <br><br><ol><li>  Carregar dados da loja para lojas </li><li>  Fa√ßa o download de todos os produtos compr√°veis ‚Äã‚Äãem Produtos </li><li>  Configurar o carregamento de cestas com usu√°rios em uma programa√ß√£o </li></ol><br>  Ok, vamos l√°.  Antes de tudo, assumimos a ess√™ncia da "loja".  Decidimos usar imediatamente a vers√£o de teste e combate da loja e, dependendo da vari√°vel de ambiente respons√°vel pelo modo de donzela / prod, trabalhamos com uma loja ou com outra. <br><br>  Para baixar dados da loja, fazemos uma solicita√ß√£o de postagem em / ecommerce / stores com o seguinte conjunto de par√¢metros: <br><br><pre> <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'dev.***.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'list_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'****'</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'*** - test'</span></span>, <span class="hljs-string"><span class="hljs-string">'domain'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'dev.***.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'email_address'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'admin@***.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'currency_code'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'RUB'</span></span>, <span class="hljs-string"><span class="hljs-string">'primary_locale'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'money_format'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'‚ÇΩ'</span></span>, ]</code> </pre> <br>  Existem v√°rias outras op√ß√µes, mas tudo depende das necessidades.  Porque  n√£o √≠amos usar os detalhes de contato da loja em cartas, n√£o preenchemos os campos de telefone, endere√ßo, fuso hor√°rio etc. <br>  Mas uma pequena surpresa nos esperava.  O campo money_format parece ter sido criado especialmente para a capacidade de apresentar o pre√ßo em um formato conveniente para n√≥s.  Mas, ao criar um modelo de cesto abandonado, o email substitui teimosamente o RUB antes do n√∫mero.  Mailchimp, pare com isso! <br><br>  Ap√≥s o download, podemos verificar os dados usando a solicita√ß√£o de recebimento no endere√ßo / com√©rcio eletr√¥nico / lojas para ver todas as lojas carregadas ou / ecommerce / stores / {id} para obter dados em uma loja espec√≠fica. <br><br>  Agora voc√™ pode adicionar todos os outros dados, porque a Loja √© o ponto raiz da nossa √°rvore de dados, porque  enviaremos todos os outros dados para uma loja espec√≠fica. <br><br>  Portanto, para que o MCH possa substituir produtos em uma cesta abandonada, ele precisa alimentar esses produtos.  Para isso, temos o endere√ßo / ecommerce / stores / {store_id} / products, para o qual enviamos solicita√ß√µes posteriores para a cria√ß√£o de produtos no sistema. <br><br><pre> <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'742'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'handle'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'kastrulya'</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/catalog/kastrulya/'</span></span>, <span class="hljs-string"><span class="hljs-string">'description'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' ‚Äî    .  ,       .  ,        !           !'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'vendor'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-string"><span class="hljs-string">'image_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/images/742/product.png'</span></span>, <span class="hljs-string"><span class="hljs-string">'variants'</span></span> =&gt; [ [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'742'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/catalog/kastrulya/'</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">890</span></span>, <span class="hljs-string"><span class="hljs-string">'sku'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'KA453'</span></span>, <span class="hljs-string"><span class="hljs-string">'inventory_quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-string"><span class="hljs-string">'image_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/images/742/product.png'</span></span>, <span class="hljs-string"><span class="hljs-string">'visibility'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'visible'</span></span>, ], ], ]</code> </pre><br>  O que √© t√£o not√°vel?  Bem, primeiro, cada produto deve consistir em pelo menos uma oferta de produto.  Essencialmente, o Produto √© um cont√™iner para carregar ofertas de produtos.  Al√©m disso, o ID do produto e a oferta do produto podem se cruzar, porque esses s√£o recursos diferentes na API do MCH. <br><br>  E aqui come√ßou o eufemismo da documenta√ß√£o do MCH.  Eu tinha que adivinhar, mesmo que n√£o fosse dif√≠cil, mas voc√™ poderia faz√™-lo normalmente, e nem sempre. <br><br>  O campo do identificador foi descrito como "o identificador de um produto".  Ok, ap√≥s a consulta, decidimos que isso faz parte do URL relacionado ao pr√≥prio produto (cnc).  Mas isso foi confirmado apenas durante os testes. <br><br>  Voc√™ tamb√©m pode anexar uma s√©rie de fotos ao produto, mas decidimos que isso n√£o seria √∫til para n√≥s e, portanto, apenas a imagem principal foi carregada no produto e em cada oferta do produto. <br><br>  E aqui tivemos um problema, por algum motivo as mercadorias n√£o apareceram nos modelos de gr√°fico de correio. <br><br>  Come√ßamos a cavar a doca para o Produto.  E eles encontraram um campo de visibilidade com uma descri√ß√£o luxuosa: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/525/123/aae/525123aae8eff2a8a1a595072d92b2f6.jpg" alt="descri√ß√£o do campo de visibilidade"><br><br>  Bem, digite String!  E o que pode ser transferido para l√°?  Por que √© imposs√≠vel descrever todos os significados poss√≠veis ?!  Posso enviar para l√°, por exemplo, "mostre-me pls!". <br><br>  Felizmente, h√° um exemplo de solicita√ß√£o! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/57b/e08/dbe/57be08dbe97502fc302cc4de5dc0e4bf.jpg" alt="exemplo de solicita√ß√£o"><br><br>  Bem, isso n√£o cancela o problema.  N√£o sei que outros valores podem ser √∫teis. <br><br>  Todo mundo lidou com isso!  Agora, o profissional de marketing por email pode verificar a disponibilidade de mercadorias no sistema atrav√©s da cria√ß√£o de um modelo com a participa√ß√£o de mercadorias ou todas as mesmas solicita√ß√µes de obten√ß√£o usando o console. <br><br>  Em seguida, somos confrontados com a tarefa de carregar cestas abandonadas no MCH.  Inicialmente, duas op√ß√µes vieram √† mente: <br><br><ol><li>  Cada vez que voc√™ altera a cesta (adicionar / remover mercadorias), repetimos essa a√ß√£o no MCH.  Das desvantagens - um grande n√∫mero de solicita√ß√µes para um servi√ßo externo sugere-se imediatamente. </li><li>  Uma vez a cada n minutos, observe cestas que n√£o foram alteradas h√° mais de uma hora.  Ent√£o n√≥s os enviamos para o MCH.  H√° apenas um problema - acompanhar as cestas que foram retomadas depois que foram para o MCH. </li></ol><br>  Primeiro, solicitamos ao nosso banco de dados (doravante denominado DB) nossos dados em uma janela de 1 hora a 3. Por que 3?  Uma hora ap√≥s a √∫ltima altera√ß√£o, enviamos a cesta para o sistema.  No MCH, o intervalo m√≠nimo poss√≠vel para o envio da cesta √© de 1 hora.  Portanto, em teoria, ap√≥s 2 horas ¬± 5 minutos, uma carta ser√° enviada.  Portanto, 3 horas √© um valor, mesmo com uma margem. <br><br>  Depois de receber os dados do banco de dados, solicitamos get no endere√ßo / ecommerce / stores / {store_id} / carrts.  Assim, obtemos todas as cestas que est√£o no sistema de com√©rcio eletr√¥nico e aguardamos a sua vez de enviar (ou j√° foram enviadas).  Por que precisamos disso?  √â necess√°rio sincronizar com nossos dados.  Enviaremos todas as cestas recebidas do banco de dados, mas precisamos excluir as que n√£o estiverem mais no intervalo de 1 a 3 horas.  Depois de 3x - dados j√° irrelevantes.  At√© uma hora - cestas que podem ser renovadas novamente ou fazer um pedido. <br><br>  Para excluir, basta encontrar a diferen√ßa entre as duas matrizes / cole√ß√µes de cestas. <br>  Depois de receber as cestas que precisam ser exclu√≠das, enviamos uma solicita√ß√£o de exclus√£o / ecommerce / stores / {store_id} / carrts / {cart_id}. <br><br>  Em seguida, pegamos as cestas para download e as enviamos por p√≥s-solicita√ß√µes ao sistema em um ciclo. <br><br>  Os par√¢metros do carrinho s√£o mais ou menos assim: <br><br><pre> <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1207'</span></span>, <span class="hljs-string"><span class="hljs-string">'customer'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'25'</span></span>, <span class="hljs-string"><span class="hljs-string">'email_address'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'email@example.com'</span></span>, <span class="hljs-string"><span class="hljs-string">'opt_in_status'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, ], <span class="hljs-string"><span class="hljs-string">'currency_code'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'RUB'</span></span>, <span class="hljs-string"><span class="hljs-string">'order_total'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1597</span></span>, <span class="hljs-string"><span class="hljs-string">'checkout_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/cart/abandoned/?cart=eyJpdGVtcyI6eyI1OTgwIjoxLCIzNDA0IjoxLCI3NzMiOjEsIjkwNTgiOjEsIjkwOTEiOjEsIjE4ODciOjEsIjc4NCI6MSwiNTExMSI6MSwiODA1MyI6MSwiMTk0MSI6MSwiNTQ0NSI6MSwiNzk1NCI6MywiOTA2NyI6NCwiOTA2NSI6NCwiNzg0MyI6MSwiOTA2NiI6M30sInByb21vY29kZSI6bnVsbH0%253D'</span></span>, <span class="hljs-string"><span class="hljs-string">'lines'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'123'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">841</span></span>, ], <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'124'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">756</span></span>, ], ], ]</code> ? Carrinho //***.ru/cart/abandoned/ = eyJpdGVtcyI6eyI1OTgwIjoxLCIzNDA0IjoxLCI3NzMiOjEsIjkwNTgiOjEsIjkwOTEiOjEsIjE4ODciOjEsIjc4NCI6MSwiNTExMSI6MSwiODA1MyI6MSwiMTk0MSI6MSwiNTQ0NSI6MSwiNzk1NCI6MywiOTA2NyI6NCwiOTA2NSI6NCwiNzg0MyI6MSwiOTA2NiI6M30sInByb21vY29kZSI6bnVsbH0% 253D', <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1207'</span></span>, <span class="hljs-string"><span class="hljs-string">'customer'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'25'</span></span>, <span class="hljs-string"><span class="hljs-string">'email_address'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'email@example.com'</span></span>, <span class="hljs-string"><span class="hljs-string">'opt_in_status'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, ], <span class="hljs-string"><span class="hljs-string">'currency_code'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'RUB'</span></span>, <span class="hljs-string"><span class="hljs-string">'order_total'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1597</span></span>, <span class="hljs-string"><span class="hljs-string">'checkout_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/cart/abandoned/?cart=eyJpdGVtcyI6eyI1OTgwIjoxLCIzNDA0IjoxLCI3NzMiOjEsIjkwNTgiOjEsIjkwOTEiOjEsIjE4ODciOjEsIjc4NCI6MSwiNTExMSI6MSwiODA1MyI6MSwiMTk0MSI6MSwiNTQ0NSI6MSwiNzk1NCI6MywiOTA2NyI6NCwiOTA2NSI6NCwiNzg0MyI6MSwiOTA2NiI6M30sInByb21vY29kZSI6bnVsbH0%253D'</span></span>, <span class="hljs-string"><span class="hljs-string">'lines'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'123'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">841</span></span>, ], <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'124'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">756</span></span>, ], ], ]</code> </pre><br>  E, novamente, nossa rubrica favorita √© "adivinhe como esses campos funcionam".  Por exemplo, pelo m√©todo de cutucada cient√≠fica, foi revelado que √© poss√≠vel n√£o criar um comprador com uma solicita√ß√£o separada.  √â necess√°rio transferir o conjunto m√≠nimo necess√°rio de campos e ele ser√° criado automaticamente se n√£o estiver no sistema.  No nosso caso, nos limitamos a id, email, opt_in_status.  O √∫ltimo par√¢metro √© respons√°vel pelo status da assinatura do usu√°rio em nossa planilha.  Se for verdade, isso significa que o estado est√° inscrito, caso contr√°rio transacional. <br><br>  A lista de produtos √© carregada sem problemas pela matriz Cart Lines, que por sua vez √© um recurso da entidade Cart.  I.e.  podemos gerenciar esse conjunto separadamente com solicita√ß√µes de descanso. <br><br>  Bem, isso √© tudo, parece?  Mas n√£o. <br><br>  Ao testar, notamos que o envio da mesma cesta √© enviado apenas uma vez.  Embora o tenhamos removido do sistema e baixado novamente.  Nada √© dito em lugar algum, nem uma √∫nica palavra!  Como resultado, empiricamente, com a ajuda de uma m√£e, tomamos como base a hip√≥tese de que uma cesta com o mesmo id pode ser enviada apenas uma vez. <br><br>  Aqui, concordo plenamente com os criadores de conte√∫do que essa restri√ß√£o nos salva de usu√°rios de spam.  Mas escreva sobre isso!  N√£o precisamos de miss√µes, temos o suficiente de nossos erros m√≠sticos no c√≥digo que escrevemos. <br><br>  Depois de tudo isso, o MCH come√ßou a nos enviar lindas cartas sobre a cesta abandonada.  E ent√£o uma segunda pergunta apareceu.  Se o usu√°rio jogou a cesta e retornou da carta para sua pr√≥pria conta, ou seja, ele foi autorizado no momento de clicar no link, ele entrar√° na cesta sem problemas.  E assim acontece que a carta diz ‚Äúligado!  leve sua cesta de volta! ‚Äù, e quando a atravessamos, dizemos:‚Äú Opa, algo estava perdido!  N√≥s n√£o tocamos em nada!  √â ele pr√≥prio! " <br><br>  Decidiu-se codificar a composi√ß√£o da cesta em uma sequ√™ncia e pass√°-la para checkout_url ao enviar a cesta ao MCH.  E quando voc√™ for ao site, pegue essa linha, decodifique e jogue todas as mercadorias na cesta, sem esquecer de redefini-la completamente antes disso. <br><br>  Portanto, n√£o importa para qual navegador enviamos o usu√°rio, ele recebe sua cesta, como prometemos.  O √∫nico aspecto negativo √© que ele s√≥ pode fazer login.  Mas autorizar por meio de um link √© uma m√° educa√ß√£o e, na verdade, √© um neg√≥cio perigoso, antes de tudo para nossos clientes. <br>  Qual √© o resultado?  Em princ√≠pio, n√£o houve problemas espec√≠ficos durante a implementa√ß√£o, pois muitas vezes as respostas do MCH ajudavam com erros relacionados √† valida√ß√£o dos campos transferidos.  Mas haveria ainda menos deles se eles normalmente descrevessem humanamente todas essas sutilezas do trabalho da MCH e descrevessem os campos com mais detalhes. <br><br><h2>  Configura√ß√£o de relat√≥rio no Google.Analytics </h2><br>  Para acompanhar o sucesso de toda a opera√ß√£o, voc√™ precisar√° configurar e analisar periodicamente o relat√≥rio na an√°lise.  Imagine que todos, como adultos, tenham com√©rcio eletr√¥nico conectado, caso contr√°rio, um milagre n√£o funcionar√° :) <br><br>  Para coletar um novo relat√≥rio para uma cesta abandonada, v√° para "Meus relat√≥rios": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/afe/749/f87/afe749f87d1c6bd4e5a0810dab40b4ef.jpg" alt="Meus relat√≥rios"><br><br>  Mais "Adicionar relat√≥rio": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/288/8bd/ba2/2888bdba2a5749ccc90c88c3f5c80f49.jpg" alt="Adicionar relat√≥rio"><br><br>  E depois disso, adicionamos os par√¢metros que rastrearemos.  Decidimos que olhar√≠amos para a cesta abandonada no contexto das cidades; voc√™ pode ter uma vis√£o diferente. <br><br>  Para um mailchamp, a campanha padr√£o para uma cesta abandonada √© ABANDONED_CART_EMAIL, n√≥s a substitu√≠mos no filtro e obtemos um relat√≥rio. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca0/a77/b25/ca0a77b256b42242851ceaed308e02c7.jpg" alt="imagem"><br><br>  Isso √© tudo garfos! <br><br>  Agora voc√™ est√° configurado para enviar a cesta abandonada e um relat√≥rio pelo qual voc√™ pode assistir a exaust√£o dela.  E teste, teste, teste!  ;) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt421393/">https://habr.com/ru/post/pt421393/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt421383/index.html">Epic Growth Conference Autumn 2018 - confer√™ncia de marketing de produto em Moscou</a></li>
<li><a href="../pt421385/index.html">Aprenda o OpenGL. Li√ß√£o 5.10 - Oclus√£o ambiental do espa√ßo na tela</a></li>
<li><a href="../pt421387/index.html">Entrevista com Lennart Pottering no Linux Piter sobre mudan√ßas no Linux, sobre systemd e por que participar de confer√™ncias</a></li>
<li><a href="../pt421389/index.html">Separa√ß√£o de poderes administrativos em Zimbra</a></li>
<li><a href="../pt421391/index.html">HackThings - um grande hackathon na Internet das coisas de 7 a 9 de setembro na Skoltech</a></li>
<li><a href="../pt421395/index.html">Relat√≥rio do Clube de Roma 2018, cap√≠tulo 3.7: ‚ÄúClima: boas not√≠cias, mas grandes problemas‚Äù</a></li>
<li><a href="../pt421397/index.html">Inicie o Mini AI Cup # 3. Batalha mec√¢nica em espa√ßos confinados</a></li>
<li><a href="../pt421399/index.html">An√°lise do Backdoor do Outlook do Cybergroup Turla</a></li>
<li><a href="../pt421401/index.html">Anatomia de sistemas de recomenda√ß√£o. Parte dois</a></li>
<li><a href="../pt421403/index.html">Semana de Seguran√ßa 32: Drama Fortnite-Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>