<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👃🏿 😽 📊 Cesta de Mailchimp abandonada: um guia para os preguiçosos 👊🏿 💈 🍩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Primeiro, um pouco ofensivo :) Cedo ou tarde, qualquer loja online tem a questão de montar uma cesta abandonada. As estatísticas e a sensação de perda...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cesta de Mailchimp abandonada: um guia para os preguiçosos</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421393/">  Primeiro, um pouco ofensivo :) Cedo ou tarde, qualquer loja online tem a questão de montar uma cesta abandonada.  As estatísticas e a sensação de perda de dinheiro sugando o estômago não poupam ninguém. <br><br><h4>  Porcentagem de cestas abandonadas de 2006 a 2017 </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/a39/77d/91a/a3977d91a0ebd3217886009fec230985.jpg" alt="Porcentagem de cestas abandonadas de 2006 a 2017"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fonte</a></i> <br><br>  Porcentagem de cestas abandonadas no primeiro trimestre de 2018 por setor: <br><img src="https://habrastorage.org/getpro/habr/post_images/633/2b5/be6/6332b5be64d04bbd4ca0d1defe9e7b14.jpg" alt="Porcentagem de cestas abandonadas no primeiro trimestre de 2018 por setor"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fonte</a></i> <br><br>  Ao mesmo tempo, apesar das estatísticas geralmente disponíveis, a maioria das lojas on-line não usa os recursos disponíveis e não conecta uma cesta abandonada.  Um recente estudo "em casa" da EmailSoldiers mostra claramente que a maioria das lojas não se preocupa com isso. <br><a name="habracut"></a><br><h4>  Estatísticas atuais de cestas abandonadas conectadas </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/fd4/b56/83f/fd4b5683f724d5004046e14523b95f69.jpg" alt="Pesquisa de Soldados"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fonte</a></i> <br><br>  Ao mesmo tempo, todos (e nós também não somos santos) acompanham o tráfego, exibem anúncios e criativos, mas nem tentam devolver a pessoa que quebrou no último momento. <br><br>  Porém, na primeira iteração, você pode obter um aumento de pedidos usando uma carta sem conteúdo dinâmico, basta configurá-la.  Faça um esforço apenas uma vez para que, em segundo plano, traga dinheiro - isso não é um conto de fadas? <br><br>  Naturalmente, uma carta com conteúdo dinâmico no qual os produtos da cesta são puxados pode funcionar melhor.  Ou talvez outro gatinho com olhos tristes seja mais influente para o seu público.  Ou você puxa as mercadorias recomendadas para as que estão na cesta e vê que elas são compradas com mais frequência por meio de cartas e aumenta a verificação média.  Ou então, você poderá criar uma série de cartas a partir das quais a conversão será ainda maior. <br><br>  Você pode melhorar e testar letras de uma cesta abandonada para um ideal inatingível, mas qualquer letra configurada já é incomparavelmente melhor que nada. <br><br><h4>  Conversão para uma cesta abandonada de acordo com RetailRocket </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/df2/2f9/684/df22f968450761e23695591fcd2931af.jpg" alt="RetailRocket conversão de cesta abandonada"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fonte</a></i> <br><br>  E assim, o camarada <a href="">Artem Aleksandrov e eu</a> começamos a introdução da cesta por dois lados. <br><br><h2>  Implementação técnica </h2><br><h4>  TOR para integração </h4><br>  Descreva brevemente a essência da tarefa. <br><br>  Tarefa: conectar um carrinho abandonado para o site xxx.xx ao serviço de correio Mailchimp <br><br>  Distribuímos todos os materiais necessários. <br><br>  Chave da API: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-usXX <br><br>  Onde conseguir a chave? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f9f/511/fc0/f9f511fc0d1ff7d44d41d19463cd362e.jpg" alt="Onde conseguir a chave?"><br><br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Damos um link para a documentação</a> <br><br>  ID da planilha à qual conectamos a Loja: XXXXXXXXXX <br><br>  Onde posso obter o ID da planilha? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/215/996/6cb/2159966cb62dc60e25079b86c5905aca.jpg" alt="Onde posso obter o ID da planilha?"><br><br>  Um serviço de correio deve ser criado com antecedência.  Assim que a solicitação da API é recebida pelo serviço de correspondência, a mensagem é gerada automaticamente e o destinatário é adicionado à fila para envio. <br><br>  Para o nosso caso, escolhemos a seguinte lógica para enviar uma cesta abandonada: <br>  Se um usuário autorizado no site adicionar mercadorias à cesta, não concluir a transação e não concluir o pedido, a cesta permanecerá inalterada por 1 hora.  Depois disso, uma solicitação é enviada ao Mailchimp, no qual são transmitidos o email, a composição do pedido do usuário, imagens do produto, preço dos produtos e um link para a cesta do usuário. <br><br><h4>  Modelo de Layout </h4><br>  Ao criar automação para uma cesta abandonada, o mailchim pergunta imediatamente se haverá uma letra ou várias e sugere a escolha de uma loja conectada. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/12d/288/b80/12d288b80aed84cc9ac1b3b81b4d3d6d.jpg" alt="Criar automação para um carrinho abandonado no Mailchimp"><br><br>  Nos modelos básicos, o mch oferece três opções de escolha: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7f2/402/d62/7f2402d625f7174f3a18f42849080bea.jpg" alt="Selecione letras para uma cesta abandonada do Mailchimp"><br><ol><li>  Cesta abandonada com mercadorias dinâmicas </li><li>  Cesta abandonada com recomendações de compras (precisa ser configurada separadamente) </li><li>  Cesta abandonada sem mercadorias (apenas uma carta) </li></ol><br>  Nas melhores tradições, se tiver tempo, você mesmo pode fazer a cesta. <br><br>  Os produtos dinâmicos sem estilos são mais ou menos assim (esqueça a indentação, eles são mostrados aqui): <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> *|ABANDONED_CART:[$total=3]|* <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*|CART:URL|*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*|PRODUCT:TITLE|*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">target</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_blank"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*|PRODUCT:IMAGE_URL|*"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> *|PRODUCT:TITLE|* — *|PRODUCT:PRICE|* <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> *|END:ABANDONED_CART|* <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> *|END:ABANDONED_CART|* <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Parece que se você alterar o número na variável <b>* | ABANDONED_CART: [$ total = 3] | *</b> , a letra exibirá uma quantidade diferente de mercadorias, mas não, coloque pelo menos 5, pelo menos 100, o mch se recusará a mostrar outra quantidade. <br><br>  E, o que também é um pouco estranho, a variável <b>* | PRODUCT: PRICE | *</b> é substituída pelos valores de formato RUB288 e, por algum motivo, também é impossível mudar isso, mas mais adiante. <br><br>  Para variar, tentamos substituir variáveis ​​pelo número de jogos e pelo custo total do pedido, que transmitimos via API, mas o mailchimp aqui disse que não.  Bem, que assim seja. <br><br><h4>  Uma palavra para o programador :) </h4><br>  Com o mailchimp, houve uma experiência histórica de integração com o mandril de serviço de terceiros, tudo é simples e claro lá.  Documentação muito amigável (é claro, em inglês), mas não havia arestas e funcionou desde o primeiro chute. <br><br>  Além disso, um mecanismo de inscrição através de formulários especiais foi introduzido em nosso site.  Aqui, sentimos plenamente o eufemismo e a ambiguidade da documentação do mailchimp.  O inglês não é um problema para um desenvolvedor experiente, mas o conhecimento do dialeto klingon não está implícito por padrão. <br><br>  Os dados iniciais são: a linguagem php7 e a estrutura yii2, que já cresceu muito com seu ecossistema.  I.e.  Já temos seis pequenos projetos que estão tentando usar componentes comuns no backend e no front-end.  Consequentemente, a implementação de qualquer tarefa requer a solução independente de seu projeto, mas isso não implica independência da estrutura, porque  você tem que pagar por isso com horas humanas, das quais há sempre uma escassez. <br><br>  Tendo recebido a tarefa de integração, devemos primeiro olhar em volta.  O que nos é dado?  Em primeiro lugar, o serviço mailchimp com o qual você precisa fazer amizade.  Vamos ao github e vemos que existem muitas implementações.  Mas a escolha é simples - o pacote mais popular de 1,5 mil estrelas ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">drewm / mailchimp-api</a> ). <br><br>  O pacote fornece um invólucro simples sobre a interação restante com um chimp de correio.  Só podemos adquirir isso com nossa lógica. <br><br>  Em segundo lugar, recebemos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documentação</a> .  Com base na documentação, temos um recurso de loja com recursos aninhados: regra de carrinho, cliente, pedido, produto e promoção.  Para uma cesta abandonada sem produtos recomendados, precisamos apenas de Produto, Carrinho e Cliente.  O carrinho, por sua vez, consiste no conjunto de linhas do carrinho e o produto contém variantes do produto. <br><br>  Decompusemos a tarefa da seguinte maneira: <br><br><ol><li>  Carregar dados da loja para lojas </li><li>  Faça o download de todos os produtos compráveis ​​em Produtos </li><li>  Configurar o carregamento de cestas com usuários em uma programação </li></ol><br>  Ok, vamos lá.  Antes de tudo, assumimos a essência da "loja".  Decidimos usar imediatamente a versão de teste e combate da loja e, dependendo da variável de ambiente responsável pelo modo de donzela / prod, trabalhamos com uma loja ou com outra. <br><br>  Para baixar dados da loja, fazemos uma solicitação de postagem em / ecommerce / stores com o seguinte conjunto de parâmetros: <br><br><pre> <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'dev.***.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'list_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'****'</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'*** - test'</span></span>, <span class="hljs-string"><span class="hljs-string">'domain'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'dev.***.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'email_address'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'admin@***.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'currency_code'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'RUB'</span></span>, <span class="hljs-string"><span class="hljs-string">'primary_locale'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'money_format'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'₽'</span></span>, ]</code> </pre> <br>  Existem várias outras opções, mas tudo depende das necessidades.  Porque  não íamos usar os detalhes de contato da loja em cartas, não preenchemos os campos de telefone, endereço, fuso horário etc. <br>  Mas uma pequena surpresa nos esperava.  O campo money_format parece ter sido criado especialmente para a capacidade de apresentar o preço em um formato conveniente para nós.  Mas, ao criar um modelo de cesto abandonado, o email substitui teimosamente o RUB antes do número.  Mailchimp, pare com isso! <br><br>  Após o download, podemos verificar os dados usando a solicitação de recebimento no endereço / comércio eletrônico / lojas para ver todas as lojas carregadas ou / ecommerce / stores / {id} para obter dados em uma loja específica. <br><br>  Agora você pode adicionar todos os outros dados, porque a Loja é o ponto raiz da nossa árvore de dados, porque  enviaremos todos os outros dados para uma loja específica. <br><br>  Portanto, para que o MCH possa substituir produtos em uma cesta abandonada, ele precisa alimentar esses produtos.  Para isso, temos o endereço / ecommerce / stores / {store_id} / products, para o qual enviamos solicitações posteriores para a criação de produtos no sistema. <br><br><pre> <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'742'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'handle'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'kastrulya'</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/catalog/kastrulya/'</span></span>, <span class="hljs-string"><span class="hljs-string">'description'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' —    .  ,       .  ,        !           !'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'vendor'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-string"><span class="hljs-string">'image_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/images/742/product.png'</span></span>, <span class="hljs-string"><span class="hljs-string">'variants'</span></span> =&gt; [ [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'742'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/catalog/kastrulya/'</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">890</span></span>, <span class="hljs-string"><span class="hljs-string">'sku'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'KA453'</span></span>, <span class="hljs-string"><span class="hljs-string">'inventory_quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-string"><span class="hljs-string">'image_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/images/742/product.png'</span></span>, <span class="hljs-string"><span class="hljs-string">'visibility'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'visible'</span></span>, ], ], ]</code> </pre><br>  O que é tão notável?  Bem, primeiro, cada produto deve consistir em pelo menos uma oferta de produto.  Essencialmente, o Produto é um contêiner para carregar ofertas de produtos.  Além disso, o ID do produto e a oferta do produto podem se cruzar, porque esses são recursos diferentes na API do MCH. <br><br>  E aqui começou o eufemismo da documentação do MCH.  Eu tinha que adivinhar, mesmo que não fosse difícil, mas você poderia fazê-lo normalmente, e nem sempre. <br><br>  O campo do identificador foi descrito como "o identificador de um produto".  Ok, após a consulta, decidimos que isso faz parte do URL relacionado ao próprio produto (cnc).  Mas isso foi confirmado apenas durante os testes. <br><br>  Você também pode anexar uma série de fotos ao produto, mas decidimos que isso não seria útil para nós e, portanto, apenas a imagem principal foi carregada no produto e em cada oferta do produto. <br><br>  E aqui tivemos um problema, por algum motivo as mercadorias não apareceram nos modelos de gráfico de correio. <br><br>  Começamos a cavar a doca para o Produto.  E eles encontraram um campo de visibilidade com uma descrição luxuosa: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/525/123/aae/525123aae8eff2a8a1a595072d92b2f6.jpg" alt="descrição do campo de visibilidade"><br><br>  Bem, digite String!  E o que pode ser transferido para lá?  Por que é impossível descrever todos os significados possíveis ?!  Posso enviar para lá, por exemplo, "mostre-me pls!". <br><br>  Felizmente, há um exemplo de solicitação! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/57b/e08/dbe/57be08dbe97502fc302cc4de5dc0e4bf.jpg" alt="exemplo de solicitação"><br><br>  Bem, isso não cancela o problema.  Não sei que outros valores podem ser úteis. <br><br>  Todo mundo lidou com isso!  Agora, o profissional de marketing por email pode verificar a disponibilidade de mercadorias no sistema através da criação de um modelo com a participação de mercadorias ou todas as mesmas solicitações de obtenção usando o console. <br><br>  Em seguida, somos confrontados com a tarefa de carregar cestas abandonadas no MCH.  Inicialmente, duas opções vieram à mente: <br><br><ol><li>  Cada vez que você altera a cesta (adicionar / remover mercadorias), repetimos essa ação no MCH.  Das desvantagens - um grande número de solicitações para um serviço externo sugere-se imediatamente. </li><li>  Uma vez a cada n minutos, observe cestas que não foram alteradas há mais de uma hora.  Então nós os enviamos para o MCH.  Há apenas um problema - acompanhar as cestas que foram retomadas depois que foram para o MCH. </li></ol><br>  Primeiro, solicitamos ao nosso banco de dados (doravante denominado DB) nossos dados em uma janela de 1 hora a 3. Por que 3?  Uma hora após a última alteração, enviamos a cesta para o sistema.  No MCH, o intervalo mínimo possível para o envio da cesta é de 1 hora.  Portanto, em teoria, após 2 horas ± 5 minutos, uma carta será enviada.  Portanto, 3 horas é um valor, mesmo com uma margem. <br><br>  Depois de receber os dados do banco de dados, solicitamos get no endereço / ecommerce / stores / {store_id} / carrts.  Assim, obtemos todas as cestas que estão no sistema de comércio eletrônico e aguardamos a sua vez de enviar (ou já foram enviadas).  Por que precisamos disso?  É necessário sincronizar com nossos dados.  Enviaremos todas as cestas recebidas do banco de dados, mas precisamos excluir as que não estiverem mais no intervalo de 1 a 3 horas.  Depois de 3x - dados já irrelevantes.  Até uma hora - cestas que podem ser renovadas novamente ou fazer um pedido. <br><br>  Para excluir, basta encontrar a diferença entre as duas matrizes / coleções de cestas. <br>  Depois de receber as cestas que precisam ser excluídas, enviamos uma solicitação de exclusão / ecommerce / stores / {store_id} / carrts / {cart_id}. <br><br>  Em seguida, pegamos as cestas para download e as enviamos por pós-solicitações ao sistema em um ciclo. <br><br>  Os parâmetros do carrinho são mais ou menos assim: <br><br><pre> <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1207'</span></span>, <span class="hljs-string"><span class="hljs-string">'customer'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'25'</span></span>, <span class="hljs-string"><span class="hljs-string">'email_address'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'email@example.com'</span></span>, <span class="hljs-string"><span class="hljs-string">'opt_in_status'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, ], <span class="hljs-string"><span class="hljs-string">'currency_code'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'RUB'</span></span>, <span class="hljs-string"><span class="hljs-string">'order_total'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1597</span></span>, <span class="hljs-string"><span class="hljs-string">'checkout_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/cart/abandoned/?cart=eyJpdGVtcyI6eyI1OTgwIjoxLCIzNDA0IjoxLCI3NzMiOjEsIjkwNTgiOjEsIjkwOTEiOjEsIjE4ODciOjEsIjc4NCI6MSwiNTExMSI6MSwiODA1MyI6MSwiMTk0MSI6MSwiNTQ0NSI6MSwiNzk1NCI6MywiOTA2NyI6NCwiOTA2NSI6NCwiNzg0MyI6MSwiOTA2NiI6M30sInByb21vY29kZSI6bnVsbH0%253D'</span></span>, <span class="hljs-string"><span class="hljs-string">'lines'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'123'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">841</span></span>, ], <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'124'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">756</span></span>, ], ], ]</code> ? Carrinho //***.ru/cart/abandoned/ = eyJpdGVtcyI6eyI1OTgwIjoxLCIzNDA0IjoxLCI3NzMiOjEsIjkwNTgiOjEsIjkwOTEiOjEsIjE4ODciOjEsIjc4NCI6MSwiNTExMSI6MSwiODA1MyI6MSwiMTk0MSI6MSwiNTQ0NSI6MSwiNzk1NCI6MywiOTA2NyI6NCwiOTA2NSI6NCwiNzg0MyI6MSwiOTA2NiI6M30sInByb21vY29kZSI6bnVsbH0% 253D', <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1207'</span></span>, <span class="hljs-string"><span class="hljs-string">'customer'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'25'</span></span>, <span class="hljs-string"><span class="hljs-string">'email_address'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'email@example.com'</span></span>, <span class="hljs-string"><span class="hljs-string">'opt_in_status'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, ], <span class="hljs-string"><span class="hljs-string">'currency_code'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'RUB'</span></span>, <span class="hljs-string"><span class="hljs-string">'order_total'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1597</span></span>, <span class="hljs-string"><span class="hljs-string">'checkout_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/cart/abandoned/?cart=eyJpdGVtcyI6eyI1OTgwIjoxLCIzNDA0IjoxLCI3NzMiOjEsIjkwNTgiOjEsIjkwOTEiOjEsIjE4ODciOjEsIjc4NCI6MSwiNTExMSI6MSwiODA1MyI6MSwiMTk0MSI6MSwiNTQ0NSI6MSwiNzk1NCI6MywiOTA2NyI6NCwiOTA2NSI6NCwiNzg0MyI6MSwiOTA2NiI6M30sInByb21vY29kZSI6bnVsbH0%253D'</span></span>, <span class="hljs-string"><span class="hljs-string">'lines'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'123'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">841</span></span>, ], <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'124'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">756</span></span>, ], ], ]</code> </pre><br>  E, novamente, nossa rubrica favorita é "adivinhe como esses campos funcionam".  Por exemplo, pelo método de cutucada científica, foi revelado que é possível não criar um comprador com uma solicitação separada.  É necessário transferir o conjunto mínimo necessário de campos e ele será criado automaticamente se não estiver no sistema.  No nosso caso, nos limitamos a id, email, opt_in_status.  O último parâmetro é responsável pelo status da assinatura do usuário em nossa planilha.  Se for verdade, isso significa que o estado está inscrito, caso contrário transacional. <br><br>  A lista de produtos é carregada sem problemas pela matriz Cart Lines, que por sua vez é um recurso da entidade Cart.  I.e.  podemos gerenciar esse conjunto separadamente com solicitações de descanso. <br><br>  Bem, isso é tudo, parece?  Mas não. <br><br>  Ao testar, notamos que o envio da mesma cesta é enviado apenas uma vez.  Embora o tenhamos removido do sistema e baixado novamente.  Nada é dito em lugar algum, nem uma única palavra!  Como resultado, empiricamente, com a ajuda de uma mãe, tomamos como base a hipótese de que uma cesta com o mesmo id pode ser enviada apenas uma vez. <br><br>  Aqui, concordo plenamente com os criadores de conteúdo que essa restrição nos salva de usuários de spam.  Mas escreva sobre isso!  Não precisamos de missões, temos o suficiente de nossos erros místicos no código que escrevemos. <br><br>  Depois de tudo isso, o MCH começou a nos enviar lindas cartas sobre a cesta abandonada.  E então uma segunda pergunta apareceu.  Se o usuário jogou a cesta e retornou da carta para sua própria conta, ou seja, ele foi autorizado no momento de clicar no link, ele entrará na cesta sem problemas.  E assim acontece que a carta diz “ligado!  leve sua cesta de volta! ”, e quando a atravessamos, dizemos:“ Opa, algo estava perdido!  Nós não tocamos em nada!  É ele próprio! " <br><br>  Decidiu-se codificar a composição da cesta em uma sequência e passá-la para checkout_url ao enviar a cesta ao MCH.  E quando você for ao site, pegue essa linha, decodifique e jogue todas as mercadorias na cesta, sem esquecer de redefini-la completamente antes disso. <br><br>  Portanto, não importa para qual navegador enviamos o usuário, ele recebe sua cesta, como prometemos.  O único aspecto negativo é que ele só pode fazer login.  Mas autorizar por meio de um link é uma má educação e, na verdade, é um negócio perigoso, antes de tudo para nossos clientes. <br>  Qual é o resultado?  Em princípio, não houve problemas específicos durante a implementação, pois muitas vezes as respostas do MCH ajudavam com erros relacionados à validação dos campos transferidos.  Mas haveria ainda menos deles se eles normalmente descrevessem humanamente todas essas sutilezas do trabalho da MCH e descrevessem os campos com mais detalhes. <br><br><h2>  Configuração de relatório no Google.Analytics </h2><br>  Para acompanhar o sucesso de toda a operação, você precisará configurar e analisar periodicamente o relatório na análise.  Imagine que todos, como adultos, tenham comércio eletrônico conectado, caso contrário, um milagre não funcionará :) <br><br>  Para coletar um novo relatório para uma cesta abandonada, vá para "Meus relatórios": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/afe/749/f87/afe749f87d1c6bd4e5a0810dab40b4ef.jpg" alt="Meus relatórios"><br><br>  Mais "Adicionar relatório": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/288/8bd/ba2/2888bdba2a5749ccc90c88c3f5c80f49.jpg" alt="Adicionar relatório"><br><br>  E depois disso, adicionamos os parâmetros que rastrearemos.  Decidimos que olharíamos para a cesta abandonada no contexto das cidades; você pode ter uma visão diferente. <br><br>  Para um mailchamp, a campanha padrão para uma cesta abandonada é ABANDONED_CART_EMAIL, nós a substituímos no filtro e obtemos um relatório. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca0/a77/b25/ca0a77b256b42242851ceaed308e02c7.jpg" alt="imagem"><br><br>  Isso é tudo garfos! <br><br>  Agora você está configurado para enviar a cesta abandonada e um relatório pelo qual você pode assistir a exaustão dela.  E teste, teste, teste!  ;) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt421393/">https://habr.com/ru/post/pt421393/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt421383/index.html">Epic Growth Conference Autumn 2018 - conferência de marketing de produto em Moscou</a></li>
<li><a href="../pt421385/index.html">Aprenda o OpenGL. Lição 5.10 - Oclusão ambiental do espaço na tela</a></li>
<li><a href="../pt421387/index.html">Entrevista com Lennart Pottering no Linux Piter sobre mudanças no Linux, sobre systemd e por que participar de conferências</a></li>
<li><a href="../pt421389/index.html">Separação de poderes administrativos em Zimbra</a></li>
<li><a href="../pt421391/index.html">HackThings - um grande hackathon na Internet das coisas de 7 a 9 de setembro na Skoltech</a></li>
<li><a href="../pt421395/index.html">Relatório do Clube de Roma 2018, capítulo 3.7: “Clima: boas notícias, mas grandes problemas”</a></li>
<li><a href="../pt421397/index.html">Inicie o Mini AI Cup # 3. Batalha mecânica em espaços confinados</a></li>
<li><a href="../pt421399/index.html">Análise do Backdoor do Outlook do Cybergroup Turla</a></li>
<li><a href="../pt421401/index.html">Anatomia de sistemas de recomendação. Parte dois</a></li>
<li><a href="../pt421403/index.html">Semana de Segurança 32: Drama Fortnite-Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>