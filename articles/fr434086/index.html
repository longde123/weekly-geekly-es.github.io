<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🅿️ 🙇🏾 👃🏾 Déploiement intégré Windows et Linux ✖️ 👨🏼‍💻 ⛽️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article décrit comment déployer rapidement un système embarqué basé sur Windows 10 et Debian Linux. Des exemples de construction d'une interface s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Déploiement intégré Windows et Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434086/">  Cet article décrit comment déployer rapidement un système embarqué basé sur Windows 10 et Debian Linux.  Des exemples de construction d'une interface sécurisée sont donnés. <br><a name="habracut"></a><br><h1>  Présentation </h1><br><p>  Dans le processus de développement de dispositifs dotés d'une interface homme-machine graphique, la tâche se pose tôt ou tard non seulement de créer l'interface elle-même, mais aussi de choisir la plateforme sur laquelle elle doit fonctionner.  Une telle plate-forme peut être soit un ordinateur à carte unique avec un système d'exploitation, soit un microcontrôleur avec un écran et un ensemble de bibliothèques pertinentes, ou une autre solution originale. </p><br><p>  Il arrive souvent qu'au niveau supérieur du système de contrôle sur lequel l'interface s'exécute, des tâches de communication avec le monde extérieur et l'interaction avec un large éventail de périphériques sont également effectuées.  De plus, l'interface elle-même peut être assez exigeante en ressources graphiques.  Compte tenu de cela, et afin d'économiser les coûts de main-d'œuvre, il est possible de prendre un ordinateur monocarte comme base et d'y installer un système d'exploitation prêt à l'emploi.  Dans ce cas, le développement logiciel peut être grandement simplifié en utilisant des cadres modernes avec une bonne documentation et un ensemble d'exemples. </p><br><h2>  Exigences d'interface </h2><br><p>  Du point de vue de l'utilisateur, l'interface doit satisfaire aux exigences suivantes: </p><br><ul><li>  Lors du chargement en plein écran, une application doit apparaître, c'est la même interface, c'est le même shell graphique; </li><li>  À part cette application, rien de plus ne devrait être disponible pour l'utilisateur; </li><li>  L'application doit fonctionner tout le temps, le système ne doit pas s'endormir, l'écran ne doit pas s'éteindre; </li><li>  Tous les raccourcis clavier, aides, fonctions d'accessibilité et autres fonctions similaires doivent être désactivés; </li><li>  En cas de défaillance de l'application - elle doit être redémarrée automatiquement par le système; </li><li>  Le système n'a pas d'exigences particulières pour la vitesse ou les modes en temps réel, cependant, il est nécessaire que l'interface réponde aux commandes de l'utilisateur sans retards notables; </li><li>  Le système doit être résistant aux redémarrages durs répétés, il ne devrait pas être nécessaire d'exécuter un script spécial pour terminer le travail; </li><li>  Il devrait être possible de cloner rapidement l'assemblage fini en une série d'appareils avec tous les réglages nécessaires effectués en mode automatique. </li></ul><br><p>  En d'autres termes, une limitation complète des actions de l'utilisateur, de la stabilité et de l'évolutivité. </p><br><p>  Quant au système d'exploitation pour un ordinateur monocarte, nous considérerons immédiatement deux options, l'une basée sur Windows, l'autre basée sur Linux, et nous les comparerons entre elles. </p><br><p>  Par exemple, créons une interface de kiosque à écran tactile.  Et en tant qu'application, prenons l'un des exemples de formation Qt Quick et implémentons-le avec quelques modifications.  Le framework Qt est disponible pour les deux systèmes d'exploitation. </p><br><p>  Afin de ne pas plonger dans les nuances de l'installation de Windows et Linux sur une plateforme ARM, le système peut être facilement assemblé sur la base d'un processeur compatible x86.  Dans ce cas, l'une des nombreuses cartes disponibles sur la plate-forme Intel Bay Trail a été utilisée pour des expériences. </p><br><p>  Un package de tous les programmes et scripts est disponible sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> . </p><br><h1>  Chemin Windows </h1><br><p>  À une certaine époque, Windows Embedded de Microsoft a été introduit pour créer des systèmes embarqués.  Même dans la première version de Windows Embedded XP, les développeurs disposaient d'un ensemble d'outils pour assembler les plus tronqués, mais équipés des pilotes d'images nécessaires.  Ces assemblages nécessitaient un minimum de RAM et fonctionnaient bien même sur des processeurs faibles.  La technologie a été développée dans la version de Windows Embedded Standard 7, où le processus de création de vos propres assemblages a été évoqué.  Windows Embedded utilisait l'idéologie d'un catalogue ouvert de modules, et n'importe qui pouvait équiper son système uniquement avec l'ensemble de composants nécessaire.  La dernière version dans laquelle cette approche était disponible, bien que sous une forme tronquée, est Windows Embedded Standard 8.1. </p><br><p>  Windows 10 IoT moderne est positionné comme une alternative à Windows Embedded, mais est très différent de ses prédécesseurs.  Un catalogue de composants ouvert n'est plus disponible.  La possibilité de collecter des images claires du concepteur et d'en faire ses propres disques d'installation a disparu.  Les options spéciales d'un système intégré, comme un filtre d'enregistrement, la marque du chargeur de démarrage, un filtre de clavier, etc., sont désormais configurées dans un système préinstallé.  De plus, la prise en charge de ces fonctions n'est disponible que dans le cadre de la version lourde de Windows 10 Enterprise. </p><br><p>  Cependant, malgré les exigences système élevées, en particulier en ce qui concerne la quantité de RAM, l'utilisation de versions même lourdes dans les solutions intégrées ne pose pas de problèmes particuliers, principalement en raison de la disponibilité des composants matériels.  En outre, n'oubliez pas que ces dernières années, il est devenu plus difficile d'acheter une licence pour les anciens produits de Microsoft. </p><br><h2>  Solution rapide </h2><br><p>  Au premier examen, il s'avère que même dans Windows 10 ordinaire, il existe déjà une fonction intégrée «Accès attribué» (Fig. 1), qui ressemble à une solution toute faite à la tâche. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/t6/14/yr/t614yroc8ueu_rkh1t7srjo0cnu.png" alt="Accès attribué"></div><p>  <i>Fig.</i>  <i>1. Fonction d'accès assignée</i> </p><br><p>  Dans ce cas, un programme pouvant être utilisé comme interface doit être initialement développé en tant qu'application de plateforme Windows universelle.  Ces <i>applications appx</i> sont installées, par exemple, sur un Windows Phone.  Une simple application plein écran, bien sûr, peut être convertie en <i>appx</i> et signée avec les certificats nécessaires, puis installée.  Il peut fonctionner comme une interface, mais sans protection appropriée.  Malheureusement, dans le mode normal "Accès attribué", l'utilisateur a toujours un accès ouvert à certains paramètres système et touches de raccourci.  Par conséquent, une interface qui répond à toutes les exigences ci-dessus ne peut pas être obtenue en utilisant cette approche.  Le système doit être configuré manuellement, d'une manière différente. </p><br><h2>  Bonne décision </h2><br><h3>  1. Installation initiale </h3><br><p>  Donc, tout d'abord, nous avons besoin de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">distribution LTSB Windows 10 Enterprise</a> .  Vous pouvez prendre l'image Microsoft d'origine, vous pouvez en utiliser une légère ou créer la vôtre à l'aide d'outils tiers.  Pour la carte expérimentale, l'un des assemblages prêts à l'emploi a été sélectionné (version légère 32 bits). </p><br><p>  Nous installons le système à partir du kit de distribution sur la carte cible.  Lors de l'installation, nous divisons le disque en deux sections, C: - pour le système, D: - pour l'application principale, les utilitaires et les journaux.  Une telle ventilation est utile à l'avenir pour le filtre d'enregistrement.  Après l'installation, nous attendons que le menu des paramètres apparaisse, ou nous ne continuons pas le menu avec les paramètres réseau. </p><br><p>  Nous redémarrons en mode service via Ctrl + Maj + F3. </p><br><p>  S'il n'y a pas eu d'erreurs pendant le processus d'installation, après le redémarrage, le système lui-même ira dans le compte de service de l'administrateur et la fenêtre <i>SysPrep</i> apparaîtra à l'écran (Fig.2).  Il doit être fermé, nous allons démarrer <i>SysPrep</i> différemment, en utilisant un fichier de réponses spécial qui n'a pas encore été créé. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/kw/xn/3y/kwxn3yxs3totane-ogcok3z9bto.png" alt="Fenêtre sysprep"></div><p>  <i>Fig.</i>  <i>2. Mode service.</i> </p><br><h3>  2. Configuration du système </h3><br><p>  Pour d'autres actions, vous aurez besoin des outils de <a href="">déploiement du kit d'évaluation et de déploiement de Windows 10</a> . </p><br><p>  À partir du disque sur lequel la distribution Windows est installée sur la carte, vous devez extraire le <i>fichier</i> image <i>install.wim</i> .  Il arrive que dans certains assemblages, ce fichier puisse être stocké sous forme compressée avec l'extension <i>esd</i> .  Dans ce cas, vous devez d'abord le déballer.  L'utilitaire <i>dism</i> est utilisé pour cela. </p><br><p>  Découvrez le numéro de série de la version souhaitée dans le conteneur (SourceIndex). </p><br><pre><code class="plaintext hljs">dism /Get-WimInfo /WimFile:install.esd</code> </pre> <br><p>  Ensuite, extrayez le fichier image (dans ce cas, le premier dans le conteneur). </p><br><pre> <code class="plaintext hljs">dism /export-image /SourceImageFile:install.esd /SourceIndex:1 /DestinationImageFile:install.wim /Compress:max /CheckIntegrity</code> </pre> <br><p>  Vous devez maintenant ouvrir l'image dans le Gestionnaire d'images système Windows (à partir des outils de déploiement) et générer un répertoire. </p><br><p>  Il convient de noter que travailler avec des images dans Windows System Image Manager n'est possible que si la profondeur de bits de l'image correspond à la profondeur de bits de l'hôte.  Autrement dit, il est impossible de modifier l'image de la version 32 bits dans un système 64 bits.  Ici, comme on dit, aucun commentaire. </p><br><p>  Une fois le répertoire créé, modifiez le fichier de réponses de l'utilitaire <i>SysPrep</i> .  Entrez les informations du propriétaire, ajoutez les utilisateurs nécessaires et configurez la première connexion automatique (Fig. 3). </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/ch/fn/4f/chfn4fan0jtazdofcrskqz6dakc.png" alt="Fichier de réponses"></div><p>  <i>Fig.</i>  <i>3. Création d'un fichier de réponses.</i> </p><br><p>  Cela n'a aucun sens de répertorier tous les paramètres; le contenu du fichier de réponses peut être trouvé dans le référentiel.  L'essentiel est de ne pas oublier de définir les paramètres <i>CopyProfile</i> sur <i>true</i> , <i>SkipReam</i> sur <i>1</i> et d'activer la <i>connexion automatique</i> de l'administrateur.  Vous pouvez entrer votre clé de produit dans la section <i>4 specialize - Microsoft-Windows-Shell-Setup - ProductKey</i> . </p><br><h3>  3. Installation de programmes </h3><br><p>  Ensuite, vous avez besoin du <i>fichier</i> image <i>install.wim</i> réel, vous devez donc le placer à côté du fichier de réponses <i>personnaliser.xml</i> , dans lequel après l'enregistrement, vous devez remplacer manuellement le chemin d'accès à l'image.  À la fin du fichier, la ligne devrait ressembler à ceci: </p><br><pre> <code class="plaintext hljs">&lt;cpi:offlineImage cpi:source="wim:d:/service/install.wim#Windows 10 Enterprise LTSB" xmlns:cpi="urn:schemas-microsoft-com:cpi" /&gt;</code> </pre> <br><p>  Pour obtenir l'interface de démonstration de KioskShell, vous devez créer une version pour Windows à partir des sources.  Les conseils d'assemblage se trouvent dans le référentiel. </p><br><p>  Nous copions les fichiers sur la carte et obtenons la structure de fichiers et de répertoires suivante: </p><br><pre> <code class="plaintext hljs">C:\ └── Design\ ├── backgroundDefault.jpg -      ( ) └── oemlogo.bmp -  ,      D:\ ├── Logs\ -       ├── Service\ │ ├── AfterSetup.bat -   ,     SysPrep │ ├── FirstLogon.bat -        │ ├── customize.xml -   │ ├── install.wim -   │ ├── CustomShellSetup.ps1 -  PowerShell     │ ├── EnableRules.ps1 -  PowerShell     │ ├── DisableAllRules.ps1 -      ( ) │ └── UserLogon.bat -      ( ) └── Shell\ -     "KioskShell.exe"   </code> </pre> <br><h3>  4. Configuration manuelle du système </h3><br><p>  Lorsque le système est en mode service, vous pouvez redémarrer autant de fois que vous le souhaitez, le système y reviendra automatiquement.  Avec un long temps d'inactivité avant de configurer l'alimentation, cependant, l'écran peut se verrouiller et ne reviendra pas, seul un redémarrage vous aidera.  Étant donné que chaque projet spécifique peut avoir ses propres fonctionnalités de configuration, il est préférable de le faire manuellement, mais vous pouvez également utiliser des scripts d'automatisation. </p><br><p>  Nous installons les composants nécessaires du système intégré et désactivons le contrôle des comptes d'utilisateurs (voir <i>AfterSetup.bat</i> depuis le référentiel) </p><br><p>  Installez tous les pilotes, configurez le matériel (carte réseau IP, résolution et orientation de l'écran, ports des périphériques externes, etc.), désactivez les touches rémanentes et toutes les fonctionnalités spéciales. </p><br><p>  Puisqu'à l'avenir, j'aimerais pouvoir administrer à distance, nous autoriserons l'accès via RDP.  Le mot de passe administrateur expirera à l'étape de configuration automatique. </p><br><p>  Ensuite, vous devez désactiver les mises à jour système dans l' <i>éditeur de stratégie de groupe local</i> (dans la section <i>Configuration ordinateur - Modèles d'administration - Composants Windows - Windows Update</i> , vous devez définir les <i>mises</i> à <i>jour automatiques configurées</i> sur <i>Désactivé</i> ).  En outre, vous devez également désactiver l'analyse automatique de Windows Update (dans le planificateur de tâches de la section <i>Microsoft - Windows - UpdateOrchestrator,</i> vous devez désactiver toutes les tâches), sinon une fenêtre noire apparaîtra à chaque démarrage, et lorsque vous vous connecterez à Internet, Windows peut soudainement commencer la mise à jour. </p><br><p>  Ensuite, configurez les paramètres d'alimentation.  Pour ce faire, vous devez d'abord rendre tous les paramètres d'alimentation visibles dans la section <i>Paramètres avancés d'alimentation</i> (pour cela, dans le registre de chaque sous-clé dans <i>HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Control \ Power \ PowerSettings \ 238C9FA8-0AAD-41ED-83F4-97BE242C8F20,</i> si vous avez le paramètre <i>Attributes</i> , vous devez affecter valeur pour lui <i>2</i> ).  Maintenant que tous les paramètres sont disponibles, désactivez le mode veille, le mode absence, supprimez l'action sur le bouton d'alimentation (sauf si, bien sûr, vous en avez besoin autrement) et désactivez le minuteur d'autorisation lorsqu'il est inactif.  Ensuite, nous supprimons le mode veille avec la connexion (dans la section <i>HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Control \ Power</i> , vous devez définir le paramètre <i>CsEnabled</i> sur <i>0</i> ).  Si nécessaire, désactivez le contrôle adaptatif de la luminosité de l'écran. </p><br><p>  Lorsque tous les paramètres système sont terminés, nous avons la dernière possibilité d'apporter des modifications, car la deuxième exécution du script <i>AfterSetup.bat</i> démarrera le mécanisme de configuration automatique à l'aide de <i>SysPrep</i> , qui ne peut pas être arrêté.  Vous devez toujours vous rappeler d'activer le système (il est suggéré de vous familiariser avec les options d'activation pour les versions d'entreprise de Windows).  Même à ce stade, vous pouvez faire une copie de sauvegarde de l'intégralité du disque et corriger l'état préliminaire de l'image en cas de modifications futures. </p><br><p>  À la fin du travail, <i>SysPrep</i> ne redémarrera pas, mais éteindra l'ordinateur - à ce stade, vous pouvez créer une image déjà opérationnelle, prête pour le portage vers une série. </p><br><h3>  5. Configuration finale du système automatique </h3><br><p>  Après le premier chargement de l'image de travail (voir <i>FirstLogon.bat à</i> partir du référentiel), l'interface sécurisée sera configurée, la <i>connexion automatique</i> sera reconfigurée sur le compte <i>utilisateur</i> et les raccourcis clavier susceptibles de briser le système seront désactivés.  Ensuite, le filtre d'écriture unifié sera configuré et activé.  Dans ce cas, le filtre est configuré pour protéger toutes les partitions à l'exception des dossiers <i>Service</i> et <i>Logs</i> et utilise un swap de 256 Mo.  Le système redémarrera plusieurs fois et, si tout est fait correctement, au prochain démarrage, une interface sécurisée apparaîtra, lancée au nom du compte <i>utilisateur</i> . </p><br><p>  Pour entretenir le système sur site, il est possible d'accéder à l'écran de connexion et, par exemple, de se connecter au compte administrateur.  Dans Windows 10, une méthode standard est fournie pour cela, vous devez appuyer sur la touche «Win» 5 fois de suite. </p><br><h1>  Chemin Linux </h1><br><p>  Il n'y a pas de moyen standard unique de créer des systèmes embarqués avec une interface graphique basée sur Linux.  Comme il n'y a pas de distribution commune unique, il s'agit tout de même d'une famille de systèmes créés selon des principes complètement différents.  Le sujet le plus proche peut sembler être le projet Yocto Linux.  Cependant, il est assez difficile de collecter des images remplies d'applications, de pilotes et de bibliothèques tierces.  Pour résoudre ce problème, il est plus facile de prendre une distribution prête à l'emploi et bien prise en charge et de la configurer manuellement. </p><br><h2>  Solution simple </h2><br><h3>  1. Installation initiale </h3><br><p>  Donc, tout d'abord, nous avons besoin de la distribution elle-même, par exemple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Debian</a> .  Vous pouvez en prendre un autre, vous pouvez faire le vôtre.  L'essentiel est que la distribution ne dispose pas d'un système de mise à jour automatique.  Pour la carte expérimentale, Debian Linux 9 (version 64 bits, noyau 4.9) a été choisie. </p><br><p>  Nous installons le système de manière traditionnelle.  Lors de l'installation, nous avons divisé le disque en deux sections, sda1 - <i>/</i> pour le système, sda2 - <i>/ var / log</i> pour les <i>journaux</i> système et logiciels.  Une telle ventilation est utile à l'avenir pour le filtre d'enregistrement.  Installez l' <i>interface graphique xfce</i> standard et le serveur <i>ssh</i> .  Nous ajoutons l' <i>administrateur</i> lors de l'installation de l'utilisateur et définissons le mot de passe. </p><br><p>  Après l'installation, la première chose du compte <i>root</i> est d'ajouter l'utilisateur <i>administrateur</i> au groupe <i>sudo</i> . </p><br><pre> <code class="plaintext hljs">apt install sudo adduser administrator sudo</code> </pre> <br><p>  Nous entrons dans le système sous l' <i>administrateur</i> du nom d'utilisateur et ajoutons un nouvel utilisateur <i>utilisateur</i> . </p><br><pre> <code class="plaintext hljs">sudo useradd -m user</code> </pre> <br><p>  Pour plus de commodité, vous pouvez supprimer complètement le mot de passe pour lui, car l'accès à ce compte sera toujours fermé partout. </p><br><pre> <code class="plaintext hljs">sudo passwd -d user</code> </pre> <br><h3>  2. Configuration du système </h3><br><p>  Nous installons les pilotes, les progiciels, les programmes supplémentaires selon vos besoins. </p><br><p>  Pour activer l'administration à distance à l'avenir, si nécessaire, vous pouvez installer et configurer le serveur <i>vnc</i> .  Cependant, dans ce cas, cela n'a aucun sens, car toutes les tâches administratives peuvent être facilement effectuées via la console, et pour cela, seul l'accès via <i>ssh est</i> suffisant. </p><br><p>  Linux a la possibilité d'utiliser différents gestionnaires de fenêtres pour différents utilisateurs.  Pour que l'interface utilisateur fonctionne, installez un gestionnaire minimaliste avec la possibilité d'affiner.  Et pour la configuration, vous aurez besoin de quelques applications supplémentaires. </p><br><pre> <code class="plaintext hljs">sudo apt install fluxbox arandr plymouth</code> </pre> <br><p>  En utilisant <i>arandr,</i> vous pouvez modifier la résolution et l'orientation de l'écran, si nécessaire, puis enregistrer la configuration sous forme de script (Fig. 4). </p><br><p><img src="https://habrastorage.org/webt/fm/qo/nw/fmqonwqu3j3rua5xd_nr9zbj4p4.png" alt="Paramètres d'écran set_resolution.sh"></p><br><p>  Fig.  4. Paramètres d'écran. </p><br><p>  Ensuite, vous devez vous connecter au système une fois sous le compte d'utilisateur, après avoir sélectionné <i>Fluxbox</i> installé précédemment comme gestionnaire de fenêtres, puis vous déconnecter à nouveau.  Ceci est nécessaire pour que <i>Fluxbox crée</i> au premier démarrage tous les fichiers de paramètres et soit sélectionné comme gestionnaire standard pour le compte <i>utilisateur</i> (voir le fichier <i>.dmrc</i> dans le répertoire personnel de l' <i>utilisateur</i> ). </p><br><p>  Vous devez maintenant configurer <i>fluxbox</i> pour répondre aux exigences d'interface décrites ci-dessus.  Pour ce faire, désactivez le panneau <i>session.screen0.toolbar.visible</i> dans <i>/home/user/.fluxbox/init</i> <i>: false</i> , commentez tous les raccourcis clavier à l'exception des boutons de volume dans <i>/home/user/.fluxbox/keys</i> et dans <i>/ home / user /. fluxbox / startup</i> ajoute le lancement du script de configuration d'écran, désactivant les fonctions d'économie d'énergie du moniteur et l'exécution automatique de l'application plein écran.  Le script redémarrera l'application en cas d'échec inattendu. </p><br><pre> <code class="plaintext hljs">set_resolution.sh xset -dmps s off /home/user/autostart.sh &amp;</code> </pre><br><p>  Vous devez maintenant accélérer le processus de démarrage du système et le cacher à l'utilisateur.  Pour ce faire, définissez <i>GRUB_TIMEOUT = 0</i> dans <i>/ etc / default / grub et</i> définissez <i>quiet_boot = "1"</i> dans <i>/etc/grub.d/10_linux</i> .  Pour afficher l'animation lors du chargement dans les paramètres du noyau <i>GRUB_CMDLINE_LINUX,</i> vous devez ajouter l'option <i>splash</i> , et si l'orientation de l'écran change, l' <i>option fbcon = rotation: 1</i> ou <i>fbcon = rotation: 3</i> , selon la direction.  Si nécessaire, vous pouvez modifier la résolution et l'orientation sur l'écran de connexion.  Pour cela, <i>display-setup-script = set_resolution.sh</i> doit être spécifié dans <i>/etc/lightdm/lightdm.conf</i> .  Et si vous devez masquer le curseur, ajoutez alors <i>xserver-command = X -core -nocursor</i> . </p><br><p>  Nous choisirons un style d'animation de chargement. </p><br><pre> <code class="plaintext hljs">sudo plymouth-set-default-theme -R text</code> </pre> <br><p>  Et enfin, corrigez tous les changements. </p><br><pre> <code class="plaintext hljs">sudo update-grub2</code> </pre> <br><h3>  3. Installation de programmes </h3><br><p>  Pour obtenir l'interface de démonstration de KioskShell, vous devez créer une version Linux à partir des sources.  Les conseils d'assemblage se trouvent dans le référentiel. </p><br><p>  Nous copions les fichiers sur la carte et obtenons la structure de fichiers et de répertoires suivante: </p><br><pre> <code class="plaintext hljs">/ ├── usr/ -      "KioskShell"    ├── local/ │ └── bin/ │ └── set_resolution.sh └── home/ ├── administrator/ │ └── relogin.sh -       └── user/ └── autostart.sh -    </code> </pre> <br><h3>  4. Configuration finale du système </h3><br><p>  À ce stade, vous pouvez faire une copie de sauvegarde de l'intégralité du disque et corriger l'état préliminaire de l'image en cas de modifications futures. </p><br><p>  Configurez la connexion automatique sous le compte utilisateur, pour cela, définissez <i>autologin-user = user</i> dans <i>/etc/lightdm/lightdm.conf</i> . </p><br><p>  Définissez maintenant la protection en écriture. </p><br><pre> <code class="plaintext hljs">sudo apt install bilibop</code> </pre> <br><p>  Lors de l'installation, sélectionnez la <i>carte dynamique des faux appareils</i> . </p><br><p>  Modifiez le fichier de paramètres <i>/etc/bilibop/bilibop.conf</i> .  Nous <i>activons</i> le module avec le paramètre <i>BILIBOP_LOCKFS = "true"</i> et ajoutons une section avec des logs aux exceptions <i>BILIBOP_LOCKFS_WHITELIST = "/ var / log"</i> .  <i>Activons</i> la possibilité de désactiver temporairement la protection si nécessaire <i>BILIBOP_LOCKFS_POLICY = "soft"</i> .  Et comme il n'y a pas de chiffrement dans le système, vous devez définir <i>BILIBOP_LOCKFS_SWAP_POLICY = "soft"</i> . </p><br><p>  Nous redémarrons le système et, si tout est fait correctement, une interface sécurisée apparaît, lancée au nom du compte utilisateur. </p><br><p>  La dernière étape peut être facilement automatisée pour obtenir un système avec une configuration automatique au premier démarrage.  Cela créera une distribution pour la mise à l'échelle sur plusieurs appareils (ce mécanisme est proposé pour être mis en œuvre indépendamment). </p><br><p>  Pour réparer le système en place, il est possible d'accéder à l'écran de connexion et de se connecter au compte administrateur.  Sous Linux, vous devez d'abord accéder à la console via Ctrl + Alt + F1.  Après vous être connecté au compte administrateur, forcez l'utilisateur <i>utilisateur</i> à se déconnecter du système. </p><br><pre> <code class="plaintext hljs">sudo skill -KILL -u user</code> </pre> <br><p>  Revenez ensuite en mode graphique via Ctrl + Alt + F7 et reconnectez-vous en tant qu'administrateur. </p><br><h1>  Conclusions </h1><br><p>  Quel que soit le chemin choisi, le résultat final est le même résultat.  Avec une configuration appropriée, l'interface utilisateur répondra à toutes les exigences décrites ci-dessus.  Seules les différences visuelles sont possibles, associées, en règle générale, aux fonctionnalités de rendu des éléments graphiques en utilisant l'accélération matérielle sur différentes plates-formes. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/rm/nk/1-/rmnk1-wetcbmnk4qnwng5ztxdri.png" alt="Application shell protégé"></div><p>  Fig.  5. L'interface est opérationnelle. </p><br><p></p><p>  Étant donné que la base du système est un ordinateur à carte unique, l'installation d'un écran tactile ou d'autres commandes ne posera aucun problème.  Si vous disposez de l'application appropriée, sur cette base, vous pouvez créer non seulement la console de contrôle ou le tableau de bord interactif de l'appareil, mais également d'autres appareils, par exemple des terminaux d'informations ou de trading. </p><br><h2>  Problème de choix </h2><br><p>  Il y a une opinion que Linux est très difficile à configurer et à maintenir, mais en même temps, il est gratuit, et Windows est simple et pratique, mais cela coûte de l'argent.  C'est peut-être vrai, mais seulement au niveau des ménages.  Lorsqu'il s'agit de créer des systèmes embarqués, d'autres circonstances doivent être prises en compte.  Par exemple, affiner Windows, en particulier en termes de gestion de l'alimentation et d'autres éléments de bas niveau, ne semble plus simple et pratique.  De plus, n'oubliez pas que Windows 10 est assez gourmand en ressources.  Dans cet exemple, il était possible de mesurer la consommation de mémoire d'un système propre plusieurs fois, et elle était d'environ 400 Mo en mode inactif.  À titre de comparaison, Linux Debian avec tous ses modules complémentaires occupait environ 200 Mo de mémoire.  Bien sûr, si vous avez plusieurs gigaoctets de RAM, ce n'est pas un problème, mais quand vous utilisez Windows et des applications clientes très chargées, vous devez prendre des ordinateurs à carte unique plus puissants.  Linux est moins exigeant en ressources, mais vraiment difficile à configurer et nécessite une approche soignée, en particulier lorsque vous travaillez avec le chargeur de démarrage.  De plus, lors du développement et de l'implémentation de certains éléments dans le système, il est parfois nécessaire d'assembler votre propre noyau avec des paramètres spéciaux.  Il est efficace, mais nécessite un niveau de compétence approprié. </p><br><p>  Il est difficile de faire un choix sans ambiguïté dans le cadre de la création d'une interface sécurisée.  La complexité du déploiement de systèmes est à peu près la même.  Le coût d'acquisition de licences Windows pour une série d'instruments peut être égal au coût de maintenance des systèmes sous Linux.  Quel système choisir, vous décidez. </p><br><p>  Diverses interfaces homme-machine basées sur les exemples décrits ont été introduites par l'auteur dans des dispositifs électroniques pour une grande variété d'applications et ont prouvé leur opérabilité dans le monde réel. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr434086/">https://habr.com/ru/post/fr434086/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr434076/index.html">Pourquoi en Russie il n'y a pas de secret bancaire</a></li>
<li><a href="../fr434078/index.html">Il suffit de prendre et de faire: un nouveau podcast sur des projets éditoriaux et une carrière dans les médias</a></li>
<li><a href="../fr434080/index.html">Comment arrêter d'écrire le firmware des microcontrôleurs. Nous commençons à vivre ...</a></li>
<li><a href="../fr434082/index.html">Un réseau de neurones développé par des scientifiques russes a appris à déterminer l'âge à partir de la vidéo avec un haut degré de précision</a></li>
<li><a href="../fr434084/index.html">Une voiture du film "Men in Black" (1997) peut-elle franchir le plafond du tunnel?</a></li>
<li><a href="../fr434088/index.html">Comment aider les employés distants à éviter la solitude et l'épuisement professionnel</a></li>
<li><a href="../fr434090/index.html">Présentation d'un transistor à vide: un appareil fabriqué à partir de vide</a></li>
<li><a href="../fr434092/index.html">Les gens qui ont sauvé 1968</a></li>
<li><a href="../fr434096/index.html">Heisenbug 2018 Moscou: une vue de la foule</a></li>
<li><a href="../fr434098/index.html">Post et pré-traitement CSS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>