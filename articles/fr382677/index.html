<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨ğŸ¾â€ğŸ¤â€ğŸ‘¨ğŸ¼ â€¼ï¸ ğŸ’ƒ Mon Internet des objets: Guest Castle (Partie 2) ğŸ¤²ğŸ½ ğŸ‘µğŸ¿ ğŸï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut GT! Le tout avec le futur et le passÃ©! 
 Je continue l'histoire de la faÃ§on dont j'ai connectÃ© la serrure de porte Ã  Internet. Commencez ici . 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mon Internet des objets: Guest Castle (Partie 2)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/382677/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Salut GT! Le tout avec le futur et le passÃ©! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je continue l'histoire de la faÃ§on dont j'ai connectÃ© la serrure de porte Ã  Internet. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Commencez ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un grand merci Ã  tous pour les commentaires. Il y a vraiment des solutions toutes faites, mais il y a aussi un certain nombre de nuances qui ne m'ont pas permis de les utiliser. Un appartement n'est toujours pas un hÃ´tel, nous rejetons donc immÃ©diatement les chÃ¢teaux spÃ©cialisÃ©s. Serrures Ã  clÃ©, antennes pour NFC, afin de ne pas effrayer les voisins, nous n'envisageons pas non plus. Aucune carte, jeton ou autre support physique ne peut Ãªtre utilisÃ© non plus, il est entendu qu'il n'y a aucun moyen de les transfÃ©rer Ã  un invitÃ© avant qu'il n'ouvre la porte.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kevo, August ou Lockitron ne pouvaient pas Ãªtre utilisÃ©s, car ils sont basÃ©s sur le type amÃ©ricain de serrure (pÃªne dormant), qui n'est pas trÃ¨s bien installÃ© sur une porte en acier de 65 Ã  70 mm d'Ã©paisseur. Notre choix est le CISA Ã©lectromÃ©canique pour portes blindÃ©es, au prix d'environ 500 euros (pas encore achetÃ©, car cher). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et surtout, je veux faire quelque chose de mes propres mains, ne pas Ãªtre Ã©goÃ¯ste au nom des courants de loisir.</font></font><br>
<img src="https://habrastorage.org/files/12f/2b5/6a3/12f2b56a3cae496d9f3717839e37cea1.JPG"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Permettez-moi de vous rappeler que le contrÃ´leur de verrouillage est situÃ© profondÃ©ment derriÃ¨re NAT dans le rÃ©seau domestique local, et donc cela n'a aucun sens d'Ã©lever un serveur Web sur Arduin; il n'y a aucun moyen de l'atteindre depuis Internet. Le serveur est Ã©crit en Python en utilisant le framework Twisted, fonctionne sous Linux dans un autre endroit oÃ¹ il y a une vraie adresse IP, et le contrÃ´leur s'y connecte et attend les commandes. </font></font><br>
<img src="https://habrastorage.org/files/c3a/803/92b/c3a80392b83f4a0382e764ad8afa142e.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, je veux parler de la logique du travail et de la cryptographie. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'ai pas trouvÃ© de trafic cryptÃ© pour Arduina, car les communications du chÃ¢teau et du serveur passeront par des canaux ouverts avec du trafic non cryptÃ©. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le premier prototype, j'ai utilisÃ© MD5, maintenant je l'ai changÃ© en SHA-1, ici sur cette bibliothÃ¨que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cryptosuite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il consomme moins de mÃ©moire et il existe dÃ©jÃ  une fonction HMAC prÃªte Ã  l'emploi.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La clÃ© est un mot de passe de 30 caractÃ¨res ASCII maximum, stockÃ© dans la mÃ©moire EEPROM du contrÃ´leur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le premier prototype, le mÃªme mot de passe Ã©tait stockÃ© explicitement sur le serveur, ce qui n'est bien sÃ»r pas de sÃ©curitÃ©. Le deuxiÃ¨me prototype nÃ©cessitait deux mots de passe. La premiÃ¨re consiste Ã  authentifier le verrou lors de la connexion au serveur, vous ne pouvez pas ouvrir le verrou avec ce mot de passe, il est nÃ©cessaire pour que seuls les verrous corrects puissent se connecter au serveur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le verrou se connecte au serveur et lui indique tout d'abord son identifiant. Le serveur vÃ©rifie dans la base de donnÃ©es s'il existe un tel verrou et, le cas Ã©chÃ©ant, il envoie une sÃ©quence ASCII gÃ©nÃ©rÃ©e de maniÃ¨re alÃ©atoire en rÃ©ponse. Le verrou le Â«signeÂ» avec un mot de passe et renvoie le hachage. Le serveur compare le hachage reÃ§u avec ce qu'il a calculÃ© par lui-mÃªme, et s'il correspond, il autorisera le contrÃ´leur connectÃ© en tant que Â«verrouÂ».</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sinon, la connexion est rÃ©initialisÃ©e. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxiÃ¨me mot de passe est dÃ©jÃ  une clÃ© numÃ©rique, il n'est pas stockÃ© sur le serveur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il fonctionne comme suit: l'application utilisateur appelle via la fonction SOAP sur le serveur, indique l'ID du verrou et la commande qu'il souhaite lui envoyer. Par consÃ©quent, la fonction renvoie l'ID de demande. Le serveur transmet cette commande au contrÃ´leur, le contrÃ´leur envoie une sÃ©quence ASCII gÃ©nÃ©rÃ©e alÃ©atoirement en rÃ©ponse et attend la rÃ©ponse Â«correcteÂ» pendant quelques secondes. Ensuite, l'application utilisateur doit l'obtenir du serveur, via le mÃªme SOAP par ID de demande, la signer avec une clÃ© numÃ©rique et la renvoyer. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le contrÃ´leur compare le hachage reÃ§u avec celui calculÃ© de lui-mÃªme et s'ils correspondent, il exÃ©cute la commande prÃ©cÃ©demment reÃ§ue, qui est signalÃ©e au serveur.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le temps pour confirmer la commande est limitÃ© Ã  2 secondes, si aucune rÃ©ponse n'est reÃ§ue pendant ce temps, le contrÃ´leur ignore la commande reÃ§ue prÃ©cÃ©demment. Si les hachages ne correspondent pas, la commande est Ã©galement ignorÃ©e. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, j'essaie de me protÃ©ger de l'attaque de Â«l'homme au milieuÂ», qui est trÃ¨s facile Ã  agencer sur les fils de mon fournisseur. La connexion y est simple, pas de mots de passe et de certificats, il suffit de couper la paire torsadÃ©e dans le bouclier, de la serrer des deux cÃ´tÃ©s, de la brancher sur le rÃ©seau depuis l'appartement avec l'adresse IP du serveur de commande, d'Ã©muler le verrou de l'autre cÃ´tÃ© (j'ai Ã©galement Ã©crit un script d'Ã©mulation sur le python pour le dÃ©bogage ), aprÃ¨s avoir organisÃ© un tel Â«pare-feuÂ» avec Ã©coute Ã©lectronique. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ã€ cet Ã©gard, Ã  mon avis, le chÃ¢teau s'est avÃ©rÃ© Ãªtre assez protÃ©gÃ©.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MÃªme le piratage du serveur de commandes et le vol de sa base de donnÃ©es avec des mots de passe pour l'autorisation par le verrou ne feront pas beaucoup de problÃ¨mes, car ils ne peuvent pas ouvrir le verrou. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il ne reste plus qu'Ã  s'occuper des invitÃ©s. Ce sont les exigences n Â° 6-8 du premier article. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les claviers, les proxys, la RFID et le NFC ne sont pas une option, ce qui prÃ©cÃ¨de a expliquÃ© pourquoi. Mais presque tout le monde a un smartphone et tous les smartphones ont Bluetooth, le choix est Ã©vident! </font></font><br>
<img src="https://habrastorage.org/files/d2a/1bd/1b0/d2a1bd1b0a2a4f81a906fba3e2640b5e.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le premier prototype, un invitÃ© Ã©tait associÃ© Ã  un seul code d'accÃ¨s. Dans la base de donnÃ©es du serveur pour ce code ont Ã©tÃ© stockÃ©s l'ID du verrou, la date et l'heure du dÃ©but et de la fin de l'accÃ¨s invitÃ©, ainsi, un champ de texte pour le nom lisible par l'homme de l'invitÃ©.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un invitÃ© s'approche de la serrure, lance une application mobile sur son smartphone, il envoie un code d'accÃ¨s via Bluetooth au contrÃ´leur, un message arrive du contrÃ´leur au serveur indiquant qu'un invitÃ© l'a approchÃ© avec un certain code d'accÃ¨s. Le serveur le vÃ©rifie par rapport Ã  la base de donnÃ©es, et si le bon invitÃ© est arrivÃ© au bon moment au bon endroit, envoie la commande pour ouvrir le verrou. En fait, au lieu du code d'accÃ¨s clair, l'invitÃ© enverra un hachage HMAC signÃ© avec un Â«timbre temporaireÂ» (une reprÃ©sentation sous forme de chaÃ®ne du temps Unix divisÃ© par 30 avec la partie fractionnaire supprimÃ©e). Le serveur de vÃ©rification fait une demande Ã  la base de donnÃ©es avec une sÃ©lection de tous les codes d'accÃ¨s actuellement valides pour un verrou donnÃ©, puis l'itÃ¨re et calcule un HMAC similaire pour eux, s'il trouve une correspondance, envoie une commande pour ouvrir,si la recherche des codes d'accÃ¨s se termine avant qu'une correspondance ne puisse Ãªtre trouvÃ©e, une rÃ©ponse nÃ©gative est envoyÃ©e au verrou lors d'une tentative d'ouverture.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le problÃ¨me est que la clÃ© numÃ©rique d'une telle autorisation devait Ãªtre stockÃ©e sur le serveur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai dÃ» compliquer l'autorisation "invitÃ©" pour le deuxiÃ¨me prototype. Le code d'accÃ¨s invitÃ© se compose dÃ©sormais de deux clÃ©s, appelons-les Â«serveurÂ» et Â«privÃ©Â». Le serveur est nÃ©cessaire pour Ã©tablir un compte invitÃ© sur le serveur et privÃ© pour ouvrir le verrou lui-mÃªme. La salle des serveurs sera explicitement stockÃ©e sur le serveur, et Ã  partir de la salle privÃ©e, il n'y aura qu'un hachage, mais pas un simple, mais un HMAC avec une clÃ© numÃ©rique pour la serrure. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, la session d'autorisation d'invitÃ© ressemble Ã  ceci: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. L'application invitÃ©e passe la clÃ© Â«serveurÂ» au contrÃ´leur (comme dans le premier prototype son hachage) et </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Le serveur le vÃ©rifie de la mÃªme maniÃ¨re, mais au lieu de la commande open envoie le hachage de la clÃ© privÃ©e</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. Le contrÃ´leur compare le hachage de la clÃ© privÃ©e reÃ§ue du serveur avec celle calculÃ©e indÃ©pendamment et si elle correspond, le verrou s'ouvre. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, le serveur ne stocke rien qui pourrait ouvrir le verrou. Il ne fonctionnera pas pour gÃ©nÃ©rer le hachage souhaitÃ© sans connaÃ®tre la clÃ© numÃ©rique. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le mÃªme Bluetooth est Ã©galement utilisÃ© pour l'accÃ¨s Â«maÃ®treÂ» sans Internet. Le contrÃ´leur reÃ§oit des commandes Ã  travers lui, rÃ©pond avec un code Ã  usage unique, qui doit Ãªtre signÃ© avec la bonne clÃ© numÃ©rique pendant 2 secondes.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GrÃ¢ce Ã  lui, je veux faire les rÃ©glages de base du contrÃ´leur. </font><font style="vertical-align: inherit;">Le propriÃ©taire appuie sur un bouton spÃ©cial du contrÃ´leur, aprÃ¨s quoi il commence Ã  accepter un ensemble Ã©tendu de commandes, telles que la dÃ©finition de l'ID de verrouillage, les clÃ©s secrÃ¨tes, l'adresse du port du serveur, les paramÃ¨tres rÃ©seau, etc. </font><font style="vertical-align: inherit;">Mais Ã  Adruin, la mÃ©moire s'est Ã©puisÃ©e et le croquis ne correspond pas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ã€ la fin, une courte dÃ©monstration du travail.</font></font><br>
<iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/dfSnXt631KQ%3Ffeature%3Doembed&amp;usg=ALkJrhjeZHKmruHwUJtYVvdS1ukMc441Tw" frameborder="0" allowfullscreen=""></iframe></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr382677/">https://habr.com/ru/post/fr382677/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr382665/index.html">StratÃ©gies et tactiques d'email marketing. Partie 1</a></li>
<li><a href="../fr382667/index.html">Intel annonce le premier processeur d'ordinateurs portables Xeon</a></li>
<li><a href="../fr382669/index.html">Un nettoyeur. Lutter contre les logiciels impurs</a></li>
<li><a href="../fr382673/index.html">MortalitÃ© du chien robot Aibo</a></li>
<li><a href="../fr382675/index.html">Des paresseux gÃ©ants du passÃ© pourraient poser des lignes de mÃ©tro</a></li>
<li><a href="../fr382679/index.html">Les astronomes ont pu obtenir des photos du lac de lave Ã  la surface d'Io, le satellite de Jupiter</a></li>
<li><a href="../fr382681/index.html">5 heures d'approche de Soyouz sur l'ISS - dans une vidÃ©o d'une demi-minute sur YouTube</a></li>
<li><a href="../fr382685/index.html">Regardez au-delÃ  de l'horizon</a></li>
<li><a href="../fr382687/index.html">Des scientifiques du CERN prÃ©parent un "champ de force" pour protÃ©ger les astronautes des radiations</a></li>
<li><a href="../fr382689/index.html">Nous contrÃ´lons l'Ã©clairage de l'appartement (NooLite, Raspberry Pi et WebIOPi)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>