<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¯ ğŸ•’ â˜ ï¸ åœ¨Tarâ€‹â€‹antoolå¼¹è¯ç­’ä¸Šè½»æ¾ä¸”åˆ†é˜¶æ®µåœ°éƒ¨ç½²åº”ç”¨ç¨‹åºï¼ˆç¬¬1éƒ¨åˆ†ï¼‰ â­ï¸ ğŸ‘¨ğŸ»â€ğŸ³ â˜ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘ä»¬å·²ç»è®¨è®ºè¿‡Tarantool Cartridge ï¼Œå®ƒå…è®¸æ‚¨å¼€å‘åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå¹¶å°†å…¶æ‰“åŒ…ã€‚ å‰©ä¸‹çš„å°±æ˜¯å­¦ä¹ å¦‚ä½•éƒ¨ç½²å’Œç®¡ç†è¿™äº›åº”ç”¨ç¨‹åºã€‚ ä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä»¬å·²ä¸ºæ‚¨æä¾›ä¸€åˆ‡ï¼ æˆ‘ä»¬æ±‡é›†äº†ä½¿ç”¨Tarantool Cartridgeçš„æ‰€æœ‰æœ€ä½³å®è·µï¼Œå¹¶ç¼–å†™äº†ä¸€ä¸ªç®€å•çš„è§’è‰² ï¼Œå°†ç¨‹åºåŒ…åˆ†è§£ä¸ºæœåŠ¡å™¨ï¼Œå¯åŠ¨å®ä¾‹ï¼Œå°†...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åœ¨Tarâ€‹â€‹antoolå¼¹è¯ç­’ä¸Šè½»æ¾ä¸”åˆ†é˜¶æ®µåœ°éƒ¨ç½²åº”ç”¨ç¨‹åºï¼ˆç¬¬1éƒ¨åˆ†ï¼‰</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/478710/"><p><img src="https://habrastorage.org/webt/yc/gm/xx/ycgmxxaqlvyslsrzoo6jnv1vmx0.jpeg"></p><br><p> æˆ‘ä»¬å·²ç»è®¨è®ºè¿‡<a href="https://habr.com/ru/company/mailru/blog/465503/">Tarantool Cartridge</a> ï¼Œå®ƒå…è®¸æ‚¨å¼€å‘åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå¹¶å°†å…¶æ‰“åŒ…ã€‚ å‰©ä¸‹çš„å°±æ˜¯å­¦ä¹ å¦‚ä½•éƒ¨ç½²å’Œç®¡ç†è¿™äº›åº”ç”¨ç¨‹åºã€‚ ä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä»¬å·²ä¸ºæ‚¨æä¾›ä¸€åˆ‡ï¼ æˆ‘ä»¬æ±‡é›†äº†ä½¿ç”¨Tarantool Cartridgeçš„æ‰€æœ‰æœ€ä½³å®è·µï¼Œå¹¶ç¼–å†™äº†ä¸€ä¸ªç®€å•çš„<a href="https://galaxy.ansible.com/tarantool/cartridge">è§’è‰²</a> ï¼Œå°†ç¨‹åºåŒ…åˆ†è§£ä¸ºæœåŠ¡å™¨ï¼Œå¯åŠ¨å®ä¾‹ï¼Œå°†å®ƒä»¬ç»„åˆåˆ°ç¾¤é›†ä¸­ï¼Œé…ç½®æˆæƒï¼Œå¯åŠ¨vshardï¼Œå¯ç”¨è‡ªåŠ¨æ•…éšœè½¬ç§»å¹¶ä¿®è¡¥ç¾¤é›†é…ç½®ã€‚ </p><br><p> æœ‰æ„æ€å— ç„¶åæˆ‘è¦æ±‚å‰Šå‡ï¼Œæˆ‘ä»¬å°†å‘Šè¯‰å¹¶å±•ç¤ºä¸€åˆ‡ã€‚ </p><a name="habracut"></a><br><h1 id="nachnem-s-primera"> è®©æˆ‘ä»¬ä»ä¸€ä¸ªä¾‹å­å¼€å§‹ã€‚ </h1><br><p> æˆ‘ä»¬å°†åªè€ƒè™‘è§’è‰²çš„ä¸€éƒ¨åˆ†åŠŸèƒ½ã€‚ æ‚¨å§‹ç»ˆå¯ä»¥åœ¨<a href="https://github.com/tarantool/ansible-cartridge">æ–‡æ¡£ä¸­</a>æ‰¾åˆ°å…¶æ‰€æœ‰åŠŸèƒ½å’Œè¾“å…¥å‚æ•°çš„å®Œæ•´è¯´æ˜ã€‚ ä½†æ˜¯ï¼Œä¸€æ¬¡å°è¯•æ¯”ä¸€æ¬¡å°è¯•ä¸€ç™¾æ¬¡æ›´å¥½ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å®‰è£…ä¸€ä¸ªå°åº”ç”¨ç¨‹åºã€‚ </p><br><p> Tarantool Cartridgeæä¾›äº†æœ‰å…³åˆ›å»ºå°å‹Cartridgeåº”ç”¨ç¨‹åºçš„<a href="https://github.com/tarantool/cartridge-cli/tree/master/examples/getting-started-app">æ•™ç¨‹</a> ï¼Œè¯¥åº”ç”¨ç¨‹åºå­˜å‚¨æœ‰å…³é“¶è¡Œå®¢æˆ·åŠå…¶å¸æˆ·çš„ä¿¡æ¯ï¼Œå¹¶ä¸”è¿˜æä¾›ç”¨äºé€šè¿‡HTTPç®¡ç†æ•°æ®çš„APIã€‚ ä¸ºæ­¤ï¼Œè¯¥åº”ç”¨ç¨‹åºæè¿°äº†ä¸¤ä¸ªå¯èƒ½çš„è§’è‰²ï¼š <code>api</code>å’Œ<code>storage</code> ï¼Œå®ƒä»¬å¯ä»¥åˆ†é…ç»™å®ä¾‹ã€‚ </p><br><p> å¢¨ç›’æœ¬èº«å¹¶æ²¡æœ‰è¯´æ˜å¦‚ä½•å¯åŠ¨è¿›ç¨‹ï¼Œå®ƒä»…æä¾›äº†é…ç½®å·²ç»è¿è¡Œçš„å®ä¾‹çš„åŠŸèƒ½ã€‚ ç”¨æˆ·å¿…é¡»åšå…¶ä½™çš„äº‹æƒ…ï¼šåˆ†è§£é…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨æœåŠ¡å¹¶é…ç½®æ‹“æ‰‘ã€‚ ä½†æ˜¯æˆ‘ä»¬ä¸ä¼šåšæ‰€æœ‰è¿™äº›ï¼ŒAnsibleä¼šä¸ºæˆ‘ä»¬åšã€‚ </p><br><p> è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨æ­£åœ¨OS Xä¸Šå¼€å‘åº”ç”¨ç¨‹åºï¼Œç„¶åå°†å…¶æ‰“åŒ…åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šï¼Œç„¶åæ— æ³•å°†å…¶å®‰è£…åœ¨Centosæˆ–Debianä¸Šå°†æ— æ³•æ­£å¸¸å·¥ä½œï¼Œå› ä¸ºè¯¥è½¯ä»¶åŒ…å°†åŒ…å«OS Xç‰¹å®šçš„æ¨¡å—å’Œå¯æ‰§è¡Œæ–‡ä»¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¿…é¡»åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰“åŒ…ã€‚ </p><br><h3 id="ot-slov-k-delu"> ä»è¨€è¯­åˆ°è¡ŒåŠ¨ </h3><br><p> å› æ­¤ï¼Œè®©æˆ‘ä»¬åœ¨ä¸¤ä¸ªè™šæ‹Ÿæœºä¸Šå®‰è£…æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¹¶è®¾ç½®ä¸€ä¸ªç®€å•çš„æ‹“æ‰‘ï¼š </p><br><ul><li> å‰¯æœ¬<code>app-1</code>å°†å®ç°<code>api</code>è§’è‰²ï¼Œå…¶ä¸­åŒ…æ‹¬<code>vshard-router</code>è§’è‰²ã€‚ åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚ </li><li>  <code>storage-1</code>å‰¯æœ¬é›†å®ç°äº†<code>storage</code>è§’è‰²ï¼ˆåŒæ—¶æ˜¯<code>vshard-storage</code> ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬æ·»åŠ äº†æ¥è‡ªä¸åŒæœºå™¨çš„ä¸¤ä¸ªå®ä¾‹ã€‚ </li></ul><br><p><img src="https://habrastorage.org/webt/k9/nh/oc/k9nhoc4kladn7obskseox7he8ek.jpeg"></p><br><p> è¦è¿è¡Œè¯¥ç¤ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦<a href="https://www.vagrantup.com/">Vagrant</a>å’Œ<a href="https://www.ansible.com/">Ansible</a> ï¼ˆ2.8æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚ </p><br><p> è§’è‰²æœ¬èº«åœ¨<a href="https://galaxy.ansible.com/docs/">Ansible Galaxyä¸­</a> ã€‚ è¿™æ˜¯ä¸€ä¸ªå­˜å‚¨åº“ï¼Œå¯è®©æ‚¨å…±äº«æœ€ä½³å®è·µå¹¶ä½¿ç”¨ç°æˆçš„è§’è‰²ã€‚ </p><br><p> æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç¤ºä¾‹å…‹éš†å­˜å‚¨åº“ï¼š </p><br><pre> <code class="bash hljs">$ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/dokshina/deploy-tarantool-cartridge-app.git $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> deploy-tarantool-cartridge-app &amp;&amp; git checkout 1.0.0</code> </pre> <br><p> æå‡è™šæ‹Ÿæœºï¼š </p><br><pre> <code class="bash hljs">$ vagrant up</code> </pre> <br><p> å®‰è£…Tarantoolå¢¨ç›’ansibleè§’è‰²ï¼š </p><br><pre> <code class="bash hljs">$ ansible-galaxy install tarantool.cartridge,1.0.1</code> </pre> <br><p> è¿è¡Œå®‰è£…çš„è§’è‰²ï¼š </p><br><pre> <code class="bash hljs">$ ansible-playbook -i hosts.yml playbook.yml</code> </pre> <br><p> æˆ‘ä»¬æ­£åœ¨ç­‰å¾…å‰§æœ¬çš„å®Œæˆï¼Œè¯·è®¿é—®<a href="http://localhost:8181/admin/cluster/dashboard">httpï¼š//æœ¬åœ°ä¸»æœºï¼š8181 / admin / cluster /ä»ªè¡¨æ¿</a>å¹¶äº«å—ç»“æœï¼š </p><br><p><img src="https://habrastorage.org/webt/70/zo/vq/70zovqqaeiph6v1bjoenzl_hn1w.png"></p><br><p> æ‚¨å¯ä»¥å€’å…¥æ•°æ®ã€‚ é…·å§ï¼Ÿ </p><br><p> ç°åœ¨è®©æˆ‘ä»¬å¼„æ¸…æ¥šå¦‚ä½•ä½¿ç”¨å®ƒï¼ŒåŒæ—¶åœ¨æ‹“æ‰‘ä¸­æ·»åŠ å¦ä¸€ä¸ªå‰¯æœ¬é›†ã€‚ </p><br><h3 id="nachinaem-razbiratsya"> å¼€å§‹äº†è§£ </h3><br><p> é‚£æ€ä¹ˆäº† </p><br><p> æˆ‘ä»¬é€‰æ‹©äº†ä¸¤ä¸ªè™šæ‹Ÿæœºï¼Œå¹¶å¯åŠ¨äº†é…ç½®é›†ç¾¤çš„ansibleå‰§æœ¬ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>playbook.yml</code>æ–‡ä»¶çš„å†…å®¹ï¼š </p><br><pre> <code class="plaintext hljs">--- - name: Deploy my Tarantool Cartridge app hosts: all become: true become_user: root tasks: - name: Import Tarantool Cartridge role import_role: name: tarantool.cartridge</code> </pre> <br><p> è¿™é‡Œæ²¡æœ‰ä»»ä½•æœ‰è¶£çš„äº‹æƒ…ï¼Œæˆ‘ä»¬å¯åŠ¨äº†ä¸€ä¸ªåä¸º<code>tarantool.cartridge</code>è§’è‰²ã€‚ </p><br><p> æ‰€æœ‰æœ€é‡è¦çš„ï¼ˆå³é›†ç¾¤é…ç½®ï¼‰éƒ½åœ¨<code>hosts.yml</code> <a href="https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html">æ¸…å•</a>æ–‡ä»¶ä¸­ï¼š </p><br><pre> <code class="plaintext hljs">--- all: vars: # common cluster variables cartridge_app_name: getting-started-app cartridge_package_path: ./getting-started-app-1.0.0-0.rpm # path to package cartridge_cluster_cookie: app-default-cookie # cluster cookie # common ssh options ansible_ssh_private_key_file: ~/.vagrant.d/insecure_private_key ansible_ssh_common_args: '-o IdentitiesOnly=yes -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no' # INSTANCES hosts: storage-1: config: advertise_uri: '172.19.0.2:3301' http_port: 8181 app-1: config: advertise_uri: '172.19.0.3:3301' http_port: 8182 storage-1-replica: config: advertise_uri: '172.19.0.3:3302' http_port: 8183 children: # GROUP INSTANCES BY MACHINES host1: vars: # first machine connection options ansible_host: 172.19.0.2 ansible_user: vagrant hosts: # instances to be started on the first machine storage-1: host2: vars: # second machine connection options ansible_host: 172.19.0.3 ansible_user: vagrant hosts: # instances to be started on the second machine app-1: storage-1-replica: # GROUP INSTANCES BY REPLICA SETS replicaset_app_1: vars: # replica set configuration replicaset_alias: app-1 failover_priority: - app-1 # leader roles: - 'api' hosts: # replica set instances app-1: replicaset_storage_1: vars: # replica set configuration replicaset_alias: storage-1 weight: 3 failover_priority: - storage-1 # leader - storage-1-replica roles: - 'storage' hosts: # replica set instances storage-1: storage-1-replica:</code> </pre> <br><p> æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å­¦ä¹ å¦‚ä½•é€šè¿‡ä¿®æ”¹æ­¤æ–‡ä»¶çš„å†…å®¹æ¥ç®¡ç†å®ä¾‹å’Œå‰¯æœ¬é›†ã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­æ·»åŠ æ–°çš„éƒ¨åˆ†ã€‚ ä¸ºäº†é¿å…æ··æ·†å°†å®ƒä»¬æ·»åŠ åˆ°ä½•å¤„ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹æ­¤æ–‡ä»¶çš„æœ€ç»ˆç‰ˆæœ¬<code>hosts.updated.yml</code> ï¼Œè¯¥æ–‡ä»¶ä½äºç¤ºä¾‹ä¸­çš„èµ„æºåº“ä¸­ã€‚ </p><br><h3 id="upravlenie-instansami"> å®ä¾‹ç®¡ç† </h3><br><p> ç”¨Ansibleæ¥è¯´ï¼Œæ¯ä¸ªå®ä¾‹éƒ½æ˜¯ä¸€ä¸ªä¸»æœºï¼ˆä¸è¦ä¸IronæœåŠ¡å™¨æ··æ·†ï¼‰ï¼Œå³  Ansibleå°†ç®¡ç†çš„åŸºç¡€ç»“æ„èŠ‚ç‚¹ã€‚ å¯¹äºæ¯ä¸ªä¸»æœºï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šè¿æ¥å‚æ•°ï¼ˆä¾‹å¦‚<code>ansible_host</code>å’Œ<code>ansible_user</code> ï¼‰ä»¥åŠå®ä¾‹é…ç½®ã€‚ å®ä¾‹è¯´æ˜åœ¨<code>hosts</code>éƒ¨åˆ†ä¸­ã€‚ </p><br><p> è€ƒè™‘<code>storage-1</code>å®ä¾‹çš„é…ç½®ï¼š </p><br><pre> <code class="plaintext hljs">all: vars: ... # INSTANCES hosts: storage-1: config: advertise_uri: '172.19.0.2:3301' http_port: 8181 ...</code> </pre> <br><p> åœ¨<code>config</code>å˜é‡ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šäº†å®ä¾‹å‚æ•°<code>advertise URI</code>å’Œ<code>HTTP port</code> ã€‚ <br> ä»¥ä¸‹æ˜¯<code>app-1</code>å’Œ<code>storage-1-replica</code>å®ä¾‹å‚æ•°ã€‚ </p><br><p> æˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªå®ä¾‹æä¾›Ansibleè¿æ¥å‚æ•°ã€‚ å°†å®ä¾‹åˆ†ä¸ºè™šæ‹Ÿæœºç»„ä¼¼ä¹æ˜¯åˆä¹é€»è¾‘çš„ã€‚ ä¸ºæ­¤ï¼Œå°†å®ä¾‹åˆ†ä¸ºç»„<code>host1</code>å’Œ<code>host2</code> ï¼Œå¹¶åœ¨<code>vars</code>éƒ¨åˆ†çš„æ¯ä¸ªç»„ä¸­æŒ‡ç¤ºä¸€ä¸ª<code>vars</code> <code>ansible_host</code>å’Œ<code>ansible_user</code>å€¼ã€‚ å¹¶ä¸”åœ¨<code>hosts</code>éƒ¨åˆ†ä¸­ï¼Œè¯¥ç»„ä¸­åŒ…å«ä¸»æœºï¼ˆå®ƒä»¬æ˜¯å®ä¾‹ï¼‰ï¼š </p><br><pre> <code class="plaintext hljs">all: vars: ... hosts: ... children: # GROUP INSTANCES BY MACHINES host1: vars: # first machine connection options ansible_host: 172.19.0.2 ansible_user: vagrant hosts: # instances to be started on the first machine storage-1: host2: vars: # second machine connection options ansible_host: 172.19.0.3 ansible_user: vagrant hosts: # instances to be started on the second machine app-1: storage-1-replica:</code> </pre> <br><p> æˆ‘ä»¬å¼€å§‹æ›´æ”¹<code>hosts.yml</code> ã€‚ å†æ·»åŠ ä¸¤ä¸ªå®ä¾‹ï¼Œç¬¬ä¸€ä¸ªè™šæ‹Ÿæœºä¸Šçš„<code>storage-2-replica</code>å’Œç¬¬äºŒä¸ªè™šæ‹Ÿæœºä¸Šçš„<code>storage-2</code> ï¼š </p><br><pre> <code class="plaintext hljs">all: vars: ... # INSTANCES hosts: ... storage-2: # &lt;== config: advertise_uri: '172.19.0.3:3303' http_port: 8184 storage-2-replica: # &lt;== config: advertise_uri: '172.19.0.2:3302' http_port: 8185 children: # GROUP INSTANCES BY MACHINES host1: vars: ... hosts: # instances to be started on the first machine storage-1: storage-2-replica: # &lt;== host2: vars: ... hosts: # instances to be started on the second machine app-1: storage-1-replica: storage-2: # &lt;== ...</code> </pre> <br><p> è¿è¡Œansibleå‰§æœ¬ï¼š </p><br><pre> <code class="bash hljs">$ ansible-playbook -i hosts.yml \ --<span class="hljs-built_in"><span class="hljs-built_in">limit</span></span> storage-2,storage-2-replica \ playbook.yml</code> </pre> <br><p> æ³¨æ„<code>--limit</code>é€‰é¡¹ã€‚ ç”±äºä»Ansibleè§’åº¦æ¥çœ‹ï¼Œç¾¤é›†çš„æ¯ä¸ªå®ä¾‹éƒ½æ˜¯ä¸»æœºï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ˜ç¡®æŒ‡å‡ºåœ¨æ’­æ”¾å‰§æœ¬æ—¶åº”é…ç½®å“ªäº›å®ä¾‹ã€‚ </p><br><p> åŒæ ·ï¼Œè½¬åˆ°Web UI <a href="http://localhost:8181/admin/cluster/dashboard">httpï¼š//æœ¬åœ°ä¸»æœºï¼š8181 / admin / cluster /ä»ªè¡¨æ¿ï¼Œ</a>å¹¶è§‚å¯Ÿæˆ‘ä»¬çš„æ–°å®ä¾‹ï¼š </p><br><p><img src="https://habrastorage.org/webt/l2/jw/9-/l2jw9-hw2varlmqtt0tdnonh8tw.png"></p><br><p> æˆ‘ä»¬å°†ä¸è®¨è®ºå·²å–å¾—çš„æˆå°±ï¼Œè€Œæ˜¯æŒæ¡æ‹“æ‰‘ç®¡ç†ã€‚ </p><br><h3 id="upravlenie-topologiey"> æ‹“æ‰‘ç®¡ç† </h3><br><p> å°†æˆ‘ä»¬çš„æ–°å®ä¾‹åˆå¹¶åˆ°<code>storage-2</code>å‰¯æœ¬é›†ã€‚ æ·»åŠ ä¸€ä¸ªæ–°çš„ç»„<code>replicaset_storage_2</code>å¹¶åœ¨å…¶å˜é‡ä¸­æè¿°replicatesetå‚æ•°ï¼Œç±»ä¼¼äº<code>replicaset_storage_1</code> ã€‚ åœ¨<code>hosts</code>éƒ¨åˆ†ï¼Œæˆ‘ä»¬æŒ‡ç¤ºå“ªäº›å®ä¾‹å°†åŒ…å«åœ¨è¯¥ç»„ä¸­ï¼ˆå³æˆ‘ä»¬çš„å‰¯æœ¬é›†ï¼‰ï¼š </p><br><pre> <code class="plaintext hljs">--- all: vars: ... hosts: ... children: ... # GROUP INSTANCES BY REPLICA SETS ... replicaset_storage_2: # &lt;== vars: # replicaset configuration replicaset_alias: storage-2 weight: 2 failover_priority: - storage-2 - storage-2-replica roles: - 'storage' hosts: # replicaset instances storage-2: storage-2-replica:</code> </pre> <br><p> é‡æ–°å¯åŠ¨å‰§æœ¬ï¼š </p><br><pre> <code class="bash hljs">$ ansible-playbook -i hosts.yml \ --<span class="hljs-built_in"><span class="hljs-built_in">limit</span></span> replicaset_storage_2 \ --tags cartridge-replicasets \ playbook.yml</code> </pre> <br><p> è¿™æ¬¡ï¼Œæˆ‘ä»¬å°†ä¸æˆ‘ä»¬çš„å‰¯æœ¬é›†ç›¸å¯¹åº”çš„ç»„çš„åç§°ä¼ é€’ç»™--limitå‚æ•°ã€‚ </p><br><p> è€ƒè™‘<code>tags</code>é€‰é¡¹ã€‚ </p><br><p> æˆ‘ä»¬çš„è§’è‰²å§‹ç»ˆæ‰§è¡Œå„ç§ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡å¸¦æœ‰ä»¥ä¸‹æ ‡è®°ï¼š </p><br><ul><li>  <code>cartridge-instances</code> ï¼š <code>cartridge-instances</code>ç®¡ç†ï¼ˆè®¾ç½®ï¼Œä¸æˆå‘˜èµ„æ ¼çš„è¿æ¥ï¼‰ï¼› </li><li>  <code>cartridge-replicasets</code> ï¼šæ‹“æ‰‘ç®¡ç†ï¼ˆç®¡ç†å‰¯æœ¬é›†å¹¶ä»ç¾¤é›†ä¸­æ°¸ä¹…åˆ é™¤ï¼ˆåˆ é™¤ï¼‰å®ä¾‹ï¼‰ï¼› </li><li>  ettes <code>cartridge-config</code> ï¼šç®¡ç†å…¶ä½™é›†ç¾¤å‚æ•°ï¼ˆvshardå¼•å¯¼ç¨‹åºï¼Œè‡ªåŠ¨æ•…éšœè½¬ç§»æ¨¡å¼ï¼Œæˆæƒå‚æ•°å’Œåº”ç”¨ç¨‹åºé…ç½®ï¼‰ã€‚ </li></ul><br><p> æˆ‘ä»¬å¯ä»¥æ˜ç¡®æŒ‡å‡ºæˆ‘ä»¬è¦å®Œæˆçš„å·¥ä½œçš„å“ªä¸€éƒ¨åˆ†ï¼Œç„¶åè¯¥è§’è‰²å°†è·³è¿‡å…¶ä½™ä»»åŠ¡çš„æ‰§è¡Œã€‚ åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªå¸Œæœ›ä½¿ç”¨æ‹“æ‰‘ï¼Œå› æ­¤æˆ‘ä»¬æŒ‡å®šäº†<code>cartridge-replicasets</code> ã€‚ </p><br><p> è®©æˆ‘ä»¬è¯„ä¼°ä¸€ä¸‹æˆ‘ä»¬çš„åŠªåŠ›ç»“æœã€‚ åœ¨<a href="http://localhost:8181/admin/cluster/dashboard">httpï¼š// localhostï¼š8181 / admin / cluster / dashboardä¸­</a>æ‰¾åˆ°æ–°çš„å‰¯æœ¬é›†ã€‚ </p><br><p><img src="https://habrastorage.org/webt/sw/0z/gm/sw0zgm53me7ft63db8lxrswcxvw.png"></p><br><p> ä¸‡å²ï¼ </p><br><p> å°è¯•æ›´æ”¹å®ä¾‹å’Œå‰¯æœ¬é›†çš„é…ç½®ï¼Œå¹¶æŸ¥çœ‹ç¾¤é›†æ‹“æ‰‘å¦‚ä½•æ›´æ”¹ã€‚ æ‚¨å¯ä»¥å°è¯•å„ç§æ“ä½œæ–¹æ¡ˆï¼Œä¾‹å¦‚ï¼Œ <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_delegation.html">æ»šåŠ¨æ›´æ–°</a>æˆ–å¢åŠ <code>memtx_memory</code> ã€‚ è¯¥è§’è‰²å°†å°è¯•æ‰§è¡Œæ­¤æ“ä½œè€Œæ— éœ€é‡æ–°å¯åŠ¨å®ä¾‹ï¼Œä»¥å‡å°‘åº”ç”¨ç¨‹åºå¯èƒ½çš„åœæœºæ—¶é—´ã€‚ </p><br><p> å®Œæˆå¯¹<code>vagrant halt</code> ï¼Œè¯·ä¸è¦å¿˜è®°å¯åŠ¨<code>vagrant halt</code>æ¥åœæ­¢<code>vagrant halt</code> ã€‚ </p><br><h1 id="a-chto-pod-kapotom"> åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ </h1><br><p> åœ¨è¿™é‡Œï¼Œæˆ‘å°†å‘æ‚¨è¯¦ç»†ä»‹ç»åœ¨æˆ‘ä»¬çš„å®éªŒè¿‡ç¨‹ä¸­ï¼Œæ‰®æ¼”è§’è‰²æ‰®æ¼”çš„è§’è‰²ã€‚ </p><br><p> è€ƒè™‘éƒ¨ç½²å¢¨ç›’åº”ç”¨ç¨‹åºçš„æ­¥éª¤ã€‚ </p><br><h3 id="ustanovka-paketa-i-start-instansov"> å®‰è£…è½¯ä»¶åŒ…å¹¶å¯åŠ¨å®ä¾‹ </h3><br><p> é¦–å…ˆï¼Œæ‚¨éœ€è¦å°†è½¯ä»¶åŒ…äº¤ä»˜åˆ°æœåŠ¡å™¨å¹¶è¿›è¡Œå®‰è£…ã€‚ ç°åœ¨ï¼Œè¯¥è§’è‰²å¯ä»¥ä½¿ç”¨RPMå’ŒDEBè½¯ä»¶åŒ…ã€‚ </p><br><p> æ¥ä¸‹æ¥ï¼Œè¿è¡Œå®ä¾‹ã€‚ è¿™é‡Œçš„ä¸€åˆ‡éƒ½å¾ˆç®€å•ï¼šæ¯ä¸ªå®ä¾‹éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„<code>systemd</code>æœåŠ¡ã€‚ æˆ‘ä¸¾ä¸€ä¸ªä¾‹å­ï¼š </p><br><pre> <code class="bash hljs">$ systemctl start myapp@storage-1</code> </pre> <br><p> æ­¤å‘½ä»¤å°†å¯åŠ¨<code>myapp</code>çš„<code>storage-1</code>å®ä¾‹ã€‚ æ­£åœ¨è¿è¡Œçš„å®ä¾‹å°†åœ¨<code>/etc/tarantool/conf.d/</code>æŸ¥æ‰¾å…¶<a href="https://www.tarantool.io/ru/doc/2.2/book/cartridge/cartridge_dev/">é…ç½®</a> ã€‚ å¯ä»¥ä½¿ç”¨<code>journald</code>æŸ¥çœ‹<code>journald</code> ã€‚ </p><br><p> ç”¨äºsystemdæœåŠ¡çš„å•ä½æ–‡ä»¶<code>/etc/systemd/system/myapp@.sevice</code>å°†ä¸è½¯ä»¶åŒ…ä¸€èµ·æä¾›ã€‚ </p><br><p>  Ansibleå…·æœ‰ç”¨äºå®‰è£…è½¯ä»¶åŒ…å’Œç®¡ç†ç³»ç»ŸæœåŠ¡çš„å†…ç½®æ¨¡å—ï¼Œè¿™é‡Œæˆ‘ä»¬æ²¡æœ‰å‘æ˜ä»»ä½•æ–°ä¸œè¥¿ã€‚ </p><br><h3 id="nastroyka-topologii-klastera"> é…ç½®é›†ç¾¤æ‹“æ‰‘ </h3><br><p> ä»è¿™é‡Œå¼€å§‹ä¹è¶£ã€‚ åŒæ„ï¼Œæ‰“æ‰°åˆ°ç‰¹æ®Šçš„ansibleè§’è‰²æ¥å®‰è£…è½¯ä»¶åŒ…å¹¶è¿è¡Œ<code>systemd</code> serviceä¼šå¾ˆå¥‡æ€ªã€‚ </p><br><p> æ‚¨å¯ä»¥æ‰‹åŠ¨é…ç½®é›†ç¾¤ï¼š </p><br><ul><li> ç¬¬ä¸€ä¸ªé€‰é¡¹ï¼šæ‰“å¼€Web UIå¹¶å•å‡»æŒ‰é’®ã€‚ å¯¹äºå¤šä¸ªå®ä¾‹çš„ä¸€æ¬¡å¯åŠ¨ï¼Œè¿™æ˜¯éå¸¸åˆé€‚çš„ã€‚ </li><li> ç¬¬äºŒç§é€‰æ‹©ï¼šæ‚¨å¯ä»¥ä½¿ç”¨GraphQl APIã€‚ åœ¨è¿™é‡Œæ‚¨å·²ç»å¯ä»¥è‡ªåŠ¨åŒ–ä¸€äº›æ“ä½œï¼Œä¾‹å¦‚ï¼Œç”¨Pythonç¼–å†™è„šæœ¬ã€‚ </li><li> ç¬¬ä¸‰ç§é€‰æ‹©ï¼ˆé’ˆå¯¹é‚£äº›<code>tarantoolctl connect</code> ï¼‰ï¼šæˆ‘ä»¬å»æœåŠ¡å™¨ï¼Œä½¿ç”¨<code>tarantoolctl connect</code>åˆ°ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä½¿ç”¨Lua <code>cartridge</code>æ¨¡å—æ‰§è¡Œæ‰€æœ‰å¿…è¦çš„æ“ä½œã€‚ </li></ul><br><p> æˆ‘ä»¬å‘æ˜çš„ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºæ‚¨å®Œæˆè¿™é¡¹å·¥ä½œä¸­æœ€å›°éš¾çš„éƒ¨åˆ†ã€‚ </p><br><p>  Ansibleå…è®¸æ‚¨ç¼–å†™æ¨¡å—å¹¶åœ¨è§’è‰²ä¸­ä½¿ç”¨å®ƒã€‚ æˆ‘ä»¬çš„è§’è‰²ä½¿ç”¨æ­¤ç±»æ¨¡å—æ¥ç®¡ç†å„ç§é›†ç¾¤ç»„ä»¶ã€‚ </p><br><p> å¦‚ä½•è¿ä½œï¼Ÿ æ‚¨å¯ä»¥åœ¨å£°æ˜æ€§é…ç½®ä¸­æè¿°é›†ç¾¤çš„æ‰€éœ€çŠ¶æ€ï¼Œè¯¥è§’è‰²å°†å…¶é…ç½®éƒ¨åˆ†æä¾›ç»™æ¯ä¸ªæ¨¡å—çš„è¾“å…¥ã€‚ è¯¥æ¨¡å—æ¥æ”¶é›†ç¾¤çš„å½“å‰çŠ¶æ€ï¼Œå¹¶å°†å…¶ä¸è¾“å…¥çš„çŠ¶æ€è¿›è¡Œæ¯”è¾ƒã€‚ ç„¶åï¼Œé€šè¿‡å…¶ä¸­ä¸€ä¸ªå®ä¾‹çš„å¥—æ¥å­—å¯åŠ¨ä»£ç ï¼Œä»è€Œä½¿ç¾¤é›†è¿›å…¥æ‰€éœ€çŠ¶æ€ã€‚ </p><br><h1 id="itogi"> æ€»ç»“ </h1><br><p> ä»Šå¤©æˆ‘ä»¬è¿›è¡Œäº†äº¤è°ˆï¼Œå¹¶å±•ç¤ºäº†å¦‚ä½•åœ¨Tarantool Cartridgeä¸Šéƒ¨ç½²æ‚¨çš„åº”ç”¨ç¨‹åºå¹¶è®¾ç½®ç®€å•çš„æ‹“æ‰‘ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†Ansibleï¼Œè¿™æ˜¯ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„åŠŸèƒ½å¼ºå¤§çš„å·¥å…·ï¼Œå¯è®©æ‚¨åŒæ—¶é…ç½®è®¸å¤šåŸºç¡€ç»“æ„èŠ‚ç‚¹ï¼ˆåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œè¿™äº›æ˜¯é›†ç¾¤å®ä¾‹ï¼‰ã€‚ </p><br><p> ä¸Šé¢ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†ä½¿ç”¨Ansibleæè¿°é›†ç¾¤é…ç½®çš„å¤šç§æ–¹æ³•ä¹‹ä¸€ã€‚ ä¸€æ—¦æ„è¯†åˆ°å‡†å¤‡ç»§ç»­å‰è¿›ï¼Œè¯·å­¦ä¹ ç¼–å†™å‰§æœ¬çš„<a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html">æœ€ä½³å®è·µ</a> ã€‚ æ‚¨å¯èƒ½ä¼šå‘ç°ä½¿ç”¨<code>group_vars</code>å’Œ<code>host_vars</code>ç®¡ç†æ‹“æ‰‘æ›´åŠ æ–¹ä¾¿ã€‚ </p><br><p>  <a href="https://habr.com/ru/company/mailru/blog/484192/">åœ¨ä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œ</a>æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä»æ‹“æ‰‘ä¸­æ°¸ä¹…åˆ é™¤ï¼ˆæ’é™¤ï¼‰å®ä¾‹ï¼Œå¼•å¯¼vshardï¼Œç®¡ç†è‡ªåŠ¨æ•…éšœè½¬ç§»æ¨¡å¼ï¼Œé…ç½®æˆæƒä»¥åŠä¿®è¡¥ç¾¤é›†é…ç½®ã€‚ ä¸è¦åœ¨é‚£é‡Œåœä¸‹æ¥ï¼Œç»§ç»­ç ”ç©¶<a href="https://github.com/tarantool/ansible-cartridge">æ–‡æ¡£</a>å¹¶å°è¯•æ›´æ”¹ç¾¤é›†å‚æ•°ã€‚ </p><br><p> å¦‚æœæŸäº›æ–¹æ³•ä¸èµ·ä½œç”¨ï¼Œè¯·åŠ¡å¿…<a href="https://github.com/tarantool/ansible-cartridge/issues/new">è®©</a>æˆ‘ä»¬çŸ¥é“è¯¥é—®é¢˜ã€‚ æˆ‘ä»¬å°†è¿…é€Ÿæ‘§æ¯ä¸€åˆ‡ï¼ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN478710/">https://habr.com/ru/post/zh-CN478710/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN478698/index.html">æˆ‘ä»¬åœ¨15åˆ†é’Ÿå†…åˆ¶å®šäº†äº’åŠ¨åœ°å½¢å›¾</a></li>
<li><a href="../zh-CN478702/index.html">Kapacitorä¸­çš„åº¦é‡å¤„ç†æŠ€å·§</a></li>
<li><a href="../zh-CN478704/index.html">å¦‚æœé‚®ä»¶å·²ç»åˆ°è¾¾åƒåœ¾é‚®ä»¶è¯¥æ€ä¹ˆåŠï¼š5ä¸ªå®é™…æ­¥éª¤</a></li>
<li><a href="../zh-CN478706/index.html">é«˜è´Ÿè½½æ¶æ„å¸ˆã€‚ OTUSçš„æ–°è¯¾ç¨‹</a></li>
<li><a href="../zh-CN478708/index.html">éšæœºå‘ç”Ÿå™¨å¦‚ä½•è®©æ‚¨ä¸ºæ—§æ¸¸æˆæ³¨å…¥æ–°çš„æ´»åŠ›</a></li>
<li><a href="../zh-CN478712/index.html">å¦‚ä½•ä¸ä¸ºJavaæ‰˜ç®¡æˆ–Google App Engineå¿«é€Ÿå…¥é—¨ä»˜è´¹</a></li>
<li><a href="../zh-CN478714/index.html">RetouchMeæ¡ˆä¾‹ç ”ç©¶ï¼šæˆ‘ä»¬ä»å°†åº”ç”¨ç¨‹åºæœ¬åœ°åŒ–ä¸º35ç§è¯­è¨€ä¸­å­¦åˆ°çš„çŸ¥è¯†</a></li>
<li><a href="../zh-CN478720/index.html">Heisenbugå’ŒMobiusçš„å…¬å…±å¹¿æ’­</a></li>
<li><a href="../zh-CN478722/index.html">å…¥é—¨å›¢é˜Ÿçš„å…­ä¸ªç§˜è¯€ï¼šå¦‚ä½•è·Ÿä¸Šä¸€åˆ‡å¹¶å‘å±•å›¢é˜Ÿ</a></li>
<li><a href="../zh-CN478726/index.html">OWASPè«æ–¯ç§‘èšä¼šï¼ƒ9</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>