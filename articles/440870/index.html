<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ñ´Ô∏è üï∫üèø üë®‚Äçüè´ C√≥mo parche√© el universo ‚è∫Ô∏è üê° üë©üèø‚Äçüè´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hay muchos art√≠culos sobre el desarrollo de juegos en Habr√©, pero entre ellos hay muy pocos art√≠culos relacionados con temas "detr√°s de escena". Uno d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo parche√© el universo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440870/"><img src="https://habrastorage.org/webt/qx/ux/p6/qxuxp6yfki43hwobitxc9pte6jm.jpeg" alt="imagen"><br><br>  <i>Hay muchos art√≠culos sobre el desarrollo de juegos en Habr√©, pero entre ellos hay muy pocos art√≠culos relacionados con temas "detr√°s de escena".</i>  <i>Uno de estos temas es la organizaci√≥n de la entrega, de hecho, del juego a un gran n√∫mero de usuarios durante mucho tiempo (uno, dos, tres).</i>  <i>A pesar del hecho de que para algunos la tarea puede parecer trivial, decid√≠ compartir mi experiencia de caminar el rake en este asunto para un proyecto espec√≠fico.</i>  <i>Alguien interesado, por favor.</i> <br><a name="habracut"></a><br>  <i>Una peque√±a digresi√≥n sobre la divulgaci√≥n de informaci√≥n.</i>  <i>La mayor√≠a de las empresas est√°n muy celosas de que la "cocina interior" no sea accesible al p√∫blico en general.</i>  <i>Por qu√©, no s√©, pero qu√© es eso.</i>  <i>En este proyecto en particular, The Universim, tuve suerte y fui el CEO de Crytivo Inc.</i>  <i>(anteriormente Crytivo Games Inc.) Alex Wallet result√≥ ser absolutamente cuerdo en este asunto, as√≠ que tengo la oportunidad de compartir experiencias con otros.</i> <br><br><h3>  Un poco sobre el parche en s√≠ mismo </h3><br>  He estado involucrado en el desarrollo de juegos durante mucho tiempo.  En algunos, como dise√±ador y programador de juegos, en otros, como una fusi√≥n de un administrador del sistema y un programador (no me gusta el t√©rmino "devops", ya que no refleja con precisi√≥n la esencia de las tareas que realizo en tales proyectos). <br><br>  A finales de 2013 (el horror de c√≥mo pasa el tiempo), pens√© en entregar nuevas versiones (compilaciones) a los usuarios.  Por supuesto, en ese momento hab√≠a muchas soluciones para tal tarea, pero gan√≥ el deseo de hacer un producto y el deseo de "construir bicicletas".  Adem√°s, quer√≠a aprender C # m√°s profundamente, as√≠ que decid√≠ hacer mi propio parcheador.  Mirando hacia el futuro, dir√© que el proyecto fue un √©xito, m√°s de una docena de compa√±√≠as lo usaron y lo usan en sus proyectos, algunos pidieron hacer una versi√≥n teniendo en cuenta exactamente sus deseos. <br><br>  La soluci√≥n cl√°sica consiste en crear paquetes delta (o diffs) de una versi√≥n a otra.  Sin embargo, este enfoque es inconveniente tanto para los jugadores de prueba como para los desarrolladores: en un caso, para obtener la √∫ltima versi√≥n del juego, debes pasar por toda la cadena de actualizaciones.  Es decir  el jugador necesita reunir secuencialmente una cierta cantidad de datos que √©l (a) nunca usar√°, y el desarrollador debe almacenar en su servidor (o servidores) un mont√≥n de datos obsoletos que algunos de los jugadores podr√≠an necesitar alguna vez. <br><br>  En otro caso, debe descargar el parche para su versi√≥n a la √∫ltima versi√≥n, pero el desarrollador debe mantener todo este zool√≥gico de parches en casa.  Algunas implementaciones de sistemas de parches requieren cierto software y cierta l√≥gica en los servidores, lo que tambi√©n crea un dolor de cabeza adicional para los desarrolladores.  Adem√°s, a menudo los desarrolladores de juegos no quieren hacer nada que no est√© directamente relacionado con el desarrollo del juego en s√≠.  Dir√© a√∫n m√°s, la mayor√≠a no son especialistas que pueden configurar servidores para la distribuci√≥n de contenido, esto simplemente no es su √°rea de actividad. <br><br>  Con todo esto en mente, quer√≠a encontrar una soluci√≥n que fuera lo m√°s simple posible para los usuarios (que quieren jugar m√°s r√°pido y no bailar con parches de diferentes versiones), as√≠ como para los desarrolladores que necesitan escribir un juego y no descubrir qu√© y por qu√© no actualizado por el siguiente usuario. <br><br>  Sabiendo c√≥mo funcionan algunos protocolos de sincronizaci√≥n de datos, cuando los datos se analizan en el cliente y solo se transmiten los cambios del servidor, decid√≠ utilizar el mismo enfoque. <br>  Adem√°s, en la pr√°ctica, de una versi√≥n a otra durante todo el per√≠odo de desarrollo, muchos archivos del juego cambian ligeramente: la textura est√° ah√≠, el modelo en s√≠, algunos sonidos. <br><br>  Como resultado, parec√≠a l√≥gico considerar cada archivo en el directorio del juego como un conjunto de bloques de datos.  Cuando se lanza la pr√≥xima versi√≥n, se analiza la construcci√≥n del juego, se construye un mapa de bloques y los archivos del juego se comprimen bloque por bloque.  El cliente analiza los bloques existentes y solo se descarga la diferencia. <br><br>  Inicialmente, el parche fue planeado como un m√≥dulo en Unity3D, sin embargo, surgi√≥ un detalle desagradable que me hizo reconsiderar esto.  El hecho es que Unity3D es una aplicaci√≥n (motor) que es completamente independiente de su c√≥digo.  Y mientras el motor est√° funcionando, hay un mont√≥n de archivos abiertos, lo que crea problemas cuando desea actualizarlos. <br><br>  En sistemas similares a Unix, sobrescribir un archivo abierto (a menos que est√© espec√≠ficamente bloqueado) no presenta ning√∫n problema, pero en Windows, sin bailar con una pandereta, una "finta con orejas" no funciona.  Es por eso que hice el parche como una aplicaci√≥n separada que no carga nada m√°s que las bibliotecas del sistema.  De hecho, el parche en s√≠ result√≥ ser una utilidad completamente independiente del motor Unity3D, que no impidi√≥, sin embargo, agregarlo a la tienda Unity3D. <br><br><h3>  Algoritmo Patcher </h3><br>  Entonces, los desarrolladores lanzan nuevas versiones con cierta frecuencia.  Los jugadores quieren obtener estas versiones.  El objetivo del desarrollador es proporcionar este proceso con costos m√≠nimos y un dolor de cabeza m√≠nimo para los jugadores. <br><br><h3>  Del desarrollador </h3><br>  Al preparar un parche, el algoritmo para las acciones del parche se ve as√≠: <br><br>  ‚óã Cree un √°rbol de archivos del juego con sus atributos y sumas de verificaci√≥n SHA512 <br>  ‚óã Para cada archivo: <br>  ‚ñ∫ Divida el contenido en bloques. <br>  ‚ñ∫ Guarde la suma de verificaci√≥n SHA256. <br>  ‚ñ∫ Comprima un bloque y agr√©guelo al mapa de bloques de archivos. <br>  ‚ñ∫ Guarde la direcci√≥n del bloque en el √≠ndice. <br>  ‚óã Guarde el √°rbol de archivos con sus sumas de verificaci√≥n. <br>  ‚óã Guarde el archivo de datos de la versi√≥n. <br><br>  El desarrollador tiene que cargar los archivos recibidos en el servidor. <br><br><h4>  Lado del jugador </h4><br>  En el cliente, el parcheador hace lo siguiente: <br>  ‚óã Se copia en un archivo con un nombre diferente.  Esto actualizar√° el archivo ejecutable del parche si es necesario.  Luego, el control se transfiere a la copia y se completa el original. <br>  ‚óã Descargue el archivo de versi√≥n y comp√°relo con el archivo de versi√≥n local. <br>  ‚óã Si la comparaci√≥n no revel√≥ una diferencia, puedes jugar, tenemos la √∫ltima versi√≥n.  Si hay una diferencia, pase al siguiente elemento. <br>  ‚óã Descargue un √°rbol de archivos con sus sumas de verificaci√≥n. <br>  ‚óã Para cada archivo en el √°rbol del servidor: <br>  ‚ñ∫ Si hay un archivo, considera su suma de comprobaci√≥n (SHA512).  De lo contrario, lo considera, pero vac√≠o (es decir, consiste en ceros s√≥lidos) y tambi√©n considera su suma de comprobaci√≥n. <br>  ‚ñ∫ Si la suma del archivo local no coincide con la suma de verificaci√≥n del archivo de la √∫ltima versi√≥n: <br>  ‚ñ∫ Crea un mapa de bloques local y lo compara con el mapa de bloques del servidor. <br>  ‚ñ∫ Para cada bloque local que difiere del remoto, descarga un bloque comprimido del servidor y lo sobrescribe localmente. <br>  ‚óã Si no hay errores, actualiza el archivo de versi√≥n. <br><br>  Hice el tama√±o del bloque de datos un m√∫ltiplo de 1024 bytes, despu√©s de un cierto n√∫mero de pruebas, decid√≠ que era m√°s f√°cil operar con bloques de 64 KB.  Aunque la universalidad en el c√≥digo permanece: <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#region DQPatcher class public class DQPatcher { </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// some internal constants // 1 minute timeout by default private const int DEFAULT_NETWORK_TIMEOUT = 60000; // maximum number of compressed blocks, which we will download at once private const UInt16 MAX_COMPRESSED_BLOCKS = 1000; // default block size, you can use range from 4k to 64k, //depending on average size of your files in the project tree private const uint DEFAULT_BLOCK_SIZE = 64 * 1024; ... #region public constants and vars section // X * 1024 bytes by default for patch creation public static uint blockSize = DEFAULT_BLOCK_SIZE; ... #endregion ....</span></span></span></span></code> </pre> <br>  Si hace que los bloques sean peque√±os, entonces el cliente requiere menos cambios cuando los cambios son pocos.  Sin embargo, surge otro problema: el tama√±o del archivo de √≠ndice aumenta inversamente con la disminuci√≥n del tama√±o del bloque, es decir  Si operamos con bloques de 8 KB, entonces el archivo de √≠ndice ser√° 8 veces m√°s grande que con bloques de 64 KB. <br><br>  Eleg√≠ SHA256 / 512 para archivos y bloques de las siguientes consideraciones: la velocidad en comparaci√≥n con el (obsoleto) MD5 / SHA128 difiere ligeramente, y a√∫n necesita leer bloques y archivos.  Y la probabilidad de colisiones con SHA256 / 512 es significativamente menor que con MD5 / SHA128.  Para ser completamente aburrido, es en este caso, pero es tan peque√±o que esta probabilidad puede ser descuidada. <br><br>  Adem√°s, el cliente tiene en cuenta los siguientes puntos: <br>  ‚ñ∫ Los bloques de datos se pueden cambiar en diferentes versiones, es decir  localmente, tenemos el bloque n√∫mero 10, y en el servidor tenemos el bloque n√∫mero 12, o viceversa.  Esto se tiene en cuenta para no descargar datos adicionales. <br>  ‚ñ∫ Los bloques se solicitan no uno a la vez, sino en grupos: el cliente intenta combinar los rangos de los bloques necesarios y los solicita al servidor utilizando el encabezado Range.  Esto tambi√©n minimiza la carga del servidor: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// get compressed remote blocks of data and return it to the caller // Note: we always operating with compressed data, so all offsets are in the _compressed_ data file!! // Throw an exception, if fetching compressed blocks failed public byte[] GetRemoteBlocks(string remoteName, UInt64 startByteRange, UInt64 endByteRange) { if (verboseOutput) Console.Error.WriteLine("Getting partial content for [" + remoteName + "]"); if (verboseOutput) Console.Error.WriteLine("Range is [" + startByteRange + "-" + endByteRange + "]"); int bufferSize = 1024; byte[] remoteData; byte[] buffer = new byte[bufferSize]; HttpWebRequest httpRequest = (HttpWebRequest)WebRequest.Create(remoteName); httpRequest.KeepAlive = true; httpRequest.AddRange((int)startByteRange, (int)endByteRange); httpRequest.Method = WebRequestMethods.Http.Get; httpRequest.ReadWriteTimeout = this.networkTimeout; try { // Get back the HTTP response for web server HttpWebResponse httpResponse = (HttpWebResponse)httpRequest.GetResponse(); if (verboseOutput) Console.Error.WriteLine("Got partial content length: " + httpResponse.ContentLength); remoteData = new byte[httpResponse.ContentLength]; Stream httpResponseStream = httpResponse.GetResponseStream(); if (!((httpResponse.StatusCode == HttpStatusCode.OK) || (httpResponse.StatusCode == HttpStatusCode.PartialContent))) // rise an exception, we expect partial content here { RemoteDataDownloadingException pe = new RemoteDataDownloadingException("While getting remote blocks:\n" + httpResponse.StatusDescription); throw pe; } int bytesRead = 0; int rOffset = 0; while ((bytesRead = httpResponseStream.Read(buffer, 0, bufferSize)) &gt; 0) { // if(verboseOutput) Console.Error.WriteLine("Got ["+bytesRead+"] bytes of remote data block."); Array.Copy(buffer, 0, remoteData, rOffset, bytesRead); rOffset += bytesRead; } if (verboseOutput) Console.Error.WriteLine("Total got: [" + rOffset + "] bytes"); httpResponse.Close(); } catch (Exception ex) { if (verboseOutput) Console.Error.WriteLine(ex.ToString()); PatchException pe = new PatchException("Unable to fetch URI " + remoteName, ex); throw pe; } return remoteData; }</span></span></code> </pre> <br>  Por supuesto, result√≥ que el cliente puede ser interrumpido en cualquier momento y despu√©s del lanzamiento posterior, continuar√° de facto con su trabajo y no descargar√° todo desde cero. <br><br>  Aqu√≠ puede ver un video que ilustra el trabajo del parcheador en el proyecto de ejemplo Angry Bots: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/lTyeYJcKbzo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  Sobre c√≥mo se organiz√≥ el parche del universo del juego </h3><br>  En septiembre de 2015, Alex Koshelkov se puso en contacto conmigo y me ofreci√≥ unirse al proyecto; necesitaban una soluci√≥n que proporcionara actualizaciones mensuales a 30 mil (con cola) de jugadores.  El tama√±o inicial del juego en el archivo es de 600 megabytes.  Antes de contactarme, hubo intentos de hacer su propia versi√≥n usando Electron, pero todo se top√≥ con el mismo problema de archivos abiertos (por cierto, la versi√≥n actual de Electron puede hacer esto) y algunos otros.  Adem√°s, ninguno de los desarrolladores entendi√≥ c√≥mo funcionar√≠a esto: me proporcionaron varios dise√±os de bicicletas, la parte del servidor estaba ausente por completo, quer√≠an hacerlo despu√©s de que todas las otras tareas se hayan resuelto. <br><br>  Adem√°s, era necesario resolver el problema de c√≥mo evitar la fuga de las claves del jugador: el hecho es que las claves eran para la plataforma Steam, aunque el juego en Steam a√∫n no estaba disponible p√∫blicamente.  Distribuir el juego era estrictamente requerido por la clave, aunque exist√≠a la posibilidad de que los jugadores pudieran compartir la clave del juego con amigos, esto podr√≠a descuidarse, ya que si el juego aparec√≠a en Steam, la clave solo pod√≠a activarse una vez. <br><br>  En la versi√≥n normal del parche, el √°rbol de datos para el parche se ve as√≠: <br><pre> ./
 | - linux
 El |  | - 1.0.0
 El |  `- version.txt
 | - macosx
 El |  | - 1.0.0
 El |  `- version.txt
 `- ventanas
     | - 1.0.0
     `- version.txt
</pre><br><br>  Necesitaba asegurarme de que solo aquellos con la clave correcta tuvieran acceso. <br><br>  Se me ocurri√≥ la siguiente soluci√≥n: para cada clave obtenemos su hash (SHA1), luego la usamos como una ruta para acceder a los datos del parche en el servidor.  En el servidor, transferimos los datos del parche a un nivel m√°s alto que el docroot, y agregamos enlaces simb√≥licos al directorio con los datos del parche en el mismo docroot.  Los enlaces simb√≥licos tienen los mismos nombres que los hashes clave, solo se dividen en varios niveles (para facilitar el funcionamiento del sistema de archivos), es decir.  el hash 0f99e50314d63c30271 ... ... ade71963e7ff se representar√° como <br><pre> ./0f/99/e5/0314d63c30271.....ade71963e7ff -----&gt; / full / path / to / patch-data /
</pre><br>  Por lo tanto, no es necesario distribuir las claves a alguien que admitir√° los servidores de actualizaci√≥n; es suficiente transferir sus hashes, que son absolutamente in√∫tiles para los propios jugadores. <br><br>  Para agregar nuevas claves (o eliminar las antiguas), simplemente agregue / elimine el enlace simb√≥lico correspondiente. <br><br>  Con esta implementaci√≥n, la verificaci√≥n de la clave en s√≠ misma obviamente no se realiza en ninguna parte; recibir errores 404 en el cliente indica que la clave es incorrecta (o ha sido desactivada). <br><br>  Cabe se√±alar que el acceso clave no es una protecci√≥n DRM completa: estas son solo restricciones en la etapa de pruebas alfa y beta (cerradas).  Y la b√∫squeda se corta f√°cilmente por medio del servidor web en s√≠ (al menos en Nginx, que yo uso). <br><br>  En el mes de lanzamiento, solo se entregaron 2.5 TB de tr√°fico solo el primer d√≠a, y en los d√≠as siguientes, se distribuye aproximadamente la misma cantidad en promedio por mes: <br><br><img src="https://habrastorage.org/webt/nl/a8/xn/nla8xn_apxlj7gfk20fyhdtm5xi.png" alt="imagen"><br><br>  Por lo tanto, si planea distribuir una gran cantidad de contenido, es mejor calcular de antemano cu√°nto le costar√°.  Seg√∫n observaciones personales: el tr√°fico m√°s barato de los hosteleros europeos, el m√°s caro (dir√≠a "oro") de Amazon y Google. <br><br>  En la pr√°ctica, los ahorros de tr√°fico por a√±o en promedio en The Universim son enormes: compare los n√∫meros anteriores.  Por supuesto, si un usuario no tiene un juego en absoluto o si est√° muy desactualizado, no ocurrir√° un milagro y tendr√° que descargar una gran cantidad de datos del servidor; si es desde cero, entonces un poco m√°s de lo que el juego toma en el archivo.  Sin embargo, con actualizaciones mensuales, las cosas se ponen realmente bien.  En menos de 6 meses, el espejo estadounidense dio un poco m√°s de 10 TB de tr√°fico, sin el uso de un parche este valor habr√≠a crecido significativamente. <br><br>  As√≠ es como se ve el tr√°fico anual del proyecto: <br><br><img src="https://habrastorage.org/webt/1f/h_/e4/1fh_e4-xudejikja5ekk_9iixti.png" alt="imagen"><br><br>  Algunas palabras sobre el "rastrillo" m√°s memorable que tuvimos que dar en el proceso de trabajar en un parche personalizado para el juego "The Universim": <br><br>  ‚óè El mayor problema era esperarme de los antivirus.  Bueno, no les gustan las aplicaciones que descargan algo de Internet all√≠, modifican archivos (incluidos los ejecutables) y luego tambi√©n intentan ejecutar los archivos descargados.  Algunos antivirus no solo bloquearon el acceso a los archivos locales, sino que tambi√©n bloquearon las llamadas al servidor de actualizaci√≥n, ingresando directamente a los datos que el cliente descarg√≥.  La soluci√≥n fue utilizar una firma digital v√°lida para el parche, esto reduce dr√°sticamente la paranoia de los antivirus, y el uso del protocolo HTTPS en lugar de HTTP, elimina r√°pidamente algunos de los errores asociados con la curiosidad de los antivirus. <br><br>  ‚óè Actualizaci√≥n de progreso.  Muchos usuarios (y clientes) desean ver el progreso de la actualizaci√≥n.  Uno tiene que improvisar, ya que no siempre es posible mostrar de manera confiable el progreso sin tener que hacer un trabajo extra.  S√≠, y tampoco se puede mostrar el tiempo exacto del final del proceso de parche, ya que el parche en s√≠ no tiene datos sobre qu√© archivos deben actualizarse por adelantado. <br><br>  ‚óè Una gran cantidad de usuarios de EE. UU. Tienen velocidades de conexi√≥n a servidores de Europa no muy altas.  La migraci√≥n del servidor de actualizaci√≥n a los EE. UU. Resolvi√≥ este problema.  Para los usuarios de otros continentes, dejamos el servidor en Alemania.  Por cierto, el tr√°fico en los EE. UU. Es mucho m√°s caro que el europeo, en algunos casos, varias docenas de veces. <br><br>  ‚óè Apple no se siente muy c√≥modo con este m√©todo de instalaci√≥n de aplicaciones.  Pol√≠tica oficial: las aplicaciones deben instalarse solo desde su tienda.  Pero el problema es que las aplicaciones en las etapas de prueba alfa y beta no est√°n permitidas en la tienda.  Y a√∫n m√°s, no hay nada de qu√© hablar sobre la venta de aplicaciones en bruto desde el acceso temprano.  Por lo tanto, tienes que escribir instrucciones sobre c√≥mo bailar en amapolas.  La opci√≥n con AppAnnie (a√∫n eran independientes) no se consider√≥ debido al l√≠mite en el n√∫mero de evaluadores. <br><br>  ‚óè Las redes son bastante impredecibles.  Para que la aplicaci√≥n no se rindiera de inmediato, tuve que ingresar un contador de errores.  9 excepciones detectadas le permiten decirle firmemente al usuario que tiene problemas con la red. <br><br>  ‚óè Los sistemas operativos de 32 bits tienen restricciones en el tama√±o de los archivos que se muestran en la memoria (Archivos de mapa de memoria - MMF) para cada subproceso de ejecuci√≥n y para el proceso en su conjunto.  Las primeras versiones del parche utilizaban MMF para acelerar el trabajo, pero como los archivos de los recursos del juego pueden ser enormes, tuve que abandonar este enfoque y usar secuencias de archivos normales.  Por cierto, no se observ√≥ una p√©rdida especial de rendimiento, probablemente debido a la lectura proactiva del sistema operativo. <br><br>  ‚óè Debe estar preparado para que los usuarios se quejen.  No importa cu√°n bueno sea su producto, siempre habr√° quienes no est√©n satisfechos.  Y cuantos m√°s usuarios de su producto (en el caso de The Universim hay m√°s de 50 mil en este momento), m√°s cuantitativamente habr√° quejas para usted.  En t√©rminos porcentuales, este es un n√∫mero muy peque√±o, pero en t√©rminos cuantitativos ... <br><br>  A pesar de que el proyecto en su conjunto fue un √©xito, tiene algunos inconvenientes: <br><br>  ‚óè Aunque inicialmente elimin√© toda la l√≥gica principal por separado, la parte de la GUI es diferente en la implementaci√≥n para MAC y Windows.  La versi√≥n de Linux no caus√≥ problemas: todos los problemas se debieron principalmente solo al usar una compilaci√≥n monol√≠tica que no requer√≠a el entorno de tiempo de ejecuci√≥n mono (MRE).  Pero dado que necesita tener una licencia adicional para distribuir dichos archivos ejecutables, se decidi√≥ abandonar las compilaciones monol√≠ticas y simplemente requerir MRE.  La versi√≥n de Linux difiere de la versi√≥n de Windows solo en la compatibilidad con los atributos de archivo espec√≠ficos de los sistemas * nix.  Para mi segundo proyecto, que ser√° m√°s que un simple parcheador, planeo usar un enfoque modular en forma de proceso de n√∫cleo que se ejecute en segundo plano y permita administrar todo en la interfaz local.  Y el control en s√≠ puede llevarse a cabo desde una aplicaci√≥n basada en Electron y similares (o simplemente desde un navegador).  Con cualquier cosita.  Antes de hablar sobre el tama√±o de la distribuci√≥n de tales aplicaciones, observe el tama√±o de los juegos.  Las versiones demo (!!!) de algunas ocupan 5 o m√°s gigabytes en el archivo (!!!). <br><br>  ‚óè Las estructuras que se usan ahora no ahorran espacio cuando se lanza el juego para 3 plataformas. De hecho, debes conservar 3 copias de datos casi id√©nticos, aunque comprimidos. <br><br>  ‚óè La versi√≥n actual del parcheador no almacena en cach√© su trabajo, cada vez que se recalculan todas las sumas de verificaci√≥n de todos los archivos.  Ser√≠a posible reducir significativamente el tiempo si el parche almacenara en cach√© los resultados de aquellos archivos que ya est√°n en el cliente.  Pero hay un dilema: si el archivo est√° da√±ado (o falta), pero la entrada de cach√© para este archivo se guarda, entonces el parche se saltar√°, lo que causar√° problemas. <br><br>  ‚óè La versi√≥n actual no puede funcionar simult√°neamente con varios servidores (a menos que haga Round-robin usando DNS). Me gustar√≠a cambiar a una tecnolog√≠a "similar a torrent" para que pueda usar varios servidores al mismo tiempo.  No se trata de utilizar clientes como fuente de datos, ya que esto plantea muchos problemas legales y es m√°s f√°cil rechazarlo desde el principio. <br><br>  ‚óè Si desea restringir el acceso a las actualizaciones, esta l√≥gica deber√° implementarse de forma independiente.  En realidad, esto dif√≠cilmente se puede llamar un inconveniente, ya que todos pueden tener sus propios deseos con respecto a las restricciones.  La restricci√≥n de teclas m√°s simple, sin ninguna parte del servidor, se hace bastante simple, como mostr√© anteriormente. <br><br>  ‚óè Se crea un parche para un solo proyecto a la vez.  Si desea construir algo similar a Steam, entonces ya se requiere un sistema completo de entrega de contenido.  Y este es un proyecto de un nivel completamente diferente. <br><br>  Planeo poner el parche en el dominio p√∫blico despu√©s de que se implemente la "segunda generaci√≥n": un sistema de entrega de contenido del juego que incluir√° no solo el parche evolucionado, sino tambi√©n un m√≥dulo de telemetr√≠a (ya que los desarrolladores necesitan saber qu√© est√°n haciendo los jugadores), M√≥dulo de guardado en la nube y algunos otros m√≥dulos. <br><br>  Si tiene un proyecto sin fines de lucro y necesita un parche, escr√≠bame los detalles sobre su proyecto y le dar√© una copia gratis.  No habr√° enlaces aqu√≠, ya que este no es el centro "I PR". <br><br>  Estar√© encantado de responder a sus preguntas. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/440870/">https://habr.com/ru/post/440870/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../440856/index.html">C√≥mo el espacio y el tiempo pueden ser un c√≥digo de correcci√≥n de error cu√°ntico</a></li>
<li><a href="../440858/index.html">Hay muchos programas para aprender ingl√©s, pero ¬øvale la pena usar alguno si eres programador?</a></li>
<li><a href="../440862/index.html">Patrones de CI / CD y antipatrones. Parte 1</a></li>
<li><a href="../440864/index.html">La tr√°gica historia de citas poppler</a></li>
<li><a href="../440866/index.html">Los tel√©fonos p√∫blicos en Rusia quieren complementar el Ministerio de Situaciones de Emergencia</a></li>
<li><a href="../440872/index.html">PostGIS y JPA</a></li>
<li><a href="../440874/index.html">Implementaci√≥n del movimiento de part√≠culas libres en ReactJS</a></li>
<li><a href="../440878/index.html">Anal√≠tica web para empresas</a></li>
<li><a href="../440880/index.html">Los 10 mejores sensores IoT en 2019</a></li>
<li><a href="../440882/index.html">Escapar de Crypto Pro. Edici√≥n GOST 34.10-2012</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>