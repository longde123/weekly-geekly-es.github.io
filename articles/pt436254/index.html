<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõ¥ üñïüèª üì£ Um bot para Starcraft em Rust, C ou qualquer outro idioma üë∑üèª ü§πüèø üéÖüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="StarCraft: Guerra da Ninhada . Este jogo significa muito para mim! E para muitos de voc√™s, eu acho. Tanto que me pergunto se devo dar um link para sua...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Um bot para Starcraft em Rust, C ou qualquer outro idioma</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436254/"><img src="https://habrastorage.org/webt/qv/fa/ex/qvfaexsnkzmckmwrt_spqmc7nr4.png" align="left"><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">StarCraft: Guerra da Ninhada</a> .  Este jogo significa muito para mim!  E para muitos de voc√™s, eu acho.  Tanto que me pergunto se devo dar um link para sua p√°gina na Wikipedia ou n√£o. </p><br><p>  Certa vez, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Halt</a> me enviou um PM e se ofereceu para aprender <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Rust</a> .  Como qualquer pessoa comum, decidimos come√ßar com <del>  ol√° mundo </del>  escrever uma biblioteca din√¢mica para Windows que possa ser carregada no espa√ßo de endere√ßo do StarCraft e gerenciar unidades. </p><br><p>  O artigo a seguir descreve o processo de encontrar solu√ß√µes e usar tecnologias e t√©cnicas que permitir√£o que voc√™ aprenda coisas novas sobre o Rust e seu ecossistema.  Voc√™ tamb√©m pode se inspirar para implementar um bot usando sua linguagem favorita, seja C, C ++, Ruby, Python, etc. </p><a name="habracut"></a><br><p>  Definitivamente, vale a pena ouvir o hino da Cor√©ia do Sul enquanto l√™ este artigo: </p><br><div class="spoiler">  <b class="spoiler_title">Starcraft OST</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/pNt0iVG2VOA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><br><h2 id="bwapi">  Bwapi </h2><br><p>  Este jogo tem quase 20 anos.  E ainda √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">popular</a> ;  Os campeonatos atra√≠ram multid√µes de pessoas nos EUA, mesmo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">em 2017,</a> onde ocorreu a batalha dos grandes mestres Jaedong vs Bisu.  Al√©m de jogadores humanos, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">m√°quinas sem alma</a> tamb√©m participam de batalhas de SC!  E isso √© poss√≠vel por causa do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BWAPI</a> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Links</a> mais √∫teis. </p><br><p>  Por mais de uma d√©cada, houve uma comunidade de desenvolvedores de bot em torno deste jogo.  Entusiastas criam bots e participam de v√°rios campeonatos.  Muitos deles estudam IA e aprendizado de m√°quina.  O BWAPI √© usado pelas universidades para treinar seus alunos.  Existe at√© um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">canal de</a> transmiss√£o transmitindo essas correspond√™ncias. </p><br><p>  Assim, uma equipe de f√£s reverteu o back-end de Starcraft h√° v√°rios anos e desenvolveu uma API em C ++, que permite criar bots, fazer inje√ß√µes no processo do jogo e dominar humanos miser√°veis. </p><br><p>  Como costuma acontecer, antes <del>  construir uma casa, √© necess√°rio extrair min√©rio, forjar ferramentas </del>  Ao criar um bot, voc√™ precisa implementar uma API.  O que Rust tem a oferecer? </p><br><h2 id="ffi">  Ffi </h2><br><p>  √â bastante simples trabalhar com outros idiomas do Rust.  Existe um <abbr title="Interface de fun√ß√£o externa">FFI</abbr> para isso.  Deixe-me dar um pequeno trecho da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> . </p><br><p>  Imagine que temos uma biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">snappy</a> , que possui um arquivo de cabe√ßalho <a href="">snappy-ch</a> , que cont√©m declara√ß√µes de fun√ß√£o. </p><br><p>  Vamos criar um projeto usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">carga</a> . </p><br><pre><code class="bash hljs">$ cargo new --bin snappy Created binary (application) `snappy` project $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> snappy snappy$ tree . ‚îú‚îÄ‚îÄ Cargo.toml ‚îî‚îÄ‚îÄ src ‚îî‚îÄ‚îÄ main.rs 1 directory, 2 files</code> </pre> <br><p>  A Cargo criou uma estrutura de arquivos padr√£o para o projeto. </p><br><p>  No <code>Cargo.toml</code> , especificamos a depend√™ncia do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">libc</a> : </p><br><pre> <code class="plaintext hljs">[dependencies] libc = "0.2"</code> </pre> <br><p>  O arquivo <code>src/main.rs</code> ter√° a seguinte apar√™ncia: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">crate</span></span> libc; <span class="hljs-comment"><span class="hljs-comment">// To import C types, in our case for size_t use libc::size_t; #[link(name = "snappy")] // Specify the name of the library for linking the function extern { // We write the declaration of the function which we want to import // in C the declaration looks like this: // size_t snappy_max_compressed_length(size_t source_length); fn snappy_max_compressed_length(source_length: size_t) -&gt; size_t; } fn main() { let x = unsafe { snappy_max_compressed_length(100) }; println!("max compressed length of a 100 byte buffer: {}", x); }</span></span></code> </pre> <br><p>  Vamos construir e executar o projeto: </p><br><pre> <code class="bash hljs">snappy$ cargo build ... snappy$ cargo run Finished dev [unoptimized + debuginfo] target(s) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 0.02s Running `target/debug/snappy` max compressed length of a 100 byte buffer: 148</code> </pre> <br><p>  Voc√™ pode chamar apenas a <code>cargo run</code> , que chama a <code>cargo build</code> antes da execu√ß√£o.  Outra op√ß√£o √© construir o projeto e chamar o bin√°rio diretamente: </p><br><pre> <code class="bash hljs">snappy$ ./target/debug/snappy max compressed length of a 100 byte buffer: 148</code> </pre> <br><p>  Se a biblioteca snappy estiver instalada, o c√≥digo ser√° compilado (para o Ubuntu, voc√™ deve instalar o pacote libsnappy-dev). </p><br><pre> <code class="bash hljs">snappy$ ldd target/debug/snappy ... libsnappy.so.1 =&gt; /usr/lib/x86_64-linux-gnu/libsnappy.so.1 (0x00007f8de07cf000)</code> </pre> <br><p>  Como voc√™ pode ver, nosso bin√°rio est√° vinculado √† biblioteca compartilhada libsnappy.  E uma chamada para <code>snappy_max_compressed_length</code> em nosso c√≥digo √© uma chamada de fun√ß√£o desta biblioteca. </p><br><h2 id="rust-bindgen">  ferrugem-bindgen </h2><br><p>  Seria bom se pud√©ssemos gerar automaticamente nosso FFI.  Felizmente, existe um utilit√°rio chamado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rust-bindgen</a> na caixa de ferramentas de um viciado em Rust.  √â capaz de gerar liga√ß√µes FFI para bibliotecas C (e algumas C ++). </p><br><p>  Instala√ß√£o: </p><br><pre> <code class="bash hljs">$ cargo install bindgen</code> </pre> <br><p>  Como √© a <strong>ferrugem-bindgen</strong> ?  Pegamos os arquivos de cabe√ßalho C / C ++, apontamos o utilit√°rio <strong>bindgen</strong> para eles, e a sa√≠da que obtemos √© gerada pelo c√≥digo Rust com as declara√ß√µes apropriadas para nos permitir usar estruturas e fun√ß√µes C.  Aqui est√° o que o <code>bindgen</code> gera para o snappy: </p><br><pre> <code class="rust hljs">$ bindgen /usr/include/snappy-ch | grep -C <span class="hljs-number"><span class="hljs-number">1</span></span> snappy_max_compressed_length <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">snappy_max_compressed_length</span></span></span></span>(source_length: <span class="hljs-built_in"><span class="hljs-built_in">usize</span></span>) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">usize</span></span>; }</code> </pre> <br><p>  Acontece que o bindgen n√£o pode lidar com cabe√ßalhos BWAPI, gerando toneladas de c√≥digo n√£o utiliz√°vel (por causa de fun√ß√µes membro virtuais, std :: string em uma API p√∫blica, etc.).  A quest√£o √© que o BWAPI √© escrito em C ++.  C ++ √© geralmente dif√≠cil de usar, mesmo em projetos C ++.  Depois que a biblioteca √© montada, √© melhor vincul√°-la ao mesmo vinculador (mesma vers√£o), os arquivos de cabe√ßalho devem ser analisados ‚Äã‚Äãcom o mesmo compilador (mesma vers√£o).  Todos esses fatores podem afetar o resultado.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mangling,</a> por exemplo, que ainda <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">n√£o pode ser implementado sem erros</a> no GNU GCC.  Esses fatores s√£o t√£o significativos que nem o <abbr title="Estrutura de teste C ++ do Google">gtest</abbr> conseguiu super√°-lo.  E na <a href="">documenta√ß√£o</a> diz: √© melhor voc√™ criar o gtest como parte do projeto pelo mesmo compilador e pelo mesmo vinculador. </p><br><h2 id="bwapi-c">  Bwapi-c </h2><br><p>  C √© a l√≠ngua franca da engenharia de software.  Se rust-bindgen funciona bem para a linguagem C, por que n√£o implementar o BWAPI for C e usar sua API?  Boa ideia! </p><br><p>  Sim, √© uma boa ideia at√© voc√™ examinar o interior da BWAPI e ver o n√∫mero de classes e m√©todos que voc√™ deve implementar.  Especialmente todos esses layouts de mem√≥ria, c√≥digos ASM, patches de mem√≥ria e outros "horrores" para os quais n√£o temos tempo.  √â necess√°rio usar a solu√ß√£o existente completamente. </p><br><p>  Mas precisamos de alguma forma superar as fun√ß√µes desconcertantes, de c√≥digo C ++, heran√ßa e membro virtual. </p><br><p>  Em C ++, existem duas ferramentas poderosas que usaremos para resolver nosso problema: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ponteiros opacos</a> e <code>extern "C"</code> . </p><br><p>  <code>extern "C" {}</code> permite que o c√≥digo C ++ "oculte" a si mesmo em C. Torna poss√≠vel gerar nomes de fun√ß√µes sem confundir. </p><br><p>  Ponteiros opacos nos permitem limpar o tipo e criar um ponteiro para "algum tipo" sem fornecer sua implementa√ß√£o.  Como essa √© apenas uma declara√ß√£o de algum tipo, √© imposs√≠vel usar esse tipo por valor, voc√™ pode us√°-lo apenas por ponteiro. </p><br><p>  Vamos imaginar que temos esse c√≥digo C ++: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> cpp { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bar; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;bar; } }; } <span class="hljs-comment"><span class="hljs-comment">// namespace cpp</span></span></code> </pre> <br><p>  Podemos transform√°-lo em um cabe√ßalho C: </p><br><pre> <code class="plaintext hljs">extern "C" { typedef struct Foo_ Foo; // Opaque pointer to Foo // call cpp::Foo::get_bar int Foo_get_bar(Foo* self); }</code> </pre> <br><p>  E aqui est√° a parte do C ++ que ser√° o link entre o cabe√ßalho C e a implementa√ß√£o do C ++: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Foo_get_bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Foo* self)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// cast the opaque pointer to the certain cpp::Foo and call the method ::get_bar return reinterpret_cast&lt;cpp::Foo*&gt;(self)-&gt;get_bar(); }</span></span></code> </pre> <br><p>  Nem todos os m√©todos das classes tiveram que ser processados ‚Äã‚Äãdessa maneira.  No BWAPI, existem classes que voc√™ pode implementar usando os campos dessas estruturas, por exemplo, <code>typedef struct Position { int x; int y; } Position;</code> <code>typedef struct Position { int x; int y; } Position;</code>  e m√©todos como <code>Position::get_distance</code> . </p><br><p>  Havia aulas que eu tinha que tratar de uma maneira especial.  Por exemplo, AIModule deve ser um ponteiro para uma classe C ++ com um conjunto espec√≠fico de fun√ß√µes-membro virtuais.  No entanto, aqui est√° o <a href="">cabe√ßalho</a> e a <a href="">implementa√ß√£o</a> . </p><br><p>  Assim, ap√≥s v√°rios meses de trabalho duro, <strong>554</strong> m√©todos e uma d√∫zia de classes, nasceu a biblioteca de plataforma cruzada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BWAPI-C</a> , que permite <a href="">criar bots em C.</a>  Um subproduto era a possibilidade de compila√ß√£o cruzada e a capacidade de implementar a API em qualquer outro idioma que suporte FFI e a conven√ß√£o de chamada cdecl. </p><br><p>  Se voc√™ estiver escrevendo uma biblioteca, escreva sua API em C. </p><br><p>  O recurso mais importante do BWAPI-C √© a integra√ß√£o mais ampla poss√≠vel com outras linguagens de programa√ß√£o.  <code>Python</code> , <code>Ruby</code> , <code>Rust</code> , <code>PHP</code> , <code>Java</code> e muitos outros s√£o capazes de trabalhar com C; portanto, se voc√™ resolver os problemas e implementar os pr√≥prios wrappers, tamb√©m poder√° escrever um bot com a ajuda deles. </p><br><h2 id="writing-a-bot-in-c">  Escrevendo um bot em C </h2><br><p>  Esta parte descreve os princ√≠pios gerais da organiza√ß√£o interna dos m√≥dulos Starcraft. </p><br><p>  Existem 2 tipos de bots: m√≥dulo e cliente.  Vejamos um exemplo de escrita de um m√≥dulo. </p><br><p>  O m√≥dulo √© uma biblioteca din√¢mica.  O princ√≠pio geral de carregamento de bibliotecas din√¢micas pode ser visto <a href="">aqui</a> .  O m√≥dulo deve exportar 2 fun√ß√µes: <code>newAIModule</code> e <code>gameInit</code> . </p><br><p>  <code>gameInit</code> √© f√°cil.  Esta fun√ß√£o √© chamada para passar um ponteiro para um jogo atual.  Esse ponteiro √© muito importante, porque existe uma vari√°vel est√°tica global nos caracteres curinga da BWAPI, que √© usada em algumas se√ß√µes do c√≥digo.  Vamos descrever <code>gameInit</code> : </p><br><pre> <code class="plaintext hljs">DLLEXPORT void gameInit(void* game) { BWAPIC_setGame(game); }</code> </pre> <br><p>  <code>newAIModule</code> √© um pouco mais complicado.  Ele deve retornar o ponteiro para uma classe C ++, que possui uma tabela de m√©todos virtuais com nomes como <strong>onXXXXX,</strong> chamados em determinados eventos do jogo.  Vamos declarar a estrutura do m√≥dulo: </p><br><pre> <code class="plaintext hljs">typedef struct ExampleAIModule { const AIModule_vtable* vtable_; const char* name; } ExampleAIModule;</code> </pre> <br><p>  O primeiro campo deve ser um ponteiro para a tabela de m√©todos (√© um tipo de m√°gica).  Aqui est√° a fun√ß√£o <code>newAIModule</code> : </p><br><pre> <code class="plaintext hljs">DLLEXPORT void* newAIModule() { ExampleAIModule* const module = (ExampleAIModule*) malloc( sizeof(ExampleAIModule) ); module-&gt;name = "ExampleAIModule"; module-&gt;vtable_ = &amp;module_vtable; return createAIModuleWrapper( (AIModule*) module ); }</code> </pre> <br><p>  <code>createAIModuleWrapper</code> √© outro truque de m√°gica que transforma o ponteiro C no ponteiro da classe C ++ com <del>  m√©todos virtuais </del>  fun√ß√µes de membro. </p><br><p>  <code>module_vtable</code> √© uma vari√°vel est√°tica na tabela de m√©todos, os valores dos m√©todos s√£o preenchidos com ponteiros para fun√ß√µes globais: </p><br><pre> <code class="plaintext hljs">static AIModule_vtable module_vtable = { onStart, onEnd, onFrame, onSendText, onReceiveText, onPlayerLeft, onNukeDetect, onUnitDiscover, onUnitEvade, onUnitShow, onUnitHide, onUnitCreate, onUnitDestroy, onUnitMorph, onUnitRenegade, onSaveGame, onUnitComplete }; void onEnd(AIModule* module, bool isWinner) { } void onFrame(AIModule* module) {} void onSendText(AIModule* module, const char* text) {} void onReceiveText(AIModule* module, Player* player, const char* text) {} void onPlayerLeft(AIModule* module, Player* player) {} void onNukeDetect(AIModule* module, Position target) {} void onUnitDiscover(AIModule* module, Unit* unit) {} void onUnitEvade(AIModule* module, Unit* unit) {} void onUnitShow(AIModule* module, Unit* unit) {} void onUnitHide(AIModule* module, Unit* unit) {} void onUnitCreate(AIModule* module, Unit* unit) {} void onUnitDestroy(AIModule* module, Unit* unit) {} void onUnitMorph(AIModule* module, Unit* unit) {} void onUnitRenegade(AIModule* module, Unit* unit) {} void onSaveGame(AIModule* module, const char* gameName) {} void onUnitComplete(AIModule* module, Unit* unit) {}</code> </pre> <br><p>  Se voc√™ observar o nome das fun√ß√µes e suas assinaturas, fica claro em que condi√ß√µes e com quais argumentos eles precisam ser chamados.  Por <a href="">exemplo,</a> deixei todas as fun√ß√µes vazias, exceto </p><br><pre> <code class="plaintext hljs">void onStart(AIModule* module) { ExampleAIModule* self = (ExampleAIModule*) module; Game* game = BWAPIC_getGame(); Game_sendText(game, "Hello from bwapi-c!"); Game_sendText(game, "My name is %s", self-&gt;name); }</code> </pre> <br><p>  Esta fun√ß√£o √© chamada quando o jogo √© executado.  O argumento √© um ponteiro para o m√≥dulo atual.  <code>BWAPIC_getGame</code> retorna um ponteiro global para o jogo, que definimos usando uma chamada para <code>BWAPIC_setGame</code> .  Ent√£o, vamos mostrar um exemplo pr√°tico de compila√ß√£o cruzada de um m√≥dulo: </p><br><pre> <code class="bash hljs">bwapi-c/example$ tree . ‚îú‚îÄ‚îÄ BWAPIC.dll ‚îî‚îÄ‚îÄ Dll.c 0 directories, 2 files bwapi-c/example$ i686-w64-mingw32-gcc -mabi=ms -shared -o Dll.dll Dll.c -I../include -L. -lBWAPIC bwapi-c/example$ cp Dll.dll ~/Starcraft/bwapi-data/ bwapi-c/example$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Starcraft/bwapi-data/ Starcraft$ wine bwheadless.exe -e StarCraft.exe -l bwapi-data/BWAPI.dll --headful ... ... ...</code> </pre> <br><p>  Aperte os bot√µes e execute o jogo.  Mais informa√ß√µes sobre compila√ß√£o e execu√ß√£o podem ser encontradas no site da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BWAPI</a> e em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BWAPI-C</a> . </p><br><p>  O resultado do m√≥dulo: </p><br><p><img src="https://habrastorage.org/webt/cw/a-/41/cwa-41ihsyva-pj2stpef1xjn2g.png" alt="imagem"></p><br><p>  Voc√™ pode encontrar um exemplo um pouco mais complicado de um m√≥dulo que mostra como trabalhar com iteradores, gerenciamento de unidades, pesquisa mineral e sa√≠da de estat√≠sticas em <a href="">bwapi-c / example / Dll.c.</a> </p><br><h2 id="bwapi-sys">  bwapi-sys </h2><br><p>  No ecossistema Rust, existe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">uma certa maneira</a> de nomear pacotes vinculados a bibliotecas nativas.  Qualquer pacote foo-sys executa duas fun√ß√µes importantes: </p><br><ul><li>  links com a biblioteca nativa libfoo; </li><li>  fornece declara√ß√µes para as fun√ß√µes da biblioteca libfoo.  Mas apenas declara√ß√µes!  Abstra√ß√µes de alto n√≠vel n√£o s√£o fornecidas em caixas * -sys. </li></ul><br><p>  Para que o pacote * -sys seja capaz de vincular com √™xito, voc√™ deve solicitar ao cargo <a href="">que procure</a> a biblioteca nativa e / ou <a href="">construa</a> a biblioteca a partir das fontes. </p><br><p>  Para que o pacote * -sys forne√ßa declara√ß√µes, voc√™ precisa escrev√™-las por conta pr√≥pria ou ger√°-las usando o bindgen.  Novamente bindgen.  Tentativa n√∫mero dois =) </p><br><p>  A gera√ß√£o de liga√ß√µes √© super f√°cil: </p><br><pre> <code class="bash hljs">bindgen BWAPI.h -o lib.rs \ --opaque-type <span class="hljs-string"><span class="hljs-string">".+_"</span></span> \ --blacklist-type <span class="hljs-string"><span class="hljs-string">"std.*|__.+|.+_$|Game_v(Send|Print|Draw).*|va_list|.+_t$"</span></span> \ --no-layout-tests \ --no-derive-debug \ --raw-line <span class="hljs-string"><span class="hljs-string">"#![allow(improper_ctypes, non_snake_case)]"</span></span> \ -- -I../submodules/bwapi-c/include sed -i -r -- <span class="hljs-string"><span class="hljs-string">'s/.+\s+(.+)_;/pub struct \1;/'</span></span> lib.rs</code> </pre> <br><p>  <code>BWAPI.h</code> √© um arquivo com todos os cabe√ßalhos C do BWAPI-C. </p><br><p>  Por exemplo, o bindgen j√° gerou essas declara√ß√µes para as fun√ß√µes acima: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> { <span class="hljs-comment"><span class="hljs-comment">/// BWAPIC_setGame must be called from gameInit to initialize BWAPI::BroodwarPtr pub fn BWAPIC_setGame(game: *mut Game); } extern "C" { pub fn BWAPIC_getGame() -&gt; *mut Game; }</span></span></code> </pre> <br><p>  Existem duas estrat√©gias: armazenar o c√≥digo gerado no reposit√≥rio e gerar o c√≥digo rapidamente durante a compila√ß√£o.  Ambas as abordagens t√™m suas vantagens e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">desvantagens</a> . </p><br><p>  Prazer em conhec√™-lo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bwapi-sys</a> ;  mais um pequeno passo para o nosso objetivo. </p><br><p>  Voc√™ se lembra que antes eu estava falando sobre multiplataforma?  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">O nlinker</a> entrou no projeto e implementou uma estrat√©gia astuta.  Se o host de destino for Windows, fa√ßa o download do BWAPIC j√° montado no GitHub.  E para os demais alvos, coletamos o BWAPI-C a partir das fontes do OpenBW (falarei sobre isso mais adiante). </p><br><h2 id="bwapi-rs">  bwapi-rs </h2><br><p>  Agora temos as liga√ß√µes e podemos definir abstra√ß√µes de alto n√≠vel.  Temos dois tipos para trabalhar: valores puros e ponteiros opacos. </p><br><p>  Tudo √© simples, com valores puros.  Vamos tomar as cores como exemplo.  Precisamos facilitar o uso do c√≥digo Rust para usar as cores de maneira conveniente e natural: </p><br><pre> <code class="rust hljs">game.draw_line(CoordinateType::Screen, (<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>), (<span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>), Color::Red); ^^^</code> </pre> <br><p>  Portanto, para uso conveniente, seria necess√°rio definir a enumera√ß√£o com <a href="">constantes</a> C ++, mas tamb√©m idiom√°tica para Rust, e definir m√©todos de convers√£o em bwapi_sys :: Color usando std :: convert :: From: </p><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// FFI version #[repr(C)] #[derive(Copy, Clone)] pub struct Color { pub color: ::std::os::raw::c_int, } // Idiomatic version #[derive(PartialEq, PartialOrd, Copy, Clone)] pub enum Color { Black = 0, Brown = 19, ...</span></span></code> </pre> <br><p>  Para sua conveni√™ncia, voc√™ pode usar a caixa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">enum-primitive-</a> derivate. </p><br><p>  Tamb√©m √© f√°cil usar ponteiros opacos.  Vamos usar o padr√£o <a href="">Newtype</a> : </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Player</span></span></span></span>(*<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> sys::Player);</code> </pre> <br><p>  Isso significa que o Player √© um tipo de estrutura com um campo privado - um ponteiro opaco bruto de C. E aqui est√° a maneira como voc√™ pode definir o Player :: color: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> Player { <span class="hljs-comment"><span class="hljs-comment">// so the method is declared Player::getColor in bwapi-sys //extern "C" { // pub fn Player_getColor(self_: *mut Player) -&gt; Color; //} pub fn color(&amp;self) -&gt; Color { // bwapi_sys::Player_getColor - wrapper function from BWAPI-C // self.0 - opaque pointer let color = unsafe { bwapi_sys::Player_getColor(self.0) }; color.into() // cast bwapi_sys::Color -&gt; Color } }</span></span></code> </pre> <br><p>  Agora podemos escrever nosso primeiro bot no Rust! </p><br><h2 id="creating-a-bot-in-rust">  Criando um bot no Rust </h2><br><p>  Como prova de conceito, o bot ser√° semelhante a um pa√≠s conhecido: toda a tarefa √© contratar trabalhadores e coletar minerais. </p><br><p><img src="https://habrastorage.org/webt/hx/r_/jm/hxr_jmj2fbsitx-tfw96p2pa2tu.png" alt="Coreia do Norte"></p><br><p><img src="https://habrastorage.org/webt/ww/gf/lr/wwgflrekcnxtv75thaurrwcm0g8.png" alt="Coreia do sul"></p><br><p>  Vamos come√ßar com as fun√ß√µes necess√°rias <code>gameInit</code> e <code>newAIModule</code> : </p><br><pre> <code class="rust hljs"><span class="hljs-meta"><span class="hljs-meta">#[no_mangle]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsafe</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gameInit</span></span></span></span>(game: *<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> void) { bwapi_sys::BWAPIC_setGame(game <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> bwapi_sys::Game); } <span class="hljs-meta"><span class="hljs-meta">#[no_mangle]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsafe</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newAIModule</span></span></span></span>() -&gt; *<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> void { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> module = ExampleAIModule { name: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>::from(<span class="hljs-string"><span class="hljs-string">"ExampleAIModule"</span></span>) }; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> result = wrap_handler(<span class="hljs-built_in"><span class="hljs-built_in">Box</span></span>::new(module)); result }</code> </pre> <br><p>  <code>#[no_mangle]</code> executa a mesma fun√ß√£o que <code>extern "C"</code> em C ++.  Dentro do <code>wrap_handler</code> toda a m√°gica ocorre, com a substitui√ß√£o da tabela de fun√ß√µes virtuais e a classe C ++ "mascarada". </p><br><p>  As defini√ß√µes da estrutura do m√≥dulo s√£o ainda mais simples e sofisticadas do que em C: </p><br><pre> <code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExampleAIModule</span></span></span></span> { name: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, }</code> </pre> <br><p>  Vamos adicionar alguns m√©todos para renderizar as estat√≠sticas e dar ordens: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> ExampleAIModule { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">draw_stat</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> game = Game::get(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> message = <span class="hljs-built_in"><span class="hljs-built_in">format!</span></span>(<span class="hljs-string"><span class="hljs-string">"Frame {}"</span></span>, game.frame_count()); game.draw_text(CoordinateType::Screen, (<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), &amp;message); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">give_orders</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> player = Game::get().self_player(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> unit <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> player.units() { <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> unit.get_type() { UnitType::Terran_SCV | UnitType::Zerg_Drone | UnitType::Protoss_Probe =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !unit.is_idle() { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> unit.is_carrying_gas() || unit.is_carrying_minerals() { unit.return_cargo(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-literal"><span class="hljs-literal">Some</span></span>(mineral) = Game::get() .minerals() .min_by_key(|m| unit.distance_to(m)) { <span class="hljs-comment"><span class="hljs-comment">// WE REQUIRE MORE MINERALS unit.right_click(&amp;mineral, false); } } UnitType::Terran_Command_Center =&gt; { unit.train(UnitType::Terran_SCV); } UnitType::Protoss_Nexus =&gt; { unit.train(UnitType::Protoss_Probe); } UnitType::Zerg_Hatchery | UnitType::Zerg_Lair | UnitType::Zerg_Hive =&gt; { unit.train(UnitType::Zerg_Drone); } _ =&gt; {} }; } } }</span></span></code> </pre> <br><p>  Para transformar o tipo ExampleAIModule em um m√≥dulo real, √© necess√°rio faz√™-lo responder aos eventos <strong>onXXXX</strong> .  Para fazer isso, voc√™ precisa implementar o tipo EventHandler, que √© an√°logo da tabela virtual AIModule_vtable de C: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> EventHandler <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ExampleAIModule { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_start</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { Game::get().send_text(&amp;<span class="hljs-built_in"><span class="hljs-built_in">format!</span></span>(<span class="hljs-string"><span class="hljs-string">"Hello from Rust! My name is {}"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.name)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_end</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _is_winner: <span class="hljs-built_in"><span class="hljs-built_in">bool</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_frame</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.draw_stat(); <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.give_orders(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_send_text</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _text: &amp;<span class="hljs-built_in"><span class="hljs-built_in">str</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_receive_text</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _player: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Player, _text: &amp;<span class="hljs-built_in"><span class="hljs-built_in">str</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_player_left</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _player: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Player) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_nuke_detect</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _target: Position) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_discover</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_evade</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_show</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_hide</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_create</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_destroy</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_morph</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_renegade</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_save_game</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _game_name: &amp;<span class="hljs-built_in"><span class="hljs-built_in">str</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_complete</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} }</code> </pre> <br><p>  Criar e executar o m√≥dulo √© t√£o simples quanto em C: </p><br><pre> <code class="bash hljs">bwapi-rs$ cargo build --example dll --target=i686-pc-windows-gnu bwapi-rs$ cp ./target/i686-pc-windows-gnu/debug/examples/dll.dll ~/Starcraft/bwapi-data/Dll.dll bwapi-rs$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Starcraft/bwapi-data/ Starcraft$ wine bwheadless.exe -e StarCraft.exe -l bwapi-data/BWAPI.dll --headful ... ... ...</code> </pre> <br><p>  E o v√≠deo do trabalho: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/rACbnWpI01M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="openbw">  Openbw </h2><br><p>  Esses caras foram ainda mais longe.  Eles decidiram escrever uma vers√£o de c√≥digo aberto do SC: BW!  E eles s√£o bons nisso.  Um de seus objetivos era implementar imagens em HD, mas SC: Remastered estava √† frente deles = (neste momento, voc√™ pode usar sua API para escrever bots (sim, tamb√©m em C ++), mas o recurso mais surpreendente √© a capacidade de visualizar reproduz <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">diretamente no seu navegador</a> . </p><br><h2 id="conclusion">  Conclus√£o </h2><br><p>  Houve um problema n√£o resolvido com a implementa√ß√£o: n√£o controlamos as refer√™ncias como √∫nicas; portanto, a exist√™ncia de <code>&amp;mut</code> e <code>&amp;</code> na mesma regi√£o resultar√° em um comportamento indefinido quando o objeto for modificado.  Um tipo de problema.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Halt</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tentou</a> implementar liga√ß√µes idiom√°ticas, mas n√£o conseguiu encontrar uma solu√ß√£o.  Al√©m disso, se voc√™ quiser concluir esta tarefa, precisar√° "escavar" com cuidado a API C ++ e colocar os qualificadores <code>const</code> corretamente. </p><br><p>  Eu realmente gostei de trabalhar neste projeto, assisti aos replays Ï¢ÖÏùº e profundamente imerso na atmosfera.  Este jogo fez um abalo em um universo.  Nenhum jogo pode ser popular pela popularidade de SC: BW, e seu impacto no ÎåÄÌïúÎØºÍµ≠ Ï†ïÏπò ÏóêÍ≤å era impens√°vel.  Os jogadores profissionais da Cor√©ia do Sul s√£o t√£o populares quanto os Dorams coreanos transmitidos no hor√°rio nobre.  ÎòêÌïú, ÌïúÍµ≠ ÏóêÏÑú Í≤åÏù¥Î®∏ ÎùºÎ©¥ Íµ∞ÎåÄ Ïùò ÌäπÎ≥ÑÌïú Ïóê Ïóê ÏûÖÎåÄ Ìï† Ïàò. </p><br><p>  Viva o StarCraft! </p><br><h2 id="links">  Liga√ß√µes </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reddit</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bwapi-rs</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bwapi-sys</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bwapi-c</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bwapi</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">openbw</a> </li></ul><br><hr><br><p>  Muito obrigado a Steve Klabnik por me ajudar com a revis√£o do artigo. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt436254/">https://habr.com/ru/post/pt436254/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt436242/index.html">YOLO e outras metodologias soltas</a></li>
<li><a href="../pt436244/index.html">O novo c√©rebro do professor Lawrence</a></li>
<li><a href="../pt436246/index.html">Engenharia automotiva moderna - 02. Muito tese sobre OS</a></li>
<li><a href="../pt436248/index.html">Kalman Filter</a></li>
<li><a href="../pt436250/index.html">Chefes sugadores de sangue fora do contexto ou por que sempre falham</a></li>
<li><a href="../pt436256/index.html">Conseguir um emprego na Alemanha ser√° mais f√°cil</a></li>
<li><a href="../pt436260/index.html">Erros e armadilhas das startups em patentear seu IP</a></li>
<li><a href="../pt436262/index.html">* A atualiza√ß√£o do Ethereum "Constantinopla" foi adiada devido a uma potencial vulnerabilidade encontrada no √∫ltimo momento</a></li>
<li><a href="../pt436264/index.html">Mono-reposit√≥rios: por favor n√£o (parte 2)</a></li>
<li><a href="../pt436266/index.html">Escalada extrema no Alibaba JDK</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>