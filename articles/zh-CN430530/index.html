<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ˜º âœŠğŸ¼ ğŸ¿ ç”¨äºç§»åŠ¨æµ‹è¯•è‡ªåŠ¨åŒ–çš„æ¨¡æ‹ŸæœåŠ¡å™¨ ğŸ›£ï¸ ğŸ‘ï¸ ğŸŒ¦ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨å¤„ç†æœ€æ–°é¡¹ç›®æ—¶ï¼Œæˆ‘é¢ä¸´ç€æµ‹è¯•åœ¨ç§»åŠ¨é€»è¾‘ä¸Šä¸å„ç§ç¬¬ä¸‰æ–¹æœåŠ¡è¿æ¥çš„ç§»åŠ¨åº”ç”¨ç¨‹åºçš„éœ€æ±‚ã€‚ æµ‹è¯•è¿™äº›æœåŠ¡ä¸æ˜¯æˆ‘çš„ä»»åŠ¡ï¼Œä½†æ˜¯ï¼ŒAPIçš„é—®é¢˜é˜»æ­¢äº†åº”ç”¨ç¨‹åºæœ¬èº«çš„å·¥ä½œ-æµ‹è¯•å¤±è´¥çš„åŸå› ä¸æ˜¯å†…éƒ¨çš„é—®é¢˜ï¼Œè€Œæ˜¯å› ä¸ºAPIçš„ä¸å¯æ“ä½œæ€§ï¼Œç”šè‡³æ˜¯åœ¨æœªæ£€æŸ¥å¿…è¦çš„åŠŸèƒ½ä¹‹å‰ã€‚ 

 ä¼ ç»Ÿä¸Šï¼Œæ”¯æ¶ç”¨äºæµ‹è¯•æ­¤ç±»åº”ç”¨ã€‚ ä½†æ˜¯å®ƒä»¬å¹¶ä¸æ€»æ˜¯...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ç”¨äºç§»åŠ¨æµ‹è¯•è‡ªåŠ¨åŒ–çš„æ¨¡æ‹ŸæœåŠ¡å™¨</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/maxilect/blog/430530/"> åœ¨å¤„ç†æœ€æ–°é¡¹ç›®æ—¶ï¼Œæˆ‘é¢ä¸´ç€æµ‹è¯•åœ¨ç§»åŠ¨é€»è¾‘ä¸Šä¸å„ç§ç¬¬ä¸‰æ–¹æœåŠ¡è¿æ¥çš„ç§»åŠ¨åº”ç”¨ç¨‹åºçš„éœ€æ±‚ã€‚ æµ‹è¯•è¿™äº›æœåŠ¡ä¸æ˜¯æˆ‘çš„ä»»åŠ¡ï¼Œä½†æ˜¯ï¼ŒAPIçš„é—®é¢˜é˜»æ­¢äº†åº”ç”¨ç¨‹åºæœ¬èº«çš„å·¥ä½œ-æµ‹è¯•å¤±è´¥çš„åŸå› ä¸æ˜¯å†…éƒ¨çš„é—®é¢˜ï¼Œè€Œæ˜¯å› ä¸ºAPIçš„ä¸å¯æ“ä½œæ€§ï¼Œç”šè‡³æ˜¯åœ¨æœªæ£€æŸ¥å¿…è¦çš„åŠŸèƒ½ä¹‹å‰ã€‚ <br><br> ä¼ ç»Ÿä¸Šï¼Œæ”¯æ¶ç”¨äºæµ‹è¯•æ­¤ç±»åº”ç”¨ã€‚ ä½†æ˜¯å®ƒä»¬å¹¶ä¸æ€»æ˜¯æ­£å¸¸å·¥ä½œï¼Œè¿™ä¼šå¹²æ‰°å·¥ä½œã€‚ ä½œä¸ºæ›¿ä»£è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä½¿ç”¨äº†mokiã€‚ æˆ‘ä»Šå¤©æƒ³è°ˆè°ˆè¿™æ¡æ£˜æ‰‹çš„é“è·¯ã€‚ <br><br><img src="https://habrastorage.org/webt/kn/uf/vw/knufvwqxahfwy6zkqxrkgeirrga.jpeg" alt="å›¾ç‰‡"><br><a name="habracut"></a><br> ä¸ºäº†ä¸æ¶‰åŠå®é™…é¡¹ç›®çš„ä»£ç ï¼ˆåœ¨NDAä¸‹ï¼‰ï¼Œä¸ºè¿›ä¸€æ­¥è®¨è®ºçš„æ¸…æ™°èµ·è§ï¼Œæˆ‘ä¸ºAndroidåˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„RESTå®¢æˆ·ç«¯ï¼Œè¯¥å®¢æˆ·ç«¯å…è®¸ä½¿ç”¨æˆ‘éœ€è¦çš„å‚æ•°å°†HTTPè¯·æ±‚ï¼ˆGET / POSTï¼‰å‘é€åˆ°æŸä¸ªåœ°å€ã€‚ æˆ‘ä»¬å°†å¯¹å…¶è¿›è¡Œæµ‹è¯•ã€‚ <br> å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»GitLabä¸‹è½½</a>å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä»£ç ï¼Œè°ƒåº¦ç¨‹åºå’Œæµ‹è¯•ã€‚ <br><br><h2> æœ‰å“ªäº›é€‰æ‹©ï¼Ÿ </h2><br> åœ¨æˆ‘çš„æƒ…å†µä¸‹ï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥æ¨¡ä»¿ï¼š <br><br><ul><li> åœ¨äº‘ä¸­æˆ–è¿œç¨‹è®¡ç®—æœºä¸Šéƒ¨ç½²æ¨¡æ‹ŸæœåŠ¡å™¨ï¼ˆå¦‚æœæˆ‘ä»¬æ­£åœ¨è°ˆè®ºä¸èƒ½å¸¦åˆ°äº‘ä¸­çš„æœºå¯†å¼€å‘ï¼‰ï¼› </li><li> åœ¨è¦æµ‹è¯•ç§»åŠ¨åº”ç”¨ç¨‹åºçš„ç”µè¯ä¸Šï¼Œåœ¨æœ¬åœ°å¯åŠ¨æ¨¡æ‹ŸæœåŠ¡å™¨ã€‚ </li></ul><br> ç¬¬ä¸€ç§é€‰æ‹©ä¸æµ‹è¯•å¹³å°æ²¡æœ‰å¤ªå¤§ä¸åŒã€‚ ç¡®å®ï¼Œå¯ä»¥åœ¨ç½‘ç»œä¸­ä¸ºæ¨¡æ‹ŸæœåŠ¡å™¨åˆ†é…ä¸€ä¸ªå·¥ä½œç«™ï¼Œä½†æ˜¯åƒä»»ä½•æµ‹è¯•å°ä¸€æ ·ï¼Œå®ƒéœ€è¦å¾—åˆ°æ”¯æŒã€‚ åœ¨è¿™é‡Œï¼Œæœ‰å¿…è¦é‡åˆ°è¿™ç§æ–¹æ³•çš„ä¸»è¦é™·é˜±ã€‚ è¿œç¨‹å·¥ä½œç«™å·²æ­»äº¡ï¼Œåœæ­¢å“åº”ï¼Œå‘ç”Ÿäº†æŸäº›æ›´æ”¹-æ‚¨éœ€è¦ç›‘è§†ï¼Œæ›´æ”¹é…ç½®ï¼Œå³ ä¸åœ¨å¸¸è§„æµ‹è¯•å°çš„æ”¯æŒä¸‹è¿›è¡Œæ‰€æœ‰æ“ä½œç›¸åŒã€‚ æˆ‘ä»¬æ— æ³•ä¸ºè‡ªå·±çº æ­£è¿™ç§æƒ…å†µï¼Œè€Œä¸”è‚¯å®šä¼šæ¯”ä»»ä½•æœ¬åœ°æ“ä½œèŠ±è´¹æ›´å¤šçš„æ—¶é—´ã€‚ å› æ­¤ï¼Œç‰¹åˆ«æ˜¯åœ¨æˆ‘çš„é¡¹ç›®ä¸­ï¼Œåœ¨æœ¬åœ°æå‡æ¨¡æ‹ŸæœåŠ¡å™¨æ›´ä¸ºæ–¹ä¾¿ã€‚ <br><br><h2> é€‰æ‹©æ¨¡æ‹ŸæœåŠ¡å™¨ </h2><br> æœ‰å¾ˆå¤šä¸åŒçš„å·¥å…·ã€‚ æˆ‘å°è¯•ä¸å‡ ä¸ªäººä¸€èµ·å·¥ä½œï¼Œå‡ ä¹åœ¨æ¯ä¸ªäººä¸­æˆ‘éƒ½é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼š <br><br><ul><li>  <b>æ¨¡æ‹ŸæœåŠ¡å™¨</b> ï¼Œ <b>wiremock-</b>ä¸¤ä¸ªæ— æ³•åœ¨Androidä¸Šæ­£å¸¸è¿è¡Œçš„æ¨¡æ‹ŸæœåŠ¡å™¨ã€‚ ç”±äºæ‰€æœ‰å®éªŒéƒ½æ˜¯ä½œä¸ºç°åœºé¡¹ç›®çš„ä¸€éƒ¨åˆ†è¿›è¡Œçš„ï¼Œå› æ­¤é€‰æ‹©çš„æ—¶é—´æœ‰é™ã€‚ å’Œä»–ä»¬ä¸€èµ·æŒ–äº†å‡ å¤©åï¼Œæˆ‘æ”¾å¼ƒäº†å°è¯•ã€‚ </li><li>  <b>Restmock</b>æ˜¯<b>okhttpmockwebserver</b>çš„åŒ…è£…ï¼Œ <b>ç¨å</b>å°†å¯¹å…¶è¿›è¡Œè¯¦ç»†è®¨è®ºã€‚ çœ‹èµ·æ¥ä¸é”™ï¼Œå®ƒå¼€å§‹äº†ï¼Œä½†æ˜¯è¿™ä¸ªåŒ…è£…å™¨çš„å¼€å‘äººå‘˜â€œåœ¨å¹•åâ€éšè—äº†è®¾ç½®æ¨¡æ‹ŸæœåŠ¡å™¨çš„IPåœ°å€å’Œç«¯å£çš„åŠŸèƒ½ï¼Œå¯¹æˆ‘æ¥è¯´è¿™å¾ˆå…³é”®ã€‚  Restmockåœ¨æŸä¸ªéšæœºç«¯å£ä¸Šå¯åŠ¨ã€‚ ä»”ç»†æŸ¥çœ‹ä»£ç ï¼Œæˆ‘çœ‹åˆ°åˆå§‹åŒ–æœåŠ¡å™¨æ—¶ï¼Œå¼€å‘äººå‘˜ä½¿ç”¨äº†ä¸€ç§æ–¹æ³•æ¥éšæœºè®¾ç½®ç«¯å£ï¼ˆå¦‚æœå®ƒåœ¨è¾“å…¥ä¸­æœªæ¥æ”¶åˆ°è¯¥ç«¯å£ï¼‰ã€‚ åŸåˆ™ä¸Šï¼Œå¯ä»¥ä»æ­¤æ–¹æ³•ç»§æ‰¿ï¼Œä½†æ˜¯é—®é¢˜å‡ºåœ¨ç§æœ‰æ„é€ å‡½æ•°ä¸­ã€‚ ç»“æœï¼Œæˆ‘æ‹’ç»äº†åŒ…è£…çº¸ã€‚ </li><li>  <b>Okhttpmockwebserver-</b>å°è¯•äº†ä¸åŒçš„å·¥å…·åï¼Œæˆ‘åœåœ¨äº†æ¨¡æ‹ŸæœåŠ¡å™¨ä¸Šï¼Œè¯¥æœåŠ¡å™¨é€šå¸¸ä¼šèšåœ¨ä¸€èµ·å¹¶åœ¨è®¾å¤‡ä¸Šæœ¬åœ°å¯åŠ¨ã€‚ </li></ul><br><h2> æˆ‘ä»¬åˆ†æå·¥ä½œåŸç† </h2><br> å½“å‰ç‰ˆæœ¬çš„okhttpmockwebserverå…è®¸æ‚¨å®ç°å‡ ç§å·¥ä½œæ–¹æ¡ˆï¼š <br><br><ul><li>  <b>ç­”æ¡ˆæ’é˜Ÿ</b> ã€‚ æ¨¡æ‹ŸæœåŠ¡å™¨å“åº”å°†æ·»åŠ åˆ°FIFOé˜Ÿåˆ—ä¸­ã€‚ ä¸ç®¡æˆ‘è¦è®¿é—®å“ªä¸ªAPIå’Œå“ªä¸ªè·¯å¾„ï¼Œæ¨¡æ‹ŸæœåŠ¡å™¨éƒ½ä¼šè½®æµå‘è¯¥é˜Ÿåˆ—ä¸­æŠ›å‡ºæ¶ˆæ¯ã€‚ </li><li> <b>è°ƒåº¦ç¨‹åº</b>å…è®¸<b>æ‚¨</b>åˆ›å»ºç¡®å®šç»™å‡ºç­”æ¡ˆçš„è§„åˆ™ã€‚ å‡è®¾è¯·æ±‚æ¥è‡ªåŒ…å«è·¯å¾„çš„URLï¼Œä¾‹å¦‚/ get-login /ã€‚ åœ¨è¿™ä¸ª/ get-login /æ¨¡æ‹ŸæœåŠ¡å™¨ä¸Šï¼Œå¹¶ç»™å‡ºä¸€ä¸ªé¢„å®šä¹‰çš„å“åº”ã€‚ </li><li>  <b>è¯·æ±‚éªŒè¯è€…</b> ã€‚ åŸºäºå‰é¢çš„åœºæ™¯ï¼Œæˆ‘å¯ä»¥æ£€æŸ¥åº”ç”¨ç¨‹åºå‘é€çš„è¯·æ±‚ï¼ˆåœ¨ç»™å®šæ¡ä»¶ä¸‹ï¼Œç¡®å®å­˜åœ¨å¸¦æœ‰æŸäº›å‚æ•°çš„è¯·æ±‚ï¼‰ã€‚ ä½†æ˜¯ï¼Œç­”æ¡ˆå¹¶ä¸é‡è¦ï¼Œå› ä¸ºå®ƒå–å†³äºAPIçš„å·¥ä½œæ–¹å¼ã€‚ è¯¥è„šæœ¬å®ç°äº†è¯·æ±‚éªŒè¯å™¨ã€‚ </li></ul><br> æ›´è¯¦ç»†åœ°è€ƒè™‘æ¯ä¸ªæ–¹æ¡ˆã€‚ <br><br><h3> å“åº”é˜Ÿåˆ— </h3><br> æ¨¡æ‹ŸæœåŠ¡å™¨æœ€ç®€å•çš„å®ç°æ˜¯å“åº”é˜Ÿåˆ—ã€‚ åœ¨æµ‹è¯•ä¹‹å‰ï¼Œæˆ‘å°†ç¡®å®šå°†åœ¨å…¶ä¸­éƒ¨ç½²æ¨¡æ‹ŸæœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£ï¼Œä»¥åŠå®ƒå°†æ ¹æ®æ¶ˆæ¯é˜Ÿåˆ—çš„åŸç†å·¥ä½œçš„äº‹å®-FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ã€‚ <br><br> æ¥ä¸‹æ¥ï¼Œè¿è¡Œæ¨¡æ‹ŸæœåŠ¡å™¨ã€‚ <br><br><pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QueueTest</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseTest</span></span></span><span class="hljs-class">() </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Rule</span></span> <span class="hljs-meta"><span class="hljs-meta">@JvmField</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mActivityRule: ActivityTestRule&lt;MainActivity&gt; = ActivityTestRule(MainActivity::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Before</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fun</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initMockServer</span></span></span><span class="hljs-class">() </span></span>{ val mockServer = MockWebServer() val ip = InetAddress.getByName(<span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>) val port = <span class="hljs-number"><span class="hljs-number">8080</span></span> mockServer.enqueue(MockResponse().setBody(<span class="hljs-string"><span class="hljs-string">"1st message"</span></span>)) mockServer.enqueue(MockResponse().setBody(<span class="hljs-string"><span class="hljs-string">"2nd message"</span></span>)) mockServer.enqueue(MockResponse().setBody(<span class="hljs-string"><span class="hljs-string">"3rd message"</span></span>)) mockServer.start(ip, port) } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">queueTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ sendGetRequest(<span class="hljs-string"><span class="hljs-string">"http://localhost:8080/getMessage"</span></span>) assertResponseMessage(<span class="hljs-string"><span class="hljs-string">"1st message"</span></span>) returnFromResponseActivity() sendPostRequest(<span class="hljs-string"><span class="hljs-string">"http://localhost:8080/getMessage"</span></span>) assertResponseMessage(<span class="hljs-string"><span class="hljs-string">"2nd message"</span></span>) returnFromResponseActivity() sendGetRequest(<span class="hljs-string"><span class="hljs-string">"http://localhost:8080/getMessage"</span></span>) assertResponseMessage(<span class="hljs-string"><span class="hljs-string">"3rd message"</span></span>) returnFromResponseActivity() } }</code> </pre> <br> æµ‹è¯•æ˜¯ä½¿ç”¨Espressoæ¡†æ¶ç¼–å†™çš„ï¼Œè¯¥æ¡†æ¶æ—¨åœ¨åœ¨ç§»åŠ¨åº”ç”¨ç¨‹åºä¸­æ‰§è¡Œæ“ä½œã€‚ åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘é€‰æ‹©è¯·æ±‚ç±»å‹å¹¶ä¾æ¬¡å‘é€å®ƒä»¬ã€‚ <br> å¼€å§‹æµ‹è¯•åï¼Œæ¨¡æ‹ŸæœåŠ¡å™¨å°†æ ¹æ®æŒ‡å®šçš„é˜Ÿåˆ—ä¸ºå…¶æä¾›ç­”æ¡ˆï¼Œå¹¶ä¸”æµ‹è¯•é¡ºåˆ©é€šè¿‡ä¸”æ²¡æœ‰é”™è¯¯ã€‚ <br><br><h3> åˆ†æ´¾å™¨å®æ–½ </h3><br> è°ƒåº¦ç¨‹åºæ˜¯æ¨¡æ‹ŸæœåŠ¡å™¨æ“ä½œæ‰€ä¾æ®çš„ä¸€ç»„è§„åˆ™ã€‚ ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘åˆ›å»ºäº†ä¸‰ä¸ªä¸åŒçš„è°ƒåº¦ç¨‹åºï¼šSimpleDispatcherï¼ŒOtherParamsDispatcherå’ŒListingDispatcherã€‚ <br><br><h4> ç®€å•è°ƒåº¦ç¨‹åº </h4><br>  Okhttpmockwebserveræä¾›<code>Dispatcher()</code>ç±»æ¥å®ç°è°ƒåº¦ç¨‹åºã€‚ æ‚¨å¯ä»¥é€šè¿‡ä»¥è‡ªå·±çš„æ–¹å¼è¦†ç›–<code>dispatch</code>å‡½æ•°æ¥ä»ä¸­ç»§æ‰¿ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleDispatcher</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Dispatcher</span></span></span><span class="hljs-class">() </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispatch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request: RecordedRequest)</span></span></span><span class="hljs-function">: MockResponse </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (request.method == <span class="hljs-string"><span class="hljs-string">"GET"</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MockResponse().setResponseCode(<span class="hljs-number"><span class="hljs-number">200</span></span>).setBody(<span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"{ "</span></span>message<span class="hljs-string"><span class="hljs-string">": "</span></span>It was a GET request<span class="hljs-string"><span class="hljs-string">" }"</span></span><span class="hljs-string"><span class="hljs-string">""</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (request.method == <span class="hljs-string"><span class="hljs-string">"POST"</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MockResponse().setResponseCode(<span class="hljs-number"><span class="hljs-number">200</span></span>).setBody(<span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"{ "</span></span>message<span class="hljs-string"><span class="hljs-string">": "</span></span>It was a POST request<span class="hljs-string"><span class="hljs-string">" }"</span></span><span class="hljs-string"><span class="hljs-string">""</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MockResponse().setResponseCode(<span class="hljs-number"><span class="hljs-number">200</span></span>) } }</code> </pre><br> æ­¤ç¤ºä¾‹ä¸­çš„é€»è¾‘å¾ˆç®€å•ï¼šå¦‚æœGETåˆ°è¾¾ï¼Œæˆ‘å°†è¿”å›ä¸€æ¡æ¶ˆæ¯ï¼Œè¡¨æ˜è¿™æ˜¯GETè¯·æ±‚ã€‚ å¦‚æœæ˜¯POSTï¼Œæˆ‘å°†è¿”å›æœ‰å…³POSTè¯·æ±‚çš„æ¶ˆæ¯ã€‚ åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œæˆ‘è¿”å›ä¸€ä¸ªç©ºè¯·æ±‚ã€‚ <br><br>  <code>SimpleDispatcher</code>å‡ºç°åœ¨æµ‹è¯•ä¸­-æˆ‘å·²åœ¨ä¸Šé¢æè¿°äº†<code>SimpleDispatcher</code>ç±»çš„ä¸€ä¸ªå¯¹è±¡ã€‚ æ­¤å¤–ï¼Œå¦‚å‰é¢çš„ç¤ºä¾‹ä¸­æ‰€ç¤ºï¼Œæ¨¡æ‹ŸæœåŠ¡å™¨å·²å¯åŠ¨ï¼Œä»…åœ¨è¿™ä¸€æ¬¡æ‰æŒ‡ç¤ºä½¿ç”¨è¯¥æ¨¡æ‹ŸæœåŠ¡å™¨çš„ä¸€ç§è§„åˆ™-ç›¸åŒçš„è°ƒåº¦ç¨‹åºã€‚ <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨å­˜å‚¨åº“ä¸­</a>å¯ä»¥æ‰¾åˆ°å¸¦æœ‰<code>SimpleDispatcher</code>æµ‹è¯•æºã€‚ <br><br><h4> å…¶ä»–ParamsDispatcher </h4><br> è¦†ç›–<code>dispatch</code>åŠŸèƒ½ï¼Œæˆ‘å¯ä»¥ä»å…¶ä»–è¯·æ±‚å‚æ•°ä¸­æ¨é€æ¥å‘é€å“åº”ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OtherParamsDispatcher</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Dispatcher</span></span></span><span class="hljs-class">() </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispatch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request: RecordedRequest)</span></span></span><span class="hljs-function">: MockResponse </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> when { request.path.contains(<span class="hljs-string"><span class="hljs-string">"?queryKey=value"</span></span>) -&gt; MockResponse().setResponseCode(<span class="hljs-number"><span class="hljs-number">200</span></span>).setBody(<span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"{ "</span></span>message<span class="hljs-string"><span class="hljs-string">": "</span></span>It was a GET request with query parameter queryKey equals value<span class="hljs-string"><span class="hljs-string">" }"</span></span><span class="hljs-string"><span class="hljs-string">""</span></span>) request.body.toString().contains(<span class="hljs-string"><span class="hljs-string">"\"bodyKey\":\"value\""</span></span>) -&gt; MockResponse().setResponseCode(<span class="hljs-number"><span class="hljs-number">200</span></span>).setBody(<span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"{ "</span></span>message<span class="hljs-string"><span class="hljs-string">": "</span></span>It was a POST request with body parameter bodyKey equals value<span class="hljs-string"><span class="hljs-string">" }"</span></span><span class="hljs-string"><span class="hljs-string">""</span></span>) request.headers.toString().contains(<span class="hljs-string"><span class="hljs-string">"header: value"</span></span>) -&gt; MockResponse().setResponseCode(<span class="hljs-number"><span class="hljs-number">200</span></span>).setBody(<span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"{ "</span></span>message<span class="hljs-string"><span class="hljs-string">": "</span></span>It was some request with header equals value<span class="hljs-string"><span class="hljs-string">" }"</span></span><span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; MockResponse().setResponseCode(<span class="hljs-number"><span class="hljs-number">200</span></span>).setBody(<span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"{ Wrong response }"</span></span><span class="hljs-string"><span class="hljs-string">""</span></span>) } } }</code> </pre><br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘å°†é’ˆå¯¹æ¡ä»¶æ¼”ç¤ºå‡ ç§é€‰æ‹©ã€‚ <br><br> é¦–å…ˆï¼Œæ‚¨å¯ä»¥åœ¨åœ°å€æ ä¸­å°†å‚æ•°ä¼ é€’ç»™APIã€‚ å› æ­¤ï¼Œæˆ‘å¯ä»¥åœ¨æŸç§æ†ç»‘å½¢å¼çš„è·¯å¾„ä¸Šè®¾ç½®æ¡ä»¶ï¼Œä¾‹å¦‚<code>â€œ?queryKey=valueâ€</code> ã€‚ <br> å…¶æ¬¡ï¼Œè¯¥ç±»ä½¿æ‚¨å¯ä»¥è¿›å…¥POSTæˆ–PUTè¯·æ±‚çš„ä¸»ä½“å†…éƒ¨ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡å…ˆæ‰§è¡Œ<code>toString()</code>æ¥ä½¿ç”¨<code>contains</code> ã€‚ åœ¨æˆ‘çš„ç¤ºä¾‹ä¸­ï¼Œå½“åŒ…å«<code>â€œbodyKeyâ€:â€valueâ€</code>çš„POSTè¯·æ±‚<code>â€œbodyKeyâ€:â€valueâ€</code>æ—¶ï¼Œè§¦å‘æ¡ä»¶ã€‚ åŒæ ·ï¼Œæˆ‘å¯ä»¥éªŒè¯è¯·æ±‚<code>header : value</code> ï¼ˆ <code>header : value</code> ï¼‰ã€‚ <br><br> æœ‰å…³æµ‹è¯•ç¤ºä¾‹ï¼Œå»ºè®®æ‚¨å‚è€ƒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å­˜å‚¨åº“</a> ã€‚ <br><br><h4>  ListingDispatcher </h4><br> å¦‚æœ‰å¿…è¦ï¼Œå¯ä»¥å®ç°æ›´å¤æ‚çš„é€»è¾‘-ListingDispatcherã€‚ åŒæ ·ï¼Œæˆ‘è¦†ç›–äº†<code>dispatch</code>åŠŸèƒ½ã€‚ ä½†æ˜¯ï¼Œç°åœ¨åœ¨è¯¥ç±»ä¸­ï¼Œæˆ‘è®¾ç½®äº†é»˜è®¤çš„<code>stubsList</code>é›†ï¼ˆ <code>stubsList</code> ï¼‰ <code>stubsList</code>ç”¨äºä¸åŒçš„åœºåˆã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ListingDispatcher</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Dispatcher</span></span></span><span class="hljs-class">() </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stubsList: ArrayList&lt;RequestClass&gt; = defaultRequests() <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispatch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request: RecordedRequest)</span></span></span><span class="hljs-function">: MockResponse </span></span>= <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { stubsList.first { it.matcher(request.path, request.body.toString()) }.response() } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e: NoSuchElementException) { Log.e(<span class="hljs-string"><span class="hljs-string">"Unexisting request path ="</span></span>, request.path) MockResponse().setResponseCode(<span class="hljs-number"><span class="hljs-number">404</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">defaultRequests</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: ArrayList&lt;RequestClass&gt; </span></span>{ val allStubs = ArrayList&lt;RequestClass&gt;() allStubs.add(RequestClass(<span class="hljs-string"><span class="hljs-string">"/get"</span></span>, <span class="hljs-string"><span class="hljs-string">"queryParam=value"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"{ "</span></span>message<span class="hljs-string"><span class="hljs-string">" : "</span></span>Request url starts with /get url and contains queryParam=value<span class="hljs-string"><span class="hljs-string">" }"</span></span><span class="hljs-string"><span class="hljs-string">""</span></span>)) allStubs.add(RequestClass(<span class="hljs-string"><span class="hljs-string">"/post"</span></span>, <span class="hljs-string"><span class="hljs-string">"queryParam=value"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"{ "</span></span>message<span class="hljs-string"><span class="hljs-string">" : "</span></span>Request url starts with /post url and contains queryParam=value<span class="hljs-string"><span class="hljs-string">" }"</span></span><span class="hljs-string"><span class="hljs-string">""</span></span>)) allStubs.add(RequestClass(<span class="hljs-string"><span class="hljs-string">"/post"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"\"bodyParam\":\"value\""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"{ "</span></span>message<span class="hljs-string"><span class="hljs-string">" : "</span></span>Request url starts with /post url and body contains bodyParam:value<span class="hljs-string"><span class="hljs-string">" }"</span></span><span class="hljs-string"><span class="hljs-string">""</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> allStubs } <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">replaceMockStub</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(stub: RequestClass)</span></span></span><span class="hljs-function"> </span></span>{ val valuesToRemove = ArrayList&lt;RequestClass&gt;() stubsList.forEach { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (it.path.contains(stub.path)&amp;&amp;it.query.contains(stub.query)&amp;&amp;it.body.contains(stub.body)) valuesToRemove.add(it) } stubsList.removeAll(valuesToRemove) stubsList.add(stub) } <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addMockStub</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(stub: RequestClass)</span></span></span><span class="hljs-function"> </span></span>{ stubsList.add(stub) } }</code> </pre><br> ä¸ºæ­¤ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªå¼€æ”¾ç±»<code>RequestClass</code> ï¼Œé»˜è®¤æƒ…å†µä¸‹å…¶æ‰€æœ‰å­—æ®µå‡ä¸ºç©ºã€‚ å¯¹äºæ­¤ç±»ï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ª<code>response</code>å‡½æ•°ï¼Œè¯¥å‡½æ•°åˆ›å»ºä¸€ä¸ª<code>MockResponse</code>å¯¹è±¡ï¼ˆè¿”å›200å“åº”æˆ–å…¶ä»–ä¸€äº›<code>responseText</code> ï¼‰ï¼Œä»¥åŠä¸€ä¸ª<code>matcher</code>å‡½æ•°ï¼Œè¿”å›<code>true</code>æˆ–<code>false</code> ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">open class </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RequestClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(val path:String = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">, val query: String = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">, val body:String = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">, val responseText: String = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-function">open fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">response</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(code: Int = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">200</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">: MockResponse </span></span>= MockResponse() .setResponseCode(code) .setBody(responseText) <span class="hljs-function"><span class="hljs-function">open fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">matcher</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(apiCall: String, apiBody: String)</span></span></span><span class="hljs-function">: Boolean </span></span>= apiCall.startsWith(path)&amp;&amp;apiCall.contains(query)&amp;&amp;apiBody.contains(body) }</code> </pre><br> ç»“æœï¼Œæˆ‘å¯ä»¥ä¸ºå­˜æ ¹å»ºç«‹æ›´å¤æ‚çš„æ¡ä»¶ç»„åˆã€‚ å°½ç®¡å…¶åŸç†éå¸¸ç®€å•ï¼Œä½†åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™ç§è®¾è®¡æ›´ä¸ºçµæ´»ã€‚ <br><br> ä½†æœ€é‡è¦çš„æ˜¯ï¼Œå¦‚æœéœ€è¦åœ¨ä¸€ä¸ªæµ‹è¯•ä¸­æ›´æ”¹æ¨¡æ‹ŸæœåŠ¡å™¨çš„å“åº”ï¼Œæˆ‘å¯ä»¥éšæ—¶éšåœ°æ›¿æ¢ä¸€äº›å­˜æ ¹ã€‚ åœ¨æµ‹è¯•å¤§å‹é¡¹ç›®æ—¶ï¼Œä¾‹å¦‚ï¼Œåœ¨æ£€æŸ¥æŸäº›ç‰¹å®šæ–¹æ¡ˆæ—¶ï¼Œç»å¸¸ä¼šå‡ºç°æ­¤é—®é¢˜ã€‚ <br> æ›´æ¢å¯ä»¥å¦‚ä¸‹è¿›è¡Œï¼š <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">replaceMockStub</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(stub: RequestClass)</span></span></span><span class="hljs-function"> </span></span>{ val valuesToRemove = ArrayList&lt;RequestClass&gt;() stubsList.forEach { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (it.path.contains(stub.path)&amp;&amp;it.query.contains(stub.query)&amp;&amp;it.body.contains(stub.body)) valuesToRemove.add(it) } stubsList.removeAll(valuesToRemove) stubsList.add(stub) }</code> </pre><br> ä½¿ç”¨è°ƒåº¦ç¨‹åºçš„è¿™ç§å®ç°ï¼Œæµ‹è¯•å°†ä¿æŒç®€å•ã€‚ æˆ‘è¿˜å¯åŠ¨äº†æ¨¡æ‹ŸæœåŠ¡å™¨ï¼Œä»…é€‰æ‹©<code>ListingDispatcher</code> ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ListingDispatcherTest</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseTest</span></span></span><span class="hljs-class">() </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Rule</span></span> <span class="hljs-meta"><span class="hljs-meta">@JvmField</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mActivityRule: ActivityTestRule&lt;MainActivity&gt; = ActivityTestRule(MainActivity::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dispatcher</span></span></span><span class="hljs-class"> </span></span>= ListingDispatcher() <span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initMockServer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ val mockServer = MockWebServer() val ip = InetAddress.getByName(<span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>) val port = <span class="hljs-number"><span class="hljs-number">8080</span></span> mockServer.setDispatcher(dispatcher) mockServer.start(ip, port) } . . . }</code> </pre><br> ä¸ºäº†è¿›è¡Œå®éªŒï¼Œæˆ‘å°†å­˜æ ¹æ›¿æ¢ä¸ºPOSTï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postReplacedStubTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ val params: HashMap&lt;String, String&gt; = hashMapOf(<span class="hljs-string"><span class="hljs-string">"bodyParam"</span></span> to <span class="hljs-string"><span class="hljs-string">"value"</span></span>) replacePostStub() sendPostRequest(<span class="hljs-string"><span class="hljs-string">"http://localhost:8080/post"</span></span>, params = params) assertResponseMessage(<span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"{ "</span></span>message<span class="hljs-string"><span class="hljs-string">" : "</span></span>Post request stub has been replaced<span class="hljs-string"><span class="hljs-string">" }"</span></span><span class="hljs-string"><span class="hljs-string">""</span></span>) }</code> </pre><br> ä¸ºæ­¤ï¼Œè¯·ä»å¸¸è§„<code>dispatcher</code>è°ƒç”¨<code>replacePostStub</code>å‡½æ•°ï¼Œå¹¶æ·»åŠ æ–°çš„<code>response</code> ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">replacePostStub</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ dispatcher.replaceMockStub(RequestClass(<span class="hljs-string"><span class="hljs-string">"/post"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"\"bodyParam\":\"value\""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"{ "</span></span>message<span class="hljs-string"><span class="hljs-string">" : "</span></span>Post request stub has been replaced<span class="hljs-string"><span class="hljs-string">" }"</span></span><span class="hljs-string"><span class="hljs-string">""</span></span>)) }</code> </pre><br> åœ¨ä¸Šé¢çš„æµ‹è¯•ä¸­ï¼Œæˆ‘ç¡®è®¤å­˜æ ¹å·²è¢«æ›¿æ¢ã€‚ <br> ç„¶åï¼Œæˆ‘æ·»åŠ äº†ä¸€ä¸ªæ–°çš„å­˜æ ¹ï¼Œå®ƒä¸æ˜¯é»˜è®¤å€¼ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNewStubTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ addSomeStub() sendGetRequest(<span class="hljs-string"><span class="hljs-string">"http://localhost:8080/some_specific_url"</span></span>) assertResponseMessage(<span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"{ "</span></span>message<span class="hljs-string"><span class="hljs-string">" : "</span></span>U have got specific message<span class="hljs-string"><span class="hljs-string">" }"</span></span><span class="hljs-string"><span class="hljs-string">""</span></span>) }</code> </pre><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addSomeStub</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ dispatcher.addMockStub(RequestClass(<span class="hljs-string"><span class="hljs-string">"/some_specific_url"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"{ "</span></span>message<span class="hljs-string"><span class="hljs-string">" : "</span></span>U have got specific message<span class="hljs-string"><span class="hljs-string">" }"</span></span><span class="hljs-string"><span class="hljs-string">""</span></span>)) }</code> </pre><br><h3> è¯·æ±‚éªŒè¯è€… </h3><br> æœ€åä¸€ç§æƒ…å†µ-è¯·æ±‚éªŒè¯ç¨‹åº-ä¸æä¾›ç›‘å¬åŠŸèƒ½ï¼Œä½†ä¼šæ£€æŸ¥åº”ç”¨ç¨‹åºå‘é€çš„è¯·æ±‚ã€‚ ä¸ºæ­¤ï¼Œæˆ‘åªæ˜¯é€šè¿‡å®ç°è°ƒåº¦ç¨‹åºæ¥å¯åŠ¨æ¨¡æ‹ŸæœåŠ¡å™¨ï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºè‡³å°‘è¿”å›æŸäº›å†…å®¹ã€‚ <br> ä»æµ‹è¯•å‘é€è¯·æ±‚æ—¶ï¼Œå®ƒä¼šåˆ°è¾¾æ¨¡æ‹ŸæœåŠ¡å™¨ã€‚ é€šè¿‡å®ƒï¼Œæˆ‘å¯ä»¥ä½¿ç”¨<code>takeRequest()</code>è®¿é—®è¯·æ±‚å‚æ•°ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">requestVerifierTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ val params: HashMap&lt;String, String&gt; = hashMapOf(<span class="hljs-string"><span class="hljs-string">"bodyKey"</span></span> to <span class="hljs-string"><span class="hljs-string">"value"</span></span>) val headers: HashMap&lt;String, String&gt; = hashMapOf(<span class="hljs-string"><span class="hljs-string">"header"</span></span> to <span class="hljs-string"><span class="hljs-string">"value"</span></span>) sendPostRequest(<span class="hljs-string"><span class="hljs-string">"http://localhost:8080/post"</span></span>, headers = headers, params = params) val request = mockServer.takeRequest() assertEquals(<span class="hljs-string"><span class="hljs-string">"POST"</span></span>, request.method) assertEquals(<span class="hljs-string"><span class="hljs-string">"value"</span></span>, request.getHeader(<span class="hljs-string"><span class="hljs-string">"header"</span></span>)) assertTrue(request.body.toString().contains(<span class="hljs-string"><span class="hljs-string">"\"bodyKey\":\"value\""</span></span>)) assertTrue(request.path.startsWith(<span class="hljs-string"><span class="hljs-string">"/post"</span></span>)) }</code> </pre><br> ä¸Šé¢ï¼Œæˆ‘é€šè¿‡ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹æ˜¾ç¤ºäº†è¯¥æµ‹è¯•ã€‚ å®Œå…¨ç›¸åŒçš„æ–¹æ³•å¯ç”¨äºå¤æ‚çš„JSONï¼ŒåŒ…æ‹¬æ£€æŸ¥è¯·æ±‚çš„æ•´ä¸ªç»“æ„ï¼ˆæ‚¨å¯ä»¥åœ¨JSONçº§åˆ«è¿›è¡Œæ¯”è¾ƒæˆ–å°†JSONè§£æä¸ºå¯¹è±¡å¹¶åœ¨å¯¹è±¡çº§åˆ«æ£€æŸ¥æ˜¯å¦ç›¸ç­‰ï¼‰ã€‚ <br><br><h2> æ€»ç»“ </h2><br> é€šå¸¸ï¼Œæˆ‘å–œæ¬¢è¯¥å·¥å…·ï¼ˆokhttpmockwebserverï¼‰ï¼Œå¹¶åœ¨å¤§å‹é¡¹ç›®ä¸­ä½¿ç”¨å®ƒã€‚ å½“ç„¶ï¼Œæœ‰äº›å°äº‹æƒ…æˆ‘æƒ³æ”¹å˜ã€‚ <br> ä¾‹å¦‚ï¼Œæˆ‘ä¸å–œæ¬¢æ‚¨å¿…é¡»åœ¨åº”ç”¨ç¨‹åºçš„é…ç½®ä¸­æ•²å…¥æœ¬åœ°åœ°å€ï¼ˆåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ä¸ºlocalhostï¼š8080ï¼‰ã€‚ ä¹Ÿè®¸æˆ‘ä»ç„¶å¯ä»¥æ‰¾åˆ°ä¸€ç§é…ç½®æ‰€æœ‰å†…å®¹çš„æ–¹æ³•ï¼Œä»¥ä¾¿æ¨¡æ‹ŸæœåŠ¡å™¨åœ¨å°è¯•å‘ä»»ä½•åœ°å€å‘é€è¯·æ±‚æ—¶åšå‡ºå“åº”ã€‚ <br> å¦å¤–ï¼Œå¦‚æœæ¨¡æ‹ŸæœåŠ¡å™¨æ²¡æœ‰åˆé€‚çš„å­˜æ ¹ï¼Œåˆ™æˆ‘æ— æ³•é‡å®šå‘è¯·æ±‚-å½“æ¨¡æ‹ŸæœåŠ¡å™¨è¿›ä¸€æ­¥å‘é€è¯·æ±‚æ—¶ã€‚ æ­¤æ¨¡æ‹ŸæœåŠ¡å™¨ä¸­æ²¡æœ‰è¿™ç§æ–¹æ³•ã€‚ ä½†æ˜¯ï¼Œå®ƒç”šè‡³è¿˜æ²¡æœ‰å®ç°ï¼Œå› ä¸ºç›®å‰â€œæˆ˜æ–—â€é¡¹ç›®è¿˜æ²¡æœ‰è¿™æ ·çš„ä»»åŠ¡ã€‚ <br><br> æ–‡ç« ä½œè€…ï¼šRuslan Abdulin <br><br>  PSï¼šæˆ‘ä»¬åœ¨Runetçš„å¤šä¸ªç«™ç‚¹ä¸Šå‘è¡¨æ–‡ç« ã€‚ è®¢é˜…æˆ‘ä»¬åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">VK</a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">FB</a>æˆ–<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Telegramé¢‘é“</a>ä¸Šçš„é¡µé¢ï¼Œä»¥æŸ¥æ‰¾æœ‰å…³æˆ‘ä»¬æ‰€æœ‰å‡ºç‰ˆç‰©å’Œå…¶ä»–Maxilectæ–°é—»çš„ä¿¡æ¯ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN430530/">https://habr.com/ru/post/zh-CN430530/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN430520/index.html">å¼•å…¥Spring Data MongoDB</a></li>
<li><a href="../zh-CN430522/index.html">æ‚¨éœ€è¦ITçš„ä¼ä¸šæ–‡åŒ–å—ï¼Ÿ å…‹æ‹‰æ–¯è¯ºè¾¾å°”å·¥ä½œå®¤Plariumå“ç‰Œç»ç†çš„å‘Šç™½</a></li>
<li><a href="../zh-CN430524/index.html">ç¥ç»ç½‘ç»œæ¶æ„</a></li>
<li><a href="../zh-CN430526/index.html">è€è™æœºï¼šå®ƒä»¬æ¥è‡ªè‹è”å“ªé‡Œï¼Œå¦‚ä½•å¸ƒç½®ï¼Ÿ</a></li>
<li><a href="../zh-CN430528/index.html">ç”¨PyUSB 1.0ç¼–ç¨‹</a></li>
<li><a href="../zh-CN430532/index.html">iOSåº”ç”¨ç¨‹åºä¸­çš„å®‰å…¨æ€§</a></li>
<li><a href="../zh-CN430534/index.html">ä»¥DVR Trassir SDKä¸ºç¤ºä¾‹ä¸ºZabbixåˆ›å»ºæ¨¡æ¿</a></li>
<li><a href="../zh-CN430536/index.html">å°†çª—å£å‡½æ•°è®¾è®¡ä¸ºå…·æœ‰ç»™å®šé‡å çº§åˆ«çš„å•å…ƒ</a></li>
<li><a href="../zh-CN430538/index.html">æ‚¨æ˜¯å¦è¯»è¿‡Scaladocçš„â€œæ˜æ˜¾â€æ”¶é›†æ–¹æ³•ï¼Ÿ è¿˜æ˜¯ä¸ºä»€ä¹ˆæ‡’æƒ°å¹¶ä¸æ€»æ˜¯é‚£ä¹ˆå¥½</a></li>
<li><a href="../zh-CN430542/index.html">å…¬å¼€ç½‘ç»œç ”è®¨ä¼šâ€œåŸºç¡€è®¾æ–½å³ä»£ç â€</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>