<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö¥ üßëüèø‚Äçü§ù‚Äçüßëüèª ü§ï L'histoire d'un "d√©veloppeur" ou comment un nouveau venu pour √©crire une application pour iOS ü•© üë©‚Äç‚öïÔ∏è ‚ò†Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Alors, mai 2018. 7 tentatives ont √©t√© faites en 7 ans pour commencer √† programmer quelque chose pour iOS. Et √† chaque fois la m√™me chose: Objective-C ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>L'histoire d'un "d√©veloppeur" ou comment un nouveau venu pour √©crire une application pour iOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469387/"><img src="https://habrastorage.org/webt/oe/bp/os/oebpos7zdtlt8gx_bn3xaeeqct0.png"><br><br>  Alors, mai 2018.  7 tentatives ont √©t√© faites en 7 ans pour commencer √† programmer quelque chose pour iOS.  Et √† chaque fois la m√™me chose: Objective-C est quelque chose d'effrayant et d'incompr√©hensible, alors il n'y a aucune id√©e.  Et puis Hello World, une fois par an, en g√©n√©ral, les choses ne se sont pas pass√©es ... <br><br>  Cette fois, un nouveau Xcode et une nouvelle langue pour moi Swift ... Et une nouvelle id√©e, je veux pousser les notifications pour mon serveur Zabbix.  il n'y a pas de stock officiel, et il n'y avait pas de clients √† l'√©poque ... <br><br>  Avant cela, le bot a envoy√© les t√©l√©grammes √† la pouss√©e, mais il a commenc√© √† junk et Roskomnadzor est arriv√© √† temps ... Le blocage du chariot ne joue pas un r√¥le sp√©cial, car  il y a Mikrotik et il a √©t√© imm√©diatement ¬´r√©par√©¬ª. <br><br>  Il a √©t√© d√©cid√© d'√©crire une notification Zabbix, qui ne sera alors plus r√©serv√©e aux notifications. <br><a name="habracut"></a><br>  Il s'est av√©r√© que l'envoi de notifications ne fonctionnera pas.  Vous devez √©crire une application, l'installer, en prendre un jeton, √©lever votre serveur pour envoyer des notifications push ... <br><br>  L'exp√©rience de programmation √©tait uniquement en PHP.  Swift est diff√©rent, mais il ne semblait pas aussi intimidant qu'Objective-C √† l'√©poque.  Et Xcode lui-m√™me est bon en tant qu'IDE qui convertit le code de l'ancien en nouveau, fait des indices. <br><br>  Tout d'abord, des vid√©os de formation, l'apprentissage de l'API Zabbix elle-m√™me.  Mais ensuite, un article apr√®s l'autre, comment NSURLSession fonctionne, quels cadres existent. <br><br>  La premi√®re version ne pouvait se connecter qu'au serveur Zabbix et donner des d√©clencheurs et des h√¥tes.  Ajout de vues de graphiques, de valeurs, etc. <br><br>  Je m'attarderai sur certains points que j'ai rencontr√©s lors de la r√©daction de la candidature. <br><br><h2>  Cadres </h2><br>  Les cadres ne sont pas entr√©s.  Ils sont ¬´cool¬ª, confortables, mais je ne veux pas r√©parer le projet plus tard car quelque chose a chang√©.  Et c'est d√©j√† arriv√©.  Pour ma part, j'ai d√©cid√© de ne pas les utiliser, et il vaut mieux inventer mon v√©lo pour comprendre comment tout fonctionne.  Pour les requ√™tes JSON, il y a Alamofire, mais j'utilise la NSURLSession int√©gr√©e car  c'est assez pour tout. <br><br><h2>  Les tests </h2><br>  Plus d'un an s'est alors √©coul√©, quand j'ai d√©cid√© d'ajouter des tests :) <br>  Je pensais que cette chose fascinante sauverait le monde ... Mais ... J'ai √©crit plusieurs tests diff√©rents, je l'ai pouss√© ici ... Et la paresse est venue.  Je ne vois pas jusqu'ici de t√¢ches dans un si petit projet pour allouer autant de temps aux tests ... Et ce n'est que le temps pour les tests de code, sans parler des tests d'interface utilisateur. <br><br><img src="https://habrastorage.org/webt/o1/un/zo/o1unzoeht1dafvq0rfojui5fonk.png" alt="image"><br><h2>  Cryptage </h2><br>  Il y avait plusieurs points au chiffrement. <br><br>  Apple par leurs manuels veut que toutes les demandes soient crypt√©es.  Et c'est vrai.  Mais comme la pratique l'a montr√©, tout le monde ne voulait pas faire https pour leur Zabbix.  Au d√©but, je n'avais pas l'option (Param√®tres de s√©curit√© du transport d'application) permettant le trafic HTTP pur, pour lequel j'ai √©t√© crucifi√© dans les critiques de l'AppStore). Ensuite, je l'ai activ√© non sans aventure.  Xcode n'a pas per√ßu ma ligne jusqu'√† ce que je viens de recr√©er l'int√©gralit√© du fichier Info.plist. <br><br>  De plus, Apple veut tout savoir sur votre application, le trafic https habituel ne rel√®ve pas de cela.  Mais si vous souhaitez crypter quelque chose "de mani√®re d√©licate", veuillez en informer les autorit√©s am√©ricaines. <br><br><img src="https://habrastorage.org/webt/vo/ok/q5/vookq5vegfsrnnm6zvovrcmpwro.png" alt="image"><br><br>  Lors de la communication avec l'un des utilisateurs de l'application, il y a eu une demande de chiffrement de bout en bout des messages PUSH.  Le message doit √™tre crypt√© sur le serveur Zabbix et d√©crypt√© uniquement sur le t√©l√©phone.  Pour une telle chose, Apple a des notifications ¬´mutables¬ª.  C'est-√†-dire  si le ¬´contenu mutable¬ª est arriv√©, alors dans la pouss√©e vous devez changer quelque chose en fonction de ce que vous √©crivez.  Je l'ai fait d√©chiffrer le message. <br><br>  La politique d'Apple n'est pas contre l'utilisation de types de cryptage standard.  Voulez-vous quelque chose de vous-m√™me, comme je l'ai √©crit ci-dessus, donnez-moi un morceau de papier et pouvez-vous me montrer la cl√©? ... <br><br>  J'ai utilis√© la biblioth√®que CommonCrypto int√©gr√©e, c'est donc consid√©r√© comme le type de cryptage standard.  J'ai d√ª jouer avec le code, car  la plupart des exemples sont soit tr√®s obsol√®tes, soit Xcode a cri√© que ce n'√©tait pas s√ªr, n'avait rien pour travailler directement avec les octets et les donn√©es, ou s'est amus√© avec IV OpenSSL-a, le d√©calage n'√©tait pas correct, puis quelque chose d'autre ne fonctionnait pas.  En cons√©quence, il √©tait possible de cr√©er du code non jur√© et de fonctionner correctement avec OpenSSL lors du chiffrement des messages. <br><br><h2>  Court-circuits </h2><br>  Et le sujet le plus excitant pour moi ... Je ne pouvais pas √©crire de code asynchrone ....  Jusqu'√† pr√©sent, au moins, je n'ai pas bien compris comment ces fermetures fonctionnent. <br><br><img src="https://habrastorage.org/webt/9b/gk/ob/9bgkobrxhssqlmyif-lm7glk09u.png" alt="image"><br><br>  Par d√©faut, NSURLSession est juste asynchrone et je ne pouvais pas comprendre comment l'utiliser plus tard ... J'ai utilis√© DispatchSemaphore pour rendre le code synchrone ... Naturellement, les utilisateurs se sont plaints qu'il se bloque et se bloque ... <br><br>  Puis, tout de m√™me, j'ai compris ce qui fonctionnait dans le circuit et comment cela fonctionnait, quel d√©lai d'attente dans NSURLSession et quoi de quoi.  Le code a √©t√© compl√®tement remplac√© par des gestionnaires d'erreur normaux, ont √©t√© ajout√©s.  Et la vie est devenue meilleure, la vie est devenue plus amusante. <br><br><h2>  Disposition </h2><br><img src="https://habrastorage.org/webt/7t/my/fz/7tmyfzxt8je0azn4ygnesshmf0g.png"><br><br>  Oui, j'ai tout dans un Storyboard.  Je sais que ce n'est pas tr√®s, mais pour l'instant il y a peu d'√©crans.  Peut-√™tre que je le mettrai dans xibs plus tard. <br><br>  iOS 13 a apport√© des modifications aux affichages d'√©cran.  Auparavant, tous les nouveaux √©crans √©taient affich√©s en PUSH, c'est-√†-dire  plein √©cran.  Cet √©cran peut maintenant √™tre abaiss√© et il se fermera. <br><br>  En g√©n√©ral, il y avait un bogue si vous cliquez sur LogOut et vous pouvez simplement replier le formulaire de connexion.  Cela ne se produit que si le dernier Xcode est assembl√© 11. Il est corrig√© simplement en d√©finissant l'option d'affichage pour afficher uniquement en plein √©cran. <br><br>  Toujours dans iOS 13, SwiftUI est apparu, mais si vous refaites l'application maintenant, cela signifie oublier ceux qui utilisent l'application sur d'anciens appareils avec un ancien firmware ... <br><br><h2>  Disposition de l'AppStore </h2><br>  Bien que j'aie √©crit l'application moi-m√™me, j'ai d√©cid√© de la publier dans l'AppStore.  Il suffit de payer 100 $ par an et de l'√©taler.  La v√©rit√© est toujours de v√©rifier l'application, d'expliquer pourquoi cette application, etc. <br><br>  Parce que  application pour Zabbix, sur le logo, je voulais utiliser quelque chose qui dit √† propos de Zabbix.  Mais ce n'√©tait pas l√†.  J'ai √©crit une lettre √† Zabbix demandant qu'il soit possible d'utiliser la forme de la lettre Z ... Mais non.  Par cons√©quent, j'ai peint mon ic√¥ne, une courbe oblique, mais la mienne) <br><br><h2>  Finances </h2><br>  L'application a presque 2 ans.  J'ai d√©pens√© 200 $ juste pour avoir l'application dans l'AppStore.  En dehors du d√©veloppement et du serveur push. <br><br><img src="https://habrastorage.org/webt/pl/mi/vf/plmivfphkjfbv-f2wxo8gsjqamk.png" alt="image"><br>  L'application a une publicit√© de Google ... qui a rapport√© ... ... 5 $ <br>  La d√©sactivation de la publicit√© a rapport√© 88 $ ... Mais le seuil de retrait est de 150 $. <br>  Ensuite, je supprimerai les annonces en g√©n√©ral d√®s que j'atteindrai le seuil de retrait. <br><br><h2>  Serveur push </h2><br>  Oui, oui, tout a commenc√© pour lui ... Les notifications push sont demand√©es.  Une fois cela fait pour que vous puissiez crypter pushy, beaucoup sont pass√©s au cryptage. <br><br>  Il y a 2 serveurs, Moscou et les Pays-Bas √† 2 roubles / jour.  √âquilibrage DNS, Nginx c Let's Encrypt, script PHP pour la r√©ception et l'envoi. <br><br>  Au d√©part, il y avait un serveur gratuit sur Amazon (15 gig de trafic ...), mais comme son heure commen√ßait √† venir, j'ai achet√© un VPS-ku pour m'y installer.  Et j'ai trouv√© le moment o√π DDOS allait chez l'h√©bergeur et que vps n'√©tait pas disponible pendant 12 heures ... 2 roubles dont je veux plus.  Eh bien, j'√©tais encore sur Amazon et cela ne m'a pas encore affect√©.  Par cons√©quent, un autre a √©t√© pris pour 2 roubles par jour mais dans un endroit diff√©rent.  Au moins une certaine tol√©rance aux pannes et un trafic de 15 gigaoctets ... Les principales pr√©occupations pour le trafic Amazon, les micro ddos ‚Äã‚Äãet vous avez de l'argent. <br><br>  Je voulais utiliser Cloudflare en tant qu'√©quilibreur, mais ils veulent la d√©l√©gation de l'int√©gralit√© du domaine pour eux, et non sous le domaine. <br><br><h2>  Quelques statistiques </h2><br>  Pr√®s de 6 000 t√©l√©chargements au total.  Et le Br√©sil est dans le top ... qui aurait pens√©) <br><br><img src="https://habrastorage.org/webt/zn/sd/ef/znsdefftcax1rqoctbocrnt3dp8.png" alt="image"><br><br><h2>  Conclusions </h2><br><ul><li>  Swift n'est rien comme √ßa) </li><li>  L'abondance d'articles et la commodit√© de l'IDE dans le monde moderne vous permettent de prendre rapidement un premier d√©part. </li><li>  L'application a √©t√© r√©dig√©e initialement pour moi-m√™me, mais elle s'est av√©r√©e √™tre une bonne exp√©rience de d√©veloppement et de pr√©sentation dans l'AppStore avec des critiques positives et n√©gatives. </li><li>  Le d√©veloppement nettoie bien le cerveau. </li><li>  Il vaut mieux lire les quais et ne pas faire de synchrone √† partir de code asynchrone :) </li><li>  √âcrire, copier, √©tudier.  Ce n'est qu'ainsi que l'on peut comprendre dans la pratique ce qui est quoi. </li><li>  * Communiquez davantage avec les utilisateurs, ils diront certainement pourquoi ils en ont besoin et comment ils veulent le voir.  J'ai ajout√© un tiers des fonctionnalit√©s de l'application pr√©cis√©ment selon les souhaits des utilisateurs. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr469387/">https://habr.com/ru/post/fr469387/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr469373/index.html">Les r√©sultats du projet de cr√©ation d'une interface neuronale pour des patients compl√®tement paralys√©s remettent en cause</a></li>
<li><a href="../fr469375/index.html">Pourquoi Mozilla, Coil et Creative Commons allouent 100 millions de dollars pour des projets open source?</a></li>
<li><a href="../fr469379/index.html">Application des m√©thodes formelles de validation des mod√®les pour l'interface utilisateur</a></li>
<li><a href="../fr469381/index.html">Agones, cr√©ez un serveur de jeu multi-utilisateurs. Architecture et installation</a></li>
<li><a href="../fr469383/index.html">Solution hyperconverg√©e AERODISK vAIR. Base - Syst√®me de fichiers ARDFS</a></li>
<li><a href="../fr469389/index.html">Param√©trage par un r√©seau neuronal d'un mod√®le physique pour r√©soudre un probl√®me d'optimisation topologique</a></li>
<li><a href="../fr469391/index.html">Interfaces audio: le son comme source d'information sur la route, au bureau et dans le ciel</a></li>
<li><a href="../fr469393/index.html">R√©daction sur Flare-On 2019</a></li>
<li><a href="../fr469395/index.html">O√π et comment utiliser les multicolonnes (colonnes CSS)</a></li>
<li><a href="../fr469399/index.html">Wi-Fi au mus√©e-domaine Arkhangelskoye</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>