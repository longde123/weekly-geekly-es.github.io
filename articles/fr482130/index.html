<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê∏ ü•ò ü•ß Attribution √† grande √©chelle de droits aux utilisateurs de domaine de diff√©rentes for√™ts ü§ûüèø üèØ üë©üèª‚Äçüî¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apparemment, mon karma est le suivant: impl√©mentez des t√¢ches standard de toutes sortes de fa√ßons non triviales. Si quelqu'un a une vision diff√©rente ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Attribution √† grande √©chelle de droits aux utilisateurs de domaine de diff√©rentes for√™ts</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482130/">  Apparemment, mon karma est le suivant: impl√©mentez des t√¢ches standard de toutes sortes de fa√ßons non triviales.  Si quelqu'un a une vision diff√©rente du probl√®me - je demande une discussion pour r√©soudre le probl√®me. <br><br>  Un beau matin, une t√¢che int√©ressante est apparue: distribuer les droits aux groupes d'utilisateurs sur diff√©rentes billes contenant des sous-dossiers de projet avec des dossiers de documents.  Tout allait bien et un script a √©t√© attribu√© en attribuant des droits aux dossiers.  Et puis il s'est av√©r√© que les groupes devraient contenir des utilisateurs de diff√©rents domaines, de diff√©rentes for√™ts ( <a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D0%25B5%25D1%2580%25D0%25B0%25D1%2580%25D1%2585%25D0%25B8%25D1%258F_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582%25D0%25BE%25D0%25B2_Active_Directory">pour ceux qui ont oubli√© ce que c'est</a> ).  Supposons que la balle elle-m√™me soit h√©berg√©e sur un support Synology enregistr√© dans le domaine FB de la for√™t PSI.  Objectif: permettre aux utilisateurs de domaines d'une autre for√™t d'avoir acc√®s au contenu de cette boule, et de mani√®re tr√®s s√©lective. <br><a name="habracut"></a><br>  Les savoirs traditionnels se profilaient sous la forme suivante: <br><br><ul><li>  2 for√™ts: for√™t PSI, for√™t TG. <br><br><img src="https://habrastorage.org/webt/wm/mu/ky/wmmukygta6ggezns9okz4nypuqq.png" alt="image"></li><li>  Chaque for√™t a 3 domaines: PSI (ZG, PSI, FB);  TG (TG, HU, KC). </li><li>  Il existe une relation de confiance entre les for√™ts, Synology voit tous les groupes de s√©curit√© dans toutes les for√™ts. </li><li>  Les bulles et les dossiers / sous-dossiers doivent avoir des comptes d'administrateur de domaine FB avec des droits FullControl </li><li>  Les noms des dossiers de bulles doivent √™tre syst√©matis√©s.  La direction √©tait en train de n√©gocier les ID du projet. J'ai d√©cid√© d'attribuer le nom des groupes de s√©curit√© aux ID du projet. </li><li>  Les dossiers de projet dans les boules syst√®me doivent contenir une structure pr√©par√©e √† l'avance dans le fichier .xlsx, avec les privil√®ges d'acc√®s appropri√©s (R / RW / NA, o√π NA - pas d'acc√®s) <br><br><img src="https://habrastorage.org/webt/3a/py/vo/3apyvo-2q-qkg7td0pnw-rqpvdy.png" alt="image"></li><li>  Il devrait √™tre possible de restreindre les droits des utilisateurs / membres du groupe d'un projet √† certains r√©pertoires de ce projet uniquement.  L'utilisateur peut ne pas avoir acc√®s √† d'autres r√©pertoires / projets, selon l'appartenance au groupe. </li><li>  Lors de la cr√©ation d'un dossier de projet, les groupes dans les domaines correspondants avec les noms des ID de projet correspondants doivent √™tre cr√©√©s aussi automatiquement que possible. </li></ul><br><h4>  Notes aux TdR </h4><br><ul><li>  Les relations de confiance ne font pas partie des savoirs traditionnels </li><li>  L'ID du projet contient des chiffres et des lettres latines </li><li>  Les r√¥les d'utilisateur de projet pour tous les domaines ont des noms g√©n√©riques </li><li>  Un fichier .xlsx avec dossiers et autorisations (matrice d'acc√®s) est pr√©par√© avant le d√©marrage de l'ensemble du projet </li><li>  Lors de la mise en ≈ìuvre de projets, il est possible de cr√©er des groupes d'utilisateurs dans les domaines correspondants </li><li>  L'automatisation est obtenue en utilisant des outils d'administration MS Windows standard </li></ul><br><h4>  Mise en ≈ìuvre des savoirs traditionnels </h4><br>  Apr√®s la formalisation de ces exigences, une pause tactique a √©t√© prise pour tester les m√©thodes de cr√©ation de r√©pertoires et leur attribuer des droits.  Il √©tait cens√© utiliser uniquement PowerShell, afin de ne pas compliquer le projet.  Comme je l'ai √©crit plus t√¥t, l'algorithme de script semblait assez simple: <br><br><ul><li>  enregistrer les groupes avec le nom d√©riv√© de l'ID de projet (par exemple, KC40587) et les r√¥les correspondants sp√©cifi√©s dans la matrice d'acc√®s: KC40587-EN- pour l'ing√©nieur;  KC40587-PM - pour chef de produit, etc. </li><li>  obtenir les SID des groupes cr√©√©s </li><li>  enregistrer le dossier du projet et l'ensemble de r√©pertoires correspondant (la liste des sous-dossiers d√©pend des boules dans lesquelles il est cr√©√© et d√©fini dans la matrice d'acc√®s) </li><li>  attribuer des droits aux groupes selon la matrice d'acc√®s aux nouveaux sous-r√©pertoires du projet. </li></ul><br>  Difficult√©s rencontr√©es √† l'√©tape 1: <br><br><ul><li>  manque de compr√©hension de la fa√ßon de d√©finir la matrice d'acc√®s dans le script (un tableau multidimensionnel est maintenant impl√©ment√©, mais un moyen de le remplir est recherch√© en fonction du contenu du fichier .xlsx / de la matrice d'acc√®s) <br><br><img src="https://habrastorage.org/webt/bx/zq/rk/bxzqrkid29fvb3dt3qvykqlgb1i.png" alt="image"></li><li>  l'impossibilit√© de d√©finir les droits d'acc√®s dans les boules SMB sur les lecteurs de synchronisation √† l'aide de PoSH (https://social.technet.microsoft.com/Forums/en-US/3f1a949f-0919-46f1-9e10-89256cf07e65/error-using-setacl-on-nas -share? forum = winserverpowershell), √† cause duquel beaucoup de temps a √©t√© perdu et j'ai d√ª tout adapter aux scripts √† l'aide de l'utilitaire de modification des autorisations icacls, qui a n√©cessit√© la cr√©ation d'un entrep√¥t interm√©diaire de fichiers texte et cmd. </li></ul><br>  Dans le mode actuel, l'ex√©cution des fichiers cmd est contr√¥l√©e manuellement, du fait de la n√©cessit√© d'enregistrer un dossier pour le projet. <br><br><img src="https://habrastorage.org/webt/1p/zz/a4/1pzza4mxf3tssw6klg8elt8k_le.png" alt="image"><br><br>  Il s'est √©galement av√©r√© que le script devait √™tre ex√©cut√©, y compris pour l'enregistrement de groupes dans d'autres for√™ts (en utilisant le terme inter-domaines), et le rapport peut √™tre non seulement de 1 pour un, mais √©galement de 1 pour plusieurs. <br><br><img src="https://habrastorage.org/webt/0s/a0/bd/0sa0bd8melox5vdkjihq_fdudou.png" alt="image"><br><br>  Cela signifie que les groupes d'autres domaines crois√©s, y compris la for√™t voisine, peuvent d√©sormais revendiquer l'acc√®s aux ressources d'un domaine.  Pour atteindre l'uniformit√©, il a √©t√© d√©cid√© de cr√©er une structure sym√©trique dans l'UO de tous les domaines desservis de toutes les for√™ts (ovales verticaux noirs).  Comme on dit, dans l'arm√©e, tout doit √™tre moche, mais uniforme: <br><br><img src="https://habrastorage.org/webt/jd/yw/xm/jdywxmilhxenmbyiwjj7xerjfto.png" alt="image"><br><br>  Ainsi, lors de l'enregistrement du projet 80XXX dans le domaine TG, le script ex√©cute: <br><br>  1. Cr√©ation de l'unit√© d'organisation correspondante (ovales horizontaux rouges) dans ce domaine et inter-domaines, c'est-√†-dire les domaines dont les employ√©s doivent avoir acc√®s √† cette ressource. <br><br>  2. remplir l'unit√© d'organisation avec des groupes avec des noms de la forme &lt;domaine SRC_&gt; &lt;domaine DST&gt; &lt;projet_ID&gt; -, o√π: <br><br><ul><li>  Domaine SRC_ - un domaine crois√© dont les employ√©s auront acc√®s aux ressources du domaine DST </li><li>  DST_domain - domaine, aux ressources desquelles, en fait, l'acc√®s doit √™tre accord√©, c'est-√†-dire pour le bien duquel tout a √©t√© d√©marr√© </li><li>  &lt;ID_project&gt; - num√©ro de projet </li><li>  R√îLES - les noms des r√¥les r√©pertori√©s dans la matrice d'acc√®s. </li></ul><br>  3. lire le tableau SID de tous les groupes de tous les domaines impliqu√©s et l'enregistrer pour le transfert de donn√©es ult√©rieur dans un fichier qui d√©termine les droits sur un sous-dossier de projet sp√©cifique <br><br>  4. g√©n√©ration de fichiers source (param√®tre / restauration) avec un ensemble d'autorisations pour utiliser l'utilitaire icacKC dans le mode de fichier ex√©cutable "icacKC" \\ as-nasNN \ KC \ Projects "/ restaurer C: \ Temp \ KC \ KC40XX \ KC40XX.txt" <br><br>  5. cr√©er un fichier CMD qui combine tous les icacls lanc√©s pour tous les dossiers de projet <br><br><img src="https://habrastorage.org/webt/hr/ik/8d/hrik8d5grjq9t45vvgwua2krgic.png" alt="image"><br><br>  Comme il a √©t√© √©crit pr√©c√©demment, le fichier ex√©cutable est lanc√© manuellement et l'√©valuation des r√©sultats de l'ex√©cution est √©galement effectu√©e manuellement. <br><br>  Difficult√©s rencontr√©es au final: <br><br><ul><li>  si le dossier du projet est d√©j√† rempli d'un grand nombre de fichiers, l'√©laboration de la commande icacls sur les volumes disponibles peut prendre un temps consid√©rable et, dans certains cas, conduire √† un √©chec (par exemple, si les chemins d'acc√®s aux fichiers sont longs); </li><li>  en plus de l'option / restore, j'ai d√ª ajouter des lignes avec l'option / reset au cas o√π des dossiers n'auraient pas √©t√© cr√©√©s, mais auraient √©t√© transf√©r√©s √† partir de dossiers existants, avec des droits d'h√©ritage d√©sactiv√©s depuis la racine; </li><li>  une partie du script pour cr√©er des groupes devait √™tre ex√©cut√©e sur un dc arbitraire de chaque for√™t, le probl√®me concerne les comptes administratifs pour chaque arbre. </li></ul><br>  Conclusion g√©n√©rale: il est tr√®s √©trange qu'il n'y ait pas encore d'utilitaires avec des fonctionnalit√©s similaires sur le march√©.  Il semble possible de mettre en ≈ìuvre une telle fonctionnalit√© sur la base du portail Sharepoint. <br>  Il fournit √©galement un fait incompr√©hensible qu'il n'est pas possible d'utiliser les utilitaires PoSH pour d√©finir des autorisations sur un dossier sur des appareils de sinologie. <br><br>  √Ä volont√©, je suis pr√™t √† partager le script en cr√©ant une sorte de projet sur github, si cela int√©resse quelqu'un. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr482130/">https://habr.com/ru/post/fr482130/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr482108/index.html">Intelligence silencieuse. M√©thode d'identification des vuln√©rabilit√©s WEB potentielles</a></li>
<li><a href="../fr482110/index.html">Linux fonctionne sur ma carte de visite</a></li>
<li><a href="../fr482114/index.html">Envoyer des e-mails en utilisant asyncio et aiohttp √† partir d'une application Django</a></li>
<li><a href="../fr482126/index.html">Chronique de Keras pour TensorFlow</a></li>
<li><a href="../fr482128/index.html">gReebok d√©tect√©. Dermatov√©nologue lui-m√™me</a></li>
<li><a href="../fr482132/index.html">La copie de Tesla Cybertruck a √©t√© rep√©r√©e √† Moscou. Il s'agit d'un ... LADA russe Samara personnalis√©</a></li>
<li><a href="../fr482134/index.html">Comparaison des hybrides ou ce qui attend les propri√©taires des √©couteurs roumains Meze pour 84 990 et 239 990 roubles</a></li>
<li><a href="../fr482136/index.html">Comment un projet monomarque peut-il entrer dans le TOP en battant les agr√©gateurs et les services internes des moteurs de recherche?</a></li>
<li><a href="../fr482140/index.html">Jeux de soci√©t√© pour jeunes programmeurs de 4 √† 10 ans. Que trouve-t-on sur le march√© fin 2019</a></li>
<li><a href="../fr482142/index.html">23 minutes Justification de l'esprit lent</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>