<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐸 🥘 🥧 Attribution à grande échelle de droits aux utilisateurs de domaine de différentes forêts 🤞🏿 🏯 👩🏻‍🔬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apparemment, mon karma est le suivant: implémentez des tâches standard de toutes sortes de façons non triviales. Si quelqu'un a une vision différente ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Attribution à grande échelle de droits aux utilisateurs de domaine de différentes forêts</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482130/">  Apparemment, mon karma est le suivant: implémentez des tâches standard de toutes sortes de façons non triviales.  Si quelqu'un a une vision différente du problème - je demande une discussion pour résoudre le problème. <br><br>  Un beau matin, une tâche intéressante est apparue: distribuer les droits aux groupes d'utilisateurs sur différentes billes contenant des sous-dossiers de projet avec des dossiers de documents.  Tout allait bien et un script a été attribué en attribuant des droits aux dossiers.  Et puis il s'est avéré que les groupes devraient contenir des utilisateurs de différents domaines, de différentes forêts ( <a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D0%25B5%25D1%2580%25D0%25B0%25D1%2580%25D1%2585%25D0%25B8%25D1%258F_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582%25D0%25BE%25D0%25B2_Active_Directory">pour ceux qui ont oublié ce que c'est</a> ).  Supposons que la balle elle-même soit hébergée sur un support Synology enregistré dans le domaine FB de la forêt PSI.  Objectif: permettre aux utilisateurs de domaines d'une autre forêt d'avoir accès au contenu de cette boule, et de manière très sélective. <br><a name="habracut"></a><br>  Les savoirs traditionnels se profilaient sous la forme suivante: <br><br><ul><li>  2 forêts: forêt PSI, forêt TG. <br><br><img src="https://habrastorage.org/webt/wm/mu/ky/wmmukygta6ggezns9okz4nypuqq.png" alt="image"></li><li>  Chaque forêt a 3 domaines: PSI (ZG, PSI, FB);  TG (TG, HU, KC). </li><li>  Il existe une relation de confiance entre les forêts, Synology voit tous les groupes de sécurité dans toutes les forêts. </li><li>  Les bulles et les dossiers / sous-dossiers doivent avoir des comptes d'administrateur de domaine FB avec des droits FullControl </li><li>  Les noms des dossiers de bulles doivent être systématisés.  La direction était en train de négocier les ID du projet. J'ai décidé d'attribuer le nom des groupes de sécurité aux ID du projet. </li><li>  Les dossiers de projet dans les boules système doivent contenir une structure préparée à l'avance dans le fichier .xlsx, avec les privilèges d'accès appropriés (R / RW / NA, où NA - pas d'accès) <br><br><img src="https://habrastorage.org/webt/3a/py/vo/3apyvo-2q-qkg7td0pnw-rqpvdy.png" alt="image"></li><li>  Il devrait être possible de restreindre les droits des utilisateurs / membres du groupe d'un projet à certains répertoires de ce projet uniquement.  L'utilisateur peut ne pas avoir accès à d'autres répertoires / projets, selon l'appartenance au groupe. </li><li>  Lors de la création d'un dossier de projet, les groupes dans les domaines correspondants avec les noms des ID de projet correspondants doivent être créés aussi automatiquement que possible. </li></ul><br><h4>  Notes aux TdR </h4><br><ul><li>  Les relations de confiance ne font pas partie des savoirs traditionnels </li><li>  L'ID du projet contient des chiffres et des lettres latines </li><li>  Les rôles d'utilisateur de projet pour tous les domaines ont des noms génériques </li><li>  Un fichier .xlsx avec dossiers et autorisations (matrice d'accès) est préparé avant le démarrage de l'ensemble du projet </li><li>  Lors de la mise en œuvre de projets, il est possible de créer des groupes d'utilisateurs dans les domaines correspondants </li><li>  L'automatisation est obtenue en utilisant des outils d'administration MS Windows standard </li></ul><br><h4>  Mise en œuvre des savoirs traditionnels </h4><br>  Après la formalisation de ces exigences, une pause tactique a été prise pour tester les méthodes de création de répertoires et leur attribuer des droits.  Il était censé utiliser uniquement PowerShell, afin de ne pas compliquer le projet.  Comme je l'ai écrit plus tôt, l'algorithme de script semblait assez simple: <br><br><ul><li>  enregistrer les groupes avec le nom dérivé de l'ID de projet (par exemple, KC40587) et les rôles correspondants spécifiés dans la matrice d'accès: KC40587-EN- pour l'ingénieur;  KC40587-PM - pour chef de produit, etc. </li><li>  obtenir les SID des groupes créés </li><li>  enregistrer le dossier du projet et l'ensemble de répertoires correspondant (la liste des sous-dossiers dépend des boules dans lesquelles il est créé et défini dans la matrice d'accès) </li><li>  attribuer des droits aux groupes selon la matrice d'accès aux nouveaux sous-répertoires du projet. </li></ul><br>  Difficultés rencontrées à l'étape 1: <br><br><ul><li>  manque de compréhension de la façon de définir la matrice d'accès dans le script (un tableau multidimensionnel est maintenant implémenté, mais un moyen de le remplir est recherché en fonction du contenu du fichier .xlsx / de la matrice d'accès) <br><br><img src="https://habrastorage.org/webt/bx/zq/rk/bxzqrkid29fvb3dt3qvykqlgb1i.png" alt="image"></li><li>  l'impossibilité de définir les droits d'accès dans les boules SMB sur les lecteurs de synchronisation à l'aide de PoSH (https://social.technet.microsoft.com/Forums/en-US/3f1a949f-0919-46f1-9e10-89256cf07e65/error-using-setacl-on-nas -share? forum = winserverpowershell), à cause duquel beaucoup de temps a été perdu et j'ai dû tout adapter aux scripts à l'aide de l'utilitaire de modification des autorisations icacls, qui a nécessité la création d'un entrepôt intermédiaire de fichiers texte et cmd. </li></ul><br>  Dans le mode actuel, l'exécution des fichiers cmd est contrôlée manuellement, du fait de la nécessité d'enregistrer un dossier pour le projet. <br><br><img src="https://habrastorage.org/webt/1p/zz/a4/1pzza4mxf3tssw6klg8elt8k_le.png" alt="image"><br><br>  Il s'est également avéré que le script devait être exécuté, y compris pour l'enregistrement de groupes dans d'autres forêts (en utilisant le terme inter-domaines), et le rapport peut être non seulement de 1 pour un, mais également de 1 pour plusieurs. <br><br><img src="https://habrastorage.org/webt/0s/a0/bd/0sa0bd8melox5vdkjihq_fdudou.png" alt="image"><br><br>  Cela signifie que les groupes d'autres domaines croisés, y compris la forêt voisine, peuvent désormais revendiquer l'accès aux ressources d'un domaine.  Pour atteindre l'uniformité, il a été décidé de créer une structure symétrique dans l'UO de tous les domaines desservis de toutes les forêts (ovales verticaux noirs).  Comme on dit, dans l'armée, tout doit être moche, mais uniforme: <br><br><img src="https://habrastorage.org/webt/jd/yw/xm/jdywxmilhxenmbyiwjj7xerjfto.png" alt="image"><br><br>  Ainsi, lors de l'enregistrement du projet 80XXX dans le domaine TG, le script exécute: <br><br>  1. Création de l'unité d'organisation correspondante (ovales horizontaux rouges) dans ce domaine et inter-domaines, c'est-à-dire les domaines dont les employés doivent avoir accès à cette ressource. <br><br>  2. remplir l'unité d'organisation avec des groupes avec des noms de la forme &lt;domaine SRC_&gt; &lt;domaine DST&gt; &lt;projet_ID&gt; -, où: <br><br><ul><li>  Domaine SRC_ - un domaine croisé dont les employés auront accès aux ressources du domaine DST </li><li>  DST_domain - domaine, aux ressources desquelles, en fait, l'accès doit être accordé, c'est-à-dire pour le bien duquel tout a été démarré </li><li>  &lt;ID_project&gt; - numéro de projet </li><li>  RÔLES - les noms des rôles répertoriés dans la matrice d'accès. </li></ul><br>  3. lire le tableau SID de tous les groupes de tous les domaines impliqués et l'enregistrer pour le transfert de données ultérieur dans un fichier qui détermine les droits sur un sous-dossier de projet spécifique <br><br>  4. génération de fichiers source (paramètre / restauration) avec un ensemble d'autorisations pour utiliser l'utilitaire icacKC dans le mode de fichier exécutable "icacKC" \\ as-nasNN \ KC \ Projects "/ restaurer C: \ Temp \ KC \ KC40XX \ KC40XX.txt" <br><br>  5. créer un fichier CMD qui combine tous les icacls lancés pour tous les dossiers de projet <br><br><img src="https://habrastorage.org/webt/hr/ik/8d/hrik8d5grjq9t45vvgwua2krgic.png" alt="image"><br><br>  Comme il a été écrit précédemment, le fichier exécutable est lancé manuellement et l'évaluation des résultats de l'exécution est également effectuée manuellement. <br><br>  Difficultés rencontrées au final: <br><br><ul><li>  si le dossier du projet est déjà rempli d'un grand nombre de fichiers, l'élaboration de la commande icacls sur les volumes disponibles peut prendre un temps considérable et, dans certains cas, conduire à un échec (par exemple, si les chemins d'accès aux fichiers sont longs); </li><li>  en plus de l'option / restore, j'ai dû ajouter des lignes avec l'option / reset au cas où des dossiers n'auraient pas été créés, mais auraient été transférés à partir de dossiers existants, avec des droits d'héritage désactivés depuis la racine; </li><li>  une partie du script pour créer des groupes devait être exécutée sur un dc arbitraire de chaque forêt, le problème concerne les comptes administratifs pour chaque arbre. </li></ul><br>  Conclusion générale: il est très étrange qu'il n'y ait pas encore d'utilitaires avec des fonctionnalités similaires sur le marché.  Il semble possible de mettre en œuvre une telle fonctionnalité sur la base du portail Sharepoint. <br>  Il fournit également un fait incompréhensible qu'il n'est pas possible d'utiliser les utilitaires PoSH pour définir des autorisations sur un dossier sur des appareils de sinologie. <br><br>  À volonté, je suis prêt à partager le script en créant une sorte de projet sur github, si cela intéresse quelqu'un. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr482130/">https://habr.com/ru/post/fr482130/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr482108/index.html">Intelligence silencieuse. Méthode d'identification des vulnérabilités WEB potentielles</a></li>
<li><a href="../fr482110/index.html">Linux fonctionne sur ma carte de visite</a></li>
<li><a href="../fr482114/index.html">Envoyer des e-mails en utilisant asyncio et aiohttp à partir d'une application Django</a></li>
<li><a href="../fr482126/index.html">Chronique de Keras pour TensorFlow</a></li>
<li><a href="../fr482128/index.html">gReebok détecté. Dermatovénologue lui-même</a></li>
<li><a href="../fr482132/index.html">La copie de Tesla Cybertruck a été repérée à Moscou. Il s'agit d'un ... LADA russe Samara personnalisé</a></li>
<li><a href="../fr482134/index.html">Comparaison des hybrides ou ce qui attend les propriétaires des écouteurs roumains Meze pour 84 990 et 239 990 roubles</a></li>
<li><a href="../fr482136/index.html">Comment un projet monomarque peut-il entrer dans le TOP en battant les agrégateurs et les services internes des moteurs de recherche?</a></li>
<li><a href="../fr482140/index.html">Jeux de société pour jeunes programmeurs de 4 à 10 ans. Que trouve-t-on sur le marché fin 2019</a></li>
<li><a href="../fr482142/index.html">23 minutes Justification de l'esprit lent</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>