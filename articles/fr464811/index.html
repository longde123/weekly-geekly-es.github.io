<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé≤ ü¶ç ‚è∏Ô∏è Apple Music pour le d√©veloppeur üë©üèª üôÉ ü•à</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mots introductifs 


 Peu importe √† quel point ils r√©primandent Apple pour la nature ferm√©e de la plate-forme et de l'√©cosyst√®me lui-m√™me, certaines d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apple Music pour le d√©veloppeur</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464811/"><h2 id="vvodnye-slova">  Mots introductifs </h2><br><p>  Peu importe √† quel point ils r√©primandent Apple pour la nature ferm√©e de la plate-forme et de l'√©cosyst√®me lui-m√™me, certaines de leurs solutions font exception.  Il existe de nombreux services de streaming sur le march√©, mais la fourniture d'un SDK √† part enti√®re pour le streaming dans des produits tiers est extr√™mement petite, pour le march√© russe, la liste des SDK officiellement disponibles est limit√©e √† Deezer et Apple Music.  Bien s√ªr, lorsque Spotify arrivera sur notre march√©, il y aura plus de SDK disponibles, mais jusqu'√† pr√©sent, il y a deux joueurs et un seul a une large base d'utilisateurs. </p><br><p> Il se trouve que j'ai eu de l'exp√©rience avec le SDK Deezer pour Android et en ce moment je travaille activement avec le SDK Apple Music ( <em>MusicKit</em> ) pour iOS.  Et la principale diff√©rence avec l'exp√©rience avec Deezer est que MusicKit est la pointe de l'iceberg, c'est aussi une API accessible au public.  Contrairement √† Deezer, o√π r√©p√©ter la plupart des fonctionnalit√©s de l'application officielle n'est qu'un long processus, il est impossible de r√©p√©ter m√™me la page Web d'Apple Music en utilisant uniquement l'API publique.  M√™me si Apple utilise MusicKit dans ses solutions, en plus de cela, il utilise beaucoup de demandes d'API non document√©es et d'API priv√©es qui ne sont pas autoris√©es √† √™tre utilis√©es par les mortels. </p><br><p>  Dans l'article, je parlerai de travailler avec MusicKit du point de vue du d√©veloppeur dans le contexte de la mise en ≈ìuvre de ¬´ <em>t√¢ches</em> assez <em>simples</em> ¬ª: recherchez dans le catalogue, montrez des images dans les r√©sultats de la recherche, obtenez des chansons, des recommandations et m√™me jouez une sorte de musique.  Pour l'avenir, je dirai qu'une grande partie de ce qui pr√©c√®de sera vraie pour travailler avec Apple Music dans Android et Javascript. </p><br><p>  Si n√©cessaire, je suis pr√™t √† donner des r√©ponses d√©taill√©es avec un code de questions dans les commentaires. </p><a name="habracut"></a><br><h2 id="otdelim-muh-ot-kotlet">  S√©parez les mouches des c√¥telettes </h2><br><p>  Lorsque vous travaillez avec MusicKit sous iOS, vous devrez interagir avec les entit√©s suivantes: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">StoreKit</a> pour autorisation dans Apple Music et offre un abonnement au service ( <em>r√©f√©rence si vous pouvez vous abonner au programme d'affiliation</em> ) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">API HTTP</a> pour rechercher et r√©cup√©rer diverses informations d'un r√©pertoire </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">API</a> de recherche iTunes pour rechercher dans le r√©pertoire iTunes (une <em>alternative tr√®s utile √† l'API HTTP</em> ).  Apple indique une limite d'un maximum de 20 requ√™tes par minute, ce qui est souvent suffisant pour effectuer des requ√™tes depuis les appareils des utilisateurs </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lecteur multim√©dia</a> pour lire et g√©rer la file d'attente </li></ul><br><p>  De plus, lorsque vous vous connectez √† un programme d'affiliation, vous pouvez demander l'acc√®s au vidage de m√©tadonn√©es du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">flux de partenaires d'entreprise</a> , qu'Apple recommande d'utiliser au lieu de demandes fr√©quentes √† l'API iTunes Search. </p><br><p>  Et juste au cas o√π, Music.app est l'application Music sur les appareils iOS, qui est le lecteur officiel Apple Music. </p><br><p>  Sources d'information, par ordre d√©croissant de leur utilit√©: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Documentation officielle</a> </li><li>  Rechercher dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">toute la documentation</a> Apple </li><li>  M√©thode d'exp√©rimentation scientifique <sup>1</sup> avec API HTTP </li><li>  Developer Console dans votre navigateur pr√©f√©r√©, √©pingl√© sur la page Web de l'entit√© d'int√©r√™t dans Apple Music </li><li>  Forums des d√©veloppeurs Apple </li><li>  Stackoverflow </li></ul><br><h2 id="poisk-kartinki">  Cherchez.  Les photos </h2><br><p> Le moyen le plus √©vident de v√©rifier si quelque chose peut √™tre fait dans votre application est le fait que quelque chose comme √ßa est disponible dans l'application officielle.  Ici, nous prenons, par exemple, une recherche.  Nous recherchons le groupe "The Police" et dans <code>Music.app</code> nous avons une photo du groupe avec un Sting souriant: </p><br><img alt="fouille polici√®re" src="https://habrastorage.org/webt/wn/jo/31/wnjo31ts3vxptbekvmhgdmxttqq.png" width="200"><br><p>  Tr√®s bien, nous utiliserons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">l'API de recherche</a> .  En cours d'√©mission, nous avons la cl√© de l' <code>artwork</code> avec un lien <code>url</code> int√©gr√© pour tout sauf les artistes.  C‚Äôest √©trange.  V√©rifiez √† nouveau, dans Music.app, tout est l√†.  De plus, l'interface Web poss√®de √©galement une photographie et un lien vers la page Web est disponible dans l'API du moteur de recherche json. </p><br><p>  L'API de recherche iTunes ne <code>artistLinkUrl</code> pas non plus <code>artistLinkUrl</code> image, mais elle inclut √©galement l'adresse de la page Web avec la cl√© <code>artistLinkUrl</code> dans la <code>artistLinkUrl</code> . </p><br><p>  Eh bien, que faire, vous devez t√©l√©charger la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">page Web</a> et en obtenir l'adresse de l'image, heureusement, les d√©veloppeurs ont pris soin et enregistr√© l'adresse de l'image dans les m√©ta-informations: </p><br><pre> <code class="plaintext hljs">&lt;meta property="og:image" content="https://is5-ssl.mzstatic.com/image/thumb/Features113/v4/bb/a2/66/bba266dd-570b-bff7-d7c6-777982582964/mzl.tdrwskof.jpg/1200x630cw.png" id="ember52310559" class="ember-view"&gt;</code> </pre> <br><p>  Formellement, nous avons d√©j√† viol√© les r√®gles d'Apple qui interdisent de ¬´gratter¬ª leurs pages Web.  En fait, toutes les applications tierces le font, sauf celles qui recherchent des images √† l'aide de services tiers. </p><br><p>  Il y a un autre inconv√©nient: nous demandons une page de plusieurs centaines de kilo-octets.  Pour une application qui g√®re d√©j√† de grandes quantit√©s de donn√©es ( <em>lecture de musique</em> ), c'est tol√©rable ( <em>surtout si l'on consid√®re que les donn√©es sont transmises sous forme compress√©e</em> ), mais dans le cas g√©n√©ral ce n'est pas tr√®s. </p><br><p>  La taille des images peut √™tre ajust√©e √† vos besoins: dans l' <code>url</code> il y a des mod√®les √† remplacer ( <code>{w}</code> , <code>{h}</code> ), et sur la page Web le lien vers l'image a le m√™me format, donc il n'y a aucune difficult√© √† obtenir l'image de la bonne taille.  Si vous voulez obtenir une image arrondie, vous devez ajouter <code>cw</code> avant l'extension. </p><br><h3 id="bonus-pro-kartinki-dlya-otobrazheniya-v-pleere">  Bonus sur les images √† afficher dans le lecteur </h3><br><p>  Pendant la lecture, le lecteur de <code>Media Player</code> fonctionne sur la construction <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>MPMediaItem</code></a> , qui, en particulier, fournit un objet <code>Artwork</code> .  Il est tr√®s pratique pour afficher une image d'une piste dans le lecteur.  Le seul probl√®me est que dans la pratique, cet objet, quoi qu'on puisse dire, ne donne pas d'images pour la musique en streaming ( <em>qui est n'importe quelle musique d'Apple Music</em> ), donc vous devez "lire" le <code>MPMediaItem</code> lecture avec des chansons qui ont √©t√© ajout√©es √† la file d'attente et t√©l√©charg√©es l'image est similaire aux albums. </p><br><h2 id="poisk-po-zhanram">  Recherche par genre </h2><br><p>  ITunes et l'application Apple Music contiennent des listes de genres et de meilleures chansons.  Trouver un genre ne devrait pas √™tre difficile, car on peut chercher n'importe quoi? </p><br><p>  C'est loin d'√™tre le cas.  L'API ne recherche pas par genre et ne fournit pas de liste de genres.  Il est possible de demander des informations ( <em>de l'utile - nom</em> ) d'un genre par son identifiant, <br>  mais la plupart des informations de l'API ne contiennent que le nom du genre, pas l'identifiant. </p><br><p>  L'avantage pour iTunes est le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©chargement de tous les genres</a> ( <em>tous, y compris les "genres" des applications mobiles</em> ).  Les identifiants de genres ( <em>comme les autres identifiants d'iTunes</em> ) correspondent enti√®rement aux identifiants d'Apple Music.  Le d√©chargement est disponible pour toutes les r√©gions (la <em>r√©gion est indiqu√©e dans la cl√© <code>cc</code> , pas la <code>storefront</code> comme dans l'API Apple Music</em> ), mais en fait seuls les noms diff√®rent ( <em>ils sont traduits</em> ).  La structure des genres est hi√©rarchique et il y a des r√©p√©titions des noms de genres. </p><br><p>  En g√©n√©ral, une recherche par genre doit √™tre effectu√©e localement, et gardez √† l'esprit que le funk jazz, le jazz funk et le jazz funk sont une seule et m√™me chose.  Pas difficile, mais pas aussi simple que de demander √† l'API de recherche de rechercher par genre. </p><br><p>  Apr√®s avoir trouv√© un genre, vous pouvez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">demander un tableau</a> (une <em>liste des chansons les plus populaires</em> ) pour ce genre.  Pour les genres rares, il est tout √† fait possible d'obtenir dans la sortie de seulement 3 chansons. </p><br><p>  Fait amusant: pour certains albums et artistes ( <em>Ed Sheeran du c√©l√®bre</em> ), un seul des genres indique simplement le genre de haut niveau de "Music".  Si vous souhaitez faire des recommandations bas√©es sur les genres, ce genre doit √™tre ignor√©. </p><br><h2 id="pesni-artistov">  Chansons d'artistes </h2><br><p>  Lorsqu'une application doit jouer des chansons d'un artiste ( <em>groupe musical</em> ) le plus souvent, cela signifie qu'il est n√©cessaire de jouer <em>des</em> chansons <em>populaires</em> de ce groupe.  Apple Music permet de demander des chansons en tant que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien</a> "chansons" <sup>2</sup> pour l'artiste.  La sortie a un maximum de 20 chansons <sup>3</sup> , clairement tri√©es par popularit√©. </p><br><p>  Parfois, vous voulez toujours obtenir un peu plus de chansons.  Avec les groupes tr√®s populaires, il existe une option pour obtenir des listes de lecture comme " <em>[Nom de l'artiste]:</em> <em>Essentials</em> " et " <em>[Nom de l'artiste]: D√©tails</em> " (" <em>[Nom de l'artiste]: √âtapes suivantes</em> "), mais en g√©n√©ral, cette option ne convient pas.  Autre option: prendre 20 chansons populaires et terminer le reste des albums, l'avantage d'Apple Music permet d'obtenir imm√©diatement tous les albums d'artistes ( <em>liens comme des <code>albums</code></em> ) et toutes les chansons qu'ils <code>include="tracks"</code> ( <code>include="tracks"</code> ) en une seule demande. </p><br><p>  Mais si vous obtenez toutes les chansons de l'artiste, un autre probl√®me se pose: vous devez s√©lectionner les chansons populaires parmi toutes ces chansons.  Malheureusement, l'API d'informations de popularit√© ne fournit pas <sup>4</sup> .  Vous pouvez prendre des chansons au hasard dans toute la liste, mais dans la pratique, cette approche conduit √† jouer fr√©quemment des enregistrements compl√®tement inint√©ressants ( <em>transcriptions en direct, enregistrements de r√©p√©tition, ermitages, etc.</em> ), ce qui est particuli√®rement visible dans les groupes tr√®s populaires <sup>5</sup> . </p><br><p>  Essayons d'obtenir des chansons populaires d'une mani√®re diff√©rente.  M√™me avant l'av√®nement de MusicKit, Apple a commenc√© √† fournir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des API de recherche</a> dans l'iTunes Store.  Comme d√©j√† mentionn√©, le catalogue de l'Apple Music et de l'iTunes Store sont les m√™mes <sup>6</sup> et, en cons√©quence, les identifiants des chansons sont √©galement les m√™mes.  Cette API renvoie 50 chansons par d√©faut, mais vous pouvez demander jusqu'√† 200 chansons.  Les r√©sultats sont √©galement tri√©s par popularit√©. </p><br><p>  Fait int√©ressant, Apple lui-m√™me n'utilise aucune de ces options dans sa propre interface Web.  Ils utilisent l'API <sup>7</sup> non document√©e (en <em>lecture, priv√©e</em> ), dans laquelle il y a tout ce qui manque, y compris l'identifiant ( <em>et pas seulement le nom</em> ) du genre et l'indice de popularit√©.  Je n'ai pas os√© utiliser cette API dans la pratique <sup>8</sup> , car les identifiants de genre peuvent √™tre obtenus par recherche invers√©e par noms de genre <sup>9</sup> , et l'indice de popularit√© num√©rique n'est pas si important lorsque vous obtenez une liste de chansons tri√©es par popularit√©. </p><br><p>  Le fait amusant que j'appelle le ¬´ <em>probl√®me de Hugh Laurie</em> ¬ª est que le catalogue Apple Music contient des tonnes de contenu non musical.  En particulier, diverses compilations d'√©missions de com√©die et de stand-up.  C'est bien d'une part ( <em>nous avons pay√© pour la musique, mais nous avons √©galement eu des dialogues amusants avec Stephen Fry que vous pouvez √©couter avant d'aller au lit</em> ), et d'autre part, cela conduit √† une sorte de bavardage lorsqu'on lui demande d'activer la musique.  En cons√©quence, lorsque le contexte de fonctionnement de l'application indique directement que l'utilisateur souhaite √©couter de la musique, il faut supprimer ind√©pendamment de la liste des ¬´ <em>chansons</em> ¬ª celles dont les genres sont d√©sign√©s comme ¬´ <em>parole parl√©e</em> ¬ª et ¬´ <em>com√©die</em> ¬ª. </p><br><h2 id="rekomendacii">  Recommandations </h2><br><p>  Les recommandations de lecture (ce sont aussi des ¬´ <em>chansons similaires</em> ¬ª, des ¬´ <em>stations de radio</em> ¬ª, ¬´ <em>vous l'aimerez</em> ¬ª, etc.) sont devenues la fonctionnalit√© de base des lecteurs de streaming.  Classiquement, les recommandations peuvent √™tre divis√©es en deux types <sup>10</sup> : pour l'utilisateur ( <em>bas√© sur l'historique d'√©coute, les achats et les likes</em> ) et pour l'objet musical ( <em>artiste, titre, moins souvent album et playlist</em> ). </p><br><p>  Avec les pr√©f√©rences de l'utilisateur dans Apple Music, officiellement, tout va bien: vous pouvez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">demander une liste de</a> recommandations personnelles, qui comprend des ¬´ <em>mixages personnels</em> ¬ª ( <em>listes de lecture</em> ) et des albums recommand√©s.  √Ä partir d'albums, une liste de chansons peut √™tre obtenue en utilisant les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>API   ( tracks</code> )</a> , pour les listes de lecture de la m√™me mani√®re.  Gardez √† l'esprit que les pistes peuvent inclure non seulement des chansons ( <code>type = "songs"</code> ), mais aussi des clips vid√©o, de sorte qu'un filtrage suppl√©mentaire des donn√©es re√ßues ne nuira pas. </p><br><p>  Avec d'autres recommandations, tout est un peu plus compliqu√©.  Si vous regardez Music.app, les " <em>artistes similaires</em> " y sont affich√©s et vous pouvez activer la " <em>station de radio</em> " pour cet artiste.  Ce dernier perd le mix de l'artiste et les recommandations √† lui. </p><br><img alt="police similaire" src="https://habrastorage.org/webt/lr/yr/e2/lryre2qusu_88h-xyvna4_gs8kc.png" width="200"><br><p>  Il semble que tout soit simple: pour les artistes, il y a probablement un lien entre " <em>artistes similaires</em> ".  Je m'empresse de bouleverser, il n'y a pas une telle connexion.  Il n'y a pas non plus d'informations de similitude dans le sch√©ma de donn√©es du flux de partenaire d'entreprise. </p><br><p>  D'accord, nous pouvons donc demander une " <em>station de radio</em> " pour l'artiste et obtenir une liste de chansons?  Et encore une fois, non, on <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">peut</a> vraiment demander une station de radio, son identifiant est dans l'√©mission des connexions de l'artiste.  Mais dans les informations de la station, il n'y a aucune information sur les chansons, les albums ou les artistes en cours de lecture, il n'y a qu'un objet de service avec des informations pour jouer √† <code>playParams</code> .  L'id√©e avec <code>playParams</code> simple: nous introduisons ce dictionnaire <sup>12</sup> dans la file d'attente de lecture et l'√©coutons. </p><br><p>  Tout cela est bien si vous ne voulez √©couter qu'une station de radio ( <em>comme le fait Music.app</em> ), mais que faire si vous voulez m√©langer des chansons de la station de radio <sup>13</sup> avec autre chose?  De toute √©vidence, nous devons en quelque sorte obtenir une liste d'artistes similaires. </p><br><p>  Dans <code>Media Player</code> , les files d'attente de lecture jouent un r√¥le important, en particulier <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MPMusicPlayerControllerMutableQueue</a> .  La file d'attente vous permet de: ins√©rer des descripteurs apr√®s un certain objet jouable, supprimer des objets sp√©cifi√©s et √©galement obtenir une liste de tous les objets dans la file d'attente.  Lorsque vous interrogez des objets pour la sortie, nous devons obtenir un tableau de <code>MPMediaItem</code> .  Et <code>MPMediaItem</code> , en particulier, comprend l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">identifiant de la chanson</a> .  Il n'y a qu'un seul probl√®me: les constructeurs de files d'attente ne sont pas une API publique, je traduirai: <code>Media Player</code> peut donner une file d'attente pr√™te √† l'emploi (parfois <em>modifiable</em> ), mais il est impossible de la cr√©er vous-m√™me <sup>14</sup> . </p><br><p>  Eh bien, creuser un peu vers des b√©quilles peut √™tre utile.  Si <code>Media Player</code> peut me donner une file d'attente variable, je dois la prendre.  Pour ce faire, vous devrez travailler avec le lecteur actuel ( <em>singleton</em> ), vous devez donc agir rapidement, sinon l'utilisateur risque de perdre quelque chose de mal, et le lecteur aura toujours le temps de pr√©charger les chansons inutiles jusqu'√† pr√©sent.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nous changeons la</a> file d'attente de lecture actuelle ( <em>ajoutez le descripteur de station</em> ), regardons ce qui s'est pass√©, annulons les modifications dans la file d'attente avec une nouvelle transaction ( <em>supprimez ce qui a √©t√© r√©ellement ajout√© √† la file d'attente</em> ). </p><br><p>  Malheureusement, nous constatons que seuls deux objets <code>MPMediaItem</code> sont <code>MPMediaItem</code> √† la file d'attente.  Les deux ressemblent √† des chansons ( <em>il y a le nom de l'artiste, le nom de la piste, la longueur de la piste</em> ), mais n'incluent pas l'identifiant de la chanson.  Si vous regardez Music.app, nous constatons que tout y converge: allumer la station de radio jouera la chanson, et dans la file d'attente il n'y aura qu'une seule chanson √† jouer.  Lorsque vous passez √† la chanson suivante, la file d'attente est mise √† jour. </p><br><p>  Cela n'a aucun sens d'essayer de construire des b√©quilles avec des stations de radio plus loin; vous devez utiliser d'autres options. </p><br><p>  Rappelez-vous que dans Music.app et l'interface Web, des artistes similaires sont affich√©s.  Des artistes similaires ne sont disponibles que pour les groupes les plus populaires <sup>15</sup> .  Encore une fois, vous devez recourir √† la m√©thode interdite d'analyse d'une page Web.  Des pros: nous t√©l√©chargeons d√©j√† une page Web pour obtenir une photo, afin que nous puissions en obtenir imm√©diatement des artistes similaires. </p><br><p>  Dans le code de la page html, nous voyons un grand objet json, √† partir duquel nous prenons d'abord les identifiants d'artistes similaires ( <code>["data"]["relationships"]["artistContemporaries"]</code> ): </p><br><img alt="donn√©es de page web" src="https://habrastorage.org/webt/xg/o-/yx/xgo-yxn-dh73gqcd8zieowzam3y.png" width="200"><br><p>  puis en utilisant ces identifiants, nous obtenons les donn√©es de l'artiste du m√™me json ( <code>["included"]</code> avec le type <code>lockup/artist</code> ): </p><br><img alt="page web incluse" src="https://habrastorage.org/webt/j8/du/my/j8dumysqer6_oh9wlj_8geroip4.png" width="300"><br><p>  Ayant les identifiants des artistes, nous pouvons demander leurs morceaux.  L'API vous permet de demander <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plusieurs artistes</a> par leurs identifiants en une seule demande avec les liens activ√©s.  H√©las, en pratique, l'API renvoie une erreur indiquant l'impossibilit√© d'ajouter une liste de pistes au r√©sultat.  Cela ne peut se faire qu'en demandant des artistes un par un ou en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">demandant directement des chansons</a> pour un seul artiste.  Dans ce cas, vous pouvez utiliser l'API iTunes Search d√©j√† mentionn√©e, qui vous donnera des informations un peu plus utiles. </p><br><p>  Les listes "d' <em>artistes similaires</em> " dans Apple Music sont assez bonnes, mais en pratique, elles s'av√®rent souvent vides.  Dans le cas d'une liste de recommandations vide, vous devez utiliser des services tiers.  Classiques - Last.fm, un peu plus sophistiqu√© - Spotify.  Les r√©sultats des deux doivent correspondre aux objets du catalogue Apple Music.  La solution "au front" consiste √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rechercher chaque artiste</a> par son nom avec exactement un r√©sultat, puis √† recevoir les chansons comme d√©crit ci-dessus.  Les solutions sont un peu plus int√©ressantes, mais il est plus co√ªteux d'utiliser musicbrainz pour l'appariement.  Musicbrainz fournit des informations sur les identifiants <sup>16</sup> dans d'autres services, c'est-√†-dire  Vous pouvez associer un identifiant dans Spotify √† un identifiant dans Apple Music.  La situation avec Last.fm est encore meilleure: Last.fm renvoie les identifiants de musicbrainz dans la liste des recommandations.  Le surco√ªt r√©side dans les limites de l'utilisation de musicbrainz, avec beaucoup de trafic, vous devez g√©n√©rer votre propre clone de musicbrainz (heureusement, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cela est possible</a> ) ou d√©velopper votre propre API autour d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">une base de donn√©es</a> , dont les d√©charges peuvent √™tre facilement t√©l√©charg√©es. </p><br><p>  Pour les nouveaux groupes, m√™me Last.fm ne donnera pas de recommandations, les options alternatives seront des recommandations de ¬´genre¬ª.  Nous prenons les genres de l'artiste ( <em>sur la base du nom, nous obtenons des identifiants de la liste d√©j√† charg√©e de tous les genres</em> ), nous obtenons le tableau de chaque genre, nous mixons les chansons re√ßues.  C'est mieux que rien. </p><br><h2 id="dve-veschi-nerazluchnye-pleer-i-ochered">  Deux choses sont ins√©parables: le joueur et la file d'attente </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Media Player</a> est responsable de la lecture dans iOS depuis Apple Music; il vous permet de travailler avec la musique d'Apple Music et le r√©pertoire personnel de l'utilisateur <sup>17</sup> .  Le cadre est de haut niveau et dans la situation de travailler avec du contenu en streaming pour descendre √† un niveau inf√©rieur √† <sup>18</sup> ne fonctionnera pas. </p><br><p>  Le cadre fournit √† deux joueurs une interface logicielle commune: l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un</a> joue de la musique directement dans l'application Music.app, et l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">autre</a> fonctionne plus ou moins ind√©pendamment.  Utiliser le premier pour quelque chose de s√©rieux est inutile <sup>19</sup> .  Et la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> ment effront√©ment <sup>20</sup> que le deuxi√®me joueur ne fonctionne pas en arri√®re-plan </p><br><p>  Du point de vue architectural, travailler avec cette question est simple: nous disons au joueur quoi jouer ( <em>par exemple, en remplissant la file d'attente, sur la base d'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tableau d'identifiants de chansons</a></em> ) et nous contr√¥lons la lecture ( <em>lecture, pause, suivante, pr√©c√©dente</em> ). </p><br><p>  Il n'y a pas de contr√¥le direct de la file d'attente de lecture, vous devez effectuer une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">modification transactionnelle</a> , ce qui prend du temps.  Dans le m√™me temps, le gestionnaire de <code>completionHandler</code> est souvent appel√© avec une erreur de temporisation, qui se traduit par " <em>Je ne sais pas si j'ai pu faire quelque chose ou si je fais autre chose, mais je suis fatigu√© de m'attendre</em> ."  Le plus souvent, la transaction se passe bien et les erreurs qui arrivent au gestionnaire doivent √™tre ignor√©es.  Certaines des modifications peuvent √™tre apport√©es √† un niveau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">l√©g√®rement sup√©rieur</a> , cependant, si vous avez d√©j√† d√ª utiliser des modifications transactionnelles, il est pr√©f√©rable de les utiliser pour tout. </p><br><p>  En g√©n√©ral, les files d'attente sont assez flexibles, et s'il est peu probable que votre application fonctionne une fois avec d'autres services de streaming <sup>21</sup> , vous pouvez faire beaucoup de choses int√©ressantes avec les files d'attente, en particulier, indiquer √† quelle heure l'√©l√©ment commence √† jouer et pendant combien de temps. </p><br><p>  Parmi les autres ¬´ <em>inconv√©nients</em> ¬ª d'une telle approche de haut niveau, il convient de noter l'incapacit√© √† traiter les actions des utilisateurs.  En appuyant sur l'utilisateur sur le casque du bouton " <em>piste suivante</em> " ne conduira pas √† une demande pour le programme " <em>que dois-je faire</em> ", le joueur sait mieux quoi faire et changera de chanson lui-m√™me.  Vous ne pouvez donc attraper que les modifications r√©ellement termin√©es de l'√©tat du joueur et prendre certaines d√©cisions apr√®s coup. </p><br><p>  En revanche, vous n'avez pas √† faire grand-chose: les informations sur la lecture sur l'√©cran de verrouillage sont simplement l√† et tous les boutons y fonctionnent, Apple Watch et Siri peuvent contr√¥ler la lecture, et la diffusion via AirPlay sur Apple TV fonctionne √† partir de la bo√Æte <sup>22</sup> . </p><br><p>  Il est possible de r√©p√©ter la fonctionnalit√© et l'interface de la file d'attente Music.app dans votre application, mais la simplicit√© apparente des √©l√©ments drag'n'drop de la file d'attente s'av√®re en fait jongler avec les transactions pour changer la file d'attente et synchroniser la file d'attente souhait√©e et la file d'attente r√©elle de <sup>23</sup> joueurs. </p><br><h2 id="para-slov-pro-sdk-dlya-drugih-platform">  Quelques mots sur le SDK pour les autres plateformes </h2><br><p>  En fait, travailler avec l'API n'est pas diff√©rent sur d'autres plates-formes, mais les SDK ne sont pas compl√®tement copi√©s avec iOS et, √† certains endroits, sont plus pratiques <sup>24</sup> , bien que l'id√©e g√©n√©rale d'une file d'attente et d'un lecteur en tandem demeure. </p><br><p>  Ainsi, sous Android, vous pouvez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">obtenir la file d'attente actuelle</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©placer les √©l√©ments de la file d'attente</a> sans astuces avec un changement transactionnel (en <em>supprimant de la file d'attente et en ajoutant au bon endroit avec les doigts crois√©s</em> ). </p><br><p>  MusicKit JS fournit √©galement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des m√©thodes d'emballage sp√©ciales</a> pour travailler avec l'API Apple Music, <br>  mais lorsque vous utilisez des wrappers, vous ne pouvez pas vous passer de lire la documentation de l'API elle-m√™me.  Travailler avec la file d'attente et le lecteur n'est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pas plus pratique que le SDK iOS</a> , mais avec de petits modules compl√©mentaires, il <a href="">peut devenir supportable</a> . </p><br><h2 id="para-slov-o-simulyatore">  Quelques mots sur le simulateur </h2><br><p>  Vous ne pouvez travailler dans le simulateur avec MusicKit que dans le contexte de la communication avec l'API HTTP, mais m√™me dans ce cas, vous devrez stabiliser le jeton de l'utilisateur pour effectuer les demandes, et ne pas l'obtenir via <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">StoreKit</a> .  Il est compl√®tement impossible de lire de la musique d'Apple Music dans le simulateur, car l'application Music.app est manquante. </p><br><p>  En fait, vous devez d√©velopper vos propres modules compl√©mentaires sur le SDK et, lors de l'ex√©cution dans le simulateur, utiliser des impl√©mentations alternatives ( <em>fictives</em> ).  En fait, lors du d√©veloppement, le simulateur n'est utile que pour travailler sur l'interface utilisateur.  Sa propre abstraction sera √©galement utile dans les captures d'√©cran automatis√©es de l'application ( <em>et en effet lors de la cr√©ation de captures d'√©cran √† l'aide d'un simulateur</em> ), car avoir les deux g√©n√©rations de ¬´grands¬ª iPad Pro dans l'arsenal juste pour prendre des captures d'√©cran de votre lecteur sur les deux est extr√™mement peu rentable et stupide . </p><br><p>  En tant qu'exp√©rience int√©ressante mais pas tr√®s utile, vous pouvez cr√©er une impl√©mentation alternative de votre propre lecteur de haut niveau bas√© sur MusicKit JS. </p><br><h2 id="pro-enterprise-partner-feed">  √Ä propos du flux de partenaires d'entreprise </h2><br><p>  D'une part, Apple fournit un vidage de m√©tadonn√©es sur demande et dit de l'utiliser pour r√©duire la charge sur l'API et obtenir des informations que l'API ne poss√®de pas.  D'autre part, nous avons un probl√®me clair avec le poulet et les ≈ìufs: l'acc√®s au programme d'affiliation est fourni en sp√©cifiant un lien vers l'application.  Il est assez difficile de d√©velopper une application en utilisant les donn√©es qui ne peuvent √™tre obtenues qu'avec l'application publi√©e sur l'App Store. </p><br><p>  Et, bien s√ªr, les donn√©es ne donnent pas le premier venu.  Chaque demande est v√©rifi√©e dans les cinq jours ouvrables.  Au moment d'√©crire ces lignes, je n'ai pas r√©ussi √† obtenir un clich√© de m√©tadonn√©es entre mes mains.  Apple a encapsul√© ma demande sans pr√©ciser les raisons exactes.  ,  -     " <em>Apple Music</em> "    ,    Apple   .   - ,      -, <em>       </em> . ,       Apple    ,    ,     . </p><br><p>       ,        ,         .             Apple Music    ( <em>      ,       </em> ),     . ,     ,     Apple Music  .         ,      ,      . </p><br><p>   Enterprise Partner Feed     : </p><br><ul><li>          Apple Music API  iTunes Search API </li><li>      (" <em> </em> "),   -   </li><li>        </li></ul><br><h2 id="ochevidnye-sovety">   </h2><br><p>    ,  -  : </p><br><ol><li>   .     ,   ,     .   <br>     ,   .         ,    -     </li><li>   -  ,   ,            . ,       -  ,             -. </li><li> ,  SDK         ,      .  Apple <sup>25</sup>   SDK     <sup>26</sup> ,         ,   ,     API  ,   SDK    . </li><li>      ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>   " <em>code level</em> "      .      " <em>Q&amp;A</em> "  " <em>Tech Notes</em> ",     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   </a> ,      - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> . </li><li>      . ,  ,       .  API ( <em>Last.fm, musicbrainz, iTunes Search API    </em> )    IP   .       Apple Music      .        " <em></em> "       ,         <sup>27</sup> . </li><li> ,   Apple Music API,       ,   . - App Store   ,      ( <em>    </em> )     , ,  ( <em>        </em> ).     <sup>28</sup>   ,    ,          ,            <sup>29</sup> .   Apple      <sup>30</sup> . </li><li> ,  - Apple Music ‚Äî   Ember.    ,   ,     html         DOM   Javascript. </li><li>   -,   ,          .          ,    . </li></ol><br><h2 id="posleslovie">  </h2><br><p>     SDK,        batch   API,          ,    ¬´ ¬ª  Apple Music.  ,     ,        SDK   .          SDK,             . </p><br><p> ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> . </p><br><h2 id="bespoleznye-primechaniya">   </h2><br><p> <sup>1</sup>    ( <em> </em> ) </p><br><p> <sup>2</sup> ,       </p><br><p> <sup>3</sup> ,  Music.app  -        ( <em>   </em> ),    API   ( <em>   ""</em> )  </p><br><p> <sup>4</sup>    <code>limit</code>  : <code>Specified limit for relationship 'songs' exceeds maximum of 20</code> </p><br><p> <sup>5</sup> The Beatles </p><br><p> <sup>6</sup>    ,      Apple Music   iTunes Store.   API iTunes Store   `isStreamablez,        Apple Music  . </p><br><p> <sup>7</sup>  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://itunes.apple.com/WebObjects/MZStore.woa/wa/viewArtistSeeAll?cc=ru&amp;ids=424279384&amp;section=0</a> </p><br><p> <sup>8</sup>  ,     ,  ,     iTunes    ( <em></em> )   iTunes Store </p><br><p> <sup>9</sup>             </p><br><p> <sup>10</sup>  ,       ! </p><br><p> <sup>11</sup> ,    Apple Music      :   ,        ,      </p><br><p> <sup>12</sup> ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MPMusicPlayerPlayParametersQueueDescriptor</a> </p><br><p> <sup>13</sup>   Apple Music   ,    ( <em></em> )   .        . </p><br><p> <sup>14</sup> , ,    App Store </p><br><p> <sup>15</sup>    ( <em></em> )    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">( <em></em> )</a>  ( <em></em> )    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">( <em></em> )</a> .       . </p><br><p> <sup>16</sup>       -,         </p><br><p> <sup>17</sup>     ,     iTunes Store    iTunes Match </p><br><p> <sup>18</sup>        API URL   </p><br><p> <sup>19</sup>  ‚Äî   -,       . ,  . </p><br><p> <sup>20</sup>  : ( <em>When your app moves to the background, the music player stops playing the current media.</em> ).       <code>AVPlayer</code> ,     ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>  <code>Info.plist</code>            . </p><br><p> <sup>21</sup>              . </p><br><p> <sup>22</sup>      ,    <code>MPMediaItem</code>    </p><br><p> <sup>23</sup>           </p><br><p> <sup>24</sup>     ,   SDK    ,     ,       .    iOS <code>Media Player</code>    ,     API  . </p><br><p> <sup>25</sup>         ,      ‚Äî      ,       . </p><br><p> <sup>26</sup>     SDK       ,    Apple Music. Apple    ,   . </p><br><p> <sup>27</sup>       ,      ‚Äî   . ,     Enterprise Partner Feed, musicbrainz,          API.  ,       ( <em>       </em> )    .      ,         . </p><br><p> <sup>28</sup> RIP </p><br><p> <sup>29</sup>   API  Bing </p><br><p> <sup>30</sup>        </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr464811/">https://habr.com/ru/post/fr464811/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr464791/index.html">Kubernetes pour la voiture: comment ouvrir l'acc√®s du d√©veloppeur √† l'ordinateur de bord et le s√©curiser</a></li>
<li><a href="../fr464795/index.html">Joyeux Quartusel, ou comment le processeur est arriv√© √† une telle vie</a></li>
<li><a href="../fr464803/index.html">"Hide www": pourquoi les d√©veloppeurs de navigateurs traditionnels ont de nouveau refus√© d'afficher le sous-domaine</a></li>
<li><a href="../fr464805/index.html">√âcrire un serpent sur iPad (Pythonista)</a></li>
<li><a href="../fr464809/index.html">Comment nous avons test√© la technologie de reconnaissance faciale et ce qui en est ressorti</a></li>
<li><a href="../fr464813/index.html">Remplacement de Punto Switcher, Birman layouts par un script sur autohotkey</a></li>
<li><a href="../fr464823/index.html">Nous consid√©rons le salaire moyen d'un ¬´data scientologist¬ª. Parsim hh.ru en utilisant pandas / python</a></li>
<li><a href="../fr464825/index.html">Pr√©paration de l'application pour Android Q. Partie 2</a></li>
<li><a href="../fr464831/index.html">Ajouter la fonctionnalit√© Razor Pages au standard .NET</a></li>
<li><a href="../fr464833/index.html">Count Scoring de la Fer ou une √©tude sur la notation du cr√©dit dans le cadre de l'√©largissement de ses horizons. 2e partie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>