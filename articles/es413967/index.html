<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçü§ù‚Äçüë®üèº üë®üèæ‚Äçüéì ü§üüèº Animal Crossing Developer Mode Ingenier√≠a inversa ü•ß üí¨ ‚õìÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El verano pasado, comenc√© la ingenier√≠a inversa Animal Crossing para GameCube. Quer√≠a explorar la posibilidad de crear mods para este juego. Adem√°s, q...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Animal Crossing Developer Mode Ingenier√≠a inversa</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413967/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b4d/fe4/7f0/b4dfe47f0139ba1af039decfb6274524.jpg" alt="Usando el c√≥digo en un GameCube real"></div><br>  El verano pasado, comenc√© la ingenier√≠a inversa Animal Crossing para GameCube.  Quer√≠a explorar la posibilidad de crear mods para este juego.  Adem√°s, quer√≠a documentar el proceso para crear tutoriales para personas interesadas en piratear ROM e ingenier√≠a inversa.  En esta publicaci√≥n, hablar√© sobre las caracter√≠sticas de depuraci√≥n del desarrollador que permanecieron en el juego, y tambi√©n compartir√© c√≥mo descubr√≠ combinaciones de trucos que se pueden usar para desbloquearlas. <br><a name="habracut"></a><br><h3>  new_Debug_mode </h3><br>  Al estudiar los s√≠mbolos de depuraci√≥n restantes, not√© los nombres de las funciones y variables que conten√≠an la palabra "depuraci√≥n", y decid√≠ que ser√≠a interesante ver si quedaba alguna funcionalidad de depuraci√≥n en el juego.  Si logro activar las funciones de depuraci√≥n o desarrollo, esto me ayudar√° en el proceso de creaci√≥n de modificaciones. <br><br>  La primera funci√≥n que not√© fue <code>new_Debug_mode</code> .  Se llama mediante la funci√≥n de <code>entry</code> , que comienza inmediatamente despu√©s de que finaliza la pantalla del logotipo de Nintendo.  Todo lo que hace es colocar la estructura de bytes <code>0x1C94</code> y guardar un puntero en ella. <br><br>  Despu√©s de que se llama en la <code>entry</code> en la estructura alojada en el desplazamiento <code>0xD4</code> inmediatamente antes de llamar a <code>mainproc</code> valor 0. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/63e/fbc/0af/63efbc0af9ebfb4eeb2c3b42feddcbed.png"></div><br>  Para ver qu√© sucede cuando el valor no es cero, <code>80407C8C</code> instrucci√≥n <code>li r0, 0</code> en <code>80407C8C</code> , reemplaz√°ndola por <code>li r0, 1</code> .  Los bytes sin procesar de la instrucci√≥n <code>li r0, 0</code> son <code>38 00 00 00</code> donde el valor asignado se encuentra al final de la instrucci√≥n, por lo que podr√≠a reemplazar los bytes con <code>38 00 00 01</code> y obtener <code>li r0, 1</code> .  Como una forma m√°s confiable de crear instrucciones, puede usar algo como <code>kstool</code> : <br><br> <code>$ kstool ppc32be "li 0, 1" <br> li 0, 1 = [ 38 00 00 01 ]</code> <br> <br>  En el emulador Dolphin, este parche se puede aplicar yendo a la pesta√±a "Parches" en las propiedades del juego e ingres√°ndolo de la siguiente manera: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e65/ecb/706/e65ecb7061c9470c9a9b71c4aad8e506.png"></div><br>  Despu√©s de asignar el valor 1, apareci√≥ un gr√°fico interesante en la parte inferior de la pantalla: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/be5/cab/e1f/be5cabe1fe1df63d0534c092d49ca8f9.png"></div><br><br>  Parec√≠a un indicador de rendimiento: las peque√±as barras en la parte inferior de la pantalla aumentaron o disminuyeron.  (M√°s tarde, cuando mir√© los nombres de las funciones que dibujan este gr√°fico, descubr√≠ que en realidad muestran las m√©tricas de uso de CPU y memoria). <br><br>  Fue genial, pero no particularmente √∫til.  Despu√©s de asignar el valor 1, mi ciudad dej√≥ de cargarse, por lo que no se pudo hacer nada m√°s aqu√≠. <br><br><h3>  Modo Zuru </h3><br>  Nuevamente comenc√© a buscar otras referencias a las funciones de depuraci√≥n, y varias veces me encontr√© con algo llamado "modo zuru".  Las ramas de bloques de c√≥digo con funcionalidad de depuraci√≥n a menudo verificaban la variable <code>zurumode_flag</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/88e/4d4/63c/88e4d463c3ea3474d3b67e2cf8367ee2.png" alt="funci√≥n game_move_first"></div><br>  <code>zzz_LotsOfDebug</code> (el nombre que se me ocurri√≥) en la funci√≥n <code>game_move_first</code> que se muestra arriba solo se llama cuando <code>zurumode_flag</code> no <code>zurumode_flag</code> igual a cero. <br><br>  Buscando funciones asociadas con este valor, encontr√© estas: <br><br><ul><li> <code>zurumode_init</code> </li> <li> <code>zurumode_callback</code> </li> <li> <code>zurumode_update</code> </li> <li> <code>zurumode_cleanup</code> </li> </ul><br>  A primera vista, su prop√≥sito es misterioso, hacen malabarismos con los bits de una variable llamada <code>osAppNMIBuffer</code> . <br><br>  As√≠ es como se ve√≠a el trabajo de estas funciones a primera vista: <br><br><h4>  zurumode_init </h4><br><ul><li>  Establece <code>zurumode_flag</code> en 0 </li><li>  Comprueba varios bits en <code>osAppNMIBuffer</code> </li><li>  Guarda un puntero a la funci√≥n <code>zurumode_callback</code> en la estructura <code>padmgr</code> </li><li>  Llamadas <code>zurumode_update</code> </li></ul><br><h4>  zurumode_update </h4><br><ul><li>  Comprueba varios bits en <code>osAppNMIBuffer</code> </li><li>  Dependiendo del valor de estos bits, <code>zurumode_flag</code> actualizaciones de <code>zurumode_flag</code> </li><li>  Imprime una cadena de formato en la consola del sistema operativo. </li></ul><br>  Esto suele ser √∫til para dar contexto al c√≥digo, pero hab√≠a muchos caracteres no imprimibles en la l√≠nea.  El √∫nico texto reconocible fue "zurumode_flag" y "% d". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/268/f99/093/268f99093e0f9dec2a19bfc22be95ac7.png" alt="cadena de formato del modo zuru"></div><br>  Suponiendo que podr√≠a ser texto japon√©s con codificaci√≥n de caracteres multibyte, pas√© la cadena a trav√©s de la herramienta de reconocimiento de codificaci√≥n y descubr√≠ que la cadena estaba codificada con Shift-JIS.  En la traducci√≥n, la l√≠nea simplemente significaba "El valor de zurumode_flag ha cambiado de% d a% d".  Esto no nos da mucha informaci√≥n nueva, pero ahora sabemos que se usa Shift-JIS: en archivos binarios y tablas de filas hay muchas m√°s l√≠neas en esta codificaci√≥n. <br><br><h4>  zurumode_callback </h4><br><ul><li>  Llamadas <code>zerumode_check_keycheck</code> </li><li>  Comprueba varios bits en <code>osAppNMIBuffer</code> </li><li>  El valor <code>zurumode_flag</code> se <code>zurumode_flag</code> </li><li>  Llamadas <code>zurumode_update</code> </li></ul><br>  <code>zerumode_check_keycheck</code> hasta que nos conocimos debido a una ortograf√≠a diferente ... ¬øqu√© es? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/49e/ca7/1fd/49eca71fdd3cefb01b01c578a93bbe72.png" alt="zerumode_check_keycheck"></div><br>  Una gran funci√≥n compleja que hace mucho m√°s trabajo en bits con valores sin nombre. <br><br>  En este punto, decid√≠ dar un paso atr√°s y estudiar otras funciones y variables de depuraci√≥n, porque no estaba seguro de la importancia del modo zuru.  Adem√°s, no entend√≠ qu√© significa "verificaci√≥n de clave" aqu√≠.  ¬øEs posible que esta sea una clave criptogr√°fica? <br><br><h3>  Volver a la depuraci√≥n </h3><br>  Alrededor de este tiempo, not√© un problema con mi forma de cargar s√≠mbolos de depuraci√≥n en la IDA.  El archivo <code>foresta.map</code> en el disco del juego contiene muchas direcciones y nombres de funciones y variables.  Al principio, no vi que las direcciones para cada secci√≥n comenzaran nuevamente desde cero, as√≠ que escrib√≠ un script simple que agrega una entrada de nombre para cada l√≠nea del archivo. <br><br>  Escrib√≠ nuevos scripts de IDA para arreglar la carga de tablas de s√≠mbolos para diferentes secciones del programa: <code>.text</code> , <code>.rodata</code> , <code>.data</code> y <code>.bss</code> .  La secci√≥n <code>.text</code> contiene todas las funciones, por lo que esta vez, cuando configur√© el nombre, el script reconocer√≠a autom√°ticamente las funciones en cada direcci√≥n. <br><br>  En las secciones de datos, ahora cre√≥ un segmento para cada objeto binario (por ejemplo, <code>m_debug.o</code> , que se supon√≠a que era un c√≥digo compilado para algo llamado <code>m_debug</code> ), y estableci√≥ el espacio y los nombres para cada pieza de datos. <br><br>  Esto me dio mucha m√°s informaci√≥n, pero tuve que configurar manualmente el tipo de datos para cada pieza de datos, porque defin√≠ cada objeto de datos como una simple matriz de bytes.  (Mirando hacia atr√°s, entiendo que ser√≠a mejor suponer que los fragmentos de 4 bytes conten√≠an enteros de 32 bits, porque hab√≠a muchas, y muchas, conten√≠an direcciones de funciones y datos importantes para construir referencias cruzadas). <br><br>  Al estudiar el nuevo segmento <code>.bss</code> para <code>m_debug_mode.o</code> , encontr√© varias variables de la forma <code>quest_draw_status</code> y <code>event_status</code> .  Esto es interesante porque quer√≠a informaci√≥n √∫til, no solo un gr√°fico de rendimiento, que se mostrara en modo de depuraci√≥n.  Afortunadamente, a partir de estos registros de datos hubo referencias cruzadas a una gran parte del c√≥digo que verifica <code>debug_print_flg</code> . <br><br>  Usando un depurador en el emulador Dolphin, establec√≠ un punto de interrupci√≥n en la ubicaci√≥n de la funci√≥n donde <code>debug_print_flg</code> verific√≥ <code>8039816C</code> (en <code>8039816C</code> ) para comprender c√≥mo funciona esta verificaci√≥n.  Pero el programa nunca pas√≥ a este punto de quiebre. <br><br>  Veamos por qu√© sucede esto: <code>game_debug_draw_last</code> llama a esta funci√≥n.  ¬øAdivina qu√© valor se verifica antes de su llamada condicional?  <code>zurumode_flag</code> !  Que diablos esta pasando <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/257/048/964/257048964f9e8265670952e66868fc83.png" alt="comprobar zurumode_flag"></div><br>  Establec√≠ un punto de interrupci√≥n en este control ( <code>80404E18</code> ) y funcion√≥ de inmediato.  El valor de <code>zurumode_flag</code> era cero, por lo que en la ejecuci√≥n normal, el programa habr√≠a perdido la llamada a esta funci√≥n.  En su lugar, insert√© una instrucci√≥n de bifurcaci√≥n NOP (la reemplac√© con una instrucci√≥n que no hace nada) para verificar qu√© sucede cuando se llama a la funci√≥n. <br><br>  En el depurador Dolphin, esto se puede hacer pausando el juego, haciendo clic derecho en las instrucciones y seleccionando "Insertar nop": <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2e6/f00/8d1/2e6f008d1dcf1be707b1961e05df2e71.png" alt="Depurador de delfines"></div><br>  No paso nada  Luego verifiqu√© lo que estaba sucediendo dentro de la funci√≥n y descubr√≠ otra construcci√≥n de ramificaci√≥n que eludi√≥ todo lo interesante que suced√≠a en <code>803981a8</code> .  Tambi√©n insert√© NOP, y la letra "D" apareci√≥ en la esquina superior derecha de la pantalla. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a18/9a0/816/a189a0816b08438ad5b85c09adaac57c.png" alt="Modo de depuraci√≥n letra D"></div><br>  En esta funci√≥n en <code>8039816C</code> (lo llam√© <code>zzz_DebugDrawPrint</code> ), todav√≠a hay un mont√≥n de c√≥digo interesante, pero no se llama.  Si observa esta funci√≥n en forma de gr√°fico, puede ver que hay una serie de operadores de ramificaci√≥n que omiten bloques de c√≥digo en toda la funci√≥n: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/236/131/4bb/2361314bbb4165b8e1c82386e8c50533.png" alt="Sucursales en zzz_DebugDrawPrint"></div><br>  Despu√©s de insertar NOP en lugar de varias otras construcciones de ramificaci√≥n, comenc√© a ver varias cosas interesantes en la pantalla: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0db/c19/008/0dbc1900844131d0c3d7f507f2b61b63.png" alt="Se imprimen m√°s cosas de depuraci√≥n"></div><br>  La siguiente pregunta fue c√≥mo activar esta funcionalidad de depuraci√≥n sin cambiar el c√≥digo. <br><br>  Adem√°s, en algunas construcciones de rama, <code>zurumode_flag</code> ocurre nuevamente en esta funci√≥n de dibujo de depuraci√≥n.  <code>zurumode_update</code> otro parche para que en <code>zurumode_update</code> bandera <code>zurumode_update</code> siempre <code>zurumode_flag</code> asignado el valor 2, porque cuando no se compara con 0, se compara espec√≠ficamente con el valor 2. <br><br>  Despu√©s de reiniciar el juego, vi en la esquina superior derecha de la pantalla un mensaje "mensaje".  no ". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97d/16e/a0b/97d16ea0b169c72dd86ab623e0e3f977.png" alt="visualizaci√≥n del n√∫mero de mensaje"></div><br>  El n√∫mero 687 es el identificador de registro del mensaje mostrado m√°s recientemente.  Lo verifiqu√© usando el programa de visualizaci√≥n de tablas que escrib√≠ al comienzo del an√°lisis, pero tambi√©n puede verificarlo usando el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">editor de tablas de cadenas con una GUI completa</a> , que escrib√≠ para piratear ROM.  As√≠ es como se ve la publicaci√≥n en el editor: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cad/e3f/378/cade3f3785a86e9bf335a144fe16a338.png" alt="Mensaje 687 en el editor de tabla de cadenas"></div><br>  En este punto, qued√≥ claro que el estudio del modo zuru ya no se eliminaba, est√° directamente relacionado con las funciones de depuraci√≥n del juego. <br><br><h3>  Volver al modo Zuru nuevamente </h3><br>  <code>zurumode_init</code> inicializa varias cosas: <br><br><ul><li>  <code>0xC(padmgr_class)</code> asigna el valor de la direcci√≥n <code>zurumode_callback</code> </li><li>  <code>0x10(padmgr_class)</code> asigna el valor de direcci√≥n de <code>padmgr_class</code> </li><li>  <code>0x4(zuruKeyCheck)</code> asigna el valor del √∫ltimo bit en la palabra cargada desde <code>0x3C(osAppNMIBuffer)</code> . </li></ul><br>  Descubr√≠ qu√© <code>padmgr</code> , una abreviatura de "gamepad manager".  Esto significa que puede haber una combinaci√≥n especial de teclas (botones) que se pueden ingresar en el gamepad para activar el modo zuru, o alg√∫n tipo de dispositivo de depuraci√≥n o funci√≥n de la consola del desarrollador que se puede usar para enviar una se√±al para activarlo. <br><br>  <code>zurumode_init</code> se ejecuta solo en el primer arranque del juego (cuando se presiona el bot√≥n de reinicio, no funciona). <br><br>  Despu√©s de establecer un punto de interrupci√≥n en la direcci√≥n <code>8040efa4</code> , en la que se asigna el valor <code>0x4(zuruKeyCheck)</code> , podemos ver que al cargar sin presionar teclas, el valor se establece en 0. Si lo reemplaza por 1, sucede algo interesante: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9dc/5f5/0fb/9dc5f50fbd68beb624745d0704a18383.png" alt="Pantalla de t√≠tulo con modo zuru"></div><br>  La letra "D" aparece nuevamente en la esquina superior derecha (esta vez es verde, no amarilla), y tambi√©n se muestra informaci√≥n de ensamblaje: <br><br> <code>[CopyDate: 02/08/01 00:16:48 ] <br> [Date: 02-07-31 12:52:00] <br> [Creator:SRD@SRD036J]</code> <br> <br>  Un parche que siempre establece <code>0x4(zuruKeyCheck)</code> en 1 al principio tiene este aspecto: <br><br> <code>8040ef9c 38c00001</code> <br> <br>  Esta parece ser la forma correcta de inicializar el modo zuru.  Despu√©s de esto, pueden ser necesarias varias acciones para lograr la visualizaci√≥n de cierta informaci√≥n de depuraci√≥n.  Al comenzar el juego, dar un paseo y hablar con un aldeano, no veremos ninguno de los mensajes mencionados anteriormente (excepto la letra "D" en la esquina). <br><br>  Los sospechosos m√°s probables son <code>zurumode_update</code> y <code>zurumode_callback</code> . <br><br><h4>  zurumode_update </h4><br>  <code>zurumode_update</code> llama primero en <code>zurumode_init</code> y luego se llama constantemente por <code>zurumode_callback</code> . <br><br>  Comprueba nuevamente el √∫ltimo bit <code>0x3C(osAppNMIBuffer)</code> y luego, en funci√≥n de este valor, actualiza <code>zurumode_flag</code> . <br><br>  Si el bit es cero, la bandera se pone a cero. <br><br>  Si no, se ejecuta la siguiente instrucci√≥n, con el valor completo <code>0x3c(osAppNMIBuffer)</code> siendo <code>r5</code> : <br><br> <code>extrwi r3, r5, 1, 28</code> <br> <br>  Extrae el bit 28 de <code>r5</code> y lo almacena en <code>r3</code> . <br><br>  Luego se agrega 1 al resultado, es decir, el resultado final es siempre 1 o 2. <br><br>  Luego, <code>zurumode_flag</code> compara con el resultado anterior, dependiendo de cu√°ntos de los bits 28 y √∫ltimos se establecen en <code>0x3c(osAppNMIBuffer)</code> : 0, 1 o 2. <br><br>  Este valor se escribe en <code>zurumode_flag</code> .  Si no cambia nada, la funci√≥n sale y devuelve el valor del indicador actual.  Si cambia el valor, se ejecuta una cadena de bloques de c√≥digo mucho m√°s compleja. <br><br>  Se muestra un mensaje en japon√©s: el mismo "valor de zurumode_flag cambi√≥ de% d a% d", del que hablamos anteriormente. <br><br>  Luego se llama a una serie de funciones con diferentes argumentos, dependiendo de si el indicador se ha convertido en cero o no.  El c√≥digo de ensamblador de esta parte es mon√≥tono, por lo que mostrar√© su pseudoc√≥digo: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (flag_changed_to_zero) { JC_JUTAssertion_changeDevice(<span class="hljs-number"><span class="hljs-number">2</span></span>) JC_JUTDbPrint_setVisible(JC_JUTDbPrint_getManager(), <span class="hljs-number"><span class="hljs-number">0</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (BIT(nmiBuffer, <span class="hljs-number"><span class="hljs-number">25</span></span>) || BIT(nmiBuffer, <span class="hljs-number"><span class="hljs-number">31</span></span>)) { JC_JUTAssertion_changeDevice(<span class="hljs-number"><span class="hljs-number">3</span></span>) JC_JUTDbPrint_setVisible(JC_JUTDbPrint_getManager(), <span class="hljs-number"><span class="hljs-number">1</span></span>) }</code> </pre> <br>  Tenga en cuenta que si el indicador es cero, el argumento 0 se pasa a JC_JUTDbPrint_setVisible. <br><br>  Si el indicador no es igual a cero, y el bit 25 o el bit 31 se establecen en <code>0x3C(osAppNMIBuffer)</code> , entonces <code>setVisible</code> pasa al argumento 1. <br><br>  Esta es la primera clave para activar el modo zuru: el √∫ltimo bit <code>0x3C(osAppNMIBuffer)</code> debe establecerse en 1 para mostrar la informaci√≥n de depuraci√≥n y establecer <code>zurumode_flag</code> valor distinto de cero. <br><br><h4>  zurumode_callback </h4><br>  <code>zurumode_callback</code> se encuentra en <code>8040ee74</code> y probablemente es llamado por una funci√≥n relacionada con el gamepad.  Despu√©s de insertar un punto de interrupci√≥n en el depurador Dolphin, la pila de llamadas nos muestra que en realidad se est√° llamando desde <code>padmgr_HandleRetraceMsg</code> . <br><br>  Una de sus primeras acciones fue ejecutar <code>zerucheck_key_check</code> .  Esta funci√≥n es compleja, pero parece que, en general, est√° dise√±ada para leer y actualizar el valor de <code>zuruKeyCheck</code> .  Antes de pasar a la funci√≥n de comprobaci√≥n de teclas, decid√≠ comprobar c√≥mo se usa este valor en el resto de la funci√≥n de devoluci√≥n de llamada. <br><br>  Luego, nuevamente comprueba algunos bits en <code>0x3c(osAppNMIBuffer)</code> .  Si se establece el bit 26, o si se establece el bit 25 y <code>padmgr_isConnectedController(1)</code> devuelve un valor distinto de cero, ¬°el √∫ltimo bit en <code>0x3c(osAppNMIBuffer)</code> en 1! <br><br>  Si ninguno de estos bits est√° establecido, o el bit 25 est√° establecido, pero <code>padmgr_isConnectedController(1)</code> devuelve 0, entonces la funci√≥n verifica si el byte en la direcci√≥n <code>0x4(zuruKeyCheck)</code> es igual a cero.  Si es igual, restablece el √∫ltimo bit en el valor original y lo vuelve a <code>0x3c(osAppNMIBuffer)</code> en <code>0x3c(osAppNMIBuffer)</code> .  De lo contrario, a√∫n establece el √∫ltimo bit en 1. <br><br>  En pseudoc√≥digo, se ve as√≠: <br><br><pre> <code class="cpp hljs">x = osAppNMIBuffer[<span class="hljs-number"><span class="hljs-number">0x3c</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (BIT(x, <span class="hljs-number"><span class="hljs-number">26</span></span>) || (BIT(x, <span class="hljs-number"><span class="hljs-number">25</span></span>) &amp;&amp; isConnectedController(<span class="hljs-number"><span class="hljs-number">1</span></span>)) || zuruKeyCheck[<span class="hljs-number"><span class="hljs-number">4</span></span>] != <span class="hljs-number"><span class="hljs-number">0</span></span>) { osAppNMIBuffer[<span class="hljs-number"><span class="hljs-number">0x3c</span></span>] = x | <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-comment"><span class="hljs-comment">// set last bit } else { osAppNMIBuffer[0x3c] = x &amp; ~1 // clear last bit }</span></span></code> </pre> <br>  Despu√©s de eso, si el bit 26 no est√° establecido, la funci√≥n procede a llamar a <code>zurumode_update</code> y luego sale. <br><br>  Si se establece el bit, entonces si <code>0x4(zuruKeyCheck)</code> no <code>0x4(zuruKeyCheck)</code> igual a cero, entonces carga una cadena de formato en la que muestra lo siguiente: "ZURU% d /% d". <br><br><h4>  Para resumir el subtotal </h4><br>  Esto es lo que pasa: <br><br>  <code>padmgr_HandleRetraceMsg</code> llama a <code>zurumode_callback</code> .  Supongo que este "mensaje de seguimiento de manejo" significa que simplemente escanea las pulsaciones de teclas del controlador.  Con cada escaneo, puede causar una serie de devoluciones de llamada diferentes. <br><br>  Cuando <code>zurumode_callback</code> ejecuta <code>zurumode_callback</code> verifica las pulsaciones de teclado (botones) actuales.  Parece que est√° comprobando un bot√≥n espec√≠fico o una combinaci√≥n de botones. <br><br>  El √∫ltimo bit en el Buffer NMI se actualiza dependiendo de los bits espec√≠ficos en su valor actual, as√≠ como del valor de uno de los bytes <code>0x4(zuruKeyCheck)</code> ). <br><br>  Luego se <code>zurumode_update</code> y comprueba este bit.  Si es 0, el indicador de modo zuru se establece en 0. Si es 1, el indicador de modo cambia a 1 o 2, dependiendo de si el bit 28 est√° configurado. <br><br>  <strong>Hay tres formas de activar el modo zuru:</strong> <br><br><ol><li>  El bit 26 se establece en <code>0x3C(osAppNMIBuffer)</code> </li><li>  El bit 25 se establece en <code>0x3C(osAppNMIBuffer)</code> y el controlador est√° conectado al puerto 2 </li><li>  <code>0x4(zuruKeyCheck)</code> no <code>0x4(zuruKeyCheck)</code> cero </li></ol><br><h4>  osAppNMIBuffer </h4><br>  Interesado en lo que significa <code>osAppNMIBuffer</code> , comenc√© a buscar "NMI" y encontr√© enlaces en el contexto de Nintendo a "interrupci√≥n no enmascarable".  Resulta que el nombre de esta variable se menciona por completo en la documentaci√≥n del desarrollador para Nintendo 64: <br><br><blockquote>  osAppNMIBuffer es un b√∫fer de 64 bytes que se borra al reiniciar en fr√≠o.  Si el sistema se reinicia debido a NMI, el estado de este b√∫fer no cambia. </blockquote><br>  De hecho, esta es una peque√±a porci√≥n de memoria guardada durante un reinicio "suave" (con el bot√≥n de reinicio).  El juego puede usar este b√∫fer para almacenar datos mientras la consola est√° en la red.  El Animal Crossing original se lanz√≥ en Nintendo 64, por lo que es l√≥gico que algo similar deber√≠a haber aparecido en el c√≥digo. <br><br>  Si vamos al archivo binario <code>boot.dol</code> (todo lo que se muestra arriba estaba en <code>foresta.rel</code> ), entonces su funci√≥n <code>main</code> tiene muchos enlaces a <code>osAppNMIBuffer</code> .  Una mirada r√°pida muestra que hay una serie de comprobaciones que pueden conducir a <code>0x3c(osAppNMIBuffer)</code> valores de diferentes bits <code>0x3c(osAppNMIBuffer)</code> utilizando operaciones OR. <br><br>  Los siguientes valores de operando OR pueden ser interesantes: <br><br><ul><li>  Bit 31: 0x01 </li><li>  Bit 30: 0x02 </li><li>  Bit 29: 0x04 </li><li>  Bit 28: 0x08 </li><li>  Bit 27: 0x10 </li><li>  Bit 26: 0x20 </li></ul><br>  Recordamos que los bits 25, 26 y 28 son especialmente interesantes: 25 y 26 determinan si el modo zuru est√° activado, y el bit 28 determina el nivel de bandera (1 o 2). <br>  El bit 31 tambi√©n es interesante, pero parece que cambia seg√∫n los valores de los dem√°s. <br><br><h5>  Bit 26 </h5><br>  En primer lugar: en la direcci√≥n <code>800062e0</code> hay una instrucci√≥n <code>ori r0, r0, 0x20</code> con un valor de b√∫fer de <code>0x3c</code> .  Establece el bit 26, que siempre activa el modo zuru. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b5c/b3c/207/b5cb3c207a61dc20dd12e6724f25099b.png" alt="Bit de ajuste 26"></div><br>  Para establecer el bit, el octavo byte devuelto por <code>DVDGetCurrentDiskID</code> debe ser <code>0x99</code> .  Este identificador se encuentra al comienzo de la imagen de disco del juego y se carga en la memoria al <code>80000000</code> .  En un lanzamiento regular del juego, el ID se ve as√≠: <br><br> <code>47 41 46 45 30 31 00 00 GAFE01..</code> <br> <br>  Reemplazando el √∫ltimo byte del identificador con un <code>0x99</code> para <code>0x99</code> , obtenemos la siguiente imagen al iniciar el juego: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/da6/c58/c90/da6c58c90515fefb62ed8cf766ad8776.png" alt="ID de la versi√≥n del juego 0x99"></div><br>  Y lo siguiente se muestra en la consola del sistema operativo: <br><br> <code>06:43:404 HW\EXI_DeviceIPL.cpp:339 N[OSREPORT]: ZURUMODE2 ENABLE <br> 08:00:288 HW\EXI_DeviceIPL.cpp:339 N[OSREPORT]: osAppNMIBuffer[15]=0x00000078</code> <br> <br>  Todos los dem√°s parches se pueden eliminar, despu√©s de lo cual la letra D aparece nuevamente en la esquina superior derecha de la pantalla, pero ya no se activan los mensajes de depuraci√≥n. <br><br><h5>  Bit 25 </h5><br>  El bit 25 se usa junto con la verificaci√≥n del puerto del controlador 2. ¬øQu√© hace que se encienda? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ddf/d00/4a1/ddfd004a1488ec21842c90581ef177fc.png" alt="Bit 25 y 28"></div><br>  Resulta que deber√≠a usar la misma verificaci√≥n que para el bit 28: la versi√≥n debe ser mayor o igual a <code>0x90</code> .  Si se establece el bit 26 (ID es <code>0x99</code> ), ambos bits tambi√©n se establecer√°n y el modo zuru seguir√° activado. <br><br>  Sin embargo, si la versi√≥n est√° en el rango de <code>0x90</code> a <code>0x98</code> , entonces el modo zuru no se activa instant√°neamente.  <code>zurumode_callback</code> la comprobaci√≥n realizada en <code>zurumode_callback</code> : el modo se habilitar√° solo si se establece el bit 25 <em>y</em> <code>padmgr_isConnectedController(1)</code> devuelve un valor distinto de cero. <br><br>  Despu√©s de que el controlador est√° conectado al puerto 2 (el argumento <code>isConnectedController</code> tiene indexaci√≥n cero), se activa el modo zuru.  La letra D y la informaci√≥n sobre el ensamblaje aparecen en la pantalla inicial, y podemos ... ¬°controlar la visualizaci√≥n de la depuraci√≥n utilizando los botones del segundo controlador! <br><br>  Algunos botones realizan acciones que no solo cambian la pantalla, sino que tambi√©n, por ejemplo, aumentan la velocidad del juego. <br><br><h4>  zerucheck_key_check </h4><br>  El √∫ltimo misterio sigue siendo <code>0x4(zuruKeyCheck)</code> .  Resulta que este valor se actualiza con una enorme funci√≥n compleja que mostr√© arriba: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/49e/ca7/1fd/49eca71fdd3cefb01b01c578a93bbe72.png" alt="zerumode_check_keycheck"></div><br>  Usando el depurador del emulador Dolphin, pude determinar que el valor verificado por esta funci√≥n es un conjunto de bits correspondientes a las pulsaciones de bot√≥n en el segundo controlador. <br><br>  El seguimiento de los clics de los botones se almacena en un valor de 16 bits a <code>0x2(zuruKeyCheck)</code> .  Cuando el controlador no est√° conectado, el valor es <code>0x7638</code> . <br><br>  Se descargan 2 bytes que contienen las banderas de las pulsaciones del bot√≥n del controlador y luego se actualizan al comienzo de <code>zerucheck_key_check</code> .  El nuevo valor se pasa con el registro <code>r4</code> funci√≥n <code>padmgr_HandleRetraceMsg</code> cuando llama a la funci√≥n de devoluci√≥n de llamada. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f98/478/318/f984783181e592098f8beef9c22cef23.png" alt="clave de verificaci√≥n final"></div><br>  Cerca del final de <code>zerucheck_key_check</code> hay otro lugar donde <code>0x4(zuruKeyCheck)</code> actualiza <code>0x4(zuruKeyCheck)</code> .        ,       <code>r3</code> ,      <code>r3</code>    ,        . <br><br>   <code>8040ed88</code>  <code>r4</code>   <code>0x4(zuruKeyCheck)</code> .            XOR-  1.    ‚Äî    (    ‚Äî  )  0  1. (  0,   <br> XOR  1  1.   1,    0. .    XOR.) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/048/c32/eb1/048c32eb12dda64c878fa7b9f0bd7ddc.png" alt="clave de verificaci√≥n final"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anteriormente, cuando estudi√© los valores en la memoria, no not√© este comportamiento, pero intentar√© romper esta instrucci√≥n en el depurador para comprender lo que est√° sucediendo. El valor original se carga en </font></font><code>8040ed7c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin tocar los botones del controlador, no llegar√© a este punto de interrupci√≥n en la pantalla inicial. Para entrar en este bloque de c√≥digo, el valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe ser igual </font></font><code>0xb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">antes de la instrucci√≥n de bifurcaci√≥n que va antes del punto de interrupci√≥n ( </font></font><code>8040ed74</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). De los muchos caminos diferentes que conducen a este bloque, solo uno asigna un </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor </font></font><code>0xb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">frente a √©l en la direcci√≥n </font></font><code>8040ed68</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/04c/926/959/04c926959999b5f6facfc8920f6a212f.png" alt="Configuraci√≥n de r5 a 0xb"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tenga en cuenta que para alcanzar el bloque que asigna el </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor </font></font><code>0xB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, el valor </font></font><code>r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe ser igual </font><font style="vertical-align: inherit;">justo antes </font></font><code>0x1000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Siguiendo los bloques en la cadena hasta el comienzo de la funci√≥n, podemos ver todas las restricciones necesarias para lograr este bloque:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8040ed74: el valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe ser igual</font></font><code>0xB</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8040ed60: el valor </font></font><code>r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe ser igual</font></font><code>0x1000</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8040ebe8: el valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe ser igual</font></font><code>0xA</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8040ebe4: el valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe ser menor</font></font><code>0x5B</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8040eba4: el valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe ser mayor</font></font><code>0x7</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8040eb94: el valor </font></font><code>r6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe ser 1</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8040eb5c: el valor </font></font><code>r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no debe ser 0</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8040eb74: los valores del bot√≥n del puerto 2 deber√≠an cambiar </font></font></li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/28e/2fa/9f3/28e2fa9f3d35b1c6146f816120dee72b.png" alt="Rastreando la ruta del c√≥digo"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqu√≠ hemos llegado al punto en el que se cargan los viejos valores de los botones y se guardan los nuevos valores. Luego vienen un par de operaciones aplicadas a los valores nuevos y antiguos: </font><font style="vertical-align: inherit;">la operaci√≥n XOR marca todos los bits que han cambiado entre los dos valores. Luego, la operaci√≥n AND enmascara la nueva entrada para establecer todos los bits que no est√°n configurados actualmente en el estado 0. El resultado </font><font style="vertical-align: inherit;">es un conjunto de bits nuevos (pulsaciones de bot√≥n) en el nuevo valor. Si no est√° vac√≠o, estamos en el camino correcto. </font><font style="vertical-align: inherit;">Para marcar la </font><font style="vertical-align: inherit;">diferencia </font><font style="vertical-align: inherit;">, el cuarto de los botones de seguimiento de 16 bits debe cambiar. Despu√©s de insertar un punto de interrupci√≥n despu√©s de la operaci√≥n XOR / AND, descubr√≠ que el bot√≥n INICIO activa este estado. </font><font style="vertical-align: inherit;">La siguiente pregunta es c√≥mo lograr </font><font style="vertical-align: inherit;">que sea inicialmente igual</font></font><br><br> <code>old_vals = old_vals XOR new_vals <br> old_vals = old_vals AND new_vals</code> <br> <br><font style="vertical-align: inherit;"></font><code>r0</code><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><code>r0</code><font style="vertical-align: inherit;"></font><code>0x1000</code><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><code>r5</code><font style="vertical-align: inherit;"></font><code>0xA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>r6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se cargan desde </font></font><code>0x0(zuruKeyCheck)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el comienzo de la funci√≥n de prueba clave y se actualizan m√°s cerca del final, cuando no ingresamos en el bloque de c√≥digo que incluye </font></font><code>0x4(zuruKeyCheck)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hay varios lugares antes de esto donde </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se asigna </font><font style="vertical-align: inherit;">el </font><font style="vertical-align: inherit;">valor </font></font><code>0xA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><ul><li> <code>8040ed50</code> </li> <li> <code>8040ed00</code> </li> <li> <code>8040ed38</code> </li> </ul><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8040ed38 </font></font></h5><br><ul><li> <code>8040ed34</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: el valor </font></font><code>r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe ser igual </font></font><code>0x4000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font><font style="vertical-align: inherit;">se </font><font style="vertical-align: inherit;">presiona el bot√≥n B)</font></font></li><li> <code>8040ebe0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: el valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe ser igual</font></font><code>0x5b</code> </li><li> <code>8040eba4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: el valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe ser mayor</font></font><code>0x7</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> entonces todo sigue como antes ... </font></font></li></ul><br> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> deber√≠a comenzar con </font></font><code>0x5b</code> <br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8040ed00 </font></font></h5><br><ul><li> <code>8040ecfc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: el valor </font></font><code>r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe ser igual </font></font><code>0xC000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(se presionan A y B)</font></font></li><li> <code>8040ebf8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: el valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe ser&gt; = 9</font></font></li><li> <code>8040ebf0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: el valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe ser inferior a 10</font></font></li><li> <code>8040ebe4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: el valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe ser menor</font></font><code>0x5b</code> </li><li> <code>8040eba4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deber√≠a ser m√°s</font></font><code>0x7</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> entonces todo sigue como antes ... </font></font></li></ul><br> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> deber√≠a comenzar a las 9 </font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8040ed50 </font></font></h5><br><ul><li> <code>8040ed4c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: el valor </font></font><code>r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe ser igual </font></font><code>0x8000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(bot√≥n A presionado)</font></font></li><li> <code>8040ec04</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: el valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe ser menor</font></font><code>0x5d</code> </li><li> <code>8040ebe4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: el valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe ser mayor</font></font><code>0x5b</code> </li><li> <code>8040eba4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: el valor </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe ser mayor</font></font><code>0x7</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> entonces todo sigue como antes ... </font></font></li></ul><br> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deber√≠a comenzar con </font></font><code>0x5c</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parece que hay alg√∫n tipo de estado entre las pulsaciones de teclas, despu√©s de lo cual debe ingresar una cierta secuencia de combos desde los botones, que termina presionando START. </font><font style="vertical-align: inherit;">Parece que A y / o B deber√≠an ir justo antes de INICIAR. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si traza la ruta del c√≥digo que establece el </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor en 9, entonces surge un patr√≥n: </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- es un valor creciente que puede aumentar cuando se encuentra un </font></font><code>r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor adecuado o cero. </font><font style="vertical-align: inherit;">Los casos m√°s extra√±os cuando este no es un valor en el rango de </font></font><code>0x0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font><code>0xB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, se produce cuando se procesan pasos con varios botones, por ejemplo, cuando se presionan simult√°neamente A y B. Una persona que intenta ingresar a este combo generalmente no puede presionar ambos botones exactamente al mismo tiempo mientras rastrea el gamepad, por lo que debe procesar el bot√≥n que se presiona. el primero </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Continuamos explorando diferentes rutas de c√≥digo:</font></font><br><br><ul><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toma el valor 9 cuando se presiona DERECHA en la direcci√≥n </font></font><code>8040ece8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toma el valor 8 cuando se presiona el bot√≥n derecho C en la direcci√≥n </font></font><code>8040eccc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toma el valor 7 cuando se presiona el bot√≥n izquierdo C en la direcci√≥n </font></font><code>8040ecb0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toma el valor 6 cuando se presiona IZQUIERDA en la direcci√≥n </font></font><code>8040ec98</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toma el valor 5 (y r6 toma el valor 1) cuando se presiona ABAJO en la direcci√≥n </font></font><code>8040ec7c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <code>r5</code>   4,     C   <code>8040ec64</code> . </li><li> <code>r5</code>   3,     C   <code>8040ec48</code> . </li><li> <code>r5</code>   2,   UP   <code>8040ec30</code> . </li><li> <code>r5</code>   1 ( <code>r6</code>   1),   Z   <code>8040ec1c</code> . </li></ul><br>    : <br><br> Z, UP, C-DOWN, C-UP, DOWN, LEFT, C-LEFT, C-RIGHT, RIGHT, A+B, START <br><br>   Z    :       Z,      <code>0x2030</code> :         (   <code>0x10</code>  <code>0x20</code> ).  , UP/DOWN/LEFT/RIGHT ‚Äî   D-pad,    . <br><br><h4> - </h4><br>     : <br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sostenga los parachoques L + R y presione Z </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> D-up </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C-ABAJO </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C-up </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> D-down </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> D-izquierda </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C-izquierda </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C-DERECHA </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> D-DERECHA </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A + B </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> START </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Funciona! </font><font style="vertical-align: inherit;">Conecte el controlador al segundo puerto e ingrese el c√≥digo, despu√©s de lo cual aparece la informaci√≥n de depuraci√≥n. </font><font style="vertical-align: inherit;">Despu√©s de eso, puede comenzar a presionar los botones en el segundo (o incluso tercero) controlador para realizar varias acciones. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este combo funcionar√° sin parchear el n√∫mero de versi√≥n del juego. </font><font style="vertical-align: inherit;">Incluso se puede usar en una copia minorista regular del juego sin herramientas de trampa o mods de consola. </font><font style="vertical-align: inherit;">Volver a ingresar combos desactiva el modo zuru.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b4d/fe4/7f0/b4dfe47f0139ba1af039decfb6274524.jpg" alt="Usando el c√≥digo en un GameCube real"></div><br>  ¬´ZURU %d/%d¬ª  <code>zurumode_callback</code>      ,    ,  ID    <code>0x99</code> (,     -).   ‚Äî      ,  <code>r5</code> .    1,     ,    ,  <code>r6</code>   1. <br><br>    ,     ,     ,     . ,            ‚Äî       .   ,   - ,    . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La pantalla negra que se muestra al presionar Z es una consola para mostrar mensajes de depuraci√≥n, espec√≠ficamente para aspectos de bajo nivel, como la asignaci√≥n de memoria, errores de almacenamiento din√°mico y otras malas excepciones. Por comportamiento, </font></font><code>fault_callback_scroll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se puede suponer que se usa para mostrar estos errores antes de que el sistema se reinicie. No inicia ninguno de estos errores, pero puede hacer que impriman un par de caracteres basura con varios NOP. Creo que en el futuro ser√° muy √∫til para mostrar sus propios mensajes de depuraci√≥n:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b06/755/a33/b06755a33e0b0b8b010b7cbff7a26594.png" alt="JUTConsole personajes basura"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despu√©s de hacer todo esto, descubr√≠ que </font><font style="vertical-align: inherit;">otras personas ya conocen </font><font style="vertical-align: inherit;">el modo de depuraci√≥n parcheando el ID de la </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">versi√≥n </font></font><code>0x99</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://tcrf.net/Animal_Crossing#Debug_Mode</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">(Tambi√©n hay buenas notas en el enlace que indican varios mensajes, y habla sobre otras cosas que se pueden hacer con el controlador en el puerto 3.) Sin embargo, hasta donde s√©, nadie ha publicado la combinaci√≥n de trucos todav√≠a.</font></font><br><br>  Eso es todo<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hay otras caracter√≠sticas del desarrollador que me gustar√≠a explorar, como la pantalla de depuraci√≥n de la tarjeta y la pantalla de selecci√≥n del emulador NES, y c√≥mo activarlas sin usar parches. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/258/eb3/445/258eb3445236357c201c343d6c8ae4ba.png" alt="Pantalla de selecci√≥n de mapa"></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adem√°s, publicar√© art√≠culos sobre ingenier√≠a inversa de sistemas de di√°logo, eventos y misiones con el objetivo de crear mods. </font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es413967/">https://habr.com/ru/post/es413967/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es413955/index.html">Ciclo de desarrollo completo del dispositivo IoT para el control de calefacci√≥n de piscinas en el ESP8266 en un entorno Arduino</a></li>
<li><a href="../es413957/index.html">Un ejemplo de creaci√≥n de una aplicaci√≥n deportiva en tiempo real en Node.js</a></li>
<li><a href="../es413959/index.html">Imagen de Docker m√°s peque√±a: menos de 1000 bytes</a></li>
<li><a href="../es413963/index.html">Mini CRM para peque√±as empresas</a></li>
<li><a href="../es413965/index.html">Revisi√≥n de c√≥digo: lo est√°s haciendo mal</a></li>
<li><a href="../es413969/index.html">Technopark Russky: desarrollo innovador de miles de millones de presupuesto</a></li>
<li><a href="../es413971/index.html">M√°s de 10 medios de comunicaci√≥n en ingl√©s para estudiantes de idiomas</a></li>
<li><a href="../es413973/index.html">Evaluaci√≥n de Cavium ThunderX2: El sue√±o del servidor Arm se hace realidad (Parte 2)</a></li>
<li><a href="../es413977/index.html">Creaci√≥n de un sistema de protecci√≥n antivirus ampliado para una peque√±a empresa. Parte 3</a></li>
<li><a href="../es413979/index.html">Mitap "¬øC√≥mo administrar gremios y comunidades?" de Tutu.ru y AgileVerse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>