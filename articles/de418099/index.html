<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§›ğŸ¼ ğŸ‘Ÿ ğŸ¤¶ğŸ¾ MIT-Kurs "Computer Systems Security". Vorlesung 3: PufferÃ¼berlÃ¤ufe: Exploits und Schutz, Teil 3 ğŸ”´ ğŸ‘ğŸ» ğŸ‘¨ğŸ¼â€ğŸ¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Massachusetts Institute of Technology. Vorlesung # 6.858. "Sicherheit von Computersystemen." Nikolai Zeldovich, James Mickens. 2014 Jahr 
 Computer Sy...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>MIT-Kurs "Computer Systems Security". Vorlesung 3: PufferÃ¼berlÃ¤ufe: Exploits und Schutz, Teil 3</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/418099/"><h3>  Massachusetts Institute of Technology.  Vorlesung # 6.858.  "Sicherheit von Computersystemen."  Nikolai Zeldovich, James Mickens.  2014 Jahr </h3><br>  Computer Systems Security ist ein Kurs zur Entwicklung und Implementierung sicherer Computersysteme.  Die VortrÃ¤ge behandeln Bedrohungsmodelle, Angriffe, die die Sicherheit gefÃ¤hrden, und Sicherheitstechniken, die auf jÃ¼ngsten wissenschaftlichen Arbeiten basieren.  Zu den Themen gehÃ¶ren Betriebssystemsicherheit, Funktionen, Informationsflussmanagement, Sprachsicherheit, Netzwerkprotokolle, Hardwaresicherheit und Sicherheit von Webanwendungen. <br><br>  Vorlesung 1: â€EinfÃ¼hrung: Bedrohungsmodelleâ€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 3</a> <br>  Vorlesung 2: â€Kontrolle von Hackerangriffenâ€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 3</a> <br>  Vorlesung 3: â€PufferÃ¼berlÃ¤ufe: Exploits und Schutzâ€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 3</a> <a name="habracut"></a><br><br>  Sie kÃ¶nnen die Technik des Erraten des "Kanarienvogels" fÃ¼r Ihre eigenen Zwecke verwenden, um das Vorhandensein von "schwachen" Bits in Bezug auf die Auswahl herauszufinden.  Das heiÃŸt, wenn Sie richtig geraten haben, wird der Server neu gestartet, und dies dient als Signal fÃ¼r Sie, dass der eingestellte Wert recht einfach zu erraten ist.  Somit ist es mÃ¶glich, die zufÃ¤lligen â€KanarienvÃ¶gelâ€œ zu besiegen, vorausgesetzt, dass sich ihr Wert nach dem Neustart des Servers nicht Ã¤ndert.  Sie kÃ¶nnen auch Gadgets verwenden, um eine verwandte Folge mehrerer Angriffe zu implementieren. <br><br>  Als nÃ¤chstes werden wir uns eine produktivere Methode ansehen, mit der Sie alle diese Methoden verwenden kÃ¶nnen, um die Verhinderung der DatenausfÃ¼hrung, zufÃ¤llige AdressrÃ¤ume und â€KanarienvÃ¶gelâ€œ zu umgehen. <br><br>  Wenden wir uns 64-Bit-Architekturen anstelle von 32-Bit-Architekturen zu.  Die ersteren eignen sich besser fÃ¼r die Randomisierung, sodass Sie viel mehr â€Chanceâ€œ haben, sich gegen einen Hacker zu verteidigen.  Und diese Systeme sehen im Hinblick auf die Angriffsbildung viel interessanter aus. <br><br>  Diese Art der 64-Bit-Architektur wurde auch aus Sicht von <b>BROP</b> , der "blinden" rÃ¼ckwÃ¤rtsorientierten Programmierung, betrachtet.  Der Einfachheit halber nehmen wir an, dass der einzige Unterschied zwischen 64-Bit- und 32-Bit-Maschinen darin besteht, dass auf einer 64-Bit-Maschine Argumente an die Register und fÃ¼r eine 32-Bit-Maschine an den Stapel Ã¼bergeben werden. <br><br><img src="https://habrastorage.org/webt/hg/z1/jc/hgz1jcij9zzqbaqc3fiztx1ctze.jpeg"><br><br>  Wenn eine Funktion mit der AusfÃ¼hrung beginnt, wird nach bestimmten Registern gesucht, um herauszufinden, wo sich die Argumente befinden. <br><br>  Kommen wir nun zum Kern des heutigen Vortrags - was ist Blind Return-orientiertes Programmieren oder <b>BROP?</b>  Das erste, was wir tun werden, ist ein Stopp-Gadget zu finden.  Denken Sie daran, dass wir mit "Gadget" im Wesentlichen Absenderadressen meinen.  Das Gadget wird mit der Absenderadresse identifiziert, der Startadresse der Befehlsfolge, zu der wir gehen mÃ¶chten.  Was ist ein Stopp-Gadget? <br><br>  Im Wesentlichen ist dies die Absenderadresse an einer Stelle im Code. Wenn Sie jedoch dorthin springen, halten Sie das Programm einfach an, ohne dass das Programm abstÃ¼rzt.  Aus diesem Grund wird dies als Stopp-Gadget bezeichnet. <br><br>  Sie kÃ¶nnten an eine Stelle im Code springen, die dann einen Aufruf des Schlafsystems oder Pausen oder Ã¤hnliches auslÃ¶st.  Es ist mÃ¶glich, dass das Programm in einer Endlosschleife â€hÃ¤ngen bleibtâ€œ, wenn Sie an diesen Ort springen.  Es spielt keine Rolle, warum der Stopp auftritt, aber Sie kÃ¶nnen sich einige Szenarien vorstellen, die dazu fÃ¼hren wÃ¼rden. <br><br>  Was nÃ¼tzt ein Stopp-Gadget? <br><br>  Sobald es dem Angreifer gelungen ist, den â€Kanarienvogelâ€œ mithilfe der interaktiven Technik des Erraten von Bits zu besiegen, kann er beginnen, diese Absenderadresse und <b>Ret-Adresse</b> neu zu schreiben und das Stopp-Gadget zu â€tappenâ€œ.  Beachten Sie, dass die meisten zufÃ¤lligen Adressen, die Sie auf dem Stapel platzieren kÃ¶nnen, wahrscheinlich einfach zum Absturz des Servers fÃ¼hren.  Auch diese Nachricht ist fÃ¼r Sie, den Angreifer, ein Hinweis darauf, dass das, was Sie gefunden haben, kein Stopp-Gadget ist.  Denn wenn der Server abstÃ¼rzt, wird Ihr Socket geschlossen und Sie als Angreifer verstehen, dass Sie nicht auf das Stopp-Gadget gekommen sind.  Aber wenn Sie etwas erraten haben und die Steckdose danach noch eine Weile offen bleibt, denken Sie: "Ja, ich habe dieses Stopp-Gadget gefunden!"  Die Grundidee des ersten Schritts besteht also darin, dieses Stopp-Gadget zu finden. <br><br><img src="https://habrastorage.org/webt/xb/af/zx/xbafzxirvhgep_31ahp8fuzpey4.jpeg"><br><br>  Schritt zwei ist, dass Sie Gadgets suchen mÃ¶chten, die StapeleintrÃ¤ge mit dem Befehl <b>pop</b> lÃ¶schen.  Verwenden Sie daher diese Abfolge sorgfÃ¤ltig gestalteter Anweisungen, um herauszufinden, wann Sie eines dieser Stapel-Gadgets greifen.  Diese Sequenz besteht aus der <b>Sondenadresse der Sondenadresse</b> , der <b>Stoppadresse der Stoppadresse</b> und der Systemfehleradresse <b>der Absturzadresse</b> . <br><br>  Daher wird die <b>Sondenadresse</b> auf den Stapel gelegt.  Dies ist die Adresse des potenziellen Gadgets zum LÃ¶schen des Stapels, <b>Stoppadresse</b> - dies haben wir im ersten Schritt berÃ¼cksichtigt, dies ist die Adresse des Stopp-Gadgets.  Die <b>Absturzadresse ist</b> dann einfach die Adresse des nicht ausfÃ¼hrbaren Codes.  Hier kÃ¶nnen Sie einfach die Nulladresse (0 x 0) eingeben. Wenn Sie die <b>Ret-</b> Funktion auf diese Adresse anwenden und versuchen, den Code dort auszufÃ¼hren, fÃ¼hrt dies zu einem Programmabsturz. <br><br><img src="https://habrastorage.org/webt/38/fa/ba/38fabavrj2kahtqh0_ruuxiigaa.jpeg"><br><br>  Wir kÃ¶nnen diese Arten von Adressen verwenden, um herauszufinden, wo diese Gadgets den <b>Stack-Popping-Stack</b> bereinigen. <br><br>  Ich werde ein einfaches Beispiel geben.  Angenommen, wir haben zwei verschiedene <b>Sondenbeispiele</b> , die <b>Fallenfalle</b> und die <b>Stoppfalle</b> .  Angenommen, wir werden mit Hilfe der <b>Sonde</b> eine Adresse "prÃ¼fen". Angenommen, sie beginnt mit 4 und endet mit acht: 0x4 ... 8, und dahinter befindet sich die nÃ¤chste Adresse der Form 0x4 ... C.  Hypothetisch kÃ¶nnen wir annehmen, dass eine dieser beiden Adressen die Adresse des <b>Stack-Popping-</b> Gadgets ist. <br><br>  Die <b>Trap-Trap</b> erhÃ¤lt die Nulladressen 0x0 und 0x0 und lÃ¤sst das <b>Stop-</b> Gadget- <b>Stop</b> beliebige Adressen wie 0xS ... 0xS ... haben, das spielt keine Rolle.  Dieses Stopp-Gadget zeigt auf den Code sleep (10), wodurch das Programm angehalten wird. <br><br>  Beginnen wir mit der <b>Sondenoperation</b> , bei der ein Register gelÃ¶scht und in der folgenden Reihenfolge zurÃ¼ckgegeben wird: <b>pop rax;</b>  <b>ret</b> .  Was wird passieren?  Wenn das System zu dieser Adresse springt, bewegt sich der Stapelzeiger in die Mitte unseres Gadgets.  Was wird das Gadget hier tun?  Richtig, fÃ¼hren Sie eine <b>Pop-Rax-</b> Operation durch. <br><br><img src="https://habrastorage.org/webt/i2/eu/zr/i2euzrwlujsohfb4dl-szdeasac.jpeg"><br><br>  Und dann folgt <b>ret</b> , wodurch die Funktion in die oberste Zeile des Gadgets verschoben wird, dh <b>gestoppt wird</b> , und die Funktion stoppt, ohne das gesamte Programm zum Absturz zu bringen.  Mit diesem Gadget kann ein Angreifer also sagen, dass die Testadresse zu einer dieser Funktionen gehÃ¶rt, wodurch der Stapel gelÃ¶scht wird, da die Server-Client-Verbindung offen ist. <br><br>  Nehmen wir nun an, dass die zweite <b>Sondenadresse</b> fÃ¼r ein Register auf etwas wie <b>xor rax, rax, ret zeigte</b> . <br><br><img src="https://habrastorage.org/webt/kw/5t/r3/kw5tr3vdtrqedphe0onl6ec-wa0.jpeg"><br><br>  Was passiert also, wenn wir versuchen, zu diesem Gadget zu springen?  Beachten Sie, dass nichts auf dem Stapel gelÃ¶scht wird, sondern nur der Inhalt der Register geÃ¤ndert wird.  Wir werden also zu der oben angegebenen 0x0-Adresse zurÃ¼ckkehren.  Dies fÃ¼hrt zum Absturz des Systems.  Die Client-Verbindung zum Server wird unterbrochen, und der Hacker wird verstehen, dass dies kein Gadget zum LÃ¶schen des Stapelstapels ist. <br><br>  Auf diese Weise kÃ¶nnen Sie eine bizarrere Reihe von Fallen verwenden und Gadgets stoppen. Sie kÃ¶nnen beispielsweise zwei Elemente auf dem Stapel lÃ¶schen.  Dazu mÃ¼ssen Sie hier nur eine weitere <b>Trap-</b> Anweisung einfÃ¼gen. Wenn dieses Gadget nicht zwei Elemente lÃ¶scht, befinden Sie sich in einer dieser Traps, und der Code wird nicht mehr ausgefÃ¼hrt.  Die Materialien fÃ¼r die Vorlesung beschreiben ein sogenanntes <b>BROP-Gadget,</b> das nÃ¼tzlich ist, wenn Sie nicht zur Programmierung zurÃ¼ckkehren <b>mÃ¶chten</b> .  Aber heute werde ich Ihnen auch sagen, wie Sie diese einfachen <b>Pop-</b> Gadgets verwenden kÃ¶nnen, um einen Ã¤hnlichen Angriff zu starten.  Sobald Sie dies verstanden haben, wird der Umgang mit einem <b>BROP-Gadget</b> viel einfacher. <br><br>  Aber verstehen Sie alle, wie wir die <b>Sondenfunktion</b> fÃ¼r diese GerÃ¤te verwenden kÃ¶nnen?  Angenommen, Sie finden die Position der Codefragmente, mit denen Sie den Stapel mit der <b>Pop-</b> Funktion lÃ¶schen und ein Element daraus entfernen kÃ¶nnen. Sie wissen jedoch nicht genau, in welchem â€‹â€‹Register diese <b>Pop-</b> Funktion funktioniert.  Sie wissen nur, dass sie bereits zur Hinrichtung bereit ist.  Sie mÃ¼ssen jedoch wissen, in welchem â€‹â€‹Register diese <b>Pop-</b> Gadgets funktionieren, da in einer 64-Bit-Architektur die Register steuern, wo sich die Argumente der Funktion befinden, die Sie aufrufen mÃ¶chten. <br><br>  Unser Ziel ist es daher, Gadgets zu erstellen, mit denen wir die Werte lÃ¶schen kÃ¶nnen, die wir in bestimmte Stapelregister eingegeben haben, und schlieÃŸlich einen Systemaufruf-Systemaufruf initiieren, mit dem wir etwas Schlechtes tun kÃ¶nnen. <br>  Jetzt mÃ¼ssen wir bestimmen, welche Register von <b>Pop-</b> Gadgets verwendet werden. <br><br><img src="https://habrastorage.org/webt/xp/w-/hw/xpw-hw9rdgd2argq0yx6xgi3ece.jpeg"><br><br>  Dazu kÃ¶nnen wir den Systemaufruf pausieren.  Wenn der Systemaufruf angehalten wird, wird die AusfÃ¼hrung des Programms angehalten und es werden keine Argumente akzeptiert.  Und das bedeutet, dass das System alles in den Registern ignoriert. <br><br>  Um die Pause-Anweisung zu finden, die wir ausfÃ¼hren, kÃ¶nnen Sie alle diese <b>Pop-</b> Gadgets verknÃ¼pfen, damit wir sie alle auf den Stapel legen kÃ¶nnen, und zwischen jedem von ihnen <b>fÃ¼gen</b> wir <b>eine Syscall-Nummer ein,</b> um anzuhalten.  Dann werden wir sehen, ob wir das Programm auf diese Weise "aussetzen" kÃ¶nnen.  Lassen Sie mich Ihnen ein konkretes Beispiel geben. <br><br>  Hier fÃ¼gen wir ein Gadget in die RÃ¼cksendeadressenleiste ein, das die <b>RDI-</b> Register lÃ¶scht und die <b>Ret-</b> Funktion auf sie anwendet.  DarÃ¼ber setzen wir eine <b>Syscall-Nummer,</b> um anzuhalten. <br><br>  Angenommen, wir haben ein weiteres Gadget darÃ¼ber, das die <b>Pop-</b> Funktion in einem anderen Register implementiert, z. B. <b>RSI</b> , und dann <b>ret</b> .  Und dann setzen wir die <b>Syscall-Nummer</b> erneut, um anzuhalten.  Und wir tun dies fÃ¼r alle Gadgets, die wir gefunden haben, und landen dann oben auf dem Stapel mit der mutmaÃŸlichen Adresse fÃ¼r <b>syscall</b> . <br><br><img src="https://habrastorage.org/webt/qd/yx/3v/qdyx3vymmlc13o-sceyeimho_ro.jpeg"><br><br>  Erinnern Sie sich noch einmal daran, wie Sie diese Systemaufrufe verwenden.  Sie mÃ¼ssen die <b>Syscall-Nummer</b> in das <b>RAX-</b> Register eintragen und dann die <b>libc-Syscall-</b> Funktion aufrufen, die den angeforderten Systemaufruf ausfÃ¼hren soll. <br><br>  Was passiert also, wenn wir diesen Code ausfÃ¼hren?  Wir werden hierher kommen, zur <b>Ret-Adresszeile</b> , wir werden zur Adresse dieses Gadgets springen. Es sollte beachtet werden, dass der Angreifer weiÃŸ, dass dieses Gadget auf der rechten Seite etwas vom Stapel entfernt, aber noch nicht weiÃŸ, in welchem â€‹â€‹Register es sich befindet. <br><br>  Was passiert also, wenn wir zur <b>Ret-Adresse</b> springen?  Er wird die <b>Pop-</b> Funktion verwenden, um den <b>Systemaufruf</b> in einem Register <b>anzuhalten</b> , das dem Angreifer nicht bekannt ist, und dann werden wir diese Kette von Operationen weiter den Stapel hinaufklettern. <br><br>  Wir hoffen, dass eines dieser Gadgets die <b>Pop-</b> Funktion fÃ¼r die <b>Syscall-Nummer</b> im entsprechenden <b>RAX-</b> Register ausfÃ¼hrt.  Bis wir hier oben auf dem Stapel ankommen und alle Register "durcheinander bringen", die eine <b>Syscall-Nummer</b> zum Anhalten haben, hoffen wir, dass wir noch ein Register haben, das korrekt sein sollte.  Denn wenn eines unserer GerÃ¤te dies tut und wir dann nach einer Weile nach oben zurÃ¼ckkehren, werden wir eine Pause einlegen, wenn wir <b>ret</b> ausfÃ¼hren.  Die Pause dient erneut als Signal an den Angreifer.  Denn wenn diese angenommene Adresse fÃ¼r <b>syscall</b> falsch war, <b>schlÃ¤gt</b> das Programm fehl. <br><br>  Was erlaubt uns also, diese Angriffsphase durchzufÃ¼hren?  Wir wissen immer noch nicht, in welchen Registern sich welche <b>Pop-</b> Gadgets befinden, aber wir wissen, dass eines davon den <b>RAX freigibt</b> , den wir steuern mÃ¶chten.  Und wir kennen wahrscheinlich die <b>Syscall-</b> Adresse, weil wir es geschafft haben, das System <b>anzuhalten</b> . <br><br>  Sobald wir dies getan haben, kÃ¶nnen wir diese Gadgets einzeln Ã¼berprÃ¼fen und herausfinden, welches das System pausiert.  Mit anderen Worten, wir schneiden alles zwischen der <b>Ret-Adresszeile</b> und der Oberseite des Stapels ab, um direkt zum <b>Systemaufruf zu gelangen</b> .  Wir werden prÃ¼fen, ob eine Pause oder ein Systemfehler aufgetreten ist.  Wenn ein Fehler auftritt, identifizieren wir das Gadget, das ihn verursacht hat. Beispiel: In der unteren Zeile rechts befindet sich <b>pop rdi</b> .  Werde ihn los und versuche den nÃ¤chsten.  Geben Sie hier in die Zeile Ã¼ber der <b>Ret-Adresse die</b> tatsÃ¤chliche Adresse fÃ¼r <b>syscall ein</b> .  KÃ¶nnten wir das Programm anhalten?  Ja, das heiÃŸt, wir haben gelernt, dass dieses <b>Pop-</b> Gadget <b>RAX</b> freigeben sollte.  Das ist klar? <br><br>  <b>Teilnehmerin:</b> Eine MÃ¶glichkeit, die Adresse fÃ¼r einen Systemaufruf zu erraten, ist also nur eine blinde Ãœbertragung von Gadgets? <br><br>  <b>Professor:</b> Ja, und es gibt MÃ¶glichkeiten, diesen Prozess in den Vorlesungsmaterialien zu optimieren, wenn Sie die <b>PLT-</b> Dateierweiterung und Ã¤hnliche Dinge verwenden.  Mit dem einfachen Angriff, den ich beschrieben habe, fÃ¼gen Sie einfach die Adresse hier ein und stellen sicher, ob sie eine Pause verursacht hat oder nicht.  Als Ergebnis des Tests ermitteln wir den Standort von <b>syscall</b> .  Wir werden herausfinden, wo sich die Anweisung befindet, die <b>Pop RAX</b> ausfÃ¼hrt.  Wir brauchen auch Gadgets, die <b>Pop auch</b> in einigen anderen Registern ausfÃ¼hren.  Sie kÃ¶nnen Ã¤hnliche Tests fÃ¼r sie durchfÃ¼hren.  Verwenden <b>Sie</b> daher anstatt die <b>Syscall-Nummer anzuhalten</b> , <b>push</b> fÃ¼r einen anderen Befehl, der beispielsweise die Argumente <b>RAX</b> und <b>RDI verwendet</b> . <br><br>  Sie kÃ¶nnen also die Tatsache nutzen, dass es fÃ¼r einen bestimmten Satz von Registern, die Sie steuern mÃ¶chten, eine Art <b>Systemaufruf</b> gibt, der einem Angreifer ein Signal gibt, um herauszufinden, ob Sie ihn erfolgreich gebrochen haben oder nicht.  Am Ende dieser Phase haben Sie also die <b>Syscall-</b> Adresse und die Gadget-Heap-Adresse, mit denen Sie beliebige Register einfÃ¼gen kÃ¶nnen. <br><br>  Und jetzt gehen wir zum vierten Schritt Ã¼ber, der als <b>Schreibaufzeichnung bezeichnet wird</b> .  Der vierte Schritt ist das Aufzeichnen eines Systemaufrufs.  Um <b>write</b> aufrufen zu kÃ¶nnen, benÃ¶tigen wir die folgenden Gadgets: <br><br>  <b>pop rdi, ret;</b> <b><br></b>  <b>pop rsi, ret;</b> <b><br></b>  <b>pop rdx, ret;</b> <b><br></b>  <b>Pop Rax, ret;</b> <b><br></b>  <b>syscall</b> <br><br><img src="https://habrastorage.org/webt/kj/1h/ds/kj1hdsjhh1509eliv3vjxte7nw4.jpeg"><br><br>  Wie werden diese Register von einem Systemaufruf verwendet?  Der erste ist der Socket oder allgemeiner der Dateideskriptor, den Sie zum Schreiben Ã¼bertragen mÃ¶chten.  Der zweite ist der Puffer, der dritte ist die LÃ¤nge dieses Puffers, der vierte ist die <b>Systemrufnummer</b> und der fÃ¼nfte ist der Systemaufruf selbst. <br><br>  Wenn wir also alle diese Gadgets finden, kÃ¶nnen wir die Werte steuern, die in die Argumente eingebettet sind, die wiederum in diesen Registern abgelegt werden, weil wir sie einfach auf den Stapel â€geschobenâ€œ haben. <br><br>  Was soll eine Steckdose sein?  Hier mÃ¼ssen wir ein wenig raten.  Sie kÃ¶nnen die Tatsache nutzen, dass Linux die Anzahl der gleichzeitig geÃ¶ffneten Verbindungen fÃ¼r eine Datei begrenzt, die einen Wert von 2024 erreicht. AuÃŸerdem sollte dies das Minimum aller verfÃ¼gbaren sein. <br><br>  Ich frage mich, was wir in den Pufferzeiger einfÃ¼gen werden.  Das ist richtig, wir beabsichtigen, das Textfragment des Programms hier zu verwenden, wir werden es irgendwo im Programmcode in einen Zeiger setzen.  Dies ermÃ¶glicht es uns, die BinÃ¤rdatei mit dem richtigen Client-Aufruf vom Socket aus dem Speicher zu lesen.  Dann kann der Angreifer diese BinÃ¤rdatei nehmen, offline offline analysieren und mithilfe von <b>GDB</b> oder einem anderen Tool herausfinden, wo sich all dies befindet.  Der Angreifer weiÃŸ, dass jetzt jedes Mal, wenn der Server "abstÃ¼rzt", die gleichen zufÃ¤lligen Dinge darin gespeichert werden.  Nachdem ein Angreifer nun die Adressen und Offsets fÃ¼r den Inhalt des Stapels ermittelt hat, kann er diese Gadgets direkt angreifen.  Es kann andere Schwachstellen direkt angreifen, herausfinden, wie die Shell geÃ¶ffnet werden kann und dergleichen.  Mit anderen Worten, an dem Ort, an dem Sie die BinÃ¤rdatei mit dem Hacker versehen haben, wurden Sie besiegt. <br><br>  So funktioniert der <b>BROP-</b> Angriff.  Wie gesagt, in den Vorlesungsmaterialien gibt es viele MÃ¶glichkeiten, diese Prozesse zu optimieren, aber zuerst mÃ¼ssen Sie das Hauptmaterial verstehen, sonst verliert die Optimierung ihre Bedeutung.  Daher kÃ¶nnen Sie mit mir einzeln oder nach dem Unterricht Ã¼ber Optimierung sprechen. <br><br>  Im <b>Moment</b> genÃ¼gt es zu sagen, dass dies die Grundlagen dafÃ¼r sind, wie Sie einen <b>BROP-</b> Angriff starten <b>kÃ¶nnen</b> .  Sie mÃ¼ssen das <b>Stopp-</b> Gadget finden, die Gadgets finden, die die Funktion von <b>Pop-</b> Stack-EintrÃ¤gen ausfÃ¼hren, herausfinden, in welchen Registern sie sich befinden, wo sich <b>syscall befindet</b> , und dann basierend auf den erhaltenen Informationen den <b>Schreibvorgang</b> einleiten. <br><br><img src="https://habrastorage.org/webt/xb/-q/iq/xb-qiqqwytbciwpbxiow5i_fovi.jpeg"><br><br>  Gehen Sie also schnell das Thema durch, wie verteidigen Sie sich gegen <b>BROP</b> ?  Das offensichtlichste, was Sie haben, ist die Re-Randomisierung.  Da die Tatsache, dass "heruntergefallene" Server nicht wieder erscheinen und keine zufÃ¤lligen Versionen von sich selbst erstellen, als Signal fungiert, das einem Angreifer die MÃ¶glichkeit gibt, verschiedene Hypothesen Ã¼ber die Funktionsweise von Programmen zu testen. <br><br>  Eine einfache MÃ¶glichkeit, sich zu schÃ¼tzen, besteht darin, bei der Wiederbelebung Ihres Prozesses sicherzustellen, dass Sie <b>Exec</b> anstelle von <b>Fork</b> ausfÃ¼hren.  Denn wenn Sie den Prozess ausfÃ¼hren, erstellen Sie einen vÃ¶llig neuen, zufÃ¤llig angeordneten Speicherplatz, zumindest geschieht dies unter Linux.  Wenn Sie unter Linux mit <b>PIE</b> , <b>Position Independent Execution</b> , einer standortunabhÃ¤ngigen ausfÃ¼hrbaren Datei, kompilieren, erhalten Sie bei Verwendung von <b>exec</b> nur einen neuen zufÃ¤lligen Adressraum. <br><br>  Der zweite Weg ist einfach die Verwendung von Windows, da dieses Betriebssystem im Grunde nicht das Ã„quivalent einer <b>Gabelfunktion</b> hat.  Dies bedeutet, dass ein Server unter Windows unter Windows immer einen neuen zufÃ¤lligen Adressraum hat. <br><br>  Jemand hier fragte, was passieren wÃ¼rde, wenn er nach einer ServerstÃ¶rung die Verbindung nicht trennen wÃ¼rde.  Wenn wir also wÃ¤hrend eines Serverabsturzes diesen Fehler irgendwie â€abfangenâ€œ und die Verbindung fÃ¼r eine Weile offen halten, kÃ¶nnen wir den Angreifer verwirren, sodass er kein Signal Ã¼ber den Fehler erhÃ¤lt und denkt, dass er die richtige Adresse gefunden hat. <br><br>  In diesem Fall wird Ihr <b>BROP-</b> Angriff zu einem <b>DOS-</b> Angriff.  Weil du gerade alle mÃ¶glichen Zombie-Prozesse hast, die es gibt.  Sie sind nutzlos, aber Sie kÃ¶nnen sie nicht weiter gehen lassen, sonst mÃ¼ssen Sie diese Informationen lÃ¶schen. <br><br>  Eine andere Sache, an die Sie denken kÃ¶nnten, ist die Grenzkontrolle, Ã¼ber die wir zuvor gesprochen haben.  Die Materialien der Vorlesung besagen, dass diese Methode unproduktiv ist, da sie doppelt so teuer ist, aber Sie sie trotzdem verwenden kÃ¶nnten. <br><br>  So funktioniert <b>BROP</b> .  Bei den Hausaufgaben wird dort eine heikle Frage gestellt: Was ist, wenn Sie einen Hash der aktuellen Zeit verwenden?  Das heiÃŸt, die Zeitspanne, in der Sie das Programm neu starten.  Reicht das aus, um diese Art von Angriff zu verhindern?  Beachten Sie, dass Sie durch Hashing nicht auf magische Weise Entropiebits erhalten, wenn die Daten, die Sie in den Hash eingeben, leicht vorhersehbar sind.  Wenn Ihr Hash Milliarden von Bits enthÃ¤lt, spielt das keine Rolle.  Aber wenn Sie dort nur ein paar Bedeutungen haben, wird der Angreifer sie nur erraten.  NatÃ¼rlich ist es besser, einen zufÃ¤lligen Zeit-Hash zu verwenden, als nichts zum Schutz vor einem Hacker zu verwenden, aber dies bietet Ihnen nicht die Sicherheit, auf die Sie zÃ¤hlen sollten. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/xSQxaie_h1o" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Die Vollversion des Kurses finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br>  Vielen Dank fÃ¼r Ihren Aufenthalt bei uns.  GefÃ¤llt dir unser Artikel?  MÃ¶chten Sie weitere interessante Materialien sehen?  UnterstÃ¼tzen Sie uns, indem Sie eine Bestellung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">aufgeben</a> oder sie Ihren Freunden empfehlen. <b>Habr-Benutzer erhalten 30% Rabatt auf ein einzigartiges Analogon von Einstiegsservern, das wir fÃ¼r Sie erfunden haben:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die ganze Wahrheit Ã¼ber VPS (KVM) E5-2650 v4 (6 Kerne) 10 GB DDR4 240 GB SSD 1 Gbit / s $ 20 oder wie teilt man den Server?</a>  (Optionen sind mit RAID1 und RAID10, bis zu 24 Kernen und bis zu 40 GB DDR4 verfÃ¼gbar). <br><br>  <b>Dell R730xd 2 mal gÃ¼nstiger?</b>  Nur wir haben <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2 x Intel Dodeca-Core Xeon E5-2650v4 128 GB DDR4 6 x 480 GB SSD 1 Gbit / s 100 TV von 249 US-Dollar</a> in den Niederlanden und den USA!</b>  Lesen Sie mehr Ã¼ber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">den Aufbau eines InfrastrukturgebÃ¤udes.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Klasse mit Dell R730xd E5-2650 v4 Servern fÃ¼r 9.000 Euro fÃ¼r einen Cent?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de418099/">https://habr.com/ru/post/de418099/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de418087/index.html">80% der Selbstbedienungskassen sind gefÃ¤hrdet</a></li>
<li><a href="../de418089/index.html">SolidCraft CNC-FrÃ¤smaschine Ãœbersicht</a></li>
<li><a href="../de418091/index.html">Liste der Artikel und Literatur zu NAS</a></li>
<li><a href="../de418093/index.html">MIT-Kurs "Computer Systems Security". Vorlesung 3: PufferÃ¼berlÃ¤ufe: Exploits und Schutz, Teil 2</a></li>
<li><a href="../de418095/index.html">Ãœber das GerÃ¤t der eingebauten TestfunktionalitÃ¤t in Rust (Ãœbersetzung)</a></li>
<li><a href="../de418101/index.html">Etymologie der IT-Begriffe</a></li>
<li><a href="../de418103/index.html">Der Chef von Roscosmos erinnerte sich an seine erste Rakete und teilte PlÃ¤ne fÃ¼r die Zukunft</a></li>
<li><a href="../de418105/index.html">Warum das Ã–ffnen von YouTube in Firefox oder Edge fÃ¼nfmal lÃ¤nger dauern kann als in Google Chrome</a></li>
<li><a href="../de418107/index.html">Festlegen eines PrÃ¤fixes fÃ¼r den MINDEO CS2190-Scanner fÃ¼r die Arbeit mit 1C im Tastaturunterbrechungsmodus</a></li>
<li><a href="../de418111/index.html">Modernes Online-Lernen: Herausforderungen und Trends</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>