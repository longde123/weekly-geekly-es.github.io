<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîí ü•ê ü§Ωüèª Connexion d'un capteur de CO2 mod√®le MH-Z19B √† l'aide de la sortie analogique Vo üë®‚Äçüë©‚Äçüëß‚Äçüë¶ üë®üèæ ‚ôåÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je souhaite la bienvenue √† tous ceux qui s'int√©ressent √† la qualit√© de l'air int√©rieur et souhaitent la contr√¥ler et la g√©rer. 

 Je me suis moi-m√™me ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Connexion d'un capteur de CO2 mod√®le MH-Z19B √† l'aide de la sortie analogique Vo</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483826/">  Je souhaite la bienvenue √† tous ceux qui s'int√©ressent √† la qualit√© de l'air int√©rieur et souhaitent la contr√¥ler et la g√©rer. <br><br>  Je me suis moi-m√™me int√©ress√© r√©cemment √† ce probl√®me et j'ai d√©cid√© de ressentir le capteur de CO2 MH-Z19 <b>B</b> de mes propres mains.  J'ai √©t√© inspir√© par de nombreux articles, par exemple le <a href="https://habr.com/ru/post/401363/">c√¥t√© obscur du MH-Z19</a> . <br><br><img src="https://habrastorage.org/webt/hk/sv/tw/hksvtwktoevk387m2o4pgacbrrw.jpeg"><br><br>  Cependant, nulle part (m√™me dans les instructions) je n'ai pas trouv√© comment travailler avec la broche Vo ... <br><a name="habracut"></a><br>  J'ai attir√© l'attention sur ceci: dans l'article <a href="https://habr.com/ru/post/391157/">Pr√©sentation du capteur de CO2 infrarouge MH-Z19</a> , ce point est mentionn√©: <br><br><ul><li>  Vo - tension de sortie 3,3 V, pas plus de 10 mA </li></ul><br>  Certains magasins en ligne, tels que le ¬´ <a href="https://radiosfera.org/catalog/datchiki/856/">capteur de dioxyde de carbone CO2 MH-Z19B</a> ¬ª, <a href="https://radiosfera.org/catalog/datchiki/856/">fournissent</a> des informations similaires: <br><br><ul><li>  Vo - tension de sortie 3,3 V, pas plus de 10 mA </li></ul><br>  (en tant que copie carbone) <br><br>  Mais les instructions ( <a href="https://www.winsen-sensor.com/d/files/infrared-gas-sensor/mh-z19b-co2-ver1_0.pdf">ici</a> ) en indiquent un peu plus: <br><br><ul><li>  Vo <b>Sortie analogique</b> (0,4 ÔΩû 2 V) ou (0 ~ 2,5 V) </li></ul><br>  Et si vous creusez plus, les instructions ( <a href="https://doc.platan.ru/pdf/datasheets/winsensor/MH-Z19B.pdf">ici</a> ) indiquent encore plus en d√©tail: <br><br><ul><li>  Vo (Pin2) - <b>Sortie analogique</b> (0,4 ÔΩû 2 V) (la plage 0 ~ 3 V peut √™tre personnalis√©e) </li></ul><br>  J'ai rapidement googl√© et ... je n'ai rien trouv√© sur cette issue!  √âtrange, pensa Stirlitz, a rapidement connect√© cette sortie √† l'entr√©e analogique de l'ESP8266 (pour Arduino, cela est √©galement pertinent) et a commenc√© √† rechercher. <br><br>  Conclusions: <br><br><ol><li>  La tension √† la sortie analogique varie de 0.4xx √† 2.002v. </li><li>  La sortie analogique r√©p√®te la tension du signal num√©rique ppm. </li><li>  Lorsque les commandes UART modifient la plage ppm 2k, 5k, 10k, la plage de conversion Vo change en cons√©quence. </li><li>  La valeur maximale de Vo = 2.001v ne change pas en fonction de la plage, car la plage de conversion, vous devez d√©finir la valeur maximale en ppm (2/5 / 10k). </li><li>  La valeur minimale de Vo varie en fonction de la plage (?), Et la plage elle-m√™me commence √† 400 ppm. </li><li>  Si vous s√©lectionnez la valeur r√©elle du contr√¥leur ADC, vous pouvez obtenir une correspondance d√©cente entre la tension et le niveau ppm.  Dans la plage allant jusqu'√† 2k, l'erreur entre le signal UART num√©rique et la conversion Vo analogique ne d√©passe pas plusieurs unit√©s ppm. </li><li>  Vous pouvez d'abord configurer le capteur en utilisant le convertisseur USB-TTL ou en utilisant Arduino + (d√©sactiver l'√©talonnage automatique et basculer 400 ... 2000ppm sur la plage "home"), puis travailler avec lui comme un signal analogique. </li></ol><br>  Comment je me suis converti: <br><br><pre><code class="1c hljs">[...] const word cADC00v = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ADC = 3 .  0.0v const word cADC04v2k = 235; // ADC = 235 .  400ppm @2k const word cADC04v5k = 174; // ADC = 174 .  400ppm @5k const word cADC04v1k = 153; // ADC = 153 .  400ppm @10k const word cADC20v = 646; // ADC = 646 6.  2.0v word ADC = analogRead(A0); //  10  ADC 0...1023 long Vin = map(ADC, cADC00v, cADC20v, 0, 2001); //  0..3,3v  ,   2,001v long ppm_2k_04_2 = map(ADC, cADC04v2k,cADC20v, 400, 2000); //  Vo  ppm   2k long ppm_5k_04_2 = map(ADC, cADC04v5k,cADC20v, 400, 5000); //  Vo  ppm   5k long ppm_10k_04_2 = map(ADC, cADC04v1k,cADC20v, 400,10000); //  Vo  ppm   10k [...]</span></span></code> </pre> <br>  Les nombres "magiques" ont √©t√© r√©cup√©r√©s exp√©rimentalement.  C'est arriv√© √† la fois plus rapidement et plus pr√©cis√©ment.  En essayant de calculer tr√®s pr√©cis√©ment, math√©matiquement, une grosse erreur s'est av√©r√©e. <br><br>  Pourquoi √ßa marche pour moi (0.4 ... 2.0v et pas 0 ... 2.5v) je ne sais pas.  Le capteur a √©t√© achet√© il y a quelques jours, production le 26 septembre 2019.  La plage jusqu'√† 5 000 ppm est grav√©e sur le bo√Ætier. <br><br>  Pourquoi en ai-je besoin?  (la r√©ponse √† "donc j'aurais mal fait ...") <br><br>  Eh bien ... il y a des gens qui aiment tenir un fer √† souder dans leurs mains, mais ils ne sont pas amis avec les contr√¥leurs.  Pour eux, la sortie analogique allume / √©teint au moins le ventilateur, et au maximum - contr√¥le en douceur de la vitesse d'√©chappement / d'admission / de r√©cup√©ration. <br><br>  Plus pr√©cis√©ment, pour moi: dans la pi√®ce voisine, un syst√®me de ventilation fonctionne depuis 2 ans, que j'ai r√©alis√© sur un contr√¥leur industriel librement programmable.  Parce que  le contr√¥leur est industriel, alors le syst√®me de programmation est sp√©cifique, je ne suis pas s√ªr que vous puissiez y √©crire votre propre protocole d'√©change UART.  Oui, il existe un port s√©rie RS484 qui fonctionne bien sur ModBus, mais ce port est occup√© par le syst√®me de r√©partition. <br><br>  Mais il y a une entr√©e analogique gratuite qui peut √™tre r√©gl√©e sur 0-10V.  Et donc, avec seulement environ 30 $, vous pouvez mettre √† niveau le syst√®me de ventilation pour une √©conomie d'√©nergie intelligente (ne ventiler que lorsque cela est n√©cessaire et exactement autant que n√©cessaire). <br><br>  PS: code SoftSerial.readBytes (mhzBuffer, 9);  sur mon ESP8266 a refus√© de travailler.  Il a tu√© environ cinq heures de sa vie.  <a href="https://habr.com/ru/post/401363/">Ils en ont</a> discut√© <a href="https://habr.com/ru/post/401363/">ici</a> , mais je l'ai lu plus tard.  J'ai √©crit ma fonction dans le style de <code>if (SoftSerial.available() { x=SoftSerial.read(); }</code> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr483826/">https://habr.com/ru/post/fr483826/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr483804/index.html">Richard Hamming "Chapitre inexistant": Comme nous savons ce que nous savons (11-20 minutes sur 40)</a></li>
<li><a href="../fr483814/index.html">Abraham Flexner: l'utilit√© des connaissances inutiles (1939)</a></li>
<li><a href="../fr483818/index.html">Moteur, langage de script et roman visuel - en 45 heures</a></li>
<li><a href="../fr483820/index.html">Ce qui affecte l'√©mission de cr√©dit. Aper√ßu de la concurrence pour le risque de d√©faut de cr√©dit</a></li>
<li><a href="../fr483822/index.html">5 fonctionnalit√©s JavaScript sans lesquelles je ne pouvais pas √©crire de code</a></li>
<li><a href="../fr483828/index.html">√âchanges atomiques de brillance et de pauvret√©</a></li>
<li><a href="../fr483832/index.html">RxJava √† Coroutines: migration des fonctionnalit√©s de bout en bout</a></li>
<li><a href="../fr483834/index.html">Debian: transformer simplement i386 en amd64</a></li>
<li><a href="../fr483842/index.html">L'histoire de la cr√©ation d'un cloud domestique. Partie 5. Mise √† jour 2019 - PHP 7.2, MariaDB 10.4 et Nextcloud 17</a></li>
<li><a href="../fr483844/index.html">Analyse des documents r√©glementaires sur la protection des informations dans le secteur russe du cr√©dit et des finances</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>