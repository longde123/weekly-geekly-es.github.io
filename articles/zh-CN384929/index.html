<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒŸ ğŸ–ğŸ¿ ğŸ’ è‹±ç‰¹å°”çˆ±è¿ªç”Ÿ è‹±ç‰¹å°”ç‰©è”ç½‘åˆ†æäº‘ï¼šåœ¨ASP.NETä¸Šå‘é€SMSå’ŒRESTfulå®¢æˆ·ç«¯ â›“ï¸ ğŸ¤šğŸ½ ğŸŒŸ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä½¿ç”¨è‹±ç‰¹å°”ç‰©è”ç½‘åˆ†æäº‘çš„æœ€åä¸€éƒ¨åˆ†ã€‚ä½¿ç”¨HTTPç½‘å…³æ·»åŠ å‘é€SMSé€šçŸ¥ï¼Œå¹¶åœ¨ASP.NETä¸Šåˆ›å»ºä¸€ä¸ªç®€å•çš„RESTfulå®¢æˆ·ç«¯ã€‚æ€»ç»“ä¸€ä¸‹ã€‚
 
 å‘é€ä½¿ç”¨HTTPç½‘å…³çŸ­ä¿¡é€šçŸ¥
 åœ¨ç”±ä»¥å‰çš„å·¥ä½œè‹±ç‰¹å°”çˆ±è¿ªç”Ÿã€‚ä½¿ç”¨è‹±ç‰¹å°”ç‰©è”ç½‘åˆ†æäº‘ï¼šåˆ›å»ºè§„åˆ™å’Œå‘é€é€šçŸ¥ï¼›å·²ç»å½¢æˆçš„è§„åˆ™ä½¿æ‚¨å¯ä»¥å‘é€ï¼šç”µå­é‚®ä»¶é€šçŸ¥å’Œç®¡ç†ä¸­ç»§...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>è‹±ç‰¹å°”çˆ±è¿ªç”Ÿ è‹±ç‰¹å°”ç‰©è”ç½‘åˆ†æäº‘ï¼šåœ¨ASP.NETä¸Šå‘é€SMSå’ŒRESTfulå®¢æˆ·ç«¯</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/384929/"><img src="https://habrastorage.org/getpro/geektimes/post_images/bd9/939/ed9/bd9939ed9f98c235c4fcb8f033e8ceba.jpg" alt="è‹±ç‰¹å°”ç‰©è”ç½‘åˆ†æ"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½¿ç”¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‹±ç‰¹å°”ç‰©è”ç½‘åˆ†æ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">äº‘çš„æœ€åä¸€éƒ¨åˆ†</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä½¿ç”¨HTTPç½‘å…³æ·»åŠ å‘é€SMSé€šçŸ¥ï¼Œå¹¶åœ¨ASP.NETä¸Šåˆ›å»ºä¸€ä¸ªç®€å•çš„RESTfulå®¢æˆ·ç«¯ã€‚</font><font style="vertical-align: inherit;">æ€»ç»“ä¸€ä¸‹ã€‚</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘é€ä½¿ç”¨HTTPç½‘å…³çŸ­ä¿¡é€šçŸ¥</font></font></strong><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
åœ¨ç”±ä»¥å‰çš„å·¥ä½œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‹±ç‰¹å°”çˆ±è¿ªç”Ÿã€‚</font><font style="vertical-align: inherit;">ä½¿ç”¨è‹±ç‰¹å°”ç‰©è”ç½‘åˆ†æäº‘ï¼šåˆ›å»ºè§„åˆ™å’Œå‘é€é€šçŸ¥ï¼›</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å·²ç»å½¢æˆçš„è§„åˆ™ä½¿æ‚¨å¯ä»¥å‘é€ï¼šç”µå­é‚®ä»¶é€šçŸ¥å’Œç®¡ç†ä¸­ç»§ç”µæºã€‚</font><font style="vertical-align: inherit;">å‘é€çŸ­ä¿¡ï¼Œæ·»åŠ åˆ°åˆ›å»ºçš„è¿™ä¸¤ä¸ªè§„åˆ™ä¸­ã€‚</font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è§„åˆ™ï¼š</font></font></strong><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higth_temp_PowerOnRelay_and_send_to_web@devdotnet.org</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Low_temp_PowerOffRelay_and_send_to_web@devdotnet.org</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†ä½¿ç”¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smsc.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SMSç½‘å…³</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¯¥API </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ­¤å¤„</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ç”¨</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦å‘é€SMSæ¶ˆæ¯ï¼Œå°±è¶³ä»¥å½¢æˆå¹¶å‘é€ä»¥ä¸‹å½¢å¼çš„GETè¯·æ±‚ï¼š</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smsc.ru/sys/send.php?</font></font></a><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
login=&amp; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
psw </font><font style="vertical-align: inherit;">=&amp; </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">phones=&amp;mes=</font></a><font style="vertical-align: inherit;">ï¼Œå…¶ä¸­ï¼š</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">login-</font></a><font style="vertical-align: inherit;">å®¢æˆ·çš„ç™»å½•</font><font style="vertical-align: inherit;">psw-å®¢æˆ·çš„å¯†ç æˆ–å°å†™çš„MD5å¯†ç å“ˆå¸Œã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”µè¯-å›½é™…æ ¼å¼çš„æ•°å­—ï¼Œä¸å¸¦â€œ +â€ç¬¦å·</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã€‚çŸ­ä¿¡-è¦å‘é€çš„æ¶ˆæ¯æ–‡æœ¬ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ— éœ€æ·»åŠ Headæ ‡å¤´ï¼Œä¸€åˆ‡éƒ½éå¸¸ç®€å•ã€‚</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†å½¢æˆä¸¤ä¸ªè¯·æ±‚ï¼š</font></font></strong><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smsc.ru/sys/send.php?login</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">tele</font></a><font style="vertical-align: inherit;"> ****å’Œpsw = d46d70eb6 ******å’Œç”µè¯= 79232 ******ï¼†mes = Relay_power_ON </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smsc.ru/sys/sendã€‚ phpï¼Ÿlogin = tele</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ****å’Œpsw = d46d70eb6 ******ï¼†ç”µè¯= 79232 ******ï¼†mes = Relay_power_OFFè½¬åˆ°</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
â€œ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è§„åˆ™â€</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éƒ¨åˆ†</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">ï¼Œ</font></a><font style="vertical-align: inherit;">æ‰“å¼€è§„åˆ™</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higth_temp_PowerOnRelay_and_send_to_web@devdotnet.orgã€‚</font></font></strong><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ·»åŠ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šçŸ¥ç±»å‹-HTTPç«¯ç‚¹</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶è¾“å…¥</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URL</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/b4c/5ef/f11/b4c5eff113c1821a8a37c0254724887b.png" alt="è‹±ç‰¹å°”ç‰©è”ç½‘åˆ†æ"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦å¤–ï¼Œæˆ‘ä»¬å°†ä¸ºç¬¬äºŒæ¡è§„åˆ™åˆ›å»º</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Low_temp_PowerOffRelay_and_send_to_web@devdotnet.org</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šè¿‡ç”µè¯æ”¶åˆ°çŸ­ä¿¡</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/getpro/geektimes/post_images/05f/e2b/b7d/05fe2bb7db543854b31a6d9347efb1b8.png" alt="Intel IoT Analytics"></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»å‘é€SMSæ¶ˆæ¯çš„åŠŸèƒ½çš„ç¼ºç‚¹æ¥çœ‹ï¼Œæœ‰å¿…è¦æ³¨æ„æ— æ³•å‘é€åŠ¨æ€æ•°æ®ï¼Œä¾‹å¦‚ï¼Œæ‚¨ä¸èƒ½å‘é€å½“å‰çš„ä¼ æ„Ÿå™¨è¯»æ•°ã€‚</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASP.NET Razorä¸Šçš„ç®€å•RESTfulå®¢æˆ·ç«¯æˆ‘ä»¬å°†</font></font></strong><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
å½¢æˆä¸€ä¸ªé¡µé¢ï¼Œæ˜¾ç¤ºå½“å‰ä¼ æ„Ÿå™¨çš„è¯»æ•°ï¼šæ¸©åº¦å’Œå‹åŠ›ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†æ§åˆ¶éƒ¨ä»¶æ”¾åœ¨é¡µé¢ä¸Šï¼šæ¥é€šç»§ç”µå™¨å’ŒLEDã€‚</font><font style="vertical-align: inherit;">Cloud APIå¯</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ­¤å¤„è·å¾—</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">åœ¨ASP.NET Razor netf 4.5ä¸Šå®ç°ã€‚</font><font style="vertical-align: inherit;">è¦ä½¿ç”¨JSONï¼Œå°†ä½¿ç”¨Newtonsoft.Jsonåº“ã€‚</font><font style="vertical-align: inherit;">Web.configæ–‡ä»¶åŒ…å«ç”¨äºè®¿é—®äº‘çš„ç™»å½•åå’Œå¯†ç ã€‚</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¥ç¤ºä¾‹ä¸æ˜¯å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯å¯¹APIä½¿ç”¨çš„ç®€å•æ¼”ç¤ºã€‚</font></font></strong><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸å¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬è·å¾—ä»¤ç‰Œï¼Œè¿™æ˜¯</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wikiæˆæƒä¸­çš„ä¸€éƒ¨åˆ†</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¼–ç </font></font></b><div class="spoiler_text"><pre><code class="hljs pgsql">string GetNewToken()<font></font>
            {<font></font>
                // <span class="hljs-keyword">login</span>  pass<font></font>
                string strLogin, strPass;<font></font>
                strLogin = <span class="hljs-keyword">System</span>.<span class="hljs-keyword">Configuration</span>.ConfigurationManager.AppSettings["Login"];<font></font>
                strPass = <span class="hljs-keyword">System</span>.<span class="hljs-keyword">Configuration</span>.ConfigurationManager.AppSettings["Pass"];<font></font>
                //,  .<font></font>
                //https://github.com/enableiot/iotkit-api/wiki/<span class="hljs-keyword">Authorization</span>
                // <span class="hljs-type">JSON</span>
                var obj = <span class="hljs-built_in">new</span><font></font>
                {<font></font>
                    username = strLogin,<font></font>
                    <span class="hljs-keyword">password</span> = strPass<font></font>
                };<font></font>
                string postData = JsonConvert.SerializeObject(obj, Formatting.Indented);<font></font>
                //HttpWebRequest<font></font>
                HttpWebRequest httpWebRequest = (HttpWebRequest)HttpWebRequest.<span class="hljs-keyword">Create</span>("https://dashboard.us.enableiot.com/v1/api/auth/token");<font></font>
                httpWebRequest.<span class="hljs-keyword">Method</span> = "POST";<font></font>
                httpWebRequest.ContentType = "application/json";<font></font>
                //<font></font>
                byte[] byte1 = <span class="hljs-keyword">System</span>.Text.<span class="hljs-keyword">Encoding</span>.UTF8.GetBytes(postData);<font></font>
                httpWebRequest.ContentLength = byte1.Length;<font></font>
                httpWebRequest.GetRequestStream().<span class="hljs-keyword">Write</span>(byte1, <span class="hljs-number">0</span>, byte1.Length);<font></font>
                httpWebRequest.GetRequestStream().<span class="hljs-keyword">Close</span>();<font></font>
                //<font></font>
                StreamReader reader = <span class="hljs-built_in">new</span> StreamReader(httpWebRequest.GetResponse().GetResponseStream());<font></font>
                JObject objResponse = JObject.Parse(reader.ReadToEnd());<font></font>
                <span class="hljs-keyword">return</span> (string)objResponse["token"];<font></font>
            }<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯»å–æ•°æ®ï¼Œå‚è§</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wiki Data-APIä¸­çš„éƒ¨åˆ†</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¼–ç </font></font></b><div class="spoiler_text"><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">GetStateSensors</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> strToken, Dictionary&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">string</span>&gt; dicSensors</span>)</span><font></font>
            {<font></font>
                <span class="hljs-comment">// </span>
                <span class="hljs-comment">//https://github.com/enableiot/iotkit-api/wiki/Data-API</span>
                <span class="hljs-comment">// JSON</span>
                <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">new</span><font></font>
                {<font></font>
                    <span class="hljs-keyword">from</span> = <span class="hljs-number">-20</span>,<font></font>
                    targetFilter = <span class="hljs-keyword">new</span> { deviceList = <span class="hljs-keyword">new</span>[] { <span class="hljs-string">"9e-8d-22-0c-50-7b"</span> } },<font></font>
                    metrics = <span class="hljs-keyword">new</span>[] { <span class="hljs-keyword">new</span> {<font></font>
						id=<span class="hljs-string">"99fb5b73-a9e2-4ae0-8a0d-45e6a7cc0541"</span>,<font></font>
						op=<span class="hljs-string">"none"</span><font></font>
					},<font></font>
                    <span class="hljs-keyword">new</span> {<font></font>
						id=<span class="hljs-string">"b3731f8a-4f31-414d-a072-b364b1792b5b"</span>,<font></font>
						op=<span class="hljs-string">"none"</span><font></font>
					}<font></font>
				}<font></font>
                };<font></font>
                <span class="hljs-keyword">string</span> postData = JsonConvert.SerializeObject(obj, Formatting.Indented);
                <span class="hljs-comment">//HttpWebRequest</span>
                HttpWebRequest httpWebRequest = (HttpWebRequest)HttpWebRequest.Create(<span class="hljs-string">"https://dashboard.us.enableiot.com/v1/api/accounts/4c8c6b2e-c54f-4df5-8bbb-a5e59df85aaa/data/search"</span>);<font></font>
                httpWebRequest.Method = <span class="hljs-string">"POST"</span>;<font></font>
                httpWebRequest.ContentType = <span class="hljs-string">"application/json"</span>;
                <span class="hljs-comment">//Headers</span>
                httpWebRequest.Headers.Add(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer "</span> + strToken);<font></font>
                httpWebRequest.Headers.Add(<span class="hljs-string">"accountId"</span>, <span class="hljs-string">"4c8c6b2e-c54f-4df5-8bbb-a5e59df85aaa"</span>);
                <span class="hljs-comment">//</span>
                <span class="hljs-keyword">byte</span>[] byte1 = System.Text.Encoding.UTF8.GetBytes(postData);<font></font>
                httpWebRequest.ContentLength = byte1.Length;<font></font>
                httpWebRequest.GetRequestStream().Write(byte1, <span class="hljs-number">0</span>, byte1.Length);<font></font>
                httpWebRequest.GetRequestStream().Close();<font></font>
                <span class="hljs-comment">//</span>
                StreamReader reader = <span class="hljs-keyword">new</span> StreamReader(httpWebRequest.GetResponse().GetResponseStream());<font></font>
                JObject objResponse = JObject.Parse(reader.ReadToEnd());<font></font>
                <span class="hljs-comment">//add Dic</span>
                <span class="hljs-keyword">string</span> strValueSensor = (<span class="hljs-keyword">string</span>)objResponse[<span class="hljs-string">"series"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"points"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"value"</span>];<font></font>
                dicSensors.Add(<span class="hljs-string">"pressure"</span>, strValueSensor);<font></font>
                strValueSensor = (<span class="hljs-keyword">string</span>)objResponse[<span class="hljs-string">"series"</span>][<span class="hljs-number">1</span>][<span class="hljs-string">"points"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"value"</span>];<font></font>
                strValueSensor = Math.Round(<span class="hljs-keyword">decimal</span>.Parse(strValueSensor, System.Globalization.CultureInfo.CreateSpecificCulture(<span class="hljs-string">"en"</span>)), <span class="hljs-number">2</span>).ToString();<font></font>
                dicSensors.Add(<span class="hljs-string">"temperature"</span>, strValueSensor);<font></font>
            }<font></font>
</code></pre><br>
</div></div><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç•Œé¢</font></font></strong><br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/d46/3f7/a36/d463f7a364e3cf24538e96a8f4f7b771.png" alt="è‹±ç‰¹å°”ç‰©è”ç½‘åˆ†æ"><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‘˜è¦</font></font></strong><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”¨äºæ•°æ®æ”¶é›†çš„äº‘ä½¿æ‚¨æ— éœ€æ„å»ºåŸºç¡€æ¶æ„ï¼Œä»è€Œé™ä½äº†è´­ä¹°ç¡¬ä»¶å’Œè½¯ä»¶çš„æˆæœ¬ã€‚é…ç½®è®¾å¤‡ï¼Œä¼ æ„Ÿå™¨éå¸¸ç®€å•ã€‚å¼€å‘çš„APIä¸ä»…å…è®¸æ¥æ”¶æ•°æ®å’Œç®¡ç†è®¾å¤‡ï¼Œè¿˜å¯ä»¥åˆ›å»ºè‡ªå·±çš„ç®¡ç†é¢æ¿ã€‚æ•°æ®ä¼ è¾“æ²¡æœ‰æ˜æ˜¾çš„å»¶è¿Ÿï¼Œè¯·æ±‚ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚æœ‰ä¸¤ä¸ªè§’è‰²ï¼šç®¡ç†å‘˜å’Œç”¨æˆ·ã€‚è¦æ·»åŠ ç”¨æˆ·ï¼Œç®¡ç†å‘˜éœ€è¦æŒ‡å®šæ–°çš„ç”µå­é‚®ä»¶ï¼Œé‚€è¯·ä¿¡å°†å‘é€åˆ°è¯¥åœ°å€ã€‚åœ¨æ³¨å†Œæ–°ç”¨æˆ·çš„è¿‡ç¨‹ä¸­ï¼Œå°†è¯¢é—®è¯¥ç”¨æˆ·æœ‰å…³æ¥å—è®¿é—®é‚€è¯·ï¼ˆé‚€è¯·ï¼‰çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œç”¨æˆ·å‚ä¸ç®¡ç†ä»–çš„å¸æˆ·ï¼ŒåŒ…æ‹¬å¯†ç æ›´æ”¹ã€‚çš„ç¼ºç‚¹ä¸å¯èƒ½åœ¨SMSæ¶ˆæ¯ä¸­åŒ…æ‹¬ä¼ æ„Ÿå™¨è¯»æ•°ï¼Œåªèƒ½æ˜¯é¢„å…ˆå‡†å¤‡çš„æ¨¡æ¿ã€‚å¯¹äºç”µå­é‚®ä»¶ï¼Œæ²¡æœ‰æ¨¡æ¿ï¼Œåªæœ‰å¸¦æœ‰ä¼ æ„Ÿå™¨è¯»å–æ¿çš„æ ‡å‡†è§†å›¾ã€‚å‘ç°äº†å¦ä¸€ä¸ªåŠŸèƒ½ï¼ŒåŒ…æ‹¬å¤„ç†è§„åˆ™çš„é¡ºåºã€‚æœ‰æ—¶åœ¨æ¥é€šåç«‹å³è§‚å¯Ÿåˆ°ç»§ç”µå™¨æ–­å¼€çš„æƒ…å†µã€‚è€Œä¸”ï¼Œæ ¹æ®ç»§ç”µå™¨çš„é€»è¾‘ï¼Œåº”è¯¥å‡è®¾åªæœ‰åœ¨æ¸©åº¦é™è‡³28 Cä»¥ä¸‹æ—¶æ‰å…³é—­ã€‚è§„åˆ™é€»è¾‘çš„æ¡ä»¶å’Œè®¾å¤‡ä¸Šçš„ä»£ç ä¸åŒ…å«é”™è¯¯ã€‚é€šè¿‡æŸ¥çœ‹è­¦æŠ¥æ—¥å¿—å·²è§£å†³äº†è¯¥æƒ…å†µï¼Œæ–°è­¦æŠ¥å·²æ·»åŠ åˆ°åˆ—è¡¨çš„æœ«å°¾ã€‚æœ‰æ—¶åœ¨æ¥é€šåç«‹å³è§‚å¯Ÿåˆ°ç»§ç”µå™¨æ–­å¼€çš„æƒ…å†µã€‚è€Œä¸”ï¼Œæ ¹æ®ç»§ç”µå™¨çš„é€»è¾‘ï¼Œåº”è¯¥å‡è®¾åªæœ‰åœ¨æ¸©åº¦é™è‡³28 Cä»¥ä¸‹æ—¶æ‰å…³é—­ã€‚è§„åˆ™é€»è¾‘çš„æ¡ä»¶å’Œè®¾å¤‡ä¸Šçš„ä»£ç ä¸åŒ…å«é”™è¯¯ã€‚é€šè¿‡æŸ¥çœ‹è­¦æŠ¥æ—¥å¿—å·²è§£å†³äº†è¯¥æƒ…å†µï¼Œæ–°è­¦æŠ¥å·²æ·»åŠ åˆ°åˆ—è¡¨çš„æœ«å°¾ã€‚æœ‰æ—¶åœ¨æ¥é€šåç«‹å³è§‚å¯Ÿåˆ°ç»§ç”µå™¨æ–­å¼€çš„æƒ…å†µã€‚æ­¤å¤–ï¼Œæ ¹æ®ç»§ç”µå™¨çš„é€»è¾‘ï¼Œä»…åœ¨æ¸©åº¦é™è‡³28 Cä»¥ä¸‹æ—¶æ‰åº”å°†å…¶å…³é—­ã€‚è§„åˆ™çš„é€»è¾‘æ¡ä»¶å’Œè®¾å¤‡ä¸Šçš„ä»£ç ä¸åŒ…å«é”™è¯¯ã€‚é€šè¿‡æŸ¥çœ‹è­¦æŠ¥æ—¥å¿—å·²è§£å†³äº†è¯¥æƒ…å†µï¼Œæ–°è­¦æŠ¥å·²æ·»åŠ åˆ°åˆ—è¡¨çš„æœ«å°¾ã€‚</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/getpro/geektimes/post_images/6dc/b9e/69e/6dcb9e69e68161149a1c8bafe72579c9.png" alt="è‹±ç‰¹å°”ç‰©è”ç½‘åˆ†æ"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
äº‹ä»¶39æ˜¯æœ€åä¸€ä¸ªè¦è¿è¡Œçš„äº‹ä»¶ï¼Œå°½ç®¡å®ƒåœ¨æ—¶é—´ä¸Šæ—©äºäº‹ä»¶38ã€‚å°½ç®¡æ¸©åº¦è¿›ä¸€æ­¥å‡é«˜ï¼Œç»§ç”µå™¨ä¹Ÿä¼šæ‰“å¼€ä¸€ç§’é’Ÿï¼Œç„¶åå…³é—­ã€‚</font><font style="vertical-align: inherit;">å¯èƒ½æ˜¯ç”±äºæœåŠ¡å°šæœªå®Œæˆã€‚</font><font style="vertical-align: inherit;">å½“å‰ï¼Œè‹±ç‰¹å°”ç‰©è”ç½‘åˆ†æäº‘å¤„äºå¼€å‘é˜¶æ®µï¼ˆBETAçŠ¶æ€ï¼‰ã€‚</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">Web.devdotnet.orgçš„</font></a></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åº”ç”¨ç¨‹åº</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
æµ‹è¯•å·¥ä½œç‰ˆæœ¬</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">
è¯¥é¡¹ç›®</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">åœ¨è¿™é‡Œ</font></a><font style="vertical-align: inherit;">å¯ç”¨</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">
èµ„æº</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">web.config</font></font></b><div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">appSettings</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">add</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"Login"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"***"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">add</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"Pass"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"***"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">appSettings</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">system.web</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">compilation</span> <span class="hljs-attr">debug</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">targetFramework</span>=<span class="hljs-string">"4.5"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">assemblies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">add</span> <span class="hljs-attr">assembly</span>=<span class="hljs-string">"Microsoft.Web.Infrastructure, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">add</span> <span class="hljs-attr">assembly</span>=<span class="hljs-string">"System.Net.Http, Version=4.0.0.0, Culture=neutral, PublicKeyToken=B03F5F7F11D50A3A"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">assemblies</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">compilation</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">httpRuntime</span> <span class="hljs-attr">targetFramework</span>=<span class="hljs-string">"4.5"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">system.web</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">runtime</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">assemblyBinding</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"urn:schemas-microsoft-com:asm.v1"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">dependentAssembly</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">assemblyIdentity</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"System.Web.Helpers"</span> <span class="hljs-attr">publicKeyToken</span>=<span class="hljs-string">"31bf3856ad364e35"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">bindingRedirect</span> <span class="hljs-attr">oldVersion</span>=<span class="hljs-string">"1.0.0.0-3.0.0.0"</span> <span class="hljs-attr">newVersion</span>=<span class="hljs-string">"3.0.0.0"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">dependentAssembly</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">dependentAssembly</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">assemblyIdentity</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"System.Web.WebPages"</span> <span class="hljs-attr">publicKeyToken</span>=<span class="hljs-string">"31bf3856ad364e35"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">bindingRedirect</span> <span class="hljs-attr">oldVersion</span>=<span class="hljs-string">"1.0.0.0-3.0.0.0"</span> <span class="hljs-attr">newVersion</span>=<span class="hljs-string">"3.0.0.0"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">dependentAssembly</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">assemblyBinding</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">runtime</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">index.cshtml</font></font></b><div class="spoiler_text"><pre><code class="hljs cs">@using System.Net.Http<font></font>
@using Newtonsoft.Json<font></font>
@using Newtonsoft.Json.Linq<font></font>
<font></font>
@{<font></font>
    <span class="hljs-comment">//   Session</span>
    <span class="hljs-keyword">string</span> strToken;<font></font>
    strToken = (<span class="hljs-keyword">string</span>)Session[<span class="hljs-string">"Token"</span>];
    <span class="hljs-keyword">if</span> (strToken == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
        strToken = GetNewToken();<font></font>
        Session[<span class="hljs-string">"Token"</span>] = strToken;<font></font>
    }<font></font>
    <span class="hljs-comment">//Action</span>
    <span class="hljs-keyword">if</span> (Request[<span class="hljs-string">"command"</span>] != <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">string</span> strCommand = (<span class="hljs-keyword">string</span>)Request[<span class="hljs-string">"command"</span>];<font></font>
        SetSateActuation(strToken,strCommand);<font></font>
    }<font></font>
    <span class="hljs-comment">//  Sensors</span>
    Dictionary&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">string</span>&gt; dicSensors = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">string</span>&gt;();<font></font>
    GetStateSensors(strToken, dicSensors);<font></font>
    <span class="hljs-comment">//  Actuation</span>
    <span class="hljs-keyword">bool</span> boolValueLED, boolValueRelay;<font></font>
    GetStateActuations(strToken, <span class="hljs-keyword">out</span> boolValueLED, <span class="hljs-keyword">out</span> boolValueRelay);<font></font>
}<font></font>
        @functions {<font></font>
            <span class="hljs-comment">// Pass a user name to this method.</span>
            <span class="hljs-function"><span class="hljs-keyword">string</span> <span class="hljs-title">GetNewToken</span>(<span class="hljs-params"></span>)</span><font></font>
            {<font></font>
                <span class="hljs-comment">// login  pass</span>
                <span class="hljs-keyword">string</span> strLogin, strPass;<font></font>
                strLogin = System.Configuration.ConfigurationManager.AppSettings[<span class="hljs-string">"Login"</span>];<font></font>
                strPass = System.Configuration.ConfigurationManager.AppSettings[<span class="hljs-string">"Pass"</span>];
                <span class="hljs-comment">//,  .</span>
                <span class="hljs-comment">//https://github.com/enableiot/iotkit-api/wiki/Authorization</span>
                <span class="hljs-comment">// JSON</span>
                <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">new</span><font></font>
                {<font></font>
                    username = strLogin,<font></font>
                    password = strPass<font></font>
                };<font></font>
                <span class="hljs-keyword">string</span> postData = JsonConvert.SerializeObject(obj, Formatting.Indented);
                <span class="hljs-comment">//HttpWebRequest</span>
                HttpWebRequest httpWebRequest = (HttpWebRequest)HttpWebRequest.Create(<span class="hljs-string">"https://dashboard.us.enableiot.com/v1/api/auth/token"</span>);<font></font>
                httpWebRequest.Method = <span class="hljs-string">"POST"</span>;<font></font>
                httpWebRequest.ContentType = <span class="hljs-string">"application/json"</span>;
                <span class="hljs-comment">//</span>
                <span class="hljs-keyword">byte</span>[] byte1 = System.Text.Encoding.UTF8.GetBytes(postData);<font></font>
                httpWebRequest.ContentLength = byte1.Length;<font></font>
                httpWebRequest.GetRequestStream().Write(byte1, <span class="hljs-number">0</span>, byte1.Length);<font></font>
                httpWebRequest.GetRequestStream().Close();<font></font>
                <span class="hljs-comment">//</span>
                StreamReader reader = <span class="hljs-keyword">new</span> StreamReader(httpWebRequest.GetResponse().GetResponseStream());<font></font>
                JObject objResponse = JObject.Parse(reader.ReadToEnd());<font></font>
                <span class="hljs-keyword">return</span> (<span class="hljs-keyword">string</span>)objResponse[<span class="hljs-string">"token"</span>];<font></font>
            }<font></font>
            <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">GetStateSensors</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> strToken, Dictionary&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">string</span>&gt; dicSensors</span>)</span><font></font>
            {<font></font>
                <span class="hljs-comment">// </span>
                <span class="hljs-comment">//https://github.com/enableiot/iotkit-api/wiki/Data-API</span>
                <span class="hljs-comment">// JSON</span>
                <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">new</span><font></font>
                {<font></font>
                    <span class="hljs-keyword">from</span> = <span class="hljs-number">-20</span>,<font></font>
                    targetFilter = <span class="hljs-keyword">new</span> { deviceList = <span class="hljs-keyword">new</span>[] { <span class="hljs-string">"9e-8d-22-0c-50-7b"</span> } },<font></font>
                    metrics = <span class="hljs-keyword">new</span>[] { <span class="hljs-keyword">new</span> {<font></font>
						id=<span class="hljs-string">"99fb5b73-a9e2-4ae0-8a0d-45e6a7cc0541"</span>,<font></font>
						op=<span class="hljs-string">"none"</span><font></font>
					},<font></font>
                    <span class="hljs-keyword">new</span> {<font></font>
						id=<span class="hljs-string">"b3731f8a-4f31-414d-a072-b364b1792b5b"</span>,<font></font>
						op=<span class="hljs-string">"none"</span><font></font>
					}<font></font>
				}<font></font>
                };<font></font>
                <span class="hljs-keyword">string</span> postData = JsonConvert.SerializeObject(obj, Formatting.Indented);
                <span class="hljs-comment">//HttpWebRequest</span>
                HttpWebRequest httpWebRequest = (HttpWebRequest)HttpWebRequest.Create(<span class="hljs-string">"https://dashboard.us.enableiot.com/v1/api/accounts/4c8c6b2e-c54f-4df5-8bbb-a5e59df85aaa/data/search"</span>);<font></font>
                httpWebRequest.Method = <span class="hljs-string">"POST"</span>;<font></font>
                httpWebRequest.ContentType = <span class="hljs-string">"application/json"</span>;
                <span class="hljs-comment">//Headers</span>
                httpWebRequest.Headers.Add(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer "</span> + strToken);<font></font>
                httpWebRequest.Headers.Add(<span class="hljs-string">"accountId"</span>, <span class="hljs-string">"4c8c6b2e-c54f-4df5-8bbb-a5e59df85aaa"</span>);
                <span class="hljs-comment">//</span>
                <span class="hljs-keyword">byte</span>[] byte1 = System.Text.Encoding.UTF8.GetBytes(postData);<font></font>
                httpWebRequest.ContentLength = byte1.Length;<font></font>
                httpWebRequest.GetRequestStream().Write(byte1, <span class="hljs-number">0</span>, byte1.Length);<font></font>
                httpWebRequest.GetRequestStream().Close();<font></font>
                <span class="hljs-comment">//</span>
                StreamReader reader = <span class="hljs-keyword">new</span> StreamReader(httpWebRequest.GetResponse().GetResponseStream());<font></font>
                JObject objResponse = JObject.Parse(reader.ReadToEnd());<font></font>
                <span class="hljs-comment">//add Dic</span>
                <span class="hljs-keyword">string</span> strValueSensor = (<span class="hljs-keyword">string</span>)objResponse[<span class="hljs-string">"series"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"points"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"value"</span>];<font></font>
                dicSensors.Add(<span class="hljs-string">"pressure"</span>, strValueSensor);<font></font>
                strValueSensor = (<span class="hljs-keyword">string</span>)objResponse[<span class="hljs-string">"series"</span>][<span class="hljs-number">1</span>][<span class="hljs-string">"points"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"value"</span>];<font></font>
                strValueSensor = Math.Round(<span class="hljs-keyword">decimal</span>.Parse(strValueSensor, System.Globalization.CultureInfo.CreateSpecificCulture(<span class="hljs-string">"en"</span>)), <span class="hljs-number">2</span>).ToString();<font></font>
                dicSensors.Add(<span class="hljs-string">"temperature"</span>, strValueSensor);<font></font>
            }<font></font>
<font></font>
            <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">GetStateActuations</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> strToken, <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> boolValueLED, <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> boolValueRelay</span>)</span><font></font>
            {<font></font>
                <span class="hljs-comment">//  Actuation</span>
                <span class="hljs-comment">//https://github.com/enableiot/iotkit-api/wiki/Control-Device-API</span>
                <span class="hljs-comment">//HttpWebRequest</span>
                HttpWebRequest httpWebRequest = (HttpWebRequest)HttpWebRequest.Create(<span class="hljs-string">"https://dashboard.us.enableiot.com/v1/api/accounts/4c8c6b2e-c54f-4df5-8bbb-a5e59df85aaa/control/devices/9e-8d-22-0c-50-7b?from=-60000"</span>);<font></font>
                httpWebRequest.Method = <span class="hljs-string">"GET"</span>;
                <span class="hljs-comment">//Headers</span>
                httpWebRequest.Headers.Add(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer "</span> + strToken);<font></font>
                httpWebRequest.Headers.Add(<span class="hljs-string">"accountId"</span>, <span class="hljs-string">"4c8c6b2e-c54f-4df5-8bbb-a5e59df85aaa"</span>);
                <span class="hljs-comment">//</span>
                StreamReader reader = <span class="hljs-keyword">new</span> StreamReader(httpWebRequest.GetResponse().GetResponseStream());<font></font>
                JArray jArr = (JArray)JsonConvert.DeserializeObject(reader.ReadToEnd());<font></font>
                <span class="hljs-comment">//Parse data</span>
                Dictionary&lt;<span class="hljs-keyword">long</span>, <span class="hljs-keyword">string</span>&gt; dicSensorLED = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-keyword">long</span>, <span class="hljs-keyword">string</span>&gt;();<font></font>
                Dictionary&lt;<span class="hljs-keyword">long</span>, <span class="hljs-keyword">string</span>&gt; dicSensorRelay = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-keyword">long</span>, <span class="hljs-keyword">string</span>&gt;();
                <span class="hljs-keyword">long</span> longTicks;
                <span class="hljs-keyword">foreach</span> (JObject item <span class="hljs-keyword">in</span> jArr)<font></font>
                {<font></font>
                    longTicks = DateTime.Parse((<span class="hljs-keyword">string</span>)item[<span class="hljs-string">"created"</span>]).Ticks;
                    <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">string</span>)item[<span class="hljs-string">"command"</span>] == <span class="hljs-string">"LED.v1.0"</span>)<font></font>
                    {<font></font>
                        <span class="hljs-keyword">if</span> (!dicSensorLED.ContainsKey(longTicks)) dicSensorLED.Add(longTicks, (<span class="hljs-keyword">string</span>)item[<span class="hljs-string">"params"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"value"</span>]);<font></font>
                    }<font></font>
                    <span class="hljs-keyword">else</span><font></font>
                    {<font></font>
                        <span class="hljs-keyword">if</span> (!dicSensorRelay.ContainsKey(longTicks)) dicSensorRelay.Add(longTicks, (<span class="hljs-keyword">string</span>)item[<span class="hljs-string">"params"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"value"</span>]);<font></font>
                    }<font></font>
                }<font></font>
                <span class="hljs-comment">//find last value</span>
                <span class="hljs-keyword">string</span> strValueLED = dicSensorLED[dicSensorLED.Max(x =&gt; x.Key)];
                <span class="hljs-keyword">string</span> strValueRelay = dicSensorRelay[dicSensorRelay.Max(x =&gt; x.Key)];
                <span class="hljs-comment">//</span>
                <span class="hljs-keyword">if</span> (strValueLED == <span class="hljs-string">"0"</span>) boolValueLED = <span class="hljs-literal">false</span>; <span class="hljs-keyword">else</span> boolValueLED = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">if</span> (strValueRelay == <span class="hljs-string">"0"</span>) boolValueRelay = <span class="hljs-literal">false</span>; <span class="hljs-keyword">else</span> boolValueRelay = <span class="hljs-literal">true</span>;<font></font>
                }<font></font>
<font></font>
            <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SetSateActuation</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> strToken, <span class="hljs-keyword">string</span> strCommand</span>)</span><font></font>
            {<font></font>
                <span class="hljs-comment">//  Actuation</span>
                <span class="hljs-comment">//https://github.com/enableiot/iotkit-api/wiki/Control-Device-API</span>
                <span class="hljs-comment">// </span>
                <span class="hljs-keyword">string</span> strComponentId, strName, strValue, strComplexCommands;
                <span class="hljs-keyword">switch</span> (strCommand)<font></font>
                {<font></font>
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"led_on"</span>:<font></font>
                        {<font></font>
                            strComponentId=<span class="hljs-string">"64dbdbee-e181-403f-8b51-0872e11a289e"</span>;<font></font>
                            strName=<span class="hljs-string">"LED"</span>;<font></font>
                            strValue = <span class="hljs-string">"1"</span>;<font></font>
                            strComplexCommands = <span class="hljs-string">"led1_ON"</span>;
                            <span class="hljs-keyword">break</span>;<font></font>
                        }<font></font>
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"led_off"</span>:<font></font>
                        {<font></font>
                            strComponentId = <span class="hljs-string">"64dbdbee-e181-403f-8b51-0872e11a289e"</span>;<font></font>
                            strName = <span class="hljs-string">"LED"</span>;<font></font>
                            strValue = <span class="hljs-string">"0"</span>;<font></font>
                            strComplexCommands = <span class="hljs-string">"led1_OFF"</span>;
                            <span class="hljs-keyword">break</span>;<font></font>
                        }<font></font>
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"relay_on"</span>:<font></font>
                        {<font></font>
                            strComponentId = <span class="hljs-string">"5f72e39a-463a-4e57-bac7-9b32debfd865"</span>;<font></font>
                            strName = <span class="hljs-string">"RELAY"</span>;<font></font>
                            strValue = <span class="hljs-string">"1"</span>;<font></font>
                            strComplexCommands = <span class="hljs-string">"relay1_ON"</span>;
                            <span class="hljs-keyword">break</span>;<font></font>
                        }<font></font>
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"relay_off"</span>:<font></font>
                        {<font></font>
                            strComponentId = <span class="hljs-string">"5f72e39a-463a-4e57-bac7-9b32debfd865"</span>;<font></font>
                            strName = <span class="hljs-string">"RELAY"</span>;<font></font>
                            strValue = <span class="hljs-string">"0"</span>;<font></font>
                            strComplexCommands = <span class="hljs-string">"relay1_OFF"</span>;
                            <span class="hljs-keyword">break</span>;<font></font>
                        }<font></font>
                    <span class="hljs-keyword">default</span>:
                        <span class="hljs-comment">// You can use the default case.</span>
                        <span class="hljs-keyword">return</span>;<font></font>
                }<font></font>
                <span class="hljs-comment">// JSON</span>
                <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">new</span><font></font>
                {<font></font>
                    commands = <span class="hljs-keyword">new</span>[] { <span class="hljs-keyword">new</span> {<font></font>
                    componentId = strComponentId,<font></font>
                    parameters= <span class="hljs-keyword">new</span>[] { <span class="hljs-keyword">new</span><font></font>
                                        {<font></font>
                                            name=strName,<font></font>
                                            <span class="hljs-keyword">value</span>=strValue<font></font>
                                        }<font></font>
                    },<font></font>
                    transport=<span class="hljs-string">"ws"</span><font></font>
                }<font></font>
                },<font></font>
                    complexCommands = <span class="hljs-keyword">new</span>[] { strComplexCommands }<font></font>
                };<font></font>
                <span class="hljs-keyword">string</span> postData = JsonConvert.SerializeObject(obj, Formatting.Indented);
                <span class="hljs-comment">//HttpWebRequest</span>
                HttpWebRequest httpWebRequest = (HttpWebRequest)HttpWebRequest.Create(<span class="hljs-string">"https://dashboard.us.enableiot.com/v1/api/accounts/4c8c6b2e-c54f-4df5-8bbb-a5e59df85aaa/control"</span>);<font></font>
                httpWebRequest.Method = <span class="hljs-string">"POST"</span>;<font></font>
                httpWebRequest.ContentType = <span class="hljs-string">"application/json"</span>;
                <span class="hljs-comment">//Headers</span>
                httpWebRequest.Headers.Add(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer "</span> + strToken);<font></font>
                httpWebRequest.Headers.Add(<span class="hljs-string">"accountId"</span>, <span class="hljs-string">"4c8c6b2e-c54f-4df5-8bbb-a5e59df85aaa"</span>);
                <span class="hljs-comment">//</span>
                <span class="hljs-keyword">byte</span>[] byte1 = System.Text.Encoding.UTF8.GetBytes(postData);<font></font>
                httpWebRequest.ContentLength = byte1.Length;<font></font>
                httpWebRequest.GetRequestStream().Write(byte1, <span class="hljs-number">0</span>, byte1.Length);<font></font>
                httpWebRequest.GetRequestStream().Close();<font></font>
                <span class="hljs-comment">//</span><font></font>
                httpWebRequest.GetResponse();<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
<font></font>
        &lt;html&gt;<font></font>
        &lt;head&gt;<font></font>
            &lt;title&gt; RESTful   Intel IoT Analytics  ASP.NET Razor&lt;/title&gt;<font></font>
        &lt;/head&gt;<font></font>
        &lt;body&gt;<font></font>
            &lt;h1&gt; RESTful   Intel IoT Analytics  ASP.NET Razor&lt;/h1&gt;<font></font>
&lt;p&gt;: @DateTime.Now.ToString()&lt;/p&gt;<font></font>
    &lt;p&gt;   &lt;a href=<span class="hljs-string">"https://github.com/enableiot/iotkit-api/wiki/Api-Home"</span>&gt;api  intel iot analytics.&lt;/a&gt;&lt;/p&gt;<font></font>
    &lt;p&gt;  API :&lt;/p&gt;<font></font>
    &lt;ol&gt;<font></font>
        &lt;li&gt;,  &lt;/li&gt;<font></font>
        &lt;li&gt;   (sensor)&lt;/li&gt;<font></font>
        &lt;li&gt;   (Actuation)&lt;/li&gt;<font></font>
    &lt;/ol&gt;<font></font>
    &lt;h3&gt; &lt;/h3&gt;<font></font>
    &lt;p&gt;: @dicSensors[<span class="hljs-string">"temperature"</span>] *&lt;/p&gt;<font></font>
    &lt;p&gt;: @dicSensors[<span class="hljs-string">"pressure"</span>] &lt;/p&gt;<font></font>
     @if (boolValueLED==<span class="hljs-literal">false</span>)<font></font>
        {<font></font>
            &lt;p&gt;LED: OFF&lt;/p&gt;<font></font>
        }<font></font>
     <span class="hljs-keyword">else</span><font></font>
     {<font></font>
        &lt;p&gt;LED: ON&lt;/p&gt;<font></font>
     }<font></font>
<font></font>
    @if (boolValueRelay == <span class="hljs-literal">false</span>)<font></font>
    {<font></font>
        &lt;p&gt;: OFF&lt;/p&gt;<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        &lt;p&gt;: ON&lt;/p&gt;<font></font>
    }<font></font>
    &lt;form name=<span class="hljs-string">"formaction"</span> action=<span class="hljs-string">"~/index.cshtml"</span> method=<span class="hljs-string">"get"</span>&gt;<font></font>
        &lt;h3&gt; Actuation&lt;/h3&gt;<font></font>
        &lt;p&gt; LED: <font></font>
            &lt;button name=<span class="hljs-string">"command"</span> type=<span class="hljs-string">"submit"</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">"led_on"</span>&gt; ON &lt;/button&gt;<font></font>
            &lt;button name=<span class="hljs-string">"command"</span> type=<span class="hljs-string">"submit"</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">"led_off"</span>&gt; OFF &lt;/button&gt;<font></font>
        &lt;/p&gt;<font></font>
        &lt;p&gt; : <font></font>
            &lt;button name=<span class="hljs-string">"command"</span> type=<span class="hljs-string">"submit"</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">"relay_on"</span>&gt; ON &lt;/button&gt;<font></font>
            &lt;button name=<span class="hljs-string">"command"</span> type=<span class="hljs-string">"submit"</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">"relay_off"</span>&gt; OFF &lt;/button&gt;<font></font>
        &lt;/p&gt;<font></font>
        &lt;p&gt;&lt;/p&gt;<font></font>
        &lt;p&gt;<font></font>
            &lt;button name=<span class="hljs-string">"update"</span> type=<span class="hljs-string">"submit"</span>&gt;   &lt;/button&gt;<font></font>
        &lt;/p&gt;<font></font>
    &lt;/form&gt;<font></font>
&lt;/body&gt;<font></font>
&lt;/html&gt;<font></font>
</code></pre><br>
</div></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›®å½•</font></font></b><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‹±ç‰¹å°”çˆ±è¿ªç”Ÿ </font><font style="vertical-align: inherit;">ç¬¬ä¸€æ¬¡å¼€å§‹</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‹±ç‰¹å°”çˆ±è¿ªç”Ÿ </font><font style="vertical-align: inherit;">ä½¿ç”¨è‹±ç‰¹å°”ç‰©è”ç½‘åˆ†æäº‘ï¼šè®°å½•å’Œå‘é€æ•°æ®</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‹±ç‰¹å°”çˆ±è¿ªç”Ÿ </font><font style="vertical-align: inherit;">ä¸è‹±ç‰¹å°”ç‰©è”ç½‘åˆ†æäº‘ä¸€èµ·ä½¿ç”¨ï¼šåˆ›å»ºè§„åˆ™å¹¶å‘é€é€šçŸ¥</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‹±ç‰¹å°”çˆ±è¿ªç”Ÿ </font><font style="vertical-align: inherit;">è‹±ç‰¹å°”ç‰©è”ç½‘åˆ†æäº‘ï¼šåœ¨ASP.NETä¸Šå‘é€SMSå’ŒRESTfulå®¢æˆ·ç«¯</font></font></li>
</ol></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN384929/">https://habr.com/ru/post/zh-CN384929/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN384915/index.html">å‡ºç‰ˆä¸å†™ä½œ</a></li>
<li><a href="../zh-CN384917/index.html">Raspberry Piå’ŒArduinoä¸Šçš„Turingç‚¸å¼¹æ¨¡æ‹Ÿå™¨</a></li>
<li><a href="../zh-CN384921/index.html">å°ç±³ä¸ä»…æ˜¯æ™ºèƒ½æ‰‹æœºåˆ¶é€ å•†çš„21ä¸ªåŸå› </a></li>
<li><a href="../zh-CN384923/index.html">ä¿ç½—Â·æ ¼é›·å„å§†ï¼ˆPaul Grahamï¼‰ï¼šé«˜ç§‘æŠ€åä¼š</a></li>
<li><a href="../zh-CN384925/index.html">èˆ’é€‚åœ°å”¤é†’-è‡ªå·±åŠ¨æ‰‹åšç¯å…‰è­¦æŠ¥</a></li>
<li><a href="../zh-CN384933/index.html">arduino JDY-40æ— çº¿ç”µæ¨¡å—</a></li>
<li><a href="../zh-CN384937/index.html">ç‰©è”ç½‘çš„å±é™©æ˜¯ä»€ä¹ˆï¼Œå€¼å¾—åˆ›é€ å—ï¼Ÿ</a></li>
<li><a href="../zh-CN384941/index.html">å†¥ç‹æ˜Ÿå«æ˜ŸCharonä¸Šçš„â€œå³¡è°·â€æ˜¯ä¸€ä¸ªå·¨å¤§çš„åœ°å£³ç ´è£‚</a></li>
<li><a href="../zh-CN384949/index.html">æ™ºèƒ½å†…è¡£ï¼šè°ä»¥åŠä¸ºä»€ä¹ˆåˆ¶é€ å‡ºè´´å¿ƒçš„å¯ç©¿æˆ´â€œç”µå­äº§å“â€</a></li>
<li><a href="../zh-CN384951/index.html">â€œç¡è§‰ï¼Œæˆ‘çš„å¿«ä¹ï¼Œç¡è§‰â€¦â€¦â€æˆ–ç¡çœ æœ‰ä»€ä¹ˆé—®é¢˜</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>