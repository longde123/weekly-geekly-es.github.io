<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐คฐ๐ผ ๐ ๐ค๐ฟ 6 ูุตุต ุนูููุฉ ูู ุฃูุงู ุงูุฃุณุจูุน SRE ูุฏููุง ๐คพ ๐ ๐คต๐ผ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุชุชููู ุงูุจููุฉ ุงูุชุญุชูุฉ ุงูุญุฏูุซุฉ ููุดุจูุฉ ูู ุงูุนุฏูุฏ ูู ุงูููููุงุช ูุฃุบุฑุงุถ ูุชุนุฏุฏุฉ ุ ูุงูุชู ููุง ุตูุฉ ูุงุถุญุฉ ูุบูุฑ ูุชุฑุงุจุทุฉ ููุบุงูุฉ. ูุตุจุญ ูุฐุง ูุงุถุญูุง ุจุดูู ุฎุงุต ุนูุฏ ุชุดุบูู ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>6 ูุตุต ุนูููุฉ ูู ุฃูุงู ุงูุฃุณุจูุน SRE ูุฏููุง</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/471892/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/7_/c-/_w/7_c-_wura080ohc4zdfyq6ummtw.png"><br><br>  ุชุชููู ุงูุจููุฉ ุงูุชุญุชูุฉ ุงูุญุฏูุซุฉ ููุดุจูุฉ ูู ุงูุนุฏูุฏ ูู ุงูููููุงุช ูุฃุบุฑุงุถ ูุชุนุฏุฏุฉ ุ ูุงูุชู ููุง ุตูุฉ ูุงุถุญุฉ ูุบูุฑ ูุชุฑุงุจุทุฉ ููุบุงูุฉ.  ูุตุจุญ ูุฐุง ูุงุถุญูุง ุจุดูู ุฎุงุต ุนูุฏ ุชุดุบูู ุงูุชุทุจููุงุช ุงูุชู ุชุณุชุฎุฏู ูุฌููุนุงุช ุจุฑุงูุฌ ูุฎุชููุฉ ุ ูุงูุชู ุจุฏุฃุช ูุน ุธููุฑ ุงูุฎุฏูุงุช ุงููุตุบุฑุฉ ูู ุญุฏูุซูุง ุญุฑูููุง ูู ูู ุฎุทูุฉ.  ุชุชู ุฅุถุงูุฉ ุงูุนูุงูู ุงูุฎุงุฑุฌูุฉ (ูุงุฌูุงุช ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ูุฌูุฉ ุฎุงุฑุฌูุฉ ุ ูุงูุฎุฏูุงุช ุ ููุง ุฅูู ุฐูู) ุฅูู "ุงููุชุนุฉ" ุงูุนุงูุฉ ุ ููุง ูุนูุฏ ุตูุฑุฉ ุตุนุจุฉ ุจุงููุนู. <br><br>  ุจุดูู ุนุงู ุ ุญุชู ูู ุชู ุชูุญูุฏ ูุฐู ุงูุชุทุจููุงุช ุจุฃููุงุฑ ูุญููู ูุนูุงุฑูุฉ ูุดุชุฑูุฉ ุ ูููุถุงุก ุนูู ุงููุดููุงุช ุบูุฑ ุงููุนุชุงุฏุฉ ูููุง ุ ุบุงูุจูุง ูุง ูุชุนูู ุนูููุง ุงูุชููู ุนุจุฑ ุงูุจุฑุงุฑู ุบูุฑ ุงููุฃูููุฉ ุงูุชุงููุฉ.  ูุง ุฅุฐุง ูุงูุช ูุฐู ุงููุดุงูู ุชุญุฏุซ ููุณุช ุณูู ูุณุฃูุฉ ููุช.  ูุฐู ูู ุงูุฃูุซูุฉ ูู ุฃุญุฏุซ ุงูููุงุฑุณุงุช ุงูุชู ูุฎุตุตูุง ููุฐู ุงูููุงูุฉ.  ุทุงูู ุงูุนูู: Golang ู Sentry ู RabbitMQ ู nginx ู PostgreSQL ูุบูุฑูุง. <a name="habracut"></a><br><br><h2 style=";text-align:right;direction:rtl">  ุงูุชุงุฑูุฎ ุฑูู 1.  Golang ู HTTP / 2 </h2><br>  ุฃุฏู ุชุดุบูู ูุนูุงุฑ ูููู ุจุงูุนุฏูุฏ ูู ุทูุจุงุช HTTP ุฅูู ุชุทุจูู ููุจ ุฅูู ูุชุงุฆุฌ ุบูุฑ ูุชููุนุฉ.  ููุชูู ุชุทุจูู Go ุงูุจุณูุท ูู ุงูุนูููุฉ ุงููุฑุฌุนูุฉ ุฅูู ุชุทุจูู Go ุขุฎุฑ ููุน ุฎูู ุงูุฏุฎูู / ุงูุงููุชุงุญ.  ุนูุฏ ุชูููู HTTP / 2. ุ ูุญุตู ุนูู ุฃุฎุทุงุก ูุน ุงูููุฏ 400 ูุจุนุถ ุงูุทูุจุงุช ุ ูููู ุณุจุจ ูุฐุง ุงูุณููู ุ ุฃุฒููุง ุชุทุจูู Go ูู ุงูููุงูุฉ ุงูุจุนูุฏุฉ ุนู ุงูุณูุณูุฉ ููููุง ุจุฅูุดุงุก ูููุน ุจุณูุท ูู Ingress ุ ูุงูุฐู ูุฑุฌุน ุฏุงุฆููุง ุฅูู 200. ูู ูุชุบูุฑ ุงูุณููู ุฏุงุฆููุง! <cut></cut><br><br>  ุซู ุชูุฑุฑ ุฅุนุงุฏุฉ ุฅูุชุงุฌ ุงูุจุฑูุงูุฌ ุงููุตู ุฎุงุฑุฌ ุจูุฆุฉ Kubernetes - ุนูู ูุทุนุฉ ูุฎุชููุฉ ูู ุงูุฃุฌูุฒุฉ.  ููุงูุช ุงููุชูุฌุฉ ุชูููู ููู Makefile ุ ุจูุณุงุนุฏุฉ ูู ุฅุทูุงู ุญุงููุชูู: ูู ุฃุญุฏ ุงููุนุงููุฑ ุงูุชู ุชุฐูุจ ุฅูู nginx ุ ูู ุงูุฃุฎุฑู - ูู Apache.  ููุงููุง ูุณุชูุน ุฅูู HTTP / 2 ูุน ุดูุงุฏุฉ ูููุนุฉ ุฐุงุชูุง.  ููุช ุงูุชุดุบูู ุงูููุงุฆู ูุฑู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://github.com/flant/examples/tree/master/2019/09-">ูุฐุง ุงููุณุชูุฏุน</a> . <br><br>  ูู ุจุชุดุบูู ุงููุนุงููุฑ <code>concurrency=200</code> : <br><br>  1.1.  ุฅูุฌู ุฅูุณ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Completed 0 requests Completed 1000 requests Completed 2000 requests Completed 3000 requests Completed 4000 requests Completed 5000 requests Completed 6000 requests Completed 7000 requests Completed 8000 requests Completed 9000 requests ----- Bench results begin ----- Requests per second: 10336.09 Failed requests: 1623 ----- Bench results end -----</code> </pre> <br>  1.2.  ุฃุจุงุชุดู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">โฆ ----- Bench results begin ----- Requests per second: 11427.60 Failed requests: 0 ----- Bench results end -----</code> </pre> <br>  ูุญู ููุชุฑุถ ุฃู ุงููุฏู ููุง ูู ุชุทุจูู HTTP / 2 ุฃูู ุตุฑุงูุฉ ูู Apache. <br><br>  ุฏุนูุง ูุญุงูู <code>concurrency=1000</code> : <br><br>  2.1.  ุฅูุฌู ุฅูุณ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">โฆ ----- Bench results begin ----- Requests per second: 11274.92 Failed requests: 4205 ----- Bench results end -----</code> </pre> <br>  2.2.  ุฃุจุงุชุดู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">โฆ ----- Bench results begin ----- Requests per second: 11211.48 Failed requests: 5 ----- Bench results end -----</code> </pre> <br>  ูู ุงูููุช ููุณู ุ ููุงุญุธ ุฃู ุงููุชุงุฆุฌ <i>ูุง</i> ูุชู <i>ุฅูุชุงุฌูุง ูู ูู ูุฑุฉ</i> : ุจุนุถ ุนูููุงุช ุงูุฅุทูุงู ุชูุฑ ุฏูู ูุดุงูู. <br><br>  ุฃุฏู ุงูุจุญุซ ุนู ุงููุดููุงุช ูู ุฌูุซุจ ูุดุฑูุน ุฌููุงูุฌ ุฅูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="># 25009</a> ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="># 32441</a> .  ูู ุฎูุงููู ุฐูุจูุง ุฅูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">PR 903</a> : ุชุนุทูู HTTP / 2 ูู Go ุงูุชุฑุงุถููุง! <br><br>  ูู ุงูุตุนุจ ููุบุงูุฉ ุชูุณูุฑ ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ ุฏูู ุงูุบูุต ุจุนูู ูู ุจููุฉ ุฎูุงุฏู ุงูููุจ ุงููุฐููุฑุฉ ุฃุนูุงู.  ูู ุญุงูุฉ ูุนููุฉ ุ ูุงู ูููู ุชุนุทูู HTTP / 2 ููุฎุฏูุฉ ุงููุญุฏุฏุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  ุงูุชุงุฑูุฎ ุฑูู 2.  ุงูุณูููููุฉ ุงููุฏููุฉ ูุงูุญุฑุงุณุฉ </h2><br>  ูู ุฃุญุฏ ุงููุดุงุฑูุน ุ ูุง ูุฒุงู ุฅุตุฏุงุฑ ูุฏูู ุฌุฏูุง ูู ุฅุทุงุฑ ุนูู symfony PHP (ุงูุฅุตุฏุงุฑ 2.3) ูุนูู.  ูุชู ุฅุฑูุงู ุนููู Raven ูุฏูู ููุตู ููุชูุจ ุฐุงุชููุง ูู PHP ุจู "ูู ุงููุฌููุนุฉ" ุ ููุง ูุนูุฏ ุชุตุญูุญ ุงูุฃุฎุทุงุก ููููุงู. <br><br>  ุจุนุฏ ููู ุฅุญุฏู ุงูุฎุฏูุงุช ูู Kubernetes ุฅูู ุชุฑูุจ ุ ูุชุณุชุฎุฏู ูุชุนูุจ ุงูุฃุฎุทุงุก ูู ุชุทุจูู ูุฐุง ุงููุดุฑูุน ุ ุชูููุช ุงูุฃุญุฏุงุซ ูุฌุฃุฉ ุงููุงุฏูุฉ.  ูุฅุนุงุฏุฉ ุฅูุชุงุฌ ูุฐุง ุงูุณููู ุ ุงุณุชุฎุฏููุง ุฃูุซูุฉ ูู ูููุน ุงูููุจ Sentry ุ ูุฃุฎุฐูุง ุฎูุงุฑูู ููุณุฎ DSN ูู ุฅุนุฏุงุฏุงุช Sentry.  ุจุตุฑูุง ุ ูู ุดูุก ูุนูู: ุชู ุฅุฑุณุงู ุฑุณุงุฆู ุงูุฎุทุฃ (ูุฒุนู) ูุงุญุฏุฉ ุชูู ุงูุฃุฎุฑู. <br><br>  ุฎูุงุฑ ุงูุชุญูู ูู ุฌุงูุง ุณูุฑูุจุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">&lt;!DOCTYPE html&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"https://browser.sentry-cdn.com/5.6.3/bundle.min.js"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">integrity</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"sha384-/Cqa/8kaWn7emdqIBLk3AkFMAHBk0LObErtMhO+hr52CntkaurEnihPmqYj3uJho"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">crossorigin</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"anonymous"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"><span class="xml"><span class="undefined"> </span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">JavaScript in Body</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"demo"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">A Paragraph.</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"myFunction()"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Try it</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="javascript"><span class="xml"><span class="javascript"> Sentry.init({ </span></span><span class="hljs-attr"><span class="xml"><span class="javascript"><span class="hljs-attr">dsn</span></span></span></span><span class="xml"><span class="javascript">: </span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">'http://33dddd76e9f0c4ddcdb51@sentry.kube-dev.test//12'</span></span></span></span><span class="xml"><span class="javascript"> }); </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">try</span></span></span></span><span class="xml"><span class="javascript"> { </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">throw</span></span></span></span><span class="xml"><span class="javascript"> </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">new</span></span></span></span><span class="xml"><span class="javascript"> </span></span><span class="hljs-built_in"><span class="xml"><span class="javascript"><span class="hljs-built_in">Error</span></span></span></span><span class="xml"><span class="javascript">(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">'Caught'</span></span></span></span><span class="xml"><span class="javascript">); } </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">catch</span></span></span></span><span class="xml"><span class="javascript"> (err) { Sentry.captureException(err); } </span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  ูุจุงููุซู ูู ุจูุซูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sentry_sdk <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> init, capture_message init(<span class="hljs-string"><span class="hljs-string">"http://33dddd76e9f0c4ddcdb51@sentry.kube-dev.test//12"</span></span>) capture_message(<span class="hljs-string"><span class="hljs-string">"Hello World"</span></span>) <span class="hljs-comment"><span class="hljs-comment"># Will create an event. raise ValueError()</span></span></code> </pre> <br>  ููุน ุฐูู ุ ูุฅููุง ูู ุชุญุตู ูู ุชุฑูุจ.  ุนูุฏ ุฅุฑุณุงู ุฑุณุงูุฉ ุ ูุชู ุฅูุดุงุก ุงูููู ุจุฃูู ุชู ุฅุฑุณุงู ุงูุฑุณุงูุฉ ุ ูุฃู ุงูุนููุงุก ููุดุฆูู ุนูู ุงูููุฑ ุชุฌุฒุฆุฉ ููุฐู ุงููุดููุฉ. <br><br>  ููุชูุฌุฉ ูุฐูู ุ ุชู ุญู ุงููุดููุฉ ุจุจุณุงุทุฉ ุดุฏูุฏุฉ: ุชู ุฅุฑุณุงู ุฅุฑุณุงู ุงูุฃุญุฏุงุซ ุฅูู HTTP ุ ูุงุณุชูุนุช ุฎุฏูุฉ ุชุฑูุจ ุงูุฃุตูุงุช ููุท ุฅูู HTTPS.  ุชู ุชูููุฑ ุฅุนุงุฏุฉ ุชูุฌูู ูู HTTP ุฅูู HTTPS ุ ููู ุงูุนููู ุงููุฏูู (ุงูููุฏ ุงูููุฌูุฏ ุนูู ุฌุงูุจ symfony) ูู ููู ูุงุฏุฑูุง ุนูู ูุชุงุจุนุฉ ุนูููุงุช ุฅุนุงุฏุฉ ุงูุชูุฌูู ุงูุชู ูุง ุชุชููุนูุง ุงูุชุฑุงุถููุง ูู ูุฐู ุงูุฃูุงู. <br><br><h2 style=";text-align:right;direction:rtl">  ุงูุชุงุฑูุฎ ุฑูู 3.  RabbitMQ ููููู ุงูุทุฑู ุงูุซุงูุซ </h2><br>  ูู ูุดุฑูุน ูุงุญุฏ ุ ูุชู ุงุณุชุฎุฏุงู ุณุญุงุจุฉ Evotor ูุฑุจุท ุณุฌูุงุช ุงูููุฏ.  ูู ุงููุงูุน ุ ุฅูู ูุนูู ููููู: ุชุฐูุจ ุทูุจุงุช POST ูู Evotor ูุจุงุดุฑุฉ ุฅูู RabbitMQ - ูู ุฎูุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุจุฑูุงูุฌ ุงููุณุงุนุฏ STOMP ุงูุฐู ุชู</a> ุชูููุฐู ุนุจุฑ ุงุชุตุงูุงุช WebSocket. <br><br>  ูุฏู ุฃุญุฏ ุงููุทูุฑูู ุทูุจุงุช ุงุฎุชุจุงุฑ ุจุงุณุชุฎุฏุงู Postman ูุชููู ุงูุฑุฏูุฏ ุงููุชููุนุฉ ูู <code>200 OK</code> ุ ููุน ุฐูู ุ ุฃุฏุช ุงูุทูุจุงุช ูู ุฎูุงู ูุฌููุนุฉ ุงููุธุฑุงุก ุฅูู <code>405 Method Not Allowed</code> ูุชููุนุฉ <code>405 Method Not Allowed</code> . <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">200 ุญุณูุง</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">source: kubernetes namespace: kube-nginx-ingress host: kube-node-2 pod_name: nginx-2bpt7 container_name: nginx stream: stdout app: nginx controller-revision-hash: 5bdbfd564 pod-template-generation: 25 time: 2019-09-10T09:42:50+00:00 request_id: 1271dba228f0943ab2df0196ff0d7f67 user: client address: 100.200.300.400 protocol: HTTP/1.1 scheme: http method: POST host: rmq-review.kube-dev.client.domain path: /api/queues/vhost/queue.gen.eeeeffff111:1.onlinecassa:55556666/get request_query: referrer: user_agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36 content_kind: cacheable namespace: review ingress: stomp-ws service: rabbitmq service_port: stats vhost: rmq-review.kube-dev.client.domain location: / nginx_upstream_addr: 10.127.1.1:15672 nginx_upstream_bytes_received: 2538 nginx_upstream_response_time: 0.008 nginx_upstream_status: 200 bytes_received: 757 bytes_sent: 1254 request_time: 0 status: 200 upstream_response_time: 0 upstream_retries: 0</code> </pre> </div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">405 ุงูุทุฑููุฉ ุบูุฑ ูุณููุญ ุจูุง</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">source: kubernetes namespace: kube-nginx-ingress host: kube-node-1 pod_name: nginx-4xx6h container_name: nginx stream: stdout app: nginx controller-revision-hash: 5bdbfd564 pod-template-generation: 25 time: 2019-09-10T09:46:26+00:00 request_id: b8dd789604864c95b4af499ed6805630 user: client address: 200.100.300.400 protocol: HTTP/1.1 scheme: http method: POST host: rmq-review.kube-dev.client.domain path: /api/queues/vhost/queue.gen.ef7fb93387ca9b544fc1ecd581cad4a9:1.onlinecassa:55556666/get request_query: referrer: user_agent: ru.evotor.proxy/37 content_kind: cache-headers-not-present namespace: review ingress: stomp-ws service: rabbitmq service_port: stats vhost: rmq-review.kube-dev.client.domain location: / nginx_upstream_addr: 10.127.1.1:15672 nginx_upstream_bytes_received: 134 nginx_upstream_response_time: 0.004 nginx_upstream_status: 405 bytes_received: 878 bytes_sent: 137 request_time: 0 status: 405 upstream_response_time: 0 upstream_retries: 0</code> </pre> </div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุทูุจ Tcpdump ูู Evotor</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">200.100.300.400.21519 &gt; 100.200.400.300: Flags [P.], cksum 0x8e29 (correct), seq 1:879, ack 1, win 221, options [nop,nop,TS val 2313007107 ecr 79097074], length 878: HTTP, length: 878 POST /api/queues//vhost/queue.gen.ef7fb93387ca9b544fc1ecd581cad4a9:1.onlinecassa:55556666/get HTTP/1.1 device-model: ST-5 device-os: android Accept-Encoding: gzip content-type: application/json; charset=utf-8 connection: close accept: application/json x-original-forwarded-for: 10.11.12.13 originhost: rmq-review.kube-dev.client.domain x-original-uri: /api/v2/apps/e114-aaef-bbbb-beee-abadada44ae/requests x-scheme: https accept-encoding: gzip user-agent: ru.evotor.proxy/37 Authorization: Basic X-Evotor-Store-Uuid: 20180417-73DC-40C9-80B7-00E990B77D2D X-Evotor-Device-Uuid: 20190909-A47B-40EA-806A-F7BC33833270 X-Evotor-User-Id: 01-000000000147888 Content-Length: 58 Host: rmq-review.kube-dev.client.domain {"count":1,"encoding":"auto","ackmode":"ack_requeue_true"}[!http] 12:53:30.095385 IP (tos 0x0, ttl 64, id 5512, offset 0, flags [DF], proto TCP (6), length 52) 100.200.400.300:80 &gt; 200.100.300.400.21519: Flags [.], cksum 0xfa81 (incorrect -&gt; 0x3c87), seq 1, ack 879, win 60, options [nop,nop,TS val 79097122 ecr 2313007107], length 0 12:53:30.096876 IP (tos 0x0, ttl 64, id 5513, offset 0, flags [DF], proto TCP (6), length 189) 100.200.400.300:80 &gt; 200.100.300.400.21519: Flags [P.], cksum 0xfb0a (incorrect -&gt; 0x03b9), seq 1:138, ack 879, win 60, options [nop,nop,TS val 79097123 ecr 2313007107], length 137: HTTP, length: 137 HTTP/1.1 405 Method Not Allowed Date: Tue, 10 Sep 2019 10:53:30 GMT Content-Length: 0 Connection: close allow: HEAD, GET, OPTIONS</code> </pre></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุทูุจ Tcpdump ุจูุงุณุทุฉ ุญูููุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">777.10.74.11.61211 &gt; 100.200.400.300:80: Flags [P.], cksum 0x32a8 (correct), seq 1:397, ack 1, win 2052, options [nop,nop,TS val 734012594 ecr 4012360530], length 396: HTTP, length: 396 POST /api/queues/%2Fvhost/queue.gen.ef7fb93387ca9b544fc1ecd581cad4a9:1.onlinecassa:55556666/get HTTP/1.1 Host: rmq-review.kube-dev.client.domain User-Agent: curl/7.54.0 Authorization: Basic = Content-Type: application/json Accept: application/json Content-Length: 58 {"count":1,"ackmode":"ack_requeue_true","encoding":"auto"}[!http] 12:40:11.001442 IP (tos 0x0, ttl 64, id 50844, offset 0, flags [DF], proto TCP (6), length 52) 100.200.400.300:80 &gt; 777.10.74.11.61211: Flags [.], cksum 0x2d01 (incorrect -&gt; 0xfa25), seq 1, ack 397, win 59, options [nop,nop,TS val 4012360590 ecr 734012594], length 0 12:40:11.017065 IP (tos 0x0, ttl 64, id 50845, offset 0, flags [DF], proto TCP (6), length 2621) 100.200.400.300:80 &gt; 777.10.74.11.61211: Flags [P.], cksum 0x370a (incorrect -&gt; 0x6872), seq 1:2570, ack 397, win 59, options [nop,nop,TS val 4012360605 ecr 734012594], length 2569: HTTP, length: 2569 HTTP/1.1 200 OK Date: Tue, 10 Sep 2019 10:40:11 GMT Content-Type: application/json Content-Length: 2348 Connection: keep-alive Vary: Accept-Encoding cache-control: no-cache vary: accept, accept-encoding, origin</code> </pre> </div></div><br>  ุชุฑู ุงูุนูู ุงููุฏุฑุจุฉ ูููููุฏุณ ุงููุฑู ุนูู ุงูููุฑ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุญูููุฉ: <code>POST /api/queues/%2Fclientโฆ</code> </li><li style=";text-align:right;direction:rtl">  Evotor: <code>POST /api/queues//clientโฆ</code> </li></ul><br>  ูุงู ุงูุดูุก ุฃูู ูู ุฅุญุฏู ุงูุญุงูุงุช <code>//vhost</code> ุบูุฑ ููููู (ุจุงููุณุจุฉ ุฅูู RabbitMQ) <code>//vhost</code> ุ ููู ุงูุญุงูุฉ ุงูุฃุฎุฑู - <code>%2Fvhost</code> ุ ููู ุงูุณููู ุงููุชููุน ุนูุฏูุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># rabbitmqctl list_vhosts Listing vhosts ... /vhost</code> </pre> <br>  ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุถูุฉ</a> ูุดุฑูุน RabbitMQ ุญูู ูุฐุง ุงูููุถูุน ุ ูุดุฑุญ ุงููุทูุฑ: <br><br><blockquote style=";text-align:right;direction:rtl">  ูู ูุณุชุจุฏู ุงูุชุฑููุฒูช.  ุฅููุง ุทุฑููุฉ ููุงุณูุฉ ูุชุฑููุฒ ูุณุงุฑ ุนููุงู URL ููุงูุช ููุฐ ุฒูู ุทููู.  ุนูู ุงูุชุฑุงุถ ุฃููช-encoding ูู ุงูุฃุฏูุงุช ุงูุชู ุชุณุชูุฏ ุฅูู HTTP ุณุชุฒูู ูุธุฑูุง ููุฌูุฏ ุญุชู ุงูุฅุทุงุฑ ุงูุฃูุซุฑ ุดููุนูุง ุนูู ุงูุชุฑุงุถ ุฃู ูุณุงุฑุงุช ุนูุงููู URL ูุฐู "ุถุงุฑุฉ" ูู ูุตูุฑุฉ ุงููุธุฑ ูุณุงุฐุฌุฉ.  ูููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุบููุฑ</a> ุงุณู ุงููุถูู ุงูุงูุชุฑุงุถู ุงูุงูุชุฑุงุถู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฅูู ุฃู ูููุฉ</a> (ูุซู ุชูู ุงูุชู ูุง ุชุณุชุฎุฏู ุฎุทูุท ูุงุฆูุฉ ุฃู ุฃู ุฃุญุฑู ุฃุฎุฑู ุชุชุทูุจูช-encoding) ูุนูู ุงูุฃูู ูุน ุฅุตุฏุงุฑ Pivotal BOSH ูู RabbitMQ ุ ูุชู ุญุฐู ุงููุถูู ุงูุธุงูุฑู ุงูุงูุชุฑุงุถู ูู ููุช ุงููุดุฑ ุนูู ุฃู ุญุงู . </blockquote><br>  ุชู ุญู ุงููุดููุฉ ุฏูู ูุฒูุฏ ูู ูุดุงุฑูุฉ ูููุฏุณููุง (ุนูู ุงูุฌุงูุจ Evotor ุจุนุฏ ุงูุงุชุตุงู ุจูู). <br><br><h2 style=";text-align:right;direction:rtl">  ุงูุชุงุฑูุฎ ุฑูู 4.  ุงูุฌูู ูู ุจูุณุชุฌุฑุณ </h2><br>  ูุญุชูู PostgreSQL ุนูู ููุฑุณ ูููุฏ ููุบุงูุฉ ุ ูุบุงูุจูุง ูุง ูุชู ูุณูุงูู.  ุจุฏุฃุช ูุฐู ุงููุตุฉ ูุน ุดูุงูู ุญูู ุงููุฑุงูู ูู ุงูุชุทุจูู.  ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงูุฉ ุญุฏูุซุฉ ุ</a> ูุฏููุง โโุจุงููุนู ูุซุงููุง ูุณูุฑ ุงูุนูู ุงูุชูุฑูุจู ุนูุฏ ุชุญููู ูุซู ูุฐู ุงูุญุงูุงุช.  ูููุง ูุฏููุง APM - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Atatus</a> - ุฃุธูุฑุช ุงูุตูุฑุฉ ุงูุชุงููุฉ: <br><br><img src="https://habrastorage.org/webt/t9/yy/gz/t9yygzwma4valcmjnpt-lbfxpdi.png"><br><br>  ูู ุงูุณุงุนุฉ 10 ุตุจุงุญูุง ุ ููุงู ุฒูุงุฏุฉ ูู ุงูููุช ุงูุฐู ููุถูู ุงูุชุทุจูู ูู ุงูุนูู ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช.  ููุง ูู ูุชููุน ุ ูููู ุงูุณุจุจ ูู ุงูุงุณุชุฌุงุจุงุช ุงูุจุทูุฆุฉ ููุธุงู ุฅุฏุงุฑุฉ ููุงุนุฏ ุงูุจูุงูุงุช.  ุจุงููุณุจุฉ ููุง ุ ูุนุฏ ุชุญููู ุงูุงุณุชุนูุงูุงุช ูุชุญุฏูุฏ ูุฌุงูุงุช ุงููุดููุงุช ูููุงุฑุณ "ุงูุชุนููู" ุฑูุชูููุง ููููููุง.  ูุณุงุนุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">okmeter</a> ุงูุฐู ูุณุชุฎุฏูู ููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุซูุฑูุง</a> : ููุงู ูู ูู ุงูููุญุงุช ุงูููุงุณูุฉ ููุฑุงูุจุฉ ุญุงูุฉ ุงูุฎูุงุฏู ุ ูุงููุฏุฑุฉ ุนูู ุจูุงุก <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุญุงุชูุง</a> <i>ุจุณุฑุนุฉ</i> - ูู ุฎูุงู ุฅุฎุฑุงุฌ ููุงููุณ ุฅุดูุงููุฉ: <br><br><img src="https://habrastorage.org/webt/5r/8h/2p/5r8h2pfgbo_rxewvzgf_3jyjcii.png"><br><br>  ุชุดูุฑ ุงูุฑุณูู ุงูุจูุงููุฉ ูุชุญููู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุฅูู ุฃู ุฅุญุฏู ููุงุนุฏ ุงูุจูุงูุงุช ูุชู ุชุญููููุง ุจูุณุจุฉ 100ูช.  ููุงุฐุงุ  ุณุชุทุงูุจ ููุญุงุช PostgreSQL ุงูุฌุฏูุฏุฉ ุจูุง ููู: <br><br><img src="https://habrastorage.org/webt/i0/pq/de/i0pqdejoizrp518mnsnguoljkdg.png"><br><br>  ุณุจุจ ุงููุดููุงุช ูุงุถุญ ุนูู ุงูููุฑ - ุงููุณุชููู ุงูุฑุฆูุณู ููุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> u.* <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> u <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> u.id = ? &amp; u.field_1 = ? <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> u.field_2 <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'%somestring%'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> u.id <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> ?</code> </pre> <br>  ุจุงููุธุฑ ุฅูู ุฎุทุฉ ุงูุนูู ุงูุฎุงุตุฉ ุจุงุณุชุนูุงู ุงููุดููุฉ ุ ูุฌุฏูุง ุฃู ุงูุชุตููุฉ ุญุณุจ ุงูุญููู ุงููููุฑุณุฉ ูู ุงูุฌุฏูู ุชููุฑ <code>field_1</code> ูุจูุฑูุง ููุบุงูุฉ: ุชุชููู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฃูุซุฑ ูู 70 ุฃูู ุตู ุญุณุจ <code>id</code> ู <code>field_1</code> ุ ุซู ุชุจุญุซ ุนู ุณูุณูุฉ ูุฑุนูุฉ ูููุง ุจูููุง.  ุงุชุถุญ ุฃู <code>LIKE</code> ุนูู ุณูุณูุฉ ูุฑุนูุฉ ูุชูุฑุฑ ุนูู ูููุฉ ูุจูุฑุฉ ูู ุงูุจูุงูุงุช ุงููุตูุฉ ุ ููุง ูุคุฏู ุฅูู ุชุจุงุทุค ุฎุทูุฑ ูู ุชูููุฐ ุงูุงุณุชุนูุงู ูุฒูุงุฏุฉ ูู ุชุญููู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ. <br><br>  <i>ููุง ููููู ุฃู ุชูุงุญุธ ุจุญู ุฃู ุงููุดููุฉ ุงููุนูุงุฑูุฉ ูุง ุชุณุชุจุนุฏ (ููุฒู ุชุตุญูุญ ููุทู ุงูุชุทุจูู ุฃู ุญุชู ูุญุฑู ุงููุต ุงููุงูู ...) ุ ูููู ูุง ููุฌุฏ ููุช ูุฅุนุงุฏุฉ ุตูุงุบุฉ ุ ูููู ูุงู ูุฌุจ ุฃู ูุนูู ุจุณุฑุนุฉ ูุจู 15 ุฏูููุฉ.</i>  <i>ูู ุงูููุช ููุณู ุ ูุฅู ูููุฉ ุงูุจุญุซ ูู ูู ุงูุญูููุฉ ููุนุฑูู (ูููุงุฐุง ูุง ุชูุฌุฏ ูู ุญูู ูููุตูุ ..) ุ ูุงูุชู ุชูุชุฌ ูุญุฏุงุช ูู ุงูุฎุทูุท.</i>  <i>ูู ุงููุงูุน ุ ุฅุฐุง ุงุณุชุทุนูุง ุฅูุดุงุก ููุฑุณ ูู ุญูู ุงููุต ูุฐุง ุ ูุณุชุตุจุญ ุฌููุน ุงูููุงุฑุณ ุงูุฃุฎุฑู ุบูุฑ ุถุฑูุฑูุฉ.</i> <br><br>  ุงูุญู ุงูููุงุฆู ุงูุญุงูู ูู ุฅุถุงูุฉ ููุฑุณ GIN ูู <code>field_2</code> .  ูุฐุง ูู ุจุทู ุงูููู - ููุณ "ุงูุฌูู".  ุจุงุฎุชุตุงุฑ ุ GIN ูู ููุน ูู ุงูููุฑุณ ูุนูู ุจุดูู ุฌูุฏ ุฌุฏูุง ูู ุงูุจุญุซ ุนู ุงููุต ุงููุงูู ุ ููุง ูุณุฑุนู ููุนููุง.  ููููู ูุฑุงุกุฉ ุงููุฒูุฏ ุนููุง ุ ุนูู ุณุจูู ุงููุซุงู ุ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฐู ุงููุงุฏุฉ ุงูุฑุงุฆุนุฉ</a> . <br><br><img src="https://habrastorage.org/webt/sm/lw/qd/smlwqdjwdystzwexf0rfz-hk6qq.png"><br><br>  ููุง ุชุฑูู ุ ุณูุญุช ูุฐู ุงูุนูููุฉ ุงูุจุณูุทุฉ ุจุฅุฒุงูุฉ ุงูุญูู ุงูุฅุถุงูู ููุนูุง - ูุชูููุฑ ุงููุงู ููุนููู. <br><br><h2 style=";text-align:right;direction:rtl">  ุงูุชุงุฑูุฎ ุฑูู 5.  ุงูุชุฎุฒูู ุงููุคูุช S3 ูู ุฅูุฌู ุฅูุณ </h2><br>  ูุทุงููุง ูุงู ุงูุชุฎุฒูู ุงูุณุญุงุจู ุงููุชูุงูู ูุน S3 ุซุงุจุชูุง ูู ูุงุฆูุฉ ุงูุชูููุงุช ุงููุณุชุฎุฏูุฉ ูู ุงูุนุฏูุฏ ูู ุงููุดุงุฑูุน.  ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ุชุฎุฒูู ุตูุฑ ููุซูู ุจู ููููุนู ุฃู ูุจูุงูุงุช ุงูุดุจูุฉ ุงูุนุตุจูุฉ ุ ูุฅู Amazon S3 ูุนุฏ ุฎูุงุฑูุง ุฑุงุฆุนูุง.  ููุซูููุฉ ุงูุชุฎุฒูู ูุชูุงูุฑ ุงูุจูุงูุงุช ุนุงููุฉ (ูุนุฏู ุงูุญุงุฌุฉ ุฅูู "ุณูุงุฌ ุงูุญุฏููุฉ") ุขุณุฑ. <br><br>  ููุน ุฐูู ุ ูู ุจุนุถ ุงูุฃุญูุงู ูุชูููุฑ ุงููุงู - ูุฃูู ุนุงุฏุฉู ูุง ูุชู ุงูุฏูุน ููุงุจู S3 ููุทูุจุงุช ูููุญุฑูุฉ - ูู ุงูุญููู ุงูุฌูุฏุฉ ุชุซุจูุช ุฎุงุฏู ูููู ููุชุฎุฒูู ุงููุคูุช ุฃูุงู ูุญุฏุฉ ุงูุชุฎุฒูู.  ุณุชููู ูุฐู ุงูุทุฑููุฉ ูู ุงูุชูุงููู ุนูุฏูุง ูุชุนูู ุงูุฃูุฑ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุจุฃูุงุชุงุฑ ุงููุณุชุฎุฏู ุ ูุงูุชู ููุฌุฏ ุงููุซูุฑ ูููุง ูู ูู ุตูุญุฉ. <br><br>  ูุจุฏู ุฃูู ุฃุณูู ูู ุฃุฎุฐ nginx ูุฅุนุฏุงุฏ ุงููููุงุก ูุน ุงูุชุฎุฒูู ุงููุคูุช ุ ุฅุนุงุฏุฉ ุงูุชุญูู ุ ุชุญุฏูุซ ุงูุฎูููุฉ ูุบูุฑูุง ูู ูุนุจุฉ ูุฑูุ  ููุน ุฐูู ุ ููุง ูู ุงูุญุงู ูู ุฃู ููุงู ุขุฎุฑ ุ ููุงู ุจุนุถ ุงููุฑูู ุงูุฏูููุฉ ... <br><br>  ุจุฏุง ุงูุชูููู ุงูุชูุฑูุจู ููุซู ูุฐุง ุงููููู ูุน ุงูุชุฎุฒูู ุงููุคูุช ููุง ููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">proxy_cache_key $uri; proxy_cache_methods GET HEAD; proxy_cache_lock on; proxy_cache_revalidate on; proxy_cache_background_update on; proxy_cache_use_stale updating error timeout invalid_header http_500 http_502 http_503 http_504; proxy_cache_valid 200 1h; location ~ ^/(?&lt;bucket&gt;avatars|images)/(?&lt;filename&gt;.+)$ { set $upstream $bucket.s3.amazonaws.com; proxy_pass http://$upstream/$filename; proxy_set_header Host $upstream; proxy_cache aws; proxy_cache_valid 200 1h; proxy_cache_valid 404 60s; }</code> </pre> <br>  ูุจุดูู ุนุงู ุ ูุฌุญุช: ุชู ุนุฑุถ ุงูุตูุฑ ุ ูู ุดูุก ูุงู ุฌูุฏูุง ูุน ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ... ููุน ุฐูู ุ ุธูุฑุช ูุดุงูู ูุน ุนููุงุก AWS S3.  ุนูู ูุฌู ุงูุฎุตูุต ุ ุชููู ุงูุนููู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">aws-sdk-php</a> ุนู ุงูุนูู.  ุฃุธูุฑ ุชุญููู ุณุฌูุงุช nginx ุฃู ุงูููุจุน ุฃุนุงุฏ ุฑูุฒ 403 ูุทูุจุงุช HEAD ุ ูุฃู ุงูุงุณุชุฌุงุจุฉ ุชุญุชูู ุนูู ุฎุทุฃ ูุญุฏุฏ: <code>SignatureDoesNotMatch</code> .  ุนูุฏูุง ุฑุฃููุง ุฃู nginx ููุฏู ุทูุจูุง ููุญุตูู ุนูู ุงูููุจุน ุ ููุฏ ุฃุตุจุญ ูู ุดูุก ูู ููุงูู. <br><br>  ูุงูุญูููุฉ ูู ุฃู ุงูุนููู S3 ูููุน ูู ุทูุจ ุ ูุงูุฎุงุฏู ูุชุญูู ูุฐุง ุงูุชูููุน.  ูู ุญุงูุฉ ุงูุจุฑููุณู ุงูุจุณูุท ุ ูู ุดูุก ูุนูู ุจุดูู ุฌูุฏ: ูุตู ุงูุทูุจ ุฅูู ุงูุฎุงุฏู ุฏูู ุชุบููุฑ.  ููุน ุฐูู ุ ุนูุฏ ุชูููู ุงูุชุฎุฒูู ุงููุคูุช ุ ูุจุฏุฃ nginx ูู ุชุญุณูู ุงูุนูู ูุน ุงููุงุฌูุฉ ุงูุฎูููุฉ ูุงุณุชุจุฏุงู ุทูุจุงุช HEAD ุจู GET.  ุงูููุทู ุจุณูุท: ูู ุงูุฃูุถู ุงุณุชุฑุฏุงุฏ ูุญูุธ ุงููุงุฆู ุจุงููุงูู ุ ููู ุซู ุฌููุน ุทูุจุงุช HEAD ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุฃูุถูุง.  ููุน ุฐูู ุ ูู ุญุงูุชูุง ุ ูุง ูููู ุชุนุฏูู ุงูุทูุจ ุ ูุฃูู ุชู ุชูููุนู. <br><br>  ููุงู ุญูุงู ุฃุณุงุณูุงู: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุง ุชุฏูุน ุนููุงุก S3 ุนุจุฑ ุงููููุงุก ุ </li><li style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู "ุถุฑูุฑููุง" ุ ูุฃููู ุชุดุบูู <code>proxy_cache_convert_head</code> <code>$request_method</code> ุฅูู ููุชุงุญ ุงูุชุฎุฒูู ุงููุคูุช.  ูู ูุฐู ุงูุญุงูุฉ ุ ูููู nginx ุจุฅุฑุณุงู ุทูุจุงุช HEAD "ููุง ูู" ูุชุฎุฒูู ุงูุฑุฏูุฏ ุนูููุง ุจุดูู ูููุตู. </li></ol><br><h2 style=";text-align:right;direction:rtl">  ุงูุชุงุฑูุฎ ุฑูู 6.  DDoS ููุญุชูู ูุณุชุฎุฏู Google </h2><br>  ูู ูุณุงุก ุงูุฃุญุฏ ูุง ุชูุฐุฑ ุงููุดุงูู ุญุชู - ูุฌุฃุฉ!  - ูุงุฆูุฉ ุงูุชุธุงุฑ ุฅุจุทุงู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุนูู ุฎูุงุฏู ุงูุญุงูุฉ ูู ุชููู ุ ููุง ูุนุทู ุญุฑูุฉ ูุฑูุฑ ูููุณุชุฎุฏููู ุงูุญูููููู.  ูุฐุง ุนุฑุถ ุบุฑูุจ ููุบุงูุฉ: ุจุนุฏ ูู ุดูุก ุ ูุชู ุชูููุฐ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูู ุงูุฐุงูุฑุฉ ููุง ุชุฑุชุจุท ุจูุญุฑูุงุช ุงูุฃูุฑุงุต ุงูุซุงุจุชุฉ.  ุชุนุฏ ุนูููุฉ ูุณุญ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูู ุงูุจููุฉ ุงููุณุชุฎุฏูุฉ ุนูููุฉ ุฑุฎูุตุฉ ุ ูุฐูู ูุง ูููู ุฃู ูุธูุฑ ูุฐุง ุงูุฎุทุฃ ุฅูุง ูู ุญุงูุฉ ุงูุญูู ุงูุนุงูู ุญููุง.  ุชู ุชุฃููุฏ ุฐูู ูู ุฎูุงู ุญูููุฉ ุฃู ููุณ ุงูุฎูุงุฏู ุจุฏุฃุช ูู ุงูุฅุจูุงุบ ุนู ุธููุฑ 500 ุฎุทุฃ <i>(ุงุฑุชูุงุน ุงูุฎุท ุงูุฃุญูุฑ ูู ุงูุฑุณู ุงูุจูุงูู ุฃุฏูุงู)</i> . <br><br><img src="https://habrastorage.org/webt/3-/cr/ec/3-crecmpt9kbmt7o_6gujxwiru0.png"><br><br>  ุฃุฏุช ูุฐู ุงูุฒูุงุฏุฉ ุงูุญุงุฏุฉ ุฅูู ุชุฌุงูุฒุงุช ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ: <br><br><img src="https://habrastorage.org/webt/2t/vn/cw/2tvncw9vkrti9ysqmil7bmcztk0.png"><br><br>  ุฃุธูุฑ ุชุญููู ุณุฑูุน ุฃู ุงูุทูุจุงุช ูู ุชุตู ุฅูู ุงููุฌุงูุงุช ุงูุฑุฆูุณูุฉ ุ ูููู ูู ุงูุณุฌูุงุช ุฃุตุจุญ ูู ุงููุงุถุญ ุฃููู ูุงููุง ูู vhost ุงูุงูุชุฑุงุถู.  ุนูู ุทูู ุงูุทุฑูู ุ ุงุชุถุญ ุฃู ุงูุนุฏูุฏ ูู ุงููุณุชุฎุฏููู ุงูุฃูุฑููููู ุฌุงุกูุง ุฅูู ุงูููุฑุฏ ุงูุฑูุณู.  ูุซู ูุฐู ุงูุธุฑูู ุฏุงุฆูุง ุชุซูุฑ ุงูุฃุณุฆูุฉ ุนูู ุงูููุฑ. <br><br>  ุจุนุฏ ุฌูุน ุงูุจูุงูุงุช ูู ุณุฌูุงุช nginx ุ ูุดููุง ุฃููุง ูุชุนุงูู ูุน ุดุจูุฉ ุฑูุจูุช ูุนููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">35.222.30.127 US [15/Sep/2019:21:40:00 +0300] GET "http://example.ru/?ITPDH=XHJI" HTTP/1.1 301 178 "http://example.ru/ORQHYGJES" "Mozilla/5.0 (Windows; U; Windows NT 5.2; en-US; rv:1.9.1.3) Gecko/20090824 Firefox/3.5.3 (.NET CLR 3.5.30729)" "-" "upcache=-" "upaddr=-" "upstatus=-" "uplen=-" "uptime=-" spdy="" "loc=wide-closed.example.ru.undef" "rewrited=/?ITPDH=XHJI" "redirect=http://www.example.ru/?ITPDH=XHJI" ancient=1 cipher=- "LM=-;EXP=-;CC=-" 107.178.215.0 US [15/Sep/2019:21:40:00 +0300] GET "http://example.ru/?REVQSD=VQPYFLAJZ" HTTP/1.1 301 178 "http://www.usatoday.com/search/results?q=MLAJSBZAK" "Mozilla/5.0 (Windows; U; MSIE 7.0; Windows NT 6.0; en-US)" "-" "upcache=-" "upaddr=-" "upstatus=-" "uplen=-" "uptime=-" spdy="" "loc=wide-closed.example.ru.undef" "rewrited=/?REVQSD=VQPYFLAJZ" "redirect=http://www.example.ru/?REVQSD=VQPYFLAJZ" ancient=1 cipher=- "LM=-;EXP=-;CC=-" 107.178.215.0 US [15/Sep/2019:21:40:00 +0300] GET "http://example.ru/?MPYGEXB=OMJ" HTTP/1.1 301 178 "http://engadget.search.aol.com/search?q=MIWTYEDX" "Mozilla/5.0 (Windows; U; Windows NT 6.1; en; rv:1.9.1.3) Gecko/20090824 Firefox/3.5.3 (.NET CLR 3.5.30729)" "-" "upcache=-" "upaddr=-" "upstatus=-" "uplen=-" "uptime=-" spdy="" "loc=wide-closed.example.ru.undef" "rewrited=/?MPYGEXB=OMJ" "redirect=http://www.example.ru/?MPYGEXB=OMJ" ancient=1 cipher=- "LM=-;EXP=-;CC=-"</code> </pre> <br>  ูุชู ุชุชุจุน ููุท ููููู ูู ุงูุณุฌูุงุช: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูููู ุงููุณุชุฎุฏู ุงูุญูููู ุ </li><li style=";text-align:right;direction:rtl">  ุทูุจ ุฅูู ุนููุงู URL ุงูุฌุฐุฑ ูุน ูุณูุทุฉ GET ุนุดูุงุฆูุฉ ูุชุฌูุจ ุงููููุน ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุ </li><li style=";text-align:right;direction:rtl">  ูุดูุฑ ุงููุฑุฌุน ุฅูู ุฃู ุงูุทูุจ ุฌุงุก ูู ูุญุฑู ุจุญุซ. </li></ul><br>  ูููู ุจุฌูุน ุงูุนูุงููู ูุงูุชุญูู ูู ุงูุชูุงุฆูุง - ุฌููุนูุง ุชูุชูู ุฅูู <code>googleusercontent.com</code> ุ ูุน ุดุจูุชูู ูุฑุนูุชูู (107.178.192.0/18 ู 34.64.0.0/10).  ุชุญุชูู ูุฐู ุงูุดุจูุงุช ุงููุฑุนูุฉ ุนูู ุฃุฌูุฒุฉ GCE ุงูุชุฑุงุถูุฉ ูุฎุฏูุงุช ูุชููุนุฉ ุ ูุซู ุชุฑุฌูุฉ ุงูุตูุญุฉ. <br><br>  ูุญุณู ุงูุญุธ ุ ูุฅู ุงููุฌูู ูู ูุฏู ุทูููุงู (ุญูุงูู ุณุงุนุฉ) ูุงูุฎูุถ ุชุฏุฑูุฌูุงู.  ูุจุฏู ุฃู ุงูุฎูุงุฑุฒููุงุช ุงูููุงุฆูุฉ ุฏุงุฎู Google ูุฏ ูุฌุญุช ุ ูุฐุง ุชู ุญู ุงููุดููุฉ "ุจููุณูุง". <br><br>  ูู ููู ูุฐุง ุงููุฌูู ูุฏูุฑุงู ุ ูููู ุฃุซุงุฑ ุฃุณุฆูุฉ ูููุฏุฉ ูููุณุชูุจู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุงุฐุง ูุง ุชุนูู ููุงูุญุฉ ddosุ  ูุชู ุงุณุชุฎุฏุงู ุฎุฏูุฉ ุฎุงุฑุฌูุฉ ุ ูุงูุชู ุฃุฑุณููุง ุฅูููุง ุทูุจูุง ูุทุงุจููุง.  ููุน ุฐูู ุ ูุงู ููุงู ุงููุซูุฑ ูู ุงูุนูุงููู ... </li><li style=";text-align:right;direction:rtl">  ููู ุชุญูู ููุณู ูู ูุฐุง ูู ุงููุณุชูุจูุ  ูู ุญุงูุชูุง ุ ุญุชู ุฎูุงุฑุงุช ุฅุบูุงู ุงููุตูู ุนูู ุฃุณุงุณ ุฌุบุฑุงูู ููููุฉ. </li></ul><br><h2 style=";text-align:right;direction:rtl">  PS </h2><br>  ุงูุฑุฃ ุฃูุถูุง ูู ูุฏููุชูุง: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู ุงูุญูุงุฉ ูุน Kubernetes: ููู ูู ูุดุชู ุงูุฃุณุจุงู ูู ุฎุงุฏู HTTP</a> " ุ </li><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">6 ุฃุฎุทุงุก ูุธุงู ูุณููุฉ ูู ุชุดุบูู Kubernetes [ูุญููุง]</a> " ุ </li><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">3 ุญุงูุงุช ุบูุฑ ุนุงุฏูุฉ ุญูู ุงููุธุงู ุงููุฑุนู ูุดุจูุฉ Linux</a> ." </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar471892/">https://habr.com/ru/post/ar471892/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar471880/index.html">ููุฑุฉ ูู Geek Halloween ุ ุฃู ุญุงู ุงูููุช ูุงุฎุชูุงุฑ GeekMask</a></li>
<li><a href="../ar471882/index.html">ูุงุฆูุฉ ููุชูุญุฉ ูู ุงูุฃุญุฏุงุซ PHP ุ ูุงููุชุญุฏุซูู ูุงูููุธููู ุนูู ุฌูุซุจ</a></li>
<li><a href="../ar471884/index.html">10 ุฃุฏูุงุช ูุณุงุนุฏุฉ ApexSQL ูุฌุงููุฉ ูุฅุฏุงุฑุฉ ููุงุนุฏ ุจูุงูุงุช Microsoft SQL Server</a></li>
<li><a href="../ar471886/index.html">ุจุฑูุงูุฌ VMmanager 6: ุชูุฏูู ุงููุฑุจุน ูุงูููุงุฑูุฉ ูุน ุงูุฌูู ุงูุณุงุจู</a></li>
<li><a href="../ar471890/index.html">ุงูุงุณุชุฏูุงู ุงููุชุบูุฑ - ูุง ูู ููุงุฐุง ูุฃููุ</a></li>
<li><a href="../ar471896/index.html">ุงูุฏุงุฎู Playbook. ููุฒุงุช ุงูุดุจูุฉ ูู ูุญุฑู Ansible ุงูุฌุฏูุฏ 2.9</a></li>
<li><a href="../ar471904/index.html">ูุฎุทุท ุงูููุงุฑุฏ ูู HPE InfoSight</a></li>
<li><a href="../ar471906/index.html">ูุฎุงุทุฑ ุงูุชุญุณููุงุช ุบูุฑ ุงูุตุญูุญุฉ</a></li>
<li><a href="../ar471908/index.html">ุฌูุงู ุบูุฑ ูุชููุน ูู ุงูุฃุนุฏุงุฏ ุงูุฃูููุฉ</a></li>
<li><a href="../ar471912/index.html">ุชุนูู ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ: 7 ุทุฑู ุนูููุฉ ูุชูุณูุน ุงูููุฑุฏุงุช ุงูุฎุงุตุฉ ุจู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>