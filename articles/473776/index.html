<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍬 🤙🏻 🤸🏽 Unificación de reglas de validación por el ejemplo de Asp core + VueJS 💪 🔏 ⏸️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este artículo describe una manera simple de unificar las reglas de validación de entrada del usuario para una aplicación cliente-servidor. Usando un p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Unificación de reglas de validación por el ejemplo de Asp core + VueJS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473776/"><p><img src="https://habrastorage.org/webt/aq/-m/hx/aq-mhx5bf0a0_ablfc-ers0kvki.png"><br>  <em>Este artículo describe una manera simple de unificar las reglas de validación de entrada del usuario para una aplicación cliente-servidor.</em>  <em>Usando un proyecto simple como ejemplo, mostraré cómo se puede hacer esto usando Asp net core y Vue js.</em> </p><br><p>  Al desarrollar aplicaciones web, como regla, nos enfrentamos a la tarea de doble validación de la entrada del usuario.  Por un lado, la entrada del usuario debe validarse en el cliente para reducir las solicitudes redundantes al servidor y acelerar la validación del usuario.  Por otro lado, hablando de validación, el servidor no puede aceptar "en fe" que la validación del cliente realmente funcionó antes de enviar la solicitud, porque  el usuario podría deshabilitar o modificar el código de validación.  O incluso haga una solicitud desde la API del cliente manualmente. </p><a name="habracut"></a><br><p>  Por lo tanto, la interacción clásica cliente-servidor tiene 2 nodos, con reglas de validación de entrada del usuario a menudo idénticas.  Este artículo en su conjunto se ha discutido en más de un artículo; aquí se describirá una solución ligera utilizando el servidor ASP.Net Core API y el cliente Vue js como ejemplo. </p><br><p> Para comenzar, determinaremos que validaremos exclusivamente las solicitudes del usuario (equipo), no la entidad, y, desde el punto de vista de la arquitectura clásica de 3 capas, nuestra validación está en la capa de presentación. </p><br><h1 id="servernaya-chast">  Lado del servidor </h1><br><p>  Mientras esté en Visual Studio 2019, crearé un proyecto para una aplicación de servidor, utilizando la plantilla de aplicación web ASP.NET Core, con un tipo de API.  La ASP lista para usar tiene un mecanismo de validación bastante bueno y extensible: validación del modelo, según el cual, las propiedades de solicitud del modelo están marcadas con atributos de validación específicos. </p><br><p>  Considere esto con un controlador simple como ejemplo: </p><br><pre><code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Route(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"[controller]"</span></span></span><span class="hljs-meta">)</span></span>] [ApiController] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AccountController</span></span> : <span class="hljs-title"><span class="hljs-title">ControllerBase</span></span> { [HttpPost(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(Registration))] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Registration</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[FromBody]RegistrationRequest request</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Ok(<span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{request.Name}</span></span></span><span class="hljs-string">,  !"</span></span>); } }</code> </pre> <br><p>  La solicitud para registrar un nuevo usuario se verá así: </p><br><div class="spoiler">  <b class="spoiler_title">Solicitud de registro</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RegistrationRequest</span></span> { [StringLength(maximumLength: <span class="hljs-number"><span class="hljs-number">50</span></span>, MinimumLength = <span class="hljs-number"><span class="hljs-number">2</span></span>, ErrorMessage = <span class="hljs-string"><span class="hljs-string">"     2  50 "</span></span>)] [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">" "</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">"  . "</span></span>)] [EmailAddress(ErrorMessage = <span class="hljs-string"><span class="hljs-string">"  . "</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Email { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">" "</span></span>)] [MaxLength(<span class="hljs-number"><span class="hljs-number">100</span></span>, ErrorMessage = <span class="hljs-string"><span class="hljs-string">"{0}    {1} "</span></span>)] [MinLength(<span class="hljs-number"><span class="hljs-number">6</span></span>, ErrorMessage =<span class="hljs-string"><span class="hljs-string">"{0}    {1} "</span></span>)] [DisplayName(<span class="hljs-string"><span class="hljs-string">""</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Password { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">" "</span></span>)] [Range(<span class="hljs-number"><span class="hljs-number">18</span></span>,<span class="hljs-number"><span class="hljs-number">150</span></span>, ErrorMessage = <span class="hljs-string"><span class="hljs-string">"      18  150"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Age { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DisplayName(<span class="hljs-string"><span class="hljs-string">""</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Culture { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> </div></div><br><p>  Utiliza atributos de validación predefinidos del espacio de nombres System.ComponentModel.DataAnnotations.  Las propiedades requeridas están marcadas con el atributo requerido.  Por lo tanto, al enviar JSON vacío ("{}"), nuestra API devolverá: </p><br><pre> <code class="json hljs">{ ... <span class="hljs-attr"><span class="hljs-attr">"errors"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Age"</span></span>: [ <span class="hljs-string"><span class="hljs-string">" "</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"Name"</span></span>: [ <span class="hljs-string"><span class="hljs-string">" "</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"Email"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"  . "</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"Password"</span></span>: [ <span class="hljs-string"><span class="hljs-string">" "</span></span> ] } }</code> </pre> <br><p>  El primer problema que se puede encontrar en esta etapa es la localización de descripciones de error.  Por cierto, ASP tiene herramientas de localización integradas, lo consideraremos más adelante. </p><br><p>  Para verificar la longitud de los datos de la cadena, puede usar los atributos con nombres de voz: StringLength, MaxLength y MinLength.  Al mismo tiempo, formateando cadenas (llaves), los parámetros de los atributos se pueden integrar en un mensaje.  Por ejemplo, para el nombre de usuario, insertamos la longitud mínima y máxima en el mensaje, y para la contraseña "nombre para mostrar" especificada en el atributo del mismo nombre.  El atributo Range es responsable de verificar el valor que debe estar en el rango especificado. <br>  Enviemos una solicitud con un nombre de usuario y contraseña inaceptablemente cortos: </p><br><pre> <code class="json hljs"> { <span class="hljs-attr"><span class="hljs-attr">"Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Password"</span></span> : <span class="hljs-string"><span class="hljs-string">"123"</span></span> }</code> </pre> <br><p>  En la respuesta del servidor, puede encontrar nuevos mensajes de error de validación: </p><br><pre> <code class="json hljs"> <span class="hljs-string"><span class="hljs-string">"Name"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"     2  50 "</span></span> ], <span class="hljs-string"><span class="hljs-string">"Password"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"    6 "</span></span> ]</code> </pre> <br><p>  El problema, que puede ser, por el momento, no obvio, es que los valores límite para la longitud del nombre y la contraseña también deben estar presentes en la aplicación del cliente.  Una situación en la que los mismos datos se configuran manualmente en dos o lugares de bodey es un posible caldo de cultivo para los insectos, uno de los signos de un mal diseño.  Vamos a arreglarlo </p><br><p>  Almacenaremos todo lo que el cliente necesitará en los archivos de recursos.  Mensajes en Controllers.AccountController.ru.resx, y datos culturalmente independientes en un recurso compartido: Controllers.AccountController.resx.  Me adhiero a este formato: </p><br><pre> <code class="json hljs">{PropertyName}DisplayName {PropertyName}{RuleName} {PropertyName}{RuleName}Message</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Por lo tanto, obtenemos la siguiente imagen</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/al/cr/zg/alcrzgje8f1btwzkgwzfrz6mgyq.png"></p></div></div><br><p>  Tenga en cuenta que para validar la dirección de correo electrónico  Se utiliza el correo de expresión regular.  Y para la validación cultural, se utiliza una regla personalizada: "Valores" (lista de valores).  También deberá verificar el campo de confirmación de contraseña, que veremos más adelante, en la interfaz de usuario. </p><br><p>  Para acceder a los archivos de recursos para una cultura específica, agregamos soporte de localización en el método Startup.ConfigureServices, indicando la ruta a los archivos de recursos: </p><br><pre> <code class="cs hljs">services.AddLocalization(options =&gt; options.ResourcesPath = <span class="hljs-string"><span class="hljs-string">"Resources"</span></span>);</code> </pre> <br><p>  Y también en el método Startup.Configure, determinando la cultura por el encabezado de la solicitud del usuario: </p><br><pre> <code class="cs hljs"> app.UseRequestLocalization(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RequestLocalizationOptions { DefaultRequestCulture = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RequestCulture(<span class="hljs-string"><span class="hljs-string">"ru-RU"</span></span>), SupportedCultures = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CultureInfo(<span class="hljs-string"><span class="hljs-string">"en-US"</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CultureInfo(<span class="hljs-string"><span class="hljs-string">"ru-RU"</span></span>) }, RequestCultureProviders = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;IRequestCultureProvider&gt; { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AcceptLanguageHeaderRequestCultureProvider() } });</code> </pre> <br><p>  Ahora, para que dentro del controlador, tengamos acceso a la localización, implementaremos una dependencia del tipo IStringLocalizer en el constructor y modificaremos la expresión de retorno de la acción de Registro: <br></p><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Ok(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(_localizer[<span class="hljs-string"><span class="hljs-string">"RegisteredMessage"</span></span>], request.Name));</code> </pre> <br><p>  La clase ResxValidatior será responsable de verificar las reglas, que utilizarán los recursos creados.  Contiene una lista reservada de palabras clave, rollos preestablecidos y un método para verificarlos. </p><br><div class="spoiler">  <b class="spoiler_title">ResxValidatior</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ResxValidator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> ValuesSeparator = <span class="hljs-string"><span class="hljs-string">','</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> RangeSeparator = <span class="hljs-string"><span class="hljs-string">'-'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Keywords { DisplayName, Message, Required, Pattern, Length, MinLength, MaxLength, Range, MinValue, MaxValue, Values, Compare } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Dictionary&lt;Keywords, Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;&gt; _rules = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;Keywords, Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;&gt;() { [Keywords.Required] = (v, arg) =&gt; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(v), [Keywords.Pattern] = (v, arg) =&gt; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(v) &amp;&amp; Regex.IsMatch(v, arg), [Keywords.Range] = (v, arg) =&gt; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(v) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>.TryParse(v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vLong) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>.TryParse(arg.Split(RangeSeparator)[<span class="hljs-number"><span class="hljs-number">0</span></span>].Trim(), <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vMin) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>.TryParse(arg.Split(RangeSeparator)[<span class="hljs-number"><span class="hljs-number">1</span></span>].Trim(), <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vMax) &amp;&amp; vLong &gt;= vMin &amp;&amp; vLong &lt;= vMax, [Keywords.Length] = (v, arg) =&gt; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(v) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>.TryParse(arg.Split(RangeSeparator)[<span class="hljs-number"><span class="hljs-number">0</span></span>].Trim(), <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vMin) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>.TryParse(arg.Split(RangeSeparator)[<span class="hljs-number"><span class="hljs-number">1</span></span>].Trim(), <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vMax) &amp;&amp; v.Length &gt;= vMin &amp;&amp; v.Length &lt;= vMax, [Keywords.MinLength] = (v, arg) =&gt; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(v) &amp;&amp; v.Length &gt;= <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.Parse(arg), [Keywords.MaxLength] = (v, arg) =&gt; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(v) &amp;&amp; v.Length &lt;= <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.Parse(arg), [Keywords.Values] = (v, arg) =&gt; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(v) &amp;&amp; arg.Split(ValuesSeparator).Select(x =&gt; x.Trim()).Contains(v), [Keywords.MinValue] = (v, arg) =&gt; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(v) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>.TryParse(v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vLong) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>.TryParse(arg, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> argLong) &amp;&amp; vLong &gt;= argLong, [Keywords.MaxValue] = (v, arg) =&gt; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(v) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>.TryParse(v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vLong) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>.TryParse(arg, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> argLong) &amp;&amp; vLong &lt;= argLong }; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IStringLocalizer _localizer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResxValidator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IStringLocalizer localizer</span></span></span><span class="hljs-function">)</span></span> { _localizer = localizer; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsValid</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> memberName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">out</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> message</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rules = _rules.Select(x =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { Name = x.Key, Check = x.Value, String = _localizer.GetString(memberName + x.Key) }).Where(x =&gt; x.String != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; !x.String.ResourceNotFound); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rule <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> rules) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!rule.Check(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, rule.String?.Value)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> messageResourceKey = <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{memberName}</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{rule.Name}</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Keywords.Message}</span></span></span><span class="hljs-string">"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> messageResource = _localizer[messageResourceKey]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> displayNameResourceKey = <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{memberName}</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Keywords.DisplayName}</span></span></span><span class="hljs-string">"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> displayNameResource = _localizer[displayNameResourceKey] ?? displayNameResourceKey; message = messageResource != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; !messageResource.ResourceNotFound ? <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(messageResource.Value, displayNameResource, rule.String?.Value) : messageResourceKey; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } message = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } }</code> </pre> </div></div><br><p>  Cree un atributo de validación personalizado que llamará nuestro validador.  Aquí, la lógica estándar es obtener el valor de la propiedad verificada del modelo, su nombre y llamar al validador. </p><br><div class="spoiler">  <b class="spoiler_title">ResxAttribute</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">public sealed class ResxAttribute : ValidationAttribute { private readonly string _baseName; private string _resourceName; public ResxAttribute(string sectionName, string resourceName = null) { _baseName = sectionName; _resourceName = resourceName; } protected override ValidationResult IsValid(object value, ValidationContext validationContext) { if (_resourceName == null) _resourceName = validationContext.MemberName; var factory = validationContext .GetService(typeof(IStringLocalizerFactory)) as IStringLocalizerFactory; var localizer = factory?.Create(_baseName, System.Reflection.Assembly.GetExecutingAssembly().GetName().Name); ErrorMessage = ErrorMessageString; var currentValue = value as string; var validator = new ResxValidator(localizer); return validator.IsValid(_resourceName, currentValue, out var message) ? ValidationResult.Success : new ValidationResult(message); } }</code> </pre> </div></div><br><p>  Finalmente, puede reemplazar todos los atributos en la solicitud con nuestro universal, indicando el nombre del recurso: </p><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Resx(sectionName: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Controllers.AccountController"</span></span></span><span class="hljs-meta">)</span></span>]</code> </pre> <br><p>  Probamos la funcionalidad enviando la misma solicitud: </p><br><pre> <code class="json hljs"> { <span class="hljs-attr"><span class="hljs-attr">"Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Password"</span></span> : <span class="hljs-string"><span class="hljs-string">"123"</span></span> }</code> </pre> <br><p>  Para la localización, agregue Controllers.AccountController.en.resx con mensajes en inglés, así como el encabezado, con información sobre la cultura: Accept-Language: en-US. </p><br><p>  Tenga en cuenta que ahora podemos anular la configuración de una cultura específica.  En el archivo * .en.resx, especifiqué la longitud mínima de contraseña de 8 y recibí un mensaje apropiado: </p><br><pre> <code class="json hljs"> <span class="hljs-string"><span class="hljs-string">"Password"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"Password must be at least 8 characters"</span></span> ]</code> </pre> <br><p>  Para mostrar mensajes idénticos durante la validación del cliente, de alguna manera debe exportar la lista completa de mensajes para la parte del cliente.  Por simplicidad, crearemos un controlador separado que le dará todo lo que necesita para una aplicación cliente en formato i18n. </p><br><div class="spoiler">  <b class="spoiler_title">Controlador local</b> <div class="spoiler_text"><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Route(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"[controller]"</span></span></span><span class="hljs-meta">)</span></span>] [ApiController] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LocaleController</span></span> : <span class="hljs-title"><span class="hljs-title">ControllerBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IStringLocalizerFactory _factory; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _assumbly; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _location; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LocaleController</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IStringLocalizerFactory factory</span></span></span><span class="hljs-function">)</span></span> { _factory = factory; _assumbly = System.Reflection.Assembly.GetExecutingAssembly().GetName().Name; _location = Path.Combine(Directory.GetCurrentDirectory(), <span class="hljs-string"><span class="hljs-string">"Resources"</span></span>); } [HttpGet(<span class="hljs-string"><span class="hljs-string">"Config"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetConfig</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> culture</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(culture)) { CultureInfo.CurrentCulture = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CultureInfo(culture); CultureInfo.CurrentUICulture = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CultureInfo(culture); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> resources = Directory.GetFiles(_location, <span class="hljs-string"><span class="hljs-string">"*.resx"</span></span>, SearchOption.AllDirectories) .Select(x =&gt; x.Replace(_location + Path.DirectorySeparatorChar, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty)) .Select(x =&gt; x.Substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, x.IndexOf(<span class="hljs-string"><span class="hljs-string">'.'</span></span>))) .Distinct(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> config = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> resource <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> resources.Select(x =&gt; x.Replace(<span class="hljs-string"><span class="hljs-string">'\\'</span></span>, <span class="hljs-string"><span class="hljs-string">'.'</span></span>))) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> section = _factory.Create(resource, _assumbly) .GetAllStrings() .OrderBy(x =&gt; x.Name) .ToDictionary(x =&gt; x.Name, x =&gt; x.Value); config.Add(resource.Replace(<span class="hljs-string"><span class="hljs-string">'.'</span></span>, <span class="hljs-string"><span class="hljs-string">'-'</span></span>), section); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = JsonConvert.SerializeObject(config, Formatting.Indented); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Ok(result); } }</code> </pre> </div></div><br><p>  Dependiendo del idioma de aceptación, devolverá: </p><br><div class="spoiler">  <b class="spoiler_title">Aceptar-Idioma: en-US</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"Controllers-AccountController"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"AgeDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Age"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AgeRange"</span></span>: <span class="hljs-string"><span class="hljs-string">"18 - 150"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AgeRangeMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"{0} must be {1}"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"EmailDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Email"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"EmailPattern"</span></span>: <span class="hljs-string"><span class="hljs-string">"^[-\\w.]+@([A-z0-9][-A-z0-9]+\\.)+[Az]{2,4}$"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"EmailPatternMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"Incorrect email"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"EmailRequired"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"EmailRequiredMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"Email required"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"LanguageDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Language"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"LanguageValues"</span></span>: <span class="hljs-string"><span class="hljs-string">"ru-RU, en-US"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"LanguageValuesMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"Incorrect language. Possible: {1}"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"NameDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Name"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"NameLength"</span></span>: <span class="hljs-string"><span class="hljs-string">"2 - 50"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"NameLengthMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"Name length must be {1} characters"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordConfirmCompare"</span></span>: <span class="hljs-string"><span class="hljs-string">"Password"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordConfirmCompareMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"Passwords must be the same"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordConfirmDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Password confirmation"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Password"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordMaxLength"</span></span>: <span class="hljs-string"><span class="hljs-string">"100"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordMaxLengthMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"{0} can't be greater than {1} characters"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordMinLength"</span></span>: <span class="hljs-string"><span class="hljs-string">"8"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordMinLengthMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"{0} must be at least {1} characters"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordRequired"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordRequiredMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"Password required"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"RegisteredMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"{0}, you've been registered!"</span></span> } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Idioma de aceptación: en-RU</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"Controllers-AccountController"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"AgeDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AgeRange"</span></span>: <span class="hljs-string"><span class="hljs-string">"18 - 150"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AgeRangeMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"{0}     {1}"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"EmailDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">" . "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"EmailPattern"</span></span>: <span class="hljs-string"><span class="hljs-string">"^[-\\w.]+@([A-z0-9][-A-z0-9]+\\.)+[Az]{2,4}$"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"EmailPatternMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"  . "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"EmailRequired"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"EmailRequiredMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"  . "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"LanguageDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"LanguageValues"</span></span>: <span class="hljs-string"><span class="hljs-string">"ru-RU, en-US"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"LanguageValuesMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">" .  : {1}"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"NameDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"NameLength"</span></span>: <span class="hljs-string"><span class="hljs-string">"2 - 50"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"NameLengthMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"    {1} "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordConfirmCompare"</span></span>: <span class="hljs-string"><span class="hljs-string">"Password"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordConfirmCompareMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"  "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordConfirmDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordMaxLength"</span></span>: <span class="hljs-string"><span class="hljs-string">"100"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordMaxLengthMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"{0}    {1} "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordMinLength"</span></span>: <span class="hljs-string"><span class="hljs-string">"6"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordMinLengthMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"{0}    {1} "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordRequired"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordRequiredMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"RegisteredMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"{0},  !"</span></span> } }</code> </pre> </div></div><br><p>  Lo último que queda por hacer es permitir solicitudes de origen cruzado para el cliente.  Para hacer esto, en Startup.ConfigureServices agregue: </p><br><pre> <code class="cs hljs"> services.AddCors();</code> </pre> <br><p>  y en Startup.Configure add: </p><br><pre> <code class="cs hljs"> app.UseCors(x =&gt; x .AllowAnyOrigin() .AllowAnyMethod() .AllowAnyHeader());</code> </pre> <br><h1 id="klientskaya-chast">  Parte del cliente </h1><br><p>  Prefiero ver todas las partes de la aplicación en un IDE, por lo que crearé un proyecto de aplicación cliente utilizando la plantilla de Visual Studio: Aplicación web Basic Vue.js.  Si no lo tiene / no desea obstruir VS con tales plantillas, use vue cli, con él instalaré varios paquetes antes: vuetify, axios, vue-i18n. </p><br><p>  Solicitamos los archivos de recursos convertidos de LocaleController, indicando la cultura en el encabezado Accept-Language, y colocamos la respuesta en los archivos en.json y ru.json en el directorio local. </p><br><p>  A continuación, necesitamos un servicio para analizar la respuesta con errores del servidor. </p><br><div class="spoiler">  <b class="spoiler_title">errorHandler.service.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ErrorHandlerService = { parseResponseError (error) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error.toString().includes(<span class="hljs-string"><span class="hljs-string">'Network Error'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'ServerUnavailable'</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error.response) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> statusText = error.response.statusText; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error.response.data &amp;&amp; error.response.data.errors) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> message = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> property <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> error.response.data.errors) { error.response.data.errors[property].forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entry) { message += entry + <span class="hljs-string"><span class="hljs-string">'\n'</span></span> } }) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> message } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error.response.data &amp;&amp; error.response.data.message) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> error.response.data.message } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (statusText) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> statusText } } } }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { ErrorHandlerService }</code> </pre> </div></div><br><p>  El validador vee-validate integrado en Vutify.js requiere que especifique una serie de funciones de validación con el atributo de reglas, las solicitaremos del servicio para trabajar con recursos. </p><br><div class="spoiler">  <b class="spoiler_title">locale.service.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> i18n <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../i18n'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> LocaleService = { getRules(resource, options) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> rules = []; options = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.prepareOptions(options); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addRequireRule(rules, resource, options); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addPatternRule(rules, resource, options); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addRangeRule(rules, resource, options); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addLengthRule(rules, resource, options); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addMaxLengthRule(rules, resource, options); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addMinLengthRule(rules, resource, options); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addValuesRule(rules, resource, options); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addCompareRule(rules, resource, options); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rules; }, prepareOptions(options){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> getter = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> v; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> compared = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!options){ options = { <span class="hljs-attr"><span class="hljs-attr">getter</span></span>: getter, <span class="hljs-attr"><span class="hljs-attr">compared</span></span>: compared }; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!options.getter) options.getter = getter; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!options.compared) options.compared = compared; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> options; }, addRequireRule(rules, resource, options){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> settings = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRuleSettings(resource, <span class="hljs-string"><span class="hljs-string">'Required'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(settings){ rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> !!options.getter(v) || settings.message); } }, addPatternRule(rules, resource, options){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> settings = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRuleSettings(resource, <span class="hljs-string"><span class="hljs-string">'Pattern'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(settings){ rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> !!options.getter(v) || settings.message); rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">RegExp</span></span>(settings.value).test(options.getter(v)) || settings.message); } }, addRangeRule(rules, resource, options){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> settings = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRuleSettings(resource, <span class="hljs-string"><span class="hljs-string">'Range'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(settings){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> values = settings.value.split(<span class="hljs-string"><span class="hljs-string">'-'</span></span>); rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> !!options.getter(v) || settings.message); rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(options.getter(v)) &gt;= values[<span class="hljs-number"><span class="hljs-number">0</span></span>] &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(options.getter(v)) &lt;= values[<span class="hljs-number"><span class="hljs-number">1</span></span>] || settings.message); } }, addLengthRule(rules, resource, options){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> settings = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRuleSettings(resource, <span class="hljs-string"><span class="hljs-string">'Length'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(settings){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> values = settings.value.split(<span class="hljs-string"><span class="hljs-string">'-'</span></span>); rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> !!options.getter(v) || settings.message); rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> options.getter(v).length &gt;= values[<span class="hljs-number"><span class="hljs-number">0</span></span>] &amp;&amp; options.getter(v).length &lt;= values[<span class="hljs-number"><span class="hljs-number">1</span></span>] || settings.message); } }, addMaxLengthRule(rules, resource, options){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> settings = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRuleSettings(resource, <span class="hljs-string"><span class="hljs-string">'MaxLength'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(settings){ rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> !!options.getter(v) || settings.message); rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> options.getter(v).length &lt;= settings.value || settings.message); } }, addMinLengthRule(rules, resource, options){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> settings = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRuleSettings(resource, <span class="hljs-string"><span class="hljs-string">'MinLength'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(settings){ rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> !!options.getter(v) || settings.message); rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> options.getter(v).length &gt;= settings.value || settings.message); } }, addValuesRule(rules, resource, options){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> settings = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRuleSettings(resource, <span class="hljs-string"><span class="hljs-string">'Values'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(settings) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> values = settings.value.split(<span class="hljs-string"><span class="hljs-string">','</span></span>); rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> !!options.getter(v) || settings.message); rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> !!values.find(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x.trim() === options.getter(v)) || settings.message); } }, addCompareRule(rules, resource, options){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> settings = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRuleSettings(resource, <span class="hljs-string"><span class="hljs-string">'Compare'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(settings) { rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> settings.value === <span class="hljs-string"><span class="hljs-string">''</span></span> || !!settings.value || settings.message }); rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> options.getter(v) === options.compared() || settings.message; }); } }, getRuleSettings(resource, rule){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> value = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRuleValue(resource, rule); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> message = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRuleMessage(resource, rule, value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value === <span class="hljs-string"><span class="hljs-string">''</span></span> || value ? { <span class="hljs-attr"><span class="hljs-attr">value</span></span>: value, <span class="hljs-attr"><span class="hljs-attr">message</span></span>: message } : <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }, getRuleValue(resource, rule){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> key =<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${resource}</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${rule}</span></span></span><span class="hljs-string">`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getI18nValue(key); }, getDisplayName(resource){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> key =<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${resource}</span></span></span><span class="hljs-string">DisplayName`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getI18nValue(key); }, getRuleMessage(resource, rule, value){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> key =<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${resource}</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${rule}</span></span></span><span class="hljs-string">Message`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i18n.t(key, [<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getDisplayName(resource), value]); }, getI18nValue(key){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> value = i18n.t(key); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value !== key ? value : <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { LocaleService }</code> </pre> </div></div><br><p>  No tiene sentido describir completamente este servicio, ya que  duplica parcialmente la clase ResxValidator.  Observo que para verificar la regla Comparar, donde es necesario comparar el valor de la propiedad actual con otra, se pasa el objeto de opciones, en el que se compara el delegado, que devuelve el valor para la comparación. </p><br><p>  Por lo tanto, un campo de formulario típico se verá así: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-text-field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"displayFor('Name')"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:rules</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rulesFor('Name')"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v-model</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"model.Name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">prepend-icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"mdi-account"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-text-field</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Para la etiqueta, la función de contenedor se llama en locale.service, que pasa el nombre completo del recurso, así como el nombre de la propiedad para la que desea obtener el nombre para mostrar.  Del mismo modo para las reglas.  El modelo v especifica un modelo para almacenar los datos ingresados. <br>  Para la propiedad de confirmación de contraseña, pase los valores de la contraseña en el objeto de opciones: </p><br><pre> <code class="xml hljs">:rules="rulesFor('PasswordConfirm', { compared:() =&gt; model.Password })"</code> </pre> <br><p>  v-select para la selección de idioma tiene una lista predefinida de elementos (esto se hace por simplicidad de ejemplo) y onChange es un controlador.  Porque  hacemos SPA, queremos cambiar la localización cuando el usuario selecciona un idioma, por lo tanto, en la selección onChange, se verifica el idioma seleccionado y, si ha cambiado, la configuración regional de la interfaz cambia: </p><br><pre> <code class="javascript hljs"> onCultureChange (value) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> culture = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cultures.find(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x.value === value); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.model.Culture = culture.value; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (culture.locale !== <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$i18n.locale) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$i18n.locale = culture.locale; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$refs.form.resetValidation(); } }</code> </pre> <br><p>  Eso es todo, el repositorio con una aplicación que funciona <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">está aquí</a> . </p><br><p>  <strong>Resumiendo, me gustaría señalar</strong> que sería genial almacenar los recursos en un solo formato JSON, que solicitamos de LocaleController, para desatarlo de los detalles del marco ASP.  En ResxValidatior, uno podría agregar soporte para extensibilidad y reglas personalizadas en particular, así como resaltar código idéntico a locale.service y reescribirlo en estilo JS para simplificar el soporte.  Sin embargo, en este ejemplo, me centro en la simplicidad. </p><p></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/473776/">https://habr.com/ru/post/473776/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../473764/index.html">Parcel es mi creador de proyectos favorito</a></li>
<li><a href="../473766/index.html">Análisis estático de grandes volúmenes de código Python: experiencia de Instagram. Parte 1</a></li>
<li><a href="../473768/index.html">Los 5 mejores libros para aquellos que desean mejorar sus habilidades</a></li>
<li><a href="../473770/index.html">Análisis estático de grandes volúmenes de código Python: experiencia de Instagram. Parte 2</a></li>
<li><a href="../473774/index.html">Secure Cloud en DF Cloud</a></li>
<li><a href="../473778/index.html">Optimización de imagen: cómo usar la IA de visión de Google para comprender los principios de clasificación de imágenes</a></li>
<li><a href="../473780/index.html">Detección rápida de contornos en video 4K: color y formas complejas</a></li>
<li><a href="../473784/index.html">¿Cómo escribir un contrato inteligente para WebAssembly en una red Ontology? Parte 2: C ++</a></li>
<li><a href="../473786/index.html">La inscripción para el hackathon en Riga está terminando. Premio - entrenamiento a corto plazo en el PhysTech</a></li>
<li><a href="../473788/index.html">Las microproteínas descubren aspectos desconocidos de la biología moderna.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>