<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎲 🥧 👩🏽‍🔧 الويب الأمن اختبار كاتب كيت 🤠 🧜🏽 🖐🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="مرحبا بالجميع! 

 اسمي اندريه. منذ 10 سنوات ، كنت أبحث عن نقاط الضعف في مختلف خدمات الويب. وعلى استعداد لتبادل معرفتي معك. في شهر مايو الماضي ، قدمت ت...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>الويب الأمن اختبار كاتب كيت</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/semrush/blog/441966/" style=";text-align:right;direction:rtl"> مرحبا بالجميع! <br><br>  اسمي اندريه.  منذ 10 سنوات ، كنت أبحث عن نقاط الضعف في مختلف خدمات الويب.  وعلى استعداد لتبادل معرفتي معك.  في شهر مايو الماضي ، قدمت تقريراً حول هذا الموضوع في مؤتمر <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Heisenbug</a> ، وأنا الآن على استعداد لمشاركة معرفتي هنا ، أيضًا ، في الأماكن المفتوحة لـ Habr.  لذلك دعونا نبدأ. <br><br>  بمجرد <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">العثور على ثغرة أمنية</a> على خوادم الشركة سيئة السمعة Facebook.  لقد نسي الرجال تحديث ImageMagick (مكتبة معالجة الصور) ودفع ثمنها :) مع هذا المثال ، أردت أن أوضح أننا جميعًا أشخاص ، ويمكننا جميعًا أن نخطئ ، بغض النظر عن الشركات وفي المواقف التي نعمل فيها.  المشكلة الوحيدة هي أن هذه الأخطاء يمكن أن تؤدي إلى جميع أنواع المخاطر. <br>  كلما زاد تعقيد التطبيق / موقع الويب / الأداة ، زاد احتمال حدوث خطأ ما. <br>  تحتاج إلى التحقق من نقاط الضعف.  من الغباء عدم القيام بذلك على الإطلاق. <br><a name="habracut"></a><br>  قد تكون العناصر التالية مراحل فحص تطبيقات الويب: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  التحضير: <ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  تحديد نقاط الدخول - في الواقع ، حيث يمكن أن تأتي البيانات من التطبيق ؛ </li><li style=";text-align:right;direction:rtl">  تحديد مخزون التكنولوجيا ؛ </li><li style=";text-align:right;direction:rtl">  تحديد نقاط الضعف التي من المنطقي التحقق منها ؛ </li></ul></li><li style=";text-align:right;direction:rtl">  التحقق  تحتاج إلى التحقق من جميع نقاط الضعف التي تنطبق على نطاق التكنولوجيا لتطبيق الويب الخاص بك ؛ </li><li style=";text-align:right;direction:rtl">  تحليل الكود.  لا تكون كسول ، لا تخطي هذا العنصر.  في بعض الحالات ، يصعب العثور على أي ثغرات أمنية دون الوصول إلى الشفرة ، وهذا يسمح لك أيضًا بتجاوز التصفية التي قد تكون مضمنة في التطبيق الخاص بك. </li></ul><br>  سأتحدث عن كل هذا بالتفصيل. <br><br>  لذلك ، التحضير.  لن أركز على جميع أنواع الثغرات الأمنية ، وإلا فستتجاوز كمية النص في المقالة جميع الأحجام المعقولة وغير المتصورة.  أنصحك بالبدء في التعلم من قائمة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">OWASP Top Ten Project</a> .  كل بضع سنوات ، يُشكل <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">اتحاد OWASP</a> قائمة بأكثر الثغرات ذات الصلة في الوقت الحالي.  سننظر في عدد قليل منها بالتفصيل. <br><br><h2 style=";text-align:right;direction:rtl">  Xss </h2><br>  <i>XSS (البرمجة النصية عبر المواقع)</i> هي هجوم على مستخدم يسمح للمهاجم بتنفيذ نص تعسفي في سياق متصفح ضحيته.  في معظم الأحيان ، فإنه ينطوي على تنفيذ علامات <i>HTML</i> والنصوص <i>JS</i> . <br>  مثال: في وقت واحد كان هناك مثل هذه الخدمة <i>Yahoo!</i>  <i>Ad Exchange</i>  يحتوي نموذج استعادة كلمة المرور على معلمة " <i>إرجاع عنوان URL</i> ".  يمكن أن تشير إلى الصفحة التي يجب الرجوع إليها بعد عملية إعادة تعيين كلمة المرور.  إذا قمت بإدخال متجه واحد أو آخر يؤدي إلى تنفيذ كود <i>JS</i> ، فيمكنك الحصول على جميع <i>ملفات تعريف الارتباط</i> الخاصة بالمستخدم.  سنحلل كيف يحدث هذا ولماذا. <br><img src="https://habrastorage.org/webt/0m/uz/t0/0muzt08lkueaenx2gle8ydaidce.png"><br><br>  هنا هو ناقل نفسه.  في كل مرة: <br><img src="https://habrastorage.org/webt/ua/ko/8l/uako8l_hpqr4bov7qmzhm97xwj4.png"><br>  لجعل الحقن ، تحتاج إلى الخروج من سياق المتغير الذي كنا فيه افتراضيًا (افتراضيًا - هذا ما افترضه المبرمج عندما كتب الرمز). <br>  أدناه هي القيمة الأصلية.  هذا هو السلوك الصحيح. <br><img src="https://habrastorage.org/webt/v4/rm/l7/v4rml7dzf1rqpkyvgq8yxdnl3oi.png"><br>  نرى أن returnURL = / login.jsp <br>  هذا يقع في قيمة <i>العلامة &lt;input&gt;</i> . <br>  إذا أضفنا علامة اقتباس بعد <i>jsp</i> ، <i>فسنرى</i> أن بناء جملة <i>HTML</i> قد سكب.  لحسن الحظ ، لغة <i>HTML</i> ليست صارمة ، سيتخطى المحلل ولن تكون هناك مشاكل: <br><img src="https://habrastorage.org/webt/3o/s6/z1/3os6z130clrrtkshbktmqgkguto.png"><br>  أضف شخصية أخرى.  نحن هنا خارج سياق <i>العلامة &lt;input&gt; تمامًا</i> : <br><img src="https://habrastorage.org/webt/lg/x9/av/lgx9avfst6nskdlowyzx0uasgyy.png"><br>  نضيف الآن فتح علامة <i>&lt;svg&gt;</i> ، ونحصل على علامتين صالحتين من حيث بناء الجملة: <br><img src="https://habrastorage.org/webt/u8/pe/tg/u8petg6ghf1gajt49dvsvtfnzn0.png"><br>  بعد ذلك ، أضف متجه الهجوم بالكامل: <br><img src="https://habrastorage.org/webt/o2/t5/n8/o2t5n8-li9jpdao1cbzghum-mhe.png"><br>  في هذه الحالة ، يتم رسم صورة <i>svg</i> .  باستخدام معالج <i>جافا سكريبت</i> " <i>onload</i> " ، نقوم بتنفيذ تنبيه مع <i>ملفات تعريف الارتباط</i> للوثيقة.  هذا كل شئ!  تلقى المهاجم <i>ملفات تعريف الارتباط</i> الخاصة بك. <br>  إذا أظهرنا في التنبيه فقط التنبيه نفسه ، فلن يكون من الصعب على المهاجم إرسال ملفات تعريف الارتباط إلى خادم يسيطر عليه ، وفي أسوأ الأحوال ، يستولي على حسابك.  دعونا نرى كيف يبدو مرة أخرى: <br><img src="https://habrastorage.org/webt/0m/uz/t0/0muzt08lkueaenx2gle8ydaidce.png"><br><br>  هناك أيضًا المزيد من متجهات الهجوم على العميل.  سأقدم بعض الأمثلة مع وصف موجز.  لكن عليك أولاً أن تفهم كيفية الخروج من السياق: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  خارج السياق.  ستساعد هذه الأحرف الستة في الخروج ليس فقط من سياق قيمة معلمة HTML ، ولكن أيضًا من العديد من الشخصيات الأخرى: <br>  -&gt; ""&gt; <br></li></ul><br>  حسنًا ، في الحقيقة ، أبسط متجهين للهجوم: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  إدراج الروابط على وجه الخصوص.  ولكن في الحالة العامة - تغيير مظهر الصفحة.  على سبيل المثال ، قد يقومون بتضمين كود html في صفحتك وعرض بعض النوافذ المزيفة التي تطلب بيانات: <br><img src="https://habrastorage.org/webt/dt/-p/yz/dt-pyzv0wcrhgxqihw3iuoccbnc.png"><br>  تشير السلسلة " <i>aaaa</i> " إلى <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">google.com</a> .  يمكنك أن ترى أن الرابط تم تقديمه على الصفحة ، لكنك قد لا ترى ذلك ، لكن هذا لا يلغي وجوده في الكود.  في كلتا الحالتين ، يمكن اعتبار القضية مكتملة ؛ </li><li style=";text-align:right;direction:rtl">  تنفيذ البرنامج النصي ، على سبيل المثال ، اعتراض <i>ملفات تعريف الارتباط الخاصة</i> بالمستخدم: <br><img src="https://habrastorage.org/webt/w8/yd/yb/w8ydybkf9oucxuawq_vumapupda.png"><br></li></ul><br><br><h3 style=";text-align:right;direction:rtl">  أين وكيف تبحث عن XSS؟ </h3><br>  أولاً ، ابحث عن وظائف إخراج المعلومات / البيانات على الصفحة.  تحليل ما هي البيانات التي تحصل هناك؟  هنا يأتي مفهوم <i>مصدر غير موثوق به</i> .  وهذا ، قبل كل شيء ، هو <i>المستخدم الخاص بك</i> .  يمكن تضمين متجهات الهجوم في أي مصادر أخرى: موجز ويب لـ RSS ، وخدمات أخرى ، خارجية وداخلية. <br>  إليك مثال على الحياة الحقيقية: أعمل في SEMrush IT.  نحن نعمل على تطوير منصة على الإنترنت ، وهي أداة عالمية للمسوقين عبر الإنترنت.  لذلك ، قامت إحدى الخدمات بحفظ البيانات ، والأخرى المستخرجة ، واعتمد كل فريق على بعضهم البعض ، واتضح أن الخدمة <i>XSS</i> نشأت في الخدمة الثانية بسبب عدم المعالجة المناسبة لبيانات المخرجات ، والأمر الأول لم يعتبر من الضروري تصفية البيانات الواردة على الإطلاق بأي شكل من الأشكال والاحتفاظ بها " <i>كما هي</i> ".  الخلاصة: إذا كنت لا تعرف كيف يتم تخزين هذه البيانات أو تلك ، فيجب اعتبارها غير موثوق بها.  أو توافق مقدمًا على من يخزن وكيف ، المرشحات ، يعرض البيانات. <br><br>  إذا كان لديك بالفعل بيانات من مصادر غير موثوق بها ، فإنني أوصي بما يلي: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  لدراسة تصفية البيانات الواردة ؛ </li><li style=";text-align:right;direction:rtl">  فحص سياق الإخراج.  لا يمكن تنفيذ <i>XSS</i> في جميع الحالات ، حتى في حالة عدم التصفية.  على سبيل المثال ، إذا كان <i>نوع محتوى</i> الاستجابة هو: <i>نص / عادي ؛</i> </li><li style=";text-align:right;direction:rtl">  لا تعتمد على تصفية أطر عمل أنظمة الأمان المدمجة. </li></ul><br><br><h2 style=";text-align:right;direction:rtl">  حقن SQL </h2><br><img src="https://habrastorage.org/webt/do/b8/ry/dob8ryjj2vifp3w1th18oroewis.png"><br><br>  <i>تطبيق كود SQL (حقن SQL باللغة الإنجليزية)</i> - مقدمة في استعلام قاعدة بيانات التعليمات التي لم تكن ضمنية هناك. <br><br>  مثال (ليس من الحياة ، ولكن جيد أيضًا): <br>  نرى نصًا يعرض جدول مستخدم.  في هذه الحالة ، يمكنه البحث عن طريق اسم المستخدم. <br>  على اليمين يظهر كيف يبدو الاستعلام إلى قاعدة البيانات ، وعلى اليسار هو نتيجة البرنامج النصي في المتصفح. <br><img src="https://habrastorage.org/webt/ng/u2/ou/ngu2ouq8da3jtb18gkjj2amzxss.png"><br>  علاوة على ذلك ، من أجل اختبار والحصول على بعض النتائج الأولية على الأقل ، نقوم بإدراج علامتي اقتباس في قيمة معلمة الاسم.  مفردة ومزدوجة: <br><img src="https://habrastorage.org/webt/0a/fd/ck/0afdckohg1xuacw-7olxyrzifha.png"><br>  نرى أنه من وجهة نظر الإخراج ، تفكك كل شيء ، اختفى الجدول تمامًا.  يحصل الطلب أيضًا على علامتي اقتباس إضافيتين.  بناء جملة استعلام <i>SQL</i> منتهكة. <br>  إذا أخذنا وأضفنا مثل هذا البناء إلى قيمة المعلمة ( <i>ed .: انظر في المربع الأصفر</i> ) ، فسوف نحصل على طلب صالح تمامًا.  إخراج الصفحة مطابق تمامًا للطلب الأول ، والذي لم يتضمن حقنة: <br><img src="https://habrastorage.org/webt/nh/9q/gu/nh9qguk8d0unxfz1bsxlfb0n8vo.png"><br>  من أجل التحقق الكامل من وجود ثغرة أمنية ، نضيف شيطلاً بدلاً من الوحدة: <br><img src="https://habrastorage.org/webt/lx/je/a6/lxjea6hv3hebohiv96gpauuo4o0.png"><br>  اتضح أن الطلب يصبح خاطئًا ، من وجهة نظر المنطق المنطقي ، ونتيجة لذلك ، لا يحتوي على بيانات.  ومع ذلك ، بخلاف اللحظة التي حدث فيها خطأ ، لدينا ناتج الجدول نفسه. <br><br>  لكي لا أذكر كل شيء قد يكون في محركات قاعدة بيانات مختلفة واستعلامات من أنواع مختلفة ، فقد قمت بتقليص كل شيء إلى سطر واحد: <br><img src="https://habrastorage.org/webt/xz/ok/mn/xzokmnhyzqdepnyax-n1bzd8siq.png"><br>  هذا شيء يمكنك محاولة إدخاله في المعلمة ، ثم ، وفقًا للاختلافات في الإجابات ، حاول أن تفهم ما يحدث ، هل هناك ثغرة أمنية أم لا.  حوالي 80 ٪ من الحالات التي يمكن أن تغطي مع هذا التلاعب. <br>  لا يزال هناك 20٪ من المواقف الصعبة التي لن يعطيك فيها أي معلومات ، على سبيل المثال: الاستعلامات / التصفية المتداخلة وما إلى ذلك.  في ممارستي ، قابلت شخصًا مشابهًا مرة واحدة فقط.  ثم اضطررت لتجاوز الترشيح على جانب الخدمة. <br><br>  ما هو الخطر في SQL؟ <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  من الواضح - <i>تسرب المعلومات</i> .  إذا كان المهاجم قادرًا على إنشاء استعلامات لقواعد البيانات الخاصة بك ، فيمكنه بطريقة أو بأخرى الحصول على قيم لم يكن من المفترض أن يتم إخراجها (تجزئة كلمة المرور ، عناوين العملاء ، إلخ) ؛ </li><li style=";text-align:right;direction:rtl">  <i>تغيير البيانات</i> .  الآن العديد من المطورين استخدام قواعد البيانات من خلال أنظمة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ORM</a> .  تتيح لك هذه الأنظمة نفسها ، افتراضيًا ، إجراء استعلامات متعددة في وقت واحد ، كما يسمح لك بناء جملة SQL بالقيام بذلك.  إذا كانت هناك ثغرة أمنية ، فكل شيء يمكن أن ينتقل ليس فقط إلى اختيار البيانات ، ولكن أيضًا إلى تغييرها (حتى حذف الجداول ، وتغيير بنية قاعدة البيانات ، وما إلى ذلك). <br>  في نفس الموقف ، من الممكن زيادة امتيازات المستخدم.  قم بتغيير الحقول في جداول معينة (على سبيل المثال ، ضع <i>is_admins = صواب</i> في قاعدة بيانات <i>المستخدمين</i> ) وبالتالي رفع حقوقك إلى المسؤول ؛ </li><li style=";text-align:right;direction:rtl">  <i>هل</i> .  في بعض الحالات ، يمكن أن يؤدي الحقن إلى رفض الخدمة.  يتم إنشاء العديد من الاستعلامات الثقيلة إلى قاعدة البيانات ، ويتم تشغيلها في عدة مؤشرات ترابط ، وقد تتوقف الخدمة عن العمل لبعض الوقت ؛ </li><li style=";text-align:right;direction:rtl">  <i>قراءة ملفات النظام</i> هي كارثة أخرى يمكن أن يسببها حقن SQL.  يعتمد حدوث هذا الخطر على نظام قاعدة البيانات الذي تستخدمه ، وكذلك على المستخدم الذي يعمل معه (متميز أو لا) ؛ </li><li style=";text-align:right;direction:rtl">  <i>RCE (تنفيذ التعليمات البرمجية عن بُعد)</i> هو تنفيذ التعليمات البرمجية.  يعتمد بشكل مباشر على نوع قاعدة البيانات المستخدمة (في السابق كان هذا ممكنًا بشكل افتراضي ، مع إعدادات قاعدة البيانات الافتراضية ، في MSSQL). </li></ul><br>  يعرض الجدول أدناه الثغرات الأمنية في استعلام <i>SQL</i> .  بالطبع ، لا تحتاج إلى حفظه.  بالإضافة إلى ذلك ، هذه ليست جميع الخيارات الممكنة ، ولكن مجرد أمثلة.  ما عليك سوى الانتباه إلى حقيقة أن الأماكن التي يمكن أن يحدث فيها الحقن في استعلام <i>SQL في</i> حالة ظهور بيانات خام هناك مظللة باللون الأحمر.  قد يجد المهاجم ذو الخبرة طريقة لاستغلال ذلك.  كن حذرا واليقظة. <br><img src="https://habrastorage.org/webt/gz/bt/xh/gzbtxhbbrkng9axlc2av07rax9o.png"><br><br><h2 style=";text-align:right;direction:rtl">  SSRF (تزوير طلب جانب الخادم) </h2><br>  ترجمة حرفية - طلبات وهمية على جانب الخادم.  وهذا هو ، الهجوم الذي يسمح لك بمعالجة البيانات التي ترسلها إلى التطبيق ، مما يفرض عليك تقديم الطلب إلى حيث لم يكن منطق العمل المخطط له في الأصل. <br>  يظهر تشغيل <i>SSRF</i> في الصورة أدناه: <br><img src="https://habrastorage.org/webt/cn/3m/xc/cn3mxclin9jb7tr5fdg6zcowez8.png"><br>  يوجد مهاجم ، يوجد الخادم الخاص بك ، والذي يتم إغلاقه بواسطة <i>جدار الحماية</i> ، ولكن في نفس الوقت هناك وظيفة تسمح لك بتقديم طلبات نيابة عن الخادم. <br>  إذا لم تكن هذه الوظيفة محمية بشكل صحيح و / أو بشكل غير صحيح ، كما يحدث عادةً :) ، بمعالجة البيانات الواردة ، يمكن للمهاجم اللجوء إلى <i>Memcached</i> أو <i>Redis</i> أو الوصول إلى أي موارد داخلية للضحية. <br><br>  للحصول على مثال توضيحي أكثر ، ضع في اعتبارك الموقف الذي تستخدمه SEMrush لتدريب الموظفين الداخليين. <br>  من المهم الانتباه إلى معنى " <i>عنوان URL للصورة الرمزية</i> ": <br><img src="https://habrastorage.org/webt/yi/yp/fr/yiypfrzdsu-pqg0adlbup1ziqgk.png"><br>  هنا نولي الاهتمام لنقطتين: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  الصورة الرمزية URL نفسه </li><li style=";text-align:right;direction:rtl">  والقدرة على تنزيله باستخدام ملف. </li></ul><br>  يرجى ملاحظة أن حقل " <i>عنوان URL للصور الرمزية</i> " هو حقل نصي للإدخال ، مما يعني أنه يمكننا معالجة هذه القيمة.  دعونا نحاول وضع الصورة الرمزية ، ربما ، الصورة الأكثر شهرة على الإنترنت - Googlebot من صفحة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الخطأ 404</a> . <br>  افعلها مرة واحدة: <br><img src="https://habrastorage.org/webt/hg/8d/oa/hg8doavbzbji9apfewlydlpxhyq.png"><br>  هل اثنين - انقر فوق " <i>حفظ</i> ".  نحصل على روبوت بدلاً من صورتي: <br><img src="https://habrastorage.org/webt/kf/4x/lr/kf4xlr2atwvebex_dmsiqlxvmbi.png"><br>  تجدر الإشارة هنا إلى حقيقة أن قيمة " <i>عنوان الصورة الرمزية</i> " قد تغيرت ، إلى مسار محلي - على ما يبدو ، طلب التطبيق صورة ، وحفظها على الخادم واستبدل قيمة جديدة. <br><br>  نحن نمضي قدما.  في حقل " <i>URL avatar</i> " ، أدخل <i>ملف</i> القيمة <i>: /// etc / passwd</i> .  يسمح لك هذا التصميم بالوصول إلى بنية الملف.  في بعض المكتبات التي تستخدم للعمل مع <i>HTTP</i> ، يتم تشغيل بنية الملفات افتراضيًا وتلقي البيانات من الخوادم التي تم تشغيلها عليها: <br><img src="https://habrastorage.org/webt/_j/2i/jb/_j2ijbofjimkfmd2tjxmoegkh4k.png"><br>  ماذا يحدث بعد النقر على زر " <i>حفظ</i> "؟ <br>  أولاً ، أصبحت الصورة " <i>خفاش</i> " ، وثانياً ، تغير مسار الملف. <br><img src="https://habrastorage.org/webt/bn/ro/d5/bnrod5bxckue0avxxbvvktglimg.png"><br>  إذا حاولنا طلب هذه الصورة في المتصفح ، فلن يعرضوا لنا أي شيء (الملف " <i>معطل</i> ").  لكننا لسنا أول يوم في أمن المعلومات ، فنحن نعرف ما يجب القيام به :) من خلال التلاعب البسيط ، نحصل على محتويات الملف على جهاز الكمبيوتر الخاص بنا: <br><img src="https://habrastorage.org/webt/vd/sw/97/vdsw97u1ce8abtqa2aqcp_zb2ac.png"><br>  وبالتالي ، بمساعدة مشكلة عدم الحصانة هذه ، يمكنني ، كمهاجم ، الحصول على جميع أكواد مصدر خدمتك وغيرها من البيانات المتاحة للقراءة للمستخدم الذي يقوم بتشغيل خدمة الويب. <br>  دعونا نلقي نظرة على مخاطر SSRF: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ميناء المسح الضوئي.  بالنسبة لشبكة خارجية ، تكون خدمتك نقطة دخول واحدة ومنفذين (http و https).  من خلال مسح المنافذ من داخل البنية الأساسية الخاصة بك ، يمكن للمهاجم اكتشاف المنافذ المفتوحة ؛ </li><li style=";text-align:right;direction:rtl">  تجاوز المصادقة المستندة إلى المضيف.  ما هي النقطة؟  من الممكن أن تتوفر في هيكلك خدمات متاحة فقط لموارد معينة (اقرأ: قائمة بيضاء IP).  لذلك ، إذا كان خادمك الضعيف في القائمة البيضاء ، فيمكنك الوصول إلى تلك الخدمات المتاحة له ، ونتيجة لذلك ، يمكنك معالجتها ؛ </li><li style=";text-align:right;direction:rtl">  مواصلة تطوير الهجوم المذكور أعلاه ، يمكنك الاستمرار في استغلال البرامج الضعيفة التي تعمل على الإنترانت أو على الخادم المحلي.  غالبًا ما تكون هناك مواقف عندما تكون البنية التحتية الداخلية ، التي يتعذر الوصول إليها من الخارج ، تخضع للمراقبة السيئة (لا يتم دائمًا تحديث الإصدارات / تصحيحات الأمان ، وما إلى ذلك)  هذا يمكن أن يؤدي أيضا إلى هجمات وسرقة البيانات. </li><li style=";text-align:right;direction:rtl">  قراءة البيانات المحلية.  لقد عرضت أعلاه مع مثال.  يمكن قراءة التكوينات الخاصة بك والوصول إليها ، الرموز وكلمات المرور. </li></ul><br><br><h3 style=";text-align:right;direction:rtl">  أن ننظر فيها ل SSRF؟ </h3><br>  هذه ليست ثغرة قياسية.  يمكن العثور عليه في أماكن مختلفة ، وغالبًا في الأماكن غير المتوقعة.  في هذه الحالة ، لا تعمل التقنية "انظر هنا ، ولكن قد لا تبدو هنا". <br>  علامات على <i>SSRF</i> ممكن: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <i>Webhook</i> .  إذا تم تكوينها بشكل سيئ ، إذا تم تكوين جدار الحماية بشكل غير صحيح على تلك الخوادم التي يقدم Webhooks منها طلبات ، فيمكن الحصول على ثغرة أمنية ؛ </li><li style=";text-align:right;direction:rtl">  <i>تحويل HTML</i> .  حاول تضمين <i>&lt;</i> <i>url</i> <i>&gt;</i> ، أو <i>&lt;img&gt;</i> ، أو <i>&lt;base&gt;</i> ، أو <i>&lt;script&gt; ،</i> أو <i>CSS</i> <i>url ،</i> الذي يشير إلى خدمة داخلية ؛ </li><li style=";text-align:right;direction:rtl">  <i>تحميل الملفات المحذوفة</i> .  تذكر المثال الرمزية؟  عندما يكون لدى المستخدم فرصة تحميل البيانات عن طريق URL إلى الخادم ، فإن ذلك يستلزم مشاكل كبيرة.  حاول إرسال عنوان URL مع المنفذ ومعرفة المحتوى الذي تم تحميله. </li></ul><br><br><h3 style=";text-align:right;direction:rtl">  كيفية البحث عن SSRF؟ </h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  رفع الخادم وتشغيل <i>المستمع</i> : <br><pre style=";text-align:right;direction:rtl"><code class="bash hljs">user$ nc -1 -n -vv -p 8080 -k</code> </pre> <br>  بهذه الطريقة سترى جميع الطلبات التي تأتي إلى الخادم الخاص بك على المنفذ <i>8080</i> .  من ناحية ، هو منفذ غير مأهول بواسطة خوادم الويب الخاصة بك ، ومن ناحية أخرى ، فهو ميناء لا يتم تصفيته في كثير من الأحيان بواسطة <i>جدار الحماية</i> .  ويعتقد أنه يستخدم لبروتوكول <i>http</i> وحظره يبدو اختياريًا ؛ </li><li style=";text-align:right;direction:rtl">  في التطبيق قيد الدراسة ، ابحث عن المعلمة التي يمكنك من خلالها تمرير مسار طلب البيانات من مضيفنا (إلى <i>مستمعنا</i> ) ؛ </li><li style=";text-align:right;direction:rtl">  فحص إخراج <i>المستمع</i> أو الاستجابة التي تم إرجاعها. </li></ul><br><br><h2 style=";text-align:right;direction:rtl">  XXE (كيان XML خارجي) </h2><br>  سأبدأ القصة ، كما هو الحال دائمًا مع مثال ، بحيث يكون أكثر وضوحًا: <br>  في خدمة SEMrush المذكورة أعلاه ، هناك هذه الأداة التي تتعامل مع تحليل المحتوى.  يقوم المستخدم بالقيادة في عنوان URL لموقعه أو موقع منافس وقبل تحليله ، تقوم الخدمة بتنزيل هذا المحتوى بالذات.  شاهد كيف يحدث هذا على الفيديو: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/WS3pJoyWwto" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  للتنزيل ، تصل الخدمة إلى الموقع المحدد ويقوم الزاحف بتنزيل ملف <i>sitemap.xml</i> .  وهذه هي <i>لغة XML</i> التي نتحدث عنها في هذه المجموعة. <br>  في الفيديو ، يمكننا ملاحظة كيف أضاف الموقع المهاجم تعريفًا للكيان الخارجي <i>XXE</i> إلى <i>sitemap.xml</i> ، والذي يشير إلى " <i>file: /// etc / hosts</i> ".  على أنظمة Linux ، هذا هو الملف الذي يصف IP الذي يتوافق مع المضيفين إذا لم يكن هناك سجلات <i>DNS</i> لهم. <br>  بعد ذلك ، يشير المهاجم في <i>العلامة &lt;loc&gt; إلى</i> توسيع هذا المتغير.  بعد تحليل <i>XML ،</i> وبعد معالجة كل <i>XML</i> في المقصورة ، ستقوم بإدراج القيمة التي كانت في " <i>file: /// etc / hosts</i> " في متغير <i>الموقع</i> (مظللة باللون الأحمر في الفيديو). <br>  يبدأ المهاجم في إطلاق المحلل اللغوي الخاص بنا ، ويذهب إلى السجلات ، وهنا يظهر سطر مظلل باللون الأبيض على الفيديو.  هذه هي محتويات ملف " <i>file: /// etc / hosts</i> " الذي تم الحصول عليه في طلب <i>GET</i> في سجلات خادم يتحكم فيه. <br>  ما التالي؟  المهاجم سوف يتحقق من أنه كان على حق.  سيغير اسم الملف إلى " <i>file: /// etc / fstab</i> " ، قم بتشغيل المحلل اللغوي مرة أخرى والحصول على إحصائيات حول العمليات الجارية. <br><br>  وأخيرًا: " <i>file: /// etc / hostname</i> " ، ابدأ المحلل اللغوي ، انتقل إلى السجلات واحصل على <i>اسم مضيف</i> الجهاز الذي نستخدمه. <br>  هذا خطأ حقيقي اكتشفه شخص حقيقي لا علاقة له بشركتنا.  اضطررت إلى رش الرماد على رأسي ودفع المال :) <br><br>  مثال آخر على <i>XXE</i> : <br><img src="https://habrastorage.org/webt/3t/va/i9/3tvai98kmgwwmpjwh0wjjuzodk0.png"><br>  لنفترض أن لدينا <i>نقطة نهاية</i> معينة ، يطلق عليها - <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">example.com/xxe</a></i> . <br>  نرسل بنية <i>XML</i> إليها → في <i>XML</i> نعلن أن الكيان <i></i> → الكيان <i></i> يشير إلى ملف النظام <i>/ etc / passwd</i> ويفتح مرة أخرى في نص الاستجابة → نحصل على محتويات هذا الملف استجابة. <br>  تجدر الإشارة إلى أن هذا لا يحدث في كثير من الأحيان كما نود. <br><br><h3 style=";text-align:right;direction:rtl">  لماذا تعمل؟ </h3><br>  مستندات <i>XML</i> هي تنسيق بيانات منظم يسمح لك ، من بين أشياء أخرى ، بوصف أنواع البيانات التي قد تحتوي عليها باستخدام علامة <i>DOCTYPE</i> خاصة. <br>  <i>تعريف نوع البيانات (DTD)</i> - تعريف أنواع البيانات داخل مستند <i>XML</i> هذا.  هناك ثلاثة خيارات لكيفية القيام بذلك: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  إذا كان المستند يدعم <i>DTD</i> .  يوضح المثال التالي بعض <i>XML</i> التي يوجد بها بنية ترتيب ، وهناك عنصر <i>منتج</i> وعنصر <i>حساب</i> (من المفترض: رقم المخزون للمنتج وعدد العناصر في الترتيب).  <i>الترتيب</i> هو الأصل لهذين العنصرين: <br><img src="https://habrastorage.org/webt/ft/to/kb/fttokbp3vkqsknatvo8yql9p5h4.png"></li><li style=";text-align:right;direction:rtl">  DTDs الخارجية على الخادم المحلي. <br>  نفعل نفس الشيء كما في المثال الأول ، لكننا نصنع كل التعريفات في ملف منفصل ، وهو موجود على الخادم المحلي: <br><img src="https://habrastorage.org/webt/qy/re/3m/qyre3m2bfjatzni4bdq6t-3opko.png"><br></li><li style=";text-align:right;direction:rtl">  DTDs الخارجية على خادم جهة خارجية: <br><img src="https://habrastorage.org/webt/wf/dj/tp/wfdjtpme3bh_lnhgiyr56m-p5si.png"></li></ul><br>  إذا كنت قارئًا منتبهًا ، فمن المحتمل أنك ربطت حقيقة أن القدرة على تقديم مثل هذه الطلبات على خدمتك وأنظمة <i>DTD</i> الخارجية هي نقطة ضعف في حد ذاتها ، تحدثنا عنها أعلاه ، وهي <i>ثغرة</i> أمنية <i>SSRF</i> . <br>  هناك أمر شائع: يقوم المطورون بإصلاح ثغرة <i>XXE</i> ، لكن تنسوا حظر معالجة <i>DTDs</i> الخارجية والحصول على <i>SSRF</i> .  العواقب الوخيمة لن تنجم عن ذلك ، لكن يجب ألا تنسى ذلك. <br><br><h3 style=";text-align:right;direction:rtl">  ما هي الكيانات في XML؟ </h3><br>  <i>الكيانات</i> في <i>XML</i> .  ما هذا  هذه فرصة لتعريف قيم معينة ودفعها إلى المتغيرات.  الكيانات لها ثلاثة أنواع مختلفة: <br><img src="https://habrastorage.org/webt/er/lb/h7/erlbh7l8z_adl4nla3ll_tir1rm.png"><br>  محدد <i>مسبقا</i> - محدد مسبقا.  على غرار شفرة <i>HTML</i> ، اجعل من الممكن استخدام تلك الأحرف التي تشكل جزءًا من بناء جملة اللغة ، كهيكل نصي.  هنا يتم تقديمها كمثال ، بحيث تفهم ما هو عليه.  نعم ، في معظم الهجمات لا يتم استخدامها ، ولكن قد تكون هناك حاجة إليها في بعض الحالات الاستثنائية. <br>  <i>العام</i> <i>والمعلمة</i> .  هذا هو واحد ، يتغير بناء جملة الإعلان الخاص بهم فقط وكيف يمكن استدعاؤهم بعد الإعلان <br><br><h3 style=";text-align:right;direction:rtl">  أن ننظر فيها ل <i>XXE</i> ؟ </h3><br>  عدة خيارات: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  معالجة <i>XML</i> في أي مظهر: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <i>SVG</i> </li><li style=";text-align:right;direction:rtl">  <i>خريطة الموقع</i> </li></ul></li><li style=";text-align:right;direction:rtl">  تحويل <i>HTML</i> إلى صيغ أخرى ؛ </li><li style=";text-align:right;direction:rtl">  التعامل مع <i>docx</i> ، <i>xlsx</i> والأشكال المماثلة. </li></ul><br><br><h3 style=";text-align:right;direction:rtl">  كيف تبحث عنهم؟ </h3><br><img src="https://habrastorage.org/webt/eo/ce/tl/eocetlpzyfdgocqc2qwv1hbxnhe.png"><br>  تظهر الصورة مجرد مثال للبدء منه.  إنه ليس مفتاح عالمي.  يجب تحسين التنسيقات التي تستخدمها في الخدمة قيد الدراسة. <br><br>  أول شيء نقوم به: إعلان كيان <i>Z</i> معين ، والذي يصل إلى المضيف الذي يتحكم فيه المضيف المهاجم ، يقوم بتوسيعه داخل نص مستند <i>XML</i> . <br>  هنا الخيار الثاني هو ممكن - مجرد جوهر <i>المعلمة</i> .  يختلف عن الإعلان الأول (علامة <i>٪</i> ).  وللتحول إلى هذا الجوهر ، لم تعد هناك حاجة إلى نص المستند.  يمكننا الوصول إليه مباشرةً في بنية <i>DOCTYPE</i> وفضح هذا الكيان: <br><img src="https://habrastorage.org/webt/3-/hc/xo/3-hcxohtjre3dee0mbed39vlfzq.png"><br>  السيناريو الثالث هو معرفة ما إذا كانت القدرة على طلب <i>DOCTYPE</i> من الخدمات الخارجية قيد التشغيل أم لا: <br><img src="https://habrastorage.org/webt/xn/yo/nj/xnyonjotk9gmb4l1ba-d818g3k4.png"><br>  بعد ذلك ، نحن ننظر إلى إخراج خادم تسيطر علينا.  إذا رأينا دعوة <i>لعنوان URL</i> <i>/ تحقق</i> من عناوين <i>IP</i> المختلفة ، فهذا يعني أنه مع درجة عالية من الاحتمال قد مرت مشكلة عدم الحصانة ، ثم نحتاج فقط إلى معرفة كيفية الحصول على بيانات أكثر إثارة للاهتمام بالنسبة لنا. <br><img src="https://habrastorage.org/webt/xl/7d/oz/xl7dozt94jtm9zf3c_zfr39kacq.png"><br>  ما هو خطر <i>XXE</i> ؟  سأكتب لفترة وجيزة ونقطة: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  قراءة الملفات المحلية ؛ </li><li style=";text-align:right;direction:rtl">  الوصول إلى الموارد المحلية ؛ </li><li style=";text-align:right;direction:rtl">  مسح المنفذ / المضيف </li><li style=";text-align:right;direction:rtl">  <i>مغلفة نص عادي</i> .  هذه فرصة للوصول إلى خدماتك التي تعمل على بروتوكول النص العادي ؛ </li><li style=";text-align:right;direction:rtl">  <i>تنفيذ التعليمات البرمجية عن بُعد</i> (ليس غالبًا).  انها مغلقة افتراضيا. </li><li style=";text-align:right;direction:rtl">  <i>هل</i> .  نظرًا لحقيقة أن الكيانات يمكن أن تكون متسلسلة ، فمن الممكن بسهولة الحصول على زيادة كبيرة في مقدار الذاكرة التي تشغلها هذه المعلمات.  والنتيجة هي <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">هجوم مليار يضحك</a> .  بمعنى آخر ، أنت ببساطة تفرط في ذاكرة الخادم الذي تمت مهاجمته. </li></ul><br>  في الختام ، سأقول إن كل هذا (المقالة وأي معرفة اكتسبتها) لا معنى له دون تطبيق عملي.  لذلك ، سوف أسألك عن تافه حقيقي: فكر في التطبيق الذي كتبته / اختبرته بالأمس وحاول التحقق من وجود ثغرات أمنية فيه.  هل هناك أي أشكال الإدخال أو معالجة <i>XML</i> ؟  هل هذا التطبيق محمي؟  هل تمت إضافة التصفية وتعطيل <i>DTD</i> ؟ <br>  افتح دليل <i>SQLmap واعرف</i> كيفية التحقق من التطبيق الخاص بك.  إذا لم يعثر على أي شيء ، استخدم أداة أخرى وفحصه ، ثم اختبر تطبيقك بحثًا عن نقاط الضعف الأخرى.  كما قلت في البداية ، يفحص المقال بضع نقاط ضعف فقط ، ولكن <i>الآلاف منها</i> . <br>  لا أعتقد أنه يمكنك كتابة رمز آمن تمامًا.  هناك دائمًا نقاط ضعف ، <i><u>لم تعثر</u></i> عليها <i><u>بعد</u></i> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar441966/">https://habr.com/ru/post/ar441966/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar441952/index.html">اختيار نظام تخزين الملفات للعمل الجماعي</a></li>
<li><a href="../ar441954/index.html">مكافأة المستخدم لمؤلفي هبر</a></li>
<li><a href="../ar441956/index.html">معالجة خطأ موحدة (خيار C ++ لأجهزة التحكم الدقيقة)</a></li>
<li><a href="../ar441962/index.html">الفهارس في بوستجرس - 1</a></li>
<li><a href="../ar441964/index.html">نصائح وحيل Kubernetes: نقل موارد المجموعة إلى Helm 2</a></li>
<li><a href="../ar441968/index.html">تطوير فرع منتج جديد: كيفية التخلص من غير عملي والحفاظ على فائدة</a></li>
<li><a href="../ar441970/index.html">FinFisher Butkit تحليل</a></li>
<li><a href="../ar441972/index.html">ضار - بديل يوتيوب الواجهة</a></li>
<li><a href="../ar441974/index.html">مسار المؤرخ من الموارد البشرية إلى المبرمجين جافا: القليل من الحظ والمثابرة</a></li>
<li><a href="../ar441976/index.html">معك FizTech.Science: نحن نبحث عن معلمات خفية ونغرق في عالم الكم الرائع</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>