<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍🏫 🖥️ 🧑🏻 Empire ERP. Comptabilité divertissante: grand livre, comptes, solde 🖖🏻 ➡️ 👩‍🔧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, nous tenterons de pénétrer au cœur même de "l'entreprise sanglante" - la comptabilité. Dans un premier temps, nous effectuerons une ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Empire ERP. Comptabilité divertissante: grand livre, comptes, solde</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471304/"><p> Dans cet article, nous tenterons de pénétrer au cœur même de "l'entreprise sanglante" - la comptabilité.  Dans un premier temps, nous effectuerons une étude du grand livre général, des comptes et du bilan, identifierons leurs propriétés et algorithmes inhérents.  Nous utilisons la technologie de développement Python et Test Driven.  Ici, nous serons engagés dans le prototypage, donc au lieu de la base de données, nous utiliserons les conteneurs de base: listes, dictionnaires et tuples.  Le projet est développé conformément aux exigences du <a href="">projet Empire ERP</a> . </p><a name="habracut"></a><br><h2 id="uslovie-zadachi">  Condition de tâche </h2><br><p>  Espace ... Planète d'Empireia ... Un état sur toute la planète.  La population travaille 2 heures en 2 semaines, après 2 ans de retraite.  Le plan comptable comprend 12 positions.  Les comptes 1-4 sont actifs, 5-8 sont actifs-passifs, 9-12 sont passifs.  Entreprise Horns &amp; Hooves.  Toutes les transactions sont effectuées au cours d'une même période de reporting, au début de la période il n'y a pas de soldes. </p><br><h2 id="nastroyka-proekta">  Configuration du projet </h2><br><p>  Nous clonons le projet depuis le github: </p><br><pre><code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/nomhoi/empire-erp.git</code> </pre> <br><p>  Nous développons en Python 3.7.4.  Configurez l'environnement virtuel, activez-le et installez <strong>pytest</strong> . </p><br><pre> <code class="bash hljs">pip install pytest</code> </pre> <br><h2 id="1-glavnaya-kniga">  1. Grand livre </h2><br><p>  Accédez au <strong>dossier reaserch / day1 / step1</strong> . </p><br><p>  <strong>accounting.py</strong> : </p><br><pre> <code class="python hljs">DEBIT = <span class="hljs-number"><span class="hljs-number">0</span></span> CREDIT = <span class="hljs-number"><span class="hljs-number">1</span></span> AMOUNT = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GeneralLedger</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(list)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__str__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> res = <span class="hljs-string"><span class="hljs-string">'\nGeneral ledger'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> e <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self: res += <span class="hljs-string"><span class="hljs-string">'\n {:2} {:2} {:8.2f}'</span></span>.format(e[DEBIT], e[CREDIT], e[AMOUNT]) res += <span class="hljs-string"><span class="hljs-string">"\n----------------------"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res</code> </pre> <br><p>  <strong>test_accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> accounting <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> decimal <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * @pytest.fixture <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ledger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GeneralLedger() @pytest.mark.parametrize(<span class="hljs-string"><span class="hljs-string">'entries'</span></span>, [ [(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">100.00</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">100.00</span></span>)] ]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_ledger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ledger, entries)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> entry <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> entries: ledger.append((entry[DEBIT], entry[CREDIT], Decimal(entry[AMOUNT]))) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> len(ledger) == <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> ledger[<span class="hljs-number"><span class="hljs-number">0</span></span>][DEBIT] == <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> ledger[<span class="hljs-number"><span class="hljs-number">0</span></span>][CREDIT] == <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> ledger[<span class="hljs-number"><span class="hljs-number">0</span></span>][AMOUNT] == Decimal(<span class="hljs-number"><span class="hljs-number">100.00</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> ledger[<span class="hljs-number"><span class="hljs-number">1</span></span>][DEBIT] == <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> ledger[<span class="hljs-number"><span class="hljs-number">1</span></span>][CREDIT] == <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> ledger[<span class="hljs-number"><span class="hljs-number">1</span></span>][AMOUNT] == Decimal(<span class="hljs-number"><span class="hljs-number">100.00</span></span>) print(ledger)</code> </pre> <br><p>  Le livre principal, comme nous le voyons, se présente sous la forme d'une liste de documents.  Chaque entrée est conçue comme un tuple.  Pour l'enregistrement de la transaction jusqu'à présent, nous utilisons uniquement les numéros de compte pour le débit et le crédit et le montant de la transaction.  Les dates, descriptions et autres informations ne sont pas encore nécessaires, nous les ajouterons plus tard. </p><br><p>  Le verrou du <strong>grand livre</strong> et le test <strong>test_ledger paramétré ont été</strong> créés dans le fichier de test.  Dans le paramètre de test des <strong>entrées</strong> , nous transférons immédiatement la liste complète des transactions.  Pour vérification est effectuée dans <strong>-v</strong> du <strong>pytest</strong> terminal.  Le test devrait passer, et nous verrons dans le terminal la liste complète des transactions stockées dans le grand livre: </p><br><pre> <code class="bash hljs">General ledger 1 12 100.00 1 11 100.00</code> </pre> <br><h2 id="2-scheta">  2. Comptes </h2><br><p>  Ajoutons maintenant la prise en charge des factures au projet.  Accédez au dossier <strong>day1 / step2</strong> . </p><br><p>  <strong>accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GeneralLedger</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(list)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, accounts=None)</span></span></span><span class="hljs-function">:</span></span> self.accounts = accounts <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, entry)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.accounts <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.accounts.append_entry(entry) super().append(entry)</code> </pre> <br><p>  La classe <strong>GeneralLedger a</strong> surchargé la méthode <strong>append</strong> .  Lorsque vous ajoutez une transaction à un livre, nous l'ajoutons immédiatement aux comptes. </p><br><p>  <strong>accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Account</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, id, begin=Decimal</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">0.00</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.id = id self.begin = begin self.end = begin self.entries = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, id, amount)</span></span></span><span class="hljs-function">:</span></span> self.entries.append((id, amount)) self.end += amount <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Accounts</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(dict)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.range = range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.range: self[i] = Account(i) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append_entry</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, entry)</span></span></span><span class="hljs-function">:</span></span> self[entry[DEBIT]].append(entry[CREDIT], Decimal(entry[AMOUNT])) self[entry[CREDIT]].append(entry[DEBIT], Decimal(-entry[AMOUNT]))</code> </pre> <br><p>  La classe <strong>Accounts</strong> est conçue comme un dictionnaire.  Dans les clés, le numéro de compte, dans les valeurs le contenu du compte, c'est-à-dire  une instance de la classe <strong>Account</strong> , qui à son tour contient les champs de solde d'ouverture et de fermeture et une liste des transactions liées à ce compte.  Notez que dans cette liste, les montants des transactions de débit et de crédit sont stockés dans un champ, le montant du débit est positif, le montant du prêt est négatif. </p><br><p>  <strong>test_accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.fixture def accounts(): return Accounts() @pytest.fixture def ledger(accounts): return GeneralLedger(accounts)</span></span></code> </pre> <br><p>  Dans le fichier de test, nous avons ajouté le verrou des <strong>comptes</strong> et ajusté le verrou du <strong>grand livre</strong> . </p><br><p>  <strong>test_accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.mark.parametrize('entries', [ [(1, 12, 100.00), (1, 11, 100.00)] ]) def test_accounts(accounts, ledger, entries): for entry in entries: ledger.append((entry[DEBIT], entry[CREDIT], Decimal(entry[AMOUNT]))) assert len(ledger) == 2 assert ledger[0][DEBIT] == 1 assert ledger[0][CREDIT] == 12 assert ledger[0][AMOUNT] == Decimal(100.00) assert len(accounts) == 12 assert accounts[1].end == Decimal(200.00) assert accounts[11].end == Decimal(-100.00) assert accounts[12].end == Decimal(-100.00) print(ledger) print(accounts)</span></span></code> </pre> <br><p>  Ajout d'un nouveau test <strong>test_accounts</strong> . </p><br><p>  Exécutez le test et observez la sortie: </p><br><pre> <code class="bash hljs">General ledger 1 12 100.00 1 11 100.00 ---------------------- Account 1 beg: 0.00 0.00 12: 100.00 0.00 11: 100.00 0.00 end: 200.00 0.00 ---------------------- Account 11 beg: 0.00 0.00 1: 0.00 100.00 end: 0.00 100.00 ---------------------- Account 12 beg: 0.00 0.00 1: 0.00 100.00 end: 0.00 100.00 ----------------------</code> </pre><br><p>  Dans les classes <strong>Account</strong> et <strong>Acconts</strong> , les <strong>méthodes __str__ sont</strong> également surchargées, vous pouvez le voir dans les sources du projet.  Les montants des écritures et des soldes pour plus de clarté sont présentés dans deux colonnes: débit et crédit. </p><br><h2 id="3-scheta-proverka-provodok">  3. Comptes: validation de validation </h2><br><p>  Nous rappelons la règle suivante: </p><br><pre> <code class="bash hljs">        .         .   -         .</code> </pre> <br><p>  En d'autres termes, dans une instance de la classe <strong>Account</strong> , la valeur finale (solde final) sur les comptes actifs ne peut pas être négative et sur les comptes passifs, elle ne peut pas être positive. </p><br><p>  Accédez au dossier <strong>day1 / step3</strong> . </p><br><p>  <strong>accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BalanceException</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Exception)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br><p>  Ajout d'une <strong>BalanceException</strong> . </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Account</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_active</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.id &lt; <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_passive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.id &gt; <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> ...</code> </pre> <br><p>  La classe <strong>compte</strong> ajoutée compte de chèques appartient à quel type: actif ou passif. </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Accounts</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(dict)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_balance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, entry)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self[entry[CREDIT]].end - Decimal(entry[AMOUNT]) &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> self[entry[CREDIT]].is_active(): <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> BalanceException(<span class="hljs-string"><span class="hljs-string">'BalanceException'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self[entry[DEBIT]].end + Decimal(entry[AMOUNT]) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> self[entry[DEBIT]].is_passive(): <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> BalanceException(<span class="hljs-string"><span class="hljs-string">'BalanceException'</span></span>) ...</code> </pre> <br><p>  Un chèque a été ajouté à la classe <strong>Accounts.py</strong> , si à la suite de l'ajout d'une nouvelle transaction une valeur de débit négative est générée sur le compte actif, une exception sera levée, et la même chose si une valeur de crédit négative est obtenue sur le compte passif. </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GeneralLedger</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(list)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, entry)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.accounts <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.accounts.check_balance(entry) self.accounts.append_entry(entry) super().append(entry) ...</code> </pre> <br><p>  Dans la classe <strong>GeneralLedger,</strong> avant d'ajouter la comptabilisation aux comptes, nous effectuons une vérification.  Si une exception est levée, l'écriture ne tombe ni dans les comptes ni dans le grand livre. </p><br><p>  <strong>test_accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.mark.parametrize('entries, exception', [ ([(12, 1, 100.00)], BalanceException('BalanceException')), ([(12, 6, 100.00)], BalanceException('BalanceException')), ([(12, 11, 100.00)], BalanceException('BalanceException')), ([(6, 2, 100.00)], BalanceException('BalanceException')), #([(6, 7, 100.00)], BalanceException('BalanceException')), #([(6, 12, 100.00)], BalanceException('BalanceException')), ([(1, 2, 100.00)], BalanceException('BalanceException')), #([(1, 6, 100.00)], BalanceException('BalanceException')), #([(1, 12, 100.00)], BalanceException('BalanceException')), ]) def test_accounts_balance(accounts, ledger, entries, exception): for entry in entries: try: ledger.append((entry[DEBIT], entry[CREDIT], Decimal(entry[AMOUNT]))) except BalanceException as inst: assert isinstance(inst, type(exception)) assert inst.args == exception.args else: pytest.fail("Expected error but found none") assert len(ledger) == 0 assert len(accounts) == 12</span></span></code> </pre> <br><p>  Le test <strong>test_accounts_balance</strong> a été ajouté au <strong>module de</strong> test.  La liste des transactions énumère d'abord toutes les combinaisons possibles de transactions et commente toutes les transactions qui ne déclenchent pas d'exception.  Exécutez le test et assurez-vous que les 5 options de publication restantes <strong>déclenchent</strong> une <strong>BalanceException</strong> . </p><br><h2 id="4-balans">  4. Équilibre </h2><br><p>  Accédez au dossier <strong>day1 / step4</strong> . </p><br><p>  <strong>accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Balance</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(list)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, accounts)</span></span></span><span class="hljs-function">:</span></span> self.accounts = accounts self.suma = Decimal(<span class="hljs-number"><span class="hljs-number">0.00</span></span>) self.sump = Decimal(<span class="hljs-number"><span class="hljs-number">0.00</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.suma = Decimal(<span class="hljs-number"><span class="hljs-number">0.00</span></span>) self.sump = Decimal(<span class="hljs-number"><span class="hljs-number">0.00</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.accounts.range: active = self.accounts[i].end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.accounts[i].end &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Decimal(<span class="hljs-number"><span class="hljs-number">0.00</span></span>) passive = -self.accounts[i].end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.accounts[i].end &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Decimal(<span class="hljs-number"><span class="hljs-number">0.00</span></span>) self.append((active, passive)) self.suma += active self.sump += passive</code> </pre> <br><p>  Lors de la création d'un solde, nous collectons simplement les soldes de tous les comptes dans une seule table. </p><br><p>  <strong>test_accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.fixture def balance(accounts): return Balance(accounts)</span></span></code> </pre> <br><p>  Créez un verrou d' <strong>équilibre</strong> . </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.mark.parametrize('entries', [ [ ( 1, 12, 200.00), # increase active and passive ],[ ( 1, 12, 200.00), # increase active and passive (12, 1, 100.00), # decrease passive and decrease active ],[ ( 1, 12, 300.00), # increase active and passive (12, 1, 100.00), # decrease passive and decrease active ( 2, 1, 100.00), # increase active and decrease active ],[ ( 1, 12, 300.00), # increase active and passive (12, 1, 100.00), # decrease passive and decrease active ( 2, 1, 100.00), # increase active and decrease active (12, 11, 100.00), # decrease passive and increase passive ] ]) def test_balance(accounts, ledger, balance, entries): for entry in entries: ledger.append(entry) balance.create() print(accounts) print(balance)</span></span></code> </pre> <br><p>  Nous avons créé le test <strong>test_balance</strong> .  Dans les listes de paramètres, tous les types de transactions possibles ont été répertoriés: augmentation de l'actif et du passif, diminution de l'actif et du passif, augmentation de l'actif et diminution de l'actif, augmentation du passif et diminution du passif.  Émis 4 options pour les publications, afin que vous puissiez voir étape par étape la sortie.  Pour la dernière option, la sortie est la suivante: </p><br><pre> <code class="plaintext hljs">General ledger 1 12 300.00 12 1 100.00 2 1 100.00 12 11 100.00 ---------------------- Account 1 beg: 0.00 0.00 12: 300.00 0.00 12: 0.00 100.00 2: 0.00 100.00 end: 100.00 0.00 ---------------------- Account 2 beg: 0.00 0.00 1: 100.00 0.00 end: 100.00 0.00 ---------------------- Account 11 beg: 0.00 0.00 12: 0.00 100.00 end: 0.00 100.00 ---------------------- Account 12 beg: 0.00 0.00 1: 0.00 300.00 1: 100.00 0.00 11: 100.00 0.00 end: 0.00 100.00 ---------------------- Balance 1 : 100.00 0.00 2 : 100.00 0.00 3 : 0.00 0.00 4 : 0.00 0.00 5 : 0.00 0.00 6 : 0.00 0.00 7 : 0.00 0.00 8 : 0.00 0.00 9 : 0.00 0.00 10 : 0.00 0.00 11 : 0.00 100.00 12 : 0.00 100.00 ---------------------- sum: 200.00 200.00 ======================</code> </pre> <br><h2 id="5-storno">  5. Inverser </h2><br><p>  Vérifions maintenant comment l'inversion est effectuée. </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.mark.parametrize('entries', [ [ ( 1, 12, 100.00), ( 1, 12,-100.00), ] ]) def test_storno(accounts, ledger, balance, entries): for entry in entries: ledger.append(entry) balance.create() print(ledger) print(accounts) print(balance)</span></span></code> </pre> <br><p>  La conclusion était la suivante: </p><br><pre> <code class="bash hljs">General ledger 1 12 100.00 1 12 -100.00 ---------------------- Account 1 beg: 0.00 0.00 12: 100.00 0.00 12: 0.00 100.00 end: 0.00 0.00 ---------------------- Account 12 beg: 0.00 0.00 1: 0.00 100.00 1: 100.00 0.00 end: 0.00 0.00 ---------------------- Balance 1 : 0.00 0.00 2 : 0.00 0.00 3 : 0.00 0.00 4 : 0.00 0.00 5 : 0.00 0.00 6 : 0.00 0.00 7 : 0.00 0.00 8 : 0.00 0.00 9 : 0.00 0.00 10 : 0.00 0.00 11 : 0.00 0.00 12 : 0.00 0.00 ---------------------- sum: 0.00 0.00 ======================</code> </pre><br><p>  Tout semble aller bien. </p><br><p>  Et si nous utilisons un tel ensemble de publications, le test réussira: </p><br><pre> <code class="python hljs">( <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">100.00</span></span>), (<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">100.00</span></span>), ( <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">-100.00</span></span>),</code> </pre> <br><p>  Et si un tel ensemble, échangez les 2 dernières lignes par endroits, alors nous obtenons une exception: </p><br><pre> <code class="python hljs">( <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">100.00</span></span>), ( <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">-100.00</span></span>), (<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">100.00</span></span>),</code> </pre> <br><p>  Ainsi, afin de détecter une telle erreur, l'annulation doit être effectuée immédiatement après la correction de la transaction. </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  Dans les articles suivants, nous poursuivrons l'étude de la comptabilité et examinerons tous les aspects du développement du système conformément à la liste des exigences d'Empire ERP. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr471304/">https://habr.com/ru/post/fr471304/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr471294/index.html">Poèmes sur Haskell, C ++ et les programmeurs</a></li>
<li><a href="../fr471296/index.html">Lean Manufacturing - Un outil pour l'efficacité</a></li>
<li><a href="../fr471298/index.html">Bieber et Bilan agitent un stylo. AI chante maintenant des chansons</a></li>
<li><a href="../fr471300/index.html">Réagissez: la levée de l'état tue votre application</a></li>
<li><a href="../fr471302/index.html">Vérification des utilisateurs en Chine et crédit social</a></li>
<li><a href="../fr471306/index.html">Développement du plugin VPN Continent-AP pour Sailfish OS</a></li>
<li><a href="../fr471310/index.html">Mon opinion très subjective sur la formation professionnelle et pas seulement en informatique</a></li>
<li><a href="../fr471312/index.html">Préparation à la certification professionnelle du printemps. Botte de printemps</a></li>
<li><a href="../fr471318/index.html">Septembre Digest sur l'apprentissage automatique et l'intelligence artificielle</a></li>
<li><a href="../fr471320/index.html">Outils pour les développeurs de logiciels: framework ouvert et bibliothèques d'apprentissage automatique</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>