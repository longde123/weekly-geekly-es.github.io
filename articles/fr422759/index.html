<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêµ üöß üéõÔ∏è Carte interactive pour une application Web en quelques heures ‚úäüèø üé¢ üëê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans un article pr√©c√©dent, j'ai bri√®vement parl√© des capacit√©s de kepler.gl, le nouvel outil Open Source pour visualiser et analyser de grands ensembl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Carte interactive pour une application Web en quelques heures</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422759/"><p>  Dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article pr√©c√©dent,</a> j'ai bri√®vement parl√© des capacit√©s de kepler.gl, le nouvel outil Open Source pour visualiser et analyser de grands ensembles de donn√©es g√©ographiques. </p><br><p><img src="https://habrastorage.org/webt/j7/wr/ug/j7wrugptpbwykcqm4quq-lrk72s.png" alt="Options pour les cartes cr√©√©es avec kepler.gl"><br>  <em>Figure 1. Options pour les cartes cr√©√©es √† l'aide de kepler.gl (par Uber)</em> </p><br><p> Cette application Web vous permet de cr√©er une carte interactive informative et, surtout, color√©e bas√©e sur des ensembles arbitraires de g√©odonn√©es en quelques minutes.  Cependant, la question se pose de savoir quoi en faire ensuite?  Comment partager les r√©sultats avec des coll√®gues, des amis ou des clients? </p><a name="habracut"></a><br><h3 id="sravnivaem-alternativnye-varianty">  Comparez les alternatives </h3><br><p>  Toute la ¬´magie¬ª de kepler.gl se produit sur le client, donc l'application ne propose que 2 fa√ßons de partager vos r√©sultats avec les autres: </p><br><ul><li>  enregistrer la visualisation sous forme d'image statique (tout en perdant la capacit√© d'interagir avec la carte) </li><li>  exporter la configuration et les donn√©es cr√©√©es sous forme de fichiers et les envoyer √† toutes les parties int√©ress√©es avec des instructions sur le t√©l√©chargement des donn√©es re√ßues sur kepler.gl pour afficher la carte cr√©√©e </li></ul><br><p>  Heureusement, kepler.gl n'est pas seulement un outil Web, mais aussi un composant React, avec lequel vous pouvez rapidement cr√©er un site de d√©monstration avec vos visualisations ou les int√©grer dans une application Web existante. </p><br><p>  <em><strong>Remarque</strong></em>  <em>Le traitement et l'agr√©gation des donn√©es √† la vol√©e, kepler.gl n√©cessitent souvent beaucoup de ressources.</em>  <em>Par cons√©quent, vous devez √™tre particuli√®rement prudent lors de son int√©gration dans des applications con√ßues pour les mobiles.</em> </p><br><p>  Ce cas d'utilisation de kepler.gl permettra: </p><br><ul><li>  ne complique pas le processus de visualisation de la visualisation (il suffit d'envoyer un lien vers votre application) </li><li>  ne donne pas acc√®s aux ensembles de donn√©es d'origine sous une forme explicite (comme requis par le cas de base 2) </li><li>  restreindre les formats accessibles aux utilisateurs pour interagir avec les visualisations (par exemple, interdire le r√©glage automatique des filtres ou des m√©thodes d'affichage des donn√©es) </li><li>  enregistrer tous les formats souhait√©s pour interagir avec la carte (info-bulle, zoom, changer de mode de carte, etc.) </li></ul><br><p>  La derni√®re des options envisag√©es n√©cessitera des efforts suppl√©mentaires de la part du cr√©ateur de g√©o-visualisation et vous ne pourrez pas vous passer de programmation.  Cependant, comme vous le verrez bient√¥t, il n'est pas difficile de le mettre en ≈ìuvre de la m√™me mani√®re. </p><br><h3 id="sozdaem-demo-prilozhenie">  Cr√©er une application de d√©monstration </h3><br><p>  Il est temps de passer de la th√©orie √† la pratique.  Afin de vous pr√©senter les √©tapes de base de l'int√©gration de kepler.gl dans votre code, j'ai r√©alis√© une petite application de d√©monstration. </p><br><p>  Il permet √† l'utilisateur de voir des informations sur les parkings payants de Moscou dans l'un des deux modes - g√©n√©ral ou agr√©g√©.  Dans le m√™me temps, l'application permet uniquement de visualiser les visualisations que nous avons cr√©√©es, de basculer entre elles et de travailler avec la carte en mode lecture seule.  Tout le code source et la version en direct sont disponibles sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> . </p><br><p><img src="https://habrastorage.org/webt/sh/hb/qa/shhbqaimmmrciwal58iquhxiy08.png" alt="Application de d√©monstration pour un parking payant √† Moscou"><br>  <em>Figure 2. Deux modes d'affichage de carte fournis par l'application de d√©monstration</em> </p><br><p>  Pour cr√©er cette d√©mo, j'ai utilis√© mon propre mod√®le de projet.  Cependant, si vous d√©cidez de jouer avec kepler.gl vous-m√™me, mais que vous n'avez toujours pas de pr√©f√©rences personnelles, je vous recommande d'utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">create-react-app</a> , ce qui r√©duira consid√©rablement le temps <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">n√©cessaire</a> pour cr√©er les fondations de votre future application. </p><br><h3 id="dobavlyaem-keplergl-v-proekt">  Ajouter kepler.gl au projet </h3><br><p>  Kepler.gl est un composant React qui utilise Redux pour stocker et g√©rer son √©tat.  Pour l'ajouter au projet, il suffit d'installer le paquet npm appropri√©: </p><br><pre><code class="bash hljs">npm install --save kepler.gl</code> </pre> <br><p>  Ce package npm comprend: </p><br><ul><li>  un ensemble de composants d'interface utilisateur et d'usines qui leur permettent d'√™tre red√©finis avec leurs propres composants </li><li>  m√©thodes pr√©d√©finies pour ajouter / modifier les donn√©es utilis√©es et comment les afficher </li><li>  R√©ducteur redux n√©cessaire √† leur travail </li></ul><br><h3 id="nastraivaem-redux-hranilische-dlya-raboty-keplergl">  Configuration du stockage Redux pour kepler.gl </h3><br><p>  Kepler.gl utilise Redux pour g√©rer son √©tat dans le processus de cr√©ation et de mise √† jour des cartes.  Par cons√©quent, avant d'utiliser le composant KeplerGl, nous devons ajouter le r√©ducteur appropri√© au r√©ducteur d'application. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { combineReducers } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> keplerGlReducer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'kepler.gl/reducers'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> appReducer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./appReducer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducers = combineReducers({ <span class="hljs-attr"><span class="hljs-attr">keplerGl</span></span>: mapReducer, <span class="hljs-attr"><span class="hljs-attr">app</span></span>: appReducer, }); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> reducers;</code> </pre> <br><p>  Il est important de se rappeler que par d√©faut, le composant KeplerGl fournira √† l'utilisateur toutes les options disponibles pour l'auto-√©dition, le t√©l√©chargement, la mise √† jour et le filtrage des donn√©es.  Pour limiter l'ensemble des actions autoris√©es √† l'utilisateur, vous devez transf√©rer des informations sur le mode de carte (pour la lecture ou l'√©dition) et les contr√¥les de carte disponibles dans les param√®tres d'√©tat initial: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mapReducer = keplerGlReducer .initialState({ <span class="hljs-attr"><span class="hljs-attr">uiState</span></span>: { <span class="hljs-attr"><span class="hljs-attr">readOnly</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">mapControls</span></span>: { <span class="hljs-attr"><span class="hljs-attr">visibleLayers</span></span>: { <span class="hljs-attr"><span class="hljs-attr">show</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-attr"><span class="hljs-attr">toggle3d</span></span>: { <span class="hljs-attr"><span class="hljs-attr">show</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-attr"><span class="hljs-attr">splitMap</span></span>: { <span class="hljs-attr"><span class="hljs-attr">show</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">mapLegend</span></span>: { <span class="hljs-attr"><span class="hljs-attr">show</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">active</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> } } } });</code> </pre> <br><p>  Nous devrons √©galement installer react <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">-palm</a> , que kepler.gl utilise pour contr√¥ler les effets secondaires et ajouter taskMiddleware √† partir de ce paquet npm au r√©f√©rentiel Redux de son application: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {createStore, applyMiddleware, compose} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {taskMiddleware} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-palm'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> reducers <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./reducers'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = { }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> middlewares = [ taskMiddleware ]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> enhancers = [applyMiddleware(...middlewares)]; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> createStore( reducers, initialState, compose(...enhancers) );</code> </pre> <br><p>  <em><strong>Remarque</strong></em>  <em>Actuellement, l'√©quipe Uber Engineering travaille activement sur une nouvelle version de kepler.gl qui ne d√©pendra pas de react-palm.</em> </p><br><p>  Par d√©faut, kepler.gl s'attend √† ce que son objet d'√©tat soit situ√© au niveau sup√©rieur de l'√©tat de l'application enti√®re et soit accessible par le nom keplerGl.  Si la configuration du r√©f√©rentiel Redux diff√®re de celle attendue, alors pour le bon fonctionnement du composant React correspondant, il suffit de sp√©cifier l'emplacement de son √©tat dans la hi√©rarchie √† l'aide de la propri√©t√© getState. </p><br><h3 id="vstraivaem-react-komponent-keplergl">  Int√©grer le composant KeplerGl React </h3><br><p>  Pour un rendu rapide des cartes avec un grand nombre d'√©l√©ments affich√©s (jusqu'√† des millions de g√©o-points!) Kepler.gl utilise desk.gl - Framework WebGL pour la visualisation des donn√©es, et MapBox - G√©o-plateforme Open Source, qui fournit une API pratique et de nombreuses possibilit√©s pour personnaliser les cartes cr√©√©es .  Par cons√©quent, l'un des param√®tres requis transmis au composant KeplerGl est le jeton d'API pour acc√©der au service MapBox. </p><br><p>  Pour recevoir un token, vous devez vous inscrire sur le site <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.mapbox.com</a> .  MapBox offre un choix de plusieurs plans tarifaires diff√©rents, mais pour les petites applications, une version gratuite avec 50 000 vues par mois sera suffisante. </p><br><p>  Apr√®s avoir cr√©√© un compte, vous devez vous rendre dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la section des jetons</a> et g√©n√©rer une cl√© publique pour acc√©der au service. </p><br><p>  D√©finissez le jeton re√ßu sur la variable d'environnement appropri√©e: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> MapboxAccessToken=&lt;your_mapBox_token&gt;</code> </pre> <br><p>  Vous pouvez maintenant passer √† la cr√©ation d'un composant React pour afficher des informations sur les parkings payants.  Dans notre cas, ce sera juste un wrapper sur le composant KeplerGl, qui prend les dimensions de la carte comme param√®tres: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> KeplerGl <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'kepler.gl'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mapboxAccessToken = process.env.MapboxAccessToken; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ParkingMap = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">KeplerGl</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"parking_map"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">mapboxApiAccessToken</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{mapboxAccessToken}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">props.width</span></span></span></span><span class="xml"><span class="hljs-tag"> } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">props.height</span></span></span></span><span class="xml"><span class="hljs-tag"> } /&gt;</span></span></span><span class="xml"> ); export default ParkingMap;</span></span></code> </pre> <br><p>  Ajoutez ParkingMap √† l'application.  √Ä ce stade, au lieu des informations de stationnement, une carte est simplement affich√©e sans aucune information, car nous n'avons pas encore transmis les donn√©es sur la base desquelles nos visualisations sont construites. </p><br><h3 id="zagruzhaem-dannye-i-konfiguracii-karty">  T√©l√©charger les configurations de donn√©es et de cartes </h3><br><p>  Pour afficher vos donn√©es sur la carte, vous devez transf√©rer √† KeplerGl l'ensemble de donn√©es sur la base duquel la carte sera cr√©√©e et la configuration souhait√©e de la visualisation finale.  Cela peut √™tre fait en utilisant l'une des deux m√©thodes - addDataToMap ou updateVisData. </p><br><p>  La premi√®re m√©thode vous permet non seulement de t√©l√©charger le jeu de donn√©es n√©cessaire et de d√©finir / mettre √† jour compl√®tement la configuration de l'instance correspondante du composant KeplerGl, y compris les param√®tres de visualisation (visState) et la carte (mapState), ainsi que le style de la carte utilis√©e (mapStyle). </p><br><p>  AddDataToMap accepte un objet contenant les informations suivantes en tant que param√®tre de la m√©thode: </p><br><ul><li>  jeux de donn√©es utilis√©s pour la visualisation du b√¢timent </li><li>  param√®tres de configuration suppl√©mentaires (options) </li><li>  donn√©es de configuration, y compris mapState, mapStyle, visState <br><pre> <code class="javascript hljs">addDataToMap({ <span class="hljs-attr"><span class="hljs-attr">datasets</span></span>: { ‚Ä¶ } options: { ‚Ä¶ } config: { mapState { ‚Ä¶ }, mapStyle { ‚Ä¶ }, <span class="hljs-attr"><span class="hljs-attr">visState</span></span>: { ‚Ä¶ } } });</code> </pre> </li></ul><br><p>  <em><strong>Remarque</strong></em>  <em>Les donn√©es de l'objet de configuration ont toujours la priorit√© sur les param√®tres pass√©s dans l'objet options.</em> </p><br><p>  La m√©thode updateVisData permet de mettre √† jour uniquement les ensembles de donn√©es utilis√©s sans modifier compl√®tement la configuration du composant utilis√©.  Comme param√®tre, il, comme la premi√®re m√©thode, prend un objet qui contient des informations sur un nouvel ensemble ou des ensembles de donn√©es et le param√®tre ¬´options¬ª pour mettre √† jour certains param√®tres d'affichage de la carte. </p><br><p>  <strong>Initialisation de la carte</strong> </p><br><p>  Ainsi, pour le chargement initial des donn√©es, nous avons besoin de la m√©thode addDataToMap.  Dans l'application de d√©monstration en cours de cr√©ation, la base de donn√©es des parkings payants √† Moscou est charg√©e lors du premier acc√®s √† l'application par une demande distincte.  Les donn√©es source r√©sultantes doivent √™tre pr√©par√©es pour √™tre t√©l√©charg√©es sur KeplerGl.  Pour cela, dans la plupart des cas, l'un des processeurs pr√©d√©finis qui portent les donn√©es csv / json au format de donn√©es pris en charge par kepler.gl est suffisant. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadParkingData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">mapMode</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch</span></span></span><span class="hljs-function">) =&gt;</span></span> { dispatch( requestParkingData() ); fetch(demoDataUrl) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function"> =&gt;</span></span> response.text()) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function"> =&gt;</span></span> { dispatch( getParkingData() ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = Processors.processCsvData(source); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = getMapConfig(mapMode); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> datasets = [{ info, data }]; dispatch( wrapTo(<span class="hljs-string"><span class="hljs-string">'parking_map'</span></span>, addDataToMap({ datasets, config }) )); }); }; }</code> </pre> <br><p>  <strong>Basculer entre les modes</strong> </p><br><p>  Pour basculer entre les modes d'affichage de la carte, nous devons d√©finir une autre fonction d'action.  √âtant donn√© que dans la version actuelle de KeplerGl, il n'y a pas de moyen facile de modifier uniquement la configuration de la carte sans affecter les donn√©es, la m√©thode addDataToMap sera √©galement la m√©thode la plus appropri√©e pour basculer entre les modes: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toggleMapMode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">mode</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getState</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = getMapConfig( mode ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> datasets = getDatasets(getState()); dispatch( wrapTo(<span class="hljs-string"><span class="hljs-string">'parking_map'</span></span>, addDataToMap({ datasets, config }) )); dispatch( setMapMode(mode) ); }; }</code> </pre> <br><p>  Le param√®tre d'ensemble de donn√©es est requis. Par cons√©quent, chaque fois que nous basculons en mode d'affichage de carte, nous retransmettons l'ensemble de donn√©es d'origine charg√© au d√©marrage de l'application.  Les informations de configuration de la carte seront mises √† jour √† chaque fois.  Dans cet article, je ne m'attarderai pas en d√©tail sur la fa√ßon dont les m√©thodes d'assistance getMapConfig et getDatasets sont impl√©ment√©es, dont vous pouvez vous familiariser avec le code source sur GitHub. </p><br><p>  <em><strong>Remarque</strong></em>  <em>Actuellement, l'API KeplerGl est tr√®s limit√©e et con√ßue pour les cas les plus √©l√©mentaires (ajout et mise √† jour de donn√©es).</em>  <em>Dans le m√™me temps, les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©veloppeurs</a> eux-m√™mes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">reconnaissent</a> que la version actuelle ne fournit pas une m√©thode efficace pour mettre √† jour uniquement les configurations ou pour les mises √† jour des donn√©es en temps r√©el.</em>  <em>Cependant, n'oubliez pas que le projet est en cours de d√©veloppement actif et qu'il y a de l'espoir pour une expansion rapide de sa fonctionnalit√©.</em> </p><br><h3 id="kastomiziruem-elementy-karty">  Personnaliser les √©l√©ments de la carte </h3><br><p>  KeplerGl comprend non seulement un conteneur avec g√©o-visualisation, mais aussi des contr√¥les de carte, une info-bulle, un panneau lat√©ral pour g√©rer les donn√©es affich√©es, une bo√Æte de dialogue pour charger les donn√©es au format csv, json ou geojson, etc.  Dans le m√™me temps, chacun des composants r√©pertori√©s peut √™tre facilement remplac√© par sa propre version √† l'aide du syst√®me d'injection de d√©pendance. </p><br><p>  Pour remplacer le composant de base par sa version personnalis√©e, il suffit: </p><br><ul><li>  importer la fabrique de composants par d√©faut </li><li>  d√©finir une nouvelle usine renvoyant un composant personnalis√© </li><li>  int√©grer une nouvelle usine √† l'aide de la m√©thode injectComponents </li></ul><br><p>  Dans l'application de d√©monstration que nous cr√©ons, nous ne voulons pas donner √† l'utilisateur la possibilit√© de configurer ind√©pendamment le mode d'affichage, de filtrer les donn√©es existantes ou de charger de nouvelles donn√©es. </p><br><p>  En th√©orie, pour cela, il suffit d'indiquer que le composant KeplerGl est en mode lecture seule, qui n'apparaissait que dans la version 0.0.27. Cependant, m√™me dans cette version, tous les contr√¥les sont toujours affich√©s pour l'utilisateur pendant les premiers instants avant de charger la carte, puis ne se cachent que.  Pour √©viter cela, nous pouvons remplacer explicitement les composants ind√©sirables par un composant nul en utilisant la m√©thode injectComponents: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { injectComponents, ModalContainerFactory, SidePanelFactory, } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'kepler.gl/components'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// define null factory to don not render any unnecessary components const NullComponent = () =&gt; null; const nullComponentFactory = () =&gt; NullComponent; const KeplerGl = injectComponents([ [ModalContainerFactory, nullComponentFactory], [SidePanelFactory, nullComponentFactory], ]); export default KeplerGl;</span></span></code> </pre> <br><p>  De mani√®re pratique, KeplerGl vous permet non seulement de remplacer des composants de base par des composants personnalis√©s, mais l'utilisation de la m√©thode withState vous permet d'ajouter des actions suppl√©mentaires et des param√®tres d'√©tat pour les nouveaux composants. </p><br><h3 id="kak-ispolzovat-neskolko-kart-odnovremenno">  Comment utiliser plusieurs cartes √† la fois </h3><br><p>  Si vous envisagez d'utiliser plusieurs composants KeplerGL diff√©rents dans la m√™me application, chacun d'eux doit √™tre d√©fini dans les param√®tres avec un identifiant unique n√©cessaire pour ajouter / mettre √† jour les donn√©es et les configurations de chacune des cartes: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> wrapToParking = wrapTo(<span class="hljs-string"><span class="hljs-string">' parking_map'</span></span>); dispatch( wrapToParking( addDataToMap({ datasets, config }) ));</code> </pre> <br><p>  Une alternative consiste √† utiliser la fonction de connexion de Redux et la fonction forwardTo de kepler.gl.  Dans ce cas, il est assez simple pour la fonction de r√©partiteur correspondante de sp√©cifier l'ID de la carte correspondante: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> KeplerGl <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'kepler.gl'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { forwardTo, toggleFullScreen } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'kepler.gl/actions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {connect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MapContainer = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function"> =&gt;</span></span> ( &lt;div&gt; &lt;button onClick=() =&gt; props.keplerGlDispatch(toggleFullScreen())/&gt; &lt;KeplerGl id="foo" /&gt; &lt;/div&gt; ) const mapStateToProps = state =&gt; state const mapDispatchToProps = (dispatch, props) =&gt; ({ dispatch, keplerGlDispatch: forwardTo('foo', dispatch) });</code> </pre> <br><h3 id="zaklyuchenie">  Conclusion </h3><br><p>  KeplerGl vous permet d'ajouter des cartes interactives color√©es √† votre application Web React.  Gr√¢ce √† l'utilisation du framework de composants desk.gl, il peut facilement afficher des millions de g√©o-points dans un format pratique pour les visualiser et les analyser. </p><br><p>  Les vastes possibilit√©s de personnalisation non seulement des visualisations cr√©√©es, mais aussi des styles de carte, ainsi que des formats d'interaction utilisateur, font de KeplerGl un outil tr√®s attrayant pour cr√©er des visualisations cartographiques et des tableaux de bord complexes. </p><br><p>  Cependant, limit√© uniquement par les sc√©narios d'API de base, le traitement des donn√©es sur le client, ainsi que l'utilisation de MapBox sans la possibilit√© de s√©lectionner une autre source de carte, r√©duisent le nombre de projets pour lesquels cet outil peut √™tre utilis√©. </p><br><p>  Mais n'oubliez pas qu'aujourd'hui, le projet est encore tr√®s jeune et qu'il est en phase active de d√©veloppement, de sorte que bon nombre de ces lacunes peuvent devenir sans objet dans un avenir proche. </p><br><h3 id="poleznye-ssylki">  Liens utiles </h3><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Code de d√©monstration complet</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article introductif sur Kepler.Gl sur Habr</a> </li><li>  <a href="">D√©p√¥t Kepler.gl sur github</a> </li><li>  <a href="">La documentation officielle de kepler.gl</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tutoriel Kepler.gl sur Vis.Academy [en]</a> </li></ol><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr422759/">https://habr.com/ru/post/fr422759/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr422747/index.html">Position de prise en charge officielle du cryptage fort de l'IEEE</a></li>
<li><a href="../fr422751/index.html">10 outils de diagnostic SSL / TLS gratuits pour les webmasters</a></li>
<li><a href="../fr422753/index.html">Comprendre les partitions dans PostgreSQL 9</a></li>
<li><a href="../fr422755/index.html">Le portefeuille prot√©gera-t-il contre les affaissements cryptographiques?</a></li>
<li><a href="../fr422757/index.html">Pas de politique. Comment transformer durablement les manifestations de rue √† l'aide d'une application mobile?</a></li>
<li><a href="../fr422761/index.html">Quatre fa√ßons de l'√©cole d'analyse de donn√©es Yandex</a></li>
<li><a href="../fr422763/index.html">√âv√©nements num√©riques √† Moscou du 10 au 16 septembre</a></li>
<li><a href="../fr422765/index.html">OpenID Connect 1.0 sur les doigts</a></li>
<li><a href="../fr422767/index.html">Conf√©rence DEFCON 16. Fedor, InSecure.org Hacker. Analyse NMAP en ligne</a></li>
<li><a href="../fr422769/index.html">Les gagnants du Startup Battlefield TechCrunch Disrupt San Francisco 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>