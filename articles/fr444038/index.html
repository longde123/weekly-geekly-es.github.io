<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ ğŸ§ ğŸ•’ ExpÃ©rience de l'utilisation de Â«coordinateursÂ» dans un vÃ©ritable projet Â«iOSÂ» ğŸŒ ğŸ’³ ğŸ‡ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le monde de la programmation moderne est riche en tendances, et cela est doublement vrai pour le monde de la programmation des applications "iOS" . J'...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ExpÃ©rience de l'utilisation de Â«coordinateursÂ» dans un vÃ©ritable projet Â«iOSÂ»</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444038/">  Le monde de la programmation moderne est riche en tendances, et cela est doublement vrai pour le monde de la programmation des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">applications "iOS"</a> .  J'espÃ¨re que je ne me trompe pas beaucoup en affirmant que l'un des modÃ¨les architecturaux les plus Â«Ã  la modeÂ» de ces derniÃ¨res annÃ©es est le Â«coordinateurÂ».  Notre Ã©quipe a donc rÃ©alisÃ© il y a quelque temps une irrÃ©sistible envie d'essayer cette technique par elle-mÃªme.  De plus, un trÃ¨s bon cas s'est prÃ©sentÃ© - un changement significatif dans la logique et une re-planification totale de la navigation dans l'application. <br><a name="habracut"></a><br><h2>  Le problÃ¨me </h2><br>  Il arrive souvent que les contrÃ´leurs commencent Ã  en prendre trop: Â«donner des commandesÂ» directement au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>UINavigationController</code></a> , Â«communiquerÂ» avec leurs contrÃ´leurs Â«frÃ¨resÂ» (mÃªme les initialiser et les transmettre Ã  la pile de navigation) - en gÃ©nÃ©ral, il y a beaucoup Ã  faire qu'ils ne devraient mÃªme pas soupÃ§onner. <br><br>  Un des moyens possibles pour Ã©viter cela est prÃ©cisÃ©ment le Â«coordinateurÂ».  De plus, comme il sâ€™est avÃ©rÃ©, il est assez pratique de travailler et trÃ¨s flexible: le modÃ¨le est capable de gÃ©rer les Ã©vÃ©nements de navigation des deux petits modules (reprÃ©sentant, peut-Ãªtre, un seul Ã©cran) et de lâ€™application entiÃ¨re (en lanÃ§ant son Â«fluxÂ», relativement parlant, directement depuis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>UIApplicationDelegate</code></a> ). <br><br><h2>  L'histoire </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Martin Fowler,</a> dans son livre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Patterns of Enterprise Application Architecture, a</a> appelÃ© ce modÃ¨le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Application Controller</a> .  Et son premier vulgarisateur dans l'environnement "iOS" est considÃ©rÃ© comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sorush Khanlu</a> : tout a commencÃ© avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">son reportage sur "NSSpain"</a> en 2015.  Puis un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article de revue</a> est apparu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur son site Web</a> , qui avait plusieurs suites (par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ceci</a> ). <br><br>  Et puis de nombreuses critiques ont suivi (la requÃªte Â«coordinateurs iosÂ» donne des dizaines de rÃ©sultats de qualitÃ© et de degrÃ© de dÃ©tail diffÃ©rents), y compris mÃªme un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">guide sur Ray Wenderlich</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un article de Paul Hudson sur son Â«Hacking with SwiftÂ»</a> dans le cadre d'une sÃ©rie de documents sur la faÃ§on de se dÃ©barrasser du problÃ¨me ContrÃ´leur "massif". <br><br>  Pour l'avenir, le sujet de discussion le plus notable est le problÃ¨me du bouton de retour dans <code>UINavigationController</code> , dont le clic n'est pas traitÃ© par notre code, mais nous ne pouvons obtenir qu'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rappel</a> . <br><br>  En fait, pourquoi est-ce un problÃ¨me?  Les coordinateurs, comme tous les objets, pour exister en mÃ©moire, ont besoin d'un autre objet pour les Â«possÃ©derÂ».  En rÃ¨gle gÃ©nÃ©rale, lors de la construction d'un systÃ¨me de navigation Ã  l'aide de coordinateurs, certains coordinateurs en gÃ©nÃ¨rent d'autres et gardent un lien fort avec eux.  En Â«quittant la zone de responsabilitÃ©Â» du coordinateur d'origine, le contrÃ´le revient au coordinateur d'origine et la mÃ©moire occupÃ©e par le coordinateur doit Ãªtre libÃ©rÃ©e. <br><br>  Sorush a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sa propre vision pour rÃ©soudre ce problÃ¨me</a> , et note Ã©galement quelques <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">approches</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dignes</a> .  Mais nous y reviendrons. <br><br><h2>  PremiÃ¨re approche </h2><br>  <i>Avant de commencer Ã  montrer le vrai code, je tiens Ã  prÃ©ciser que bien que les principes soient pleinement cohÃ©rents avec ceux que nous avons Ã©laborÃ©s dans le projet, des extraits du code et des exemples de son utilisation sont simplifiÃ©s et rÃ©duits partout oÃ¹ cela n'interfÃ¨re pas avec leur perception.</i> <br><br>  Lorsque nous avons commencÃ© Ã  expÃ©rimenter avec les coordinateurs de l'Ã©quipe, nous n'avions pas beaucoup de temps et de libertÃ© d'action pour cela: il fallait tenir compte des principes existants et de l'appareil de navigation.  La premiÃ¨re option d'implÃ©mentation pour les coordinateurs Ã©tait basÃ©e sur un Â«routeurÂ» commun, qui est dÃ©tenu et exploitÃ© par l' <code>UINavigationController</code> .  Il sait comment faire avec les instances de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>UIViewController</code></a> tout ce qui est nÃ©cessaire en matiÃ¨re de navigation - push / pop, present / disable plus les manipulations avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le contrÃ´leur racine</a> .  Un exemple de l'interface d'un tel routeur: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> UIKit protocol Router { func present(_ module: UIViewController, animated: Bool) func dismissModule(animated: Bool, completion: (() -&gt; Void)?) func push(_ module: UIViewController, animated: Bool, completion: (() -&gt; Void)?) func popModule(animated: Bool) func setAsRoot(_ module: UIViewController) func popToRootModule(animated: Bool) }</code> </pre> <br>  Une implÃ©mentation spÃ©cifique est initialisÃ©e avec une instance de <code>UINavigationController</code> et ne contient rien de particuliÃ¨rement dÃ©licat en soi.  La seule limitation: vous ne pouvez pas passer d'autres instances de <code>UINavigationController</code> comme arguments aux mÃ©thodes d'interface (pour des raisons Ã©videntes: <code>UINavigationController</code> ne peut pas contenir <code>UINavigationController</code> dans sa pile - il s'agit d'une restriction <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>UIKit</code></a> ). <br><br>  Le coordinateur, comme tout objet, a besoin d'un propriÃ©taire - un autre objet qui stockera un lien vers celui-ci.  Un lien vers la racine peut Ãªtre stockÃ© par l'objet qui le gÃ©nÃ¨re, mais chaque coordinateur peut Ã©galement gÃ©nÃ©rer d'autres coordinateurs.  Par consÃ©quent, une interface de base a Ã©tÃ© Ã©crite pour fournir un mÃ©canisme de gestion pour les coordinateurs gÃ©nÃ©rÃ©s: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Coordinator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> childCoordinators = [<span class="hljs-type"><span class="hljs-type">Coordinator</span></span>]() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dependency coordinator: Coordinator)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// ... } func remove(dependency coordinator: Coordinator) { // ... } }</span></span></code> </pre> <br>  L'un des avantages implicites des coordinateurs est l'encapsulation des connaissances sur des sous-classes spÃ©cifiques de l' <code>UIViewController</code> .  Pour assurer l'interaction du routeur et des coordinateurs, nous avons introduit l'interface suivante: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Presentable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">presented</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UIViewController</span></span> }</code> </pre> <br>  Ensuite, chaque coordinateur spÃ©cifique devrait hÃ©riter du <code>Coordinator</code> et implÃ©menter l'interface <code>Presentable</code> , et l'interface du routeur devrait prendre la forme suivante: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Router</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">present</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> module: Presentable, animated: Bool)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dismissModule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(animated: Bool, completion: </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>)?) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> module: Presentable, animated: Bool, completion: </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>)?) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">popModule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(animated: Bool)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAsRoot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> module: Presentable)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">popToRootModule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(animated: Bool)</span></span></span></span> }</code> </pre> <br>  (L'approche avec <code>Presentable</code> vous permet Ã©galement d'utiliser des coordinateurs Ã  l'intÃ©rieur de modules Ã©crits pour interagir directement avec les instances de <code>UIViewController</code> , sans les soumettre (modules) Ã  un traitement radical.) <br><br>  Un bref exemple de tout cela en action: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FirstCoordinator</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Coordinator</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Presentable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">presented</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UIViewController</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">UIViewController</span></span>() } } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SecondCoordinator</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Coordinator</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Presentable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">presented</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UIViewController</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">UIViewController</span></span>() } } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> nc = <span class="hljs-type"><span class="hljs-type">UINavigationController</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> router = <span class="hljs-type"><span class="hljs-type">RouterImpl</span></span>(navigationController: nc) <span class="hljs-comment"><span class="hljs-comment">// Router implementation. router.setAsRoot(FirstCoordinator()) router.push(SecondCoordinator(), animated: true, completion: nil) router.popToRootModule(animated: true)</span></span></code> </pre> <br><h2>  Prochaine approximation </h2><br>  Et puis, un jour, le moment est venu de modifier totalement la navigation et la libertÃ© d'expression absolue!  Le moment oÃ¹ rien ne nous a empÃªchÃ© d'essayer d'implÃ©menter la navigation sur les coordinateurs en utilisant la mÃ©thode convoitÃ©e <code>start()</code> - une version qui captivait Ã  l'origine par sa simplicitÃ© et sa concision. <br><br>  Les fonctionnalitÃ©s de <code>Coordinator</code> mentionnÃ©es ci-dessus ne seront Ã©videmment pas superflues.  Mais la mÃªme mÃ©thode doit Ãªtre ajoutÃ©e Ã  l'interface gÃ©nÃ©rale: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Coordinator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dependency coordinator: Coordinator)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">remove</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dependency coordinator: Coordinator)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseCoordinator</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Coordinator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> childCoordinators = [<span class="hljs-type"><span class="hljs-type">Coordinator</span></span>]() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dependency coordinator: Coordinator)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// ... } func remove(dependency coordinator: Coordinator) { // ... } func start() { } }</span></span></code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Swift"</a> n'offre pas la possibilitÃ© de dÃ©clarer des classes abstraites (car il est plus orientÃ© vers une approche orientÃ©e protocole que vers une approche plus classique, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">orientÃ©e objet</a> ), donc la mÃ©thode <code>start()</code> peut Ãªtre laissÃ©e avec une implÃ©mentation ou une poussÃ©e vide il quelque chose comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>fatalError(_:file:line:)</code></a> (forÃ§ant Ã  remplacer cette mÃ©thode par les hÃ©ritiers).  Personnellement, je prÃ©fÃ¨re la premiÃ¨re option. <br><br>  Mais Swift a une excellente occasion d'ajouter des mÃ©thodes d'implÃ©mentation par dÃ©faut aux mÃ©thodes de protocole, donc la premiÃ¨re pensÃ©e, bien sÃ»r, n'Ã©tait pas de dÃ©clarer une classe de base, mais de faire quelque chose comme ceci: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Coordinator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dependency coordinator: Coordinator)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// ... } func remove(dependency coordinator: Coordinator) { // ... } }</span></span></code> </pre> <br>  Mais les extensions de protocole ne peuvent pas dÃ©clarer de champs stockÃ©s, et les implÃ©mentations de ces deux mÃ©thodes doivent Ã©videmment Ãªtre basÃ©es sur une propriÃ©tÃ© de type stockÃ©e privÃ©e. <br><br>  La base de tout coordinateur particulier ressemblera Ã  ceci: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeCoordinator</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseCoordinator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// ... } }</span></span></code> </pre> <br>  Toutes les dÃ©pendances nÃ©cessaires au fonctionnement du coordinateur peuvent Ãªtre ajoutÃ©es Ã  l'initialiseur.  Comme cas typique, une instance de <code>UINavigationController</code> . <br><br>  S'il s'agit du coordinateur racine dont la responsabilitÃ© est de mapper le <code>UIViewController</code> racine, le coordinateur peut, par exemple, accepter une nouvelle instance du <code>UINavigationController</code> avec une pile vide. <br><br>  Lors du traitement des Ã©vÃ©nements (plus Ã  ce sujet plus tard), le coordinateur peut transmettre ce <code>UINavigationController</code> plus loin aux autres coordinateurs qu'il gÃ©nÃ¨re.  Et ils peuvent Ã©galement faire avec l'Ã©tat actuel de la navigation ce dont ils ont besoin: Â«pousserÂ», Â«prÃ©senterÂ», et au moins remplacer la pile de navigation entiÃ¨re. <br><br><h3>  AmÃ©liorations possibles de l'interface </h3><br>  Comme il s'est avÃ©rÃ© plus tard, tous les coordinateurs ne gÃ©nÃ©reront pas d'autres coordinateurs, donc tous ne devraient pas dÃ©pendre d'une telle classe de base.  Par consÃ©quent, l'un des collÃ¨gues de l'Ã©quipe connexe a suggÃ©rÃ© de se dÃ©barrasser de l'hÃ©ritage et d'introduire l'interface du gestionnaire de dÃ©pendances en tant que dÃ©pendance externe: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CoordinatorDependencies</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dependency coordinator: Coordinator)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">remove</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dependency coordinator: Coordinator)</span></span></span></span> } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultCoordinatorDependencies</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CoordinatorDependencies</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dependencies = [<span class="hljs-type"><span class="hljs-type">Coordinator</span></span>]() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dependency coordinator: Coordinator)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// ... } func remove(dependency coordinator: Coordinator) { // ... } } final class SomeCoordinator: Coordinator { private let dependencies: CoordinatorDependencies init(dependenciesManager: CoordinatorDependencies = DefaultCoordinatorDependencies()) { dependencies = dependenciesManager } func start() { // ... } }</span></span></code> </pre> <br><h3>  Gestion des Ã©vÃ©nements gÃ©nÃ©rÃ©s par l'utilisateur </h3><br>  Eh bien, le coordinateur a crÃ©Ã© et lancÃ© une nouvelle cartographie.  TrÃ¨s probablement, l'utilisateur regarde l'Ã©cran et voit un certain ensemble d'Ã©lÃ©ments visuels avec lesquels il peut interagir: boutons, champs de texte, etc. Certains d'entre eux provoquent des Ã©vÃ©nements de navigation, et ils doivent Ãªtre contrÃ´lÃ©s par le coordinateur qui a gÃ©nÃ©rÃ© ce contrÃ´leur.  Pour rÃ©soudre ce problÃ¨me, nous utilisons la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dÃ©lÃ©gation</a> traditionnelle. <br><br>  Supposons qu'il existe une sous-classe de <code>UIViewController</code> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre> <br>  Et le coordinateur qui l'ajoute Ã  la pile: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeCoordinator</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Coordinator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dependencies: <span class="hljs-type"><span class="hljs-type">CoordinatorDependencies</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> navigationController: <span class="hljs-type"><span class="hljs-type">UINavigationController?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(navigationController: <span class="hljs-type"><span class="hljs-type">UINavigationController</span></span>, dependenciesManager: <span class="hljs-type"><span class="hljs-type">CoordinatorDependencies</span></span> = <span class="hljs-type"><span class="hljs-type">DefaultCoordinatorDependencies</span></span>()) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.navigationController = navigationController dependencies = dependenciesManager } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> vc = <span class="hljs-type"><span class="hljs-type">SomeViewController</span></span>() navigationController?.pushViewController(vc, animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>) } }</code> </pre> <br>  Nous dÃ©lÃ©guons le traitement des Ã©vÃ©nements de contrÃ´leur correspondants au mÃªme coordinateur.  Ici, en fait, le schÃ©ma classique est utilisÃ©: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeViewControllerRoute</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSomeEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> route: <span class="hljs-type"><span class="hljs-type">SomeViewControllerRoute?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(route: <span class="hljs-type"><span class="hljs-type">SomeViewControllerRoute</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.route = route <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(nibName: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, bundle: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">required</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>?(coder aDecoder: <span class="hljs-type"><span class="hljs-type">NSCoder</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">fatalError</span></span>(<span class="hljs-string"><span class="hljs-string">"init(coder:) has not been implemented"</span></span>) } <span class="hljs-meta"><span class="hljs-meta">@IBAction</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buttonAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { route?.onSomeEvent() } } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeCoordinator</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Coordinator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dependencies: <span class="hljs-type"><span class="hljs-type">CoordinatorDependencies</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> navigationController: <span class="hljs-type"><span class="hljs-type">UINavigationController?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(navigationController: <span class="hljs-type"><span class="hljs-type">UINavigationController</span></span>, dependenciesManager: <span class="hljs-type"><span class="hljs-type">CoordinatorDependencies</span></span> = <span class="hljs-type"><span class="hljs-type">DefaultCoordinatorDependencies</span></span>()) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.navigationController = navigationController dependencies = dependenciesManager } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> vc = <span class="hljs-type"><span class="hljs-type">SomeViewController</span></span>(route: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) navigationController?.pushViewController(vc, animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeCoordinator</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeViewControllerRoute</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSomeEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// ... } }</span></span></code> </pre> <br><h3>  Manipulation du bouton de retour </h3><br>  Un autre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bon examen du modÃ¨le architectural discutÃ© a Ã©tÃ© publiÃ© par Paul Hudson sur son site Web Â«Hacking with SwiftÂ»,</a> on pourrait mÃªme dire un guide.  Il contient Ã©galement une explication simple et directe de l'une de leurs solutions possibles au problÃ¨me du bouton de retour susmentionnÃ©: le coordinateur (si nÃ©cessaire) se dÃ©clare dÃ©lÃ©guÃ© de l'instance <code>UINavigationController</code> qui lui a Ã©tÃ© transmise et surveille l'Ã©vÃ©nement qui nous intÃ©resse. <br><br>  Cette approche prÃ©sente un petit inconvÃ©nient: seul le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>NSObject</code></a> peut Ãªtre un dÃ©lÃ©guÃ© <code>UINavigationController</code> . <br><br>  Donc, il y a un coordinateur qui engendre un autre coordinateur.  Cet autre, en appelant <code>start()</code> ajoute une sorte de <code>UIViewController</code> Ã  la pile <code>UINavigationController</code> .  En cliquant sur le bouton de retour sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>UINavigationBar</code></a> tout ce que vous avez Ã  faire est de faire savoir au coordinateur d'origine que le coordinateur gÃ©nÃ©rÃ© a terminÃ© son travail (Â«fluxÂ»).  Pour ce faire, nous avons introduit un autre outil de dÃ©lÃ©gation: un dÃ©lÃ©guÃ© est allouÃ© Ã  chaque coordinateur gÃ©nÃ©rÃ©, dont l'interface est implÃ©mentÃ©e par le coordinateur gÃ©nÃ©rateur: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CoordinatorFlowListener</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onFlowFinished</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(coordinator: Coordinator)</span></span></span></span> } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainCoordinator</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Coordinator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dependencies: <span class="hljs-type"><span class="hljs-type">CoordinatorDependencies</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> navigationController: <span class="hljs-type"><span class="hljs-type">UINavigationController</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(navigationController: <span class="hljs-type"><span class="hljs-type">UINavigationController</span></span>, dependenciesManager: <span class="hljs-type"><span class="hljs-type">CoordinatorDependencies</span></span> = <span class="hljs-type"><span class="hljs-type">DefaultCoordinatorDependencies</span></span>()) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.navigationController = navigationController dependencies = dependenciesManager <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> someCoordinator = <span class="hljs-type"><span class="hljs-type">SomeCoordinator</span></span>(navigationController: navigationController, flowListener: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) dependencies.add(someCoordinator) someCoordinator.start() } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainCoordinator</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CoordinatorFlowListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onFlowFinished</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(coordinator: Coordinator)</span></span></span></span> { dependencies.remove(coordinator) <span class="hljs-comment"><span class="hljs-comment">// ... } } final class SomeCoordinator: NSObject, Coordinator { private weak var flowListener: CoordinatorFlowListener? private weak var navigationController: UINavigationController? init(navigationController: UINavigationController, flowListener: CoordinatorFlowListener) { self.navigationController = navigationController self.flowListener = flowListener } func start() { // ... } } extension SomeCoordinator: UINavigationControllerDelegate { func navigationController(_ navigationController: UINavigationController, didShow viewController: UIViewController, animated: Bool) { guard let fromVC = navigationController.transitionCoordinator?.viewController(forKey: .from) else { return } if navigationController.viewControllers.contains(fromVC) { return } if fromVC is SomeViewController { flowListener?.onFlowFinished(coordinator: self) } } }</span></span></code> </pre> <br>  Dans l'exemple ci-dessus, le <code>MainCoordinator</code> ne fait rien: il lance simplement le flux d'un autre coordinateur - dans la vraie vie, bien sÃ»r, il est inutile.  Dans notre application, le <code>MainCoordinator</code> reÃ§oit des donnÃ©es de l'extÃ©rieur, selon lesquelles il dÃ©termine l'Ã©tat dans lequel l'application est - autorisÃ©e, non autorisÃ©e, etc.  - et quel Ã©cran doit Ãªtre affichÃ©.  En fonction de cela, il lance un flux du coordinateur correspondant.  Si le coordinateur d'origine a terminÃ© son travail, le coordinateur principal reÃ§oit un signal Ã  ce sujet via le <code>CoordinatorFlowListener</code> et, par exemple, lance le flux d'un autre coordinateur. <br><br><h2>  Conclusion </h2><br>  Bien entendu, la solution habituelle prÃ©sente un certain nombre d'inconvÃ©nients (comme toute solution Ã  tout problÃ¨me). <br><br>  Oui, vous devez utiliser beaucoup de dÃ©lÃ©gation, mais c'est simple et a une seule direction: du gÃ©nÃ©rÃ© au gÃ©nÃ©rÃ© (du contrÃ´leur au coordinateur, du coordinateur gÃ©nÃ©rÃ© au gÃ©nÃ©rÃ©). <br><br>  Oui, pour Ã©chapper aux fuites de mÃ©moire, vous devez ajouter une mÃ©thode dÃ©lÃ©guÃ©e <code>UINavigationController</code> avec une implÃ©mentation presque identique Ã  chaque coordinateur.  (La premiÃ¨re approche n'a pas cet inconvÃ©nient, mais partage plutÃ´t plus gÃ©nÃ©reusement ses connaissances internes sur la nomination d'un coordinateur spÃ©cifique.) <br><br>  Mais le plus gros inconvÃ©nient de cette approche est que, dans la vraie vie, les coordinateurs, malheureusement, en savent un peu plus sur le monde qui les entoure que nous ne le souhaiterions.  Plus prÃ©cisÃ©ment, ils devront ajouter des Ã©lÃ©ments logiques qui dÃ©pendent des conditions externes, dont le coordinateur n'a pas directement connaissance.  Fondamentalement, c'est en fait ce qui se passe lorsque la mÃ©thode <code>start()</code> est <code>onFlowFinished(coordinator:)</code> ou que le <code>onFlowFinished(coordinator:)</code> est <code>onFlowFinished(coordinator:)</code> .  Et tout peut arriver Ã  ces endroits, et ce sera toujours un comportement "codÃ© en dur": ajouter un contrÃ´leur Ã  la pile, remplacer la pile, retourner au contrÃ´leur racine - peu importe.  Et tout cela ne dÃ©pend pas des compÃ©tences du contrÃ´leur actuel, mais des conditions externes. <br><br>  NÃ©anmoins, le code est Â«joliÂ» et concis, il est vraiment agrÃ©able de travailler avec lui et la navigation dans le code est beaucoup plus facile.  Il nous a semblÃ© qu'avec les lacunes mentionnÃ©es, en Ã©tant conscients, il est tout Ã  fait possible d'exister. <br><blockquote>  Merci d'avoir lu cet endroit!  J'espÃ¨re qu'ils ont appris quelque chose d'utile pour eux-mÃªmes.  Et si vous voulez tout Ã  coup "plus que moi", voici un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien vers mon Twitter</a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr444038/">https://habr.com/ru/post/fr444038/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr444028/index.html">PrÃ©sentation de Microsoft Game Stack</a></li>
<li><a href="../fr444030/index.html">Le dÃ©taillant en ligne chinois Gearbest a laissÃ© ouverte une base de donnÃ©es contenant des millions de donnÃ©es personnelles sur les clients</a></li>
<li><a href="../fr444032/index.html">Pourquoi une imprimante 3D n'est pas une imprimante</a></li>
<li><a href="../fr444034/index.html">7 pÃ©chÃ©s capitaux d'un manager</a></li>
<li><a href="../fr444036/index.html">AccÃ©lÃ©rer les E / S des fichiers C / C ++ sans vraiment forcer</a></li>
<li><a href="../fr444040/index.html">Classement autocentrique. Rapport Yandex sur la recherche d'audiences pertinentes pour les auteurs zen</a></li>
<li><a href="../fr444044/index.html">L'Europe va recycler le fer du centre de donnÃ©es</a></li>
<li><a href="../fr444048/index.html">Trucs et astuces de Digital Forensics: comment dÃ©tecter les modifications de stratÃ©gie de groupe induites par un intrus</a></li>
<li><a href="../fr444050/index.html">Discussion: le stockage d'ADN deviendra-t-il massif</a></li>
<li><a href="../fr444052/index.html">Comment nous Ã  IntelliJ IDEA recherchons les expressions lambda</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>