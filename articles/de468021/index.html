<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚óºÔ∏è üëäüèΩ ‚òÆÔ∏è PHP, wie viel Abstraktion f√ºr die Menschen? üë±üèø üö∂üèø üåº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Joy: Was ist los? 
 Traurigkeit: Wir abstrahieren! Es gibt vier Stufen. Dies ist der erste. Nicht objektive Fragmentierung! 
 Bing Bong: Okay, keine P...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PHP, wie viel Abstraktion f√ºr die Menschen?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/funcorp/blog/468021/"><img src="https://habrastorage.org/webt/wx/in/ae/wxinae8d5pdleez3sa9w1odeaw0.jpeg"><br>  <i>Joy: Was ist los?</i> <i><br></i>  <i>Traurigkeit: Wir abstrahieren!</i>  <i>Es gibt vier Stufen.</i>  <i>Dies ist der erste.</i>  <i>Nicht objektive Fragmentierung!</i> <i><br></i>  <i>Bing Bong: Okay, keine Panik.</i>  <i>Wichtig ist, dass wir alle zusammen bleiben.</i>  <i>[pl√∂tzlich f√§llt sein abstrakter Arm ab]</i> <i><br></i>  <i>Joy: Oh!</i>  <i>[Traurigkeit und Freude fallen auch auseinander]</i> <i><br></i>  <i>Traurigkeit: Wir sind in der zweiten Phase.</i>  <i>Wir dekonstruieren!</i>  <i>[als Bing Bong in St√ºcke f√§llt]</i> <i><br></i>  <i>Bing Bong: Ich kann meine Beine nicht f√ºhlen!</i>  <i>[nimmt ein Bein hoch] Oh, da sind sie.</i> <i><br></i>  <i><b>¬© Cartoon von innen nach au√üen</b></i> <br><br>  Jeder liebt es, sch√∂nen Code zu schreiben.  Zu Abstraktionen, Lambdas, SOLID, DRY, DI usw.  usw.  In diesem Artikel m√∂chte ich untersuchen, wie viel es in Bezug auf die Leistung kostet und warum. <br><br>  Dazu √ºbernehmen wir eine einfache Aufgabe, die von der Realit√§t getrennt ist, und wir werden nach und nach Sch√∂nheit in sie einbringen, die Leistung messen und unter die Haube schauen. <br><a name="habracut"></a><br>  <b>Haftungsausschluss:</b> Dieser Artikel sollte in keiner Weise als Aufruf zum Schreiben von fehlerhaftem Code ausgelegt werden.  Es ist am besten, wenn Sie im Voraus abstimmen und nach dem Lesen von ‚ÄûCool!  Jetzt wei√ü ich, wie es drinnen ist.  Aber ich werde es nat√ºrlich nicht benutzen. ‚Äú  :) :) <br><br>  Herausforderung: <br><br><ol><li>  Dan Textdatei. </li><li>  Wir brechen es in Linien. </li><li>  Schneiden Sie die Zwischenr√§ume nach links und rechts </li><li>  Verwerfen Sie alle Leerzeilen. </li><li>  Wir ersetzen alle nicht einzelnen Leerzeichen durch einzelne ("ABC" -&gt; "ABC"). </li><li>  Zeilen mit mehr als 10 W√∂rtern werden entsprechend den W√∂rtern r√ºckw√§rts gespiegelt ("An Bn Cn" -&gt; "Cn Bn An"). </li><li>  Wir z√§hlen, wie oft jede Zeile vorkommt. </li><li>  Drucken Sie alle Zeilen, die mehr als N Mal vorkommen. </li></ol><br>  Als Eingabedatei nehmen wir traditionell php-src / Zend / zend_vm_execute.h f√ºr ~ 70.000 Zeilen. <br><br>  Nehmen Sie zur Laufzeit PHP 7.3.6. <br>  Schauen wir uns die kompilierten Opcodes hier an: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://3v4l.org</a> . <br><br>  Die Messungen werden wie folgt durchgef√ºhrt: <br><br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//     $start = microtime(true); ob_start(); for ($i = 0; $i &lt; 10; $i++) { //    } ob_clean(); echo "Time: " . (microtime(true) - $start) / 10;</span></span></code> </pre> <br><h3>  Erster Ansatz, naiv </h3><br>  Schreiben wir einen einfachen Imperativcode: <br><br><pre> <code class="php hljs">$array = explode(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>, file_get_contents(<span class="hljs-string"><span class="hljs-string">'/Users/rjhdby/CLionProjects/php-src/Zend/zend_vm_execute.h'</span></span>)); $cache = []; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($array <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $row) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($row)) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; $words = preg_split(<span class="hljs-string"><span class="hljs-string">"/\s+/"</span></span>, trim($row)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($words) &gt; <span class="hljs-number"><span class="hljs-number">10</span></span>) { $words = array_reverse($words); } $row = implode(<span class="hljs-string"><span class="hljs-string">" "</span></span>, $words); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($cache[$row])) { $cache[$row]++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $cache[$row] = <span class="hljs-number"><span class="hljs-number">1</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($cache <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $value) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($value &gt; <span class="hljs-number"><span class="hljs-number">1000</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"$key : $value"</span></span> . PHP_EOL; } }</code> </pre> <br>  Laufzeit ~ 0,148 s. <br><br>  Alles ist einfach und es gibt nichts zu erz√§hlen. <br><br><h3>  Der zweite Ansatz, prozedural </h3><br>  Wir √ºberarbeiten unseren Code und nehmen die elementaren Aktionen in der Funktion heraus. <br>  Wir werden versuchen, den Grundsatz der alleinigen Verantwortung einzuhalten. <br><br><div class="spoiler">  <b class="spoiler_title">Fu√ütuch unter dem Spoiler.</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContentFromFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $fileName)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> explode(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>, file_get_contents($fileName)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reverseWordsIfNeeded</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array &amp;$input)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($input) &gt; <span class="hljs-number"><span class="hljs-number">10</span></span>) { $input = array_reverse($input); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $input)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $words = preg_split(<span class="hljs-string"><span class="hljs-string">"/\s+/"</span></span>, trim($input)); reverseWordsIfNeeded($words); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> implode(<span class="hljs-string"><span class="hljs-string">" "</span></span>, $words); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printIfSuitable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $input, int $threshold)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($input <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $value) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($value &gt; $threshold) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"$key : $value"</span></span> . PHP_EOL; } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addToCache</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array &amp;$cache, string $line)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($cache[$line])) { $cache[$line]++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $cache[$line] = <span class="hljs-number"><span class="hljs-number">1</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processContent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $input)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ $cache = []; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($input <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $row) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($row)) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; addToCache($cache, prepareString($row)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $cache; } printIfSuitable( processContent( getContentFromFile(<span class="hljs-string"><span class="hljs-string">'/Users/rjhdby/CLionProjects/php-src/Zend/zend_vm_execute.h'</span></span>) ), <span class="hljs-number"><span class="hljs-number">1000</span></span> );</code> </pre> <br></div></div><br>  Laufzeit ~ 0,275s ... WTF !?  Der Unterschied ist fast 2 mal! <br><br>  Mal sehen, was eine PHP-Funktion aus Sicht einer virtuellen Maschine ist. <br><br>  Code: <br><br><pre> <code class="php hljs">$a = <span class="hljs-number"><span class="hljs-number">1</span></span>; $b = <span class="hljs-number"><span class="hljs-number">2</span></span>; $c = $a + $b;</code> </pre> <br>  Kompiliert zu: <br><br><pre> <code class="php hljs">line <span class="hljs-comment"><span class="hljs-comment">#* EIO op fetch ext return operands ------------------------------------------------------------------------------------- 2 0 E &gt; ASSIGN !0, 1 3 1 ASSIGN !1, 2 4 2 ADD ~5 !0, !1 3 ASSIGN !2, ~5</span></span></code> </pre><br>  Lassen Sie uns den Zusatz in eine Funktion einf√ºgen: <br><br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($a, $b)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $a + $b; } $a = <span class="hljs-number"><span class="hljs-number">1</span></span>; $b = <span class="hljs-number"><span class="hljs-number">1</span></span>; $c = sum($a, $b);</code> </pre> <br>  Dieser Code wird in zwei Gruppen von Opcodes kompiliert: einen f√ºr den Root-Namespace und einen f√ºr die Funktion. <br><br>  Wurzel: <br><br><pre> <code class="php hljs">line <span class="hljs-comment"><span class="hljs-comment">#* EIO op fetch ext return operands ------------------------------------------------------------------------------------- 2 0 E &gt; ASSIGN !0, 1 3 1 ASSIGN !1, 1 5 2 NOP 9 3 INIT_FCALL 'sum' 4 SEND_VAR !0 5 SEND_VAR !1 6 DO_FCALL 0 $5 7 ASSIGN !2, $5</span></span></code> </pre> <br>  Funktion: <br><br><pre> <code class="php hljs">line <span class="hljs-comment"><span class="hljs-comment">#* EIO op fetch ext return operands ------------------------------------------------------------------------------------- 5 0 E &gt; RECV !0 1 RECV !1 6 2 ADD ~2 !0, !1 3 &gt; RETURN ~2</span></span></code> </pre> <br>  Das hei√üt,  Selbst wenn Sie nur nach Opcodes z√§hlen, f√ºgt jeder Funktionsaufruf 3 + 2N Opcodes hinzu, wobei N die Anzahl der √ºbergebenen Argumente ist. <br><br>  Und wenn Sie etwas tiefer graben, dann wechseln wir hier auch den Ausf√ºhrungskontext. <br><br>  Eine grobe Sch√§tzung unseres √ºberarbeiteten Codes ergibt solche Zahlen (denken Sie an etwa 70.000 Iterationen). <br>  Die Anzahl der "zus√§tzlich" ausgef√ºhrten Opcodes: ~ 17.000.000. <br>  Anzahl der Kontextwechsel: ~ 280.000. <br><br><h3>  Der dritte Ansatz, klassisch </h3><br>  Besonders ohne zu philosophieren, wickeln wir all diese Funktionen in eine Klasse ein. <br><br><div class="spoiler">  <b class="spoiler_title">Bettlaken unter dem Spoiler</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProcessFile</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $content; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $cache = []; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $fileName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;content = explode(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>, file_get_contents($fileName)); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reverseWordsIfNeeded</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array &amp;$input)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($input) &gt; <span class="hljs-number"><span class="hljs-number">10</span></span>) { $input = array_reverse($input); } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $input)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $words = preg_split(<span class="hljs-string"><span class="hljs-string">"/\s+/"</span></span>, trim($input)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;reverseWordsIfNeeded($words); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> implode(<span class="hljs-string"><span class="hljs-string">" "</span></span>, $words); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printIfSuitable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $threshold)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $value) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($value &gt; $threshold) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"$key : $value"</span></span> . PHP_EOL; } } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addToCache</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $line)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache[$line])) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache[$line]++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache[$line] = <span class="hljs-number"><span class="hljs-number">1</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processContent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;content <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $row) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($row)) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addToCache( <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;prepareString($row)); } } } $processFile = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProcessFile(<span class="hljs-string"><span class="hljs-string">'/Users/rjhdby/CLionProjects/php-src/Zend/zend_vm_execute.h'</span></span>); $processFile-&gt;processContent(); $processFile-&gt;printIfSuitable(<span class="hljs-number"><span class="hljs-number">1000</span></span>);</code> </pre><br></div></div><br>  Vorlaufzeit: 0,297.  Es wurde schlimmer.  Nicht viel, aber auff√§llig.  Ist die Erstellung eines Objekts (in unserem Fall 10-mal) so teuer?  Nuuu ... Nicht nur das. <br><br>  Mal sehen, wie eine virtuelle Maschine mit einer Klasse funktioniert. <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Adder</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $a; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $b; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($a, $b)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;a = $a; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;b = $b; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;a + <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;b; } } $a = <span class="hljs-number"><span class="hljs-number">1</span></span>; $b = <span class="hljs-number"><span class="hljs-number">1</span></span>; $adder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Adder($a, $b); $c = $adder-&gt;sum();</code> </pre> <br>  Es wird drei S√§tze von Opcodes geben, was logisch ist: den Root und zwei Methoden. <br><br>  Wurzel: <br><br><pre> <code class="php hljs">line <span class="hljs-comment"><span class="hljs-comment">#* EIO op fetch ext return operands --------------------------------------------------------------------------- 2 0 E &gt; NOP 16 1 ASSIGN !0, 1 17 2 ASSIGN !1, 1 18 3 NEW $7 :15 4 SEND_VAR_EX !0 5 SEND_VAR_EX !1 6 DO_FCALL 0 7 ASSIGN !2, $7 19 8 INIT_METHOD_CALL !2, 'sum' 9 DO_FCALL 0 $10 10 ASSIGN !3, $10</span></span></code> </pre> <br>  Konstruktor: <br><br><pre> <code class="php hljs">line <span class="hljs-comment"><span class="hljs-comment">#* EIO op fetch ext return operands --------------------------------------------------------------------------- 6 0 E &gt; RECV !0 1 RECV !1 7 2 ASSIGN_OBJ 'a' 3 OP_DATA !0 8 4 ASSIGN_OBJ 'b' 5 OP_DATA !1 9 6 &gt; RETURN null</span></span></code> </pre> <br>  <b>Summenmethode</b> : <br><br><pre> <code class="php hljs">line <span class="hljs-comment"><span class="hljs-comment">#* EIO op fetch ext return operands --------------------------------------------------------------------------- 11 0 E &gt; FETCH_OBJ_R ~0 'a' 1 FETCH_OBJ_R ~1 'b' 2 ADD ~2 ~0, ~1 3 &gt; RETURN ~2</span></span></code> </pre> <br>  Das <b>neue</b> Schl√ºsselwort wird tats√§chlich in einen Funktionsaufruf konvertiert (Zeilen 3-6). <br>  Es erstellt eine Instanz der Klasse und ruft den Konstruktor mit den √ºbergebenen Parametern auf. <br><br>  Im Methodencode werden wir daran interessiert sein, mit Klassenfeldern zu arbeiten.  Bitte beachten Sie, dass, wenn Sie einen einfachen <b>ASSIGN-</b> Opcode mit normalen Variablen f√ºr die Zuweisung zuweisen, f√ºr Klassenfelder alles etwas anders ist. <br><br>  Zuordnung - 2 Opcodes <br><br><pre> <code class="php hljs"> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ASSIGN_OBJ <span class="hljs-string"><span class="hljs-string">'a'</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> OP_DATA !<span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  Lesen - 1 Opcode <br><br><pre> <code class="php hljs"> <span class="hljs-number"><span class="hljs-number">1</span></span> FETCH_OBJ_R ~<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-string"><span class="hljs-string">'b'</span></span></code> </pre> <br>  Hier sollten Sie wissen, dass <b>ASSIGN_OBJ</b> und <b>FETCH_OBJ_R</b> viel komplizierter und dementsprechend ressourcenintensiver sind als ein einfaches <b>ASSIGN</b> , das grob gesagt einfach <b>zval</b> von einem Speicherelement in ein anderes kopiert. <br><br><div class="scrollable-table"><table><tbody><tr><th>  Opcode </th><th>  Die Anzahl der Zeilen des Handlers (C-Code) </th></tr><tr><td>  ASSIGN_OBJ </td><td>  149 </td></tr><tr><td>  OP_DATA </td><td>  30 </td></tr><tr><td>  FETCH_OBJ_R </td><td>  112 </td></tr><tr><td>  ZUWEISEN </td><td>  26 </td></tr></tbody></table></div><br>  Es ist klar, dass ein solcher Vergleich alles andere als korrekt ist, aber dennoch eine Vorstellung davon gibt.  Ein wenig weiter werde ich Messungen vornehmen. <br><br>  Nun wollen wir sehen, wie teuer es ist, ein Objekt zu instanziieren.  Messen wir an einer Million Iterationen: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ValueObject</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $a; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($a)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;a = $a; } } $start = microtime(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; <span class="hljs-number"><span class="hljs-number">1000000</span></span>; $i++){ <span class="hljs-comment"><span class="hljs-comment">// $a = $i; // $a = new ValueObject($i); } echo "Time: " . (microtime(true) - $start);</span></span></code> </pre> <br>  Variablenzuordnung: 0,092. <br>  Instanzobjekt: 0,889. <br><br>  So etwas in der Art.  Nicht ganz kostenlos, besonders wenn oft. <br><br>  Um nicht zweimal aufzustehen, messen wir den Unterschied zwischen der Arbeit mit Eigenschaften und lokalen Variablen.  √Ñndern Sie dazu unseren Code folgenderma√üen: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ValueObject</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $b; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">try</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($a)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    // $this-&gt;b = $a; // $c = $this-&gt;b; //    // $b = $a; // $c = $b; return $c; } } $a = new ValueObject(); $start = microtime(true); for($i = 0; $i &lt; 1000000; $i++){ $b = $a-&gt;try($i); } echo "Simple. Time: " . (microtime(true) - $start);</span></span></code> </pre> <br><br>  Austausch durch Zuordnung: 0,830. <br>  Austausch durch Eigentum: 0,862. <br><br>  Nur ein bisschen, aber l√§nger.  Genau die gleiche Reihenfolge der Unterschiede, die Sie nach dem Umschlie√üen von Funktionen in eine Klasse erhalten haben. <br><br><h3>  Banale Schlussfolgerungen </h3><br><ol><li>  Wenn Sie das n√§chste Mal eine Million Objekte instanziieren m√∂chten, √ºberlegen Sie, ob Sie sie wirklich ben√∂tigen.  Vielleicht nur ein Array, oder? </li><li>  Schreiben Sie einen Spaghetti-Code, um eine Millisekunde zu sparen.  Der Auspuff ist billig und Kollegen k√∂nnen sie sp√§ter schlagen. </li><li>  Aber um 500 Millisekunden einzusparen, ist es manchmal sinnvoll.  Die Hauptsache ist, nicht zu weit zu gehen und sich daran zu erinnern, dass diese 500 Millisekunden h√∂chstwahrscheinlich nur durch einen kleinen Abschnitt sehr hei√üen Codes gespeichert werden und nicht das gesamte Projekt in eine Leere der Trauer verwandeln. </li></ol><br>  PS √úber Lambdas beim n√§chsten Mal.  Es ist dort interessant.  :) :) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de468021/">https://habr.com/ru/post/de468021/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de468011/index.html">Die Geschichte eines hypothetischen Roboters</a></li>
<li><a href="../de468013/index.html">Eine einfache und sichere M√∂glichkeit, die Bereitstellung von Kanarienv√∂geln mit Helm zu automatisieren</a></li>
<li><a href="../de468015/index.html">Was ist derzeit √ºber ITIL 4 bekannt und wer nutzt die neue Bibliothek bereits?</a></li>
<li><a href="../de468017/index.html">Die Vielleicht-Monade √ºber Async / Warten in C # (ohne Aufgabe ov!)</a></li>
<li><a href="../de468019/index.html">Website-Entwicklung in WebAssembly mit NetCore 3 und Blazor</a></li>
<li><a href="../de468023/index.html">K√ºnstliche Intelligenz im Kampfspiel Shadow Fight 3</a></li>
<li><a href="../de468025/index.html">Wie konfiguriere ich SNI in Zimbra OSE?</a></li>
<li><a href="../de468027/index.html">Codeoptimierungsmethoden f√ºr Redd. Teil 2: Nicht zwischenspeicherbarer Speicher und paralleler Busbetrieb</a></li>
<li><a href="../de468031/index.html">Wir portieren ein Multiplayer-Spiel von C ++ mit Cheerp, WebRTC und Firebase ins Web</a></li>
<li><a href="../de468035/index.html">Laden Sie die Presse mit einem Gamecontroller oder 8 ungew√∂hnlichen Patenten f√ºr Eingabeger√§te herunter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>