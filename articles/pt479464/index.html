<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äç‚öñÔ∏è ü§òüèø üíÑ Tubos e filtros. Exemplo de aplica√ß√£o e implementa√ß√£o usando Spring üöÉ üå≠ ü•ì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este artigo discutir√° o uso do padr√£o de tubula√ß√µes e filtros. 


 Primeiro, analisaremos um exemplo de fun√ß√£o, que reescreveremos mais tarde usando o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tubos e filtros. Exemplo de aplica√ß√£o e implementa√ß√£o usando Spring</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479464/"><p>  Este artigo discutir√° o uso do padr√£o de tubula√ß√µes e filtros. </p><br><p>  Primeiro, analisaremos um exemplo de fun√ß√£o, que reescreveremos mais tarde usando o padr√£o mencionado acima.  As altera√ß√µes no c√≥digo ocorrer√£o gradualmente e cada vez que criarmos uma vers√£o vi√°vel at√© que possamos nos concentrar na solu√ß√£o usando DI (neste exemplo da Primavera). </p><br><p>  Assim, criaremos v√°rias solu√ß√µes, oferecendo a oportunidade de usar qualquer uma. <br>  No final, comparamos as implementa√ß√µes inicial e final, analisamos exemplos de aplica√ß√£o em projetos reais e resumimos. </p><a name="habracut"></a><br><h2 id="zadacha">  Desafio </h2><br><p>  Suponha que tenhamos um monte de roupas que obtemos da secagem e que agora precisamos mudar para o arm√°rio.  Acontece que os dados (roupas) v√™m de um servi√ßo separado e a tarefa √© fornecer esses dados ao cliente da forma correta (em um arm√°rio no qual ele pode obter roupas). </p><br><p>  Na maioria dos casos, voc√™ n√£o pode usar os dados recebidos na forma em que eles chegam at√© n√≥s.  Esses dados precisam ser verificados, transformados, classificados etc. <br>  Suponha que um cliente exija que as roupas sejam passadas a ferro se forem de hortel√£. </p><br><p> Ent√£o, pela primeira vez, criamos um <code>Modifier</code> , no qual prescrevemos as altera√ß√µes: </p><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Modifier</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;&gt; modify(List&lt;&gt; ){ (); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (List&lt;&gt; ) { .stream() .filter(::) .forEach(o -&gt; { <span class="hljs-comment"><span class="hljs-comment">// }); } }</span></span></code> </pre> <br><p>  Nesta fase, tudo √© simples e claro.  Vamos escrever um teste que verifique se todas as roupas amassadas foram passadas. </p><br><p>  Por√©m, com o tempo, novos requisitos aparecem e toda vez que a funcionalidade da classe <code>Modifier</code> expande: </p><br><ul><li>  N√£o coloque roupas sujas no arm√°rio. </li><li>  Camisas, jaquetas e cal√ßas devem pendurar nos ombros. </li><li>  As meias com vazamento precisam ser costuradas primeiro </li><li>  ... </li></ul><br><p>  A sequ√™ncia de mudan√ßas tamb√©m √© importante.  Por exemplo, voc√™ n√£o pode pendurar as roupas nos ombros e depois passar a ferro. </p><br><p>  Assim, em algum momento, o <code>Modifier</code> pode assumir a seguinte forma: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Modifier</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Predicate&lt;&gt; ___ = ((Predicate&lt;&gt;).class::isInstance) .or(.class::isInstance) .or(.class::isInstance) ; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;&gt; modify(List&lt;&gt; ){ (); (); (); (); <span class="hljs-comment"><span class="hljs-comment">//   return ; } private void (List&lt;&gt; ) { .stream() .filter(.class::isInstance) .map(.class::cast) .filter(::) .forEach(o -&gt; { // }); } private void (List&lt;&gt; ) { .stream() .filter(___) .forEach(o -&gt; { //   }); } private void (List&lt;&gt; ) { .removeIf(::); } private void (List&lt;&gt; ) { .stream() .filter(::) .forEach(o -&gt; { // }); } //  }</span></span></code> </pre> <br><p>  Da mesma forma, os testes se tornaram mais complicados, que agora devem pelo menos verificar cada etapa individualmente. </p><br><p>  E quando um novo requisito chega, observando o c√≥digo, decidimos que chegou a hora da refatora√ß√£o. </p><br><h2 id="refactoring">  Refatora√ß√£o </h2><br><p>  A primeira coisa que chama sua aten√ß√£o √© o rebentamento frequente de todas as roupas.  Portanto, o primeiro passo, movemos tudo em um ciclo e tamb√©m transferimos a verifica√ß√£o de limpeza para o in√≠cio do ciclo: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Modifier</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Predicate&lt;&gt; ___ = ((Predicate&lt;&gt;).class::isInstance) .or(.class::isInstance) .or(.class::isInstance) ; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;&gt; modify(List&lt;&gt; ){ List&lt;&gt; result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o : ){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(o.()){ <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } result.add(o); (o); (o); (o); <span class="hljs-comment"><span class="hljs-comment">//   } return result; } private void ( ) { if( instanceof ){ // ()  } } private void ( ) { if(___.test()){ //   } } private void ( ) { if(.()){ // } } //  }</span></span></code> </pre> <br><p>  Agora, o tempo de processamento de roupas √© reduzido, mas o c√≥digo ainda √© muito longo para uma classe e para o corpo do ciclo.  Vamos tentar encurtar o corpo do ciclo primeiro. </p><br><ul><li><p>  Ap√≥s verificar a limpeza, voc√™ pode fazer todas as chamadas em um m√©todo de <code>modify( )</code> separado <code>modify( )</code> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;&gt; modify(List&lt;&gt; ){ List&lt;&gt; result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o : ){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(o.()){ <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } result.add(o); modify(o); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">modify</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( o)</span></span></span><span class="hljs-function"> </span></span>{ (o); (o); (o); <span class="hljs-comment"><span class="hljs-comment">//   }</span></span></code> </pre> <br></li><li><p>  Voc√™ pode combinar todas as chamadas em um <code>Consumer</code> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Consumer&lt;&gt; modification = ((Consumer&lt;&gt;) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>::) .andThen(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>::) .andThen(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>::); <span class="hljs-comment"><span class="hljs-comment">//   public List&lt;&gt; modify(List&lt;&gt; ){ return .stream() .filter(o -&gt; !o.()) .peek(modification) .collect(Collectors.toList()); }</span></span></code> </pre> <br><blockquote>  Sem corte: peek <br>  Eu costumava dar uma espiada.  O Sonar dir√° que esse c√≥digo n√£o deve ser feito, porque  Javadoc informa que o m√©todo existe principalmente para depura√ß√£o.  Mas se voc√™ reescrev√™-lo no mapa: .map (o -&gt; {modification.accept (o); retornar o;}), a IDEA dir√° que √© melhor usar a espiada </blockquote><br></li></ul><br><blockquote>  Trope√ßo: Consumidor <br>  Um exemplo com Consumidor (e subseq√ºente com Fun√ß√£o) √© dado para mostrar os recursos do idioma. </blockquote><p>  Agora, o corpo do ciclo ficou mais curto, mas at√© agora a pr√≥pria classe ainda √© muito grande e cont√©m muita informa√ß√£o (conhecimento de todas as etapas). </p><br><p>  Vamos tentar resolver esse problema usando padr√µes de programa√ß√£o j√° estabelecidos.  Nesse caso, usaremos <code>Pipes &amp; Filters</code> . </p><br><h2 id="pipes--filters">  Tubos e filtros </h2><br><p>  <a href="https://docs.microsoft.com/ru-ru/azure/architecture/patterns/pipes-and-filters">O modelo de canal e filtro</a> <a href="https://medium.com/nuances-of-programming/%25D0%25BA%25D1%2580%25D0%25B0%25D1%2582%25D0%25BA%25D0%25B8%25D0%25B9-%25D0%25BE%25D0%25B1%25D0%25B7%25D0%25BE%25D1%2580-10-%25D0%25BF%25D0%25BE%25D0%25BF%25D1%2583%25D0%25BB%25D1%258F%25D1%2580%25D0%25BD%25D1%258B%25D1%2585-%25D0%25B0%25D1%2580%25D1%2585%25D0%25B8%25D1%2582%25D0%25B5%25D0%25BA%25D1%2582%25D1%2583%25D1%2580%25D0%25BD%25D1%258B%25D1%2585-%25D1%2588%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD%25D0%25BE%25D0%25B2-%25D0%25BF%25D1%2580%25D0%25B8%25D0%25BB%25D0%25BE%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B9-81647be5c46f">descreve uma abordagem</a> na qual os dados recebidos passam por v√°rias etapas de processamento. </p><br><p>  Vamos tentar aplicar essa abordagem ao nosso c√≥digo. </p><br><h3 id="shag-1">  Etapa 1 </h3><br><p>  De fato, nosso c√≥digo j√° est√° pr√≥ximo desse padr√£o.  Os dados obtidos passam por v√°rias etapas independentes.  At√© agora, cada m√©todo √© um filtro e a pr√≥pria <code>modify</code> descreve o canal, primeiro filtrando todas as roupas sujas. </p><br><p>  Agora vamos transferir cada etapa para uma classe separada e ver o que obtemos: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Modifier</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span>  ; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span>  ; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span>  ; <span class="hljs-comment"><span class="hljs-comment">//  public Modifier( ,  ,   //  ) { this. = ; this. = ; this. = ; //  } public List&lt;&gt; modify(List&lt;&gt; ) { return .stream() .filter(o -&gt; !o.()) .peek(o -&gt; { .(o); .(o); .(o); //  }) .collect(Collectors.toList()); } }</span></span></code> </pre> <br><p>  Assim, colocamos o c√≥digo em classes separadas, simplificando os testes para transforma√ß√µes individuais (e criando a possibilidade de reutilizar etapas).  A ordem das chamadas determina a sequ√™ncia de etapas. </p><br><p>  Mas a pr√≥pria classe ainda conhece todas as etapas individuais, controla a ordem e, portanto, possui uma enorme lista de depend√™ncias.  Al√©m de adicionar uma nova etapa, seremos for√ßados a n√£o apenas escrever uma nova classe, mas tamb√©m adicion√°-la ao <code>Modfier</code> . </p><br><h3 id="shag-2">  Etapa 2 </h3><br><p>  Simplifique o c√≥digo usando o Spring. <br>  Primeiro, crie uma interface para cada etapa individual: </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Modification</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">modify</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( )</span></span></span></span>; }</code> </pre><br><p>  <code>Modifier</code> pr√≥prio <code>Modifier</code> agora ser√° muito menor: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Modifier</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> List&lt;Modification&gt; steps; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Modifier</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;Modification&gt; steps)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.steps = steps; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;&gt; modify(List&lt;&gt; ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> .stream() .filter(o -&gt; !o.()) .peek(o -&gt; { steps.forEach(m -&gt; m.modify(o)); }) .collect(Collectors.toList()); } }</code> </pre> <br><p>  Agora, para adicionar uma nova etapa, basta escrever uma nova classe que implemente a interface <code>Modification</code> e colocar o <code>@Component</code> acima dela.  O Spring o encontrar√° e o adicionar√° √† lista. </p><br><p>  <code>Modifer</code> pr√≥prio <code>Modifer</code> n√£o sabe nada sobre as etapas individuais, o que cria uma "conex√£o fraca" entre os componentes. </p><br><p>  A √∫nica dificuldade √© definir a sequ√™ncia.  Para fazer isso, o Spring possui uma anota√ß√£o <code>@Order</code> na qual voc√™ pode passar um valor int.  A lista √© classificada em ordem crescente. <br>  Assim, pode acontecer que, adicionando uma nova etapa no meio da lista, voc√™ precise alterar os valores de classifica√ß√£o das etapas existentes. </p><br><blockquote>  O Spring poderia ter sido dispensado se todas as implementa√ß√µes conhecidas fossem passadas manualmente para o construtor Modifier.  Isso ajudar√° a resolver o problema de classifica√ß√£o, mas novamente complicar√° a adi√ß√£o de novas etapas. </blockquote><br><h3 id="shag-3">  Etapa 3 </h3><br><p>  Agora passamos no teste de limpeza em uma etapa separada.  Para fazer isso, reescrevemos nossa interface para que ela sempre retorne um valor: </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Modification</span></span></span><span class="hljs-class"> </span></span>{  modify( ); }</code> </pre> <br><p>  Verifique a limpeza: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-meta"><span class="hljs-meta">@Order</span></span>(Ordered.HIGHEST_PRECEDENCE) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CleanFilter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Modification</span></span></span><span class="hljs-class"> </span></span>{  modify( ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(.()){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ; } }</code> </pre> <br><p>  <code>Modifier.modify</code> : </p><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;&gt; modify(List&lt;&gt; ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> .stream() .map(o -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> modified = o; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> step : steps){ modified = step.modify(o); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(modified == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> modified; }) .filter(Objects::nonNull) .collect(Collectors.toList()); }</code> </pre> <br><p>  Nesta vers√£o, o <code>Modifier</code> n√£o possui nenhuma informa√ß√£o de dados.  Ele simplesmente os transmite a todos os passos conhecidos e coleta os resultados. </p><br><p>  Se uma das etapas retornar nulo, o processamento dessa pe√ßa de roupa ser√° interrompido. </p><br><p>  Um princ√≠pio semelhante √© usado no Spring for HandlerInterceptors.  Antes e depois da chamada do controlador, todos os interceptores apropriados para este URL s√£o chamados.  Ao mesmo tempo, retorna true ou false no m√©todo preHandle para indicar se o processamento e a chamada de interceptores subseq√ºentes podem continuar </p><br><h3 id="shag-n">  Etapa n </h3><br><p>  O pr√≥ximo passo √© adicionar o m√©todo de <code>matches</code> √† interface <code>Modification</code> , na qual as etapas para um atributo separado da roupa s√£o verificadas: </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Modification</span></span></span><span class="hljs-class"> </span></span>{  modify( ); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">matches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( )</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>;} }</code> </pre> <br><p>  Devido a isso, voc√™ pode simplificar um pouco a l√≥gica nos m√©todos de <code>modify</code> movendo as verifica√ß√µes de classes e propriedades para um m√©todo separado. </p><br><p>  Uma abordagem semelhante √© usada no filtro Spring (Request), mas a principal diferen√ßa √© que cada filtro √© um wrapper no pr√≥ximo e chama explicitamente FilterChain.doFilter para continuar o processamento. </p><br><h2 id="itogo">  Total </h2><br><p>  O resultado final √© muito diferente da vers√£o inicial.  Comparando-os, podemos tirar as seguintes conclus√µes: </p><br><ul><li>  A implementa√ß√£o baseada em tubula√ß√µes e filtros simplifica a pr√≥pria classe <code>Modifier</code> . </li><li>  Responsabilidades melhor distribu√≠das e conex√µes "fracas" entre componentes. </li><li>  Mais f√°cil para testar etapas individuais. </li><li>  Mais f√°cil de adicionar e remover etapas. </li><li>  Um pouco mais dif√≠cil de testar toda uma cadeia de filtros.  J√° precisamos de IntegrationTests. </li><li>  Mais aulas </li></ul><br><p>  Por fim, uma op√ß√£o mais conveniente e flex√≠vel que a original. </p><br><p>  Al√©m disso, voc√™ pode simplesmente paralelizar o processamento de dados usando o mesmo parallelStream. </p><br><h3 id="chto-ne-reshaet-dannyy-primer">  O que este exemplo n√£o resolve </h3><br><ol><li>  A descri√ß√£o do padr√£o diz que filtros individuais podem ser reutilizados criando outra cadeia de filtros (canal). <br><ul><li>  Por um lado, isso √© f√°cil de usar usando o <code>@Qualifier</code> . </li><li>  Por outro lado, definir uma ordem diferente com o <code>@Order</code> falhar√°. </li></ul></li><li>  Para exemplos mais complexos, voc√™ precisar√° usar v√°rias cadeias, usar cadeias aninhadas e ainda alterar a implementa√ß√£o existente. <br><ul><li>  Por exemplo, a tarefa: "para cada meia, procure um par e coloque-o em uma inst√¢ncia de &lt;? Extends Clothing&gt;" n√£o se encaixar√° bem na implementa√ß√£o descrita, porque  Agora, para cada dedo do p√©, voc√™ deve classificar todas as roupas e alterar a lista de dados inicial. </li><li>  Para resolver isso, voc√™ pode escrever uma nova interface que aceite e retorne uma Lista &lt;Vestu√°rio&gt; e a transfira para uma nova cadeia.  Mas voc√™ precisa ter cuidado com a sequ√™ncia de chamadas das pr√≥prias cadeias, se as meias puderem ser costuradas apenas pelo hotel. </li></ul></li></ol><br><h2 id="spasibo-za-vnimanie">  Obrigado pela aten√ß√£o. </h2></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt479464/">https://habr.com/ru/post/pt479464/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt479450/index.html">AppCode 2019.3: funciona mais r√°pido, entende melhor o Swift, conhece o Mac Catalyst, exibe convenientemente mensagens de montagem</a></li>
<li><a href="../pt479452/index.html">Como o sistema de nomes de dom√≠nio se desenvolveu: a era da ARPANET</a></li>
<li><a href="../pt479458/index.html">Beleza ou praticidade na sala do servidor</a></li>
<li><a href="../pt479460/index.html">Um guia para carros voadores</a></li>
<li><a href="../pt479462/index.html">Serializa√ß√£o em C ++</a></li>
<li><a href="../pt479466/index.html">Habraiting 2019: estat√≠sticas e ranking dos melhores artigos de 2019</a></li>
<li><a href="../pt479468/index.html">Edge of Honesty e John Doe</a></li>
<li><a href="../pt479474/index.html">Por que a auto-organiza√ß√£o de equipes √© t√£o importante no Scrum e por que n√£o pode haver gerentes nele</a></li>
<li><a href="../pt479478/index.html">Plug-in Java sem problemas</a></li>
<li><a href="../pt479480/index.html">SARIF SDK e seus erros</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>