<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüë®‚Äçüëß‚Äçüëß üç¨ üÜí Portes arri√®re de microcode assembl√©es par processeur X86 üî± üì£ üóÉÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous n'avons pas fait confiance aux logiciels depuis longtemps, et donc nous effectuons son audit, proc√©dons √† la r√©tro-ing√©nierie, les ex√©cutons √©tap...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Portes arri√®re de microcode assembl√©es par processeur X86</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427757/"><p> Nous n'avons pas fait confiance aux logiciels depuis longtemps, et donc nous effectuons son audit, proc√©dons √† la r√©tro-ing√©nierie, les ex√©cutons √©tape par √©tape, les ex√©cutons dans le bac √† sable.  Qu'en est-il du processeur sur lequel notre logiciel fonctionne?  - Nous faisons confiance aveugl√©ment et sans r√©serve √† ce petit morceau de silicium.  Cependant, le mat√©riel moderne a les m√™mes probl√®mes que les logiciels: fonctionnalit√© secr√®te non document√©e, bogues, vuln√©rabilit√©s, logiciels malveillants, chevaux de Troie, rootkits, portes d√©rob√©es. </p><br><p><img src="https://habrastorage.org/webt/ip/yi/6i/ipyi6itjefhde2aetsgvqabmbwo.jpeg"></p><br><p>  ISA (Instruction Set Architecture) x86 est l'une des plus longues ¬´architectures de jeu d'instructions¬ª en √©volution constante de l'histoire.  √Ä partir de la conception 8086 d√©velopp√©e en 1976, ISA subit des modifications et des mises √† jour continues;  tout en conservant la compatibilit√© descendante et la prise en charge de la sp√©cification d'origine.  Plus de 40 ans de croissance, l'architecture ISA a grandi et continue de cro√Ætre avec de nombreux nouveaux modes et ensembles d'instructions, chacun ajoutant une nouvelle couche √† la conception pr√©c√©dente, d√©j√† surcharg√©e.  En raison de la politique de compatibilit√© descendante totale, les processeurs x86 modernes contiennent m√™me des instructions et des modes qui sont d√©j√† compl√®tement oubli√©s.  En cons√©quence, nous avons une architecture de processeur, qui est un labyrinthe complexe de technologies nouvelles et anciennes.  Un tel environnement extr√™mement complexe - provoque de nombreux probl√®mes avec la cybers√©curit√© du processeur.  Par cons√©quent, les processeurs x86 ne peuvent pas pr√©tendre √™tre la racine fiable de la cyber-infrastructure critique. </p><a name="habracut"></a><br><h2 id="vy-vsyo-eschyo-doveryaete-svoemu-processoru">  Faites-vous toujours confiance √† votre processeur? </h2><br><p>  S√©curit√© des programmes et du syst√®me d'exploitation - est bas√©e sur la s√©curit√© du mat√©riel sur lequel ils sont d√©ploy√©s.  En r√®gle g√©n√©rale, les d√©veloppeurs de logiciels ne prennent pas en compte le fait que le mat√©riel sur lequel leur logiciel est d√©ploy√© peut √™tre non fiable, malveillant.  Lorsque le mat√©riel se comporte de mani√®re erron√©e (intentionnellement ou non), les m√©canismes de s√©curit√© des logiciels perdent toute valeur.  Depuis de nombreuses ann√©es, diff√©rents mod√®les de processeurs s√©curis√©s ont √©t√© propos√©s: Intel SGX, AMD Pacifica, etc. N√©anmoins, la r√©gularit√© enviable avec laquelle les informations sont publi√©es sur les d√©faillances critiques (de r√©centes, par exemple Meltdown et Spectre) et d√©tect√© des fonctions de ¬´d√©bogage¬ª non document√©es - conduit √† l'id√©e que notre enti√®re confiance dans les processeurs est sans fondement. </p><br><p>  Les processeurs x86 modernes sont un entrelacement tr√®s lourd et complexe des technologies les plus r√©centes et anciennes.  8086 avait 29 mille transistors, Pentium 3 millions, Broadwell 3,2 milliards, Cannonlake plus de 10 milliards. </p><br><p><img src="https://habrastorage.org/webt/tn/p-/_2/tnp-_2qkl0ubruapqvdv-57kcko.png"></p><br><p>  Avec autant de transistors, il n'est pas surprenant que les processeurs x86 modernes soient cribl√©s d'instructions non document√©es et de vuln√©rabilit√©s mat√©rielles.  Parmi les non document√©s, qui ont √©t√© d√©couverts presque par accident, des instructions: ICEBP (0xF1), LOADALL (0x0F07), apicall (0x0FFFF0) [1], qui permettent de d√©verrouiller le processeur pour un acc√®s non autoris√© aux zones de m√©moire prot√©g√©es. </p><br><p>  Quant aux nombreuses vuln√©rabilit√©s mat√©rielles des processeurs (voir deux figures ci-dessous), elles permettent √† un cyber-attaquant d'augmenter ses privil√®ges [3], d'extraire des cl√©s cryptographiques [4], de cr√©er de nouvelles instructions d'assembleur [2], de changer la fonctionnalit√© des instructions d'assembleur d√©j√† existantes [2] , installez des hooks sur les instructions de l'assembleur [2], prenez le contr√¥le de la ¬´virtualisation acc√©l√©r√©e mat√©rielle¬ª [7], intervenez dans les ¬´calculs cryptographiques atomiques¬ª [7], et, enfin, doux, entrez en ¬´mode divin¬ª:  vous ive un mat√©riel l√©gitime porte d√©rob√©e Intel ME (ce qui vous permet de recevoir un acc√®s √† distance, m√™me l'ordinateur est √©teint). [8]  Et tout cela - sans laisser de traces num√©riques. </p><br><p><img src="https://habrastorage.org/webt/8b/7r/hu/8b7rhuqyqipkayzqgoa-dvxximu.png"><br><img src="https://habrastorage.org/webt/v9/hi/pk/v9hipk3k6e1n8krpm22zz8j_0uk.png"></p><br><h2 id="sovremennye-processory--eto-bolshe-soft-chem-zhelezo">  Les processeurs modernes sont plus logiciels que mat√©riels </h2><br><p>  √Ä proprement parler, les processeurs modernes ne peuvent m√™me pas √™tre appel√©s "mat√©riel" au sens plein du terme.  Parce que leur fonctionnalit√© la plus critique (y compris ISA) est fournie par le microcode clignotant.  Initialement, le microcode √©tait principalement responsable du contr√¥le du d√©codage et de l'ex√©cution des instructions d'assembleurs complexes: op√©rations en virgule flottante, primitives MMX, gestionnaires de lignes avec le pr√©fixe REP, etc.  Cependant, au fil du temps, de plus en plus de responsabilit√©s sont attribu√©es au microcode pour les op√©rations de traitement √† l'int√©rieur du processeur.  Par exemple, les extensions modernes des processeurs Intel, telles que AVX (Advanced Vector Extensions) et VT-d (virtualisation mat√©rielle) sont impl√©ment√©es sur microcode. </p><br><p>  De plus, le microcode est aujourd'hui responsable, entre autres, du maintien de l'√©tat du processeur, de la gestion du cache, et √©galement de la gestion des √©conomies d'√©nergie.  Pour √©conomiser de l'√©nergie, le microcode a un m√©canisme d'interruption qui traite les √©tats de puissance: √©tat C (degr√© de sommeil √† √©conomie d'√©nergie: de l'√©tat actif au sommeil profond) et √©tat P (diff√©rentes combinaisons de tension et de fr√©quence).  Ainsi, par exemple, le microcode est responsable de la r√©initialisation du cache L2 lors de l'entr√©e dans l'√©tat C4, ainsi que lors de sa sortie. </p><br><h2 id="zachem-proizvoditeli-processorov-polzuyutsya-mikrokodom">  Pourquoi les fabricants de processeurs utilisent-ils un microcode? </h2><br><p>  Les fabricants de processeurs x86 utilisent un microcode pour d√©composer des instructions d'assemblage complexes (pouvant aller jusqu'√† 15 octets) en une cha√Æne de micro-instructions simples, afin de simplifier l'architecture mat√©rielle et de faciliter les diagnostics.  En fait, le microcode est un interpr√®te entre l'architecture CISC externe (visible pour l'utilisateur) et l'architecture RISC interne (mat√©rielle). </p><br><p>  Si des erreurs sont d√©tect√©es dans l'architecture CISC (principalement dans ISA), les fabricants publient une mise √† jour du microcode qui peut √™tre t√©l√©charg√©e sur le processeur via le BIOS / UEFI de la carte m√®re ou via le syst√®me d'exploitation (pendant le processus de d√©marrage).  Gr√¢ce √† un tel syst√®me de mise √† jour bas√© sur des microcodes, les fabricants de processeurs se procurent flexibilit√© et r√©duction des co√ªts - tout en corrigeant les erreurs dans leurs √©quipements.  L'erreur sensationnelle avec fdiv, qui a gravement fait tomber les processeurs Intel Pentium en 1994, a rendu le fait que les erreurs mat√©rielles de haute technologie sujettes aux logiciels le rendent encore plus √©vident.  Cet incident a donn√© aux fabricants encore plus d'int√©r√™t pour l'architecture des processeurs √† microcodes.  Par cons√©quent, Intel et AMD ont commenc√© √† construire leurs processeurs en utilisant la technologie des microcodes.  Intel - √† commencer par le Pentium Pro (P6), sorti en 1995.  AMD - √† commencer par le K7, sorti en 1999. </p><br><h2 id="vsyo-taynoe-stanovitsya-yavnym">  Tout secret devient clair </h2><br><p>  Malgr√© le fait que les fabricants de processeurs tentent de garder l'architecture des microcodes et le m√©canisme de mise √† jour dans la plus stricte confidentialit√©, l'ennemi n'est pas endormi.  Des informations fragment√©es (provenant principalement de brevets, tels que AMD RISC86 [5]) et une inversion r√©fl√©chie des mises √† jour officielles du BIOS (comme c'√©tait le cas avec K8 [6]), √©claircissent progressivement le secret du microcode (voir, par exemple, dans la figure ci-dessous " M√©canisme de mise √† jour du microcode du processeur AMD ¬ª).  Et gr√¢ce √† l'√©volution constante des outils d'inversion (logiciels et mat√©riels) [2], aux techniques de fuzzing prometteuses [1] et √† l'av√®nement des outils OpenSource tels que Microparse [9] et Sandsifter [10] - un cyber-attaquant peut tout apprendre sur un microcode n√©cessaire pour avoir √† y √©crire des logiciels malveillants √† microcodes. </p><br><p><img src="https://habrastorage.org/webt/rp/ko/yc/rpkoycfyygkkxhvcyxe4poffqri.png"></p><br><p>  Ainsi, par exemple, dans [2] comme "Bonjour tout le monde!"  (la premi√®re √©tape pour trojaniser le microcode) un ¬´micro hook¬ª (programme de microcode qui intercepte l'instruction d'assembleur) a √©t√© d√©velopp√©, qui compte combien de fois le processeur a acc√©d√© √† la commande div.  Ce micro-crochet est une injection dans le gestionnaire de la division instruction assembleur. </p><br><p><img src="https://habrastorage.org/webt/rn/kv/os/rnkvos_2xlvug2sjpyxjkif2h5a.png"></p><br><p>  Ibid [2] pr√©sente un micro-crochet plus avanc√©, qui se trouve tranquillement dans l'instruction d'assembleur du div ebx, sans r√©v√©ler sa pr√©sence, et n'est activ√© que lorsque des conditions sp√©cifiques sont remplies en se r√©f√©rant au div ebx: le registre ebx contient la valeur B, et le registre eax contient la valeur A. Lorsqu'il est activ√©, ce micro-crochet augmente la valeur du registre eip (pointeur d'instruction courant) d'une unit√©.  En cons√©quence, l'ex√©cution du programme (qui a eu le courage de se r√©f√©rer √† l'instruction div ebx) se poursuit avec un d√©calage: non pas √† partir du premier octet de la commande suivant le div ebx, mais √† partir de son deuxi√®me octet.  Si d'autres valeurs sont sp√©cifi√©es dans les registres eax et ebx, alors la div ebx fonctionne comme d'habitude.  Quelle en est la valeur pratique?  Par exemple, pour activer discr√®tement une cha√Æne cach√©e d'instructions d'assembleur lors de l'utilisation de techniques d'obscurcissement avec des ¬´instructions qui se chevauchent¬ª [11]. </p><br><p><img src="https://habrastorage.org/webt/gx/af/w9/gxafw9lfzweuvhrirvuwf_qfbu0.png"></p><br><p>  Ces deux exemples montrent comment des instructions d'assembleur l√©gitimes peuvent √™tre utilis√©es pour y cacher du code cheval de Troie arbitraire. </p><br><p>  Dans le m√™me temps, un cyber-attaquant peut activer sa charge utile malveillante - y compris √† distance.  Par exemple, lorsque la condition n√©cessaire √† l'activation est remplie sur une page Web contr√¥l√©e par un attaquant.  Cela est possible gr√¢ce aux compilateurs Just-in-Time (JIT) et Ahead-of-Time (AOT) int√©gr√©s aux navigateurs Web modernes.  Ces compilateurs vous permettent d'√©mettre un flux pr√©d√©fini d'instructions d'assembleur pour le code machine - m√™me si vous √©crivez le programme exclusivement en JavaScript de haut niveau (voir la derni√®re liste, juste au-dessus). </p><br><div class="spoiler">  <b class="spoiler_title">Bibliographie</b> <div class="spoiler_text"><ol><li>  <em>Christopher Domas</em> .  Briser le x86 ISA // DEFCON 25.07.2017. </li><li>  <em>Philipp Koppe</em> .  Reverse Engineering x86 Processor Microcode // Actes du 26√®me symposium de s√©curit√© USENIX.  2017. pp.  1163-1180. </li><li>  <em>Matthew Hicks</em> .  SP√âCIFICATIONS: Un m√©canisme d'ex√©cution l√©ger pour prot√©ger les logiciels contre les bogues des processeurs critiques pour la s√©curit√© // Actes de la 28e Conf√©rence internationale sur le support architectural des langages de programmation et des syst√®mes d'exploitation (ASPLOS).  2015. pp.  517-529. </li><li>  <em>Adi Shamir</em> .  Bug Attacks // Actes de la 28e conf√©rence annuelle sur la cryptographie: les progr√®s de la cryptologie.  2008. pp.  221‚Äì240. </li><li>  <em>John Favor</em> .  Jeu d'instructions RISC86 // Brevet am√©ricain 6336178. 2002. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Opteron Exposed: Reverse Engineering AMD K8 Microcode Updates</a> .  2004. </li><li>  <em>Saming Chen</em> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Analyse de s√©curit√© du</a> microcode du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">processeur x86</a> .2014. </li><li>  <em>Catalin Cimpanu</em> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un logiciel malveillant utilise la fonction de processeur Intel obscur pour voler des donn√©es et √©viter les pare-feu</a> .  2017. </li><li>  <em>Daming Chen</em> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Microparse: analyseur de microcodes pour les processeurs AMD, Intel et VIA</a> // GitHub.  2014. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sandsifter: le processeur x86 fuzzer</a> // GitHib.  2017. </li><li>  <em>Karev V.M.</em>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment √©crire un programme assembleur avec des instructions qui se chevauchent (une autre technique pour</a> brouiller le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">code d'octet)</a> // Habrahabr.  2018. URL: (Date d'acc√®s: 25 octobre 2018). </li></ol></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr427757/">https://habr.com/ru/post/fr427757/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr427745/index.html">Trucs et astuces Kubernetes: acc√®s aux sites de d√©veloppement</a></li>
<li><a href="../fr427747/index.html">Qui √©craser une voiture sans pilote: r√©sultats de l'exp√©rience Moral Machine</a></li>
<li><a href="../fr427749/index.html">Apple et Samsung pour la premi√®re fois condamn√©s √† une amende pour avoir ralenti de vieux t√©l√©phones</a></li>
<li><a href="../fr427751/index.html">CudaText Sublime Ideas</a></li>
<li><a href="../fr427755/index.html">Nouvelle version de GitLab 11.4 avec examen par les pairs des demandes de fusion et des indicateurs de fonctionnalit√©</a></li>
<li><a href="../fr427759/index.html">A propos de la solvabilit√© des probl√®mes de ceinture de circulation en temps polynomial</a></li>
<li><a href="../fr427761/index.html">Impl√©mentation de l'algorithme k-means (k-means) en utilisant l'exemple du travail avec les pixels</a></li>
<li><a href="../fr427763/index.html">Cours MIT "S√©curit√© des syst√®mes informatiques". Conf√©rence 13: Protocoles r√©seau, partie 1</a></li>
<li><a href="../fr427767/index.html">Situation: au Canada, ils ont propos√© d'introduire une taxe sur le streaming - nous discutons du probl√®me</a></li>
<li><a href="../fr427771/index.html">Cours MIT "S√©curit√© des syst√®mes informatiques". Conf√©rence 13: Network Protocols, Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>