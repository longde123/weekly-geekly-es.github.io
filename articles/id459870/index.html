<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💽 🎅🏼 👼 Contoh arsitektur Model-View-Update dalam F # 👨‍💻 🐺 🕵🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Seseorang tidak suka Redux dalam Bereaksi karena penerapannya pada JS? 


 Saya tidak suka sakelar sakelar yang kikuk di reduksi, ada bahasa dengan pe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Contoh arsitektur Model-View-Update dalam F #</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459870/"><p>  Seseorang tidak suka Redux dalam Bereaksi karena penerapannya pada JS? </p><br><p>  Saya tidak suka sakelar sakelar yang kikuk di reduksi, ada bahasa dengan pencocokan pola yang lebih nyaman, dan mengetik acara dan model model yang lebih baik.  Misalnya, F #. <br>  Artikel ini adalah penjelasan tentang perangkat olahpesan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Elmish</a> . </p><a name="habracut"></a><br><p>  Saya akan memberikan contoh aplikasi konsol yang ditulis pada arsitektur ini, akan jelas pada contohnya bagaimana menggunakan pendekatan ini, dan kemudian kita akan memahami arsitektur Elmish. </p><br><p>  Saya menulis aplikasi konsol sederhana untuk membaca puisi, di seed ada beberapa puisi, satu untuk setiap penulis, yang ditampilkan di konsol. </p><br><p> Jendela hanya berisi 4 baris teks, Anda dapat menggulir puisi dengan menekan tombol "Atas" dan "Turun", tombol numerik mengubah warna teks, dan tombol kiri dan kanan memungkinkan Anda menavigasi riwayat tindakan, misalnya, pengguna membaca puisi Pushkin, beralih ke puisi Yesenin, diubah ke puisi Yesenin, diubah warna teks, dan kemudian berpikir bahwa warnanya tidak terlalu bagus dan Yesenin tidak menyukainya, klik dua kali pada panah kiri dan kembali ke tempat di mana ia selesai membaca Pushkin. </p><br><p>  Mukjizat ini terlihat seperti ini: </p><br><p><img src="https://habrastorage.org/webt/3h/2j/lh/3h2jlh-zewzgiozosfdxax-re4m.png"></p><br><p>  Pertimbangkan implementasinya. </p><br><p>  Jika Anda memikirkan semua opsi, jelas bahwa semua yang dapat dilakukan pengguna adalah menekan tombol, dengan menekannya, Anda dapat menentukan apa yang diinginkan pengguna, dan ia dapat berharap: </p><br><ol><li>  Ubah penulis </li><li>  Ubah warna </li><li>  Gulir (atas / bawah) </li><li>  Pergi ke versi sebelumnya / berikutnya </li></ol><br><p>  Karena pengguna harus dapat kembali ke versi kembali, Anda harus memperbaiki tindakannya dan <strong>mengingat modelnya</strong> , sebagai akibatnya, semua pesan yang mungkin dijelaskan sebagai berikut: </p><br><pre><code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Msg</span></span></span><span class="hljs-class"> = | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ConsoleEvent</span></span></span><span class="hljs-class"> of </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ConsoleKey</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ChangeAuthor</span></span></span><span class="hljs-class"> of </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Author</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ChangeColor</span></span></span><span class="hljs-class"> of </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ConsoleColor</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ChangePosition</span></span></span><span class="hljs-class"> of </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ChangePosition</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ChangeVersion</span></span></span><span class="hljs-class"> of </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ChangeVersion</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RememberModel</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WaitUserAction</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Exit</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ChangeVersion</span></span></span><span class="hljs-class"> = | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Back</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Forward</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ChangePosition</span></span></span><span class="hljs-class"> = | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Up</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Down</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Author</span></span></span><span class="hljs-class"> = | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Pushkin</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Lermontov</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Blok</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Esenin</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Poem</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Poem</span></span></span><span class="hljs-class"> of string</span></span></code> </pre> <br><p>  Dalam model, Anda perlu menyimpan informasi tentang teks yang sekarang ada di konsol, riwayat tindakan pengguna dan jumlah tindakan yang akan diputar pengguna untuk mengetahui model mana yang akan ditampilkan. </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span><span class="hljs-class"> = { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">viewTextInfo</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ViewTextInfo</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">countVersionBack</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">history</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ViewTextInfo</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class"> } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ViewTextInfo</span></span></span><span class="hljs-class"> = { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">formatText</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">countLines</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">positionY</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">color</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ConsoleColor</span></span></span><span class="hljs-class"> }</span></span></code> </pre> <br><p>  Arsitektur Elmish - model-view-update, model sudah dipertimbangkan, mari kita lanjutkan untuk melihat: </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> <span class="hljs-type"><span class="hljs-type">SnowAndUserActionView</span></span> (model: <span class="hljs-type"><span class="hljs-type">Model</span></span>) (dispatch: <span class="hljs-type"><span class="hljs-type">Msg</span></span> -&gt; unit) = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> { formatText = ft; color = clr } = model.viewTextInfo; clearConsoleAndPrintTextWithColor ft clr <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> key = <span class="hljs-type"><span class="hljs-type">Console</span></span>.<span class="hljs-type"><span class="hljs-type">ReadKey</span></span>().<span class="hljs-type"><span class="hljs-type">Key</span></span>; <span class="hljs-type"><span class="hljs-type">Msg</span></span>.<span class="hljs-type"><span class="hljs-type">ConsoleEvent</span></span> key |&gt; dispatch <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> clearConsoleAndPrintTextWithColor (text: string) (color: <span class="hljs-type"><span class="hljs-type">ConsoleColor</span></span>) = <span class="hljs-type"><span class="hljs-type">Console</span></span>.<span class="hljs-type"><span class="hljs-type">Clear</span></span>(); <span class="hljs-type"><span class="hljs-type">Console</span></span>.<span class="hljs-type"><span class="hljs-type">WriteLine</span></span>() <span class="hljs-type"><span class="hljs-type">Console</span></span>.<span class="hljs-type"><span class="hljs-type">ForegroundColor</span></span> &lt;- color <span class="hljs-type"><span class="hljs-type">Console</span></span>.<span class="hljs-type"><span class="hljs-type">WriteLine</span></span>(text)</code> </pre> <br><p>  Ini adalah salah satu pandangan, ini dibuat berdasarkan <em>viewTextInfo</em> , menunggu reaksi pengguna, dan mengirimkan pesan ini ke fungsi <em>pembaruan</em> . <br>  Nanti kita akan memeriksa secara rinci apa yang sebenarnya terjadi ketika <em>pengiriman</em> dipanggil, dan apa fungsinya. </p><br><p>  <em>Perbarui</em> : </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> update (msg: <span class="hljs-type"><span class="hljs-type">Msg</span></span>) (model: <span class="hljs-type"><span class="hljs-type">Model</span></span>) = match msg with | <span class="hljs-type"><span class="hljs-type">ConsoleEvent</span></span> key -&gt; model, updateConsoleEvent key | <span class="hljs-type"><span class="hljs-type">ChangeAuthor</span></span> author -&gt; updateChangeAuthor model author | <span class="hljs-type"><span class="hljs-type">ChangeColor</span></span> color -&gt; updateChangeColor model color | <span class="hljs-type"><span class="hljs-type">ChangePosition</span></span> position -&gt; updateChangePosition model position | <span class="hljs-type"><span class="hljs-type">ChangeVersion</span></span> version -&gt; updateChangeVersion model version | <span class="hljs-type"><span class="hljs-type">RememberModel</span></span> -&gt; updateAddEvent model | <span class="hljs-type"><span class="hljs-type">WaitUserAction</span></span> -&gt; model, []</code> </pre> <br><p>  Bergantung pada jenis <em>pesan, ia</em> memilih fungsi mana yang akan memproses pesan. </p><br><p>  Ini adalah <em>pembaruan</em> pada tindakan pengguna, memetakan tombol ke pesan, kasus terakhir - mengembalikan acara <em>WaitUserAction</em> - mengabaikan klik dan menunggu tindakan pengguna lebih lanjut. </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> updateConsoleEvent (key: <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> msg = match key with | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">D1</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeColor</span></span> <span class="hljs-type"><span class="hljs-type">ConsoleColor</span></span>.<span class="hljs-type"><span class="hljs-type">Red</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">D2</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeColor</span></span> <span class="hljs-type"><span class="hljs-type">ConsoleColor</span></span>.<span class="hljs-type"><span class="hljs-type">Green</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">D3</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeColor</span></span> <span class="hljs-type"><span class="hljs-type">ConsoleColor</span></span>.<span class="hljs-type"><span class="hljs-type">Blue</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">D4</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeColor</span></span> <span class="hljs-type"><span class="hljs-type">ConsoleColor</span></span>.<span class="hljs-type"><span class="hljs-type">Black</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">D5</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeColor</span></span> <span class="hljs-type"><span class="hljs-type">ConsoleColor</span></span>.<span class="hljs-type"><span class="hljs-type">Cyan</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">LeftArrow</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeVersion</span></span> <span class="hljs-type"><span class="hljs-type">Back</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">RightArrow</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeVersion</span></span> <span class="hljs-type"><span class="hljs-type">Forward</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">P</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeAuthor</span></span> <span class="hljs-type"><span class="hljs-type">Author</span></span>.<span class="hljs-type"><span class="hljs-type">Pushkin</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">E</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeAuthor</span></span> <span class="hljs-type"><span class="hljs-type">Author</span></span>.<span class="hljs-type"><span class="hljs-type">Esenin</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeAuthor</span></span> <span class="hljs-type"><span class="hljs-type">Author</span></span>.<span class="hljs-type"><span class="hljs-type">Blok</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">L</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeAuthor</span></span> <span class="hljs-type"><span class="hljs-type">Author</span></span>.<span class="hljs-type"><span class="hljs-type">Lermontov</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">UpArrow</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangePosition</span></span> <span class="hljs-type"><span class="hljs-type">Up</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">DownArrow</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangePosition</span></span> <span class="hljs-type"><span class="hljs-type">Down</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">X</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Exit</span></span> | _ -&gt; <span class="hljs-type"><span class="hljs-type">WaitUserAction</span></span> msg |&gt; <span class="hljs-type"><span class="hljs-type">Cmd</span></span>.ofMsg</code> </pre> <br><p>  Kami mengubah penulis, perhatikan bahwa <em>countVersionBack</em> segera diatur ulang ke 0, yang berarti bahwa jika pengguna memutar kembali kisahnya dan kemudian ingin mengubah warnanya, tindakan ini akan diperlakukan sebagai baru dan akan ditambahkan ke <em>riwayat</em> . </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> updateChangeAuthor (model: <span class="hljs-type"><span class="hljs-type">Model</span></span>) (author: <span class="hljs-type"><span class="hljs-type">Author</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> (<span class="hljs-type"><span class="hljs-type">Poem</span></span> updatedText) = seed.[author] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> updatedFormatText = getlines updatedText <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> updatedCountLines = (splitStr updatedText).<span class="hljs-type"><span class="hljs-type">Length</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> updatedViewTextInfo = {model.viewTextInfo with text = updatedText; formatText = updatedFormatText; countLines = updatedCountLines } { model with viewTextInfo = updatedViewTextInfo; countVersionBack = <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-type"><span class="hljs-type">Cmd</span></span>.ofMsg <span class="hljs-type"><span class="hljs-type">RememberModel</span></span></code> </pre><br><p>  Kami juga mengirim pesan <em>RememberModel</em> , pawang yang memperbarui <em>sejarah</em> , menambahkan model saat ini. </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> updateModelHistory model = { model with history = model.history @ [ model.viewTextInfo ] }, <span class="hljs-type"><span class="hljs-type">Cmd</span></span>.ofMsg <span class="hljs-type"><span class="hljs-type">WaitUserAction</span></span></code> </pre> <br><p>  Sisa dari <em>pembaruan</em> dapat dilihat di <a href="">sini</a> , mereka mirip dengan yang dipertimbangkan. </p><br><p>  Untuk menguji kinerja program, saya akan memberikan tes untuk beberapa skenario: </p><br><div class="spoiler">  <b class="spoiler_title">Tes</b> <div class="spoiler_text"><p>  <em>Metode</em> jalankan <em>mengambil struktur di mana daftar</em> Pesan <em>disimpan</em> <em>dan mengembalikan model setelah mereka diproses.</em> </p><br><pre> <code class="haskell hljs">[&lt;<span class="hljs-type"><span class="hljs-type">Property</span></span>(<span class="hljs-type"><span class="hljs-type">Verbose</span></span>=true)&gt;] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> ``    `` (authors: <span class="hljs-type"><span class="hljs-type">Author</span></span> list) = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> state = (createProgram (authors |&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>.map <span class="hljs-type"><span class="hljs-type">ChangeAuthor</span></span>) |&gt; run) match (authors |&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>.tryLast) with | <span class="hljs-type"><span class="hljs-type">Some</span></span> s -&gt; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> (<span class="hljs-type"><span class="hljs-type">Poem</span></span> text) = seed.[s] state.viewTextInfo.text = text | <span class="hljs-type"><span class="hljs-type">None</span></span> -&gt; true [&lt;<span class="hljs-type"><span class="hljs-type">Property</span></span>(<span class="hljs-type"><span class="hljs-type">Verbose</span></span>=true)&gt;] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> ``    `` changeColorMsg = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> state = (createProgram (changeColorMsg|&gt;<span class="hljs-type"><span class="hljs-type">List</span></span>.map <span class="hljs-type"><span class="hljs-type">ChangeColor</span></span>)|&gt; run) match (changeColorMsg |&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>.tryLast) with | <span class="hljs-type"><span class="hljs-type">Some</span></span> s -&gt; state.viewTextInfo.color = s | <span class="hljs-type"><span class="hljs-type">None</span></span> -&gt; true [&lt;<span class="hljs-type"><span class="hljs-type">Property</span></span>(<span class="hljs-type"><span class="hljs-type">Verbose</span></span>=true,<span class="hljs-type"><span class="hljs-type">Arbitrary</span></span>=[|typeof&lt;<span class="hljs-type"><span class="hljs-type">ChangeColorAuthorPosition</span></span>&gt;|])&gt;] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> ``        `` msgs = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> tryLastSomeList list = list |&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>.filter (<span class="hljs-type"><span class="hljs-type">Option</span></span>.isSome) |&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>.map (<span class="hljs-type"><span class="hljs-type">Option</span></span>.get) |&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>.tryLast <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> lastAuthor = msgs |&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>.map (fun x -&gt; match x with | <span class="hljs-type"><span class="hljs-type">ChangeAuthor</span></span> a -&gt; <span class="hljs-type"><span class="hljs-type">Some</span></span> a | _ -&gt; <span class="hljs-type"><span class="hljs-type">None</span></span>) |&gt; tryLastSomeList <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> lastColor = msgs |&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>.map (fun x -&gt; match x with | <span class="hljs-type"><span class="hljs-type">ChangeColor</span></span> a -&gt; <span class="hljs-type"><span class="hljs-type">Some</span></span> a | _ -&gt; <span class="hljs-type"><span class="hljs-type">None</span></span>) |&gt; tryLastSomeList <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> state = (createProgram msgs |&gt; run) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> colorTest = match lastColor with | <span class="hljs-type"><span class="hljs-type">Some</span></span> s -&gt; state.viewTextInfo.color = s | <span class="hljs-type"><span class="hljs-type">None</span></span> -&gt; true <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> authorTest = match lastAuthor with | <span class="hljs-type"><span class="hljs-type">Some</span></span> s -&gt; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> (<span class="hljs-type"><span class="hljs-type">Poem</span></span> t) = seed.[s]; state.viewTextInfo.text = t | <span class="hljs-type"><span class="hljs-type">None</span></span> -&gt; true authorTest &amp;&amp; colorTest</code> </pre></div></div><br><p>  Untuk ini, perpustakaan FsCheck digunakan, yang menyediakan kemampuan untuk menghasilkan data. </p><br><p>  Sekarang pertimbangkan inti dari program ini, kode dalam Elmish ditulis untuk semua kesempatan, saya menyederhanakannya ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kode asli)</a> : </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dispatch</span></span></span><span class="hljs-class">&lt;'msg&gt; = 'msg -&gt; unit </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Sub</span></span></span><span class="hljs-class">&lt;'msg&gt; = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dispatch</span></span></span><span class="hljs-class">&lt;'msg&gt; -&gt; unit </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Cmd</span></span></span><span class="hljs-class">&lt;'msg&gt; = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Sub</span></span></span><span class="hljs-class">&lt;'msg&gt; list </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Program</span></span></span><span class="hljs-class">&lt;'model, 'msg, 'view&gt; = { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">init</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">unit</span></span></span><span class="hljs-class"> -&gt;'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class"> * </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Cmd</span></span></span><span class="hljs-class">&lt;'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">update</span></span></span><span class="hljs-class">: '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class"> -&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class"> -&gt; ('</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class"> * </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Cmd</span></span></span><span class="hljs-class">&lt;'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class">&gt;) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">setState</span></span></span><span class="hljs-class">: '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class"> -&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dispatch</span></span></span><span class="hljs-class">&lt;'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class">&gt; -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">unit</span></span></span><span class="hljs-class"> } let runWith&lt;'arg, 'model, 'msg, 'view&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">program</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Program</span></span></span><span class="hljs-class">&lt;'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">, '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class">, '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">view</span></span></span><span class="hljs-class">&gt;) = let (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initModel</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initCmd</span></span></span><span class="hljs-class">) = program.init() //1 let mutable state = initModel //2 let mutable reentered = false //3 let buffer = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RingBuffer</span></span></span><span class="hljs-class"> 10 //4 let rec dispatch msg = let mutable nextMsg = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Some</span></span></span><span class="hljs-class"> msg; //5 if reentered //6 then buffer.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Push</span></span></span><span class="hljs-class"> msg //7 else while </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Option</span></span></span><span class="hljs-class">.isSome nextMsg do // 8 reentered &lt;- true // 9 let (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">) = program.update nextMsg.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Value</span></span></span><span class="hljs-class"> state // 9 program.setState model nextMsg.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Value</span></span></span><span class="hljs-class"> dispatch // 10 </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Cmd</span></span></span><span class="hljs-class">.exec dispatch cmd |&gt; ignore //11 state &lt;- model; // 12 nextMsg &lt;- buffer.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Pop</span></span></span><span class="hljs-class">() // 13 reentered &lt;- false; // 14 </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Cmd</span></span></span><span class="hljs-class">.exec dispatch initCmd |&gt; ignore // 15 state //16 let run program = runWith program</span></span></code> </pre> <br><p>  Jenis <em>Dispath &lt;'msg&gt; adalah</em> pengiriman yang digunakan dalam <em>tampilan</em> , dibutuhkan <em>pesan</em> dan <em>unit</em> pengembalian <br>  <em>Sub &lt;'msg&gt;</em> - fungsi pelanggan, menerima <em>unit</em> <em>pengiriman</em> dan pengembalian, kami <em>menelurkan</em> daftar <em>Sub</em> ketika kami menggunakanMsg: </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> ofMsg&lt;'msg&gt; (msg: 'msg): <span class="hljs-type"><span class="hljs-type">Cmd</span></span>&lt;'msg&gt; = [ fun (dispatch: <span class="hljs-type"><span class="hljs-type">Dispatch</span></span>&lt;'msg&gt;) -&gt; dispatch msg ]</code> </pre> <br><p>  Setelah memanggil <em>ofMsg</em> , seperti <em>Cmd.ofMsg RememberModel</em> di akhir metode <em>updateChangeAuthor</em> , setelah beberapa saat pelanggan dipanggil dan pesan masuk ke metode <em>pembaruan</em> <br>  <em>Cmd &lt;'msg&gt;</em> - <em>Sub</em> Sheet <em>&lt;' msg&gt;</em> </p><br><p>  Mari kita beralih ke tipe <em>Program</em> , ini adalah tipe generik, dibutuhkan tipe model, pesan dan <em>tampilan</em> , dalam aplikasi konsol tidak perlu mengembalikan sesuatu dari <em>tampilan</em> , tetapi dalam Elmish. Bereaksi tampilan mengembalikan struktur F # dari pohon DOM. </p><br><p>  Bidang init - dipanggil pada awal elmish, fungsi ini mengembalikan model awal dan pesan pertama, dalam kasus saya, saya mengembalikan <em>Cmd.ofMsg RememberModel</em> <br>  <em>Pembaruan</em> adalah fungsi utama <em>pembaruan</em> , Anda sudah terbiasa dengannya. </p><br><p>  <em>SetState</em> - di Elmish standar, ia hanya menerima model dan <em>tampilan</em> <em>pengiriman</em> dan panggilan, tetapi saya harus meneruskan pesan untuk mengganti <em>tampilan</em> tergantung pada pesan, saya akan menunjukkan implementasinya setelah kami mempertimbangkan pengiriman pesan. </p><br><p>  Fungsi <em>runWith</em> menerima konfigurasi, kemudian memanggil <em>init</em> , model dan pesan pertama dikembalikan, pada baris 2,3 dua objek yang dapat diubah dideklarasikan, yang pertama - di mana <em>keadaan</em> akan disimpan, yang kedua diperlukan oleh fungsi <em>pengiriman</em> . </p><br><p>  Pada baris ke-4, <em>buffer</em> dinyatakan - Anda dapat mengambilnya sebagai antrian, yang pertama datang - yang pertama keluar (sebenarnya, implementasi <em>RingBuffer</em> sangat menarik, saya mengambilnya dari perpustakaan, saya menyarankan Anda untuk membacanya di <a href="">github</a> ) </p><br><p>  Selanjutnya datang fungsi <em>pengiriman</em> rekursif itu sendiri, yang sama yang disebut dalam <em>tampilan</em> , ketika kita pertama kali memanggil, kita memotong <em>jika jika</em> pada saluran 6 dan segera masuk ke loop, atur <em>reented</em> ke <em>true</em> sehingga panggilan rekursif berikutnya tidak kembali ke loop ini, tetapi tambahkan pesan baru di <em>buffer</em> . </p><br><p>  Pada baris 9, kami menjalankan metode <em>pembaruan</em> , dari mana kami mengambil model yang diubah dan pesan baru (untuk pertama kalinya ini adalah pesan <em>RememberModel</em> ) <br>  <em>Baris</em> 10 menggambarkan model, metode <em>SetState</em> terlihat seperti ini: </p><br><p><img src="https://habrastorage.org/webt/3v/2c/3l/3v2c3li4ffe4paffy46f98nadle.png"></p><br><p>  Seperti yang Anda lihat, posting berbeda menyebabkan <em>tampilan</em> berbeda <br>  Ini adalah ukuran yang diperlukan untuk tidak memblokir aliran, karena memanggil <em>Konsol. ReadLine</em> memblokir aliran program, dan peristiwa seperti <em>RememberModel, ChangeColor</em> (yang dipicu di dalam program, bukan oleh pengguna) akan menunggu setiap kali sampai pengguna mengklik tombol, meskipun mereka hanya perlu mengubah warna. </p><br><p>  Untuk pertama kalinya, fungsi <em>OnlyShowView</em> akan dipanggil, yang hanya akan menggambar model. <br>  Jika pesan <em>WaitUserAction</em> datang ke metode alih-alih RememberModel, fungsi <em>ShowAndUserActionView</em> akan <em>dipanggil</em> , yang akan <em>menggambar</em> model dan memblokir aliran, menunggu tombol untuk ditekan, segera setelah tombol ditekan, metode <em>pengiriman</em> akan dipanggil lagi dan pesan akan dikirim ke <em>buffer</em> (karena <em>reenvited</em> = <em>false</em> ) </p><br><p>  Selanjutnya, Anda perlu memproses semua pesan yang datang dari metode <em>pembaruan</em> , jika tidak kita akan kehilangan mereka, panggilan rekursif hanya akan masuk ke loop jika <em>reents</em> menjadi false.  Baris 11 terlihat rumit, tetapi sebenarnya itu hanya dorongan dari semua pesan di <em>buffer</em> : </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> exec&lt;'msg&gt; (dispatch: <span class="hljs-type"><span class="hljs-type">Dispatch</span></span>&lt;'msg&gt;) (cmd: <span class="hljs-type"><span class="hljs-type">Cmd</span></span>&lt;'msg&gt;) = cmd |&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>.map (fun sub -&gt; sub dispatch)</code> </pre> <br><p>  Untuk semua pelanggan yang dikembalikan oleh metode <em>pembaruan</em> , <em>pengiriman</em> akan dipanggil, sehingga menambahkan pesan ini ke <em>buffer</em> . </p><br><p>  Pada baris 12 kami memperbarui model, mendapatkan pesan baru dan kembali ke false ketika <em>buffer</em> tidak kosong itu tidak perlu, tetapi jika tidak ada elemen yang tersisa dan <em>pengiriman</em> hanya dapat dipanggil dari <em>tampilan</em> , ini masuk akal.  Sekali lagi, dalam kasus kami, ketika semuanya sinkron, ini tidak masuk akal, karena kami mengharapkan panggilan pengiriman sinkron pada saluran 10, tetapi jika ada panggilan tidak sinkron dalam kode, <em>pengiriman</em> dapat dipanggil dari panggilan balik dan Anda harus dapat melanjutkan program. </p><br><p>  Nah, itulah keseluruhan deskripsi fungsi <em>pengiriman</em> , pada saluran 15 disebut dan <em>status</em> dikembalikan pada saluran 16. </p><br><p>  Dalam aplikasi konsol, keluar terjadi ketika <em>buffer</em> menjadi kosong.  Di versi asli, <em>runWith</em> tidak <em>mengembalikan</em> apa-apa, tetapi pengujian tidak mungkin tanpa ini. </p><br><p>  <em>Program</em> untuk pengujian berbeda, fungsi <em>createProgram</em> menerima daftar pesan yang akan diinisiasi pengguna dan di <em>SetState</em> mereka mengganti klik yang biasa: <br><img src="https://habrastorage.org/webt/jc/tz/4u/jctz4uefscbzhubowwwfa9zltr8.png"></p><br><p>  Perbedaan lain antara versi saya yang berubah dan yang asli adalah bahwa fungsi pembaruan disebut pertama, dan kemudian hanya <em>setState</em> , dalam versi asli, sebaliknya, rendering pertama dan kemudian pemrosesan pesan, saya harus melakukan ini karena panggilan pemblokiran ke <em>Console.ReadKey</em> (perlu mengubah <em>lihat</em> ) </p><br><p>  Saya harap saya berhasil menjelaskan bagaimana Elmish dan sistem serupa bekerja, cukup banyak fungsi Elmish tertinggal, jika Anda tertarik dengan topik ini, saya menyarankan Anda untuk melihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">situs web</a> mereka. </p><br><p>  Terima kasih atas perhatian anda! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id459870/">https://habr.com/ru/post/id459870/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id459852/index.html">Praktek menggunakan perpustakaan lottie di aplikasi seluler bank</a></li>
<li><a href="../id459858/index.html">Menjelajahi Modern Malware Cerberus untuk Android</a></li>
<li><a href="../id459860/index.html">Mengkonfigurasi ClickHouse untuk pengujian integrasi di gitlab-ci</a></li>
<li><a href="../id459862/index.html">Antarmuka Berkeley DB STL</a></li>
<li><a href="../id459866/index.html">Pemecahan masalah dengan pwnable.kr 02 - collision. Tabrakan Hash</a></li>
<li><a href="../id459872/index.html">Patton Jeff. Cerita khusus. Seni pengembangan perangkat lunak tangkas</a></li>
<li><a href="../id459874/index.html">Anda memiliki sesuatu yang disembunyikan</a></li>
<li><a href="../id459878/index.html">7 tips pengoptimalan CSS untuk mempercepat pemuatan halaman</a></li>
<li><a href="../id459880/index.html">Konfigurasikan Firefox di Linux</a></li>
<li><a href="../id459882/index.html">Musik "secara default": trek apa yang dapat ditemukan di pemutar dan komputer pribadi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>