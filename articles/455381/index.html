<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø üßòüèæ ü§úüèΩ El soporte t√©cnico de 3CX responde: captura el tr√°fico SIP en el servidor PBX üöá ü§¶ üå¨Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este art√≠culo, hablaremos sobre los conceptos b√°sicos de capturar y analizar el tr√°fico SIP generado por las PBX 3CX. El art√≠culo est√° dirigido a a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>El soporte t√©cnico de 3CX responde: captura el tr√°fico SIP en el servidor PBX</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/3cx/blog/455381/">  En este art√≠culo, hablaremos sobre los conceptos b√°sicos de capturar y analizar el tr√°fico SIP generado por las PBX 3CX.  El art√≠culo est√° dirigido a administradores de sistemas novatos o usuarios comunes cuyas responsabilidades incluyen el mantenimiento de la telefon√≠a.  Para un estudio en profundidad del tema, le recomendamos que complete el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">curso de capacitaci√≥n avanzada 3CX</a> . <br><br>  3CX V16 le permite capturar tr√°fico SIP directamente a trav√©s de la interfaz web del servidor y guardarlo en el formato est√°ndar Wireshark PCAP.  Puede adjuntar el archivo de captura al contactar con el soporte t√©cnico o descargarlo para autoan√°lisis. <a name="habracut"></a><br><br>  Si 3CX se ejecuta en Windows, debe instalar Wireshark en el servidor 3CX usted mismo.  De lo contrario, cuando intente capturar, aparecer√° el siguiente mensaje. <br><img src="https://habrastorage.org/getpro/habr/post_images/170/ed9/40b/170ed940b2159d489164e56fd1ed5d61.png"><br><br>  En los sistemas Linux, tcpdump se instala autom√°ticamente cuando instala o actualiza 3CX. <br><br><h2>  Captura de tr√°fico </h2><br>  Para comenzar a capturar, vaya a la secci√≥n de la interfaz Inicio&gt; Eventos SIP y seleccione la interfaz en la que desea capturar.  Tambi√©n puede capturar tr√°fico en todas las interfaces simult√°neamente, excepto las interfaces de t√∫nel IPv6. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3be/f3b/1b7/3bef3b1b7e78206b60788a3f593a07bc.png"><br><br>  En 3CX para Linux, puede capturar el tr√°fico para el host local (lo).  Esta captura se utiliza para analizar conexiones de clientes SIP utilizando la tecnolog√≠a de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">t√∫nel 3CX y el controlador de borde de sesi√≥n</a> . <br><br>  El bot√≥n Traffic Capture inicia Wireshark en Windows o tcpdump en Linux.  En este punto, debe reproducir r√°pidamente el problema, porque  Capture carga el procesador y ocupa suficiente espacio en disco. <br><img src="https://habrastorage.org/getpro/habr/post_images/1c3/b4e/dba/1c3b4edba3ec938ba5eec5b7d13667a1.png"><br><br>  Preste atenci√≥n a los siguientes par√°metros de llamada: <br><br><ul><li>  El n√∫mero que se llam√≥, que fue llamado por otros n√∫meros / participantes de la llamada. <br></li><li>  La hora exacta en que ocurri√≥ el problema en el reloj del servidor 3CX. <br></li><li>  La ruta de la llamada. <br></li></ul><br>  Intente no hacer clic en otros lugares de la interfaz, excepto el bot√≥n "Detener".  Tampoco haga clic en otros enlaces en esta ventana del navegador.  De lo contrario, la captura de tr√°fico continuar√° en segundo plano y generar√° una carga adicional en el servidor. <br><br><h2>  Obteniendo archivo de captura </h2><br>  El bot√≥n Detener detiene la captura y guarda el archivo de captura.  Puede descargar el archivo a su computadora para analizarlo en la utilidad Wireshark o generar un archivo especial de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">soporte t√©cnico</a> que incluir√° esta captura y otra informaci√≥n de depuraci√≥n.  Despu√©s de la descarga o inclusi√≥n en el paquete de soporte t√©cnico, el archivo de captura se elimina autom√°ticamente del servidor 3CX por razones de seguridad. <br><br>  En el servidor 3CX, el archivo se encuentra en la siguiente ubicaci√≥n: <br><br><ul><li>  Windows: C: \ ProgramData \ 3CX \ Instance1 \ Data \ Logs \ dump.pcap <br></li><li>  Linux: /var/lib/3cxpbx/Instance/Data/Logs/dump.pcap <br></li></ul><br>  Para evitar una mayor carga del servidor o p√©rdida de paquetes durante la captura, el per√≠odo de captura se limita a 2 millones de paquetes.  Despu√©s de eso, la captura se detiene autom√°ticamente.  Si necesita una captura m√°s larga, use la utilidad Wireshark separada, como se describe a continuaci√≥n. <br><br><h2>  Captura de tr√°fico de Wireshark </h2><br>  Si est√° interesado en un an√°lisis m√°s profundo del tr√°fico de red, capt√∫relo manualmente.  Descargue la utilidad Wireshark para su sistema operativo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">desde aqu√≠</a> .  Despu√©s de instalar la utilidad en el servidor 3CX, vaya a Captura&gt; Interfaces.  Todas las interfaces de red del sistema operativo se mostrar√°n aqu√≠.  Las direcciones IP de la interfaz se pueden mostrar en IPv6.  Para ver la direcci√≥n IPv4, haga clic en la direcci√≥n IPv6. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aa8/011/f70/aa8011f7006210f391cf07fea10dcdc9.png"><br><br>  Seleccione la interfaz para capturar y haga clic en el bot√≥n Opciones.  Desmarque Capturar tr√°fico en modo promiscuo y deje el resto de la configuraci√≥n sin cambios. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/14b/dc7/fbf/14bdc7fbfad0be3a6785e578c989f01c.png"><br><br>  Ahora deber√≠as reproducir el problema.  Cuando se reproduzca el problema, detenga la captura (men√∫ Captura&gt; Detener).  Puede seleccionar mensajes SIP en el men√∫ Telefon√≠a&gt; Flujos SIP. <br><br><h2>  Conceptos b√°sicos de an√°lisis de tr√°fico - Mensaje SIP INVITE </h2><br>  Considere los campos principales del mensaje INVITE SIP que se env√≠a para establecer una llamada VoIP, es decir  Es el punto de partida para el an√°lisis.  Por lo general, SIP INVITE incluye de 4 a 6 campos con informaci√≥n que utilizan los dispositivos terminales SIP (tel√©fonos, puertas de enlace) y operadores de telecomunicaciones.  Comprender el contenido de INVITE y los mensajes que le siguen a menudo ayuda a determinar la fuente del problema.  Adem√°s, conocer los campos INVITE ayuda al conectar operadores SIP a 3CX o al combinar 3CX con otros intercambios SIP. <br><br>  En un mensaje INVITE, los usuarios (o dispositivos SIP) se identifican por URI.  Por lo general, un URI SIP es el n√∫mero de tel√©fono del usuario + la direcci√≥n del servidor SIP.  SIP URI es muy similar a una direcci√≥n de correo electr√≥nico y est√° escrito como sip: x @ y: Port. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d9f/81a/c5a/d9f81ac5a0cc88303b7ea2178bf3212d.png"><br><br><h3>  Request-Line-URI: </h3><br>  Request-Line-URI: el campo contiene el destinatario de la llamada.  Contiene la misma informaci√≥n que en el campo Para, pero sin un Nombre para mostrar. <br><br><h3>  V√≠a: </h3><br>  V√≠a: cada servidor SIP (proxy) a trav√©s del cual pasa la solicitud INVITE, agrega en la parte superior de la lista V√≠a su direcci√≥n IP y el puerto al que se recibi√≥ el mensaje.  Luego, el mensaje se transmite m√°s a lo largo de la ruta.  Cuando el destinatario final responde la solicitud INVITE, todos los nodos de tr√°nsito "miran" el encabezado Via y devuelven un mensaje al remitente a lo largo de la misma ruta.  En este caso, el proxy de tr√°nsito SIP elimina sus datos del encabezado. <br><br><h3>  De: </h3><br>  Desde: el encabezado indica el iniciador de la solicitud desde el punto de vista del servidor SIP.  El encabezado se forma de la misma manera que una direcci√≥n de correo electr√≥nico (usuario @ dominio, donde usuario es el n√∫mero de extensi√≥n del usuario 3CX, y dominio es la direcci√≥n IP local o dominio SIP del servidor 3CX).  Al igual que el encabezado To, el encabezado From contiene un URI y, opcionalmente, un nombre de usuario de nombre para mostrar.  Desde el encabezado From, puede comprender exactamente c√≥mo se debe procesar esta solicitud SIP. <br><br>  El est√°ndar SIP RFC 3261 establece que si el Nombre para mostrar no se transmite, el tel√©fono IP o la puerta de enlace VoIP (UAC) deben usar el Nombre para mostrar "An√≥nimo", por ejemplo, De: "An√≥nimo" &lt;sip: 10000@10.172.0.2&gt;. <br><br><h3>  Para: </h3><br>  Para: este encabezado indica el destinatario de la solicitud.  Puede ser el destinatario final de la llamada o un enlace intermedio.  Normalmente, el encabezado contiene un URI SIP, pero son posibles otros esquemas (consulte RFC 2806 [9]).  Sin embargo, los URI de SIP deben ser compatibles con todas las implementaciones de SIP, independientemente del fabricante del equipo.  El encabezado Para tambi√©n puede contener un Nombre para mostrar Nombre para mostrar, por ejemplo, Para: ‚ÄúNombre Apellido‚Äù (sip: 101@10.172.0.2&gt;). <br><br>  Normalmente, el campo Para contiene un URI SIP que indica el primer (siguiente) proxy SIP que procesar√° la solicitud.  Este no tiene que ser el destinatario final de la solicitud. <br><br><h3>  Contacto: </h3><br>  Contacto: el encabezado contiene el URI de SIP, por el cual puede contactar al remitente de la solicitud INVITE.  Este es un encabezado obligatorio y debe contener solo un URI SIP.  Forma parte de una comunicaci√≥n bidireccional que corresponde a la solicitud SIP INVITE inicial.  Es muy importante que el encabezado del contacto contenga la informaci√≥n correcta (incluida la direcci√≥n IP) en la que el remitente de la solicitud est√° esperando una respuesta.  El contacto URI tambi√©n se usa en comunicaciones posteriores, despu√©s del establecimiento de una sesi√≥n de comunicaci√≥n. <br><br><h3>  Permitir: </h3><br>  Permitir: el campo contiene una lista de par√°metros (m√©todos SIP), separados por una coma.  Describen qu√© caracter√≠sticas del protocolo SIP admite este remitente (dispositivo).  Lista completa de m√©todos: ACK, BYE, CANCEL, INFO, INVITE, NOTIFY, OPTIONS, PRACK, REFER, REGISTRO, SUSCRIPCI√ìN, ACTUALIZACI√ìN.  Aqu√≠ se describen m√°s m√©todos SIP. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/455381/">https://habr.com/ru/post/455381/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../455371/index.html">Fuente de corriente estable de 5 ŒºA a 20 mA</a></li>
<li><a href="../455373/index.html">¬øC√≥mo ajustar la ley de Spring para que se convierta en un est√≠mulo para los peque√±os proveedores? Cancelarlo</a></li>
<li><a href="../455375/index.html">Escribiendo UDR en Pascal</a></li>
<li><a href="../455377/index.html">Arquitectura IoT</a></li>
<li><a href="../455379/index.html">(Est√°tica) Selecci√≥n de contenedores √≥ptimos en programas C ++</a></li>
<li><a href="../455387/index.html">Comprensi√≥n del aprendizaje autom√°tico en Elastic Stack (tambi√©n conocido como Elasticsearch, tambi√©n conocido como ELK)</a></li>
<li><a href="../455389/index.html">Haxe 4: ¬øQu√© hay de nuevo?</a></li>
<li><a href="../455391/index.html">Parte 1: RISC-V / RocketChip en un h√°bitat antinatural</a></li>
<li><a href="../455393/index.html">Sobre el uso de m√©todos param√©tricos de estimaci√≥n espectral en radar: el m√©todo MUSIC. Adici√≥n al art√≠culo.</a></li>
<li><a href="../455397/index.html">C√≥mo dise√±amos e implementamos la nueva red en Huawei en la oficina de Mosc√∫, parte 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>