<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯНб ЁЯНК ЁЯЪ╡ рдкрд╛рдпрдерди + рдХреЗрд░рд╕ + LSTM: рдЖрдзреЗ рдШрдВрдЯреЗ рдореЗрдВ рдПрдХ рдкрд╛рда рдЕрдиреБрд╡рд╛рджрдХ рдХрд░реЗрдВ ЁЯСитАНЁЯСйтАНЁЯСзтАНЁЯСж ЁЯдР ЁЯСм</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╣рд╛рдп, рд╣реИрдмреНрд░ред 

 рдкрд┐рдЫрд▓реЗ рднрд╛рдЧ рдореЗрдВ, рдореИрдВрдиреЗ рдПрдХ рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдкрд╛рда рдкрд╣рдЪрд╛рди рдмрдирд╛рдиреЗ рдкрд░ рдзреНрдпрд╛рди рджрд┐рдпрд╛ред рдЖрдЬ рд╣рдо рдПрдХ рд╕рдорд╛рди рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ рдФрд░ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдкрд╛рдпрдерди + рдХреЗрд░рд╕ + LSTM: рдЖрдзреЗ рдШрдВрдЯреЗ рдореЗрдВ рдПрдХ рдкрд╛рда рдЕрдиреБрд╡рд╛рджрдХ рдХрд░реЗрдВ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470706/">  рд╣рд╛рдп, рд╣реИрдмреНрд░ред <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд┐рдЫрд▓реЗ рднрд╛рдЧ рдореЗрдВ,</a> рдореИрдВрдиреЗ рдПрдХ рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдкрд╛рда рдкрд╣рдЪрд╛рди рдмрдирд╛рдиреЗ рдкрд░ рдзреНрдпрд╛рди рджрд┐рдпрд╛ред  рдЖрдЬ рд╣рдо рдПрдХ рд╕рдорд╛рди рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ рдФрд░ рдЕрдВрдЧреНрд░реЗрдЬреА рд╕реЗ рдЬрд░реНрдорди рддрдХ рдЧреНрд░рдВрдереЛрдВ рдХрд╛ рдПрдХ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЕрдиреБрд╡рд╛рджрдХ рд▓рд┐рдЦреЗрдВрдЧреЗред <br><br><img src="https://habrastorage.org/webt/gf/ft/jx/gfftjxwflb7yxrwtffish1hkqsc.jpeg"><br><br>  рдЬреЛ рд▓реЛрдЧ рдЗрд╕ рдХрд╛рдо рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ, рдЙрдирдХреЗ рд▓рд┐рдП рд╡рд┐рд╡рд░рдг рдХрдЯреМрддреА рдХреЗ рдЕрдзреАрди рд╣реИред <br><a name="habracut"></a><br>  <i>рдиреЛрдЯ</i> : рдЕрдиреБрд╡рд╛рдж рдХреЗ рд▓рд┐рдП рдПрдХ рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдпрд╣ рдкрд░рд┐рдпреЛрдЬрдирд╛ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╢реИрдХреНрд╖рд┐рдХ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдкреНрд░рд╢реНрди "рдХреНрдпреЛрдВ" рдирд╣реАрдВ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕рд┐рд░реНрдл рдордиреЛрд░рдВрдЬрди рдХреЗ рд▓рд┐рдПред  рдореИрдВ рдпрд╣ рд╕рд╛рдмрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдирд╣реАрдВ рд╣реВрдВ рдХрд┐ рдпрд╣ рдпрд╛ рд╡рд╣ рддрд░реАрдХрд╛ рдмреЗрд╣рддрд░ рд╣реИ рдпрд╛ рдмрджрддрд░ рд╣реИ, рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рджрд┐рд▓рдЪрд╕реНрдк рдерд╛ рдХрд┐ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИред  рдиреАрдЪреЗ рджреА рдЧрдИ рд╡рд┐рдзрд┐, рдмреЗрд╢рдХ, рд╕рд░рд▓реАрдХреГрдд рд╣реИ, рд▓реЗрдХрд┐рди рдореБрдЭреЗ рдЖрд╢рд╛ рд╣реИ рдХрд┐ рдХреЛрдИ рднреА рдЙрдореНрдореАрдж рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рд╣рдо рдЖрдзреЗ рдШрдВрдЯреЗ рдореЗрдВ рджреВрд╕рд░рд╛ рд▓рд┐рдВрдЧреНрд╡реЛ рд▓рд┐рдЦреЗрдВрдЧреЗред <br><br><h2>  рдбреЗрдЯрд╛ рд╕рдВрдЧреНрд░рд╣ </h2><br>  рдЯреИрдм рджреНрд╡рд╛рд░рд╛ рдЕрд▓рдЧ рдХрд┐рдП рдЧрдП рдЕрдВрдЧреНрд░реЗрдЬреА рдФрд░ рдЬрд░реНрдорди рд╡рд╛рдХреНрдпрд╛рдВрд╢реЛрдВ рд╡рд╛рд▓реЗ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдорд┐рд▓реА рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реНрд░реЛрдд рдбреЗрдЯрд╛рд╕реЗрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рд╡рд╛рдХреНрдпрд╛рдВрд╢реЛрдВ рдХрд╛ рдПрдХ рд╕реЗрдЯ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ: <br><br><pre><code class="python hljs">Hi. Hallo! Hi. Gr├╝├Я Gott! Run! Lauf! Wow! Potzdonner! Wow! Donnerwetter! Fire! Feuer! Help! Hilfe! Help! Zu H├╝lf! Stop! Stopp! Wait! Warte! Go on. Mach weiter. Hello! Hallo! I ran. Ich rannte. I see. Ich verstehe. ...</code> </pre> <br>  рдлрд╝рд╛рдЗрд▓ рдореЗрдВ 192 рд╣рдЬрд╛рд░ рд▓рд╛рдЗрдиреЗрдВ рд╣реИрдВ рдФрд░ рдЗрд╕рдХрд╛ рдЖрдХрд╛рд░ 13 рдПрдордмреА рд╣реИред  рд╣рдо рдкрд╛рда рдХреЛ рдореЗрдореЛрд░реА рдореЗрдВ рд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдбреЗрдЯрд╛ рдХреЛ рдЕрдВрдЧреНрд░реЗрдЬреА рдФрд░ рдЬрд░реНрдорди рд╢рдмреНрджреЛрдВ рдХреЗ рд▓рд┐рдП рджреЛ рдмреНрд▓реЙрдХ рдореЗрдВ рддреЛрдбрд╝рддреЗ рд╣реИрдВред <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_text</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filename)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(filename, mode=<span class="hljs-string"><span class="hljs-string">'rt'</span></span>, encoding=<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> file: text = file.read() sents = text.strip().split(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [i.split(<span class="hljs-string"><span class="hljs-string">'\t'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sents] data = read_text(<span class="hljs-string"><span class="hljs-string">"deutch.txt"</span></span>) deu_eng = np.array(data) deu_eng = deu_eng[:<span class="hljs-number"><span class="hljs-number">30000</span></span>,:] print(<span class="hljs-string"><span class="hljs-string">"Dictionary size:"</span></span>, deu_eng.shape) <span class="hljs-comment"><span class="hljs-comment"># Remove punctuation deu_eng[:,0] = [s.translate(str.maketrans('', '', string.punctuation)) for s in deu_eng[:,0]] deu_eng[:,1] = [s.translate(str.maketrans('', '', string.punctuation)) for s in deu_eng[:,1]] # convert text to lowercase for i in range(len(deu_eng)): deu_eng[i,0] = deu_eng[i,0].lower() deu_eng[i,1] = deu_eng[i,1].lower()</span></span></code> </pre><br>  рд╣рдордиреЗ рд╡рд┐рд░рд╛рдо рдЪрд┐рд╣реНрди рдХреЛ рд╕рднреА рд╢рдмреНрджреЛрдВ рдореЗрдВ рдмрджрд▓ рджрд┐рдпрд╛ рдФрд░ рд╡рд┐рд░рд╛рдо рдЪрд┐рд╣реНрдиреЛрдВ рдХреЛ рд╣рдЯрд╛ рджрд┐рдпрд╛ред <br><br>  рдЕрдЧрд▓рд╛ рдХрджрдо рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рддреИрдпрд╛рд░ рдХрд░рдирд╛ рд╣реИред  рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рдкрддрд╛ рдирд╣реАрдВ рд╣реИ рдХрд┐ рд╢рдмреНрдж рдХреНрдпрд╛ рд╣реИрдВ, рдФрд░ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╕рдВрдЦреНрдпрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред  рд╕реМрднрд╛рдЧреНрдп рд╕реЗ рд╣рдорд╛рд░реЗ рд▓рд┐рдП, keras рдХреЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдЯреЛрдХрдирд░рд╛рдЗрдЬрд╝рд░ рд╡рд░реНрдЧ рд╣реИ, рдЬреЛ рд╢рдмреНрджреЛрдВ рдХреЛ рдбрд┐рдЬрд┐рдЯрд▓ рдХреЛрдб рдХреЗ рд╕рд╛рде рдмрджрд▓ рджреЗрддрд╛ рд╣реИред <br><br>  рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдмрд╕ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд╕рд╛рде рд╕рдЪрд┐рддреНрд░ рд╣реИ: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.preprocessing.text <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Tokenizer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.preprocessing.sequence <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pad_sequences s = <span class="hljs-string"><span class="hljs-string">"To be or not to be"</span></span> eng_tokenizer = Tokenizer() eng_tokenizer.fit_on_texts([s]) seq = eng_tokenizer.texts_to_sequences([s]) seq = pad_sequences(seq, maxlen=<span class="hljs-number"><span class="hljs-number">8</span></span>, padding=<span class="hljs-string"><span class="hljs-string">'post'</span></span>) print(seq)</code> </pre><br>  рд╡рд╛рдХреНрдпрд╛рдВрд╢ "рд╣реЛрдиреЗ рдпрд╛ рди рд╣реЛрдиреЗ" рдХреЛ рд╕рд░рдгреА [1 2 3 4 1 2 0 0] рд╕реЗ рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬрд╣рд╛рдВ рдЕрдиреБрдорд╛рди рд▓рдЧрд╛рдирд╛ рдореБрд╢реНрдХрд┐рд▓ рдирд╣реАрдВ рд╣реИ, 1 = рд╕реЗ, 2 = рд╣реЛрдирд╛, 3 = рдпрд╛, 4 = рдирд╣реАрдВред  рд╣рдо рдЗрди рдЖрдВрдХрдбрд╝реЛрдВ рдХреЛ рдкрд╣рд▓реЗ рд╣реА рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдЬрдорд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br><h2>  рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░рд╢рд┐рдХреНрд╖рдг </h2><br>  рд╣рдорд╛рд░рд╛ рдбреЗрдЯрд╛ рдбрд┐рдЬрд┐рдЯрд▓ рд░реВрдк рд╕реЗ рддреИрдпрд╛рд░ рд╣реИред  рд╣рдо рдЗрдирдкреБрдЯ (рдЕрдВрдЧреНрд░реЗрдЬреА рд▓рд╛рдЗрдиреЛрдВ) рдФрд░ рдЖрдЙрдЯрдкреБрдЯ (рдЬрд░реНрдорди рд▓рд╛рдЗрдиреЛрдВ) рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рд╕рд░рдгреА рдХреЛ рджреЛ рдмреНрд▓реЙрдХреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддреЗ рд╣реИрдВред  рд╣рдо рд╕реАрдЦрдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдорд╛рдиреНрдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рдЗрдХрд╛рдИ рднреА рддреИрдпрд╛рд░ рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># split data into train and test set train, test = train_test_split(deu_eng, test_size=0.2, random_state=12) # prepare training data trainX = encode_sequences(eng_tokenizer, eng_length, train[:, 0]) trainY = encode_sequences(deu_tokenizer, deu_length, train[:, 1]) # prepare validation data testX = encode_sequences(eng_tokenizer, eng_length, test[:, 0]) testY = encode_sequences(deu_tokenizer, deu_length, test[:, 1])</span></span></code> </pre><br>  рдЕрдм рд╣рдо рдПрдХ рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛ рдПрдХ рдореЙрдбрд▓ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕рдХрд╛ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ LSTM рдкрд░рддреЗрдВ рд╣реЛрддреА рд╣реИрдВ рдЬрд┐рдирдореЗрдВ рдореЗрдореЛрд░реА рд╕реЗрд▓реНрд╕ рд╣реЛрддреА рд╣реИрдВред  рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рд╕рдВрднрд╡рддрдГ "рдирд┐рдпрдорд┐рдд" рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдХрд╛рдо рдХрд░реЗрдЧрд╛, рдЬреЛ рд▓реЛрдЧ рдЕрдкрдиреА рдЗрдЪреНрдЫрд╛ рд╕реЗ рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_model</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(in_vocab, out_vocab, in_timesteps, out_timesteps, n)</span></span></span><span class="hljs-function">:</span></span> model = Sequential() model.add(Embedding(in_vocab, n, input_length=in_timesteps, mask_zero=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)) model.add(LSTM(n)) model.add(Dropout(<span class="hljs-number"><span class="hljs-number">0.3</span></span>)) model.add(RepeatVector(out_timesteps)) model.add(LSTM(n, return_sequences=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)) model.add(Dropout(<span class="hljs-number"><span class="hljs-number">0.3</span></span>)) model.add(Dense(out_vocab, activation=<span class="hljs-string"><span class="hljs-string">'softmax'</span></span>)) model.compile(optimizer=optimizers.RMSprop(lr=<span class="hljs-number"><span class="hljs-number">0.001</span></span>), loss=<span class="hljs-string"><span class="hljs-string">'sparse_categorical_crossentropy'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> model eng_vocab_size = len(eng_tokenizer.word_index) + <span class="hljs-number"><span class="hljs-number">1</span></span> deu_vocab_size = len(deu_tokenizer.word_index) + <span class="hljs-number"><span class="hljs-number">1</span></span> eng_length, deu_length = <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span> model = make_model(eng_vocab_size, deu_vocab_size, eng_length, deu_length, <span class="hljs-number"><span class="hljs-number">512</span></span>) num_epochs = <span class="hljs-number"><span class="hljs-number">40</span></span> model.fit(trainX, trainY.reshape(trainY.shape[<span class="hljs-number"><span class="hljs-number">0</span></span>], trainY.shape[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">1</span></span>), epochs=num_epochs, batch_size=<span class="hljs-number"><span class="hljs-number">512</span></span>, validation_split=<span class="hljs-number"><span class="hljs-number">0.2</span></span>, callbacks=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, verbose=<span class="hljs-number"><span class="hljs-number">1</span></span>) model.save(<span class="hljs-string"><span class="hljs-string">'en-de-model.h5'</span></span>)</code> </pre><br>  рдкреНрд░рд╢рд┐рдХреНрд╖рдг рд╣реА рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ: <br><br><img src="https://habrastorage.org/webt/fj/xl/b4/fjxlb4yorszz5ojzpcih4ixlria.png"><br><br>  рдкреНрд░рдХреНрд░рд┐рдпрд╛, рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рддреЗрдЬ рдирд╣реАрдВ рд╣реИ, рдФрд░ рдХреЛрд░ i7 + GeForce 1060 рдкрд░ 30 рд╣рдЬрд╛рд░ рд▓рд╛рдЗрдиреЛрдВ рдХреЗ рд╕реЗрдЯ рдХреЗ рд▓рд┐рдП рд▓рдЧрднрдЧ рдЖрдзреЗ рдШрдВрдЯреЗ рд▓рдЧрддреЗ рд╣реИрдВред  рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдХреЗ рдЕрдВрдд рдореЗрдВ (рдЗрд╕реЗ рдХреЗрд╡рд▓ рдПрдХ рдмрд╛рд░ рдХрд┐рдП рдЬрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ), рдореЙрдбрд▓ рдХреЛ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рд╣реЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ рдЗрд╕рдХрд╛ рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br>  рдЕрдиреБрд╡рд╛рдж рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо predict_classes рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдХрд╛ рдЗрдирдкреБрдЯ рд╣рдо рдХреБрдЫ рд╕рд░рд▓ рд╡рд╛рдХреНрдпрд╛рдВрд╢ рдкреНрд░рд╕реНрддреБрдд рдХрд░рддреЗ рд╣реИрдВред  Get_word рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рд╢рдмреНрджреЛрдВ рдХреЛ рд╕рдВрдЦреНрдпрд╛рдУрдВ рдореЗрдВ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br><pre> <code class="python hljs">model = load_model(<span class="hljs-string"><span class="hljs-string">'en-de-model.h5'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_word</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n, tokenizer)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> word, index <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tokenizer.word_index.items(): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> index == n: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> word <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> phrs_enc = encode_sequences(eng_tokenizer, eng_length, [<span class="hljs-string"><span class="hljs-string">"the weather is nice today"</span></span>, <span class="hljs-string"><span class="hljs-string">"my name is tom"</span></span>, <span class="hljs-string"><span class="hljs-string">"how old are you"</span></span>, <span class="hljs-string"><span class="hljs-string">"where is the nearest shop"</span></span>]) preds = model.predict_classes(phrs_enc) print(<span class="hljs-string"><span class="hljs-string">"Preds:"</span></span>, preds.shape) print(preds[<span class="hljs-number"><span class="hljs-number">0</span></span>]) print(get_word(preds[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>], deu_tokenizer), get_word(preds[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>], deu_tokenizer), get_word(preds[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>], deu_tokenizer), get_word(preds[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">3</span></span>], deu_tokenizer)) print(preds[<span class="hljs-number"><span class="hljs-number">1</span></span>]) print(get_word(preds[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>], deu_tokenizer), get_word(preds[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>], deu_tokenizer), get_word(preds[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>], deu_tokenizer), get_word(preds[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">3</span></span>], deu_tokenizer)) print(preds[<span class="hljs-number"><span class="hljs-number">2</span></span>]) print(get_word(preds[<span class="hljs-number"><span class="hljs-number">2</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>], deu_tokenizer), get_word(preds[<span class="hljs-number"><span class="hljs-number">2</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>], deu_tokenizer), get_word(preds[<span class="hljs-number"><span class="hljs-number">2</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>], deu_tokenizer), get_word(preds[<span class="hljs-number"><span class="hljs-number">2</span></span>][<span class="hljs-number"><span class="hljs-number">3</span></span>], deu_tokenizer)) print(preds[<span class="hljs-number"><span class="hljs-number">3</span></span>]) print(get_word(preds[<span class="hljs-number"><span class="hljs-number">3</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>], deu_tokenizer), get_word(preds[<span class="hljs-number"><span class="hljs-number">3</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>], deu_tokenizer), get_word(preds[<span class="hljs-number"><span class="hljs-number">3</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>], deu_tokenizer), get_word(preds[<span class="hljs-number"><span class="hljs-number">3</span></span>][<span class="hljs-number"><span class="hljs-number">3</span></span>], deu_tokenizer))</code> </pre><br><h2>  рдкрд░рд┐рдгрд╛рдо </h2><br>  рдЕрдм, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╕рдмрд╕реЗ рдЙрддреНрд╕реБрдХ рдЪреАрдЬ рдкрд░рд┐рдгрд╛рдо рд╣реИред  рдпрд╣ рджреЗрдЦрдирд╛ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдХрд┐ рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдХреИрд╕реЗ рд╕реАрдЦрддрд╛ рд╣реИ рдФрд░ рдЕрдВрдЧреНрд░реЗрдЬреА рдФрд░ рдЬрд░реНрдорди рд╡рд╛рдХреНрдпрд╛рдВрд╢реЛрдВ рдХреЗ рдмреАрдЪ рдХреЗ рдкрддреНрд░рд╛рдЪрд╛рд░ рдХреЛ "рдпрд╛рдж" рдХрд░рддрд╛ рд╣реИред  рдореИрдВрдиреЗ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ 2 рд╡рд╛рдХреНрдпрд╛рдВрд╢реЛрдВ рдХреЛ рдЖрд╕рд╛рди рдФрд░ 2 рдХрдард┐рди рдЕрдВрддрд░ рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рд▓рд┐рдпрд╛ред <br><br>  <b>5 рдорд┐рдирдЯ рдХрд╛ рдкреНрд░рд╢рд┐рдХреНрд╖рдг</b> <br><br>  "рдЖрдЬ рдореМрд╕рдо рдЕрдЪреНрдЫрд╛ рд╣реИ" - "рджрд╛рд╕ ist рдЯреЙрдо" <br>  "рдореЗрд░рд╛ рдирд╛рдо рдЯреЙрдо рд╣реИ" - "рд╡рд╛рдИ рдлрд░ рдЯреЙрдо рдЯреЙрдо" <br>  "рдЖрдкрдХреА рдЙрдореНрд░ рдХрд┐рддрдиреА рд╣реИ" - "wie geht ist es" <br>  "рд╕рдмрд╕реЗ рдирдЬрд╝рджреАрдХреА рджреБрдХрд╛рди рдХрд╣рд╛рдБ рд╣реИ" - "wo ist der" <br><br>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЕрдм рддрдХ рдХреБрдЫ "рд╣рд┐рдЯ" рд╣реИрдВред  рд╡рд╛рдХреНрдпрд╛рдВрд╢ "рдЖрдк рдХрд┐рддрдиреЗ рд╕рд╛рд▓ рдХреЗ рд╣реИрдВ" рдХрд╛ рдПрдХ рдЯреБрдХрдбрд╝рд╛ "рдХреИрд╕реЗ рдЖрдк рд╣реИрдВ" рд╡рд╛рдХреНрдпрд╛рдВрд╢ рдХреЗ рд╕рд╛рде рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рднреНрд░рдорд┐рдд рдХрд┐рдпрд╛ рдФрд░ рдЕрдиреБрд╡рд╛рдж "wie geht ist es" (рдЖрдк рдХреИрд╕реЗ рд╣реИрдВ?) рдХрд╛ рдЙрддреНрдкрд╛рджрди рдХрд┐рдпрд╛ред  рд╡рд╛рдХреНрдпрд╛рдВрд╢ рдореЗрдВ "рдХрд╣рд╛рдВ рд╣реИ ..." рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдиреЗ рдХреЗрд╡рд▓ рдХреНрд░рд┐рдпрд╛ рдХреА рдкрд╣рдЪрд╛рди рдХреА рд╣реИ, рдЬрд╣рд╛рдВ рдЕрдиреБрд╡рд╛рдж "wo ist der" (рдЬрд╣рд╛рдВ рдпрд╣ рд╣реИ?) рдХрд╛ рдЙрддреНрдкрд╛рджрди рдХрд┐рдпрд╛, рдЬреЛ, рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдЕрд░реНрде рдХреЗ рдмрд┐рдирд╛ рдирд╣реАрдВ рд╣реИред  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдпрд╣ рд╕рдореВрд╣ A1 рдореЗрдВ рдЬрд░реНрдорди рдирд╡рд╛рдЧрдВрддреБрдХ рдореЗрдВ рднреА рдЕрдиреБрд╡рд╛рдж рдХрд░рддрд╛ рд╣реИ;) <br><br>  <b>10 рдорд┐рдирдЯ рдХрд╛ рдкреНрд░рд╢рд┐рдХреНрд╖рдг</b> <br><br>  "рдЖрдЬ рдореМрд╕рдо рдЕрдЪреНрдЫрд╛ рд╣реИ" - "рджрд╛рд╕ рд╣реИрд╕ рдмреЗрд░реЗрдЯ" <br>  "рдореЗрд░рд╛ рдирд╛рдо рдЯреЙрдо рд╣реИ" - "mei hee hei tome tom" <br>  "рдЖрдк рдХрд┐рддрдиреЗ рд╕рд╛рд▓ рдХреЗ рд╣реИрдВ" - "wie alt sind sie" <br>  "рд╕рдмрд╕реЗ рдирдЬрд╝рджреАрдХреА рджреБрдХрд╛рди рдХрд╣рд╛рдБ рд╣реИ" - "wo ist paris" <br><br>  рдХреБрдЫ рдкреНрд░рдЧрддрд┐ рджрд┐рдЦрд╛рдИ рджреЗ рд░рд╣реА рд╣реИред  рдкрд╣рд▓рд╛ рд╡рд╛рдХреНрдпрд╛рдВрд╢ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЬрдЧрд╣ рд╕реЗ рдмрд╛рд╣рд░ рд╣реИред  рджреВрд╕рд░реЗ рд╡рд╛рдХреНрдпрд╛рдВрд╢ рдореЗрдВ, рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ "рд╕реАрдЦрд╛" рдХреНрд░рд┐рдпрд╛ hei (en (рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ), рд▓реЗрдХрд┐рди "mein hei├Яe hei├Яe рдЯреЙрдо" рдЕрднреА рднреА рдЧрд▓рдд рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЖрдк рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЕрд░реНрде рдХрд╛ рдЕрдиреБрдорд╛рди рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВред  рддреАрд╕рд░рд╛ рд╡рд╛рдХреНрдпрд╛рдВрд╢ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕рд╣реА рд╣реИред  рдЪреМрдереЗ рдореЗрдВ, рдкрд╣рд▓рд╛ рднрд╛рдЧ "wo ist" рд╣реИ, рд▓реЗрдХрд┐рди рдирд┐рдХрдЯрддрдо рджреБрдХрд╛рди рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ рдкреЗрд░рд┐рд╕ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХреА рдЧрдИ рдереАред <br><br>  <b>30 рдорд┐рдирдЯ рдХрд╛ рдкреНрд░рд╢рд┐рдХреНрд╖рдг</b> <br><br>  "рдЖрдЬ рдореМрд╕рдо рдЕрдЪреНрдЫрд╛ рд╣реИ" - "рджрд╛рд╕ рдЗрд╕реН рдЯ рдЗрдЬрд╝ рдЧреБрджрд╛" <br>  "рдореЗрд░рд╛ рдирд╛рдо рдЯреЙрдо рд╣реИ" - "рдЯреЙрдо" ist mein рдирд╛рдо " <br>  "рдЖрдк рдХрд┐рддрдиреЗ рд╕рд╛рд▓ рдХреЗ рд╣реИрдВ" - "wie alt sind sie" <br>  "рд╕рдмрд╕реЗ рдирдЬрд╝рджреАрдХреА рджреБрдХрд╛рди рдХрд╣рд╛рдБ рд╣реИ" - "wo ist der" <br><br>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рджреВрд╕рд░рд╛ рд╡рд╛рдХреНрдпрд╛рдВрд╢ рд╕рд╣реА рд╣реЛ рдЧрдпрд╛ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдбрд┐рдЬрд╛рдЗрди рдХреБрдЫ рдЕрд╕рд╛рдорд╛рдиреНрдп рджрд┐рдЦрддрд╛ рд╣реИред  рддреАрд╕рд░рд╛ рд╡рд╛рдХреНрдпрд╛рдВрд╢ рд╕рд╣реА рд╣реИ, рд▓реЗрдХрд┐рди рдкрд╣рд▓реА рдФрд░ рдЪреМрдереА рд╡рд╛рдХреНрдпрд╛рдВрд╢ рдЕрднреА рддрдХ "рд╕реАрдЦрд╛" рдирд╣реАрдВ рдЧрдпрд╛ рд╣реИред  рдЗрд╕рдХреЗ рд╕рд╛рде рд╣реА <s>рдмрд┐рдЬрд▓реА рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ</s> рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдкреВрд░рд╛ рдХрд┐рдпрд╛ред <br><br><h2>  рдирд┐рд╖реНрдХрд░реНрд╖ </h2><br>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред  рдореИрдВ рдЗрд╕ рддрд░рд╣ рдХреА рдЧрддрд┐ рдХреЗ рд╕рд╛рде рдПрдХ рдирдИ рднрд╛рд╖рд╛ рдХреЛ рдпрд╛рдж рдХрд░рдирд╛ рдЪрд╛рд╣реВрдВрдЧрд╛ :) рдмреЗрд╢рдХ, рдкрд░рд┐рдгрд╛рдо рдЕрднреА рддрдХ рд╕рд╣реА рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди 190 рд╣рдЬрд╛рд░ рд▓рд╛рдЗрдиреЛрдВ рдХреЗ рдкреВрд░реНрдг рд╕реЗрдЯ рдкрд░ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдореЗрдВ рдПрдХ рдШрдВрдЯреЗ рд╕реЗ рдЕрдзрд┐рдХ рд╕рдордп рд▓рдЧреЗрдЧрд╛ред <br><br>  рдЬреЛ рд▓реЛрдЧ рдЕрдкрдиреЗ рджрдо рдкрд░ рдкреНрд░рдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЙрдирдХреЗ рд▓рд┐рдП рд╕реНрд░реЛрдд рдХреЛрдб рд╕реНрдкреЙрдЗрд▓рд░ рд╣реИред  рдХрд╛рд░реНрдпрдХреНрд░рдо рд╕реИрджреНрдзрд╛рдВрддрд┐рдХ рд░реВрдк рд╕реЗ рднрд╛рд╖рд╛рдУрдВ рдХреЗ рдХрд┐рд╕реА рднреА рдЬреЛрдбрд╝реЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рди рдХреЗрд╡рд▓ рдЕрдВрдЧреНрд░реЗрдЬреА рдФрд░ рдЬрд░реНрдорди (рдлрд╝рд╛рдЗрд▓ UTF-8 рдПрдиреНрдХреЛрдбрд┐рдВрдЧ рдореЗрдВ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП)ред  рдЕрдиреБрд╡рд╛рдж рдХреА рдЧреБрдгрд╡рддреНрддрд╛ рдХрд╛ рдореБрджреНрджрд╛ рднреА рдЦреБрд▓рд╛ рд╣реИ, рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╣реИред <br><br><div class="spoiler">  <b class="spoiler_title">keras_translate.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-comment"><span class="hljs-comment"># os.environ["CUDA_VISIBLE_DEVICES"] = "-1" # Force CPU os.environ['TF_CPP_MIN_LOG_LEVEL'] = '3' # 0 = all messages are logged, 3 - INFO, WARNING, and ERROR messages are not printed import string import re import numpy as np import pandas as pd from keras.models import Sequential from keras.layers import Dense, LSTM, Embedding, RepeatVector from keras.preprocessing.text import Tokenizer from keras.callbacks import ModelCheckpoint from keras.preprocessing.sequence import pad_sequences from keras.models import load_model from keras import optimizers from sklearn.model_selection import train_test_split import matplotlib.pyplot as plt pd.set_option('display.max_colwidth', 200) # Read raw text file def read_text(filename): with open(filename, mode='rt', encoding='utf-8') as file: text = file.read() sents = text.strip().split('\n') return [i.split('\t') for i in sents] data = read_text("deutch.txt") deu_eng = np.array(data) deu_eng = deu_eng[:30000,:] print("Dictionary size:", deu_eng.shape) # Remove punctuation deu_eng[:,0] = [s.translate(str.maketrans('', '', string.punctuation)) for s in deu_eng[:,0]] deu_eng[:,1] = [s.translate(str.maketrans('', '', string.punctuation)) for s in deu_eng[:,1]] # Convert text to lowercase for i in range(len(deu_eng)): deu_eng[i,0] = deu_eng[i,0].lower() deu_eng[i,1] = deu_eng[i,1].lower() # Prepare English tokenizer eng_tokenizer = Tokenizer() eng_tokenizer.fit_on_texts(deu_eng[:, 0]) eng_vocab_size = len(eng_tokenizer.word_index) + 1 eng_length = 8 # Prepare Deutch tokenizer deu_tokenizer = Tokenizer() deu_tokenizer.fit_on_texts(deu_eng[:, 1]) deu_vocab_size = len(deu_tokenizer.word_index) + 1 deu_length = 8 # Encode and pad sequences def encode_sequences(tokenizer, length, lines): # integer encode sequences seq = tokenizer.texts_to_sequences(lines) # pad sequences with 0 values seq = pad_sequences(seq, maxlen=length, padding='post') return seq # Split data into train and test set train, test = train_test_split(deu_eng, test_size=0.2, random_state=12) # Prepare training data trainX = encode_sequences(eng_tokenizer, eng_length, train[:, 0]) trainY = encode_sequences(deu_tokenizer, deu_length, train[:, 1]) # Prepare validation data testX = encode_sequences(eng_tokenizer, eng_length, test[:, 0]) testY = encode_sequences(deu_tokenizer, deu_length, test[:, 1]) # Build NMT model def make_model(in_vocab, out_vocab, in_timesteps, out_timesteps, n): model = Sequential() model.add(Embedding(in_vocab, n, input_length=in_timesteps, mask_zero=True)) model.add(LSTM(n)) model.add(Dropout(0.3)) model.add(RepeatVector(out_timesteps)) model.add(LSTM(n, return_sequences=True)) model.add(Dropout(0.3)) model.add(Dense(out_vocab, activation='softmax')) model.compile(optimizer=optimizers.RMSprop(lr=0.001), loss='sparse_categorical_crossentropy') return model print("deu_vocab_size:", deu_vocab_size, deu_length) print("eng_vocab_size:", eng_vocab_size, eng_length) # Model compilation (with 512 hidden units) model = make_model(eng_vocab_size, deu_vocab_size, eng_length, deu_length, 512) # Train model num_epochs = 250 history = model.fit(trainX, trainY.reshape(trainY.shape[0], trainY.shape[1], 1), epochs=num_epochs, batch_size=512, validation_split=0.2, callbacks=None, verbose=1) # plt.plot(history.history['loss']) # plt.plot(history.history['val_loss']) # plt.legend(['train','validation']) # plt.show() model.save('en-de-model.h5') # Load model model = load_model('en-de-model.h5') def get_word(n, tokenizer): if n == 0: return "" for word, index in tokenizer.word_index.items(): if index == n: return word return "" phrs_enc = encode_sequences(eng_tokenizer, eng_length, ["the weather is nice today", "my name is tom", "how old are you", "where is the nearest shop"]) print("phrs_enc:", phrs_enc.shape) preds = model.predict_classes(phrs_enc) print("Preds:", preds.shape) print(preds[0]) print(get_word(preds[0][0], deu_tokenizer), get_word(preds[0][1], deu_tokenizer), get_word(preds[0][2], deu_tokenizer), get_word(preds[0][3], deu_tokenizer)) print(preds[1]) print(get_word(preds[1][0], deu_tokenizer), get_word(preds[1][1], deu_tokenizer), get_word(preds[1][2], deu_tokenizer), get_word(preds[1][3], deu_tokenizer)) print(preds[2]) print(get_word(preds[2][0], deu_tokenizer), get_word(preds[2][1], deu_tokenizer), get_word(preds[2][2], deu_tokenizer), get_word(preds[2][3], deu_tokenizer)) print(preds[3]) print(get_word(preds[3][0], deu_tokenizer), get_word(preds[3][1], deu_tokenizer), get_word(preds[3][2], deu_tokenizer), get_word(preds[3][3], deu_tokenizer)) print()</span></span></code> </pre><br></div></div><br>  рд╢рдмреНрджрдХреЛрд╢ рд╣реА рд▓реЗрдЦ рдХреЗ рд╕рд╛рде рд╕рдВрд▓рдЧреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдмрдбрд╝рд╛ рд╣реИ, рд▓рд┐рдВрдХ рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдореЗрдВ рд╣реИред <br><br>  рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣, рд╕рднреА рд╕рдлрд▓ рдкреНрд░рдпреЛрдЧред </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi470706/">https://habr.com/ru/post/hi470706/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi470688/index.html">рд╡реАрдПрдорд╡рд░реНрд▓реНрдб 2019 рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛ рдкрддрд╛ рд╣реИ</a></li>
<li><a href="../hi470692/index.html">рд╣рдордиреЗ рдПрдХ рдирдИ рд░реЛрд╕рдмреИрдВрдХ рд╡реЗрдмрд╕рд╛рдЗрдЯ рдХреИрд╕реЗ рдмрдирд╛рдИ, рдФрд░ рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛ рдЖрдпрд╛</a></li>
<li><a href="../hi470694/index.html">рдИрдореЗрд▓ рдорд╛рд░реНрдХреЗрдЯрд┐рдВрдЧ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдЪреБрдирдирд╛: рд░реВрд╕реА рдХрдВрдкрдирд┐рдпреЛрдВ рдкрд░ рдХреНрдпрд╛ рдзреНрдпрд╛рди рджреЗрдирд╛ рд╣реИ</a></li>
<li><a href="../hi470696/index.html">рднрд╛рд╖рдг рдХреА рдорд╛рдиреНрдпрддрд╛ рдХреЗ рд▓рд┐рдП рдХрд▓рджреА рдХреНрдпреЛрдВ рдЕрдЪреНрдЫрд╛ рд╣реИ? (рдЕрдкрдбреЗрдЯреЗрдб 12.25.2019)</a></li>
<li><a href="../hi470700/index.html">рдЯреЗрдмрд▓ред рдзрд╛рддреБред рдореМрдиред рддреБрдореНрд╣рд╛рд░рд╛?</a></li>
<li><a href="../hi470710/index.html">рдЕрдкрдиреЗ рдлреНрд▓реИрдЯ рд╢рд┐рдХрд╛рд░ рдХреЗ рд▓рд┐рдП рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧред рднрд╛рдЧ реи</a></li>
<li><a href="../hi470714/index.html">рдореИрдВ рдбрд┐рдЬрд┐рдЯрд▓ рдирд┐рд░реНрдгрд╛рдпрдХ рдлрд╛рдЗрдирд▓ рдореЗрдВ рдХреИрд╕реЗ рдЧрдпрд╛</a></li>
<li><a href="../hi470718/index.html">рдорд╛рдирд╡ рднрд╛рд╖рд╛ рдореЗрдВ "рдмреАрдЬрдЧрдгрд┐рддреАрдп рдкреНрд░рднрд╛рд╡"</a></li>
<li><a href="../hi470720/index.html">рдУрдиреНрдЯреЛрд▓реЙрдЬреА рдкрд░ рдкрд╛рдпрдерди рдХреЗ рд╕рд╛рде рдПрдХ рд╕реНрдорд╛рд░реНрдЯ рдЕрдиреБрдмрдВрдз рдХреИрд╕реЗ рд▓рд┐рдЦреЗрдВ? рднрд╛рдЧ 2: рднрдВрдбрд╛рд░рдг рдПрдкреАрдЖрдИ</a></li>
<li><a href="../hi470722/index.html">рдУрдиреНрдЯреЛрд▓реЙрдЬреА рдкрд░ рдкрд╛рдпрдерди рдХреЗ рд╕рд╛рде рдПрдХ рд╕реНрдорд╛рд░реНрдЯ рдЕрдиреБрдмрдВрдз рдХреИрд╕реЗ рд▓рд┐рдЦреЗрдВ? рднрд╛рдЧ 3: рд░рдирдЯрд╛рдЗрдо рдПрдкреАрдЖрдИ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>