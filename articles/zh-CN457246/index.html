<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¶ ğŸ‘º â— å¦‚ä½•ä½¿ç”¨C ++ 17ï¼Œå…ƒç»„å’Œä¸€äº›å¹»æƒ³ä½¿CortexMä¸Šçš„4ä¸ªLEDé—ªçƒ â˜¯ï¸ ğŸ§“ğŸ¿ ğŸš¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¤§å®¶èº«ä½“å¥åº·ï¼ 

 åœ¨å¤§å­¦é‡Œæ•™å­¦ç”Ÿå¼€å‘ç”¨äºå¾®æ§åˆ¶å™¨çš„åµŒå…¥å¼è½¯ä»¶æ—¶ï¼Œæˆ‘ä½¿ç”¨C ++ï¼Œæœ‰æ—¶æˆ‘ä¼šç»™å¯¹å„ç§ä»»åŠ¡ç‰¹åˆ«æ„Ÿå…´è¶£çš„å­¦ç”Ÿæ‰¾å‡ºæœ‰ç‰¹æ®Šå¤´ç—›çš„å¤©æ‰å­¦ç”Ÿã€‚ 

 å†ä¸€æ¬¡ï¼Œæ­¤ç±»å­¦ç”Ÿçš„ä»»åŠ¡æ˜¯ä½¿ç”¨C ++ 17è¯­è¨€å’Œæ ‡å‡†C ++åº“ä½¿4ä¸ªLEDé—ªçƒï¼Œè€Œæ— éœ€è¿æ¥å…¶ä»–åº“ï¼Œä¾‹å¦‚CMSISåŠå…¶å¸¦æœ‰å¯„å­˜å™¨ç»“æ„æè¿°çš„å¤´æ–‡ä»¶ï¼Œç­‰...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å¦‚ä½•ä½¿ç”¨C ++ 17ï¼Œå…ƒç»„å’Œä¸€äº›å¹»æƒ³ä½¿CortexMä¸Šçš„4ä¸ªLEDé—ªçƒ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457246/">å¤§å®¶èº«ä½“å¥åº·ï¼ <br><br> åœ¨å¤§å­¦é‡Œæ•™å­¦ç”Ÿå¼€å‘ç”¨äºå¾®æ§åˆ¶å™¨çš„åµŒå…¥å¼è½¯ä»¶æ—¶ï¼Œæˆ‘ä½¿ç”¨C ++ï¼Œæœ‰æ—¶æˆ‘ä¼šç»™å¯¹å„ç§ä»»åŠ¡ç‰¹åˆ«æ„Ÿå…´è¶£çš„å­¦ç”Ÿæ‰¾å‡ºæœ‰ç‰¹æ®Šå¤´ç—›çš„å¤©æ‰å­¦ç”Ÿã€‚ <br><br> å†ä¸€æ¬¡ï¼Œæ­¤ç±»å­¦ç”Ÿçš„ä»»åŠ¡æ˜¯ä½¿ç”¨C ++ 17è¯­è¨€å’Œæ ‡å‡†C ++åº“ä½¿4ä¸ªLEDé—ªçƒï¼Œè€Œæ— éœ€è¿æ¥å…¶ä»–åº“ï¼Œä¾‹å¦‚CMSISåŠå…¶å¸¦æœ‰å¯„å­˜å™¨ç»“æ„æè¿°çš„å¤´æ–‡ä»¶ï¼Œç­‰ç­‰ã€‚ ROMä¸­çš„å†…å­˜å°†æ˜¯æœ€å°çš„å¤§å°å’Œæœ€å°‘çš„RAMã€‚ ç¼–è¯‘å™¨ä¼˜åŒ–ä¸åº”é«˜äºä¸­çº§ã€‚  IARç¼–è¯‘å™¨8.40.1ã€‚ <br> è·èƒœè€…<s>å‰å¾€Canaryï¼Œ</s>è·å¾—5åˆ†è€ƒè¯•ã€‚ <br><br> æˆ‘è‡ªå·±ä¹‹å‰ä¹Ÿæ²¡æœ‰è§£å†³è¿‡è¿™ä¸ªé—®é¢˜ï¼Œå› æ­¤ï¼Œæˆ‘å°†å‘Šè¯‰æ‚¨å­¦ç”Ÿå¦‚ä½•è§£å†³è¯¥é—®é¢˜ä»¥åŠå‘ç”Ÿäº†ä»€ä¹ˆäº‹ã€‚ æˆ‘ç«‹å³è­¦å‘Šæ‚¨ï¼Œæ­¤ç±»ä»£ç ä¸å¤ªå¯èƒ½åœ¨å®é™…åº”ç”¨ä¸­ä½¿ç”¨ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘å°†å‡ºç‰ˆç‰©å‘å¸ƒåœ¨â€œå¼‚å¸¸ç¼–ç¨‹â€éƒ¨åˆ†ä¸­çš„åŸå› ï¼Œå°½ç®¡è°çŸ¥é“ã€‚ <br><a name="habracut"></a><br><h3> ä»»åŠ¡æ¡ä»¶ </h3><br> ç«¯å£GPIOA.5ï¼ŒGPIOC.5ï¼ŒGPIOC.8ï¼ŒGPIOC.9ä¸Šæœ‰4ä¸ªLEDã€‚ ä»–ä»¬éœ€è¦çœ¨çœ¼ã€‚ ä¸ºäº†æ¯”è¾ƒï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ç”¨Cç¼–å†™çš„ä»£ç ï¼š <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delay</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">1000000</span></span>; ++i){ } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(;;) { GPIOA-&gt;ODR ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>); GPIOC-&gt;ODR ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>); GPIOC-&gt;ODR ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>); GPIOC-&gt;ODR ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">9</span></span>); delay(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ; }</code> </pre> <br> è¿™é‡Œçš„<code>delay()</code>å‡½æ•°çº¯ç²¹æ˜¯å½¢å¼ä¸Šçš„ï¼Œæœ‰è§„å¾‹çš„å¾ªç¯ï¼Œæ— æ³•å¯¹å…¶è¿›è¡Œä¼˜åŒ–ã€‚ <br> å‡å®šç«¯å£å·²ç»é…ç½®ä¸ºè¾“å‡ºï¼Œå¹¶ä¸”å·²å¯¹å…¶åº”ç”¨æ—¶é’Ÿã€‚ <br> æˆ‘è¿˜è¦ç«‹å³è¯´ï¼Œbitbangingå¹¶ä¸æ˜¯ç”¨æ¥ä½¿ä»£ç å¯ç§»æ¤çš„ã€‚ <br><br> ä¸­ç­‰ä¼˜åŒ–æ—¶ï¼Œæ­¤ä»£ç åœ¨å †æ ˆä¸Šå ç”¨8ä¸ªå­—èŠ‚ï¼Œåœ¨ROMä¸­å ç”¨256ä¸ªå­—èŠ‚ <br><blockquote>  255ä¸ªå­—èŠ‚çš„åªè¯»ä»£ç å­˜å‚¨å™¨ <br>  1å­—èŠ‚çš„åªè¯»æ•°æ®å­˜å‚¨å™¨ <br>  8å­—èŠ‚çš„è¯»å†™æ•°æ®å­˜å‚¨å™¨ </blockquote><br> ç”±äºéƒ¨åˆ†å†…å­˜ä½äºä¸­æ–­å‘é‡è¡¨ä¹‹ä¸‹ï¼Œè°ƒç”¨IARå‡½æ•°ä»¥åˆå§‹åŒ–æµ®ç‚¹å—ï¼Œå„ç§è°ƒè¯•å‡½æ•°å’Œ__low_level_initå‡½æ•°ï¼ˆç«¯å£æœ¬èº«å·²åœ¨å…¶ä¸­é…ç½®ï¼‰çš„äº‹å®ï¼Œå› æ­¤ä¸º255ä¸ªå­—èŠ‚ã€‚ <br><br> å› æ­¤ï¼Œå®Œæ•´çš„è¦æ±‚æ˜¯ï¼š <br><br><ul><li>  mainï¼ˆï¼‰å‡½æ•°åº”åŒ…å«å°½å¯èƒ½å°‘çš„ä»£ç  </li><li> æ‚¨ä¸èƒ½ä½¿ç”¨å® </li><li>  IAR 8.40.1ç¼–è¯‘å™¨æ”¯æŒC ++ 17 </li><li>  CMSISå¤´æ–‡ä»¶ï¼Œä¾‹å¦‚â€œ #includeâ€ stm32f411xe.hâ€œ </li><li> æ‚¨å¯ä»¥å°†__forceinlineæŒ‡ä»¤ç”¨äºå†…è”å‡½æ•° </li><li> ä¸­ç­‰ç¼–è¯‘å™¨ä¼˜åŒ– </li></ul><br><h3> å­¦ç”Ÿå†³å®š </h3><br> æ€»çš„æ¥è¯´ï¼Œæœ‰å‡ ç§è§£å†³æ–¹æ¡ˆï¼Œæˆ‘åªä¼šå±•ç¤ºä¸€ç§â€¦â€¦è¿™ä¸æ˜¯æœ€ä½³æ–¹æ¡ˆï¼Œä½†æˆ‘å¾ˆå–œæ¬¢ã€‚ <br><br> ç”±äºæ— æ³•ä½¿ç”¨æ ‡é¢˜ï¼Œå› æ­¤å­¦ç”Ÿè¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯<code>Gpio</code>ç±»ï¼Œè¯¥ç±»åº”åœ¨å…¶åœ°å€å¤„å­˜å‚¨æŒ‡å‘ç«¯å£å¯„å­˜å™¨çš„é“¾æ¥ã€‚ ä¸ºæ­¤ï¼Œä»–ä»¬ä½¿ç”¨ç»“æ„å åŠ å±‚ï¼Œå¾ˆå¯èƒ½æ˜¯ä»è¿™é‡Œå¾—åˆ°çš„æƒ³æ³•ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç»“æ„å åŠ å±‚</a> ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Gpio</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Toggle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bitNum)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">volatile</span></span></span><span class="hljs-function"> </span></span>{ Odr ^= bitNum ; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Moder; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Otyper; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Ospeedr; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Pupdr; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Idr; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Odr; <span class="hljs-comment"><span class="hljs-comment">//    static_assert(sizeof(Gpio) == sizeof(std::uint32_t) * 6); } ;</span></span></code> </pre> <br> å¦‚æ‚¨æ‰€è§ï¼Œä»–ä»¬ç«‹å³è¯†åˆ«äº†<code>Gpio</code>ç±»ï¼Œè¯¥ç±»å…·æœ‰åº”ä½äºç›¸åº”å¯„å­˜å™¨çš„åœ°å€å¤„çš„å±æ€§ï¼Œä»¥åŠä¸€ç§é€šè¿‡åˆ†æ”¯æ•°æ¥åˆ‡æ¢çŠ¶æ€çš„æ–¹æ³•ï¼š <br> ç„¶åï¼Œæˆ‘ä»¬ç¡®å®šäº†<code>GpioPin</code>çš„ç»“æ„ï¼Œ <code>GpioPin</code>åŒ…å«æŒ‡å‘<code>Gpio</code>çš„æŒ‡é’ˆå’Œæ”¯è„šçš„ç¼–å·ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GpioPin</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> Gpio* port ; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> pinNum ; } ;</code> </pre> <br> ç„¶åï¼Œä»–ä»¬åœ¨ç«¯å£çš„ç‰¹å®šåˆ†æ”¯ä¸Šåˆ¶ä½œäº†ä¸€ä¸ªLEDé˜µåˆ—ï¼Œå¹¶é€šè¿‡è°ƒç”¨æ¯ä¸ªLEDçš„<code>Toggle()</code>æ–¹æ³•æ¥æ£€æŸ¥è¯¥LEDï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> GpioPin leds[] = {{<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> Gpio*&gt;(GpioaBaseAddr), <span class="hljs-number"><span class="hljs-number">5</span></span>}, {<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> Gpio*&gt;(GpiocBaseAddr), <span class="hljs-number"><span class="hljs-number">5</span></span>}, {<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> Gpio*&gt;(GpiocBaseAddr), <span class="hljs-number"><span class="hljs-number">9</span></span>}, {<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> Gpio*&gt;(GpiocBaseAddr), <span class="hljs-number"><span class="hljs-number">9</span></span>} } ; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LedsDriver</span></span></span><span class="hljs-class"> {</span></span> __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToggelAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>&amp; it: leds) { it.port-&gt;Toggle(it.pinNum); } } } ;</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">å¥½å§ï¼Œå®é™…ä¸Šæ˜¯æ•´ä¸ªä»£ç ï¼š</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> GpioaBaseAddr = <span class="hljs-number"><span class="hljs-number">0x4002'0000</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> GpiocBaseAddr = <span class="hljs-number"><span class="hljs-number">0x4002'0800</span></span> ; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Gpio</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Toggle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bitNum)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">volatile</span></span></span><span class="hljs-function"> </span></span>{ Odr ^= bitNum ; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Moder; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Otyper; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Ospeedr; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Pupdr; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Idr; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Odr; } ; <span class="hljs-comment"><span class="hljs-comment">//    static_assert(sizeof(Gpio) == sizeof(std::uint32_t) * 6); struct GpioPin { volatile Gpio* port ; std::uint32_t pinNum ; } ; const GpioPin leds[] = {{reinterpret_cast&lt;volatile Gpio*&gt;(GpioaBaseAddr), 5}, {reinterpret_cast&lt;volatile Gpio*&gt;(GpiocBaseAddr), 5}, {reinterpret_cast&lt;volatile Gpio*&gt;(GpiocBaseAddr), 9}, {reinterpret_cast&lt;volatile Gpio*&gt;(GpiocBaseAddr), 9} } ; struct LedsDriver { __forceinline static inline void ToggelAll() { for (auto&amp; it: leds) { it.port-&gt;Toggle(it.pinNum); } } } ; int main() { for(;;) { LedsContainer::ToggleAll() ; delay(); } return 0 ; }</span></span></code> </pre> <br></div></div><br> æœ‰å…³åª’ä»‹ä¼˜åŒ–çš„ä»£ç ç»Ÿè®¡ä¿¡æ¯ï¼š <br><blockquote>  275ä¸ªå­—èŠ‚çš„åªè¯»ä»£ç å­˜å‚¨å™¨ <br>  1å­—èŠ‚çš„åªè¯»æ•°æ®å­˜å‚¨å™¨ <br>  8å­—èŠ‚çš„è¯»å†™æ•°æ®å­˜å‚¨å™¨ </blockquote><br> ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯éœ€è¦å¾ˆå¤šå†…å­˜:) <br><br><h3> æˆ‘çš„å†³å®š </h3><br> å½“ç„¶ï¼Œæˆ‘å†³å®šä¸å¯»æ‰¾ç®€å•çš„æ–¹æ³•ï¼Œè€Œæ˜¯ä¸¥è‚ƒåœ°é‡‡å–è¡ŒåŠ¨:)ã€‚ <br>  LEDä½äºä¸åŒçš„ç«¯å£å’Œä¸åŒçš„æ”¯è„šä¸Šã€‚ æ‚¨éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯åˆ¶ä½œ<code>Port</code>ç±»ï¼Œä½†æ˜¯è¦æ‘†è„±å ç”¨RAMçš„æŒ‡é’ˆå’Œå˜é‡ï¼Œæ‚¨éœ€è¦ä½¿ç”¨é™æ€æ–¹æ³•ã€‚ ç«¯å£ç±»å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> addr&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Port</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">//  -  };</span></span></code> </pre> <br> ä½œä¸ºæ¨¡æ¿å‚æ•°ï¼Œå®ƒå°†å…·æœ‰ç«¯å£åœ°å€ã€‚ ä¾‹å¦‚ï¼Œåœ¨<code>"#include "stm32f411xe.h"</code> ï¼Œå¯¹äºç«¯å£Aï¼Œå®ƒå®šä¹‰ä¸ºGPIOA_BASEã€‚ä½†æ˜¯æˆ‘ä»¬ä¸å…è®¸ä½¿ç”¨è¿™äº›å¤´æ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦è®¾ç½®è‡ªå·±çš„å¸¸é‡å³å¯ã€‚å› æ­¤ï¼Œå¯ä»¥åƒè¿™æ ·ä½¿ç”¨è¯¥ç±»ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> GpioaBaseAddr = <span class="hljs-number"><span class="hljs-number">0x4002'0000</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> GpiocBaseAddr = <span class="hljs-number"><span class="hljs-number">0x4002'0800</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> PortA = Port&lt;GpioaBaseAddr&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> PortC = Port&lt;GpiocBaseAddr&gt; ;</code> </pre><br> è¦é—ªçƒï¼Œæ‚¨éœ€è¦Toggleæ–¹æ³•ï¼ˆconst std :: uint8_tä½ï¼‰ï¼Œè¯¥æ–¹æ³•å°†ä½¿ç”¨å¼‚æˆ–è¿ç®—æ¥åˆ‡æ¢æ‰€éœ€çš„ä½ã€‚ è¯¥æ–¹æ³•å¿…é¡»æ˜¯é™æ€çš„ï¼Œå°†å…¶æ·»åŠ åˆ°ç±»ä¸­ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> addr&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Port</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">//   __forceinline,        __forceinline inline static void Toggle(const std::uint8_t bitNum) { *reinterpret_cast&lt;std::uint32_t*&gt;(addr+20) ^= (1 &lt;&lt; bitNum) ; //addr + 20  ODR  } };</span></span></code> </pre> <br> ä¼˜ç§€çš„<code>Port&lt;&gt;</code>æ˜¯ï¼Œå®ƒå¯ä»¥åˆ‡æ¢è…¿çš„çŠ¶æ€ã€‚  LEDä½äºç‰¹å®šçš„è…¿ä¸Šï¼Œå› æ­¤é€»è¾‘ä¸Šè¦åˆ›å»ºä¸€ä¸ª<code>Pin</code>ç±»ï¼Œè¯¥ç±»å°†ä»¥<code>Port&lt;&gt;</code>å’Œåˆ†æ”¯ç¼–å·ä½œä¸ºæ¨¡æ¿å‚æ•°ã€‚ ç”±äº<code>Port&lt;&gt;</code>ç±»å‹æ˜¯æ¨¡æ¿ï¼Œå³ å¯¹äºä¸åŒçš„ç«¯å£ï¼Œæˆ‘ä»¬åªèƒ½ä¼ è¾“é€šç”¨ç±»å‹Tã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> pinNum&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pin</span></span></span><span class="hljs-class"> {</span></span> __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Toggle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ T::Toggle(pinNum) ; } } ;</code> </pre> <br> å°½ç®¡å‡å®šæˆ‘ä»¬åªåº”ä¼ é€’<code>Port&lt;&gt;</code>ç±»å‹ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸èƒ½ä¼ é€’ä»»ä½•å…·æœ‰<code>Toggle()</code>æ–¹æ³•çš„<code>T</code>ç±»å‹åºŸè¯ï¼Œè¿™å°†æ˜¯æ— æ•ˆçš„ã€‚ ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œæˆ‘ä»¬å°†ä½¿<code>Port&lt;&gt;</code>ç»§æ‰¿è‡ª<code>PortBase</code>åŸºç±»ï¼Œå¹¶åœ¨æ¨¡æ¿ä¸­å°†éªŒè¯ä¼ é€’çš„ç±»å‹ç¡®å®åŸºäº<code>PortBase</code> ã€‚ æˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹å†…å®¹ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> OdrAddrShift = <span class="hljs-number"><span class="hljs-number">20U</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PortBase</span></span></span><span class="hljs-class"> {</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> addr&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Port</span></span></span><span class="hljs-class">:</span></span> PortBase { __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Toggle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bit)</span></span></span><span class="hljs-function"> </span></span>{ *<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span>*&gt;(addr ) ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; bit) ; } }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> pinNum, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">:</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">enable_if_t</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_base_of&lt;PortBase, T&gt;::value&gt;&gt; <span class="hljs-comment"><span class="hljs-comment">//   struct Pin { __forceinline inline static void Toggle() { T::Toggle(pinNum) ; } } ;</span></span></code> </pre> <br> ç°åœ¨ï¼Œä»…å½“æˆ‘ä»¬çš„ç±»å…·æœ‰åŸºç±»<code>PortBase</code>å®ä¾‹åŒ–æ¨¡æ¿ã€‚ <br> ä»ç†è®ºä¸Šè®²ï¼Œæ‚¨å·²ç»å¯ä»¥ä½¿ç”¨è¿™äº›ç±»ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æ²¡æœ‰ä¼˜åŒ–ä¼šå‘ç”Ÿä»€ä¹ˆï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> PortA = Port&lt;GpioaBaseAddr&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> PortC = Port&lt;GpiocBaseAddr&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Led1 = Pin&lt;PortA, <span class="hljs-number"><span class="hljs-number">5</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Led2 = Pin&lt;PortC, <span class="hljs-number"><span class="hljs-number">5</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Led3 = Pin&lt;PortC, <span class="hljs-number"><span class="hljs-number">8</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Led4 = Pin&lt;PortC, <span class="hljs-number"><span class="hljs-number">9</span></span>&gt; ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(;;) { Led1::Toggle(); Led2::Toggle(); Led3::Toggle(); Led4::Toggle(); delay(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ; }</code> </pre> <br><blockquote>  271ä¸ªå­—èŠ‚çš„åªè¯»ä»£ç å­˜å‚¨å™¨ <br>  1å­—èŠ‚çš„åªè¯»æ•°æ®å­˜å‚¨å™¨ <br>  24å­—èŠ‚çš„è¯»å†™æ•°æ®å­˜å‚¨å™¨ </blockquote><br>  RAMä¸­é¢å¤–çš„16ä¸ªå­—èŠ‚å’ŒROMä¸­16ä¸ªå­—èŠ‚ä»ä½•è€Œæ¥ã€‚ å®ƒä»¬æ¥è‡ªä»¥ä¸‹äº‹å®ï¼šæˆ‘ä»¬å°†bitå‚æ•°ä¼ é€’ç»™Portç±»çš„Toggleå‡½æ•°ï¼ˆconst std :: uint8_tä½ï¼‰ï¼Œå¹¶ä¸”ç¼–è¯‘å™¨åœ¨è¾“å…¥mainå‡½æ•°æ—¶ä¼šåœ¨è¯¥å‚æ•°é€šè¿‡çš„å †æ ˆä¸Šä¿å­˜4ä¸ªå…¶ä»–å¯„å­˜å™¨ï¼Œç„¶åä½¿ç”¨å®ƒä»¬å¯„å­˜å™¨ä¸­å­˜å‚¨äº†æ¯ä¸ªå¼•è„šçš„è„šç¼–å·çš„å€¼ï¼Œå¹¶åœ¨ç¦»å¼€ä¸»ç”µæºæ—¶ä»å †æ ˆä¸­æ¢å¤äº†è¿™äº›å¯„å­˜å™¨ã€‚ è€Œä¸”ï¼Œå°½ç®¡ä»æœ¬è´¨ä¸Šè®²è¿™æ˜¯æŸç§å®Œå…¨æ²¡ç”¨çš„å·¥ä½œï¼Œä½†æ˜¯ç”±äºè¿™äº›å‡½æ•°æ˜¯å†…ç½®çš„ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨çš„è¡Œä¸ºå®Œå…¨ç¬¦åˆè¯¥æ ‡å‡†ã€‚ <br> æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ¶ˆé™¤æ­¤é—®é¢˜ï¼šé€šå¸¸åˆ é™¤ç«¯å£ç±»ï¼Œå°†ç«¯å£åœ°å€ä½œä¸º<code>Pin</code>ç±»çš„æ¨¡æ¿å‚æ•°ä¼ é€’ï¼Œå¹¶åœ¨<code>Toggle()</code>æ–¹æ³•å†…éƒ¨ï¼Œè®¡ç®—ODRå¯„å­˜å™¨çš„åœ°å€ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> OdrAddrShift = <span class="hljs-number"><span class="hljs-number">20U</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> addr, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> pinNum, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pin</span></span></span><span class="hljs-class"> {</span></span> __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Toggle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ *<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span>*&gt;(addr + OdrAddrShift ) ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; bit) ; } } ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Led1 = Pin&lt;GpioaBaseAddr, <span class="hljs-number"><span class="hljs-number">5</span></span>&gt; ;</code> </pre> <br> ä½†æ˜¯ï¼Œè¿™çœ‹èµ·æ¥ä¸æ˜¯å¾ˆå¥½ï¼Œå¹¶ä¸”ç”¨æˆ·å‹å¥½ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›ç¼–è¯‘å™¨é€šè¿‡ä¸€äº›ä¼˜åŒ–æ¥æ¶ˆé™¤è¿™ç§ä¸å¿…è¦çš„å¯„å­˜å™¨ä¿å­˜ã€‚ <br><br> æˆ‘ä»¬å¯¹Mediumè¿›è¡Œä¼˜åŒ–ï¼Œç„¶åçœ‹åˆ°ç»“æœï¼š <br><blockquote>  251ä¸ªå­—èŠ‚çš„åªè¯»ä»£ç å­˜å‚¨å™¨ <br>  1å­—èŠ‚çš„åªè¯»æ•°æ®å­˜å‚¨å™¨ <br>  8å­—èŠ‚çš„è¯»å†™æ•°æ®å­˜å‚¨å™¨ </blockquote><br> å“‡å“‡...å°‘äº†4ä¸ªå­—èŠ‚ <div class="spoiler">  <b class="spoiler_title">ä»£å·</b> <div class="spoiler_text"><blockquote>  255ä¸ªå­—èŠ‚çš„åªè¯»ä»£ç å­˜å‚¨å™¨ <br>  1å­—èŠ‚çš„åªè¯»æ•°æ®å­˜å‚¨å™¨ <br>  8å­—èŠ‚çš„è¯»å†™æ•°æ®å­˜å‚¨å™¨ </blockquote><br></div></div><br> æ€ä¹ˆä¼šè¿™æ · è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è°ƒè¯•å™¨ä¸­çš„C ++ä»£ç ï¼ˆå·¦ï¼‰å’ŒCä»£ç ï¼ˆå³ï¼‰çš„æ±‡ç¼–å™¨ï¼š <br><br><img src="https://habrastorage.org/webt/vh/ym/d9/vhymd9hbcko9luonsasg-xz7w7e.png" alt="å›¾ç‰‡"><br><br> å¯ä»¥çœ‹å‡ºï¼Œé¦–å…ˆï¼Œç¼–è¯‘å™¨å†…ç½®äº†æ‰€æœ‰åŠŸèƒ½ï¼Œç°åœ¨æ ¹æœ¬æ²¡æœ‰è°ƒç”¨ï¼Œå…¶æ¬¡ï¼Œå®ƒä¼˜åŒ–äº†å¯„å­˜å™¨çš„ä½¿ç”¨ã€‚ å¯ä»¥çœ‹å‡ºï¼Œåœ¨ä½¿ç”¨Cä»£ç çš„æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä½¿ç”¨R1æˆ–R2å¯„å­˜å™¨å­˜å‚¨ç«¯å£åœ°å€ï¼Œå¹¶åœ¨æ¯æ¬¡åˆ‡æ¢è¯¥ä½æ—¶æ‰§è¡Œå…¶ä»–æ“ä½œï¼ˆå°†åœ°å€ä¿å­˜åœ¨R1æˆ–R2ä¸­çš„å¯„å­˜å™¨ä¸­ï¼‰ã€‚ åœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œå®ƒä»…ä½¿ç”¨R1å¯„å­˜å™¨ï¼Œå¹¶ä¸”ç”±äºæœ€å3ä¸ªè°ƒç”¨æ€»æ˜¯ä»ç«¯å£Cè¿›è¡Œçš„ï¼Œå› æ­¤ä¸å†éœ€è¦åœ¨å¯„å­˜å™¨ä¸­ä¿å­˜ç›¸åŒçš„ç«¯å£Cåœ°å€ã€‚ ç»“æœï¼ŒèŠ‚çœäº†2ä¸ªå›¢é˜Ÿå’Œ4ä¸ªå­—èŠ‚ã€‚ <br><br> è¿™æ˜¯ç°ä»£ç¼–è¯‘å™¨çš„å¥‡è¿¹ï¼š)å¥½å§ï¼Œå¥½å§ã€‚ åŸåˆ™ä¸Šï¼Œå¯ä»¥åœåœ¨é‚£é‡Œï¼Œä½†è®©æˆ‘ä»¬ç»§ç»­å‰è¿›ã€‚ æˆ‘è®¤ä¸ºä¸å¯èƒ½ä¼˜åŒ–å…¶ä»–ä»»ä½•ä¸œè¥¿ï¼Œå°½ç®¡å¯èƒ½ä¸æ­£ç¡®ï¼Œå¦‚æœæ‚¨æœ‰æƒ³æ³•ï¼Œè¯·åœ¨è¯„è®ºä¸­å†™ä¸‹ã€‚ ä½†æ˜¯æœ‰äº†mainï¼ˆï¼‰ä¸­çš„å¤§é‡ä»£ç ï¼Œæ‚¨å°±å¯ä»¥å·¥ä½œã€‚ <br><br> ç°åœ¨ï¼Œæˆ‘å¸Œæœ›æ‰€æœ‰çš„LEDéƒ½ä½äºå®¹å™¨ä¸­çš„æŸä¸ªä½ç½®ï¼Œæ‚¨å¯ä»¥è°ƒç”¨è¯¥æ–¹æ³•ï¼Œåˆ‡æ¢æ‰€æœ‰å†…å®¹...åƒè¿™æ ·ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(;;) { LedsContainer::ToggleAll() ; delay(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ; }</code> </pre> <br> æˆ‘ä»¬ä¸ä¼šæ„šè ¢åœ°å°†4ä¸ªLEDçš„å¼€å…³æ’å…¥åˆ°LedsContainer :: ToggleAllå‡½æ•°ä¸­ï¼Œå› ä¸ºè¿™å¹¶ä¸æœ‰è¶£ï¼š)ã€‚ æˆ‘ä»¬å¸Œæœ›å°†LEDæ”¾å…¥å®¹å™¨ä¸­ï¼Œç„¶åå¯¹å®ƒä»¬è¿›è¡Œéå†å¹¶åœ¨æ¯ä¸ªLEDä¸Šè°ƒç”¨Toggleï¼ˆï¼‰æ–¹æ³•ã€‚ <br><br>  <i>å­¦ç”Ÿä½¿ç”¨æ•°ç»„å­˜å‚¨æŒ‡å‘LEDçš„æŒ‡é’ˆã€‚</i> ä½†æ˜¯æˆ‘æœ‰ä¸åŒçš„ç±»å‹ï¼Œä¾‹å¦‚ï¼š <code>Pin&lt;PortA, 5&gt;</code> ï¼Œ <code>Pin&lt;PortC, 5&gt;</code> ï¼Œå¹¶ä¸”æˆ‘æ— æ³•åœ¨æ•°ç»„ä¸­å­˜å‚¨æŒ‡å‘ä¸åŒç±»å‹çš„æŒ‡é’ˆã€‚ æ‚¨å¯ä»¥ä¸ºæ‰€æœ‰Pinåšä¸€ä¸ªè™šæ‹Ÿçš„åŸºç¡€ç­ï¼Œä½†æ˜¯éšåä¼šå‡ºç°ä¸€ä¸ªè™šæ‹ŸåŠŸèƒ½è¡¨ï¼Œæˆ‘ä¸ä¼šæˆåŠŸèµ¢å¾—å­¦ç”Ÿã€‚ <br><br> å› æ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å…ƒç»„ã€‚ å®ƒå…è®¸æ‚¨å­˜å‚¨ä¸åŒç±»å‹çš„å¯¹è±¡ã€‚ è¿™ç§æƒ…å†µå°†å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LedsContainer</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> records = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::make_tuple ( Pin&lt;PortA, <span class="hljs-number"><span class="hljs-number">5</span></span>&gt;{}, Pin&lt;PortC, <span class="hljs-number"><span class="hljs-number">5</span></span>&gt;{}, Pin&lt;PortC, <span class="hljs-number"><span class="hljs-number">8</span></span>&gt;{}, Pin&lt;PortC, <span class="hljs-number"><span class="hljs-number">9</span></span>&gt;{} ) ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> tRecordsTuple = <span class="hljs-keyword"><span class="hljs-keyword">decltype</span></span>(records) ; }</code> </pre> <br> æœ‰ä¸€ä¸ªå¾ˆæ£’çš„å®¹å™¨ï¼Œå®ƒå­˜å‚¨æ‰€æœ‰LEDã€‚ ç°åœ¨å‘å…¶ä¸­æ·»åŠ <code>ToggleAll()</code>æ–¹æ³•ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LedsContainer</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToggleAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//        } private: constexpr static auto records = std::make_tuple ( Pin&lt;PortA, 5&gt;{}, Pin&lt;PortC, 5&gt;{}, Pin&lt;PortC, 8&gt;{}, Pin&lt;PortC, 9&gt;{} ) ; using tRecordsTuple = decltype(records) ; }</span></span></code> </pre> <br> æ‚¨ä¸èƒ½åªéå†å…ƒç»„çš„å…ƒç´ ï¼Œå› ä¸ºå…ƒç»„å…ƒç´ åªèƒ½åœ¨ç¼–è¯‘é˜¶æ®µæ¥æ”¶ã€‚ è¦è®¿é—®å…ƒç»„çš„å…ƒç´ ï¼Œæœ‰ä¸€ä¸ªæ¨¡æ¿getæ–¹æ³•ã€‚ å¥½å§ å¦‚æœæˆ‘ä»¬è¿™æ ·ç¼–å†™<code>std::get&lt;0&gt;(records).Toggle()</code> ï¼Œåˆ™å¦‚æœ<code>std::get&lt;1&gt;(records).Toggle()</code> ï¼Œåˆ™å¯¹ç±»<code>Pin&lt;PortA, 5&gt;</code>çš„å¯¹è±¡è°ƒç”¨<code>Toggle()</code>æ–¹æ³•ã€‚ç„¶åä¸ºç±»<code>Pin&lt;Port, 5&gt;</code>çš„å¯¹è±¡è°ƒç”¨<code>Toggle()</code>æ–¹æ³•ï¼Œä¾æ­¤ç±»æ¨... <br><br> æ‚¨å¯ä»¥<s>æ“¦æ‹­å­¦ç”Ÿçš„é¼»å­</s> ï¼Œåªéœ€å†™ä¸‹ï¼š <br><br><pre> <code class="cpp hljs"> __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToggleAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::get&lt;<span class="hljs-number"><span class="hljs-number">0</span></span>&gt;(records).Toggle(); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::get&lt;<span class="hljs-number"><span class="hljs-number">1</span></span>&gt;(records).Toggle(); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::get&lt;<span class="hljs-number"><span class="hljs-number">2</span></span>&gt;(records).Toggle(); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::get&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>&gt;(records).Toggle(); }</code> </pre> <br> ä½†æ˜¯æˆ‘ä»¬ä¸æƒ³è®©æ”¯æŒè¯¥ä»£ç å¹¶å…è®¸ä»–åšæ›´å¤šå·¥ä½œçš„ç¨‹åºå‘˜è´¹åŠ²ï¼Œä¾‹å¦‚åœ¨å‡ºç°å¦ä¸€ä¸ªLEDçš„æƒ…å†µä¸‹ï¼ŒèŠ±æ‰ä»–å…¬å¸çš„èµ„æºã€‚ æ‚¨å°†ä¸å¾—ä¸åœ¨å…ƒç»„å’Œæ­¤æ–¹æ³•çš„ä¸¤ä¸ªä½ç½®æ·»åŠ ä»£ç -è¿™æ ·åšä¸å¥½ï¼Œå¹¶ä¸”å…¬å¸æ‰€æœ‰è€…ä¸ä¼šéå¸¸æ»¡æ„ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨è¾…åŠ©æ–¹æ³•ç»•è¿‡å…ƒç»„ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LedsContainer</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">friend</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToggleAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    3,2,1,0    ,     visit(std::make_index_sequence&lt;std::tuple_size&lt;tRecordsTuple&gt;::value&gt;()); } private: __forceinline template&lt;std::size_t... index&gt; static inline void visit(std::index_sequence&lt;index...&gt;) { Pass((std::get&lt;index&gt;(records).Toggle(), true)...); //    get&lt;3&gt;(records).Toggle(), get&lt;2&gt;(records).Toggle(), get&lt;1&gt;(records).Toggle(), get&lt;0&gt;(records).Toggle() } __forceinline template&lt;typename... Args&gt; static void inline Pass(Args... ) {//      } constexpr static auto records = std::make_tuple ( Pin&lt;PortA, 5&gt;{}, Pin&lt;PortC, 5&gt;{}, Pin&lt;PortC, 8&gt;{}, Pin&lt;PortC, 9&gt;{} ) ; using tRecordsTuple = decltype(records) ; }</span></span></code> </pre> <br> å®ƒçœ‹èµ·æ¥å¾ˆå“äººï¼Œä½†æˆ‘åœ¨æ–‡ç« å¼€å¤´è­¦å‘Šè¯´<s>shizany</s>æ–¹æ³•ä¸æ˜¯å¾ˆæ™®é€š... <br><br> åœ¨ç¼–è¯‘é˜¶æ®µï¼Œä»¥ä¸Šæ‰€æœ‰è¿™äº›é­”æœ¯å®é™…ä¸Šæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  LedsContainer::ToggleAll() ; //   4 : Pin&lt;Port, 9&gt;().Toggle() ; Pin&lt;Port, 8&gt;().Toggle() ; Pin&lt;PortC, 5&gt;().Toggle() ; Pin&lt;PortA, 5&gt;().Toggle() ; //     Toggle() inline,   : *reinterpret_cast&lt;std::uint32_t*&gt;(0x40020814 ) ^= (1 &lt;&lt; 9) ; *reinterpret_cast&lt;std::uint32_t*&gt;(0x40020814 ) ^= (1 &lt;&lt; 8) ; *reinterpret_cast&lt;std::uint32_t*&gt;(0x40020814 ) ^= (1 &lt;&lt; 5) ; *reinterpret_cast&lt;std::uint32_t*&gt;(0x40020014 ) ^= (1 &lt;&lt; 5) ;</span></span></code> </pre> <br> ç»§ç»­ç¼–è¯‘å¹¶æ£€æŸ¥ä»£ç å¤§å°ï¼Œæ— éœ€ä¼˜åŒ–ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">ç¼–è¯‘çš„ä»£ç </b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;cstddef&gt; #include &lt;tuple&gt; #include &lt;utility&gt; #include &lt;cstdint&gt; #include &lt;type_traits&gt; //#include "stm32f411xe.h" #define __forceinline _Pragma("inline=forced") constexpr std::uint32_t GpioaBaseAddr = 0x4002'0000 ; constexpr std::uint32_t GpiocBaseAddr = 0x4002'0800 ; constexpr std::uint32_t OdrAddrShift = 20U; struct PortBase { }; template &lt;std::uint32_t addr&gt; struct Port: PortBase { __forceinline inline static void Toggle(const std::uint8_t bit) { *reinterpret_cast&lt;std::uint32_t*&gt;(addr + OdrAddrShift) ^= (1 &lt;&lt; bit) ; } }; template &lt;typename T, std::uint8_t pinNum, class = typename std::enable_if_t&lt;std::is_base_of&lt;PortBase, T&gt;::value&gt;&gt; struct Pin { __forceinline inline static void Toggle() { T::Toggle(pinNum) ; } } ; using PortA = Port&lt;GpioaBaseAddr&gt; ; using PortC = Port&lt;GpiocBaseAddr&gt; ; //using Led1 = Pin&lt;PortA, 5&gt; ; //using Led2 = Pin&lt;PortC, 5&gt; ; //using Led3 = Pin&lt;PortC, 8&gt; ; //using Led4 = Pin&lt;PortC, 9&gt; ; class LedsContainer { friend int main() ; public: __forceinline static inline void ToggleAll() { //    3,2,1,0    ,     visit(std::make_index_sequence&lt;std::tuple_size&lt;tRecordsTuple&gt;::value&gt;()); } private: __forceinline template&lt;std::size_t... index&gt; static inline void visit(std::index_sequence&lt;index...&gt;) { Pass((std::get&lt;index&gt;(records).Toggle(), true)...); } __forceinline template&lt;typename... Args&gt; static void inline Pass(Args... ) { } constexpr static auto records = std::make_tuple ( Pin&lt;PortA, 5&gt;{}, Pin&lt;PortC, 5&gt;{}, Pin&lt;PortC, 8&gt;{}, Pin&lt;PortC, 9&gt;{} ) ; using tRecordsTuple = decltype(records) ; } ; void delay() { for (int i = 0; i &lt; 1000000; ++i){ } } int main() { for(;;) { LedsContainer::ToggleAll() ; //GPIOA-&gt;ODR ^= 1 &lt;&lt; 5; //GPIOC-&gt;ODR ^= 1 &lt;&lt; 5; //GPIOC-&gt;ODR ^= 1 &lt;&lt; 8; //GPIOC-&gt;ODR ^= 1 &lt;&lt; 9; delay(); } return 0 ; }</span></span></span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">ç»„è£…è¯æ˜ï¼ŒæŒ‰è®¡åˆ’åŒ…è£…ï¼š</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/0e/aa/un/0eaaunh1qwmg73s1p-3ev4zcpws.png" alt="å›¾ç‰‡"><br></div></div><br> æˆ‘ä»¬çœ‹åˆ°å†…å­˜è¿‡å¤§ï¼Œå¤šäº†18ä¸ªå­—èŠ‚ã€‚ é—®é¢˜æ˜¯ç›¸åŒçš„ï¼Œå†åŠ ä¸Š12ä¸ªå­—èŠ‚ã€‚ æˆ‘ä¸çŸ¥é“å®ƒä»¬çš„æ¥æº...ä¹Ÿè®¸æœ‰äººä¼šè§£é‡Šã€‚ <br><blockquote>  283å­—èŠ‚çš„åªè¯»ä»£ç å­˜å‚¨å™¨ <br>  1å­—èŠ‚çš„åªè¯»æ•°æ®å­˜å‚¨å™¨ <br>  24å­—èŠ‚çš„è¯»å†™æ•°æ®å­˜å‚¨å™¨ </blockquote><br> ç°åœ¨ï¼Œåœ¨â€œåª’ä»‹ä¼˜åŒ–â€å’Œâ€œç§ç§â€ä¸Šä¹Ÿæœ‰åŒæ ·çš„äº‹æƒ…â€¦â€¦æˆ‘ä»¬åœ¨é¢å¤´ä¸Šè·å¾—çš„ä»£ç ä¸C ++å®ç°å®Œå…¨ç›¸åŒï¼Œè€Œåœ¨Cä»£ç æ–¹é¢åˆ™æ›´ä¸ºä¼˜åŒ–ã€‚ <br><blockquote>  251ä¸ªå­—èŠ‚çš„åªè¯»ä»£ç å­˜å‚¨å™¨ <br>  1å­—èŠ‚çš„åªè¯»æ•°æ®å­˜å‚¨å™¨ <br>  8å­—èŠ‚çš„è¯»å†™æ•°æ®å­˜å‚¨å™¨ </blockquote><br><div class="spoiler">  <b class="spoiler_title">ç»„è£…å·¥</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/y4/7w/l9/y47wl95frzmeyb2brdekbnvqvr8.png" alt="å›¾ç‰‡"><br></div></div><br> å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘èµ¢äº†ï¼Œ <s>å»äº†åŠ é‚£åˆ©ç¾¤å²›</s> ï¼Œå¾ˆé«˜å…´åœ¨è½¦é‡Œé›…å®¾æ–¯å…‹ä¼‘æ¯:)ï¼Œä½†æ˜¯å­¦ç”Ÿä»¬ä¹Ÿå¾ˆæ£’ï¼Œä»–ä»¬é¡ºåˆ©é€šè¿‡äº†è€ƒè¯•ï¼ <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è°åœ¨ä¹ï¼Œä»£ç åœ¨è¿™é‡Œ</a> <br><br> å¥½çš„ï¼Œæˆ‘åœ¨å“ªé‡Œå¯ä»¥ä½¿ç”¨å®ƒï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨EEPROMå­˜å‚¨å™¨ä¸­æœ‰å‚æ•°ï¼Œå¹¶æè¿°äº†è¿™äº›å‚æ•°çš„ç±»ï¼ˆè¯»å–ï¼Œå†™å…¥ï¼Œåˆå§‹åŒ–ä¸ºåˆå§‹å€¼ï¼‰ã€‚ è¯¥ç±»æ˜¯æ¨¡æ¿ï¼Œä¾‹å¦‚<code>Param&lt;float&lt;&gt;&gt;</code>å’Œ<code>Param&lt;int&lt;&gt;&gt;</code> ï¼Œä¾‹å¦‚ï¼Œæ‚¨éœ€è¦å°†æ‰€æœ‰å‚æ•°é‡ç½®ä¸ºé»˜è®¤å€¼ã€‚ ç”±äºç±»å‹ä¸åŒï¼Œåœ¨è¿™é‡Œå¯ä»¥å°†å®ƒä»¬å…¨éƒ¨æ”¾å…¥ä¸€ä¸ªå…ƒç»„ä¸­ï¼Œå¹¶åœ¨æ¯ä¸ªå‚æ•°ä¸Šè°ƒç”¨<code>SetToDefault()</code>æ–¹æ³•ã€‚ çš„ç¡®ï¼Œå¦‚æœæœ‰100ä¸ªè¿™æ ·çš„å‚æ•°ï¼Œåˆ™ROMå°†åƒå¾ˆå¤šï¼Œä½†RAMä¸ä¼šå—åˆ°å½±å“ã€‚ <br><br>  PSæˆ‘å¿…é¡»æ‰¿è®¤ï¼Œåœ¨æœ€å¤§ç¨‹åº¦åœ°ä¼˜åŒ–ä¹‹åï¼Œæ­¤ä»£ç çš„å¤§å°ä¸Cå’Œæˆ‘çš„è§£å†³æ–¹æ¡ˆä¸­çš„ä»£ç ç›¸åŒã€‚ ç¨‹åºå‘˜æ”¹å–„ä»£ç çš„æ‰€æœ‰åŠªåŠ›éƒ½å½’ç»“ä¸ºåŒä¸€æ±‡ç¼–ä»£ç ã€‚ <br><br>  P.S1è°¢è°¢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">0xd34df00d</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">è‰¯å¥½</a>å»ºè®®ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨<code>std::apply()</code>ç®€åŒ–å¯¹å…ƒç»„çš„æ‹†åŒ…ã€‚  <code>ToggleAll()</code>çš„åŠŸèƒ½ä»£ç ç„¶åç®€åŒ–ä¸ºï¼š <br><br><pre> <code class="cpp hljs"> __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToggleAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::apply([](<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>... args) { (args.Toggle(), ...); }, records); }</code> </pre> <br> ä¸å¹¸çš„æ˜¯ï¼Œåœ¨IARä¸­ï¼Œå½“å‰ç‰ˆæœ¬å°šæœªå®ç°std :: applyï¼Œä½†å®ƒä¹Ÿå¯ä»¥æ­£å¸¸å·¥ä½œï¼Œè¯·å‚é˜…<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">std :: applyçš„å®ç°</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN457246/">https://habr.com/ru/post/zh-CN457246/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN457224/index.html">Androidä¸­ç«äº‰çš„ç°ä»£æ–¹æ³•ï¼šKotlinçš„Corotins</a></li>
<li><a href="../zh-CN457232/index.html">æœºå™¨äººâ€œå¤§é»„èœ‚â€-å›½é™…ç©ºé—´ç«™å†…çš„é¦–æ¬¡è¯•é£</a></li>
<li><a href="../zh-CN457234/index.html">äº§å“è®¤çŸ¥åå·®</a></li>
<li><a href="../zh-CN457236/index.html">ITå…¬å¸å¦‚ä½•åŠªåŠ›é”€å”®éŸ³ä¹</a></li>
<li><a href="../zh-CN457240/index.html">æœ¬å‘¨æ–°é—»ï¼šç¥ç»ç½‘ç»œå’Œæ‹ç…§å›¾åƒï¼ŒYandexè‚¡ä»½çš„å¢é•¿ï¼Œåä¸ºéœ€è¦10äº¿ç¾å…ƒçš„ä¸“åˆ©</a></li>
<li><a href="../zh-CN457248/index.html">è½¦åºŠçš„JavaScriptç¼–ç¨‹</a></li>
<li><a href="../zh-CN457250/index.html">Vue.jsçš„é»‘æš—æ—¥å­</a></li>
<li><a href="../zh-CN457254/index.html">303å·ç§»åŠ¨å¼€å‘äººå‘˜çš„æœ‰è¶£ææ–™æ‘˜è¦ï¼ˆ6æœˆ17æ—¥è‡³23æ—¥ï¼‰</a></li>
<li><a href="../zh-CN457256/index.html">äº’è”ç½‘å†å²è®°å½•ï¼šARPANET-è½¯ä»¶åŒ…</a></li>
<li><a href="../zh-CN457258/index.html">æµ·ç›—æ¹¾æœ‰15å¹´äº†ï¼Œæ— æ³•æ€æ­»</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>