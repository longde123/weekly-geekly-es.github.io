<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ•µğŸ¾ ğŸ¥‘ ğŸ¨ ä½¿ç”¨ReactiveUIå’ŒAvaloniaçš„ç¤ºä¾‹åœ¨è·¨å¹³å°.NET Coreåº”ç”¨ç¨‹åºä¸­å¯¼èˆªå¹¶å°†çŠ¶æ€ä¿å­˜åˆ°ç£ç›˜ ğŸ˜ ğŸ‘œ ğŸ†’</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç°ä»£åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ç•Œé¢é€šå¸¸å¾ˆå¤æ‚-é€šå¸¸æœ‰å¿…è¦å®ç°é¡µé¢å¯¼èˆªæ”¯æŒï¼Œå¤„ç†å„ç§è¾“å…¥å­—æ®µä»¥åŠåŸºäºç”¨æˆ·é€‰æ‹©çš„å‚æ•°æ˜¾ç¤ºæˆ–éšè—ä¿¡æ¯ã€‚ åŒæ—¶ï¼Œä¸ºäº†æ”¹å–„UXï¼Œåº”ç”¨ç¨‹åºå¿…é¡»åœ¨æŒ‚èµ·æˆ–å…³é—­æœŸé—´å°†æ¥å£å…ƒç´ çš„çŠ¶æ€ä¿å­˜åˆ°ç£ç›˜ï¼Œå¹¶åœ¨é‡æ–°å¯åŠ¨ç¨‹åºæ—¶ä»ç£ç›˜æ¢å¤çŠ¶æ€ã€‚ 


 ReactiveUI MVVMæ¡†æ¶å»ºè®®é€šè¿‡åœ¨ç¨‹åºæš‚åœæ—¶å¯¹è¡¨ç¤ºæ¨¡...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨ReactiveUIå’ŒAvaloniaçš„ç¤ºä¾‹åœ¨è·¨å¹³å°.NET Coreåº”ç”¨ç¨‹åºä¸­å¯¼èˆªå¹¶å°†çŠ¶æ€ä¿å­˜åˆ°ç£ç›˜</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457164/"><p><img src="https://habrastorage.org/webt/tu/lv/gl/tulvgli1xkcq1jqef9m91o_caxe.png"><br></p><br><p>ç°ä»£åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ç•Œé¢é€šå¸¸å¾ˆå¤æ‚-é€šå¸¸æœ‰å¿…è¦å®ç°é¡µé¢å¯¼èˆªæ”¯æŒï¼Œå¤„ç†å„ç§è¾“å…¥å­—æ®µä»¥åŠåŸºäºç”¨æˆ·é€‰æ‹©çš„å‚æ•°æ˜¾ç¤ºæˆ–éšè—ä¿¡æ¯ã€‚ åŒæ—¶ï¼Œä¸ºäº†æ”¹å–„UXï¼Œåº”ç”¨ç¨‹åºå¿…é¡»åœ¨æŒ‚èµ·æˆ–å…³é—­æœŸé—´å°†æ¥å£å…ƒç´ çš„çŠ¶æ€ä¿å­˜åˆ°ç£ç›˜ï¼Œå¹¶åœ¨é‡æ–°å¯åŠ¨ç¨‹åºæ—¶ä»ç£ç›˜æ¢å¤çŠ¶æ€ã€‚ </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ReactiveUI</a> MVVMæ¡†æ¶å»ºè®®é€šè¿‡åœ¨ç¨‹åºæš‚åœæ—¶å¯¹è¡¨ç¤ºæ¨¡å‹çš„å›¾å½¢è¿›è¡Œåºåˆ—åŒ–æ¥ä¿ç•™åº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼Œè€Œå¯¹äºæ¡†æ¶å’Œå¹³å°è€Œè¨€ï¼Œç¡®å®šæš‚åœæ—¶é—´çš„æœºåˆ¶æ˜¯ä¸åŒçš„ã€‚ å› æ­¤ï¼Œå¯¹äºWPFï¼Œå¯¹äºXamarin.Android- <code>ActivityPaused</code> ï¼Œå¯¹äºXamarin.iOS- <code>DidEnterBackground</code> ï¼Œå¯¹äºUWP- <code>OnLaunched</code>é‡è½½éƒ½ä½¿ç”¨<code>Exit</code>äº‹ä»¶ã€‚ </p><br><p> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Avalonia</a>è·¨å¹³å°GUIæ¡†æ¶<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ä¸ºä¾‹</a> ï¼Œè€ƒè™‘ä½¿ç”¨ReactiveUIé€šè¿‡GUIä¿å­˜å’Œæ¢å¤è½¯ä»¶çŠ¶æ€ï¼ŒåŒ…æ‹¬è·¯ç”±å™¨çŠ¶æ€ã€‚ è¯¥ææ–™å‡å®šè¯»è€…å¯¹CVMè¯­è¨€å’Œ.NETå¹³å°ä¸­<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çš„MVVMè®¾è®¡æ¨¡å¼</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ååº”å¼ç¼–ç¨‹</a>æœ‰åŸºæœ¬çš„äº†è§£ã€‚ æœ¬æ–‡ä¸­çš„æ­¥éª¤é€‚ç”¨äºWindows 10å’ŒUbuntu 18ã€‚ </p><a name="habracut"></a><br><h2 id="sozdanie-proekta"> é¡¹ç›®åˆ›å»º </h2><br><p> è¦å°è¯•å®é™…è¿›è¡Œè·¯ç”±ï¼Œè¯·ä»Avaloniaæ¨¡æ¿åˆ›å»ºä¸€ä¸ªæ–°çš„.NET Coreé¡¹ç›®ï¼Œå®‰è£…<code>Avalonia.ReactiveUI</code>ç¨‹åºåŒ…-Avaloniaå’ŒReactiveUIé›†æˆçš„è–„å±‚ã€‚ å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿å·²å®‰è£…<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">.NET Core SDK</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">git</a> ã€‚ </p><br><pre> <code class="plaintext hljs">git clone https://github.com/AvaloniaUI/avalonia-dotnet-templates git --git-dir ./avalonia-dotnet-templates/.git checkout 9263c6b dotnet new --install ./avalonia-dotnet-templates dotnet new avalonia.app -o ReactiveUI.Samples.Suspension cd ./ReactiveUI.Samples.Suspension dotnet add package Avalonia.ReactiveUI dotnet add package Avalonia.Desktop dotnet add package Avalonia</code> </pre> <br><p> ç¡®ä¿åº”ç”¨ç¨‹åºå¯åŠ¨å¹¶æ˜¾ç¤ºä¸€ä¸ªçª—å£ï¼Œæ˜¾ç¤ºæ¬¢è¿ä½¿ç”¨Avaloniaï¼ </p><br><pre> <code class="plaintext hljs"># Use .NET Core version which you have installed. # It can be netcoreapp2.0, netcoreapp2.1 and so on. dotnet run --framework netcoreapp3.0</code> </pre> <br><p><img src="https://habrastorage.org/webt/bn/84/7b/bn847bgygv5j5awbdb_0pvipoyq.png" width="400"><br></p><br><h2 id="podklyuchenie-predvaritelnyh-sborok-avalonia-iz-myget"> ä»MyGetè¿æ¥Avaloniaé¢„æ„å»º </h2><br><p> è¦è¿æ¥å¹¶ä½¿ç”¨å½“<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">GitHubä¸Š</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><code>nuget.config</code></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">å­˜å‚¨åº“</a> <code>master</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">åˆ†æ”¯</a>æ›´æ”¹æ—¶è‡ªåŠ¨å‘å¸ƒåˆ°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">MyGet</a>çš„æœ€æ–°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Avalonia</a>æ„å»ºï¼Œæˆ‘ä»¬ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><code>nuget.config</code></a>åŒ…æºé…ç½®æ–‡ä»¶ã€‚ ä¸ºäº†ä½¿IDEå’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">.NET Core CLI</a>æŸ¥çœ‹<code>nuget.config</code> ï¼Œæ‚¨éœ€è¦ä¸ºä¸Šé¢åˆ›å»ºçš„é¡¹ç›®ç”Ÿæˆä¸€ä¸ª<code>sln</code>æ–‡ä»¶ã€‚ æˆ‘ä»¬ä½¿ç”¨.NET Core CLIçš„å·¥å…·ï¼š </p><br><pre> <code class="plaintext hljs">dotnet new sln # Ctrl+C dotnet sln ReactiveUI.Samples.Suspension.sln add ReactiveUI.Samples.Suspension.csproj</code> </pre> <br><p> åœ¨åŒ…å«ä»¥ä¸‹å†…å®¹çš„<code>.sln</code>æ–‡ä»¶çš„æ–‡ä»¶å¤¹ä¸­åˆ›å»º<code>nuget.config</code>æ–‡ä»¶ï¼š </p><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packageSources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AvaloniaCI"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://www.myget.org/F/avalonia-ci/api/v2"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packageSources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> æ‚¨å¯èƒ½éœ€è¦é‡æ–°å¯åŠ¨IDEï¼Œæˆ–å¸è½½å¹¶ä¸‹è½½æ•´ä¸ªè§£å†³æ–¹æ¡ˆã€‚ æˆ‘ä»¬å°†ä½¿ç”¨IDEçš„NuGetåŒ…ç®¡ç†å™¨ç•Œé¢ï¼Œæˆ–ä½¿ç”¨Windowså‘½ä»¤è¡Œå·¥å…·æˆ–Linuxç»ˆç«¯ï¼Œå°†AvaloniaåŒ…æ›´æ–°ä¸ºæ‰€éœ€ç‰ˆæœ¬ï¼ˆè‡³å°‘ä¸º<code>0.9.1</code> ï¼‰ã€‚ </p><br><pre> <code class="plaintext hljs">dotnet add package Avalonia.ReactiveUI --version 0.9.1 dotnet add package Avalonia.Desktop --version 0.9.1 dotnet add package Avalonia --version 0.9.1 cat ReactiveUI.Samples.Suspension.csproj</code> </pre> <br><p> ç°åœ¨ï¼Œ <code>ReactiveUI.Samples.Suspension.csproj</code>é¡¹ç›®æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Sdk</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Microsoft.NET.Sdk"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">OutputType</span></span></span><span class="hljs-tag">&gt;</span></span>WinExe<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">OutputType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TargetFramework</span></span></span><span class="hljs-tag">&gt;</span></span>netcoreapp3.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TargetFramework</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Compile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Update</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"**\*.xaml.cs"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DependentUpon</span></span></span><span class="hljs-tag">&gt;</span></span>%(Filename)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DependentUpon</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Compile</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">AvaloniaResource</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"**\*.xaml"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SubType</span></span></span><span class="hljs-tag">&gt;</span></span>Designer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SubType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">AvaloniaResource</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PackageReference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Avalonia"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.9.1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PackageReference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Avalonia.Desktop"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.9.1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PackageReference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Avalonia.ReactiveUI"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.9.1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Project</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­åˆ›å»º<code>Views/</code>å’Œ<code>ViewModels/</code>æ–‡ä»¶å¤¹ï¼Œä¸ºæ–¹ä¾¿èµ·è§ï¼Œå°†<code>MainWindow</code>ç±»åæ›´æ”¹ä¸º<code>MainView</code> ï¼Œå°†å…¶ç§»åŠ¨åˆ°<code>Views/</code>ç›®å½•ï¼Œç›¸åº”åœ°å°†åç§°ç©ºé—´æ›´æ”¹ä¸º<code>ReactiveUI.Samples.Suspension.Views</code> ã€‚  <code>App.xaml.cs</code> <code>Program.cs</code>å’Œ<code>App.xaml.cs</code>å†…å®¹-å°†<code>UseReactiveUI</code>è°ƒç”¨åº”ç”¨äº<code>UseReactiveUI</code>åº”ç”¨ç¨‹åºæ„å»ºå™¨ï¼Œå°†ä¸»è§†å›¾çš„åˆå§‹åŒ–ç§»åŠ¨åˆ°<code>OnFrameworkInitializationCompleted</code>ä»¥ç¬¦åˆåº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸç®¡ç†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">å»ºè®®</a> ï¼š </p><br><p>  <strong>Program.cs</strong> </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-comment"><span class="hljs-comment">//  .   API  Avalonia  , //  SynchronizationContext,    // OnFrameworkInitializationCompleted  App.xaml.cs:  //     -    . public static void Main(string[] args) =&gt; BuildAvaloniaApp() .StartWithClassicDesktopLifetime(args); //   Avalonia.    // ,      . public static AppBuilder BuildAvaloniaApp() =&gt; AppBuilder.Configure&lt;App&gt;() .UseReactiveUI() // ! .UsePlatformDetect() .LogToDebug(); }</span></span></code> </pre> <br><p>  <strong>App.xaml.cs</strong> </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span> : <span class="hljs-title"><span class="hljs-title">Application</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; AvaloniaXamlLoader.Load(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    .     //  MVVM , DI    .    //     ApplicationLifetime,    //     . public override void OnFrameworkInitializationCompleted() { new Views.MainView().Show(); base.OnFrameworkInitializationCompleted(); } }</span></span></code> </pre> <br><p> æ‚¨å°†éœ€è¦<code>using Avalonia.ReactiveUI</code>æ·»åŠ åˆ°<code>Program.cs</code> ã€‚ ç¡®ä¿æ›´æ–°è½¯ä»¶åŒ…åï¼Œé¡¹ç›®å¯åŠ¨å¹¶æ˜¾ç¤ºé»˜è®¤çš„æ¬¢è¿çª—å£ã€‚ </p><br><pre> <code class="plaintext hljs"># Use .NET Core version which you have installed. # It can be netcoreapp2.0, netcoreapp2.1 and so on. dotnet run --framework netcoreapp3.0</code> </pre> <br><p><img src="https://habrastorage.org/webt/bn/84/7b/bn847bgygv5j5awbdb_0pvipoyq.png" width="400"><br></p><br><h2 id="krossplatformennyy-routing-reactiveui"> è·¨å¹³å°è·¯ç”±ReactiveUI </h2><br><p> é€šå¸¸ï¼Œåœ¨.NETåº”ç”¨ç¨‹åºçš„é¡µé¢ä¹‹é—´å®ç°å¯¼èˆªçš„ä¸»è¦æ–¹æ³•æœ‰ä¸¤ç§ï¼šè§†å›¾ä¼˜å…ˆå’Œè§†å›¾æ¨¡å‹ä¼˜å…ˆã€‚ è§†å›¾ä¼˜å…ˆæ–¹æ³•æ¶‰åŠä»¥MVVMæœ¯è¯­åœ¨è§†å›¾çº§åˆ«æ§åˆ¶å¯¼èˆªå †æ ˆå’Œé¡µé¢ä¹‹é—´çš„å¯¼èˆª-ä¾‹å¦‚ï¼Œåœ¨UWPæˆ–WPFçš„æƒ…å†µä¸‹ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Frame</a>å’Œ<a href="" rel="nofollow">Page</a>ç±»ï¼Œè€Œåœ¨ä½¿ç”¨è§†å›¾æ¨¡å‹ä¼˜å…ˆæ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œå¯¼èˆªåœ¨è¡¨ç¤ºæ¨¡å‹çº§åˆ«å®ç°ã€‚ åœ¨åº”ç”¨ç¨‹åºä¸­ç»„ç»‡è·¯ç”±çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ReactiveUI</a>å·¥å…·ä¸“æ³¨äºä½¿ç”¨è§†å›¾æ¨¡å‹ä¼˜å…ˆæ–¹æ³•ã€‚  ReactiveUIè·¯ç”±åŒ…æ‹¬ä¸€ä¸ªåŒ…å«è·¯ç”±å™¨çŠ¶æ€çš„<code>IRoutableViewModel</code>å®ç°<code>IRoutableViewModel</code>å¤šä¸ª<code>IRoutableViewModel</code>å®ç°ä»¥åŠ<code>RoutedViewHost</code>äºå¹³å°çš„XAMLæ§ä»¶<code>RoutedViewHost</code> ã€‚ </p><br><p><img width="600" src="https://habrastorage.org/webt/4s/7a/6_/4s7a6_gsiixrbgx3h5kf7leezcw.png"><br></p><br><p> è·¯ç”±å™¨çš„çŠ¶æ€ç”±æ§åˆ¶å¯¼èˆªå †æ ˆçš„<code>RoutingState</code>å¯¹è±¡è¡¨ç¤ºã€‚  <code>IScreen</code>æ˜¯å¯¼èˆªå †æ ˆçš„æ ¹ï¼Œåœ¨åº”ç”¨ç¨‹åºä¸­å¯èƒ½æœ‰å¤šä¸ªå¯¼èˆªæ ¹ã€‚  <code>RoutedViewHost</code>ç›‘è§†å…¶ç›¸åº”çš„<code>RoutingState</code>è·¯ç”±å™¨çš„çŠ¶æ€ï¼Œé€šè¿‡åµŒå…¥XAMLæ§ä»¶çš„ç›¸åº”<code>IRoutableViewModel</code>æ¥å“åº”å¯¼èˆªå †æ ˆä¸­çš„æ›´æ”¹ã€‚ ä¸‹é¢çš„ç¤ºä¾‹å°†è¯´æ˜æ‰€æè¿°çš„åŠŸèƒ½ã€‚ </p><br><h2 id="sohranenie-sostoyaniya-modeley-predstavleniya-na-disk"> å°†è§†å›¾æ¨¡å‹çš„çŠ¶æ€ä¿å­˜åˆ°ç£ç›˜ </h2><br><p> è€ƒè™‘ä¿¡æ¯æœç´¢å±å¹•çš„å…¸å‹ç¤ºä¾‹ã€‚ </p><br><p><img width="400" src="https://habrastorage.org/webt/ki/tk/o4/kitko4krrwapat8y9_bm0kcobky.png"><br></p><br><p> æˆ‘ä»¬å¿…é¡»å†³å®šåœ¨åº”ç”¨ç¨‹åºæš‚åœæˆ–å…³é—­æœŸé—´å°†å±å¹•è¡¨ç¤ºæ¨¡å‹çš„å“ªäº›å…ƒç´ ä¿å­˜åˆ°ç£ç›˜ï¼Œä»¥åŠåœ¨æ¯æ¬¡å¯åŠ¨æ—¶é‡æ–°åˆ›å»ºã€‚ æ— éœ€ä¿å­˜å®ç°<code>ICommand</code>æ¥å£å¹¶é™„åŠ åˆ°æŒ‰é’®<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">çš„ReactiveUIå‘½ä»¤</a>çš„çŠ¶æ€<code>ReactiveCommand&lt;TIn, TOut&gt;</code>åœ¨æ„é€ å‡½æ•°ä¸­åˆ›å»ºå’Œåˆå§‹åŒ–ï¼Œè€Œ<code>CanExecute</code>æŒ‡ç¤ºå™¨çš„çŠ¶æ€å–å†³äºè§†å›¾æ¨¡å‹çš„å±æ€§ï¼Œå¹¶åœ¨å®ƒä»¬æ›´æ”¹æ—¶é‡æ–°è®¡ç®—ã€‚ æ˜¯å¦éœ€è¦ä¿å­˜æœç´¢ç»“æœï¼ˆæœ‰äº‰è®®çš„ç‚¹ï¼‰å–å†³äºåº”ç”¨ç¨‹åºçš„å…·ä½“æƒ…å†µï¼Œä½†æ˜¯æ˜æ™ºçš„åšæ³•æ˜¯ä¿å­˜å’Œæ¢å¤<code>SearchQuery</code>è¾“å…¥å­—æ®µçš„çŠ¶æ€ï¼ </p><br><p>  <strong>ViewModels / SearchViewModel.cs</strong> </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">DataContract</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SearchViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">ReactiveObject</span></span>, <span class="hljs-title"><span class="hljs-title">IRoutableViewModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ReactiveCommand&lt;Unit, Unit&gt; _search; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _searchQuery; <span class="hljs-comment"><span class="hljs-comment">//   IScreen  ,   NULL //  IScreen  Splat.Locator.    //      . public SearchViewModel(IScreen screen = null) { HostScreen = screen ?? Locator.Current.GetService&lt;IScreen&gt;(); //     SearchQuery , //     . var canSearch = this .WhenAnyValue(x =&gt; x.SearchQuery) .Select(query =&gt; !string.IsNullOrWhiteSpace(query)); //      ,  //     . _search = ReactiveCommand.CreateFromTask( () =&gt; Task.Delay(1000), //    canSearch); } public IScreen HostScreen { get; } public string UrlPathSegment =&gt; "/search"; public ICommand Search =&gt; _search; [DataMember] public string SearchQuery { get =&gt; _searchQuery; set =&gt; this.RaiseAndSetIfChanged(ref _searchQuery, value); } }</span></span></code> </pre> <br><p> è§†å›¾æ¨¡å‹çš„ç±»æ ‡è®°æœ‰<code>[DataContract]</code>å±æ€§ï¼Œè€Œéœ€è¦åºåˆ—åŒ–çš„<code>[DataMember]</code>å…·æœ‰<code>[DataMember]</code> ã€‚ å¦‚æœæ‰€ä½¿ç”¨çš„åºåˆ—åŒ–ç¨‹åºä½¿ç”¨â€œé€‰æ‹©åŠ å…¥â€æ–¹æ³•å°±è¶³å¤Ÿäº†-å®ƒä»…å°†ä½¿ç”¨å±æ€§æ˜ç¡®æ ‡è®°çš„å±æ€§ä¿å­˜åˆ°ç£ç›˜ï¼›å¯¹äºé€‰æ‹©â€œé€€å‡ºâ€æ–¹æ³•ï¼Œåˆ™éœ€è¦ä½¿ç”¨<code>[IgnoreDataMember]</code>å±æ€§æ ‡è®°é‚£äº›ä¸éœ€è¦ä¿å­˜åˆ°ç£ç›˜çš„å±æ€§ã€‚ å¦å¤–ï¼Œæˆ‘ä»¬åœ¨è§†å›¾æ¨¡å‹ä¸­å®ç°<code>IRoutableViewModel</code>æ¥å£ï¼Œä»¥ä¾¿ä»¥åå®ƒå¯ä»¥æˆä¸ºåº”ç”¨ç¨‹åºè·¯ç”±å™¨å¯¼èˆªå †æ ˆçš„ä¸€éƒ¨åˆ†ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">åŒæ ·ï¼Œæˆ‘ä»¬å®ç°æˆæƒé¡µé¢å±•ç¤ºæ¨¡å‹</b> <div class="spoiler_text"><p>  <strong>ViewModels / LoginViewModel.cs</strong> </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">DataContract</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LoginViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">ReactiveObject</span></span>, <span class="hljs-title"><span class="hljs-title">IRoutableViewModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ReactiveCommand&lt;Unit, Unit&gt; _login; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _password; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _username; <span class="hljs-comment"><span class="hljs-comment">//   IScreen  ,   NULL //  IScreen  Splat.Locator.    //      . public LoginViewModel(IScreen screen = null) { HostScreen = screen ?? Locator.Current.GetService&lt;IScreen&gt;(); //     Username  Password // ,     . var canLogin = this .WhenAnyValue( x =&gt; x.Username, x =&gt; x.Password, (user, pass) =&gt; !string.IsNullOrWhiteSpace(user) &amp;&amp; !string.IsNullOrWhiteSpace(pass)); //      ,  //    . _login = ReactiveCommand.CreateFromTask( () =&gt; Task.Delay(1000), //    canLogin); } public IScreen HostScreen { get; } public string UrlPathSegment =&gt; "/login"; public ICommand Login =&gt; _login; [DataMember] public string Username { get =&gt; _username; set =&gt; this.RaiseAndSetIfChanged(ref _username, value); } //        ! public string Password { get =&gt; _password; set =&gt; this.RaiseAndSetIfChanged(ref _password, value); } }</span></span></code> </pre> </div></div><br><p> è¯¥åº”ç”¨ç¨‹åºçš„ä¸¤ä¸ªé¡µé¢çš„æ¼”ç¤ºæ¨¡å‹å·²å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å®ç°<code>IRoutableViewModel</code>æ¥å£ï¼Œå¹¶ä¸”å¯ä»¥å†…ç½®åˆ°<code>IScreen</code>è·¯ç”±å™¨ä¸­ã€‚ ç°åœ¨æˆ‘ä»¬ç›´æ¥å®ç°<code>IScreen</code> ã€‚ æˆ‘ä»¬å€ŸåŠ©<code>[DataContract]</code>å±æ€§æ ‡è®°è¦åºåˆ—åŒ–è§†å›¾æ¨¡å‹çš„å“ªäº›å±æ€§ï¼Œä»¥åŠå¿½ç•¥å“ªäº›å±æ€§ã€‚ åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œè¯·æ³¨æ„æ ‡æœ‰<code>[DataMember]</code>çš„å…¬å…±è®¾ç½®å™¨-è¯¥å±æ€§æœ‰æ„å¼€æ”¾ä¾›ç¼–å†™ï¼Œä»¥ä¾¿åºåˆ—åŒ–ç¨‹åºå¯ä»¥åœ¨æ¨¡å‹ååºåˆ—åŒ–æœŸé—´ä¿®æ”¹å¯¹è±¡çš„æ–°åˆ›å»ºå®ä¾‹ã€‚ </p><br><p>  <strong>ViewModels / MainViewModel.cs</strong> </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">DataContract</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MainViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">ReactiveObject</span></span>, <span class="hljs-title"><span class="hljs-title">IScreen</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ReactiveCommand&lt;Unit, Unit&gt; _search; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ReactiveCommand&lt;Unit, Unit&gt; _login; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> RoutingState _router = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RoutingState(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainViewModel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//       , //  ,   . var canLogin = this .WhenAnyObservable(x =&gt; x.Router.CurrentViewModel) .Select(current =&gt; !(current is LoginViewModel)); _login = ReactiveCommand.Create( () =&gt; { Router.Navigate.Execute(new LoginViewModel()); }, canLogin); //       , //  ,   . var canSearch = this .WhenAnyObservable(x =&gt; x.Router.CurrentViewModel) .Select(current =&gt; !(current is SearchViewModel)); _search = ReactiveCommand.Create( () =&gt; { Router.Navigate.Execute(new SearchViewModel()); }, canSearch); } [DataMember] public RoutingState Router { get =&gt; _router; set =&gt; this.RaiseAndSetIfChanged(ref _router, value); } public ICommand Search =&gt; _search; public ICommand Login =&gt; _login; }</span></span></code> </pre> <br><p> åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ï¼Œåªéœ€è¦å°†<code>RoutingState</code>ä¿å­˜åˆ°ç£ç›˜ï¼›å‡ºäºæ˜æ˜¾çš„åŸå› ï¼Œä¸éœ€è¦å°†å‘½ä»¤ä¿å­˜åˆ°ç£ç›˜-å®ƒä»¬çš„çŠ¶æ€å®Œå…¨å–å†³äºè·¯ç”±å™¨ã€‚ åºåˆ—åŒ–çš„å¯¹è±¡å¿…é¡»åŒ…å«æœ‰å…³å®ç°<code>IRoutableViewModel</code>çš„ç±»å‹çš„æ‰©å±•ä¿¡æ¯ï¼Œä»¥ä¾¿å¯ä»¥åœ¨ååºåˆ—åŒ–æ—¶æ¢å¤å¯¼èˆªå †æ ˆã€‚ æˆ‘ä»¬æè¿°<code>MainViewModel</code>è§†å›¾<code>MainViewModel</code>çš„é€»è¾‘ï¼Œå°†ç±»æ”¾åœ¨<code>ViewModels/MainViewModel.cs</code>å’Œç›¸åº”çš„<code>ReactiveUI.Samples.Suspension.ViewModels</code>å‘½åç©ºé—´ä¸­ã€‚ </p><br><p><img width="250" src="https://habrastorage.org/webt/d7/l0/zm/d7l0zmx2opzysobg-rkqvhexpxk.png"><br></p><br><h2 id="routing-v-prilozhenii-avalonia"> åœ¨Avaloniaåº”ç”¨ä¸­è·¯ç”± </h2><br><p> åœ¨æ¨¡å‹å±‚å’Œæ¼”ç¤ºåº”ç”¨ç¨‹åºçš„è¡¨ç¤ºæ¨¡å‹çš„å±‚çº§ä¸Šçš„ç”¨æˆ·ç•Œé¢é€»è¾‘å·²å®ç°ï¼Œå¹¶ä¸”å¯ä»¥ç§»åŠ¨åˆ°é’ˆå¯¹.NET Standardçš„å•ç‹¬ç¨‹åºé›†ä¸­ï¼Œå› ä¸ºå®ƒå¯¹æ‰€ä½¿ç”¨çš„GUIæ¡†æ¶ä¸€æ— æ‰€çŸ¥ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¡¨ç¤ºå±‚ã€‚ åœ¨MVVMæœ¯è¯­ä¸­ï¼Œè¡¨ç¤ºå±‚è´Ÿè´£åœ¨å±å¹•ä¸Šå‘ˆç°è¡¨ç¤ºæ¨¡å‹çš„çŠ¶æ€ï¼Œè¦å‘ˆç°<code>RoutingState</code>è·¯ç”±å™¨çš„å½“å‰çŠ¶æ€ï¼Œè¯·ä½¿ç”¨<code>RoutedViewHost</code>åŒ…ä¸­åŒ…å«çš„XAML <code>RoutedViewHost</code>æ§ä»¶ã€‚ æˆ‘ä»¬ä¸º<code>SearchViewModel</code>å®ç°GUI-ä¸ºæ­¤ï¼Œåœ¨<code>Views/</code>ç›®å½•ä¸­åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶ï¼š <code>SearchView.xaml</code>å’Œ<code>SearchView.xaml.cs</code> ã€‚ </p><br><p>  Windows Presentation Foundationï¼ŒUniversal Windows Platformæˆ–Xamarin.Formsä¸Šçš„å¼€å‘äººå‘˜å¯èƒ½å¯¹ä½¿ç”¨Avaloniaä¸­ä½¿ç”¨çš„XAMLæ–¹è¨€çš„ç”¨æˆ·ç•Œé¢è¿›è¡Œäº†æè¿°ã€‚ åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸ºæœç´¢è¡¨å•åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ç•Œé¢-æˆ‘ä»¬ç»˜åˆ¶ä¸€ä¸ªæ–‡æœ¬æ¡†ä»¥è¾“å…¥æœç´¢æŸ¥è¯¢å’Œä¸€ä¸ªæŒ‰é’®æ¥å¯åŠ¨æœç´¢ï¼ŒåŒæ—¶å°†æ§ä»¶ç»‘å®šåˆ°ä¸Šé¢å®šä¹‰çš„<code>SearchViewModel</code>æ¨¡å‹çš„å±æ€§ã€‚ </p><br><p>  <strong>è§†å›¾/ SearchView.xaml</strong> </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UserControl</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://github.com/avaloniaui"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:d</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:mc</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">d:DataContext</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{d:DesignInstance viewModels:SearchViewModel}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:viewModels</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clr-namespace:ReactiveUI.Samples.Suspension.ViewModels"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ReactiveUI.Samples.Suspension.Views.SearchView"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:reactiveUi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://reactiveui.net"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mc:Ignorable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"d"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Search view"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding SearchQuery, Mode=TwoWay}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Search"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Search}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UserControl</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  <strong>è§†å›¾/ SearchView.xaml.cs</strong> </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SearchView</span></span> : <span class="hljs-title"><span class="hljs-title">ReactiveUserControl</span></span>&lt;<span class="hljs-title"><span class="hljs-title">SearchViewModel</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchView</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//  WhenActivated     //        . this.WhenActivated((CompositeDisposable disposable) =&gt; { }); AvaloniaXamlLoader.Load(this); } }</span></span></code> </pre> <br><p> ç†Ÿæ‚‰çš„WPFï¼ŒUWPå’ŒXF <code>SearchView.xaml</code>ä¹Ÿå°†çœ‹åˆ°<code>SearchView.xaml</code>æ§ä»¶çš„ä»£ç ã€‚ åœ¨æ¿€æ´»å’Œåœç”¨è§†å›¾æˆ–è¡¨ç¤ºæ¨¡å‹æ—¶ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">WhenActivated</a>è°ƒç”¨ç”¨äºæ‰§è¡Œä¸€äº›ä»£ç ã€‚ å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºä½¿ç”¨äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">çƒ­çš„å¯è§‚å¯Ÿå¯¹è±¡</a> ï¼ˆè®¡æ—¶å™¨ï¼Œåœ°ç†ä½ç½®ï¼Œåˆ°æ¶ˆæ¯æ€»çº¿çš„è¿æ¥ï¼‰ï¼Œåˆ™æœ€å¥½<code>CompositeDisposable</code>è°ƒç”¨<code>DisposeWith</code>å°†å®ƒä»¬é™„åŠ åˆ°<code>CompositeDisposable</code>è¿™æ ·å½“æ‚¨ä»å¯è§†æ ‘ä¸­<code>DisposeWith</code> XAMLæ§ä»¶åŠå…¶å¯¹åº”çš„è§†å›¾æ¨¡å‹æ—¶ï¼Œ <em>çƒ­çš„å¯è§‚å¯Ÿå¯¹è±¡å°†</em>åœæ­¢å‘å¸ƒæ–°å€¼ï¼Œå¹¶ä¸”ä¸ä¼šæ³„æ¼è®°å¿†ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">åŒæ ·ï¼Œæˆ‘ä»¬å®ç°æˆæƒé¡µé¢çš„è¡¨ç¤º</b> <div class="spoiler_text"><p>  <strong>è§†å›¾/ LoginView.xaml</strong> </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UserControl</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://github.com/avaloniaui"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:d</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:mc</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">d:DataContext</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{d:DesignInstance viewModels:LoginViewModel, IsDesignTimeCreatable=True}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:viewModels</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clr-namespace:ReactiveUI.Samples.Suspension.ViewModels"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ReactiveUI.Samples.Suspension.Views.LoginView"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:reactiveUi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://reactiveui.net"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mc:Ignorable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"d"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Login view"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Username, Mode=TwoWay}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">PasswordChar</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Password, Mode=TwoWay}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Login"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Login}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UserControl</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  <strong>è§†å›¾/ LoginView.xaml.cs</strong> </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LoginView</span></span> : <span class="hljs-title"><span class="hljs-title">ReactiveUserControl</span></span>&lt;<span class="hljs-title"><span class="hljs-title">LoginViewModel</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoginView</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.WhenActivated(disposables =&gt; { }); AvaloniaXamlLoader.Load(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }</code> </pre> </div></div><br><p> ç¼–è¾‘<code>Views/MainView.xaml</code>å’Œ<code>Views/MainView.xaml.cs</code> ã€‚  <code>RoutedViewHost</code>æ¥è‡ª<code>RoutedViewHost</code>å‘½åç©ºé—´<code>RoutedViewHost</code> XAML <code>RoutedViewHost</code>ä¸»å±å¹•ä¸Šï¼Œå¹¶å°†<code>RoutingState</code>è·¯ç”±å™¨çš„çŠ¶æ€åˆ†é…ç»™<code>RoutingState</code>å±æ€§ã€‚ æ·»åŠ æŒ‰é’®ä»¥å¯¼èˆªåˆ°æœç´¢å’Œæˆæƒé¡µé¢ï¼Œå°†å®ƒä»¬ç»‘å®šåˆ°ä¸Šè¿°çš„<code>ViewModels/MainViewModel</code>å±æ€§ã€‚ </p><br><p>  <strong>è§†å›¾/ MainView.xaml</strong> </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Window</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://github.com/avaloniaui"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:d</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:mc</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mc:Ignorable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"d"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">d:DesignWidth</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"800"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">d:DesignHeight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"450"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ReactiveUI.Samples.Suspension.Views.MainView"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:reactiveUi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://reactiveui.net"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ReactiveUI.Samples.Suspension"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  ,   RoutingState,   View  ViewModel --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reactiveUi:RoutedViewHost</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Router</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Router}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reactiveUi:RoutedViewHost.DefaultContent</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Default Content"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reactiveUi:RoutedViewHost.DefaultContent</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reactiveUi:RoutedViewHost</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.ColumnDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ColumnDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ColumnDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ColumnDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.ColumnDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Search}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Search"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Login}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Login"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Router.NavigateBack}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Back"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Window</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  <strong>è§†å›¾/ MainView.xaml.cs</strong> </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MainView</span></span> : <span class="hljs-title"><span class="hljs-title">ReactiveWindow</span></span>&lt;<span class="hljs-title"><span class="hljs-title">MainViewModel</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainView</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.WhenActivated(disposables =&gt; { }); AvaloniaXamlLoader.Load(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }</code> </pre> <br><p> ä¸€ä¸ªæ¼”ç¤º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ReactiveUI</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Avalonia</a>è·¯ç”±<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">åŠŸèƒ½çš„</a>ç®€å•åº”ç”¨ç¨‹åºå·²å‡†å¤‡å°±ç»ªã€‚ å•å‡»â€œ <code>Search</code>å’Œâ€œ <code>Login</code>æŒ‰é’®åï¼Œå°†è°ƒç”¨ç›¸åº”çš„å‘½ä»¤ï¼Œåˆ›å»ºè§†å›¾æ¨¡å‹çš„æ–°å®ä¾‹ï¼Œå¹¶æ›´æ–°<code>RoutingState</code> ã€‚ è®¢é˜…å¯¹<code>RoutedViewHost</code>çš„æ›´æ”¹çš„XAMLæ§ä»¶<code>RoutedViewHost</code>å°è¯•è·å–<code>IViewFor&lt;TViewModel&gt;</code> ï¼Œå…¶ä¸­<code>TViewModel</code>æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><code>Locator.Current</code></a>çš„è§†å›¾æ¨¡å‹ç±»å‹ã€‚ å¦‚æœæ‰¾åˆ°<code>IViewFor&lt;TViewModel&gt;</code>çš„æ³¨å†Œå®ç°ï¼Œ <code>IViewFor&lt;TViewModel&gt;</code>åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹ï¼Œå°†å…¶å†…ç½®åˆ°<code>RoutedViewHost</code>å¹¶æ˜¾ç¤ºåœ¨<code>RoutedViewHost</code>åº”ç”¨ç¨‹åºçª—å£ä¸­ã€‚ </p><br><p><img width="550" src="https://habrastorage.org/webt/ys/o4/dg/yso4dgybdbqulwbb7dumlbktp5w.png"><br></p><br><p> æˆ‘ä»¬ä½¿ç”¨<code>Locator.CurrentMutable</code>åœ¨åº”ç”¨ç¨‹åºçš„<code>App.OnFrameworkInitializationCompleted</code>æ–¹æ³•ä¸­æ³¨å†Œå¿…è¦çš„ç»„ä»¶<code>IViewFor&lt;TViewModel&gt;</code>å’Œ<code>IScreen</code> ã€‚  <code>IViewFor&lt;TViewModel&gt;</code>å¯¹äº<code>RoutedViewHost</code> <code>IScreen</code>å¿…éœ€çš„ï¼Œè€Œ<code>IScreen</code>æ³¨å†Œ<code>IScreen</code>å¿…éœ€çš„ï¼Œä»¥ä¾¿åœ¨ååºåˆ—åŒ–æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸å¸¦å‚æ•°å’Œ<code>Locator.Current</code>çš„æ„é€ å‡½æ•°æ­£ç¡®åˆå§‹åŒ–<code>SearchViewModel</code>å’Œ<code>LoginViewModel</code> ã€‚ </p><br><p>  <strong>App.xaml.cs</strong> </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnFrameworkInitializationCompleted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//   . Locator.CurrentMutable.RegisterConstant&lt;IScreen&gt;(new MainViewModel()); Locator.CurrentMutable.Register&lt;IViewFor&lt;SearchViewModel&gt;&gt;(() =&gt; new SearchView()); Locator.CurrentMutable.Register&lt;IViewFor&lt;LoginViewModel&gt;&gt;(() =&gt; new LoginView()); //        . new MainView { DataContext = Locator.Current.GetService&lt;IScreen&gt;() }.Show(); base.OnFrameworkInitializationCompleted(); }</span></span></code> </pre> <br><p> è¿è¡Œè¯¥åº”ç”¨ç¨‹åºï¼Œå¹¶ç¡®ä¿è·¯ç”±æ­£ç¡®è¿è¡Œã€‚ å¦‚æœXAMLæ ‡è®°ä¸­æœ‰ä»»ä½•é”™è¯¯ï¼Œåˆ™<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Avaloniaä¸­ä½¿ç”¨</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">XamlIIlç¼–è¯‘å™¨</a>å°†åœ¨ç¼–è¯‘é˜¶æ®µå‘Šè¯‰æˆ‘ä»¬ç¡®åˆ‡çš„ä½ç½®ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">XamlIlè¿˜ç›´æ¥åœ¨IDEè°ƒè¯•å™¨ä¸­æ”¯æŒXAMLè°ƒè¯•</a> ï¼ </p><br><pre> <code class="plaintext hljs">dotnet run --framework netcoreapp3.0</code> </pre> <br><p><img src="https://habrastorage.org/webt/c2/pp/88/c2pp88h397pwscpwn-i8vnke6sw.gif" width="400"><br></p><br><h2 id="sohranenie-i-vosstanovlenie-sostoyaniya-prilozheniya-celikom"> ä¿å­˜å’Œè¿˜åŸæ•´ä¸ªåº”ç”¨ç¨‹åºçŠ¶æ€ </h2><br><p> æ—¢ç„¶è·¯ç”±å·²ç»é…ç½®å¹¶ä¸”å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œæœ€æœ‰è¶£çš„éƒ¨åˆ†å°±å¼€å§‹äº†-æ‚¨éœ€è¦åœ¨å…³é—­åº”ç”¨ç¨‹åºæ—¶å®ç°å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜ï¼Œå¹¶åœ¨å¯åŠ¨æ—¶ä»ç£ç›˜è¯»å–æ•°æ®ä»¥åŠè·¯ç”±å™¨çš„çŠ¶æ€ã€‚ ä¾¦å¬åº”ç”¨ç¨‹åºå¯åŠ¨å’Œå…³é—­äº‹ä»¶çš„æŒ‚é’©çš„åˆå§‹åŒ–ç”±ç‰¹æ®Šçš„<code>AutoSuspendHelper</code>ç±»å¤„ç†ï¼Œè¯¥ç±»<code>AutoSuspendHelper</code>äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ReactiveUI</a>æ”¯æŒçš„æ¯ä¸ªå¹³å°ã€‚ å¼€å‘äººå‘˜çš„ä»»åŠ¡æ˜¯åœ¨åº”ç”¨ç¨‹åºç»„åˆæ ¹çš„æœ€å¼€å§‹å¤„åˆå§‹åŒ–æ­¤ç±»ã€‚ è¿˜éœ€è¦<code>RxApp.SuspensionHost.CreateNewAppState</code>å‡½æ•°åˆå§‹åŒ–<code>RxApp.SuspensionHost.CreateNewAppState</code>å±æ€§<code>RxApp.SuspensionHost.CreateNewAppState</code>å¦‚æœæ²¡æœ‰ä¿å­˜çŠ¶æ€æˆ–å‘ç”Ÿæ„å¤–é”™è¯¯ï¼Œæˆ–è€…ä¿å­˜çš„æ–‡ä»¶å·²æŸåï¼Œåˆ™è¯¥å‡½æ•°å°†è¿”å›åº”ç”¨ç¨‹åºçš„é»˜è®¤çŠ¶æ€ã€‚ </p><br><p> æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦è°ƒç”¨<code>RxApp.SuspensionHost.SetupDefaultSuspendResume</code>æ–¹æ³•ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™<code>RxApp.SuspensionHost.SetupDefaultSuspendResume</code>çš„å®ç°ï¼Œ <code>ISuspensionDriver</code>æ˜¯è¯»å†™çŠ¶æ€å¯¹è±¡çš„é©±åŠ¨ç¨‹åºã€‚ ä¸ºäº†å®ç°<code>ISuspensionDriver</code> ï¼Œ <code>ISuspensionDriver</code>ä½¿ç”¨<code>Newtonsoft.Json</code>åº“å’Œ<code>System.IO</code>å‘½åç©ºé—´æ¥å¤„ç†æ–‡ä»¶ç³»ç»Ÿã€‚ ä¸ºæ­¤ï¼Œè¯·å®‰è£…<code>Newtonsoft.Json</code>è½¯ä»¶åŒ…ï¼š </p><br><pre> <code class="plaintext hljs">dotnet add package Newtonsoft.Json</code> </pre> <br><p>  <strong>é©±åŠ¨ç¨‹åº/ NewtonsoftJsonSuspensionDriver.cs</strong> </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">NewtonsoftJsonSuspensionDriver</span></span> : <span class="hljs-title"><span class="hljs-title">ISuspensionDriver</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _file; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> JsonSerializerSettings _settings = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JsonSerializerSettings { TypeNameHandling = TypeNameHandling.All }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NewtonsoftJsonSuspensionDriver</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> file</span></span></span><span class="hljs-function">)</span></span> =&gt; _file = file; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IObservable&lt;Unit&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InvalidateState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (File.Exists(_file)) File.Delete(_file); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Observable.Return(Unit.Default); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IObservable&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lines = File.ReadAllText(_file); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state = JsonConvert.DeserializeObject&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;(lines, _settings); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Observable.Return(state); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IObservable&lt;Unit&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> state</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lines = JsonConvert.SerializeObject(state, _settings); File.WriteAllText(_file, lines); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Observable.Return(Unit.Default); } }</code> </pre> <br><p>      â€” <code>System.IO</code>    Universal Winows Platform,     â€”   <code>File</code>  <code>Directory</code>  <code>StorageFile</code>  <code>StorageFolder</code> .      ,         <code>IRoutableViewModel</code> ,  <code>Newtonsoft.Json</code>       <code>TypeNameHandling.All</code>  .       Avalonia â€”  <code>App.OnFrameworkInitializationCompleted</code> : </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnFrameworkInitializationCompleted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//   . var suspension = new AutoSuspendHelper(ApplicationLifetime); RxApp.SuspensionHost.CreateNewAppState = () =&gt; new MainViewModel(); RxApp.SuspensionHost.SetupDefaultSuspendResume(new NewtonsoftJsonSuspensionDriver("appstate.json")); suspension.OnFrameworkInitializationCompleted(); //  ,      . var state = RxApp.SuspensionHost.GetAppState&lt;MainViewModel&gt;(); Locator.CurrentMutable.RegisterConstant&lt;IScreen&gt;(state); Locator.CurrentMutable.Register&lt;IViewFor&lt;SearchViewModel&gt;&gt;(() =&gt; new SearchView()); Locator.CurrentMutable.Register&lt;IViewFor&lt;LoginViewModel&gt;&gt;(() =&gt; new LoginView()); //  . new MainView { DataContext = Locator.Current.GetService&lt;IScreen&gt;() }.Show(); base.OnFrameworkInitializationCompleted(); }</span></span></code> </pre> <br><p>   <code>AutoSuspendHelper</code>   <code>Avalonia.ReactiveUI</code>        <code>IApplicationLifetime</code> â€”  ,           <code>ISuspensionDriver</code>    .    <code>ISuspensionDriver</code>            <code>appstate.json</code>     : </p><br><div class="spoiler"> <b class="spoiler_title">appstate.json</b> <div class="spoiler_text"><p>   â€”      <code>$type</code> ,          ,    . </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"$type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ReactiveUI.Samples.Suspension.ViewModels.MainViewModel, ReactiveUI.Samples.Suspension"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Router"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ReactiveUI.RoutingState, ReactiveUI"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_navigationStack"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$type"</span></span>: <span class="hljs-string"><span class="hljs-string">"System.Collections.ObjectModel.ObservableCollection`1[[ReactiveUI.IRoutableViewModel, ReactiveUI]], System.ObjectModel"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"$values"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"$type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ReactiveUI.Samples.Suspension.ViewModels.SearchViewModel, ReactiveUI.Samples.Suspension"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"SearchQuery"</span></span>: <span class="hljs-string"><span class="hljs-string">"funny cats"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"$type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ReactiveUI.Samples.Suspension.ViewModels.LoginViewModel, ReactiveUI.Samples.Suspension"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Username"</span></span>: <span class="hljs-string"><span class="hljs-string">"worldbeater"</span></span> } ] } } }</code> </pre> </div></div><br><p>   , ,  ,     ,     ,      ,     !  ,        ,  ReactiveUI â€”   UWP  WPF,    Xamarin.Forms. </p><br><p><img src="https://habrastorage.org/webt/yf/ig/p0/yfigp0_ob3ah_cofj-3tdazxrgc.png" width="750"><br></p><br><p> <strong>:</strong> <code>ISuspensionDriver</code>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Akavache</a> â€”      <code>UserAccount</code>  <code>Secure</code>   iOS  UWP          ,    ,   Android  <a href="" rel="nofollow"> BundleSuspensionDriver</a>   <code>ReactiveUI.AndroidSupport</code> .      JSON   Xamarin.Essentials <code>SecureStorage</code> . ,           â€”    ! </p><br><h2 id="poleznye-ssylki">   </h2><br><ul><li>  ,   , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">  GitHub</a> . </li><li>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Avalonia</a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a> . </li><li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ReactiveUI</a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  ReactiveUI  </a> . </li><li>           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  DynamicData</a> . </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN457164/">https://habr.com/ru/post/zh-CN457164/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN457150/index.html">æ–°çš„Windowsç»ˆç«¯ç°å·²åœ¨Microsoft Storeä¸Šå¯ç”¨</a></li>
<li><a href="../zh-CN457152/index.html">DEFCON 25ä¼šè®®ï¼ŒGarry Kasparovã€‚ â€œå¤§è„‘çš„æœ€åä¸€æˆ˜ã€‚â€ ç¬¬ä¸€éƒ¨åˆ†</a></li>
<li><a href="../zh-CN457154/index.html">é’ˆå¯¹æ¯ä¸ªç”¨æˆ·çš„å“åº”å¼åº”ç”¨ç¨‹åºè®¾è®¡</a></li>
<li><a href="../zh-CN457156/index.html">æœªæ¥çš„è®¡ç®—ç³»ç»Ÿå¯èƒ½æ˜¯ä»€ä¹ˆ</a></li>
<li><a href="../zh-CN457160/index.html">æˆ‘åœ¨C ++ä¸­å®ç°å§”æ‰˜çš„æ–¹æ³•ï¼šåœ¨è¿è¡Œæ—¶è°ƒç”¨å‚æ•°æœªçŸ¥çš„å‡½æ•°</a></li>
<li><a href="../zh-CN457168/index.html">ä½¿ç”¨Pythonå’ŒTextBlobè¿›è¡ŒåŸå‹æƒ…æ„Ÿåˆ†æ</a></li>
<li><a href="../zh-CN457172/index.html">ScreenLogger-å¾®ç¬‘ï¼Œéšè—çš„æ‘„åƒå¤´å¸¦æ‚¨</a></li>
<li><a href="../zh-CN457178/index.html">å¤„ç†å™¨çš„è®¾è®¡å’Œåˆ¶é€ æ–¹å¼ï¼šCPUè®¾è®¡</a></li>
<li><a href="../zh-CN457180/index.html">å®˜æ–¹ç½‘ç«™Node.jsç°å·²å¯ç”¨ä¿„è¯­</a></li>
<li><a href="../zh-CN457182/index.html">REXXè¯­è¨€40å‘¨å¹´</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>