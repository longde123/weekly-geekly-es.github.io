<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§Æ üë©üèæ‚Äçü§ù‚Äçüë®üèø üõ£Ô∏è Otro dsl en Kotlin o c√≥mo imprim√≠ PDF desde reaccionar üìª üë©üèæ‚Äçü§ù‚Äçüë®üèΩ üë®‚Äçüë®‚Äçüëß‚Äçüë¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No puede simplemente tomar e imprimir una p√°gina escrita en React: hay separadores de p√°gina, campos de entrada. Adem√°s, quiero escribir un render una...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Otro dsl en Kotlin o c√≥mo imprim√≠ PDF desde reaccionar</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430238/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/ir/d8/d4/ird8d4jfijzncjzyjbubqxjoaiw.jpeg"></a> <br><br>  No puede simplemente tomar e imprimir una p√°gina escrita en React: hay separadores de p√°gina, campos de entrada.  Adem√°s, quiero escribir un render una vez para que genere ReactDom y HTML simple, que se puede convertir a PDF. <br><br>  La parte m√°s dif√≠cil es que React tiene su propio dsl y html tiene el suyo.  ¬øC√≥mo resolver este problema?  Escribe otro! <br><br>  Casi se me olvida, todo estar√° escrito en Kotlin, por lo que este es realmente un art√≠culo sobre Kotlin dsl. <br><a name="habracut"></a><br><h3>  ¬øPor qu√© necesitamos nuestro propio Uruk-hai? </h3><br>  Hay muchos informes en mi proyecto y todos deben poder imprimirse.  Hay varias opciones sobre c√≥mo hacer esto: <br><br><ul><li>  Juega con estilos de impresi√≥n, oculta todo lo que no necesitas y espera que todo est√© bien.  Solo los botones, filtros y similares se imprimir√°n tal cual.  Y tambi√©n, si hay muchas tablas, es necesario que cada una est√© en una p√°gina separada.  Y personalmente, los enlaces agregados, las fechas, etc. que salen al imprimir desde el sitio me est√°n enfureciendo. </li><li>  Intente utilizar alguna biblioteca especializada en react, que puede representar PDF.  Encontr√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este</a> , es beta y, al parecer, no puedes reutilizar componentes de reacci√≥n normales. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Convierte HTML en lienzo</a> y crea PDF con √©l.  Pero para esto necesitamos HTML, sin botones y similares.  Deber√° representarse en un elemento oculto para imprimirlo m√°s tarde.  Pero no parece que en esta opci√≥n pueda controlar los saltos de p√°gina. </li></ul><br>  Al final, decid√≠ escribir c√≥digo capaz de generar ReactDom y HTML.  Enviar√© el HTML al back-end para imprimir el PDF insertando etiquetas especiales sobre saltos de p√°gina en el camino. <br><br>  Kotlin tiene una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">biblioteca de capas</a> para trabajar con React que proporciona dsl de tipo seguro para trabajar con React.  C√≥mo se ve en general se puede encontrar en mi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> anterior. <br><br>  JetBrains tambi√©n escribi√≥ una biblioteca para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">generar HTML</a> .  Es multiplataforma, es decir  Se puede utilizar tanto en Java como en JS.  Esto tambi√©n es dsl, muy similar en estructura. <br><br>  Necesitamos encontrar una manera de cambiar entre bibliotecas dependiendo de si necesitamos ReactDom o HTML puro. <br><br><h3>  ¬øQu√© material tenemos? </h3><br>  Por ejemplo, tome una tabla con un cuadro de b√∫squeda en el encabezado.  As√≠ es como se ve la representaci√≥n de tablas en React y HTML: <br><table><tbody><tr><th>  reaccionar <br></th><th>  html <br></th></tr><tr><td><pre><code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> RBuilder.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">renderReactTable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( search: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, onChangeSearch: (</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> ) { table { thead { tr { th { attrs.colSpan = <span class="hljs-string"><span class="hljs-string">"2"</span></span> <span class="hljs-comment"><span class="hljs-comment">//(1) attrs.style = js { border = "solid" borderColor = "red" } //(2) +":" search(search, onChangeSearch) //(3) } } tr { th { +"" } th { +"" } } } tbody { tr { td { +"" } td { +"" } } tr { td { +"" } td { +"" } } } } }</span></span></code> </pre> <br></td><td><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> TagConsumer</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;*&gt;</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">renderHtmlTable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( search: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span></span> { table { thead { tr { th { colSpan = <span class="hljs-string"><span class="hljs-string">"2"</span></span> <span class="hljs-comment"><span class="hljs-comment">//(1) style = """ border: solid; border-color: red; """ //(2) +": " +(search?:"") //(3) } } tr { th { +"" } th { +"" } } } tbody { tr { td { +"" } td { +"" } } tr { td { +"" } td { +"" } } } } }</span></span></code> </pre><br></td></tr></tbody></table><br><br>  Nuestra tarea es combinar los lados izquierdo y derecho de la tabla. <br><br>  Primero, descubramos cu√°l es la diferencia: <br><br><ol><li>  En html, las <code>colSpan</code> <code>style</code> y <code>colSpan</code> asignan en el nivel superior, en React, en el objeto attr nested </li><li>  El estilo se llena de manera diferente.  Si en HTML esto es CSS regular como una cadena, entonces en React es un objeto js cuyos nombres de campo son ligeramente diferentes de CSS est√°ndar debido a las limitaciones de JS. </li><li>  En la versi√≥n React, usamos la entrada para la b√∫squeda, en HTML simplemente mostramos el texto.  Esto ya comienza a partir de la declaraci√≥n del problema. </li></ol><br>  Bueno y lo m√°s importante: estos son diferentes dsl con diferentes consumidores y diferentes api.  Para el compilador, son completamente diferentes.  Es imposible cruzarlos directamente, por lo que tendr√° que escribir una capa que se ver√° casi igual, pero podr√° trabajar con la API React y la API HTML. <br><br><h3>  Ensamblar el esqueleto </h3><br>  Por ahora, solo dibuja una tableta de una celda vac√≠a: <br><br><pre> <code class="kotlin hljs">table { thead { tr { th { } } } }</code> </pre><br>  Tenemos un √°rbol HTML y dos formas de procesarlo.  La soluci√≥n cl√°sica es implementar patrones compuestos y visitantes.  Solo que no tendremos una interfaz para el visitante.  Por qu√©, se ver√° m√°s tarde. <br><br>  Las unidades principales ser√°n ParentTag y TagWithParent.  ParentTag est√° genificado por la etiqueta HTML de la API de Kotlin (gracias a Dios que se usa tanto en HTML como en la API React), y TagWithParent almacena la etiqueta y dos funciones que la insertan en el padre en dos variantes de API. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ParentTag</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T : HTMLTag</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tags: MutableList&lt;TagWithParent&lt;*, T&gt;&gt; = mutableListOf() <span class="hljs-comment"><span class="hljs-comment">//     protected fun RDOMBuilder&lt;T&gt;.withChildren() { ... } //  reactAppender    protected fun T.withChildren() { ... } //  htmlAppender    } class TagWithParent&lt;T, P : HTMLTag&gt;( val tag: T, val htmlAppender: (T, P) -&gt; Unit, val reactAppender: (T, RDOMBuilder&lt;P&gt;) -&gt; Unit )</span></span></code> </pre><br>  ¬øPor qu√© necesitas tantos gen√©ricos?  El problema es que dsl para HTML es muy estricto al compilar.  Si en React puede llamar a td desde cualquier lugar, incluso desde un div, en el caso de HTML puede llamarlo solo desde el contexto de tr.  Por lo tanto, tendremos que arrastrar el contexto para la compilaci√≥n en forma de gen√©rico a todas partes. <br><br>  La mayor√≠a de las etiquetas se escriben aproximadamente de la misma manera: <br><br><ol><li>  Implementamos dos m√©todos de visita.  Uno para React, uno para HTML.  Son responsables de la representaci√≥n final.  Estos m√©todos agregan estilos, clases y similares. </li><li>  Escribimos una extensi√≥n que inserta la etiqueta en el padre. </li></ol><br><div class="spoiler">  <b class="spoiler_title">Aqu√≠ hay un ejemplo de thead</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">THead</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ParentTag</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">THEAD</span></span></span><span class="hljs-class">&gt;</span></span>() { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(builder: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">RDOMBuilder</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TABLE</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { builder.thead { withChildren() } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(builder: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TABLE</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { builder.thead { withChildren() } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> Table.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">thead</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">THead</span></span></span></span><span class="hljs-function"><span class="hljs-params">.()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>) { tags += TagWithParent(THead().also(block), THead::visit, THead::visit) }</code> </pre><br></div></div><br>  Finalmente, puede explicar por qu√© no se utiliz√≥ la interfaz para el visitante.  El problema es que tr puede insertarse tanto en thead como en tbody.  No pude expresar esto dentro del marco de una interfaz.  Salieron cuatro sobrecargas de la funci√≥n de visita. <br><br><div class="spoiler">  <b class="spoiler_title">Un mont√≥n de duplicaciones que no se pueden evitar.</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tr</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> classes: String? ) : ParentTag&lt;TR&gt;() { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(builder: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">RDOMBuilder</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">THEAD</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { builder.tr(classes) { withChildren() } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(builder: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">THEAD</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { builder.tr(classes) { withChildren() } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(builder: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">RDOMBuilder</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TBODY</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { builder.tr(classes) { withChildren() } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(builder: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TBODY</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { builder.tr(classes) { withChildren() } } }</code> </pre><br></div></div><br><h3>  Construir carne </h3><br>  Agregue texto a la celda: <br><br><pre> <code class="kotlin hljs"> table { thead { tr { th { +<span class="hljs-string"><span class="hljs-string">": "</span></span> } } } }</code> </pre><br>  Centrarse en '+' es bastante simple: basta con redefinir unaryPlus en las etiquetas, que pueden incluir texto. <br><br><pre> <code class="plaintext hljs">abstract class TableCell&lt;T : HTMLTag&gt; : ParentTag&lt;T&gt;() { operator fun String.unaryPlus() { ... } }</code> </pre><br>  Esto le permite llamar '+' en el contexto de td o th, lo que agregar√° una etiqueta con texto al √°rbol. <br><br><h3>  Cuero cabelludo la piel </h3><br>  Ahora tenemos que lidiar con lugares que difieren en el html y reaccionar api.  Una peque√±a diferencia con colSpan se resuelve por s√≠ sola, pero la diferencia en la formaci√≥n del estilo es m√°s complicada.  Si alguien no lo sabe, en React, el estilo es un objeto JS y no puede usar un gui√≥n en el nombre del campo.  Entonces se usa camelCase en su lugar.  En HTML api queremos css regulares de nosotros.  Nuevamente necesitamos tanto esto como aquello al mismo tiempo. <br><br>  Podr√≠a intentar llevar camelCase autom√°ticamente a un gui√≥n y dejarlo como en React api, pero no s√© si siempre funcionar√°.  Por lo tanto, escrib√≠ otra capa: <br><br><div class="spoiler">  <b class="spoiler_title">Quien no es perezoso, puede ver c√≥mo se ve</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Style</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> border: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> borderColor: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> width: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> padding: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> background: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(callback: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Style</span></span></span></span><span class="hljs-function"><span class="hljs-params">.()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>) { callback() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toHtmlStyle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: String = properties .map { it.html to it.property(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) } .filter { (_, value) -&gt; value != <span class="hljs-literal"><span class="hljs-literal">null</span></span> } .joinToString(<span class="hljs-string"><span class="hljs-string">"; "</span></span>) { (name, value) -&gt; <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$name</span></span></span><span class="hljs-string">: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$value</span></span></span><span class="hljs-string">"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toReactStyle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: String { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> result = js(<span class="hljs-string"><span class="hljs-string">"{}"</span></span>) properties .map { it.react to it.property(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) } .filter { (_, value) -&gt; value != <span class="hljs-literal"><span class="hljs-literal">null</span></span> } .forEach { (name, value) -&gt; result[name] = value.toString() } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result.unsafeCast&lt;String&gt;() } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StyleProperty</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> html: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> react: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> property: Style.() -&gt; Any? ) <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> properties = listOf( StyleProperty(<span class="hljs-string"><span class="hljs-string">"border"</span></span>, <span class="hljs-string"><span class="hljs-string">"border"</span></span>) { border }, StyleProperty(<span class="hljs-string"><span class="hljs-string">"border-color"</span></span>, <span class="hljs-string"><span class="hljs-string">"borderColor"</span></span>) { borderColor }, StyleProperty(<span class="hljs-string"><span class="hljs-string">"width"</span></span>, <span class="hljs-string"><span class="hljs-string">"width"</span></span>) { width }, StyleProperty(<span class="hljs-string"><span class="hljs-string">"padding"</span></span>, <span class="hljs-string"><span class="hljs-string">"padding"</span></span>) { padding }, StyleProperty(<span class="hljs-string"><span class="hljs-string">"background"</span></span>, <span class="hljs-string"><span class="hljs-string">"background"</span></span>) { background } ) } }</code> </pre><br></div></div><br>  S√≠, s√© si desea una propiedad css m√°s: agregue a esta clase.  S√≠, y un mapa con un convertidor ser√≠a m√°s f√°cil de implementar.  Pero de tipo seguro.  Incluso uso enumeraciones en algunos lugares.  Quiz√°s, si no escribiera por m√≠ mismo, de alguna manera resolver√≠a la pregunta de manera diferente. <br><br>  Hice un poco de trampa y permit√≠ este uso de la clase resultante: <br><br><pre> <code class="kotlin hljs">th { attrs.style { border = <span class="hljs-string"><span class="hljs-string">"solid"</span></span> borderColor = <span class="hljs-string"><span class="hljs-string">"red"</span></span> } }</code> </pre><br>  C√≥mo funciona: en el campo attr.style, de forma predeterminada, ya hay un Style () vac√≠o.  Si define la invocaci√≥n divertida del operador, el objeto puede usarse como una funci√≥n, es decir,  puede llamar a <code>attrs.style()</code> , aunque el estilo es un campo, no una funci√≥n.  En dicha llamada, se deben pasar los par√°metros especificados en invocaci√≥n divertida del operador.  En este caso, este es un par√°metro: devoluci√≥n de llamada: Estilo. () -&gt; Unidad.  Como se trata de una lambda, los (par√©ntesis) son opcionales. <br><br><h3>  Prob√°ndose diferentes armaduras </h3><br>  Queda por aprender c√≥mo dibujar entradas en React, y solo texto en HTML.  Me gustar√≠a obtener esta sintaxis: <br><br><pre> <code class="kotlin hljs">react { search(search, onChangeSearch) } html { +(search?:<span class="hljs-string"><span class="hljs-string">""</span></span>) }</code> </pre><br>  C√≥mo funciona: la funci√≥n de reacci√≥n toma una lambda para la API Rreact y devuelve la etiqueta insertada.  En la etiqueta, puede llamar a la funci√≥n infijo y pasar el lambda a la API HTML.  El modificador infijo permite que se llame a html sin un punto.  Muy similar a if {} else {}.  Y como en if-else, la llamada html es opcional, fue √∫til varias veces. <br><br><div class="spoiler">  <b class="spoiler_title">Implementaci√≥n</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReactTag</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T : HTMLTag</span></span></span><span class="hljs-class">&gt;</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> block: RBuilder.() -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> = {} ) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> htmlAppender: (T) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> = {} <span class="hljs-keyword"><span class="hljs-keyword">infix</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">html</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: (</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>.() -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>) { htmlAppender = block } ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T : HTMLTag&gt;</span></span></span><span class="hljs-function"> ParentTag</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">react</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">RBuilder</span></span></span></span><span class="hljs-function"><span class="hljs-params">.()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>): ReactTag&lt;T&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> reactTag = ReactTag&lt;T&gt;(block) tags += TagWithParent&lt;ReactTag&lt;T&gt;, T&gt;(reactTag, ReactTag&lt;T&gt;::visit, ReactTag&lt;T&gt;::visit) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> reactTag }</code> </pre><br></div></div><br><h3>  Marca de Saruman </h3><br>  Otro toque  Es necesario heredar ParentTag y TagWithParent de una interfaz de herida especial con una anotaci√≥n de herida especial en la que se encuentra una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">anotaci√≥n</a> especial <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@DslMarker</a> , ya desde el n√∫cleo del lenguaje: <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@DslMarker</span></span> <span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StyledTableMarker</span></span></span><span class="hljs-class"> </span><span class="hljs-meta"><span class="hljs-class"><span class="hljs-meta">@StyledTableMarker</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tag</span></span></span></span></code> </pre><br>  Esto es necesario para que el compilador no permita escribir llamadas extra√±as como estas: <br><br><pre> <code class="kotlin hljs">td { td { } } tr { thead { } }</code> </pre><br>  Sin embargo, no est√° claro qui√©n pensar√≠a en escribir algo as√≠ ... <br><br><h3>  A la batalla! </h3><br>  Todo est√° listo para que dibujemos una tabla desde el comienzo del art√≠culo, pero este c√≥digo ya generar√° ReactDom y HTML.  Escribe una vez que corras a cualquier parte! <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> Table.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">renderUniversalTable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(search: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, onChangeSearch: (</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>) { thead { tr { th { attrs.colSpan = <span class="hljs-number"><span class="hljs-number">2</span></span> attrs.style { border = <span class="hljs-string"><span class="hljs-string">"solid"</span></span> borderColor = <span class="hljs-string"><span class="hljs-string">"red"</span></span> } +<span class="hljs-string"><span class="hljs-string">":"</span></span> react { search(search, onChangeSearch) <span class="hljs-comment"><span class="hljs-comment">//(*) } html { +(search?:"") } } } tr { th { +"" } th { +"" } } } tbody { tr { td { +"" } td { +"" } } tr { td { +"" } td { +"" } } } }</span></span></code> </pre><br>  Preste atenci√≥n a (*): esta es exactamente la misma funci√≥n de b√∫squeda que en la versi√≥n original de la tabla para React.  No es necesario transferir todo a la nueva dsl, solo etiquetas comunes. <br><br>  ¬øCu√°l podr√≠a ser el resultado de dicho c√≥digo?  Aqu√≠ hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un ejemplo de una impresi√≥n en PDF de un</a> informe de mi proyecto.  Naturalmente, reemplac√© todos los n√∫meros y nombres con al azar.  A modo de comparaci√≥n, una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">impresi√≥n en PDF de</a> la misma p√°gina, pero por el navegador.  Artefactos desde romper una tabla entre p√°ginas hasta superponer texto. <br><br>  Al escribir dsl, obtienes una gran cantidad de c√≥digo adicional centrado √∫nicamente en la forma de uso.  Adem√°s, se utilizan muchas funciones de Kotlin, que ni siquiera piensa en la vida cotidiana. <br><br>  Quiz√°s en otros casos ser√° diferente, pero en este caso tambi√©n hubo mucha duplicaci√≥n de la que no pude deshacerme (por lo que s√©, JetBarins usa la generaci√≥n de c√≥digo para escribir la biblioteca HTML). <br><br>  Pero se me ocurri√≥ construir dsl con una apariencia casi similar a la API React y HTML (casi no me asomo).  Curiosamente, junto con la conveniencia de dsl, tenemos control total sobre el renderizado.  Puede agregar una etiqueta de p√°gina para separar las p√°ginas.  Puede expandir el " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">acorde√≥n</a> " al imprimir.  Y puede intentar encontrar una forma de reutilizar este c√≥digo en el servidor y generar html ya para los motores de b√∫squeda. <br><br>  PD Seguramente, hay formas de imprimir PDF m√°s f√°cilmente <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Nabo con fuente para el art√≠culo</a> <br><br><div class="spoiler">  <b class="spoiler_title">Otros art√≠culos sobre Kotlin:</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El regusto de Kotlin, parte 1</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El regusto de Kotlin, parte 2</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Postgusto de Kotlin, parte 3. Corutinas: comparta el tiempo del procesador</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kotlin + React vs Javasript + React</a> <br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es430238/">https://habr.com/ru/post/es430238/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es430226/index.html">De var b a entrevista</a></li>
<li><a href="../es430228/index.html">Marcas en forma de X como m√©todo de identificaci√≥n por radar utilizando an√°lisis de datos abiertos de dos sat√©lites cient√≠ficos SENTINEL-1</a></li>
<li><a href="../es430230/index.html">C√≥mo mantener tu lugar en una startup en crecimiento</a></li>
<li><a href="../es430232/index.html">Generaci√≥n de llamada cerrada en los juegos: "Al borde de la derrota" o "Casi gan√≥"</a></li>
<li><a href="../es430236/index.html">NASA anuncia vuelo de luna nueva</a></li>
<li><a href="../es430240/index.html">Vulnerabilidad de n√∫mero seudoaleatorio de Bitcoin</a></li>
<li><a href="../es430242/index.html">OpenSceneGraph: nodos de grupo, nodos de transformaci√≥n y nodos de conmutaci√≥n</a></li>
<li><a href="../es430244/index.html">SpaceX recibi√≥ permiso para desplegar una red satelital de 11943 sat√©lites</a></li>
<li><a href="../es430246/index.html">Reubicaci√≥n al socialismo austriaco</a></li>
<li><a href="../es430252/index.html">Enemigo por dentro: c√≥mo me met√≠ en el enrojecimiento interno</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>