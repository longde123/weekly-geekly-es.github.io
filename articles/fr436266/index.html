<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçüè≠ üòº üî© Mise √† l'√©chelle extr√™me dans Alibaba JDK ‚ôªÔ∏è üßóüèø üë®üèª‚Äçüíº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beaucoup se m√©fient de la perspective de bifurquer et d'√©crire quelque chose par eux-m√™mes. Souvent, le prix est trop √©lev√©. Il est particuli√®rement √©...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mise √† l'√©chelle extr√™me dans Alibaba JDK</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/436266/"><p>  Beaucoup se m√©fient de la perspective de bifurquer et d'√©crire quelque chose par eux-m√™mes.  Souvent, le prix est trop √©lev√©.  Il est particuli√®rement √©trange d'entendre parler de vos propres JDK, qui sont cens√©s se trouver dans toutes les grandes entreprises.  Que diable fait rage avec de la graisse?  Cet article sera une histoire d√©taill√©e de l'entreprise, qui tout cela apporte de r√©els avantages commerciaux, et qui a fait un travail terrible, car ils: </p><br><ul><li>  D√©velopper une machine Java virtuelle multi-locataire; </li><li>  Ils ont mis au point un m√©canisme pour le fonctionnement des objets qui n'entra√Ænent pas de frais g√©n√©raux pour la collecte des ordures; </li><li>  Ils ont fait quelque chose comme l'homologue ReadyNow d'Azul Zing; </li><li>  Ils ont arros√© leurs propres coroutines avec des rendements et des continuations (et sont m√™me pr√™ts √† partager leur exp√©rience avec Loom, dont j'ai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©crit √† l'automne</a> ); </li><li>  Ils ont viss√© √† tous ces miracles leur propre sous-syst√®me de diagnostic. </li></ul><br><p> Comme toujours, la vid√©o, le d√©cryptage de texte int√©gral et les diapositives vous attendent sous la coupe.  Bienvenue dans l'enfer de l'un des domaines les plus difficiles de l'adaptation des projets open source! </p><br><p><img src="https://habrastorage.org/webt/dk/gg/wt/dkggwtykndi-ewrxf_6ajxec7ts.png"></p><br><p>  <strong>Docteur, o√π obtenez-vous de telles photos?</strong>  O'Reilly Covers Corner: Le fond KDPV est fourni par Joshua Newton et repr√©sente la danse sacr√©e <em>Sangyang Jaran</em> √† Ubud, Indon√©sie.  Il s'agit d'une performance balinaise classique compos√©e de danse feu et transe.  Un homme √† talons nus se d√©place autour d'un feu de joie, √©lev√© sur des coques de noix de coco, poussant des choses avec ses pieds et dansant dans un √©tat de transe sous l'influence d'un esprit de cheval.  Illustration parfaite pour votre propre JDK, non? </p><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/94eTZsNYYBE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Diapositives et description du rapport</a> (vous n'en avez pas besoin, ce habratopike a tout ce dont vous avez besoin). </p><br><hr><br><p>  Bonjour, je m'appelle Sanhong Lee, je travaille chez Alibaba et j'aimerais parler des changements que nous avons apport√©s √† OpenJDK pour les besoins de notre entreprise.  Le poste se compose de trois parties.  Dans le premier, je parlerai de la fa√ßon dont Java est utilis√© dans Alibaba.  La deuxi√®me partie, √† mon avis, est la plus importante - nous y discuterons de la fa√ßon dont nous configurons OpenJDK pour les besoins de notre entreprise.  La troisi√®me partie portera sur les outils que nous avons cr√©√©s pour le diagnostic. </p><br><p>  Mais avant de passer √† la premi√®re partie, je voudrais vous parler bri√®vement de notre entreprise. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/2e2/20c/776/2e220c776112b1cf5e66b102559a39a5.jpg"></p><br><p>  Le diagramme montre la structure interne d'Alibaba.  Il est compos√© de diff√©rentes soci√©t√©s dont la principale sp√©cialit√© est l'organisation du march√© √©lectronique et la mise √† disposition de plateformes financi√®res et logistiques.  Je pense que la plupart des gens en Russie connaissent AliExpress.  Alibaba dispose d'une √©quipe d√©di√©e de programmeurs qui d√©veloppent et prennent en charge l'int√©gralit√© de la pile distribu√©e, fournissant des services aux clients Aliexpress du monde entier. </p><br><p>  Pour avoir une id√©e de l'ampleur du travail d'Alibaba, voyons ce qui se passe en Chine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lors de la Journ√©e des c√©libataires</a> .  Il est c√©l√©br√© chaque ann√©e le 11 novembre et ce jour-l√†, les gens ach√®tent surtout de nombreux produits via Alibaba.  Pour autant que je sache, parmi les vacances dans le monde, c'est celle qui fait le plus de shopping. <br></p><p><img src="https://habrastorage.org/getpro/habr/post_images/e31/55e/b62/e3155eb62e307c57535b1479351f41ad.jpg"></p><br><p>  Dans l'image ci-dessus, vous voyez un diagramme qui montre la charge sur notre syst√®me de support.  La ligne rouge montre le travail de notre service de commande et montre le nombre maximal de transactions par seconde, l'ann√©e derni√®re il s'√©levait √† 325 mille.  La ligne bleue fait r√©f√©rence au service de paiement, et elle a ce chiffre de 256 mille.  Je voudrais parler de la fa√ßon d'optimiser la pile desservant autant de transactions. </p><br><p>  Discutons des principales technologies qui fonctionnent dans Alibaba avec Java.  Tout d'abord, je dois dire que nous avons un certain nombre d'applications open source comme base.  Pour le traitement des m√©gadonn√©es, nous utilisons HBase Hadoop.  En tant que conteneur, nous utilisons Tomcat et OSGi.  Java est utilis√© √† une √©chelle colossale - des millions d'instances JVM sont d√©ploy√©es dans notre centre de donn√©es.  Il faut √©galement dire que notre architecture est orient√©e services, c'est-√†-dire que nous cr√©ons de nombreux services qui communiquent entre eux √† l'aide d'appels RPC.  Enfin, notre architecture est h√©t√©rog√®ne.  Pour am√©liorer les performances, de nombreux algorithmes sont √©crits √† l'aide de biblioth√®ques C et C ++, de sorte qu'ils communiquent avec Java √† l'aide d'appels JNI. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f99/614/041/f99614041cb58edab73a43dea38fdda9.jpg"></p><br><p>  L'histoire de notre travail avec OpenJDK a commenc√© en 2011, pendant OpenJDK 6. Il y a trois raisons importantes pour lesquelles nous avons choisi OpenJDK.  Tout d'abord, nous pouvons directement changer son code en fonction des besoins de l'entreprise.  Deuxi√®mement, lorsque des probl√®mes urgents surviennent, nous pouvons les r√©soudre nous-m√™mes plus rapidement que d'attendre la publication officielle.  C'est vital pour notre entreprise.  Troisi√®mement, nos d√©veloppeurs Java utilisent nos propres outils pour un d√©bogage et des diagnostics rapides et de haute qualit√©. </p><br><p>  Avant de passer aux questions techniques, je voudrais √©num√©rer les principales difficult√©s que nous devons surmonter.  Premi√®rement, nous avons lanc√© un grand nombre d'instances JVM - dans cette situation, la question de la r√©duction des co√ªts du mat√©riel est un probl√®me aigu.  Deuxi√®mement, j'ai d√©j√† dit que nous effectuons un grand nombre de transactions.  Gr√¢ce au garbage collector, Java nous promet une ¬´m√©moire infinie¬ª.  De plus, il gagne en performances √† bas niveau gr√¢ce au compilateur JIT.  Mais cela a aussi un revers: un temps d'arr√™t du monde plus long pour la collecte des ordures.  De plus, Java a besoin de cycles CPU suppl√©mentaires pour compiler les m√©thodes Java.  Cela signifie que les compilateurs se disputent les cycles CPU.  Les deux probl√®mes s'aggravent √† mesure que l'application devient plus complexe. </p><br><p>  La troisi√®me difficult√© est que nous avons beaucoup d'applications en cours d'ex√©cution.  Je pense que tout le monde ici est familier avec les outils fournis avec OpenJDK, tels que JConsole ou VisualVM.  Le probl√®me est qu'ils ne nous donnent pas les informations exactes dont nous avons besoin pour configurer.  De plus, lorsque nous utilisons ces outils (par exemple, JConsole ou VisualVM) en production, une surcharge faible n'est pas seulement un souhait, mais une exigence n√©cessaire.  J'ai d√ª √©crire mes propres outils de diagnostic. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ec5/da9/bcb/ec5da9bcb1620f073d5aed05aaba76aa.jpg"></p><br><p>  L'image d√©crit les modifications que nous avons apport√©es √† OpenJDK.  Voyons comment nous avons surmont√© les difficult√©s dont j'ai parl√© plus haut. </p><br><h1>  JVM multi-locataire </h1><br><p>  Une solution que nous appelons une machine virtuelle Java multi-locataire.  Il vous permet d'ex√©cuter en toute s√©curit√© plusieurs applications Web dans un seul conteneur.  Une autre solution est appel√©e GCIH (GC Invisible Heap).  Il s'agit d'un m√©canisme qui vous fournit des objets Java √† part enti√®re, qui en m√™me temps ne n√©cessitent pas le co√ªt de la r√©cup√©ration de place.  De plus, afin de r√©duire les co√ªts des contextes de threads, nous avons impl√©ment√© des coroutines sur notre plateforme Java.  De plus, nous avons √©crit un m√©canisme appel√© JWarmup - sa fonction est tr√®s similaire √† ReadyNow.  Douglas Hawkins semble l'avoir mentionn√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans son rapport</a> .  Enfin, nous avons d√©velopp√© notre propre outil de profilage, ZProfiler. </p><br><p>  Examinons de plus pr√®s comment nous impl√©mentons la multi-location bas√©e sur OpenJDK. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/133/d4b/f5f/133d4bf5f82bfa3f7a7df9abb0e59afa.jpg"></p><br><p>  Jetez un oeil √† l'image ci-dessus - je pense que la plupart d'entre vous connaissent ce mod√®le.  Comparez l'approche traditionnelle avec le multi-locataire.  Si votre application s'ex√©cute √† l'aide d'Apache Tomcat, vous pouvez √©galement ex√©cuter plusieurs instances dans le m√™me conteneur.  Mais Tomcat ne fournit pas de consommation de ressources stable pour chacun d'eux.  Par exemple, si l'une des applications en cours d'ex√©cution a besoin de plus de temps CPU que l'autre, comment contr√¥lerez-vous l'allocation du temps CPU?  Comment s'assurer que cette application n'affecte pas le travail des autres?  C'est principalement cette question qui nous a fait nous tourner vers la technologie multi-locataire. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e7f/77e/add/e7f77eadd29a6dbe8ea8ffc0cc1ec8ae.jpg"></p><br><p>  L'image montre sch√©matiquement comment nous l'impl√©mentons.  Nous cr√©ons plusieurs conteneurs pour les locataires √† l'int√©rieur de la JVM.  Chacun de ces conteneurs fournit un contr√¥le fiable de la consommation des ressources pour chaque module Java.  Plusieurs modules peuvent √™tre d√©ploy√©s dans un seul conteneur.  Chaque module peut √™tre associ√© √† un thread ou √† un groupe de threads lors de l'ex√©cution. </p><br><p>  Voyons √† quoi ressemble l'API du conteneur de locataires.  Nous avons une classe de configuration de locataire qui stocke des informations sur la consommation des ressources.  Ensuite, il y a une classe du conteneur lui-m√™me. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f3c/95e/27d/f3c95e27dbc40c2bb216b70f7521b270.jpg"></p><br><p>  Dans l'extrait de code pr√©sent√©, nous cr√©ons un locataire, puis indiquons combien de temps le processeur et la m√©moire lui sont fournis.  Le premier indicateur est un entier, ce qui signifie la part du temps CPU disponible pour le locataire, dans ce cas nous avons indiqu√© 512. Nous utilisons une approche tr√®s similaire dans le cas des cgroups, je m'attarderai l√†-dessus plus en d√©tail.  La deuxi√®me mesure est la taille de segment de m√©moire maximale que les locataires peuvent utiliser. </p><br><p> Consid√©rez comment un locataire interagit avec un thread.  La classe <code>.run()</code> fournit la m√©thode <code>.run()</code> et lorsqu'un thread y entre, il s'attache automatiquement au locataire et lorsqu'il le quitte, la proc√©dure inverse se produit.  Ainsi, tout le code est ex√©cut√© √† l'int√©rieur de la m√©thode <code>.run()</code> .  En outre, tout thread cr√©√© √† l'int√©rieur de la m√©thode <code>.run()</code> est attach√© au locataire du thread parent. </p><br><p>  Nous sommes arriv√©s √† une question tr√®s importante - comment le processeur est-il g√©r√© dans une machine virtuelle Java √† locataires multiples?  Notre solution vient d'√™tre impl√©ment√©e sur la plateforme Linux x64.  Il existe un m√©canisme de groupe de contr√¥le, cgroups.  Il vous permet de s√©lectionner un processus dans un groupe distinct, puis d'indiquer votre mode de consommation de ressources pour chaque groupe.  Essayons de transf√©rer cette approche dans le contexte de la JVM Hotspot.  Sur Hotstpot, les threads Java sont organis√©s en threads natifs. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/fbb/093/2d4/fbb0932d4d1dbc6ef982c17dcac8bebb.jpg"></p><br><p>  Ceci est illustr√© dans le diagramme ci-dessus: chaque thread Java est en correspondance biunivoque avec le thread natif.  Dans notre exemple, nous avons un conteneur <code>TenantA</code> , dans lequel il y a deux threads natifs.  Afin de pouvoir contr√¥ler la distribution du temps CPU, nous pla√ßons les deux threads natifs dans un groupe de contr√¥le.  Pour cette raison, nous pouvons r√©guler la consommation des ressources, en nous appuyant uniquement sur la fonctionnalit√© des [groupes de contr√¥le] ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://en.wikipedia.org/wiki/Cgroups</a> ). </p><br><p>  Jetons un coup d'≈ìil √† un exemple plus d√©taill√©. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/6ac/6c8/6bc/6ac6c86bc668c785c1dd92ee13547e2a.jpg"></p><br><p>  Les groupes de contr√¥le sous Linux sont mapp√©s sur un r√©pertoire.  Dans notre exemple, nous avons cr√©√© le r√©pertoire <code>/t0</code> pour le locataire 0. Ce r√©pertoire contient le r√©pertoire <code>/t0/tasks</code> , tous les threads pour <code>t0</code> seront situ√©s ici.  Un autre fichier important est <code>/t0/cpu.shares</code> .  Il indique combien de temps le processeur sera accord√© √† ce locataire.  Toute cette structure est h√©rit√©e des groupes de contr√¥le - nous avons simplement assur√© une correspondance directe entre le thread Java, le thread natif et le groupe de contr√¥le. </p><br><p>  Un autre probl√®me important concerne la gestion d'un groupe de chaque locataire. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b3a/570/b4e/b3a570b4ece66bcabd3bfa9d5071e553.jpg"></p><br><p>  Dans l'image, vous voyez un diagramme de la fa√ßon dont il est mis en ≈ìuvre.  Notre approche est bas√©e sur le G1GC.  Au bas de l'image, G1GC divise le tas en sections de m√™me taille.  Sur cette base, nous cr√©ons des contextes d'allocation de locataire, TAC, avec lesquels le locataire g√®re sa section de segment de m√©moire.  Gr√¢ce √† TAC, nous limitons la taille de la portion de tas disponible pour le locataire.  Ici, le principe s'applique, selon lequel chaque section du tas contient des objets d'un seul locataire.  Pour l'impl√©menter, nous devions apporter des modifications au processus de copie d'un objet pendant le garbage collection - il √©tait n√©cessaire de s'assurer que l'objet √©tait copi√© dans la bonne section du tas. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ae8/195/7c8/ae81957c8027d99056a66648472f9674.jpg"></p><br><p>  Sch√©matiquement, ce processus est d√©crit dans le diagramme ci-dessus.  Comme je l'ai dit, notre impl√©mentation est bas√©e sur G1GC.  G1GC est un garbage collector de copie, donc pendant le garbage collection, nous devons nous assurer que l'objet est copi√© dans la bonne section du tas.  Sur la diapositive, tous les objets cr√©√©s par <code>Tenant-1</code> doivent √™tre copi√©s dans sa partie du segment de m√©moire, similaire √† <code>Tenant-2</code> . </p><br><p>  D'autres consid√©rations surviennent lorsque les locataires sont isol√©s les uns des autres.  Ici, je dois dire sur TLAB (Thread Local Allocation Buffer) - un m√©canisme pour l'allocation rapide de la m√©moire.  L'espace TLAB d√©pend de la section de tas.  Comme je l'ai dit, diff√©rents locataires ont diff√©rents groupes de sections de tas. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0c9/0b4/1e7/0c90b41e753761f3a2e294ccef6e6591.jpg"></p><br><p>  Les d√©tails de l'utilisation de TLAB sont pr√©sent√©s sur la diapositive - lorsque le thread passe de <code>Tenant 1</code> √† <code>Tenant 2</code> , nous devons nous assurer que la bonne section de segment de m√©moire est utilis√©e pour l'espace TLAB.  Cela peut √™tre r√©alis√© de deux mani√®res.  La premi√®re fa√ßon est lorsque le <code>Thread A</code> passe du <code>Tenant 1</code> au <code>Tenant 2</code> , nous nous d√©barrassons simplement de l'ancien et en cr√©ons un nouveau dans le <code>Tenant 2</code> .  Cette m√©thode est relativement facile √† impl√©menter, mais elle gaspille de l'espace dans TLAB, ce qui n'est pas souhaitable.  La deuxi√®me fa√ßon est plus compliqu√©e - pour informer TLAB des locataires.  Cela signifie que nous aurons plusieurs tampons TLAB pour un thread.  Lorsque le <code>Thread A</code> passe du <code>Tenant 1</code> au <code>Tenant 2</code> , nous devons modifier le tampon et utiliser celui qui a √©t√© cr√©√© dans le <code>Tenant 2</code> . </p><br><p>  Un autre m√©canisme qui doit √™tre dit dans le cadre de la d√©limitation des locataires est l'IHOP (Initiator Thread Occupancy Percent).  Initialement, l'IHOP a √©t√© calcul√© sur la base du tas entier, mais dans le cas d'un m√©canisme √† plusieurs locataires, il doit √™tre calcul√© sur la base d'une seule section du tas. </p><br><p>  Examinons de plus pr√®s ce qu'est GCIH (GC Invisible Heap).  Ce m√©canisme cr√©e une section sur le tas, cach√©e du garbage collector et, par cons√©quent, non affect√©e par le garbage collection.  Ce site est g√©r√© par le locataire GCIH. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/00a/fc1/843/00afc1843cc320ee600a80892f0c4940.jpg"></p><br><p>  Il est important de dire ici que nous fournissons une API publique √† nos d√©veloppeurs Java.  Un exemple de travail avec celui-ci peut √™tre vu √† l'√©cran.  Il permet d'utiliser la m√©thode <code>moveIn()</code> pour d√©placer des objets d'un tas normal vers une partie du tas GCIH.  Son avantage est que vous pouvez toujours interagir avec ces objets comme avec les objets Java classiques, leur structure est tr√®s similaire.  Mais en m√™me temps, ils ne n√©cessitent pas le co√ªt de la collecte des ordures.  La conclusion, √† mon avis, est que si vous souhaitez acc√©l√©rer la collecte des ordures, vous devez personnaliser le comportement du garbage collector en fonction des besoins de votre application. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/af0/c7d/bb3/af0c7dbb3eca6dd45ecc10f52247e369.jpg"></p><br><p>  L'image montre un sch√©ma GCIH de haut niveau.  √Ä droite, un tas Java standard, √† gauche, l'espace allou√© √† GCIH.  Les liens d'un tas r√©gulier vers des objets dans GCIH sont valides, mais les liens de GCIH vers un tas normal ne le sont pas.  Pour comprendre pourquoi il en est ainsi, consid√©rons un exemple.  Nous avons l'objet ¬´A¬ª dans GCIH, qui contient une r√©f√©rence √† l'objet ¬´B¬ª dans un tas r√©gulier.  Le probl√®me est que l'objet B peut √™tre d√©plac√© par le garbage collector.  Comme je l'ai d√©j√† dit, nous ne faisons pas de mises √† jour dans GCIH, donc apr√®s que le garbage collector fonctionne, l'objet "A" peut contenir une r√©f√©rence invalide √† l'objet "B".  Ce probl√®me peut √™tre r√©solu en utilisant la barri√®re de pr√©-√©criture - ils ont √©t√© discut√©s dans un rapport pr√©c√©dent.  Par exemple, supposons que quelqu'un ait besoin d'enregistrer un lien √† partir d'un tas Java ordinaire vers GCIH avant que l'enregistrement que nous supposions n'entra√Æne une exception de pr√©dicteur avec un indicateur indiquant que la r√®gle a √©t√© viol√©e. </p><br><p>  Pour une application sp√©cifique, une machine virtuelle Java √† locataires multiples est utilis√©e dans notre plateforme de personnalisation Taobao, en abr√©g√© TPP.  Il s'agit d'un syst√®me de recommandation pour notre application e-shopping.  TPP peut d√©ployer plusieurs microservices dans un seul conteneur, et avec l'aide de la JVM multi-locataire, nous contr√¥lons la m√©moire et le temps CPU fournis √† chaque microservice. </p><br><p>  Quant √† GCIH, il est utilis√© dans notre autre syst√®me, UM Platform.  Il s'agit d'une application de r√©duction en ligne.  Le propri√©taire de cette application utilise GCIH pour pr√©-mettre en cache les donn√©es GCIH sur la machine locale, afin de ne pas acc√©der aux objets sur le serveur de cache distant ou la base de donn√©es distante.  En cons√©quence, nous all√©gons la charge sur le r√©seau et effectuons moins de s√©rialisation et de d√©s√©rialisation. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/36d/707/20c/36d70720cd2b4465b4b32b01467fbe51.jpg"></p><br><p>  L'image montre un diagramme dans lequel la couleur bleue montre la charge lors de l'utilisation d'un JDK conventionnel et le rouge - GCIH.  Comme vous pouvez le voir, nous r√©duisons l'utilisation du processeur de plus de 18%. </p><br><p>  Pour autant que je sache, un probl√®me similaire a √©t√© r√©solu par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BellSoft</a> , et leur solution √©tait similaire √† GCIH, mais ils ont utilis√© une approche diff√©rente pour r√©duire les co√ªts de s√©rialisation et de d√©s√©rialisation. </p><br><h1>  Coroutines en Java </h1><br><p>  Revenons √† Alibaba et voyons comment les coroutines peuvent √™tre impl√©ment√©es en Java.  Mais d'abord, parlons des origines, de la raison pour laquelle nous devons faire cela.  En Java, il √©tait toujours tr√®s facile d'√©crire des applications multithreads.  Mais le probl√®me avec la cr√©ation de telles applications est que, comme je l'ai dit, dans Hotspot, les threads Java sont d√©j√† impl√©ment√©s en tant que threads natifs.  Par cons√©quent, lorsqu'il y a beaucoup de threads dans votre application, les co√ªts de modification du contexte du thread deviennent tr√®s √©lev√©s. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/2c5/b79/4f1/2c5b794f12c5cfcc82fa893a82c7a92e.jpg"></p><br><p>  Prenons un exemple dans lequel nous aurons 4 threads d'E / S et 200 threads avec la logique de votre application.  Le tableau √† l'√©cran montre les r√©sultats du d√©marrage de cette d√©monstration simple - vous pouvez voir combien de temps le processeur prend pour changer de contexte.  La solution √† ce probl√®me peut √™tre l'impl√©mentation de la corutine en Java. </p><br><p>  Pour le fournir, nous avions besoin de deux choses.  Tout d'abord, Alibaba JDK devait ajouter un support de continuation.  Ce travail √©tait bas√© sur le patch JKU, nous y reviendrons plus en d√©tail.  Deuxi√®mement, nous avons ajout√© un sheduler en mode utilisateur qui sera responsable de la suite dans le thread.  Troisi√®mement, il y a beaucoup d'applications √† Alibaba.  Par cons√©quent, notre solution est tr√®s importante pour nos d√©veloppeurs Java, et il √©tait n√©cessaire de la rendre absolument transparente pour eux.  Et cela signifie que dans notre application m√©tier, il ne devrait y avoir pratiquement aucun changement dans le code.  Nous avons appel√© notre solution Wisp.  Notre impl√©mentation de coroutines en Java est largement utilis√©e dans Alibaba, il peut donc √™tre consid√©r√© comme prouv√© qu'elle fonctionne en Java.  Apprenez √† le conna√Ætre plus en d√©tail. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5af/7af/0c2/5af7af0c2075b299ef7152bd8cff94fe.jpg"></p><br><p>  Commen√ßons par l'exemple, dont le code est pr√©sent√© ci-dessus - il s'agit d'une application Java tout √† fait ordinaire.  Tout d'abord, un pool de threads est cr√©√©.  Ensuite, une autre t√¢che ex√©cutable est cr√©√©e qui accepte le socket.  Apr√®s cela, la lecture du flux est effectu√©e.  Ensuite, nous cr√©ons une autre t√¢che ex√©cutable, avec laquelle nous nous connectons au serveur et, enfin, √©crivons des donn√©es dans le flux.  Comme vous pouvez le voir, tout semble assez standard.  Si vous ex√©cutez le code sur un JDK standard, chacune de ces t√¢ches ex√©cutables sera ex√©cut√©e dans un thread distinct.  Mais dans notre d√©cision, la m√©canique sera compl√®tement diff√©rente. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a06/f12/716/a06f12716380d6e3447ac9de3784c37c.jpg"></p><br><p>  Comme vous pouvez le voir sur le vidage du fil montr√© sur la diapositive, nous cr√©ons deux coroutines dans un fil, et non deux fils.  Vous devez maintenant faire fonctionner cette solution.  L'essentiel ici est de g√©n√©rer des √©v√©nements yieldTo √† tous les points de blocage possibles.  Dans notre exemple, ces points seront <code>serverSocket.accept()</code> , <code>is.read(buf)</code> , une connexion socket et <code>os.write(buf)</code> .  Gr√¢ce aux √©v√©nements de rendement √† ces points, nous pourrons transf√©rer le contr√¥le d'une coroutine √† une autre dans le m√™me thread.  Pour r√©sumer, notre approche est que nous obtenons des performances asynchrones en utilisant coroutine, mais nos programmeurs peuvent √©crire du code dans un style synchrone, car un tel code est beaucoup plus simple et plus facile √† maintenir et √† d√©boguer. </p><br><p>  Voyons exactement comment nous avons fourni un support de continuation dans Alibaba JDK.  Comme je l'ai dit, ce travail est bas√© sur un projet de machine virtuelle multilingue cr√©√© par la communaut√© - il est dans le domaine public.  Nous avons utilis√© ce correctif dans Alibaba JDK et corrig√© certains bogues qui se produisaient dans notre environnement de production. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5e3/580/3bd/5e35803bda5ad8ae70b35f3fd5fd4771.jpg"></p><br><p>  Comme vous pouvez le voir dans le diagramme, ici, dans un thread, il peut y avoir plusieurs coroutines, et pour chacune une pile distincte est cr√©√©e.  De plus, le patch dont j'ai parl√© nous fournit ici l'API la plus importante - yieldTo, √† l'aide de laquelle le contr√¥le est transf√©r√© d'une coroutine √† une autre. </p><br><p>  Passons √† la fa√ßon dont nous avons impl√©ment√© le sheduler en mode utilisateur pour coroutine.  Nous utilisons un s√©lecteur, et avec lui, nous enregistrons plusieurs canaux.  Lorsqu'un √©v√©nement d'E / S (lecture de socket, √©criture de socket, connexion de socket ou acceptation de socket) se produit, il est √©crit comme cl√© pour le s√©lecteur.  Par cons√©quent, √† la fin de cet √©v√©nement, nous recevons une alerte du s√©lecteur.  Ainsi, nous utilisons un s√©lecteur pour planifier les coroutines en cas de verrouillage d'E / S.  Prenons un exemple de la fa√ßon dont cela fonctionnera. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a32/45d/f81/a3245df8176dc1c23d810413ff1f1031.jpg"></p><br><p>  Dans l'image, nous voyons le socket et l'appel synchrone <code>client.read(buffer)</code> .  Au bas de la diapositive, un code est √©crit qui sera ex√©cut√© √† l'int√©rieur de cet appel.  Tout d'abord, il v√©rifie s'il est possible de lire √† partir du canal ou non.  Si c'est le cas, nous renvoyons le r√©sultat.  La chose la plus int√©ressante se produit si la lecture ne peut pas √™tre effectu√©e.  Ensuite, nous enregistrons l'√©v√©nement de lecture dans notre planificateur avec s√©lecteur.  Cela permet de planifier l'ex√©cution de toute autre coroutine.  Regardez comment cela se produit.  Nous avons un fil dans lequel un ordonnanceur est cr√©√©.  Le fil et notre coroutine sont en correspondance biunivoque.  Sheduler nous permet de g√©rer les coroutines de ce fil.  Que se passe-t-il si les E / S sont bloqu√©es?  Lorsque des √©v√©nements d'E / S se produisent, le sheduler re√ßoit une alerte et, dans cette situation, il d√©pend enti√®rement du s√©lecteur.  Apr√®s un tel √©v√©nement, le sheduler a la possibilit√© de planifier la prochaine coroutine disponible. </p><br><p>  R√©sumons l'aper√ßu de notre sheduler, que nous avons appel√© WispEngine.  Pour chacun de nos threads, nous allouons un WispEngine distinct.  Lorsqu'un verrouillage coroutine se produit, nous enregistrons certains √©v√©nements (lecture / √©criture de socket, etc.) √† l'aide de WispEngine.  Certains √©v√©nements sont li√©s au stationnement des threads, par exemple, si vous appelez <code>thread.sleep()</code> avec un d√©lai de 100 millisecondes.  Dans ce cas, un √©v√©nement de stationnement de thread sera g√©n√©r√© pour vous, qui sera ensuite enregistr√© dans le s√©lecteur.  Un autre probl√®me important est le moment o√π le sheduler nomme la prochaine coroutine disponible.  Il y a deux conditions principales.  Le premier est lorsque certains √©v√©nements sont g√©n√©r√©s, tels que des √©v√©nements d'E / S ou des √©v√©nements d'expiration.  Tout est assez simple ici: supposons que vous <code>thread.sleep()</code> avec un retard de 200 millisecondes.  A leur expiration, le sheduler a la possibilit√© d'ex√©cuter la prochaine coroutine disponible.  Ou ici, nous pouvons parler de certains √©v√©nements de d√©compression qui sont g√©n√©r√©s, par exemple, en appelant <code>object.notify()</code> ou <code>object.notifyAll()</code> La deuxi√®me condition est lorsque l'utilisateur soumet de nouvelles demandes, et nous cr√©ons une coroutine pour r√©pondre √† ces demandes, puis le sheduler attribue sa mise en ≈ìuvre. </p><br><p>  Ici, vous devez √©galement parler du service que nous avons cr√©√©, WispThreadExecutor. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5a5/ddc/881/5a5ddc88194e0794593506627f420915.jpg"></p><br><p>  Un exemple de code est pr√©sent√© √† l'√©cran, et nous voyons qu'il s'agit d'un ExecutorService normal, cr√©√© de la m√™me mani√®re.  Les <code>.execute()</code> et <code>submit()</code> sont disponibles pour les t√¢ches Runnable, mais le probl√®me est que toutes les t√¢ches Runnable qui passent par la m√©thode <code>submit()</code> seront ex√©cut√©es dans corutin, et non dans le thread.  Cette solution est totalement transparente pour ceux qui vont impl√©menter notre application, ils pourront utiliser notre API pour les coroutines. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/2b5/e03/041/2b5e03041077b86eb3b4438a5d286813.jpg"></p><br><p>  J'en viens √† la derni√®re partie difficile de l'article - comment r√©soudre le probl√®me de la synchronisation dans les coroutines.  C'est une question complexe, alors regardons-la avec un exemple simplifi√©.  Nous avons ici la coroutine A ( <code>test::foo</code> ) et la corutine <code></code> ( <code>test::bar</code> ).  Tout d'abord, nous attribuons l'ex√©cution du <code>test:foo</code> √† la coroutine <code></code>  La Corutine <code></code> appelle <code></code> <code>wait()</code> .  Si rien n'est fait, le thread actuel sera bloqu√© par l'appel √† <code>wait()</code> .  Comme on peut le voir √† partir de ce vidage du thread, un blocage se produira et nous ne pourrons pas planifier la prochaine coroutine √† ex√©cuter. </p><br><p>  Comment r√©soudre ce probl√®me?  Hotspot propose trois types de verrous.  Le premier est le verrouillage rapide.  Ici, le propri√©taire du verrou est d√©termin√© par l'adresse sur la pile.  Comme je l'ai dit, chacune de nos coroutines a une pile distincte.  Par cons√©quent, dans le cas d'un verrouillage rapide, nous n'avons pas besoin d'effectuer de travail suppl√©mentaire.  Il n'y a pas de support similaire pour le verrouillage biais√© dans notre syst√®me.  Nous l'avons essay√© sur notre production et il s'est av√©r√© qu'en l'absence d'un verrou biais√©, les performances ne diminuent pas.  Pour nous, c'est tout √† fait appropri√©. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/1a9/051/bd1/1a9051bd163c97d904d6a4bd13afb188.jpg"></p><br><p>  Parlons d'un cas plus compliqu√© - verrou gonfl√©.  Reprenons l'exemple que j'ai cit√© plus haut.  Nous avons Corutin <code></code> ( <code>.foo()</code> ) et Corutin <code>B</code> ( <code>.bar()</code> ).  Tout d'abord, nous attribuons l'ex√©cution de la coroutine <code></code> et la d√©marrons.  Ensuite, il appelle <code>Object.wait</code> , apr√®s quoi il entre dans la liste d'attente.  Apr√®s cela, nous prenons une √©tape tr√®s importante: nous g√©n√©rons l'√©v√©nement <code>yieldTo</code> , qui transf√®re le contr√¥le au thread principal.  Ensuite, nous commen√ßons Corutin <code>B</code>  Il appelle <code>Object.notify</code> et les √©v√©nements d' <code>Object.notify</code> correspondants sont <code>unpark</code> .  Ils r√©veilleront √©ventuellement la coroutine <code></code>  Une fois l'ex√©cution de la <code>bar()</code> , il sera possible de transf√©rer le contr√¥le √† la coroutine <code></code>  Ainsi, l'impasse que j'ai mentionn√©e plus t√¥t est compl√®tement surmont√©e. </p><br><p>  Parlons maintenant des performances.  Nous utilisons des coroutines dans l'une de nos applications en ligne Carts.  Sur cette base, nous pouvons comparer le travail de la corutine avec le travail d'un JDK r√©gulier. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/022/52c/c95/02252cc950a2ad902d2feb29f4129249.jpg"></p><br><p>  Comme vous pouvez le voir, ils nous permettent de r√©duire la consommation de temps processeur de pr√®s de 10%.  Je comprends que la plupart d'entre vous n'ont probablement pas la possibilit√© d'apporter directement des modifications aussi complexes au code JDK.  Mais la principale conclusion ici, √† mon avis, est que si les pertes de performances co√ªtent de l'argent et que le montant r√©sultant est suffisamment important, vous pouvez essayer d'am√©liorer les performances en utilisant la biblioth√®que coroutine. </p><br><h1>  Jarmarm </h1><br><p>  Passons √† notre autre outil - JWarmup.  Il est tr√®s similaire √† un autre outil, ReadyNow.  Comme nous le savons, en Java il y a un probl√®me d'√©chauffement - le compilateur √† ce stade n√©cessite des cycles CPU suppl√©mentaires.  Cela nous a caus√© des probl√®mes - par exemple, une erreur TimeOut s'est produite.  Lors de la mise √† l'√©chelle, ces probl√®mes ne font qu'empirer, et dans notre cas, nous parlons d'une application tr√®s complexe - plus de 20 000 classes et plus de 50 000 m√©thodes. </p><br><p>  Avant de commencer √† utiliser JWarmup, les propri√©taires de notre application utilisaient des donn√©es simul√©es pour se r√©chauffer.  Sur ces donn√©es, le compilateur JIT a pr√©compil√© avant la r√©ception des demandes.  Mais les donn√©es simul√©es sont diff√©rentes des vraies; par cons√©quent, elles ne sont pas repr√©sentatives pour le compilateur.  Dans certains cas, une d√©soptimisation inattendue s'est produite, les performances ont souffert.  La solution √† ce probl√®me √©tait JWarmup.  Il a deux √©tapes principales de travail - l'enregistrement et la compilation.  Alibaba a deux types d'environnements, b√™ta et production.  Les deux re√ßoivent des demandes r√©elles des utilisateurs, apr√®s quoi la m√™me version de l'application est d√©ploy√©e dans ces deux environnements.  Dans l'environnement b√™ta, seules les donn√©es de profilage sont collect√©es, sur la base desquelles une compilation pr√©liminaire en production est ensuite effectu√©e. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5e4/aec/01c/5e4aec01c9cece135daff42490463627.jpg"></p><br><p>  Voyons plus en d√©tail le type d'informations que nous collectons.  Nous devons √©crire exactement quelles classes sont initialis√©es, quelles m√©thodes sont compil√©es, puis ces donn√©es sont vid√©es dans le journal sur le disque dur, qui est accessible au compilateur.  Le moment le plus difficile est l'initialisation des classes.  Son ordre d√©pend enti√®rement de la logique d'application.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La diapositive montre un exemple - l'initialisation de la classe </font></font><code>Bar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit se produire apr√®s l'ex√©cution </font></font><code>Foo.test()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, comme elle l'utilise </font></font><code>foo.count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dans cette situation, nous effectuons l'initialisation au moment o√π toute la logique n√©cessaire est d√©j√† termin√©e.</font></font></p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/3f9/1fa/cfe/3f91facfe6c55e70cad3bebe147d17ff.jpg"></p><br><p>      JWarmup    (tiered compilation),     .     ,    ‚Äî  CPU.     JWarmup    ,      CPU,   JDK.  ,       ,           JDK. ,             ,     . </p><br><p>       JWarmup.     ,     , ,  groovy-,    Java-,  .     .  ,     ,  ¬´null check elimination¬ª.         . ,    JWarmup    ,       JWarmup,   . </p><br><h1>   </h1><br><p>      ,     Alibaba. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ef5/7c9/4b0/ef57c94b07c6f3335e44d9b7baa360b9.jpg"></p><br><p>    .    JVM ‚Äî  ,    ,     .       Java-, metaspace,  VM (     VM)     JIT-.        OpenJDK. -,          ,       . -,        .   HotMethodProfiling,   ,       CPU.  ,      ,    <em>Honest Profiler</em> ,     ,      ,     HotMethodProfiling.    MethodTracing.           ,    ,     .  ,       metaspace   .          Java-,        .   metaspace  ,    .       Java. </p><br><p> ,      ,   ZProfiler. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/201/324/1fc/2013241fca408ec2cea997d466327a33.jpg"></p><br><p>       .      JVMTi,     JVM (  ).  ,    ZProfiler   Apache Tomcat.      -.    ZProfiler     JVM. ,  ZProfiler  -UI,     . ZProfiler    . -,      UI        JVM. -, ZProfiler  post-mortem . ,        OutOfMemoryError,       ,         JVM   ZProfiler,       .    ,    , , Eclipse MAT. </p><br><p>  .         .   JVM, GCIH,   Alibaba JDK,   JWarmup ‚Äî ,    ReadyNow   Zing JVM. ,    ZProfiler.      ,         ,      OpenJDK.      ,  ,    JWarmup  OpenJDK.  ,      OpenJDK   Loom,     Java.     ,   . </p><br><blockquote>  . ,     ,     JPoint  2018 .    2019 ,   JPoint   , 5-6 .      ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>     Rafael Winterhalter  Sebastian Daschner.     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> .        ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   YouTube</a> .   JPoint! </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr436266/">https://habr.com/ru/post/fr436266/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr436254/index.html">Un bot pour Starcraft en rouille, C ou toute autre langue</a></li>
<li><a href="../fr436256/index.html">Obtenir un emploi en Allemagne sera plus facile</a></li>
<li><a href="../fr436260/index.html">Erreurs et pi√®ges des startups dans le brevetage de leur propri√©t√© intellectuelle</a></li>
<li><a href="../fr436262/index.html">* La mise √† jour d'Ethereum "Constantinople" est report√©e en raison d'une vuln√©rabilit√© potentielle trouv√©e au dernier moment</a></li>
<li><a href="../fr436264/index.html">Mono-r√©f√©rentiels: veuillez ne pas le faire (partie 2)</a></li>
<li><a href="../fr436268/index.html">Nous collectons un jeu complet</a></li>
<li><a href="../fr436270/index.html">35% de l'audience Runet n'utilise pas du tout d'ordinateur pour Internet</a></li>
<li><a href="../fr436272/index.html">Programmation visuelle pour Sonoff Basic</a></li>
<li><a href="../fr436276/index.html">Visualisation tridimensionnelle dans des simulateurs de mat√©riel roulant bas√©s sur le moteur OpenSceneGraph</a></li>
<li><a href="../fr436282/index.html">D√©fi d'une entreprise √©trang√®re ou √©chec d'une entrevue</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>