<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèáüèæ üïê üôÇ Primera introducci√≥n a AssemblyScript üèπ üßë‚Äçü§ù‚Äçüßë üë®üèª‚Äçüíª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El soporte para la tecnolog√≠a WebAssembly (Wasm) ha aparecido en los navegadores relativamente recientemente. Pero esta tecnolog√≠a puede ampliar las c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Primera introducci√≥n a AssemblyScript</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/477272/">  El soporte para la tecnolog√≠a <a href="https://webassembly.org/">WebAssembly</a> (Wasm) ha aparecido en los navegadores relativamente recientemente.  Pero esta tecnolog√≠a puede ampliar las capacidades de la web, convirti√©ndola en una plataforma capaz de admitir aplicaciones que generalmente se perciben como escritorio. <br><br>  Dominar WebAssembly puede ser una tarea desalentadora para los desarrolladores web.  Sin embargo, el compilador <a href="https://assemblyscript.org/">AssemblyScript</a> puede mejorar la situaci√≥n. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pw/p4/91/pwp491ryabgnwblabon5slwooey.jpeg"></div><br>  El autor del art√≠culo, que publicamos la traducci√≥n de hoy, ofrece primero hablar sobre por qu√© WebAssembly es una tecnolog√≠a muy prometedora, y luego echar un vistazo a c√≥mo AssemblyScript puede ayudar a desbloquear el potencial de Wasm. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Montaje web</font> </h2><br>  WebAssembly puede llamarse un lenguaje de bajo nivel para navegadores.  Ofrece a los desarrolladores la capacidad de crear c√≥digo que se compila en algo distinto de JavaScript.  Esto permite que los programas incluidos en las p√°ginas web funcionen casi tan r√°pido como las aplicaciones nativas para varias plataformas.  Dichos programas se ejecutan en un entorno limitado y seguro. <br><br>  Los representantes de los equipos responsables del desarrollo de todos los principales navegadores (Chrome, Firefox, Safari y Edge) participaron en la creaci√≥n del est√°ndar WebAssembly.  Acordaron una <a href="https://lists.w3.org/Archives/Public/public-webassembly/2017Feb/0002.html">arquitectura de</a> sistema a principios de 2017.  Ahora todos los navegadores anteriores admiten WebAssembly.  De hecho, esta tecnolog√≠a se puede utilizar en <a href="https://caniuse.com/">aproximadamente el 87% de los</a> navegadores. <br><br>  El c√≥digo de WebAssembly existe en formato binario.  Esto significa que dicho c√≥digo es m√°s peque√±o que un c√≥digo JavaScript similar y se carga m√°s r√°pido.  El c√≥digo wasm, adem√°s, se puede presentar en <a href="https://developer.mozilla.org/en-US/docs/WebAssembly/Understanding_the_text_format">formato de texto</a> , para que las personas puedan leerlo y editarlo. <br><br>  Cuando apareci√≥ por primera vez el est√°ndar WebAssembly, algunos desarrolladores pensaron que bien podr√≠a ocupar el lugar de JavaScript y convertirse en el idioma principal de la web.  Pero WebAssembly se ve mejor como una nueva herramienta que se integra bien con la plataforma web existente.  Este es uno de sus <a href="https://webassembly.org/docs/high-level-goals/">objetivos prioritarios</a> . <br><br>  En lugar de reemplazar JavaScript donde este lenguaje se ha utilizado durante mucho tiempo y con √©xito, WebAssembly ofrece nuevas oportunidades interesantes para los desarrolladores web.  Es cierto que el c√≥digo Wasm no tiene acceso directo al DOM, por lo que la mayor√≠a de los proyectos web existentes continuar√°n usando JavaScript.  Este lenguaje, a lo largo de los a√±os de desarrollo y optimizaci√≥n, ya es bastante r√°pido.  Y WebAssembly tiene sus propias <a href="https://webassembly.org/docs/use-cases/">aplicaciones</a> : <br><br><ul><li>  Juegos </li><li>  C√°lculos cient√≠ficos, visualizaciones, simulaciones. </li><li>  Aplicaciones CAD. </li><li>  Edici√≥n de im√°genes y videos. </li></ul><br>  Todos estos usos para Wasm est√°n unidos por lo que sus respectivas aplicaciones generalmente se consideran de escritorio.  Pero debido al hecho de que WebAssembly le permite alcanzar un nivel de rendimiento cercano al nativo, muchas aplicaciones similares ahora se pueden implementar utilizando la plataforma web. <br><br>  WebAssembly puede aprovechar los proyectos web existentes.  Un ejemplo es el proyecto <a href="https://www.figma.com/">Figma</a> .  Gracias al uso de Wasm, el tiempo de carga de este proyecto mejor√≥ significativamente.  Si un sitio web usa c√≥digo que realiza c√°lculos pesados, entonces, para mejorar el rendimiento de este sitio web, tiene sentido reemplazar solo dicho c√≥digo con un an√°logo de WebAssembly. <br><br>  Es posible que desee intentar utilizar WebAssembly en sus propios proyectos.  Este idioma se puede aprender y escribir <a href="https://blog.scottlogic.com/2018/04/26/webassembly-by-hand.html">inmediatamente en √©l</a> .  Pero, sin embargo, WebAssembly se desarroll√≥ originalmente como un <a href="https://github.com/appcypher/awesome-wasm-langs">objetivo de compilaci√≥n</a> para otros idiomas.  Fue <a href="https://webassembly.org/docs/c-and-c%2B%2B/">dise√±ado</a> con buen soporte para C y C ++.  Wasm <a href="">experimental support</a> apareci√≥ en Go 1.11.  Se est√° poniendo mucho esfuerzo en escribir aplicaciones Wasm en <a href="https://www.rust-lang.org/what/wasm">Rust</a> . <br><br>  Pero es muy posible que los desarrolladores web no quieran aprender C, C ++, Go o Rust solo para usar WebAssembly.  Que hacen  La respuesta a esta pregunta puede dar AssemblyScript. <br><br><h2>  <font color="#3AC1EF">AssemblyScript</font> </h2><br>  AssemblyScript es un compilador que convierte el c√≥digo TypeScript en c√≥digo WebAssembly.  TypeScript es un lenguaje desarrollado por Microsoft.  Este es un superconjunto de JavaScript, con soporte de tipo mejorado y algunas otras caracter√≠sticas.  TypeScript se ha convertido en un lenguaje bastante <a href="https://insights.stackoverflow.com/survey/2019">popular</a> .  Cabe se√±alar que AssemblyScript puede convertir a Wasm solo un conjunto limitado de construcciones TypeScript.  Esto significa que incluso alguien que no est√© familiarizado con TypeScript puede aprender r√°pidamente este lenguaje a un nivel suficiente para escribir c√≥digo que AssemblyScript entienda. <br><br>  Adem√°s, dado que TypeScript es muy similar a JavaScript, podemos decir que la tecnolog√≠a AssemblyScript permite a los desarrolladores web integrar f√°cilmente m√≥dulos Wasm en sus proyectos sin la necesidad de aprender un lenguaje completamente nuevo. <br><br><h2>  <font color="#3AC1EF">Ejemplo</font> </h2><br>  Escribamos nuestro primer m√≥dulo AssemblyScript.  Todo el c√≥digo que vamos a discutir ahora se puede encontrar en <a href="https://github.com/dguo/assemblyscript-demo">GitHub</a> .  Para <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly">admitir</a> WebAssembly, necesitamos al menos <a href="https://nodejs.org/">Node.js</a> 8. <br><br>  Cree un nuevo directorio, inicialice el proyecto npm e instale AssemblyScript: <br><br><pre><code class="javascript hljs">mkdir assemblyscript-demo cd assemblyscript-demo npm init npm install --save-dev github:AssemblyScript/assemblyscript</code> </pre> <br>  Tenga en cuenta que AssemblyScript debe instalarse directamente desde <a href="https://github.com/AssemblyScript/assemblyscript">el repositorio GitHub</a> del proyecto.  AssemblyScript a√∫n no se ha publicado en npm, ya que los desarrolladores <a href="https://github.com/AssemblyScript/assemblyscript/issues/442">a√∫n no lo consideran</a> listo para su uso generalizado. <br><br>  Crearemos archivos auxiliares utilizando el comando <code>asinit</code> incluido en AssemblyScript: <br><br><pre> <code class="javascript hljs">npx asinit .</code> </pre> <br>  Ahora la secci√≥n de <code>scripts</code> de nuestro <code>package.json</code> deber√≠a tomar la siguiente forma: <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: {    <span class="hljs-string"><span class="hljs-string">"asbuild:untouched"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/untouched.wasm -t build/untouched.wat --sourceMap --validate --debug"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild:optimized"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/optimized.wasm -t build/optimized.wat --sourceMap --validate --optimize"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run asbuild:untouched &amp;&amp; npm run asbuild:optimized"</span></span>  } }</code> </pre> <br>  El archivo <code>index.js</code> ubicado en la carpeta ra√≠z del proyecto se ver√° as√≠: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"fs"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> compiled = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebAssembly.Module(fs.readFileSync(__dirname + <span class="hljs-string"><span class="hljs-string">"/build/optimized.wasm"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> imports = {  <span class="hljs-attr"><span class="hljs-attr">env</span></span>: {    abort(_msg, _file, line, column) {       <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(<span class="hljs-string"><span class="hljs-string">"abort called at index.ts:"</span></span> + line + <span class="hljs-string"><span class="hljs-string">":"</span></span> + column);    }  } }; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(<span class="hljs-built_in"><span class="hljs-built_in">module</span></span>, <span class="hljs-string"><span class="hljs-string">"exports"</span></span>, {  <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebAssembly.Instance(compiled, imports).exports });</code> </pre> <br>  Esto le permite incluir m√≥dulos WebAssembly en su c√≥digo utilizando el comando <a href="https://nodejs.org/api/modules.html">require</a> .  Es decir, de la misma manera que los m√≥dulos JavaScript normales est√°n conectados. <br><br>  La carpeta de <code>assembly</code> contiene el archivo <code>index.ts</code> .  Tiene c√≥digo fuente escrito de acuerdo con las reglas de AssemblyScript.  El c√≥digo repetitivo generado autom√°ticamente es una funci√≥n simple para agregar dos n√∫meros: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a: i32, b: i32</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i32</span></span></span><span class="hljs-function"> </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b; }</code> </pre> <br>  Quiz√°s esperaba que la firma de una funci√≥n similar se pareciera a <code>add(a: number, b: number): number</code> .  Por lo tanto, se ver√≠a si estuviera escrito en TypeScript ordinario.  Pero aqu√≠, en lugar del tipo de <code>number</code> , se <code>i32</code> tipo <code>i32</code> .  Esto sucede porque el c√≥digo AssemblyScript utiliza <a href="https://docs.assemblyscript.org/basics/types">tipos</a> espec√≠ficos de <a href="https://docs.assemblyscript.org/basics/types">WebAssembly</a> para enteros y n√∫meros de coma flotante, en lugar del tipo de <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html">n√∫mero</a> gen√©rico de TypeScript. <br><br>  Armemos el proyecto: <br><br><pre> <code class="javascript hljs">npm run asbuild</code> </pre> <br>  Los siguientes archivos deber√≠an aparecer en la carpeta de <code>build</code> : <br><br><pre> <code class="javascript hljs">optimized.wasm optimized.wasm.map optimized.wat untouched.wasm untouched.wasm.map untouched.wat</code> </pre> <br>  Hay versiones optimizadas y regulares del ensamblaje.  Cada versi√≥n del ensamblaje nos proporciona un archivo .wasm binario, un <a href="https://developer.mozilla.org/en-US/docs/Tools/Debugger/How_to/Use_a_source_map">mapa de mapa</a> .wasm.map y una representaci√≥n textual del c√≥digo binario en un archivo .wat.  La presentaci√≥n de prueba del c√≥digo Wasm est√° destinada al programador, pero ni siquiera miraremos este archivo.  En realidad, una de las razones para usar AssemblyScript es que elimina la necesidad de trabajar con c√≥digo Wasm. <br><br>  Ahora ejecutemos Node.js en modo REPL y asegur√©monos de que el m√≥dulo Wasm compilado se pueda usar de la misma manera que cualquier m√≥dulo JS normal: <br><br><pre> <code class="javascript hljs">$ node Welcome to Node.js v12<span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>. Type <span class="hljs-string"><span class="hljs-string">".help"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> more information. &gt; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> add = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./index'</span></span>).add; <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> &gt; add(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span></code> </pre> <br>  En general, esto es todo lo que se necesita para usar la tecnolog√≠a WebAssembly en Node.js. <br><br><h2>  <font color="#3AC1EF">Equipar un proyecto con un guion de observador</font> </h2><br>  Para reconstruir autom√°ticamente el m√≥dulo durante el desarrollo al realizar cambios, recomiendo usar el paquete <a href="https://github.com/Qard/onchange">onchange</a> .  El hecho es que AssemblyScript <a href="https://github.com/AssemblyScript/assemblyscript/issues/624">a√∫n no tiene</a> su propio sistema para monitorear los cambios de archivos.  Instale el paquete onchange: <br><br><pre> <code class="javascript hljs">npm install --save-dev onchange</code> </pre> <br>  Agregue <code>asbuild:watch</code> script a <code>package.json</code> .  <a href="https://github.com/Qard/onchange">El indicador</a> <code>-i</code> <a href="https://github.com/Qard/onchange">se</a> incluye en el comando para que el proceso de compilaci√≥n comience una vez cuando se llama al script, antes de que ocurra cualquier evento. <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: {    <span class="hljs-string"><span class="hljs-string">"asbuild:untouched"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/untouched.wasm -t build/untouched.wat --sourceMap --validate --debug"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild:optimized"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/optimized.wasm -t build/optimized.wat --sourceMap --validate --optimize"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run asbuild:untouched &amp;&amp; npm run asbuild:optimized"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild:watch"</span></span>: <span class="hljs-string"><span class="hljs-string">"onchange -i 'assembly/**/*' -- npm run asbuild"</span></span>  } }</code> </pre> <br>  Ahora, en lugar de ejecutar constantemente el comando <code>asbuild</code> , solo ejecuta <code>asbuild:watch</code> una vez. <br><br><h2>  <font color="#3AC1EF">Rendimiento</font> </h2><br>  Escribiremos una prueba simple que evaluar√° el nivel de rendimiento del c√≥digo Wasm.  El alcance principal de WebAssembly es resolver tareas que usan el procesador de manera intensiva.  Por ejemplo, estos son alg√∫n tipo de c√°lculos "pesados".  Creemos una funci√≥n que descubra si cierto n√∫mero es primo. <br><br>  La implementaci√≥n b√°sica de JS de una funci√≥n similar se muestra a continuaci√≥n.  Est√° organizado de manera muy simple, verifica el n√∫mero por fuerza bruta, pero para nuestros prop√≥sitos es adecuado, ya que realiza grandes cantidades de c√°lculos. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPrime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;    }    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; x; i++) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x % i === <span class="hljs-number"><span class="hljs-number">0</span></span>) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br>  Una funci√≥n similar, escrita para el compilador AssemblyScript, se ve casi igual.  La principal diferencia es la presencia de anotaciones de tipo en el c√≥digo: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPrime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x: u32</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;    }    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i: u32 = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; x; i++) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x % i === <span class="hljs-number"><span class="hljs-number">0</span></span>) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br>  Para analizar el rendimiento del c√≥digo, utilizaremos el paquete <a href="https://benchmarkjs.com/">Benchmark.js</a> .  Instalarlo: <br><br><pre> <code class="javascript hljs">npm install --save-dev benchmark</code> </pre> <br>  Cree el archivo <code>benchmark.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Benchmark = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'benchmark'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> assemblyScriptIsPrime = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./index'</span></span>).isPrime; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPrime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; x; i++) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x % i === <span class="hljs-number"><span class="hljs-number">0</span></span>) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> suite = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Benchmark.Suite; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> startNumber = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> stopNumber = <span class="hljs-number"><span class="hljs-number">10000</span></span>; suite.add(<span class="hljs-string"><span class="hljs-string">'AssemblyScript isPrime'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = startNumber; i &lt; stopNumber; i++) {        assemblyScriptIsPrime(i);    } }).add(<span class="hljs-string"><span class="hljs-string">'JavaScript isPrime'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = startNumber; i &lt; stopNumber; i++) {        isPrime(i);    } }).on(<span class="hljs-string"><span class="hljs-string">'cycle'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{    <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>(event.target)); }).on(<span class="hljs-string"><span class="hljs-string">'complete'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fastest = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filter(<span class="hljs-string"><span class="hljs-string">'fastest'</span></span>);    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> slowest = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filter(<span class="hljs-string"><span class="hljs-string">'slowest'</span></span>);    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> difference = (fastest.map(<span class="hljs-string"><span class="hljs-string">'hz'</span></span>) - slowest.map(<span class="hljs-string"><span class="hljs-string">'hz'</span></span>)) / slowest.map(<span class="hljs-string"><span class="hljs-string">'hz'</span></span>) * <span class="hljs-number"><span class="hljs-number">100</span></span>;    <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${fastest.map(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'name'</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string"> is ~</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${difference.toFixed(</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">% faster.`</span></span>); }).run();</code> </pre> <br>  Esto es lo que logr√© obtener despu√©s de ejecutar el comando de <code>node benchmark</code> en mi computadora: <br><br><pre> <code class="javascript hljs">AssemblyScript isPrime x <span class="hljs-number"><span class="hljs-number">74.00</span></span> ops/sec ¬±<span class="hljs-number"><span class="hljs-number">0.43</span></span>% (<span class="hljs-number"><span class="hljs-number">76</span></span> runs sampled) JavaScript isPrime x <span class="hljs-number"><span class="hljs-number">61.56</span></span> ops/sec ¬±<span class="hljs-number"><span class="hljs-number">0.30</span></span>% (<span class="hljs-number"><span class="hljs-number">64</span></span> runs sampled) AssemblyScript isPrime is ~<span class="hljs-number"><span class="hljs-number">20.2</span></span>% faster.</code> </pre> <br>  Como puede ver, la implementaci√≥n de AssemblyScript del algoritmo fue un 20% m√°s r√°pida que la implementaci√≥n de JS.  Sin embargo, tenga en cuenta que esta prueba es un <a href="https://stackoverflow.com/a/2842707/1481479">microbenchmark</a> .  No conf√≠e demasiado en sus resultados. <br><br>  Con el fin de encontrar resultados m√°s confiables de la investigaci√≥n de rendimiento de los proyectos AssemblyScript, recomiendo echar un vistazo a <a href="https://wasmboy.app/benchmark/">este</a> y <a href="https://jtiscione.github.io/webassembly-wave/index.html">estos</a> puntos de referencia. <br><br><h2>  <font color="#3AC1EF">Uso de un m√≥dulo Wasm en una p√°gina web</font> </h2><br>  Usemos nuestro m√≥dulo Wasm en una p√°gina web.  Comenzamos creando un archivo <code>index.html</code> con los siguientes contenidos: <br><br><pre> <code class="javascript hljs">&lt;!DOCTYPE html&gt; &lt;html&gt;    &lt;head&gt;        &lt;meta charset="utf-8" /&gt;        &lt;title&gt;AssemblyScript isPrime demo&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;form id="prime-checker"&gt;            &lt;label for="number"&gt;Enter a number to check if it is prime:&lt;/label&gt;            &lt;input name="number" type="number" /&gt;            &lt;button type="submit"&gt;Submit&lt;/button&gt;        &lt;/form&gt;        &lt;p id="result"&gt;&lt;/p&gt;        &lt;script src="demo.js"&gt;&lt;/script&gt;    &lt;/body&gt; &lt;/html&gt;</code> </pre> <br>  Ahora cree el archivo <code>demo.js</code> cuyo c√≥digo se muestra a continuaci√≥n.  Hay <a href="https://developers.google.com/web/updates/2018/04/loading-wasm">muchas formas de</a> cargar m√≥dulos WebAssembly.  Lo m√°s eficiente es compilarlos e inicializarlos en modo de transmisi√≥n mediante la funci√≥n <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly/instantiateStreaming">WebAssembly.instantiateStreaming</a> .  Tenga en cuenta que tendremos que redefinir la funci√≥n de <a href="https://docs.assemblyscript.org/details/debugging">cancelaci√≥n</a> , que se llama si alguna <a href="https://docs.assemblyscript.org/basics/environment">instrucci√≥n</a> no se ejecuta. <br><br><pre> <code class="javascript hljs">(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; {    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> importObject = {        <span class="hljs-attr"><span class="hljs-attr">env</span></span>: {            abort(_msg, _file, line, column) {                <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(<span class="hljs-string"><span class="hljs-string">"abort called at index.ts:"</span></span> + line + <span class="hljs-string"><span class="hljs-string">":"</span></span> + column);            }        }    };    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> WebAssembly.instantiateStreaming(        fetch(<span class="hljs-string"><span class="hljs-string">"build/optimized.wasm"</span></span>),        importObject    );    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isPrime = <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.instance.exports.isPrime;    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"#result"</span></span>);    <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"#prime-checker"</span></span>).addEventListener(<span class="hljs-string"><span class="hljs-string">"submit"</span></span>, event =&gt; {        event.preventDefault();        result.innerText = <span class="hljs-string"><span class="hljs-string">""</span></span>;        <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> number = event.target.elements.number.value;        result.innerText = <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${number}</span></span></span><span class="hljs-string"> is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${isPrime(number) ? </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">''</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> : </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'not '</span></span></span></span><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class="hljs-string">prime.`</span></span>;    }); })();</code> </pre> <br>  A continuaci√≥n, instale el paquete del <a href="https://github.com/nbluis/static-server">servidor est√°tico</a> .  Necesitamos un servidor debido al hecho de que para usar la funci√≥n <code>WebAssembly.instantiateStreaming</code> , el m√≥dulo debe ser reparado usando el tipo MIME de <code>application/wasm</code> . <br><br><pre> <code class="javascript hljs">npm install --save-dev <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>-server</code> </pre> <br>  Agregue el script apropiado a <code>package.json</code> : <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: {    <span class="hljs-string"><span class="hljs-string">"serve-demo"</span></span>: <span class="hljs-string"><span class="hljs-string">"static-server"</span></span>  } }</code> </pre> <br>  Ahora <code>npm run serve-demo</code> y abra la URL del host local en el navegador.  Si ingresa un cierto n√∫mero en el formulario, puede averiguar si es simple o no.  Ahora, al desarrollar AssemblyScript, hemos recorrido un largo camino desde la escritura del c√≥digo hasta su uso en Node.js y en una p√°gina web. <br><br><h2>  <font color="#3AC1EF">Resumen</font> </h2><br>  WebAssembly, y por lo tanto AssemblyScript, no puede acelerar m√°gicamente ning√∫n sitio.  Pero Wasm nunca tuvo la tarea de acelerar absolutamente todo.  Esta tecnolog√≠a es notable porque abre el camino a la web para nuevos tipos de aplicaciones. <br><br>  Algo similar se puede decir sobre AssemblyScript.  Esta tecnolog√≠a simplifica el acceso a WebAssembly para una gran cantidad de desarrolladores.  Al crear c√≥digo en un lenguaje cercano a JavaScript, permite usar las capacidades de WebAssembly para resolver problemas computacionales complejos. <br><br>  <b>Estimados lectores!</b>  ¬øC√≥mo eval√∫a las perspectivas de utilizar AssemblyScript en sus proyectos? <br><br><div style="text-align:center;"> <a href="https://ruvds.com/vps_start/"><img src="https://habrastorage.org/webt/-o/2e/tu/-o2etuqogwhmdnmysb9_vivc9v4.png"></a> </div><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/477272/">https://habr.com/ru/post/477272/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../477256/index.html">El primer lanzamiento completo de OneWeb en el veh√≠culo de lanzamiento Soyuz se pospone el pr√≥ximo a√±o, as√≠ como el lanzamiento del veh√≠culo de lanzamiento Angara</a></li>
<li><a href="../477262/index.html">Androides de la empresa Promobot. Vista lateral</a></li>
<li><a href="../477264/index.html">La excavadora se convirti√≥ en un robot aut√≥nomo capaz de cavar trincheras de forma independiente</a></li>
<li><a href="../477266/index.html">El resumen de materiales frescos del mundo del front-end para la √∫ltima semana No. 390 (18-24 de noviembre de 2019)</a></li>
<li><a href="../477268/index.html">Optimizaci√≥n de soluciones de b√∫squeda en github</a></li>
<li><a href="../477274/index.html">¬øC√≥mo deshacerse del c√≥digo CSS no utilizado? Parte 1</a></li>
<li><a href="../477276/index.html">¬øC√≥mo deshacerse del c√≥digo CSS no utilizado? Parte 2</a></li>
<li><a href="../477278/index.html">Pruebas frontend</a></li>
<li><a href="../477282/index.html">Perfilar el c√≥digo del proyecto Go y resolver problemas de asignaci√≥n de memoria</a></li>
<li><a href="../477284/index.html">¬øPor qu√© se requiere JavaScript en modo estricto?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>