<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîº üëé üë©üèæ‚Äçüíº Analyse des performances des serveurs WSGI: deuxi√®me partie üíáüèΩ üíô üåà</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article est une traduction de l'article de Kevin Goldberg ¬´Une analyse des performances des serveurs Python WSGI: partie 2¬ª dzone.com/articles/a-p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Analyse des performances des serveurs WSGI: deuxi√®me partie</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427217/">  <i>Cet article est une traduction de l'article de Kevin Goldberg ¬´Une analyse des performances des serveurs Python WSGI: partie 2¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dzone.com/articles/a-performance-analysis-of-python-wsgi-servers-part</a> avec quelques ajouts du traducteur.</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eee/5ee/9d4/eee5ee9d43f8a092b0c299c5e12bd661.jpg" alt="image"><br><br><h2>  Pr√©sentation </h2><br>  Dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">premi√®re partie de</a> cette s√©rie, vous avez rencontr√© <b>WSGI</b> et les six serveurs les plus populaires selon l'auteur de <b>WSGI</b> .  Dans cette partie, vous verrez le r√©sultat de l'analyse des performances de ces serveurs.  √Ä cet effet, un bac √† sable de test sp√©cial a √©t√© cr√©√©. <br><a name="habracut"></a><br><h2>  Concurrents </h2><br>  En raison de contraintes de temps, la recherche a √©t√© limit√©e √† six serveurs WSGI.  Toutes les instructions de d√©marrage de ce projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sont h√©berg√©es sur GitHub</a> .  Peut-√™tre qu'avec le temps, le projet s'√©largira et des analyses de performances pour d'autres serveurs WSGI seront pr√©sent√©es.  Mais pour l'instant, nous parlerons de six serveurs: <br><br><ol><li>  <b>Bjoern se</b> d√©crit comme un ¬´serveur WSGI ultra-rapide¬ª et se vante d'√™tre ¬´le serveur WSGI le plus rapide, le plus petit et le plus l√©ger¬ª.  Nous avons cr√©√© une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">petite application</a> qui utilise la plupart des param√®tres de biblioth√®que par d√©faut. </li><li>  <b>CherryPy</b> est un framework et un serveur WSGI extr√™mement populaires et stables.  Ce <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">petit script a √©t√©</a> utilis√© pour servir notre exemple d'application via <b>CherryPy</b> . </li><li>  <b>Gunicorn a</b> √©t√© inspir√© par le serveur Ruby's <b>Unicorn</b> (d'o√π son nom).  Il affirme modestement qu'il est "simplement impl√©ment√©, facile √† utiliser et assez rapide".  Contrairement √† <b>Bjoern</b> et <b>CherryPy</b> , <b>Gunicorn</b> est un serveur autonome.  Nous l'avons cr√©√© √† l'aide de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cette commande</a> .  Le param√®tre "WORKER_COUNT" a √©t√© d√©fini sur deux fois le nombre de c≈ìurs de processeur disponibles, plus un.  Cela a √©t√© fait sur la base des recommandations de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation Gunicorn</a> . </li><li>  <b>Meinheld</b> est un serveur Web hautes performances compatible WSGI qui pr√©tend √™tre l√©ger.  Sur la base de l'exemple montr√© sur le site du serveur, nous avons cr√©√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notre application</a> . </li><li>  <b>mod_wsgi a √©t√©</b> cr√©√© par le m√™me cr√©ateur que <b>mod_python</b> .  Comme <b>mod_python</b> , il n'est disponible que pour Apache.  Cependant, il inclut un outil appel√© <b>"mod_wsgi express"</b> qui cr√©e la plus petite instance Apache possible.  Nous avons configur√© et utilis√© <b>mod_wsgi express</b> avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cette commande</a> .  Pour correspondre √† <b>Gunicorn</b> , nous avons r√©gl√© <b>mod_wsgi</b> pour cr√©er deux fois plus de travailleurs que de c≈ìurs de processeur. </li><li>  <b>uWSGI</b> est un serveur d'applications complet.  En r√®gle g√©n√©rale, <b>uWSGI est</b> associ√© √† un serveur proxy (par exemple: Nginx).  Cependant, afin de mieux √©valuer les performances de chaque serveur, nous avons essay√© de n'utiliser que des serveurs nus et avons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cr√©√© deux travailleurs</a> pour chaque c≈ìur de processeur disponible. </li></ol><br><h2>  Benchmark </h2><br>  Pour rendre le test aussi objectif que possible, un conteneur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Docker a</a> √©t√© cr√©√© pour isoler le serveur test√© du reste du syst√®me.  En outre, l'utilisation du conteneur Docker a garanti que chaque lancement recommence √† z√©ro. <br><br><h3>  Serveur: </h3><br><ul><li>  Isol√© dans un conteneur docker. </li><li>  2 c≈ìurs de processeur allou√©s. </li><li>  La RAM du conteneur √©tait limit√©e √† 512 Mo. </li></ul><br><h3>  Test: </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wrk</a> , un outil de benchmarking HTTP moderne, a effectu√© des tests. </li><li>  Les serveurs ont √©t√© test√©s dans un ordre al√©atoire avec une augmentation du nombre de connexions simultan√©es de l'ordre de 100 √† 10 000. </li><li>  <b>wrk</b> √©tait limit√© √† deux c≈ìurs de processeur non utilis√©s par Docker. </li><li>  Chaque test a dur√© 30 secondes et a √©t√© r√©p√©t√© 4 fois. </li></ul><br><h3>  M√©trique: </h3><br><ul><li>  <b>Wrk</b> a fourni le nombre moyen de demandes persistantes, d'erreurs et de retards. </li><li>  Int√©gr√©e √† Docker, la surveillance a montr√© les niveaux d'utilisation du processeur et de la RAM. </li><li>  Les valeurs les plus √©lev√©es et les plus basses ont √©t√© rejet√©es et les valeurs restantes ont √©t√© moyenn√©es. </li><li>  Pour les curieux, nous avons envoy√© le script complet √† <a href="">GitHub</a> . </li></ul><br><h2>  R√©sultats </h2><br>  Tous les indicateurs de performance initiaux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ont √©t√© inclus dans le r√©f√©rentiel du projet</a> , et un <a href="">fichier CSV</a> r√©sum√© <a href="">a</a> √©galement <a href="">√©t√©</a> fourni.  De plus, pour la visualisation, des graphiques ont √©t√© cr√©√©s dans l'environnement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Google-doc</a> . <br><br><h3>  RPS par rapport au nombre de connexions simultan√©es </h3><br>  Ce graphique montre le nombre moyen de demandes simultan√©es;  Plus le nombre est √©lev√©, mieux c'est. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e09/5b5/cc4/e095b5cc4e7e7455183ddd0a50d64250.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/6a5/666/b22/6a5666b22ae59edff617647a06bfa7b4.png" alt="image"><br><br><ul><li>  Bjoern: Un gagnant clair. </li><li>  CherryPy: Bien qu'il soit √©crit en pur Python, il √©tait le meilleur interpr√®te. </li><li>  Meinheld: Excellentes performances compte tenu des ressources limit√©es des conteneurs. </li><li>  mod_wsgi: Pas le plus rapide, mais les performances √©taient coh√©rentes et ad√©quates. </li><li>  Gunicorn: Bonnes performances √† faibles charges, mais il y a un combat avec un grand nombre de connexions. </li><li>  uWSGI: Frustr√© avec de mauvais r√©sultats. </li></ul><br>  <b>VAINQUEUR: Bjoern</b> <br><br><h4>  Bjoern </h4><br>  Par le nombre de demandes constantes, <b>Bjoern</b> est clairement le gagnant.  Cependant, √©tant donn√© que les chiffres sont beaucoup plus √©lev√©s que ceux des concurrents, nous sommes un peu sceptiques.  Nous ne sommes pas s√ªrs que <b>Bjoern soit</b> vraiment incroyablement rapide.  Au d√©but, nous avons test√© les serveurs par ordre alphab√©tique et nous pensions que <b>Bjoern</b> avait un avantage injuste.  Cependant, m√™me apr√®s le d√©marrage des serveurs dans un ordre de serveur al√©atoire et un nouveau test, le r√©sultat reste le m√™me. <br><br><h4>  uWSGI </h4><br>  Nous avons √©t√© d√©√ßus par les faibles r√©sultats de l' <b>uWSGI</b> .  Nous nous attendions √† ce qu'il soit en t√™te.  Lors des tests, nous avons remarqu√© que les journaux <b>uWSGI</b> s'imprimaient √† l'√©cran, et nous avons initialement expliqu√© le manque de performances avec le travail suppl√©mentaire effectu√© par le serveur.  Cependant, m√™me apr√®s que l' <b>option</b> ¬´ <b>--disable-logging</b> ¬ª a √©t√© ajout√©e, <b>uWSGI</b> est toujours le serveur le plus lent. <br><br>  Comme mentionn√© dans le manuel <b>uWSGI</b> , il s'interface g√©n√©ralement avec un serveur proxy tel que Nginx.  Cependant, nous ne sommes pas s√ªrs que cela puisse expliquer une si grande diff√©rence. <br><br><h3>  Retard </h3><br>  Le d√©lai est le temps √©coul√© entre la demande et sa r√©ponse.  Les nombres inf√©rieurs sont meilleurs. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e03/5c2/6b0/e035c26b0593b256add7d8ce564913ae.png" alt="image"><br><br><ul><li>  CherryPy: Bien g√©r√© la charge. </li><li>  Bjoern: Latence g√©n√©ralement faible, mais fonctionne mieux avec moins de connexions simultan√©es. </li><li>  Gunicorn: bon et coh√©rent. </li><li>  mod_wsgi: performances moyennes, m√™me avec un grand nombre de connexions simultan√©es. </li><li>  Meinheld: Performance globale acceptable. </li><li>  uWSGI: uWSGI est √† nouveau √† la derni√®re place. </li></ul><br>  <b>GAGNANT: CherryPy</b> <br><br><h3>  Utilisation de la RAM </h3><br>  Cette m√©trique montre les besoins en m√©moire et la ¬´l√©g√®ret√©¬ª de chaque serveur.  Les nombres inf√©rieurs sont meilleurs. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a38/138/59b/a3813859b6d73db89c186759941add94.png" alt="image"><br><br><ul><li>  Bjoern: Extr√™mement l√©ger.  Il utilise seulement 9 Mo de RAM pour traiter 10 000 requ√™tes simultan√©es. </li><li>  Meinheld: Identique √† <b>Bjoern</b> . </li><li>  Gunicorn: adapte habilement les charges √©lev√©es avec une consommation de m√©moire √† peine perceptible. </li><li>  CherryPy: Initialement, il avait besoin d'une petite quantit√© de RAM, mais son utilisation a augment√© rapidement avec l'augmentation de la charge. </li><li>  mod_wsgi: Aux niveaux inf√©rieurs, c'√©tait l'un des plus intenses en m√©moire, mais il est rest√© assez coh√©rent. </li><li>  uWSGI: √âvidemment, la version que nous testons a des probl√®mes avec la quantit√© de m√©moire consomm√©e. </li></ul><br>  <b>GAGNANTS: Bjoern et Meinheld</b> <br><br><h3>  Nombre d'erreurs </h3><br>  Une erreur se produit lorsque le serveur se bloque, est interrompu ou que la demande expire.  Le plus bas sera le mieux. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/282/e05/371/282e0537118fd5d98f4284ed084bd427.png" alt="image"><br><br>  Pour chaque serveur, nous avons calcul√© le ratio du ratio total du nombre de requ√™tes sur le nombre d'erreurs: <br><br><ul><li>  CherryPy: taux d'erreur autour de 0, m√™me avec un nombre √©lev√© de connexions. </li><li>  Bjoern: Des erreurs se sont produites, mais cela a √©t√© compens√© par le nombre de demandes trait√©es. </li><li>  mod_wsgi: Fonctionne bien avec un taux d'erreur acceptable de 6%. </li><li>  Gunicorn: Fonctionne avec un taux d'erreur de 9%. </li><li>  uWSGI: Compte tenu du faible nombre de demandes trait√©es, il s'est retrouv√© avec un taux d'erreur de 34%. </li><li>  Meinheld: est tomb√© √† des charges plus √©lev√©es, provoquant plus de 10 000 erreurs lors du test le plus exigeant. </li></ul><br>  <b>GAGNANT: CherryPy</b> <br><br><h3>  Utilisation du processeur </h3><br>  Une utilisation √©lev√©e du processeur n'est ni bonne ni mauvaise si le serveur fonctionne bien.  Cependant, cela fournit des informations int√©ressantes sur le serveur.  √âtant donn√© que deux c≈ìurs de processeur ont √©t√© utilis√©s, l'utilisation maximale possible est de 200%. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/73c/cf7/87f/73ccf787f03745d453ceaa5f4310a921.png" alt="image"><br><br><ul><li>  Bjoern: un serveur √† thread unique, comme en t√©moigne son utilisation coh√©rente de 100% CPU. </li><li>  CherryPy: multithread, mais bloqu√© √† 150%.  Cela peut √™tre d√ª √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Python GIL</a> . </li><li>  Gunicorn: utilise plusieurs processus avec une utilisation compl√®te des ressources CPU √† des niveaux inf√©rieurs. </li><li>  Meinheld: un serveur √† thread unique utilisant des ressources CPU comme Bjoern. </li><li>  mod_wsgi: un serveur multi-thread utilisant tous les c≈ìurs de CPU √† travers toutes les mesures </li><li>  uWSGI: tr√®s faible utilisation du CPU.  La consommation du processeur ne d√©passe pas 50%.  Ceci est une preuve que uWSGI n'est pas configur√© correctement. </li></ul><br>  <b>GAGNANT: Non, car il s'agit plus d'une observation de comportement que d'une comparaison de performances.</b> <br><br><h2>  Conclusion </h2><br>  Pour r√©sumer!  Voici quelques id√©es g√©n√©rales que vous pouvez tirer des r√©sultats de chaque serveur: <br><br><ul><li>  Bjoern: se justifie comme un ¬´serveur WSGI ultra-rapide et ultra-l√©ger¬ª. </li><li>  CherryPy: hautes performances, faible consommation de m√©moire et faibles taux d'erreur.  Pas mal pour du pur Python. </li><li>  Gunicorn: Un bon serveur pour des charges moyennes. </li><li>  Meinheld: Fonctionne bien et n√©cessite un minimum de ressources.  Cependant, aux prises avec des charges plus √©lev√©es. </li><li>  mod_wsgi: S'int√®gre √† Apache et fonctionne tr√®s bien. </li><li>  uWSGI: Tr√®s d√©√ßu.  Soit nous avons configur√© <b>uWSGI de</b> mani√®re incorrecte, soit la version que nous avons install√©e contient des erreurs de base. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr427217/">https://habr.com/ru/post/fr427217/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr427205/index.html">Habrakvest en l'honneur du 20e anniversaire du groupe Mail.Ru: gagnants et r√©ponses</a></li>
<li><a href="../fr427207/index.html">Les employ√©s de Rockstar se l√®vent pour l'entreprise apr√®s avoir critiqu√© les semaines de travail de 100 heures</a></li>
<li><a href="../fr427209/index.html">GeoPuzzle - faites le monde morceau par morceau</a></li>
<li><a href="../fr427211/index.html">Electron est un flash pour ordinateur de bureau</a></li>
<li><a href="../fr427215/index.html">Les microservices doivent grandir, pas commencer par eux</a></li>
<li><a href="../fr427219/index.html">Messagerie diff√©r√©e non bloquante inutile dans MPI: analyse l√©g√®re et tutoriel pour ceux qui sont un peu "dans le sujet"</a></li>
<li><a href="../fr427221/index.html">Ce que j'ai r√©alis√© sur le chemin de mon r√™ve d'intelligence artificielle</a></li>
<li><a href="../fr427223/index.html">Quelle est la responsabilit√© du d√©veloppeur principal</a></li>
<li><a href="../fr427225/index.html">Sortie d'Oracle Database 18c XE</a></li>
<li><a href="../fr427227/index.html">Comment nous avons cr√©√© un jeu de soci√©t√© avec t√©l√©commande - Partie 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>