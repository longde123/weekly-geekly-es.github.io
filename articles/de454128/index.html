<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äçüè´ üîè üõ∂ So erstellen Sie zwei Anwendungen aus einer. Tinkoff Junior Erfahrung üò¥ ü§§ ü•Ö</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo, mein Name ist Andrey und ich arbeite an den Anwendungen Tinkoff und Tinkoff Junior f√ºr die Android-Plattform. Ich m√∂chte dar√ºber sprechen, wie ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>So erstellen Sie zwei Anwendungen aus einer. Tinkoff Junior Erfahrung</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/454128/"><p>  Hallo, mein Name ist Andrey und ich arbeite an den Anwendungen Tinkoff und Tinkoff Junior f√ºr die Android-Plattform.  Ich m√∂chte dar√ºber sprechen, wie wir zwei √§hnliche Anwendungen aus einer Codebasis sammeln. </p><br><p><code>  ‚Äî    ,   ÃÜ  14 .       ,       (,  ),  , ,  (, ).</code> </p> <br><p><img src="https://habrastorage.org/webt/-1/po/-k/-1po-kymjlvzoyqyoe3y99fw08a.png" width="200">  . <img src="https://habrastorage.org/webt/ip/yp/ko/ipypko5-iq8wsxowwzs9v7r7n6k.png" width="200"><img src="https://habrastorage.org/webt/pa/7y/5v/pa7y5volewp8xuxjv9znokv1fqi.png" width="200"></p><br><p>  Zu Beginn des Projekts haben wir verschiedene Optionen f√ºr seine Umsetzung gepr√ºft und eine Reihe von Entscheidungen getroffen.  Es wurde sofort klar, dass die beiden Anwendungen (Tinkoff und Tinkoff Junior) einen erheblichen Teil des gemeinsamen Codes haben w√ºrden.  Wir wollten uns nicht von der alten Anwendung trennen und dann die Fehlerkorrekturen und die neuen allgemeinen Funktionen kopieren.  Um mit zwei Anwendungen gleichzeitig arbeiten zu k√∂nnen, haben wir drei Optionen in Betracht gezogen: Gradle Flavours, Git-Submodule, Gradle-Module. </p><a name="habracut"></a><br><h3 id="gradle-flavors">  Gradle Aromen </h3><br><p>  Viele unserer Entwickler haben bereits versucht, Aromen zu verwenden, und wir k√∂nnten mehrdimensionale Aromen f√ºr die Verwendung mit vorhandenen Aromen verwenden. <br>  Aromen haben jedoch einen fatalen Fehler.  Android Studio betrachtet den Code nur als den Code der aktiven Variante - das hei√üt, was sich im Hauptordner und im Geschmacksordner befindet.  Der Rest des Codes wird zusammen mit Kommentaren als Text betrachtet.  Dies f√ºhrt zu Einschr√§nkungen f√ºr einige Studio-Tools: Suche nach Code-Verwendung, Refactoring und andere. </p><br><h3 id="git-submodules">  Git-Submodule </h3><br><p>  Eine weitere M√∂glichkeit zur Implementierung unserer Idee besteht darin, die Submodule des Git zu verwenden: √úbertragen Sie den gemeinsamen Code in ein separates Repository und verbinden Sie ihn als Submodul mit dem Code f√ºr eine bestimmte Anwendung mit zwei Repositorys. </p><br><p>  Dieser Ansatz erh√∂ht die Komplexit√§t der Arbeit mit dem Quellcode des Projekts.  Au√üerdem m√ºssten Entwickler weiterhin mit allen drei Repositorys arbeiten, um √Ñnderungen vorzunehmen, wenn die API des gemeinsamen Moduls ge√§ndert wird. </p><br><h3 id="mnogomodulnaya-arhitektura">  Multi-Modul-Architektur </h3><br><p>  Die letzte Option ist der Wechsel zur Architektur mit mehreren Modulen.  Dieser Ansatz ist frei von den Nachteilen, die die beiden anderen haben.  Der √úbergang zu einer Architektur mit mehreren Modulen erfordert jedoch zeitaufw√§ndiges Refactoring. </p><br><p>  Zu Beginn unserer Arbeit an Tinkoff Junior hatten wir zwei Module: ein kleines API-Modul, das die Arbeit mit dem Server beschreibt, und ein gro√ües monolithisches Anwendungsmodul, in dem der Gro√üteil des Projektcodes konzentriert war. </p><br><p><img src="https://habrastorage.org/webt/jn/wu/at/jnwuat-2xwkuarvovw0cy-hyte0.png" alt="Zeichnen" height="300" width="300"><img src="https://habrastorage.org/webt/iv/ci/0s/ivci0s379lazzwffmjbmpbpcw4a.png" alt="Zeichnen" height="400" width="400"><br>  Aus diesem Grund wollten wir zwei Anwendungsmodule erhalten: <em>Adult</em> und <em>Junior</em> sowie einige gemeinsame Kernmodule.  Wir haben zwei Optionen identifiziert: </p><br><ul><li>  Gemeinsamen Code in das gemeinsame Modul einf√ºgen.  Dieser Ansatz ist ‚Äûkorrekter‚Äú, dauert jedoch l√§nger.  Wir haben das Volumen der Wiederverwendung von Code auf ungef√§hr 80% gesch√§tzt. <br><img src="https://habrastorage.org/webt/03/xq/da/03xqdaunybaqagt_eoawvjyfpea.png" alt="Zeichnen" height="400" width="400"></li><li>  Konvertieren Sie das Anwendungsmodul in eine Bibliothek und verbinden Sie diese Bibliothek mit den Thin <em>Adult-</em> und <em>Junior-</em> Modulen.  Diese Option ist schneller, bringt jedoch Code zu Tinkoff Junior, der niemals ausgef√ºhrt wird. <br><img src="https://habrastorage.org/webt/_1/jw/pw/_1jwpw2tzdjv6wf1o4jm6tbqmeg.png" alt="Zeichnen" height="300" width="300"></li></ul><br><p>  Wir hatten Zeit in Reserve und beschlossen, die Entwicklung gem√§√ü der ersten Option (dem <em>gemeinsamen</em> Modul) mit der Bedingung zu beginnen, auf die schnelle Option umzuschalten, wenn wir keine Zeit mehr f√ºr das Refactoring haben. <br>  Am Ende geschah dies: Wir haben einen Teil des Projekts in das <em>gemeinsame</em> Modul √ºbertragen und dann das verbleibende <em>Anwendungsmodul</em> in eine Bibliothek umgewandelt.  Als Ergebnis haben wir jetzt die folgende Projektstruktur: </p><br><img src="https://habrastorage.org/webt/eb/_g/h_/eb_gh_twasummele8nn9vwqe4a8.png" alt="Zeichnen" height="400"><br><p>  Wir haben Module mit Funktionen, mit denen wir zwischen einem "Erwachsenen" -, einem allgemeinen oder einem "Kinder" -Code unterscheiden k√∂nnen.  Das <em>Anwendungsmodul</em> ist jedoch immer noch gro√ü genug, und jetzt ist etwa die H√§lfte des Projekts dort gespeichert. </p><br><h3 id="prevraschaem-prilozhenie-v-biblioteku">  Die Anwendung in eine Bibliothek verwandeln </h3><br><p>  Die Dokumentation enth√§lt einfache <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anweisungen</a> zum Verwandeln einer Anwendung in eine Bibliothek.  Es enth√§lt vier einfache Punkte, und es scheint, dass keine Schwierigkeiten bestehen sollten: </p><br><ol><li>  √ñffnen <code>build.gradle</code> Datei <code>build.gradle</code> Moduls </li><li>  Entfernen Sie die <code>applicationId</code> aus der Modulkonfiguration </li><li>  Ersetzen Sie am Anfang der Datei das <code>apply plugin: 'com.android.application'</code> durch <code>apply plugin: 'com.android.application'</code> <code>apply plugin: 'com.android.library'</code> </li><li>  Speichern Sie die √Ñnderungen und synchronisieren Sie das Projekt in Android Studio ( <strong>Datei&gt; Projekt mit Gradle-Dateien</strong> synchronisieren). </li></ol><br><p>  Die Konvertierung dauerte jedoch mehrere Tage und der resultierende Unterschied stellte sich wie folgt heraus: </p><br><ul><li>  183 Dateien ge√§ndert </li><li>  1601 Einf√ºgungen (+) </li><li>  1920 Streichungen (-) </li></ul><br><h5 id="chto-zhe-poshlo-ne-tak">  Was ist schief gelaufen? </h5><br><p>  Erstens sind Ressourcenkennungen in Bibliotheken <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">keine Konstanten</a> .  In Bibliotheken wie in Anwendungen wird eine <em>R.java-</em> Datei mit einer Liste von Ressourcenkennungen <em>generiert</em> .  In Bibliotheken sind die Bezeichnerwerte nicht konstant.  In Java k√∂nnen Sie nicht konstante Werte nicht aktivieren, und alle Schalter m√ºssen durch if-else ersetzt werden. </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Application int id = view.getId(); switch(id) { case R.id.button1: action1(); break; case R.id.button2: action2(); break; } // Library int id = view.getId(); if (id == R.id.button1) { action1(); } else if (id == R.id.button2) { action2(); }</span></span></code> </pre> <br><p>  Als n√§chstes stie√üen wir auf eine Paketkollision. <br>  Angenommen, Sie haben eine Bibliothek mit package = <em>com.example</em> , und die Anwendung mit package = <em>com.example.app</em> h√§ngt von dieser Bibliothek ab.  Dann wird die Klasse <em>com.example.R</em> in der Bibliothek bzw. <em>com.example.app.R</em> in der Anwendung generiert.  Erstellen <em>wir nun die Aktivit√§t com.example.MainActivity</em> in der Anwendung, in der wir versuchen, auf die R-Klasse zuzugreifen.  Ohne expliziten Import wird die R-Klasse der Bibliothek verwendet, in der nicht die Anwendungsressourcen, sondern nur die Bibliotheksressourcen angegeben sind.  Android Studio hebt den Fehler jedoch nicht hervor, und wenn Sie versuchen, von Code zu einer Ressource zu wechseln, ist alles in Ordnung. </p><br><h3 id="dagger">  Dolch </h3><br><p>  Wir verwenden Dolch als Rahmen f√ºr die Abh√§ngigkeitsinjektion. <br>  In jedem Modul, das Aktivit√§ten, Fragmente und Dienste enth√§lt, haben wir die √ºblichen Schnittstellen, die die <em>Inject-</em> Methoden f√ºr diese Entit√§ten beschreiben.  In Anwendungsmodulen ( <em>Adult</em> und <em>Junior</em> ) erben die <em>Dolchkomponentenschnittstellen</em> von diesen Schnittstellen.  In den Modulen bringen wir die Komponenten zu den f√ºr dieses Modul notwendigen Schnittstellen. </p><br><h4 id="multibindingi">  Multibindings </h4><br><p>  Die Entwicklung unseres Projekts wird durch die Verwendung von Multibindings erheblich vereinfacht. <br>  In einem der g√§ngigen Module definieren wir eine Schnittstelle.  In jedem Anwendungsmodul ( <em>Erwachsener</em> , <em>Junior</em> ) beschreiben wir die Implementierung dieser Schnittstelle.  Mithilfe der Annotation <code>@Binds</code> wir dem Dolch mit, dass jedes Mal anstelle einer Schnittstelle die spezifische Implementierung f√ºr eine Kinder- oder Erwachsenenanwendung eingef√ºgt werden muss.  Wir sammeln auch h√§ufig eine Sammlung von Schnittstellenimplementierungen (Set oder Map), und solche Implementierungen werden in verschiedenen Anwendungsmodulen beschrieben. </p><br><h4 id="fleyvory">  Aromen </h4><br><p>  F√ºr verschiedene Zwecke sammeln wir verschiedene Anwendungsoptionen.  Die im Basismodul beschriebenen Geschmacksrichtungen m√ºssen auch in den abh√§ngigen Modulen beschrieben werden.  Damit Android Studio ordnungsgem√§√ü funktioniert, m√ºssen in allen Projektmodulen kompatible Baugruppenoptionen ausgew√§hlt werden. </p><br><h3 id="vyvody">  Schlussfolgerungen </h3><br><p>  In kurzer Zeit haben wir eine neue Anwendung implementiert.  Jetzt versenden wir die neue Funktionalit√§t in zwei Anwendungen und schreiben sie einmal. </p><br><p>  Gleichzeitig haben wir einige Zeit mit Refactoring verbracht, gleichzeitig die technische Verschuldung reduziert und auf eine Architektur mit mehreren Modulen umgestellt.  Auf dem Weg stie√üen wir auf Einschr√§nkungen durch das Android SDK und Android Studio, die wir erfolgreich verwaltet haben. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de454128/">https://habr.com/ru/post/de454128/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de454110/index.html">Entwicklung eines Online-Shops zur Erhaltung der Natur von Kamtschatka</a></li>
<li><a href="../de454112/index.html">Duke Nukem Level Design Geschichte (mit Levelord Sketches)</a></li>
<li><a href="../de454114/index.html">Erfahrung mit Starwind VSAN und EMC ScaleIO (VxFlexOS) + Spickzettel f√ºr Mini Enterprise Storage (1 Teil)</a></li>
<li><a href="../de454124/index.html">Das Buch "Lernen, in JavaScript zu programmieren"</a></li>
<li><a href="../de454126/index.html">Vom t√§glichen Absturz bis zur Stabilit√§t: Informatica mit 10 Admin-Augen</a></li>
<li><a href="../de454130/index.html">C-V2X mit Unterst√ºtzung f√ºr 5G NR-Netze: Ein neues Paradigma f√ºr den Datenaustausch zwischen Fahrzeugen</a></li>
<li><a href="../de454132/index.html">Video√ºberwachung auf Orange Pi Zero - billig und √ºberhaupt nicht b√∂se</a></li>
<li><a href="../de454136/index.html">Der sch√∂nste Satz der Mathematik: Eulers Identit√§t</a></li>
<li><a href="../de454138/index.html">10. Juni, Deworkacy - QS Gute Kommunikation</a></li>
<li><a href="../de454140/index.html">Vom Anwalt zum Tester in Yandex. Die Geschichte meines Praktikums</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>