<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔱 🏸 ☂️ Praktek menggunakan perpustakaan lottie di aplikasi seluler bank 🏒 🙌🏼 💉</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! 

 Pada suatu waktu, Pemilik Produk meminta kami untuk berpikir tentang membuat proses yang efektif untuk memasukkan animasi ke dalam apli...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Praktek menggunakan perpustakaan lottie di aplikasi seluler bank</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/homecredit/blog/459852/">  Halo, Habr! <br><br>  Pada suatu waktu, Pemilik Produk meminta kami untuk berpikir tentang membuat proses yang efektif untuk memasukkan animasi ke dalam aplikasi android / ios kami.  Pada saat itu, kami melakukan tugas pra-mengisi aplikasi dengan data pribadi untuk produk pinjaman, dan butuh beberapa waktu bagi server untuk merespons, di mana kami ingin menunjukkan animasi pemuatan yang indah. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0f/zx/te/0fzxtebssjpev57e8wic-slkpu8.png" width="300"></div><a name="habracut"></a><br>  Tugasnya jelas: perancang ingin menggambar dengan indah, memberikan kode sumber untuk keduanya <br>  platform tanpa dopilivaniya di pihaknya, dan agar tidak ketinggalan pada perangkat yang lebih lama (ya, kami masih mendukung Android 4.1). <br><br>  <b>Apa pilihan saya untuk memperkenalkan animasi:</b> <br><br><ol><li>  Pena menggunakan gambar vektor yang dapat digambar.  Hal yang baik adalah rendering berfungsi <br>  di utas terpisah (dimulai dengan api 25), kontra adalah kompleksitas menciptakan animasi seperti itu dan sejumlah kecil manipulasi dengan objek.  Untuk animasi sederhana, ini semua bekerja dengan baik, tetapi sedikit lebih rumit, dan neraka dimulai.  Ya, dan pada platform yang berbeda Anda tidak akan memulai. </li><li>  Gif - beratnya banyak, memiliki ukuran tetap, yang berarti mereka tidak skala secara normal.  Dan Anda tidak akan melakukan manipulasi khusus dengan mereka. </li><li>  Urutan png (tanpa komentar). </li></ol><br>  Menggali selama beberapa waktu ke arah animasi vektor asli android dan gif (ya Tuhan, kami masih mempertimbangkan opsi ini), saya ingat perpustakaan Lottie yang indah, dan menunjukkannya kepada rekan-rekan saya. <br><br>  Setelah beberapa pengujian dengan berbagai perangkat, kami memutuskan bahwa perpustakaan harus diimplementasikan, terutama karena kemampuannya sangat mengesankan.  Perancang itu sangat senang, sekarang dia bisa melakukan hampir semua animasi di Adobe After Effects, dan mengekspor ke file json dengan beberapa klik.  Kami senang juga, tetapi hal pertama yang pertama. <br><br>  Lottie diciptakan dan diimplementasikan oleh Airbnb sebagai tanggapan terhadap permintaan yang meningkat akan animasi lintas platform, sehingga bekerja sama (baik, hampir) di semua platform.  Pengembang sendiri mengklaim bahwa tujuan mereka adalah untuk mewujudkan jumlah fitur After Effects maksimum, dan mereka berhasil dalam hal ini.  Sekarang menanamkan animasi Lottie semudah memasukkan gambar ke ImageView. <br><br>  <b>Kunci 3 kelas:</b> <br><br><ol><li>  LottieAnimationView adalah penerus ImageView, dan cara termudah untuk menggunakan animasi.  Anda dapat menggambarkan animasi dalam xml, atau Anda dapat dalam kode, sebagian besar metode didukung. </li><li>  LottieDrawable - keturunan Drawable, dengan fungsi yang sama dengan kelas sebelumnya, memungkinkan Anda untuk menerapkan animasi ke tampilan apa pun. </li><li>  LottieComposition dan pendampingnya LottieCompositionFactory memungkinkan Anda untuk memuat animasi dari berbagai sumber dan mendaftar ke LottieDrawable dan LottieAnimationView. </li></ol><br><h4>  Memuat sumber daya </h4><br>  Mendukung memuat sumber daya dari: <br><br><ol><li>  res / mentah </li><li>  src / aset </li><li>  String json </li><li>  Setiap url dari jaringan yang mengarah ke file json atau zip (diimplementasikan melalui HttpURLConnection, agar tidak menambahkan dependensi eksternal. Jika Anda memiliki animasi dengan gambar, maka Anda perlu menggunakan zip) </li><li>  InputStream json atau file zip </li></ol><br><h4>  Caching animasi </h4><br>  Yang keren adalah bahwa semua animasi yang diunduh melalui res / raw atau aset disimpan oleh cache LRU, yang memungkinkan kita untuk tidak membuang waktu pengguna memuat ulang dan mem-parsing animasi, seperti dalam kasus animasi kompleks mungkin perlu waktu.  Apa yang lebih keren, jika Anda perlu memuat animasi sebelumnya, dan kemudian dalam fragmen berikutnya menampilkan animasi secara instan, Anda dapat menggunakan kode <br><br><pre><code class="kotlin hljs">LottieCompositionFactory.fromRawRes(context, rawFile)</code> </pre> <br>  Animasi di-cache menggunakan kunci rawFile, dan di mana Anda benar-benar perlu menggunakannya, itu dimulai hampir secara instan. <br><br><h4>  Manajemen kemajuan </h4><br>  Lottie memungkinkan Anda untuk mengatur keadaan animasi saat ini melalui setProgress (...).  Ini bisa berguna jika Anda ingin menganimasikan status unggah file, posisi gulir, berbagai gerakan, dll.  Saya melihat berbagai implementasi di BottomSheets, PullToRefresh, CollapsingToolbarLayout. <br><br>  Inilah cara menggunakan kemajuan dengan AppBarLayout: <br><br><pre> <code class="kotlin hljs">appBarLayout.addOnOffsetChangedListener(AppBarLayout.OnOffsetChangedListener { appBarLayout, verticalOffset -&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> percent = Math.abs(verticalOffset).toFloat()/appBarLayout.totalScrollRange animationView.progress = percent })</code> </pre><br><h4>  Looping </h4><br>  Lottie mendukung perulangan setRepeatMode () atau setRepeatCount () tidak hanya seluruh animasi, tetapi juga setiap fragmen di dalam (0,0 ... 1.0).  Ini diimplementasikan oleh properti setMinFrame, setMaxFrame, setMinAndMaxFrame.  Kami menggunakan ini agar tidak menerapkan 3 animasi untuk status unggah file yang berbeda: idle, progres, selesai.  Ini adalah sepotong kecil kode yang memecahkan ini: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (loadingStatus) { LoadingStatus.IDLE -&gt; { animationView.setMaxProgress(<span class="hljs-number"><span class="hljs-number">0.1f</span></span>) } LoadingStatus.PROGRESS -&gt; { animationView.setMinAndMaxProgress(<span class="hljs-number"><span class="hljs-number">0.2f</span></span>, <span class="hljs-number"><span class="hljs-number">0.9f</span></span>) animationView.repeatCount = LottieDrawable.INFINITE animationView.playAnimation() } LoadingStatus.COMPLETE -&gt; { animationView.setMinAndMaxProgress(<span class="hljs-number"><span class="hljs-number">0.9f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) animationView.repeatCount = <span class="hljs-number"><span class="hljs-number">1</span></span> animationView.playAnimation() }}</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mi/iw/iu/miiwiupaeldyjmhfegtkruqn9jo.gif" width="250"></div><br><h4>  Gambar </h4><br>  Salah satu keuntungan utama Lottie bagi kami adalah perpustakaan mendukung penyisipan gambar langsung ke animasi.  Selain itu, Anda dapat menyisipkan gambar statis dan dinamis yang diunduh dari Internet.  Sekarang saya akan menjelaskan cara kerjanya. <br><br>  Dalam hal gambar statis, semuanya sederhana: perancang membongkar arsip yang berisi json plus gambar itu sendiri. <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"v"</span></span>: <span class="hljs-string"><span class="hljs-string">"5.1.13"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"fr"</span></span>: <span class="hljs-number"><span class="hljs-number">29.9700012207031</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ip"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"op"</span></span>: <span class="hljs-number"><span class="hljs-number">47.0000019143492</span></span>, <span class="hljs-attr"><span class="hljs-attr">"w"</span></span>: <span class="hljs-number"><span class="hljs-number">1034</span></span>, <span class="hljs-attr"><span class="hljs-attr">"h"</span></span>: <span class="hljs-number"><span class="hljs-number">1334</span></span>, <span class="hljs-attr"><span class="hljs-attr">"nm"</span></span>: <span class="hljs-string"><span class="hljs-string">" 1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ddd"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"assets"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"image_0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"w"</span></span>: <span class="hljs-number"><span class="hljs-number">130</span></span>, <span class="hljs-attr"><span class="hljs-attr">"h"</span></span>: <span class="hljs-number"><span class="hljs-number">436</span></span>, <span class="hljs-attr"><span class="hljs-attr">"u"</span></span>: <span class="hljs-string"><span class="hljs-string">"images/"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"p"</span></span>: <span class="hljs-string"><span class="hljs-string">"img_0.png"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"comp_0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"layers"</span></span>: [ ... ]}] }</code> </pre> <br>  Ini img_0.png, ini adalah gambar yang harus Anda masukkan ke src / aset, dan yang akan ada di dalam animasi. <br><br>  Untuk memuat dinamis, metode setImageAssetDelegate digunakan, di mana Anda harus melewati bitmap.  Kami memuat gambar dengan Glide, jadi pada tahap membuka sebuah fragmen dengan animasi dan gambar, semuanya keluar dari cache, jadi semuanya cukup cepat.  Ini kodenya: <br><br><pre> <code class="kotlin hljs">glideLoader.loadAsBitmap(imageUrl).into(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>: CustomTarget&lt;Bitmap&gt;() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResourceReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(resource: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bitmap</span></span></span></span><span class="hljs-function"><span class="hljs-params">, transition: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Transition</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">in</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bitmap</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;?)</span></span></span></span> { viewAnimation.setImageAssetDelegate(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>: ImageAssetDelegate { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchBitmap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(asset: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">LottieImageAsset</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: Bitmap { asset?.let { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> resizeBitmap =Bitmap.createScaledBitmap(resource, it.width, it.height, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resizeBitmap } ?: run { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resource } } }) setAnimation(viewAnimation, animationImage) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onLoadCleared</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(placeholder: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Drawable</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> {} })</code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/eb/i3/ly/ebi3lylquqmqr2yljlo3jllm-ja.gif" width="250"></div><br><h4>  Performa </h4><br>  Tentu saja, lebih baik tidak menggunakan banyak animasi di layar di mana pengguna menghabiskan banyak waktu, karena itu menuntut pada prosesor.  Menurut pengujian kami, beban prosesor pada beberapa animasi mencapai 20%.  Karena itu, kasus ideal dari animasi semacam itu adalah elemen interaktif yang menyala sekali. <br><br>  Jika animasi pada beberapa perangkat melambat, terkadang ini membantu <br><br><pre> <code class="kotlin hljs">viewAnimation.useHardwareAcceleration(<span class="hljs-literal"><span class="hljs-literal">true</span></span>)</code> </pre> <br>  Namun, pengembang merekomendasikan untuk menggunakan metode ini dengan hati-hati, karena ponsel yang berbeda menggunakan akselerasi perangkat keras dengan cara yang berbeda, jadi alih-alih akselerasi, Anda bisa mendapatkan efek sebaliknya. <br><br><h4>  Kesimpulan </h4><br>  Secara umum, penggunaan perpustakaan Lottie sangat menyederhanakan implementasi animasi dalam aplikasi. <br><br>  <b>Keuntungan utama lottie yang kami soroti:</b> <br><br><ol><li>  Ukuran perpustakaan kecil (300 kb) </li><li>  Solusi lintas platform ios / android / web </li><li>  Unduh animasi dari web </li><li>  Manajemen kemajuan dan perulangan di mana saja </li><li>  Sejumlah besar fitur dari efek setelah memungkinkan desainer untuk mewujudkan efek yang diinginkan. </li></ol><br>  <b>Cons:</b> <br><br><ol><li>  Rendering dilakukan di utas utama, dan fps dapat turun secara signifikan dalam aplikasi. </li><li>  Mengurai animasi lottie dapat memakan waktu cukup lama dengan animasi yang kompleks. </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4v/l9/i7/4vl9i7i2nta0osmi8rj3x6oixzm.gif" width="250"></div><br>  Ngomong-ngomong, untuk memeriksa seberapa intensif animasi sumber daya, Anda dapat menggunakan aplikasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Lottie</a> resmi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dari Google Play</a> .  Ada Grafik Render di mana Anda dapat melihat waktu untuk merender bingkai, dan juga melihat bagaimana animasi akan terlihat jika Anda memotongnya menjadi bingkai, atau bagaimana akselerasi perangkat keras dan banyak lagi akan mempengaruhi. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id459852/">https://habr.com/ru/post/id459852/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id459838/index.html">Tulis Kode Lebih Baik Lebih Cepat dengan Roslyn Analyzers</a></li>
<li><a href="../id459840/index.html">XAML Hot Reload untuk Xamarin.Form Dirilis</a></li>
<li><a href="../id459842/index.html">Luxor</a></li>
<li><a href="../id459844/index.html">Penguin di jendela: tentang potensi dan prospek WSL2</a></li>
<li><a href="../id459850/index.html">Teknologi radio amatir: bagaimana saya memesan pemasangan papan sirkuit tercetak di pabrik Cina</a></li>
<li><a href="../id459858/index.html">Menjelajahi Modern Malware Cerberus untuk Android</a></li>
<li><a href="../id459860/index.html">Mengkonfigurasi ClickHouse untuk pengujian integrasi di gitlab-ci</a></li>
<li><a href="../id459862/index.html">Antarmuka Berkeley DB STL</a></li>
<li><a href="../id459866/index.html">Pemecahan masalah dengan pwnable.kr 02 - collision. Tabrakan Hash</a></li>
<li><a href="../id459870/index.html">Contoh arsitektur Model-View-Update dalam F #</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>