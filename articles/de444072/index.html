<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😫 👩‍👩‍👧‍👧 ✌🏼 Android Shopping - Abrechnungsbibliothek abspielen 🏥 👵🏾 👩‍🎤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Und wie kommt es, dass es darüber noch keinen Artikel über Habré gibt? Es spielt keine Rolle, es ist notwendig, es zu korrigieren. 

 Es gibt zwei Mög...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Android Shopping - Abrechnungsbibliothek abspielen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444072/"><img src="https://cdn-images-1.medium.com/max/2600/1*MEl6386c9aV-g7EG3-HrKw.png" alt="Bild"><br><br>  Und wie kommt es, dass es darüber noch keinen Artikel über Habré gibt?  Es spielt keine Rolle, es ist notwendig, es zu korrigieren. <br><br>  Es gibt zwei Möglichkeiten, Ihrer Android-App In-App-Käufe hinzuzufügen - alte und neue.  Bis 2017 nutzten alle die Bibliothek von anjlab, aber seit Juni 2017 hat sich die Situation geändert. Google hat eine eigene Bibliothek für interne Einkäufe und Abonnements veröffentlicht - Play Billing Library.  Letzteres gilt nun als Standard. <br><a name="habracut"></a><br>  Play Billing Library ist sehr einfach. <br><br>  Verbinden Sie die Abhängigkeit. <br><br><pre><code class="java hljs">implementation <span class="hljs-string"><span class="hljs-string">'com.android.billingclient:billing:1.2'</span></span></code> </pre> <br>  Fügen Sie dem Manifest die Berechtigung hinzu. <br><br><pre> <code class="java hljs">&lt;uses-permission android:name=<span class="hljs-string"><span class="hljs-string">"com.android.vending.BILLING"</span></span>/&gt;</code> </pre> <br>  Erstellen Sie eine BillingClient-Instanz und starten Sie die Verbindung. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BillingClient mBillingClient; ... mBillingClient = BillingClient.newBuilder(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).setListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PurchasesUpdatedListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPurchasesUpdated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> responseCode, @Nullable List&lt;Purchase&gt; purchases)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (responseCode == BillingClient.BillingResponse.OK &amp;&amp; purchases != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//       } } }).build(); mBillingClient.startConnection(new BillingClientStateListener() { @Override public void onBillingSetupFinished(@BillingClient.BillingResponse int billingResponseCode) { if (billingResponseCode == BillingClient.BillingResponse.OK) { //         } } @Override public void onBillingServiceDisconnected() { //    -    } });</span></span></code> </pre> <br>  Beim Kauf gelangen wir zur Methode <i>onPurchasesUpdated (). Bei der</i> Methode <i>onBillingSetupFinished ()</i> können Sie Informationen zu Waren und Einkäufen anfordern. <br><br>  Produktinformationen anfordern.  <i>Fügen</i> Sie <i>querySkuDetails ()</i> in <i>onBillingSetupFinished () ein</i> . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Map&lt;String, SkuDetails&gt; mSkuDetailsMap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String mSkuId = <span class="hljs-string"><span class="hljs-string">"sku_id_1"</span></span>; ... <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBillingSetupFinished</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@BillingClient.BillingResponse </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> billingResponseCode)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (billingResponseCode == BillingClient.BillingResponse.OK) { <span class="hljs-comment"><span class="hljs-comment">//         querySkuDetails(); //   } } ... private void querySkuDetails() { SkuDetailsParams.Builder skuDetailsParamsBuilder = SkuDetailsParams.newBuilder(); List&lt;String&gt; skuList = new ArrayList&lt;&gt;(); skuList.add(mSkuId); skuDetailsParamsBuilder.setSkusList(skuList).setType(BillingClient.SkuType.INAPP); mBillingClient.querySkuDetailsAsync(skuDetailsParamsBuilder.build(), new SkuDetailsResponseListener() { @Override public void onSkuDetailsResponse(int responseCode, List&lt;SkuDetails&gt; skuDetailsList) { if (responseCode == 0) { for (SkuDetails skuDetails : skuDetailsList) { mSkuDetailsMap.put(skuDetails.getSku(), skuDetails); } } } }); }</span></span></code> </pre> <br>  Im Code bemerken Sie möglicherweise das Konzept der SKU. Was ist das?  Artikelnummer - von der englischen Lagerhaltungseinheit (Warenartikelkennung). <br><br>  Jetzt <i>haben</i> wir in <i>mSkuDetailsMap</i> alle Informationen zu den Produkten (Name, Beschreibung, Preis) in der Play Console dieser Anwendung registriert (dazu später mehr).  <i>Achten Sie</i> auf diese Zeile <i>skuList.add (mSkuId);</i>  Hier haben wir die Produkt-ID aus der Play Console hinzugefügt. Hier werden alle Produkte aufgelistet, mit denen Sie interagieren möchten.  Wir haben ein Produkt - sku_id_1. <br><br>  Alles ist bereit, die Kaufanfrage zu erfüllen.  Wir übergeben die Produkt-ID.  Führen Sie diese Methode beispielsweise aus, indem Sie auf die Schaltfläche klicken. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">launchBilling</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String skuId)</span></span></span><span class="hljs-function"> </span></span>{ BillingFlowParams billingFlowParams = BillingFlowParams.newBuilder() .setSkuDetails(mSkuDetailsMap.get(skuId)) .build(); mBillingClient.launchBillingFlow(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, billingFlowParams); }</code> </pre> <br>  Wenn Sie diese Methode ausführen, wird dieses Dialogfeld angezeigt (ca. Bilder aus dem Internet). <br><br><img src="https://cdn-images-1.medium.com/max/1200/1*GMy6xh4083vU7c6SHng57g.png" alt="Bild"><br><br>  Wenn der Benutzer die Waren kauft, muss er diese bereitstellen.  Fügen Sie die <i>payComplete ()</i> -Methode hinzu und führen Sie darin Aktionen aus, die den Zugriff auf das gekaufte Produkt ermöglichen.  Wenn ein Nutzer beispielsweise eine Anzeigenunterbrechung gekauft hat, führen Sie diese Methode so aus, dass die Anzeige nicht mehr angezeigt wird. <br><br><pre> <code class="java hljs">... <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPurchasesUpdated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> responseCode, @Nullable List&lt;Purchase&gt; purchases)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (responseCode == BillingClient.BillingResponse.OK &amp;&amp; purchases != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//       payComplete(); } } ...</span></span></code> </pre> <br>  Alles ist in Ordnung, aber wenn der Benutzer die Anwendung neu startet, weiß unser Programm nichts über Einkäufe.  Es ist notwendig, Informationen über sie anzufordern.  Tun Sie es in <i>onBillingSetupFinished ()</i> . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBillingSetupFinished</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@BillingClient.BillingResponse </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> billingResponseCode)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (billingResponseCode == BillingClient.BillingResponse.OK) { <span class="hljs-comment"><span class="hljs-comment">//         querySkuDetails(); //   List&lt;Purchase&gt; purchasesList = queryPurchases(); //   //   ,    for (int i = 0; i &lt; purchasesList.size(); i++) { String purchaseId = purchasesList.get(i).getSku(); if(TextUtils.equals(mSkuId, purchaseId)) { payComplete(); } } } } ... private List&lt;Purchase&gt; queryPurchases() { Purchase.PurchasesResult purchasesResult = mBillingClient.queryPurchases(BillingClient.SkuType.INAPP); return purchasesResult.getPurchasesList(); }</span></span></code> </pre><br>  In <i>KäufeListe</i> erhält eine Liste aller vom Benutzer getätigten Käufe. <br><br>  Wir prüfen: Wenn die Ware gekauft wird, führen Sie <i>payComplete () aus</i> . <br><br>  Fertig.  Diese Anwendung muss noch in der Play Console veröffentlicht und Produkte hinzugefügt werden.  So fügen Sie ein Produkt hinzu: <i>Beschreibung der Anwendungsseite</i> &gt; <i>Zum Verkauf stehender Inhalt</i> &gt; <i>Begrenzten Inhalt erstellen</i> . <br><br>  <b>Hinweis 1</b> : Sie können keine Waren hinzufügen, bis Sie den Anwendungsbuild auf die Play Console hochgeladen haben. <br><br>  <b>Hinweis 2</b> : Um den Kaufdialog anzuzeigen, müssen Sie den Build in die Play Console hochladen, das Produkt hinzufügen und eine Weile (~ 30 Minuten - 1 Stunde - 3 Stunden) warten, bis das Produkt aktualisiert wird. Danach wird ein Dialogfeld angezeigt, und Sie können wird einen Kauf tätigen. <br><br>  <b>Hinweis 3</b> : <i>Bitte beheben Sie den Fehler bei den Eingabeparametern.</i>  <i>Die SKU darf nicht null sein</i> - das Produkt in der Play Console wurde noch nicht aktualisiert. Bitte warten Sie. <br><br>  <b>Hinweis 4</b> : Möglicherweise tritt in den Protokollen als <i>Antwortcode 6</i> der <i>Fehler "Ihre Transaktion kann nicht abgeschlossen werden" auf</i> <i>,</i> während Sie testen.  Aus welchen Gründen mir dies passiert, ist nicht genau bekannt, aber nach meinen Beobachtungen geschieht dies nach häufigen Manipulationen beim Kauf und der Rückgabe von Waren.  Um dies zu beheben, gehen Sie zum Bankkartenmenü und übertragen Sie Ihre Karte.  Wie vermeide ich das?  Fügen Sie Ihr Konto als Tester zur Play Console hinzu und kaufen Sie nur von einer Testkarte. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Demo auf Github</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kauf mir Kaffee</a> <br><br>  <sup><i>(Übrigens funktioniert das Donetsystem auf Habr über den Button unter dem Artikel - ca. Moderator).</i></sup> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de444072/">https://habr.com/ru/post/de444072/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de444060/index.html">Migration von Nagios zu Icinga2 in Australien</a></li>
<li><a href="../de444062/index.html">Licht auf! Nachttransformationen des Lakhta Centers</a></li>
<li><a href="../de444064/index.html">Neue Ideen für eine neue Zukunft</a></li>
<li><a href="../de444068/index.html">Wer schaut zu?</a></li>
<li><a href="../de444070/index.html">Entwicklung eines Hexapods von Grund auf neu (Teil 4) - mathematische Trajektorien und Sequenzen</a></li>
<li><a href="../de444074/index.html">Internet der Dinge: Vier Technologiegeschichten</a></li>
<li><a href="../de444076/index.html">Wie ich versucht habe, TP4056 zu besiegen</a></li>
<li><a href="../de444078/index.html">Linux 5.1 Kernel - was ist über die Änderungen bekannt</a></li>
<li><a href="../de444082/index.html">Die Zusammenfassung interessanter Materialien für den mobilen Entwickler # 290 (11. - 17. März)</a></li>
<li><a href="../de444088/index.html">Mit dem neuen Material für Brennstoffzellen können Sie langfristige "Energiezellen" erstellen.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>