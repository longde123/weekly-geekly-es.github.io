<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí• üôåüèº üï¢ Toda a verdade sobre o RTOS. Artigo 31. Diagn√≥sticos e verifica√ß√£o de erros RTOS üíÖüèø üë©üèΩ‚Äçü§ù‚Äçüë©üèº üôé</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A manipula√ß√£o de erros n√£o √© a coisa mais comum para sistemas operacionais projetados para aplicativos de sistemas incorporados. Este √© um resultado i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Toda a verdade sobre o RTOS. Artigo 31. Diagn√≥sticos e verifica√ß√£o de erros RTOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463403/"><img src="https://habrastorage.org/webt/ot/7b/f6/ot7bf602l2thhfxphukcduobth8.jpeg"><br><br>  A manipula√ß√£o de erros n√£o √© a coisa mais comum para sistemas operacionais projetados para aplicativos de sistemas incorporados.  Este √© um resultado inevit√°vel de recursos limitados, pois todos os sistemas embarcados possuem certas restri√ß√µes.  E apenas um pequeno n√∫mero desses sistemas tem a capacidade de se comportar como sistemas de desktop, ou seja, oferece ao usu√°rio a capacidade de escolher a√ß√µes no caso de eventos excepcionais. <br><br>  No Nucleus SE, em geral, existem tr√™s tipos de verifica√ß√£o de erros: <br><ul><li>  meios para verificar a integridade da configura√ß√£o selecionada para garantir que os par√¢metros selecionados n√£o levem a erros; </li><li>  c√≥digo opcionalmente inclu√≠do para verificar o comportamento do tempo de execu√ß√£o; </li><li>  Certas fun√ß√µes da API que contribuem para o desenvolvimento de c√≥digo mais robusto. </li></ul><br>  Tudo isso ser√° discutido neste artigo, juntamente com algumas id√©ias sobre diagn√≥stico pelo usu√°rio. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Artigos anteriores da s√©rie:</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 30.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Procedimentos de inicializa√ß√£o e inicializa√ß√£o do N√∫cleo SE</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 29.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Interrup√ß√µes no N√∫cleo SE</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 28.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Temporizadores de software</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo # 27</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Hora do sistema</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 26.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Canais: servi√ßos auxiliares e estruturas de dados</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 25.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Canais de Dados: Introdu√ß√£o e Servi√ßos B√°sicos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 24.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Filas: servi√ßos auxiliares e estruturas de dados</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 23.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Filas: introdu√ß√£o e servi√ßos b√°sicos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 22.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Caixas de correio: servi√ßos auxiliares e estruturas de dados</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 21.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Caixas de correio: Introdu√ß√£o e servi√ßos b√°sicos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 20.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sem√°foros: Servi√ßos Auxiliares e Estruturas de Dados</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 19.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sem√°foros: introdu√ß√£o e servi√ßos b√°sicos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo # 18</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Grupos de Sinalizadores de Eventos: Servi√ßos Auxiliares e Estruturas de Dados</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 17.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Grupos de Sinalizadores de Eventos: Introdu√ß√£o e Servi√ßos B√°sicos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 16.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Signals</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 15.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parti√ß√µes de mem√≥ria: servi√ßos e estruturas de dados</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 14.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Se√ß√µes de mem√≥ria: introdu√ß√£o e servi√ßos b√°sicos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 13.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Estruturas de dados da tarefa e chamadas de API n√£o suportadas</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 12.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Servi√ßos para trabalhar com tarefas</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 11.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tarefas: configura√ß√£o e introdu√ß√£o √† API</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 10.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Agendador: recursos avan√ßados e preserva√ß√£o de contexto</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 9.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Agendador: implementa√ß√£o</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 8.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">N√∫cleo SE: Projeto Interno e Implanta√ß√£o</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo # 7</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">N√∫cleo SE: Introdu√ß√£o</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 6.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Outros servi√ßos RTOS</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 5.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Intera√ß√£o e sincroniza√ß√£o de tarefas</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tarefas, altern√¢ncia de contexto e interrup√ß√µes</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo # 3</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tarefas e planejamento</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RTOS: estrutura e modo em tempo real</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RTOS: introdu√ß√£o.</a> <br></div></div><br><br><h2>  Verificar configura√ß√µes </h2><br>  O Nucleus SE foi projetado com foco na alta configurabilidade do usu√°rio, o que deve garantir o melhor uso dos recursos dispon√≠veis.  Essa configurabilidade √© uma tarefa complexa, pois o n√∫mero de par√¢metros poss√≠veis e as interdepend√™ncias entre eles s√£o enormes.  Conforme declarado em muitos artigos anteriores, a maioria das etapas do usu√°rio para configurar o Nucleus SE s√£o executadas usando as diretivas <b>#define</b> no arquivo <b>nuse_config.h</b> . <br><br>  Para ajudar a identificar erros de configura√ß√£o, o arquivo <b>nuse_config.c</b> a <b>#include</b> inclui o arquivo <b>nuse_config_check.h</b> , que executa verifica√ß√µes de integridade nas diretivas <b>#define</b> .  A seguir est√° um trecho deste arquivo: <br><pre><code class="plaintext hljs">/*** Tasks and task control ***/ #if NUSE_TASK_NUMBER &lt; 1 || NUSE_TASK_NUMBER &gt; 16 #error NUSE: invalid number of tasks - must be 1-16 #endif #if NUSE_TASK_RELINQUISH &amp;&amp; (NUSE_SCHEDULER_TYPE == NUSE_PRIORITY_SCHEDULER) #error NUSE: NUSE_Task_Relinquish() selected - not valid with priority scheduler #endif #if NUSE_TASK_RESUME &amp;&amp; !NUSE_SUSPEND_ENABLE #error NUSE: NUSE_Task_Resume() selected - task suspend not enabled #endif #if NUSE_TASK_SUSPEND &amp;&amp; !NUSE_SUSPEND_ENABLE #error NUSE: NUSE_Task_Suspend() selected - task suspend not enabled #endif #if NUSE_INITIAL_TASK_STATE_SUPPORT &amp;&amp; !NUSE_SUSPEND_ENABLE #error NUSE: Initial task state enabled - task suspend not enabled #endif /*** Partition pools ***/ #if NUSE_PARTITION_POOL_NUMBER &gt; 16 #error NUSE: invalid number of partition pools - must be 0-16 #endif #if NUSE_PARTITION_POOL_NUMBER == 0 #if NUSE_PARTITION_ALLOCATE #error NUSE: NUSE_Partition_Allocate() enabled ‚Äì no partition pools configured #endif #if NUSE_PARTITION_DEALLOCATE #error NUSE: NUSE_Partition_Deallocate() enabled ‚Äì no partition pools configured #endif #if NUSE_PARTITION_POOL_INFORMATION #error NUSE: NUSE_Partition_Pool_Information() enabled ‚Äì no partition pools configured #endif #endif</code> </pre> <br>  O c√≥digo acima executa as seguintes verifica√ß√µes: <br><ul><li>  verifique se pelo menos uma, mas n√£o mais que dezesseis tarefas est√£o configuradas; </li><li>  Confirma√ß√£o de que as fun√ß√µes da API selecionadas s√£o compat√≠veis com o planejador selecionado e outros par√¢metros especificados; </li><li>  verifica√ß√£o de que n√£o foram criadas mais de dezesseis inst√¢ncias de outros objetos do kernel; </li><li>  Confirma√ß√£o de que as fun√ß√µes da API relacionadas a objetos n√£o declarados n√£o foram selecionadas. </li><li>  garantir que as fun√ß√µes da API para sinais e hora do sistema n√£o sejam usadas quando o suporte a esses servi√ßos estiver desativado; </li><li>  verifica√ß√£o do tipo selecionado de planejador e par√¢metros relacionados. </li></ul><br>  Em todos os casos, a detec√ß√£o de erros leva √† execu√ß√£o da diretiva <b>#error</b> na compila√ß√£o.  Isso geralmente faz com que a compila√ß√£o pare e exiba a mensagem correspondente. <br><br>  Este arquivo n√£o garante a impossibilidade de criar uma configura√ß√£o / configura√ß√£o incorreta, mas torna muito improv√°vel. <br><br><h2>  Verificando as configura√ß√µes da API </h2><br>  Como o Nucleus RTOS, o Nucleus SE tem a capacidade de incluir c√≥digo para verificar os par√¢metros de chamada de fun√ß√µes da API em tempo de execu√ß√£o.  Geralmente, isso √© usado apenas durante a depura√ß√£o e o teste inicial, pois no c√≥digo final do programa o consumo excessivo de mem√≥ria √© indesej√°vel. <br><br>  A verifica√ß√£o de par√¢metro √© ativada configurando o par√¢metro <b>NUSE_API_PARAMETER_CHECKING</b> no arquivo <b>nuse_config.h</b> como <b>TRUE</b> .  Isso leva √† compila√ß√£o do c√≥digo adicional necess√°rio.  A seguir, √© apresentado um exemplo de verifica√ß√£o dos par√¢metros de fun√ß√£o da API: <br><pre> <code class="plaintext hljs">STATUS NUSE_Mailbox_Send(NUSE_MAILBOX mailbox, ADDR *message, U8 suspend) { STATUS return_value; #if NUSE_API_PARAMETER_CHECKING if (mailbox &gt;= NUSE_MAILBOX_NUMBER) { return NUSE_INVALID_MAILBOX; } if (message == NULL) { return NUSE_INVALID_POINTER; } #if NUSE_BLOCKING_ENABLE if ((suspend != NUSE_NO_SUSPEND) &amp;&amp; (suspend != NUSE_SUSPEND)) { return NUSE_INVALID_SUSPEND; } #else if (suspend != NUSE_NO_SUSPEND) { return NUSE_INVALID_SUSPEND; } #endif #endif</code> </pre><br>  Essa verifica√ß√£o dos par√¢metros pode levar ao fato de que a chamada da API produzir√° um c√≥digo de erro.  √â um valor negativo no formato <b>NUSE_INVALID_xxx</b> (por exemplo, <b>NUSE_INVALID_POINTER</b> ) - um conjunto completo de defini√ß√µes est√° contido no arquivo <b>nuse_codes.h</b> . <br><br>  Para processar valores de erro, um c√≥digo de aplicativo adicional (possivelmente criado usando compila√ß√£o condicional) pode ser adicionado; no entanto, para detect√°-los, √© melhor usar as ferramentas de monitoramento dos dados dos depuradores de firmware modernos. <br><br>  A verifica√ß√£o dos par√¢metros leva ao consumo adicional de mem√≥ria (c√≥digo adicional) e afeta o desempenho do c√≥digo; portanto, seu uso afetar√° todo o sistema.  Como todo o c√≥digo fonte do Nucleus SE est√° dispon√≠vel para o desenvolvedor, a verifica√ß√£o e a depura√ß√£o podem ser realizadas manualmente no c√≥digo final do aplicativo, se for necess√°ria precis√£o absoluta. <br><br><h2>  Verificando a pilha de tarefas </h2><br>  At√© que o Agendador de execu√ß√£o at√© a conclus√£o seja usado, o Nucleus SE oferece a capacidade de verificar a pilha de tarefas, que √© semelhante a uma fun√ß√£o semelhante no Nucleus RTOS e mostra o espa√ßo restante na pilha.  Essa chamada de utilit√°rio da API ( <b>NUSE_Task_Check_Stack ()</b> ) foi descrita em detalhes em um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo anterior</a> (n¬∫ 12).  Algumas id√©ias para verificar erros de pilha s√£o fornecidas posteriormente neste artigo na se√ß√£o Diagn√≥stico personalizado. <br><br><h2>  Informa√ß√µes da vers√£o </h2><br>  O Nucleus RTOS e o Nucleus SE t√™m uma fun√ß√£o de API que simplesmente retorna informa√ß√µes sobre a vers√£o / constru√ß√£o do kernel. <br><br><h3>  Chamada da API do RTOS do n√∫cleo </h3><br>  Prot√≥tipo de chamada de servi√ßo: <br>  CHAR * NU_Release_Information (VOID); <br><br>  Par√¢metros: nenhum. <br><br>  Valor de retorno: <br>  Ponteiro para uma sequ√™ncia contendo informa√ß√µes de vers√£o que terminam com um byte nulo. <br><br><h3>  Chamada da API do Nucleus SE </h3><br>  Essa chamada de API suporta a funcionalidade principal da API do Nucleus RTOS. <br><br>  Prot√≥tipo de chamada de servi√ßo: <br>  char * NUSE_Release_Information (nulo); <br><br>  Par√¢metros: nenhum. <br><br>  Valor de retorno: <br>  Ponteiro para uma sequ√™ncia contendo informa√ß√µes de vers√£o que terminam com um byte nulo. <br><br><h3>  Fazendo uma chamada para obter informa√ß√µes de montagem do Nucleus SE </h3><br>  A implementa√ß√£o desta chamada √† API √© bastante simples.  Um ponteiro √© retornado para a linha constante <b>NUSE_Release_Info</b> , declarada e inicializada no arquivo <b>nuse_globals.c</b> . <br><br>  Essa linha tem o formato Nucleus SE - <b>Xyymmmdd</b> , em que: <br>  <b>X</b> - status da compila√ß√£o: <b>A</b> = alfa;  <b>B</b> = beta;  <b>R</b> = libera√ß√£o <br>  <b>aa</b> - ano de lan√ßamento <br>  <b>mm</b> - m√™s de lan√ßamento <br>  <b>dd</b> - dia do lan√ßamento <br><br><h2>  Compat√≠vel com n√∫cleo RTOS </h2><br>  O Nucleus RTOS cont√©m suporte opcional a revistas de hist√≥ria.  O kernel registra os detalhes de v√°rias a√ß√µes do sistema.  Existem fun√ß√µes de API que permitem que os programas: <br><ul><li>  ativar / desativar o registro; </li><li>  crie uma entrada no di√°rio; </li><li>  Obter uma entrada no di√°rio. </li></ul><br>  Este recurso n√£o √© suportado no Nucleus SE. <br><br>  O Nucleus RTOS tamb√©m possui v√°rias macros de gerenciamento de erros que permitem executar confirma√ß√µes sem erro (ASSERT) e fornecem a capacidade de chamar fun√ß√µes de erro cr√≠ticas definidas pelo usu√°rio.  Eles s√£o opcionalmente inclu√≠dos no conjunto do SO.  O Nucleus SE n√£o suporta essa funcionalidade. <br><br><h3>  Diagn√≥stico do usu√°rio </h3><br>  At√© agora neste artigo, examinamos as ferramentas de diagn√≥stico e verifica√ß√£o de erros fornecidas pelo pr√≥prio Nucleus SE.  Agora vale a pena dizer como as ferramentas de diagn√≥stico definidas pelo usu√°rio ou orientadas para um aplicativo espec√≠fico podem ser implementadas usando as ferramentas fornecidas pelo kernel e / ou nosso conhecimento sobre sua estrutura interna e implementa√ß√£o. <br><br><h3>  Diagn√≥stico espec√≠fico do aplicativo </h3><br>  Em quase todos os aplicativos, voc√™ pode adicionar c√≥digo adicional para verificar sua integridade no tempo de execu√ß√£o.  O n√∫cleo de multitarefa facilita e simplifica a cria√ß√£o de uma tarefa especial para este trabalho.  Obviamente, neste artigo, n√£o consideraremos casos de diagn√≥stico muito incomuns, mas consideraremos algumas id√©ias gerais. <br><br><h3>  Verifica√ß√µes de mem√≥ria </h3><br>  Obviamente, a opera√ß√£o adequada da mem√≥ria √© fundamental para a integridade de qualquer sistema de processador.  N√£o √© menos √≥bvio que um erro cr√≠tico n√£o permitir√° que voc√™ execute, n√£o apenas diagn√≥sticos, mas todo o software como um todo ( <i>nota do tradutor: a prop√≥sito, esse √© exatamente o caso que examinamos no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo ‚ÄúFake Blue Pill‚Äù</a></i> ).  No entanto, h√° situa√ß√µes em que um determinado erro aparece, o que √© um s√©rio motivo de preocupa√ß√£o, mas n√£o interfere na execu√ß√£o do c√≥digo.  O teste de mem√≥ria √© um t√≥pico bastante complicado que est√° al√©m do escopo deste artigo, portanto, darei apenas algumas id√©ias gerais. <br><br>  Os dois erros mais comuns que ocorrem na RAM s√£o: <br><ul><li>  "Bits aderentes" quando o bit tem um valor de 0 ou 1, que n√£o pode ser alterado; </li><li>  "Diafonia" quando bits adjacentes causam interfer√™ncia um no outro. </li></ul><br>  Ambos os erros podem ser verificados escrevendo e lendo determinados padr√µes de teste em cada √°rea da RAM, por sua vez.  Algumas verifica√ß√µes podem ser realizadas apenas na inicializa√ß√£o, mesmo antes da forma√ß√£o da pilha ( <i>nota do tradutor: no artigo mencionado acima, constatou-se que foi o primeiro uso da pilha que destruiu tudo de uma vez</i> ).  Por exemplo, uma verifica√ß√£o de "unidade em execu√ß√£o", na qual cada bit de mem√≥ria recebe um valor de um e todos os outros bits s√£o verificados para garantir que sejam iguais a zero.  Outros padr√µes de teste bit a bit podem ser executados durante a opera√ß√£o, desde que enquanto a √°rea de RAM esteja danificada, a altern√¢ncia de contexto n√£o ocorrer√°.  O uso das macros de restri√ß√£o de se√ß√£o cr√≠tica do <b>Nucleus SE NUSE_CS_Enter ()</b> e <b>NUSE_CS_Exit ()</b> √© bastante simples e escal√°vel. <br><br>  Diferentes tipos de ROMs tamb√©m s√£o propensos a erros peri√≥dicos, mas n√£o existem muitas ferramentas para verific√°-las.  Uma soma de verifica√ß√£o calculada ap√≥s a montagem do c√≥digo pode ser √∫til aqui.  Essa verifica√ß√£o pode ser realizada no momento da inicializa√ß√£o e, possivelmente, no tempo de execu√ß√£o. <br><br>  Um erro na l√≥gica de endere√ßamento de mem√≥ria pode afetar a ROM e a RAM.  Voc√™ pode desenvolver uma verifica√ß√£o especial para esse erro, mas provavelmente ser√° detectado como parte das verifica√ß√µes descritas acima. <br><br><h3>  Perif√©ricos de teste </h3><br>  Al√©m da CPU, os circuitos perif√©ricos tamb√©m podem estar sujeitos a erros.  Obviamente, isso varia muito de sistema para sistema; no entanto, na maioria dos dispositivos, existem v√°rias maneiras de verificar sua integridade usando o software de diagn√≥stico.  Por exemplo, um canal de comunica√ß√£o pode ter um modo de verifica√ß√£o de loopback no qual todos os dados que entram no canal s√£o retornados imediatamente. <br><br><h3>  Servi√ßo de vigil√¢ncia </h3><br>  Os desenvolvedores incorporados costumam usar um c√£o de guarda.  Este √© um dispositivo perif√©rico que interrompe a CPU e aguarda uma resposta ou (mais preferencialmente) requer acesso peri√≥dico do software.  Nos dois casos, um resultado comum de um cron√¥metro de vigil√¢ncia √© uma redefini√ß√£o do sistema. <br><br>  O uso efetivo de um c√£o de guarda em um ambiente multitarefa √© um problema complexo.  Se voc√™ criar uma tarefa que a acesse periodicamente (cron√¥metro de vigil√¢ncia), confirmar√° que essa tarefa espec√≠fica est√° funcionando.  Uma solu√ß√£o poss√≠vel poderia ser a implementa√ß√£o da "tarefa do despachante".  Um exemplo dessa tarefa ser√° fornecido abaixo. <br><br><h3>  Verifica√ß√£o de estouro de pilha </h3><br>  Se voc√™ n√£o usar o Agendador de Execu√ß√£o at√© a Conclus√£o, ser√° criada uma pilha para cada tarefa no aplicativo Nucleus SE.  A integridade dessas pilhas √© muito importante, mas √© prov√°vel que a quantidade de RAM seja limitada; portanto, √© importante otimizar o tamanho do aplicativo.  Prever estaticamente os requisitos para a pilha de cada tarefa √© poss√≠vel, mas muito dif√≠cil.  A pilha deve ser grande o suficiente para at√© as fun√ß√µes mais aninhadas, junto com o manipulador de interrup√ß√µes mais exigente.  Uma abordagem mais simples para resolver esse problema seria usar testes exaustivos de tempo de execu√ß√£o. <br><br>  De um modo geral, existem duas abordagens para empilhar a verifica√ß√£o.  Se voc√™ usar um depurador sofisticado de software incorporado, os limites da pilha poder√£o ser monitorados e todas as viola√ß√µes ser√£o detectadas.  A <b>localiza√ß√£o</b> e o tamanho das pilhas do Nucleus SE est√£o dispon√≠veis nas estruturas de dados globais da ROM: <b>NUSE_Task_Stack_Base []</b> e <b>NUSE_Task_Stack_Size []</b> . <br><br>  Uma alternativa √© o teste de tempo de execu√ß√£o.  Uma abordagem comum √© usar ‚Äúpalavras de guarda‚Äù no final de cada pilha, geralmente o primeiro elemento de cada √°rea dos dados da pilha.  Essas palavras s√£o inicializadas com um valor diferente de zero reconhecido.  A tarefa de servi√ßo / diagn√≥stico verifica se essas palavras foram alteradas e executa as a√ß√µes apropriadas.  Pressionar a palavra seguran√ßa n√£o significa que a pilha esteja cheia, mas indica que isso est√° prestes a acontecer.  Portanto, o software pode continuar funcionando, pode ser necess√°rio tomar a√ß√µes corretivas ou relatar um erro ao usu√°rio. <br><br><h3>  Tarefa do supervisor </h3><br>  Apesar do Nucleus SE n√£o reservar nenhuma das dezesseis tarefas poss√≠veis para suas pr√≥prias necessidades, o usu√°rio pode selecionar uma tarefa para diagn√≥stico.  Essa pode ser uma tarefa de baixa prioridade que simplesmente usa qualquer tempo "livre" do processador ou pode ser uma tarefa de alta prioridade que √© executada periodicamente, levando um curto per√≠odo de tempo, o que garante que os diagn√≥sticos sejam realizados regularmente. <br><br>  A seguir, √© apresentado um exemplo de como uma tarefa semelhante pode funcionar. <br><br>  Os sinalizadores de sinal da tarefa do despachante s√£o usados ‚Äã‚Äãpara rastrear a opera√ß√£o de seis tarefas cr√≠ticas do sistema.  Cada uma dessas tarefas usa um sinalizador espec√≠fico (do bit 0 ao bit 5) e deve defini-lo regularmente.  A tarefa do expedidor redefine todos os sinalizadores e pausa seu trabalho por um determinado per√≠odo de tempo.  Quando ela retoma o trabalho, espera que todas as seis tarefas sejam "verificadas" configurando o sinalizador apropriado, e procura uma correspond√™ncia exata com o valor de <b>b00111111</b> (do arquivo <b>nuse_binary.h</b> ).  Se tudo atender aos requisitos, ele redefine os sinalizadores e pausa novamente.  Caso contr√°rio, ele chama a rotina de tratamento de erros cr√≠ticos, que por sua vez pode, por exemplo, reiniciar o sistema. <br><br>  Em uma implementa√ß√£o alternativa, grupos de sinalizadores de eventos podem ser usados.  Isso faz sentido se os sinais n√£o forem usados ‚Äã‚Äãem outras partes do aplicativo (caso contr√°rio, isso levar√° ao uso excessivo de RAM por todas as tarefas) e, especialmente, se os sinalizadores de eventos forem usados ‚Äã‚Äãpara outros fins. <br><br><h2>  Rastreamento e cria√ß√£o de perfil </h2><br>  Apesar do fato de que muitos depuradores de software embarcados modernos t√™m um alto grau de personaliza√ß√£o e podem ser usados ‚Äã‚Äãpara trabalhar com o RTOS, a depura√ß√£o de um aplicativo multiencadeado ainda pode ser dif√≠cil.  Uma abordagem amplamente usada √© a cria√ß√£o de perfil de p√≥s-execu√ß√£o, na qual o c√≥digo (RTOS) √© implementado para que uma auditoria detalhada de seu trabalho possa ser analisada em retrospecto.  Normalmente, a implementa√ß√£o de um servi√ßo desse tipo inclui dois componentes: <br><ol><li>  Um c√≥digo adicional √© adicionado ao RTOS para registrar a√ß√µes.  Normalmente, ele ser√° envolvido em diretivas de pr√©-processador para usar a compila√ß√£o condicional.  Esse c√≥digo registra v√°rios bytes de informa√ß√µes quando ocorre um evento importante (por exemplo, chamar uma fun√ß√£o de API ou alternar o contexto).  Essas informa√ß√µes podem incluir: <br><ul><li>  endere√ßo atual (PC); </li><li>  ID da tarefa atual (√≠ndice); </li><li>  √≠ndices de outros objetos usados; </li><li>  c√≥digo correspondente √† opera√ß√£o executada. </li></ul><br></li><li>  A tarefa alocada para descarregar o buffer de informa√ß√µes do perfil no armazenamento externo, geralmente no computador host. </li></ol><br>  A an√°lise dos dados assim obtidos tamb√©m exigir√° algum trabalho, mas n√£o √© mais complicado do que usar uma planilha regular do Excel. <br><br>  No pr√≥ximo artigo, examinaremos em detalhes a compatibilidade do Nucleus SE e Nucleus RTOS. <br><br>  <b>Sobre o autor:</b> Colin Walls trabalha na ind√∫stria eletr√¥nica h√° mais de trinta anos, dedicando a maior parte de seu tempo ao firmware.  Ele agora √© engenheiro de firmware na Mentor Embedded (uma divis√£o da Mentor Graphics).  Colin Walls frequentemente fala em confer√™ncias e semin√°rios, autor de v√°rios artigos t√©cnicos e dois livros sobre firmware.  Vive no Reino Unido.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Blog</a> profissional <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">de Colin</a> , e-mail: colin_walls@mentor.com. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt463403/">https://habr.com/ru/post/pt463403/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt463391/index.html">Como se casar com todos (casamento de um, dois e tr√™s sexos) do ponto de vista da matem√°tica e por que os homens sempre vencem</a></li>
<li><a href="../pt463393/index.html">Sua empresa √© uma fam√≠lia ou um time de esportes?</a></li>
<li><a href="../pt463397/index.html">Mercado de c√¢mbio e engenharia financeira na Idade M√©dia</a></li>
<li><a href="../pt463399/index.html">Introdu√ß√£o ao 3CX 16 Update 3 Alpha - DNS avan√ßado e reconex√£o de clientes m√≥veis</a></li>
<li><a href="../pt463401/index.html">N√°poles a Roma: Novas CPUs AMD EPYC</a></li>
<li><a href="../pt463405/index.html">A segunda camada de desenvolvimento (jogo para celular), o que, quando e por que</a></li>
<li><a href="../pt463411/index.html">N√£o trabalhe em projetos ruins</a></li>
<li><a href="../pt463415/index.html">Semana da Seguran√ßa 33: interessante com o Black Hat / DEF CON 2019</a></li>
<li><a href="../pt463417/index.html">Portando o SO para Aarch64</a></li>
<li><a href="../pt463419/index.html">Eventos digitais em Moscou de 12 a 18 de agosto</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>