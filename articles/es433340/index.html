<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéº üë®üèæ‚Äçüåæ üñêüèø Dispositivos inal√°mbricos Xiaomi en el hogar inteligente ioBroker üåô ‚õ±Ô∏è ü§ûüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saludos a todos los amantes de la dom√≥tica. Decid√≠ compartir la experiencia de usar dispositivos inal√°mbricos Xiaomi con la interfaz ZigBee. Honestame...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dispositivos inal√°mbricos Xiaomi en el hogar inteligente ioBroker</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/iobroker/blog/433340/">  Saludos a todos los amantes de la dom√≥tica.  Decid√≠ compartir la experiencia de usar dispositivos inal√°mbricos Xiaomi con la interfaz ZigBee.  Honestamente, estoy en contra del uso de dispositivos inal√°mbricos en cualquier automatizaci√≥n, desde sistemas de control de procesos serios de objetos grandes hasta peque√±as automatizaciones como alarmas contra incendios u hogares inteligentes, pero ... las soluciones de Xiaomi sobornadas con bajo costo, accesibilidad, excelente dise√±o y muchas cr√≠ticas positivas de los usuarios, decid√≠ para intentarlo <br><br>  Esta publicaci√≥n debe tomarse como una instrucci√≥n paso a paso para integrar dispositivos ZigBee en la infraestructura del hogar inteligente.  Aqu√≠ se describe de ninguna manera un axioma y puede encontrar muchas otras formas de conectar dispositivos ZigBee.  Si a√∫n omite la descripci√≥n detallada, puede tener la impresi√≥n de la complejidad o facilidad de combinar dispositivos de diferentes fabricantes en una plataforma local utilizando el ejemplo de ZigBee y ioBroker (m√°s sobre eso m√°s adelante).  Dir√© en este art√≠culo c√≥mo conectar dispositivos a una casa inteligente, mostrar informaci√≥n de ellos en una tableta o simplemente en un navegador y enviar mensajes a trav√©s de telegramas sobre el cambio del estado del dispositivo.  Si estoy interesado en ti, entonces pido un gato. <br><a name="habracut"></a><br>  Seg√∫n el fabricante de Xiaomi, los usuarios deber√≠an usar una aplicaci√≥n nativa con una conexi√≥n a la nube y una puerta de enlace Wi-Fi para dispositivos ZigBee.  Sin embargo, hace mucho que se conoce un m√©todo para activar el modo desarrollador en una aplicaci√≥n para obtener un token de control.  Por lo tanto, dentro de la red local, puede comunicarse con la puerta de enlace, que le permite hacer el controlador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mihome</a> , que es parte de ioBroker. <br><br>  ioBroker es una plataforma abierta para IoT, incluida la construcci√≥n de sistemas dom√©sticos inteligentes.  Qu√© es ioBroker se puede encontrar en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> anterior. <br><br>  Ahora mi casa inteligente est√° "girando" en una placa ARM Cubietruck con alg√∫n "kit de carrocer√≠a" en forma de disco duro de 80 GB, bater√≠as recargables de 5000 mAh, un maestro USB de 1 cable, un convertidor USB-RS485 para dispositivos de sondeo que utilizan el protocolo Modbus.  Armbian OS se instala en el disco duro con la transferencia de la partici√≥n ra√≠z, solo el gestor de arranque permanece en la tarjeta de memoria microSD. <br><br>  Comenc√© a conocer los dispositivos inal√°mbricos de Xiaomi comprando sensores de temperatura y humedad.  En ese momento, la √∫nica posibilidad de su integraci√≥n era el controlador <b>mihome</b> , que se mencion√≥ anteriormente. <br><br><h4>  Conductor de Mihome </h4><br>  Agregar un controlador al sistema es muy simple, debe hacer clic en el bot√≥n "+" en la lista de controladores disponibles y observar el proceso de instalaci√≥n. <br><br><img src="https://habrastorage.org/webt/1q/uv/gs/1quvgskqfsscaszi1df_weidl_k.png"><br><br>  No describir√© la instalaci√≥n y la configuraci√≥n inicial de la aplicaci√≥n nativa de Android Mi Home, puede verla en la p√°gina de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Github</a> del controlador o en Internet.  Entonces, se activa el modo desarrollador, se recibe el token, configuramos el adaptador mihome, lo guardamos y ejecutamos si no se ha iniciado. <br><br><img src="https://habrastorage.org/webt/hg/gi/uz/hggiuzkuphbirpnjp1xdcwcxy2e.png"><br><br>  La puerta de enlace de Xiaomi y los dispositivos conectados en la aplicaci√≥n Mi Home deben aparecer en el √°rbol de objetos. <br><br><img src="https://habrastorage.org/webt/tm/wf/gs/tmwfgsbmgvfncvw-gyezzdjhamw.png"><br><br>  A continuaci√≥n, puede configurar los objetos reci√©n creados.  Por ejemplo, almacenar el historial de sensores de temperatura y humedad.  Utilizo un controlador SQL para datos hist√≥ricos que est√° configurado en una base de datos SQLite. <br><br><img src="https://habrastorage.org/webt/wv/op/yk/wvopykrwhlu2pcgdru82m1yv8sg.png"><br><br>  El almacenamiento del historial de la variable se configura en la ventana de objetos del sistema: en la jerarqu√≠a de objetos, debe acceder a la variable misma y presionar el bot√≥n con una llave a la derecha.  En la pesta√±a "Configuraci√≥n", tengo el almacenamiento de historial activado por sensores, solo cambios en la variable. <br><br>  Otras configuraciones: <br><br><ul><li>  intervalo m√≠nimo de 10 segundos: si la variable cambiar√° con m√°s frecuencia, se ignorar√° la entrada en la base de datos </li><li>  registrar valores cada 300 segundos (5 minutos): si la variable no cambia durante m√°s de 5 minutos, el valor actual todav√≠a se escribe en la base de datos </li><li>  tipo de valor - n√∫mero </li><li>  vida √∫til: 1 a√±o </li></ul><br><img src="https://habrastorage.org/webt/a2/6n/ed/a26nedcztddt2fo4vofcdndkadu.png"><br><br>  Agregar nuevos dispositivos ocurre a trav√©s de la aplicaci√≥n nativa.  Es decir  debe emparejar el nuevo dispositivo con la puerta de enlace de acuerdo con las instrucciones adjuntas y luego aparecer√° autom√°ticamente en la lista de objetos ioBroker. <br><br><h4>  Conductor Zigbee </h4><br>  Fue un inconveniente para m√≠ usar la aplicaci√≥n Xiaomi nativa, especialmente porque tuve que comprar una puerta de enlace con un enchufe chino, que en mi caso, excepto para comunicarme con dispositivos, no era √∫til para nada.  S√≠, se puede usar como luz nocturna o usar un sensor de luz en algunos escenarios.  En Internet puede encontrar instrucciones sobre c√≥mo "alimentar" una lista de reproducci√≥n a una puerta de enlace para reproducir sus propias estaciones de radio, pero nada de esto me qued√≥ grabado.  Adem√°s, la idea de que mis datos se filtraban en alg√∫n lugar, se procesaban y almacenaban en alg√∫n lugar era inquietante. <br><br>  Uno de los usuarios activos de la plataforma ioBroker encontr√≥ en Internet la biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">zigbee-shepherd</a> en node.js, en la que se mencionaba la conexi√≥n de dispositivos Xiaomi.  Se cre√≥ un controlador para ioBroker sobre la base, y el autor de este controlador no se limit√≥ solo a los dispositivos Xiaomi, la lista de dispositivos compatibles se actualiza constantemente y est√° disponible en la p√°gina de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github</a> del proyecto. <br><br>  Se supone que utiliza dispositivos de bajo costo basados ‚Äã‚Äãen los chips <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CC25xx</a> de TI como coordinador de red.  Puede comprar m√≥dulos ZigBee listos para usar con conexi√≥n USB y una antena incorporada, as√≠ como modelos m√°s caros y m√°s serios: con una antena externa, amplificador y conexi√≥n a trav√©s de UART. <br><br>  Para trabajar con el controlador, solo necesita cambiar el firmware.  Por lo tanto, resulta que este controlador no necesita una puerta de enlace costosa, no se necesitan redes Wi-Fi.  El "punto de entrada" es el coordinador, un dispositivo basado en el chip SS25xx con firmware especial.  A trav√©s del coordinador, hay comunicaci√≥n directa de los dispositivos zigbee y el sistema Smart Home, as√≠ como la vinculaci√≥n de nuevos dispositivos. <br><br>  Como coordinador, utilizo una placa base preparada basada en un chip CC2530 con una antena externa, que conect√© al servidor a trav√©s de UART. <br><br>  Para el firmware del dispositivo, se compr√≥ un depurador SmartRF04EB especial, cuyo puerto microUSB me conect√© a la computadora y el m√≥dulo ZigBee se conect√≥ mediante cableado para la depuraci√≥n de acuerdo con el esquema: <br><table><tbody><tr><th>  SS2530 </th><th>  SmartRF04EB Board </th></tr><tr><td>  P22 </td><td>  DC </td></tr><tr><td>  P21 </td><td>  DD </td></tr><tr><td>  Rst </td><td>  RESET </td></tr><tr><td>  GND </td><td>  GND </td></tr><tr><td>  Vcc </td><td>  3.3V </td></tr></tbody></table><br><br><img src="https://habrastorage.org/webt/zy/g3/mf/zyg3mfircqqapiz8vz59afyrm5g.jpeg"><br><br>  En la p√°gina de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github</a> del proyecto, descargue el firmware (el archivo se llama CC2530ZNP-Pro-Secure_LinkKeyJoin.hex para este dispositivo) y el programa de firmware (programador flash), despu√©s de lo cual se agregan los controladores necesarios al sistema. <br>  Cuando conecta la placa del depurador al puerto USB de la computadora, el programa mostrar√° inmediatamente el dispositivo conectado.  Solo necesita especificar la ruta al archivo de firmware y hacer clic en el bot√≥n "Realizar acciones" <br><br><img src="https://habrastorage.org/webt/7z/rd/w8/7zrdw8e3iwpyvisw6dzohkfn3zs.png"><br><br>  Los puertos del m√≥dulo ZigBee P03 (Rx) y P02 (Tx) est√°n conectados a las placas cubietruck UART4 (en el sistema operativo como ttyS4), con alimentaci√≥n 3V3, GND tom√≥ el pin vecino.  Para una operaci√≥n estable, a√∫n necesita tirar de los puertos P20, P4, P5 del coordinador al suelo.  Como escrib√≠ anteriormente, uso el sistema operativo Armbian, el puerto UART se activa de manera muy simple, usando el <b>comando armbian-config</b> en la secci√≥n <b>Sistema</b> - <b>Hardware</b> , debe activar el puerto deseado y reiniciar el sistema. <br><br><img src="https://habrastorage.org/webt/ic/7l/il/ic7lilxwfsext55fvjnpdyxfiuq.png"><br><br>  El controlador zigbee se agrega desde el panel de administraci√≥n con un solo clic. <br><br><img src="https://habrastorage.org/webt/uw/-d/zm/uw-dzmkdrsbgnunfmchqtzqq8ta.png"><br><br>  En mi caso, el coordinador est√° conectado al puerto <b>/ dev / ttyS4</b> (como escrib√≠ anteriormente), lo especificamos en la configuraci√≥n. <br><br><img src="https://habrastorage.org/webt/eu/2i/bo/eu2ibog5mba2paet4ecec7jo7aw.png"><br><br>  Se pueden dejar otras configuraciones por defecto.  Despu√©s del primer lanzamiento del controlador, debe emparejar (agregar) dispositivos.  La instrucci√≥n completa sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github</a> , el emparejamiento a trav√©s de este controlador es un poco m√°s complicado que a trav√©s de la aplicaci√≥n nativa, pero no tuve problemas. <br><br>  Entonces, por ejemplo, agregue el bot√≥n Xiaomi (serie Mijia), para esto presionamos el bot√≥n verde en la configuraci√≥n del controlador y, siguiendo las instrucciones, primero mantenga presionado el bot√≥n de emparejamiento en la parte posterior con un clip de papel hasta que el LED comience a parpadear, luego haga clic en este bot√≥n aproximadamente una vez cada 2 segundos, Ver el progreso del emparejamiento. <br><br><img src="https://habrastorage.org/webt/mm/vq/ok/mmvqokw8ors3oszymkuqv5jsswq.png"><br><br>  Mi apartamento no es grande, con todos los dispositivos la conexi√≥n es estable, incluso con un sensor de puerta abierta en el rellano (el muro de hormig√≥n armado mide 100 mm y 5 m en l√≠nea recta).  Los problemas comenzaron cuando decid√≠ agregar un sensor de temperatura y humedad al aire de la calle, que instal√© en la pared exterior de la casa desde el lado de la logia aislada.  La se√±al de un sensor d√©bil, que tambi√©n estaba en la calle, no lleg√≥ al gabinete de automatizaci√≥n.  El problema puede resolverse simplemente: debe agregar un enrutador a la red ZigBee y colocarlo m√°s cerca del sensor.  Algunos dispositivos inal√°mbricos, por ejemplo, el z√≥calo Xiaomi, pueden funcionar como un enrutador, pero no ten√≠a tales dispositivos.  No quer√≠a comprar una salida costosa o una luz controlada solo para "reenviar" datos desde un sensor en la calle.  Al final result√≥ que, para los mismos dispositivos terminales basados ‚Äã‚Äãen el chip SS25xx hay un firmware especial que les permite ser utilizados como un enrutador en el sistema.  Como resultado, agregu√© un enrutador basado en el chip CC2531 con una conexi√≥n USB.  No me detendr√© en el proceso de firmware, el esquema y el archivo de firmware en s√≠ se pueden encontrar en la p√°gina de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Github</a> del proyecto. <br><br>  Como, de hecho, no se produce la comunicaci√≥n con el m√≥dulo a trav√©s del puerto USB, lo conect√© temporalmente a la carga con el puerto USB y lo enchuf√© a un tomacorriente de la cocina.  En un futuro pr√≥ximo planeo colocarlo estacionario en un edificio normal en la logia y con la energ√≠a normal de un UPS dom√©stico. <br><br><img src="https://habrastorage.org/webt/kh/an/8v/khan8vzw8f5ueqs2n-jf-9kc2e4.jpeg"><br><br>  El proceso de agregar un enrutador al sistema es simple: presione el bot√≥n de emparejamiento en el controlador y en el enrutador encendido presione el bot√≥n S2 varias veces hasta que los dispositivos se conecten. <br><br><img src="https://habrastorage.org/webt/6g/x_/gf/6gx_gfpctjiecwfz8mtz3ah8bne.png"><br><br>  Agreguemos un ejemplo de un sensor de temperatura / humedad, que ubiqu√© en la galer√≠a exterior y que deber√≠a funcionar a trav√©s de un enrutador. <br><br>  Simplemente puede realizar el emparejamiento a trav√©s del controlador y el sensor debe conectarse a trav√©s del enrutador, si est√° m√°s cerca.  Pero puede especificar a la fuerza que el emparejamiento pasa por un enrutador espec√≠fico; para esto, en la lista de dispositivos en el icono del enrutador, haga clic en el bot√≥n verde de emparejamiento. <br><br><img src="https://habrastorage.org/webt/bz/df/tr/bzdftrouwfsmd3qq0yyztpsfyee.png"><br><br>  Aseg√∫rese de que el sensor est√© conectado correctamente; consulte el mapa de red. <br><br><img src="https://habrastorage.org/webt/g9/bj/ru/g9bjruowwwdc7tvq03p0vychauo.png"><br><br>  El mapa muestra las l√≠neas de emparejamiento de dispositivos que indican la calidad de la se√±al entre segmentos de red.  Como escrib√≠ anteriormente, tengo un peque√±o odnushka de 35 metros cuadrados, por lo que el mapa es bastante modesto.  Con el permiso de otros usuarios, publicar√© posibles opciones con una tarjeta m√°s grande. <br><br><img src="https://habrastorage.org/webt/9b/r9/g6/9br9g6psblxtppn56-khinqtf90.png"><br><br><img src="https://habrastorage.org/webt/jo/--/ux/jo--uxxcnxpn_qtlah5yd4awl_g.png"><br><br><img src="https://habrastorage.org/webt/p0/lg/ba/p0lgba6-rpbvnqkcttsabf6wnaa.jpeg"><br><br>  La funcionalidad de algunos dispositivos Xiaomi a trav√©s de este adaptador es incluso un poco m√°s que a trav√©s de la aplicaci√≥n nativa y el controlador mihome.  En el futuro quiero expandir un poco la red y probar nuevos dispositivos, en particular, una unidad inteligente para cortinas y un cubo sensor. <br><br><h4>  Conductor material </h4><br>  Tenemos los datos, los actuadores atados, ¬øqu√© hacer ahora con ellos?  Primero, vamos a mostrar en una hermosa interfaz.  Tengo un gran proyecto en el controlador VIS, que existe en varias versiones para diferentes permisos, pero hay suficiente material para un art√≠culo separado.  Quiz√°s ella ser√° la pr√≥xima. <br><br>  Para una visualizaci√≥n simple y r√°pida de los datos y el control de varios dispositivos, utilizo el controlador de material.  Instalaci√≥n como de costumbre en un par de clics.  Los mosaicos de interfaz muestran datos basados ‚Äã‚Äãen la configuraci√≥n de categor√≠a, que se agregan en la ventana de administraci√≥n de interfaz del mismo nombre.  La lista de categor√≠as est√° limitada solo por la imaginaci√≥n, utilizo el esquema de "funci√≥n de sala", y la agrupaci√≥n ocurre de acuerdo con ellas.  Se agregaron todas las habitaciones (cocina, pasillo, sala, balc√≥n, etc.) y funciones (iluminaci√≥n, sensores, sistema, etc.). <br><br><img src="https://habrastorage.org/webt/le/nt/7p/lent7pos1th-k5mzz9yezdmug-m.png"><br><br>  Ahora, en la ventana de configuraci√≥n de los objetos del sistema, es necesario que las variables que se mostrar√°n en la pantalla indiquen la sala, la funci√≥n y asignen un rol (para una visualizaci√≥n adecuada).  Un ejemplo es el sensor de temperatura y humedad de la pared interior de Xiaomi, conectado a trav√©s de Bluetooth. <br><br><img src="https://habrastorage.org/webt/by/2u/ws/by2uwskolk1rxomzcm-mvg_rccw.png"><br><br>  En funci√≥n de esta configuraci√≥n, el mosaico mostrar√° datos en la pantalla, el √≠cono se ajustar√° y para los objetos de cierto tipo de control estar√° disponible. <br><br>  <b>Ejemplo 1.</b> La salida de toda la informaci√≥n en una categor√≠a - funci√≥n.  Iluminaci√≥n en todo el departamento. <br><br><img src="https://habrastorage.org/webt/jp/xs/m3/jpxsm3v67xbi7otryix6xqemigu.png"><br><br>  <b>Ejemplo 2.</b> La salida de toda la informaci√≥n sobre la habitaci√≥n - Ba√±o. <br><br><img src="https://habrastorage.org/webt/5x/ce/2m/5xce2mjrmxjetxojelprdg95chg.png"><br><br>  <b>Ejemplo 3. El</b> voltaje y el nivel de descarga de la bater√≠a de todos los dispositivos inal√°mbricos Xiaomi. <br><br><img src="https://habrastorage.org/webt/40/t4/p3/40t4p3d-ggn71albkiy7aarsylo.png"><br><br>  Este controlador funciona para m√≠ para el control local del sistema desde un tel√©fono m√≥vil, una tableta estacionaria en la pared.  A veces me conecto a trav√©s de VPN.  Para controlar y ver estados de forma remota, para recibir notificaciones, utilizo el controlador de telegrama. <br><br><h4>  Conductor de telegrama </h4><br>  No describir√© la instalaci√≥n, solo repase la configuraci√≥n.  Utilizo el modo de operaci√≥n mediante encuestas peri√≥dicas (300 ms por defecto) y conexi√≥n a trav√©s de un servidor proxy.  Para obtener el token, debes "hablar" con el creador de bots, BotFather.  El proceso es simple: busque este robot, d√©le un comando para crear uno nuevo, especifique su nombre √∫nico y su clave, ind√≠quelo en la configuraci√≥n del controlador y, por seguridad, aseg√∫rese de especificar la contrase√±a de "bienvenida".  Su bot le preguntar√° cuando se comunique con un nuevo usuario. <br><br><img src="https://habrastorage.org/webt/du/nw/jt/dunwjtmlt874q5t1hma81lpz0qs.png"><br><br>  Ahora necesita configurar casos de comunicaci√≥n a trav√©s del bot.  Puede usar el controlador text2command o JavaScript para hacer esto.  Sucedi√≥ hist√≥ricamente que uso JavaScript tanto en forma de texto como de bloques Blockly.  Instalar el controlador JS no deber√≠a causar dificultades, la configuraci√≥n en este caso no es necesaria.  Despu√©s de la instalaci√≥n y el inicio, debe habilitar la visualizaci√≥n del men√∫ para crear y editar scripts. <br><br><img src="https://habrastorage.org/webt/wj/tc/pb/wjtcpbty2ro46bn6a5orrwbvpis.png"><br><br>  <b>Ejemplo 1.</b> Alertas. <br><br>  Primero, intentemos enviar una notificaci√≥n sobre la apertura, por ejemplo, de la puerta principal.  Tengo un interruptor de l√°minas de sensor inal√°mbrico Xiaomi en la puerta principal.  Superviso c√≥mo mi esposa camina con el mezquino mientras estoy en el trabajo.  Cree un nuevo script en el grupo com√∫n. <br><br><img src="https://habrastorage.org/webt/cu/l6/5j/cul65jefd-k794nct-cicju7x64.png"><br><br>  Especifique lo que ser√° "dibujar" en bloque y ll√°melo "telegram_bot". <br><br><img src="https://habrastorage.org/webt/os/ed/kq/osedkqplopwii7ckmd3eftjliwo.png"><br><br>  En el grupo "Eventos", tomamos la unidad de reacci√≥n para cambiar la variable y la arrastramos al campo de trabajo. <br><br><img src="https://habrastorage.org/webt/1h/o6/yq/1ho6yq_kluvryjb48bdo9iijn-a.png"><br><br>  Luego, seleccione la ID del objeto al que nos estamos suscribiendo, inserte la verificaci√≥n del objeto a trav√©s de "si" - "de lo contrario si" a verdadero / falso.  El resultado deber√≠a ser algo como lo siguiente. <br><br><img src="https://habrastorage.org/webt/9u/-r/0s/9u-r0sajaneojinyzpgojw2lnoa.png"><br><br>  Ok, ahora estamos corriendo, abrimos la puerta, la cerramos y vemos mensajes en el telegrama. <br><br><img src="https://habrastorage.org/webt/ae/07/u6/ae07u62jmarzp0nw1hv2a3bhv9y.png"><br><br>  <b>Ejemplo 2.</b> Control de iluminaci√≥n a trav√©s del men√∫. <br>  Un ejemplo es m√°s complicado, hagamos el control de la iluminaci√≥n usando los botones del men√∫ en telegrama.  Aqu√≠ tienes que esperar un poco, es decir  Al crear un script, debe seleccionar JS.  La tarea es aproximadamente la siguiente: crear botones en forma de men√∫ con el estado de los dispositivos que se muestran inmediatamente en el texto de la firma del bot√≥n.  Intente asegurarse de que cuando presiona el bot√≥n, el estado de la iluminaci√≥n se invierte y el estado se actualiza inmediatamente en el texto del bot√≥n con la aparici√≥n / desaparici√≥n de la bombilla.  Adem√°s, si el men√∫ ya se est√° ejecutando y se enciende / apaga manualmente la luz con el bot√≥n, es necesario que el men√∫ tambi√©n se actualice con el estado de los dispositivos. <br>  El c√≥digo contiene comentarios y es relativamente sencillo: <br><div class="oembed"><script type="text/javascript" src="https://gist.github.com/c980b9dd1c2e9d050810b11ed712b0c0.js"></script><link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-31007ea0d3bd9f80540adfbc55afc7bd.css"><div id="gist93669305" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-telegram_bot" class="file">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-text ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-telegram_bot-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-telegram_bot-LC1" class="blob-code blob-code-inner js-file-line">//    ID   </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-telegram_bot-LC2" class="blob-code blob-code-inner js-file-line">const LIGHT1 = ' ',     CH_LIGHT1 = 'mqtt.0.PLC55_Lighting.lighting.MainRoom_main1';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-telegram_bot-LC3" class="blob-code blob-code-inner js-file-line">const LIGHT2 = ' ',      CH_LIGHT2 = 'mqtt.0.PLC55_Lighting.lighting.MainRoom_main2';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-telegram_bot-LC4" class="blob-code blob-code-inner js-file-line">const LIGHT3 = ' ',    CH_LIGHT3 = 'mqtt.0.PLC55_Lighting.lighting.MainRoom_sec';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-telegram_bot-LC5" class="blob-code blob-code-inner js-file-line">const LIGHT4 = ' ',      CH_LIGHT4 = 'mqtt.0.PLC55_Lighting.lighting.Kitchen_main';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-telegram_bot-LC6" class="blob-code blob-code-inner js-file-line">const LIGHT5 = ' 1',  	CH_LIGHT5 = 'mqtt.0.PLC55_Lighting.lighting.Kitchen_sec_top';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-telegram_bot-LC7" class="blob-code blob-code-inner js-file-line">const LIGHT6 = ' 2',    CH_LIGHT6 = 'mqtt.0.PLC55_Lighting.lighting.Kitchen_sec_bottom';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-telegram_bot-LC8" class="blob-code blob-code-inner js-file-line">const LIGHT7 = ' ',     CH_LIGHT7 = 'mqtt.0.PLC55_Lighting.lighting.BathRoom_main';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-telegram_bot-LC9" class="blob-code blob-code-inner js-file-line">const LIGHT8 = ' ',       CH_LIGHT8 = 'mqtt.0.PLC55_Lighting.lighting.Hall_main';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-telegram_bot-LC10" class="blob-code blob-code-inner js-file-line">const LIGHT9 = ' ',    CH_LIGHT9 = 'mqtt.0.PLC55_Lighting.lighting.Balcon_main';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-telegram_bot-LC11" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-telegram_bot-LC12" class="blob-code blob-code-inner js-file-line">//    </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-telegram_bot-LC13" class="blob-code blob-code-inner js-file-line">function sendLightMenu(message_text) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-telegram_bot-LC14" class="blob-code blob-code-inner js-file-line">	//   </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-telegram_bot-LC15" class="blob-code blob-code-inner js-file-line">    var l1 = getState(CH_LIGHT1).val ? 'üí°' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-telegram_bot-LC16" class="blob-code blob-code-inner js-file-line">    var l2 = getState(CH_LIGHT2).val ? 'üí°' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-telegram_bot-LC17" class="blob-code blob-code-inner js-file-line">    var l3 = getState(CH_LIGHT3).val ? 'üí°' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-telegram_bot-LC18" class="blob-code blob-code-inner js-file-line">    var l4 = getState(CH_LIGHT4).val ? 'üí°' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-telegram_bot-LC19" class="blob-code blob-code-inner js-file-line">    var l5 = getState(CH_LIGHT5).val ? 'üí°' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-telegram_bot-LC20" class="blob-code blob-code-inner js-file-line">    var l6 = getState(CH_LIGHT6).val ? 'üí°' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-telegram_bot-LC21" class="blob-code blob-code-inner js-file-line">    var l7 = getState(CH_LIGHT7).val ? 'üí°' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-telegram_bot-LC22" class="blob-code blob-code-inner js-file-line">    var l8 = getState(CH_LIGHT8).val ? 'üí°' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-telegram_bot-LC23" class="blob-code blob-code-inner js-file-line">    var l9 = getState(CH_LIGHT9).val ? 'üí°' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L24" class="blob-num js-line-number" data-line-number="24"></td>
        <td id="file-telegram_bot-LC24" class="blob-code blob-code-inner js-file-line">    // </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L25" class="blob-num js-line-number" data-line-number="25"></td>
        <td id="file-telegram_bot-LC25" class="blob-code blob-code-inner js-file-line">	sendTo('telegram.0', {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L26" class="blob-num js-line-number" data-line-number="26"></td>
        <td id="file-telegram_bot-LC26" class="blob-code blob-code-inner js-file-line">        text:   message_text,</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L27" class="blob-num js-line-number" data-line-number="27"></td>
        <td id="file-telegram_bot-LC27" class="blob-code blob-code-inner js-file-line">        reply_markup: {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L28" class="blob-num js-line-number" data-line-number="28"></td>
        <td id="file-telegram_bot-LC28" class="blob-code blob-code-inner js-file-line">            keyboard: [</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L29" class="blob-num js-line-number" data-line-number="29"></td>
        <td id="file-telegram_bot-LC29" class="blob-code blob-code-inner js-file-line">                [LIGHT1+l1, LIGHT2+l2, LIGHT3+l3],</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L30" class="blob-num js-line-number" data-line-number="30"></td>
        <td id="file-telegram_bot-LC30" class="blob-code blob-code-inner js-file-line">                [LIGHT4+l4, LIGHT5+l5, LIGHT6+l6],</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L31" class="blob-num js-line-number" data-line-number="31"></td>
        <td id="file-telegram_bot-LC31" class="blob-code blob-code-inner js-file-line">                [LIGHT7+l7, LIGHT8+l8, LIGHT9+l9]</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L32" class="blob-num js-line-number" data-line-number="32"></td>
        <td id="file-telegram_bot-LC32" class="blob-code blob-code-inner js-file-line">            ],</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L33" class="blob-num js-line-number" data-line-number="33"></td>
        <td id="file-telegram_bot-LC33" class="blob-code blob-code-inner js-file-line">            resize_keyboard:   true,</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L34" class="blob-num js-line-number" data-line-number="34"></td>
        <td id="file-telegram_bot-LC34" class="blob-code blob-code-inner js-file-line">            one_time_keyboard: true</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L35" class="blob-num js-line-number" data-line-number="35"></td>
        <td id="file-telegram_bot-LC35" class="blob-code blob-code-inner js-file-line">        }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L36" class="blob-num js-line-number" data-line-number="36"></td>
        <td id="file-telegram_bot-LC36" class="blob-code blob-code-inner js-file-line">    });</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L37" class="blob-num js-line-number" data-line-number="37"></td>
        <td id="file-telegram_bot-LC37" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L38" class="blob-num js-line-number" data-line-number="38"></td>
        <td id="file-telegram_bot-LC38" class="blob-code blob-code-inner js-file-line">//  </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L39" class="blob-num js-line-number" data-line-number="39"></td>
        <td id="file-telegram_bot-LC39" class="blob-code blob-code-inner js-file-line">function changeLight(room, channel) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L40" class="blob-num js-line-number" data-line-number="40"></td>
        <td id="file-telegram_bot-LC40" class="blob-code blob-code-inner js-file-line">	//   </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L41" class="blob-num js-line-number" data-line-number="41"></td>
        <td id="file-telegram_bot-LC41" class="blob-code blob-code-inner js-file-line">    var alive = getState("mqtt.0.info.connection").val;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L42" class="blob-num js-line-number" data-line-number="42"></td>
        <td id="file-telegram_bot-LC42" class="blob-code blob-code-inner js-file-line">    if (alive.includes("PLC55_Lighting")) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L43" class="blob-num js-line-number" data-line-number="43"></td>
        <td id="file-telegram_bot-LC43" class="blob-code blob-code-inner js-file-line">        if (getState(channel).val) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L44" class="blob-num js-line-number" data-line-number="44"></td>
        <td id="file-telegram_bot-LC44" class="blob-code blob-code-inner js-file-line">            setState(channel, false, false, function () {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L45" class="blob-num js-line-number" data-line-number="45"></td>
        <td id="file-telegram_bot-LC45" class="blob-code blob-code-inner js-file-line">                sendLightMenu(room+' ');</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L46" class="blob-num js-line-number" data-line-number="46"></td>
        <td id="file-telegram_bot-LC46" class="blob-code blob-code-inner js-file-line">            });</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L47" class="blob-num js-line-number" data-line-number="47"></td>
        <td id="file-telegram_bot-LC47" class="blob-code blob-code-inner js-file-line">        } else { </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L48" class="blob-num js-line-number" data-line-number="48"></td>
        <td id="file-telegram_bot-LC48" class="blob-code blob-code-inner js-file-line">            setState(channel, true, false, function () {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L49" class="blob-num js-line-number" data-line-number="49"></td>
        <td id="file-telegram_bot-LC49" class="blob-code blob-code-inner js-file-line">                sendLightMenu(room+' ');</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L50" class="blob-num js-line-number" data-line-number="50"></td>
        <td id="file-telegram_bot-LC50" class="blob-code blob-code-inner js-file-line">            });</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L51" class="blob-num js-line-number" data-line-number="51"></td>
        <td id="file-telegram_bot-LC51" class="blob-code blob-code-inner js-file-line">        }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L52" class="blob-num js-line-number" data-line-number="52"></td>
        <td id="file-telegram_bot-LC52" class="blob-code blob-code-inner js-file-line">    } else {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L53" class="blob-num js-line-number" data-line-number="53"></td>
        <td id="file-telegram_bot-LC53" class="blob-code blob-code-inner js-file-line">        sendLightMenu('  OFFLINE');</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L54" class="blob-num js-line-number" data-line-number="54"></td>
        <td id="file-telegram_bot-LC54" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L55" class="blob-num js-line-number" data-line-number="55"></td>
        <td id="file-telegram_bot-LC55" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L56" class="blob-num js-line-number" data-line-number="56"></td>
        <td id="file-telegram_bot-LC56" class="blob-code blob-code-inner js-file-line">//   request  ,    </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L57" class="blob-num js-line-number" data-line-number="57"></td>
        <td id="file-telegram_bot-LC57" class="blob-code blob-code-inner js-file-line">on({id: "telegram.0.communicate.request", ack: false, change: 'any'}, function (obj) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L58" class="blob-num js-line-number" data-line-number="58"></td>
        <td id="file-telegram_bot-LC58" class="blob-code blob-code-inner js-file-line">    var msg = obj.state.val;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L59" class="blob-num js-line-number" data-line-number="59"></td>
        <td id="file-telegram_bot-LC59" class="blob-code blob-code-inner js-file-line">    var command = obj.state.val.substring(obj.state.val.indexOf(']')+1);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L60" class="blob-num js-line-number" data-line-number="60"></td>
        <td id="file-telegram_bot-LC60" class="blob-code blob-code-inner js-file-line">    var user = obj.state.val.substring(obj.state.val.indexOf('[')+1,obj.state.val.indexOf(']'));</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L61" class="blob-num js-line-number" data-line-number="61"></td>
        <td id="file-telegram_bot-LC61" class="blob-code blob-code-inner js-file-line">    var chat_id = getState("telegram.0.communicate.requestChatId").val;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L62" class="blob-num js-line-number" data-line-number="62"></td>
        <td id="file-telegram_bot-LC62" class="blob-code blob-code-inner js-file-line">    var message_id = getState("telegram.0.communicate.requestMessageId").val;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L63" class="blob-num js-line-number" data-line-number="63"></td>
        <td id="file-telegram_bot-LC63" class="blob-code blob-code-inner js-file-line">    var handled = false;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L64" class="blob-num js-line-number" data-line-number="64"></td>
        <td id="file-telegram_bot-LC64" class="blob-code blob-code-inner js-file-line">    //     </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L65" class="blob-num js-line-number" data-line-number="65"></td>
        <td id="file-telegram_bot-LC65" class="blob-code blob-code-inner js-file-line">	if (command == '/start' || command == '/menu' || command == '' || command == '') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L66" class="blob-num js-line-number" data-line-number="66"></td>
        <td id="file-telegram_bot-LC66" class="blob-code blob-code-inner js-file-line">        sendLightMenu("");</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L67" class="blob-num js-line-number" data-line-number="67"></td>
        <td id="file-telegram_bot-LC67" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L68" class="blob-num js-line-number" data-line-number="68"></td>
        <td id="file-telegram_bot-LC68" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L69" class="blob-num js-line-number" data-line-number="69"></td>
        <td id="file-telegram_bot-LC69" class="blob-code blob-code-inner js-file-line">//######################## Lighting menu and commands ################</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L70" class="blob-num js-line-number" data-line-number="70"></td>
        <td id="file-telegram_bot-LC70" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT1 || command == LIGHT1+'üí°') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L71" class="blob-num js-line-number" data-line-number="71"></td>
        <td id="file-telegram_bot-LC71" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT1, CH_LIGHT1);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L72" class="blob-num js-line-number" data-line-number="72"></td>
        <td id="file-telegram_bot-LC72" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L73" class="blob-num js-line-number" data-line-number="73"></td>
        <td id="file-telegram_bot-LC73" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L74" class="blob-num js-line-number" data-line-number="74"></td>
        <td id="file-telegram_bot-LC74" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT2 || command == LIGHT2+'üí°') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L75" class="blob-num js-line-number" data-line-number="75"></td>
        <td id="file-telegram_bot-LC75" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT2, CH_LIGHT2);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L76" class="blob-num js-line-number" data-line-number="76"></td>
        <td id="file-telegram_bot-LC76" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L77" class="blob-num js-line-number" data-line-number="77"></td>
        <td id="file-telegram_bot-LC77" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L78" class="blob-num js-line-number" data-line-number="78"></td>
        <td id="file-telegram_bot-LC78" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT3 || command == LIGHT3+'üí°') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L79" class="blob-num js-line-number" data-line-number="79"></td>
        <td id="file-telegram_bot-LC79" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT3, CH_LIGHT3);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L80" class="blob-num js-line-number" data-line-number="80"></td>
        <td id="file-telegram_bot-LC80" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L81" class="blob-num js-line-number" data-line-number="81"></td>
        <td id="file-telegram_bot-LC81" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L82" class="blob-num js-line-number" data-line-number="82"></td>
        <td id="file-telegram_bot-LC82" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT4 || command == LIGHT4+'üí°') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L83" class="blob-num js-line-number" data-line-number="83"></td>
        <td id="file-telegram_bot-LC83" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT4, CH_LIHT4);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L84" class="blob-num js-line-number" data-line-number="84"></td>
        <td id="file-telegram_bot-LC84" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L85" class="blob-num js-line-number" data-line-number="85"></td>
        <td id="file-telegram_bot-LC85" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L86" class="blob-num js-line-number" data-line-number="86"></td>
        <td id="file-telegram_bot-LC86" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT5 || command == LIGHT5+'üí°') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L87" class="blob-num js-line-number" data-line-number="87"></td>
        <td id="file-telegram_bot-LC87" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT5, CH_LIGHT5);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L88" class="blob-num js-line-number" data-line-number="88"></td>
        <td id="file-telegram_bot-LC88" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L89" class="blob-num js-line-number" data-line-number="89"></td>
        <td id="file-telegram_bot-LC89" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L90" class="blob-num js-line-number" data-line-number="90"></td>
        <td id="file-telegram_bot-LC90" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT6 || command == LIGHT6+'üí°') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L91" class="blob-num js-line-number" data-line-number="91"></td>
        <td id="file-telegram_bot-LC91" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT6, CH_LIGHT6);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L92" class="blob-num js-line-number" data-line-number="92"></td>
        <td id="file-telegram_bot-LC92" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L93" class="blob-num js-line-number" data-line-number="93"></td>
        <td id="file-telegram_bot-LC93" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L94" class="blob-num js-line-number" data-line-number="94"></td>
        <td id="file-telegram_bot-LC94" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT7 || command == LIGHT7+'üí°') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L95" class="blob-num js-line-number" data-line-number="95"></td>
        <td id="file-telegram_bot-LC95" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT7, CH_LIGHT7);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L96" class="blob-num js-line-number" data-line-number="96"></td>
        <td id="file-telegram_bot-LC96" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L97" class="blob-num js-line-number" data-line-number="97"></td>
        <td id="file-telegram_bot-LC97" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L98" class="blob-num js-line-number" data-line-number="98"></td>
        <td id="file-telegram_bot-LC98" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT8 || command == LIGHT8+'üí°') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L99" class="blob-num js-line-number" data-line-number="99"></td>
        <td id="file-telegram_bot-LC99" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT8, CH_LIGHT8);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L100" class="blob-num js-line-number" data-line-number="100"></td>
        <td id="file-telegram_bot-LC100" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L101" class="blob-num js-line-number" data-line-number="101"></td>
        <td id="file-telegram_bot-LC101" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L102" class="blob-num js-line-number" data-line-number="102"></td>
        <td id="file-telegram_bot-LC102" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT9 || command == LIGHT9+'üí°') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L103" class="blob-num js-line-number" data-line-number="103"></td>
        <td id="file-telegram_bot-LC103" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT9, CH_LIGHT9);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L104" class="blob-num js-line-number" data-line-number="104"></td>
        <td id="file-telegram_bot-LC104" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L105" class="blob-num js-line-number" data-line-number="105"></td>
        <td id="file-telegram_bot-LC105" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L106" class="blob-num js-line-number" data-line-number="106"></td>
        <td id="file-telegram_bot-LC106" class="blob-code blob-code-inner js-file-line">	//       ,      text2command</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L107" class="blob-num js-line-number" data-line-number="107"></td>
        <td id="file-telegram_bot-LC107" class="blob-code blob-code-inner js-file-line">    if (!handled) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L108" class="blob-num js-line-number" data-line-number="108"></td>
        <td id="file-telegram_bot-LC108" class="blob-code blob-code-inner js-file-line">        sendTo('text2command.0', {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L109" class="blob-num js-line-number" data-line-number="109"></td>
        <td id="file-telegram_bot-LC109" class="blob-code blob-code-inner js-file-line">            text: command.replace(/\//g, '#').replace(/_/g, ' '),</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L110" class="blob-num js-line-number" data-line-number="110"></td>
        <td id="file-telegram_bot-LC110" class="blob-code blob-code-inner js-file-line">            id: chat_id,</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L111" class="blob-num js-line-number" data-line-number="111"></td>
        <td id="file-telegram_bot-LC111" class="blob-code blob-code-inner js-file-line">            user: user</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L112" class="blob-num js-line-number" data-line-number="112"></td>
        <td id="file-telegram_bot-LC112" class="blob-code blob-code-inner js-file-line">        }, function (response) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L113" class="blob-num js-line-number" data-line-number="113"></td>
        <td id="file-telegram_bot-LC113" class="blob-code blob-code-inner js-file-line">            if (response &amp;&amp; response.response) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L114" class="blob-num js-line-number" data-line-number="114"></td>
        <td id="file-telegram_bot-LC114" class="blob-code blob-code-inner js-file-line">                sendTo('telegram.0', {user: user, text: response.response});</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L115" class="blob-num js-line-number" data-line-number="115"></td>
        <td id="file-telegram_bot-LC115" class="blob-code blob-code-inner js-file-line">            }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L116" class="blob-num js-line-number" data-line-number="116"></td>
        <td id="file-telegram_bot-LC116" class="blob-code blob-code-inner js-file-line">        });</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L117" class="blob-num js-line-number" data-line-number="117"></td>
        <td id="file-telegram_bot-LC117" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L118" class="blob-num js-line-number" data-line-number="118"></td>
        <td id="file-telegram_bot-LC118" class="blob-code blob-code-inner js-file-line">});</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L119" class="blob-num js-line-number" data-line-number="119"></td>
        <td id="file-telegram_bot-LC119" class="blob-code blob-code-inner js-file-line">//   ,   </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L120" class="blob-num js-line-number" data-line-number="120"></td>
        <td id="file-telegram_bot-LC120" class="blob-code blob-code-inner js-file-line">on({id: /^mqtt\.0\.PLC55_Lighting\.lighting\..*$/, ack: true, change: 'ne'}, function (obj) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L121" class="blob-num js-line-number" data-line-number="121"></td>
        <td id="file-telegram_bot-LC121" class="blob-code blob-code-inner js-file-line">    sendLightMenu(" ");</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L122" class="blob-num js-line-number" data-line-number="122"></td>
        <td id="file-telegram_bot-LC122" class="blob-code blob-code-inner js-file-line">});</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L123" class="blob-num js-line-number" data-line-number="123"></td>
        <td id="file-telegram_bot-LC123" class="blob-code blob-code-inner js-file-line">//       </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L124" class="blob-num js-line-number" data-line-number="124"></td>
        <td id="file-telegram_bot-LC124" class="blob-code blob-code-inner js-file-line">sendLightMenu("");</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="" style="float:right">view raw</a>
        <a href="">telegram_bot</a>
        hosted with ‚ù§ by <a href="">GitHub</a>
      </div>
    </div>
</div>
</div><br><br>  El resultado deber√≠a ser algo como esto: <br><br><img src="https://habrastorage.org/webt/wm/kw/dj/wmkwdjedebx86h6ujqutsik93sa.png"><br><br><h4>  Conclusi√≥n </h4><br>  El art√≠culo result√≥ ser largo, pero espero que sea √∫til, y tal vez haga la vida m√°s f√°cil para algunos usuarios o aliente a alguien a crear su propia casa inteligente. <br>  Por el momento, mi sistema de hogar inteligente basado en ioBroker ha estado funcionando durante 4 a√±os y estoy bastante satisfecho con √©l.  Adem√°s de ZigBee, tambi√©n se conectan varios controladores caseros a trav√©s de MQTT y HTTP para controlar la iluminaci√≥n, la ventilaci√≥n y otros sistemas, una red de sensores de temperatura en el bus de 1 cable, un dispositivo de monitoreo de la fuente de alimentaci√≥n en el bus RS485 y el protocolo Modbus RTU, y mucho m√°s. <br><br>  En mi alcanc√≠a de soluciones para un hogar inteligente, he acumulado muchas ideas, aunque, probablemente, deber√≠an percibirse m√°s como una alcanc√≠a de problemas para un hogar inteligente (aquellos que entienden el tema sobre lo que quiero decir).  Deje sus deseos en los comentarios para ayudarme a decidir sobre el tema del pr√≥ximo art√≠culo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es433340/">https://habr.com/ru/post/es433340/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es433330/index.html">Resuelve crucigramas japoneses con SAT Solver</a></li>
<li><a href="../es433332/index.html">Soporte de Python en Azure Functions</a></li>
<li><a href="../es433334/index.html">Comportamientos XAML para WPF ahora es de c√≥digo abierto</a></li>
<li><a href="../es433336/index.html">La implementaci√≥n de la biblioteca babil√≥nica</a></li>
<li><a href="../es433338/index.html">Descripci√≥n general del fabricante de la impresora 3D Creality</a></li>
<li><a href="../es433342/index.html">Otro procesador simple de Verilog</a></li>
<li><a href="../es433344/index.html">Dos √©xitos del espacio privado.</a></li>
<li><a href="../es433346/index.html">Cambiar de Redshift a ClickHouse</a></li>
<li><a href="../es433348/index.html">DSL mecanografiado en TypeScript de JSX</a></li>
<li><a href="../es433350/index.html">Eventos digitales en Mosc√∫ del 17 al 23 de diciembre.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>