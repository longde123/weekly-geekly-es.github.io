<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖊️ 🤛🏽 👨🏼‍⚕️ IP-KVM via QEMU 🌿 👨🏿‍🚒 👨‍👧‍👧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pemecahan masalah saat memuat sistem operasi pada server tanpa KVM bukanlah tugas yang mudah. Kami membuat KVM-over-IP menggunakan gambar pemulihan da...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>IP-KVM via QEMU</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/464565/"><img src="https://habrastorage.org/webt/jr/rx/m6/jrrxm6jhxdczns-5x0qym8maw_u.png"><br><br>  Pemecahan masalah saat memuat sistem operasi pada server tanpa KVM bukanlah tugas yang mudah.  Kami membuat KVM-over-IP menggunakan gambar pemulihan dan mesin virtual. <br><br>  Jika terjadi masalah dengan sistem operasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pada server jarak jauh</a> , administrator mengunduh gambar pemulihan dan melakukan pekerjaan yang diperlukan.  Metode ini berfungsi dengan baik ketika penyebab kegagalan diketahui, dan gambar pemulihan dan sistem operasi yang diinstal pada server berasal dari keluarga yang sama.  Jika penyebab kegagalan belum diketahui, Anda harus memantau perkembangan pemuatan sistem operasi. <br><a name="habracut"></a><br><h2>  KVM jarak jauh </h2><br>  Anda dapat mengakses konsol server menggunakan alat bawaan seperti IPMI atau Intel® vPro ™, atau menggunakan perangkat eksternal yang disebut IP-KVMs.  Ada situasi di mana semua teknologi yang tercantum tidak tersedia.  Namun, ini bukan akhir.  Jika server dapat di-reboot dari jarak jauh menjadi gambar pemulihan berdasarkan sistem operasi Linux, maka Anda dapat dengan cepat mengatur KVM-over-IP. <br><br>  Gambar pemulihan adalah sistem operasi lengkap yang berada di RAM.  Dengan demikian, kita dapat menjalankan perangkat lunak apa pun, termasuk mesin virtual (VM).  Artinya, Anda dapat memulai VM, di mana sistem operasi server akan bekerja.  Akses ke konsol VM dapat diatur, misalnya, melalui VNC. <br><br>  Untuk memulai sistem operasi server di dalam VM, Anda harus menentukan disk server sebagai disk VM.  Pada sistem operasi keluarga Linux, disk fisik direpresentasikan sebagai perangkat blok dari form <b>/ dev / sdX</b> , yang dapat <b>ditangani</b> seperti file biasa. <br><br>  Beberapa hypervisor, seperti QEMU dan VirtualBox, memungkinkan Anda untuk menyimpan data VM dalam bentuk mentah, yaitu, hanya menyimpan data tanpa metadata hypervisor.  Dengan demikian, VM dapat mulai menggunakan disk fisik server. <br><br>  Metode ini membutuhkan sumber daya untuk menjalankan citra pemulihan dan VM di dalamnya.  Namun, dengan empat atau lebih gigabytes RAM, ini tidak akan menjadi masalah. <br><br><h2>  Persiapan lingkungan </h2><br>  Sebagai mesin virtual, Anda dapat menggunakan program <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">QEMU yang</a> ringan dan sederhana, yang paling sering bukan bagian dari gambar pemulihan, sehingga harus diinstal secara terpisah.  Gambar pemulihan yang kami tawarkan kepada pelanggan didasarkan pada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Arch Linux</a> , yang menggunakan manajer paket <b>pacman</b> . <br><br>  Pertama, Anda perlu memastikan bahwa gambar pemulihan menggunakan perangkat lunak terbaru.  Anda dapat memeriksa dan memperbarui semua komponen OS dengan perintah berikut: <br><br> <code>pacman -Suy</code> <br> <br>  Setelah pembaruan, Anda harus menginstal QEMU.  Perintah instalasi melalui pacman akan terlihat seperti ini: <br><br> <code>pacman -S qemu</code> <br> <br>  Periksa apakah qemu terinstal dengan benar: <br><br> <code>root@sel-rescue ~ # qemu-system-x86_64 --version <br> QEMU emulator version 4.0.0 <br> Copyright (c) 2003-2019 Fabrice Bellard and the QEMU Project developers</code> <br> <br>  Jika demikian, maka gambar pemulihan siap digunakan. <br><br><h2>  Startup mesin virtual </h2><br>  Pertama, Anda perlu menentukan jumlah sumber daya yang dialokasikan untuk VM, dan mencari tahu jalur ke disk fisik.  Dalam kasus kami, kami akan mengalokasikan dua core dan dua gigabytes RAM ke mesin virtual, dan disk berada di jalur <b>/ dev / sda</b> dan <b>/ dev / sdb</b> .  Jalankan VM: <br><br> <code>qemu-system-x86_64 \ <br> -m 2048M \ <br> -net nic -net user \ <br> -enable-kvm \ <br> -cpu host,nx \ <br> -M pc \ <br> -smp 2 \ <br> -vga std \ <br> -drive file=/dev/sda,format=raw,index=0,media=disk \ <br> -drive file=/dev/sdb,format=raw,index=1,media=disk \ <br> -vnc :0,password \ <br> -monitor stdio</code> <br> <br>  Sedikit lagi tentang arti setiap parameter: <br><br><ul><li>  <b>-m 2048M</b> - mengalokasikan 2 GB RAM per VM; </li><li>  <b>-net nic -net user</b> - menambahkan koneksi jaringan sederhana melalui hypervisor menggunakan NAT (Network Address Translation); </li><li>  <b>-enable-kvm</b> - <b>mengaktifkan</b> virtualisasi KVM penuh (Kernel Virtual Machine); </li><li>  <b>-cpu host</b> - beri tahu prosesor virtual untuk mendapatkan semua fungsi prosesor server; </li><li>  <b>-M pc</b> - jenis peralatan PC; </li><li>  <b>-smp 2</b> - prosesor virtual harus dual-core; </li><li>  <b>-vga std</b> - pilih kartu video standar yang tidak mendukung resolusi layar besar; </li><li>  <b>File -drive = / dev / sda, format = mentah, indeks = 0, media = disk</b> <br><ul><li>  <b>file = / dev / sdX</b> - path ke perangkat blok yang mewakili disk server; </li><li>  <b>format = raw</b> - tandai bahwa dalam file yang ditentukan semua data dalam bentuk "mentah", seperti pada disk; </li><li>  <b>index = 0</b> - nomor disk, harus bertambah untuk setiap disk berikutnya dengan satu; </li><li>  <b>media = disk</b> - mesin virtual harus mengenali penyimpanan ini sebagai disk; </li></ul></li><li>  <b>-vnc: 0, kata sandi</b> - jalankan server VNC default pada 0.0.0.0-05900, gunakan kata sandi sebagai otorisasi; </li><li>  <b>-monitor stdio</b> - administrator akan berkomunikasi dengan qemu melalui aliran input / output standar. </li></ul><br>  Jika semuanya beres, maka monitor QEMU akan mulai: <br><br> <code>QEMU 4.0.0 monitor - type 'help' for more information <br> (qemu)</code> <br> <br>  Kami menunjukkan bahwa otorisasi dilakukan dengan kata sandi, tetapi tidak menentukan kata sandi itu sendiri.  Anda dapat melakukan ini dengan mengirimkan perintah ubah kata sandi vnc ke monitor QEMU.  Catatan penting: kata sandi tidak boleh lebih dari delapan karakter. <br><br> <code>(qemu) change vnc password <br> Password: ******</code> <br> <br>  Setelah itu, kita dapat terhubung dengan klien VNC, misalnya, Remmina, dengan alamat IP server kami dengan kata sandi yang Anda tentukan. <br><br><img src="https://habrastorage.org/webt/hz/c8/gv/hzc8gv9gh83yjki7t3ycmiazdds.png" title="Parameter untuk menghubungkan melalui VNC"><br><br><img src="https://habrastorage.org/webt/um/qs/sh/umqsshwhmcbnd0c2uc_u0nte-la.png" title="Klien VNC membantu mencari tahu mengapa sistem operasi tidak bisa boot."><br><br>  Sekarang kita tidak hanya melihat kemungkinan kesalahan pada tahap pemuatan, tetapi kita juga bisa melawannya. <br><br>  Di akhir pekerjaan, Anda harus menyelesaikan mesin virtual.  Ini dapat dilakukan di dalam OS dengan <b>mengirimkan</b> sinyal shutdown, atau Anda dapat memberikan perintah <b>system_powerdown</b> ke monitor QEMU.  Ini akan setara dengan satu tekan tombol shutdown: sistem operasi di dalam mesin virtual akan dimatikan dengan lancar. <br><br><h2>  Instalasi sistem operasi </h2><br>  Mesin virtual memiliki akses penuh ke disk server dan karenanya dapat digunakan untuk menginstal sistem operasi secara manual.  Satu-satunya batasan adalah jumlah RAM: tidak selalu ISO-image dapat ditempatkan dalam RAM.  Kami memilih empat gigabytes RAM untuk menyimpan gambar di <b>/ mnt</b> : <br><br> <code>mount -t tmpfs -o size=4G tmpfs /mnt</code> <br> <br>  Kami juga memuat gambar instalasi sistem operasi FreeBSD 12.0: <br><br> <code>wget -P /mnt ftp://ftp.freebsd.org/pub/FreeBSD/releases/amd64/amd64/ISO-IMAGES/12.0/FreeBSD-12.0-RELEASE-amd64-bootonly.iso</code> <br> <br>  Sekarang Anda dapat memulai VM: <br><br> <code>qemu-system-x86_64 \ <br> -m 2048M \ <br> -net nic -net user \ <br> -enable-kvm \ <br> -cpu host,nx \ <br> -M pc \ <br> -smp 2 \ <br> -vga std \ <br> -drive file=/dev/sda,format=raw,index=0,media=disk \ <br> -drive file=/dev/sdb,format=raw,index=1,media=disk \ <br> -vnc :0,password \ <br> -monitor stdio \ <br> -cdrom /mnt/FreeBSD-12.0-RELEASE-amd64-bootonly.iso \ <br> -boot d <br></code> <br><br>  Bendera <b>-boot d</b> mengatur boot dari drive CD.  Kami terhubung oleh klien VNC dan kami melihat loader FreeBSD. <br><br><img src="https://habrastorage.org/webt/j4/jb/hh/j4jbhhidggiupbszepsduhffn0g.png" title="Bootloader FreeBSD."><br><br>  Karena DHCP digunakan untuk mengakses Internet, ada kemungkinan bahwa setelah konfigurasi akan diperlukan untuk mem-boot ke sistem yang baru diinstal dan memperbaiki pengaturan jaringan.  Dalam beberapa kasus, mungkin perlu menginstal driver adaptor jaringan, karena kartu jaringan yang dipasang di server dan ditiru dalam VM berbeda. <br><br><h2>  Kesimpulan </h2><br>  Metode pengorganisasian akses jarak jauh ke konsol server ini menghabiskan sebagian sumber daya server, namun, ini tidak memaksakan persyaratan khusus apa pun pada komponen perangkat keras server, dan karenanya dapat dilakukan di hampir semua kondisi.  Menggunakan solusi ini secara signifikan dapat memfasilitasi diagnosis kegagalan perangkat lunak dan memulihkan kesehatan server jauh. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id464565/">https://habr.com/ru/post/id464565/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id464555/index.html">Cara mudah untuk menghasilkan uang di Bug Bounty</a></li>
<li><a href="../id464557/index.html">XD Design Bobby Pro: Remake yang Kami Tunggu-nunggu</a></li>
<li><a href="../id464559/index.html">Fitur transportasi Universiade dan Alex yang sangat antusias</a></li>
<li><a href="../id464561/index.html">Menulis Aplikasi iOS Menggunakan Pola Redux</a></li>
<li><a href="../id464563/index.html">Keamanan informasi - apa yang perlu Anda ketahui dan dapat dianggap sebagai spesialis keamanan informasi yang baik?</a></li>
<li><a href="../id464571/index.html">Brain + VPS selama 30 rubel =?</a></li>
<li><a href="../id464579/index.html">Computer Vision Summer Camp - Intel Computer Vision Summer School</a></li>
<li><a href="../id464581/index.html">25 jenis "Caesar" dan kata-kata bahasa Inggris</a></li>
<li><a href="../id464583/index.html">Dataset 3D masif membantu robot memahami berbagai hal</a></li>
<li><a href="../id464591/index.html">Kimia ayam goreng. Analisis terperinci</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>