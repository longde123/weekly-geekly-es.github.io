<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤟 💅🏼 🥔 Datenbank in einem kommerziellen Projekt: Was tun? ☑️ 👨🏾‍🎓 👨🏾‍💼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Alles mit dem Ende der Ferien! ... Einige werden sagen, dass diese Glückwünsche so lala sind. Aber sicherlich werden viele bald Urlaub haben, also neh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Datenbank in einem kommerziellen Projekt: Was tun?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/microsoft/blog/413757/">  Alles mit dem Ende der Ferien! ... Einige werden sagen, dass diese Glückwünsche so lala sind.  Aber sicherlich werden viele bald Urlaub haben, also nehmen Sie sich etwas mehr Zeit.  Nun, wir verlieren nicht an Dynamik und teilen an diesem warmen Tag die Erfahrungen unserer Partner.  Es geht darum, die Arbeit mit der Datenbank zu optimieren.  Weitere Details unter dem Schnitt! <br><br><img src="https://habrastorage.org/webt/ea/ms/5v/eams5vve4rwkpzitmhnv4bl0-ki.jpeg"><a name="habracut"></a><br><br>  <i>Ich gebe dem Autor das Wort.</i> <br><br>  Wir begrüßen Sie, Leser von Habr!  Wir sind das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">WaveAccess-</a> Team. In diesem Artikel werden wir Ihnen die Erfahrungen mit der Verwendung des Azure Cosmos DB-Datenbankdienstes (DB) in einem kommerziellen Projekt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">mitteilen</a> .  Wir werden Ihnen erklären, warum die Datenbank vorgesehen ist und mit welchen Nuancen wir uns während der Entwicklung auseinandersetzen mussten. <br><br><h2>  Was ist Azure Cosmos DB? </h2><br>  Azure Cosmos DB ist ein kommerzieller, global verteilter Datenbankdienst mit einem Paradigma für mehrere Modelle, der als PaaS-Lösung bereitgestellt wird.  Sie ist die nächste Generation von Azure DocumentDB. <br><br>  Die Datenbank wurde 2017 von Microsoft unter Beteiligung von Leslie Lamport, Ph.D. in Computer Science, entwickelt (Turing-Preisträger 2013 für einen grundlegenden Beitrag zur Theorie verteilter Systeme, LaTex-Entwickler, Entwickler der TLA + -Spezifikation). <br><br>  Die Hauptmerkmale von Azure Cosmos DB sind: <br><br><ul><li>  Nicht relationale Datenbank; </li><li>  Die darin enthaltenen Dokumente werden als JSON gespeichert. </li><li>  Horizontale Skalierung mit einer Auswahl geografischer Regionen; <br><br><img src="https://habrastorage.org/webt/nl/dy/3g/nldy3g3u0sgafl2hucspvk5bcdc.jpeg"><br><br></li><li>  Datenparadigma für mehrere Modelle: Schlüsselwert, Dokument, Diagramm, Spaltenfamilie; </li><li>  Geringe Latenz für 99% der Anforderungen: weniger als 10 ms für Leseoperationen und weniger als 15 ms für (indizierte) Schreiboperationen; </li><li>  Entwickelt für hohen Durchsatz; </li><li>  Es garantiert Verfügbarkeit, Datenkonsistenz und Latenz auf SLA-Ebene von 99,999%. </li><li>  Konfigurierbare Bandbreite </li><li>  Automatische Replikation (Master-Slave); </li><li>  Automatische Indizierung von Daten; </li><li>  Anpassbare Datenkonsistenzstufen.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">5 verschiedene Ebenen</a> (Stark, Begrenzte Stalenität, Sitzung, Konsistentes Präfix, Eventuell); </li></ul><br>  In der Grafik sehen Sie die Abhängigkeit verschiedener Konsistenzstufen von der Verfügbarkeit, Leistung und Konsistenz von Daten. <br><br><img src="https://habrastorage.org/webt/aj/mn/3a/ajmn3abjqxczqnngqpexk7hrdfu.jpeg"><br><br><ul><li>  Für den bequemen Übergang von der Datenbank zu Cosmos DB gibt es viele APIs für den Zugriff auf Daten: SQL, JavaScript, Gremlin, MongoDB, Cassandra, Azure Blob; </li><li>  Anpassbare Firewall; </li><li>  Benutzerdefinierte Datenbankgröße. </li></ul><br><h2>  Die Aufgabe, die wir gelöst haben </h2><br>  Tausende von Sensoren auf der ganzen Welt übertragen alle paar N Sekunden Informationen (im Folgenden: Benachrichtigungen).  Diese Benachrichtigungen müssen in der Datenbank gespeichert und dann gesucht und in der Benutzeroberfläche des Systembetreibers angezeigt werden. <br><br>  Kundenanforderungen: <br><br><ul><li>  Verwenden eines Stapels von Microsoft-Technologien, einschließlich der Azure-Cloud; </li><li>  Durchsatz von 100 Anfragen pro Sekunde; </li><li>  Benachrichtigungen haben keine klare Struktur und könnten weiter ausgebaut werden. </li><li>  Für kritische Benachrichtigungen ist die Verarbeitungsgeschwindigkeit wichtig. </li><li>  Hohe Systemstabilität. </li></ul><br>  Basierend auf den Kundenanforderungen wurden wir idealerweise von einer nicht relationalen, global verteilten, zuverlässigen kommerziellen Datenbank angesprochen. <br><br><img src="https://habrastorage.org/webt/x8/fe/no/x8fenovzxodrhh7fvpxqvpjtrcg.jpeg"><br><br>  Wenn wir uns Datenbanken ansehen, die Cosmos DB ähnlich sind, können wir uns an Amazon DynamoDB, Google Cloud Spanner, erinnern.  Amazon DynamoDB ist jedoch nicht global verteilt, und Google Cloud Spanner weist weniger Konsistenzstufen und Datenmodelltypen auf (nur tabellarisch, relational). <br><br>  Aus diesen Gründen haben wir uns für Azure Cosmos DB entschieden.  Für die Interaktion mit der Datenbank haben wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">das Azure Cosmos DB SDK für .NET verwendet</a> , da das Backend in .NET geschrieben wurde. <br><br><h2>  Die Nuancen, denen wir begegnet sind </h2><br>  <b>1. Datenbankverwaltung</b> <br><br>  Um die Datenbank verwenden zu können, müssen Sie zunächst ein Tool zur Verwaltung auswählen.  Wir haben Azure Cosmos DB Data Explorer im Azure-Portal und im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DocumentDbExplorer verwendet</a> .  Es gibt auch ein Azure Storage Explorer-Dienstprogramm. <br><br><img src="https://habrastorage.org/webt/rc/pv/wo/rcpvwozefe9cykihsulmvtmmxgs.jpeg"><br><br>  <b>2. Einrichten von Datenbanksammlungen</b> <br><br>  In Cosmos DB besteht jede Datenbank aus Sammlungen und Dokumenten. <br><br>  Anpassbare Sammlungsfunktionen, auf die Sie achten sollten: <br><br><ul><li>  Sammlungsgröße: fest oder unbegrenzt; </li><li>  Bandbreite in Einheiten von Anforderungen pro Sekunde RU / s (ab 400 RU / s); <br><br><img src="https://habrastorage.org/webt/i3/pk/xt/i3pkxtag0v2kvwtjyuclvhzoojk.jpeg"><br><br></li><li>  Indizierungsrichtlinie (einschließlich oder ausgenommen Dokumente und Pfade zum und vom Index, Einrichten verschiedener Indextypen, Einrichten von Indexaktualisierungsmodi). </li></ul><br>  Typisches Indexbeispiel <br><br><pre><code class="cs hljs">{ <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"datas"</span></span>, <span class="hljs-string"><span class="hljs-string">"indexingPolicy"</span></span>: { <span class="hljs-string"><span class="hljs-string">"indexingMode"</span></span>: <span class="hljs-string"><span class="hljs-string">"consistent"</span></span>, <span class="hljs-string"><span class="hljs-string">"automatic"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"includedPaths"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"/*"</span></span>, <span class="hljs-string"><span class="hljs-string">"indexes"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"kind"</span></span>: <span class="hljs-string"><span class="hljs-string">"Range"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>: <span class="hljs-string"><span class="hljs-string">"Number"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>: <span class="hljs-number"><span class="hljs-number">-1</span></span> }, { <span class="hljs-string"><span class="hljs-string">"kind"</span></span>: <span class="hljs-string"><span class="hljs-string">"Hash"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>: <span class="hljs-string"><span class="hljs-string">"String"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"kind"</span></span>: <span class="hljs-string"><span class="hljs-string">"Spatial"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>: <span class="hljs-string"><span class="hljs-string">"Point"</span></span> } ] } ], <span class="hljs-string"><span class="hljs-string">"excludedPaths"</span></span>: [] } }</code> </pre> <br>  Damit die Teilstringsuche funktioniert, müssen Sie für Zeichenfolgenfelder den Hash-Index verwenden ("kind": "Hash"). <br><br>  <b>3. Datenbanktransaktionen</b> <br><br>  Transaktionen werden in der Datenbank auf der Ebene gespeicherter Prozeduren implementiert (das Ausführen einer gespeicherten Prozedur ist eine atomare Operation).  Gespeicherte JavaScript-Prozeduren <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> helloWorldStoredProc = { id: <span class="hljs-string"><span class="hljs-string">"helloWorld"</span></span>, body: function () { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> context = getContext(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> response = context.getResponse(); response.setBody(<span class="hljs-string"><span class="hljs-string">"Hello, World"</span></span>); } }</code> </pre> <br>  <b>4. Datenbankwechselkanal</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Feed ändern</a> hört Änderungen in der Sammlung.  Wenn Änderungen an Sammlungsdokumenten vorgenommen werden, löst die Datenbank ein Ereignis über Änderungen an allen Abonnenten dieses Kanals aus. <br><br>  Wir haben Change Feed verwendet, um Änderungen an der Sammlung zu verfolgen.  Beim Erstellen eines Kanals müssen Sie zunächst eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AUX-Hilfssammlung</a> erstellen, die die Verarbeitung des Änderungskanals für mehrere Arbeitsrollen koordiniert. <br><br>  <b>5. Datenbankbeschränkungen:</b> <br><br><ul><li>  Fehlende <a href="">Massenoperationen</a> (verwendete gespeicherte Prozeduren zum <a href="">Löschen von Massen</a> , Aktualisieren von Dokumenten); </li><li>  Fehlende teilweise Aktualisierung des Dokuments; </li><li>  Keine SKIP-Operation (Komplexität der Paginierungsimplementierung).  Um die Paginierung in Benachrichtigungsanforderungen zu implementieren, haben wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RequestContinuation</a> (Link zum letzten Element als Ergebnis der Ausgabe) und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MaxItemCount</a> (Anzahl der von der Datenbank zurückgegebenen Elemente) verwendet.  Standardmäßig werden die Ergebnisse stapelweise zurückgegeben (nicht mehr als 100 Artikel und nicht mehr als 1 MB in jedem Paket).  Die Anzahl der zurückgegebenen Artikel kann mit dem Parameter MaxItemCount auf 1000 erhöht werden. </li></ul><br>  <b>6. Verarbeitung des 429. Datenbankfehlers</b> <br><br>  Wenn die Erfassungsbandbreite ihr Maximum erreicht, generiert die Datenbank den Fehler "429 Too Many Request".  Um dies zu verarbeiten, können Sie die Einstellung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RetryOptions</a> im SDK verwenden, wobei MaxRetryAttemptOnThrottledRequests die Anzahl der Versuche zum Abschließen der Anforderung und MaxRetryWaitTimeInSeconds die Gesamtzeit der Verbindungsversuche ist. <br><br>  <b>7. Prognose der Kosten für die Nutzung der Datenbank</b> <br><br>  Um die Kosten für die Nutzung der Datenbank vorherzusagen, haben wir den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Online-Rechner</a> RU / s verwendet.  Im Basisplan entspricht eine Anforderungseinheit für ein Element von 1 KB einem einfachen GET-Befehl durch eine Verknüpfung mit sich selbst oder der Kennung dieses Elements. <br><br><h2>  Schlussfolgerungen </h2><br>  Azure Cosmos DB ist einfach zu verwenden, einfach und flexibel über das Azure-Portal zu konfigurieren.  Die vielen Datenzugriffs-APIs erleichtern die Migration zu Cosmos DB.  Sie müssen keinen Datenbankadministrator beauftragen, um die Datenbank zu verwalten.  SLA-Finanzgarantien und globale horizontale Skalierung machen diese Datenbank auf dem Markt sehr attraktiv.  Es eignet sich für den Einsatz in Unternehmen und globalen Anwendungen, die hohe Anforderungen an Fehlertoleranz und Bandbreite stellen.  Wir bei WaveAccess verwenden Cosmos DB weiterhin in unseren Projekten. <br><br><h2>  Über den Autor </h2><br>  Das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">WaveAccess-</a> Team erstellt technisch anspruchsvolle, hoch geladene und fehlertolerante Software für Unternehmen auf der ganzen Welt.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Alexander Azarov</a> , Senior Vice President für Softwareentwicklung bei WaveAccess, kommentiert: <br><br><blockquote>  Auf den ersten Blick können schwierige Aufgaben mit relativ einfachen Methoden gelöst werden.  Es ist wichtig, nicht nur neue Werkzeuge zu erlernen, sondern auch das Wissen über bekannte Technologien zu perfektionieren. </blockquote><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Firmenblog</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de413757/">https://habr.com/ru/post/de413757/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de413745/index.html">Für alle elektronischen Geräte im menschlichen Körper wurde gleichzeitig ein drahtloses Stromversorgungssystem entwickelt</a></li>
<li><a href="../de413747/index.html">NULL durchlaufen</a></li>
<li><a href="../de413749/index.html">B + Baum in einem realen Projekt</a></li>
<li><a href="../de413751/index.html">Ruslan Cheremin und Maxim Gramin - arbeiten mit der Umwelt auf jug.msk.ru</a></li>
<li><a href="../de413753/index.html">Auge in den Himmel: Patrouillendrohne mit Anerkennung von Gewalt in Menschenmengen und an öffentlichen Orten</a></li>
<li><a href="../de413759/index.html">Neugierde entdeckte organische Stoffe auf dem Milliarden Jahre alten Mars</a></li>
<li><a href="../de413761/index.html">So verhindern Sie, dass Windows 10 nach Updates neu gestartet wird</a></li>
<li><a href="../de413763/index.html">Was wir im Mai gelesen haben: Ivy-Rezensionen, Nest 5-Version und andere nützliche Texte für Angular-Entwickler</a></li>
<li><a href="../de413765/index.html">Verantwortungskette in variablen C ++ - Vorlagen</a></li>
<li><a href="../de413767/index.html">Der kanadische PRNG-Experte kritisiert Behörden für die Verwendung alter Excel-Algorithmen zum Zeichnen von Visa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>