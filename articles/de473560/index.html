<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🤝‍👩🏼 🐽 🧔🏾 Erstellen einer REST-API mit Node.js und einer Oracle-Datenbank. Teil 4 👐🏼 🤪 👩🏾‍✈️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Teil 4. Erstellen einer REST-API: Behandeln von POST-, PUT- und DELETE-Anforderungen 

 Im vorherigen Artikel haben Sie der API Logik für GET-Anforder...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Erstellen einer REST-API mit Node.js und einer Oracle-Datenbank. Teil 4</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473560/">  <b>Teil 4. Erstellen einer REST-API: Behandeln von POST-, PUT- und DELETE-Anforderungen</b> <br><br>  Im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorherigen Artikel haben</a> Sie der API Logik für GET-Anforderungen hinzugefügt, mit denen Daten aus einer Datenbank abgerufen wurden.  In diesem Beitrag vervollständigen Sie die Grundfunktionen der CRUD-API, indem Sie Logik hinzufügen, um POST-, PUT- und DELETE-Anforderungen zu verarbeiten. <br><a name="habracut"></a><br>  <b>Routing-Logik hinzufügen</b> <br><br>  Um die Routing-Logik zu vereinfachen, leiten Sie alle HTTP-Methoden über eine vorhandene Route um (mit einem optionalen ID-Parameter).  Öffnen Sie die <b>Datei services / router.js</b> und ersetzen Sie die aktuelle Routing-Logik (Zeilen 5-6) durch den folgenden Code: <br><br><pre><code class="javascript hljs">router.route(<span class="hljs-string"><span class="hljs-string">'/employees/:id?'</span></span>) .get(employees.get) .post(employees.post) .put(employees.put) .delete(employees.delete);</code> </pre> <br>  Die aktualisierte Routing-Logik ordnet die vier am häufigsten verwendeten HTTP-Methoden für grundlegende CRUD-Operationen der richtigen Controller-Logik zu. <br><br>  <b>POST-Anforderungsverarbeitung</b> <br><br>  HTTP-POST-Anforderungen werden zum Erstellen neuer Ressourcen verwendet (in diesem Fall Mitarbeiterdatensätze).  Die Hauptidee besteht darin, Daten aus dem Hauptteil der HTTP-Anforderung zu extrahieren und daraus eine neue Zeile in der Datenbank zu erstellen.  Öffnen Sie zum Hinzufügen der Controller-Logik für POST-Anforderungen die Datei <b>controller / employee.js</b> und fügen Sie den folgenden Code hinzu: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getEmployeeFromRec</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> employee = { <span class="hljs-attr"><span class="hljs-attr">first_name</span></span>: req.body.first_name, <span class="hljs-attr"><span class="hljs-attr">last_name</span></span>: req.body.last_name, <span class="hljs-attr"><span class="hljs-attr">email</span></span>: req.body.email, <span class="hljs-attr"><span class="hljs-attr">phone_number</span></span>: req.body.phone_number, <span class="hljs-attr"><span class="hljs-attr">hire_date</span></span>: req.body.hire_date, <span class="hljs-attr"><span class="hljs-attr">job_id</span></span>: req.body.job_id, <span class="hljs-attr"><span class="hljs-attr">salary</span></span>: req.body.salary, <span class="hljs-attr"><span class="hljs-attr">commission_pct</span></span>: req.body.commission_pct, <span class="hljs-attr"><span class="hljs-attr">manager_id</span></span>: req.body.manager_id, <span class="hljs-attr"><span class="hljs-attr">department_id</span></span>: req.body.department_id }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> employee; } <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">post</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res, next</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> employee = getEmployeeFromRec(req); employee = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> employees.create(employee); res.status(<span class="hljs-number"><span class="hljs-number">201</span></span>).json(employee); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { next(err); } } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.post = post;</code> </pre> <br>  Die Funktion getEmployeeFromRec nimmt ein Anforderungsobjekt und gibt ein Objekt mit den Eigenschaften zurück, die zum Erstellen eines Mitarbeiterdatensatzes erforderlich sind.  Die Funktion wurde außerhalb der Post-Funktion deklariert, damit sie später für PUT-Anforderungen verwendet werden kann. <br><br>  Die Post-Funktion initialisiert die Variable mit getEmployeeFromRec, die dann an die create-Methode der Mitarbeiterdatenbank-API übergeben wird.  Nach dem Erstellungsvorgang wird der Statuscode „201 Erstellt“ zusammen mit dem Mitarbeiter-JSON (einschließlich des neuen Werts der Mitarbeiter-ID) an den Client gesendet. <br><br>  Jetzt können Sie auf die Logik in der Datenbank-API achten.  Öffnen Sie die Datei <b>db_apis / employee.js</b> und fügen Sie den folgenden Code hinzu. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createSql = <span class="hljs-string"><span class="hljs-string">`insert into employees ( first_name, last_name, email, phone_number, hire_date, job_id, salary, commission_pct, manager_id, department_id ) values ( :first_name, :last_name, :email, :phone_number, :hire_date, :job_id, :salary, :commission_pct, :manager_id, :department_id ) returning employee_id into :employee_id`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">emp</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> employee = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign({}, emp); employee.employee_id = { <span class="hljs-attr"><span class="hljs-attr">dir</span></span>: oracledb.BIND_OUT, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: oracledb.NUMBER } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> database.simpleExecute(createSql, employee); employee.employee_id = result.outBinds.employee_id[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> employee; } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.create = create;</code> </pre> <br>  Die obige Logik deklariert zunächst eine Konstante mit dem Namen createSql, um die insert-Anweisung zu speichern.  Beachten Sie, dass <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bindungsvariablen</a> und keine Zeichenfolgenverkettung verwendet werden, um auf die einzufügenden Werte zu verweisen.  Es lohnt sich zu wiederholen, wie wichtig Bindevariablen aus Sicherheits- und Leistungsgründen sind.  Vermeiden Sie nach Möglichkeit die Verkettung von Zeichenfolgen. <br><br>  Innerhalb der Funktion create wird die Mitarbeiterkonstante für eine Kopie des Parameters emp mit Object.assign definiert und initialisiert.  Dies verhindert eine direkte Änderung des von der Steuerung übertragenen Objekts. <br><br>  Anschließend wird die Eigenschaft employee_id zum Mitarbeiterobjekt hinzugefügt (konfiguriert als "out bind"), sodass sie alle Bindungsvariablen enthält, die zum Ausführen der SQL-Anweisung erforderlich sind.  Anschließend wird die Funktion insertExecute mit der Funktion simpleExecute ausgeführt, und mit der Eigenschaft outBinds wird die Eigenschaft employee.employee_id überschrieben, bevor das Objekt zurückgegeben wird. <br><br>  Da es einen Link zum oracledb-Modul gibt, müssen Sie die folgende Zeile oben in die Datei einfügen. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> oracledb = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'oracledb'</span></span>);</code> </pre> <br><br>  <b>PUT-Anforderungsverarbeitung</b> <br><br>  PUT-Anforderungen werden verwendet, um vorhandene Ressourcen zu aktualisieren.  Es ist wichtig zu beachten, dass PUT verwendet wird, um die gesamte Ressource zu ersetzen - es werden keine Teilaktualisierungen durchgeführt (ich werde Ihnen zeigen, wie dies in Zukunft mit PATCH gemacht wird).  Kehren Sie zur Datei <b>controller / employee.js zurück</b> und fügen Sie den folgenden Code hinzu. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">put</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res, next</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> employee = getEmployeeFromRec(req); employee.employee_id = <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(req.params.id, <span class="hljs-number"><span class="hljs-number">10</span></span>); employee = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> employees.update(employee); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (employee !== <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { res.status(<span class="hljs-number"><span class="hljs-number">200</span></span>).json(employee); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { res.status(<span class="hljs-number"><span class="hljs-number">404</span></span>).end(); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { next(err); } } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.put = put;</code> </pre> <br>  Die put-Funktion verwendet getEmployeeFromRec, um ein Objekt mit dem Namen employee zu initialisieren, und fügt dann der URL die Eigenschaft employee_id aus dem Parameter id hinzu.  Anschließend wird das Mitarbeiterobjekt an die Datenbank-API-Aktualisierungsfunktion übergeben und die entsprechende Antwort basierend auf dem Ergebnis an den Client gesendet. <br><br>  <b>Fügen Sie der</b> Datei <b>db_apis / employee.js</b> den folgenden Code hinzu, um die Aktualisierungslogik zur Datenbank-API hinzuzufügen. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> updateSql = <span class="hljs-string"><span class="hljs-string">`update employees set first_name = :first_name, last_name = :last_name, email = :email, phone_number = :phone_number, hire_date = :hire_date, job_id = :job_id, salary = :salary, commission_pct = :commission_pct, manager_id = :manager_id, department_id = :department_id where employee_id = :employee_id`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">emp</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> employee = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign({}, emp); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> database.simpleExecute(updateSql, employee); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.rowsAffected &amp;&amp; result.rowsAffected === <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> employee; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.update = update;</code> </pre> <br>  Die Aktualisierungslogik ist der Erstellungslogik sehr ähnlich.  Eine Variable wird deklariert, um die SQL-Anweisung zu speichern, und dann wird simpleExecute verwendet, um die Anweisung mit den übertragenen dynamischen Werten auszuführen (nachdem sie in ein anderes Objekt kopiert wurden).  Mit result.rowsAffected wird festgestellt, ob die Aktualisierung erfolgreich war, und der richtige Wert zurückgegeben. <br><br>  <b>Anforderungsverarbeitung LÖSCHEN</b> <br><br>  Die letzte Methode, die Sie implementieren müssen, ist DELETE, mit der überraschenderweise Ressourcen aus der Datenbank entfernt werden.  Fügen Sie den folgenden Code am Ende der Datei <b>controller / employee.js hinzu.</b> <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">del</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res, next</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(req.params.id, <span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> success = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> employees.delete(id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (success) { res.status(<span class="hljs-number"><span class="hljs-number">204</span></span>).end(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { res.status(<span class="hljs-number"><span class="hljs-number">404</span></span>).end(); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { next(err); } } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.delete = del;</code> </pre> <br>  Die JavaScript-Engine löst eine Ausnahme aus, wenn Sie versuchen, eine Funktion namens "delete" mit dem Funktionsoperator zu deklarieren.  Um dies zu umgehen, wird eine Funktion mit dem Namen "del" deklariert und dann als "delete" exportiert. <br><br>  An diesem Punkt sollten Sie in der Lage sein, Logik zu lesen und zu verstehen.  Im Gegensatz zu den vorherigen Beispielen hat diese HTTP-Anforderung keinen Textkörper. Im Routenpfad wird nur der Parameter id verwendet.  Der Statuscode „204 No Content“ wird häufig bei DELETE-Anforderungen verwendet, wenn der Antworttext nicht gesendet wird. <br><br>  Um die Datenbanklogik zu vervollständigen, <b>kehren Sie zur</b> Datei <b>db_apis / employee.js zurück</b> und fügen Sie am Ende den folgenden Code hinzu. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> deleteSql = <span class="hljs-string"><span class="hljs-string">`begin delete from job_history where employee_id = :employee_id; delete from employees where employee_id = :employee_id; :rowcount := sql%rowcount; end;`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">del</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> binds = { <span class="hljs-attr"><span class="hljs-attr">employee_id</span></span>: id, <span class="hljs-attr"><span class="hljs-attr">rowcount</span></span>: { <span class="hljs-attr"><span class="hljs-attr">dir</span></span>: oracledb.BIND_OUT, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: oracledb.NUMBER } } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> database.simpleExecute(deleteSql, binds); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result.outBinds.rowcount === <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.delete = del;</code> </pre> <br>  Da die Tabelle JOB_HISTORY eine Fremdschlüsseleinschränkung aufweist, die auf die Tabelle EMPLOYEES verweist, wird ein einfacher PL / SQL-Block verwendet, um die erforderlichen Zeilen in einem einzigen Zyklus aus beiden Tabellen zu entfernen. <br><br>  <b>Analysieren von JSON-Anforderungen</b> <br><br>  Wenn Sie sich die Funktion getEmployeeFromRec in controller / employee.js ansehen, werden Sie feststellen, dass die Eigenschaft des Anfragetexts ein JavaScript-Objekt ist.  Dies bietet eine einfache Möglichkeit, Werte aus dem Anforderungshauptteil abzurufen, dies geschieht jedoch nicht automatisch. <br><br>  Die von Ihnen erstellte API erwartet, dass Clients Daten im JSON-Format im Hauptteil der POST- und PUT-Anforderungen senden.  Darüber hinaus sollten Clients den Content-Type-Header der Anforderung auf application / json setzen, damit der Webserver weiß, welcher Typ von Anforderungshauptteil gesendet wird.  Sie können die integrierte Middleware express.json verwenden, damit Express solche Anforderungen analysieren kann. <br><br>  Öffnen Sie die <b>Datei services / web-server.js</b> und fügen Sie die folgenden Zeilen direkt unter dem Aufruf von app.use hinzu, wodurch der Anforderungspipeline Morgan hinzugefügt wird. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Parse incoming JSON requests and revive JSON. app.use(express.json({ reviver: reviveJson }));</span></span></code> </pre> <br>  Wenn JSON-Daten in native JavaScript-Objekte analysiert werden, werden nur die in JSON unterstützten Datentypen korrekt JavaScript-Typen zugeordnet.  Daten werden in JSON nicht unterstützt und normalerweise als ISO 8601-Zeichenfolgen dargestellt. Mit der an die Express.json-Middleware übergebenen Reviver-Funktion können Sie die Konvertierung manuell durchführen.  Fügen Sie den folgenden Code am Ende der <b>Datei services / web-server.js hinzu</b> . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> iso8601RegExp = <span class="hljs-regexp"><span class="hljs-regexp">/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{3})?Z$/</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reviveJson</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key, value</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// revive ISO 8601 date strings to instances of Date if (typeof value === 'string' &amp;&amp; iso8601RegExp.test(value)) { return new Date(value); } else { return value; } }</span></span></code> </pre> <br>  <b>API-Tests</b> <br><br>  Es ist Zeit, die neue CRUD-Funktionalität zu testen!  Bisher haben Sie den Browser zum Testen der API verwendet, dies funktioniert jedoch nicht für POST-, PUT- und DELETE-Anforderungen.  Ich werde Ihnen zeigen, wie Sie die API mit Curl-Befehlen testen, da sie in einer virtuellen Maschine leicht zugänglich ist.  Sie können jedoch ein grafisches Tool wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Postman</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Insomina</a> (kostenlos) verwenden. <br><br>  Starten Sie die Anwendung, öffnen Sie ein anderes Terminalfenster und führen Sie den folgenden Befehl aus, um einen neuen Mitarbeiter zu erstellen. <br><br><pre> <code class="javascript hljs">curl -X <span class="hljs-string"><span class="hljs-string">"POST"</span></span> <span class="hljs-string"><span class="hljs-string">"http://localhost:3000/api/employees"</span></span> \ -i \ -H <span class="hljs-string"><span class="hljs-string">'Content-Type: application/json'</span></span> \ -d $<span class="hljs-string"><span class="hljs-string">'{ "first_name": "Dan", "last_name": "McGhan", "email": "dan@fakemail.com", "job_id": "IT_PROG", "hire_date": "2014-12-14T00:00:00.000Z", "phone_number": "123-321-1234" }'</span></span></code> </pre> <br>  Wenn die Anforderung erfolgreich war, muss die Antwort ein Mitarbeiterobjekt mit dem Attribut employee_id enthalten.  Hier ist ein Beispiel: <br><br><img src="https://habrastorage.org/webt/7w/au/vk/7wauvk6m-ypdscfrwsciifabg9m.png" alt="Bild"><br><br>  In meinem Fall war der Wert von employee_id 227 - Sie müssen die folgenden Befehle basierend auf dem empfangenen Wert von employee_id ändern. <br><br>  Um beispielsweise einen neuen Eintrag zu aktualisieren, geben Sie PUT für die URL mit diesem Bezeichnerwert ein. <br><br><pre> <code class="javascript hljs">curl -X <span class="hljs-string"><span class="hljs-string">"PUT"</span></span> <span class="hljs-string"><span class="hljs-string">"http://localhost:3000/api/employees/227"</span></span> \ -i \ -H <span class="hljs-string"><span class="hljs-string">'Content-Type: application/json'</span></span> \ -d $<span class="hljs-string"><span class="hljs-string">'{ "first_name": "Dan", "last_name": "McGhan", "email": "dan@fakemail.com", "job_id": "AD_PRES", "hire_date": "2014-12-14T00:00:00.000Z", "phone_number": "123-321-1234" }'</span></span></code> </pre> <br>  Der UPDATE_JOB_HISTORY-Trigger im HR-Schema erkennt eine Jobänderung und fügt der Tabelle JOB_HISTORY eine Zeile hinzu.  Wenn Sie sich diese Tabelle ansehen, sollten Sie einen Datensatz für den neuen Mitarbeiter sehen.  Führen Sie den folgenden Befehl aus, um den Jobverlauf und die Mitarbeiterdatensätze zu löschen. <br><br><pre> <code class="javascript hljs">curl -i -X <span class="hljs-string"><span class="hljs-string">"DELETE"</span></span> <span class="hljs-string"><span class="hljs-string">"http://localhost:3000/api/employees/227"</span></span></code> </pre> <br><br>  Und jetzt haben Sie alles, volle CRUD-Funktionalität! <br><br>  Die API macht gute Fortschritte, aber es gibt noch viel zu tun.  Im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">letzten Beitrag</a> werde ich Ihnen zeigen, wie Sie Paginierungs-, Sortier- und Filterfunktionen in GET-Anforderungen hinzufügen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de473560/">https://habr.com/ru/post/de473560/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de473544/index.html">JPEG Multiple Reload-Studie</a></li>
<li><a href="../de473546/index.html">Anwendung auf TSD und Kommunikation mit 1C: Enterprise 8.3 über HTTP-Service. Teil 2 (API-Implementierung auf der 1C-Seite)</a></li>
<li><a href="../de473548/index.html">PKI-Dezentralisierung: Vorgeschlagene Ansätze zur Verbesserung der Sicherheit</a></li>
<li><a href="../de473550/index.html">Joker 2019: Triumph des Jahres</a></li>
<li><a href="../de473552/index.html">Deanonymisierung durch Clickjacking im Jahr 2019</a></li>
<li><a href="../de473562/index.html">Verschlüsselte Einstellungen in Android</a></li>
<li><a href="../de473564/index.html">Es gibt Fähigkeiten, aber keinen Grund: Aufgaben, die die KI nicht bewältigen kann</a></li>
<li><a href="../de473568/index.html">Außendienst, Anwendungen auf der Karte, Geolokalisierung. Wahl des kartografischen Dienstes. Produktseitenansicht</a></li>
<li><a href="../de473570/index.html">Suche 314 km² in 10 Stunden - der letzte Kampf der Suchingenieure gegen den Wald</a></li>
<li><a href="../de473572/index.html">„Zakroma Rodina“ wird erzählt: Deutschland wird die strategischen Reserven nach der neuen Methode bestimmen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>