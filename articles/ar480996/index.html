<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏴 🤜🏼 👨‍🎨 ملاحظات بنتستر: حالات الصيد - 2 👵🏼 🏴󠁧󠁢󠁥󠁮󠁧󠁿 🍃</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="نواصل الحديث عن حالات مثيرة للاهتمام في عمل pentesters. في آخر مشاركة ، تحدثنا عن اختبار الاختراق الخارجي ، اليوم سنتحدث عن أكثر الآفات الداخلية إثارة...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ملاحظات بنتستر: حالات الصيد - 2</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/solarsecurity/blog/480996/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/vr/xh/gw/vrxhgwizzyqzqg0cr2e2qarsfqi.png"><br><br>  نواصل الحديث عن حالات مثيرة للاهتمام في عمل pentesters.  في آخر <a href="https://habr.com/ru/company/solarsecurity/blog/463971/">مشاركة ،</a> تحدثنا عن اختبار الاختراق الخارجي ، اليوم سنتحدث عن أكثر الآفات الداخلية إثارة للاهتمام التي قمنا بتنفيذها مؤخرًا.  جوهرها هو أنه ينبغي لنا ، في المحيط الداخلي للعميل ، الحصول على أقصى الامتيازات في المجال والوصول إلى أي بيانات مهمة.  حدث أن تفاجأ.  لكن أول الأشياء أولا. <br><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  الحالة 1. مدير كلمة المرور جيد ، لكن يجب أن يكونوا قادرين على استخدامه </h2><br>  لقد أجرينا اختبارات الاختراق الداخلي لعميل كبير سبق له تدريب مسؤولي النظام وخدمة IS.  خلال العمل ، تلقينا العديد من الحسابات التي تمكنا بالفعل من الدخول على الشبكة والاتصال بأجهزة المستخدمين الآخرين.  في مرحلة ما ، استقروا في سيارة أحد مسؤولي النظام ووجدوا eldorado هناك.  استخدم مسؤول النظام كلمات مرور معقدة بالفعل (سيكون من الصعب العثور على تلك الكلمات) وحتى تخزينها في keepass.  ولكن هذا هو الحظ السيئ: لم يتم حظر مدير كلمة المرور نفسه أبدًا - ليس بعد 15 دقيقة أو وقت قفل الشاشة.  مع هذه المكافأة ، حصلنا على حقوق إدارية في أنظمة العملاء المهمة دون ضجيج أو تراب. <br><br>  وكان عميل آخر حالة مماثلة.  كلمات مرور معقدة أيضًا ، keepass أيضًا ، رغم أنه لا يزال هناك قفل تلقائي بعد 15 دقيقة.  كيف يمكننا استخدام هذا؟  انتظروا حتى قام المسؤول بتأمين سطح المكتب وغادر (لتناول طعام الغداء؟).  ثم كانت مسألة صغيرة. <br><br>  إذا كنت تستخدم مديري كلمة المرور ، فاستخدمهم بحكمة - قم بتشغيل خيار القفل باستخدام شاشة قفل وفي حالة عدم وجود نشاط لمدة 1-5 دقائق. <br><br><h2 style=";text-align:right;direction:rtl">  الحالة 2. تم استبعاد الموظفين </h2><br>  غالبًا ما نتمكّن من الوصول خلال عمليات البحث الداخلية عن طريق تحديد كلمات المرور - عادةً ما يكون المستخدمون كسولين جدًا في الخروج بمجموعات معقدة ، خاصةً عندما تتطلب سياسة كلمة المرور تحديثها كل شهر.  غالبًا ما تتغير الأرقام - لذلك ، يتحول superpassword_03.2019 بعد شهر إلى superpassword_04.2019 ثم يتراجع إلى أسفل القائمة. <br><br>  لكن في بعض الأحيان يأتي العملاء عبر اللون الأزرق.  لذا ، عند إجراء هجوم برش بكلمة مرور في إحدى الشركات ، حصلنا على عدد من الحسابات وكان أحدها مثيرًا للاهتمام بشكل خاص: كانت تتمتع بحقوق واسعة إلى حد ما ، على الرغم من أنها ليست حقوقًا إدارية.  تم تعيين كلمة مرور سهلة لها (qaz12345) ، وتشير التعليقات على هذا الإدخال في م إلى أنه تم فصل الموظف - وفقًا للتقرير ، قبل عام تقريبًا.  أي أنه بعد الإقالة ، لم يتم حظر الحساب ، ولكن ببساطة إعادة تعيين كلمة المرور إلى "الافتراضي" وتعيين خيار "تغيير كلمة المرور عند تسجيل الدخول الأول".  من أجل سعادة العميل ، كنا أول من تمت دعوته للقيام بذلك. <br><br><h2 style=";text-align:right;direction:rtl">  حالة 3. بقع؟  لا ، لا </h2><br>  الجزء الأصعب من pentest الداخلي هو الحصول على الحساب الأول.  هناك العديد من الأدوات والطرق للقيام بذلك ، بدءًا من عرض أزياء تجسسي في المكتب يبحث عن ملصقات عزيزة مع كلمات مرور ويلتقط المصاب من خلال شبكة Wi-Fi مستنسخة ، تنتهي بهجمات على Kerberos وتكسير حسابات كلمة المرور.  ولكن في بعض الأحيان حتى مع الفحص الأولي ، يمكنك العثور على برنامج لم يقم أحد بتحديثه منذ عشرة آلاف عام (لماذا تهتم بتحديث البرنامج في البنية التحتية الداخلية؟). <br><br>  في أحد هذه المشاريع ، واجهوا برنامج إدارة من HP ، حيث تم العثور على RCE بدون مصادقة - حيث حصلوا على جزء منه في الحسابات. <br><br>  ¯ \ _ (ツ) _ / ¯ <br><br>  يبدو أن كل شيء سيكون أكثر بساطة - Mimikatz ، والأمر موجود في القبعة ، لكن اتضح أن الحسابات التي تلقيناها لا تمتلك الامتيازات التي نحتاجها.  كما يقولون ، فإن قوتنا في الاستعداد للسحابة: باستخدام سحر nmap و smb-enum-script ، اكتشفنا أن أحد الحسابات لديه حقوق المسؤول المحلي على خادم الاختبار ، والتي شارك فيها مسؤولو المجال بنشاط في تلك اللحظة =). <br><br><h2 style=";text-align:right;direction:rtl">  حالة 4. أقفال </h2><br>  أخيرًا ، دعنا نتحدث قليلاً عن حظر الوصول المحتمل.  العمل على "vnutryanka" التي نقوم بها في معظم الأحيان مع الوصول عن بعد.  يبدو المخطط كما يلي: نحن نتصل بشبكة VPN ، ونحصل على العنوان الداخلي ، ثم نتشبث بالجهاز المخصص لنا عبر RDP.  ومع هذه الآلة ، بدأنا بالفعل في تنفيذ العمل ، لكن من أجل هذا نحتاج إلى نقل أدواتنا بطريقة أو بأخرى.  يستخدم العديد من عملائنا خوادم بروكسي بها قوائم بيضاء للمواقع ، وأحيانًا مع قوائم بيضاء للمنافذ ، للوصول إلى الإنترنت (على سبيل المثال ، يمكنك الاتصال بموقع ويب باستخدام المنفذ 80 ، ولكن لم يعد بإمكانك الاتصال بـ 8081).  هذا يجعل العمل أكثر صعوبة بعض الشيء ، خاصة إذا كان نسخ اللصق من خلال RDP محظورًا. <br><br>  ولكن أين في أعمالنا دون فروق دقيقة.  كان لدى أحد العملاء قواعد صارمة للغاية ولم يُسمح لنا بملء أدواتنا بطريقة رسمية ، لذا ، فقد منعوا الاختراق من خلال "المدخل الرئيسي".  مثل ، إليك آلة افتراضية وأقل حقوق لك - تعاني مثل المتسللين الحقيقيين. <br><br>  لم أكن مضطراً للمعاناة لفترة طويلة.  لقد حظر الوكيل حقًا كثيرًا ، لم يكن من الممكن حتى الاتصال بخادم http الخاص به (لم يكن موجودًا في القوائم البيضاء) ، وتم حظر نسخ النسخ ورفض المتصفح الذهاب إلى أي مكان باستثناء http (80 / tcp) و https (443 / tcp) و في مكان ما عدا البوابات الداخلية.  لقد جربنا استخدام بوويرشيل - إنه لا يعمل أيضًا ، لا يعمل بدون وكيل ، ويحظره الوكلاء.  لكن الأداة المساعدة FTP المضمنة في Windows تعمل بشكل جيد - لم تكن هناك قواعد على جدار الحماية تمنع حركة المرور هذه.  لذلك جرنا جميع أدواتنا داخل المحيط ويمكننا القيام بعمل رائع. <br><br><h2 style=";text-align:right;direction:rtl">  في النهاية </h2><br>  سأكرر التوصيات الواردة في الجزء السابق ، لأن التكرار هو أم التعاليم <s>المتعثرة</s> .  قم بإجراء اختبار تغلغل دوري - سوف يساعدك في العثور على نقاط حساسة في دفاعك ، على سبيل المثال ، في الحالة 3. قد ترى أنه ليس من الضروري تصحيح الأنظمة في المحيط الداخلي ، ولكن في بعض الأحيان يؤدي ذلك إلى عواقب وخيمة. <br><br>  قم بإنشاء نظام لإدارة التصحيح - لا يقتصر على إزالة ثغرات "عالية التعريف" (مثل EternalBlue أو BlueKeep) ، ولكن أيضًا أقل شهرة ، ولكن ليس أقل خطورة في حالة تشغيلها (كما هو الحال مع HP AM).  باختصار ، تتبع جميع النظم الخاصة بك. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar480996/">https://habr.com/ru/post/ar480996/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar480982/index.html">3. Fortinet بدء التشغيل v6.0. إعداد تخطيط</a></li>
<li><a href="../ar480984/index.html">تجنب أخطاء أمان الشبكة الشعبية</a></li>
<li><a href="../ar480986/index.html">LEGO Education WeDo 2.0 and Scratch - حزمة جديدة لتعليم الأطفال الروبوتات</a></li>
<li><a href="../ar480990/index.html">هضم الرجعية: 30 موارد مثيرة للاهتمام حول التكنولوجيا والألعاب في السنوات الماضية</a></li>
<li><a href="../ar480992/index.html">حول مهنة مدير المنتج: كيفية تحقيق المثالي؟ (الجزء 2)</a></li>
<li><a href="../ar480998/index.html">MERCH! MERCH! MERCH! و ... حيدات</a></li>
<li><a href="../ar481000/index.html">الحوسبة بدون خادم على أساس OpenWhisk ، الجزء 4</a></li>
<li><a href="../ar481004/index.html">جافا دايجست ل 18 ديسمبر</a></li>
<li><a href="../ar481010/index.html">16 نصائح لتطوير android في Kotlin. الجزء 3</a></li>
<li><a href="../ar481012/index.html">ما تعلمته في 10 سنوات على Stack Overflow</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>