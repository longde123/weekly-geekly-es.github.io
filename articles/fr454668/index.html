<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçπ üë©üèΩ‚Äçü§ù‚Äçüë®üèø ‚úåüèº D√©veloppeur Cookbook: DDD Recipes (Part 5, Processes) üï∫üèº ‚õΩÔ∏è üë©‚Äçüíª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√©sentation 


 Dans les articles pr√©c√©dents, nous avons d√©crit: la port√©e , les fondements m√©thodologiques , un exemple d'architecture et de structu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>D√©veloppeur Cookbook: DDD Recipes (Part 5, Processes)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454668/"><h1 id="vvedenie">  Pr√©sentation </h1><br><p> Dans les articles pr√©c√©dents, nous avons d√©crit: la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">port√©e</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">les fondements m√©thodologiques</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un exemple d'architecture</a> et de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">structure</a> .  Dans cet article, je voudrais expliquer comment d√©crire les processus, les principes de collecte des exigences, en quoi les exigences m√©tier diff√®rent des exigences fonctionnelles, comment passer des exigences au code.  Parlez des principes d'utilisation du cas d'utilisation et de la fa√ßon dont ils peuvent nous aider.  Explorez des exemples d'options d'impl√©mentation pour les mod√®les de conception d'interaction et de couche de service. </p><br><p><img src="https://habrastorage.org/webt/wo/je/ct/woject0sgeuwc_4xnnzugty-5jg.png" alt="commevotregrand-m√®re"></p><br><p>  Les exemples donn√©s dans l'article sont donn√©s √† l'aide de notre solution <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LunaPark</a> , il vous aidera dans les premi√®res √©tapes des approches d√©crites. </p><br><h1 id="otdelyaem-funkcionalnye-trebovaniya-ot-biznes-trebovaniy">  S√©parez les exigences fonctionnelles des exigences commerciales. </h1><br><p>  Encore et encore, il arrive que de nombreuses id√©es commerciales ne se transforment pas vraiment en produit final pr√©vu.  Cela est souvent d√ª √† une incapacit√© √† comprendre la diff√©rence entre les exigences commerciales et les exigences fonctionnelles, ce qui conduit finalement √† une collecte inad√©quate des exigences, une documentation inutile, des retards de projet et des √©checs majeurs de projet. </p><br><p>  Ou parfois, nous sommes confront√©s √† des situations dans lesquelles, bien que la solution finale r√©ponde aux besoins des clients, mais en quelque sorte les objectifs commerciaux ne sont pas atteints. </p><br><p>  Par cons√©quent, il est imp√©ratif de s√©parer les exigences m√©tier des exigences fonctionnelles jusqu'√† ce que vous commenciez √† les d√©finir.  Prenons un exemple. </p><a name="habracut"></a><br><p>  Supposons que nous r√©digions une demande pour une entreprise de livraison de pizza et que nous avons d√©cid√© de cr√©er un syst√®me de suivi des courriers.  Les exigences commerciales sont les suivantes: </p><br><p>  <em>"Introduire un syst√®me bas√© sur le Web et un syst√®me de suivi des employ√©s mobile bas√© sur les employ√©s qui capture les courriers sur leurs itin√©raires et am√©liore l'efficacit√© en surveillant l'activit√© des courriers, leur absence du travail et la productivit√© du travail."</em> </p><br><p>  Ici, nous pouvons distinguer un certain nombre de caract√©ristiques qui indiqueront que ce sont des exigences de l'entreprise: </p><br><ul><li>  les exigences commerciales sont toujours √©crites du point de vue du client; </li><li>  Ce sont des exigences larges et de haut niveau, mais toujours orient√©es vers les parties; </li><li>  ce ne sont pas des objectifs de l'entreprise, mais ils aident l'entreprise √† atteindre ses objectifs; </li><li>  r√©pondez aux questions ¬´ <strong>pourquoi</strong> ¬ª et ¬´ <strong>quoi</strong> ¬ª.  Que souhaite recevoir l'entreprise?  Et pourquoi en a-t-elle besoin? </li></ul><br><p>  Les exigences fonctionnelles sont des <em>actions</em> que le syst√®me doit effectuer pour impl√©menter les exigences m√©tier.  Ainsi, les exigences fonctionnelles sont li√©es √† la solution ou au logiciel d√©velopp√©.  Nous formulons les exigences fonctionnelles pour l'exemple ci-dessus: </p><br><ul><li>  le syst√®me devrait afficher la longitude et la latitude de l'employ√© via GPS / GLONASS; </li><li>  le syst√®me devrait afficher les positions des employ√©s sur la carte; </li><li>  le syst√®me devrait permettre aux gestionnaires d'envoyer des notifications √† leurs subordonn√©s sur le terrain. </li></ul><br><p>  Nous mettons en √©vidence les fonctionnalit√©s suivantes: </p><br><ul><li>  les exigences fonctionnelles sont toujours √©crites du point de vue du syst√®me; </li><li>  ils sont plus sp√©cifiques et d√©taill√©s; </li><li>  c'est gr√¢ce √† la satisfaction des exigences fonctionnelles qu'une solution efficace est d√©velopp√©e qui r√©pond aux besoins de l'entreprise et aux objectifs du client; </li><li>  r√©pondre √† la question ¬´ <strong>comment</strong> ¬ª.  Comment le syst√®me r√©sout les besoins de l'entreprise. </li></ul><br><p>  Il convient de dire quelques mots sur les exigences non fonctionnelles (√©galement appel√©es ¬´exigences de qualit√©¬ª), qui imposent des restrictions sur la conception ou la mise en ≈ìuvre (par exemple, les exigences de performances, de s√©curit√©, de disponibilit√©, de fiabilit√©).  Ces exigences r√©pondent √† la question ¬´ <strong>quoi</strong> ¬ª devrait √™tre le syst√®me. </p><br><p>  Le d√©veloppement est la traduction des exigences m√©tier en exigences fonctionnelles.  La programmation appliqu√©e est la mise en ≈ìuvre d'exigences fonctionnelles et le syst√®me - non fonctionnel. </p><br><h1 id="varianty-ispolzovaniya-use-cases">  Cas d'utilisation </h1><br><p>  La mise en ≈ìuvre des exigences fonctionnelles est souvent la plus complexe dans les syst√®mes commerciaux.  Dans une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">architecture pure,</a> les exigences fonctionnelles sont impl√©ment√©es via la couche <em>Use Case</em> . </p><br><p>  Mais pour commencer, je veux me tourner vers la source.  Ivar Jacobson - l'auteur de la d√©finition de <em>cas d'utilisation</em> , l'un des auteurs d'UML, et de la m√©thodologie RUP, dans son article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Use-Case 2.0 The Hub of Software Development</a> identifie 6 principes d'utilisation des <em>cas d'</em> utilisation: </p><br><ol><li>  les rendre simples gr√¢ce √† la narration; </li><li>  avoir un plan strat√©gique, √™tre conscient de la situation dans son ensemble; </li><li>  se concentrer sur le sens; </li><li>  aligner le syst√®me en couches; </li><li>  livrer le syst√®me √©tape par √©tape; </li><li>  r√©pondre aux besoins de l'√©quipe. </li></ol><br><p>  Nous consid√©rons bri√®vement chacun de ces principes, ils nous sont utiles pour une meilleure compr√©hension.  Ci-dessous ma traduction gratuite, avec abr√©viations et encarts, je vous recommande fortement de vous familiariser avec l'original. </p><br><h3 id="prostota-cherez-povestvovanie">  Simplicit√© gr√¢ce √† la narration </h3><br><p>  <em>La narration fait partie de notre culture;</em>  <em>C'est le moyen le plus simple et le plus efficace de transf√©rer des connaissances, des informations d'une personne √† une autre.</em>  <em>C'est le meilleur moyen de communiquer ce que le syst√®me doit faire et d'aider l'√©quipe √† se concentrer sur des objectifs communs.</em> </p><br><p>  <em>Les cas d'utilisation refl√®tent les objectifs du syst√®me.</em>  <em>Pour comprendre le cas d'utilisation, nous racontons, racontons une certaine histoire.</em>  <em>L'histoire raconte comment atteindre un objectif et comment r√©soudre les probl√®mes qui se posent en cours de route.</em>  <em>Les cas d'utilisation, comme un livre d'histoires, fournissent un moyen d'identifier et de couvrir toutes les histoires diff√©rentes mais li√©es d'une mani√®re simple et compl√®te.</em>  <em>Cela facilite la collecte, la distribution et la compr√©hension des exigences du syst√®me.</em> </p><br><p>  Ce principe est en corr√©lation avec le langage Ubiques de l'approche DDD. </p><br><h3 id="ponimanie-kartiny-v-celom">  Comprendre toute l'image </h3><br><p>  <em>Quel que soit le syst√®me que vous d√©veloppez, grand, petit, logiciel, mat√©riel ou entreprise, il est tr√®s important de comprendre la situation dans son ensemble.</em>  <em>Sans comprendre le syst√®me dans son ensemble, vous ne pouvez pas prendre les bonnes d√©cisions sur ce qu'il faut inclure dans le syst√®me, ce qu'il faut exclure, combien cela co√ªtera et quels avantages il apportera.</em> </p><br><p>  Ivar Jacobson sugg√®re d'utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le diagramme de cas d'utilisation</a> , qui est tr√®s pratique pour collecter les exigences.  Si les exigences sont compil√©es et claires, la carte de contexte d'Eric Evans est la meilleure option.  Souvent, l'approche Scrum est interpr√©t√©e de mani√®re √† ce que les gens ne passent pas de temps sur un plan strat√©gique, envisageant de planifier, plus de deux semaines plus tard, une relique du pass√©.  La propagande de Jeff Sutherland est tomb√©e sur le d√©bit d'eau, et les personnes qui ont suivi des cours de formation de deux semaines pour les Scrum Masters autoris√©s √† g√©rer des projets ont fait leur travail.  Mais le bon sens reconna√Æt l'importance de la planification strat√©gique.  Il n'est pas n√©cessaire d'√©laborer un plan strat√©gique d√©taill√©, mais cela devrait l'√™tre. </p><br><h3 id="fokus-na-znachenii">  Focus sur la valeur </h3><br><p>  <em>Lorsque vous essayez de comprendre comment le syst√®me sera utilis√©, il est toujours important de se concentrer sur la valeur qu'il apportera √† ses utilisateurs et aux autres parties int√©ress√©es.</em>  <em>La valeur est form√©e uniquement lorsque le syst√®me est utilis√©.</em>  <em>Par cons√©quent, il est pr√©f√©rable de se concentrer sur la fa√ßon dont le syst√®me sera appliqu√© que sur de longues listes de fonctionnalit√©s ou de capacit√©s qu'il peut offrir.</em> </p><br><p>  <em>Les cas d'utilisation fournissent cette orientation, vous aidant √† vous concentrer sur la fa√ßon dont le syst√®me sera utilis√© par un utilisateur sp√©cifique pour atteindre son objectif.</em>  <em>Les cas d'utilisation couvrent de nombreuses fa√ßons d'utiliser le syst√®me: ceux qui atteignent leurs objectifs avec succ√®s et ceux qui r√©solvent les difficult√©s qui surviennent.</em> </p><br><p>  De plus, l'auteur donne un merveilleux sch√©ma, auquel il convient d'accorder la plus grande attention: </p><br><p><img src="https://habrastorage.org/webt/5g/nk/ma/5gnkmae4chv6_azevvzhg2euglc.png"></p><br><p>  Le diagramme montre un cas d'utilisation, "Retrait d'esp√®ces √† un guichet automatique".  La fa√ßon la plus simple d'atteindre l'objectif est d√©crite dans la <em>direction de</em> base (flux de base).  D'autres cas sont d√©crits comme des flux alternatifs.  Ces instructions aident √† raconter des histoires, √† structurer le syst√®me et √† r√©diger des tests. </p><br><h3 id="posloynoe-postroenie">  Superposition </h3><br><p>  <em>La plupart des syst√®mes n√©cessitent beaucoup de travail avant d'√™tre pr√™ts √† l'emploi.</em>  <em>Ils ont de nombreuses exigences, dont la plupart d√©pendent d'autres exigences, elles doivent √™tre mises en ≈ìuvre avant que les exigences soient satisfaites et √©valu√©es.</em> </p><br><p>  <em>C'est une grosse erreur de cr√©er un tel syst√®me √† la fois.</em>  <em>Le syst√®me doit √™tre construit √† partir de pi√®ces dont chacune a une valeur claire pour les utilisateurs.</em> </p><br><p>  Ces id√©es r√©sonnent avec des approches agiles et avec des id√©es de <em>domaine</em> . </p><br><h3 id="poshagovyy-vyvod-produkta-na-rynok">  Lancement de produit √©tape par √©tape </h3><br><p>  <em>La plupart des syst√®mes logiciels ont √©volu√© au fil des g√©n√©rations.</em>  <em>Ils ne sont pas produits √† la fois;</em>  <em>ils sont construits comme une s√©rie de versions, chacune √©tant bas√©e sur une version pr√©c√©dente.</em>  <em>M√™me les versions elles-m√™mes ne sortent pas imm√©diatement, mais se d√©veloppent √† travers une s√©rie de versions interm√©diaires.</em>  <em>Chaque √©tape fournit une version claire et utilisable du syst√®me.</em>  <em>C'est ainsi que tous les syst√®mes doivent √™tre cr√©√©s.</em> </p><br><h3 id="udovletvoryat-potrebnosti-komandy">  R√©pondre aux besoins de l'√©quipe </h3><br><p>  <em>Malheureusement, il n'y a pas de solution universelle aux probl√®mes de d√©veloppement logiciel;</em>  <em>diff√©rentes √©quipes et diff√©rentes situations n√©cessitent diff√©rents styles et diff√©rents niveaux de d√©tail.</em>  <em>Peu importe les m√©thodes et techniques que vous choisissez, vous devez vous assurer qu'elles sont suffisamment adaptables pour r√©pondre aux besoins actuels de l'√©quipe.</em> </p><br><p>  Eric Evans dans son livre vous invite √† ne pas passer beaucoup de temps √† d√©crire tous les processus via UML.  Il suffit d'utiliser n'importe quel sch√©ma visuel.  Diff√©rentes √©quipes, diff√©rents projets n√©cessitent un niveau de d√©tail diff√©rent, comme l'auteur UML en parle lui-m√™me. </p><br><h1 id="realizaciya">  Impl√©mentation </h1><br><p>  En architecture pure, Robert Martin d√©finit les <em>cas d'utilisation</em> suivants: </p><br><blockquote>  Ces cas d'utilisation orchestrent le flux de donn√©es vers et depuis les entit√©s, et demandent √† ces entit√©s d'utiliser leurs r√®gles m√©tier critiques pour atteindre les objectifs du cas d'utilisation. </blockquote><p>  Essayons de traduire ces id√©es en code.  Rappelons le sch√©ma du troisi√®me principe d'utilisation des <em>cas d'</em> utilisation et prenons-le comme base.  Prenons un processus d'entreprise vraiment complexe: ¬´Faire cuire une tarte au chou¬ª. </p><br><p>  Essayons de le d√©composer: </p><br><ul><li>  v√©rifier la disponibilit√© des produits; </li><li>  les retirer du stock; </li><li>  p√©trir la p√¢te; </li><li>  laissez lever la p√¢te; </li><li>  pr√©parer la garniture; </li><li>  faire une tarte; </li><li>  cuire une tarte. </li></ul><br><p>  Nous impl√©mentons cette s√©quence enti√®re via l' <em>interacteur</em> , et chaque √©tape sera impl√©ment√©e via une fonction ou un objet fonctionnel sur la couche de service. </p><br><h1 id="posledovatelnost-deystviy-interactor">  S√©quence d'actions (Interacteur) </h1><br><p><img src="https://habrastorage.org/webt/6b/vk/ra/6bvkra2chr3b8d43dmtxebpjaj4.png" alt="√©tape par √©tape"></p><br><p>  Je recommande fortement de commencer le d√©veloppement d'un processus m√©tier complexe avec la <em>s√©quence d'actions</em> .  Plus pr√©cis√©ment, pas le cas, vous devez d√©terminer le <em>domaine de domaine</em> auquel appartient le processus m√©tier.  Clarifiez toutes les exigences commerciales.  Identifiez toutes les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><em>entit√©s</em></a> impliqu√©es dans le processus.  Documentez les exigences et les d√©finitions de chaque <em>entit√©</em> dans la base de connaissances. </p><br><p>  Peignez tout sur papier par √©tapes.  Parfois, vous avez besoin d'un diagramme de s√©quence.  Son auteur est le m√™me qui a invent√© le cas d'utilisation - Ivar Jacobson.  Le sch√©ma a √©t√© invent√© par lui lorsqu'il d√©veloppait un syst√®me de maintenance du r√©seau t√©l√©phonique pour Erickson, bas√© sur le circuit de relais.  J'aime beaucoup ce diagramme, et le terme <em>s√©quence</em> , √† mon avis, est plus expressif que le terme <em>interacteur</em> .  Mais compte tenu de la plus grande pr√©valence de ce dernier, nous utiliserons le terme familier - <em>Interacteur</em> . </p><br><p>  Un petit indice lorsque vous d√©crivez un processus d'entreprise est une bonne aide pour vous, la r√®gle principale de la gestion des documents peut devenir: ¬´√Ä la suite de toute activit√© commerciale, un document doit √™tre √©tabli¬ª.  Par exemple, nous d√©veloppons un syst√®me de rabais.  En accordant une remise, nous, en effet, du point de vue des affaires, concluons un accord entre l'entreprise et le client.  Toutes les conditions doivent √™tre √©nonc√©es dans ce contrat.  Autrement dit, dans le domaine DiscountSystem, vous aurez Entites :: Contract.  Ne liez pas la remise au client, mais cr√©ez un contrat d' <em>entit√©</em> , qui d√©crit les r√®gles de sa fourniture. </p><br><p>  Revenons √† la description de notre processus d'affaires, apr√®s qu'il soit devenu transparent pour toutes les personnes impliqu√©es dans son d√©veloppement, et que toutes vos connaissances soient fixes.  Je vous recommande de commencer √† √©crire du code avec la <em>s√©quence d'actions</em> . </p><br><p>  Le mod√®le de conception de <em>s√©quence</em> est responsable de: </p><br><ul><li>  s√©quence d' <em>actions</em> ; </li><li>  coordination des donn√©es transmises entre les <em>actions</em> ; </li><li>  les erreurs de traitement commises par les <em>Actions</em> lors de leur ex√©cution; </li><li>  retour du r√©sultat de l'ensemble des <em>Actions</em> engag√©es; </li><li>  <strong>IMPORTANT</strong> : la responsabilit√© la plus importante de ce mod√®le de conception est la mise en ≈ìuvre de la logique m√©tier. </li></ul><br><p>  Je voudrais m'attarder sur la derni√®re responsabilit√© plus en d√©tail si nous avons une sorte de processus complexe - nous devons le d√©crire de mani√®re √† ce que ce qui se passe soit clair sans entrer dans les d√©tails techniques.  <strong>Vous devez le d√©crire aussi expressivement que vos comp√©tences en programmation vous le permettent</strong> .  Confiez ce cours au membre le plus exp√©riment√© de votre √©quipe. </p><br><p>  Revenons √† la tarte: essayons de d√©crire le processus de sa pr√©paration via <em>Interactor</em> . </p><br><h2 id="realizaciya-1">  Impl√©mentation </h2><br><p>  Je donne un exemple d'impl√©mentation avec notre solution <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LunaPark</a> , que nous avons pr√©sent√©e dans un article pr√©c√©dent. </p><br><pre><code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Kitchen</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sequences</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CookingPieWith</span></span></span><span class="hljs-class"></span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">abbage</span></span></span><span class="hljs-class"> &lt; LunaPark::Interactors::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sequence</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TEMPERATURE</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values::Temperature</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">(180, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">unit</span></span></span><span class="hljs-class">: :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cel</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call!</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::CheckProductsAvailability</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ingredients</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dough</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::BeatDough</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">from</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Repository::Products</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">beat_ingredients</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filler</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::Make</span></span></span><span class="hljs-class"></span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">abbageFiller</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">from</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Repository::Products</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filler_ingredients</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pie</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::MakePie</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dough</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filler</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bake</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::BakePie</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pie</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">temp</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TEMPERATURE</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sleep</span></span></span><span class="hljs-class"> 5.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">min</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">until</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bake</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pie</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_accessor</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">beat_ingredients</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filler_ingredients</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_accessor</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pie</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ingredients_list</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">beat_ingredients_list</span></span></span><span class="hljs-class"> + </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filler_ingredients_list</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  Comme nous pouvons le voir, l' <code>call!</code>  d√©crit toute la logique commerciale du processus de cuisson des g√¢teaux.  Et il est pratique √† utiliser pour comprendre la logique de l'application. </p><br><p>  En outre, nous pouvons facilement d√©crire le processus de cuisson de la tarte au poisson en rempla√ßant <code>MakeabbageFiller</code> par <code>MakeFishFiller</code> .  Ainsi, nous modifions tr√®s rapidement le processus m√©tier, sans modifications significatives du code.  De plus, nous pouvons laisser les deux <em>s√©quences</em> en m√™me temps, en adaptant les analyses de rentabilisation. </p><br><h3 id="dogovorennosti">  Arrangements </h3><br><ul><li>  M√©thode d' <code>call!</code>  est une m√©thode obligatoire, elle d√©crit l'ordre des <em>actions</em> . </li><li>  Chaque param√®tre d'initialisation peut √™tre d√©crit via un setter ou <code>attr_acessor</code> : </li></ul><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class"> &lt; LunaPark::Interactors::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sequence</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... private attr_accessor :bar end Foo.call(bar: 42)</span></span></span></span></code> </pre> <br><ul><li>  Le reste des m√©thodes doit √™tre priv√©. </li></ul><br><h2 id="primer-ispolzovaniya">  Exemple d'utilisation </h2><br><pre> <code class="ruby hljs">beat_ingredients = [ Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:flour</span></span>, <span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:gr</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:oil</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:gr</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:salt</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:spoon</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:milk</span></span>, <span class="hljs-number"><span class="hljs-number">150</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:ml</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:egg</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:unit</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:yeast</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:spoon</span></span> ] filler_ingredients = [ Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:cabbage</span></span>, <span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:gr</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:salt</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:spoon</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:pepper</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:spoon</span></span> ] cooking = CookingPieWithabbage.call( <span class="hljs-symbol"><span class="hljs-symbol">beat_ingredients:</span></span> beat_ingredients, <span class="hljs-symbol"><span class="hljs-symbol">filler_ingredients:</span></span> filler_ingredients ) <span class="hljs-comment"><span class="hljs-comment">#   : cooking.success? # =&gt; true cooking.fail # =&gt; false cooking.fail_message # =&gt; '' cooking.data # =&gt; Entity::Pie #   : cooking.success? # =&gt; false cooking.fail # =&gt; true cooking.fail_message # =&gt; 'The pie burned out' cooking.data # =&gt; nil</span></span></code> </pre> <br><p>  Le processus est repr√©sent√© par l'objet et nous avons toutes les m√©thodes n√©cessaires pour l'appeler - l'appel a-t-il r√©ussi, une erreur s'est-elle produite lors de l'appel, et si oui, laquelle? </p><br><h2 id="obrabotka-oshibok">  Gestion des erreurs </h2><br><p>  Si nous rappelons maintenant le troisi√®me principe de l'application Cas d'utilisation, nous faisons attention au fait qu'en plus de la <em>ligne principale</em> , nous avions √©galement <em>des</em> directions <em>alternatives</em> .  Ce sont des erreurs que nous devons g√©rer.  Prenons un exemple: nous ne voulons certainement pas que les √©v√©nements se d√©roulent de cette fa√ßon, mais nous ne pouvons rien y faire, la dure r√©alit√© est que les tartes br√ªlent p√©riodiquement. </p><br><p>  <em>Interactor</em> intercepte toutes les erreurs h√©rit√©es de la <code>LunaPark::Errors::Processing</code> . </p><br><p>  Comment pouvons-nous garder une trace du g√¢teau?  Pour ce faire, d√©finissez l'erreur <code>Burned</code> dans l' <em>action</em> <code>BakePie</code> . </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Kitchen</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Errors</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Burned</span></span></span><span class="hljs-class"> &lt; LunaPark::Errors::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Processing</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Et pendant la cuisson, v√©rifiez que notre tarte n'a pas grill√©: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Kitchen</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BakePie</span></span></span><span class="hljs-class"> &lt; LunaPark::Callable </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... rescue Errors::Burned, 'The pie burned out' if pie.burned? # ... end end end end</span></span></span></span></code> </pre> <br><p>  Dans ce cas, le pi√®ge d'erreur fonctionnera et nous pourrons les traiter dans <code></code> . <br>  Les erreurs non h√©rit√©es du <code>Processing</code> sont per√ßues comme des erreurs syst√®me et seront intercept√©es au niveau du serveur.  Sauf indication contraire, l'utilisateur recevra 500 ServerError. </p><br><h2 id="praktika-ispolzovaniya">  Utilisation pratique </h2><br><h3 id="1-staraytes-opisyvat-vse-vyzovy-v-metode-call">  1. Essayez de d√©crire tous les appels dans la m√©thode d'appel! </h3><br><p>  Vous ne devez pas impl√©menter chaque <em>action dans une</em> m√©thode distincte, cela rend le code plus gonfl√©.  Vous devez regarder l'ensemble de la classe plusieurs fois pour comprendre comment cela fonctionne.  G√¢tez la recette de la cuisson d'une tarte: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CookingPieWith</span></span></span><span class="hljs-class"></span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">abbage</span></span></span><span class="hljs-class"> &lt; LunaPark::Interactors::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sequence</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call!</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">check_products_availability</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">make_cabbage_filler</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">make_pie</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bake</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">check_products_availability</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::CheckProductsAvailability</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ingredients</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end</span></span></span></span></code> </pre> <br><p>  Utilisez l'appel √† l'action directement en classe.  Du point de vue du rubis, cette approche peut sembler inhabituelle, elle semble donc plus lisible: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DrivingStart</span></span></span><span class="hljs-class"> &lt; LunaPark::Interactors::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sequence</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call!</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service::CheckEngine</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service::StartUpTheIgnition</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">car</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service::ChangeGear</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">car</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gear_box</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to</span></span></span><span class="hljs-class">: :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">drive</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service::StepOnTheGas</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">car</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pedals</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">right</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><h3 id="2-po-vozmozhnosti-ispolzuyte-metod-klassa-call">  2. Si possible, utilisez la m√©thode de classe d'appel </h3><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># good - ,   ,  . #    . Sequence::RingingToPerson.call(params) # good -   ,      e, #    ,     , #    . ring = Sequence::RingingToPerson.new(person) unless ring.success? ring.call sleep 5.min end</span></span></code> </pre><br><h3 id="3-ne-sozdavayte-_funkcionalnye-obekty_-radi-tipizacii-koda-smotrite-po-situacii">  3. Ne cr√©ez pas d' <em>objets fonctionnels</em> pour taper le code, regardez la situation </h3><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># bad -        ,  #     . module Services class BuildUser &lt; LunaPark::Callable def initialize(first_name:, last_name:, phone:) </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@first</span></span></span><span class="hljs-comment">_name = first_name </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@last</span></span></span><span class="hljs-comment">_name = last_name </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@phone</span></span></span><span class="hljs-comment"> = phone end def call Entity::User.new( first_name: first_name, last_name: last_name, phone: phone ) end private attr_reader :first_name, :last_name, :phone end end module Sequences class RegisteringUser &lt; LunaPark::Interactors::Sequence attr_accessor :first_name, :last_name, :phone def call! user = Service::BuildUser.call(first_name: first_name, last_name: last_name, phone: phone) end end end # good -     ,  . #        , #       . module Sequences class RegisteringUser &lt; LunaPark::Interactors::Sequence attr_accessor :first_name, :last_name, :phone def call! user #... end private def user </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@user</span></span></span><span class="hljs-comment"> = Entity::User.new( first_name: first_name, last_name: last_name, phone: phone ) end end end</span></span></code> </pre> <br><h1 id="servisnyy-sloy-service-layer">  Couche de service </h1><br><p><img src="https://habrastorage.org/webt/1-/qv/ip/1-qvipbbxxz2i0cveslcf02b7c0.png" alt="lsd"></p><br><p>  <em>L'</em> Interacteur, comme nous l'avons dit, d√©crit la logique m√©tier au plus haut niveau.  <em>La couche service</em> ( <em>couche</em> service) r√©v√®le d√©j√† les d√©tails de la mise en ≈ìuvre des exigences fonctionnelles.  Si nous parlons de faire une tarte, alors au niveau de l'interacteur, nous disons simplement ¬´p√©trir la p√¢te¬ª, sans entrer dans les d√©tails sur la fa√ßon de la p√©trir.  Le processus de p√©trissage est d√©crit au <em>niveau</em> du <em>service</em> .  Revenons √† la source originale, le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">grand livre bleu</a> : </p><br><p>  <em>Dans le domaine appliqu√©, il existe des op√©rations qui ne trouvent pas de place naturelle dans un objet de type Entit√© ou Objet de valeur.</em>  <em>Ce ne sont pas intrins√®quement des objets, mais des activit√©s.</em>  <em>Mais comme la base de notre paradigme de mod√©lisation est l'approche objet, nous allons essayer de les transformer en objets.</em> </p><br><p>  <em>√Ä ce stade, il est facile de faire une erreur commune: abandonner la tentative de placer l'op√©ration dans un objet appropri√© pour lui, et ainsi arriver √† la programmation proc√©durale.</em>  <em>Mais si vous placez avec force une op√©ration dans un objet avec une d√©finition qui lui est √©trang√®re, cela fera perdre √† l'objet lui-m√™me sa puret√©, ce qui le rendra plus difficile √† comprendre et √† refactoriser.</em>  <em>Si vous impl√©mentez beaucoup d'op√©rations complexes dans un objet simple, cela peut devenir incompr√©hensible quoi, ce que vous faites n'est pas clair quoi.</em>  <em>De telles op√©rations impliquent souvent d'autres objets du domaine et la coordination entre eux est effectu√©e pour effectuer une t√¢che conjointe.</em>  <em>Une responsabilit√© suppl√©mentaire cr√©e des cha√Ænes de d√©pendance entre les objets, m√©langeant des concepts qui pourraient √™tre consid√©r√©s ind√©pendamment.</em> </p><br><p>  Lorsque vous choisissez un emplacement pour la mise en ≈ìuvre d'une fonctionnalit√©, utilisez toujours le bon sens.  Votre t√¢che consiste √† rendre le mod√®le plus expressif.  Regardons un exemple, "Nous devons couper du bois": </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Wood</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">chop</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end end</span></span></span></span></code> </pre> <br><p>  Cette m√©thode sera une erreur.  Le bois de chauffage ne se coupera pas, nous avons besoin d'une hache: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Axe</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">chop</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sacrifice</span></span></span><span class="hljs-class">) </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end end</span></span></span></span></code> </pre> <br><p>  Si nous utilisons un mod√®le √©conomique simplifi√©, ce sera suffisant.  Mais si le processus doit √™tre mod√©lis√© plus en d√©tail, nous avons besoin d'une personne qui coupera ces bois de chauffage, et peut-√™tre d'un journal qui servira de support au processus. </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Human</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">chop_firewood</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wood</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">axe</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">chock</span></span></span><span class="hljs-class">) </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end end</span></span></span></span></code> </pre><br><p>  Comme vous l'avez probablement d√©j√† devin√©, ce n'est pas une bonne id√©e.  Nous ne sommes pas tous engag√©s dans la coupe du bois, ce n'est pas le devoir direct d'une personne.  Nous voyons souvent √† quel point les mod√®les de Ruby on Rails sont surcharg√©s, qui contiennent une logique similaire: obtenir des remises, ajouter des marchandises au panier, retirer de l'argent au solde.  Cette logique ne s'applique pas √† l'entit√©, mais au processus dans lequel cette entit√© est impliqu√©e. </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChopFirewood</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end</span></span></span></span></code> </pre> <br><p>  Apr√®s avoir d√©termin√© quelle logique nous stockons dans les <em>Services,</em> nous allons essayer de mettre en ≈ìuvre l'un d'entre eux.  Le plus souvent, les services sont impl√©ment√©s via des m√©thodes ou des objets fonctionnels. </p><br><h2 id="funkcionalnye-obekty">  Objets fonctionnels </h2><br><p>  Un objet fonctionnel remplit une exigence fonctionnelle.  Dans sa forme la plus primitive, un objet fonctionnel a une seule m√©thode publique - <code>call</code> . </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serivices</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class"> + </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class">).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_reader</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  De tels objets pr√©sentent plusieurs avantages: ils sont concis, ils sont tr√®s simples √† tester.  Il y a un inconv√©nient, ces objets peuvent s'av√©rer √™tre un grand nombre.  Il existe plusieurs fa√ßons de regrouper des objets similaires; dans une partie de nos projets, nous les divisons par type: </p><br><ul><li>  <em>Objet de service</em> (Service) - un objet, cr√©e un nouvel objet; </li><li>  <em>Commande</em> (Commande) - modifie l'objet actuel; </li><li>  <em>Guardian</em> (Guard) - renvoie une erreur en cas de probl√®me. </li></ul><br><h2 id="servisnyy-obekt-service">  Objet de service </h2><br><p>  Dans notre impl√©mentation, <em>Service</em> - impl√©mente une exigence fonctionnelle et renvoie toujours une valeur. </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KorovaMilkBar</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FindMilk</span></span></span><span class="hljs-class"> &lt; LunaPark::Callable </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GLASS_SIZE</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values::Unit</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> '200</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">g</span></span></span><span class="hljs-class">' </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class">:) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shelfs</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">find</span></span></span><span class="hljs-class"> { |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shelf</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shelf</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">has?</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GLASS_SIZE</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">of</span></span></span><span class="hljs-class">: :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">milk</span></span></span><span class="hljs-class">) } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_reader</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FindMilk</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">the_red_one</span></span></span><span class="hljs-class">) </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># =&gt; #&lt;Glass: ... &gt;</span></span></span></span></code> </pre> <br><h2 id="komanda-command">  Commande </h2><br><p>  Dans notre impl√©mentation, <em>Command</em> - effectue une <em>action</em> , modifie l'objet, si true renvoie true.  En fait, l' <em>√©quipe</em> ne cr√©e pas d'objet, mais modifie un objet existant. </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KorovaMilkBar</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Commands</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FillGlass</span></span></span><span class="hljs-class"> &lt; LunaPark::Callable </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class">:) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">content</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class"> &lt;&lt; content </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_reader</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Glass</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">empty</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">milk</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Milk</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">(200, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gr</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">empty?</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># =&gt; true FillGlass.call glass, with: milk # =&gt; true glass.empty? # =&gt; false</span></span></span></span></code> </pre> <br><h2 id="vahter-guard">  Gardien (Garde) </h2><br><p>  <em>Le gardien</em> effectue une v√©rification logique et en cas d'√©chec donne une erreur de traitement.  Ce type d'objet n'affecte en rien la <em>direction principale</em> , mais nous fait basculer vers la <em>direction alternative en</em> cas de probl√®me. </p><br><p>  Lors du service du lait, il est important de s'assurer qu'il est frais: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KorovaMilkBar</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Guards</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IsFresh</span></span></span><span class="hljs-class"> &lt; LunaPark::Callable </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">product</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">products</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">products</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">products</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">each</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">product</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">raise</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Errors::Rotten</span></span></span><span class="hljs-class">, "</span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#{product.title} is not fresh" if product.expiration_date &gt; Date.today end nil end private attr_reader :products end end end</span></span></span></span></code> </pre> <br><p>  Il peut √™tre utile de s√©parer les objets fonctionnels par type.  Vous pouvez ajouter le v√¥tre, par exemple, <em>Builder</em> - cr√©e un objet bas√© sur des param√®tres. </p><br><h3 id="dogovorennosti-1">  Arrangements </h3><br><ul><li>  La m√©thode d' <code>call</code> est la seule m√©thode publique obligatoire. </li><li>  La m√©thode <code>initialize</code> est la seule m√©thode publique facultative. </li><li>  Le reste des m√©thodes doit √™tre priv√©. </li><li>  Les erreurs logiques doivent √™tre h√©rit√©es de la <code>LunaPark::Errors::Processing</code> . </li></ul><br><h2 id="obrabotka-oshibok-1">  Gestion des erreurs </h2><br><p>  Il existe 2 types d'erreurs qui peuvent se produire pendant le fonctionnement d'une <em>action</em> . </p><br><h5 id="oshibki-processa-vypolneniya">  Erreurs d'ex√©cution </h5><br><p>  De telles erreurs peuvent survenir √† la suite d'une violation de la logique de traitement. </p><br><p>  Par exemple: </p><br><ul><li>  lors de la cr√©ation d'un e-mail utilisateur est r√©serv√©; </li><li>  quand vous essayez de boire du lait, c'est fini; </li><li>  un autre microservice a rejet√© l'action (pour une raison logique, et non parce que le service n'est pas disponible). </li></ul><br><p>  Selon toute vraisemblance, l'utilisateur voudra conna√Ætre ces erreurs.  Ce sont aussi probablement les erreurs <br>  que nous pouvons pr√©voir. </p><br><p>  Ces erreurs doivent √™tre h√©rit√©es de <code>LunaPark::Errors::Processing</code> </p><br><h5 id="sistemnyy-oshibki">  Erreurs syst√®me </h5><br><p>  Erreurs survenues √† la suite d'un plantage du syst√®me. </p><br><p>  Par exemple: </p><br><ul><li>  la base de donn√©es ne fonctionne pas; </li><li>  quelque chose divis√© par z√©ro. </li></ul><br><p>  Selon toute vraisemblance, nous ne pouvons pas pr√©voir ces erreurs et ne pouvons rien dire √† l'utilisateur, sauf que tout est tr√®s mauvais, et envoyer aux d√©veloppeurs un rapport appelant √† l'action.  Ces erreurs doivent √™tre h√©rit√©es de <code>SystemError</code> </p><br><p>  Il existe √©galement <strong>des erreurs de validation</strong> , dont nous discuterons plus en d√©tail dans le prochain article. </p><br><h2 id="praktika-ispolzovaniya-1">  Utilisation pratique </h2><br><h3 id="1-ispolzuyte-peremennye-chtoby-povysit-chitaemost">  1. Utilisez des variables pour augmenter la lisibilit√© </h3><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Fishing</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># bad -   Serivices::Catch.call(fish, rod) # bad -  Serivices::Catch.call(fish: fish, rod: rod) # good -   Serivices::Catch.call(fish, with: rod) module Serivices class Catch def initialize(fish, with:) </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@fish</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = fish </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@rod</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = with #      #   . end # ... private attr_reader :fish, :rod end end end</span></span></span></span></code> </pre> <br><h3 id="2-peredavayte-obekty-a-ne-parametry">  2. Passez des objets, pas des param√®tres </h3><br><p>  Essayez de simplifier l'initialiseur si le traitement des param√®tres n'est pas son objectif. <br>  Passez des objets, pas des param√®tres. </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># bad -        -.  #      ,   . class Foo def initialize(foo_params:, bar_params:) </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@foo</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = Values::Foo.new(*foo_params) </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@bar</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = Values::Bar.new(*bar_params) end # ... end Services::Foo.call(foo: {a: 1, b: 2}, bar: 34) # good -   -. class Bar def initialize(foo:, bar:) </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@foo</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = foo </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@bar</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = bar # ... end end foo = Values::Foo.new(a: 1, b: 2) bar = Values::Bar.new(34) Services::Bar.call(foo: foo, bar: bar) # good -       - Builder. class BuildFoo def initialize(param_1:, param_2:) </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span></span><span class="hljs-class"><span class="hljs-comment">_1 = param_1 </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span></span><span class="hljs-class"><span class="hljs-comment">_1 = param_1 end def call Foo.new( param_1: param_1.foo, param_2: param_2.bar, param_3: some_magick ) end # ... end end</span></span></span></span></code> </pre> <br><h3 id="3-ispolzuyte-v-nazvanie-deystviya---glagol-deystviya-i-obekt-vozdeystviya">  3. Utilisez le nom Actions - le verbe de l'action et l'objet d'influence. </h3><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># bad module Services class Milk; end class Work; end class FooBuild; end class PasswordGenerator; end end # good module Services class GetMilk; end class WorkOnTable; end class BuildFoo; end class GeneratePassword; end end</span></span></code> </pre> <br><h3 id="4-po-vozmozhnosti-ispolzuyte-metod-klassa-call">  4. Si possible, utilisez la m√©thode de classe d'appel </h3><br><p>  Habituellement, une instance de la classe <em>Actions</em> , rarement utilis√©e autre que l'√©criture pour effectuer un appel. </p><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># good -    . Services::BuildFoo.call(params) # good -     Services::BuildFoo.(params) # good -   ,      , #    ,     ,   #  . ring = Services::RingToPhone.new(phone: neighbour) 10.times do ring.call end</span></span></code> </pre> <br><h3 id="5-obrabotka-oshibok-ne-yavlyaetsya-zadachey-servisa">  5. La gestion des erreurs n'est pas une t√¢che de service </h3><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># bad -    ,   . def call #... rescue SystemError =&gt; e return false end</span></span></code> </pre> <br><h2 id="moduli">  Modules </h2><br><p>  Jusqu'√† ce moment, nous avons consid√©r√© l'impl√©mentation de la <em>couche Service</em> comme un ensemble d'objets fonctionnels.  Mais nous pouvons facilement placer des m√©thodes sur cette couche: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sum</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">b</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class"> + </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">b</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  Un autre probl√®me auquel nous sommes confront√©s est un grand nombre d'installations de service.  Au lieu du ¬´mod√®le fat rails¬ª, que nous avons mis de c√¥t√©, nous obtenons le ¬´dossier fat services¬ª.  Il existe plusieurs fa√ßons d'organiser la structure pour r√©duire l'ampleur de la trag√©die.  Eric Evans r√©sout ce probl√®me en combinant un certain nombre de fonctions en une seule classe.  Imaginez que nous devons mod√©liser les processus commerciaux de la nounou, Arina Rodionovna, elle peut nourrir Pouchkine et le coucher: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NoonService</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">arina_radionovna</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pushkin</span></span></span><span class="hljs-class">) </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end def to_feed # ... end def to_sleep # ... end end</span></span></span></span></code> </pre> <br><p>  Cette approche est plus correcte du point de vue de la POO.  Mais nous sugg√©rons de l'abandonner, au moins dans les premi√®res √©tapes.  Les programmeurs peu exp√©riment√©s commencent √† √©crire beaucoup de code dans cette classe, ce qui conduit finalement √† une connectivit√© accrue.  Au lieu de cela, vous pouvez utiliser le module, repr√©sentant l'activit√© comme une abstraction: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Noon</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToFeed</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call!</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end class &lt;&lt; self #    ,   #    def to_feed(arina_radionovna, pushkin) ToFeed.new(arina_radionovna, pushkin).call end #    ,    def to_sleep(arina_radionovna, pushkin) arina_radionovna.tell_story pushkin pushkin.state = :sleep end end end end</span></span></span></span></code> </pre> <br><p>  Lors de la division en modules, un faible couplage externe (faible couplage) doit √™tre observ√© avec une forte coh√©sion interne (forte coh√©sion), mais nous utilisons des modules tels que les services ou les interacteurs, cela va √©galement √† l'encontre des id√©es d'architecture pure.  Il s'agit d'un choix conscient qui facilite la perception.  Par le nom du fichier, nous comprenons quel mod√®le de conception impl√©mente telle ou telle classe, si cela est √©vident pour un programmeur exp√©riment√©, ce n'est pas toujours le cas pour un d√©butant.  Une fois que votre √©quipe est pr√™te, jetez cet exc√®s. </p><br><p>  Pour citer un autre petit extrait du grand livre bleu: </p><br><p>  <em>Choisissez des modules qui racontent l'histoire du syst√®me et contiennent des ensembles coh√©rents de concepts.</em>  <em>Cela conduit souvent √† une faible d√©pendance des modules les uns par rapport aux autres.</em>  <em>Mais si ce n'est pas le cas, trouvez un moyen de changer le mod√®le de mani√®re √† s√©parer les concepts les uns des autres, ou recherchez le concept qui manquait dans le mod√®le, qui pourrait devenir la base du module et ainsi rapprocher les √©l√©ments du mod√®le de mani√®re naturelle et significative.</em>  <em>Atteindre une faible d√©pendance des modules les uns par rapport aux autres dans le sens o√π les concepts des diff√©rents modules peuvent √™tre analys√©s et per√ßus ind√©pendamment les uns des autres.</em>  <em>Affinez le mod√®le jusqu'√† ce que des limites naturelles y apparaissent conform√©ment aux concepts de haut niveau du domaine concern√©, et le code correspondant n'est pas divis√© en cons√©quence.</em> </p><br><p>  <em>Donnez aux modules les noms qui seront inclus dans la LANGUE UNIFI√âE.</em>  <em>Les MODULES eux-m√™mes et leurs noms doivent refl√©ter la connaissance et la compr√©hension du sujet.</em> </p><br><p>  Le sujet des modules est vaste et int√©ressant, mais dans son int√©gralit√© va clairement au-del√† du sujet de cet article.  La prochaine fois, nous parlerons avec vous des <em>r√©f√©rentiels</em> et <em>adaptateurs</em> .  Nous avons ouvert une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cha√Æne de t√©l√©grammes confortable</a> o√π nous aimerions partager des documents sur le th√®me du DDD.  Nous appr√©cions vos questions et commentaires. </p><br><hr><br><div class="spoiler">  <b class="spoiler_title">Sources d'inspiration</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.netsolutions.com/insights/business-and-functional-requirements-what-is-the-difference-and-why-should-you-care/</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://magazines.russ.ru/nz/2007/54/gi3.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.microtool.de/en/knowledge-base/how-use-case-2-0-works/</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.researchgate.net/publication/220059381_Use_cases_-_Yesterday_today_and_tomorrow</a> </li><li>  Conception orient√©e probl√®me, Eric J. Evans </li></ul></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr454668/">https://habr.com/ru/post/fr454668/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr454652/index.html">Moteur √† r√©action sur une imprimante 3D domestique</a></li>
<li><a href="../fr454658/index.html">Gadgets de beaut√© - Affaires s√©rieuses</a></li>
<li><a href="../fr454662/index.html">D√©m√©nagement prudent aux Pays-Bas avec sa femme et son hypoth√®que. Partie 1: Recherche d'emploi</a></li>
<li><a href="../fr454664/index.html">Jouer √† Tetris en AR</a></li>
<li><a href="../fr454666/index.html">Radio d√©finie par logiciel - comment √ßa marche? Partie 7</a></li>
<li><a href="../fr454670/index.html">La s√©rie "Tchernobyl": regardez et pensez</a></li>
<li><a href="../fr454672/index.html">La cl√© du d√©part: les meilleurs logiciels et mat√©riels pour la criminalistique informatique</a></li>
<li><a href="../fr454674/index.html">Surveillance du pauvre ou surveillance du serveur depuis la console</a></li>
<li><a href="../fr454676/index.html">Montre GPS sur Arduino</a></li>
<li><a href="../fr454678/index.html">Programmation GPU idiomatique dans Rust: Emu Library</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>