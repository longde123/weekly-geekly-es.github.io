<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê∑ üéë üë©üèæ‚Äçüè´ Una base de datos no es solo un almac√©n de datos üëï üîî üë©üèø‚Äçüî¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Usar una base de datos solo para almacenamiento de datos es lo mismo que llamar a Unix como una interfaz para trabajar con archivos. Por lo tanto, qui...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Una base de datos no es solo un almac√©n de datos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422989/"><p><img src="https://habrastorage.org/webt/o1/t_/g4/o1t_g4i4iyk2wbbfyv61pq45mfa.png" align="left" height="35%" width="35%">  Usar una base de datos solo para almacenamiento de datos es lo mismo que llamar a Unix como una interfaz para trabajar con archivos.  Por lo tanto, quiero recordarles las funciones de base de datos conocidas y no muy conocidas que me gustar√≠a ver con m√°s frecuencia en las aplicaciones de combate basadas en la web. </p><a name="habracut"></a><br><h2 id="tldr">  tl; dr </h2><br><p>  A continuaci√≥n se tratar√° sobre autenticaci√≥n, usuarios, derechos de acceso, integridad de datos, FDW, registro y estad√≠sticas.  Nada nuevo </p><br><h2 id="primechaniya">  Notas </h2><br><ul><li>  Me referir√© a Ruby on Rails y Postgres, pero la mayor√≠a de las referencias son bien toleradas en otros idiomas y DBMS. </li><li> No dir√© nada nuevo, todo esto ha sido descrito en la documentaci√≥n y los art√≠culos.  Solo quiero recordar una vez m√°s las herramientas y d√≥nde se pueden aplicar para mejorar un poco la vida. </li></ul><br><h2 id="peerident-autentifikaciya">  Autenticaci√≥n de igual / ident </h2><br><p> Cosa absolutamente saludable, que casi nadie usa.  Asigna un usuario de Unix a un usuario de la base de datos.  En el primer caso, se asigna el usuario local y, en el segundo, el usuario remoto.  El beneficio es que puede eliminar el host, el nombre de usuario y la contrase√±a de la configuraci√≥n (y el nombre de la base de datos tambi√©n se puede eliminar), pero todo funcionar√° como antes.  Adem√°s, ser√° m√°s conveniente ingresar a la consola para la depuraci√≥n directa (solo psql desde el terminal en lugar de todos estos <code>-h -U -W -d</code> y as√≠ sucesivamente). </p><br><p>  Documentaci√≥n de PG sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pares</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ident</a> . </p><br><p>  Matices: adecuado si no solo tiene root y superusuario en el servidor;  y en el caso de ident, usted controla la red, el hardware y est√° seguro de que no hay intrusos ni saboteadores. </p><br><h3 id="primery-ispolzovaniya">  Ejemplos de uso </h3><br><p>  Seguridad  No puede eliminar la contrase√±a de la base de datos y conectarse desde el entorno local o desde otro lugar.  No hay contrase√±a y no hay nada que arrastrar. </p><br><p>  Control de acceso.  Si hay varios roles de acceso a la producci√≥n u otro servidor y ya est√°n divididos en el nivel de Unix, entonces es conveniente vincularlos con los usuarios de la base de datos.  En este caso, la misma base de c√≥digo se conectar√° con diferentes usuarios de la base de datos.  Por ejemplo, el soporte t√©cnico y los desarrolladores se suben a la misma consola de rieles, pero para algunos es de solo lectura, y para el segundo es de pleno derecho. </p><br><h2 id="prava-dostupa">  Derechos de acceso </h2><br><p>  En Unix, todos piensan en ellos y se ven muy sesgados al trabajar desde la ra√≠z o en <code>'chmod 777'</code> .  Pero en la base de datos todo es de alguna manera diferente.  Superusuario y listo.  Aunque todo lo que hay no es menos (y tal vez incluso m√°s) genial. </p><br><p>  Hay una jerarqu√≠a de herencia de roles (un poco como grupo en Unix), hay accesos de diferentes niveles: a objetos espec√≠ficos (como permisos de archivos), a operadores espec√≠ficos (como reglas en <code>sudoers</code> ), incluso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">a l√≠neas espec√≠ficas</a> .  En resumen, todo est√° ah√≠.  √ösalo. </p><br><h3 id="oblasti-prilozheniya">  √Åreas de aplicaci√≥n </h3><br><p>  En la versi√≥n m√≠nima, junto con el par / ident anterior, puede separar el usuario para las migraciones / implementaci√≥n y el usuario para el funcionamiento diario de la aplicaci√≥n.  Esto, al menos, proteger√° contra llamadas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DDL</a> en tiempo de ejecuci√≥n.  Por supuesto, hay muchos casos de modificaci√≥n de la estructura de la base de datos "en caliente".  Estos son despliegues de tiempo de inactividad cero, y varias revisiones, y reconstrucciones de √≠ndices con precisi√≥n (y a veces sin).  Pero, en general, una aplicaci√≥n DDL no deber√≠a. </p><br><p>  Otra opci√≥n: si tiene "microservicios", pero por alguna raz√≥n, usan la misma base de datos, entonces compartir claramente el acceso a los objetos de la base de datos es una muy buena idea.  De hecho, las interfaces de interacci√≥n deben estar lo m√°s localizadas posible, y el acceso an√°rquico a todos los datos contribuye a la erosi√≥n de la l√≥gica y la responsabilidad. </p><br><h2 id="ogranichenie-celostnosti">  Restricci√≥n de integridad </h2><br><p>  En Rails 5, al menos de alguna manera, el trabajo comenz√≥ con referencias e integridad de datos.  Pero, en el caso general, muchos desarrolladores creen que la validaci√≥n en el modelo o sus alrededores es suficiente para preservar el estado consistente de los datos.  Por desgracia, esto no es del todo cierto. </p><br><p>  Se pueden omitir las validaciones, puede ir directamente a la base de datos y ejecutar sql, puede limpiar durante la migraci√≥n.  En general, se puede hacer mucho.  Por lo tanto, todo lo que se basa en la l√≥gica de negocios debe ser clavado por la base de datos.  Esta es la √∫nica forma de preservar la integridad de los datos y no obtener "sorpresas" en la pr√≥xima implementaci√≥n. </p><br><h2 id="foreign-data-wrapper">  Contenedor de datos for√°neos </h2><br><p>  Se trata de conectar una base de datos a otra para acceder a tablas remotas como propias.  El beneficio principal es que la aplicaci√≥n web no participa aqu√≠, pero hay muchas optimizaciones cuando funcionan dos bases de datos id√©nticas (en general, el pushdown es para adaptadores diferentes, pero todo es complicado all√≠, por lo que es m√°s f√°cil suponer que el paquete PG-PG funciona bien, y todo lo dem√°s, c√≥mo va). </p><br><h3 id="ispolzovanie-fdw">  Usando FDW </h3><br><p>  En lugar de configuraciones con las coordenadas de varias bases de datos en una aplicaci√≥n web, es incomparablemente m√°s f√°cil dejar una conexi√≥n a la base de datos y administrar todo a nivel de base de datos.  All√≠, por s√≠ mismo, se resolver√° la cuesti√≥n de los derechos de acceso y la elecci√≥n de los objetos a los que se necesita acceso. </p><br><p>  Adem√°s, en el futuro, puede reemplazar la tabla externa con una vista materializada o simplemente una tabla, pero no cambie nada en una aplicaci√≥n web. </p><br><p>  Y, sin embargo, puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">conectarse al</a> tipo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ex√≥tico</a> de MS Access y desaparecen los problemas con las restricciones en el uso de las relaciones en los modelos.  Despu√©s de todo, si tiene m√°s de 2 conexiones, no podr√° unir dos bases a nivel de aplicaci√≥n web, aunque ORM (en particular, ActiveRecord) honestamente intentar√° hacer esto ... y se caer√°.  Y a nivel de la base de datos, esto se puede hacer, en algunos casos, casi sin una sobrecarga. </p><br><h2 id="logirovanie">  Registro </h2><br><p>  Casi todos lo conocen y lo usan todo.  Pero por si acaso, perm√≠teme recordarte: no dudes en registrar solicitudes largas.  Fuera de la caja, en PG, est√° apagado.  Necesito <code>log_min_duration_statement</code> .  En cuanto a su significado, hay muchos holivars y, tal vez, me tartamudean, pero para empezar, pon un par de segundos.  Dado que si tiene una aplicaci√≥n grande, es poco probable que la lea y usted mismo sepa qu√© hacer, pero si es peque√±a, entonces no tiene tiempo para lidiar con frenos peque√±os y solo las cosas fatales lo molestan. </p><br><p>  Tambi√©n recuerda sobre N + 1.  La base de datos no dir√° nada al respecto.  Utiliza herramientas de terceros.  Por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">bala</a> y sentido com√∫n. </p><br><h2 id="statistika">  Estad√≠sticas </h2><br><p>  Debe recordarse que es as√≠ y que puede apestar.  Al principio, todo est√° bien.  Pero con el tiempo, generalmente, los siguientes resultados: la tasa de cambio de datos es aproximadamente la misma, y ‚Äã‚Äãel tama√±o de la tabla es mayor.  En consecuencia, las tablas de vac√≠o / an√°lisis comienzan a ocurrir con menos frecuencia y en alg√∫n momento el programador comienza a fallar.  En el mejor de los casos, la solicitud cae en el registro anterior, en el peor de los casos: simplemente sufre y no entiende por qu√©.  En general, mire en <code>pg_stat_user_tables</code> y correlacione las fechas de vac√≠o / an√°lisis con la carga en las tablas. </p><br><p>  Y a veces puedes usar estad√≠sticas para un <code>count</code> aproximado.  Raramente resulta √∫til, pero de manera bastante acertada, porque PG no es Oracle y el <code>count</code> de toda la tabla no se realiza en O (1), aunque realmente quiero hacerlo. </p><br><h2 id="konec">  El final </h2><br><p>  Gracias por leer  Si no es dif√≠cil, responda la siguiente pregunta.  A la luz de un art√≠culo reciente sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GQL, en lugar de SQL,</a> comenz√≥ a molestarme mucho. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es422989/">https://habr.com/ru/post/es422989/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es422977/index.html">Mikhail Bessmeltsev y su colega desarrollaron nuevos algoritmos para vectorizar gr√°ficos</a></li>
<li><a href="../es422979/index.html">An√°logo estadounidense de GDPR: lo que necesita saber sobre el CCPA</a></li>
<li><a href="../es422981/index.html">Implementaci√≥n del sistema de componentes de entidad m√°s simple</a></li>
<li><a href="../es422985/index.html">Inicio r√°pido de un proyecto web (BE - Java Spring, FE - React Redux, interacci√≥n - Rest, WebSocket)</a></li>
<li><a href="../es422987/index.html">Y de nuevo, el d√≠a 256 del a√±o.</a></li>
<li><a href="../es422993/index.html">Quemando televisores OLED en pruebas reales</a></li>
<li><a href="../es422995/index.html">QA mitap en Redmadrobot</a></li>
<li><a href="../es422997/index.html">El libro "PHP moderno"</a></li>
<li><a href="../es422999/index.html">Crea tu propio conjunto de datos alien√≠genas</a></li>
<li><a href="../es423005/index.html">C√≥mo Yandex.Zen, el complemento de almacenamiento en cach√© de WordPress y el alojamiento aumentaron mi presi√≥n</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>