<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍✈️ 🉐 👎🏻 Pencatatan aktivitas menggunakan Web Beacon API ⏯️ 🍱 👷🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beacon API adalah antarmuka berbasis JavaScript untuk: 


 mengirim sejumlah kecil data ke server dari browser, tanpa menunggu tanggapan. Dalam artike...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pencatatan aktivitas menggunakan Web Beacon API</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419137/"><p><img src="https://habrastorage.org/webt/or/qb/ju/orqbjuhannguixlf_fyehlsv0zy.jpeg"></p><br><h3>  Beacon API adalah antarmuka berbasis JavaScript untuk: </h3><br><p> mengirim sejumlah kecil data ke server dari browser, tanpa menunggu tanggapan.  Dalam artikel ini, kami akan mempertimbangkan dalam kasus apa Beacon API akan berguna, bagaimana ia berbeda dari menggunakan <code>XMLHTTPRequest</code> (Ajax) untuk tujuan yang sama dan bagaimana menggunakannya. </p><br><h3>  Mengapa kita membutuhkan API lain? </h3><br><p>  Beacon API digunakan untuk mengirim data kecil ke server <i>tanpa menunggu tanggapan</i> .  Bagian terakhir dari pernyataan itu adalah yang paling menarik.  API Beacon dirancang khusus untuk mengirim data dan melupakannya.  Tidak perlu mengharapkan jawaban, karena itu tidak akan pernah terjadi. </p><a name="habracut"></a><br><p>  Metafora dengan kartu pos, ini adalah kartu yang orang kirim / kirim satu sama lain.  Sebagai aturan, mereka menulis teks kecil pada mereka ("Di mana Anda? Dan saya lol di laut.", "Di sini saya memiliki cuaca yang baik, tidak seperti di kantor Anda"), mereka melemparkan mereka melalui pos dan lupa.  Tidak ada yang mengharapkan jawaban seperti "Aku sudah pergi untukmu," "Luar biasa di kantorku." </p><br><p>  Ada banyak kasus di mana pendekatan "kirim dan lupakan" akan sesuai. </p><br><h3>  Pelacakan Statistik dan Informasi Analitik </h3><br><p>  Ini adalah hal pertama yang terlintas dalam pikiran.  Solusi besar seperti Google Analytics dapat memberikan ikhtisar yang baik tentang hal-hal dasar.  Tetapi jika kita menginginkan sesuatu yang lebih khusus?  Kita perlu menulis beberapa kode untuk melacak apa yang terjadi pada halaman (bagaimana pengguna berinteraksi dengan komponen, seberapa jauh mereka menggulir, halaman mana yang ditampilkan sebelum penjualan pertama), kemudian mengirimkan data ini ke server ketika pengguna meninggalkan halaman.  Beacon cocok untuk tugas seperti itu, karena kami hanya mengirim data dan kami tidak memerlukan respons dari server. </p><br><h3>  Debug dan Logging </h3><br><p>  Aplikasi lain adalah mencatat informasi dari kode JavaScript.  Bayangkan sebuah situasi ketika Anda memiliki aplikasi besar dengan UI / UX yang kaya.  Semua tes berwarna hijau, dan kesalahan muncul secara berkala pada pro yang Anda ketahui, tetapi Anda tidak dapat melakukannya karena kurangnya informasi.  Dalam hal ini, Anda dapat menggunakan Beacon untuk diagnostik. </p><br><p>  Bahkan, tugas apa pun dengan logging dapat diselesaikan menggunakan Beacon.  Ini bisa berupa pembuatan titik penyimpanan dalam game, mengumpulkan informasi tentang penggunaan fungsionalitas baru, merekam hasil tes, dan sebagainya.  Jika ini adalah sesuatu yang terjadi di browser dan Anda ingin server mengetahuinya, Beacon adalah yang Anda butuhkan. </p><br><h3>  Bukankah kita pernah melakukan ini sebelumnya? </h3><br><p>  Saya tahu apa yang Anda pikirkan.  Tidak ada yang baru?  Kami telah berkomunikasi dengan utara melalui XMLHTTPRequest selama lebih dari 10 tahun.  Kami baru-baru ini mulai menggunakan API Ambil, yang sebenarnya melakukan hal yang sama, hanya dengan antarmuka Janji baru.  Jadi mengapa kita perlu API Beacon lain? </p><br><p>  Fitur kuncinya adalah kita tidak memerlukan respons dari server.  Browser dapat mengantri permintaan dan mengirim data tanpa memblokir eksekusi kode apa pun.  Karena peramban memanfaatkan ini, tidak masalah bagi kami apakah kode itu masih berjalan atau tidak, peramban hanya akan mengirim permintaan ke latar belakang secara diam-diam. </p><br><p>  C Beacon API tidak perlu menunggu momen terbaik untuk jaringan CPU.  Menambahkan permintaan ke antrian menggunakan suar praktis tidak ada artinya. </p><br><p>  Untuk memahami mengapa ini penting, lihat saja bagaimana dan di mana logika seperti itu biasanya digunakan.  Misalnya, untuk mengukur berapa lama pengguna berada di halaman, kita perlu mengirim permintaan ke server sedekat mungkin ke akhir sesi. </p><br><p>  Ini biasanya dilakukan pada <code>unload</code> atau <code>beforeunload</code> .  Kode tersebut dapat memblokir eksekusi, dan jika halaman tertunda, pemuatan halaman berikutnya juga tertunda.  Ini mengarah ke bukan UX terbaik. </p><br><p>  Apakah Anda mengerti betapa lambatnya permintaan HTTP?  Dan hal terakhir yang Anda inginkan adalah mendorong permintaan HTTP di antara transisi. </p><br><h3>  Mencoba Beacon API </h3><br><p>  Contoh penggunaan dasar sangat sederhana: </p><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">let</span></span> result = navigator.sendBeacon(url, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">);</span></span></code> </pre> <br><p>  <code>result</code> nilai boolean.  Jika browser telah menambahkan permintaan ke antrian - <code>true</code> , jika tidak <code>false</code> . </p><br><h4>  Menggunakan navigator.sendBeacon () </h4><br><p>  <code>navigator.sendBeacon</code> menerima dua parameter.  Yang pertama adalah URL yang permintaannya akan dikirim, yang kedua adalah data yang harus dikirim.  Permintaan memiliki bentuk <code>HTTP POST</code> . </p><br><p>  <code>data</code> - parameter ini dapat menerima beberapa format data, yang semuanya digunakan oleh API Ambil.  Itu bisa berupa Blob, BufferSource, FormData atau URLSearchParams, dll. </p><br><p>  Saya suka menggunakan FormData untuk data nilai kunci sederhana, ini bukan kelas yang kompleks dan mudah digunakan. </p><br><pre> <code class="hljs haskell">// <span class="hljs-type"><span class="hljs-type">URL</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> url = '/api/my-endpoint'; //   <span class="hljs-type"><span class="hljs-type">FormData</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> = new </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FormData</span></span></span><span class="hljs-class">(); </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.append('</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hello'</span></span></span><span class="hljs-class">, '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">world'</span></span></span><span class="hljs-class">); let result = navigator.sendBeacon(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">url</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">); if (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">result</span></span></span><span class="hljs-class">) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">console</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">log</span></span></span><span class="hljs-class">('  !'); } else { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">console</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">log</span></span></span><span class="hljs-class">('.'); }</span></span></code> </pre> <br><h3>  Dukungan browser </h3><br><p>  Dukungan untuk API ini cukup solid.  Satu-satunya browser yang tidak mendukung adalah Internet Explorer (saya tidak mengharapkan ini) dan Opera Mini.  Tapi di Edge semuanya bekerja.  Dalam kebanyakan kasus, ada dukungan, tetapi lebih baik untuk memeriksa berjaga-jaga: </p><br><pre> <code class="hljs ruby"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (navigator.sendBeacon) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Beacon  } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  XHR? }</code> </pre> <br><h3>  Contoh: waktu logging dihabiskan di halaman </h3><br><p>  Untuk melihat semua ini dalam praktiknya, mari kita buat sistem sederhana untuk menghitung waktu pengguna berada di halaman.  Ketika halaman dimuat, kami melihat waktu dan ketika ia pergi, kami mengirim permintaan dari awal melihat dan yang sekarang ke server. </p><br><p>  Karena kami hanya tertarik pada waktu yang dihabiskan di halaman, dan bukan saat ini, kami dapat menggunakan <code>performance.now()</code> untuk mendapatkan stempel waktu saat memuat halaman: </p><br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> startTime = performance.<span class="hljs-built_in"><span class="hljs-built_in">now</span></span>();</code> </pre> <br><p>  Mari kita bungkus sepotong logika kecil dalam fungsi yang mudah digunakan: </p><br><pre> <code class="hljs pgsql">let logVisit = <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>() { // Test that we have support <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!navigator.sendBeacon) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; // URL <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> send the data <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>, eg let url = <span class="hljs-string"><span class="hljs-string">'/api/log-visit'</span></span>; // Data <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> send let data = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> FormData(); data.append(<span class="hljs-string"><span class="hljs-string">'start'</span></span>, startTime); data.append(<span class="hljs-string"><span class="hljs-string">'end'</span></span>, performance.now()); data.append(<span class="hljs-string"><span class="hljs-string">'url'</span></span>, document.URL); // Let<span class="hljs-string"><span class="hljs-string">'s go! navigator.sendBeacon(url, data); };</span></span></code> </pre> <br><p>  Akhirnya, kita perlu memanggil fungsi ini ketika pengguna meninggalkan halaman.  Pikiran pertama adalah menggunakan <code>unload</code> , tetapi Safari di Mac tampaknya memblokir permintaan untuk alasan keamanan.  Karena itu, lebih baik menggunakan <code>beforeunload</code> : </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">window</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'beforeunload'</span></span>, logVisit);</code> </pre> <br><p>  Ketika halaman diturunkan (atau sebelum), fungsi <code>logVisit()</code> akan dipanggil dan, jika browser mendukung Beacon API, itu akan mengirimkan permintaan ke server. </p><br><h3>  Beberapa poin </h3><br><p>  Karena sebagian besar masalah yang API Beacon akan digunakan berputar di sekitar pelacakan aktivitas, penting untuk mencatat bagian sosial dan hukum dari seluruh dapur ini. </p><br><h3>  GDPR </h3><br><p>  Ingat saja tentang itu. </p><br><h3>  DNT: JANGAN TRACK </h3><br><p>  Selain itu, browser memiliki opsi yang memungkinkan pengguna untuk menunjukkan bahwa mereka tidak ingin aktivitas mereka dilacak.  <code>Do Not Track</code> mengirim tajuk HTTP yang terlihat seperti ini: </p><br><pre> <code class="hljs">DNT: 1</code> </pre> <br><p>  Jika Anda melacak data yang dapat menunjukkan pengguna dan header permintaan memiliki <code>DNT: 1</code> , maka lebih baik mendengarkan pengguna dan tidak menyimpan data apa pun.  Misalnya, menggunakan PHP, ini dapat diverifikasi sebagai berikut: </p><br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_DNT'</span></span>])) { <span class="hljs-comment"><span class="hljs-comment">//  ,   }</span></span></code> </pre> <br><h3>  Kesimpulannya </h3><br><p>  Beacon API memang cara yang sangat mudah untuk mengirim data ke server, terutama dalam konteks pencatatan.  Dukungan peramban berada pada tingkat yang cukup baik dan memungkinkan Anda untuk dengan mudah mencatat informasi apa pun tanpa konsekuensi negatif apa pun untuk kinerja dan responsif UI Anda.  Sifat non-blocking dari permintaan ini memainkan peran yang sangat baik dalam hal ini, itu jauh lebih cepat daripada alternatif XHR dan Fetch. </p><br><p><img src="https://habrastorage.org/webt/od/9-/sg/od9-sglbgmr5sjagemivcierh0k.png"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id419137/">https://habr.com/ru/post/id419137/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id419127/index.html">Tiga reinkarnasi dari toko online. Cara menguras uang, waktu, dan mengapa templat bagus</a></li>
<li><a href="../id419129/index.html">Sistem multi-agen dalam pembangunan ruang virtual</a></li>
<li><a href="../id419131/index.html">Tanggal peluncuran awal modul lunar, SpaceIL diumumkan</a></li>
<li><a href="../id419133/index.html">Webinar Jumat: belajar program secara gratis</a></li>
<li><a href="../id419135/index.html">Friday JS: 0-line JS dan CSS game</a></li>
<li><a href="../id419141/index.html">Seks phishing mendapatkan momentum di AS</a></li>
<li><a href="../id419143/index.html">Membuat mesin arcade emulator. Bagian 4</a></li>
<li><a href="../id419145/index.html">Fintech Digest: Kapitalisasi Apple melebihi $ 1 triliun, AI membantu eBay meningkatkan pendapatan hingga miliaran</a></li>
<li><a href="../id419147/index.html">Kubus 1000 dimensi: apakah mungkin untuk membuat model komputasi memori manusia saat ini?</a></li>
<li><a href="../id419149/index.html">Panduan untuk Mikrotik RoMON</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>