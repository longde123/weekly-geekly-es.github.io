<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ôüèø üê¢ üç® Mockito und wie man es kocht üò™ üò≥ ü•û</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√úber Artikel 


 Hier ist ein weiterer Leitfaden f√ºr Mockito. Darin habe ich einerseits versucht, die Funktionalit√§t dieser Bibliothek so zu beschreib...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mockito und wie man es kocht</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444982/"><h2 id="o-state">  √úber Artikel </h2><br><p>  Hier ist ein weiterer Leitfaden f√ºr Mockito.  Darin habe ich einerseits versucht, die Funktionalit√§t dieser Bibliothek so zu beschreiben, dass ein mit ihr nicht vertrauter Leser sofort die M√∂glichkeit bekam, sie vollst√§ndig zu nutzen, und nicht nur eine allgemeine Vorstellung davon.  Andererseits wollte ich es kompakt und strukturiert genug machen, damit ich es schnell in seiner Gesamtheit lesen und schnell etwas darin finden konnte, was einmal gelesen, aber vergessen wurde.  Im Allgemeinen dieser Artikel, der f√ºr mich selbst n√ºtzlich w√§re, als ich gerade auf diese Bibliothek stie√ü und nicht wirklich verstand, wie es funktioniert. </p><br><p>  Ich nehme an, es kann mir jetzt n√ºtzlich sein - manchmal vergesse ich etwas davon, und es ist am bequemsten, das Material nicht gem√§√ü der offiziellen Dokumentation oder den Artikeln anderer Leute abzurufen, sondern gem√§√ü meiner eigenen, sagen wir, Zusammenfassung.  Gleichzeitig habe ich versucht, den Text so zu gestalten, dass er vor allem dazu geeignet ist, Mockito von Grund auf neu kennenzulernen, und an einigen Stellen analysiere ich scheinbar offensichtliche Dinge im Detail - nicht alle waren mir von Anfang an klar. </p><a name="habracut"></a><br><h2 id="soderzhanie">  Inhalt: </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mockito: Was ist das und warum ist es notwendig?</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Umwelt, Versionen und Versuchstier</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">verspotten und spionieren</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Verhaltensmanagement</a> <br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anrufbedingungen einstellen</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anrufergebnisse einstellen</a> </li></ol></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tracking Method Calls</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mock-Objekte als Feldwerte und Mockito-Annotationen</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Rollback-Verhalten auf Standard- und Mockito-Sitzungen</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Was sonst?</a> </li></ol><br><h2 id="mockito-chto-eto-takoe-i-zachem-nuzhno">  Mockito: Was ist das und warum ist es notwendig? </h2><br><p>  Kurz gesagt, Mockito ist ein Stub-Framework. </p><br><p>  Wie Sie wissen, muss das zu testende Element beim Testen von Code (haupts√§chlich Unit-Tests, aber nicht nur) h√§ufig Instanzen von Klassen bereitstellen, die es beim Arbeiten verwenden sollte.  Oft m√ºssen sie jedoch nicht voll funktionsf√§hig sein - im Gegenteil, sie m√ºssen sich streng definiert verhalten, damit ihr Verhalten einfach und vollst√§ndig vorhersehbar ist.  Sie werden Stubs genannt.  Um sie zu erhalten, k√∂nnen Sie alternative Testimplementierungen von Schnittstellen erstellen, die erforderlichen Klassen mit einer Neudefinition der Funktionalit√§t erben usw. Dies alles ist jedoch recht unpraktisch, redundant und mit Fehlern behaftet.  Eine in jeder Hinsicht bequemere L√∂sung sind spezielle Frameworks zum Erstellen von Stubs.  Einer davon (und vielleicht der ber√ºhmteste f√ºr Java) ist Mockito. </p><br><p> Mit Mockito k√∂nnen Sie mit einer einzigen Codezeile den sogenannten Mock (so etwas wie die Basis f√ºr den gew√ºnschten Stub) jeder Klasse erstellen.  F√ºr einen solchen Mock ist unmittelbar nach der Erstellung ein bestimmtes Standardverhalten charakteristisch (alle Methoden geben zuvor bekannte Werte zur√ºck - normalerweise ist dies <code>null</code> oder <code>0</code> ).  Sie k√∂nnen dieses Verhalten nach Ihren W√ºnschen neu definieren, es mit dem richtigen Detaillierungsgrad steuern und so weiter.  Infolgedessen wird Mock zu einem Stub mit den erforderlichen Eigenschaften.  Im Folgenden werde ich ausf√ºhrlich erl√§utern, wie dies zu tun ist. </p><br><p>  Ich stelle fest, dass Mock auch f√ºr diese Klassen erstellt werden kann, deren neue Instanz Sie nicht nur Klassen mit ausschlie√ülich privaten Konstruktoren wie Singleton- und Utility-Klassen und mit einer minimalen Konfiguration des Frameworks und der Aufz√§hlungen erstellen k√∂nnen. </p><br><h2 id="okruzhenie-versii-i-podopytnoe-zhivotnoe">  Umwelt, Versionen und Versuchstier </h2><br><p>  Beim Schreiben dieses Artikels habe ich verwendet: </p><br><ul><li>  Mockito: 'org.mockito: mockito-core: 2.24.0' (neueste stabile Version zum Zeitpunkt des Schreibens) </li><li>  TestNG: 'org.testng: testng: 6.14.3' als Testframework </li><li>  AssertJ: 'org.assertj: assertj-core: 3.11.1' als Validierungswerkzeug </li><li>  Lombok: 'org.projectlombok: lombok: 1.18.6' (nur zur Vereinfachung) </li><li>  Java 8 </li></ul><br><p>  F√ºr meine unmenschlichen Experimente habe ich diese Schnittstelle eines Dienstes geschrieben, der den Zugriff auf bestimmte Daten erm√∂glicht. </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;String&gt; dataToSave)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String id)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String id, Supplier&lt;String&gt; calculateIfAbsent)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataListByIds</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;String&gt; idList)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataByRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DataSearchRequest request)</span></span></span></span>; }</code> </pre> <br><p>  Und dieser (der Ordnung halber) Code der Anforderungsklasse, der an die letzte der Schnittstellenmethoden √ºbergeben wurde. </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@Getter</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataSearchRequest</span></span></span><span class="hljs-class"> </span></span>{ String id; Date updatedBefore; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> length; }</code> </pre> <br><p>  Dateneinheiten werden anhand der ID identifiziert und weisen einige weitere Merkmale auf. Sie sind jedoch direkt in der Form, in der sie vom Dienst zur√ºckgegeben werden, Zeichenfolgen und keine komplexeren Objekte.  Ich vermisse nichts Wichtiges und die Beispiele sind einfacher und klarer. </p><br><p>  Ich werde sofort bemerken: In den folgenden Beispielen rufe ich die √ºberschriebenen Methoden meiner Scheinobjekte aus Gr√ºnden der Klarheit direkt auf, aber bei echten Tests ist die Idee √ºberhaupt nicht!  In diesem Test w√ºrde ich konsequent Folgendes tun: </p><br><ul><li>  konfigurierte den Mock meines Dienstes nach Bedarf; </li><li>  hat es (h√∂chstwahrscheinlich √ºber den Konstruktor) an eine Instanz einer anderen Klasse √ºbergeben, die es verwendet (angenommen, es enth√§lt eine Art Gesch√§ftslogik unter Verwendung der vom <code>DataService</code> bereitgestellten <code>DataService</code> ), die ich tats√§chlich testen w√ºrde; </li><li>  aktivierte die Funktionalit√§t der getesteten Klasse und kontrollierte die Ergebnisse; </li><li>  Bei Bedarf w√ºrde ich die Anzahl und Reihenfolge der Aufrufe der Methode (n) meines Modells steuern, die von der getesteten Klasse als Ergebnis der vorherigen Aktion aufgerufen werden sollten. </li></ul><br><h2 id="mock-i-spy">  verspotten und spionieren </h2><br><p>  Die zentrale Klasse von Mockito, √ºber die auf die meisten Funktionen <code>BDDMockito</code> soll, ist in der Tat eine Klasse namens <code>Mockito</code> (es gibt auch die <code>BDDMockito</code> Klasse, die ungef√§hr die gleichen M√∂glichkeiten in einer f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">BDD</a> besser geeigneten Form bietet, aber hier werde ich nicht weiter darauf eingehen). .  Der Zugriff auf die Funktionalit√§t erfolgt √ºber statische Methoden. </p><br><p>  Um ein <code>DataService</code> der <code>DataService</code> Klasse zu erstellen, muss ich nur Folgendes tun: </p><br><pre> <code class="java hljs">DataService dataServiceMock = Mockito.mock(DataService.class);</code> </pre> <br><p>  Fertig - Ich habe eine Instanz der Klasse, die ich brauche.  Es wird von jeder Methode oder jedem Konstruktor akzeptiert, f√ºr die ein Parameter dieses Typs erforderlich ist (z. B. der Konstruktor der Klasse, die ich testen m√∂chte).  Selbst wenn eine <code>instanceof DataService</code> sp√§ter darauf wartet, wird sie bestanden: Nicht nur die <code>instanceof DataService</code> gibt <code>true</code> , sondern auch <code>dataServiceMock.getClass()</code> - n√§mlich <code>DataService.class</code> .  In gewisser formaler Weise stellt sich heraus, dass die programmatische Unterscheidung eines Scheinobjekts von einem gew√∂hnlichen eine ziemlich schwierige Aufgabe ist, was logisch ist: Schlie√ülich soll die erste nur von der zweiten nicht zu unterscheiden sein.  Mockito verf√ºgt jedoch √ºber ein Tool daf√ºr - die <code>Mockito.mockingDetails</code> Methode.  Wenn ich ein beliebiges Objekt √ºbergebe, erhalte ich ein Objekt der <code>MockingDetails</code> Klasse.  Es enth√§lt Informationen dar√ºber, was dieses Objekt aus Sicht von Mockito darstellt: ob es sich um eine Schein- oder Spionage handelt (siehe unten), wie es verwendet wurde, wie es erstellt wurde und so weiter. </p><br><p>  Besonders hervorzuheben ist die Situation, in der ich versuche, ein Modell f√ºr die letzte Klasse oder eine Scheininstanz von enum zu erstellen oder das Verhalten der endg√ºltigen Methode zu √ºberschreiben.  In diesem Fall weigert sich der obige Code mit dem Standardverhalten von Mockito, genau unter diesen Umst√§nden zu funktionieren.  Dies kann jedoch ge√§ndert werden. Erstellen Sie einfach im Projekt (mit dem Standardger√§t des Projektverzeichnisbaums) die Datei <code>test/resources/mockito-extensions/org.mockito.plugins.MockMaker</code> und geben Sie die folgende Zeile ein: </p><br><pre> <code class="plaintext hljs">mock-maker-inline</code> </pre> <br><p>  Danach k√∂nnen Sie die endg√ºltigen Klassen und Aufz√§hlungen auf die √ºbliche Weise nachahmen und die endg√ºltigen Methoden √ºberschreiben. </p><br><p>  Das Modell, das ich in Aktion gesetzt habe, ist so merkw√ºrdig wie m√∂glich: Keine einzige Methode hat Auswirkungen auf irgendetwas, und der zur√ºckgegebene Wert ist f√ºr Objekttypen <code>null</code> und f√ºr primitive <code>0</code> .  Bitte beachten Sie: Wenn die Methode eine Sammlung zur√ºckgibt, gibt das Standardmodell keine <code>null</code> , sondern leere Sammlungsinstanzen.  F√ºr <code>List</code> sich beispielsweise heraus, dass dies eine leere <code>LinkedList</code> unabh√§ngig davon, was die reale Methode h√§tte zur√ºckgeben sollen.  Aber als Werte von Arrays, Grundelementen oder Objekten erhalte ich <code>null</code> .  Das Standardverhalten (und nicht nur das Verhalten) kann mithilfe der Funktionalit√§t der <code>MockSettings</code> Klasse ge√§ndert werden. Dies ist jedoch selten erforderlich. </p><br><p>  Auf die eine oder andere Weise ben√∂tige ich in den meisten F√§llen nicht das Standardverhalten, und im n√§chsten Abschnitt werde ich detailliert analysieren, wie stattdessen festgelegt wird, was stattdessen erforderlich ist. </p><br><p>  Was ist jedoch, wenn ich ein reales Klassenobjekt mit der verf√ºgbaren Funktionalit√§t als Stub verwenden m√∂chte, um die Funktionsweise nur eines Teils seiner Methoden neu zu definieren?  Wenn es sich um Unit-Tests handelt, weist ein solcher Bedarf normalerweise (aber nicht immer) darauf hin, dass das Projekt mit dem Design nicht in Ordnung ist, und dies wird im Prinzip nicht empfohlen.  Es gibt jedoch Situationen, in denen dies aus irgendeinem Grund nicht vermieden werden kann.  In diesem Fall hat Mockito den sogenannten Spion "Spione".  Im Gegensatz zu Mocks k√∂nnen sie sowohl basierend auf der Klasse als auch auf dem fertigen Objekt erstellt werden: </p><br><pre> <code class="java hljs">DataService dataServiceSpy = Mockito.spy(DataService.class); <span class="hljs-comment"><span class="hljs-comment">// or DataService dataService = new DataService(); dataServiceSpy = Mockito.spy(dataService);</span></span></code> </pre> <br><p>  Wenn beim Erstellen eines Spions basierend auf einer Klasse ein Typ eine Schnittstelle ist, wird ein regul√§res Scheinobjekt erstellt. Wenn der Typ eine Klasse ist, versucht Mockito, eine Instanz mit dem Standardkonstruktor (ohne Parameter) zu erstellen.  Und nur wenn es keinen solchen Konstruktor gibt, tritt ein Fehler auf und der Test funktioniert nicht. </p><br><p>  Das Verhalten von Spionageobjekten ist standardm√§√üig identisch mit dem Verhalten einer regul√§ren Klasseninstanz, bietet mir jedoch die gleichen M√∂glichkeiten wie Scheinobjekte: Sie erm√∂glichen mir, ihr Verhalten neu zu definieren und ihre Verwendung zu √ºberwachen (siehe die folgenden Abschnitte).  Ein wichtiger Punkt: Spion ist kein Wrapper um die Instanz, auf der er erstellt wurde!  Daher hat der Aufruf der Spionagemethode keinen Einfluss auf den Status der urspr√ºnglichen Instanz. </p><br><h2 id="upravlenie-povedeniem">  Verhaltensmanagement </h2><br><p>  Also, wie man sich l√§cherlich macht oder ausspioniert, um das zu tun, was ich brauche.  Au√üerdem werde ich √ºberall einfach "verspotten" schreiben - dies bedeutet "verspotten oder spionieren", sofern nicht ausdr√ºcklich anders angegeben. </p><br><p>  Im Allgemeinen beruht die Steuerung des Verhaltens eines Scheinobjekts auf einem offensichtlichen Konzept: Wenn ein Schein auf diese Weise beeinflusst wurde (dh eine solche und eine solche Methode wurde mit solchen und solchen Argumenten aufgerufen), sollte er auf diese und jene Weise reagieren.  Dieses Konzept hat zwei Implementierungen innerhalb der Mockito-Klasse - die Hauptimplementierung, die von Entwicklern empfohlen wird, wo immer dies m√∂glich ist, und die alternative, die verwendet wird, wenn die Hauptkonzeption nicht geeignet ist. </p><br><p>  Die Hauptimplementierung basiert auf der Methode <code>Mockito.when</code> .  Diese Methode nimmt als "Parameter" einen Aufruf der neu definierten Methode des <code>OngoingStubbing</code> (auf diese Weise wird die erkannte Aktion behoben) und gibt ein Objekt vom Typ <code>OngoingStubbing</code> , mit dem eine der Methoden der <code>Mockito.then...</code> -Familie <code>Mockito.then...</code> (so wird die Reaktion auf diesen Effekt festgelegt).  Alles in allem sieht es im einfachsten Fall ungef√§hr so ‚Äã‚Äãaus: </p><br><pre> <code class="java hljs">List&lt;String&gt; data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); data.add(<span class="hljs-string"><span class="hljs-string">"dataItem"</span></span>); Mockito.when(dataService.getAllData()).thenReturn(data);</code> </pre> <br><p>  Nach dieser Operation <code>getAllData()</code> ich durch Aufrufen der Methode <code>getAllData()</code> f√ºr das <code>getAllData()</code> Objekt das in der ersten Zeile der Liste angegebene Objekt. </p><br><p>  Hier kann die vertraute "objektorientierte" Intuition zu einer Fehlfunktion f√ºhren, weshalb es sich lohnt, n√§her darauf einzugehen.  Aus Sicht der Java-Syntax ist der an die <code>when</code> Methode als Parameter √ºbergebene Wert nat√ºrlich der Wert, der von der √ºberschriebenen Methode zur√ºckgegeben wird.  F√ºr mock ist dies ein leerer Wert, f√ºr spy ist dies der Wert, der von der Methode des realen Objekts zur√ºckgegeben wird.  Dank der Magie, die ‚Äûunter der Haube‚Äú von Mockito wirkt, funktioniert die <code>when</code> Methode jedoch nur dann normal (und st√ºrzt beim Starten mit einem Fehler nicht ab), wenn sich der Aufruf der Mock-Object-Methode nach dem <code>when</code> in den Klammern befindet. </p><br><p>  Eine √§hnliche Ideologie funktioniert h√§ufig, wenn das Verhalten eines Mocks in einem Mockito definiert wird: Durch Aufrufen einer Methode (eines Mock-Objekts oder einer Klasse des <code>Mockito</code> ) versuche ich, den von ihm zur√ºckgegebenen Wert nicht zu erhalten, sondern irgendwie den m√∂glichen Aufruf der Methode des Mock-Objekts zu beeinflussen, mit dem ich arbeite: angeben seine Grenzen, das Ergebnis festlegen, die Beobachtung seiner Herausforderungen festlegen und so weiter.  Ich gebe zu, es klingt ein bisschen neblig, und bei der ersten Kollision sieht es seltsam aus, aber nachdem Sie es herausgefunden haben, werden Sie diesen Ansatz im Zusammenhang mit der Arbeit mit Stubs bald als v√∂llig nat√ºrlich empfinden. </p><br><p>  Eine alternative Implementierung zum Verkn√ºpfen der Bedingung und des Ergebnisses des Aufrufs sind die Methoden der <code>Mockito.do...</code> -Familie.  Mit diesen Methoden k√∂nnen Sie das Verhalten beginnend mit dem Ergebnis des Aufrufs festlegen und ein Objekt der <code>Stubber</code> Klasse zur√ºckgeben, mit dem Sie die Bedingung bereits festlegen k√∂nnen.  Die gleiche Bindung wie oben auf diese Weise sieht folgenderma√üen aus: </p><br><pre> <code class="java hljs">List&lt;String&gt; data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); data.add(<span class="hljs-string"><span class="hljs-string">"dataItem"</span></span>); Mockito.doReturn(data).when(dataService).getData()</code> </pre> <br><p>  Was ist der Unterschied, warum das Binden √ºber <code>Mockito.when</code> als vorzuziehen angesehen wird und wann Sie noch die Methoden von <code>Mockito.do...</code> ?  Bitte beachten Sie: In der ersten Implementierung wird beim Festlegen des Verhaltens der Methode (in diesem Fall <code>getAllData()</code> ) zuerst der Aufruf der noch nicht neu definierten Version ausgef√ºhrt, und erst dann tritt im Darm von Mockito eine √úberschreibung auf.  Im zweiten Fall tritt ein solcher Aufruf nicht auf - die <code>Stubber.when</code> Methode <code>Stubber.when</code> direkt an die <code>Stubber.when</code> Methode √ºbergeben, und ein Objekt desselben Typs, das von dieser Methode zur√ºckgegeben wird, aber anderer Art ist, wird mit einer √ºberschreibbaren Methode aufgerufen.  Dieser Unterschied bestimmt alles.  Die Bindung √ºber <code>Mockito.do...</code> steuert zur Kompilierungszeit nicht, welche neu definierbare Methode ich aufrufen werde und ob sie mit dem angegebenen R√ºckgabewert typkompatibel ist.  Daher ist normalerweise <code>Mockito.when</code> vorzuziehen - daran kann kein Fehler liegen.  Es kann jedoch F√§lle geben, in denen ich vermeiden m√∂chte, eine √ºberschriebene Methode aufzurufen. F√ºr einen frisch erstellten Mock ist ein solcher Aufruf durchaus akzeptabel. Wenn ich diese Methode jedoch bereits neu definiert habe oder mich mit Spionage befasse, ist dies m√∂glicherweise unerw√ºnscht, und das Ausl√∂sen einer Ausnahme l√§sst die erforderliche Neudefinition √ºberhaupt nicht zu .  Und hier kommt die Bindung durch <code>Mockito.do...</code> zur <code>Mockito.do...</code> </p><br><p>  Eine andere Situation, in der Sie nicht auf die Methoden <code>Mockito.do...</code> k√∂nnen, ist das √úberschreiben der Methode, die <code>void</code> <code>Mockito.when</code> : Der ausstehende Parameter <code>Mockito.when</code> kann mit einer solchen Methode nicht funktionieren.  <code>Mockito.doReturn</code> , aber es gibt <code>Mockito.doThrow</code> , <code>Mockito.doAnswer</code> und selten genug <code>Mockito.doNothing</code> . </p><br><p>  Als n√§chstes werde ich etwas detaillierter √ºberlegen, wie die Bedingungen und Ergebnisse von Anrufen festgelegt werden.  Ich werde nur in Betracht ziehen, √ºber <code>Mockito.when</code> binden. <code>Mockito.when</code> ein alternativer Weg in der Handhabung fast v√∂llig √§hnlich ist. </p><br><h3 id="zadanie-usloviy-vyzova">  Anrufbedingungen einstellen </h3><br><p>  Das obige Beispiel betrifft eine Methode ohne Parameter, und die zugeh√∂rige Aufrufbedingung ist eines m√∂glich - die Tatsache des Aufrufs.  Sobald Parameter erscheinen, wird die Situation komplizierter.  Um eine Methode aufzurufen, deren Verhalten ich einstelle, muss ich mindestens etwas an sie √ºbergeben.  Aber noch etwas ist wichtiger: Es kann sich herausstellen, dass ich nicht immer die gegebene Reaktion erhalten m√∂chte, sondern nur, wenn ich sie mit Parametern aufrufe, die bestimmte Anforderungen erf√ºllen.  <code>DataService</code> hat folgende Methode: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataItemById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// some code... }</span></span></code> </pre> <br><p>  Wenn ich unabh√§ngig von den Argumenten eine Antwort auf einen Aufruf dieser Methode <code>Mockito.any</code> muss, muss ich die Methode <code>Mockito.any</code> verwenden: </p><br><pre> <code class="java hljs">Mockito.when(dataService.getDataItemById(any())) .thenReturn(<span class="hljs-string"><span class="hljs-string">"dataItem"</span></span>);</code> </pre> <br><p>  Wenn ich Mock brauche, um nur auf einen bestimmten Wert des Arguments zu reagieren, k√∂nnen Sie diesen Wert direkt oder die Methoden von <code>Mockito.eq</code> (wenn es sich um eine √Ñquivalenz handelt) oder <code>Mockito.same</code> (wenn ein <code>Mockito.same</code> erforderlich ist) verwenden: </p><br><pre> <code class="java hljs">Mockito.when(dataService.getDataItemById(<span class="hljs-string"><span class="hljs-string">"idValue"</span></span>)) .thenReturn(<span class="hljs-string"><span class="hljs-string">"dataItem"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// or Mockito.when(dataService.getDataItemById(Mockito.eq("idValue"))) .thenReturn("dataItem");</span></span></code> </pre> <br><p>  Und wenn ich m√∂chte, dass das Argument einige Anforderungen erf√ºllt, gibt es eine Reihe praktischer statischer Methoden derselben <code>Mockito</code> Klasse (z. B. k√∂nnen Zeichenfolgen am Anfang oder am Ende einer bestimmten Zeichenfolge, beim Mustervergleich usw. auf Inhalt √ºberpr√ºft werden).  Es gibt auch eine allgemeine Methode Mockito.argThat (und ihre Analoga f√ºr primitive Typen), die die Implementierung der ArgumentMatcher-Funktionsschnittstelle akzeptiert: </p><br><pre> <code class="java hljs">Mockito.when(dataService.getDataById( Mockito.argThat(arg -&gt; arg == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || arg.length() &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>))) .thenReturn(<span class="hljs-string"><span class="hljs-string">"dataItem"</span></span>);</code> </pre> <br><p>  Mit den Klassen <code>ArgumentMatchers</code> und <code>AdditionalMatchers</code> k√∂nnen Sie mit einigen n√ºtzlichen Standardimplementierungen dieser Schnittstelle arbeiten.  Mit <code>AdditionalMatchers.or</code> und <code>AdditionalMatchers.and</code> k√∂nnen Sie beispielsweise andere Matcher kombinieren (Hinweis: Die statischen Methoden dieser Klassen geben keine Instanzen von Matchern zur√ºck, sondern greifen nur darauf zu!). </p><br><p>  F√ºr dieselbe Methode k√∂nnen Sie das Verhalten mehrmals mit unterschiedlichen Anforderungen an die Argumente festlegen, und alle auf diese Weise definierten Verhaltensmodelle wirken gleichzeitig.  In einigen F√§llen k√∂nnen sie sich nat√ºrlich √ºberschneiden. Ich werde beispielsweise verlangen, ein Ergebnis zur√ºckzugeben, wenn der <code>int</code> Wert des Parameters kleiner als 5 ist, und das andere, wenn der gerade Wert empfangen wird.  In dieser Situation hat das sp√§ter angegebene Verhalten Vorrang.  Wenn Sie komplexe Verhaltensmuster definieren, sollten Sie daher mit den schw√§chsten Anforderungen (im Limit - <code>any()</code> ) beginnen und erst dann zu spezifischeren √ºbergehen. </p><br><p>  Bei der Arbeit mit Methoden mit mehr als einem Argument werden die angegebenen Anforderungen gem√§√ü dem logischen UND kombiniert. Das hei√üt, um das angegebene Ergebnis zu erhalten, muss JEDES der Argumente die angegebene Anforderung erf√ºllen.  Ich habe keinen Weg gefunden, einen willk√ºrlichen Weg zu finden, um sie zu kombinieren, obwohl es vielleicht existiert. </p><br><p>  Wenn man das Verhalten einer solchen Methode spezifiziert, kann man au√üerdem die statischen <code>Mockito</code> Methoden nicht <code>Mockito</code> und der direkten √úbertragung von Werten kombinieren.  Verwenden Sie <code>Mockito.eq</code> oder <code>Mockito.same</code> . </p><br><h3 id="zadanie-rezultatov-vyzova">  Anrufergebnisse einstellen </h3><br><p>  Nach dem Aufruf der Mock-Object-Methode muss das Objekt auf den Aufruf antworten.  Die wichtigsten m√∂glichen Konsequenzen sind die R√ºckgabe des Ergebnisses und das Ausl√∂sen einer Ausnahme. Genau f√ºr diese Optionen wurde das Mockito-Toolkit in erster Linie entwickelt. </p><br><p>  Im einfachsten Fall, der oben bereits gezeigt wurde, besteht die Antwort auf den Aufruf darin, einen Wert zur√ºckzugeben.  Ich werde seinen Code noch einmal geben: </p><br><pre> <code class="java hljs">List&lt;String&gt; data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); data.add(<span class="hljs-string"><span class="hljs-string">"dataItem"</span></span>); Mockito.when(dataService.getAllData()).thenReturn(data);</code> </pre> <br><p>  Bitte beachten Sie: Sie k√∂nnen nur ein Objekt zur√ºckgeben, es gibt keine separaten Methoden f√ºr Grundelemente.  Wenn die Methode einen primitiven Wert zur√ºckgibt, tritt in einer solchen Situation ein Un / Boxing auf.  In den meisten F√§llen st√∂rt dies nicht, aber wenn der Compiler anders denkt, m√ºssen Sie ihm irgendwie zustimmen ... oder seine Warnungen ertragen. </p><br><p>  Ausnahmen zu werfen ist nicht schwerer: </p><br><pre> <code class="java hljs">Mockito.when(dataService.getDataById(<span class="hljs-string"><span class="hljs-string">"invalidId"</span></span>)) .thenThrow(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException());</code> </pre> <br><p>  Es gibt noch einen anderen Weg: Sie k√∂nnen ein Ausnahmeobjekt erstellen und direkt ausl√∂sen, oder Sie k√∂nnen Mockito nur eine Ausnahmeklasse zur Verf√ºgung stellen, damit es automatisch erstellt wird: </p><br><pre> <code class="java hljs">Mockito.when(dataService.getDataById(<span class="hljs-string"><span class="hljs-string">"invalidId"</span></span>)) .thenThrow(IllegalArgumentException.class);</code> </pre> <br><p>  In beiden F√§llen k√∂nnen Sie mit der Syntax Ausnahmen verwenden und √ºberpr√ºfen, aber mit Mockito k√∂nnen Sie einen solchen Test nicht ausf√ºhren, wenn der Ausnahmetyp nicht mit der Methode √ºbereinstimmt, mit der ich das Ausl√∂sen dieser Ausnahme erzwingen m√∂chte. </p><br><p>  Bei Verwendung einer Klasse als Parameter werden Konstruktoren (auch ohne Parameter) sowie die direkte Feldinitialisierung ignoriert - das Objekt wird unter Umgehung erstellt (schlie√ülich ist dies Mockito!), Sodass alle Felder der ausgel√∂sten Ausnahme <code>null</code> .  Wenn Ihnen der Inhalt der Ausnahme wichtig ist (z. B. ein Typfeld mit einem Standardwert), m√ºssen Sie diese Methode abbrechen und Ausnahmen manuell erstellen. </p><br><p>  Diese Reaktionsoptionen sind geeignet, wenn Sie als Antwort auf einen Anruf mit bestimmten Bedingungen immer einen bestimmten, immer den gleichen Wert des Ergebnisses zur√ºckgeben oder immer die gleiche Ausnahme ausl√∂sen m√ºssen, und in den meisten F√§llen sind diese Funktionen v√∂llig ausreichend.  Was aber, wenn mehr Flexibilit√§t erforderlich ist?  Angenommen, meine Methode akzeptiert eine Sammlung von Werten und gibt eine weitere Sammlung von Werten zur√ºck, die dem ersten zu eins zugeordnet sind (z. B. Abrufen einer Sammlung von Datenobjekten anhand der Menge ihrer IDs), und ich m√∂chte dieses Scheinobjekt wiederholt mit verschiedenen Eingabes√§tzen im Test verwenden Daten, jedes Mal das entsprechende Ergebnis erhalten.  Sie k√∂nnen die Reaktion auf jeden bestimmten Parametersatz nat√ºrlich separat beschreiben, aber es gibt eine bequemere L√∂sung - die <code>Mockito.thenAnswer</code> Methode, auch bekannt als <code>Mockito.then</code> .  Es akzeptiert eine Implementierung der <code>Answer</code> Funktionsschnittstelle, deren einzige Methode darin besteht, ein Objekt der <code>InvocationOnMock</code> Klasse zu empfangen.  Von letzterem kann ich die Parameter des Methodenaufrufs anfordern (einer nach Nummer oder alle gleichzeitig in Form eines Arrays) und mit ihnen nach Belieben handeln.  Sie k√∂nnen beispielsweise f√ºr jedes Element meiner Sammlung einen entsprechenden Wert abrufen, daraus eine neue Sammlung bilden und diese zur√ºckgeben (Hinweis: Das gew√ºnschte Ergebnis wird einfach zur√ºckgegeben und nicht wie erwartet in ein Feld des Parameterobjekts geschrieben): </p><br><pre> <code class="java hljs">Mockito.when(dataService.getDataByIds(Mockito.any())) .thenAnswer(invocation -&gt; invocation .&lt;List&lt;String&gt;&gt;getArgument(<span class="hljs-number"><span class="hljs-number">0</span></span>).stream() .map(id -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (id) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"a"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"dataItemA"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"dataItemB"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } }) .collect(Collectors.toList()));</code> </pre> <br><p>  Ideologisch ist dies so etwas wie das Schreiben eines Modells einer realen Methode: Parameter abrufen, verarbeiten, ein Ergebnis zur√ºckgeben.          -  ,    - ,      ,     ,    mock-    . </p><br><p>     <code>Answer</code> ,     , ‚Äî , <code>AnswersWithDelay</code> , <code>ReturnsElementsOf</code>  . . </p><br><p>  :  <code>InvocationOnMock</code>   ‚Äî       <code>Object[]</code> ,  generic-. </p><br><p>        ‚Äî <code>thenCallRealMethod</code> .    .     mock-,    spy-.   mock   ,      ,  -   <code>null</code> .  spy   <code>thenCallRealMethod</code>     spy  ;    ,     -      . </p><br><p>        <code>thenAnswer</code> :  <code>InvocationOnMock</code>   <code>callRealMethod()</code> ‚Äî   ,   ""    -  . </p><br><p>    <code>OngoingStubbing</code>    <code>OngoingStubbing</code> ,  ,   ,     .            ,   .  <code>thenReturn</code>  <code>thenThrow</code>   ,  varargs.       . </p><br><pre> <code class="java hljs">Mockito.when(dataService.getDataById(<span class="hljs-string"><span class="hljs-string">"a"</span></span>)) .thenReturn(<span class="hljs-string"><span class="hljs-string">"valueA1"</span></span>, <span class="hljs-string"><span class="hljs-string">"valueA2"</span></span>) .thenThrow(IllegalArgumentException.class);</code> </pre> <br><p>         <code>"valueA1</code> ,  ‚Äî <code>"valueA2</code> ( ),   (  )    <code>IllegalArgumentException</code> . </p><br><h2 id="slezhenie-za-vyzovami-metodov">     </h2><br><p>        :          (mock'    ),     .   ,     :   ,          ,       .      <code>verify</code> . </p><br><p>  ,           ,  : </p><br><pre> <code class="java hljs">Mockito.verify(dataService).getDataById(Mockito.any());</code> </pre> <br><p>      ,            <code>getDataById</code> ,  ,           . ,             Mockito,      <code>when</code> ,   ,  ,         mock-. , ,  ,      <code>when</code>  , ‚Äî      mock',       (. ). </p><br><p>           : </p><br><pre> <code class="plaintext hljs">Mockito.verify(dataService, Mockito.times(1)) .getDataById(Mockito.any());</code> </pre> <br><p>           <code>Mockito.times</code> ;       <code>Mockito.never</code> .    <code>Mockito.atLeast</code> (  <code>Mockito.atLeastOnce</code>   1)  <code>Mockito.atMost</code> ,       ,    <code>Mockito.only</code> , ,         mock-  (. .     ). </p><br><p>  ,         <code>Mockito</code> ,     <code>VerificationAfterDelay</code>  <code>VerificationWithTimeout</code> ,    <code>Mockito.after</code>  <code>Mockito.timeout</code> .  Zum Beispiel: </p><br><pre> <code class="plaintext hljs">Mockito.verify(dataService, Mockito.after(1000).times(1)) .getDataById(Mockito.any());</code> </pre> <br><p>    ,    mock   ,      ,              ,       .        .   <code>after</code>  <code>timeout</code>  ,          ,    ,    ‚Äî   ,     .  ,   <code>timeout</code>         ‚Äî       .   <code>VerificationWithTimeout</code>   <code>never</code>  <code>atMost</code> :         . </p><br><p>  ,             <code>Mockito.any()</code> .          ,   ,     ‚Äî    Mockito       ,    ,     . Mock-     ,        ,   , , : </p><br><pre> <code class="java hljs">dataService.getDataById(<span class="hljs-string"><span class="hljs-string">"a"</span></span>); dataService.getDataById(<span class="hljs-string"><span class="hljs-string">"b"</span></span>); Mockito.verify(dataService, Mockito.times(<span class="hljs-number"><span class="hljs-number">2</span></span>)).getDataById(Mockito.any()); Mockito.verify(dataService, Mockito.times(<span class="hljs-number"><span class="hljs-number">1</span></span>)).getDataById(<span class="hljs-string"><span class="hljs-string">"a"</span></span>); Mockito.verify(dataService, Mockito.never()).getDataById(<span class="hljs-string"><span class="hljs-string">"c"</span></span>); dataService.getDataById(<span class="hljs-string"><span class="hljs-string">"c"</span></span>); Mockito.verify(dataService, Mockito.times(<span class="hljs-number"><span class="hljs-number">1</span></span>)).getDataById(<span class="hljs-string"><span class="hljs-string">"c"</span></span>); Mockito.verifyNoMoreInteractions(dataService);</code> </pre> <br><p>      <code>verifyNoMoreInteractions</code> (  <code>verifyZeroInteractions</code> ) ‚Äî    -  (            <code>verify</code> )    mock- ‚Äî    .  :   varargs,     ,     ,         <strong> </strong> ! </p><br><p>       ,   ,      ,     .   ,    <code>InOrder</code> : </p><br><pre> <code class="java hljs">InOrder inOrder = Mockito.inOrder(dataService);</code> </pre> <br><p>     varargs;     ‚Äî    mock-   ,    <code>InOrder</code>                .     <code>verify</code>    ,   <code>Mockito.verify</code> : </p><br><pre> <code class="java hljs">inOrder.verify(dataService, times(<span class="hljs-number"><span class="hljs-number">2</span></span>)).saveData(any()); inOrder.verify(dataService).getData();</code> </pre> <br><p>       ,         <code>saveData</code> , <strong> </strong>  ‚Äî <code>getData</code> .  ,   <code>InOrder</code>    ,      ‚Äî     . </p><br><p>       ,   ,       ‚Äî , .      -      ,    ,      ‚Äî  ,     ,    .     <code>ArgumentCaptor</code>    <code>capture()</code> .  Zum Beispiel: </p><br><pre> <code class="java hljs">DataSearchRequest request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataSearchRequest(<span class="hljs-string"><span class="hljs-string">"idValue"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Date(System.currentTimeMillis()), <span class="hljs-number"><span class="hljs-number">50</span></span>); dataService.getDataByRequest(request); ArgumentCaptor&lt;DataSearchRequest&gt; requestCaptor = ArgumentCaptor.forClass(DataSearchRequest.class); Mockito.verify(dataService, times(<span class="hljs-number"><span class="hljs-number">1</span></span>)).getDataByRequest(requestCaptor.capture()); assertThat(requestCaptor.getAllValues()).hasSize(<span class="hljs-number"><span class="hljs-number">1</span></span>); DataSearchRequest capturedArgument = requestCaptor.getValue(); assertThat(capturedArgument.getId()).isNotNull(); assertThat(capturedArgument.getId()).isEqualTo(<span class="hljs-string"><span class="hljs-string">"idValue"</span></span>); assertThat(capturedArgument.getUpdatedBefore()).isAfterYear(<span class="hljs-number"><span class="hljs-number">1970</span></span>); assertThat(capturedArgument.getLength()).isBetween(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>);</code> </pre> <br><p> <code>ArgumentCaptor</code>       ,      <strong> </strong> ,   <code>ArgumentCaptor</code>  . <code>getValue()</code>    , <code>getAllValues()</code> ‚Äî     .   ,         ,   . </p><br><h2 id="mock-obekty-kak-znacheniya-poley-i-annotacii-mockito"> Mock-      Mockito </h2><br><p>      ,     mock-   ,      ‚Äî     <code>@Mock</code>   -       : </p><br><pre> <code class="java hljs">MockitoAnnotations.initMocks(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre> <br><p> (  ,       mock',       ) </p><br><p>  spy   <code>@Spy</code> ‚Äî     <code>@Mock</code> ‚Ä¶   spy   ,      , ?          ,      ‚Äî  spy     . </p><br><p>   <code>@Captor</code>    <code>ArgumentCaptor</code> ‚Äî   , ,    . </p><br><p>   <code>@InjectMocks</code> .       -  Mockito,          .       mock-   ,   .        ,    .  -     ,     <code>null</code> ,   -     .         (      )  dependency injection. </p><br><h2 id="otkat-povedeniya-k-defoltnomu-i-sessii-mockito">       Mockito </h2><br><p>         ,  :   mock (spy, argument captor...),   ,    , .    ,  mock' ‚Äî    ,    . JUnit           ,      ,    TestNG   ‚Äî       . , ,   mock'    ,     ,   ,         . .  ,  ,  ‚Äî  ,          . </p><br><p>   ,             mock-    .  TestNG     <code>@BeforeMethod</code> ( <code>@AfterMethod</code>  ).           mock'   ,        ,           (    JUnit ‚Äî      <code>@Before</code> ). </p><br><p>   ,     , ‚Äî   <code>Mockito.reset</code>  <code>Mockito.clearInvocations</code> .   varargs,      mock'.      ,    .     :     (,              )  ,   /   mock'    , ‚Äî       .     ,    mock'       . .      , ,             . </p><br><p>       (,  ) ‚Äî     <code>MockitoAnnotations.initMocks(this);</code>  .    ""  ,   Mockito. </p><br><p>    ‚Äî     Mockito.    .     mock- ,          ( mock'      ).          ,      <code>MockitoSession</code> ,           .     TestNG: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Mock</span></span> DataService dataService; MockitoSession session; <span class="hljs-meta"><span class="hljs-meta">@BeforeMethod</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beforeMethod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ session = Mockito.mockitoSession() .initMocks(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) .startMocking(); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testMethod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// some code using the dataService field } @AfterMethod public void afterMethod() { session.finishMocking(); }</span></span></code> </pre> <br><p>  ,        ‚Äî  ,  "" (,     )  ,   . </p><br><h2 id="chto-eschyo">  ? </h2><br><p>      Mockito:  mock  spy-,        .      ,       .  ,  , : </p><br><ul><li>  Mockito   mock-   <code>MockSettings</code> (      ‚Äî ,   mock'    -  ); </li><li>     mock-,   <code>MockingDetails</code> ; </li><li>   <code>BDDMockito</code>   <code>Mockito</code> ; </li><li>     (    JUnit       Mockito,     ). </li></ul><br><p>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  Mockito</a> .           javadoc'  <code>Mockito</code> . </p><br><p> , ,  . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de444982/">https://habr.com/ru/post/de444982/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de444972/index.html">Intel Gen11 GPU-Architektur und diskrete Grafikkarte von Intel</a></li>
<li><a href="../de444974/index.html">Kryptographie in Java. Klasse MessageDigest</a></li>
<li><a href="../de444976/index.html">Quester - Plattform zum Erstellen und Abschlie√üen von Quests (Beta)</a></li>
<li><a href="../de444978/index.html">Die EU-Beh√∂rden haben Google mit einer Geldstrafe von 1,7 Milliarden US-Dollar belegt, weil sie Anzeigen von Wettbewerbern blockiert haben</a></li>
<li><a href="../de444980/index.html">Analysieren eines kritischen Fehlers im KIB SEARCHINFORM-Verschl√ºsselungsalgorithmus</a></li>
<li><a href="../de444984/index.html">Woher kommen Fotos zum Testen von Gesichtserkennungssystemen?</a></li>
<li><a href="../de444986/index.html">IETF genehmigt ACME - Dies ist der Standard f√ºr die Arbeit mit SSL-Zertifikaten</a></li>
<li><a href="../de444992/index.html">In das System integrierte Fehler: ihre Rolle in der Statistik</a></li>
<li><a href="../de444994/index.html">√úber Laufwerke und deren Verwendung auf modernen Computern</a></li>
<li><a href="../de444996/index.html">Redis Streams als saubere Datenstruktur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>