<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèåÔ∏è üëêüèº ü§æ ShIoTiny: ventilaci√≥n de habitaci√≥n h√∫meda (proyecto de ejemplo) üÜö ‚è¨ üë©üèø‚Äç‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Puntos clave o de qu√© trata este art√≠culo 
 Continuamos la serie de art√≠culos sobre ShIoTiny , un controlador visualmente programable basado en el chi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ShIoTiny: ventilaci√≥n de habitaci√≥n h√∫meda (proyecto de ejemplo)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464485/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ue/so/ox/uesoox7zwrguyei6o5m_ndp2ufw.jpeg"></div><br><h4>  Puntos clave o de qu√© trata este art√≠culo </h4><br>  Continuamos la serie de art√≠culos sobre <b>ShIoTiny</b> , un controlador visualmente programable basado en el chip <b>ESP8266</b> . <br><br>  Este art√≠culo describe un ejemplo de un proyecto de control de ventilaci√≥n en un ba√±o u otra habitaci√≥n h√∫meda sobre c√≥mo crear un programa para <b>ShIoTiny</b> . <br><br><h4>  Art√≠culos anteriores de la serie. </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ShIoTiny: peque√±a automatizaci√≥n, Internet de las cosas o "seis meses antes de las vacaciones"</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ShIoTiny: nodos, enlaces y eventos o caracter√≠sticas de programas de dibujo</a> <br><br><h4>  Referencias </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><b>Sitio del</b> proyecto <b>ShIoTiny</b></a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Firmware binario, circuitos del controlador y documentaci√≥n</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Instrucciones y descripci√≥n de nodos.</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Configuraci√≥n del broker MQTT cloudmqtt.com</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Panel de control del tablero de instrumentos MQTT para Android</a> <br><a name="habracut"></a><br><h4>  Introduccion </h4><br>  No hay comprensi√≥n fuera de la experiencia.  Esta es la verdad probada por el tiempo y las generaciones.  Por lo tanto, no hay nada mejor para aprender habilidades pr√°cticas que tratar de hacer algo por su cuenta.  Y ejemplos que muestran lo que se puede hacer y lo que no vale la pena probar, aqu√≠ ser√°n √∫tiles.  Los errores de otras personas, por supuesto, no pueden evitar la ocurrencia de errores propios, pero pueden ayudar a reducir el n√∫mero de estos √∫ltimos. <br><br>  Las preguntas y cartas de lectores de art√≠culos anteriores me llevaron a hacer un peque√±o proyecto, un ejemplo de control de ventilaci√≥n, para mostrar c√≥mo funcionan los nodos ShIoTiny. <br><br>  La idea inicial, sobre la base de la cual <b>apareci√≥ el</b> controlador <b>ShIoTiny</b> , una estaci√≥n de <b>bombeo</b> y riego, est√° lejos de ser adecuada para todos y ser√° interesante.  Por lo tanto, tom√© para todos un sistema de control de ventilaci√≥n comprensible y muy √∫til como ejemplo. <br><br>  Dir√© que la idea del proyecto no es m√≠a, pero la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">obtuve de aqu√≠</a> y luego la <b>adapt√©</b> a <b>ShIoTiny</b> . <br><br><h4>  Primero entiende lo que quieres </h4><br>  El proceso de cultivo es interminable.  Y fue esta propiedad la que arruin√≥ muchas buenas ideas y proyectos.  El desarrollador, en lugar de lanzar, si no un ideal, sino un trabajo, continu√≥ mejorando.  Y lo perfeccion√≥ hasta que sus competidores lo eludieron, liberando, si no una soluci√≥n ideal (y a menudo francamente miserable), pero funcional. <br><br>  Por lo tanto, es muy importante saber d√≥nde poner fin al proyecto.  O, en otras palabras, es necesario determinar lo que queremos obtener al final del proyecto a partir de lo que tenemos al principio.  En ruso, para un documento que se elabora solo para describir la forma de crear algo, existe una hermosa palabra breve y espaciosa, "plan", que los traductores con retraso mental y los gerentes defectuosos recientemente comenzaron a llamar la "hoja de ruta" por alguna raz√≥n.  Bueno, que Dios los bendiga. <br><br>  Nuestro plan ser√° as√≠.  Suponga que hay una habitaci√≥n en la que la humedad a veces puede aumentar dram√°ticamente.  Por ejemplo, como un ba√±o o cocina.  La humedad es algo desagradable y la forma de lidiar con ella es tan antigua como el mundo: ventilar la habitaci√≥n.  Hay bastantes m√©todos de aireaci√≥n.  Pero, tal vez, rechacemos formas ex√≥ticas y anticuadas como los negros con telara√±as y nos detendremos en el abanico habitual.  Los aficionados son m√°s baratos y encontrarlos en nuestra √°rea es m√°s f√°cil. <br><br>  En resumen, queremos controlar el ventilador: encenderlo y apagarlo, respectivamente.  M√°s precisamente, queremos que se encienda y apague cuando sea necesario. <br><br>  Queda por determinar: bajo qu√© condiciones se debe encender el ventilador y bajo qu√© condiciones, apagar. <br><br>  Aqu√≠ todo es obvio: si la humedad est√° por encima de un l√≠mite predeterminado, el ventilador se enciende y aspira aire;  la humedad ha vuelto a la normalidad: el ventilador se apaga. <br><br>  El lector atento captar√° de inmediato la palabra "dado".  ¬øQui√©n es el dado?  ¬øQu√© tan preestablecido? <br><br>  Hay varias formas de establecer el umbral de humedad.  Consideraremos dos de ellos: el primero, con la ayuda de resistencia variable y el segundo, a trav√©s de la red a trav√©s del protocolo MQTT.  Cada uno de estos m√©todos tiene ventajas y desventajas, que se discutir√°n m√°s adelante. <br><br>  Para aquellos que no entienden, explicar√© que el "umbral de humedad" es un nivel de humedad, que excede el que requiere la inclusi√≥n de un ventilador. <br><br>  La siguiente pregunta es si darle al usuario el derecho de encender el ventilador directamente.  Es decir, independientemente del nivel de humedad, con solo tocar un bot√≥n.  Brindaremos esa oportunidad.  Despu√©s de todo, puede ser necesario un ventilador no solo con alta humedad, sino tambi√©n para eliminar de la habitaci√≥n, por ejemplo, un olor desagradable, conocido popularmente como "hedor". <br><br>  Entonces, entendimos lo que queremos e incluso un poco c√≥mo funcionar√°.  Enumeramos brevemente todas las funciones de nuestro sistema de control de ventilaci√≥n: <br><br><ul><li>  establecer un umbral de nivel de humedad (dos opciones); </li><li>  medici√≥n de humedad; </li><li>  inclusi√≥n autom√°tica del ventilador; </li><li>  apagado autom√°tico del ventilador; </li><li>  inclusi√≥n manual del ventilador (con solo tocar un bot√≥n). </li></ul><br>  Entonces, el plan es claro.  Es necesario implementar todas las funciones anteriores en nuestro programa.  Sobre la base de este "plan" actuaremos.  Para comenzar, dibuje un diagrama de bloques del dispositivo. <br><br><h4>  Diagrama de bloques del dispositivo </h4><br>  En t√©rminos generales, tendremos dos de estos esquemas.  El primero es para la opci√≥n en la que el nivel de humedad umbral se establece mediante una resistencia variable.  El segundo esquema es para la opci√≥n en la que el nivel de humedad umbral se establece a trav√©s de la red a trav√©s del protocolo MQTT. <br><br>  Pero dado que estos circuitos diferir√°n en un solo elemento: la resistencia variable "que establece el nivel de humedad umbral", dibujaremos solo un diagrama estructural.  Por supuesto, el esquema estructural seg√∫n GOST se ve diferente.  Pero no nos centramos en los ingenieros de bisontes, sino en la generaci√≥n m√°s joven.  Por lo tanto, la visibilidad es m√°s importante. <br><br><img src="https://habrastorage.org/webt/ut/qh/db/utqhdblfgdlmsv0rkcgqxaztvo8.jpeg"><br><br>  Entonces, ¬øqu√© vemos en la imagen?  El ventilador est√° conectado al rel√© <b>Relay1 del</b> controlador <b>ShIoTiny</b> .  Le llamo la atenci√≥n sobre el hecho de que el ventilador es un artilugio que vive bajo alto voltaje.  Por lo tanto, si alguien har√° esto por s√≠ mismo, tenga cuidado.  Es decir, al menos, antes de meter los dedos o medir instrumentos en el circuito: desconecte al menos el ventilador.  Y el segundo punto.  Si su ventilador es m√°s potente que <b>250 W</b> , entonces no <b>debe</b> conectarlo directamente a <b>ShIoTiny</b> , solo a trav√©s del arrancador. <br><br>  Descubrimos el ventilador.  Ahora el bot√≥n "manual on" del ventilador.  Est√° conectado a la entrada <b>Input1</b> .  No hay nada m√°s que explicar. <br><br>  Sensor de temperatura y humedad <b>DHT-11</b> (o <b>DHT-22</b> o sus an√°logos).  Para conectarlo, se proporciona una entrada especial en el controlador <b>ShIoTiny</b> .  Como puede ver en la figura, conectar un sensor de este tipo tampoco presenta problemas. <br><br>  Y finalmente, una resistencia variable que establece el umbral de nivel de humedad.  M√°s precisamente, un divisor que consiste en resistencias variables y constantes.  No hay problemas con su conexi√≥n, pero explicar√© que el ADC incorporado en el <b>ESP8266 est√°</b> dise√±ado para un m√°ximo de 1 voltio.  Por lo tanto, se necesita un divisor de voltaje aproximadamente 5 veces. <br><br>  Y una vez m√°s, le recuerdo que este divisor no es necesario si el nivel de humedad umbral se establece a trav√©s de la red utilizando el protocolo MQTT. <br><br>  Comenzaremos a elaborar el algoritmo del dispositivo en el editor ElDraw ShIoTiny.  C√≥mo llegar all√≠, en este editor, puede leer en los art√≠culos anteriores o en las instrucciones, un enlace al que se encuentra al comienzo del art√≠culo. <br><br><h4>  Opci√≥n uno, la m√°s simple </h4><br>  Comencemos con uno simple: encienda el rel√© <b>Relay1 cuando</b> se exceda el nivel de humedad umbral durante un tiempo determinado. <br><br><img src="https://habrastorage.org/webt/un/8e/kd/un8ekdrb8cy8zvbc6e_ae2ygwyw.png"><br><br>  Como puede ver, nada complicado: solo cuatro nodos, sin contar los nodos de comentarios.  <b>DHT11</b> es en realidad un sensor de temperatura y humedad (se puede cambiar a <b>DHT22</b> ). <br><br>  La <b>constante CONST</b> es el nivel de humedad umbral, en porcentaje. <br><br>  Comparador: un nodo que compara dos n√∫meros y establece la salida 1 si se cumple la condici√≥n especificada y 0 si no se cumple la condici√≥n. <br><br>  En nuestro caso, esta condici√≥n ser√° <b>A&gt; B</b> , donde <b>A</b> es el nivel de humedad medido por el sensor y <b>B</b> es el nivel umbral de la misma humedad. <br><br>  Tan pronto como el nivel de humedad medido ( <b>A</b> ) exceda el nivel de humedad umbral ( <b>B</b> ), aparecer√° 1 inmediatamente en la salida del comparador <b>A&gt; B</b> y el rel√© se encender√°.  Por el contrario, tan pronto como el nivel de humedad vuelva a la normalidad (es decir, <b>A &lt;= B</b> ), inmediatamente a la salida del comparador <b>A&gt; B,</b> aparecer√° 0 y el rel√© se apagar√°. <br><br>  ¬øEst√° todo claro?  Para aquellos que no lo hacen realmente, l√©anlo nuevamente o miren la descripci√≥n del funcionamiento de los nodos en las instrucciones. <br><br>  Observo que los datos del sensor <b>DHT11 se</b> actualizan aproximadamente una vez cada 10 segundos.  Por lo tanto, el rel√© no podr√° encenderse y apagarse m√°s de una vez cada 10 segundos. <br><br>  Todo estar√≠a bien, pero nos gustar√≠a establecer el umbral de humedad utilizando una resistencia variable.  ¬°Nada es m√°s f√°cil! <br><br><img src="https://habrastorage.org/webt/ez/qe/oi/ezqeoioucwwf0nm90o2sibwizj0.png"><br><br>  Simplemente reemplace el nodo constante con el nodo ADC.  Despu√©s de todo, fue al ADC que conectamos el divisor de voltaje con una resistencia variable. <br><br>  El voltaje en la entrada ADC var√≠a de 0 a 1 voltio.  Pero la humedad en la salida del sensor var√≠a de 0 a 100%.  ¬øC√≥mo los comparamos?  Todo es simple  El nodo ADC en <b>ShIoTiny</b> no solo mide el voltaje de entrada, sino que tambi√©n sabe c√≥mo <i><b>escalarlo y cambiarlo</b></i> . <br><br>  Es decir, en la salida del nodo ADC1 (ADC) habr√° un valor <b>X</b> calculado por la f√≥rmula <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>X</mi><mo>=</mo><mi>k</mi><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>e</mi><mi>n</mi></mrow></msub><mo>+</mo><mi>b</mi></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.213ex" height="2.419ex" viewBox="0 -780.1 7841.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhg8VeAfQ6CNg7secudFf8rHmcpGWA#MJMATHI-58" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhg8VeAfQ6CNg7secudFf8rHmcpGWA#MJMAIN-3D" x="1130" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhg8VeAfQ6CNg7secudFf8rHmcpGWA#MJMATHI-6B" x="2186" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhg8VeAfQ6CNg7secudFf8rHmcpGWA#MJMATHI-63" x="2958" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhg8VeAfQ6CNg7secudFf8rHmcpGWA#MJMATHI-64" x="3391" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhg8VeAfQ6CNg7secudFf8rHmcpGWA#MJMATHI-6F" x="3915" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhg8VeAfQ6CNg7secudFf8rHmcpGWA#MJMATHI-74" x="4400" y="0"></use><g transform="translate(4762,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhg8VeAfQ6CNg7secudFf8rHmcpGWA#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhg8VeAfQ6CNg7secudFf8rHmcpGWA#MJMATHI-65" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhg8VeAfQ6CNg7secudFf8rHmcpGWA#MJMATHI-6E" x="466" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhg8VeAfQ6CNg7secudFf8rHmcpGWA#MJMAIN-2B" x="6411" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhg8VeAfQ6CNg7secudFf8rHmcpGWA#MJMATHI-62" x="7411" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>X</mi><mo>=</mo><mi>k</mi><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>e</mi><mi>n</mi></mrow></msub><mo>+</mo><mi>b</mi></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> X = k \ cdot u_ {en} + b </script></p>  donde <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>n</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.116ex" height="1.817ex" viewBox="0 -520.7 1341.4 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhg8VeAfQ6CNg7secudFf8rHmcpGWA#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhg8VeAfQ6CNg7secudFf8rHmcpGWA#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhg8VeAfQ6CNg7secudFf8rHmcpGWA#MJMATHI-6E" x="345" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>n</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-2"> u_ {in} </script>  - voltaje en la entrada ADC (de 0 a 1V);  Rango <b>k</b> (rango ADC) y desplazamiento <b>b</b> (desplazamiento ADC).  Por lo tanto, si establece <b>k = 100</b> <b>yb = 0</b> , al cambiar <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>n</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.116ex" height="1.817ex" viewBox="0 -520.7 1341.4 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhg8VeAfQ6CNg7secudFf8rHmcpGWA#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhg8VeAfQ6CNg7secudFf8rHmcpGWA#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhg8VeAfQ6CNg7secudFf8rHmcpGWA#MJMATHI-6E" x="345" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>n</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-3"> u_ {in} </script>  en el rango de 0 a 1, el valor de <b>X</b> en la salida de la unidad ADC variar√° en el rango de 0 a 100. Es decir, num√©ricamente igual al rango de cambios de humedad de 0 a 100%. <br><br>  O, simplemente, girando el motor de resistencia variable, puede establecer el nivel de humedad umbral de 0 a 100. El √∫nico inconveniente es que no hay dispositivos de visualizaci√≥n.  Pero en la pr√°ctica, si el motor de resistencia variable hace 6 divisiones 0%, 20%, 40%, 60%, 80%, 100%), esto es suficiente para establecer el umbral de nivel de humedad. <br><br>  ¬øC√≥mo establecemos los coeficientes <b>k</b> - rango (rango ADC) y desplazamiento <b>b</b> (desplazamiento ADC)?  ¬°S√≠, es m√°s f√°cil que los nabos al vapor!  Haga clic con el puntero del mouse en el nodo <b>ADC1</b> e inmediatamente ver√° la ventana de configuraci√≥n.  En √©l puedes configurar todo lo que necesitas.  Para nuestro caso, ser√° una ventana como la de la figura. <br><br><img src="https://habrastorage.org/webt/cn/so/ub/cnsoubc9q_rhu-2p6hlffcd_1ig.png"><br><br>  Entonces, tenemos la soluci√≥n de trabajo m√°s simple.  Comencemos a mejorarlo. <br>  Por cierto, la soluci√≥n m√°s simple tiene una ventaja: no necesita Internet.  Es completamente aut√≥nomo. <br><br><h4>  Opci√≥n dos, conecta el bot√≥n </h4><br>  Todo funciona y todos est√°n felices.  Pero mala suerte, no podemos encender la ventilaci√≥n con fuerza.  Ya hemos acordado que se conectar√° un bot√≥n a la entrada <b>Input1</b> , que encender√° y apagar√° el ventilador a la fuerza, sin prestar atenci√≥n al sensor de humedad. <br>  Es hora de procesar este bot√≥n en nuestro programa de circuito. <br><br><img src="https://habrastorage.org/webt/rn/9h/p8/rn9hp8-41uqwkms65uqiwynd_-k.png"><br><br>  La unidad de procesamiento de clic de bot√≥n se resalta en una l√≠nea naranja.  Es un contador de clic de bot√≥n que se restablece a cero cuando el valor en su salida excede uno (l√≠nea verde, salida del nodo <b>CT</b> ). <br><br>  Todo funciona aqu√≠ tan simple como antes: el contador <b>CT</b> cuenta los clics del bot√≥n conectado a la <b>Entrada1</b> .  Es decir, el valor en la salida de este contador aumenta en 1 con cada clic del bot√≥n. <br><br>  Tan pronto como este valor sea igual a dos (es decir, m√°s de 1), inmediatamente en la salida del comparador <b>A&gt; B</b> aparece 1. Y este 1 restablecer√° el contador <b>CT</b> a cero.  ¬°Esto significa el comparador, el inferior seg√∫n el esquema! <br><br>  Por lo tanto, nuestro bot√≥n tiene dos estados: 0 y 1. Si necesit√°ramos m√°s estados (3 o 4 o incluso m√°s), ser√≠a suficiente para nosotros cambiar la constante <b>CONST</b> de uno a otro valor. <br><br>  Entonces, tenemos dos condiciones para encender el ventilador: exceder el nivel de humedad establecido y presionar el bot√≥n una vez.  Si se cumple alguna de las condiciones, el ventilador se encender√°.  Y funcionar√° hasta que se vuelva a presionar el bot√≥n <b>Y</b> el nivel de humedad vuelva a la normalidad. <br><br>  Por supuesto, puede complicar a√∫n m√°s el algoritmo, pero no lo haremos, dejaremos espacio para la creatividad de aquellos que lo deseen. <br><br><h4>  Opci√≥n tres, con√©ctese a Internet </h4><br>  Todo lo que describimos es bastante funcional.  ¬øPero qu√© pasa con el espect√°culo?  Despu√©s de todo, ¬°cualquier hacker-hacker-cracker con granos se reir√° de alguien que tuerce un bol√≠grafo y presiona un bot√≥n, y no lo controla desde un tel√©fono inteligente!  Torcer el mango "no est√° de moda".  Pero arrastrar el dedo por el tel√©fono inteligente y borrar este dedo en la sangre, aqu√≠ est√°, el pico de los deseos del hacker-hacker-cracker (nunca podr√≠a distinguirlos a todos, as√≠ que si comet√≠ un error, lo siento). <br><br>  Pero seremos condescendientes con estos individuos.  La gobernanza de Internet tiene ventajas reales.  Primero que nada, es visual.  Hay muchas aplicaciones para todas las plataformas que permiten un par de golpes para crear un panel de control completamente utilizable para nuestro controlador Carlson.  En segundo lugar, es una oportunidad para controlar de forma remota el estado de la humedad en la habitaci√≥n.  Y en tercer lugar, puede ver no solo lo que hace el ventilador, girando o no, sino tambi√©n qu√© nivel de humedad umbral se establece.  Y luego, el ventilador se enciende autom√°tica o manualmente.  En general, lo que quieras. <br><br>  Por supuesto, para algunos fan√°ticos hay mucho honor, tanta atenci√≥n.  Pero esto es solo un ejemplo. <br><br>  Entonces, para conectarse a Internet usaremos la tecnolog√≠a <b>MQTT</b> y el protocolo del mismo nombre. <br>  Para usar esta tecnolog√≠a, necesitamos un <b>corredor MQTT</b> .  Este es un servidor tan especial que sirve a <b>clientes MQTT</b> , por ejemplo, <b>ShIoTIny</b> y su tel√©fono inteligente. <br><br>  La esencia de la tecnolog√≠a <b>MQTT</b> es que cualquier cliente publica datos arbitrarios con un nombre espec√≠fico (denominado <b>tema</b> en la terminolog√≠a <b>MQTT</b> ) en un agente (servidor) MQTT.  Otros clientes pueden suscribirse a datos arbitrarios por su nombre ( <b>tema</b> ) y recibir datos reci√©n publicados.  Es decir, todo el intercambio de datos se basa en el principio de cliente-agente-cliente. <br><br>  No <i><b>me</b></i> enfocar√© en los detalles.  Hay toneladas de art√≠culos y tutoriales en Internet sobre c√≥mo funciona <b>MQTT</b> y qu√© tipo de programas existen para crear paneles de control.  Solo te mostrar√© c√≥mo recibir y publicar datos usando <b>ShIoTiny</b> . <br><br>  Como corredor, utilic√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.cloudmqtt.com</a> , pero el principio es el mismo en todas partes. <br><br>  Por lo tanto, asumiremos que se ha registrado con el <b>agente MQTT</b> .  En general, el corredor le dar√° (o requerir√° que invente) un nombre de usuario y contrase√±a (para autorizaci√≥n), as√≠ como un puerto para la conexi√≥n.  <b>Hay</b> dos formas de conectar <b>ShIoTiny</b> al <b>agente MQTT</b> : conexi√≥n regular y <b>TLS</b> ( <b>SSL</b> ). <br><br>  Todos estos par√°metros en <b>ShIoTiny</b> se ingresan en la pesta√±a <b>Networking</b> , la secci√≥n <b>MQTT Connection to server</b> . <br><br><img src="https://habrastorage.org/webt/97/6j/kb/976jkbemm294uso3-pjdcb4wx_4.png"><br><br>  Si su <b>agente MQTT</b> no requiere autorizaci√≥n, no ingrese su nombre de usuario y contrase√±a (deje estos campos vac√≠os). <br><br>  El par√°metro de <b>prefijo de tema MQTT</b> requiere una explicaci√≥n por separado. <br><br>  El prefijo de los par√°metros MQTT es una l√≠nea agregada al t√≠tulo del tema al publicar y suscribirse al agente MQTT.  Para configurar el <b>prefijo MQTT</b> para su controlador, solo necesita ingresarlo en el campo de entrada " <b>Prefijo de tema MQTT</b> " (" <b>Prefijo de tema MQTT</b> ").  ¬°El prefijo siempre comienza con una barra inclinada ( <b>"/"</b> )!  Si no ingresa una barra diagonal en el campo de entrada, se agregar√° autom√°ticamente.  Los caracteres <b>"#"</b> y <b>"+"</b> no se pueden usar en el prefijo.  No hay otras restricciones. <br><br>  Por ejemplo, si publica el par√°metro " <b>estado</b> " (o se suscribe a √©l), y su prefijo se establece en " <b>/ shiotiny /</b> ", entonces en el intermediario, este par√°metro se publicar√° con el nombre " <b>/ shiotiny / status</b> ".  Si tiene un prefijo vac√≠o establecido, todos los par√°metros en el intermediario comenzar√°n con una barra inclinada ( <b>"/"</b> ): " <b>estado</b> " se publicar√° como " <b>/ estado</b> ". <br><br>  Por lo tanto, creemos que se ha registrado con el <b>agente MQTT</b> y ha recibido su nombre de usuario, contrase√±a y puerto.  Luego configura estos par√°metros en la pesta√±a <b>Redes</b> , la <b>secci√≥n</b> <b>Conexi√≥n MQTT al servidor</b> <b>del</b> controlador <b>ShIoTiny</b> . <br><br>  Creemos que el prefijo se establece en " <b>/ room /</b> ". <br><br>  Para comenzar, publicaremos el estado de todos los par√°metros clave: rel√© <b>Realay1</b> , estado de encendido manual, estado de encendido autom√°tico y, finalmente, umbral y niveles de humedad actuales.  Bien y una ventaja: la temperatura en la habitaci√≥n.  C√≥mo hacer esto, ver la figura. <br><br><img src="https://habrastorage.org/webt/tq/xj/la/tqxjla44g3klhb_apkinf7yudka.png"><br><br>  Como puede ver, la diferencia con la versi√≥n anterior es solo los nodos de <b>publicaci√≥n MQTT</b> .  Dado el prefijo, se publican los siguientes par√°metros: <br><img src="https://habrastorage.org/webt/hr/9c/wd/hr9cwdccjlb3tnpkgm2g7grdyhe.jpeg"><br><br>  Como puede ver, ¬°todo el estado del sistema est√° a la vista! <br><br>  Pero queremos no solo ver, sino tambi√©n controlar.  Como ser  Muy simple  ¬°Nos negaremos a establecer el nivel de humedad umbral usando el <b>ADC</b> y una resistencia variable y estableceremos este nivel de humedad umbral por <b>MQTT</b> directamente desde el tel√©fono inteligente! <br><br><img src="https://habrastorage.org/webt/dr/e3/yw/dre3ywd0uyw_cjtw8tnzr-doicq.png"><br><br>  Eliminamos el nodo ADC del circuito e incluimos tres nodos nuevos all√≠: <b>FLASH store</b> , <b>FLASH restore</b> y <b>MQTT describe</b> . <br><br>  La funci√≥n del nodo de <b>descripci√≥n MQTT</b> es obvia: recibe el <b>par√°metro / room / trigHset</b> (nivel de humedad umbral) del <b>agente MQTT</b> .  ¬øPero qu√© hace con los datos a continuaci√≥n?  Simplemente los entrega al nodo de <b>almacenamiento FLASH</b> , que, a su vez, almacena estos datos en una memoria no vol√°til con el nombre <b>trigH</b> .  Despu√©s de eso, el nodo de <b>restauraci√≥n FLASH</b> lee los datos bajo el nombre <b>trigH</b> de la memoria no vol√°til y ya sabemos lo que sucede a continuaci√≥n. <br><br>  ¬øPor qu√© tantas dificultades?  ¬øPor qu√© no puedo enviar inmediatamente los datos recibidos a la entrada del comparador? <br><br>  Como sol√≠a decir el camarada S. Holmes, ¬° <i>esto es elemental</i> !  Nadie garantiza que despu√©s de encender su dispositivo, se unir√° al <b>agente MQTT</b> .  Y la humedad debe ser medida.  Y el ventilador debe estar encendido.  Pero sin informaci√≥n sobre el nivel de humedad umbral, ¬°esto es imposible!  Por lo tanto, cuando se enciende, nuestro dispositivo extrae un nivel de humedad umbral previamente almacenado de la memoria no vol√°til y lo utiliza para la toma de decisiones.  Y cuando se establece la conexi√≥n con el <b>agente MQTT</b> y alguien publica un nuevo valor <b>/ room / trigHset</b> , se <b>utilizar√°</b> este nuevo valor. <br><br>  Entonces puedes inventar lo que quieras.  Por ejemplo, adem√°s de la humedad, tambi√©n ingrese un registro de temperatura.  O agregue control de iluminaci√≥n "inteligente" (todav√≠a dejamos sin usar dos rel√©s y dos entradas).  ¬°Todo est√° en tus manos! <br><br><h4>  Conclusi√≥n </h4><br>  As√≠ que miramos varios ejemplos de la implementaci√≥n del controlador m√°s simple en esencia basado en ShIoTiny.  Tal vez sea √∫til para alguien. <br><br>  Como siempre, sugerencias, deseos, preguntas, errores tipogr√°ficos, etc., por correo electr√≥nico: <b>shiotiny@yandex.ru</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/464485/">https://habr.com/ru/post/464485/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../464465/index.html">¬øC√≥mo y por qu√© migramos Preply a Kubernetes?</a></li>
<li><a href="../464467/index.html">Aprenda anal√≠tica web desde cero. Amplia selecci√≥n</a></li>
<li><a href="../464471/index.html">monitoreo de impresora snmp en The Dude</a></li>
<li><a href="../464479/index.html">"Manifiesto de programadores novatos de especialidades relacionadas" o c√≥mo llegu√© a tal vida</a></li>
<li><a href="../464481/index.html">C√≥mo construimos un sistema de entrenamiento y motivaci√≥n en el estudio</a></li>
<li><a href="../464487/index.html">Estamos creando una interfaz para ingresar documentos a trav√©s de la selecci√≥n</a></li>
<li><a href="../464489/index.html">Buildbot en ejemplos</a></li>
<li><a href="../464491/index.html">Vivaldi 2.7 - Vida intensa en silencio</a></li>
<li><a href="../464495/index.html">Desarrollo del equipo y reflexi√≥n como comunicaci√≥n gerencial del l√≠der del equipo.</a></li>
<li><a href="../464497/index.html">JIRA como remedio para el insomnio y las crisis nerviosas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>