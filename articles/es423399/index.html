<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëêüèª üé¥ üî† Un ejemplo de versiones simples de registros PostgreSQL üç≥ üñºÔ∏è üéé</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cuando vi la implementaci√≥n del "historial de registros" - versiones, al lado del programa trabajando con la base de datos SQL. Antes de cambiar el re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un ejemplo de versiones simples de registros PostgreSQL</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423399/">  Cuando vi la implementaci√≥n del "historial de registros" - versiones, al lado del programa trabajando con la base de datos SQL.  Antes de cambiar el registro, la versi√≥n anterior se obtuvo de la base de datos, se escribi√≥ en XML y la cadena XML resultante se escribi√≥ en una tabla de versi√≥n separada. <br><br>  Inicialmente, en su programa, planeaba realizar el control de versiones alg√∫n tiempo despu√©s, no hab√≠a necesidad urgente.  Recuerdo que hab√≠a un deseo de usar el tipo de datos jsonb en alg√∫n lugar, tan pronto como pens√© en una implementaci√≥n simple y concisa de las versiones en el lado de SQL, no pude hacerlo.  Solo una tabla de versi√≥n con 5 columnas y una funci√≥n de activaci√≥n en 3 l√≠neas de c√≥digo. <br><br>  Describir la implementaci√≥n de una tabla de versi√≥n no es suficiente, por lo que debe describir algunas tablas m√°s, por ejemplo. <br><br>  En casi todas las bases de datos, con raras excepciones, hay una tabla de usuarios: usuarios.  Es √∫til almacenar el historial de cambios: versiones del usuario, por ejemplo, para que el usuario mismo pueda volver a la versi√≥n anterior. <br><br>  Ejemplo de tabla de usuario: <br><br><img src="https://habrastorage.org/webt/s0/8p/mv/s08pmv6wo9rurj0dnlmkbbey5ss.png" alt="imagen"><br><br>  Los dos √∫ltimos campos de la imagen son necesarios para la tabla de versiones, tambi√©n pueden denominarse "autor de la versi√≥n" y "fecha de versi√≥n", pero, si lo desea, puede prescindir de ellos. <br><a name="habracut"></a><br>  Tabla de versiones: <br><br><img src="https://habrastorage.org/webt/fz/j0/9j/fzj09jhvwep5egmihncotsmz9_k.png"><br><br>  Funci√≥n de disparo para guardar versiones: <br><br><img src="https://habrastorage.org/webt/3g/td/b1/3gtdb17c7rsntarlf8-ecnto-po.png"><br><br>  Los primeros dos campos se rellenan desde el registro guardado OLD.changestamp y OLD.userid. <br>  En la tabla de versiones, no solo se pueden almacenar las entradas de la tabla de usuarios, el tercer campo es el hash MD5 del nombre de la tabla versionada, convertida a uuid. <br><br>  Los ejemplos describieron previamente una estructura muy simple, pero como regla, varios datos de referencia pueden tener tablas adicionales con una relaci√≥n de uno a muchos. <br><br>  Por ejemplo, la tabla "Grupos de usuarios". <br><br><img src="https://habrastorage.org/webt/ou/r6/vy/our6vydvwuh_kvb6jywdptxqg4a.png"><br><br>  Y la segunda tabla es "Usuarios del grupo", la composici√≥n del grupo son los usuarios del grupo. <br><br><img src="https://habrastorage.org/webt/yf/zb/1i/yfzb1ifdcxh7_d9nos-isv2h_-4.png"><br><br>  Para no complicar el mecanismo simple de control de versiones, puede hacer una ligera duplicaci√≥n de datos en la tabla de grupos, agregar un campo jsonb que repita la estructura de la tabla "Usuarios de grupo". <br><br><img src="https://habrastorage.org/webt/tc/af/fb/tcaffb1vpedfl4_ygcgpgmbjkem.png"><br><br>  Para simplificar el trabajo con datos duplicados, puede realizar una funci√≥n de activaci√≥n adicional, con INSERTAR o ACTUALIZAR, llenando la tabla "Agrupar usuarios" desde el campo jsonb. <br><br><img src="https://habrastorage.org/webt/ct/up/o4/ctupo4kui_jkigpzkbglgx9qmog.png"><br><br>  La duplicaci√≥n descrita anteriormente solo es necesaria cuando se requiere obtener datos de la tabla con frecuencia y lo m√°s r√°pido posible.  Por ejemplo, si a menudo se realiza una consulta en la tabla "Usuarios del grupo" para determinar si un usuario es miembro del grupo Administradores.  En otros casos, los datos se pueden obtener mediante consultas directamente desde el campo jsonb, y no utilizar una tabla duplicada. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><b>El c√≥digo de ejemplo completo est√° aqu√≠.</b></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es423399/">https://habr.com/ru/post/es423399/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es423385/index.html">Curso "Fundamentos de programaci√≥n"</a></li>
<li><a href="../es423391/index.html">CLRium # 4: .Net Community Meeting</a></li>
<li><a href="../es423393/index.html">Redes neuronales basadas en reglas</a></li>
<li><a href="../es423395/index.html">Tesla establece r√©cord trimestral para autom√≥viles el√©ctricos producidos</a></li>
<li><a href="../es423397/index.html">Integraci√≥n de 3CX con 1C: Gesti√≥n comercial: m√©todo para instalar una extensi√≥n de configuraci√≥n</a></li>
<li><a href="../es423403/index.html">Prueba de manejo VW e-Golf, Nissan Leaf y Tesla Model 3</a></li>
<li><a href="../es423405/index.html">Aprenda t√°cticas adversarias, t√©cnicas y conocimientos comunes (ATT @ CK). T√°cticas empresariales. Parte 1</a></li>
<li><a href="../es423407/index.html">Generalmente tengo miedo de los ni√±os, mi querido se√±or, son ruidosos, crueles y ego√≠stas, ¬øy si los ni√±os gobiernan el estado?</a></li>
<li><a href="../es423409/index.html">C√≥mo hacer el Lunokhod mismo</a></li>
<li><a href="../es423411/index.html">iOS CSS de la muerte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>