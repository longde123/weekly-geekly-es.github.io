<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍈 🧑🏽 👨🏼‍🏫 Files d'attente - qu'est-ce que c'est, pourquoi et comment l'utiliser? Jetez un œil aux fonctionnalités d'AWS SQS 🌰 👩🏿‍🌾 ↕️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Définissons d'abord le concept de «file d'attente». 
 Prenez en considération le type de file d'attente «FIFO» (premier entré , premier sorti). Si vou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Files d'attente - qu'est-ce que c'est, pourquoi et comment l'utiliser? Jetez un œil aux fonctionnalités d'AWS SQS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457068/"><img src="https://habrastorage.org/webt/zw/yz/pq/zwyzpqk1p65bfsq6xzvqab7rt60.png"><br><h3>  <b>Définissons d'abord le concept de «file d'attente».</b> </h3><br>  Prenez en considération le type de file d'attente <b>«FIFO»</b> (premier <b>entré</b> , premier sorti).  Si vous prenez la valeur de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Wikipedia</a> - "c'est un type de données abstrait avec la discipline d'accès aux éléments."  En bref, cela signifie que nous ne pouvons pas obtenir de données de celui-ci dans un ordre aléatoire, mais uniquement récupérer ce qui est arrivé en premier. <br><br><h3>  Ensuite, vous devez décider pourquoi ils sont nécessaires? </h3><br>  <b>1. Pour les opérations différées.</b>  Un exemple classique est le traitement d'image.  Par exemple, un utilisateur a téléchargé une image sur le site que nous devons traiter, cette opération prend beaucoup de temps, l'utilisateur ne veut pas attendre autant.  Par conséquent, nous chargeons l'image, puis la transférons dans la file d'attente.  Et il sera traité lorsqu'un «travailleur» le recevra. <br><br>  <b>2. Pour gérer les charges de pointe.</b>  Par exemple, il y a une partie du système qui provoque parfois beaucoup de trafic et qui ne nécessite pas de réponse instantanée.  En option, générer des rapports.  Lancer cette tâche dans la file d'attente - nous donnons la possibilité de la gérer avec une charge uniforme sur le système. <br><br>  <b>3. Évolutivité.</b>  Et probablement la raison la plus importante, la file d'attente permet <br>  évoluer.  Cela signifie que vous pouvez afficher plusieurs services pour le traitement en parallèle, ce qui augmentera considérablement la productivité. <br><a name="habracut"></a><br><h3>  Voyons maintenant les problèmes auxquels nous serons confrontés si nous créons nous-mêmes la file d'attente: </h3><br>  <b>1. Accès parallèle.</b>  Un seul gestionnaire peut prendre un message dans une file d'attente.  Autrement dit, si en même temps deux services demandent des messages, chacun d'eux doit renvoyer un ensemble unique de messages.  Sinon, il s'avère qu'un message est traité deux fois.  Ce qui pourrait être lourd. <br><br>  <b>2. Le mécanisme de déduplication.</b>  Le service doit disposer d'un système qui protège la file d'attente des doublons.  Il peut y avoir une situation dans laquelle un même ensemble de données sera envoyé à la file d'attente par hasard deux fois.  En conséquence, nous traiterons la même chose deux fois.  Ce qui est encore lourd. <br><br>  <b>3. Mécanisme de gestion des erreurs.</b>  Disons que notre service a pris trois messages de la file d'attente.  Il en a traité deux avec succès en envoyant des demandes de suppression de la file d'attente.  Et le troisième qu'il n'a pas pu traiter et est mort.  Un message en cours de traitement n'est pas disponible pour les autres services.  Et il ne doit pas rester éternellement en cours de traitement.  Un tel message doit être transmis à un autre gestionnaire par une logique.  Un exemple de mise en œuvre de cette logique sera bientôt envisagé en utilisant AWS SQS (Simple Queue Service) comme exemple. <br><br><h3>  Amazon Web Services - Service de file d'attente simple </h3><br><h4>  Voyons maintenant comment SQS résout ces problèmes et ce qu'il peut faire. </h4><br>  <b>1. Accès parallèle.</b>  Dans la file d'attente, vous pouvez définir le paramètre de <b>délai d'expiration de</b> la <b>visibilité</b> .  Il détermine la durée maximale du traitement d'un message.  Par défaut, c'est <b>30 secondes.</b>  Lorsqu'un service récupère un message, il est transféré à l'état <b>«En vol»</b> pendant 30 secondes.  Si pendant ce temps il n'y avait pas de commande pour supprimer ce message de la file d'attente, il revient au début et le service suivant peut le recevoir à nouveau pour traitement. <br><br>  <b>Petit travail de shemka.</b> <br><br><img src="https://habrastorage.org/webt/zx/wj/pd/zxwjpdw6hdsdw8qoinabmifuyzo.png"><br><blockquote>  <b>Remarque:</b> soyez prudent.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dans certains cas, SQS peut envoyer un message en double (article "Livraison au moins une fois").</a>  Par conséquent, votre service doit être <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">idempotent</a> pour le traitement. </blockquote><br>  <b>2. Mécanisme de gestion des erreurs.</b>  Dans SQS, vous pouvez configurer le deuxième tour pour les messages "morts" (Dead Letter Queue).  Autrement dit, ceux qui n'ont pas pu traiter notre service seront envoyés dans une file d'attente distincte, dont vous pouvez disposer à votre discrétion.  Vous pouvez également définir après quoi le nombre de tentatives infructueuses le message ira dans la file d'attente "morte".  Une tentative ayant échoué correspond à l'expiration du "délai d'expiration de la visibilité".  Autrement dit, si aucune demande de suppression n'a été envoyée pendant ce temps, un tel message sera considéré comme non traité et retournera dans la file d'attente principale ou ira aux "morts". <br><br>  <b>3. Déduplication des messages.</b>  SQS dispose également d'un système de protection en double.  Chaque message a un <b>«ID de déduplication»</b> , SQS ne mettra pas en file d'attente un message avec <br>  répété «Id de déduplication» pendant 5 minutes.  Vous devez spécifier un «ID de déduplication» dans chaque message ou activer la génération d'ID basée sur le contenu.  Cela signifie qu'un hachage généré en fonction de votre contenu entrera dans l '«ID de déduplication».  Le paramètre <b>"Déduplication basée sur le contenu".</b>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">En savoir plus sur la déduplication</a> <br><blockquote>  <b>Remarque:</b> soyez prudent si vous envoyez deux messages identiques dans les 5 minutes et que la <b>«déduplication basée sur le contenu» est</b> activée <b>.</b> SQS n'ajoutera pas de deuxième message à la file d'attente. <br></blockquote><blockquote>  <b>Remarque:</b> soyez prudent, par exemple, si la connexion est perdue sur l'appareil et qu'il ne reçoit pas de réponse et envoie ensuite une deuxième demande après 5 minutes, un doublon sera créé. <br></blockquote>  <b>4. Long scrutin.</b>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Long sondage</a> .  SQS prend en charge ce type de connexion avec un délai maximal de 20 secondes.  Ce qui nous permet d'économiser sur le trafic et les "saccades" du service. <br><br>  <b>5. Mesures.</b>  Amazon fournit également des métriques de file d'attente détaillées.  Tels que le nombre de messages reçus / envoyés / supprimés, la taille en Ko de ces messages, etc.  Vous pouvez également connecter SQS au service de journalisation CloudWatch.  Là, vous pouvez voir encore plus.  Là aussi, vous pouvez configurer les soi-disant <b>«alarmes»</b> et vous pouvez configurer des actions pour tous les événements.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">En savoir plus sur la connexion à SQS.</a>  Et la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation CloudWatch</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><br></a> <br><h3>  Voyons maintenant les paramètres de la file d'attente: </h3><br><h4>  Les principaux: </h4><br>  <b>Délai de visibilité par défaut - le</b> nombre de secondes / minutes / heures pendant lesquelles le message après réception ne sera pas visible pour la réception.  Le temps de traitement maximum est de 12 heures. <br><br>  <b>Période de rétention des messages - le</b> nombre de secondes / minutes / heures / jours, ce qui signifie combien de temps les messages non traités seront stockés dans la file d'attente.  Maximum - 14 jours. <br><br>  <b>Taille</b> maximale des messages <b>- taille</b> maximale des messages en Ko.  La valeur est comprise entre 1 Ko et 256 Ko. <br><br>  <b>Délai de livraison -</b> vous pouvez définir le délai de livraison d'un message à la file d'attente.  De 0 seconde à 15 minutes (En fait, les messages seront dans la file d'attente, mais ne seront pas visibles pour recevoir). <br><br>  <b>Recevoir le temps d'attente des messages -</b> temps, durée de la connexion si nous utilisons «Interrogation longue» pour recevoir de nouveaux messages. <br><br>  <b>Déduplication basée sur le contenu - l'</b> indicateur, s'il est défini sur true, un «ID de déduplication» sera ajouté à chaque message sous la forme d'un hachage SHA-256 généré à partir du contenu. <br><br><h4>  Paramètres de file d'attente morte </h4><br>  <b>Utiliser la stratégie de redirection - un</b> indicateur, s'il est défini, les messages seront redirigés après plusieurs tentatives. <br><br>  <b>Dead Letter Queue - le</b> nom de la file d'attente "morte" à laquelle les messages bruts seront envoyés. <br><br>  <b>Maximum de réceptions - le</b> nombre de tentatives de traitement infructueuses, après quoi le message sera envoyé à la file d'attente "morte" <br><blockquote>  <b>Remarque: Notez</b> également que nous pouvons envoyer tous les paramètres principaux avec chaque message séparément.  Par exemple, chaque message individuel peut avoir son propre <b>délai de visibilité</b> ou <b>délai de livraison.</b> </blockquote><h3>  Maintenant, un peu sur les messages eux-mêmes et leurs propriétés: </h3><br>  Un message a plusieurs paramètres: <br><br>  <b>1. Corps du message -</b> n'importe quel texte <br>  <b>2. L'ID du groupe de messages est</b> quelque chose comme une balise, un canal, requis pour tous les messages.  Chacun de ces groupes est garanti d'être traité en mode FIFO. <br>  <b>3. ID de déduplication de message -</b> chaîne pour identifier les doublons.  Si le mode "Déduplication basée sur le contenu" est défini, le paramètre est facultatif. <br><br><h4>  Il existe également des attributs de message </h4><br>  Les attributs se composent d'un nom, d'un type et d'une valeur. <br><br>  <b>1. Nom -</b> chaîne <br>  <b>2. Type -</b> il existe plusieurs types: chaîne, nombre, binaire.  Le type vient simplement sous forme de chaîne, et il est possible d'ajouter un suffixe au type.  Dans ce cas, le type viendra avec ce suffixe à travers le point, par exemple string.example_postfix <br>  <b>3. Valeur -</b> chaîne <br><blockquote>  <b>Remarque:</b> veuillez noter que le nombre maximal d'attributs est de <b>10</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Détails</a> </blockquote>  PS: cet article fournit une brève description de la file d'attente, ainsi qu'un peu sur les capacités et la mécanique de SQS.  L'article suivant sera consacré à <b>AWS Lambda</b> , puis à leur partage pratique. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr457068/">https://habr.com/ru/post/fr457068/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr457058/index.html">Conversion des résultats d'impression en clics pour Google et Yandex en 2019</a></li>
<li><a href="../fr457060/index.html">Trois vidéos pour les écrivains iOS</a></li>
<li><a href="../fr457062/index.html">Centre de formation des cosmonautes à Star City</a></li>
<li><a href="../fr457064/index.html">A la question des modules</a></li>
<li><a href="../fr457066/index.html">Comment modifier le robot FEDOR et le fauteuil de vol ISS</a></li>
<li><a href="../fr457070/index.html">Textolite au lieu de carton. Quelques mots sur le badge interactif OFFZONE 2019</a></li>
<li><a href="../fr457072/index.html">Comment résoudre un ancien problème en utilisant ML en Python et .Net</a></li>
<li><a href="../fr457074/index.html">L'évolution des développeurs: à quels jeux faut-il s'attendre à l'avenir</a></li>
<li><a href="../fr457078/index.html">Comment transformer votre avatar Telegram en montre</a></li>
<li><a href="../fr457082/index.html">Octroi imperceptible de droits d'administrateur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>