<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå®Ô∏è üë®üèø‚Äçüéì üòÆ Configurar a VPN site a site IPSec no hardware da Palo Alto Networks üëÜ üîõ ü§πüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este artigo √© uma continua√ß√£o do material anterior sobre os recursos da configura√ß√£o do equipamento da Palo Alto Networks . Aqui, queremos falar sobre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Configurar a VPN site a site IPSec no hardware da Palo Alto Networks</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/crosstech/blog/448952/"><img src="https://habrastorage.org/getpro/habr/post_images/a2c/68c/d7c/a2c68cd7c6cbac21b84a65f55eb7dd33.png" alt="imagem"><br><br>  Este artigo √© uma continua√ß√£o do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">material anterior</a> sobre os recursos da configura√ß√£o do equipamento da <b>Palo Alto Networks</b> .  Aqui, queremos falar sobre a configura√ß√£o da <b>VPN IPSec site a site</b> em equipamentos da <b>Palo Alto Networks</b> e sobre uma poss√≠vel op√ß√£o de configura√ß√£o para conectar v√°rios provedores de Internet. <br><a name="habracut"></a><br>  Para demonstra√ß√£o, ser√° utilizado o esquema padr√£o de conex√£o da matriz √† filial.  Para fornecer uma conex√£o √† Internet tolerante a falhas, a matriz usa a conex√£o simult√¢nea de dois provedores: ISP-1 e ISP-2.  A filial tem uma conex√£o com apenas um provedor, ISP-3.  Entre os firewalls PA-1 e PA-2, dois t√∫neis s√£o constru√≠dos.  Os t√∫neis operam no modo de <b>espera ativa</b> , o t√∫nel-1 est√° ativo, o t√∫nel-2 come√ßar√° a transmitir tr√°fego quando o t√∫nel-1 falhar.  O t√∫nel-1 usa uma conex√£o com o provedor de servi√ßos de Internet ISP-1, o t√∫nel-2 usa uma conex√£o com o provedor de servi√ßos de Internet ISP-2.  Todos os endere√ßos IP s√£o gerados aleatoriamente para fins de demonstra√ß√£o e n√£o est√£o relacionados √† realidade. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/312/8a1/67b/3128a167bfa98d8aed104e6e1e85ef22.png" alt="imagem"><br><br>  Para criar a VPN site a site, o <b>IPSec</b> ser√° usado - um conjunto de protocolos para proteger os dados transmitidos por IP.  <b>O IPSec</b> funcionar√° usando o protocolo de seguran√ßa <b>ESP</b> (Encapsulating Security Payload), que fornecer√° criptografia dos dados transmitidos. <br><br>  <b>O IPSec</b> inclui o <b>IKE</b> (Internet Key Exchange), o protocolo respons√°vel por negociar os par√¢metros de seguran√ßa do SA (associa√ß√µes de seguran√ßa) usados ‚Äã‚Äãpara proteger os dados transmitidos.  Os firewalls PAN suportam <b>IKEv1</b> e <b>IKEv2</b> . <br><br>  Na VPN <b>IKEv1</b> , a conex√£o √© constru√≠da em dois est√°gios: <b>IKEv1 Fase 1</b> (t√∫nel IKE) e <b>IKEv1 Fase 2</b> (t√∫nel IPSec), criando assim dois t√∫neis, um dos quais serve para a troca de informa√ß√µes de servi√ßo entre firewalls, o segundo para transmiss√£o de tr√°fego.  Existem dois modos de opera√ß√£o na <b>IKEv1 Fase 1</b> - modo principal e modo agressivo.  O modo agressivo usa menos mensagens e √© mais r√°pido, mas n√£o oferece suporte √† prote√ß√£o de identidade de mesmo n√≠vel. <br><br>  <b>O IKEv2</b> substituiu o <b>IKEv1</b> e, comparado ao <b>IKEv1,</b> sua principal vantagem s√£o os requisitos de menos largura de banda e a negocia√ß√£o mais r√°pida do SA.  <b>O IKEv2</b> usa menos mensagens de servi√ßo (4 no total), suporta EAP, protocolo MOBIKE e adiciona um mecanismo de verifica√ß√£o de disponibilidade de pares com o qual um t√∫nel √© criado - <b>Liveness Check</b> , substituindo Dead Peer Detection no IKEv1.  Se o teste falhar, o <b>IKEv2</b> poder√° redefinir o t√∫nel e recuperar automaticamente o mais r√°pido poss√≠vel.  Voc√™ pode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ler</a> mais sobre as diferen√ßas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br>  Se o t√∫nel for constru√≠do entre firewalls de diferentes fabricantes, pode haver erros na implementa√ß√£o do <b>IKEv2</b> e, para compatibilidade com esse equipamento, √© poss√≠vel usar o <b>IKEv1</b> .  Em outros casos, √© melhor usar o <b>IKEv2</b> . <br><br>  Etapas de instala√ß√£o: <br><br>  <b>‚Ä¢ Configurando dois provedores de Internet no modo Active \ Standby</b> <br><br>  Existem v√°rias maneiras de implementar esse recurso.  Uma delas √© usar o mecanismo de <b>Monitoramento de caminho</b> , que est√° dispon√≠vel desde o <b>PAN-OS 8.0.0</b> .  Este exemplo usa a vers√£o 8.0.16.  Esse recurso √© semelhante ao IP SLA nos roteadores Cisco.  No par√¢metro da rota padr√£o est√°tica, o envio de pacotes de ping para um endere√ßo IP espec√≠fico a partir de um endere√ßo de origem espec√≠fico est√° configurado.  Nesse caso, a interface ethernet1 / 1 faz ping no gateway padr√£o uma vez por segundo.  Se n√£o houver resposta para tr√™s pings seguidos, a rota ser√° considerada inoperante e ser√° removida da tabela de roteamento.  A mesma rota √© configurada na dire√ß√£o do segundo provedor de Internet, mas com mais m√©tricas (√© backup).  Assim que a primeira rota for removida da tabela, o firewall come√ßar√° a enviar tr√°fego ao longo da segunda rota - <b>Failover</b> .  Quando o primeiro provedor come√ßar a responder aos pings, sua rota retornar√° √† tabela e substituir√° o segundo devido √† melhor m√©trica - <b>Fail-Back</b> .  O processo de <b>failover</b> leva v√°rios segundos, dependendo dos intervalos configurados, mas, em qualquer caso, o processo n√£o √© instant√¢neo e, nesse momento, o tr√°fego √© perdido.  <b>O Fail-Back</b> passa sem perda de tr√°fego.  √â poss√≠vel tornar o <b>failover mais</b> r√°pido usando o <b>BFD</b> , se o seu provedor de servi√ßos de Internet fornecer essa op√ß√£o.  <b>O BFD √©</b> suportado a partir das <b>s√©ries PA-3000</b> e <b>VM-100</b> .  Como endere√ßo para ping, √© melhor especificar n√£o o gateway do provedor, mas um endere√ßo p√∫blico sempre acess√≠vel na Internet. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/459/47f/546/45947f5469df67a6ecd315180779465b.png" alt="imagem"><br><br>  <b>‚Ä¢ Criando uma interface de t√∫nel</b> <br><br>  O tr√°fego dentro do t√∫nel √© transmitido atrav√©s de interfaces virtuais especiais.  Cada um deles deve ser configurado com um endere√ßo IP da rede de tr√¢nsito.  Neste exemplo, a sub-rede 172.16.1.0/30 ser√° usada para o t√∫nel-1 e a sub-rede 172.16.2.0/30 ser√° usada para o t√∫nel-2. <br>  A interface do t√∫nel √© criada na se√ß√£o <b>Rede -&gt; Interfaces -&gt; T√∫nel</b> .  Voc√™ deve especificar o roteador virtual e a zona de seguran√ßa, bem como o endere√ßo IP da rede de transporte correspondente.  O n√∫mero da interface pode ser qualquer um. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b06/a3d/08e/b06a3d08e1ee5088b23f5196aae51d3f.png" alt="imagem"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/13f/9e5/5b6/13f9e55b6855207fc6bc8c2be69657c7.png" alt="imagem"><br><br>  Na se√ß√£o <b>Avan√ßado</b> , voc√™ pode especificar um <b>Perfil de Gerenciamento</b> que permita o ping nessa interface; isso pode ser √∫til para teste. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b67/f4d/47a/b67f4d47a922bdf70f010be46f3e3fe2.png" alt="imagem"><br><br>  <b>‚Ä¢ Configurar perfil IKE</b> <br><br>  <b>O perfil IKE</b> √© respons√°vel pela primeira etapa na cria√ß√£o de uma conex√£o VPN; aqui, os par√¢metros do t√∫nel <b>IKE Fase 1</b> s√£o especificados.  O perfil √© criado na se√ß√£o <b>Rede -&gt; Perfis de rede -&gt; Criptografia IKE</b> .  Voc√™ deve especificar o algoritmo de criptografia, o hash, o grupo Diffie-Hellman e a vida √∫til da chave.  Em geral, quanto mais complexos os algoritmos, pior o desempenho; eles precisam ser selecionados com base em requisitos de seguran√ßa espec√≠ficos.  No entanto, √© fortemente desencorajado o uso do grupo Diffie-Hellman abaixo de 14 para proteger informa√ß√µes importantes.  Isso ocorre devido √† vulnerabilidade do protocolo, que s√≥ pode ser nivelado usando um tamanho de m√≥dulo de 2048 bits ou mais, ou algoritmos de criptografia el√≠ptica, que s√£o usados ‚Äã‚Äãnos grupos 19, 20, 21, 24. Esses algoritmos s√£o mais produtivos que a criptografia tradicional.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mais detalhes aqui</a> .  E <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3ff/18a/d04/3ff18ad0457e792f86045d8b42534e39.png" alt="imagem"><br><br>  <b>‚Ä¢ Configurar perfil IPSec</b> <br><br>  A segunda etapa na cria√ß√£o de uma conex√£o VPN √© o t√∫nel IPSec.  Os par√¢metros SA para ele s√£o configurados em <b>Rede -&gt; Perfis de rede -&gt; Perfil criptogr√°fico IPSec</b> .  Aqui voc√™ precisa especificar o protocolo IPSec - <b>AH</b> ou <b>ESP</b> , bem como os par√¢metros <b>SA</b> - hash, algoritmos de criptografia, grupos Diffie-Hellman e dura√ß√£o da chave.  As configura√ß√µes de SA no perfil criptogr√°fico IKE e no perfil criptogr√°fico IPSec podem n√£o corresponder. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b38/5e2/30c/b385e230c1548d0c65f6b8d7ead35b29.png" alt="imagem"><br><br>  <b>‚Ä¢ Configurar gateway IKE</b> <br><br>  <b>Um gateway IKE</b> √© um objeto que identifica o roteador ou firewall com o qual um t√∫nel VPN √© constru√≠do.  Para cada t√∫nel, voc√™ precisa criar seu pr√≥prio <b>gateway IKE</b> .  Nesse caso, dois t√∫neis s√£o criados, um atrav√©s de cada provedor de Internet.  A interface de sa√≠da correspondente e seu endere√ßo IP, endere√ßo IP de mesmo n√≠vel e chave comum s√£o indicados.  Voc√™ pode usar certificados como uma alternativa a uma chave compartilhada. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a56/251/b36/a56251b36a69840ec730e50568e690e8.png" alt="imagem"><br><br>  Isso indica o <b>perfil de criptografia IKE</b> criado anteriormente.  Os par√¢metros para o segundo objeto <b>Gateway IKE</b> s√£o semelhantes, com exce√ß√£o dos endere√ßos IP.  Se o firewall da Palo Alto Networks estiver localizado atr√°s de um roteador NAT, o mecanismo <b>NAT Traversal</b> dever√° estar ativado. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/23b/3cc/da8/23b3ccda8c845371f4bd4e7efd41a7ea.png" alt="imagem"><br><br>  <b>‚Ä¢ Configurar t√∫nel IPSec</b> <br><br>  <b>O t√∫nel IPSec</b> √© um objeto que especifica os par√¢metros do t√∫nel IPSec, como o nome indica.  Aqui voc√™ precisa especificar a interface do encapsulamento e os objetos <b>IKE Gateway</b> , <b>IPSec Crypto Profile</b> criados anteriormente.  Para garantir a altern√¢ncia autom√°tica de roteamento para o t√∫nel em espera, voc√™ deve ativar o <b>Monitor de T√∫nel</b> .  Este √© um mecanismo que verifica se um par est√° ativo usando o tr√°fego ICMP.  Como o endere√ßo de destino, voc√™ deve especificar o endere√ßo IP da interface do t√∫nel do par com o qual o t√∫nel est√° sendo constru√≠do.  O perfil indica os temporizadores e a a√ß√£o em caso de perda de conex√£o.  <b>Aguarde Recuperar</b> - aguarde at√© que a conex√£o seja restaurada, <b>Fail Over</b> - envie tr√°fego em outra rota, se houver.  A configura√ß√£o do segundo t√∫nel √© completamente a mesma; a segunda interface de t√∫nel e o IKE Gateway s√£o indicados. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fdb/29c/f75/fdb29cf75864f4fcf0ca5ec1d7459dc4.png" alt="imagem"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/96c/330/1cb/96c3301cb47e3dcbb449f5174227532a.png" alt="imagem"><br><br>  <b>‚Ä¢ configura√ß√£o de roteamento</b> <br><br>  Este exemplo usa roteamento est√°tico.  No firewall PA-1, al√©m de duas rotas padr√£o, voc√™ precisa especificar duas rotas para a sub-rede 10.10.10.0/24 na filial.  Uma rota usa o t√∫nel-1, a outra t√∫nel-2.  A rota pelo t√∫nel-1 √© b√°sica porque possui uma m√©trica mais baixa.  O mecanismo de <b>monitoramento de caminho</b> para essas rotas n√£o √© usado.  <b>O Tunnel Monitor</b> √© respons√°vel pela comuta√ß√£o. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f94/b4f/3ed/f94b4f3ed8ce6c2d44af95ebfaf3c1b1.png" alt="imagem"><br><br>  As mesmas rotas para a sub-rede 192.168.30.0/24 devem ser configuradas no PA-2. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bdd/a93/ffb/bdda93ffb9dc17d0765d7e6cf78515ad.png" alt="imagem"><br><br>  <b>‚Ä¢ Configurar regras de rede</b> <br><br>  Para que o t√∫nel funcione, voc√™ precisa de tr√™s regras: <br><br><ol><li>  Para que o <b>Path Monitor</b> funcione, ative o ICMP em interfaces externas. </li><li>  Para <b>IPSec,</b> ative aplicativos <b>ike</b> e <b>ipsec</b> em interfaces externas. </li><li>  Permitir tr√°fego entre sub-redes internas e interfaces de t√∫nel. </li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/157/271/34a/15727134adc31c0260c32ef6c2768248.png" alt="imagem"><br><br>  <b>Conclus√£o</b> <br><br>  Este artigo descreve a configura√ß√£o de uma conex√£o √† Internet √† prova de falhas e uma <b>VPN site a site</b> .  Esperamos que as informa√ß√µes sejam √∫teis e o leitor tenha uma id√©ia das tecnologias usadas nas <b>redes Palo Alto</b> .  Se voc√™ tiver d√∫vidas sobre personaliza√ß√£o e sugest√µes sobre os t√≥picos de futuros artigos - escreva-os nos coment√°rios, teremos o maior prazer em responder. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt448952/">https://habr.com/ru/post/pt448952/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt448942/index.html">Criptomoeda: vive ou morre?</a></li>
<li><a href="../pt448944/index.html">Fluent 1.0: sistema de localiza√ß√£o flex√≠vel</a></li>
<li><a href="../pt448946/index.html">Como come√ßar a aplicar o R ‚Äã‚Äãno Enterprise. Exemplo pr√°tico</a></li>
<li><a href="../pt448948/index.html">A ci√™ncia da l√≥gica na programa√ß√£o</a></li>
<li><a href="../pt448950/index.html">Faca de processamento json su√≠√ßo</a></li>
<li><a href="../pt448956/index.html">Raiva do c√≥digo: programadores e negatividade</a></li>
<li><a href="../pt448958/index.html">Como a Amazon escolhe suas ofertas aparentemente aleat√≥rias do dia. E por que os vendedores est√£o t√£o atr√°s deles</a></li>
<li><a href="../pt448960/index.html">Tecnologia XR ilimitada na era da computa√ß√£o distribu√≠da</a></li>
<li><a href="../pt448962/index.html">A efic√°cia do funil de marketing AARRR</a></li>
<li><a href="../pt448964/index.html">A torradeira oferece aos usu√°rios mais direitos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>