<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍🔧 👩🏿‍🚒 🍪 Comment nous avons conçu et mis en œuvre le nouveau réseau sur Huawei dans le bureau de Moscou, partie 1 🖖🏻 👔 📋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aujourd'hui, je vais parler de la façon dont l'idée de créer un nouveau réseau interne pour notre entreprise est apparue et s'est concrétisée. Positio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment nous avons conçu et mis en œuvre le nouveau réseau sur Huawei dans le bureau de Moscou, partie 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jetinfosystems/blog/455397/"><img src="https://habrastorage.org/webt/bo/8h/z8/bo8hz8x_sstu2ooz0yyiusyjaqs.png" alt="image"><br><br>  Aujourd'hui, je vais parler de la façon dont l'idée de créer un nouveau réseau interne pour notre entreprise est apparue et s'est concrétisée.  Position de gestion - pour vous-même, vous devez réaliser le même projet à part entière que pour le client.  Si nous le faisons bien pour nous-mêmes, nous pouvons inviter le client et montrer comment bien organisé et fonctionne ce que nous lui proposons.  Par conséquent, nous avons abordé le développement du concept d'un nouveau réseau pour le bureau de Moscou de manière très approfondie, en utilisant le cycle de production complet: analyse des besoins des départements → choix de la solution technique → conception → mise en œuvre → tests.  Alors c'est parti. <a name="habracut"></a><br><br><h2>  Choix de la solution technique: réserve de mutants </h2><br>  La procédure pour travailler sur un système automatisé complexe est jusqu'à présent mieux décrite dans GOST 34.601-90 «Systèmes automatisés.  Les étapes de la création », nous y avons donc travaillé.  Et déjà au stade de l'élaboration des exigences et du développement d'un concept, nous avons rencontré les premières difficultés.  Des organisations de profils variés - banques, assurances, développeurs de logiciels, etc. - pour leurs missions et normes, certains types de réseaux sont nécessaires, dont les spécificités sont claires et standardisées.  Cependant, cela ne fonctionnera pas avec nous. <br><br>  Pourquoi? <br><br>  Jet Infosystems est une grande entreprise informatique multidisciplinaire.  Dans le même temps, notre département de support interne est petit (mais fier), il assure la disponibilité des services et systèmes de base.  La société comprend de nombreuses divisions qui remplissent différentes fonctions: elle comprend plusieurs puissantes équipes d'impartition, et ses propres développeurs de systèmes commerciaux et de sécurité de l'information, et des architectes de complexes informatiques - en général, qui ne l'est pas.  En conséquence, leurs tâches, systèmes et politiques de sécurité sont également différents.  Ce qui était censé créer des difficultés dans le processus d'analyse des besoins et de leur standardisation. <br><br>  Par exemple, le service de développement: ses employés écrivent et testent du code pour un grand nombre de clients.  Souvent, il est nécessaire d'organiser rapidement des environnements de test, et franchement, il n'est pas toujours possible pour chaque projet de formuler des exigences, de demander des ressources et de créer un environnement de test séparé conformément à toutes les réglementations internes.  Cela donne lieu à des situations curieuses: une fois que votre humble serviteur a regardé dans la salle des développeurs et trouvé un cluster Hadoop de 20 postes de travail sous la table qui était inexplicablement connecté à un réseau commun.  Je pense qu'il ne vaut pas la peine de préciser que le service informatique de l'entreprise ne connaissait pas son existence.  Cette circonstance, comme beaucoup d'autres, est devenue la cause du fait que pendant le développement du projet, le terme «réserve mutante» est né, décrivant l'état de l'infrastructure de bureau qui souffre depuis longtemps. <br><br>  Ou voici un autre exemple.  Périodiquement, un banc d'essai est installé à l'intérieur d'une unité.  Ce fut le cas avec Jira et Confluence, qui étaient peu utilisés par le Software Development Center dans certains projets.  Après un certain temps, ces ressources utiles ont été découvertes dans d'autres divisions, évaluées et, fin 2018, Jira et Confluence sont passées du statut de "programmeurs de jouets locaux" au statut de "ressources de l'entreprise".  Maintenant, le propriétaire doit être affecté à ces systèmes, les SLA, les politiques d'accès / de sécurité, les politiques de sauvegarde, les politiques de surveillance, les règles de routage pour la résolution des demandes doivent être définies - en général, tous les attributs d'un système d'information complet doivent être présents. <br>  Chacune de nos unités est également un incubateur qui cultive ses propres produits.  Certains d'entre eux meurent au stade du développement, certains que nous utilisons pendant la période de travail sur les projets, tandis que d'autres prennent racine et deviennent des solutions reproduites que nous commençons à appliquer nous-mêmes et à vendre aux clients.  Pour chacun de ces systèmes, il est souhaitable d'avoir son propre environnement de réseau, où il se développera sans interférer avec d'autres systèmes, et à un moment donné, il pourra être intégré dans l'infrastructure de l'entreprise. <br><br>  En plus du développement, nous avons un très grand <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">centre de service</a> avec plus de 500 employés, formé en équipes pour chaque client.  Ils sont engagés dans la maintenance des réseaux et autres systèmes, la surveillance à distance, le règlement des applications, etc.  Autrement dit, l'infrastructure du <abbr title="Centre de service">SC</abbr> est, en fait, l'infrastructure du client avec lequel il travaille actuellement.  La particularité de travailler avec cette partie du réseau est que leurs postes de travail pour notre entreprise sont en partie externes et en partie internes.  Par conséquent, pour SC, nous avons mis en œuvre l'approche suivante - la société fournit à l'unité correspondante un réseau et d'autres ressources, en considérant les postes de travail de ces unités comme des connexions externes (similaires aux succursales et aux utilisateurs distants). <br><br><h2>  Conception d'autoroutes: nous sommes l'opérateur (surprise) </h2><br>  Après avoir évalué tous les écueils, nous avons réalisé que nous disposions du réseau d'un opérateur de télécommunications dans un seul bureau et avons commencé à agir en conséquence. <br><br>  Nous avons créé un réseau fédérateur, à l'aide duquel tout consommateur interne, et à long terme, externe est fourni avec le service requis: VPN L2, VPN L3 ou routage L3 conventionnel.  Certains départements ont besoin d'un accès Internet sécurisé, tandis que d'autres ont besoin d'un accès propre sans pare-feu, mais avec la protection de nos ressources d'entreprise et de notre réseau principal contre leur trafic. <br><br>  Avec chaque division, nous avons officieusement «conclu un SLA».  Conformément à celui-ci, tous les incidents survenus devraient être éliminés dans un certain délai préalablement convenu.  Les exigences de l'entreprise pour son réseau se sont avérées difficiles.  Le temps de réponse maximum aux incidents pour les pannes de téléphone et de courrier électronique était de 5 minutes.  Le temps de récupération du réseau lors de pannes typiques ne dépasse pas une minute. <br><br>  Comme nous avons un réseau de classe opérateur, vous ne pouvez vous y connecter qu'en stricte conformité avec les règles.  Les départements de service établissent des politiques et fournissent des services.  Ils n'ont même pas besoin d'informations sur les connexions de serveurs, de machines virtuelles et de postes de travail spécifiques.  Mais en même temps, des mécanismes de protection sont nécessaires, car aucune connexion ne doit désactiver le réseau.  Lors de la création accidentelle d'une boucle, les autres utilisateurs ne doivent pas le remarquer, c'est-à-dire qu'une réponse réseau adéquate est nécessaire.  Tout opérateur de télécommunications résout constamment ces tâches apparemment complexes au sein de son réseau principal.  Il fournit des services à de nombreux clients ayant des besoins et un trafic différents.  Dans le même temps, différents abonnés ne devraient pas être gênés par le trafic des autres. <br>  À la maison, nous avons résolu ce problème comme suit: nous avons construit un réseau L3 de base avec une redondance complète en utilisant le <abbr title="Système intermédiaire à système intermédiaire">protocole IS-IS</abbr> .  Un réseau de superposition basé sur la technologie <abbr title="Réseau local virtuel extensible"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">EVPN</a></abbr> / <abbr title="Réseau local virtuel extensible"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">VXLAN a</a></abbr> été construit au-dessus du réseau principal, en utilisant le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">protocole de</a> routage <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MP-BGP</a> .  Pour accélérer la convergence des protocoles de routage, la technologie <abbr title="Détection de retransmission bidirectionnelle">BFD a</abbr> été utilisée. <br><br><img src="https://habrastorage.org/webt/nq/em/2c/nqem2cmbfmocygufrjxasqqouqo.png" alt="image"><br>  <i>Structure du réseau</i> <br><br>  Dans les tests, un tel schéma s'est révélé excellent - lorsqu'un canal ou un commutateur est désactivé, le temps de convergence ne dépasse pas 0,1-0,2 s, un minimum de paquets (souvent aucun) est perdu, les sessions TCP ne sont pas interrompues, les conversations téléphoniques ne sont pas interrompues. <br><br><img src="https://habrastorage.org/webt/gw/zc/cg/gwzccgmva3btuvrxxiv1hbwssac.png" alt="Sous-couche"><br>  <i>Niveau de calque sous-jacent - Routage</i> <br><br><img src="https://habrastorage.org/webt/co/vx/4w/covx4wy-1ykygd9lfjf2tu6h158.png" alt="Superposition"><br>  <i>Superposition de niveaux - Routage</i> <br><br>  En tant que commutateurs de distribution, des commutateurs Huawei CE6870 avec des licences VXLAN ont été utilisés.  Cet appareil a une combinaison optimale de prix / qualité, vous permet de connecter des abonnés à une vitesse de 10 Gbit / s, et de se connecter au tronc à des vitesses de 40-100 Gbit / s, selon les émetteurs-récepteurs utilisés. <br><br><img src="https://habrastorage.org/webt/4k/gq/qh/4kgqqhwjylwbxjmte4j02jyqzhk.jpeg" alt="image"><br>  <i>Commutateurs Huawei CE6870</i> <br><br>  En tant que commutateurs principaux, les commutateurs Huawei CE8850 ont été utilisés.  De la tâche - pour transmettre rapidement et de manière fiable du trafic.  Aucun périphérique n'y est connecté, à l'exception des commutateurs de distribution, ils ne connaissent rien au VXLAN, par conséquent, un modèle avec 32 ports 40/100 Gbit / s a ​​été choisi, avec une licence de base qui fournit le routage L3 et la prise en charge des protocoles IS-IS et MP-BGP . <br><br><img src="https://habrastorage.org/webt/tf/8y/3w/tf8y3wtb1sjyfsqd2qmbcunby88.jpeg" alt="image"><br>  <i>Le plus bas est le commutateur de base Huawei CE8850</i> <br><br>  Au stade de la conception, une discussion a éclaté au sein de l'équipe sur les technologies avec lesquelles vous pouvez implémenter une connexion de sécurité aux nœuds du réseau principal.  Notre bureau de Moscou est situé dans trois bâtiments, nous avons 7 chambres croisées, dans chacune desquelles deux commutateurs de distribution Huawei CE6870 ont été installés (seuls quelques commutateurs d'accès ont été installés dans plusieurs chambres croisées).  Lors du développement du concept de réseau, deux options de sauvegarde ont été envisagées: <br><br><ul><li>  Combinaison des commutateurs de distribution en une pile à sécurité intégrée dans chaque pièce transversale.  Avantages: simplicité et facilité d'installation.  Inconvénients: il y a une probabilité plus élevée de défaillance de la pile entière lors de la manifestation d'erreurs dans le micrologiciel des périphériques réseau («fuites de mémoire», etc.). </li><li>  Appliquez les technologies de passerelle M-LAG et Anycast pour connecter des appareils aux commutateurs de distribution. </li></ul><br><br>  En conséquence, nous avons opté pour la deuxième option.  Il est un peu plus difficile à configurer, mais en pratique, il a montré ses performances et sa haute fiabilité. <br>  Envisagez d'abord de connecter des terminaux aux commutateurs de distribution: <br><img src="https://habrastorage.org/webt/yr/gr/f-/yrgrf-9_tqqfajlcyos0fh2ar94.png" alt="Croix"><br>  <i>Croix</i> <br><br>  Un commutateur d'accès, un serveur ou tout autre périphérique nécessitant une connexion de basculement est inclus dans deux commutateurs de distribution.  La technologie M-LAG assure la redondance des liaisons.  On suppose que deux commutateurs de distribution ressemblent à un seul appareil pour l'équipement connecté.  La redondance et l'équilibrage de charge sont effectués à l'aide du protocole LACP. <br><br>  La technologie de passerelle Anycast fournit une redondance au niveau du réseau.  Chaque commutateur de distribution est configuré avec un nombre suffisamment important de VRF (chaque VRF est conçu pour ses propres besoins - séparément pour les utilisateurs «ordinaires», séparément pour la téléphonie, séparément pour différents environnements de test et de développement, etc.), et dans chaque VRF a configuré plusieurs VLAN.  Dans notre réseau, les commutateurs de distribution sont les passerelles par défaut pour tous les appareils qui leur sont connectés.  Les adresses IP correspondant aux VLAN sont les mêmes pour les deux commutateurs de distribution.  Le trafic est acheminé via le commutateur le plus proche. <br><br>  Pensez maintenant à connecter les commutateurs de distribution au noyau: <br>  La tolérance aux pannes est fournie au niveau du réseau, selon le protocole IS-IS.  Veuillez noter - entre les commutateurs, une ligne de communication L3 distincte est fournie, à une vitesse de 100G.  Physiquement, cette ligne de communication est un câble à accès direct, on peut le voir à droite sur la photo des commutateurs Huawei CE6870. <br><br>  Une alternative serait d'organiser une topologie double étoile «honnête» entièrement connectée, mais, comme mentionné ci-dessus, nous avons 7 chambres transversales dans trois bâtiments.  En conséquence, si nous choisissions la topologie «double étoile», nous aurions alors besoin d'exactement deux fois plus d'émetteurs-récepteurs 40G «à longue portée».  Les économies ici sont très importantes. <br><br>  Je dois dire quelques mots sur la façon dont les technologies de passerelle VXLAN et Anycast fonctionnent ensemble.  VXLAN, s'il n'entre pas dans les détails, est un tunnel pour transporter des trames Ethernet à l'intérieur de paquets UDP.  Les interfaces de bouclage des commutateurs de distribution sont utilisées comme adresse IP de destination du tunnel VXLAN.  Chaque commutateur a deux commutateurs avec les mêmes adresses d'interface de bouclage, respectivement, un paquet peut arriver à l'un d'eux et une trame Ethernet peut en être extraite. <br><br>  Si le commutateur connaît l'adresse MAC de destination de la trame extraite, la trame sera correctement livrée à sa destination.  Le mécanisme M-LAG, qui assure la synchronisation des tables d'adresses MAC (ainsi que des tables ARP) sur les deux, est chargé de s'assurer que les deux commutateurs de distribution installés sur un seul croisement ont des informations à jour sur toutes les adresses MAC qui arrivent des commutateurs d'accès. Commutateurs à paire M-LAG. <br><br>  L'équilibrage du trafic est obtenu grâce à la présence dans le réseau sous-jacent de plusieurs routes vers les interfaces de bouclage des commutateurs de distribution. <br><br><h2>  Au lieu d'une conclusion </h2><br>  Comme mentionné ci-dessus, pendant les tests et en fonctionnement, le réseau a montré une haute fiabilité (temps de récupération pour les pannes typiques pas plus de centaines de millisecondes) et de bonnes performances - chacune étant interconnectée avec le cœur par deux canaux de 40 Gbit / s.  Les commutateurs d'accès de notre réseau sont empilés et connectés aux commutateurs de distribution via LACP / M-LAG avec deux canaux 10 Gb / s.  La pile a généralement 5 commutateurs avec 48 ports chacun, jusqu'à 10 piles d'accès sont connectées à la distribution dans chaque croix.  Ainsi, le backbone fournit environ 30 Mbit / s par utilisateur, même à une charge théorique maximale, ce qui au moment de la rédaction est suffisant pour toutes nos applications pratiques. <br><br>  Le réseau vous permet d'organiser facilement l'appairage de tout périphérique connecté arbitrairement à la fois via L2 et L3, offrant une isolation complète du trafic (qui est apprécié par le service de sécurité de l'information) et des domaines de défaillance (qui est apprécié par le service d'exploitation). <br><br>  Dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">partie suivante</a> , nous décrirons comment nous avons migré vers un nouveau réseau.  Restez à l'écoute! <br><br>  <i>Maxim Klochkov</i> <i><br></i>  <i>Consultant principal, Audit de réseau et projets intégrés</i> <i><br></i>  <i>Centre de solutions réseau</i> <i><br></i>  <i>Jet Infosystems</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr455397/">https://habr.com/ru/post/fr455397/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr455381/index.html">Le support technique de 3CX répond: capturez le trafic SIP sur le serveur PBX</a></li>
<li><a href="../fr455387/index.html">Comprendre l'apprentissage automatique dans Elastic Stack (aka Elasticsearch, aka ELK)</a></li>
<li><a href="../fr455389/index.html">Haxe 4: Quoi de neuf?</a></li>
<li><a href="../fr455391/index.html">Partie 1: RISC-V / RocketChip dans un habitat non naturel</a></li>
<li><a href="../fr455393/index.html">Sur l'utilisation des méthodes paramétriques d'estimation spectrale en radar - la méthode MUSIC. Ajout à l'article</a></li>
<li><a href="../fr455401/index.html">Tcl pour Cisco IOS dans des exemples simples</a></li>
<li><a href="../fr455403/index.html">De cinq cents au jeu des divinités</a></li>
<li><a href="../fr455405/index.html">Comment un petit programme a transformé un petit bureau en une entreprise fédérale avec un bénéfice de plus de 100 millions de roubles / mois</a></li>
<li><a href="../fr455407/index.html">Voitures électriques et pointe des ventes de voitures à essence</a></li>
<li><a href="../fr455409/index.html">Compatibilité descendante</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>