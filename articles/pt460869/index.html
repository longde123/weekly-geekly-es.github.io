<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêõ üëì üîÄ Reconhecimento de objetos em tempo real no iOS usando YOLOv3 üê¶ üì¶ üßëüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° pessoal! 

 Neste artigo, escreveremos um pequeno programa para resolver o problema de detec√ß√£o e reconhecimento de objetos (detec√ß√£o de objetos) ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Reconhecimento de objetos em tempo real no iOS usando YOLOv3</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460869/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/gr/ah/g9/grahg9mh7movhc2fcbn7m-yfoxu.png"></div><br>  Ol√° pessoal! <br><br>  Neste artigo, escreveremos um pequeno programa para resolver o problema de detec√ß√£o e reconhecimento de objetos (detec√ß√£o de objetos) em tempo real.  O programa ser√° escrito na linguagem de programa√ß√£o Swift para a plataforma iOS.  Para detectar objetos, usaremos uma rede neural convolucional com uma arquitetura chamada YOLOv3.  No artigo, aprenderemos como trabalhar no iOS com redes neurais usando a estrutura CoreML, um pouco de compreens√£o do que √© a rede YOLOv3 e como usar e processar as sa√≠das dessa rede.  Tamb√©m verificaremos o funcionamento do programa e comparamos diversas varia√ß√µes de YOLOv3: YOLOv3-tiny e YOLOv3-416. <br><br>  As fontes estar√£o dispon√≠veis no final do artigo, para que todos possam testar a opera√ß√£o da rede neural em seu dispositivo. <br><a name="habracut"></a><br><h2>  Detec√ß√£o de objetos </h2><br>  Para come√ßar, entenderemos brevemente qual √© a tarefa de detectar objetos (detec√ß√£o de objetos) na imagem e quais ferramentas s√£o usadas para isso hoje.  Entendo que muitos est√£o bastante familiarizados com este t√≥pico, mas ainda me permito contar um pouco sobre ele. <br><br>  Agora, muitas tarefas no campo da vis√£o computacional s√£o resolvidas com a ajuda de redes neurais convolucionais (Redes Neurais Convolucionais), a seguir denominadas CNN.  Devido √† sua estrutura, eles extraem recursos da imagem.  As CNNs s√£o usadas na classifica√ß√£o, reconhecimento, segmenta√ß√£o e muitas outras. <br><br>  Arquiteturas CNN populares para reconhecimento de objetos: <br><br><ul><li>  <b>R-CNN.</b>  Podemos dizer o primeiro modelo para resolver este problema.  Funciona como um classificador de imagem comum.  Diferentes regi√µes da imagem s√£o alimentadas √† entrada da rede e s√£o feitas previs√µes para elas.  Muito lento, pois executa uma √∫nica imagem milhares de vezes. </li><li>  <b>R-CNN r√°pido.</b>  Uma vers√£o aprimorada e mais r√°pida do R-CNN, funciona com um princ√≠pio semelhante, mas primeiro a imagem inteira √© alimentada na entrada da CNN, depois as regi√µes s√£o geradas a partir da representa√ß√£o interna recebida.  Mas ainda √© muito lento para tarefas em tempo real. </li><li>  <b>R-CNN mais r√°pido.</b>  A principal diferen√ßa dos anteriores √© que, em vez do algoritmo de busca seletiva, ele usa uma rede neural para selecionar regi√µes para "memoriz√°-las". </li><li>  <b>YOLO.</b>  Um princ√≠pio de opera√ß√£o completamente diferente dos anteriores n√£o usa regi√µes.  O mais r√°pido.  Mais detalhes ser√£o discutidos no artigo. </li><li>  <b>SSD</b>  √â semelhante em princ√≠pio ao YOLO, mas usa o VGG16 como uma rede para extrair recursos.  Tamb√©m muito r√°pido e adequado para trabalho em tempo real. </li><li>  <b>Redes de pir√¢mides de recursos (FPN).</b>  Outro tipo de rede, como o Single Shot Detector, devido aos recursos de extra√ß√£o de recursos, √© melhor do que o SSD reconhece objetos pequenos. </li><li>  <b>RetinaNet.</b>  Utiliza uma combina√ß√£o de FPN + ResNet e, gra√ßas a uma fun√ß√£o de erro especial (perda focal), proporciona uma precis√£o mais alta. </li></ul><br>  Neste artigo, usaremos a arquitetura YOLO, ou seja, sua √∫ltima modifica√ß√£o, YOLOv3. <br><br><h2>  Por que YOLO? </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i4/fy/lq/i4fylqlbpgsp-mu3w6k96zd5e1u.jpeg"></div><br><br>  YOLO ou You Only Look Once √© a arquitetura muito popular da CNN, usada para reconhecer v√°rios objetos em uma imagem.  Informa√ß√µes mais completas sobre isso podem ser obtidas no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site oficial</a> , no mesmo local, voc√™ pode encontrar publica√ß√µes nas quais a teoria e o componente matem√°tico dessa rede s√£o descritos em detalhes, assim como o processo de treinamento. <br><br>  A principal caracter√≠stica dessa arquitetura em compara√ß√£o com outras √© que a maioria dos sistemas aplica a CNN v√°rias vezes em diferentes regi√µes da imagem; no YOLO, a CNN √© aplicada uma vez √† imagem inteira de uma s√≥ vez.  A rede divide a imagem em um tipo de grade e prev√™ caixas delimitadoras e a probabilidade de haver um objeto desejado para cada se√ß√£o. <br><br>  As vantagens dessa abordagem √© que a rede olha para a imagem inteira de uma s√≥ vez e leva em considera√ß√£o o contexto ao detectar e reconhecer um objeto.  O YOLO tamb√©m √© 1000 vezes mais r√°pido que o R-CNN e cerca de 100x mais r√°pido que o Fast R-CNN.  Neste artigo, lan√ßaremos uma rede em um dispositivo m√≥vel para processamento online, portanto, essa √© a qualidade mais importante para n√≥s. <br><br>  Informa√ß√µes mais detalhadas sobre a compara√ß√£o de arquiteturas podem ser encontradas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br><h4>  YOLOv3 </h4><br>  YOLOv3 √© uma vers√£o avan√ßada da arquitetura YOLO.  Consiste em 106 camadas convolucionais e detecta melhor objetos pequenos em compara√ß√£o com seu predecessor YOLOv2.  A principal caracter√≠stica do YOLOv3 √© que existem tr√™s camadas na sa√≠da, cada uma delas projetada para detectar objetos de tamanhos diferentes. <br>  A figura abaixo mostra sua estrutura esquem√°tica: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cl/rf/_j/clrf_jqzkt1qfszivfchhxkujv4.png"></div><br><br>  <b>YOLOv3-tiny</b> - Uma vers√£o cortada da arquitetura YOLOv3 consiste em menos camadas (existem apenas duas camadas de sa√≠da).  Ele prev√™ objetos menores piores e √© destinado a pequenos conjuntos de dados.  Por√©m, devido √† estrutura truncada, os pesos da rede ocupam uma pequena quantidade de mem√≥ria (~ 35 MB) e produz um FPS mais alto.  Portanto, essa arquitetura √© prefer√≠vel para uso em um dispositivo m√≥vel. <br><br><h2>  Estamos escrevendo um programa para reconhecimento de objetos </h2><br>  A parte divertida come√ßa! <br><br>  Vamos criar um aplicativo que reconhe√ßa v√°rios objetos na imagem em tempo real usando a c√¢mera do telefone.  Todo o c√≥digo ser√° escrito na linguagem de programa√ß√£o Swift 4.2 e executado em um dispositivo iOS. <br><br>  Neste tutorial, teremos uma rede pronta com escalas pr√©-treinadas em um conjunto de dados <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">COCO</a> .  Apresenta 80 classes diferentes.  Portanto, nosso neur√¥nio ser√° capaz de reconhecer 80 objetos diferentes. <br><br><h4>  Do Darknet ao CoreML </h4><br>  A arquitetura YOLOv3 original √© implementada usando a estrutura <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Darknet</a> . <br><br>  No iOS, a partir da vers√£o 11.0, existe uma maravilhosa biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CoreML</a> que permite executar modelos de aprendizado de m√°quina diretamente no dispositivo.  Mas h√° uma limita√ß√£o: o <b>programa s√≥ pode ser executado em um dispositivo executando o iOS 11 e superior.</b> <br><br>  O problema √© que o CoreML entende apenas o formato espec√≠fico do modelo <i>.coreml</i> .  Para as bibliotecas mais populares, como Tensorflow, Keras ou XGBoost, √© poss√≠vel converter diretamente para o formato CoreML.  Mas para a Darknet n√£o existe essa possibilidade.  Para converter o modelo salvo e treinado de Darknet em CoreML, voc√™ pode usar v√°rias op√ß√µes, por exemplo, salvar Darknet em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ONNX</a> e depois convert√™-lo de ONNX em CoreML. <br><br>  Usaremos uma maneira mais simples e usaremos a implementa√ß√£o Keras do YOLOv3.  O algoritmo de a√ß√£o √© o seguinte: carregue os pesos Darknet no modelo Keras, salve-o no formato Keras e converta-o diretamente para CoreML a partir disso. <br><br><ol><li>  <b>Fa√ßa o download do Darknet.</b>  Fa√ßa o download dos arquivos do modelo Darknet-YOLOv3 treinado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  Neste artigo, usarei duas arquiteturas: YOLOv3-416 e YOLOv3-tiny.  Vamos precisar de arquivos cfg e pesos. </li><li>  <b>De Darknet a Keras.</b>  Primeiro, clone o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reposit√≥rio</a> , v√° para a pasta repo e execute o comando: <br><br><pre><code class="bash hljs">python convert.py yolov3.cfg yolov3.weights yolo.h5</code> </pre> <br>  onde yolov3.cfg e yolov3.weights baixaram arquivos Darknet.  Como resultado, devemos ter um arquivo com a extens√£o <i>.h5</i> - este √© o modelo YOLOv3 salvo no formato Keras. </li><li>  <b>Do Keras ao CoreML.</b>  O √∫ltimo passo permaneceu.  Para converter o modelo em CoreML, √© necess√°rio executar o script python (voc√™ deve primeiro instalar a biblioteca coremltools para python): <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> coremltools coreml_model = coremltools.converters.keras.convert( <span class="hljs-string"><span class="hljs-string">'yolo.h5'</span></span>, input_names=<span class="hljs-string"><span class="hljs-string">'image'</span></span>, image_input_names=<span class="hljs-string"><span class="hljs-string">'image'</span></span>, input_name_shape_dict={<span class="hljs-string"><span class="hljs-string">'image'</span></span>: [<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-number"><span class="hljs-number">416</span></span>, <span class="hljs-number"><span class="hljs-number">416</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>]}, <span class="hljs-comment"><span class="hljs-comment">#      image_scale=1/255.) coreml_model.input_description['image'] = 'Input image' coreml_model.save('yolo.mlmodel')</span></span></code> </pre> </li></ol><br>  As etapas descritas acima devem ser executadas para os dois modelos YOLOv3-416 e YOLOv3-tiny. <br>  Quando fizemos tudo isso, temos dois arquivos: yolo.mlmodel e yolo-tiny.mlmodel.  Agora voc√™ pode come√ßar a escrever o c√≥digo do pr√≥prio aplicativo. <br><br><h4>  Criando um aplicativo iOS </h4><br>  N√£o descreverei todo o c√≥digo do aplicativo, voc√™ pode v√™-lo no reposit√≥rio, cujo link ser√° fornecido no final do artigo.  Deixe-me apenas dizer que temos tr√™s UIViewController-a: OnlineViewController, PhotoViewController e SettingsViewController.  A primeira √© a sa√≠da da c√¢mera e a detec√ß√£o on-line de objetos para cada quadro.  No segundo, voc√™ pode tirar uma foto ou selecionar uma foto da galeria e testar a rede nessas imagens.  O terceiro cont√©m as configura√ß√µes. Voc√™ pode escolher o modelo YOLOv3-416 ou YOLOv3-tiny, al√©m de escolher os limites IoU (interse√ß√£o sobre a uni√£o) e a confian√ßa do objeto (a probabilidade de haver um objeto na se√ß√£o de imagem atual). <br><br>  <b>Carregando modelos no CoreML</b> <br><br>  Depois de convertermos o modelo treinado do formato Darknet para CoreML, temos um arquivo com a extens√£o <i>.mlmodel</i> .  No meu caso, criei dois arquivos: <i>yolo.mlmodel</i> e <i>yolo-tiny.mlmodel</i> , para os modelos YOLOv3-416 e YOLOv3-tiny, respectivamente.  Agora voc√™ pode carregar esses arquivos em um projeto no Xcode. <br><br>  Criamos a classe ModelProvider, que armazenar√° o modelo e os m√©todos atuais para invoca√ß√£o ass√≠ncrona da rede neural para execu√ß√£o.  O modelo √© carregado desta maneira: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: YOLOType)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.model = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-type"><span class="hljs-type">YOLO</span></span>(type: type) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">assertionFailure</span></span>(<span class="hljs-string"><span class="hljs-string">"error creating model"</span></span>) } }</code> </pre><br>  A classe YOLO √© diretamente respons√°vel por carregar arquivos <i>.mlmodel</i> e manipular sa√≠das de modelo.  Fa√ßa o download dos arquivos de modelo: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url: <span class="hljs-type"><span class="hljs-type">URL?</span></span> = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.type = type <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> type { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .v3_Tiny: url = <span class="hljs-type"><span class="hljs-type">Bundle</span></span>.main.url(forResource: <span class="hljs-string"><span class="hljs-string">"yolo-tiny"</span></span>, withExtension:<span class="hljs-string"><span class="hljs-string">"mlmodelc"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.anchors = tiny_anchors <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .v3_416: url = <span class="hljs-type"><span class="hljs-type">Bundle</span></span>.main.url(forResource: <span class="hljs-string"><span class="hljs-string">"yolo"</span></span>, withExtension:<span class="hljs-string"><span class="hljs-string">"mlmodelc"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.anchors = anchors_416 } <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> modelURL = url <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-type"><span class="hljs-type">YOLOError</span></span>.modelFileNotFound } <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { model = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-type"><span class="hljs-type">MLModel</span></span>(contentsOf: modelURL) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(error) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-type"><span class="hljs-type">YOLOError</span></span>.modelCreationError }</code> </pre><br><div class="spoiler">  <b class="spoiler_title">C√≥digo completo do fornecedor do modelo.</b> <div class="spoiler_text"><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> UIKit <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> CoreML protocol ModelProviderDelegate: class { func show(predictions: [YOLO.Prediction]?, stat: ModelProvider.Statistics, error: YOLOError?) } @available(macOS 10.13, iOS 11.0, tvOS 11.0, watchOS 4.0, *) class ModelProvider { struct Statistics { var timeForFrame: Float var fps: Float } static let shared = ModelProvider(modelType: Settings.shared.modelType) var model: YOLO! weak var delegate: ModelProviderDelegate? var predicted = 0 var timeOfFirstFrameInSecond = CACurrentMediaTime() init(modelType type: YOLOType) { loadModel(type: type) } func reloadModel(type: YOLOType) { loadModel(type: type) } private func loadModel(type: YOLOType) { do { self.model = try YOLO(type: type) } catch { assertionFailure("error creating model") } } func predict(frame: UIImage) { DispatchQueue.global().async { do { let startTime = CACurrentMediaTime() let predictions = try self.model.predict(frame: frame) let elapsed = CACurrentMediaTime() - startTime self.showResultOnMain(predictions: predictions, elapsed: Float(elapsed), error: nil) } catch let error as YOLOError { self.showResultOnMain(predictions: nil, elapsed: -1, error: error) } catch { self.showResultOnMain(predictions: nil, elapsed: -1, error: YOLOError.unknownError) } } } private func showResultOnMain(predictions: [YOLO.Prediction]?, elapsed: Float, error: YOLOError?) { if let delegate = self.delegate { DispatchQueue.main.async { let fps = self.measureFPS() delegate.show(predictions: predictions, stat: ModelProvider.Statistics(timeForFrame: elapsed, fps: fps), error: error) } } } private func measureFPS() -&gt; Float { predicted += 1 let elapsed = CACurrentMediaTime() - timeOfFirstFrameInSecond let currentFPSDelivered = Double(predicted) / elapsed if elapsed &gt; 1 { predicted = 0 timeOfFirstFrameInSecond = CACurrentMediaTime() } return Float(currentFPSDelivered) } }</code> </pre><br></div></div><br>  <b>Processamento de sa√≠da de rede neural</b> <br><br>  Agora vamos descobrir como processar as sa√≠das da rede neural e obter as caixas delimitadoras correspondentes.  No Xcode, se voc√™ selecionar um arquivo de modelo, poder√° ver o que s√£o e as camadas de sa√≠da. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/m_/3b/vz/m_3bvzkroynfyfkpv1fal-ydf_k.png"></div><br>  <i>Entrada e sa√≠da YOLOv3-tiny.</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0l/nl/hy/0lnlhydblax7trhpzdte8bojc0y.png"></div><br>  <i>Entrada e sa√≠da YOLOv3-416.</i> <br><br>  Como voc√™ pode ver na imagem acima, temos tr√™s para YOLOv3-416 e duas para pequenas camadas de sa√≠da YOLOv3 em cada uma das caixas delimitadoras para v√°rios objetos. <br>  Nesse caso, esse √© um conjunto regular de n√∫meros, vamos descobrir como analis√°-lo. <br><br>  O modelo YOLOv3 usa tr√™s camadas como sa√≠da para dividir a imagem em uma grade diferente. Os tamanhos das c√©lulas dessas grades t√™m os seguintes valores: 8, 16 e 32. Suponha que tenhamos uma imagem de 416x416 pixels de tamanho na entrada e as matrizes de sa√≠da ter√£o um tamanho de 52x52 , 26x26 e 13x13 (416/8 = 52, 416/16 = 26 e 416/32 = 13).  No caso do YOLOv3-tiny, tudo √© o mesmo, mas em vez de tr√™s grades, temos duas: 16 e 32, ou seja, matrizes de dimens√µes 26x26 e 13x13. <br><br>  Ap√≥s iniciar o modelo CoreML carregado, obtemos dois (ou tr√™s) objetos da classe MLMultiArray na sa√≠da.  E se voc√™ observar a propriedade shape desses objetos, veremos a seguinte figura (para YOLOv3-tiny): <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mo stretchy=&quot;false&quot;>[</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>255</mn><mo>,</mo><mn>26</mn><mo>,</mo><mn>26</mn><mo stretchy=&quot;false&quot;>]</mo><mspace linebreak=&quot;newline&quot; /><mo stretchy=&quot;false&quot;>[</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>255</mn><mo>,</mo><mn>13</mn><mo>,</mo><mn>13</mn><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="76.867ex" height="6.033ex" viewBox="0 -832 33095.6 2597.7" role="img" focusable="false" style="vertical-align: -4.101ex; max-width: 638px;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(13126,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-31" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-2C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-31" x="1224" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-2C" x="1724" y="0"></use><g transform="translate(2169,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-35" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-35" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-2C" x="3671" y="0"></use><g transform="translate(4116,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-36" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-2C" x="5117" y="0"></use><g transform="translate(5562,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-36" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-5D" x="6563" y="0"></use></g><g transform="translate(13126,-1433)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-31" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-2C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-31" x="1224" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-2C" x="1724" y="0"></use><g transform="translate(2169,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-35" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-35" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-2C" x="3671" y="0"></use><g transform="translate(4116,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-33" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-2C" x="5117" y="0"></use><g transform="translate(5562,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-33" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-5D" x="6563" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo stretchy="false">[</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>255</mn><mo>,</mo><mn>26</mn><mo>,</mo><mn>26</mn><mo stretchy="false">]</mo><mspace linebreak="newline"></mspace><mo stretchy="false">[</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>255</mn><mo>,</mo><mn>13</mn><mo>,</mo><mn>13</mn><mo stretchy="false">]</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> [1, 1, 255, 26, 26] \\ [1, 1, 255, 13, 13] </script></p><br>  Como esperado, a dimens√£o das matrizes ser√° 26 x 26 e 13 x 13. Mas o que o n√∫mero 255 significa?  Como mencionado anteriormente, as camadas de sa√≠da s√£o matrizes 52x52, 26x26 e 13x13.  O fato √© que cada elemento dessa matriz n√£o √© um n√∫mero, √© um vetor.  Ou seja, a camada de sa√≠da √© uma matriz tridimensional.  Esse vetor tem a dimens√£o B x (5 + C), onde B √© o n√∫mero da caixa delimitadora na c√©lula, C √© o n√∫mero de classes.  De onde vem o n√∫mero 5?  A raz√£o √© a seguinte: para cada caixa-a, a probabilidade de predi√ß√£o de um objeto (confian√ßa do objeto) √© um n√∫mero, e os quatro restantes s√£o x, y, largura e altura para a caixa-predita.  A figura abaixo mostra uma representa√ß√£o esquem√°tica deste vetor: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3d/j3/rl/3dj3rlk_te-4x-pthae9mreq7k0.png"></div><br>  <i>Representa√ß√£o esquem√°tica da camada de sa√≠da (mapa de recursos).</i> <br><br>  Para nossa rede treinada em 80 classes, s√£o previstas 3 caixas delimitadoras a para cada c√©lula da grade de parti√ß√µes, para cada uma delas - 80 probabilidades de classe + confian√ßa no objeto + 4 n√∫meros respons√°veis ‚Äã‚Äãpela posi√ß√£o e tamanho dessa caixa-a.  Total: 3 x (5 + 80) = 255. <br><br>  Para obter esses valores da classe MLMultiArray, √© melhor usar um ponteiro bruto para uma matriz de dados e aritm√©tica de endere√ßo: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pointer = <span class="hljs-type"><span class="hljs-type">UnsafeMutablePointer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Double</span></span>&gt;(<span class="hljs-type"><span class="hljs-type">OpaquePointer</span></span>(out.dataPointer)) <span class="hljs-comment"><span class="hljs-comment">//    if out.strides.count &lt; 3 { throw YOLOError.strideOutOfBounds } let channelStride = out.strides[out.strides.count-3].intValue let yStride = out.strides[out.strides.count-2].intValue let xStride = out.strides[out.strides.count-1].intValue func offset(ch: Int, x: Int, y: Int) -&gt; Int { //     return ch * channelStride + y * yStride + x * xStride }</span></span></code> </pre><br>  Agora voc√™ precisa processar um vetor de 255 elementos.  Para cada caixa, √© necess√°rio obter uma distribui√ß√£o de probabilidade para 80 classes, voc√™ pode fazer isso usando a fun√ß√£o softmax. <br><br><div class="spoiler">  <b class="spoiler_title">O que √© softmax</b> <div class="spoiler_text">  Fun√ß√£o converte um vetor <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>m</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi>b</mi><mi>b</mi><mi>x</mi></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.354ex" height="2.074ex" viewBox="0 -772.3 4027.5 892.8" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-6D" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-61" x="1128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-74" x="1658" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-68" x="2019" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-62" x="2596" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-62" x="3025" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-78" x="3455" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>m</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi>b</mi><mi>b</mi><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-2"> \ mathbb x </script>  dimens√£o K em um vetor da mesma dimens√£o, em que cada coordenada <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>m</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi>b</mi><mi>b</mi><msub><mi>x</mi><mi>i</mi></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.154ex" height="2.349ex" viewBox="0 -772.3 4371.8 1011.3" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-6D" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-61" x="1128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-74" x="1658" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-68" x="2019" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-62" x="2596" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-62" x="3025" y="0"></use><g transform="translate(3455,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-69" x="809" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>m</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi>b</mi><mi>b</mi><msub><mi>x</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-3"> \ mathbb x_i </script>  o vetor resultante √© representado por um n√∫mero real no intervalo [0,1] e a soma das coordenadas √© 1. <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>a</mi><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>m</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi>b</mi><mi>b</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>x</mi></mrow><msub><mo stretchy=&quot;false&quot;>)</mo><mi>i</mi></msub><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msup><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>x</mi><mi>i</mi></msub></mrow></msup></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>u</mi><msubsup><mi>m</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>K</mi></mrow></msubsup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msup><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>x</mi><mi>k</mi></msub></mrow></msup></mrow></mrow></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="41.144ex" height="3.037ex" viewBox="0 -890.8 17714.6 1307.5" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.968ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-73" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-69" x="719" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-67" x="1065" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-6D" x="1545" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-61" x="2424" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-28" x="2953" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-6D" x="3593" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-61" x="4471" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-74" x="5001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-68" x="5362" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-62" x="5939" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-62" x="6368" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-78" x="6798" y="0"></use><g transform="translate(7370,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-29" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-69" x="550" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-3D" x="8382" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-66" x="9688" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-72" x="10238" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-61" x="10690" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-63" x="11219" y="0"></use><g transform="translate(11653,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-65" x="0" y="0"></use><g transform="translate(466,412)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-69" x="809" y="-213"></use></g></g><g transform="translate(12868,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-73" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-75" x="719" y="0"></use><g transform="translate(1292,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-4B" x="1242" y="488"></use><g transform="translate(878,-327)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-3D" x="521" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-31" x="1300" y="0"></use></g></g><g transform="translate(3543,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-65" x="0" y="0"></use><g transform="translate(466,412)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-6B" x="809" y="-213"></use></g></g></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>&nbsp;</mtext><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>a</mi><mo stretchy="false">(</mo><mtext>&nbsp;</mtext><mi>m</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi>b</mi><mi>b</mi><mrow class="MJX-TeXAtom-ORD"><mi>x</mi></mrow><msub><mo stretchy="false">)</mo><mi>i</mi></msub><mo>=</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>x</mi><mi>i</mi></msub></mrow></msup></mrow><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>s</mi><mi>u</mi><msubsup><mi>m</mi><mrow class="MJX-TeXAtom-ORD"><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>K</mi></mrow></msubsup><mrow class="MJX-TeXAtom-ORD"><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>x</mi><mi>k</mi></msub></mrow></msup></mrow></mrow></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-4"> \ sigma (\ mathbb {x}) _ i = \ frac {e ^ {x_i}} {\ sum_ {k = 1} ^ {K} {e ^ {x_k}}} </script></p>  onde K √© a dimens√£o do vetor. <br></div></div><br>  Fun√ß√£o Softmax no Swift: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">softmax</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">inout</span></span></span></span><span class="hljs-function"><span class="hljs-params"> [Float])</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> len = vDSP_Length(x.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-built_in"><span class="hljs-built_in">count</span></span> = <span class="hljs-type"><span class="hljs-type">Int32</span></span>(x.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) vvexpf(&amp;x, x, &amp;<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sum: <span class="hljs-type"><span class="hljs-type">Float</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> vDSP_sve(x, <span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;sum, len) vDSP_vsdiv(x, <span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;sum, &amp;x, <span class="hljs-number"><span class="hljs-number">1</span></span>, len) }</code> </pre><br>  Para obter as coordenadas e os tamanhos da caixa delimitadora-a, voc√™ precisa usar as f√≥rmulas: <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>x</mi><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>a</mi><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>x</mi><mo stretchy=&quot;false&quot;>)</mo><mo>+</mo><msub><mi>c</mi><mi>x</mi></msub><mspace linebreak=&quot;newline&quot; /><mi>y</mi><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>a</mi><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>y</mi><mo stretchy=&quot;false&quot;>)</mo><mo>+</mo><msub><mi>c</mi><mi>y</mi></msub><mspace linebreak=&quot;newline&quot; /><mi>w</mi><mo>=</mo><msub><mi>p</mi><mi>w</mi></msub><msup><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>w</mi></mrow></msup><mspace linebreak=&quot;newline&quot; /><mi>h</mi><mo>=</mo><msub><mi>p</mi><mi>h</mi></msub><msup><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>h</mi></mrow></msup></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="76.867ex" height="13.262ex" viewBox="0 -832 33095.6 5710.1" role="img" focusable="false" style="vertical-align: -11.33ex; max-width: 638px;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(11502,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-3D" x="850" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-73" x="2156" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-69" x="2626" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-67" x="2971" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-6D" x="3452" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-61" x="4330" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-28" x="4860" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-68" x="5499" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-61" x="6076" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-74" x="6605" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-78" x="6967" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-29" x="7539" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-2B" x="8151" y="0"></use><g transform="translate(9152,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-78" x="613" y="-213"></use></g></g><g transform="translate(11604,-1433)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-79" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-3D" x="775" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-73" x="2081" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-69" x="2551" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-67" x="2896" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-6D" x="3377" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-61" x="4255" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-28" x="4785" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-68" x="5424" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-61" x="6001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-74" x="6530" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-79" x="6892" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-29" x="7389" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-2B" x="8001" y="0"></use><g transform="translate(9002,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-79" x="613" y="-213"></use></g></g><g transform="translate(13787,-3064)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-77" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-3D" x="994" y="0"></use><g transform="translate(2050,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-77" x="712" y="-213"></use></g><g transform="translate(3160,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-65" x="0" y="0"></use><g transform="translate(466,412)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-68" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-61" x="930" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-77" x="1821" y="0"></use></g></g></g><g transform="translate(13956,-4593)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-68" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-3D" x="854" y="0"></use><g transform="translate(1910,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-68" x="712" y="-213"></use></g><g transform="translate(2921,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-65" x="0" y="0"></use><g transform="translate(466,412)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-68" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-61" x="930" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-68" x="1821" y="0"></use></g></g></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>x</mi><mo>=</mo><mtext>&nbsp;</mtext><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>a</mi><mo stretchy="false">(</mo><mtext>&nbsp;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><msub><mi>c</mi><mi>x</mi></msub><mspace linebreak="newline"></mspace><mi>y</mi><mo>=</mo><mtext>&nbsp;</mtext><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>a</mi><mo stretchy="false">(</mo><mtext>&nbsp;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>y</mi><mo stretchy="false">)</mo><mo>+</mo><msub><mi>c</mi><mi>y</mi></msub><mspace linebreak="newline"></mspace><mi>w</mi><mo>=</mo><msub><mi>p</mi><mi>w</mi></msub><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>w</mi></mrow></msup><mspace linebreak="newline"></mspace><mi>h</mi><mo>=</mo><msub><mi>p</mi><mi>h</mi></msub><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>h</mi></mrow></msup></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-5"> x = \ sigma (\ hat x) + c_x \\ y = \ sigma (\ hat y) + c_y \\ w = p_we ^ {\ hat w} \\ h = p_he ^ {\ hat h} </script></p><br>  onde <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>h</mi><mi>a</mi><mi>p</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xE9;</mo></mrow><mi>u</mi><mi>x</mi><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>h</mi><mi>a</mi><mi>p</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xE9;</mo></mrow><mi>u</mi><mi>y</mi><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>h</mi><mi>a</mi><mi>p</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xE9;</mo></mrow><mi>u</mi><mi>w</mi><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>h</mi><mi>a</mi><mi>p</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xE9;</mo></mrow><mi>u</mi><mi>h</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="38.638ex" height="2.419ex" viewBox="0 -780.1 16635.7 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-63" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-68" x="683" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-61" x="1260" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-70" x="1789" y="0"></use><g transform="translate(2293,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">√©</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-75" x="2661" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-78" x="3234" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-2C" x="3806" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-63" x="4501" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-68" x="4935" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-61" x="5511" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-70" x="6041" y="0"></use><g transform="translate(6544,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">√©</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-75" x="6913" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-79" x="7486" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-2C" x="7983" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-63" x="8678" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-68" x="9112" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-61" x="9688" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-70" x="10218" y="0"></use><g transform="translate(10721,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">√©</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-75" x="11090" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-77" x="11663" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-2C" x="12379" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-63" x="13074" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-68" x="13508" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-61" x="14084" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-70" x="14614" y="0"></use><g transform="translate(15117,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">√©</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-75" x="15486" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-68" x="16059" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>c</mi><mi>h</mi><mi>a</mi><mi>p</mi><mrow class="MJX-TeXAtom-ORD"><mo>√©</mo></mrow><mi>u</mi><mi>x</mi><mo>,</mo><mtext>&nbsp;</mtext><mi>c</mi><mi>h</mi><mi>a</mi><mi>p</mi><mrow class="MJX-TeXAtom-ORD"><mo>√©</mo></mrow><mi>u</mi><mi>y</mi><mo>,</mo><mtext>&nbsp;</mtext><mi>c</mi><mi>h</mi><mi>a</mi><mi>p</mi><mrow class="MJX-TeXAtom-ORD"><mo>√©</mo></mrow><mi>u</mi><mi>w</mi><mo>,</mo><mtext>&nbsp;</mtext><mi>c</mi><mi>h</mi><mi>a</mi><mi>p</mi><mrow class="MJX-TeXAtom-ORD"><mo>√©</mo></mrow><mi>u</mi><mi>h</mi></math></span></span><script type="math/tex" id="MathJax-Element-6"> \ chap√©u x, \ chap√©u y, \ chap√©u w, \ chap√©u h </script>  - coordenadas x, y previstas, largura e altura, respectivamente, <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>a</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.999ex" height="2.66ex" viewBox="0 -832 4305 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-73" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-69" x="719" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-67" x="1065" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-6D" x="1545" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-61" x="2424" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-28" x="2953" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-78" x="3343" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-29" x="3915" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>a</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-7"> \ sigma (x) </script>  √â a fun√ß√£o sigm√≥ide e <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>p</mi><mi>w</mi></msub><mo>,</mo><msub><mi>p</mi><mi>h</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.05ex" height="1.817ex" viewBox="-38.5 -520.7 2605 782.1" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-77" x="712" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-2C" x="1110" y="0"></use><g transform="translate(1555,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-68" x="712" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>w</mi></msub><mo>,</mo><msub><mi>p</mi><mi>h</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-8"> p_w, p_h </script>  - valores de √¢ncoras (√¢ncoras) para tr√™s caixas.  Esses valores s√£o determinados durante o treinamento e s√£o definidos no arquivo Helpers.swift: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> anchors1: [<span class="hljs-type"><span class="hljs-type">Float</span></span>] = [<span class="hljs-number"><span class="hljs-number">116</span></span>,<span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-number"><span class="hljs-number">156</span></span>,<span class="hljs-number"><span class="hljs-number">198</span></span>, <span class="hljs-number"><span class="hljs-number">373</span></span>,<span class="hljs-number"><span class="hljs-number">326</span></span>] <span class="hljs-comment"><span class="hljs-comment">//     let anchors2: [Float] = [30,61, 62,45, 59,119] //     let anchors3: [Float] = [10,13, 16,30, 33,23] //    </span></span></code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ng/zf/pv/ngzfpvvch8bhnkdapz6url5ok-w.png"></div><br>  <i>Representa√ß√£o esquem√°tica do c√°lculo da posi√ß√£o de uma caixa delimitadora.</i> <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo completo para processamento de camadas de sa√≠da.</b> <div class="spoiler_text"><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(output out: MLMultiArray, name: String)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> -&gt; [<span class="hljs-type"><span class="hljs-type">Prediction</span></span>] { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> predictions = [<span class="hljs-type"><span class="hljs-type">Prediction</span></span>]() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> grid = out.shape[out.shape.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>].intValue <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> gridSize = <span class="hljs-type"><span class="hljs-type">YOLO</span></span>.inputSize / <span class="hljs-type"><span class="hljs-type">Float</span></span>(grid) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> classesCount = labels.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(out.shape) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pointer = <span class="hljs-type"><span class="hljs-type">UnsafeMutablePointer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Double</span></span>&gt;(<span class="hljs-type"><span class="hljs-type">OpaquePointer</span></span>(out.dataPointer)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> out.strides.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> &lt; <span class="hljs-number"><span class="hljs-number">3</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-type"><span class="hljs-type">YOLOError</span></span>.strideOutOfBounds } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> channelStride = out.strides[out.strides.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>-<span class="hljs-number"><span class="hljs-number">3</span></span>].intValue <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> yStride = out.strides[out.strides.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>-<span class="hljs-number"><span class="hljs-number">2</span></span>].intValue <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> xStride = out.strides[out.strides.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>].intValue <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ch: Int, x: Int, y: Int)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Int</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ch * channelStride + y * yStride + x * xStride } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ..&lt; grid { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ..&lt; grid { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> box_i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ..&lt; <span class="hljs-type"><span class="hljs-type">YOLO</span></span>.boxesPerCell { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> boxOffset = box_i * (classesCount + <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bbx = <span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset, x: x, y: y)]) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bby = <span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset + <span class="hljs-number"><span class="hljs-number">1</span></span>, x: x, y: y)]) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bbw = <span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset + <span class="hljs-number"><span class="hljs-number">2</span></span>, x: x, y: y)]) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bbh = <span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset + <span class="hljs-number"><span class="hljs-number">3</span></span>, x: x, y: y)]) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> confidence = sigmoid(<span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset + <span class="hljs-number"><span class="hljs-number">4</span></span>, x: x, y: y)])) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> confidence &lt; confidenceThreshold { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> x_pos = (sigmoid(bbx) + <span class="hljs-type"><span class="hljs-type">Float</span></span>(x)) * gridSize <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> y_pos = (sigmoid(bby) + <span class="hljs-type"><span class="hljs-type">Float</span></span>(y)) * gridSize <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> width = exp(bbw) * <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.anchors[name]![<span class="hljs-number"><span class="hljs-number">2</span></span> * box_i] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> height = exp(bbh) * <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.anchors[name]![<span class="hljs-number"><span class="hljs-number">2</span></span> * box_i + <span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ..&lt; <span class="hljs-number"><span class="hljs-number">80</span></span> { classes[<span class="hljs-built_in"><span class="hljs-built_in">c</span></span>] = <span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset + <span class="hljs-number"><span class="hljs-number">5</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>, x: x, y: y)]) } softmax(&amp;classes) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> (detectedClass, bestClassScore) = argmax(classes) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> confidenceInClass = bestClassScore * confidence <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> confidenceInClass &lt; confidenceThreshold { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> } predictions.append(<span class="hljs-type"><span class="hljs-type">Prediction</span></span>(classIndex: detectedClass, score: confidenceInClass, rect: <span class="hljs-type"><span class="hljs-type">CGRect</span></span>(x: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span>(x_pos - width / <span class="hljs-number"><span class="hljs-number">2</span></span>), y: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span>(y_pos - height / <span class="hljs-number"><span class="hljs-number">2</span></span>), width: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span>(width), height: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span>(height)))) } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> predictions }</code> </pre><br></div></div><br>  <b>Supress√£o n√£o m√°xima</b> <br><br>  Depois de receber as coordenadas e os tamanhos das caixas delimitadoras e as probabilidades correspondentes para todos os objetos encontrados na imagem, voc√™ poder√° come√ßar a desenh√°-los na parte superior da imagem.  Mas h√° um problema!  Tal situa√ß√£o pode surgir quando v√°rias caixas com probabilidades bastante altas s√£o previstas para um objeto.  O que fazer neste caso?  Aqui, um algoritmo bastante simples chamado N√£o supress√£o m√°xima vem em nosso aux√≠lio. <br><br>  O algoritmo √© o seguinte: <br><br><ol><li>  Estamos procurando uma caixa delimitadora com a maior probabilidade de pertencer ao objeto. </li><li>  Corremos por todas as caixas delimitadoras que tamb√©m pertencem a esse objeto. </li><li>  N√≥s os excluiremos se Intersec√ß√£o sobre uni√£o (IoU) com a primeira caixa delimitadora for maior que o limite especificado. </li></ol><br>  A IoU √© calculada usando uma f√≥rmula simples: <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>I</mi><mi>o</mi><mi>U</mi></mrow><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xC1;</mo></mrow><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>e</mi><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xE7;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xE3;</mo></mrow><mi>o</mi></mrow></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>A</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>e</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>o</mi><mi>c</mi><mi>i</mi><mi>a</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xE7;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xE3;</mo></mrow><mi>o</mi></mrow></mrow></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="61.792ex" height="2.539ex" viewBox="0 -832 26605 1093.4" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-74" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-65" x="611" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-78" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-74" x="1650" y="0"></use><g transform="translate(2012,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-49" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-6F" x="504" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-55" x="990" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMAIN-3D" x="4047" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-66" x="5353" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-72" x="5904" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-61" x="6355" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-63" x="6885" y="0"></use><g transform="translate(7318,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-74" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-65" x="611" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-78" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-74" x="1650" y="0"></use><g transform="translate(2012,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">√Å</text><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-72" x="674" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-65" x="1125" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-61" x="1592" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-64" x="2121" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-65" x="2645" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-69" x="3111" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-6E" x="3457" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-74" x="4057" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-65" x="4419" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-72" x="4885" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-73" x="5337" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-65" x="5806" y="0"></use><g transform="translate(6273,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">√ß</text></g><g transform="translate(6642,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">√£</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-6F" x="7057" y="0"></use></g></g><g transform="translate(16873,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-74" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-65" x="611" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-78" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-74" x="1650" y="0"></use><g transform="translate(2012,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-41" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-72" x="750" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-65" x="1202" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-61" x="1668" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-64" x="2198" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-65" x="2721" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-61" x="3188" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-73" x="3717" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-73" x="4187" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-6F" x="4656" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-63" x="5142" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-69" x="5575" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-61" x="5921" y="0"></use><g transform="translate(6450,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">√ß</text></g><g transform="translate(6819,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">√£</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuMPkYD3LsI1y7c7v5A_CDCosWag#MJMATHI-6F" x="7234" y="0"></use></g></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>&nbsp;</mtext><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>I</mi><mi>o</mi><mi>U</mi></mrow><mo>=</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mo>√Å</mo></mrow><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>e</mi><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mo>√ß</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>√£</mo></mrow><mi>o</mi></mrow></mrow><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>A</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>e</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>o</mi><mi>c</mi><mi>i</mi><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mo>√ß</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>√£</mo></mrow><mi>o</mi></mrow></mrow></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-9"> \ text {IoU} = \ frac {\ text {√Årea de interse√ß√£o}} {\ text {Area de associa√ß√£o}} </script></p><div class="spoiler">  <b class="spoiler_title">C√°lculo de IoU.</b> <div class="spoiler_text"><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IOU</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a: CGRect, b: CGRect)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Float</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> areaA = a.width * a.height <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> areaA &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> areaB = b.width * b.height <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> areaB &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> intersection = a.intersection(b) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> intersectionArea = intersection.width * intersection.height <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Float</span></span>(intersectionArea / (areaA + areaB - intersectionArea)) }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Supress√£o n√£o m√°xima.</b> <div class="spoiler_text"><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nonMaxSuppression</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(boxes: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">inout</span></span></span></span><span class="hljs-function"><span class="hljs-params"> [Prediction], threshold: Float)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> i &lt; boxes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j = i + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> j &lt; boxes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> iou = <span class="hljs-type"><span class="hljs-type">YOLO</span></span>.<span class="hljs-type"><span class="hljs-type">IOU</span></span>(a: boxes[i].rect, b: boxes[j].rect) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> iou &gt; threshold { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> boxes[i].score &gt; boxes[j].score { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> boxes[i].classIndex == boxes[j].classIndex { boxes.remove(at: j) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { j += <span class="hljs-number"><span class="hljs-number">1</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> boxes[i].classIndex == boxes[j].classIndex { boxes.remove(at: i) j = i + <span class="hljs-number"><span class="hljs-number">1</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { j += <span class="hljs-number"><span class="hljs-number">1</span></span> } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { j += <span class="hljs-number"><span class="hljs-number">1</span></span> } } i += <span class="hljs-number"><span class="hljs-number">1</span></span> } }</code> </pre><br></div></div><br>  Depois disso, o trabalho diretamente com os resultados da previs√£o de redes neurais pode ser considerado completo.  Em seguida, voc√™ precisa escrever fun√ß√µes e classes para obter as imagens da c√¢mera, exibir a imagem na tela e renderizar as caixas delimitadoras previstas.  N√£o descreverei todo esse c√≥digo neste artigo, mas ele pode ser visualizado no reposit√≥rio. <br><br>  Tamb√©m vale mencionar que adicionei um pouco de suaviza√ß√£o das caixas delimitadoras ao processar imagens on-line; nesse caso, √© a m√©dia usual da posi√ß√£o e tamanho do quadrado previsto nos √∫ltimos 30 quadros. <br><br><h4>  Testando o programa </h4><br>  Agora testamos o aplicativo. <br><br>  Deixe-me lembr√°-lo mais uma vez: Existem tr√™s ViewControllers no aplicativo, um para processar fotos ou instant√¢neos, um para processar um fluxo de v√≠deo online e um terceiro para configurar a rede. <br><br>  Vamos come√ßar com o terceiro.  Nele, voc√™ pode escolher um dos dois modelos YOLOv3-tiny ou YOLOv3-416, escolher o limite de confian√ßa e o IoU, tamb√©m pode ativar ou desativar o anti-aliasing online. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sb/zq/tz/sbzqtzy6hai51objkormfzvtbuq.jpeg"></div><br>  Agora vamos ver como o neur√¥nio treinado trabalha com imagens reais; para isso, tiramos uma foto da galeria e passamos pela rede.  A imagem abaixo mostra os resultados do YOLOv3-tiny com configura√ß√µes diferentes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nr/j3/fj/nrj3fjpw0yvxgl2cigujbcb-1p4.png"></div><br>  <i>Diferentes modos de opera√ß√£o do YOLOv3-tiny.</i>  <i>A imagem da esquerda mostra o modo usual de opera√ß√£o.</i>  <i>No meio - o limite IoU = 1, ou seja,</i>  <i>como se a supress√£o n√£o m√°xima estivesse ausente.</i>  <i>√Ä direita, h√° um baixo limiar de confian√ßa do objeto, ou seja,</i>  <i>todas as caixas delimitadoras poss√≠veis s√£o exibidas.</i> <br><br>  A seguir, o resultado de YOLOv3-416.  Voc√™ pode notar que, em compara√ß√£o com YOLOv3-tiny, os quadros resultantes s√£o mais corretos, assim como objetos menores na imagem s√£o reconhecidos, o que corresponde ao trabalho da terceira camada de sa√≠da. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wc/nj/xq/wcnjxqeygnuriffqpatmtvevyfo.png"></div><br>  <i>Imagem processada usando YOLOv3-416.</i> <br><br>  Quando o modo de opera√ß√£o on-line foi ativado, cada quadro foi processado e foi feita uma previs√£o, <b>testes foram realizados no iPhone XS,</b> portanto <b>,</b> o resultado foi bastante aceit√°vel para as duas op√ß√µes de rede.  <b>YOLOv3-tiny produz uma m√©dia de 30 - 32 qps, YOLOv3-416 - de 23 a 25 qps.</b>  O dispositivo em que foi testado √© bastante produtivo; portanto, em modelos anteriores, os resultados podem diferir; nesse caso, √© claro, √© prefer√≠vel usar o YOLOv3-tiny.  Outro ponto importante: o yolo-tiny.mlmodel (YOLOv3-tiny) ocupa cerca de 35 MB, enquanto o yolo.mlmodel (YOLOv3 -16) pesa cerca de 250 MB, o que √© uma diferen√ßa muito significativa. <br><br><h2>  Conclus√£o </h2><br>  Como resultado, um aplicativo iOS foi escrito que, com a ajuda de uma rede neural, √© poss√≠vel reconhecer objetos na imagem.  Vimos como trabalhar com a biblioteca CoreML e como us√°-la para executar v√°rios modelos pr√©-treinados (a prop√≥sito, voc√™ tamb√©m pode treinar com ela).  O problema de reconhecimento de objetos foi resolvido usando a rede YOLOv3.  No iPhone XS, essa rede (YOLOv3-tiny) √© capaz de processar imagens com uma frequ√™ncia de ~ 30 quadros por segundo, o que √© suficiente para a opera√ß√£o em tempo real. <br><br>  O c√≥digo completo do aplicativo pode ser visualizado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt460869/">https://habr.com/ru/post/pt460869/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt460859/index.html">Confer√™ncia IThink # 3 em Kharkov - com base na WWDC 2019</a></li>
<li><a href="../pt460861/index.html">Escopo e fechamento lexical do JavaScript</a></li>
<li><a href="../pt460863/index.html">Cloudflare crash details 2 de julho de 2019</a></li>
<li><a href="../pt460865/index.html">Pessoas na lua. Fontes</a></li>
<li><a href="../pt460867/index.html">Sourcery para converter automaticamente em estruturas de objetos do Dom√≠nio</a></li>
<li><a href="../pt460873/index.html">Por que Turok: Dinosaur Hunter para N64 est√° anos √† frente de seu tempo</a></li>
<li><a href="../pt460875/index.html">Como n√≥s da QIWI chegamos a um estilo comum de intera√ß√£o entre o View e o ViewModel no MVVM</a></li>
<li><a href="../pt460877/index.html">Dailymotion da Kubernetes-adventure: construindo infraestrutura nas nuvens + no local</a></li>
<li><a href="../pt460879/index.html">DUMP Kazan 2019 - Tatarstan Developers Conference. Aceitamos pedidos de relat√≥rios</a></li>
<li><a href="../pt460881/index.html">Dificuldades na aplica√ß√£o de tecnologias de OCR em sistemas DLP ou Como preparamos o OCR</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>