<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚴🏼 👆🏿 💌 AnyStub, perpustakaan rintisan koneksi Java ☮️ 🅰️ 👂🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tidak seperti banyak platform, Java menderita kekurangan perpustakaan koneksi rintisan. Jika Anda telah berada di dunia ini untuk waktu yang lama, mak...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>AnyStub, perpustakaan rintisan koneksi Java</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450958/"><p> Tidak seperti banyak platform, Java menderita kekurangan perpustakaan koneksi rintisan.  Jika Anda telah berada di dunia ini untuk waktu yang lama, maka Anda mungkin harus terbiasa dengan WireMock, Betamax atau bahkan Spock.  Banyak pengembang dalam tes menggunakan Mockito untuk menggambarkan perilaku objek, DataJpaTest dengan database h2 lokal, tes Mentimun.  Hari ini Anda akan menemukan alternatif ringan yang akan membantu Anda mengatasi berbagai masalah yang mungkin Anda temui menggunakan pendekatan ini.  Secara khusus, anyStub mencoba memecahkan masalah berikut: </p><br><ul><li>  menyederhanakan konfigurasi lingkungan pengujian </li><li>  mengotomatiskan pengumpulan data untuk pengujian </li><li>  tetap menguji aplikasi Anda dan menghindari pengujian untuk hal lain </li></ul><a name="habracut"></a><br><h2 id="chto-takoe-anystub-i-kak-eto-rabotaet">  Apa itu anyStub dan bagaimana cara kerjanya </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">AnyStub</a> membungkus panggilan fungsi, mencoba menemukan panggilan yang cocok yang telah direkam.  Dua hal dapat terjadi dengan ini: </p><br><ul><li>  jika ada panggilan yang cocok, anyStub akan mengembalikan hasil yang direkam terkait dengan panggilan itu dan mengembalikannya </li><li>  jika tidak ada panggilan yang cocok dan akses ke sistem eksternal diizinkan, anyStub akan melakukan panggilan ini, merekam hasil ini dan mengembalikannya </li></ul><br><p>  Di luar kotak, anyStub menyediakan pembungkus untuk klien http dari Apache HttpClient untuk membuat stubs untuk permintaan http dan beberapa antarmuka dari javax.sql. * Untuk koneksi DB.  Anda juga diberikan API untuk membuat stub untuk koneksi lain. </p><br><p>  AnyStub adalah pustaka kelas sederhana dan tidak memerlukan konfigurasi khusus dari lingkungan Anda.  Pustaka ini ditujukan untuk bekerja dengan aplikasi spring-boot dan Anda akan mendapatkan manfaat maksimal dengan mengikuti jalur ini.  Anda dapat menggunakannya di luar Spring, di aplikasi Java biasa, tetapi Anda harus melakukan pekerjaan tambahan.  Deskripsi berikut difokuskan pada pengujian aplikasi boot-musim semi. </p><br><p>  Mari kita lihat pengujian integrasi.  Ini adalah cara paling menarik dan komprehensif untuk menguji sistem Anda.  Bahkan, spring-boot dan JUnit melakukan hampir segalanya untuk Anda ketika Anda menulis anotasi magis: </p><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(SpringRunner.class) <span class="hljs-meta"><span class="hljs-meta">@SpringBootTest</span></span></code> </pre> <br><p>  Saat ini, tes integrasi diremehkan dan digunakan sampai batas tertentu, dan beberapa pengembang menghindarinya.  Ini terutama disebabkan oleh persiapan dan pemeliharaan pengujian yang memakan waktu atau kebutuhan untuk konfigurasi khusus lingkungan pada server yang dibangun. </p><br><p>  Dengan anyStub, Anda tidak perlu melumpuhkan spring-contex.  Sebaliknya, menjaga konteks dekat dengan konfigurasi produksi sederhana dan mudah. </p><br><p>  Dalam contoh ini, kita akan melihat bagaimana menghubungkan anyStub ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Layanan Web</a> RESTful dari manual dari Pivotal. </p><br><p>  Menghubungkan perpustakaan melalui pom.xml </p><br><pre> <code class="java hljs"> &lt;dependency&gt; &lt;groupId&gt;org.anystub&lt;/groupId&gt; &lt;artifactId&gt;anystub&lt;/artifactId&gt; &lt;version&gt;<span class="hljs-number"><span class="hljs-number">0.2</span></span>.27&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt;</code> </pre> <br><p>  Langkah selanjutnya adalah mengubah konteks pegas. </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> hello; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.anystub.http.StubHttpClient; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.http.client.HttpClient; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.http.impl.client.HttpClientBuilder; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.boot.web.client.RestTemplateBuilder; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.boot.web.client.RestTemplateCustomizer; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.context.annotation.Bean; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.context.annotation.Configuration; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.http.client.HttpComponentsClientHttpRequestFactory; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.web.client.RestTemplate; <span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RestTemplateBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">builder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ RestTemplateCustomizer restTemplateCustomizer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RestTemplateCustomizer() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">customize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RestTemplate restTemplate)</span></span></span><span class="hljs-function"> </span></span>{ HttpClient real = HttpClientBuilder.create().build(); StubHttpClient stubHttpClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StubHttpClient(real); HttpComponentsClientHttpRequestFactory requestFactory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpComponentsClientHttpRequestFactory(); requestFactory.setHttpClient(stubHttpClient); restTemplate.setRequestFactory(requestFactory); } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RestTemplateBuilder(restTemplateCustomizer); } }</code> </pre> <br><p>  Modifikasi ini tidak mengubah hubungan komponen dalam aplikasi, tetapi hanya menggantikan implementasi antarmuka tunggal.  Ini mengirim kami ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Prinsip Substitusi Barbara Lisk</a> .  Jika desain aplikasi Anda tidak melanggarnya, maka pergantian ini tidak akan melanggar fungsionalitas. </p><br><p>  Semuanya sudah siap.  Proyek ini sudah termasuk tes. </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(SpringRunner.class) <span class="hljs-meta"><span class="hljs-meta">@SpringBootTest</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> RestTemplate restTemplate; <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">contextLoads</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ assertThat(restTemplate).isNotNull(); } }</code> </pre> <br><p>  Tes ini kosong, tetapi sudah menjalankan konteks aplikasi.  <strong>Kesenangan dimulai di sini</strong> .  Seperti yang kami katakan di atas, konteks aplikasi dalam tes bertepatan dengan konteks kerja di mana CommandLineRunner dibuat di mana permintaan http ke sistem eksternal dieksekusi. </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger log = LoggerFactory.getLogger(Application.class); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String args[])</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(Application.class); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RestTemplate </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">restTemplate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RestTemplateBuilder builder)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> builder.build(); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CommandLineRunner </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RestTemplate restTemplate)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> args -&gt; { Quote quote = restTemplate.getForObject( <span class="hljs-string"><span class="hljs-string">"https://gturnquist-quoters.cfapps.io/api/random"</span></span>, Quote.class); log.info(quote.toString()); }; } }</code> </pre> <br><p>  Ini cukup untuk menunjukkan operasi perpustakaan.  Setelah memulai tes untuk pertama kalinya, Anda akan menemukan file <code>complete/src/test/resources/anystub/stub.yml</code> yang baru <code>complete/src/test/resources/anystub/stub.yml</code> . </p><br><pre> <code class="plaintext hljs">request0: exception: [] keys: [GET, HTTP/1.1, 'https://gturnquist-quoters.cfapps.io/api/random'] values: [HTTP/1.1, '200', OK, 'Content-Type: application/json;charset=UTF-8', 'Date: Thu, 25 Apr 2019 23:04:49 GMT', 'X-Vcap-Request-Id: 5ffce9f3-d972-4e95-6b5c-f88f9b0ae29b', 'Content-Length: 177', 'Connection: keep-alive', '{"type":"success","value":{"id":3,"quote":"Spring has come quite a ways in addressing developer enjoyment and ease of use since the last time I built an application using it."}}']</code> </pre> <br><p>  Apa yang terjadi  spring-boot telah membangun RestTemplateBuilder dari konfigurasi pengujian ke dalam aplikasi.  Ini menyebabkan aplikasi bekerja melalui implementasi rintisan klien http.  StubHttpClient mencegat permintaan, tidak menemukan file rintisan, mengeksekusi permintaan, menyimpan hasil dalam file, dan mengembalikan hasil yang dipulihkan dari file. </p><br><p>  Mulai sekarang, Anda dapat menjalankan tes ini tanpa koneksi internet dan permintaan ini akan berhasil.  <code>restTemplate.getForObject()</code> akan mengembalikan hasil yang sama.  Anda dapat mengandalkan fakta ini di tes mendatang. </p><br><p>  Anda dapat menemukan semua perubahan yang dijelaskan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GitHub</a> . </p><br><p>  Faktanya, kami masih belum membuat satu tes.  Sebelum menulis tes, mari kita lihat cara kerjanya dengan database. </p><br><p>  Dalam contoh ini, kami akan menambahkan tes integrasi ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mengakses Data Relasional menggunakan JDBC dengan Spring</a> dari tutorial Pivotal. </p><br><p>  Konfigurasi tes untuk kasus ini terlihat seperti ini: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> hello; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.anystub.jdbc.StubDataSource; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.h2.jdbcx.JdbcDataSource; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.context.annotation.Bean; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.context.annotation.Configuration; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.sql.DataSource; <span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> DataSource </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dataSource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ JdbcDataSource ds = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JdbcDataSource(); ds.setURL(<span class="hljs-string"><span class="hljs-string">"jdbc:h2:./test"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StubDataSource(ds); } }</code> </pre> <br><p>  Di sini, sumber data reguler ke database eksternal dibuat dan dibungkus dengan implementasi rintisan - kelas StubDataSource.  Spring-boot menyematkannya dalam konteks.  Kita juga perlu membuat setidaknya satu tes untuk menjalankan konteks pegas dalam tes. </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> hello; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.anystub.AnyStubId; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.junit.Test; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.junit.runner.RunWith; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.boot.test.context.SpringBootTest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.test.context.junit4.SpringRunner; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> org.junit.Assert.*; <span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(SpringRunner.class) <span class="hljs-meta"><span class="hljs-meta">@SpringBootTest</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-meta"><span class="hljs-meta">@AnyStubId</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre> <br><p>  Sekali lagi ini adalah tes kosong - satu-satunya tugas adalah menjalankan konteks aplikasi.  Di sini kita melihat anotasi <code>@AnystubId</code> sangat penting, tetapi belum terlibat. </p><br><p>  Setelah dijalankan pertama kali, Anda akan menemukan file <code>src/test/resources/anystub/stub.yml</code> yang mencakup semua panggilan basis data.  Anda akan terkejut bagaimana pegas bekerja di belakang layar dengan database.  Perhatikan bahwa, uji coba yang baru tidak akan menghasilkan akses nyata ke database.  Jika Anda menghapus test.mv.db, itu tidak akan muncul setelah pengujian berulang kali.  Set lengkap perubahan dapat dilihat di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GitHub</a> . </p><br><p>  Untuk meringkas.  dengan anyStub: </p><br><ul><li>  Anda tidak perlu secara khusus mengatur lingkungan pengujian </li><li>  pengujian dilakukan dengan data nyata </li><li>  uji coba pertama membuktikan asumsi Anda dan menyimpan data uji, yang berikutnya memeriksa bahwa sistem belum terdegradasi </li></ul><br><p>  Anda mungkin memiliki pertanyaan: bagaimana hal ini mencakup kasus di mana basis data belum ada, apa yang harus dilakukan dengan pengujian negatif dan penanganan pengecualian.  Kami akan kembali ke ini, tetapi pertama-tama, kami akan berurusan dengan menulis tes sederhana. </p><br><p>  Kami sekarang bereksperimen dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mengkonsumsi Layanan Web RESTful</a> .  Proyek ini tidak mengandung komponen yang dapat diuji.  Dua kelas dibuat di bawah ini, yang harus menggambarkan dua lapisan dari beberapa desain arsitektur. </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> hello; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.stereotype.Component; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.web.client.RestTemplate; <span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataProvider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RestTemplate restTemplate; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DataProvider</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RestTemplate restTemplate)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.restTemplate = restTemplate; } <span class="hljs-function"><span class="hljs-function">Quote </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">provideData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> restTemplate.getForObject( <span class="hljs-string"><span class="hljs-string">"https://gturnquist-quoters.cfapps.io/api/random"</span></span>, Quote.class); } }</code> </pre> <br><p>  DataProvider menyediakan akses ke data di <del>  volatile </del>  sistem eksternal. </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> hello; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.stereotype.Component; <span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataProcessor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> DataProvider dataProvider; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DataProcessor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DataProvider dataProvider)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dataProvider = dataProvider; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dataProvider.provideData().getValue().getQuote().length(); } }</code> </pre> <br><p>  DataProcessor akan memproses data dari sistem eksternal. </p><br><p>  Kami bermaksud menguji <code>DataProcessor</code> .  Penting untuk menguji kebenaran algoritma pemrosesan dan melindungi sistem dari degradasi dari perubahan di masa depan. </p><br><p>  Untuk mencapai tujuan ini, Anda dapat mempertimbangkan membuat objek tiruan DataProvider dengan kumpulan data dan meneruskannya ke konstruktor DataProcessor dalam pengujian.  Cara lain bisa dengan menguraikan DataProcessor untuk menyoroti pemrosesan kelas Penawaran.  Kemudian, kelas semacam itu mudah untuk diuji menggunakan unit test (Tentunya, ini adalah metode yang direkomendasikan dalam buku-buku yang dihormati tentang kode bersih).  Mari kita coba untuk menghindari perubahan kode dan penemuan data uji dan hanya menulis tes. </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(SpringRunner.class) <span class="hljs-meta"><span class="hljs-meta">@SpringBootTest</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataProcessorTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> DataProcessor dataProcessor; <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-meta"><span class="hljs-meta">@AnyStubId</span></span>(filename = <span class="hljs-string"><span class="hljs-string">"stub"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDataTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ assertEquals(<span class="hljs-number"><span class="hljs-number">131</span></span>, dataProcessor.processData()); } }</code> </pre> <br><p>  Saatnya berbicara tentang anotasi @AnystubId.  Anotasi ini membantu mengelola dan mengontrol file rintisan dalam pengujian.  Itu dapat digunakan dengan kelas uji atau metodenya.  Anotasi ini mengatur file rintisan individu untuk area yang sesuai.  Jika ada area yang secara bersamaan dicakup oleh anotasi level kelas dan metode, anotasi metode lebih diutamakan.  Anotasi ini memiliki parameter nama file, yang menentukan nama file rintisan.  ekstensi ".yml" ditambahkan secara otomatis jika dihilangkan.  Dengan menjalankan tes ini Anda <strong>tidak</strong> akan menemukan file baru.  File <code>src/test/resources/anystub/stub.yml</code> telah dibuat sebelumnya dan tes ini akan menggunakannya kembali.  Kami mendapat nomor 131 dari rintisan ini dengan menganalisis hasil kueri. </p><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-meta"><span class="hljs-meta">@AnyStubId</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDataTest2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ assertEquals(<span class="hljs-number"><span class="hljs-number">131</span></span>, dataProcessor.processData()); Base base = getStub(); assertEquals(<span class="hljs-number"><span class="hljs-number">1</span></span>, base.times(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>)); assertTrue(base.history().findFirst().get().matchEx_to(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">".*gturnquist-quoters.cfapps.io.*"</span></span>)); }</code> </pre> <br><p>  Dalam pengujian ini, anotasi @AnyStubId muncul tanpa parameter nama file.  Dalam kasus ini, file <code>src/test/resources/anystubprocessDataTest2.yml</code> .  Nama file dibangun dari nama fungsi (kelas) + ".yml".  Setelah anyStub membuat file baru untuk pengujian ini, Anda perlu membuat panggilan sistem yang sebenarnya.  Dan itu adalah keberuntungan kami bahwa kutipan baru memiliki panjang yang sama.  Dua pemeriksaan terakhir menunjukkan cara menguji perilaku aplikasi.  Ini tersedia untuk Anda: memilih kueri berdasarkan parameter atau bagian parameter dan menghitung jumlah kueri.  Ada beberapa variasi waktu <em>dan</em> fungsi <em>pencocokan</em> yang dapat ditemukan dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi</a> . </p><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-meta"><span class="hljs-meta">@AnyStubId</span></span>(requestMode = RequestMode.rmTrack) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDataTest3</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ assertEquals(<span class="hljs-number"><span class="hljs-number">79</span></span>, dataProcessor.processData()); assertEquals(<span class="hljs-number"><span class="hljs-number">79</span></span>, dataProcessor.processData()); assertEquals(<span class="hljs-number"><span class="hljs-number">168</span></span>, dataProcessor.processData()); assertEquals(<span class="hljs-number"><span class="hljs-number">79</span></span>, dataProcessor.processData()); Base base = getStub(); assertEquals(<span class="hljs-number"><span class="hljs-number">4</span></span>, base.times(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>)); }</code> </pre> <br><p>  Dalam pengujian ini, @AnyStubId muncul dengan parameter requestMode baru.  Ini memungkinkan Anda untuk mengelola izin untuk file rintisan.  Ada dua aspek untuk dikendalikan: pencarian file dan izin untuk memanggil sistem eksternal. </p><br><p>  <code>RequestMode.rmTrack</code> menetapkan aturan berikut: jika file baru saja dibuat, semua permintaan dikirim ke sistem eksternal dan ditulis ke file dengan jawaban, terlepas dari apakah ada permintaan yang identik dalam file (duplikat dalam file diperbolehkan).  Jika sebelum menjalankan tes, file rintisan ada, permintaan ke sistem eksternal dilarang.  Panggilan diharapkan dalam urutan yang persis sama.  Jika permintaan berikutnya tidak cocok dengan permintaan dalam file, pengecualian dilemparkan. </p><br><p>  <code>RequestMode.rmNew</code> mode ini diaktifkan secara default.  Setiap permintaan dicari dalam file rintisan.  Jika permintaan yang cocok ditemukan - hasil yang sesuai dipulihkan dari file, permintaan ke sistem eksternal ditunda.  Jika permintaan tidak ditemukan, sistem eksternal diminta, hasilnya disimpan dalam file.  Permintaan duplikat dalam file - jangan terjadi. </p><br><p>  <code>RequestMode.rmNone</code> Setiap permintaan dicari dalam file rintisan.  Jika kueri yang cocok ditemukan, hasilnya dikembalikan dari file.  Jika tes menghasilkan permintaan yang tidak ada dalam file, pengecualian dilemparkan. </p><br><p>  <code>RequestMode.rmAll</code> sebelum permintaan pertama, file rintisan dihapus.  Semua permintaan ditulis ke file (duplikat dalam file diizinkan).  Anda dapat menggunakan mode ini jika Anda ingin menonton koneksi berfungsi. </p><br><p>  <code>RequestMode.rmPassThrough</code> semua permintaan dikirim langsung ke sistem eksternal, melewati rintisan implementasi. </p><br><p>  Perubahan ini tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GitHub.</a> </p><br><h1 id="chto-eschyo">  Apa lagi </h1><br><p>  Kami melihat bagaimana anyStub menyimpan respons.  Jika pengecualian dilemparkan ketika mengakses sistem eksternal, anyStub akan menyimpannya, dan akan memutarnya pada permintaan berikutnya. </p><br><p>  Seringkali pengecualian dilemparkan oleh kelas tingkat atas, sementara kelas koneksi menerima respons yang valid (Mungkin dengan kode kesalahan).  Dalam hal ini, anyStub bertanggung jawab untuk mereproduksi jawaban dengan kode kesalahan, dan kelas tingkat yang lebih tinggi juga akan memberikan pengecualian untuk pengujian Anda. </p><br><p>  Tambahkan file rintisan ke repositori. </p><br><p>  Jangan takut untuk menghapus dan menimpa file rintisan. </p><br><p>  Kelola file rintisan dengan bijak.  Anda dapat menggunakan kembali satu file dalam beberapa tes atau memberikan file individual untuk setiap tes.  Gunakan kesempatan ini untuk kebutuhan Anda.  Tetapi biasanya menggunakan satu file dengan mode akses berbeda adalah ide yang buruk. </p><br><p>  Ini semua adalah fitur utama anyStub. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id450958/">https://habr.com/ru/post/id450958/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id450948/index.html">MU-MIMO: salah satu algoritma implementasi</a></li>
<li><a href="../id450950/index.html">Dasar-Dasar Aliran Dart</a></li>
<li><a href="../id450952/index.html">Indeks Sedang dan Antibank</a></li>
<li><a href="../id450954/index.html">Bagaimana kami belajar mengeksploitasi Java di Docker</a></li>
<li><a href="../id450956/index.html">Perbandingan COB industri: ISIM vs Kics</a></li>
<li><a href="../id450962/index.html">Pompa insulin, microchip yang rusak, dan radio yang ditentukan oleh perangkat lunak</a></li>
<li><a href="../id450964/index.html">Pustaka intrinsik x86 SIMD baru - debug immintrin</a></li>
<li><a href="../id450966/index.html">Merekam video dari komputer lama - metode dari LGR</a></li>
<li><a href="../id450970/index.html">Cara benar-benar membandingkan harga Apple di AS dan Rusia. Pengalaman pribadi</a></li>
<li><a href="../id450972/index.html">Bagaimana cara mengatur studio foto? Kasus Studio Bolshakova</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>