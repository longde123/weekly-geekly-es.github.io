<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äç‚úàÔ∏è ‚è© üï§ Notes du fournisseur IoT. Pi√®ges de l'enqu√™te sur les compteurs de services publics üéÖ ‚òÅÔ∏è üì∞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour chers amoureux de l'Internet des objets. Dans cet article, je voudrais √† nouveau parler du logement et des services communaux et d'une enqu√™te...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Notes du fournisseur IoT. Pi√®ges de l'enqu√™te sur les compteurs de services publics</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/449668/">  Bonjour chers amoureux de l'Internet des objets.  Dans cet article, je voudrais √† nouveau parler du logement et des services communaux et d'une enqu√™te sur les appareils de mesure. <br><br>  P√©riodiquement, un autre acteur majeur des t√©l√©communications raconte √† quel moment il va p√©n√©trer ce march√© et √©craser tout le monde.  Chaque fois avec de telles histoires, je pense: "les gars, bonne chance!" <br>  Vous ne savez pas o√π vous grimpez. <br><br>  Afin de vous faire comprendre l'ampleur du probl√®me, je d√©crirai bri√®vement une petite partie de notre exp√©rience dans le d√©veloppement de la plateforme Smart City.  La partie de celui-ci qui est responsable de la planification. <br><br><img src="https://habrastorage.org/webt/xu/49/vl/xu49vludx9l7aqn72w0jfxfhndo.jpeg"><br><br><a name="habracut"></a><h3>  Id√©e g√©n√©rale et premi√®res difficult√©s </h3><br>  Si nous ne parlons pas de compteurs individuels, mais de ceux qui se trouvent dans les sous-sols, les chaufferies et les entreprises, la plupart d'entre eux sont d√©sormais √©quip√©s d'une sortie t√©l√©m√©trique.  Moins souvent puls√©, plus souvent - RS-485/232 ou Ethernet.  En r√®gle g√©n√©rale, les appareils de mesure les plus "√† pain" sont ceux qui tiennent compte de la chaleur.  Ce sont eux qui sont pr√™ts √† payer pour leur exp√©dition en premier lieu. <br>  J'ai d√©j√† insist√© en d√©tail dans mon article sur les caract√©ristiques du RS-485.  En bref, ce n'est qu'une interface de transfert de donn√©es.  Essentiellement - les exigences relatives aux impulsions √©lectriques et aux lignes de communication.  La description des packages va jusqu'√† la norme de transfert de donn√©es, qui s'ex√©cute au-dessus de RS-485.  Et quel type de norme sera l√† - c'est laiss√© au fabricant.  Souvent Modbus, mais pas n√©cessaire.  M√™me si Modbus, il peut encore √™tre l√©g√®rement modifi√©. <br><br>  En fait, pour chaque compteur, vous avez besoin de votre propre script d'enqu√™te, qui sait ¬´parler¬ª avec lui et l'interroger.  Cela signifie que le syst√®me de r√©partition est un ensemble de scripts pour chaque compteur individuel.  Une base de donn√©es o√π tout cela est stock√©.  Et une certaine interface utilisateur dans laquelle il peut g√©n√©rer le rapport dont il a besoin. <br><br><img src="https://habrastorage.org/webt/_o/5_/r8/_o5_r8yi41f7wlnhbwxbu0bajny.png"><br><br>  √áa a l'air facile.  Le diable, comme toujours, est dans les d√©tails. <br><br>  Commen√ßons par la premi√®re partie. <br><br><h3>  Scripts </h3><br>  Comment les √©crire?  Eh bien, √©videmment, achetez un compteur, ramassez-le, apprenez √† communiquer avec lui et √† l'int√©grer dans une plateforme commune. <br><br>  Malheureusement, cette solution ne couvrira qu'une partie de nos besoins.  En r√®gle g√©n√©rale, un compteur populaire a plusieurs g√©n√©rations et le script de chaque g√©n√©ration peut diff√©rer.  Parfois un peu, parfois de mani√®re significative.  En achetant quelque chose, vous obtenez la derni√®re g√©n√©ration.  L'abonn√© est tr√®s probablement quelque chose de plus ancien.  Il n'est plus vendu en magasin.  Et l'abonn√© ne changera pas le n≈ìud de mesure. <br><br>  D'o√π le premier probl√®me.  L'√©criture de tels scripts est un groupe difficile de d√©veloppeurs de logiciels et d'ing√©nieurs "sur le terrain".  Nous avons achet√© la derni√®re g√©n√©ration, √©crit un mod√®le initial, puis l'avons modifi√© sur de vrais appareils.  Faire cela en laboratoire est irr√©aliste, seulement en travaillant avec des abonn√©s en direct. <br><br>  Il nous a fallu beaucoup de temps pour cr√©er un tel ensemble.  Maintenant, l'algorithme est √©labor√©.  Les mod√®les initiaux ont √©t√© constamment ajust√©s et compl√©t√©s, selon ce que nous avons rencontr√© dans notre pratique.  Bien s√ªr, l'abonn√© a √©t√© pr√©venu si tout √† coup son compteur √©tait un peu ¬´pas comme √ßa¬ª.  Lorsqu'un tel p√©riph√©rique appara√Æt, il est connect√© selon le sch√©ma standard et le script d'interrogation est modifi√© en cours de route.  Au moment de l'int√©gration, l'abonn√© travaille gratuitement.  Il est inform√© qu'il vit toujours en mode test.  Le processus d'int√©gration lui-m√™me est une chose plut√¥t impr√©visible.  Il arrive que vous deviez effectuer un minimum de corrections.  Il y a un processus complexe avec une excursion, pelleter de la litt√©rature et surmonter cons√©cutivement un r√¢teau. <br><br>  La t√¢che n'est pas simple, mais r√©soluble.  Le r√©sultat est un script de travail.  Plus la biblioth√®que de scripts est grande, plus il est facile de vivre. <br><br>  Le deuxi√®me probl√®me. <br><br><h3>  Cartes de connexion technologiques </h3><br>  Pour vous faire prendre conscience de la complexit√© de ce travail, je vais vous donner un exemple.  Prenez le compteur de chaleur VKT-7 extr√™mement populaire. <br><br>  Le nom lui-m√™me ne signifie rien pour nous.  VKT-7 propose plusieurs solutions de fer.  De quel type d'interface s'agit-il √† l'int√©rieur? <br><br><img src="https://habrastorage.org/webt/6a/vj/2v/6avj2vxzeg84mfssvgarpqkyb-4.jpeg"><br><br>  Il existe diff√©rentes options.  Il peut y avoir une sortie dans le bloc DB-9 standard (c'est RS-232).  Il pourrait simplement s'agir d'un bornier avec contacts RS-485.  Peut-√™tre m√™me une carte r√©seau avec RJ-45 (dans ce cas, ModBus est emball√© en Ethernet). <br><br>  Ou peut-√™tre rien du tout.  Juste un m√®tre nu.  Vous pouvez y installer une sortie d'interface, elle est vendue s√©par√©ment par le fabricant et co√ªte de l'argent.  Le principal probl√®me - pour l'installer, vous devez ouvrir le comptoir et briser les scell√©s.  Autrement dit, une organisation fournissant des ressources est incluse dans ce processus.  Elle est inform√©e que les scell√©s seront bris√©s, une journ√©e est fix√©e et notre ing√©nieur, en pr√©sence d'un repr√©sentant de la ressource, proc√®de aux am√©liorations n√©cessaires, apr√®s quoi le compteur est √† nouveau scell√©. <br><br>  Selon l'interface install√©e, un raffinement suppl√©mentaire est effectu√©.  Par exemple, nous avons d√©cid√© de connecter un compteur pour le fil.  C'est l'option la plus simple, si notre commutateur est √† moins de 100 m√®tres de l'accessibilit√©, il est redondant d'√™tre plus sage avec LoRa.  C√¢ble plus simple vers notre r√©seau, dans un VLAN isol√©. <br><br>  RS-485/232 a besoin d'un convertisseur Ethernet.  Beaucoup se rappelleront imm√©diatement MOX, mais c'est cher.  Pour nos solutions, nous avons choisi une solution chinoise moins ch√®re. <br><br>  Si la sortie est imm√©diatement Ethernet, alors un convertisseur n'est pas n√©cessaire. <br><br>  Question  Supposons que nous d√©finissions nous-m√™mes la sortie de l'interface.  Peut-il lui faciliter la vie et installer imm√©diatement Ethernet partout? <br><br>  Ce n'est pas toujours possible.  Il faut regarder les performances de l'affaire.  Il peut ne pas avoir le bon trou pour que l'interface se tienne comme il se doit.  Et le comptoir, je me souviens, est dans notre sous-sol.  Ou dans la chaufferie.  Il y a une forte humidit√©, l'√©tanch√©it√© ne peut pas √™tre rompue.  Finir le fichier avec un fichier est une mauvaise id√©e.  Mieux vaut mettre quelque chose qui initialement ne n√©cessite pas de grandes modifications.  Souvent, le RS-485 est la seule issue. <br><br>  Plus loin.  Le compteur est-il connect√© √† une alimentation garantie?  Sinon, il vit sur batterie.  Dans ce mode, il est con√ßu pour une interrogation manuelle une fois par mois pendant trois minutes.  L'appel constant au VKT-7 fera chuter sa batterie.  Vous devez donc tirer la puissance garantie et installer un convertisseur de tension. <br><br>  Pour chaque fabricant de compteurs, le module de puissance est diff√©rent.  Il peut s'agir d'une unit√© externe sur rail DIN ou d'un convertisseur int√©gr√©. <br><br>  Il s'av√®re qu'un ensemble d'interfaces et de modules de puissance diff√©rents pour chaque compteur doit toujours √™tre stock√© dans notre entrep√¥t.  La nomenclature y est impressionnante. <br><br>  Bien s√ªr, tout cela sera finalement pay√© par l'abonn√©.  Mais il n'attendra pas un mois avant que l'appareil souhait√© n'arrive.  Et il a besoin d'une estimation pour la connexion ici et maintenant.  Le stock technologique tombe donc sur nos √©paules. <br><br>  Tout ce que j'ai d√©crit se transforme en une carte de connexion technique claire afin que les ing√©nieurs de terrain ne pensent pas au type d'animal qu'ils ont rencontr√© au sous-sol suivant et √† ce dont ils ont besoin pour son travail. <br><br>  La liste des t√¢ches est adjacente aux r√®gles g√©n√©rales de connexion.  Apr√®s tout, il ne suffit pas d'inclure le compteur dans notre r√©seau, vous devez toujours lancer le m√™me VLAN sur le port du commutateur, vous devez effectuer des diagnostics, effectuer un sondage.  Nous nous effor√ßons d'automatiser l'ensemble du processus autant que possible afin d'√©viter les erreurs et de ne pas attirer les forces suppl√©mentaires des ing√©nieurs. <br><br>  Eh bien, ils ont √©crit des cartes techniques, des r√©glementations, de l'automatisation.  Logistique √©tablie. <br><br><h3>  O√π sont les pi√®ges cach√©s ailleurs? </h3><br>  Les donn√©es sont lues et vers√©es dans la base de donn√©es. <br><br>  L'abonn√© de ces chiffres n'est ni chaud ni froid.  Il a besoin d'un rapport.  De pr√©f√©rence sous la forme sous laquelle il est utilis√©.  Encore mieux, si imm√©diatement sous la forme d'un rapport qu'il comprend, qu'il peut imprimer, mettre une signature et remettre.  Cela signifie que vous avez besoin d'une interface simple et intuitive qui affiche des informations sur le compteur et peut g√©n√©rer automatiquement un rapport. <br><br>  Ici, notre zoo continue.  Le fait est qu'il existe plusieurs formulaires de rapport.  √Ä la base, ils refl√®tent la m√™me chose (chaleur consomm√©e), mais de diff√©rentes mani√®res. <br><br>  Certains abonn√©s d√©clarent des valeurs absolues (c'est-√†-dire que les valeurs sont √©crites dans le graphique de la consommation de chaleur, en commen√ßant par l'installation du compteur), d'autres en deltas (c'est lorsque nous √©crivons la consommation sur une p√©riode de temps sans r√©f√©rence aux valeurs initiales).  En fait, ils n'utilisent pas des normes communes, mais une pratique √©tablie.  Il y a eu des cas o√π les abonn√©s voient toutes les valeurs dont ils ont besoin (la quantit√© de chaleur consomm√©e, la quantit√© de liquide de refroidissement fournie et laiss√©e, la diff√©rence de temp√©rature), mais les colonnes du rapport ne sont pas dans la m√™me s√©quence. <br>  D'o√π l'√©tape suivante - le rapport doit √™tre personnalisable.  Autrement dit, l'abonn√© choisit lui-m√™me la s√©quence √† venir et les ressources contenues dans son document. <br><br>  Voici un point int√©ressant.  Tout va bien si notre compteur est install√© correctement.  Mais il arrive que l'organisation d'installation, lors de l'installation de l'ITP, ait foir√© et r√©gl√© incorrectement l'heure du compteur.  Nous avons rencontr√© des appareils qui pensent - dans la cour en 2010.  Dans notre syst√®me, cela ressemblera √† z√©ro relev√© pour la date actuelle et √† la consommation r√©elle - si vous choisissez 2010.  Les deltas sont tr√®s utiles ici.  Autrement dit, nous disons qu'au cours de la derni√®re journ√©e, tant de choses sont arriv√©es. <br><br>  Il semblerait, pourquoi de telles difficult√©s?  Si difficile de laisser tomber l'horloge? <br><br>  C'est pr√©cis√©ment avec VKT-7 que cela conduira √† une r√©initialisation compl√®te du compteur et √† la suppression des archives de celui-ci. <br>  L'abonn√© sera oblig√© de prouver aux personnes ressources qu'il a d√©fini l'ITP pas hier, mais seulement il y a environ cinq ans. <br><br>  Et enfin, une cerise sur le g√¢teau. <br><br><h3>  La certification </h3><br>  Nous avons un appareil de mesure, nous avons un rapport.  Entre eux se trouve notre syst√®me, qui g√©n√®re ce rapport.  La croyez-vous? <br><br>  Je le suis.  Mais comment prouver que rien ne change en nous, que nous ne d√©naturons pas le sens.  Il s'agit d'un probl√®me de certification.  Le syst√®me d'enqu√™te doit disposer d'un certificat confirmant son impartialit√©.  Tous les grands syst√®mes, tels que LERS, I Energetik et autres, ont un certificat similaire.  Nous l'avons obtenu, bien qu'il soit co√ªteux et long. <br><br>  Bien s√ªr, vous pouvez toujours couper le coin et acheter quelque chose de pr√™t.  Mais pour cela, vous devez payer le d√©veloppeur.  Et le d√©veloppeur peut demander non seulement des frais d'entr√©e, mais aussi des frais mensuels.  Autrement dit, nous serons oblig√©s de partager une partie de notre tarte avec lui. <br><br><h3>  Pourquoi tout cela? </h3><br>  Ce n'est pas le principal probl√®me.  D√©velopper votre propre syst√®me est √©galement tr√®s co√ªteux et beaucoup plus difficile.  Cependant, cela donne un avantage important.  Nous comprenons clairement comment cela fonctionne.  Nous le modulons facilement, nous pouvons le modifier si un tel besoin se fait sentir soudainement.  L'abonn√© re√ßoit un service plus complet, et de notre part, un contr√¥le √† cent pour cent sur le processus. <br><br>  C'est pourquoi nous avons choisi la deuxi√®me voie.  Nous y avons investi un an de la vie de nos d√©veloppeurs et ing√©nieurs de terrain.  Mais maintenant, nous comprenons clairement le travail de toute la cha√Æne. <br><br>  Avec le recul, je comprends que sans les connaissances acquises, je ne pourrais tout simplement pas interpr√©ter correctement le comportement anormal de l'un ou l'autre compteur. <br><br>  De plus, quelque chose de plus peut √™tre construit sur la base du syst√®me de r√©partition.  Alarmes de consommation excessive, rapport d'accident.  Nous nous pr√©parons prochainement √† lancer une application mobile. <br><br>  Nous sommes all√©s encore plus loin et avons ajout√© √† notre plate-forme (sinon vous ne pouvez plus l'appeler) ajout√© la possibilit√© de recevoir des appels des r√©sidents, la possibilit√© de g√©rer nos "interphones intelligents", de contr√¥ler imm√©diatement l'√©clairage public et quelques autres projets sur lesquels je n'ai pas encore √©crit. <br><br><img src="https://habrastorage.org/webt/_v/zl/bw/_vzlbw1q-ue01p8udfadwdu3nuq.png"><br><br>  Tout cela est compliqu√©, d√©chirant et long.  Mais le r√©sultat en vaut la peine.  Les abonn√©s re√ßoivent un produit complet fini. <br><br>  Chaque op√©rateur qui pr√©voit de se diriger vers le logement et les services communaux empruntera certainement cette voie.  Va-t-il passer? <br>  Il y a une question.  Ce n'est m√™me pas une question d'argent.  Comme je l'ai √©crit ci-dessus, nous avons besoin ici d'un tas de travail dans le domaine et le d√©veloppement.  Tous les grands acteurs n'y sont pas habitu√©s.  Si vos d√©veloppeurs sont √† Moscou et que les connexions sont √©tablies √† Novossibirsk, votre temps pour le produit fini est consid√©rablement allong√©. <br><br>  Le temps dira qui restera sur ce march√© et qui dira - eh bien, laissez-le aller en enfer!  Mais je suis s√ªr d'une chose: venir prendre des parts de march√© exclusivement avec de l'argent ne fonctionnera pas.  Ce processus n√©cessite des approches non conventionnelles, de bons ing√©nieurs, creuser dans le r√©gulateur, communiquer avec les ressources et les abonn√©s, identifier et surmonter constamment le rake. <br><br>  <b>PS</b> Dans cet article, je me suis d√©lib√©r√©ment concentr√© sur la chaleur et je n'ai pas mentionn√© l'√©lectricit√© ou l'eau.  Je d√©cris √©galement la connexion par c√¢ble.  Si nous avons une sortie d'impulsion, il y a quelques nuances, telles que les rapprochements obligatoires apr√®s l'installation.  Il se peut que le fil n'atteigne pas, alors LoRaWAN est utilis√©.  Il est tout simplement irr√©aliste de d√©crire l'ensemble de notre plateforme et les √©tapes de son d√©veloppement dans un seul article. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr449668/">https://habr.com/ru/post/fr449668/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr449656/index.html">Comment vous divertir avec vk api</a></li>
<li><a href="../fr449658/index.html">Nouvel ≈ìuf de P√¢ques de Google - Thanos et le gant de l'infini par rapport aux r√©sultats de recherche Google</a></li>
<li><a href="../fr449662/index.html">Bienvenue √† prendre la parole √† PyCon Russie 2019</a></li>
<li><a href="../fr449664/index.html">Configuration de GitLab CI pour charger un projet Java dans Maven Central</a></li>
<li><a href="../fr449666/index.html">DevOpsForum 2019. D√©ployer DevOps ne peut pas attendre</a></li>
<li><a href="../fr449670/index.html">Pour soutenir la muse: comment sont organis√©s les dons pour les streamers</a></li>
<li><a href="../fr449672/index.html">Noerden Life2 - horloge analogique avec contr√¥le ¬´gestuel¬ª et verre ¬´tactile¬ª</a></li>
<li><a href="../fr449674/index.html">Mise √† jour de la prise en charge de Razor dans Visual Studio Code, maintenant avec la prise en charge de Blazor</a></li>
<li><a href="../fr449676/index.html">Gestion comp√©tente - mythe ou r√©alit√©? R√©pondre au groupe Kolesa, Evil Martians et Wrike</a></li>
<li><a href="../fr449678/index.html">Pourquoi les t√¢ches logicielles prennent toujours plus de temps que vous ne le pensez</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>