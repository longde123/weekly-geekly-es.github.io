<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏂🏻 🚱 🥣 Android如何运作，第4部分 🐙 👩🏿‍🤝‍👩🏼 🤳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="大家好！ 我们花时间继续阅读有关内部Android设备的一系列文章。 在本文中，我将讨论Android启动过程，文件系统的内容，用户和应用程序数据的存储方式，root用户访问权限，Android构建的可移植性以及碎片问题。 


 系列文章： 


- Android如何运作，第1部分 
- And...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Android如何运作，第4部分</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/solarsecurity/blog/427431/"><p> <a href=""><img src="https://habrastorage.org/webt/jv/bc/cd/jvbccdismv6aavwbri8o5q9uu5o.png"></a> </p><br><p> 大家好！ 我们花时间继续阅读有关内部Android设备的一系列文章。 在本文中，我将讨论Android启动过程，文件系统的内容，用户和应用程序数据的存储方式，root用户访问权限，Android构建的可移植性以及碎片问题。 </p><a name="habracut"></a><br><p> 系列文章： </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Android如何运作，第1部分</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Android如何运作，第2部分</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Android如何运作，第3部分</a> </li><li>  Android如何运作，第4部分 </li><li>  ... </li></ul><br><h2 id="pakety"> 配套 </h2><br><p>如前所述，Android体系结构围绕应用程序构建。 应用程序在系统的许多部分的设备中起着关键作用，构建活动和意图模型是为了应用程序的和谐交互，而Android安全模型基于应用程序的隔离。 并且，如果活动管理器负责协调应用程序组件之间的交互，则<strong>包管理器</strong>负责安装，更新和管理应用程序权限（包管理器-您可以使用<code>pm</code>命令在shell中调用它）。 </p><br><p> 顾名思义，“程序包管理器”在此级别通常称为<strong>程序包</strong> 。 软件包以<strong>APK</strong>格式分发（Android软件包）-特殊的zip档案。 每个软件包都有一个唯一标识此应用程序的<em>名称</em> （也称为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">应用程序ID</a> ）（但不能标识其特定版本-相反，该软件包的不同版本的名称必须匹配，否则它们将被视为单独的软件包）。 程序包名称通常以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><em>反向DNS名称的</em></a>形式书写-例如，YouTube应用程序使用程序包名称<code>com.google.android.youtube</code> 。 程序包名称通常与Java代码中使用的名称空间匹配，但Android不需要它（此外，应用程序的APK文件通常包含第三方库，该名称库与程序包名称完全没有关系，谁使用它们）。 </p><br><p> 组装期间的每个APK必须<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong>由</strong></a>开发人员使用数字签名签名。  Android在安装应用程序时会检查此签名，并在更新已安装的应用程序时会另外比较用于签名新旧版本的公钥； 它们必须匹配，以确保新版本是由与旧版本相同的开发人员创建的。  （如果无法进行此检查，则攻击者可以使用与现有应用程序相同的名称创建一个程序包，通过“更新”该应用程序诱使用户安装它，并获得对该应用程序数据的访问权限。） </p><br><p> 软件包本身的<strong>更新</strong>是安装新版本，而不是旧版本，其中保留了从用户那里收到的数据和权限。 您还可以将应用程序“降级”到旧版本，但是默认情况下，Android同时会擦除新版本保存的数据，因为旧版本可能无法使用新版本使用的数据格式。 </p><br><p> 正如我已经说过的，通常每个应用程序的代码都是在其自己的Unix用户（UID）下执行的，这可以确保它们相互隔离。 多个应用程序可能会<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">明确要求</a> Android为它们使用通用的UID，这将允许它们直接访问彼此的文件，甚至（如果需要）在同一进程中运行。 </p><br><p> 尽管通常一个软件包对应一个APK文件，但Android支持由多个APK组成的软件包（这称为拆分APK或<strong>拆分APK</strong> ）。 这是Android此类“魔术”功能的基础，例如动态加载其他应用程序模块（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">动态功能模块</a> ）和在Android Studio中<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">即时运行</a> （自动更新正在运行的应用程序代码，而无需完全重新安装，并且在许多情况下，甚至无需重新启动）。 </p><br><p><img src="https://habrastorage.org/webt/jm/_x/0q/jm_x0qtvqsmt4-tj6-hxbcwzizi.png"></p><br><h2 id="faylovaya-sistema"> 文件系统 </h2><br><p> 文件系统设备是操作系统体系结构中最重要，最有趣的问题之一，Android中的文件系统设备也不例外。 </p><br><p> 首先要关注的是，使用哪种文件系统，即以哪种格式将文件内容保存在条件磁盘上（对于Android，通常是闪存和SD卡），以及系统内核如何提供支持。 。  Android中使用的Linux内核在某种程度上支持多种不同的文件系统-从Windows FAT和NTFS中使用的文件系统，以及臭名昭著的HFS +和现代APFS在达尔文中使用的文件系统-到计划9中的网络9pfs。 »对于Linux文件系统-例如，Btrfs和ext系列。 </p><br><p>  Linux的事实上的标准长期以来一直是<strong>ext4</strong> ，大多数流行的Linux发行版默认使用<strong>ext4</strong> 。 因此，在Android中使用它的事实并不令人意外。 一些程序集（和一些发烧友）还使用<strong>F2FS</strong> （闪存友好文件系统），该文件专门针对闪存进行了优化（但是，由于其优势，目前<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">尚不清楚</a> ）。 </p><br><p> 其次，所谓的<strong>文件系统布局</strong>令人感兴趣-系统和用户文件夹以及文件在文件系统中的位置。  “常规Linux”中的文件系统布局应提供更详细的描述（例如，可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在此链接中找到</a> ）； 我在这里只提及一些最重要的目录： </p><br><ul><li>  <code>/home</code>存储用户主文件夹； 在这里，程序会在各种隐藏文件夹（ <code>.cache</code> ， <code>.cache</code> ， <code>.config</code>等）中存储特定于用户的设置，数据和缓存， </li><li>  <code>/boot</code>存储Linux内核和initramfs映像（特殊启动文件系统）， </li><li>  <code>/usr</code> （调用<code>/system</code>会更合乎逻辑）存储系统本身的主要部分，包括库，可执行文件，配置文件以及资源-界面主题，图标，系统手册内容等， </li><li>  <code>/etc</code> （调用<code>/config</code>会更合逻辑）存储系统范围的设置， </li><li>  <code>/dev</code>存储设备文件和其他特殊文件（例如socket <code>/dev/log</code> ）， </li><li>  <code>/var</code>存储可变数据-日志，系统缓存，数据库内容等 </li></ul><br><p>  Android使用相似但明显不同的文件系统布局。 以下是其中一些最重要的部分： </p><br><ul><li>  <code>/data</code>存储可变数据， </li><li> 内核和initramfs映像存储在单独的闪存分区中，该闪存分区无法安装在主文件系统上。 </li><li>  <code>/system</code>匹配<code>/usr</code>并存储系统， </li><li>  <code>/vendor</code> -为该Android程序集的特定文件设计的<code>/system</code>的类似物，未包含在“标准” Android中， </li><li>  <code>/dev</code> ，如“标准Linux”中一样，存储设备文件和其他特殊文件。 </li></ul><br><p> 这些目录中最有趣的是<code>/data</code>和<code>/system</code> 。  <code>/system</code>的内容描述了系统，并包含其大部分组成文件。  <code>/system</code>位于闪存的单独部分，默认情况下以只读模式挂载； 通常，仅当系统更新时，其上的数据才会更改。  <code>/data</code>也位于单独的部分，描述了特定设备的可变状态，包括用户设置，已安装的应用程序及其数据，缓存等。 使用这种方案清除所有用户数据，即所谓的出厂重置，仅是清除<em>数据</em>部分的内容。 未触及的系统仍保留在“ <em>系统”</em>部分中。 </p><br><pre> <code class="markdown hljs"><span class="hljs-section"><span class="hljs-section"># mount | grep /system /dev/block/mmcblk0p14 on /system type ext4 (ro,seclabel,relatime,data=ordered) # mount | grep /data /dev/block/mmcblk0p24 on /data type ext4 (rw,seclabel,nosuid,nodev,noatime,noauto_da_alloc,data=writeback)</span></span></code> </pre> <br><p> 应用程序-即它们的APK，odex文件（提前编译的Java代码）和ELF库-安装在<code>/system/app</code> （对于系统附带的应用程序）或<code>/data/app</code> （对于用户安装）中应用程序）。 创建Android程序集时，将为每个预安装的应用程序分配一个名为<code>/system/app/Terminal</code>形式的文件夹，对于在安装过程中用户安装的应用程序，将创建以其包名开头的文件夹。 例如，YouTube应用程序保存在一个名为<code>/data/app/com.google.android.youtube-bkJAtUtbTuzvAioW-LEStg==/</code>的文件夹中。 </p><br><div class="spoiler">  <b class="spoiler_title">关于此后缀</b> <div class="spoiler_text"><p> 应用程序文件夹名称中的后缀是Base64中编码的16个随机字节。 使用此后缀可以防止其他应用程序“猜测”他们不应该知道的应用程序路径。 原则上，设备上安装的应用程序列表及其路径不是秘密-可以通过<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">标准API获取</a> -但在某些情况下（即，对于Instant apps），对此数据的访问受到限制。 </p><br><p> 此后缀有另一个用途。 每次更新应用程序时，新的APK都会安装在带有新后缀的文件夹中，然后删除旧文件夹。 在8.0版Oreo之前，这是后缀的目的，而不是随机字节<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">，</a>而是交替<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用</a> <code>-1</code>和<code>-2</code> （例如，对于YouTube，为<code>/data/app/com.google.android.youtube-2</code> ）。 </p><br><p> 可以使用标准API或<code>pm path org.example.packagename</code>获取<code>/system/app</code>或<code>/data/app</code>应用程序文件夹的完整路径，该<code>pm path org.example.packagename</code>可显示所有应用程序APK文件的路径。 </p><br><pre> <code class="markdown hljs"><span class="hljs-section"><span class="hljs-section"># pm path com.android.egg package:/system/app/EasterEgg/EasterEgg.apk</span></span></code> </pre> </div></div><br><p> 由于<strong>预装的应用程序存储在<em>系统</em>部分</strong> （我记得，其内容仅在系统更新时才更改），因此无法删除它们（相反，Android提供了“禁用”它们的功能）。 尽管如此，仍支持<em>更新</em>预安装的应用程序-在这种情况下，将在<code>/data/app</code>中为新版本创建一个文件夹，并且系统随附的版本仍在<code>/system/app</code> 。 在这种情况下，用户有机会“删除”该应用程序的更新，从而从<code>/system/app</code>返回到版本。 </p><br><p> 预安装的应用程序的另一个功能是它们可以接收<strong>特殊的“系统”权限</strong> 。 例如，第三方应用程序没有获得<code>DELETE_PACKAGES</code>权限，该权限允许您删除其他应用程序， <code>REBOOT</code>允许您重新启动系统，而<code>READ_FRAME_BUFFER</code>则允许直接访问屏幕内容。 这些权限具有<em>签名保护级别</em> ，也就是说，尝试访问它们的应用程序必须使用与实现它们的应用程序或服务相同的密钥进行签名-在这种情况下，由于这些许可权是由系统实现的，因此对其进行签名的密钥Android版 </p><br><p> 为了存储可变数据，每个应用程序都在<code>/data/data</code>分配了一个文件夹（例如，对于YouTube，为<code>/data/data/com.google.android.youtube</code> ）。 只有应用程序本身可以访问此文件夹-也就是说，只有该应用程序在其下启动的UID（如果该应用程序使用多个UID，或者如果多个应用程序使用一个公共UID，则所有操作都可能更加复杂）。 应用程序在此文件夹中保存设置，高速缓存（分别在<code>shared_prefs</code>和<code>cache</code>子文件夹中）以及所需的其他任何数据： </p><br><pre> <code class="markdown hljs"><span class="hljs-section"><span class="hljs-section"># ls /data/data/com.google.android.youtube/ cache code_cache databases files lib no_backup shared_prefs # cat /data/data/com.google.android.youtube/shared_prefs/youtube.xml &lt;?xml version='1.0' encoding='utf-8' standalone='yes' ?&gt; &lt;map&gt; &lt;string name="user_account"&gt;username@gmail.com&lt;/string&gt; &lt;boolean name="h264_main_profile_supported7.1.2" value="true" /&gt; &lt;int name="last_manual_video_quality_selection_max" value="-2" /&gt; &lt;...&gt; &lt;/map&gt;</span></span></code> </pre> <br><p> 系统知道<code>cache</code>文件夹的存在，如果没有足够的空间，可以自行清理它。 当您卸载该应用程序时，该应用程序的整个文件夹将被完全删除，并且该应用程序不会留下任何痕迹。 另外，两个用户都可以在设置中明确地执行操作： </p><br><p> <a href=""><img src="https://habrastorage.org/webt/nz/a7/tw/nza7tw-1zno64k_jos3dtwoct9g.jpeg"></a> </p><br><p> 分配给每个应用程序的数据存储称为内部存储。 </p><br><p> 此外，Android还具有另一种类型的存储-所谓的<strong>外部存储</strong> （外部存储-此名称反映了最初的想法，即外部存储应位于插入手机的外部SD卡上）。 实际上，外部存储设备充当<strong>用户主文件夹</strong>的角色-文件，下载，音乐和图片等文件夹位于此处，文件管理器将其作为默认文件夹打开的外部存储设备，允许计算机在连接​​后访问外部存储设备的内容通过电缆。 </p><br><pre> <code class="markdown hljs"><span class="hljs-section"><span class="hljs-section"># ls /sdcard Alarms Download Podcasts Android Movies Ringtones Books Music Subtitles DCIM Notifications bluetooth Documents Pictures</span></span></code> </pre> <br><p> 与内部存储不同，内部存储分为各个应用程序的文件夹，外部存储是一个“公共区域”：任何已获得用户适当许可的应用程序均具有完全访问权限。 正如我在上一篇文章中提到的那样，文件管理器之类的应用程序应该请求此权限。 对于大多数其他应用程序，最好将<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>ACTION_GET_CONTENT</code></a>操作与intent一起使用，使用户有机会在系统文件管理器中选择所需的文件。 </p><br><p> 许多应用程序倾向于将其一些内部文件保存在外部存储中，这些内部文件很大（例如，下载的图像和音频文件的缓存）。 为此，Android会将名称分配为<code>Android/data/com.google.android.youtube</code>的形式分配给外部存储文件夹中的应用程序。 该应用程序本身<em>不需要</em>访问整个外部存储器的权限即可访问此文件夹（因为其UID设置为该文件夹的所有者），但是任何其他具有此权限的应用程序都可以访问此文件夹，因此，值得使用仅用于存储公共和非关键数据。 当您卸载应用程序时，系统还将删除其在外部存储中的特殊文件夹； 但是，由应用程序在其特殊文件夹之外的外部存储器中创建的文件被认为属于用户，并且在删除创建它们的应用程序之后仍保留在原位。 </p><br><p> 正如我上面提到的，最初假定外部存储实际上位于外部SD卡上，因为那时SD卡的容量大大大于电话内置的内存容量（在HTC Dream中仅为256 MB，其中大约90兆字节分配给了<em>数据</em>部分）。 从那时起，许多情况发生了变化。 现代手机通常没有SD卡插槽，但移动标准安装了大量的内部存储器（例如，在Samsung Galaxy Note 9中，其最大存储容量为512 <em>GB</em> ）。 </p><br><p> 因此，在现代Android中，内部存储器和外部存储器几乎总是位于内部存储器中。 外部存储器在文件系统中所处的实际路径采用<code>/data/media/0</code>的形式（为每个设备用户<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">创建</a>了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一个</a>单独的外部存储器，并且路径中的数字与用户号相对应）。 出于兼容性目的，也可以通过<code>/sdcard</code> ， <code>/mnt/sdcard</code> ， <code>/storage/self/primary</code> ， <code>/storage/emulated/0</code>路径，以<code>/mnt/runtime/</code>开头的几个路径以及其他一些路径来访问外部存储。 </p><br><p> 另一方面，许多设备仍然具有SD卡插槽。 插入Android设备的SD卡可用作常规的外部驱动器（无需将其转换为系统的内部或外部存储设备）-将文件保存到其中，打开其中存储的文件，使用它将文件传输到其他设备等。 此外，Android允许您“借用” SD卡并在其上放置内部和外部存储（这称为借用存储- <strong>采用的存储</strong> ）。 同时，系统重新格式化SD卡并对其内容进行加密-无法通过将SD卡连接到另一台设备来读取其中存储的数据。 </p><br><p><img src="https://habrastorage.org/webt/rg/_o/ll/rg_ollklgpm44_ixtasfjhowl-a.png"></p><br><p> 例如，您可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在本文</a>以及<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">面向应用程序开发人员</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Android程序集创建者</a>的官方文档中了解有关所有这些内容的更多信息。 </p><br><h2 id="zagruzka"> 载入中 </h2><br><p> 计算机系统安全性的传统方法仅限于保护系统免受软件攻击。 人们认为， <strong>如果攻击者可以物理访问计算机，那么该游戏已经丢失</strong> ：他可以完全访问存储在计算机上的任何数据。 为此，对于他来说，例如，在此计算机上运行由他控制的任意操作系统就足够了，从而允许他绕过“主要”权利系统施加的任何限制，或者直接将数据磁盘连接到另一台设备。 如果需要，攻击者可以使计算机处于可操作状态，但可以修补安装在其上的系统，安装任意后门，键盘记录程序等。 </p><br><p> 抵制软件攻击的重点在于Unix中限制用户权限的模型（以及Android中基于此限制的应用程序沙盒技术）；  Unix限制本身并不能保护系统免受用户进入服务器机房并获得对计算机的物理访问权限。 而且，如果可以并且应该保护严肃的多用户服务器免遭未经授权的个人计算机（特别是移动设备）的物理访问，则该方法根本不适用。 </p><br><p> 可以通过以下两种方法来尝试改善这种情况，使其免受攻击者获得对该设备的物理访问权： </p><br><ul><li> 首先，可以<strong>对存储在磁盘上的数据</strong>进行<strong>加密</strong> ，从而即使攻击者可以访问<strong>磁盘的内容</strong> ，也可以防止攻击者获得对数据本身的访问权。 </li><li> 其次，有可能以某种方式<strong>限制在设备上加载任意操作系统的能力</strong> ，从而迫使攻击者通过已安装系统中的身份验证和授权过程。 </li></ul><br><p>  Android中的安全启动模型正是与这两个保护区域相关联的。 </p><br><h3 id="verified-boot"> 验证启动 </h3><br><p>  Android引导过程的设计是，一方面，它不允许攻击者在设备上下载任意操作系统，另一方面，它允许用户安装自定义的Android程序集（和其他系统）。 </p><br><p> 首先，与“台式”计算机不同，Android设备通常不允许用户（或攻击者）从外部介质启动； 相反，安装在设备上的<strong>引导</strong>程序（引导程序）将立即启动。  Bootloader是一个相对简单的程序，其任务（以正常模式加载时）包括： </p><br><ul><li> 可信执行环境（例如ARM TrustZone）的初始化和配置， </li><li> 查找存储Linux内核映像和initramfs的内部存储器分区， </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 验证其完整性（完整性）-否则，下载会因错误消息而中断-通过验证制造商的数字签名， </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 将内核和initramfs加载到内存中，并将控制权转移给内核。 </font></font></li></ul><br><h3 id="flashing-unlocking-fastboot-i-recovery"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 闪烁，解锁，快速启动和恢复 </font></font></h3><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 另外，bootloader支持用于更新和重新安装系统的其他功能。 </font></font></p><br><p> -,       (Android)   ,  <strong>recovery</strong> .  recovery,    Android-  ,           ,    Android  <em> recovery</em> . </p><br><p>      «» bootloader',       —   ( <strong>flashing</strong> )           .   bootloader       ,   fastboot mode (   bootloader mode),        bootloader'      <strong>fastboot</strong> (    <code>fastboot</code>  Android SDK   ). </p><br><p>   bootloader'   .     ,   Samsung,    bootloader'a (Loke)        (Odin).    Odin          Samsung (   Odin),      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Heimdall</a> . </p><br><p>      bootloader' (       ),      recovery   Android,    ,     : </p><br><pre> <code class="markdown hljs">$ fastboot flash recovery recovery.img $ fastboot flash boot boot.img $ fastboot flash system system.img</code> </pre> <br><p>      ;        : ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong>  </strong></a> ,   bootloader'     Android,      ,      ,          ,      . </p><br><p>  ,    <strong> bootloader'</strong> (unlocking the bootloader,    OEM unlock) —   bootloader'    recovery,         (     ).        Android,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong>LineageOS</strong></a> ( <strong>CyanogenMod</strong> ), <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Paranoid Android</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">AOKP</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">OmniROM</a>  . </p><br><p>   bootloader' -       ,         (  <em>data</em> ) <strong> </strong> .     ,   ,          (,      Google      ),   —    ,       . </p><br><p> <a href=""><img src="https://habrastorage.org/webt/sb/_q/3k/sb_q3kyv1pigm9j1wmi2vhu7lwa.png"></a> </p><br><p>     recovery   bootloader   ,            . </p><br><p>   bootloader'         : </p><br><p> <a href=""><img src="https://habrastorage.org/webt/rz/a6/sf/rza6sf4m3cprxkxymn41msgoaq0.jpeg"></a> </p><br><p>   recovery,    «» (flashaholics) — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TWRP</a> (Team Win Recovery Project).   -    «»,            zip-,           : </p><br><p> <a href=""><img src="https://habrastorage.org/webt/fo/rr/o_/forro_lz3skkvzytylekedddcli.png"></a> </p><br><h3 id="shifrovanie-diska">   </h3><br><p>   Android     ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong>file-based encryption</strong></a> ).       ext4  ,    Linux ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">fscrypt</a> ),          . </p><br><p>       ,    <em>data</em> ,   ,            (credential encrypted storage).  ,          ,         .                ,     ,     . </p><br><p> <a href=""><img src="https://habrastorage.org/webt/2f/4j/y8/2f4jy8m3qevncs1084-vvpqdku4.png"></a> </p><br><p>    credential encrypted storage  Android   device encrypted storage —     ,     (    Trusted Execution Environment). ,   ,     ,    .     ,   <strong>Direct Boot</strong> :           ;         ( )     device encrypted storage,        ,     . , Direct Boot        ,   ,      -      . </p><br><h2 id="root"> Root </h2><br><p>   root- —       « root» (UID 0,    <strong></strong> ). ,  root —    Unix-,  —     —       ,        . </p><br><p>       , Android     ,  <strong>        root-</strong> .       ,          «  »,  Android  « »,    root-     «»,  : </p><br><ul><li>    —      ,    APK   , </li><li>    : -, email-, ,  , ,   ,   ,       (      activity  intent',      ), </li><li>      (icon packs), </li><li>      ,     , </li><li>     (    Android-)        , </li><li>  ,    Android,      . </li></ul><br><p><img src="https://habrastorage.org/webt/np/pl/rh/npplrhnnumsl4ssb2vitzojmcqi.png"></p><br><p> ,   ,      , root-  .      root-        (   ),  <strong>   Android       root</strong> . ,     ,      Unix-;  shell,      <code>adb shell</code> ,        Unix- <em>shell</em> . </p><br><p>   , ,  root  : </p><br><ul><li> -, root-     Android  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong></strong></a> —    Android Studio     QEMU,             . <img src="https://habrastorage.org/getpro/habr/post_images/afa/9d4/6c3/afa9d46c303ccf673c839b29aff9fe97.gif"></li><li> -, root-        Android ( <strong>pre-rooted</strong> ROMs). </li><li> -,  <strong> bootloader'</strong> root-    Android   ,    ,   <code>su</code> ,  bootloader. </li><li>   , -, <strong>   ,   </strong> ,    root-,   (   root-          ). ,        2016 ,   root-  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Dirty Cow</a> . </li></ul><br><p>     ? , root-       .  ,  root-,    ,   ,     .        — ,            .  ,     ,      <em>system</em> (     ). </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">   </a> , root-   <strong>      </strong> —  ,       . </p><br><h3 id="problemy-root-dostupa">  root- </h3><br><blockquote> With great power comes great responsibility. </blockquote><p>       ,           .  ,  root-          . </p><br><p> ,         ,   .   ,   root-       , ,  ,    root-   .      root, ,  , ,  <strong>       </strong> —  ,   ,   ,    .. </p><br><p>        ,          Unix, Android   ,        —      .   <strong>   root-</strong> , ,        . , root-      Android,               . </p><br><p>   ,  <strong>    ,    root-</strong> ,                . ,  ,   , ,  ,       .  ,      — , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Google Pay</a> ( Android Pay) —  <strong>     root-</strong> ,    . </p><br><p><img src="https://habrastorage.org/webt/4h/qx/9g/4hqx9gfx2cobrrbikc6xhzzbobi.jpeg"></p><br><p> , -   Pokémon GO     root- , ,        . </p><br><h3 id="google-play-i-root-dostup"> Google Play  root- </h3><br><p> Google    Google Play Store  Google Play Services   ,  root- ,    Android     , , ,       ,          .   Play Store —     (   ,    )    Android,        . (   — , Amazon    Android   Fire OS    — Echo, Fire TV, Fire Phone, Kindle Fire Tablet —       Google).   root-       Android-. </p><br><p>     , Google   ,    root-,   Google Play (         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Open GApps</a> );   Google <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> ,             <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a> . </p><br><blockquote> Device manufacturers work with Google to certify that Android devices with Google apps installed are secure and will run apps correctly. To be certified, a device must pass Android compatibility tests. If you are unable to add a Google Account on your Android device, your Android device software might not have passed Android compatibility tests, or the device manufacturer has not submitted the results to Google to seek approval. As a result, your device is uncertified. This means that your device might not be secure. <br><br> If you are a User wanting to use custom ROMs on your device, please register your device by submitting your Google Services Framework Android ID below. </blockquote><br><h3 id="ogranichenie-dostupa-kroot">    root </h3><br><p>  «» Linux,     Unix-,   root- (   <code>sudo</code>  <code>su</code> )     ( ,   Unix- root,        )     (,    ).         ,            root-. </p><br><p> <a href=""> </a>  <code>su</code>  Android Open Source Project     ,     Unix- <em>shell</em> (  root),       root-.    <code>su</code>      , ,    ,     . </p><br><p>        ,     <code>su</code> .     <code>su</code>     ,        root-.         , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SuperSU</a> ;           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Magisk</a> . </p><br><p><img src="https://habrastorage.org/webt/ln/dk/s_/lndks_ju4haxlsnfbh8xpvofhek.png"></p><br><h3 id="magisk"> Magisk </h3><br><p>   Magisk —      ,       ,    <code>/system</code> ,        <em>system</em> (   <strong>systemless-ly</strong> ), <a href="">    «» Linux</a> .    <strong>Magisk Hide</strong> —        root-,         root-   Magisk   —    -            Google Pay,     root- . Magisk Hide         root-,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong>SafetyNet</strong></a>  Google. </p><br><p>    <em> </em> ,  ,      Google Pay  root-        —      root-   . ,    root-, -            Google Pay.    ,       . </p><br><p> Magisk  systemless-    «»   <strong>Magisk Modules</strong> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>     Magisk.    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">, </a> ,  root- Xposed  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ViPER</a> ,        . </p><br><h2 id="soc-drayvera-i-fragmentaciya"> SoC,    </h2><br><h3 id="sistemy-na-kristalle">    </h3><br><p>          <strong> </strong> ,       «»,      ,        — ,    —    (,    Wi-Fi ). </p><br><p>     ,   Android-    <strong>  </strong> (system on a chip, SoC).         —  ,   ,  -,  , LTE-, Bluetooth-  Wi-Fi-  .. —        .         ,     ,             ,        ,      ,          . </p><br><p> , ,       .      ,     «», , ,   ,       . ,  ,  -,      ,        ,  ,      . </p><br><h3 id="o-drayverah">   </h3><br><p>  —       Android —  SoC        .     ,    ,      —    LTE- —      .      , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">             ;  ,       </a> ,            . </p><br><p>    SoC (, Qualcomm)      Android- (, Sony  LG),       Android,     Android Open Source Project.   ,   Android,    ,       ,          . </p><br><p>     Android          Android-.         ,           Android.        Android     ,  ,            .             . </p><br><h3 id="fragmentaciya">  </h3><br><p>    ,   <strong></strong> :  Android       —      ,     .           Android,              . </p><br><p> ,    ,             ,     Android.         . </p><br><p> -,  <strong></strong> .       ,      .      ,     ,   ,  ,     . </p><br><p> -,        Android —    <strong>developer experience</strong> (DX,    user experience/UX).  ,              Android,    API — Android Framework, OpenGL/Vulkan   —      .   , ,   ,               Android —   ,   ,     . </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/aca/68a/fed/aca68afed91e22f1ab449a9b54c83ba5.jpg"></a> </p><br><h3 id="dont-stop-thinking-abouttomorrow"> Don't Stop Thinking About Tomorrow </h3><br><p>     Android-         . , Google      Nexus  Pixel   ,     Android.       Android      ,  ,   ,     . </p><br><p>  ,    ,   Android,    SoC. Android       «»  (, ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Android-x86</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RemixOS</a> ).   Android   ChromeOS,   Chromebook'  Android-   Linux-  -.   —    Android   —   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Anbox</a> ,   Android-  «» Linux-. (,  Android-     x86-,   ,     Java,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>    .) </p><br><p><img src="https://habrastorage.org/webt/p4/6q/e0/p46qe0opbvxrwdru85-3py3pgw0.png"></p><br><p>    ,    Android          —   ,     Android  . </p><br><p>       —   <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> </strong>       Android.   ,  ,    .    ,      <strong> </strong> ,    Android           . </p><br><p>     .  2017  Google <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> <strong>Project Treble</strong> — ,    (     HAL, hardware abstraction layer)    (  ,    )    . Treble <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>     ,   ,     ,   —     —     . </p><br><p> <strong>Treble    </strong>        .  Treble      (Sony, Nokia, OnePlus, Oppo, Xiaomi, Essential  Vivo —      Google) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>  - Android Pie. Treble <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> Essential    Android Pie   Essential Phone <em>   </em> Android Pie.      Android —          -  — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  </a>   ,  Treble,   ,         SoC. </p><br><p>  Treble   . Java   «write once, run everywhere»    —       Android-       . Treble —  ,        Android      SoC.    ,       ,   Treble.  ,        Android-  . </p><br><hr><br><p>         userspace Android:   init,  Zygote, Binder,   props. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN427431/">https://habr.com/ru/post/zh-CN427431/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN427419/index.html">当处理器无关时该怎么办？</a></li>
<li><a href="../zh-CN427421/index.html">家谱网站如何使杀手更容易</a></li>
<li><a href="../zh-CN427423/index.html">City2Share：慕尼黑物流中心的电动和自动驾驶汽车</a></li>
<li><a href="../zh-CN427427/index.html">他们如何进入IT领域：关于实习生和傻瓜（“我的圈子”民意调查的结果）</a></li>
<li><a href="../zh-CN427429/index.html">GUI框架-每个线程</a></li>
<li><a href="../zh-CN427433/index.html">运营商IP网络中的流量平衡</a></li>
<li><a href="../zh-CN427435/index.html">STM32H7-不带HAL的时钟设置</a></li>
<li><a href="../zh-CN427437/index.html">配置链接的服务器：ms sql服务器和teradata</a></li>
<li><a href="../zh-CN427439/index.html">关于RTOS的全部真相。 第十六条 讯号</a></li>
<li><a href="../zh-CN427441/index.html">与Kubernetes融合</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>