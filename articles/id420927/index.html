<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🦖 🚞 🧑🏻 “Pencarian host karet di Alibaba Cloud”: host Elasticsearch di fasilitas Alibaba Cloud 🤰🏻 🧖 🧑🏽‍🤝‍🧑🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beberapa waktu yang lalu, saya berbicara tentang pengalaman kami dalam memecahkan masalah yang rumit menggunakan Elasticsearch. Itu adalah cerita tent...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>“Pencarian host karet di Alibaba Cloud”: host Elasticsearch di fasilitas Alibaba Cloud</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420927/"><img src="https://habrastorage.org/webt/uq/9z/lr/uq9zlr4cxk0jr9im5sqmw5rbybo.jpeg"><br><br>  Beberapa waktu yang lalu, saya berbicara tentang pengalaman kami dalam memecahkan masalah yang rumit menggunakan Elasticsearch.  Itu adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">cerita tentang sosis</a> , di mana kami mengembangkan pencarian di database setidaknya 50.000 dokumen, yang memungkinkan Anda untuk mencari bahan dalam produk dan secara otomatis menghasilkan deskripsi produk dari mereka. <br><br>  Baru-baru ini, sebuah proyek menarik datang ke perusahaan kami yang mengharuskan penggunaan Elasticsearch.  Kali ini kami dihadapkan dengan tugas menyebarkan ES untuk bekerja dalam aplikasi pada platform cloud China, Alibaba Cloud.  Di sini, di samping masalah teknis, kami menemukan hal yang tidak terduga seperti mentalitas China. <br><br>  Artikel ini hanya akan berfokus pada pengalaman pribadi kami dengan Alibaba Cloud, dan bukan pada antarmuka atau opsi standar.  Saya akan memberi tahu Anda apa yang berhasil saya temukan dalam komunikasi dengan perwakilan platform Elasticsearch dan Alibaba Cloud, dan bagaimana kami menggunakannya dalam menyelesaikan masalah kami. <br><a name="habracut"></a><br><h3>  Ayun ke Cina </h3><br>  Di awal proyek, pelanggan mengumumkan bahwa peluncuran pertama aplikasi akan di Cina.  Ini tugas yang sangat rumit: Hukum Tiongkok memberikan cukup banyak ketidaknyamanan bagi pengembang dan pemilik situs web.  Penerimaan domain semata-mata karena birokrasi lokal berlangsung selama tiga bulan.  Tetapi bagaimana jika Anda meng-host aplikasi di luar Cina?  - kamu bertanya.  Dan sebagai tanggapan, semoga Anda beruntung dengan peluncuran di zona Cina, karena trik seperti itu praktis ilegal di sana. <br><br>  Kami diberi akses ke server klien di Alibaba Cloud dan diminta untuk menempatkan kontainer buruh pelabuhan dengan aplikasi di dalamnya.  Ini adalah yang pertama, tetapi bukan masalah utama.  Kami meneruskan akses dari wadah ke sistem file untuk memiliki akses ke file proyek di tingkat server, dan di sini masalahnya adalah bahwa pada server itu sendiri tidak ada yang lain selain buruh pelabuhan: tidak ada git, atau nginx, atau php.  Semuanya dilakukan di tingkat kontainer, dan server hanyalah gudang data.  Oleh karena itu, tarikan git sederhana berubah menjadi sebagai berikut: <br><br><pre><code class="hljs perl">docker <span class="hljs-keyword"><span class="hljs-keyword">exec</span></span> -it b33aee747c5e git pull</code> </pre> <br>  Karena itu, kami harus menulis skrip bash untuk setiap wadah, misalnya, dengan nama git: <br><br><pre> <code class="hljs powershell">docker exec <span class="hljs-literal"><span class="hljs-literal">-it</span></span> b33aee747c5e git <span class="hljs-variable"><span class="hljs-variable">$</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">@</span></span></code> </pre> <br>  Selanjutnya, petualangan hanya menjadi lebih rumit: kami harus menginstal ES entah bagaimana.  Melalui Alibaba Cloud Management Console, kami memasang gambar Elasticsearch 6.0.0 dan ... <br>  ... Dan setelah beberapa waktu mereka mulai menangkap kesalahan.  Entah sistem kontrol akses X-Pack akan mulai "bersumpah" bahwa setelah 28 hari lisensi berakhir, maka RAM akan berakhir ketika sekitar 500 dokumen diindeks.  Bukan "melambung." <br><br><h3>  Masalah Laovai </h3><br>  Selama ini kami berpikir bahwa alasan kegagalan adalah X-Pack, bahwa dialah yang mencegah kami bekerja secara normal. <br><br>  "Yah, apa yang bisa kita lakukan," kata pelanggan, setelah mendengarkan versi kami.  - Jadi, kami akan membeli lisensi X-Pack.  Menulis ke Elasticsearch, mungkin mereka sendiri akan menyarankan sesuatu. "  Saya menulis ke layanan akun, dan konsultan dari kantor Belanda, Driton Khalili, menjawab saya (jika Anda kebetulan bekerja dengannya, katakan halo kepada saya, dia baik-baik saja).  Ya, Eropa Timur dan Rusia memiliki kantor Belanda yang bertanggung jawab atas mereka, tempat orang Turki bekerja. <br><br>  Konsultan memberi tahu saya tentang sistem pembayaran lisensi X-Pack dan bertanya di mana kami hosting. <br>  Di China, saya menjawab. <br><br>  "Ini masalah," katanya.  - Pelanggan Anda perlu menulis ke cabang Cina kami untuk membantunya dengan masalah ini. <br>  - Apakah ada opsi lain?  Saya bertanya. <br>  - Coba hubungi Alibaba Cloud.  Faktanya adalah bahwa kami baru saja menyelesaikan perjanjian kemitraan dengan mereka, dan sekarang mereka menyediakan Elasticsearch sebagai layanan. <br>  "Jadi, kami menjamu mereka," kataku. <br>  - Lalu mengapa Anda tersiksa dengan wadah bukannya mengambil langsung dari mereka ?! <br>  Setelah menyelesaikan pembicaraan, saya menceritakan semua ini kepada pelanggan. <br>  - Maksud saya - apakah Alibaba memiliki Elasticsearch sebagai Layanan ?!  - Kemarahan klien tidak mengenal batas.  Setelah itu, dia pergi untuk berbicara dengan "rekan-rekan Cina", dan hari berikutnya dia mengatakan yang berikut: <br>  - Orang-orang ini mengatakan bahwa saya "mencintai", dan pada akun "penuh kasih" saya, saya tidak seharusnya memiliki Elasticsearch. <br>  Tidak sulit untuk menebak bahwa orang Solo menyebut orang asing itu orang Cina, sering menggunakan kata ini dengan konotasi yang meremehkan.  Kita dapat mengatakan bahwa ini adalah orang Cina "datang dalam jumlah besar." <br>  - Mereka minum puer di sana, atau apa? <br>  - Saya tidak tahu tentang puer, tetapi setelah pidato saya yang mengilhami bahwa mereka agak salah dan saya membayar mereka sama sekali, mereka memberi saya tautan "rahasia" ke Elasticsearch, yang sekarang akan ditampilkan di konsol cloud kami.  Atur dan kami akan pindah. <br><br><h3>  Apa yang harus dilakukan untuk "lepas landas" </h3><br>  Tiga minggu kemudian, tautan ke Alibaba Cloud Elasticsearch muncul di menu konsol kontrol (di bagian DTplus, di bagian paling bawah). <br><br><img src="https://habrastorage.org/webt/k6/-d/nl/k6-dnlxehlliuqjxg1yvtjuxnks.png"><br><br>  Dari sini kita dapat menyimpulkan bahwa jika orang Cina tetap memberi Anda tautan, Anda harus menunggu akses untuk sementara waktu (saya tidak dapat mengatakan dengan pasti tentang harganya, menurut pendapat saya, ini tidak menambah biaya berlangganan). <br><br>  Dan satu hal lagi: tentu saja, Anda akan diberikan akses ke pengaturan, URL normal, Kibana untuk pemantauan.  Hanya ketika Anda mencoba untuk mencapai ES dari tempat lain Anda mendapatkan 505. <br><br>  Bagaimana saya mengatasi masalah ini? <br><br>  Secara default, Elasticsearch Alibaba Cloud Console hanya dapat diakses dari Kibana dan proksi panggilan darinya ke 127.0.0.1 di dalam server tempat ES berada.  Lalu saya berpikir: apa alamat IP yang kita miliki di dalam di antara kontainer?  Saya masuk ke pengaturan dan melihat bahwa kita semua berputar di subnet 192.168.0 yang cukup akrab. *.  Saya tidak sepenuhnya yakin, jadi saya menulis beberapa alamat sendiri jika saya tidak "terbang". <br><br>  Saya juga memikirkan apa yang akan terjadi jika saya sendiri perlu mengirim permintaan ke ES dari workstation saya, jadi saya juga menuliskan alamat IP saya di selembar kertas. <br><br>  Selanjutnya, lakukan hal berikut. <br><br>  Masuk ke Alibaba Cloud Console, buka Cluster -&gt; Manage -&gt; Network dan Snapshots -&gt; bagian Cluster Network Settings -&gt; Daftar Putih Alamat IP Publik -&gt; Perbarui.  Dan kami menyimpan di sini semua alamat yang berguna - baik pribadi maupun publik.  Setelah itu, Anda sudah dapat bekerja dan mengetuk ES baik dari wadah dengan aplikasi, dan dari tempat lain. <br><br><img src="https://habrastorage.org/webt/ho/mi/gu/homigujirp4lwf6xh9vptwfbmnm.png"><br><br>  Perpindahan itu memakan waktu kurang dari dua jam.  Benar, selama seminggu lagi saya paranoid tentang kenyataan bahwa semuanya bisa jatuh, tetapi sejauh ini tidak ada yang jatuh.  Selama tiga bulan sekarang tidak pernah jatuh. <br><br>  Secara total, kami menghabiskan sekitar tiga minggu mencoba menyelesaikan masalah yang tidak ada.  Hanya saja orang Cina sangat licik dan tidak ingin memberikan akses ke layanan mereka ke "laov" apa pun.  Untuk seseorang dengan mentalitas Barat atau kami, ini aneh, namun, kami menangani masalah ini, dan itu adalah pengalaman yang agak menarik. <br><br>  Terima kasih atas perhatian anda! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id420927/">https://habr.com/ru/post/id420927/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id420909/index.html">Perusahaan TV Rusia menuduh Yandex pembajakan</a></li>
<li><a href="../id420913/index.html">Jalankan kubernetes di dalam LXC</a></li>
<li><a href="../id420915/index.html">Analisis RFM satu-klik atau bagaimana kami membuat hidup lebih mudah bagi pelanggan</a></li>
<li><a href="../id420919/index.html">Angka animasi di Android</a></li>
<li><a href="../id420923/index.html">Keterampilan Meta Pengembang Perangkat Lunak</a></li>
<li><a href="../id420929/index.html">Jalankan, Uji, Jalankan. Berbicara tentang Rapat Pengujian Seluler</a></li>
<li><a href="../id420931/index.html">Cara menguji pembangkit listrik tenaga nuklir</a></li>
<li><a href="../id420935/index.html">Semua yang perlu Anda ketahui tentang perataan di Flexbox</a></li>
<li><a href="../id420937/index.html">Tentang memakai SSD pada contoh nyata</a></li>
<li><a href="../id420939/index.html">Satu cerita tentang pertumbuhan karier atau mengapa saya menganggap diri saya seorang manajer yang baik</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>