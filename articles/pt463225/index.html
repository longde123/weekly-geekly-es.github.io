<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìü üëÑ üÜë Empresa WiFi. FreeRadius + FreeIPA + Ubiquiti üîå üéë üíã</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Alguns exemplos de WiFi corporativo j√° foram descritos. Aqui vou descrever como implementei uma solu√ß√£o semelhante e os problemas que tive que enfrent...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Empresa WiFi. FreeRadius + FreeIPA + Ubiquiti</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463225/"><img src="https://habrastorage.org/webt/2w/tm/tw/2wtmtwbdgzq2u6yp-ujvywpl4rw.jpeg"><br><br>  Alguns exemplos de WiFi corporativo j√° foram descritos.  Aqui vou descrever como implementei uma solu√ß√£o semelhante e os problemas que tive que enfrentar ao conectar em diferentes dispositivos.  Usaremos o LDAP existente com os usu√°rios estabelecidos, aumentaremos o FreeRadius e configuraremos o WPA2-Enterprise no controlador Ubnt.  Parece que tudo √© simples.  Vamos ver ... <br><a name="habracut"></a><br><h2>  Um pouco sobre os m√©todos EAP </h2><br>  Antes de prosseguir com a tarefa, precisamos decidir qual m√©todo de autentica√ß√£o usaremos em nossa solu√ß√£o. <br><br>  <b>Da wikipedia:</b> <br><blockquote>  O EAP √© uma estrutura de autentica√ß√£o que √© frequentemente usada em redes sem fio e conex√µes ponto a ponto.  O formato foi descrito pela primeira vez na RFC 3748 e atualizado na RFC 5247. <br>  O EAP √© usado para selecionar um m√©todo de autentica√ß√£o, transferir chaves e processar essas chaves com plug-ins chamados m√©todos EAP.  Existem muitos m√©todos EAP, ambos definidos com o pr√≥prio EAP e aqueles lan√ßados por fabricantes individuais.  O EAP n√£o define a camada de link, apenas define o formato da mensagem.  Cada protocolo que usa EAP possui seu pr√≥prio protocolo para encapsular mensagens EAP. </blockquote><br>  <b>Os pr√≥prios m√©todos:</b> <br><br><ul><li>  O LEAP √© um protocolo propriet√°rio desenvolvido pela CISCO.  Vulnerabilidades encontradas.  Atualmente n√£o recomendado </li><li>  O EAP-TLS √© bem suportado entre os fornecedores sem fio.  √â um protocolo seguro porque √© o sucessor dos padr√µes SSL.  A configura√ß√£o do cliente √© bastante complicada.  Precisa de um certificado de cliente al√©m da senha.  Suportado em muitos sistemas </li><li>  EAP-TTLS - amplamente suportado em muitos sistemas, oferece boa seguran√ßa usando certificados PKI apenas no servidor de autentica√ß√£o </li><li>  O EAP-MD5 √© outro padr√£o aberto.  Oferece seguran√ßa m√≠nima.  Vulner√°vel, n√£o suporta autentica√ß√£o m√∫tua e gera√ß√£o de chaves </li><li>  EAP-IKEv2 - Com base na vers√£o 2. do Protocolo de troca de chaves da Internet. Fornece autentica√ß√£o m√∫tua e estabelecimento de chave de sess√£o entre cliente e servidor. </li><li>  O PEAP √© uma solu√ß√£o conjunta CISCO, Microsoft e RSA Security como um padr√£o aberto.  Amplamente dispon√≠vel em produtos, oferece muito boa seguran√ßa.  Semelhante ao EAP-TTLS, exigindo apenas um certificado do lado do servidor </li><li>  PEAPv0 / EAP-MSCHAPv2 - Ap√≥s o EAP-TLS, √© o segundo padr√£o amplamente utilizado no mundo.  Rela√ß√£o cliente-servidor usada em Microsoft, Cisco, Apple, Linux </li><li>  PEAPv1 / EAP-GTC - criado pela Cisco como uma alternativa ao PEAPv0 / EAP-MSCHAPv2.  N√£o protege os dados de autentica√ß√£o de nenhuma maneira.  N√£o suportado no sistema operacional Windows </li><li>  O EAP-FAST √© um m√©todo desenvolvido pela Cisco para corrigir defici√™ncias do LEAP.  Usa credenciais de acesso protegido (PAC).  N√£o totalmente desenvolvido </li></ul><br>  De toda essa diversidade, a escolha ainda n√£o √© √≥tima.  O m√©todo de autentica√ß√£o era necess√°rio: boa seguran√ßa, suporte em todos os dispositivos (Windows 10, macOS, Linux, Android, iOS) e, de fato, quanto mais simples, melhor.  Portanto, a escolha recaiu sobre o EAP-TTLS em conjunto com o protocolo PAP. <br>  Talvez surja a pergunta - Por que usar PAP?  porque transfere senhas em texto n√£o criptografado? <br><br>  Sim est√° certo.  A comunica√ß√£o entre o FreeRadius e o FreeIPA ocorrer√° dessa maneira.  No modo de depura√ß√£o, voc√™ pode acompanhar como o nome de usu√°rio e a senha s√£o enviados.  Sim, e deixe-os ir, apenas voc√™ tem acesso ao servidor FreeRadius. <br><br>  Leia mais sobre o trabalho do EAP-TTLS <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><br></a> <br><br><h2>  Freeradius </h2><br>  Iremos aumentar o FreeRadius no CentOS 7.6.  Nada complicado aqui, definido da maneira usual. <br><br><pre><code class="bash hljs">yum install freeradius freeradius-utils freeradius-ldap -y</code> </pre> <br>  <i>Nos pacotes, a vers√£o 3.0.13 est√° instalada.</i>  <i>O √∫ltimo pode ser obtido em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://freeradius.org/</a></i> <br><br>  Depois disso, o FreeRadius j√° funciona.  Voc√™ pode descomentar a linha em / etc / raddb / users <br><br><pre> <code class="bash hljs">steve Cleartext-Password := <span class="hljs-string"><span class="hljs-string">"testing"</span></span></code> </pre> <br>  Execute o servidor no modo de depura√ß√£o <br><br><pre> <code class="bash hljs">freeradius -X</code> </pre> <br>  E fa√ßa uma conex√£o de teste com o localhost <br><br><pre> <code class="bash hljs">radtest steve testing 127.0.0.1 1812 testing123</code> </pre> <br>  Obtive uma resposta <i>Received Access-Accept Id 115 de 127.0.0.1:1812 para 127.0.0.1‚ñ∫6081 length 20</i> , ent√£o est√° tudo bem.  V√° em frente. <br><br>  N√≥s conectamos o m√≥dulo <i><b>LDAP</b></i> . <br><br><pre> <code class="bash hljs">ln -s /etc/raddb/mods-available/ldap /etc/raddb/mods-enabled/ldap</code> </pre> <br>  E mude imediatamente.  Precisamos do FreeRadius para acessar o FreeIPA <br><br><div class="spoiler">  <b class="spoiler_title">habilitado para mods / ldap</b> <div class="spoiler_text"><pre> <code class="bash hljs">ldap { server=<span class="hljs-string"><span class="hljs-string">"ldap://ldap.server.com"</span></span> port=636 start_tls=yes identity=<span class="hljs-string"><span class="hljs-string">"uid=admin,cn=users,dc=server,dc=com"</span></span> password=********** base_dn=<span class="hljs-string"><span class="hljs-string">"cn=users,dc=server,dc=com"</span></span> set_auth_type=yes ... user { base_dn=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${..base_dn}</span></span></span><span class="hljs-string">"</span></span> filter=<span class="hljs-string"><span class="hljs-string">"(uid=%{%{Stripped-User-Name}:-%{User-Name}})"</span></span> } ...</code> </pre> <br></div></div><br>  Reiniciamos o servidor radius e verificamos a sincroniza√ß√£o dos usu√°rios LDAP: <br><br><pre> <code class="bash hljs">radtest user_ldap password_ldap localhost 1812 testing123</code> </pre> <br>  Editando o eap no <i><b>mods-enabled / eap</b></i> <br>  Adicione duas inst√¢ncias eap aqui.  Eles diferem apenas em certificados e chaves.  Vou explicar logo abaixo o porqu√™ <br><br><div class="spoiler">  <b class="spoiler_title">ativado por mods / eap</b> <div class="spoiler_text"><pre> <code class="bash hljs">eap eap-client { default_eap_type = ttls timer_expire = 60 ignore_unknown_eap_types = no cisco_accounting_username_bug = no max_sessions = <span class="hljs-variable"><span class="hljs-variable">${max_requests}</span></span> tls-config tls-common { private_key_file = <span class="hljs-variable"><span class="hljs-variable">${certdir}</span></span>/fisrt.key certificate_file = <span class="hljs-variable"><span class="hljs-variable">${certdir}</span></span>/first.crt dh_file = <span class="hljs-variable"><span class="hljs-variable">${certdir}</span></span>/dh ca_path = <span class="hljs-variable"><span class="hljs-variable">${cadir}</span></span> cipher_list = <span class="hljs-string"><span class="hljs-string">"HIGH"</span></span> cipher_server_preference = no ecdh_curve = <span class="hljs-string"><span class="hljs-string">"prime256v1"</span></span> check_crl = no } ttls { tls = tls-common default_eap_type = md5 copy_request_to_tunnel = no use_tunneled_reply = yes virtual_server = <span class="hljs-string"><span class="hljs-string">"inner-tunnel"</span></span> } } eap eap-guest { default_eap_type = ttls timer_expire = 60 ignore_unknown_eap_types = no cisco_accounting_username_bug = no max_sessions = <span class="hljs-variable"><span class="hljs-variable">${max_requests}</span></span> tls-config tls-common { private_key_passwotd=blablabla private_key_file = <span class="hljs-variable"><span class="hljs-variable">${certdir}</span></span>/server.key certificate_file = <span class="hljs-variable"><span class="hljs-variable">${certdir}</span></span>/server.crt dh_file = <span class="hljs-variable"><span class="hljs-variable">${certdir}</span></span>/dh ca_path = <span class="hljs-variable"><span class="hljs-variable">${cadir}</span></span> cipher_list = <span class="hljs-string"><span class="hljs-string">"HIGH"</span></span> cipher_server_preference = no ecdh_curve = <span class="hljs-string"><span class="hljs-string">"prime256v1"</span></span> check_crl = no } ttls { tls = tls-common default_eap_type = md5 copy_request_to_tunnel = no use_tunneled_reply = yes virtual_server = <span class="hljs-string"><span class="hljs-string">"inner-tunnel"</span></span> } }</code> </pre> <br></div></div><br>  Em seguida, edite o <i><b>site ativado / padr√£o</b></i> .  Interessado nas se√ß√µes autorizar e autenticar. <br><br><div class="spoiler">  <b class="spoiler_title">ativado pelo site / padr√£o</b> <div class="spoiler_text"><pre> <code class="bash hljs">authorize { filter_username preprocess <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (&amp;User-Name == <span class="hljs-string"><span class="hljs-string">"guest"</span></span>) { eap-guest { ok = <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } elsif (&amp;User-Name == <span class="hljs-string"><span class="hljs-string">"client"</span></span>) { eap-client { ok = <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { eap-guest { ok = <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } ldap <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((ok || updated) &amp;&amp; User-Password) { update { control:Auth-Type := ldap } } expiration logintime pap } authenticate { Auth-Type LDAP { ldap } Auth-Type eap-guest { eap-guest } Auth-Type eap-client { eap-client } pap }</code> </pre> <br></div></div><br>  Na se√ß√£o autorizar, removemos todos os m√≥dulos que n√£o precisamos.  Deixe apenas o LDAP.  Adicionamos a verifica√ß√£o do cliente por nome de usu√°rio.  Por isso, adicionamos as duas inst√¢ncias eap acima. <br><br><div class="spoiler">  <b class="spoiler_title">Multi eap</b> <div class="spoiler_text">  O fato √© que, ao conectar alguns dispositivos, usaremos certificados do sistema e indicaremos o dom√≠nio.  Temos um certificado e uma chave de uma autoridade de certifica√ß√£o confi√°vel.  Pessoalmente, na minha opini√£o, esse procedimento de conex√£o √© mais f√°cil do que lan√ßar um certificado autoassinado em cada dispositivo.  Mas mesmo sem certificados autoassinados, ele ainda n√£o deu certo.  Os dispositivos Samsung e Android = &lt;6 vers√µes n√£o sabem como usar certificados do sistema.  Portanto, para eles, criamos uma inst√¢ncia separada de eap-guest com certificados autoassinados.  Para todos os outros dispositivos, usaremos o eap-client com um certificado confi√°vel.  O nome do usu√°rio √© determinado pelo campo An√¥nimo quando o dispositivo est√° conectado.  Apenas tr√™s valores s√£o permitidos: Convidado, Cliente e campo vazio.  O resto √© descartado.  Isso est√° configurado nas pol√≠ticas.  Darei um exemplo mais tarde <br></div></div><br>  Edite autorizar e autenticar se√ß√µes no <i><b>site ativado / t√∫nel interno</b></i> <br><br><div class="spoiler">  <b class="spoiler_title">ativado por site / t√∫nel interno</b> <div class="spoiler_text"><pre> <code class="bash hljs">authorize { filter_username filter_inner_identity update control { &amp;Proxy-To-Realm := LOCAL } ldap <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((ok || updated) &amp;&amp; User-Password) { update { control:Auth-Type := ldap } } expiration digest logintime pap } authenticate { Auth-Type eap-guest { eap-guest } Auth-Type eap-client { eap-client } Auth-Type PAP { pap } ldap }</code> </pre> <br></div></div><br>  Em seguida, voc√™ precisa especificar nas pol√≠ticas quais nomes podem ser usados ‚Äã‚Äãpara login an√¥nimo.  Edite <b><i>policy.d / filter</i></b> . <br><br>  Voc√™ precisa encontrar linhas semelhantes a esta: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (&amp;outer.request:User-Name !~ /^(anon|@)/) { update request { Module-Failure-Message = <span class="hljs-string"><span class="hljs-string">"User-Name is not anonymized"</span></span> } reject }</code> </pre> <br>  E abaixo, em elsif, adicione os valores necess√°rios: <br><br><pre> <code class="bash hljs">elsif (&amp;outer.request:User-Name !~ /^(guest|client|@)/) { update request { Module-Failure-Message = <span class="hljs-string"><span class="hljs-string">"User-Name is not anonymized"</span></span> } reject }</code> </pre> <br>  Agora precisamos ir para o diret√≥rio <b><i>certs</i></b> .  Aqui, voc√™ precisa colocar a chave e o certificado de uma autoridade de certifica√ß√£o confi√°vel, que j√° temos e precisamos gerar certificados autoassinados para o eap-guest. <br><br>  Altere os par√¢metros no arquivo <b><i>ca.cnf</i></b> . <br><br><div class="spoiler">  <b class="spoiler_title">ca.cnf</b> <div class="spoiler_text"><pre> <code class="bash hljs">... default_days = 3650 default_md = sha256 ... input_password = blablabla output_password = blablabla ... countryName = RU stateOrProvinceNmae = State localityNmae = City organizationName = NONAME emailAddress = admin@admin.ru commonName = <span class="hljs-string"><span class="hljs-string">"CA FreeRadius"</span></span></code> </pre> <br></div></div><br>  Os mesmos valores s√£o especificados no arquivo <b><i><i>server.cnf</i></i></b> .  N√≥s mudamos apenas <br>  <b>commonName</b> : <br><br><div class="spoiler">  <b class="spoiler_title">server.cnf</b> <div class="spoiler_text"><pre> <code class="bash hljs">... default_days = 3650 default_md = sha256 ... input_password = blablabla output_password = blablabla ... countryName = RU stateOrProvinceNmae = State localityNmae = City organizationName = NONAME emailAddress = admin@admin.ru commonName = <span class="hljs-string"><span class="hljs-string">"Server Certificate FreeRadius"</span></span></code> </pre> <br></div></div><br>  Criamos: <br><br><pre> <code class="bash hljs">make</code> </pre> <br>  Feito.  O <b><i>server.crt</i></b> e <b><i>server.key</i></b> resultantes j√° est√£o registrados acima no eap-guest. <br><br>  Por fim, adicione nossos pontos de acesso ao arquivo <b><i>client.conf</i></b> .  Eu os tenho 7. Para n√£o adicionar cada ponto separadamente, registraremos apenas a rede na qual eles est√£o localizados (meus pontos de acesso est√£o em uma VLAN separada). <br><br><pre> <code class="bash hljs">client APs { ipaddr = 192.168.100.0/24 password = password_AP }</code> </pre> <br><h2>  Controlador Ubiquiti </h2><br>  No controlador, criamos uma rede separada.  Que seja 192.168.2.0/24 <br>  V√° para configura√ß√µes -&gt; perfil.  Crie um novo: <br><br><img src="https://habrastorage.org/webt/n4/mj/_s/n4mj_shukldt1eogoqnpphaal3e.png"><br><br>  Escrevemos o endere√ßo e a porta do servidor radius e a senha que foram registradas no arquivo <b><i>clients.conf</i></b> : <br><br><img src="https://habrastorage.org/webt/6x/8e/km/6x8ekm2bbnrzghk0rv5qbdggnam.png"><br><br>  Crie um novo nome sem fio.  Como m√©todo de autentica√ß√£o, selecione WPA-EAP (Enterprise) e especifique o perfil de raio criado: <br><br><img src="https://habrastorage.org/webt/5i/ku/9n/5iku9n_j-r3fqsxvppyekim8aqi.png"><br><br>  Salvamos, aplicamos e seguimos em frente. <br><br><h2>  Configura√ß√£o do cliente </h2><br>  Vamos come√ßar com o mais dif√≠cil! <br><br><h3>  Windows 10 </h3><br>  A complexidade se resume ao fato de o Windows ainda n√£o conseguir se conectar ao WiFi corporativo por dom√≠nio.  Portanto, voc√™ precisa fazer o upload manual de nosso certificado para o armazenamento confi√°vel.  Aqui voc√™ pode usar tanto autoassinado quanto de uma autoridade de certifica√ß√£o.  Vou usar o segundo. <br><br>  Em seguida, voc√™ precisa criar uma nova conex√£o.  Para fazer isso, v√° para as configura√ß√µes de rede e Internet -&gt; Central de Rede e Compartilhamento -&gt; Criar e configurar uma nova conex√£o ou rede: <br><br><img src="https://habrastorage.org/webt/7d/9e/ix/7d9eixr7yfn94zmiv56f1kqpm_o.png"><br><br><img src="https://habrastorage.org/webt/-z/iy/dp/-ziydpjwwwqxkgisvkxmj4kpfse.png"><br><br><img src="https://habrastorage.org/webt/jg/hd/w3/jghdw32jkf-d-9gxs71ca2o-q9y.png"><br><br>  Registre manualmente o nome da rede e altere o tipo de seguran√ßa.  Depois de clicar em <i>alterar as configura√ß√µes de conex√£o,</i> na se√ß√£o Seguran√ßa, selecionamos a autentica√ß√£o de rede - EAP-TTLS. <br><br><img src="https://habrastorage.org/webt/gq/tg/x6/gqtgx6svylvh5sqmxrcjmovj-10.png"><br><br><img src="https://habrastorage.org/webt/kn/7l/a8/kn7la8fhk6a2fh8vkjtwvsji1gu.png"><br><br><img src="https://habrastorage.org/webt/y1/tl/gv/y1tlgv2-xbwqn-lcupnyiwpxz3s.png"><br><br>  Entramos nos par√¢metros, prescrevemos a autentica√ß√£o de privacidade - <b>cliente</b> .  Como autoridade de certifica√ß√£o confi√°vel, selecionamos o certificado que adicionamos, marque a caixa ‚ÄúN√£o d√™ um convite ao usu√°rio se o servidor n√£o puder ser autorizado‚Äù e selecione o m√©todo de autentica√ß√£o - senha n√£o criptografada (PAP). <br><br><img src="https://habrastorage.org/webt/5x/ww/3j/5xww3jjmvmf1rhkdxcqvoxh0l18.png"><br><br>  Em seguida, v√° para os par√¢metros adicionais, marque "Especificar modo de autentica√ß√£o".  Selecione o item "Autentica√ß√£o do usu√°rio" e clique em <i>Salvar credenciais</i> .  Aqui voc√™ precisar√° digitar username_ldap e password_ldap <br><br><img src="https://habrastorage.org/webt/e5/lv/xu/e5lvxualbxusv6ksq1iqwhiodyi.png"><br><br><img src="https://habrastorage.org/webt/om/he/tc/omhetcqvchjagt5mcqjo_e5hq0m.png"><br><br><img src="https://habrastorage.org/webt/2p/ni/oc/2pniocysbjtvvzgoa5yqw5ahl_g.png"><br><br>  N√≥s salvamos, aplicamos, fechamos tudo.  Voc√™ pode se conectar √† nova rede. <br><br><h3>  Linux </h3><br>  Eu testei no Ubuntu 18.04, 18.10, Fedora 29, 30. <br><br>  Para come√ßar, baixe um certificado.  N√£o encontrei no Linux se √© poss√≠vel usar certificados do sistema e se existe um armazenamento assim. <br><br>  N√≥s nos conectaremos por dom√≠nio.  Portanto, voc√™ precisa de um certificado do centro de certifica√ß√£o do qual nosso certificado foi adquirido. <br><br>  Toda a conex√£o √© feita em uma janela.  Escolha nossa rede: <br><br><img src="https://habrastorage.org/webt/_b/bv/ks/_bbvksnhgramkno1xteuugeiicu.png"><br><br>  <i>an√¥nimo - cliente</i> <i><br></i>  <i>dom√≠nio - dom√≠nio para o qual o certificado √© emitido</i> <i><br></i> <br><h3>  Android </h3><br><h4>  n√£o samsung </h4><br>  Na vers√£o 7, ao conectar o WiFi, voc√™ pode usar certificados do sistema especificando apenas o dom√≠nio: <br><br><img src="https://habrastorage.org/webt/ft/ma/cl/ftmaclvd6hgnr6l61f1ntqx4pho.png"><br><br>  <i>dom√≠nio - dom√≠nio para o qual o certificado √© emitido</i> <i><br></i>  <i>an√¥nimo - cliente</i> <i><br></i> <br><h4>  Samsung </h4><br>  Como j√° mencionado acima, os dispositivos Samsung n√£o sabem como usar certificados do sistema ao conectar o WiFi e n√£o t√™m a capacidade de se conectar por dom√≠nio.  Portanto, voc√™ deve adicionar manualmente o certificado raiz da autoridade de certifica√ß√£o (ca.pem, n√≥s o usamos no servidor Radius).  √â aqui que ele ser√° autoassinado. <br><br>  Fa√ßa o download do certificado no seu dispositivo e instale-o. <br><br><div class="spoiler">  <b class="spoiler_title">Instala√ß√£o de certificado</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/jw/vn/p6/jwvnp6k3hcvgr_-sxahbjjfwuma.png"><br><br><img src="https://habrastorage.org/webt/vw/-u/2c/vw-u2crpfqhzv2hewbw4fvcm0k8.png"><br><br><img src="https://habrastorage.org/webt/fn/n-/i6/fnn-i6gkkzzt6w9hxjpv5fgo_sk.png"><br><br><img src="https://habrastorage.org/webt/xk/pc/-2/xkpc-2wufsgnckjexjhmiv79avy.png"><br><br>  Nesse caso, ser√° necess√°rio definir o padr√£o de desbloqueio da tela, o c√≥digo PIN ou a senha, se ainda n√£o estiver instalado: <br><br><img src="https://habrastorage.org/webt/_w/aa/px/_waapxwklsloxwpvo3oe8mrdwek.png"><br><br><img src="https://habrastorage.org/webt/v6/nx/k1/v6nxk1ts6ej-j8sffb1kpqfx9ae.png"><br><br>  <i>Eu mostrei uma vers√£o complicada da instala√ß√£o do certificado.</i>  <i>Na maioria dos dispositivos, basta clicar no certificado baixado.</i> <br></div></div><br>  Quando o certificado est√° instalado, voc√™ pode prosseguir para a conex√£o: <br><br><img src="https://habrastorage.org/webt/rr/9l/vx/rr9lvx4jov8ohepj-hetehl4g1s.png"><br><br>  <i>certificado - indique o que foi instalado</i> <i><br></i>  <i>usu√°rio an√¥nimo - convidado</i> <i><br></i> <br><h3>  macOS </h3><br>  Os dispositivos Apple prontos para o uso podem se conectar apenas ao EAP-TLS, mas voc√™ ainda precisa enviar um certificado a eles.  Para especificar um m√©todo de conex√£o diferente, voc√™ precisa usar o Apple Configurator 2. Portanto, voc√™ deve primeiro fazer o download para a papoula, criar um novo perfil e adicionar todas as configura√ß√µes de WiFi necess√°rias. <br><br><div class="spoiler">  <b class="spoiler_title">Configurador da Apple</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/tg/mj/zi/tgmjzi_qpkrel011yzj5q5h23qs.png"><br><br><img src="https://habrastorage.org/webt/dw/dd/dl/dwdddlobqibczjpygjt1f-cnbp8.png"><br><br>  <i>Aqui indicamos o nome da sua rede</i> <i><br></i>  <i>Tipo de seguran√ßa - WPA2 Enterprise</i> <i><br></i>  <i>Tipos de EAP aceitos - TTLS</i> <i><br></i>  <i>Nome de usu√°rio e senha - deixe em branco</i> <i><br></i>  <i>Autentica√ß√£o interna - PAP</i> <i><br></i>  <i>Identidade externa - cliente</i> <i><br></i> <br><br>  <i>Guia Confiar.</i>  <i>Aqui indicamos nosso dom√≠nio</i> <br><br>  S√≥ isso.  Um perfil pode ser salvo, assinado e distribu√≠do para dispositivos <br></div></div><br>  Depois que o perfil estiver pronto, ele precisar√° ser baixado na papoula e instalado.  Durante o processo de instala√ß√£o, voc√™ precisar√° especificar o usu√°rio usernmae_ldap e password_ldap: <br><br><img src="https://habrastorage.org/webt/_z/um/7m/_zum7mpbqlszgaq5d9cm6k7-why.png"><br><br><img src="https://habrastorage.org/webt/hb/iq/ig/hbiqigx3cy7zdklsbnx22zmb0e4.png"><br><br><img src="https://habrastorage.org/webt/u4/tb/-8/u4tb-8v3jbt9t5gs9zz9tplbnt0.png"><br><br><h3>  iOS </h3><br>  O processo √© semelhante ao macOS.  Voc√™ precisa usar um perfil (voc√™ pode fazer o mesmo que no macOS. Como criar um perfil no Apple Configurator, veja acima). <br><br>  Fa√ßa o download do perfil, instale, insira as credenciais, conecte: <br><br><img src="https://habrastorage.org/webt/pi/gx/3m/pigx3mjskrdwyuk07xs0m6zh-v4.png"><br><br><img src="https://habrastorage.org/webt/y9/hk/6g/y9hk6gm7k5jkdrvms-stzkdmu9s.png"><br><br><img src="https://habrastorage.org/webt/ie/xt/a-/iexta-krrvub6rrozdvmk7adh_s.png"><br><br><img src="https://habrastorage.org/webt/ej/oo/wj/ejoowjqmtjojl31jmau1z3np7mi.png"><br><br><img src="https://habrastorage.org/webt/pw/s4/en/pws4enrdkqc97p009eglr3wpiy0.png"><br><br><img src="https://habrastorage.org/webt/zj/z_/5f/zjz_5f7hqthgj52z_nnigigrcm4.png"><br><br>  S√≥ isso.  Montamos um servidor Radius, sincronizamos com o FreeIPA e pedimos aos pontos de acesso da Ubiquiti para usar o WPA2-EAP. <br><br><h2>  Poss√≠veis perguntas </h2><br>  <b>P:</b> como transferir perfil / certificado para funcion√°rio? <br><br>  <b>R:</b> Todos os certificados / perfis que eu armazeno no ftp com acesso via web.  Gerou uma rede de convidados com limite de velocidade e acesso √† Internet apenas, exceto para ftp. <br>  A autentica√ß√£o dura 2 dias, ap√≥s os quais √© redefinida e o cliente fica sem a Internet.  T.O.  quando um funcion√°rio deseja se conectar ao Wi-Fi, ele primeiro se conecta √† rede de convidados, visita o FTP, baixa o certificado ou o perfil de que precisa, instala-os e pode se conectar √† rede corporativa. <br><br>  <b>P:</b> por que n√£o usar um esquema com o MSCHAPv2?  ela √© mais segura! <br><br>  <b>R: em</b> primeiro lugar, esse esquema funciona bem no NPS (Windows Network Policy System); em nossa implementa√ß√£o, precisamos configurar adicionalmente o LDAP (FreeIpa) e armazenar hashes de senha no servidor.  Adicionar.  configura√ß√µes n√£o s√£o aconselh√°veis, porque  isso pode levar a v√°rios problemas de sincroniza√ß√£o do ultrassom.  Em segundo lugar, o hash √© MD4, portanto, isso n√£o aumenta realmente a seguran√ßa. <br><br>  <b>P: √©</b> poss√≠vel autorizar dispositivos por endere√ßos MAC? <br><br>  <b>R:</b> N√ÉO, isso n√£o √© seguro, um invasor pode falsificar endere√ßos de papoula e, al√©m disso, a autoriza√ß√£o para endere√ßos de papoula n√£o √© suportada em muitos dispositivos <br><br>  <b>P:</b> por que usar todos esses certificados?  voc√™ pode se conectar sem eles <br><br>  <b>R:</b> Certificados s√£o usados ‚Äã‚Äãpara autorizar o servidor.  I.e.  o dispositivo, quando conectado, verifica se √© ou n√£o confi√°vel o servidor.  Se um, a autentica√ß√£o vai al√©m; caso contr√°rio, a conex√£o √© fechada.  Voc√™ pode se conectar sem certificados, mas se um invasor ou um vizinho pegar um servidor radius e um ponto de acesso com o mesmo nome que o nosso, ele poder√° interceptar facilmente as credenciais do usu√°rio (n√£o esque√ßa que elas s√£o transmitidas em texto n√£o criptografado).  E quando o certificado √© usado, o inimigo ver√° em nossos registros apenas nosso Nome de Usu√°rio fict√≠cio - h√≥spede ou cliente e um erro do tipo - Certificado CA Desconhecido <br><br><div class="spoiler">  <b class="spoiler_title">mais sobre o macOS</b> <div class="spoiler_text">  Normalmente, no macOS, a reinstala√ß√£o do sistema √© feita pela Internet.  No modo de recupera√ß√£o, a papoila deve estar conectada ao WiFi, e nem o nosso WiFi corporativo nem a rede de convidados funcionar√£o aqui.  Pessoalmente, peguei outra rede, a usual WPA2-PSK, oculta, apenas para opera√ß√µes t√©cnicas.  Ou ent√£o, voc√™ pode criar uma unidade flash USB inicializ√°vel com o sistema com anteced√™ncia.  Mas se a papoula depois de 2015, voc√™ ainda precisar√° encontrar um adaptador para esta unidade flash) <br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt463225/">https://habr.com/ru/post/pt463225/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt463207/index.html">Desenvolvimento Chatbot (telegrama + youtube)</a></li>
<li><a href="../pt463213/index.html">Conceitos errados para desenvolvedores iniciantes em C #. Tentando responder a perguntas padr√£o</a></li>
<li><a href="../pt463215/index.html">Engenheiros e arquitetos j√° est√£o projetando assentamentos lunares</a></li>
<li><a href="../pt463221/index.html">Watching the Sun: 5 tipos de gadgets, de US $ 5 a US $ 5.000</a></li>
<li><a href="../pt463223/index.html">O resumo de materiais interessantes para o desenvolvedor m√≥vel n¬∫ 310 (de 5 a 11 de agosto)</a></li>
<li><a href="../pt463227/index.html">Solu√ß√£o de problemas com pwnable.kr 19 - desvincular. Estouro de buffer de pilha</a></li>
<li><a href="../pt463229/index.html">Jetpacks em Cultura: Cinema</a></li>
<li><a href="../pt463231/index.html">Treinamento Cisco 200-125 CCNA v3.0. Dia 14. VTP, Poda e VLAN Nativa</a></li>
<li><a href="../pt463233/index.html">Treinamento Cisco 200-125 CCNA v3.0. Dia 15. Comunica√ß√£o lenta e seguran√ßa portu√°ria</a></li>
<li><a href="../pt463237/index.html">Como tocamos m√∫sica com redes neurais v 2.0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>