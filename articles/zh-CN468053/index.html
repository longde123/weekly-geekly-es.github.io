<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏨 🏈 📹 机器学习助您一臂之力。 第一部分 🏛️ 🚀 🏳️‍🌈</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="您是否曾经寻找过公寓？ 您想增加一些机器学习并使过程更有趣吗？ 



 今天，我们将考虑应用机器学习来找到最佳单位。 
 引言 


首先，我想澄清这一刻，并解释“最佳公寓”的含义。 这是一个具有一系列不同特征的单位，例如“区域”，“区域”，“阳台数量”等。 对于这些功能，我们希望有一个特定的价格...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>机器学习助您一臂之力。 第一部分</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468053/"><p> 您是否曾经寻找过公寓？ 您想增加一些机器学习并使过程更有趣吗？ </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/af/w7/7e/afw77esq32gd2e0admnmjfby4kk.png" alt="叶卡捷琳堡的公寓"></div><a name="habracut"></a><br><p> 今天，我们将考虑应用机器学习来找到最佳单位。 </p><br><h2 id="introduction"> 引言 </h2><br><p>首先，我想澄清这一刻，并解释“最佳公寓”的含义。 这是一个具有一系列不同特征的单位，例如“区域”，“区域”，“阳台数量”等。 对于这些功能，我们希望有一个特定的价格。 看起来像一个需要几个参数并返回数字的函数。 也许还有一个黑匣子可以提供一些魔力。 </p><br><p> 但是……有一个很大的“但是”，有时您可能会遇到由于地理位置等一系列原因而被高估的公寓。 此外，城市中心还有城镇以外的地区，都享有较高的声誉。 或者...有时人们想出售他们的公寓，因为他们搬到了地球的另一个地方。 换句话说，有许多因素会影响价格。 听起来很熟悉吗？ </p><br><h2 id="little-stepaside"> 退一步 </h2><br><p> 在继续之前，请允许我进行一点抒情离题。 <br> 我住在叶卡捷琳堡（欧洲和亚洲之间的城市，这是2018年举办过世界足球锦标赛的城市之一）五年。 </p><br><p> 我爱上了这些水泥丛林。 我讨厌那个城市的冬季和公共交通。 这是一个发展中的城市，每个月都有成千上万的公寓要出售。 </p><br><p> 是的，这是一个人满为患，污染严重的城市。 同时-这是分析房地产市场的好地方。 我从互联网上收到了很多关于公寓的广告。 我将进一步使用该信息。 </p><br><p> 另外，我尝试在叶卡捷琳堡地图上形象化显示不同的报价。 是的，这是来自habracut的引人注目的照片，是在Kepler.gl上制作的 </p><br><p><img src="https://habrastorage.org/webt/af/w7/7e/afw77esq32gd2e0admnmjfby4kk.png" alt="图片"></p><br><p>  2019年7月在叶卡捷琳堡出售了超过2000套一居室公寓。 它们的价格有所不同，从不到一百万卢布到近一千四百万卢布。 </p><br><p> 这些点是指其地理位置。 地图上点的颜色表示价格，蓝色附近的价格越低，红色附近的价格越高。 您可以将其视为冷色和暖色的类比，暖色越大价格就越高。 <br> 拜托，记住那一刻，颜色越红，值越高。 相同的想法适用于蓝色，但价格最低。 </p><br><p> 现在，您对图片有了<em>大致的</em>了解，分析的时间到了。 </p><br><h3 id="goal"> 目标 </h3><br><p> 我住在叶卡捷琳堡时想要什么？ 我想找一个足够好的公寓，或者如果我们谈论ML，我想建立一个模型，该模型会给我有关购买的建议。 </p><br><p> 一方面，如果某个公寓的定价过高，则该模型应建议通过显示该公寓的预期价格来等待价格下降。 <br> 另一方面-根据市场状况，如果价格足够好-也许我应该考虑该报价。 </p><br><p> 当然，没有什么理想的，我准备接受计算中的错误。 通常，对于此类任务，请使用预测的平均误差，而我准备将误差降低到10％。 例如，如果您有2-3百万俄罗斯卢布，则可以忽略200-300,000的错误，您可以负担得起。 在我看来。 </p><br><h2 id="preparing"> 准备 </h2><br><p> 正如我之前提到的，有很多公寓，让我们仔细看看。 <br> 将熊猫作为pd导入 </p><br><pre><code class="python hljs">df = pd.read_csv(<span class="hljs-string"><span class="hljs-string">'flats.csv'</span></span>) df.shape</code> </pre> <br><p><img src="https://habrastorage.org/webt/qx/_0/qg/qx_0qgrsiuprxgsbno2ccihjdia.png" alt="图片"></p><br><p>  2310个单位住了一个月，我们可以从中提取一些有用的东西。 一般数据概述呢？ </p><br><pre> <code class="python hljs">df.describe()</code> </pre> <br><p><img src="https://habrastorage.org/webt/is/pi/tj/ispitjyk3gpg-cbkhwfwnrayloa.png" alt="图片"><br> 没有什么特别的东西-经度，纬度，单位价格（标签为“ <em>cost</em> ”）等。 是的，那一刻我使用“ <em>成本</em> ”而不是“ <em>价格</em> ”，希望不会引起误解，请一视同仁。 </p><br><h2 id="cleaning"> 清洁用品 </h2><br><p> 每个记录都有相同的含义吗？ 其中有些是像小隔间这样的有代表性的公寓，您可以在那儿工作，但不想住在那儿。 他们是狭窄的小房间，不是真正的公寓。 让我们删除它们。 </p><br><pre> <code class="python hljs">df = df[df.total_area &gt;= <span class="hljs-number"><span class="hljs-number">20</span></span>]</code> </pre> <br><p> 单位价格的预测来自经济学和相关领域中最古老的问题。 与“ ML”一词无关，人们试图根据平方米/英尺来猜测价格。 <br> 因此，我们查看这些列/标签，并尝试获取它们的分布。 </p><br><pre> <code class="python hljs">numerical_fields = [<span class="hljs-string"><span class="hljs-string">'total_area'</span></span>,<span class="hljs-string"><span class="hljs-string">'cost'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> col <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> numerical_fields: mask = ~np.isnan(df[col]) sns.distplot(df[col][mask], color=<span class="hljs-string"><span class="hljs-string">"r"</span></span>,label=col) plot.show()</code> </pre> <br><p><img src="https://habrastorage.org/webt/w2/kj/eq/w2kjeqg-gr-qzcum6hcgqnoz6eo.png" alt="图片"></p><br><p> 好吧...没有什么特别的，看起来像是正态分布。 也许我们需要更进一步？ </p><br><pre> <code class="python hljs">sns.pairplot(df[numerical_fields])</code> </pre> <br><p><img src="https://habrastorage.org/webt/df/fw/lg/dffwlggd_vemlbfl96qdw-0h3fw.png" alt="图片"></p><br><p> 糟糕...出了点问题。 清除这些字段中的异常值，然后尝试再次分析我们的数据。 </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#Remove outliers df = df[abs(df.total_area - df.total_area.mean()) &lt;= (3 * df.total_area.std())] df = df[abs(df.cost - df.cost.mean()) &lt;= (3 * df.cost.std())] #Redraw our data sns.pairplot(df[numerical_fields])</span></span></code> </pre> <br><p><img src="https://habrastorage.org/webt/uu/zp/ok/uuzpokfgmae_4d2bxqvsmp53jns.png" alt="图片"></p><br><p> 离群值已消失，现在看起来更好。 </p><br><h2 id="transformation"> 转型 </h2><br><p> 指向建造年份的标签“ year”应该转换为更有意义的东西。 让它成为建筑物的年龄，换句话说，就是一栋特定的房子是多么古老。 </p><br><pre> <code class="python hljs">df[<span class="hljs-string"><span class="hljs-string">'age'</span></span>] = <span class="hljs-number"><span class="hljs-number">2019</span></span> -df[<span class="hljs-string"><span class="hljs-string">'year'</span></span>]</code> </pre> <br><p> 让我们看一下结果。 </p><br><pre> <code class="python hljs">df.head()</code> </pre> <br><p><img src="https://habrastorage.org/webt/wq/j_/h-/wqj_h-w8jwshp3fi0ofyhhuanca.png" alt="图片"></p><br><p> 有各种各样的数据，分类的，Nan值，文本描述和一些地理信息（经度和纬度）。 让我们抛开最后一个，因为在那个阶段它们是无用的。 我们稍后会再与他们联系。 </p><br><pre> <code class="python hljs">df.drop(columns=[<span class="hljs-string"><span class="hljs-string">"lon"</span></span>,<span class="hljs-string"><span class="hljs-string">"lat"</span></span>,<span class="hljs-string"><span class="hljs-string">"description"</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><h3 id="categorical-data"> 分类数据 </h3><br><p> 通常，对于分类数据，人们使用不同类型的编码或诸如CatBoost之类的东西，它们提供了与数字变量一起使用它们的机会。 <br> 但是，我们可以使用更合理，更直观的方法吗？ 现在是时候让我们的数据更容易理解而不丢失其含义了。 </p><br><h3 id="districts"> 地区 </h3><br><p> 嗯，有二十多个可能的地区，我们可以在模型中添加20多个其他变量吗？ 当然可以，但是……应该吗？ 我们是人，我们可以比较事物，不是吗？ <br> 首先-并非每个区都等同。 在城市中心，一平方米的价格更高，离市区更远-价格下降。 听起来合乎逻辑吗？ 我们可以使用吗？ <br> 是的，我们绝对可以匹配具有特定系数的任何地区，而其他地区则是较便宜的公寓。 </p><br><p> 匹配城市并使用另一个Web服务地图（ArcGIS Online）后，其视图已更改，并且具有相似的视图 <br><img src="https://habrastorage.org/webt/ji/a6/sw/jia6swan_kxipvxp4y2p1ycfqk4.png" alt="图片"></p><br><p> 我使用了与Flat可视化相同的想法。 最“有名望”和“最昂贵”的地区以红色和最少的颜色-蓝色。 色温，您还记得吗？ <br> 另外，我们应该对数据框进行一些操作。 </p><br><pre> <code class="python hljs">district_map = {<span class="hljs-string"><span class="hljs-string">'alpha'</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'beta'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, ... <span class="hljs-string"><span class="hljs-string">'delta'</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>, ... <span class="hljs-string"><span class="hljs-string">'epsilon'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} df.district = df.district.str.lower() df.replace({<span class="hljs-string"><span class="hljs-string">"district"</span></span>: district_map}, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p> 相同的方法将用于描述公寓的内部质量。 有时它需要一些修理，有时平坦则可以居住。 在其他情况下，您应该花更多的钱使它看起来更好（更换水龙头，粉刷墙壁）。 也可能有使用系数。 </p><br><pre> <code class="python hljs">repair = {<span class="hljs-string"><span class="hljs-string">'A'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'B'</span></span>: <span class="hljs-number"><span class="hljs-number">0.6</span></span>, <span class="hljs-string"><span class="hljs-string">'C'</span></span>: <span class="hljs-number"><span class="hljs-number">0.7</span></span>, <span class="hljs-string"><span class="hljs-string">'D'</span></span>: <span class="hljs-number"><span class="hljs-number">0.8</span></span>} df.repair.fillna(<span class="hljs-string"><span class="hljs-string">'D'</span></span>, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) df.replace({<span class="hljs-string"><span class="hljs-string">"repair"</span></span>: repair}, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p> 顺便说一下，关于墙壁。 当然，它也会影响公寓的价格。 现代材料比旧材料好，砖比混凝土好。 木质墙是一个颇具争议的时刻，也许它是乡村的好选择，但对城市生活却不是那么好。 </p><br><p> 我们使用与以前相同的方法，并对不知道的行提出建议。 是的，有时人们不会提供有关其公寓的所有信息。 此外，根据历史，我们可以尝试猜测墙壁的材质。 在特定的时间段内（例如赫鲁晓夫的领导时期）-我们了解典型的建筑材料。 </p><br><pre> <code class="python hljs">walls_map = {<span class="hljs-string"><span class="hljs-string">'brick'</span></span>: <span class="hljs-number"><span class="hljs-number">1.0</span></span>, ... <span class="hljs-string"><span class="hljs-string">'concrete'</span></span>: <span class="hljs-number"><span class="hljs-number">0.8</span></span>, <span class="hljs-string"><span class="hljs-string">'block'</span></span>: <span class="hljs-number"><span class="hljs-number">0.8</span></span>, ... <span class="hljs-string"><span class="hljs-string">'monolith'</span></span>: <span class="hljs-number"><span class="hljs-number">0.9</span></span>, <span class="hljs-string"><span class="hljs-string">'wood'</span></span>: <span class="hljs-number"><span class="hljs-number">0.4</span></span>} mask = df[df[<span class="hljs-string"><span class="hljs-string">'walls'</span></span>].isna()][df.year &gt;= <span class="hljs-number"><span class="hljs-number">2010</span></span>].index df.loc[mask, <span class="hljs-string"><span class="hljs-string">'walls'</span></span>] = <span class="hljs-string"><span class="hljs-string">'monolith'</span></span> mask = df[df[<span class="hljs-string"><span class="hljs-string">'walls'</span></span>].isna()][df.year &gt;= <span class="hljs-number"><span class="hljs-number">2000</span></span>].index df.loc[mask, <span class="hljs-string"><span class="hljs-string">'walls'</span></span>] = <span class="hljs-string"><span class="hljs-string">'concrete'</span></span> mask = df[df[<span class="hljs-string"><span class="hljs-string">'walls'</span></span>].isna()][df.year &gt;= <span class="hljs-number"><span class="hljs-number">1990</span></span>].index df.loc[mask, <span class="hljs-string"><span class="hljs-string">'walls'</span></span>] = <span class="hljs-string"><span class="hljs-string">'block'</span></span> mask = df[df[<span class="hljs-string"><span class="hljs-string">'walls'</span></span>].isna()].index df.loc[mask, <span class="hljs-string"><span class="hljs-string">'walls'</span></span>] = <span class="hljs-string"><span class="hljs-string">'block'</span></span> df.replace({<span class="hljs-string"><span class="hljs-string">"walls"</span></span>: walls_map}, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) df.drop(columns=[<span class="hljs-string"><span class="hljs-string">'year'</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p> 此外，还有有关阳台的信息。 以我的拙见-阳台是一件非常有用的东西，所以我忍不住考虑。 <br> 不幸的是，有一些空值。 如果广告的作者检查了有关该广告的信息，我们将获得更现实的信息。 <br> 好吧，如果没有信息，它将意味着“没有阳台”。 </p><br><pre> <code class="python hljs">df.balcony.fillna(<span class="hljs-number"><span class="hljs-number">0</span></span>,inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p> 在那之后，我们删除带有有关建造年份信息的列（我们有一个很好的替代方法）。 另外，我们删除包含建筑物类型信息的列，因为它具有很多NaN值，而且我没有找到任何机会来填补这些空白。 然后，我们使用NaN删除所有行。 </p><br><pre> <code class="python hljs">df.drop(columns=[<span class="hljs-string"><span class="hljs-string">'type_house'</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) df = df.astype(np.float64) df.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><h2 id="checking"> 检查中 </h2><br><p> 所以...我们使用了一种非标准的方法，将分类值替换为其数值表示形式。 现在，我们完成了数据转换。 <br> 删除了一部分数据，但总的来说，它是一个很好的数据集。 让我们看一下自变量之间的相关性。 </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show_correlation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(df)</span></span></span><span class="hljs-function">:</span></span> sns.set(style=<span class="hljs-string"><span class="hljs-string">"whitegrid"</span></span>) corr = df.corr() * <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-comment"><span class="hljs-comment"># Select upper triangle of correlation matrix mask = np.zeros_like(corr, dtype=np.bool) mask[np.triu_indices_from(mask)] = True # Set up the matplotlib figure f, ax = plt.subplots(figsize=(15, 11)) # Generate a custom diverging colormap cmap = sns.diverging_palette(220, 10) # Draw the heatmap with the mask and correct aspect ratio sns.heatmap(corr, mask=mask, cmap=cmap, center=0, linewidths=1, cbar_kws={"shrink": .7}, annot=True, fmt=".2f") plot.show() # df[columns] = scale(df[columns]) return df df1 = show_correlation(df.drop(columns=['cost']))</span></span></code> </pre> <br><p><img src="https://habrastorage.org/webt/ht/dv/ir/htdvirxheiytace3nmaujf3wet8.png" alt="图片"></p><br><p> 嗯...这变得非常有趣。 <br>  <strong>正相关</strong> <br>  <em>阳台总面积</em> 。 为什么不呢 如果我们的公寓很大，将会有一个阳台。 <br>  <strong>负相关</strong> <br>  <em>总面积年龄</em> 。 较新的公寓，居住面积更大。 听起来合乎逻辑，新的比旧的更宽敞。 <br>  <em>年龄阳台</em> 。 越平的阳台越少。 好像是通过另一个变量的关联。 也许这是一个三角形的Age-Balcony-Area，其中一个变量对另一个变量具有隐式影响。 搁置一段时间。 <br>  <em>年龄-地区。</em> 较老的公寓将被安置在享有较高声誉的地区。 可能与中心附近的较高价格有关吗？ </p><br><p> 此外，我们可以看到与因变量的相关性 </p><br><pre> <code class="python hljs">plt.figure(figsize=(<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>)) corr = df.corr()*<span class="hljs-number"><span class="hljs-number">100.0</span></span> sns.heatmap(corr[[<span class="hljs-string"><span class="hljs-string">'cost'</span></span>]], cmap= sns.diverging_palette(<span class="hljs-number"><span class="hljs-number">220</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), center=<span class="hljs-number"><span class="hljs-number">0</span></span>, linewidths=<span class="hljs-number"><span class="hljs-number">1</span></span>, cbar_kws={<span class="hljs-string"><span class="hljs-string">"shrink"</span></span>: <span class="hljs-number"><span class="hljs-number">.7</span></span>}, annot=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, fmt=<span class="hljs-string"><span class="hljs-string">".2f"</span></span>)</code> </pre> <br><p><img src="https://habrastorage.org/webt/o7/ax/m1/o7axm1zph-x3eterypsfcod38zo.png" alt="图片"></p><br><p> 我们开始... </p><br><p> 单位面积与价格之间有很强的相关性。 如果您想拥有更大的居住空间，将需要更多的钱。 <br>  “ <em>年龄/成本</em> ”和“ <em>地区/成本</em> ”对之间存在负相关。 新房中的公寓比旧房便宜。 在农村，公寓便宜。 <br> 无论如何，这似乎很清楚而且可以理解，所以我决定使用它。 </p><br><h2 id="model"> 型号 </h2><br><p> 对于通常与预测单位价格有关的任务，请使用线性回归。 根据前一阶段的显着相关性，我们也可以尝试使用它。 它是适合许多任务的主力。 <br> 准备我们的数据以备后用 </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.model_selection <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> train_test_split y = df.cost X = df.drop(columns=[<span class="hljs-string"><span class="hljs-string">'cost'</span></span>]) X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=<span class="hljs-number"><span class="hljs-number">0.2</span></span>, random_state=<span class="hljs-number"><span class="hljs-number">42</span></span>)</code> </pre> <br><p> 此外，我们创建了一些简单的函数来预测和评估结果。 让我们先尝试预测价格！ </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">predict</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X, y_test, model)</span></span></span><span class="hljs-function">:</span></span> y = model.predict(X) score = round((r2_score(y_test, y) * <span class="hljs-number"><span class="hljs-number">100</span></span>), <span class="hljs-number"><span class="hljs-number">2</span></span>) print(<span class="hljs-string"><span class="hljs-string">f'Score on </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{model.__class__.__name__}</span></span></span><span class="hljs-string"> is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{score}</span></span></span><span class="hljs-string">'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> score <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">train_model</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X, y, regressor)</span></span></span><span class="hljs-function">:</span></span> model = regressor.fit(X, y) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> model</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.linear_model <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> LinearRegression regressor = LinearRegression() model = train_model(X_train, y_train, regressor) predict(X_test, y_test, model)</code> </pre> <br><p><img src="https://habrastorage.org/webt/ak/v3/_a/akv3_antf7wwaxndcpjwx90rvju.png" alt="图片"></p><br><p> 好吧……准确度为76.67％。 是不是很大？ 根据我的观点，这还不错。 此外，这是一个很好的起点。 当然，这不是理想的，并且有改进的潜力。 </p><br><p> 同时-我们试图仅预测数据的一部分。 将相同的策略应用于其他数据该怎么办？ 是的，需要进行交叉验证的时间。 </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_cross_validation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X, y, model)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.model_selection <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> KFold, cross_val_score regressor_name = model.__class__.__name__ fold = KFold(n_splits=<span class="hljs-number"><span class="hljs-number">10</span></span>, shuffle=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, random_state=<span class="hljs-number"><span class="hljs-number">0</span></span>) scores_on_this_split = cross_val_score(estimator=model, X=X, y=y, cv=fold, scoring=<span class="hljs-string"><span class="hljs-string">'r2'</span></span>) scores_on_this_split = np.round(scores_on_this_split * <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) mean_accuracy = scores_on_this_split.mean() print(<span class="hljs-string"><span class="hljs-string">f'Crossvaladaion accuracy on </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{model.__class__.__name__}</span></span></span><span class="hljs-string"> is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{mean_accuracy}</span></span></span><span class="hljs-string">'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mean_accuracy do_cross_validation(X, y, model)</code> </pre> <br><p><img src="https://habrastorage.org/webt/yn/uf/3y/ynuf3yr9ew4kgjrvnb-nifevbnq.png" alt="图片"></p><br><p> 交叉验证的结果现在我们得到另一个结果。  73小于76。但是，直到我们拥有一个更好的候选人之前，它也是一个不错的候选人。 同样，这意味着线性回归在我们的数据集上非常稳定。 </p><br><p> 现在是最后一步的时候了。 </p><br><p> 我们将研究线性回归的最佳特征。 <br> 与更复杂的模型相反，该模型家族具有更好的理解能力。 只有一些带有系数的数字，您可以将您的数字放在等式中，进行一些简单的数学运算并得出结果。 </p><br><p> 让我们尝试解释我们的模型 </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">estimate_model</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(model)</span></span></span><span class="hljs-function">:</span></span> sns.set(style=<span class="hljs-string"><span class="hljs-string">"white"</span></span>, context=<span class="hljs-string"><span class="hljs-string">"talk"</span></span>) f, ax = plot.subplots(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, figsize=(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), sharex=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) sns.barplot(x=model.coef_, y=X.columns, palette=<span class="hljs-string"><span class="hljs-string">"vlag"</span></span>, ax=ax) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(model.coef_.astype(int)): ax.text(v + <span class="hljs-number"><span class="hljs-number">3</span></span>, i + <span class="hljs-number"><span class="hljs-number">.25</span></span>, str(v), color=<span class="hljs-string"><span class="hljs-string">'black'</span></span>) ax.set_title(<span class="hljs-string"><span class="hljs-string">f"Coefficients"</span></span>) estimate_model(regressor)</code> </pre> <br><p><img src="https://habrastorage.org/webt/1j/bc/_a/1jbc_apacascsr3cakmwz4qbnu8.png" alt="我们模型的系数"></p><br><p> 图片看起来很合逻辑。  <em>阳台/墙壁/面积/维修</em>可为固定价格做出<strong>积极</strong>贡献。 <br> 距离越远， <strong>负贡献</strong>越大。 也适用于年龄。 单位越大，价格越低。 </p><br><p> 因此，这是一次迷人的旅程。 <br> 我们从头开始，基于人类的观点（数字代替虚拟变量），检查的变量及其相互关系，使用非典型的方法进行数据转换。 之后，我们建立了简单的模型，并使用交叉验证对其进行了测试。 就像蛋糕上的樱桃一样-看一下模型的内部结构，这使我们对自己的方式充满信心。 </p><br><p> 但是！ 这不是旅程的终点​​，只是休息。 将来，我们将尝试更改模型，也许（只是也许）它会提高预测的准确性。 </p><br><p>  <strong>感谢您的阅读！</strong> </p><br><blockquote> 第二部分在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">那里</a> <br></blockquote><p>  PS源数据和Ipython笔记本位于<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN468053/">https://habr.com/ru/post/zh-CN468053/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN468035/index.html">使用游戏控制器下载印刷机，或输入设备获得8项非常规专利</a></li>
<li><a href="../zh-CN468039/index.html">莫斯科Kubernetes聚会＃6在Acronis（Fiztehpark）10/03/2019</a></li>
<li><a href="../zh-CN468041/index.html">Kubernetes Web View Web界面的公告（以及Kubernetes其他Web UI的简要概述）</a></li>
<li><a href="../zh-CN468043/index.html">如何创建要出售的UI套件。 开发商业设计系统的阶段</a></li>
<li><a href="../zh-CN468047/index.html">在lsFusion中使用层次结构</a></li>
<li><a href="../zh-CN468057/index.html">类似于Unix的OS开发-多任务处理和系统调用（7）</a></li>
<li><a href="../zh-CN468059/index.html">我与Hai句的第二个星期：很多隐藏的钻石和令人惊喜的惊喜，以及一些问题</a></li>
<li><a href="../zh-CN468061/index.html">Linux上的Cron：历史记录，用法和设备</a></li>
<li><a href="../zh-CN468063/index.html">角效应</a></li>
<li><a href="../zh-CN468065/index.html">面向所有人的心理产品管理模型</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>