<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßôüèº üèÇüèª üë®üèø‚Äçü§ù‚Äçüë®üèª Nuevas tarjetas CUBA ü¶ë üåñ ü§òüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Trabajar con datos geoespaciales y mapas cartogr√°ficos son partes integrales de muchas aplicaciones comerciales. Pueden ser sistemas de informaci√≥n mu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nuevas tarjetas CUBA</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/464517/"><p><img src="https://habrastorage.org/getpro/habr/post_images/2b4/8ca/a70/2b48caa7053d14a2edd9cfaecc6b6fb8.png" alt="mapas"></p><br><p>  Trabajar con datos geoespaciales y mapas cartogr√°ficos son partes integrales de muchas aplicaciones comerciales.  Pueden ser sistemas de informaci√≥n municipales y regionales, aplicaciones para la industria del petr√≥leo y el gas, sistemas de gesti√≥n de infraestructura de transporte, as√≠ como servicios de entrega y muchos otros.  En nuestra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Plataforma CUBA,</a> para construir tales aplicaciones, adem√°s de las caracter√≠sticas b√°sicas provistas de f√°brica, hay un conjunto bastante extenso de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">complementos y componentes</a> .  Uno de ellos es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Gr√°ficos y mapas</a> , que, adem√°s de mostrar gr√°ficos, le permite integrar mapas de Google en la parte visual de la aplicaci√≥n.  El a√±o pasado, Google actualiz√≥ los t√©rminos de uso de sus servicios de mapas, lo que llev√≥ a un aumento en el costo, y tambi√©n introdujo la condici√≥n para la presencia obligatoria de un perfil de pago para usar la API.  Estas circunstancias llevaron a la mayor√≠a de nuestros clientes a pensar en proveedores de tarjetas alternativos, y se nos solicit√≥ desarrollar un nuevo componente de tarjeta. </p><a name="habracut"></a><br><p>  Ahora nos complace presentar un componente completamente nuevo: <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CUBA Maps</a></strong> .  CUBA Maps complementa la funcionalidad de la aplicaci√≥n con una representaci√≥n visual y herramientas intuitivas para editar datos geoespaciales.  El componente funciona con datos r√°ster y vectoriales.  Puede usar cualquier proveedor de mapas compatible con el protocolo del Servicio de mapas web o proporcionar mosaicos en formato XYZ como datos r√°ster.  Para trabajar con datos vectoriales, el componente utiliza tipos de datos geom√©tricos (punto, polil√≠nea, pol√≠gono) de la biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">JTS Topology Suite (JTS)</a> , la biblioteca Java m√°s popular para trabajar con datos geoespaciales.  El componente proporciona todas las herramientas necesarias para crear un sistema integral de informaci√≥n geogr√°fica basado en CUBA. </p><br><p>  En este art√≠culo, hablaremos sobre las nuevas caracter√≠sticas que ofrece el componente Mapas y tambi√©n lo compararemos con nuestro componente de mapa anterior. </p><br><h2 id="struktura-osnovannaya-na-sloyah">  Estructura basada en capas </h2><br><p>  El componente admite la estructura multicapa tradicional que se usa ampliamente en los sistemas profesionales de informaci√≥n geogr√°fica.  Las capas se dividen principalmente en r√°ster y vector.  <em>Las capas r√°ster</em> consisten en im√°genes r√°ster, mientras <em>que las capas</em> vectoriales contienen geometr√≠as vectoriales. </p><br><p>  El componente admite los siguientes tipos de capas: </p><br><ul><li>  <em>La capa de</em> mosaico muestra los mosaicos proporcionados por los servicios de mosaico en formato XYZ. </li><li>  <em>La capa del Servicio de mapas web (WMS)</em> muestra las im√°genes proporcionadas por los servicios WMS. </li><li>  <em>La capa vectorial</em> contiene geoobjetos (entidades con atributos geom√©tricos). </li></ul><br><p>  Estas capas son elementos estructurales de los mapas.  Por ejemplo, la capa inferior puede ser un mapa base que consta de mosaicos, la segunda capa puede contener pol√≠gonos que describen unidades territoriales, por ejemplo, regiones, y la capa superior puede contener puntos geogr√°ficos (ubicaci√≥n de clientes, tiendas, etc.).  Superponiendo estas capas una encima de la otra, obtenemos el mapa final: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b16/3b2/5f7/b163b25f702af4f76363340b899139b4.png" alt="capas"></p><br><p>  Gracias a este enfoque, puede crear mapas claramente estructurados con cualquier contenido. </p><br><p> CUBA Maps proporciona un nuevo componente visual: <code>GeoMap</code> .  En el descriptor XML del componente, puede establecer los par√°metros b√°sicos del mapa, as√≠ como un conjunto de capas mostradas.  Un ejemplo de tal configuraci√≥n: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"600px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">center</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"37.615, 55.752"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">zoom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">selectedLayer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:tile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tiles"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tileProvider</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"maps_OpenStreetMap"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"territoryLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"territoryDc"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressDc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">editable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Este enfoque le permite lograr una mayor flexibilidad que faltaba en <strong>Gr√°ficos y Mapas</strong> : </p><br><ul><li>  <em>Capas.</em>  Esta estructura le permite crear tarjetas con cualquier contenido, por ejemplo, combinar mosaicos proporcionados por varios servicios. </li><li>  <em>Las capas proporcionan una abstracci√≥n que re√∫ne objetos homog√©neos.</em>  En el componente <strong>Gr√°ficos y mapas</strong> , todos los contenidos del mapa (por ejemplo, puntos, pol√≠gonos, etc.) se volcaron en un mont√≥n com√∫n en el componente UI.  Para estructurar de alguna manera estos objetos, los equipos del proyecto tuvieron que escribir l√≥gica adicional. </li><li>  <em>Un m√©todo declarativo para describir capas.</em>  Como se muestra en el ejemplo anterior, puede especificar completamente la estructura del mapa (conjunto de capas) en el descriptor XML.  En muchos casos, esto es suficiente para no implementar ninguna l√≥gica adicional en el controlador de pantalla.  Usando <strong>Gr√°ficos y Mapas</strong> era casi imposible hacerlo sin escribir l√≥gica adicional. </li></ul><br><p>  El uso de capas de mosaico o WMS le permite trabajar con cualquier proveedor de mapas preferido.  No est√° vinculado a un proveedor espec√≠fico, como estaba en <strong>Gr√°ficos y Mapas</strong> . </p><br><p>  Las capas vectoriales simplifican enormemente la visualizaci√≥n, la edici√≥n interactiva y el dibujo de geoobjetos en el mapa. </p><br><p>  Tambi√©n vale la pena se√±alar que el componente visual de <code>GeoMap</code> por defecto tiene una capa auxiliar especial: <strong>Canvas</strong> .  Canvas proporciona una API conveniente para mostrar y dibujar geometr√≠as (puntos, polil√≠neas, pol√≠gonos) en un mapa.  Cubriremos ejemplos de uso de Canvas m√°s adelante en el art√≠culo. </p><br><h2 id="geo-obekty">  Geo objetos </h2><br><p>  Supongamos que tenemos una entidad que contiene un atributo asociado con la geometr√≠a (punto, polil√≠nea, pol√≠gono).  Llamaremos a esta entidad un <em>geoobjeto</em> .  Entonces, el componente simplifica enormemente el trabajo con geoobjetos. </p><br><p>  Por ejemplo, considere la <strong>direcci√≥n del</strong> objeto geogr√°fico: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StandardEntity</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"LOCATION"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Geometry</span></span> <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(datatype = <span class="hljs-string"><span class="hljs-string">"GeoPoint"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Convert</span></span>(converter = CubaPointWKTConverter.class) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Point location; ... }</code> </pre> <br><p>  Tiene un atributo de <code>location</code> de tipo <code>org.locationtech.jts.geom.Point</code> de la biblioteca JTS Topology Suite (JTS).  El componente admite los siguientes tipos geom√©tricos de JTS: </p><br><ul><li>  <code>org.locationtech.jts.geom.Point</code> : punto. </li><li>  <code>org.locationtech.jts.geom.LineString</code> - polil√≠nea. </li><li>  <code>org.locationtech.jts.geom.Polygon</code> - pol√≠gono. </li></ul><br><p>  El atributo de <code>location</code> est√° etiquetado con la anotaci√≥n <code>@Geometry</code> .  Esta anotaci√≥n anuncia que el valor de este atributo debe usarse al mostrar un geoobjeto en el mapa.  El atributo tambi√©n est√° marcado con las siguientes anotaciones: </p><br><ul><li>  <code>@MetaProperty</code> : en este caso, se utiliza para indicar el atributo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tipo de datos</a> .  El marco CUBA utiliza la interfaz <code>Datatype</code> para convertir valores hacia y desde una cadena. </li><li>  <code>@Convert</code> : define un convertidor JPA para un atributo persistente.  El convertidor JPA convierte los valores de atributo entre sus representaciones en la base de datos y el c√≥digo Java.  El componente proporciona un conjunto de tipos de datos espaciales y convertidores JPA.  Hay m√°s informaci√≥n disponible en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n del</a> componente.  Tambi√©n puede usar su propia implementaci√≥n del convertidor JPA, que le permite trabajar con varias fuentes de datos espaciales (por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PostGIS</a> ). </li></ul><br><p>  Por lo tanto, para convertir una entidad en un geoobjeto, debe definir un atributo del tipo de geometr√≠a JTS y anotarlo con <code>@Geometry</code> .  Hay otra opci√≥n: crear un atributo no persistente proporcionando m√©todos getter / setter.  Esto puede ser √∫til si no desea realizar cambios en el modelo de datos y regenerar los scripts DDL. </p><br><p>  Por ejemplo, considere la <strong>direcci√≥n de</strong> la entidad con atributos separados para latitud y longitud: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.haulmont.addon.maps.gis.utils.GeometryUtils; ... <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StandardEntity</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"LATITUDE"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Double latitude; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"LONGITUDE"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Double longitude; ... <span class="hljs-meta"><span class="hljs-meta">@Geometry</span></span> <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(datatype = <span class="hljs-string"><span class="hljs-string">"GeoPoint"</span></span>, related = {<span class="hljs-string"><span class="hljs-string">"latitude"</span></span>, <span class="hljs-string"><span class="hljs-string">"longitude"</span></span>}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Point </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getLatitude() == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || getLongitude() == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GeometryUtils.createPoint(getLongitude(), getLatitude()); } <span class="hljs-meta"><span class="hljs-meta">@Geometry</span></span> <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(datatype = <span class="hljs-string"><span class="hljs-string">"GeoPoint"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Point point)</span></span></span><span class="hljs-function"> </span></span>{ Point prevValue = getLocation(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (point == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { setLatitude(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); setLongitude(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { setLatitude(point.getY()); setLongitude(point.getX()); } propertyChanged(<span class="hljs-string"><span class="hljs-string">"location"</span></span>, prevValue, point); } ... }</code> </pre> <br><p>  Si decide utilizar este enfoque, aseg√∫rese de que se llame al m√©todo <code>propertyChanged</code> en el setter, ya que el componente responde a este evento actualizando la geometr√≠a en el mapa. </p><br><p>  Ahora que hemos preparado la clase de nuestro geoobjeto, podemos agregar instancias de esta clase a la capa vectorial.  <em>Una capa vectorial</em> es esencialmente un elemento de conexi√≥n entre datos (geoobjetos) y un mapa.  Para conectar objetos geogr√°ficos con una capa, debe transferir el contenedor de datos o, en el caso de pantallas obsoletas (hasta la versi√≥n 7 de CUBA), fuente de datos a la capa vectorial.  Esto se puede hacer en un descriptor XML: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressesLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressesDc"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Como resultado, las instancias de la clase <code>Address</code> contenidas en el contenedor AddressDc se mostrar√°n en el mapa. </p><br><p>  Consideremos una tarea elemental: crear una pantalla para editar un geoobjeto con un mapa, donde puede editar la geometr√≠a del objeto.  Para resolver el problema, debe declarar el componente visual de <code>GeoMap</code> en el descriptor XML de la pantalla de edici√≥n y agregar una capa vectorial asociada con el contenedor que contiene el geoobjeto editado: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"600px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">center</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"37.615, 55.752"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">zoom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">selectedLayer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:tile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span><span class="hljs-tag">"/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressDc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">editable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Si marca la capa vectorial como editable, se activa la edici√≥n interactiva del geoobjeto en el mapa.  Si la geometr√≠a del objeto est√° vac√≠a, el mapa cambiar√° autom√°ticamente al modo de dibujo.  Como puede ver, para resolver el problema, es suficiente declarar una capa vectorial en el mapa y pasarle el contenedor de datos / fuente de datos. </p><br><p>  Eso es todo  Si utiliz√°ramos <strong>Gr√°ficos y Mapas</strong> para resolver el mismo problema, tendr√≠amos que escribir bastante c√≥digo en el controlador de pantalla para proporcionar una funcionalidad similar.  Con el nuevo componente de <strong>Maps,</strong> resolver estos problemas es mucho m√°s simple. </p><br><h2 id="canvas">  Lienzo </h2><br><p>  Hay momentos en los que necesita trabajar no con entidades.  En cambio, desea una API simple para agregar y dibujar geometr√≠as en un mapa, como lo fue en <strong>Gr√°ficos y Mapas</strong> .  Para esto, el componente visual <code>GeoMap</code> tiene una capa especial: <em>Canvas</em> .  Esta es una capa auxiliar, que est√° en el mapa de manera predeterminada y que proporciona una API simple para agregar y dibujar geometr√≠as en el mapa.  Puede <code>map.getCanvas()</code> mapa de <code>map.getCanvas()</code> llamando al m√©todo <code>map.getCanvas()</code> . </p><br><p>  A continuaci√≥n, veremos algunas tareas simples, c√≥mo se resolvieron en <strong>Gr√°ficos y Mapas</strong> y c√≥mo hacer lo mismo con Canvas. </p><br><h3 id="otobrazhenie-geometriy-na-karte">  Mostrar geometr√≠as en un mapa </h3><br><p>  En <strong>Gr√°ficos y mapas, los</strong> objetos de geometr√≠a se crearon usando el componente visual del mapa, se usaron como una f√°brica y luego se agregaron al mapa: </p><br><pre> <code class="java hljs">Marker marker = map.createMarker(); GeoPoint position = map.createGeoPoint(lat, lon); marker.setPosition(position); map.addMarker(marker);</code> </pre> <br><p>  El nuevo componente de <strong>Maps</strong> funciona directamente con las clases de la biblioteca JTS: </p><br><pre> <code class="java hljs">CanvasLayer canvasLayer = map.getCanvas(); Point point = address.getLocation(); canvasLayer.addPoint(point);</code> </pre> <br><h3 id="redaktirovanie-geometriy">  Edici√≥n de geometr√≠a </h3><br><p>  En <strong>Gr√°ficos y mapas,</strong> puede designar la geometr√≠a como editable.  Cuando tales geometr√≠as se cambiaron a trav√©s de la interfaz de usuario, los eventos correspondientes se llamaron: </p><br><pre> <code class="java hljs">Marker marker = map.createMarker(); GeoPoint position = map.createGeoPoint(lat, lon); marker.setPosition(position); marker.setDraggable(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); map.addMarker(marker); map.addMarkerDragListener(event -&gt; { <span class="hljs-comment"><span class="hljs-comment">// do something });</span></span></code> </pre> <br><p>  En el componente <strong>Mapas</strong> , al agregar geometr√≠a JTS a Canvas, el m√©todo correspondiente devuelve un objeto especial que es una representaci√≥n de esta geometr√≠a en el mapa: <code>CanvasLayer.Point</code> , <code>CanvasLayer.Polyline</code> o <code>CanvasLayer.Polygon</code> .  Este objeto tiene una interfaz fluida para configurar varios par√°metros de geometr√≠a, tambi√©n se puede utilizar para suscribirse a eventos relacionados con la geometr√≠a o para eliminar geometr√≠a de un lienzo. </p><br><pre> <code class="java hljs">CanvasLayer canvasLayer = map.getCanvas(); CanvasLayer.Point location = canvasLayer.addPoint(address.getLocation()); location.setEditable(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) .setPopupContent(address.getName()) .addModifiedListener(modifiedEvent -&gt; address.setLocation(modifiedEvent.getGeometry()));</code> </pre> <br><h3 id="risovanie-geometriy">  Dibujo de geometr√≠a </h3><br><p>  En los <strong>mapas y mapas</strong> complementarios anteriores hab√≠a un componente auxiliar: <code>DrawingOptions</code> .  Se utiliz√≥ para activar la capacidad de dibujar en el mapa.  Despu√©s de dibujar la geometr√≠a, se gener√≥ el evento correspondiente: </p><br><pre> <code class="java hljs">DrawingOptions options = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DrawingOptions(); PolygonOptions polygonOptions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PolygonOptions(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">"#993366"</span></span>, <span class="hljs-number"><span class="hljs-number">0.6</span></span>); ControlOptions controlOptions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ControlOptions( Position.TOP_CENTER, Arrays.asList(OverlayType.POLYGON)); options.setEnableDrawingControl(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); options.setPolygonOptions(polygonOptions); options.setDrawingControlOptions(controlOptions); options.setInitialDrawingMode(OverlayType.POLYGON); map.setDrawingOptions(options); map.addPolygonCompleteListener(event -&gt; { <span class="hljs-comment"><span class="hljs-comment">//do something });</span></span></code> </pre> <br><p>  El componente Mapas hace que lo mismo sea mucho m√°s f√°cil.  El nuevo Canvas de <strong>mapas</strong> contiene un conjunto de m√©todos para dibujar geometr√≠as.  Por ejemplo, para dibujar un pol√≠gono, use el m√©todo <code>canvas.drawPolygon()</code> .  Despu√©s de llamar a este m√©todo, el mapa cambiar√° al modo de dibujo de pol√≠gono.  El m√©todo acepta la funci√≥n <code>Consumer&lt;CanvasLayer.Polygon&gt;</code> , en la que puede realizar acciones adicionales con el pol√≠gono dibujado. </p><br><pre> <code class="java hljs">canvasLayer.drawPolygon(polygon -&gt; { territory.setPolygon(polygon.getGeometry()); });</code> </pre> <br><h2 id="instrumenty-dlya-geo-analiza">  Herramientas de geoan√°lisis </h2><br><h3 id="klasterizaciya">  Agrupaci√≥n </h3><br><p>  Otra herramienta √∫til presente en el nuevo componente de Mapas es la agrupaci√≥n de puntos.  Si la capa consta de una gran cantidad de puntos, puede habilitar la agrupaci√≥n para agrupar los puntos cercanos en grupos para que el mapa se vea m√°s ordenado y mejor percibido: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e6c/166/4d7/e6c1664d7e9092880dfcf13cc4dca58c.jpg" alt="grupo"></p><br><p>  La agrupaci√≥n en cl√∫steres se habilita agregando la etiqueta del <code>cluster</code> dentro de la etiqueta del <code>vector</code> en el descriptor XML: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"locations"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"locationsDc"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:cluster</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Tambi√©n puede habilitar la agrupaci√≥n en funci√≥n de los pesos de los puntos.  El peso del punto es el valor del atributo especificado en el par√°metro <code>weightProperty</code> . </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"orders"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ordersDc"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:cluster</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">weightProperty</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"amount"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3 id="teplovye-karty">  Mapas de calor </h3><br><p>  Los mapas de calor son una representaci√≥n visual de la densidad de datos en m√∫ltiples ubicaciones geogr√°ficas.  El componente visual de GeoMap contiene un m√©todo para agregar un mapa de calor: <code>addHeatMap(Map&lt;Point, Double&gt; intensityMap)</code> . </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/722/10b/289/72210b289dd04fcf41cc4ebec062c2d5.jpg" alt="mapa de calor"></p><br><h2 id="zaklyuchenie">  Conclusi√≥n </h2><br><p>  El procesamiento, an√°lisis y visualizaci√≥n de datos geoespaciales es un elemento esencial de muchas aplicaciones comerciales.  El componente <strong>CUBA Maps</strong> le proporcionar√° a su aplicaci√≥n CUBA todas las herramientas necesarias para implementar esta funcionalidad. </p><br><p>  Una estructura basada en capas ayuda a construir mapas con cualquier contenido.  Con las capas de mosaico / WMS, puede usar cualquier proveedor que necesite como tarjeta base.  Las capas vectoriales le permiten trabajar eficazmente con conjuntos de geoobjetos homog√©neos.  Canvas proporciona una API simple para mostrar y dibujar geometr√≠as en un mapa. </p><br><p>  El componente funciona con tipos espaciales de la biblioteca JTS, lo que lo hace compatible con muchos otros marcos (por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GeoTools</a> ) para resolver una amplia gama de tareas relacionadas con el procesamiento y an√°lisis de datos geogr√°ficos. </p><br><p>  Esperamos que disfrute el componente.  Esperando sus comentarios! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/464517/">https://habr.com/ru/post/464517/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../464503/index.html">Contrase√±a de Wi-Fi que coincida con aircrack-ng</a></li>
<li><a href="../464509/index.html">El libro "Grok Deep Learning"</a></li>
<li><a href="../464511/index.html">C√≥mo recopilar cohortes de usuarios en forma de gr√°ficos en Grafana [+ imagen acoplable con un ejemplo]</a></li>
<li><a href="../464513/index.html">Duffle: transformador de XD Design</a></li>
<li><a href="../464515/index.html">C√≥mo hacer correos electr√≥nicos y no desordenar: consejos pr√°cticos</a></li>
<li><a href="../464523/index.html">Sistemas de pago (PSP) para negocios de TI: jugamos a lo grande</a></li>
<li><a href="../464525/index.html">Su propio convertidor JSON o un poco m√°s sobre ExpressionTrees</a></li>
<li><a href="../464529/index.html">Para publicidad contextual por los nombres de los competidores ahora se puede multar con 500,000 rublos</a></li>
<li><a href="../464535/index.html">Detalles sobre el dispositivo y las funciones del scooter el√©ctrico KickScooter T60</a></li>
<li><a href="../464537/index.html">Arduino DIY Demonic Carrousel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>