<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨â€ğŸš€ âœ¡ï¸ ğŸ•¥ åŸºäºIcinga2å’ŒPuppetçš„ç›‘æ§ç³»ç»Ÿçš„è‡ªåŠ¨åŒ– ğŸ”€ ğŸ›’ ğŸ¤®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åŸºäºIcinga2å’ŒPuppetçš„ç›‘æ§ç³»ç»Ÿçš„è‡ªåŠ¨åŒ– 
 è®©æˆ‘ä»¬è°ˆè°ˆ...åŸºç¡€æ¶æ„å³ä»£ç ï¼ˆIaCï¼‰ã€‚ 
 åœ¨HabrÃ©ä¸Šæœ‰ä¸€äº›å…³äºIcinga2çš„å¾ˆå¥½çš„æ–‡ç« ï¼Œä¹Ÿæœ‰å…³äºPuppetçš„å¾ˆå¥½çš„æ–‡ç« ï¼š 

 Icinga2æ˜¯ä¸€ä¸ªç®€å•çš„é€‰æ‹© 
 æˆ‘ä»¬ä»¥æœ€ä½çš„è´¹ç”¨åœ¨icinga2ä¸Šè¿›è¡Œå¾®ç›‘æ§ 
 ä»å¤´å¼€å§‹è®¾ç½®ç°ä»£...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åŸºäºIcinga2å’ŒPuppetçš„ç›‘æ§ç³»ç»Ÿçš„è‡ªåŠ¨åŒ–</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420199/"><h1><img src="https://habrastorage.org/webt/do/po/ex/dopoexqmfbzwvbyt6vlwvvaqqus.png"> åŸºäºIcinga2å’ŒPuppetçš„ç›‘æ§ç³»ç»Ÿçš„è‡ªåŠ¨åŒ– </h1><br><h3> è®©æˆ‘ä»¬è°ˆè°ˆ...åŸºç¡€æ¶æ„å³ä»£ç ï¼ˆIaCï¼‰ã€‚ </h3><br> åœ¨HabrÃ©ä¸Šæœ‰ä¸€äº›å…³äºIcinga2çš„å¾ˆå¥½çš„æ–‡ç« ï¼Œä¹Ÿæœ‰å…³äºPuppetçš„å¾ˆå¥½çš„æ–‡ç« ï¼š <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Icinga2æ˜¯ä¸€ä¸ªç®€å•çš„é€‰æ‹©</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æˆ‘ä»¬ä»¥æœ€ä½çš„è´¹ç”¨åœ¨icinga2ä¸Šè¿›è¡Œå¾®ç›‘æ§</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»å¤´å¼€å§‹è®¾ç½®ç°ä»£PuppetæœåŠ¡å™¨</a> <br><br> ä½†æ˜¯ï¼Œè¿™ä¸¤ä¸ªæƒŠäººçš„ç³»ç»Ÿçš„è‡ªåŠ¨åŒ–å’Œé›†æˆçš„ä¸»é¢˜æ ¹æœ¬æ²¡æœ‰å…¬å¼€ã€‚ <br> åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘å°†åœ¨ä¸€ä¸ªâ€œæ´»ç€çš„â€ç¤ºä¾‹ä¸­å±•ç¤ºå¦‚ä½•å°†è¿™ä¸¤è€…ç»“åˆ <br> ç³»ç»Ÿï¼Œè¯·ä½¿ç”¨åŠŸèƒ½å¼ºå¤§çš„å·¥å…·æ¥ç›‘è§†å…·æœ‰æ‰€æœ‰å¿…è¦åŠŸèƒ½çš„åŸºç¡€æ¶æ„ã€‚ æœ¬æ–‡æ˜¯æœ‰å…³â€œå…¨éƒ¨è£…åœ¨ä¸€ä¸ªç“¶å­ä¸­â€å®‰è£…è½¯ä»¶åŒ…çš„ä¸€ç§æ“ä½œæŒ‡å—ã€‚ å®Œæˆæœ¬æŒ‡å—åï¼Œæ‚¨å°†è·å¾—å®Œæ•´çš„è¿è¡Œç›‘æ§è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥è‡ªå·±è¿›ä¸€æ­¥â€œå®Œæˆâ€ã€‚ è¯•è¯•å§ï¼ <br><a name="habracut"></a><br><h1> å› æ­¤ï¼š </h1><br><h2> æˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªæ–°ä¸»äººã€‚ æˆ‘ä»¬éœ€è¦ï¼š </h2><br><h2>  1.ä½¿å…¶ç›‘è§†è‡ªåŠ¨å‡ºç°åœ¨Icinga2ä¸­ï¼Œå¹¶åˆ›å»ºåŸºæœ¬æ£€æŸ¥ï¼š </h2><br><table><tbody><tr><td>  <font color="#337788"><b>æ”¯ç¥¨</b></font> <br></td><td>  <font color="#337788"><b>å¿«ç…§</b></font> <br></td><td>  <font color="#337788"><b>è¯´æ˜</b></font> <br></td></tr><tr><td>  <font color="#337788"><b>ä¸»æŒäºº</b></font> <font color="#337788"><br></font> <br></td><td> <a href=""><img src="https://habrastorage.org/webt/kj/3z/hj/kj3zhjnnftl0e_bymn0ffsp-cps.png"><br></a> <br></td><td> åœ¨ç»™å®šçš„é¢‘ç‡ä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨pingå‘½ä»¤æ£€æŸ¥ä¸»æœºæ˜¯å¦å¤„äºâ€œæ´»åŠ¨çŠ¶æ€â€ã€‚ <br></td></tr><tr><td>  <font color="#337788"><b>ç£ç›˜ä½¿ç”¨ç‡</b></font> <font color="#337788"><br></font> <br></td><td> <a href=""><img src="https://habrastorage.org/webt/_k/od/6-/_kod6-txtpme2ygoeq_y5ixhpga.png"><br></a> <br></td><td> æ£€æŸ¥æˆ‘ä»¬æ˜¯å¦æœ‰è¶³å¤Ÿçš„å¯ç”¨ç£ç›˜ç©ºé—´ã€‚ </td></tr><tr><td>  <font color="#337788"><b>å¹³å‡è´Ÿè½½</b></font> <font color="#337788"><br></font> <br></td><td> <a href=""><img src="https://habrastorage.org/webt/ts/4x/nm/ts4xnmllobanjgmtc-nzlgp5o2i.png"><br></a> <br></td><td> æˆ‘ä»¬åŠ¨æ€ç›‘è§†æœåŠ¡å™¨ä¸Šçš„è´Ÿè½½ã€‚ è€ƒè™‘åˆ°å…¶ä¸Šçš„å¤„ç†å™¨æ•°é‡ã€‚ </td></tr><tr><td>  <font color="#337788"><b>å¯ç”¨å†…å­˜</b></font> <font color="#337788"><br></font> <br></td><td> <a href=""><img src="https://habrastorage.org/webt/m0/c_/7k/m0c_7kx6vpz7x6lmdyzhs1nxqgw.png"><br></a> <br></td><td> æˆ‘ä»¬æ£€æŸ¥æœåŠ¡å™¨ä¸Šæ˜¯å¦æœ‰è¶³å¤Ÿçš„å¯ç”¨å†…å­˜ã€‚ </td></tr><tr><td>  <font color="#337788"><b>å¼€æ”¾ç«¯å£</b></font> <font color="#337788"><br></font> <br></td><td> <a href=""><img src="https://habrastorage.org/webt/qe/ww/d6/qewwd6qbleu9rokn11av0bbesge.png"><br></a> <br></td><td> æˆ‘ä»¬æ‰«ææœåŠ¡å™¨ä¸Šçš„ç«¯å£å¹¶åˆ›å»ºå¼€æ”¾ç«¯å£çš„æ˜ å°„ã€‚ æˆ‘ä»¬ç›‘è§†æˆ‘ä»¬æ²¡æœ‰æ–°çš„æ‰“å¼€æˆ–å…³é—­çš„ç«¯å£ã€‚ </td></tr><tr><td>  <font color="#337788"><b>é‡è¦æ›´æ–°</b></font> <font color="#337788"><br></font> <br></td><td> <a href=""><img src="https://habrastorage.org/webt/ac/in/y5/aciny5yddcavhdjfrfjxitrn4fo.png"><br></a> <br></td><td> æˆ‘ä»¬ç›‘è§†æœåŠ¡å™¨ä¸Šå…³é”®æ›´æ–°çš„å­˜åœ¨ã€‚ </td></tr></tbody></table><br><br><h2>  2.ä»¥æ–¹ä¾¿æ˜“æ‡‚çš„æ–¹å¼ä¸ºå„ç§æœåŠ¡æ·»åŠ è‡ªå®šä¹‰æ£€æŸ¥ã€‚ ç„¶åä¼šå‘å¯¼æ¼”å±•ç¤ºä»€ä¹ˆï¼Œæˆ‘ä»¬æ˜¯å¥½ä¼™ä¼´ï¼Œå¹¶è·å¾—å¥–èµï¼ <br></h2><br> ä¸€äº›ä¾‹å­ï¼š <br><table><tbody><tr><th>  <font color="#337788"><b>æœåŠ¡ä¸“åŒº</b></font> <br></th><th>  <font color="#337788"><b>YAMLéªŒè¯ç </b></font> <br></th></tr><tr><td><div class="spoiler">  <b class="spoiler_title">è™šæ‹Ÿä¸»æœº</b> <div class="spoiler_text"> æ˜¯å¦æ£€æŸ¥â€œå®æ—¶â€ä¸»æœºã€‚ <br></div></div><br><br> <a href=""><img src="https://habrastorage.org/webt/fa/q_/8m/faq_8muc2rwor0d9jp4ywh86qe8.png"><br></a> <br></td><td><pre><code class="hljs ruby"><span class="hljs-string"><span class="hljs-string">'%{::fqdn} virtual host'</span></span> : <span class="hljs-symbol"><span class="hljs-symbol">target:</span></span> /etc/icinga2/zones.d/master/<span class="hljs-string"><span class="hljs-string">%{::fqdn}</span></span>.conf <span class="hljs-symbol"><span class="hljs-symbol">apply:</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-symbol"><span class="hljs-symbol">assign:</span></span> [ <span class="hljs-string"><span class="hljs-string">'host.name == %{::fqdn}'</span></span> ] <span class="hljs-symbol"><span class="hljs-symbol">display_name:</span></span> <span class="hljs-string"><span class="hljs-string">'%{::fqdn} virtualhost'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">check_command:</span></span> <span class="hljs-string"><span class="hljs-string">'http'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">vars:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">http_uri:</span></span> / <span class="hljs-symbol"><span class="hljs-symbol">http_ssl:</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-symbol"><span class="hljs-symbol">http_vhost:</span></span> <span class="hljs-string"><span class="hljs-string">'hostname'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">http_address:</span></span> <span class="hljs-string"><span class="hljs-string">"%{lookup('host_address')}"</span></span></code> </pre> <br></td></tr><tr><td><div class="spoiler">  <b class="spoiler_title">PostgreSQLçš„</b> <div class="spoiler_text"> æ£€æŸ¥æˆ‘ä»¬æ˜¯å¦å¯ä»¥è¿æ¥åˆ°PostgreSQLæ•°æ®åº“ã€‚ <br></div></div><br><br> <a href=""><img src="https://habrastorage.org/webt/ct/c2/wz/ctc2wzluely2l7lsbkxwx5du8i4.png"><br></a> <br></td><td><pre> <code class="hljs javascript"> <span class="hljs-string"><span class="hljs-string">'%{::fqdn} PostgreSQL'</span></span>: target: <span class="hljs-regexp"><span class="hljs-regexp">/etc/i</span></span>cinga2/zones.d/master/%{::fqdn}.conf apply: <span class="hljs-literal"><span class="hljs-literal">true</span></span> assign: [ <span class="hljs-string"><span class="hljs-string">'host.name == %{::fqdn}'</span></span> ] display_name: <span class="hljs-string"><span class="hljs-string">'PostgreSQL'</span></span> command_endpoint: <span class="hljs-string"><span class="hljs-string">'%{::fqdn}'</span></span> check_command: <span class="hljs-string"><span class="hljs-string">"postgres"</span></span> vars: postgres_host: <span class="hljs-string"><span class="hljs-string">"localhost"</span></span> postgres_action: <span class="hljs-string"><span class="hljs-string">"connection"</span></span> phone_notifications: <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre><br></td></tr><tr><td><div class="spoiler">  <b class="spoiler_title">NginxçŠ¶æ€</b> <div class="spoiler_text"> æˆ‘ä»¬é€šè¿‡stub_statusç›‘è§†Nginxçš„çŠ¶æ€ã€‚ <br></div></div><br><br> <a href=""><img src="https://habrastorage.org/webt/ht/el/a9/htela9efivyadlyw4vuxdouiqbk.png"><br></a> <br></td><td><pre> <code class="hljs pgsql"> <span class="hljs-string"><span class="hljs-string">'%{::fqdn} nginx status'</span></span> : target: /etc/icinga2/zones.d/master/%{::fqdn}.conf apply: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> assign: [ <span class="hljs-string"><span class="hljs-string">'host.name == %{::fqdn}'</span></span> ] command_endpoint: <span class="hljs-string"><span class="hljs-string">'%{::fqdn}'</span></span> display_name: <span class="hljs-string"><span class="hljs-string">'nginx status'</span></span> check_command: <span class="hljs-string"><span class="hljs-string">'nginx_status'</span></span> vars: nginx_status_host_address: localhost nginx_status_servername: <span class="hljs-keyword"><span class="hljs-keyword">server</span></span>.com nginx_status_critical: <span class="hljs-string"><span class="hljs-string">'1600,60,30'</span></span> nginx_status_warn: <span class="hljs-string"><span class="hljs-string">'1500,55,25'</span></span></code> </pre><br></td></tr></tbody></table><br><h2>  3.ä¸€åˆ‡éƒ½æ•´æ´ï¼Œå¯é å’Œç¾ä¸½ã€‚ æœ€é‡è¦çš„æ˜¯ï¼ŒèŠ±è´¹ä¸è¶…è¿‡30åˆ†é’Ÿçš„æ—¶é—´è¿›è¡Œåˆå§‹è®¾ç½®ã€‚ <br></h2><br>  <i>æ‚¨å¿…é¡»å…·æœ‰Dockerçš„ç»éªŒï¼Œå› æ­¤å¿…é¡»å…·æœ‰Linuxçš„ç»éªŒ-æœ¬èº«ã€‚</i> <i><br><br></i>  <i>è¯¥è®¾ç½®åœ¨Debian / Ubuntuä¸‹è¿›è¡Œäº†æè¿°ã€‚</i>  <i>è€Œä¸”ï¼Œå°½ç®¡æˆ‘æ²¡æœ‰ç†ç”±ä¸è®©ä»–ä¸åœ¨å…¶ä»–ç±»ä¼¼Unixçš„ç³»ç»Ÿä¸Šå·¥ä½œï¼Œä½†æˆ‘æœ¬äººæ— æ³•æä¾›æ­¤ç±»ä¿è¯ã€‚</i>  <i>æˆ‘æœ‰å‡ å°ä½¿ç”¨CentOSçš„è®¡ç®—æœºï¼Œå®ƒå¯ä»¥åœ¨å…¶ä¸­è¿è¡Œï¼Œä½†æ˜¯å°½ç®¡å¦‚æ­¤ï¼Œå¤§å¤šæ•°è¿˜æ˜¯Debian / Ubuntuã€‚</i> <i><br></i> <br><h2> è®©æˆ‘ä»¬å¼€å§‹å§ </h2><br> æˆ‘é©¬ä¸Šè¯´ï¼Œå½“æ•´ä¸ªä¸»æœºé…ç½®ä¸ºæœåŠ¡ï¼Œé…ç½®ï¼Œè½¯ä»¶ï¼Œå¸æˆ·ç­‰æ—¶ï¼Œè¿™å¯¹æˆ‘æ¥è¯´å¾ˆæ–¹ä¾¿ã€‚  -å®ƒä»¬ç”±ä¸€ä¸ªyamlæ–‡ä»¶æè¿°ï¼Œå®é™…ä¸Šé¿å…äº†è®°å½•åŸºç¡€ç»“æ„å¹¶æä¾›äº†æ¸…æ™°çš„é…ç½®ã€‚ ä»–åœ¨gitå­˜å‚¨åº“ä¸­æ‰“å¼€äº†ç›¸åº”çš„é¡¹ç›®ï¼Œæ–‡ä»¶åä¸ä¸»æœºåç›¸å¯¹åº”ï¼Œç„¶åæ‰“å¼€æ‰€éœ€ä¸»æœºçš„é…ç½®ã€‚ æ‚¨å¯ä»¥ç«‹å³æŸ¥çœ‹ä¸»æœºä¸Šæœ‰å“ªäº›æœåŠ¡ï¼Œä»ä¸­å¤‡ä»½äº†å“ªäº›å†…å®¹ï¼Œç›‘è§†äº†å“ªäº›å†…å®¹ç­‰ã€‚ <br><br>  <b>è¿™æ˜¯å­˜å‚¨åº“ä¸­çš„é¡¹ç›®ç»“æ„çš„å¤–è§‚ï¼š</b> <br><br><pre> <code class="hljs">project_1/hostname1.com.yaml project_2/hostname2.com.yaml project_3/hostname3.com.yaml</code> </pre><br> æˆ‘åœ¨è¿™é‡Œä½¿ç”¨è¿™æ ·çš„æ¨¡æ¿ï¼Œå®ƒæè¿°äº†æˆ‘ä»¬ä»»ä½•æœåŠ¡å™¨çš„é…ç½®ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">å®Œæ•´èŒƒæœ¬</b> <div class="spoiler_text"><pre> <code class="hljs smalltalk">#============================|<span class="hljs-type"><span class="hljs-type">INPUT</span></span> <span class="hljs-type"><span class="hljs-type">DATA</span></span>|=================================# #---------------------------------------|<span class="hljs-type"><span class="hljs-type">VARS</span></span>|----------------------------# #---//<span class="hljs-type"><span class="hljs-type">Information</span></span> about variables, keys &amp; contacts//----------------------# host_address: xxxx my_company: my_mail_domain: my_ssh_port: #---------------------------------------|<span class="hljs-type"><span class="hljs-type">CLASSES</span></span>|-------------------------# #---//<span class="hljs-type"><span class="hljs-type">Classes</span></span> are modules installed on the server.//----------------------# #---//<span class="hljs-type"><span class="hljs-type">These</span></span> modules process the arguments typed below.//------------------# #---//<span class="hljs-type"><span class="hljs-type">Without</span></span> classes nothing will work.//--------------------------------# #---//<span class="hljs-type"><span class="hljs-type">Class</span></span> default_role is mandatory. <span class="hljs-type"><span class="hljs-type">This</span></span> class will install//----------# #---//etckeeper, some required perl modules and manages all the logics.//-# classes: - default_role #---------------------------------------|<span class="hljs-type"><span class="hljs-type">TIMEZONE</span></span>|------------------------# #---//<span class="hljs-type"><span class="hljs-type">Set</span></span> timezone, which will be used on the host.//---------------------# timezone::timezone: <span class="hljs-type"><span class="hljs-type">Europe</span></span>/<span class="hljs-type"><span class="hljs-type">Moscow</span></span> #---------------------------------------|<span class="hljs-type"><span class="hljs-type">FACTS</span></span>|---------------------------# #---//<span class="hljs-type"><span class="hljs-type">Facts</span></span> are variables which puppet agent uses.//----------------------# facter::facts_hash: role: value: <span class="hljs-string"><span class="hljs-string">'name'</span></span> company: value: <span class="hljs-string"><span class="hljs-string">'name of company'</span></span> file: <span class="hljs-string"><span class="hljs-string">'location.txt'</span></span> #=========================================================================# #============================|<span class="hljs-type"><span class="hljs-type">PUPPET</span></span>|=====================================# #---//<span class="hljs-type"><span class="hljs-type">Settings</span></span> for puppet agent.//----------------------------------------# puppet::runmode: cron puppet::ca_server: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('puppet_ca')}"</span></span> puppet::puppetmaster: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('puppet_master')}"</span></span> #=========================================================================# #============================|<span class="hljs-type"><span class="hljs-type">CRON</span></span> <span class="hljs-type"><span class="hljs-type">TASKS</span></span>|=================================# cron_tasks: <span class="hljs-type"><span class="hljs-type">Name</span></span>: command: <span class="hljs-comment"><span class="hljs-comment">""</span></span> user: minute: <span class="hljs-string"><span class="hljs-string">''</span></span> hour: <span class="hljs-string"><span class="hljs-string">''</span></span> #=========================================================================# #============================|<span class="hljs-type"><span class="hljs-type">SUPERVISOR</span></span>|=================================# #---//<span class="hljs-type"><span class="hljs-type">Supervisor</span></span> is a process manager//-----------------------------------# supervisord::install_pip: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> supervisord::install_init: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> supervisord::service_name: supervisor supervisord::package_provider: apt supervisord::executable: /usr/bin/supervisord supervisord::executable_ctl: /usr/bin/supervisorctl supervisord::config_file: /etc/supervisor/supervisord.conf supervisord::programs: <span class="hljs-string"><span class="hljs-string">'name'</span></span>: ensure: present command: <span class="hljs-string"><span class="hljs-string">'su - rails -c "/home/name/s2"'</span></span> autostart: no autorestart: <span class="hljs-string"><span class="hljs-string">'false'</span></span> directory: /home/name/domainName/current #=========================================================================# #============================|<span class="hljs-type"><span class="hljs-type">SECURITY</span></span>|===================================# #-------------------------------------|<span class="hljs-type"><span class="hljs-type">FIREWALL</span></span>|--------------------------# #---//<span class="hljs-type"><span class="hljs-type">Iptables</span></span> rules//----------------------------------------------------# firewall: <span class="hljs-number"><span class="hljs-number">096</span></span> <span class="hljs-type"><span class="hljs-type">Allow</span></span> inbound <span class="hljs-type"><span class="hljs-type">SSH</span></span>: dport: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('my_ssh_port')}"</span></span> proto: tcp action: accept #-------------------------------------|<span class="hljs-type"><span class="hljs-type">FAIL2BAN</span></span>|--------------------------# #-------------------------------------|<span class="hljs-type"><span class="hljs-type">ACCESS</span></span>|----------------------------# #--------------------------------------------|<span class="hljs-type"><span class="hljs-type">ACCOUNTS</span></span>|-------------------# #---//<span class="hljs-type"><span class="hljs-type">Discription</span></span> of accounts which will be created on server.//----------# accounts: user: shell: <span class="hljs-string"><span class="hljs-string">'/bin/bash'</span></span> password: <span class="hljs-string"><span class="hljs-string">''</span></span> locked: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> purge_sshkeys: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> groups: - docker sshkeys: - <span class="hljs-comment"><span class="hljs-comment">"%{alias('admins_ssh_keys')}"</span></span> #--------------------------------------------|<span class="hljs-type"><span class="hljs-type">SUDO</span></span>|-----------------------# #---//<span class="hljs-type"><span class="hljs-type">Appointment</span></span> permissions for users.//--------------------------------# sudo::config_file_replace: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> sudo::configs: user: content: <span class="hljs-comment"><span class="hljs-comment">"user ALL=(ALL) NOPASSWD: ALL"</span></span> #--------------------------------------------|<span class="hljs-type"><span class="hljs-type">SSH</span></span>|------------------------# #--------//<span class="hljs-type"><span class="hljs-type">Settings</span></span> for ssh server.//-------------------------------------# ssh::storeconfigs_enabled: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ssh::server_options: <span class="hljs-type"><span class="hljs-type">Protocol</span></span>: <span class="hljs-string"><span class="hljs-string">'2'</span></span> <span class="hljs-type"><span class="hljs-type">Port</span></span>: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('my_ssh_port')}"</span></span> <span class="hljs-type"><span class="hljs-type">PasswordAuthentication</span></span>: <span class="hljs-string"><span class="hljs-string">'yes'</span></span> <span class="hljs-type"><span class="hljs-type">PermitRootLogin</span></span>: <span class="hljs-string"><span class="hljs-string">'without-password'</span></span> <span class="hljs-type"><span class="hljs-type">SyslogFacility</span></span>: <span class="hljs-string"><span class="hljs-string">'AUTHPRIV'</span></span> <span class="hljs-type"><span class="hljs-type">UsePAM</span></span>: <span class="hljs-string"><span class="hljs-string">'yes'</span></span> <span class="hljs-type"><span class="hljs-type">X11Forwarding</span></span>: <span class="hljs-string"><span class="hljs-string">'no'</span></span> #--------------------------------------------|<span class="hljs-type"><span class="hljs-type">VPN</span></span>|------------------------# #---//<span class="hljs-type"><span class="hljs-type">Settings</span></span> for vpn server.//------------------------------------------# openvpn::servers: <span class="hljs-string"><span class="hljs-string">'namehost'</span></span>: country: <span class="hljs-string"><span class="hljs-string">''</span></span> province: <span class="hljs-string"><span class="hljs-string">''</span></span> city: <span class="hljs-string"><span class="hljs-string">''</span></span> organization: <span class="hljs-string"><span class="hljs-string">''</span></span> email: <span class="hljs-string"><span class="hljs-string">''</span></span> server: <span class="hljs-string"><span class="hljs-string">'xxxx 255.255.255.0'</span></span> dev: tun local: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('host_address')}"</span></span> openvpn::client_defaults: server: <span class="hljs-string"><span class="hljs-string">'namehost'</span></span> openvpn::clients: # <span class="hljs-type"><span class="hljs-type">Firstname</span></span> <span class="hljs-type"><span class="hljs-type">Lastname</span></span> <span class="hljs-string"><span class="hljs-string">'user'</span></span>: {} openvpn::client_specific_configs: <span class="hljs-string"><span class="hljs-string">'user'</span></span>: server: <span class="hljs-string"><span class="hljs-string">'namehost'</span></span> redirect_gateway: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> route: - xxxx <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span> #=========================================================================# #============================|<span class="hljs-type"><span class="hljs-type">OPERATING</span></span> <span class="hljs-type"><span class="hljs-type">SYSTEM</span></span>|===========================# #---------------------------------------------|<span class="hljs-type"><span class="hljs-type">SYSCTL</span></span>|--------------------# #---//set sysctl parameters//---------------------------------------------# sysctl::base::values: fs.file-max: value: <span class="hljs-string"><span class="hljs-string">'2097152000'</span></span> net.netfilter.nf_conntrack_max: value: <span class="hljs-string"><span class="hljs-string">'1048576'</span></span> net.nf_conntrack_max: value: <span class="hljs-string"><span class="hljs-string">'1048576'</span></span> net.ipv6.conf.all.disable_ipv6: value: <span class="hljs-string"><span class="hljs-string">'1'</span></span> vm.oom_kill_allocating_task: value: <span class="hljs-string"><span class="hljs-string">'1'</span></span> net.ipv4.ip_forward: value: <span class="hljs-string"><span class="hljs-string">'0'</span></span> net.ipv4.tcp_keepalive_time: value: <span class="hljs-string"><span class="hljs-string">'3'</span></span> net.ipv4.tcp_keepalive_intvl: value: <span class="hljs-string"><span class="hljs-string">'60'</span></span> net.ipv4.tcp_keepalive_probes: value: <span class="hljs-string"><span class="hljs-string">'9'</span></span> #---------------------------------------------|<span class="hljs-type"><span class="hljs-type">RCS</span></span>|-----------------------# #---//<span class="hljs-type"><span class="hljs-type">Managment</span></span> of <span class="hljs-type"><span class="hljs-type">RC</span></span> scenario//------------------------------------------# rcs::tmptime: <span class="hljs-string"><span class="hljs-string">'-1'</span></span> #---------------------------------------------|<span class="hljs-type"><span class="hljs-type">WEB</span></span> <span class="hljs-type"><span class="hljs-type">SERVERS</span></span>|---------------# #---------------------------------------------------------|<span class="hljs-type"><span class="hljs-type">HAPROXY</span></span>|-------# #---//<span class="hljs-type"><span class="hljs-type">HAProxy</span></span> is software that provides a high availability load//--------# #---//balancer and proxy server for <span class="hljs-type"><span class="hljs-type">TCP</span></span> and <span class="hljs-type"><span class="hljs-type">HTTP</span></span>-based applications//-----# #---// that spreads requests across multiple servers.//-------------------# haproxy::merge_options: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> haproxy::defaults_options: log: global maxconn: <span class="hljs-number"><span class="hljs-number">20000</span></span> option: [ <span class="hljs-string"><span class="hljs-string">'tcplog'</span></span>, <span class="hljs-string"><span class="hljs-string">'redispatch'</span></span>, <span class="hljs-string"><span class="hljs-string">'dontlognull'</span></span> ] retries: <span class="hljs-number"><span class="hljs-number">3</span></span> stats: enable timeout: [ <span class="hljs-string"><span class="hljs-string">'http-request 10s'</span></span>, <span class="hljs-string"><span class="hljs-string">'queue 1m'</span></span>, <span class="hljs-string"><span class="hljs-string">'check 10s'</span></span>, <span class="hljs-string"><span class="hljs-string">'connect 300000000ms'</span></span>, <span class="hljs-string"><span class="hljs-string">'client 300000000ms'</span></span>, <span class="hljs-string"><span class="hljs-string">'server 300000000ms'</span></span> ] haproxy_server: stats: ipaddress: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('host_address')}"</span></span> ports: <span class="hljs-string"><span class="hljs-string">'9090'</span></span> options: mode: <span class="hljs-string"><span class="hljs-string">'http'</span></span> stats: [ <span class="hljs-string"><span class="hljs-string">'uri /'</span></span>, <span class="hljs-string"><span class="hljs-string">'auth puppet:123123123'</span></span> ] postgres: collect_exported: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> ipaddress: <span class="hljs-string"><span class="hljs-string">'0.0.0.0'</span></span> ports: <span class="hljs-string"><span class="hljs-string">'5432'</span></span> options: option: - tcplog balance: roundrobin haproxy_balancemember: hostname1: listening_service: postgres server_names: hostname1 ipaddresses: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('host1_ip')}"</span></span> ports: <span class="hljs-number"><span class="hljs-number">6432</span></span> options: check hostname2: listening_service: postgres server_names: hostname2 ipaddresses: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('host2_ip')}"</span></span> ports: <span class="hljs-number"><span class="hljs-number">6432</span></span> options: - check - backup #---------------------------------------------|<span class="hljs-type"><span class="hljs-type">NGINX</span></span>|---------------------# #---//<span class="hljs-type"><span class="hljs-type">Nginx</span></span> is a web server which can also be used as a reverse proxy,//--# #---//load balancer, mail proxy and <span class="hljs-type"><span class="hljs-type">HTTP</span></span> cache//--------------------------# nginx::nginx_cfg_prepend: <span class="hljs-string"><span class="hljs-string">'load_module'</span></span>: - modules/ngx_http_geoip_module.so nginx::http_raw_append: - <span class="hljs-string"><span class="hljs-string">'real_ip_header X-Forwarded-For;'</span></span> - <span class="hljs-string"><span class="hljs-string">'geoip_country /usr/share/GeoIP/GeoIP.dat;'</span></span> - <span class="hljs-string"><span class="hljs-string">'set_real_ip_from 0.0.0.0/0;'</span></span> nginx::worker_rlimit_nofile: <span class="hljs-number"><span class="hljs-number">16384</span></span> nginx::confd: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> nginx::server_purrge: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> nginx::server::maintenance: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> #---------------------------------------------nginx-|<span class="hljs-type"><span class="hljs-type">MAPS</span></span>|----------------# nginx::string_mappings: allowed_country: ensure: present string: <span class="hljs-string"><span class="hljs-string">'$geoip_country_code'</span></span> mappings: - key: <span class="hljs-string"><span class="hljs-string">'default'</span></span> value: <span class="hljs-string"><span class="hljs-string">'yes'</span></span> - key: <span class="hljs-string"><span class="hljs-string">'US'</span></span> value: <span class="hljs-string"><span class="hljs-string">'no'</span></span> #---------------------------------------------nginx-|<span class="hljs-type"><span class="hljs-type">UPSTREAMS</span></span>|-----------# nginx::nginx_upstreams: <span class="hljs-comment"><span class="hljs-comment">"upstreamName"</span></span>: ensure: present members: - <span class="hljs-comment"><span class="hljs-comment">"localhost:9999"</span></span> #---------------------------------------------nginx-|<span class="hljs-type"><span class="hljs-type">VHOSTS</span></span>|--------------# nginx::nginx_servers: <span class="hljs-string"><span class="hljs-string">'hostname'</span></span>: proxy: <span class="hljs-string"><span class="hljs-string">'http://'</span></span> location_raw_append: - <span class="hljs-string"><span class="hljs-string">'if ($allowed_country = no) {return 403;}'</span></span> try_files: - <span class="hljs-string"><span class="hljs-string">''</span></span> - /index.html - =<span class="hljs-number"><span class="hljs-number">404</span></span> ssl: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ssl_cert: <span class="hljs-comment"><span class="hljs-comment">"/etc/letsencrypt/live/hostname/fullchain.pem"</span></span> ssl_key: <span class="hljs-comment"><span class="hljs-comment">"/etc/letsencrypt/live/hostname/privkey.pem"</span></span> ssl_trusted_cert: <span class="hljs-comment"><span class="hljs-comment">"/etc/letsencrypt/live/hostname/chain.pem"</span></span> ssl_redirect: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> ssl_port: <span class="hljs-number"><span class="hljs-number">443</span></span> error_pages: <span class="hljs-string"><span class="hljs-string">'403'</span></span>: /usa-restrict.html #---------------------------------------------nginx-|<span class="hljs-type"><span class="hljs-type">HTTPAUTH</span></span>|------------# httpauth: <span class="hljs-string"><span class="hljs-string">'admin'</span></span>: file: <span class="hljs-comment"><span class="hljs-comment">"/etc/nginx/htaccess"</span></span> password: <span class="hljs-string"><span class="hljs-string">''</span></span> realm: realm mechanism: basic ensure: present #---------------------------------------------nginx-|<span class="hljs-type"><span class="hljs-type">LOCATIONS</span></span>|-----------# nginx::nginx_locations: <span class="hljs-string"><span class="hljs-string">'domain1.com/usa-restricted'</span></span>: location: /usa-restrict.html www_root: /home/clientName1/clientName1-client-release/current/dist server: domain1.com ssl: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> <span class="hljs-string"><span class="hljs-string">'^~ domain2.com/resources/upload/'</span></span>: location: <span class="hljs-string"><span class="hljs-string">'^~ /resources/upload/'</span></span> server: domain2.com location_alias: <span class="hljs-string"><span class="hljs-string">'/home/clientName2/upload/'</span></span> raw_append: - <span class="hljs-string"><span class="hljs-string">'if ($allowed_country = no) {return 403;}'</span></span> <span class="hljs-string"><span class="hljs-string">'/nginx_status-domain3.com'</span></span>: location: /nginx_status stub_status: on raw_append: - access_log off; - allow <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>; - deny all; #---------------------------------------------nginx-|<span class="hljs-type"><span class="hljs-type">WELL</span></span>-<span class="hljs-type"><span class="hljs-type">KNOWN</span></span>|----------# #---//<span class="hljs-type"><span class="hljs-type">These</span></span> locations are needed for <span class="hljs-type"><span class="hljs-type">SSL</span></span> certificates generating//--------# #---//with <span class="hljs-type"><span class="hljs-type">Letsencrypt</span></span>.//-------------------------------------------------# <span class="hljs-string"><span class="hljs-string">'x.hostname.zz/.well-known'</span></span>: location: <span class="hljs-string"><span class="hljs-string">'/.well-known'</span></span> server: x.hostname.zz proxy: <span class="hljs-string"><span class="hljs-string">'http://kibana'</span></span> auth_basic: <span class="hljs-comment"><span class="hljs-comment">"ciao"</span></span> auth_basic_user_file: <span class="hljs-comment"><span class="hljs-comment">"/etc/nginx/htaccess www_root: /var/www/html ssl: true 'hostname.zz/~* \.(?:ico|css|js|html|map|gif|jpg|png|svg|ttf|woff|appcache|pdf)$': location: '~* \.(?:ico|css|js|html|map|gif|jpg|png|svg|ttf|woff|appcache|pdf)$' www_root: '/home/hostname/hostname-client-release/current/dist' expires: max raw_append: - "</span></span>add_header <span class="hljs-type"><span class="hljs-type">Pragma</span></span> public;<span class="hljs-comment"><span class="hljs-comment">" - 'add_header Cache-Control "</span></span>public, must-revalidate, proxy-revalidate<span class="hljs-comment"><span class="hljs-comment">";' #---------------------------------------------------|NGINS STATUS|--------# #----------------------------|LETSENCRYPT|--------------------------------# #---//Let's Encrypt is a certificate authority that provides #---//free X.509 certificates for Transport Layer Security (TLS)//--------# #---//encryption via an automated process designed to eliminate//---------# #---//the hitherto complex process of manual creation, validation,//------# #---//signing, installation, and renewal of certificates//----------------# #---//for secure websites.//----------------------------------------------# letsencrypt::email: client@mail.com letsencrypt_certonly: hostname: manage_cron: true domains: - hostname plugin: webroot webroot_paths: - '/var/www/html' #----------------------------|FILE SERVERS|-------------------------------# #-----------------------------------------|FILES|-------------------------# #---//Creating files &amp; folders on the server.//---------------------------# file: "</span></span>/home/hostname/hostname-release/shared/ecosystem.config.js<span class="hljs-comment"><span class="hljs-comment">": ensure: present owner: hostname content: | module.exports = { /** * Application configuration section * http://pm2.keymetrics.io/docs/usage/application-declaration/ */ apps : [ // First application { name : 'api', script : '/home/hostname/hostname-release/current/dist/index.js', cwd : '/home/hostname/hostname-release/current/dist/', watch : false, ignore_watch : ["</span></span>logs<span class="hljs-comment"><span class="hljs-comment">"], "</span></span>log_type<span class="hljs-comment"><span class="hljs-comment">": "</span></span>format<span class="hljs-comment"><span class="hljs-comment">", env: { COMMON_VARIABLE: 'true' }, env_production : { NODE_ENV: 'production', PORT: 9999, DEBUG : '*' }, env_development : { NODE_ENV: 'development', PORT: 9999, DEBUG : '*' } }, // Second application { name : 'WEB', script : 'web.js' } ], /** * Deployment section * http://pm2.keymetrics.io/docs/usage/deployment/ */ deploy : { production : { user : 'node', host : '0.0.0.0', ref : 'origin/master', repo : 'name@name.com:repo.git', path : '/var/www/production', 'post-deploy' : 'npm install &amp;&amp; pm2 reload ecosystem.config.js --env production' }, dev : { user : 'node', host : '0.0.0.0', ref : 'origin/master', repo : 'name@name.com:repo.git', path : '/var/www/development', 'post-deploy' : 'npm install &amp;&amp; pm2 reload ecosystem.config.js --env dev', env : { NODE_ENV: 'dev' } } } }; #-----------------------------------------|FTP|----------------------------# #---//Very Secure FTP Daemon is an FTP server for Unix-like systems.//-----# vsftpd::ftpd_banner: 'ASCII FTP Server' vsftpd::anonymous_enable: 'NO' vsftpd::write_enable: 'YES' vsftpd::chroot_local_user: 'YES' vsftpd::allow_writeable_chroot: 'YES' vsftpd::userlist_enable: 'YES' vsftpd::userlist_deny: 'NO' #-----------------------------------------|NFS|---------------------------# #---//Network File System is a distributed file system protocol,//--------# #---//allowing a user on a client computer to access files over//---------# #---//a computer network much like local storage is accessed.//-----------# nfs::server_enabled: true nfs::client_enabled : false nfs::nfs_v4: true nfs::nfs_v4_idmap_domain: "</span></span>%{::domain}<span class="hljs-comment"><span class="hljs-comment">" nfs::nfs_v4_export_root: '/share' nfs::nfs_v4_export_root_clients: "</span></span>%{lookup(<span class="hljs-string"><span class="hljs-string">'host_address'</span></span>)}/<span class="hljs-number"><span class="hljs-number">32</span></span>(rw,fsid=root,insecure,no_subtree_check,async,no_root_squash)<span class="hljs-comment"><span class="hljs-comment">" nfs::nfs_exports_global: /var/www: {} /var/smb: {} #----------------------------|PACKAGES|-----------------------------------# #---//Install of packages to server.//------------------------------------# packages: namePackage: ensure: installed #-------------------------------------|APT|-------------------------------# #---//Management of repository of packages.//---# apt::sources: 'debian_unstable': comment: 'This is the iWeb Debian unstable mirror' location: 'http://debian.mirror.iweb.ca/debian/' release: 'unstable' repos: 'main contrib non-free' pin: '-10' key: id: 'IDIDIDIDIDIDIDIDIDIDIDIDIDIDIDID' server: 'subkeys.pgp.net' include: src: true deb: true 'puppetlabs': location: 'http://apt.puppetlabs.com' repos: 'main' key: id: 'IDIDIDIDIDIDIDIDIDIDIDIDIDIDIDID' server: 'pgp.mit.edu' #-------------------------------------|PHP|-------------------------------# php_pool: myadmin: listen: 'xxxx:x' #-------------------------------------|RVM|-------------------------------# #---//Ruby Version Manager is a unix-like software platform designed//---# #---//to manage multiple installations of Ruby on the same device.//------# rvm_ruby: user1_rvm: user: user1 version: ruby-2.5.1 white_label_platform: default #-------------------------------------|PYTHON|----------------------------# python::version: system python::dev: present python::virtualenv: true #----------------------------|NODEJS|-------------------------------------# #-----------------------------------|NVM|---------------------------------# #---//Node Version Manager for Node.js//----------------------------------# #---//Node.js lets developers use JavaScript to write Command Line//------# #---//tools and for server-side scriptingâ€”running scripts server-side//---# #---//to produce dynamic web page content before the page is sent//-------# #---//to the user's web browser.//----------------------------------------# nodejs::repo_url_suffix: '8.x' nvm::user: name nvm::install_node: 8.10.0 #----------------------------|DOCKER|-------------------------------------# #---//Docker's management//-----------------------------------------------# docker::run_instance::instance: nats: image: 'nats' extra_parameters: '-p 8222:8222 -p 4222:4222 -p 6222:6222 --name nats --network admin_default' docker::compose::ensure: present docker_compose: /etc/admin/gitlab/docker-compose.yaml: ensure: present docker::iptables: false docker::tcp_bind: tcp://0.0.0.0:2375 docker::compose::ensure: present docker_swarm: 'agent': ensure: present join: true advertise_addr: '%{::ipaddress_enp2s0}' listen_addr: '%{::ipaddress_enp2s0}' manager_ip: '%{lookup("</span></span>host_address<span class="hljs-comment"><span class="hljs-comment">")}' token: '' docker_registry: 'host.com:5000': username: '' password: '' email: 'mail@mail.com' #=========================================================================# #============================|BACKUPS UPDATES|============================# #--------------------------------------------|UPDATES|--------------------# #---//Unattended upgrades is the linux-like mechanism//-------------------# #---//automatic updates.//------------------------------------------------# unattended_upgrades::origins: - "</span></span>o=<span class="hljs-type"><span class="hljs-type">Debian</span></span>,n=<span class="hljs-string"><span class="hljs-string">${</span></span>distro_codename}<span class="hljs-comment"><span class="hljs-comment">" - "</span></span>o=<span class="hljs-type"><span class="hljs-type">Debian</span></span>,n=<span class="hljs-string"><span class="hljs-string">${</span></span>distro_codename}-security<span class="hljs-comment"><span class="hljs-comment">" - "</span></span>o=<span class="hljs-type"><span class="hljs-type">Debian</span></span>,n=<span class="hljs-string"><span class="hljs-string">${</span></span>distro_codename}-updates<span class="hljs-comment"><span class="hljs-comment">" - "</span></span>o=<span class="hljs-type"><span class="hljs-type">Debian</span></span>,n=<span class="hljs-string"><span class="hljs-string">${</span></span>distro_codename}-proposed<span class="hljs-comment"><span class="hljs-comment">" - "</span></span>o=<span class="hljs-type"><span class="hljs-type">Debian</span></span>,n=<span class="hljs-string"><span class="hljs-string">${</span></span>distro_codename}-backports<span class="hljs-comment"><span class="hljs-comment">" - "</span></span>o=debian icinga,n=icinga-<span class="hljs-string"><span class="hljs-string">${</span></span>distro_codename}<span class="hljs-comment"><span class="hljs-comment">" - "</span></span>o=<span class="hljs-type"><span class="hljs-type">Zabbix</span></span>,n=<span class="hljs-string"><span class="hljs-string">${</span></span>distro_codename}<span class="hljs-comment"><span class="hljs-comment">" #--------------------------------------------|BACKUPS|--------------------# #---//The backups are processed by gembackup.//---------------------------# backup_jobs: #Creates full backup type_files: types: ['archive'] add: - '/path' storage_type: 'ftp' storage_host: "</span></span>%{lookup(<span class="hljs-string"><span class="hljs-string">'my_ftp_hostname'</span></span>)}<span class="hljs-comment"><span class="hljs-comment">" path: '/files/' storage_username: "</span></span>%{lookup(<span class="hljs-string"><span class="hljs-string">'my_backup_ftp_username'</span></span>)}<span class="hljs-comment"><span class="hljs-comment">" storage_password: "</span></span>%{lookup(<span class="hljs-string"><span class="hljs-string">'my_backup_ftp_password'</span></span>)}<span class="hljs-comment"><span class="hljs-comment">" compressor: "</span></span>%{lookup(<span class="hljs-string"><span class="hljs-string">'my_backup_compressor'</span></span>)}<span class="hljs-comment"><span class="hljs-comment">" keep: 7 weekday: [1-7] hour: 0 minute: 0 #--------------------------------------------|MOUNT|----------------------# #---//ontrol the mounting of remote &amp; local mount points.//--------------# mount: #Mount folder from other server to keep backups "</span></span>/tmp/mediastagetv_netbynet<span class="hljs-comment"><span class="hljs-comment">": device: "</span></span>%{lookup(<span class="hljs-string"><span class="hljs-string">'host_address'</span></span>)}:/<span class="hljs-comment"><span class="hljs-comment">" ensure: mounted fstype: nfs4 options: defaults atboot: false #--------------------------------------------|S3 AMAZON|------------------# #---//Simple Storage Service is a cloud computing web service.//----------# hostname1-archives: '/home/hostname1/hostname1/shared/log_amazon' hostname2-archives: '/home/hostname2/hostname2/shared/log_amazon' yas3fs::mounts: #=========================================================================# #============================|MONITORING|=================================# #---------------------------------------|ICINGA SERVICES|-----------------# #---//Managment of monitoring system.//-----------------------------------# icinga2_service: '%{::fqdn} virtual host' : target: /etc/icinga2/zones.d/master/%{::fqdn}.conf apply: true assign: [ 'host.name == %{::fqdn}' ] display_name: '%{::fqdn} virtualhost' check_command: 'http' vars: http_uri: / http_ssl: true http_vhost: 'hostname' http_address: "</span></span>%{lookup(<span class="hljs-string"><span class="hljs-string">'host_address'</span></span>)}<span class="hljs-comment"><span class="hljs-comment">" '%{::fqdn} nginx status' : target: /etc/icinga2/zones.d/master/%{::fqdn}.conf apply: true assign: [ 'host.name == %{::fqdn}' ] command_endpoint: '%{::fqdn}' display_name: 'nginx status' check_command: 'nginx_status' vars: nginx_status_host_address: localhost nginx_status_servername: server.com nginx_status_critical: '1600,60,30' nginx_status_warn: '1500,55,25' '%{::fqdn} redis': target: /etc/icinga2/zones.d/master/%{::fqdn}.conf apply: true assign: [ 'host.name == %{::fqdn}' ] display_name: 'Redis' command_endpoint: '%{::fqdn}' check_command: "</span></span>redis<span class="hljs-comment"><span class="hljs-comment">" vars: redis_hostname: localhost redis_port: 6379 redis_perfvars: '*' #=========================================================================# #============================|MAIL &amp; LOGS|================================# #----------------------------------------|MAIL|---------------------------# #---------------------------------------------|POSTFIX|-------------------# #---//Management of mail-server Postfix.//--------------------------------# postfix::manage_conffiles: false postfix_config: relayhost: ensure: present value: "</span></span>%{lookup(<span class="hljs-string"><span class="hljs-string">'host_address'</span></span>)}<span class="hljs-comment"><span class="hljs-comment">" virtual_maps: value: hash:/etc/postfix/virtual ensure: present sender_canonical_map: value: hash:/etc/postfix/canonical_sender ensure: present postfix_hash: '/etc/postfix/virtual': ensure: present content: | root %{lookup('hostname_admin_emails')} rails %{lookup('hostname_emails')} '/etc/postfix/canonical_sender': ensure: present content: | name@%{lookup('my_domain')} name@my_domain.com root@%{lookup('my_domain')} root@my_domain.com #----------------------------------------|LOGS|---------------------------# #---------------------------------------------|RSYSLOG|-------------------# #---//Rsyslog is a software utility for forwarding log messages//---------# #---//in an IP network. It implements the basic syslog protocol,//--------# #---//extends it with content-based filtering, rich filtering//-----------# #---//capabilities, flexible configuration options and adds features//----# #---//such as using TCP for transport.//----------------------------------# rsyslog::client: log_local: true my_rsyslog_snippet: 99_everything: content: "</span></span>*.*;auth,authpriv.none /var/log/syslog\n<span class="hljs-comment"><span class="hljs-comment">" 01_mail: content: "</span></span>mail.* -/var/log/mail.log\n&amp; stop<span class="hljs-comment"><span class="hljs-comment">" 02_auth: content: "</span></span>auth,authpriv.* /var/log/auth\n&amp; stop<span class="hljs-comment"><span class="hljs-comment">" 03_puppetagent: content: "</span></span>:programname,contains,\<span class="hljs-comment"><span class="hljs-comment">"puppet-agent\"</span></span> /var/log/puppetlabs/puppet/puppet-agent.log\n&amp; stop<span class="hljs-comment"><span class="hljs-comment">" 04_iptables: content: "</span></span>:msg,contains,\<span class="hljs-comment"><span class="hljs-comment">"IPTABLES INPUT\"</span></span> /var/log/iptables/iptables.log\n&amp; stop<span class="hljs-comment"><span class="hljs-comment">" 05_pam_unix: content: "</span></span>:msg,regex,\<span class="hljs-comment"><span class="hljs-comment">".*session opened for.*(uid=0)\"</span></span> /var/log/admin/auth.log\n&amp; stop<span class="hljs-comment"><span class="hljs-comment">" 06_sshd: content: "</span></span>:msg,regex,\<span class="hljs-comment"><span class="hljs-comment">".*publickey for username.*0.0.0.0\"</span></span> /var/log/admin/auth.log\n&amp; stop #---------------------------------------------|<span class="hljs-type"><span class="hljs-type">LOGWATCH</span></span>|------------------# #---//<span class="hljs-type"><span class="hljs-type">Logwatch</span></span> is a log-analysator for create short reports.//------------# logwatch::format: text logwatch::service: # <span class="hljs-type"><span class="hljs-type">Ignore</span></span> this servie - -http - -iptables #---------------------------------------------|<span class="hljs-type"><span class="hljs-type">LOGROTATE</span></span>|-----------------# #---//<span class="hljs-type"><span class="hljs-type">Management</span></span> of rotation of log files.//------------------------------# my_rclogs_path: <span class="hljs-string"><span class="hljs-string">'/home/hostname/hostname/shared/log'</span></span> my_rclogs_amazon_path: <span class="hljs-string"><span class="hljs-string">'/home/hostname1/hostname1/shared/log_amazon'</span></span> my_ttlogs_path: <span class="hljs-string"><span class="hljs-string">'/home/hostname2/hostname2/shared/log'</span></span> my_ttlogs_amazon_path: <span class="hljs-string"><span class="hljs-string">'/home/hostname/hostname/shared/log_amazon'</span></span> logrotate::ensure: latest logrotate::config: dateext: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> compress: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> logrotate::rules: booking-logs: path: <span class="hljs-string"><span class="hljs-string">'%{lookup("my_rclogs_path")}/booking_com.log'</span></span> size: <span class="hljs-number"><span class="hljs-number">2500</span></span>M rotate: <span class="hljs-number"><span class="hljs-number">20</span></span> copytruncate: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> delaycompress: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> dateext: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> dateformat: -%<span class="hljs-type"><span class="hljs-type">Y</span></span>%m%d-%s compress: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> postrotate: mv %{lookup(<span class="hljs-string"><span class="hljs-string">'my_rclogs_path'</span></span>)}/booking_com.log*.gz %{lookup(<span class="hljs-string"><span class="hljs-string">'my_rclogs_amazon_path'</span></span>)}/ #---------------------------------------------|<span class="hljs-type"><span class="hljs-type">ATOP</span></span>|----------------------# #---//<span class="hljs-type"><span class="hljs-type">ATOP</span></span> service displays a new information about <span class="hljs-type"><span class="hljs-type">CPU</span></span>//-----------------# #---//and memory utilization.//-------------------------------------------# atop::service: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> atop::interval: <span class="hljs-number"><span class="hljs-number">30</span></span> #----------------------------------------|<span class="hljs-type"><span class="hljs-type">DNS</span></span>|----------------------------# #---//<span class="hljs-type"><span class="hljs-type">Management</span></span> of file /etc/resolv.conf//-------------------------------# resolv_conf::nameservers: - <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> - <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> #=========================================================================# #============================|<span class="hljs-type"><span class="hljs-type">DATABASES</span></span>|==================================# #--------------------------------------|<span class="hljs-type"><span class="hljs-type">MYSQL</span></span>|----------------------------# #---//<span class="hljs-type"><span class="hljs-type">MySQL</span></span> is a relational database management system.//-----------------# mysql::server::package_ensure: <span class="hljs-string"><span class="hljs-string">'installed'</span></span> #Â· mysql::server::root_password: <span class="hljs-comment"><span class="hljs-comment">"ooy5ieneePahnei"</span></span> mysql::server::manage_config_file: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> mysql::server::service_name: <span class="hljs-string"><span class="hljs-string">'mysql'</span></span> # required for puppet module mysql::server::override_options: <span class="hljs-string"><span class="hljs-string">'mysqld'</span></span>: <span class="hljs-string"><span class="hljs-string">'bind-address'</span></span>: <span class="hljs-string"><span class="hljs-string">'*'</span></span> <span class="hljs-comment"><span class="hljs-comment">"userName"</span></span>: <span class="hljs-comment"><span class="hljs-comment">""</span></span>, <span class="hljs-comment"><span class="hljs-comment">"password"</span></span>: <span class="hljs-comment"><span class="hljs-comment">""</span></span>, <span class="hljs-comment"><span class="hljs-comment">"databaseName"</span></span>: <span class="hljs-comment"><span class="hljs-comment">""</span></span>, mysql::server::db: <span class="hljs-comment"><span class="hljs-comment">"hostname"</span></span>: user: <span class="hljs-comment"><span class="hljs-comment">""</span></span> password: <span class="hljs-comment"><span class="hljs-comment">""</span></span> host: <span class="hljs-comment"><span class="hljs-comment">"%"</span></span> grant: - <span class="hljs-comment"><span class="hljs-comment">"ALL"</span></span> #-------------------------------------|<span class="hljs-type"><span class="hljs-type">ELASTICSEARCH</span></span>|---------------------# #---//<span class="hljs-type"><span class="hljs-type">Elasticsearch</span></span> is a search engine based on <span class="hljs-type"><span class="hljs-type">Lucene</span></span>.//-----------------# #---//<span class="hljs-type"><span class="hljs-type">It</span></span> provides a distributed, multitenant-capable full-text search//---# #---//engine with an <span class="hljs-type"><span class="hljs-type">HTTP</span></span> web interface and schema-free <span class="hljs-type"><span class="hljs-type">JSON</span></span> documents.//-# elasticsearch::version: <span class="hljs-number"><span class="hljs-number">5.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> elasticsearch::manage_repo: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> elasticsearch::repo_version: <span class="hljs-number"><span class="hljs-number">5.</span></span>x elasticsearch::java_install: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> elasticsearch::restart_on_change: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> elasticsearch_instance: <span class="hljs-string"><span class="hljs-string">'es-01'</span></span>: ensure: <span class="hljs-string"><span class="hljs-string">'present'</span></span> #-------------------------------------|<span class="hljs-type"><span class="hljs-type">REDIS</span></span>|-----------------------------# #---//<span class="hljs-type"><span class="hljs-type">Redis</span></span> is an in-memory database project implementing//---------------# #---//a distributed, in-memory key-value store with//---------------------# #---//optional durability.//----------------------------------------------# redis::bind: <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> #-------------------------------------|<span class="hljs-type"><span class="hljs-type">ZOOKEPER</span></span>|--------------------------# #---//<span class="hljs-type"><span class="hljs-type">Zooker</span></span> is a centralized service for distributed systems//-----------# #---//to a hierarchical key-value store, which is used to provide//-------# #---//a distributed configuration service, synchronization service,//-----# #---//and naming registry for large distributed systems.//----------------# zookeeper::init_limit: <span class="hljs-string"><span class="hljs-string">'1000'</span></span> zookeeper::id: <span class="hljs-string"><span class="hljs-string">'1'</span></span> zookeeper::purge_interval: <span class="hljs-string"><span class="hljs-string">'1'</span></span> zookeeper::servers: - <span class="hljs-comment"><span class="hljs-comment">"%{lookup('host')}"</span></span> #-------------------------------------|<span class="hljs-type"><span class="hljs-type">POSTGRES</span></span>|--------------------------# #---//<span class="hljs-type"><span class="hljs-type">Postgres</span></span>, is an object-relational database management system//------# #---//with an emphasis on extensibility and standards compliance.//-------# #---//<span class="hljs-type"><span class="hljs-type">As</span></span> a database server, its primary functions are to store data//----# #---//securely and return that data in response to requests from other//--# #---//software applications.//--------------------------------------------# postgresql::server::postgres_password: postgresql::server::ip_mask_allow_all_users: <span class="hljs-string"><span class="hljs-string">'0.0.0.0/0'</span></span> postgresql::postgresql::server: ip_mask_allow_all_users: <span class="hljs-string"><span class="hljs-string">'0.0.0.0/32'</span></span> postgres_db: master: user: password: confluence: user: password: postgres_config: <span class="hljs-string"><span class="hljs-string">'max_connections'</span></span>: value: <span class="hljs-number"><span class="hljs-number">300</span></span> postgres_hba: <span class="hljs-string"><span class="hljs-string">'Allow locals without password'</span></span>: order: <span class="hljs-number"><span class="hljs-number">1</span></span> description: <span class="hljs-string"><span class="hljs-string">'locals postgres no password'</span></span> type: <span class="hljs-string"><span class="hljs-string">'host'</span></span> address: <span class="hljs-string"><span class="hljs-string">'127.0.0.1/32'</span></span> database: <span class="hljs-string"><span class="hljs-string">'all'</span></span> user: <span class="hljs-string"><span class="hljs-string">'all'</span></span> auth_method: <span class="hljs-string"><span class="hljs-string">'trust'</span></span> #----------------------------------------------|<span class="hljs-type"><span class="hljs-type">PGBOUNCER</span></span>|----------------# #---//<span class="hljs-type"><span class="hljs-type">PgBouncer</span></span> is a connection pooler for <span class="hljs-type"><span class="hljs-type">PostgreSQL</span></span>//-------------------# pgbouncer::group: postgres pgbouncer::user: postgres pgbouncer::userlist: - user: password: pgbouncer::databases: - source_db: recommender host: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('')}"</span></span> dest_db: recommender auth_user: recommender pool_size: <span class="hljs-number"><span class="hljs-number">200</span></span> auth_pass: - source_db: master host: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('')}"</span></span> dest_db: recommender auth_user: recommender pool_size: <span class="hljs-number"><span class="hljs-number">50</span></span> auth_pass: - source_db: slave host: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('')}"</span></span> dest_db: recommender auth_user: recommender pool_size: <span class="hljs-number"><span class="hljs-number">200</span></span> auth_pass: #=========================================================================# #==============================|<span class="hljs-type"><span class="hljs-type">APPLICATION</span></span> <span class="hljs-type"><span class="hljs-type">SERVICES</span></span>|=====================# #---------------------------------------------------|<span class="hljs-type"><span class="hljs-type">CONFLUENCE</span></span>|----------# #---------------------------------------------------|<span class="hljs-type"><span class="hljs-type">JENKINS</span></span>|-------------# #=========================================================================#</code> </pre><br></div></div><br><br><h3> ç›‘è§†éƒ¨åˆ†ç¤ºä¾‹ï¼š </h3><br><pre> <code class="hljs smalltalk">#============================|<span class="hljs-type"><span class="hljs-type">MONITORING</span></span>|=================================# #---------------------------------------|<span class="hljs-type"><span class="hljs-type">ICINGA</span></span> <span class="hljs-type"><span class="hljs-type">SERVICES</span></span>|-----------------# #---//<span class="hljs-type"><span class="hljs-type">Managment</span></span> of monitoring system.//-----------------------------------# icinga2_service: <span class="hljs-string"><span class="hljs-string">'%{::fqdn} virtual host'</span></span> : target: /etc/icinga2/zones.d/master/%{::fqdn}.conf apply: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> assign: [ <span class="hljs-string"><span class="hljs-string">'host.name == %{::fqdn}'</span></span> ] display_name: <span class="hljs-string"><span class="hljs-string">'%{::fqdn} virtualhost'</span></span> check_command: <span class="hljs-string"><span class="hljs-string">'http'</span></span> vars: http_uri: / http_ssl: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> http_vhost: <span class="hljs-string"><span class="hljs-string">'hostname'</span></span> http_address: <span class="hljs-comment"><span class="hljs-comment">"%{lookup('host_address')}"</span></span> <span class="hljs-string"><span class="hljs-string">'%{::fqdn} nginx status'</span></span> : target: /etc/icinga2/zones.d/master/%{::fqdn}.conf apply: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> assign: [ <span class="hljs-string"><span class="hljs-string">'host.name == %{::fqdn}'</span></span> ] command_endpoint: <span class="hljs-string"><span class="hljs-string">'%{::fqdn}'</span></span> display_name: <span class="hljs-string"><span class="hljs-string">'nginx status'</span></span> check_command: <span class="hljs-string"><span class="hljs-string">'nginx_status'</span></span> vars: nginx_status_host_address: localhost nginx_status_servername: server.com nginx_status_critical: <span class="hljs-string"><span class="hljs-string">'1600,60,30'</span></span> nginx_status_warn: <span class="hljs-string"><span class="hljs-string">'1500,55,25'</span></span> <span class="hljs-string"><span class="hljs-string">'%{::fqdn} redis'</span></span>: target: /etc/icinga2/zones.d/master/%{::fqdn}.conf apply: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> assign: [ <span class="hljs-string"><span class="hljs-string">'host.name == %{::fqdn}'</span></span> ] display_name: <span class="hljs-string"><span class="hljs-string">'Redis'</span></span> command_endpoint: <span class="hljs-string"><span class="hljs-string">'%{::fqdn}'</span></span> check_command: <span class="hljs-comment"><span class="hljs-comment">"redis"</span></span> vars: redis_hostname: localhost redis_port: <span class="hljs-number"><span class="hljs-number">6379</span></span> redis_perfvars: <span class="hljs-string"><span class="hljs-string">'*'</span></span> #=========================================================================#</code> </pre><br><br><h2> è¿™ç§æ–¹æ¡ˆçš„ä¸€èˆ¬æ“ä½œæ–¹æ¡ˆä»…åŒ…å«ä¸¤ä¸ªç®€å•çš„æ“ä½œï¼š </h2><br><ol><li>  <b>æˆ‘ä»¬åœ¨ä¸»æœºä¸Šå¯åŠ¨puppet-ä¸»æœºçœ‹åˆ°å±äºå®ƒçš„æ”¯ç¥¨å¹¶å°†å…¶å¯¼å‡ºåˆ°puppetDBã€‚</b> <b><br></b> <br></li><li>  <b>åœ¨icinga2å®¹å™¨ä¸­è¿è¡Œpuppet-æ¥è‡ªpuppetdbçš„æ£€æŸ¥å°†è½¬æ¢ä¸ºçœŸæ­£çš„Icinga2é…ç½®ã€‚</b> <b><br></b> <br></li></ol><br> åœ¨è¿™é‡Œï¼Œè®¸å¤šäººä¼šè¯´ï¼š <i>â€œå¦‚æœæˆ‘èƒ½ä¸¾èµ·å¹³å¸¸çš„icinga2å¹¶ç”¨æ‰‹æˆ–é€šè¿‡Webç•Œé¢æ·»åŠ æ”¯ç¥¨ï¼Œä¸ºä»€ä¹ˆè¦ä½¿è¿™ä¸€åˆ‡æˆä¸ºç°å®ï¼Ÿâ€</i> <br><br> çš„ç¡®ï¼Œå¦‚æœæ‚¨éœ€è¦ç›‘è§†åäºŒä¸ªä¸»æœºå¹¶æä¾›â€‹â€‹æ•°ç™¾ç§æœåŠ¡ï¼Œå¹¶ä¸”æ‚¨æ˜¯ä¸€ä¸ªéå¸¸æ•´æ´çš„äººï¼Œå¹¶ä¸”æ‹¥æœ‰è‰¯å¥½çš„è®°å¿†åŠ›ï¼ˆè‡ªç„¶ç•Œä¸­æ‰¾ä¸åˆ°ï¼‰ï¼Œé‚£ä¹ˆå›´å µèŠ±å›­æ¯«æ— æ„ä¹‰ã€‚ å¦‚æœæ‚¨æ‹¥æœ‰ç›¸å½“å¤§çš„åŸºç¡€æ¶æ„ï¼Œå¹¶ä¸”æ„Ÿè§‰åˆ°æ‚¨å¯èƒ½å¿˜è®°äº†æŸä¸ªåœ°æ–¹ï¼Œé‚£å°±å®Œå…¨ä¸åŒäº†ã€‚ åœ¨è¿™æ ·çš„æ—¶åˆ»ï¼Œè‡ªåŠ¨åŒ–æœ‰å¾ˆå¤§å¸®åŠ©ï¼Œå› ä¸º æœ‰åŠ©äºå°†æ‰€æœ‰ç‰©å“æ”¾åœ¨è´§æ¶ä¸Šï¼Œå¹¶åœ¨è®¸å¤šæ–¹é¢é¿å…äº†äººä¸ºå› ç´ ã€‚ <br><br><h2> è¡¨ç¤ºä¸»è¦ä¼˜ç‚¹ï¼š </h2><br>  <b>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªæ¨¡æ¿ï¼š</b> <br><br><pre> <code class="hljs pgsql">icinga2_service: <span class="hljs-string"><span class="hljs-string">'%{::fqdn} disk service'</span></span>: target: /etc/icinga2/zones.d/master/%{::fqdn}.conf apply: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> assign: [ <span class="hljs-string"><span class="hljs-string">'host.name == %{::fqdn}'</span></span> ] display_name: <span class="hljs-string"><span class="hljs-string">'Disk usage'</span></span> command_endpoint: <span class="hljs-string"><span class="hljs-string">'%{::fqdn}'</span></span> check_command: <span class="hljs-string"><span class="hljs-string">'disk'</span></span> vars: #<span class="hljs-keyword"><span class="hljs-keyword">All</span></span> disks disk_all: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> disk_exclude_type: - aufs - tmpfs disk_ignore_ereg_path: - /run/docker<span class="hljs-comment"><span class="hljs-comment">/* - /sys/* - /var/lib/docker* - /var/lib/ureadahead/debugfs/* - /run/user/*</span></span></code> </pre><br> <b>+ 1.     Hiera            â€” ..  .    Icinga2,   ,         .   ,     , ,    . <br></b> <br> <b>+ 2.    ,     .       â€”           . <br></b> <br> <b>+ 3.        , ..       ,          Icinga2     ,  puppet   Icinga2. <br></b> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ 4.å› æ­¤ï¼Œæˆ‘ä»¬å·²å°†æ‰€æœ‰æ£€æŸ¥å­˜å‚¨åœ¨ä¸€ä¸ªpuppetDBæ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºåŠŸèƒ½å¼ºå¤§çš„è„šæœ¬æ¥è¿›ä¸€æ­¥è‡ªåŠ¨åŒ–ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­ä½¿ç”¨æ­¤ä¿¡æ¯ã€‚ </font></font><br></b> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ‰€ä»¥èµ°å§ </font></font></h2><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.è®¾ç½®äººå¶ã€‚ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸Œæœ›æ‚¨å·²ç»é…ç½®äº†dockerå’Œdocker-composeã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦å®‰è£…å®ƒä»¬ï¼š</font></font><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®‰è£…Docker ... </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®‰è£…Docker-compose ...</font></font></a> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.æˆ‘ä»¬å°†å­˜å‚¨åº“å…‹éš†åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼š </font></font></h3><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> http://git.comgress64.com/external/puppet-icinga2-how-to.git</code> </pre><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3.ä½¿ç”¨æ‚¨å–œæ¬¢çš„ç¼–è¾‘å™¨æ‰“å¼€docker-compose.yamlå¹¶æŸ¥çœ‹å®ƒã€‚ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬çœ‹åˆ°åœ¨è¿™ä¸ªåŒ…ä¸­ï¼Œæˆ‘ä»¬æœ‰å‡ ä¸ªå®¹å™¨åŒæ—¶å‡ºç°-PuppetServerï¼ŒPuppetDbï¼ŒPostgreSQLæœåŠ¡å™¨å’ŒPuppetBoardã€‚</font><font style="vertical-align: inherit;">è¿˜ä»å½“å‰ç›®å½•è£…å…¥å·ã€‚</font><font style="vertical-align: inherit;">æ­¤é…ç½®å¹¶éæ‰€æœ‰äººéƒ½æœ€ä½³ï¼Œå› æ­¤è¯·è€ƒè™‘æ‚¨çš„åŸºç¡€æ¶æ„ã€‚</font><font style="vertical-align: inherit;">æŸäººå·²ç»æ‹¥æœ‰PostgreSQLæœåŠ¡å™¨ï¼ŒæŸäººæƒ³å°†ä»£ç å­˜å‚¨åœ¨å¦ä¸€éƒ¨åˆ†ä¸­-è¿™æ˜¯åˆ›é€ çš„è‡ªç”±ã€‚</font><font style="vertical-align: inherit;">åœ¨æ­¤é˜¶æ®µï¼Œæˆ‘å»ºè®®ä¿ç•™é»˜è®¤æ¨¡æ¿-æ‚¨ä»¥åå¯ä»¥éšæ—¶è¿”å›å®ƒã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬æ‹¿èµ·æˆ‘ä»¬çš„å®¹å™¨åŒ…ï¼Œçœ‹çœ‹å‘ç”Ÿäº†ä»€ä¹ˆï¼š</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.å¯åŠ¨Puppetï¼ŒPostgresï¼ŒPuppetdbå’ŒGraphiteå®¹å™¨ã€‚ </font></font></h3><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  Puppet, Postgres  Puppetdb #  Puppet, Postgres, Puppetdb  Graphite cd puppet-icinga2-how-to docker-compose up -d puppet puppetdb-postgres puppetdb graphite &amp;&amp; docker-compose logs -f</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»åŠ è½½äº†å¤šä¸ªæ˜ åƒå¹¶å¯åŠ¨äº†å®¹å™¨ï¼Œå¹¶åœ¨PostgreSQLä¸­åˆ›å»ºäº†æ•°æ®åº“ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ç­‰å¾…æ‰€æœ‰æœåŠ¡å™¨å¯åŠ¨-é”™è¯¯å¯ä»¥å¿½ç•¥ï¼Œå› ä¸ºå®ƒä»¬ä¼šåœ¨ä¸€æ®µæ—¶é—´åç¨³å®šä¸‹æ¥ã€‚</font><font style="vertical-align: inherit;">æŒ‰Ctrl + Cé€€å‡ºæ—¥å¿—æŸ¥çœ‹æ¨¡å¼ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5.æ£€æŸ¥æˆ‘ä»¬çš„æœ¨å¶å¤§å¸ˆçš„å·¥ä½œï¼š </font></font></h3><br><pre> <code class="bash hljs">docker run --net puppeticinga2howto_default --link puppet:puppet puppet/puppet-agent</code> </pre><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6.å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ‚¨å°†çœ‹åˆ°ä»¥ä¸‹ç»“è®ºï¼š </font></font></h3><br><pre> <code class="bash hljs">Notice: Applied catalog <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 0.03 seconds Changes: Total: 1 Events: Success: 1 Total: 1 Resources: Changed: 1 Out of sync: 1 Total: 8 Time: Schedule: 0.00 File: 0.00 Transaction evaluation: 0.01 Catalog application: 0.03 Convert catalog: 0.04 Config retrieval: 0.45 Node retrieval: 1.38 Last run: 1532605377 Fact generation: 2.24 Plugin sync: 4.50 Filebucket: 0.00 Total: 8.65 Version: Config: 1532605376 Puppet: 5.5.1</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è®¾ç½®Icinga2æœåŠ¡å™¨ã€‚ </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7.é€šè¿‡æ‰§è¡Œä»¥ä¸‹æ“ä½œä»Dockerfileä¸­åˆ›å»ºæ˜ åƒï¼š </font></font></h3><br><pre> <code class="bash hljs">docker-compose build icinga</code> </pre><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8.è¿è¡Œå°†å®¹çº³Icinga2æœåŠ¡å™¨çš„å®¹å™¨ã€‚ </font></font></h3><br><pre> <code class="bash hljs">docker-compose up -d icinga</code> </pre><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„å®¹å™¨æ˜¯ç©ºçš„ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬é€šè¿‡æ‰§è¡Œä»¥ä¸‹æ“ä½œæ¥ä½¿ç”¨æˆ‘ä»¬çš„PuppetæœåŠ¡å™¨é…ç½®icinga2æœåŠ¡å™¨ï¼š</font></font></h3><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   puppet  librarian-puppet   puppet docker-compose exec puppet bash -c 'cd /etc/puppetlabs/code &amp;&amp; gem install librarian-puppet &amp;&amp; librarian-puppet install --verbose' # Puppet   Icinga     docker-compose exec icinga puppet agent --server puppet --waitforcert 60 --test</span></span></code> </pre><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 10.å®‰è£…å¹¶é…ç½®Icingaï¼ŒIcingaweb2å’ŒApacheã€‚ </font></font></h3><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ‚¨çš„Icinga2æœåŠ¡å™¨å·²å‡†å¤‡å°±ç»ªï¼ </font></font></h2><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Icingaweb2 </font></font></h2><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬å¾—åˆ°äº†ä»€ä¹ˆã€‚ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ç›‘è§†ç³»ç»Ÿçš„çŠ¶æ€å¾ˆæ–¹ä¾¿ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€</font></font><font color="#0000aa"><u><code>http://ip___:8081/icingaweb2</code></u></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶ä½¿ç”¨é»˜è®¤ç”¨æˆ·å</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">icingaadmin / icingaè½¬åˆ°Icinga</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬çœ‹åˆ°è¿™å¼ å›¾ç‰‡ï¼š</font></font></b> <br><br><img src="https://habrastorage.org/webt/vg/hr/zn/vghrznlioinsw68lgide-onot9o.png"><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡ åˆ†é’Ÿåï¼Œæˆ‘ä»¬çœ‹åˆ°æ‰€æœ‰æ£€æŸ¥éƒ½å¯¹æˆ‘ä»¬</font></font></b> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰ç”¨</font><b><font style="vertical-align: inherit;">ï¼š</font></b></font><br><br><img src="https://habrastorage.org/webt/ju/5a/ds/ju5adsckudygkhbejybx4k7fmz4.png"><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å›¾å½¢ä¹Ÿèµ·ä½œç”¨ï¼š</font></font></b> <br><br><img src="https://habrastorage.org/webt/hy/6i/lw/hy6ilwnlp0ua6fdoouzo-8t7rog.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬æœ‰ä¸€ä¸ªé€‚ç”¨äºIcinga2çš„Webç¯å¢ƒï¼Œä½†æ˜¯è¿˜æ²¡æœ‰ä¸»æœºè¿æ¥åˆ°Icingaï¼Œè®©æˆ‘ä»¬è¿æ¥ç¬¬ä¸€ä¸ªä¸»æœºã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.å°†æ–°ä¸»æœºè¿æ¥åˆ°ç›‘è§†ç³»ç»Ÿ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬åªæœ‰ä¸€å°ä¸»æœºè¿æ¥åˆ°icinga2-Icingaæœ¬èº«ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬è¿æ¥å¦ä¸€ä¸ªã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘åœ¨dockerä¸­æ˜¾ç¤ºä¸€ä¸ªç¤ºä¾‹ï¼Œä½†æ˜¯æ‰€æœ‰è¿™äº›éƒ½å¯ä»¥åœ¨è£¸æœºä¸Šè¿è¡Œï¼š</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¦–å…ˆï¼Œæ‚¨éœ€è¦å‡†å¤‡ä¸€ä¸ªæ¨¡æ¿ï¼Œå¹¶æä¾›ä¸€äº›æœ‰å…³æœ¨å¶ä¸»æœºçš„ä¿¡æ¯ï¼š</font></font></b> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    cd puppet-icinga2-how-to/code/environments/production/hieradata/nodes #    (   ) cp template.yaml example.com.yaml #       : host_address: 172.18.0.7 my_company: COMGRESS64 my_package_manager: apt my_ssh_port: 22 #   </span></span></code> </pre><br> <b>  .      hostname      ,     :</b> <br><br><pre> <code class="bash hljs">docker run --hostname example.com --rm -t --link puppet:puppet --net puppeticinga2howto_default -i phusion/baseimage:latest /sbin/my_init -- bash -l</code> </pre><br> <b> puppet   :</b> <br><br><pre> <code class="bash hljs">apt-get update &amp;&amp; apt-get install -y ruby make gcc perl-modules &amp;&amp; gem install --no-ri --no-rdoc puppet</code> </pre><br> <b> puppet:</b> <br><br><pre> <code class="bash hljs">puppet agent --server puppet --waitforcert 60 --<span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre><br> <b>    icinga2             puppetDB.   ,  puppet   icinga2:</b> <br><br><pre> <code class="bash hljs">docker-compose <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> icinga puppet agent --server puppet --waitforcert 60 --<span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬é€šè¿‡æµè§ˆå™¨æŸ¥çœ‹å¾—åˆ°çš„ç»“æœï¼š</font></font></b> <br><br><img src="https://habrastorage.org/webt/tc/ko/uc/tckoucinbkuwoqh_bhquehthj-i.png"><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å·²æ·»åŠ æ£€æŸ¥å¹¶ç­‰å¾…å®Œæˆã€‚</font></font></b> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5åˆ†é’Ÿåï¼š</font></font></b> <br><br><img src="https://habrastorage.org/webt/-9/va/dv/-9vadvzxjwxepukpbjoinxt0h9a.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥åŒæ ·çš„æ–¹å¼ï¼Œå°†æ‰€æœ‰å…¶ä»–ä¸»æœºæ·»åŠ åˆ°ç³»ç»Ÿä¸­ã€‚æˆ‘æƒ³æè¯·æ‚¨æ³¨æ„è¿™ä¸ªæŒ‡å—æ˜¯ä¸€ä¸ªæ¦‚å¿µè¯æ˜ï¼Œæœªç»ä¿®æ”¹å°±ä¸èƒ½åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœè¿™ç¯‡æ–‡ç« çœ‹èµ·æ¥å¾ˆæœ‰è¶£ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡æˆ‘å°†å±•ç¤ºå¦‚ä½•æ·»åŠ å„ç§æœ‰è¶£çš„è‡ªå®šä¹‰æ£€æŸ¥ï¼Œå…±äº«ç§˜å¯†ä»¥åŠè®²è¿°å„ç§å¾®å¦™ä¹‹å¤„ã€‚å¦å¤–ï¼Œå¦‚æœæœ‰éœ€è¦ï¼Œæˆ‘ä¼šä»å†…éƒ¨æ›´è¯¦ç»†åœ°ä»‹ç»è¿™ä¸€åˆ‡çš„å·¥ä½œæ–¹å¼ã€‚</font></font><br><br>  <b>æ„Ÿè°¢æ‚¨çš„å…³æ³¨ï¼</b> <br><br><hr><br> <b>      Confluence:</b> <br> <i>/    ./</i> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b>docs.comgress64.com/...</b></a> <br><br> <b>  :</b> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://github.com/Icinga/puppet-icinga2</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://forge.puppet.com/icinga/icingaweb2</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://docs.docker.com/</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://docs.puppet.com/</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://docs.puppet.com/hiera/</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN420199/">https://habr.com/ru/post/zh-CN420199/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN420189/index.html">æ²¡æœ‰å€Ÿå£ä¿±ä¹éƒ¨ï¼šMassimiliano Sichiçš„æ— é™æ¯…åŠ›</a></li>
<li><a href="../zh-CN420191/index.html">SONIAå›¢é˜Ÿï¼šè‡ªåŠ¨é©¾é©¶æ°´ä¸‹èˆªè¡Œå™¨çš„æœªæ¥</a></li>
<li><a href="../zh-CN420193/index.html">å¸¦æœ‰CISSçš„æ‰“å°æœºï¼šé€‰æ‹©å¹¶æ¯”è¾ƒæ‰“å°æˆæœ¬</a></li>
<li><a href="../zh-CN420195/index.html">åœ¨é¦–éƒ½å·¥ä½œçš„åœ°æ–¹-è«æ–¯ç§‘15åˆä½œçš„ç®€è¦æ¦‚è¿°</a></li>
<li><a href="../zh-CN420197/index.html">ä½¿ç”¨glock cuzdraæ–¹æ³•åˆ›å»ºAIã€‚ æ™ºåŠ›å¥¥å¾·èµ›</a></li>
<li><a href="../zh-CN420201/index.html">ä¸ºä»€ä¹ˆè¥¿æ–¹äººå®³æ€•æœºå™¨äººï¼Œè€Œæ—¥æœ¬äººå´ä¸å®³æ€•ï¼Ÿ</a></li>
<li><a href="../zh-CN420203/index.html">è¿™ä½å°‘å¹´é˜»æ­¢äº†é‡å­è®¡ç®—çš„æˆåŠŸ</a></li>
<li><a href="../zh-CN420205/index.html">åŸºäºDNAçš„ROMï¼Œæ ¸é…¸å­˜å‚¨å™¨å’ŒOxRAMçš„åº•ç‰©</a></li>
<li><a href="../zh-CN420209/index.html">OpenAIæ¼”ç¤ºäº†å¤æ‚æ“ä½œä»æ¨¡æ‹Ÿåˆ°ç°å®ä¸–ç•Œçš„è½¬ç§»</a></li>
<li><a href="../zh-CN420211/index.html">å…³äºæœºå™¨å­¦ä¹ çš„ç¥å¥‡æ€ç»´ä¸ä¼šä½¿çœŸæ­£çš„AIæ›´åŠ ç´§å¯†</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>