<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍👨‍👧‍👦 👏🏽 🎅🏻 So aktualisieren Sie ein vorhandenes Projekt von ASP.NET MVC auf ASP.NET Core. Praktische Anleitung 🧘🏽 👩🏻‍🚀 ⏲️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dieser Beitrag wurde aus unserer Erfahrung mit der Migration eines vorhandenen Projekts von ASP.NET MVC auf ASP.NET Core erstellt. Wir haben versucht,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>So aktualisieren Sie ein vorhandenes Projekt von ASP.NET MVC auf ASP.NET Core. Praktische Anleitung</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472738/">  Dieser Beitrag wurde aus unserer Erfahrung mit der Migration eines vorhandenen Projekts von ASP.NET MVC auf ASP.NET Core erstellt.  Wir haben versucht, den gesamten Migrationsprozess in strukturierter Form zusammenzustellen und die verschiedenen Engpässe zu beschreiben, damit sich Entwickler weiterhin auf dieses Material verlassen und die Roadmap zur Lösung solcher Probleme befolgen können. <br><br>  Ein paar Worte zu unserem Projekt.  Wir sind eine Open-Source-E-Commerce-Plattform auf ASP.NET, die zum Zeitpunkt der Übertragung bereits seit 9 Jahren erfolgreich besteht.  Wir haben die Migration vor 2 Jahren durchgeführt - aber unsere Hände kamen erst jetzt, um darüber zu schreiben.  Zu dieser Zeit waren wir eines der ersten großen Projekte, die sich für einen solchen Schritt entschieden haben. <br><br><h2>  Warum zu ASP.NET Core wechseln? </h2><br>  Bevor Sie mit den Schritten zur Migration von ASP.NET MVC zu ASP.NET Core fortfahren, einige Worte zu den Vorteilen dieser Plattform. <br><br><img src="https://habrastorage.org/webt/wo/xg/ue/woxgueorhrjz_brki1qktunkqhe.png"><br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Vorteile von ASP.NET Core</b> <div class="spoiler_text"> Daher ist ASP.NET Core bereits ein ziemlich bekanntes und entwickeltes Framework, das bereits mehrere wichtige Aktualisierungen erfahren hat. Dies bedeutet, dass es heute recht stabil, technologisch fortschrittlich und resistent gegen XSRF / CSRF-Angriffe ist. <br><br>  <b>Plattformübergreifend</b> ist eines der Markenzeichen, die es ihm ermöglichen, immer beliebter zu werden.  Von nun an kann Ihre Webanwendung sowohl in Windows- als auch in Unix-Umgebungen ausgeführt werden. <br><br>  <b>Modularität</b> - ASP.NET Core wird vollständig in Form von NuGet-Paketen geliefert. Auf diese Weise können Sie die Anwendung einschließlich der ausgewählten erforderlichen Pakete optimieren.  Dies verbessert die Leistung der Lösung und reduziert den Zeitaufwand für das Upgrade einzelner Teile.  Dies ist die zweite wichtige Funktion, mit der Entwickler neue Funktionen flexibler in ihre Lösung integrieren können. <br><br>  <b>Die Leistung</b> ist ein weiterer Schritt zum Erstellen einer Hochleistungsanwendung. ASP.NET Core verarbeitet 2300% mehr Anforderungen pro Sekunde als ASP.NET 4.6 und 800% mehr Anforderungen pro Sekunde als node.js.  Detaillierte Leistungstests können Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> oder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> selbst prüfen. <br><br><img src="https://habrastorage.org/webt/wb/vg/oi/wbvgoixwdbcfr0m8l0myjywrlpq.png"><br><br>  <b>Middleware</b> ist die neue leichte modulare Hochleistungs-Pipeline für In-App-Anfragen.  Jede Middleware verarbeitet eine HTTP-Anforderung und entscheidet sich dann entweder für die Rückgabe des Ergebnisses oder übergibt die nächste Middleware.  Dieser Ansatz gibt dem Entwickler die vollständige Kontrolle über die HTTP-Pipeline und trägt zur Entwicklung einfacher Module für die Anwendung bei, was für ein wachsendes Open Source-Projekt wichtig ist. <br><br>  ASP.NET Core MVC bietet Funktionen, die die Webentwicklung vereinfachen.  NopCommerce verwendete bereits Funktionen wie die Model-View-Controller-Vorlage, die Razor-Syntax, die Modellbindung und die Validierung. Es wurden jedoch neue Tools veröffentlicht: <br><br><ul><li>  Tag Helfer.  Dies ist serverseitiger Code, der zum Erstellen und Rendern von HTML-Elementen in Razor-Dateien beiträgt. </li><li>  Komponenten anzeigen.  Dies ist ein neues Tool, ähnlich wie Teilansichten, aber viel leistungsfähiger.  nopCommerce verwendet Ansichtskomponenten, wenn die Wiederverwendung der Renderlogik erforderlich ist und die Aufgabe für eine Teilansicht zu komplex ist. </li><li>  DIs Ansicht.  Obwohl die meisten in den Ansichten angezeigten Daten vom Controller übergeben werden, verfügt nopCommerce über Ansichten, in denen die Abhängigkeitsinjektion bequemer ist. </li></ul><br>  Natürlich hat ASP.NET Core viel mehr Funktionen, aber wir haben gerade die interessantesten untersucht. </div></div><br>  Lassen Sie uns nun darüber sprechen, was Sie beim Portieren Ihrer Anwendung auf eine neue Plattform beachten sollten. <br><br><h2>  Die Migration </h2><br>  Der Text enthält eine Vielzahl von Links zur offiziellen ASP.NET Core-Dokumentation, um detailliertere Informationen zum Thema zu erhalten.  Besonders relevant für Entwickler, die zum ersten Mal vor einer ähnlichen Aufgabe stehen. <br><br><h3>  Schritt 1. Vorbereitung der Werkzeuge </h3><br>  Als erstes müssen Sie Visual Studio 2017 auf Version 15.3 oder höher aktualisieren.  Installieren Sie die neueste Version des .NET Core SDK. <br><br>  Bevor Sie mit der Migration beginnen, wird empfohlen, das Portability Analysis-Tool .NET <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">.Net Portability Analyzer zu</a> verwenden.  Dies ist ein guter Ausgangspunkt, um zu verstehen, wie mühsam der Übergang von einer Plattform zur anderen sein wird.  Aber dieses Tool löst natürlich nicht alle Probleme, und dabei gibt es viele Fallstricke.  Als nächstes werden die Hauptphasen beschrieben, die bestanden werden müssen, und die in unserem Projekt verwendeten Lösungen werden gezeigt. <br><br>  Als erstes müssen Sie die Links zu den im Projekt verwendeten Bibliotheken aktualisieren, die .NET Standard unterstützen würden. <br><br><h3>  Schritt 2. Kompatibilitätsanalyse von NuGet-Paketen zur Unterstützung von .Net Standard </h3><br>  Wenn Sie NuGet-Pakete in Ihrem Projekt verwenden, müssen Sie überprüfen, ob sie mit .NET Core kompatibel sind.  Eine Möglichkeit hierfür ist die Verwendung des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">NuGetPackageExplorer-</a> Tools. <br><br><h3>  Schritt 3. .NET Core verwendet das neue csproj-Dateiformat </h3><br>  Es ist wichtig, den neuen Ansatz zum Hinzufügen von in .NET Core eingeführten Links von Drittanbietern zu verwenden: Wenn der Lösung eine neue Klassenbibliothek hinzugefügt wird, sollten Sie die Hauptprojektdatei öffnen und deren Inhalt durch Folgendes ersetzen: <br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Sdk</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Microsoft.NET.Sdk"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TargetFramework</span></span></span><span class="hljs-tag">&gt;</span></span>netcoreapp2.2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TargetFramework</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PackageReference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Microsoft.AspNetCore.App"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2.2.6"</span></span></span><span class="hljs-tag"> /&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Project</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Links aus verbundenen Bibliotheken werden automatisch heruntergeladen.  Weitere Informationen zur Zuordnung zwischen den Eigenschaften project.json und CSPROJ finden Sie in der offiziellen Dokumentation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br><h3>  Schritt 4. Aktualisieren des Namespace </h3><br>  Sie müssen alle Verwendungen von System.Web entfernen und durch Microsoft.AspNetCore ersetzen. <br><br><h3>  Schritt 5. Sie müssen die Datei Startup.cs konfigurieren.  anstatt global.asax zu verwenden </h3><br>  ASP.NET Core verfügt über einen neuen Mechanismus zum Laden der Anwendung.  Der Einstiegspunkt in die Anwendung wird zu <code>Startup</code> , und die Abhängigkeit von der Datei <i>Global.asax</i> verschwindet.  <code>Startup</code> die Middleware-Suite in der Anwendung registriert.  <code>Startup</code> muss die <code>Configure</code> Methode enthalten.  <code>Configure</code> die erforderliche Middleware zur Pipeline hinzu. <br><br>  <b>Probleme mit Startup.cs</b> <br><br><ol><li>  Middleware für MVC- und WebAPI-Anforderungen konfigurieren </li><li>  Konfigurationseinstellungen für: </li></ol><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ausnahmebehandlung</a> <br><p>  Da Sie während des Übergangs unweigerlich mit verschiedenen Arten von Kollisionen zu kämpfen haben, müssen Sie die Ausnahmebehandlung in der Entwicklungsumgebung sofort vorbereiten und einrichten.  Mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">UseDeveloperExceptionPage</a> wird Middleware hinzugefügt, um Ausnahmen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">abzufangen</a> . </p></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Routing MVC</a> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die Registrierung neuer Routen wurde</a> ebenfalls geändert.  IRouteBuilder wird jetzt anstelle von RouteCollection verwendet, einer neuen Methode zum <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Registrieren von Einschränkungen</a> (IActionConstraint). </p></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MVC / WebAPI-Filter</a> <br><p>  Sie müssen die Filter gemäß der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">neuen ASP.NET Core-Implementierung</a> neu schreiben. </p></li><li>  MVC / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">WebAPI-Formatierer</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bindungsmodelle</a> </li></ul><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//add basic MVC feature var mvcBuilder = services.AddMvc(); //add custom model binder provider (to the top of the provider list) mvcBuilder.AddMvcOptions(options =&gt; options.ModelBinderProviders.Insert(0, new NopModelBinderProvider())); /// &lt;summary&gt; /// Represents model binder provider for the creating NopModelBinder /// &lt;/summary&gt; public class NopModelBinderProvider : IModelBinderProvider { /// &lt;summary&gt; /// Creates a nop model binder based on passed context /// &lt;/summary&gt; /// &lt;param name="context"&gt;Model binder provider context&lt;/param&gt; /// &lt;returns&gt;Model binder&lt;/returns&gt; public IModelBinder GetBinder(ModelBinderProviderContext context) { if (context == null) throw new ArgumentNullException(nameof(context)); var modelType = context.Metadata.ModelType; if (!typeof(BaseNopModel).IsAssignableFrom(modelType)) return null; //use NopModelBinder as a ComplexTypeModelBinder for BaseNopModel if (context.Metadata.IsComplexType &amp;&amp; !context.Metadata.IsCollectionType) { //create binders for all model properties var propertyBinders = context.Metadata.Properties .ToDictionary(modelProperty =&gt; modelProperty, modelProperty =&gt; context.CreateBinder(modelProperty)); return new NopModelBinder(propertyBinders, EngineContext.Current.Resolve&lt;ILoggerFactory&gt;()); } //or return null to further search for a suitable binder return null; } }</span></span></code> </pre> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bereiche</a> </li></ul><br><br><pre> <code class="java hljs">app.UseMvc(routes =&gt; { routes.MapRoute(<span class="hljs-string"><span class="hljs-string">"areaRoute"</span></span>, <span class="hljs-string"><span class="hljs-string">"{area:exists}/{controller=Admin}/{action=Index}/{id?}"</span></span>); routes.MapRoute( name: <span class="hljs-string"><span class="hljs-string">"default"</span></span>, template: <span class="hljs-string"><span class="hljs-string">"{controller=Home}/{action=Index}/{id?}"</span></span>); });</code> </pre> <br>  Gleichzeitig sollte der Ordner mit dem Namen Bereich, in dem sich der Admin-Ordner befindet, im Stammverzeichnis der Anwendung abgelegt werden.  Jetzt wird das Attribut <code>[Area("Admin")] [Route("admin")]</code> verwendet, um den Controller mit diesem Bereich zu verbinden. <br>  Es müssen nur noch Ansichten für alle in der Steuerung beschriebenen Aktionen erstellt werden. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3o/eo/rp/3oeorp_vjlbwlisc1kbavvvaeoe.png"></div><br><pre> <code class="java hljs">[Area(<span class="hljs-string"><span class="hljs-string">"Admin"</span></span>)] [Route(<span class="hljs-string"><span class="hljs-string">"admin"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AdminController</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(); } }</code> </pre> <br>  <b>Validierung</b> <br><br>  Jetzt müssen Sie IFormCollection nicht mehr an die Controller übergeben, da in diesem Fall die Servervalidierung von asp.net deaktiviert ist. MVC unterdrückt die weitere Validierung, wenn festgestellt wird, dass die IFormCollection nicht null ist.  Die Lösung des Problems kann darin bestehen, diese Eigenschaft dem Modell hinzuzufügen. Dadurch wird verhindert, dass wir direkt an die Controller-Methode übergeben.  Diese Regel ist nur gültig, wenn ein Modell vorhanden ist. Wenn jedoch kein Modell vorhanden ist, erfolgt keine Validierung. <br><br>  Untergeordnete Eigenschaften werden nicht mehr automatisch überprüft.  Es muss manuell angegeben werden. <br><br><h3>  Schritt 6. Übertragen von HTTP-Handlern und HTTP-Modulen auf Middleware </h3><br>  HTTP-Handler und HTTP-Module sind dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://docs.microsoft.com/ru-ru/aspnet/core/migration/">Middleware-</a> Konzept <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://docs.microsoft.com/ru-ru/aspnet/core/migration/">in ASP.NET Core</a> im Wesentlichen sehr ähnlich. Im Gegensatz zu Modulen basiert die Middleware-Reihenfolge jedoch auf der Reihenfolge, in der sie in die Anforderungspipeline eingefügt werden.  Die Reihenfolge der Module basiert größtenteils auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anwendungslebenszyklusereignissen</a> .  Die Reihenfolge der Middleware für die Antworten ist das Gegenteil der Reihenfolge der Anforderungen, und die Reihenfolge der Module für die Anforderungen und Antworten ist dieselbe. Auf dieser Grundlage können Sie mit dem Upgrade fortfahren. <br><br>  Also, was bleibt noch zu aktualisieren: <br><br><ul><li>  Migration von Modulen für Middleware (AuthenticationMiddleware, CultureMiddleware usw.) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://docs.microsoft.com/en-us/aspnet/core/migration/">Handler</a> für Middleware </li><li>  Neue Middleware verwenden </li></ul><br>  Bei der Authentifizierung in unserem Projekt wird nicht das integrierte Anmeldeinformationssystem verwendet. Für diese Zwecke wird die Middleware AuthenticationMiddleware verwendet, die gemäß der neuen ASP.NET Core-Struktur entwickelt wurde. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthenticationMiddleware</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> readonly RequestDelegate _next; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AuthenticationMiddleware</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IAuthenticationSchemeProvider schemes, RequestDelegate next)</span></span></span><span class="hljs-function"> </span></span>{ Schemes = schemes ?? <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(nameof(schemes)); _next = next ?? <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(nameof(next)); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IAuthenticationSchemeProvider Schemes { get; set; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> async Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpContext context)</span></span></span><span class="hljs-function"> </span></span>{ context.Features.Set&lt;IAuthenticationFeature&gt;(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AuthenticationFeature { OriginalPath = context.Request.Path, OriginalPathBase = context.Request.PathBase }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handlers = context.RequestServices.GetRequiredService&lt;IAuthenticationHandlerProvider&gt;(); foreach (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scheme in await Schemes.GetRequestHandlerSchemesAsync()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (await handlers.GetHandlerAsync(context, scheme.Name) is IAuthenticationRequestHandler handler &amp;&amp; await handler.HandleRequestAsync()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ignored } } var defaultAuthenticate = await Schemes.GetDefaultAuthenticateSchemeAsync(); if (defaultAuthenticate != null) { var result = await context.AuthenticateAsync(defaultAuthenticate.Name); if (result?.Principal != null) { context.User = result.Principal; } } await _next(context); } }</span></span></code> </pre> <br>  ASP.NET bietet viele eingebettete Middleware, die Sie in Ihrer Anwendung verwenden können. Beachten Sie jedoch, dass der Entwickler <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">seine eigene Middleware erstellen</a> und zur HTTP-Anforderungspipeline hinzufügen kann.  Um diesen Mechanismus zu vereinfachen, haben wir eine spezielle Schnittstelle hinzugefügt. Jetzt reicht es aus, nur eine Klasse zu erstellen, die ihn implementiert. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">INopStartup</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/// &lt;summary&gt; /// Add and configure any of the middleware /// &lt;/summary&gt; /// &lt;param name="services"&gt;Collection of service descriptors&lt;/param&gt; /// &lt;param name="configuration"&gt;Configuration of the application&lt;/param&gt; void ConfigureServices(IServiceCollection services, IConfiguration configuration); /// &lt;summary&gt; /// Configure the using of added middleware /// &lt;/summary&gt; /// &lt;param name="application"&gt;Builder for configuring an application's request pipeline&lt;/param&gt; void Configure(IApplicationBuilder application); /// &lt;summary&gt; /// Gets order of this startup configuration implementation /// &lt;/summary&gt; int Order { get; } }</span></span></code> </pre> <br>  Hier können Sie Ihre Middleware hinzufügen und konfigurieren: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/// &lt;summary&gt; /// Represents object for the configuring authentication middleware on application startup /// &lt;/summary&gt; public class AuthenticationStartup : INopStartup { /// &lt;summary&gt; /// Add and configure any of the middleware /// &lt;/summary&gt; /// &lt;param name="services"&gt;Collection of service descriptors&lt;/param&gt; /// &lt;param name="configuration"&gt;Configuration of the application&lt;/param&gt; public void ConfigureServices(IServiceCollection services, IConfiguration configuration) { //add data protection services.AddNopDataProtection(); //add authentication services.AddNopAuthentication(); } /// &lt;summary&gt; /// Configure the using of added middleware /// &lt;/summary&gt; /// &lt;param name="application"&gt;Builder for configuring an application's request pipeline&lt;/param&gt; public void Configure(IApplicationBuilder application) { //configure authentication application.UseNopAuthentication(); } /// &lt;summary&gt; /// Gets order of this startup configuration implementation /// &lt;/summary&gt; public int Order =&gt; 500; //authentication should be loaded before MVC }</span></span></code> </pre> <br><h3>  Schritt 7. Integriertes DI verwenden </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die Abhängigkeitsinjektion</a> ist eine der Hauptfunktionen im Anwendungsentwurfsprozess in ASP.NET Core.  Sie können damit lose gekoppelte Anwendungen erstellen, die testbarer, modularer und damit wartbarer sind.  Möglich wurde dies durch das Prinzip der Abhängigkeitsinversion.  Zum Installieren von Abhängigkeiten werden IoC-Container (Inversion of Control) verwendet.  In ASP.NET Core wird ein solcher Container durch die IServiceProvider-Schnittstelle dargestellt.  Dienste werden in der Anwendung in der Methode <code>Startup.ConfigureServices()</code> installiert. <br><br>  Jeder registrierte Dienst kann mit drei Bereichen konfiguriert werden: <br><br><ul><li>  vorübergehend </li><li>  Umfang </li><li>  Singleton </li></ul><br><pre> <code class="java hljs">services.AddDbContext&lt;ApplicationDbContext&gt;(options =&gt; options.UseSqlServer(Configuration.GetConnectionString(<span class="hljs-string"><span class="hljs-string">"DefaultConnection"</span></span>))); services.AddSingleton&lt;Isingleton,MySingleton&gt;();</code> </pre> <br><h3>  Schritt 8. Verwenden von WebAPI Project Compatibility Shells (Shim) </h3><br>  Um die Migration einer vorhandenen Web-API-Implementierung zu vereinfachen, wird empfohlen, das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Microsoft.AspNetCore.Mvc.WebApiCompatShim</a> NuGet-Paket zu verwenden.  Folgende <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">kompatible Funktionen werden</a> unterstützt: <br><br><ul><li>  Fügt den ApiController-Typ hinzu </li><li>  Aktiviert die Modellbindung im Web-API-Stil </li><li>  Erweitert die Modellbindung, sodass Controller-Aktionen Parameter vom Typ HttpRequestMessage akzeptieren können. </li><li>  Fügt Nachrichtenformatierer hinzu, mit denen Aktionen Ergebnisse vom Typ HttpResponseMessage zurückgeben können </li></ul><br><pre> <code class="java hljs">services.AddMvc().AddWebApiConventions(); routes.MapWebApiRoute(name: <span class="hljs-string"><span class="hljs-string">"DefaultApi"</span></span>, template: <span class="hljs-string"><span class="hljs-string">"api/{controller}/{id?}"</span></span> );</code> </pre> <br><h3>  Schritt 9. Anwendungskonfiguration übertragen </h3><br>  Zuvor wurden einige Einstellungen in der Datei web.config gespeichert.  Wir verfolgen jetzt einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">neuen Ansatz,</a> der auf Schlüssel-Wert-Paaren basiert, die <i>von Konfigurationsanbietern</i> festgelegt <i>wurden</i> .  Dies ist der empfohlene Mechanismus in ASP.NET Core, und wir verwenden die Datei appsettings.json. <br><br>  Sie können auch das NuGet-Paket <code>System.Configuration.ConfigurationManager</code> wenn Sie aus irgendeinem Grund weiterhin * .config verwenden möchten.  In diesem Fall müssen Sie die Möglichkeit aufgeben, die Anwendung auf Unix-Plattformen auszuführen, und sie nur unter IIS ausführen. <br><br>  Wenn Sie den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Azure Key Vault-</a> Konfigurationsanbieter verwenden möchten, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">lesen</a> Sie die Inhaltsmigration <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zu Azure Key Valut-Inhalten</a> .  In unserem Projekt war dies nicht die Aufgabe. <br><br><h3>  Schritt 10. Übertragen von statischem Inhalt auf wwwroot </h3><br>  Um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">statischen Inhalt bereitzustellen,</a> müssen Sie dem Webhost das Stammverzeichnis des Inhalts des aktuellen Verzeichnisses mitteilen.  Der Standardwert ist wwwroot.  Sie können Ihr Verzeichnis zum Speichern statischer Dateien anpassen, indem Sie Middleware einrichten. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b7/z1/s7/b7z1s7pkzbd2yrkqukxcfholuus.png"></div><br><br><h3>  Schritt 11. Portieren von EntityFramework auf EF Core </h3><br>  Wenn das Projekt einige spezifische <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Funktionen von Entity Framework 6 verwendet</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">die</a> in <code>EF Core</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">nicht unterstützt werden</a> , ist es sinnvoll, die Anwendung auf dem <code>NET Framework</code> auszuführen.  In diesem Fall müssen Sie jedoch die Multiplattform opfern.  Die Anwendung funktioniert nur unter Windows und unter IIS. <br><br>  <b>Werfen wir einen Blick auf die wichtigsten Änderungen, die berücksichtigt werden müssen:</b> <br><br><ul><li>  Der System.Data.Entity-Namespace wurde durch Microsoft.EntityFrameworkCore ersetzt </li><li>  Die Signatur des DbContext-Konstruktors wurde geändert.  Jetzt müssen Sie DbContextOptions injizieren </li><li>  HasDatabaseGeneratedOption (DatabaseGeneratedOption.None) -Methode ersetzt durch ValueGeneratedNever () </li><li>  WillCascadeOnDelete (false) -Methode ersetzt durch OnDelete (DeleteBehavior.Restrict) </li><li>  OnModelCreating (DbModelBuilder modelBuilder) -Methode ersetzt durch OnModelCreating (ModelBuilder modelBuilder) </li><li>  Die HasOptional-Methode ist nicht mehr verfügbar </li><li>  Die Konfiguration der Objekte wurde geändert. Jetzt müssen Sie OnModelCreating verwenden, da  EntityTypeConfiguration ist nicht mehr verfügbar </li><li>  Das ComplexType-Attribut ist nicht mehr verfügbar </li><li>  Ersetzen der IDbSet-Schnittstelle durch DbSet </li><li>  ComplexType - Unterstützung für komplexe Typen wurde in EF Core 2 mit dem Typ Owned Entity ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://docs.microsoft.com/en-us/ef/core/modeling/owners-entities</a> ) und Tabellen ohne Primärschlüssel mit QueryType in EF Core angezeigt 2.1 ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://docs.microsoft.com/en-us/ef/core/modeling/query-types</a> ) </li><li>  Fremdschlüssel in EF Core generieren <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Schatteneigenschaften</a> mithilfe des ID-Musters [Entity], im Gegensatz zu EF6, das das _Id-Muster [Entity] verwendet.  Fügen Sie der Entität daher zunächst Fremdschlüssel als reguläre Eigenschaft hinzu. </li><li>  Um DI für DbContext zu unterstützen, konfigurieren Sie Ihren DbContex in <code>ConfigureServices</code> </li></ul><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/// &lt;summary&gt; /// Register base object context /// &lt;/summary&gt; /// &lt;param name="services"&gt;Collection of service descriptors&lt;/param&gt; public static void AddNopObjectContext(this IServiceCollection services) { services.AddDbContextPool&lt;NopObjectContext&gt;(optionsBuilder =&gt; { optionsBuilder.UseSqlServerWithLazyLoading(services); }); } /// &lt;summary&gt; /// SQL Server specific extension method for Microsoft.EntityFrameworkCore.DbContextOptionsBuilder /// &lt;/summary&gt; /// &lt;param name="optionsBuilder"&gt;Database context options builder&lt;/param&gt; /// &lt;param name="services"&gt;Collection of service descriptors&lt;/param&gt; public static void UseSqlServerWithLazyLoading(this DbContextOptionsBuilder optionsBuilder, IServiceCollection services) { var nopConfig = services.BuildServiceProvider().GetRequiredService&lt;NopConfig&gt;(); var dataSettings = DataSettingsManager.LoadSettings(); if (!dataSettings?.IsValid ?? true) return; var dbContextOptionsBuilder = optionsBuilder.UseLazyLoadingProxies(); if (nopConfig.UseRowNumberForPaging) dbContextOptionsBuilder.UseSqlServer(dataSettings.DataConnectionString, option =&gt; option.UseRowNumberForPaging()); else dbContextOptionsBuilder.UseSqlServer(dataSettings.DataConnectionString); }</span></span></code> </pre><br>  Verwenden Sie das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SQL Compare-</a> Tool, um zu überprüfen, ob <code>EF Core</code> während der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Migration</a> ein ähnliches Datenbankschema wie das <code>Entity Framework</code> generiert. <br><br><h3>  Schritt 12. Entfernen aller HttpContext-Referenzen, Ersetzen veralteter Klassen und Ändern des Namespace </h3><br>  Während der Migration Ihres Projekts werden Sie feststellen, dass eine ausreichend große Anzahl von Klassen umbenannt oder verschoben wurde. Jetzt müssen Sie alles an die neuen Anforderungen anpassen.  Hier ist eine Liste der wichtigsten Übergänge, auf die Sie stoßen können: <br><br><ul><li>  HttpPostedFileBase -&gt; IFormFile </li><li>  Der Zugriff auf HttpContext erfolgt jetzt über IHttpContextAccessor </li><li>  HtmlHelper -&gt; IHtmlHelper </li><li>  ActionResult -&gt; IActionResult </li><li>  HttpUtility -&gt; WebUtility </li><li>  Anstelle von HttpSessionStateBase - ISession kann über HttpContext.Session zugegriffen werden.  von Microsoft.AspNetCore.Http </li><li>  Request.Cookies gibt IRequestCookieCollection zurück: IEnumerable &lt;KeyValuePair &lt;string, string &gt;&gt;, also anstelle von HttpCookie, KeyValuePair &lt;string, string&gt; von Microsoft.AspNetCore.Http </li></ul><br>  Namespace-Ersatz: <br><br><ul><li>  SelectList -&gt; Microsoft.AspNetCore.Mvc.Rendering </li><li>  UrlHelper -&gt; WebUtitlity </li><li>  MimeMapping -&gt; FileExtensionContentTypeProvider </li><li>  MvcHtmlString -&gt; IHtmlString und HtmlString </li><li>  ModelState, ModelStateDictionary, ModelError -&gt; Microsoft.AspNetCore.Mvc.ModelBinding </li><li>  FormCollection -&gt; IFormCollection </li><li>  Request.Url.Scheme -&gt; this.Url.ActionContext.HttpContext.Request.Scheme </li></ul><br>  Sonstiges: <br><br><ul><li>  MvcHtmlString.IsNullOrEmpty (IHtmlString) -&gt; String.IsNullOrEmpty (variable.ToHtmlString ()) </li><li>  [ValidateInput (false)] - ist im Allgemeinen nicht mehr vorhanden und wird nicht benötigt </li><li>  HttpUnauthorizedResult -&gt; UnauthorizedResult </li><li>  [AllowHtml] - Es gibt keine Direktive mehr und sie wird nicht benötigt </li><li>  TagBuilder.SetInnerText-Methode ersetzt - jetzt ist dies InnerHtml.AppendHtml </li><li>  JsonRequestBehavior.AllowGet bei der Rückgabe von Json wird nicht mehr benötigt </li><li>  HttpUtility.JavaScriptStringEncode.  -&gt; JavaScriptEncoder.Default.Encode </li><li>  Request.RawUrl.  Es ist erforderlich, Request.Path + Request.QueryString separat zu verbinden </li><li>  AllowHtmlAttribute - keine Klasse mehr </li><li>  XmlDownloadResult - jetzt können Sie einfach die Rückgabedatei (Encoding.UTF8.GetBytes (xml), "application / xml", "filename.xml") verwenden. </li><li>  [ValidateInput (false)] - Es gibt keine Direktive mehr und sie wird nicht benötigt </li></ul><br><h3>  Schritt 13. Aktualisieren der Authentifizierung und Autorisierung </h3><br>  Ich habe bereits oben geschrieben, dass in unserem Projekt die Authentifizierung nicht mithilfe des integrierten Identitätssystems implementiert wird, sondern in einer separaten Middleware-Schicht ausgeführt wird.  ASP.NET Core verfügt jedoch über einen eigenen Mechanismus zum Bereitstellen von Anmeldeinformationen.  Weitere Details finden Sie in der Dokumentation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br>  Zum Datenschutz verwenden wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MachineKey</a> nicht mehr.  Stattdessen verwenden wir die integrierte Datenschutzfunktion.  Standardmäßig werden Schlüssel beim Start der Anwendung generiert.  Das Data Warehouse kann sein: <br><br><ul><li>  Dateisystem - Dateisystem-basierter Keystore </li><li>  Azure Storage - Datenschutzschlüssel im Azure Blob-Speicher </li><li>  Redis - Datenschutzschlüssel im Redis-Cache </li><li>  Registrierung - muss verwendet werden, wenn die Anwendung keinen Zugriff auf das Dateisystem hat </li><li>  EF Core - Schlüssel werden in der Datenbank gespeichert </li></ul><br>  Wenn die integrierten Mechanismen nicht geeignet sind, können Sie Ihren eigenen Schlüsselspeichermechanismus angeben, indem Sie ein benutzerdefiniertes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">IXmlRepository bereitstellen</a> . <br><br><h3>  Schritt 14. Aktualisieren von JS / CSS </h3><br>  Die Arbeitsweise mit statischen Ressourcen hat sich geändert: Jetzt sollten alle im Stammordner des <i>wwwroot-</i> Projekts gespeichert werden, sofern natürlich keine anderen Einstellungen angegeben sind. <br><br>  Wenn Sie integrierte Javascript-Blöcke verwenden, wird empfohlen, diese an das Ende der Seite zu verschieben.  Verwenden Sie einfach das Attribut asp-location = "Footer" für Ihre Tags.  Die gleiche Regel gilt für js-Dateien. <br><br>  Verwenden Sie die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">BundlerMinifier-</a> Erweiterung als Ersatz für System.Web.Optimization. Auf diese Weise können Sie JavaScript und CSS beim <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Erstellen</a> des Projekts binden und minimieren.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link</a> zur Dokumentation. <br><br><h3>  Schritt 15. Ansichten migrieren </h3><br>  Untergeordnete Aktionen werden nicht mehr verwendet.  Stattdessen bietet ASP.NET Core ein neues leistungsstarkes Tool - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ViewComponents</a> , das asynchron aufgerufen wird. <br><br>  So erhalten Sie eine Zeichenfolge von ViewComponent: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/// &lt;summary&gt; /// Render component to string /// &lt;/summary&gt; /// &lt;param name="componentName"&gt;Component name&lt;/param&gt; /// &lt;param name="arguments"&gt;Arguments&lt;/param&gt; /// &lt;returns&gt;Result&lt;/returns&gt; protected virtual string RenderViewComponentToString(string componentName, object arguments = null) { if (string.IsNullOrEmpty(componentName)) throw new ArgumentNullException(nameof(componentName)); var actionContextAccessor = HttpContext.RequestServices.GetService(typeof(IActionContextAccessor)) as IActionContextAccessor; if (actionContextAccessor == null) throw new Exception("IActionContextAccessor cannot be resolved"); var context = actionContextAccessor.ActionContext; var viewComponentResult = ViewComponent(componentName, arguments); var viewData = ViewData; if (viewData == null) { throw new NotImplementedException(); } var tempData = TempData; if (tempData == null) { throw new NotImplementedException(); } using (var writer = new StringWriter()) { var viewContext = new ViewContext( context, NullView.Instance, viewData, tempData, writer, new HtmlHelperOptions()); // IViewComponentHelper is stateful, we want to make sure to retrieve it every time we need it. var viewComponentHelper = context.HttpContext.RequestServices.GetRequiredService&lt;IViewComponentHelper&gt;(); (viewComponentHelper as IViewContextAware)?.Contextualize(viewContext); var result = viewComponentResult.ViewComponentType == null ? viewComponentHelper.InvokeAsync(viewComponentResult.ViewComponentName, viewComponentResult.Arguments): viewComponentHelper.InvokeAsync(viewComponentResult.ViewComponentType, viewComponentResult.Arguments); result.Result.WriteTo(writer, HtmlEncoder.Default); return writer.ToString(); } }</span></span></code> </pre> <br>  Es ist nicht mehr erforderlich, HtmlHelper zu verwenden - ASP.NET Core verfügt über eine große Anzahl integrierter Helper-Tag-Funktionen ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tag-Helfer</a> ).  Wenn die Anwendung ausgeführt wird, werden sie von der Razor-Engine auf der Serverseite verarbeitet und schließlich in Standard-HTML-Elemente konvertiert.  Dies vereinfacht die Anwendungsentwicklung erheblich.  Und natürlich können Sie Ihre eigenen Tag-Helfer implementieren. <br><br>  Wir haben begonnen, die Abhängigkeitsinjektion in Ansichten zu verwenden, anstatt Einstellungen und Dienste mithilfe von <code>EngineContext</code> . <br><br>  Die wichtigsten Punkte zur Migration von Ansichten: <br><br><ul><li>  Konvertieren Sie <code>Views/web.config  Views/_ViewImports.cshtml</code> - wird zum Importieren von Namespaces und <code>Views/web.config  Views/_ViewImports.cshtml</code> Abhängigkeiten verwendet.  Diese Datei unterstützt keine anderen <code>Razor</code> Funktionen wie Funktions- und Abschnittsdefinitionen. </li><li>  Konvertieren Sie <code>namespaces.add</code> in <code>@using</code> </li><li>  Übertragen Sie alle Einstellungen in die Hauptanwendungskonfiguration </li><li>  <code>Scripts.Render</code> und <code>Styles.Render</code> nicht vorhanden.  Ersetzen Sie <code>libman</code> oder <code>BundlerMinifier</code> Links zur Ausgabe </li></ul><br><h2>  Abschließend </h2><br>  Wir haben aus unserer Erfahrung gesehen, dass der Prozess der Migration einer großen Webanwendung eine sehr zeitaufwändige Aufgabe ist, die ohne Fallstricke kaum ausgeführt werden kann.  Wir hatten vor, auf ein neues Framework umzusteigen, sobald die erste stabile Version veröffentlicht wurde, konnten es jedoch nicht sofort fertigstellen: Es gab einige wichtige Funktionen, die zu diesem Zeitpunkt noch nicht auf .NET Core übertragen worden waren, insbesondere im Zusammenhang mit EntityFramework.  Daher mussten wir zuerst die nächste Version mit einem gemischten Ansatz veröffentlichen - der .NET Core-Architektur mit den .NET Framework-Abhängigkeiten. <br><br>  Wir konnten das Projekt nach der Veröffentlichung von .NET Core 2.1 vollständig anpassen, da zu diesem Zeitpunkt bereits eine stabile Lösung für die neue Architektur vorhanden war. Es mussten lediglich einige Pakete ersetzt und die Arbeit mit EF Core neu geschrieben werden.  Die vollständige Migration auf das neue Framework dauerte daher mehrere Monate. <br><br>  Weitere Informationen zu unserem Projekt finden Sie in unserem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Repository auf GitHub</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de472738/">https://habr.com/ru/post/de472738/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de472720/index.html">ERP funktioniert nicht ... Was ist die Alternative? oder pünktlich. Für Russland?</a></li>
<li><a href="../de472724/index.html">Einführung in skydive.network</a></li>
<li><a href="../de472726/index.html">Verbesserung der Immunität gegen Arduino-Rauschen</a></li>
<li><a href="../de472730/index.html">Ivanovo! Mitap zu Ehren des 10-jährigen Jubiläums von Node.js.</a></li>
<li><a href="../de472736/index.html">Offenes Webinar "Einführung in die Testautomatisierung mobiler Anwendungen auf Selen und Appium"</a></li>
<li><a href="../de472744/index.html">MRP funktioniert nicht ... Was ist die Alternative?</a></li>
<li><a href="../de472746/index.html">Terminalserver für Admin; Keine einzige SSH-Lücke</a></li>
<li><a href="../de472748/index.html">Semantischer Browser oder Leben ohne Websites</a></li>
<li><a href="../de472750/index.html">OK, brauche ich wirklich Kubernetes?</a></li>
<li><a href="../de472752/index.html">CSE: Kubernetes für alle in vCloud</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>