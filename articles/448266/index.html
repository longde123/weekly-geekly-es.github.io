<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äç‚ù§Ô∏è‚Äçüë© üö∂üèΩ üï¶ Telefoneado! C√≥mo armar tu marcador web en una hora üè´ üéÉ üë©üèæ‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Amigos, hoy quiero hablar con ustedes sobre las llamadas. Para algunos, este es un tema completamente nuevo. Para otros, es pura diversi√≥n de los fan√°...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Telefoneado! C√≥mo armar tu marcador web en una hora</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/2gis/blog/448266/"><img src="https://habrastorage.org/webt/li/yz/m7/liyzm7mhhxjuc1oeyzofjmqmob8.jpeg"><br><br><p>  Amigos, hoy quiero hablar con ustedes sobre las llamadas.  Para algunos, este es un tema completamente nuevo.  Para otros, es pura diversi√≥n de los fan√°ticos a nivel de "pero ¬ødeber√≠a enviarme mi Skype?"  Para el tercero, una repentina necesidad de vida.  La √∫ltima opci√≥n es nuestra opci√≥n. </p><br><p>  En este art√≠culo, le mostrar√© un ejemplo de implementaci√≥n peque√±o pero muy viable que le permitir√° literalmente hacer su propio marcador WEB y llamar a un amigo directamente desde el navegador, literalmente, en el extremo de varias docenas de l√≠neas de JavaScript. </p><a name="habracut"></a><br><h3 id="pro-tehnologii-i-protokoly">  Sobre tecnolog√≠as y protocolos </h3><br><img src="https://habrastorage.org/webt/8w/sw/sh/8wswshoy0tsia7gpl51lynbu7-c.png"><br><br><p>  Es 2019, y para nuestro deleite, ya existe una herramienta preparada para implementar <strong>R</strong> ealTime <strong>C</strong> ommunication (RTC) para la web, a saber, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">WebRTC</a> .  Hace unos a√±os estaba en desarrollo activo.  La API a√∫n se est√° finalizando, pero la tecnolog√≠a se ha convertido en el est√°ndar de facto y es compatible con los navegadores m√°s populares.  En este art√≠culo, no nos detendremos en la tecnolog√≠a en s√≠; puede leer m√°s en el sitio web de los desarrolladores o buscar art√≠culos en el centro  Por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </p><br><p>  Pero antes de comenzar, quiero aclarar un par de puntos. </p><br><ol><li>  En primer lugar, WebRTC se ejecuta sobre un conjunto de protocolos, e incluso para la comunicaci√≥n p2p necesitar√° alg√∫n tipo de servidor a trav√©s del cual sus clientes puedan encontrarse y hacerse amigos entre s√≠.  Nuestro ejemplo utilizar√° el protocolo SIP, del cual puede leer m√°s, por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </li><li>  Necesitar√° un servidor con soporte para todo lo anterior, como FreeSwitch o Asterisk. </li></ol><br><p>  Dejamos estas cosas fuera del alcance del art√≠culo.  Asumimos que usted es tan afortunado como nosotros y que ya ha configurado la telefon√≠a VoIP a su disposici√≥n. </p><br><p>  Bueno, la parte m√°s larga del art√≠culo est√° detr√°s, ¬°codifiquemos! </p><br><h3 id="verstaem-stranichku">  Dise√±o de p√°gina </h3><br><img src="https://habrastorage.org/webt/55/zn/km/55znkm3wc6qbka1zce5iskukjbg.png"><br><br><p>  Primero, necesitamos una p√°gina con la que llamaremos, campos para ingresar un nombre de usuario, contrase√±a, n√∫mero de tel√©fono y un par de botones.  En la versi√≥n m√°s simple, se ver√° m√°s o menos as√≠: </p><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"input-group mb-6"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"input-group-prepend"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"input-group-text"</span></span></span><span class="hljs-tag">&gt;</span></span>Login<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"loginText"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"input-group-prepend"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"input-group-text"</span></span></span><span class="hljs-tag">&gt;</span></span>Password<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"passwordText"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"loginButton"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-primary"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"login()"</span></span></span><span class="hljs-tag">&gt;</span></span>Login<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"logOutButton"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-primary d-none"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"logout()"</span></span></span><span class="hljs-tag">&gt;</span></span>LogOut<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"input-group mb-6 d-none"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"callPanel"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"callNumberText"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Call number"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"callNumberButton"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-success"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"call()"</span></span></span><span class="hljs-tag">&gt;</span></span>Call<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hangUpButton"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-danger d-none"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hangUp()"</span></span></span><span class="hljs-tag">&gt;</span></span>Hang Up<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">audio</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"localAudio"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autoPlay</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">muted</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">audio</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">audio</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"remoteAudio"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autoPlay</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">audio</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">audio</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sounds"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autoPlay</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">audio</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Los elementos de audio "enviar√°n" y "recibir√°n" sonido, y por belleza, a trav√©s de sonidos, reproducir√°n sonidos de marcaci√≥n. </p><br><p>  La interfaz de usuario est√° lista, no puede encontrar fallas en UX, hagamos que funcione. </p><br><h3 id="prikruchivaem-jssip">  Sujetamos JSSIP </h3><br><img src="https://habrastorage.org/webt/uj/im/ma/ujimma62qvgawzhngknhm337rze.png"><br><br><p>  Utilizaremos una biblioteca en la que todo lo que se requiere ya est√° implementado: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">JSSIP</a> .  Puede consultar la documentaci√≥n: todo se describe con suficiente detalle all√≠ e incluso hay un ejemplo de implementaci√≥n listo para usar.  Es decir, pr√°cticamente no necesitamos hacer nada: simplemente simplifique todo lo m√°s posible y descubra qu√© es qu√©. </p><br><p>  Despu√©s de ingresar el nombre de usuario / contrase√±a (debe estar registrado en su servidor de telefon√≠a) debe iniciar sesi√≥n en el servidor.  Hacemos esto: </p><br><pre> <code class="javascript hljs">socket = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JsSIP.WebSocketInterface(<span class="hljs-string"><span class="hljs-string">"wss://webrtcserver:port/ws"</span></span>); _ua = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JsSIP.UA( { <span class="hljs-attr"><span class="hljs-attr">uri</span></span>: <span class="hljs-string"><span class="hljs-string">"sip:"</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loginText.val() + <span class="hljs-string"><span class="hljs-string">"@webrtcserver"</span></span>, <span class="hljs-attr"><span class="hljs-attr">password</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.passwordText.val(), <span class="hljs-attr"><span class="hljs-attr">display_name</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loginText.val(), <span class="hljs-attr"><span class="hljs-attr">sockets</span></span>: [socket] });</code> </pre> <br><p>  En el camino, puede suscribirse a los eventos conectados y conectados y hacer algo √∫til all√≠.  Pero pasemos al evento de registro: </p><br><pre> <code class="javascript hljs">his._ua.on(<span class="hljs-string"><span class="hljs-string">'registered'</span></span>, () =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"UA registered"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loginButton.addClass(<span class="hljs-string"><span class="hljs-string">'d-none'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.logOutButton.removeClass(<span class="hljs-string"><span class="hljs-string">'d-none'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loginText.prop(<span class="hljs-string"><span class="hljs-string">'disabled'</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.passwordText.prop(<span class="hljs-string"><span class="hljs-string">'disabled'</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); $(<span class="hljs-string"><span class="hljs-string">"#callPanel"</span></span>).removeClass(<span class="hljs-string"><span class="hljs-string">'d-none'</span></span>); });</code> </pre> <br><p>  Aqu√≠ solo necesitamos cambiar el estado de los botones: mostrar lo necesario, ocultar lo innecesario.  Y si de repente algo sali√≥ mal con el inicio de sesi√≥n, escupimos el error en el registro: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._ua.on(<span class="hljs-string"><span class="hljs-string">'registrationFailed'</span></span>, (data) =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(<span class="hljs-string"><span class="hljs-string">"UA registrationFailed"</span></span>, data.cause); });</code> </pre> <br><p>  Esto es suficiente para iniciar sesi√≥n.  Queda por obtener el √≥rgano de barril con <br>  this._ua.start (); </p><br><p>  Si el servidor se especifica correctamente y se acepta su nombre de usuario / contrase√±a, aparecer√° un campo para ingresar el tel√©fono y aparecer√° el bot√≥n Llamar. </p><br><p>  Para iniciar sesi√≥n, debe llamar a this._ua.stop (), todo es simple. </p><br><h3 id="delaem-zvonok">  Hacer una llamada </h3><br><p>  Ahora, lo m√°s importante: debe llamar al n√∫mero ingresado. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.session = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._ua.call(number, { <span class="hljs-attr"><span class="hljs-attr">pcConfig</span></span>: { <span class="hljs-attr"><span class="hljs-attr">hackStripTcp</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-comment"><span class="hljs-comment">//   ,       rtcpMuxPolicy: 'negotiate', //   ,   multiplexing.       . iceServers: [] }, mediaConstraints: { audio: true, //    video: false }, rtcOfferConstraints: { offerToReceiveAudio: 1, //    offerToReceiveVideo: 0 } });</span></span></code> </pre> <br><p>  Tenga en cuenta: habilitamos expl√≠citamente la multiplexaci√≥n, esta configuraci√≥n tambi√©n debe estar habilitada en su servidor.  En el caso de un asterisco, esto es rtcp_mux = yes en la configuraci√≥n sip.conf. </p><br><p>  La interacci√≥n adicional se basa en devoluciones de llamada, en las que debemos asegurar la direcci√≥n del flujo de audio y video al elemento de p√°gina correspondiente y enviar los mensajes necesarios en el orden correcto al servidor. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    this.session.on('progress', () =&gt; { console.log("UA session progress"); playSound("ringback.ogg", true); }); //      this.session.on('connecting', () =&gt; { console.log("UA session connecting"); playSound("ringback.ogg", true); //          ,     let peerconnection = this.session.connection; let localStream = peerconnection.getLocalStreams()[0]; // Handle local stream if (localStream) { // Clone local stream this._localClonedStream = localStream.clone(); console.log('UA set local stream'); let localAudioControl = document.getElementById("localAudio"); localAudioControl.srcObject = this._localClonedStream; } //       ,        peerconnection.addEventListener('addstream', (event) =&gt; { console.log("UA session addstream"); let remoteAudioControl = document.getElementById("remoteAudio"); remoteAudioControl.srcObject = event.stream; }); }); //   , ,    this.session.on('failed', (data) =&gt; { console.log("UA session failed"); stopSound("ringback.ogg"); playSound("rejected.mp3", false); this.callButton.removeClass('d-none'); this.hangUpButton.addClass('d-none'); }); // ,  this.session.on('ended', () =&gt; { console.log("UA session ended"); playSound("rejected.mp3", false); JsSIP.Utils.closeMediaStream(this._localClonedStream); this.callButton.removeClass('d-none'); this.hangUpButton.addClass('d-none'); }); //  ,    this.session.on('accepted', () =&gt; { console.log("UA session accepted"); stopSound("ringback.ogg"); playSound("answered.mp3", false); });</span></span></code> </pre> <br><p>  En general, todo es bastante l√≥gico.  Mientras marca ['progreso']: reproduce los sonidos de marcaci√≥n.  En nuestro ejemplo, reproducimos nuestro propio sonido, pero como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">pvsur</a> coment√≥ correctamente, tambi√©n puede obtenerlo del lado llamado y escuchar la respuesta del informador autom√°tico como "deje un mensaje despu√©s del pitido", si hay uno. <br>  Tan pronto como llegu√© ['aceptado'] - reproducir el sonido respondi√≥.  Tan pronto como el suscriptor levante el tel√©fono, obtendremos su flujo de sonido y lo colocaremos en el elemento remoteAudio ['connect' y 'addstream']. <br>  Al final de la llamada, cierre closeMediaStream.  Puedes relajarte </p><br><h3 id="nemnogo-pro-ekspluataciyu">  Un poco sobre la operaci√≥n. </h3><br><p>  Durante las pruebas, se descubrieron dos cosas. </p><br><ol><li>  En Chrome, hubo un retraso de varios segundos al comienzo de la marcaci√≥n, lo cual fue muy molesto.  Descubrimos por los registros que fue al servidor de hielo, que no era necesario en absoluto, ya que tenemos nuestro propio servidor.  Por lo tanto, en la configuraci√≥n de JSSIP, simplemente los eliminamos e inmediatamente nos volvimos m√°s bonitos.  Consulte pcConfig.iceServers y pcConfig.hackStripTcp. </li><li>  Nuestro asterisco tiene un protocolo WSS con encriptaci√≥n para SIP.  El navegador lo requiere al usar el sitio web HTTPS.  Pero el asterisco usa WS en funci√≥n de los par√°metros de contacto en los que la biblioteca JSSIP contiene un descriptor WS codificado.  Los desarrolladores de la biblioteca al mismo tiempo se√±alan est√°ndares en los que realmente no hay requisitos sobre este tema.  Y los colegas del aster persistentemente no quieren arreglar nada.  En general, un callej√≥n sin salida.  Bueno, en este momento encontramos en la fuente la l√≠nea this._configuration.contact_uri = new URI (...), cambie transport: 'ws' a transport: 'wss' y contin√∫e disfrutando de la vida. </li></ol><br><p>  En general, el ejemplo est√° listo, puede tomar y llamar.  No es necesario poner ning√∫n softphone o desarrollar uno propio.  No necesita preocuparse por implementar este software en los autom√≥viles de los clientes.  Simplemente abra el navegador y llame. </p><br><p>  Otra biblioteca le permite marcar n√∫meros adicionales en modo tono.  Es decir, puede llamar, por ejemplo, al centro de llamadas del banco y acceder al elemento deseado en el men√∫ de voz.  Para hacer esto, simplemente ejecute el siguiente comando: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._call.sendDTMF(<span class="hljs-string"><span class="hljs-string">'. '</span></span>)</code> </pre> <br><h3 id="pro-fakapy">  Sobre Fakapy </h3><br><img src="https://habrastorage.org/webt/kv/_l/sa/kv_lsarz4y173fa0ojus_vx_26q.png"><br><br><p>  Hubo varios puntos que realmente me pusieron nervioso. </p><br><p>  Dej√© esta parte fuera del alcance del art√≠culo, pero adem√°s de las llamadas salientes, tambi√©n necesit√°bamos aceptar llamadas entrantes.  Y durante alg√∫n tiempo tuve que ponerme en cuclillas con una llamada entrante, que lleg√≥ y luego se interrumpi√≥.  Todo fue decidido por la configuraci√≥n rtcpMuxPolicy mencionada anteriormente y que permiti√≥ la multiplexaci√≥n en el asterisco, pero fuimos est√∫pidos durante bastante tiempo. </p><br><p>  Y todav√≠a hay problemas para marcar usted mismo, cuando se realiza una llamada y una llamada en la misma m√°quina.  No recuerdo exactamente, pero la conexi√≥n se estableci√≥ con √©xito, no hubo errores ni sonido :) El tiempo se estaba acabando, por lo que obtuvimos un puntaje en este efecto especial.  Pero tenga en cuenta que probar las llamadas entrantes es mejor en un autom√≥vil separado. </p><br><h3 id="zaklyuchenie">  Conclusi√≥n </h3><br><p>  Finalmente, quiero se√±alar que probamos el paquete JSSIP + Asterisk en nuestro centro de llamadas, todo funciona bien, al menos en cromo, lo que nos conviene por completo.  Lo principal es permitir que el navegador acceda a dispositivos multimedia y registre usuarios en el servidor de marcado. </p><br><p>  Puedes ver el ejemplo terminado en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github</a> . </p><br><h3 id="poleznye-ssylki">  Enlaces utiles </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sobre webrct</a> <br>  Sobre SIP: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tyts</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tyts</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sobre el asterisco</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Biblioteca Jssip</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/448266/">https://habr.com/ru/post/448266/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448254/index.html">IPhone no es el primer tel√©fono de Apple</a></li>
<li><a href="../448258/index.html">Monitores industriales modulares Advantech FPM-7002</a></li>
<li><a href="../448260/index.html">Configure Visual Studio en su organizaci√≥n con .vsconfig</a></li>
<li><a href="../448262/index.html">C√≥mo jugar Speedgate, el primer deporte creado por AI</a></li>
<li><a href="../448264/index.html">Nada de l√≠pidos fr√≠os: previene la cristalizaci√≥n del agua a -263 ¬∞ C</a></li>
<li><a href="../448268/index.html">Sistemas telef√≥nicos en caja</a></li>
<li><a href="../448270/index.html">Cambiar la configuraci√≥n del programa mientras se mantiene la configuraci√≥n personal</a></li>
<li><a href="../448272/index.html">¬øPor qu√© roci√≥ espec√≠ficamente el avi√≥n antes de la salida, y qu√© suceder√° si esto no se hace?</a></li>
<li><a href="../448274/index.html">Monitoreo por SMS del peso de tres colmenas por $ 35</a></li>
<li><a href="../448276/index.html">C√≥mo vive Alfa Bank en un per√≠odo de cambio y qu√© logramos hacer al combinar el desarrollo de TI y Alfa Lab</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>