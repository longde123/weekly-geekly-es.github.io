<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôéüèæ ‚ÜóÔ∏è ü§ôüèª DEFCON-Konferenz 20. Erfassung in 60 Sekunden: von einem Gastkonto zu einem Windows-Dom√§nenadministrator. Teil 1 üïõ üßñüèº üöã</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo, ich bin Zach Feysel, ich werde schnell sprechen. Wenn es zu schnell ist, kannst du mich verlangsamen. Tags√ºber bin ich ein Pentester, nachts bi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DEFCON-Konferenz 20. Erfassung in 60 Sekunden: von einem Gastkonto zu einem Windows-Dom√§nenadministrator. Teil 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/436472/"> Hallo, ich bin Zach Feysel, ich werde schnell sprechen. Wenn es zu schnell ist, kannst du mich verlangsamen.  Tags√ºber bin ich ein Pentester, nachts bin ich DJ und Fotograf. Ich bin auf Twitter unter dem Spitznamen @zfazel zu finden.  Die Leute fragen mich immer nach Diplomen.  Ich geh√∂re nicht zu den Leuten, die eine Reihe von Abschl√ºssen auflisten. Sie sollten mich also besser anhand dieser Pr√§sentation beurteilen und nicht anhand der Anzahl meiner Zertifikate. <br><br><img src="https://habrastorage.org/webt/l3/kp/2g/l3kp2gz0xpfmgdk12en8bqyi4yq.jpeg"><br><br>  Ein unversch√§mter Kommentar: Wir haben hier wenig Konkurrenz, im Moment sind die Jungs aus Chicago auf Spur 4, wir sind alle aus Chicago, heben Sie schnell Ihre H√§nde, wer hier aus Chicago ist.  Ich glaube, ich habe die Wette verloren.  Ich werde heute Abend DJ im Pool sein. Wenn Sie also frei sind, begr√º√üen Sie den Kampf mit Kate Myers. Danach werde ich zu einer weiteren Hacker-Konferenz nach Chicago zur√ºckkehren.  Letztes Jahr waren 500 Personen anwesend, dieses Jahr hoffen wir, dass es mehr G√§ste geben wird.  Meine 312 Leute werden auch da sein, weitere Informationen zu dieser Konferenz finden Sie auf thotcon.org. <br><br>  Um keine Zeit zu verschwenden: Wir werden √ºber eine Alternative zum Pass-the-Hash-Angriff namens NTLM-Relay sprechen, √ºber eine Reihe neuer Tools f√ºr das protokoll√ºbergreifende protokoll√ºbergreifende Relaying f√ºr NTLM-Authentifizierungsanforderungen, √ºber neue Methoden der automatischen Clientauthentifizierung und √ºber neue Zwecke, f√ºr die Sie Pass-the-Hash verwenden k√∂nnen. <br>  Beginnen wir mit NTLM. F√ºr diejenigen, die nicht wissen, was NTLM 101 ist, kann der ganze Punkt in weniger als 10 Minuten angegeben werden.  Was ist LM / NTLM?  Es handelt sich um ein Kennwort-Repository und ein Netzwerkauthentifizierungsprotokoll, die von Microsoft f√ºr die Verwendung unter Windows entwickelt wurden.  Verdammt, meine Folien sind nicht in Ordnung!  Der LM-Hash ist also ein Format zum Speichern von Benutzerkennw√∂rtern mit einer L√§nge von weniger als 15 Zeichen. Das Kennwort wird in 2 Teile von 7 Bytes unterteilt und in Gro√übuchstaben konvertiert.  Ich hoffe, Sie k√∂nnen sehen, wie die LM- und NTLM-Hashes aussehen.  Ich werde keine Zeit damit verschwenden, zu erz√§hlen, wie schlecht und schwach LM ist. Sie alle wissen das und wenn nicht, googeln Sie es. <a name="habracut"></a><br><br><img src="https://habrastorage.org/webt/jl/rk/ge/jlrkge7x_ler-llqlbl4chy6jn8.jpeg"><br><br>  Ein NTLM-Hash unterscheidet normalerweise zwischen Gro√ü- und Kleinschreibung, hat eine unbegrenzte L√§nge, ist nicht in Zeichengruppen aufgeteilt und ist etwas st√§rker als LM, aber auch nicht ohne Probleme.  Jetzt werde ich √ºber sie sprechen.  Die erste Sicherheitsanf√§lligkeit ist die M√∂glichkeit eines Pass-the-Hash-Angriffs, bei dem sich ein Hacker bei einem Remoteserver anmelden kann, der eine Clientauthentifizierung basierend auf NTLM / LM-Protokollen verwendet.  Sorry, Leute, ich habe die Folien durcheinander gebracht, ich habe sie vor 5 Minuten gemacht, kurz gesagt, LM ist schei√üe. <br><br>  Was ist die NTLM-Authentifizierung?  Dies ist die Netzwerkauthentifizierung f√ºr Remotedienste.  Sie muss beweisen, dass du wirklich das bist, was du dich nennst.  Der Dienst wird normalerweise auf einem separaten Computer ausgef√ºhrt, auf dem Sie auf die vom Dienst angebotenen Ressourcen zugreifen m√∂chten. Beispielsweise ist ein Dateiserver ein Dienst und Dateien sind Ressourcen.  In einer Minute werden wir uns ansehen, was diese Dienste sind. <br><br>  Wir k√∂nnen verwirrt sein, wenn wir √ºber NTLM v1, v2, NTLM 2, signiert oder nicht signiert, sprechen. Lassen Sie uns also schnell die NTLM-Authentifizierung durchgehen.  W√§hrend der Authentifizierung werden 3 Arten von Nachrichten gesendet. <br><br><img src="https://habrastorage.org/webt/xr/ub/mp/xrubmplrjtbebui7zomdfqkeuzu.jpeg"><br><br>  Typ 1 ist die Anforderung des Clients an den Server, einen Kontakt herzustellen, z. B. "Ich m√∂chte mich authentifizieren".  Sie sehen das von Wireshark erfasste Paket in St√ºcke zerlegt. Es gibt Flags zur Unterst√ºtzung der Authentifizierung, den Namen der Workstation und ihren Dom√§nennamen. <br><br>  Die Nachricht vom Typ 2 ist eine Serverantwort.  Wenn Sie anhand der Nachricht vom Typ 1 bemerkt haben, dass wir noch nicht wissen, wer dieser Benutzer ist, hat er nur um eine Verbindung zum Server gebeten und m√∂chte herausfinden, ob die Anforderung unterst√ºtzt wird. <br><br><img src="https://habrastorage.org/webt/wl/j0/v0/wlj0v0bz-jkpsykoklolampo0x8.jpeg"><br><br>  Hier sehen Sie die Antwort des NTML Challenge-Servers als eine Reihe von Zahlen, die sich jedes Mal √§ndern.  Der Screenshot zeigt eine statische Antwort, mit der ‚ÄûRegenbogentabellen‚Äú erstellt werden k√∂nnen.  Der Server antwortet also mit einer Nachricht des zweiten Typs: "Dies ist, was ich unterst√ºtze, hier ist mein Domainname, hier ist mein Servername".  Diese Antwort wird verwendet, um den Hash Ihres Passworts zu "salzen", sodass jedes Mal, wenn eine eindeutige Antwort erhalten wird, Sie diese nicht immer wieder mit derselben Anfrage wiederholen k√∂nnen. <br><br>  Nachricht vom Typ 3 - Dies ist die Clientauthentifizierungsnachricht. <br><br><img src="https://habrastorage.org/webt/mg/of/a8/mgofa83tlvbkexds9ksby3d4osu.jpeg"><br><br>  Dies ist die Antwort des Servers, der mit dem Kennwort-Hash f√ºr den NTML-Hash zusammen mit dem Benutzernamen, dem Namen der Arbeitsstation und dem Dom√§nennamen sowie dem Sitzungsschl√ºssel gehasht wird, wenn Sie die Sitzung signieren. <br><br>  Dies ist, was NTML Version 1 ist. NTML Version 2 ist dem sehr √§hnlich, aber es gibt zus√§tzliche Parameter im Antwortkennwort und beim Aufruf des Clients, um vor der Verwendung von "Regenbogentabellen" zu sch√ºtzen, dh der Client verwendet ein Element der Zuf√§lligkeit gegen diese. <br><br>  Eine andere Sache, √ºber die wir sprechen m√ºssen, ist die integrierte Windows-Authentifizierung.  Dies ist erforderlich, damit Sie das System nicht jedes Mal mit einem Kennwort erneut eingeben m√ºssen, um Ressourcen und Dienste nutzen zu k√∂nnen.  Wenn Sie mit einem Dom√§nenserver oder einem internen Webserver verbunden sind, fordert Windows Sie nicht zur Eingabe eines Kennworts auf, sondern fordert lediglich eine API an und empf√§ngt Informationen, die das System zur Authentifizierung verwenden soll. <br>  Im Kontext der lokalen Sicherheit sch√ºtzt HTTP durch Verwendung vertrauensw√ºrdiger Sicherheitszonen, vertrauensw√ºrdiger Sites oder lokaler Sites, indem nur ein Dom√§nenname mit nur einem Wort √ºberpr√ºft wird.  Ich werde versuchen, Ihr Ged√§chtnis schnell aufzufrischen.  Eine Einzelwortdom√§ne sucht zuerst auf DNS-Servern nach einem DNS-Namen, √ºberpr√ºft dann ihren Host- oder DNS-Hostnamen und gibt ihn zur√ºck.  Es √ºberpr√ºft die Struktur Ihres vollst√§ndigen Namens und f√ºhrt dann NBNS aus, die Broadcast-Anforderung f√ºr diesen Domainnamen.  Tats√§chlich fragt er das Netzwerk: ‚ÄûHey, ich suche einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Namen</a> , kennen Sie jemanden mit diesem Namen?‚Äú, Verteilt diese Anfrage im MBNS-Multimedia-Broadcast-Modus √ºber das lokale Netzwerk. <br><br>  Wie gesagt, da wir das SMB-Protokoll √ºberall verwenden, gibt es keine Einschr√§nkungen, wir haben nur eine automatische Authentifizierung mit SMB.  Dies verursacht einige Probleme. <br><br>  Betrachten Sie die Pass-the-Hash-Methode.  Aus den Protokollen geht hervor, dass NTML nicht das urspr√ºngliche Kennwort f√ºr die Authentifizierung verwendet. Wir ben√∂tigen also nur den NTML-Hash selbst.  Wir k√∂nnen mit verschiedenen Windows-Tools auf den NTML-Hash zugreifen, dh diesen Hash aus dem lokalen Speicher oder aus dem Speicher abrufen.  All dies wurde in anderen Reden beschrieben. Ich m√∂chte Sie nur schnell an das Wesentliche des Problems erinnern, um die Unterschiede zwischen den beiden Methoden aufzuzeigen. <br>  Tatsache ist, dass Sie f√ºr diesen Pass-the-Hash normalerweise Zugriff auf lokaler Systemadministratorebene ben√∂tigen, da Sie mit einem Gastkonto keinen Zugriff auf lokalen Speicher oder lokalen Speicher erhalten. <br><br>  Was ist NTLM-Relaying und wie unterscheidet es sich von der Pass-the-Hash-Methode?  Sie sagen mir st√§ndig: "Ah, Sie sprechen von Pass-the-Hash!" Und ich antworte: "Nein, ich spreche von NTLM-Relaying!".  Der Unterschied besteht darin, dass f√ºr NTLM Relaying keine Administratorrechte erforderlich sind, um auf das Netzwerk oder das System zuzugreifen.  Tats√§chlich stellen Sie von innen oder au√üen eine Verbindung zum Netzwerk her und beginnen als Gast zu arbeiten.  Es gibt keine Anmeldeinformationen, es gibt keinen Zugriff auf das System, nur die Anforderung wird authentifiziert, wenn Sie zu den oben genannten Nachrichtentypen 1,2,3 zur√ºckkehren.  Es erfolgt keine √úberpr√ºfung, wenn der Host auf Ihre Anfrage antwortet und sicherstellt, dass Sie Sie sind. <br>  Wir erstellen einen betr√ºgerischen Server, um Authentifizierungsanforderungen zu empfangen und diese dann an den Zielserver weiterzuleiten. <br><br>  H√∂ren wir uns die Geschichte an, damit Sie die Essenz des Problems verstehen.  Als Dominic Brezinsky 1996 eine Sicherheitsl√ºcke im Authentifizierungsprozess mithilfe des CIFS-Zugriffsprotokolls entdeckte, der ersten Version des SMB-Protokolls.  Danach sprachen sie zun√§chst √ºber die M√∂glichkeit der Verwendung von NTLM-Relaying.  Im Jahr 2001 gelang es NTLM, ein Loch in SMB zu finden.  Zuerst sagte Veracode-Mitarbeiter Christian Ryu (alias Dildog) dies auf einer DefCon-Konferenz, und dann ver√∂ffentlichte Hacker Josh Bushbinder (alias Sir Dystic) einen Exploit-Code, der mit dieser Sicherheitsanf√§lligkeit funktioniert.  Wir haben das Telnet-Protokoll und die Sicherheitsanf√§lligkeit des IE-Browsers verwendet, bei der Sie einfach telnet: // ip eingeben und sich automatisch authentifizieren konnten. <br><br><img src="https://habrastorage.org/webt/mn/z5/mc/mnz5mcfwjyklsnbgafwv6rkqtoq.jpeg"><br><br>  Danach wurde die NTLM-Relaying-Methode verwendet, um SMB-Anforderungen an andere Hosts oder an ihren eigenen Host umzuleiten.  Dies dauerte bis November 2008, als Microsoft Windows L√ºcken reparierte, wo dies m√∂glich war, und verhinderte, dass die NTLM-Authentifizierungsanforderung mit dem Patch MS08-068 zur√ºckgegeben wurde. <br><br>  Daher haben wir die M√∂glichkeit verloren, eine Authentifizierungsanforderung an unseren Host zur√ºckzugeben, und konnten sie aufgrund der Protokolldesignfunktionen nur an andere Hosts weiterleiten.  Im Jahr 2008 gab ein Mann unter dem Spitznamen Grutz eine Erkl√§rung zum Tod von DefLon NTLM ab.  Ich denke, dies war eine der besten Leistungen der letzten Jahre, da dies einen enormen Einfluss auf das Unternehmensumfeld hatte. <br><br><img src="https://habrastorage.org/webt/2a/3o/jt/2a3ojthljjqouilw7tkxdyhrkww.jpeg"><br><br>  Er nannte sein Instrument den Namen des Pokemon Squirtle und die Technologie - "Affe in der Mitte" in Analogie zu "Mann in der Mitte".  Dieses Tool erm√∂glichte die Ausf√ºhrung von NTLM-Relaying √ºber HTTP und funktionierte auch gut mit SMB, die Authentifizierungsanforderungen empfingen. <br><br><img src="https://habrastorage.org/webt/zk/vw/0b/zkvw0bevvlrf-tkgcgofh2myqge.jpeg"><br><br>  Dieser Screenshot wurde vor zwei Tagen aufgenommen und die Entwicklung seiner Squirtle-Anwendung ist noch nicht abgeschlossen.  Ich habe beschlossen, dass Sie alle mit diesen Sicherheitsl√ºcken vertraut sind, √ºber deren Probleme wir immer wieder sprechen, weil sie in keiner Weise behoben sind und sich √ºberall manifestieren.  Ich geh√∂re zur Unternehmensumgebung, daher bin ich mir des Problems bewusst, √ºber das ich mich st√§ndig beschwere - dass Websites keine SSL-Verschl√ºsselung von Authentifizierungsanforderungen durchf√ºhren, genauso wie sie ihre Cookies nicht verschl√ºsseln.  Im Jahr 2010 wurde eine Firefox-Browsererweiterung namens Firesheep ver√∂ffentlicht. <br><br>  Sie sind wahrscheinlich mit diesem Tool zum Abfangen unverschl√ºsselter HTTP-Cookies beliebter Websites und anderer Sitzungen zum Arbeiten mit Websites √ºber WLAN oder Netzwerk-Sniffing vertraut, die sich als andere Benutzer ausgeben. <br><br><img src="https://habrastorage.org/webt/bq/wp/fk/bqwpfk8n_ufmlqpudkkukju9iqc.jpeg"><br><br>  Ich fragte mich, woher die Leute den Drang hatten, solche Werkzeuge zu entwickeln.  Es stellt sich heraus, dass es um Benutzerfreundlichkeit geht.  Es ist einfach genug, eine Anwendung zu erstellen, mit der Sie sich als jemand anderes ausgeben k√∂nnen.  Deshalb habe ich mich entschlossen, von derselben Seite aus zu beginnen und eine Anwendung zu erstellen, mit der die NTLM-Relaying-Methode verwendet werden kann, um den Leuten zu zeigen, dass es so einfach wie Firesheep ist. <br><br><img src="https://habrastorage.org/webt/rk/we/3g/rkwe3gmeq7t-edqk0jno3qqzwyu.jpeg"><br><br>  Ich habe angefangen, an NTLM Relaying zu arbeiten, um zu sehen, wie Multiprotokollunterst√ºtzung m√∂glich ist.  Viele Leute sprachen √ºber die theoretische M√∂glichkeit einer solchen Unterst√ºtzung, aber niemand setzte sie in die Praxis um.  Mein Ziel war es also, Firesheep f√ºr NTLM zu erstellen. <br>  Ich habe beschlossen, Ruby zu lernen, weil ich meinen Exploit urspr√ºnglich in Metasploit integrieren wollte.  2012 wollte ich dieses Thema auf Black Hat- und DefCon-Konferenzen ansprechen, aber mein Bericht wurde abgelehnt.  Meine Reden wurden nicht nur abgelehnt, ich erhielt eine gef√§lschte E-Mail, dass DefCon meinen Bericht akzeptierte.  Ein Freund dachte, es w√§re sehr lustig, mich zu trollen, er ist so ein Idiot.  Er hatte hier einen Freund, dessen Leistung genehmigt wurde, und mein Freund nahm mich auf und schickte mir den Inhalt seiner E-Mail.  Ich habe nicht auf die √úberschrift geachtet, die "From Nikita" lautete und in Panik geriet, als mir klar wurde, dass ich in anderthalb Stunden bei DefCon sprechen sollte, aber dann erhielt ich einen echten Brief mit einer Ablehnung. <br><br>  Glaubst du, das beendet die Geschichte?  Nein, drei Wochen sp√§ter sagt mir Nikita: "Hey, wir haben am Sonntag eine Er√∂ffnung, jemand hat sich geweigert teilzunehmen, willst du an seiner Stelle sprechen?"  Ich fand es in Ordnung, aber dann wurde mir klar, dass ich vor der Auff√ºhrung nur sehr wenig Zeit hatte, und ich begann wie verr√ºckt zu programmieren und versuchte, alles p√ºnktlich zu beenden. <br><br>  Was waren meine Probleme?  Erstens konnten fremde Tools den von mir ben√∂tigten Pentester-Job nicht ausf√ºhren, da ihnen verschiedene Protokolle fehlten, die Authentifizierungsanforderungen zur√ºckgeben konnten.  Die meisten Protokolle bezogen sich auf die Verwendung von SMB und HTTP, und keines von ihnen unterst√ºtzte LDAP f√ºr die MySQL-Authentifizierung oder zumindest das Testen von Remotedesktop, VPNs und dergleichen. <br><br>  Ein weiteres Problem bestand darin, dass alle Anfragen an dasselbe Ziel weitergeleitet wurden.  Das hei√üt, wir haben Benutzerdaten und Computerkonten empfangen und die gesamte Authentifizierung an einen einzigen Zweck gesendet. Daher konnten wir Benutzer vor der Authentifizierung, dh vor dem Empfang einer Nachricht vom Typ 3, nicht identifizieren.  Wenn Sie sich an diese Nachrichten vom Typ 1,2,3 erinnern, ist die Nachricht vom Typ 2 die Antwort des Servers.  Es ist f√ºr jede Sitzung einzigartig und ich wei√ü nicht, wer diese Benutzer sind, bis sie die letzte Nachricht vom Typ 3 senden, und ich wei√ü nicht, welche Antwort und von welchem ‚Äã‚ÄãServer der Benutzer ist.  Ich war daran interessiert, warum es keine Tools gibt, die dies tun w√ºrden, deshalb habe ich mir Protokolle wie SMB und HTTP genauer angesehen. Sp√§ter werden wir genauer darauf eingehen. <br><br>  Windows 8 und Windows 2012 unterst√ºtzen weiterhin standardm√§√üig NTLM.  Dies ist be√§ngstigend, da wir √ºber die Sicherheitsanf√§lligkeit dieser Protokolle Bescheid wissen, NTLM jedoch nicht verschwunden ist.  Deshalb informieren wir als Pentester Organisationen, dass sie sich vor solchen Angriffen sch√ºtzen m√ºssen. <br>  Also wollte ich dieses Problem l√∂sen und habe ein Tool namens ZackAttack erstellt.  Ich wei√ü, dass es h√§sslich aussieht, aber wir haben eine ganze Reihe von Namen durchgesehen. Ich pers√∂nlich mochte den letzten am meisten - ‚ÄûNTLMv2?  H√ºndin bitte ... ". <br><br><img src="https://habrastorage.org/webt/m-/2t/ho/m-2tho0orjti9rj9ytmo0su1jv0.jpeg"><br><br>  Was ist in diesem Tool enthalten?  Ich werde diese Folien schnell durchgehen, weil ich denke, dass Sie bereits genug unterhalten wurden.  ZackAttack besteht aus mehreren verschiedenen Komponenten, wir werden √ºber jede von ihnen sprechen und wie sie miteinander zusammenh√§ngen. <br><br>  Zun√§chst gibt es einen HTTP-SMB-Server - dies ist ein betr√ºgerischer Server, der Authentifizierungsanforderungen akzeptiert.  Clients zielen also auf diesen Server ab, authentifizieren sich und der Server h√§lt sie authentifiziert.  Als n√§chstes haben wir eine Reihe von Regeln f√ºr den automatischen Betrieb. <br><br>  Wir haben Clients f√ºr solche automatischen Exploits sowie APIs, die wir mit jeder Drittanbieteranwendung verkn√ºpfen k√∂nnen, die NTLM-Relaying-Anforderungen √ºbertr√§gt. <br><br><img src="https://habrastorage.org/webt/1o/xt/om/1oxtompzqtshvinccoxpb1yfzwe.jpeg"><br><br>  Schlie√ülich haben wir eine Generation von Nutzdaten, die Kunden dazu zwingen, sich automatisch f√ºr uns zu authentifizieren. <br><br>  Was sind betr√ºgerische Server?  Erstens authentifizieren sie Benutzer und speichern sie f√ºr uns, sp√§ter werde ich Ihnen sagen, wie wir sie verwenden. <br><br><img src="https://habrastorage.org/webt/c2/ik/io/c2ikiockvkztijbnn4e-kcqg6ke.jpeg"><br><br>  Wir brauchen all diese Leute, um ihren Authentifizierungsstatus aufrechtzuerhalten.  Es gibt viele Tools, die Benutzer nach der ersten erfolgreichen Authentifizierung deaktivieren, aber unser ZackAttack-Tool h√§lt Benutzer so lange wie m√∂glich authentifiziert.  In Windows LAN f√ºr SMB dauert dies ungef√§hr 30 Mal, bevor die Verbindung getrennt wird.  Wir m√ºssen also herausfinden, wer dieser Benutzer ist, w√§hrend wir ihn authentifizieren. <br><br>  Die erste Authentifizierungsanforderung ist ein statischer Aufruf vom Typ 112233. Diejenigen unter Ihnen, die am Pentesting beteiligt sind, wissen, dass dies eine Art Aufgabe f√ºr ‚ÄûRegenbogentabellen‚Äú ist.  Wie gesagt, wir m√ºssen herausfinden, wer dieser Benutzer ist, aber wir wissen das nicht, bis wir zur Typ 3-Nachricht kommen, also senden wir eine Reihe von Anrufen.  Ich nenne dies das "Alzheimer-Element", wenn das System vergisst, wer der Benutzer ist, und ihn jedes Mal auffordert, sich zu authentifizieren, um eine Verbindung herzustellen, ohne die Sitzung zu schlie√üen. <br><br>  Der Grund, warum wir dies tun, ist, dass HTTP, WPAD und andere Anforderungen Cookies nicht immer unterst√ºtzen. Au√üerdem funktioniert die SMB-Identifizierung √ºber IP oder Quellport. Quellport funktioniert nicht, wenn Sie versuchen, dies remote √ºber das Internet zu tun. <br><br>  Daher verwenden wir f√ºr den HTTP-Server eine 302-Umleitung mit dem Keep-Alive-Parameter, mit der wir die Sitzung offen halten k√∂nnen, w√§hrend der Socket geschlossen ist. Nach der Authentifizierung wissen wir, wer sie sind, und wir wissen dies bis zum Ende dieser Sitzung. <br><br>  Mit SMB war es schwieriger, ich musste einen benutzerdefinierten SMB-Server schreiben, es ist ein bisschen fehlerhaft, aber es funktioniert trotzdem.  Ich werde mich nicht mit dem Authentifizierungsmechanismus des SMB-Protokolls befassen, da dies einige Stunden dauern wird, daher werde ich kurz darauf eingehen.  Nachdem der Server die Authentifizierungsanforderung erhalten hat, scheint er zu vergessen, wer dieser Benutzer ist, und sagt: "Oh, hallo, sch√∂n Sie kennenzulernen!"  "Cool, ich m√∂chte mich verbinden!"  "Warten Sie, und wer sind Sie?" Und erfordert erneut eine Authentifizierungsanforderung. <br><br>  Daher m√ºssen wir Authentifizierungsanforderungen empfangen, die an HTTP- und SMB-Server gesendet werden.  Viele Leute fragen, wie wir den Angriff ‚ÄûMann in der Mitte‚Äú durchf√ºhren.  Es gibt verschiedene M√∂glichkeiten, um Benutzer dazu zu bringen, sich bei unserem Server zu authentifizieren und sie dann zu anderen Aufgaben zu senden.  √úberlegen Sie daher, wie hoch die Nutzlast in unserem Tool ist. <br><br>  Dies ist zun√§chst WPAD - ein Protokoll f√ºr die automatische Proxy-Konfiguration, mit dem Sie den Speicherort der Konfigurationsdatei bestimmen k√∂nnen.  Wenn Sie unter Windows versuchen, wie Sie wissen, eine Verbindung herzustellen, wird ein Fenster mit einem kleinen H√§kchen "Meine Verbindungseinstellungen automatisch finden" angezeigt, das WPAD aktiviert.  Dieses Protokoll sendet Anforderungen zum √úberpr√ºfen von DNS- und Netzwerksendungen, damit Sie diese Anforderungen f√§lschen und darauf antworten k√∂nnen. <br><br>  Standardm√§√üig authentifiziert der Computer unter Windows den WPAD-Server automatisch √ºber HTTP mit den aktuellen Benutzeranmeldeinformationen. <br><br>  18:00 min <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DEFCON 20-Konferenz. Erfassung in 60 Sekunden: von einem Gastkonto zu einem Windows-Dom√§nenadministrator.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 2</a> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/nHU3ujyw_sQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Vielen Dank f√ºr Ihren Aufenthalt bei uns.  Gef√§llt dir unser Artikel?  M√∂chten Sie weitere interessante Materialien sehen?  Unterst√ºtzen Sie uns, indem Sie eine Bestellung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">aufgeben</a> oder Ihren Freunden empfehlen, einen <b>Rabatt von 30% f√ºr Habr-Benutzer auf ein einzigartiges Analogon von Einstiegsservern, das wir f√ºr Sie erfunden haben:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die ganze Wahrheit √ºber VPS (KVM) E5-2650 v4 (6 Kerne) 10 GB DDR4 240 GB SSD 1 Gbit / s von $ 20 oder wie teilt man den Server?</a>  (Optionen sind mit RAID1 und RAID10, bis zu 24 Kernen und bis zu 40 GB DDR4 verf√ºgbar). <br><br>  <b>VPS (KVM) E5-2650 v4 (6 Kerne) 10 GB DDR4 240 GB SSD 1 Gbit / s bis zum Fr√ºhjahr kostenlos,</b> wenn Sie f√ºr einen Zeitraum von sechs Monaten bezahlen, k√∂nnen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> bestellen. <br><br>  <b>Dell R730xd 2 mal g√ºnstiger?</b>  Nur wir haben <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2 x Intel Dodeca-Core Xeon E5-2650v4 128 GB DDR4 6 x 480 GB SSD 1 Gbit / s 100 TV von 249 US-Dollar</a> in den Niederlanden und den USA!</b>  Lesen Sie mehr √ºber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">den Aufbau eines Infrastrukturgeb√§udes.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Klasse mit Dell R730xd E5-2650 v4 Servern f√ºr 9.000 Euro f√ºr einen Cent?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de436472/">https://habr.com/ru/post/de436472/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de436458/index.html">Fortschritt und Hype in der Ai-Forschung</a></li>
<li><a href="../de436460/index.html">Die Wahl von Technologie, Architektur und Design in Softwareprojekten - ohne Bargeld</a></li>
<li><a href="../de436464/index.html">2. Check Point Log Analysis: SmartEvent</a></li>
<li><a href="../de436466/index.html">Electron: Entwicklung von Desktop-Anwendungen mit HTML, CSS und JavaScript</a></li>
<li><a href="../de436468/index.html">Legislative Experiment mit digitaler Innovation</a></li>
<li><a href="../de436474/index.html">DEFCON-Konferenz 20. Erfassung in 60 Sekunden: von einem Gastkonto zu einem Windows-Dom√§nenadministrator. Teil 2</a></li>
<li><a href="../de436476/index.html">Cloud f√ºr Versicherer</a></li>
<li><a href="../de436480/index.html">Ich habe einen Bot gemacht, der mit Personalvermittlern f√ºr mich kommuniziert, und ich mochte</a></li>
<li><a href="../de436482/index.html">Advanced Three.js: Shader-Materialien und Nachbearbeitung</a></li>
<li><a href="../de436484/index.html">Wo finde ich DNS-Einstellungen unter MacOS?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>