<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè• üà∂ üéÖ Guide CMake complet. Deuxi√®me partie: Build System ‚úîÔ∏è ‚õ≥Ô∏è üê∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√©sentation 


 Cet article d√©crit l'utilisation du syst√®me de g√©n√©ration CMake utilis√© dans un grand nombre de projets C / C ++. Il est fortement re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guide CMake complet. Deuxi√®me partie: Build System</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/432096/"><p><img src="https://habrastorage.org/webt/lf/se/70/lfse70sjifxiyddiuym73hdvcho.png"></p><br><h1 id="vvedenie">  Pr√©sentation </h1><br><p>  Cet article d√©crit l'utilisation du syst√®me de g√©n√©ration CMake utilis√© dans un grand nombre de projets C / C ++.  Il est fortement recommand√© de lire la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">premi√®re partie du</a> manuel pour √©viter de mal comprendre la syntaxe du langage CMake, qui appara√Æt explicitement dans tout l'article. </p><a name="habracut"></a><br><h1 id="zapusk-cmake">  Lancement de CMake </h1><br><p>  Voici des exemples d'utilisation du langage CMake que vous devez pratiquer.  Exp√©rimentez avec le code source en modifiant les commandes existantes et en en ajoutant de nouvelles.  Pour ex√©cuter ces exemples, installez CMake √† partir du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site Web officiel</a> . </p><br><h1 id="princip-raboty">  Principe de fonctionnement </h1><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le syst√®me de construction CMake</a> est un wrapper sur d'autres utilitaires d√©pendant de la plate-forme (par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ninja</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Make</a> ).  Ainsi, dans le processus d'assemblage lui-m√™me, aussi paradoxal que cela puisse para√Ætre, il ne participe pas directement. </p><br><p> Le syst√®me de build CMake accepte un fichier <code>CMakeLists.txt</code> avec une description des r√®gles de build dans le langage CMake formel, puis g√©n√®re des fichiers de build natifs et interm√©diaires dans le m√™me r√©pertoire accept√© sur votre plateforme. </p><br><p>  Les fichiers g√©n√©r√©s contiendront des noms sp√©cifiques d'utilitaires syst√®me, de r√©pertoires et de compilateurs, tandis que les commandes CMake n'utilisent que le concept abstrait du compilateur et ne sont pas li√©es √† des outils d√©pendants de la plate-forme qui diff√®rent consid√©rablement selon les diff√©rents syst√®mes d'exploitation. </p><br><h1 id="proverka-versii-cmake">  V√©rification de la version de CMake </h1><br><p>  La commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>cmake_minimum_required</code></a> v√©rifie la version en cours d'ex√©cution de CMake: si elle est inf√©rieure au minimum sp√©cifi√©, alors CMake se termine avec une erreur fatale.  Un exemple qui montre l'utilisation typique de cette commande au d√©but de n'importe quel fichier CMake: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#     CMake: cmake_minimum_required(VERSION 3.0)</span></span></code> </pre> <br><p>  Comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">indiqu√©</a> dans les commentaires, la commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>cmake_minimum_required</code></a> d√©finit tous les indicateurs de compatibilit√© (voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>cmake_policy</code></a> ).  Certains d√©veloppeurs ont intentionnellement d√©fini une version basse de CMake, puis ajustent la fonctionnalit√© manuellement.  Cela vous permet de prendre en charge simultan√©ment les anciennes versions de CMake et, √† certains endroits, de profiter de nouvelles fonctionnalit√©s. </p><br><h1 id="oformlenie-proekta">  Conception du projet </h1><br><p>  Au d√©but de tout <code>CMakeLists.txt</code> sp√©cifier les caract√©ristiques du projet avec l'√©quipe de projet pour une meilleure conception avec des environnements int√©gr√©s et d'autres outils de d√©veloppement. </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#    "MyProject": project(MyProject VERSION 1.2.3.4 LANGUAGES C CXX)</span></span></code> </pre> <br><p>  Il convient de noter que si le mot cl√© <code>LANGUAGES</code> est omis, les langues par d√©faut sont <code>C CXX</code> .  Vous pouvez √©galement d√©sactiver l'indication de toutes les langues en √©crivant le mot-cl√© <code>NONE</code> sous forme de liste de langues ou simplement laisser une liste vide. </p><br><h1 id="zapusk-skriptovyh-faylov">  Ex√©cution de fichiers de script </h1><br><p>  La commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>include</code></a> remplace la ligne de son appel par le code du fichier sp√©cifi√©, agissant de mani√®re similaire √† la commande <code>include</code> pr√©processeur C / C ++.  Cet exemple ex√©cute le fichier de script <code>MyCMakeScript.cmake</code> commande d√©crite: </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">message</span></span>(<span class="hljs-string"><span class="hljs-string">"'TEST_VARIABLE' is equal to [${TEST_VARIABLE}]"</span></span>) <span class="hljs-comment"><span class="hljs-comment">#   `MyCMakeScript.cmake`  : include(MyCMakeScript.cmake) message("'TEST_VARIABLE' is equal to [${TEST_VARIABLE}]")</span></span></code> </pre> <br><p>  Dans cet exemple, le premier message notifiera que la variable <code>TEST_VARIABLE</code> pas encore √©t√© d√©finie, cependant, si le script <code>MyCMakeScript.cmake</code> cette variable, le deuxi√®me message informera d√©j√† de la nouvelle valeur de la variable de test.  Ainsi, le fichier de script inclus par la commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>include</code></a> ne cr√©e pas sa propre port√©e, qui √©tait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mentionn√©e</a> dans les commentaires de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article pr√©c√©dent</a> . </p><br><h1 id="kompilyaciya-ispolnyaemyh-faylov">  Compilation de fichiers ex√©cutables </h1><br><p>  La commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>add_executable</code></a> compile le fichier ex√©cutable avec le nom donn√© dans la liste source.  Il est important de noter que le nom de fichier final d√©pend de la plate-forme cible (par exemple, <code>&lt;ExecutableName&gt;.exe</code> ou simplement <code>&lt;ExecutableName&gt;</code> ).  Un exemple typique d'appeler cette commande: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#    "MyExecutable"  #  "ObjectHandler.c", "TimeManager.c"  "MessageGenerator.c": add_executable(MyExecutable ObjectHandler.c TimeManager.c MessageGenerator.c)</span></span></code> </pre> <br><h1 id="kompilyaciya-bibliotek">  Compilation de biblioth√®que </h1><br><p>  La commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>add_library</code></a> compile la biblioth√®que avec la vue et le nom sp√©cifi√©s √† partir de la source.  Il est important de noter que le nom de biblioth√®que final d√©pend de la plate-forme cible (par exemple, <code>lib&lt;LibraryName&gt;.a</code> ou <code>&lt;LibraryName&gt;.lib</code> ).  Un exemple typique d'appeler cette commande: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#    "MyLibrary"  #  "ObjectHandler.c", "TimeManager.c"  "MessageConsumer.c": add_library(MyLibrary STATIC ObjectHandler.c TimeManager.c MessageConsumer.c)</span></span></code> </pre> <br><ul><li>  Les biblioth√®ques statiques sont sp√©cifi√©es par le mot cl√© <code>STATIC</code> comme deuxi√®me argument et sont des archives de fichiers objets associ√©s √† des fichiers ex√©cutables et √† d'autres biblioth√®ques au moment de la compilation; </li><li>  Les biblioth√®ques dynamiques sont sp√©cifi√©es par le mot cl√© <code>SHARED</code> comme deuxi√®me argument et sont des biblioth√®ques binaires charg√©es par le syst√®me d'exploitation lors de l'ex√©cution du programme; </li><li>  Les biblioth√®ques modulaires sont d√©finies par le mot-cl√© <code>MODULE</code> comme deuxi√®me argument et sont des biblioth√®ques binaires charg√©es en utilisant la technique d'ex√©cution par l'ex√©cutable lui-m√™me; </li><li>  Les biblioth√®ques d'objets sont d√©finies par le mot cl√© <code>OBJECT</code> comme deuxi√®me argument et sont un ensemble de fichiers objets associ√©s √† des fichiers ex√©cutables et √† d'autres biblioth√®ques au moment de la compilation. </li></ul><br><h1 id="dobavlenie-ishodnikov-k-celi">  Ajout d'une source √† l'objectif </h1><br><p>  Il existe des cas qui n√©cessitent plusieurs ajouts de fichiers source √† la cible.  Pour ce faire, la commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>target_sources</code></a> est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>target_sources</code></a> , qui peut ajouter plusieurs fois des sources √† la cible. </p><br><p>  Le premier argument de la commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>target_sources</code></a> est le nom de la cible pr√©c√©demment sp√©cifi√© √† l'aide des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>add_executable</code></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>add_library</code></a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>add_executable</code></a> , et les arguments suivants sont une liste des fichiers source √† ajouter. </p><br><p>  Les appels r√©p√©t√©s √† la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>target_sources</code></a> ajoutent les fichiers source √† la cible dans l'ordre dans lequel ils ont √©t√© appel√©s, de sorte que les deux derniers blocs de code sont fonctionnellement √©quivalents: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#    "MyExecutable"   # "ObjectPrinter.c"  "SystemEvaluator.c": add_executable(MyExecutable ObjectPrinter.c SystemEvaluator.c) #    "MyExecutable"  "MessageConsumer.c": target_sources(MyExecutable MessageConsumer.c) #    "MyExecutable"  "ResultHandler.c": target_sources(MyExecutable ResultHandler.c)</span></span></code> </pre> <br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#    "MyExecutable"   # "ObjectPrinter.c", "SystemEvaluator.c", "MessageConsumer.c"  "ResultHandler.c": add_executable(MyExecutable ObjectPrinter.c SystemEvaluator.c MessageConsumer.c ResultHandler.c)</span></span></code> </pre> <br><h1 id="generiruemye-fayly">  Fichiers g√©n√©r√©s </h1><br><p>  L'emplacement des fichiers de sortie g√©n√©r√©s par les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>add_library</code></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>add_executable</code></a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>add_library</code></a> n'est d√©termin√© qu'au stade de la g√©n√©ration, cependant, cette r√®gle peut √™tre modifi√©e avec plusieurs variables qui d√©terminent l'emplacement final des fichiers binaires: </p><br><ul><li>  Les variables <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>RUNTIME_OUTPUT_DIRECTORY</code></a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>RUNTIME_OUTPUT_NAME</code></a> d√©terminent l'emplacement des cibles d'ex√©cution; </li><li>  Les variables <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>LIBRARY_OUTPUT_DIRECTORY</code></a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>LIBRARY_OUTPUT_NAME</code></a> d√©terminent l'emplacement des biblioth√®ques; </li><li>  Les variables <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>ARCHIVE_OUTPUT_DIRECTORY</code></a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>ARCHIVE_OUTPUT_NAME</code></a> d√©terminent l'emplacement des archives. </li></ul><br><p>  Les fichiers ex√©cutables sont toujours consid√©r√©s comme des objectifs d'ex√©cution, les biblioth√®ques statiques sont consid√©r√©es comme des objectifs d'archivage et les biblioth√®ques modulaires sont consid√©r√©es comme des objectifs de biblioth√®que.  Pour les plates-formes "non DLL", les biblioth√®ques dynamiques sont consid√©r√©es comme des cibles de biblioth√®que et pour les "plates-formes DLL", des objectifs d'ex√©cution.  Ces variables ne sont pas fournies pour les biblioth√®ques d'objets, car ce type de biblioth√®ques est g√©n√©r√© dans les entrailles du r√©pertoire <code>CMakeFiles</code> . </p><br><p>  Il est important de noter que toutes les plates-formes Windows, y compris <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cygwin,</a> sont consid√©r√©es comme des "plates-formes DLL". </p><br><h1 id="komponovka-s-bibliotekami">  Disposition de la biblioth√®que </h1><br><p>  La commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>target_link_libraries</code></a> biblioth√®que ou un ex√©cutable avec d'autres biblioth√®ques fournies.  Le premier argument de cette commande est le nom de la cible g√©n√©r√©e par les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>add_library</code></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>add_executable</code></a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>add_library</code></a> , et les arguments suivants sont les noms des cibles de biblioth√®que ou les chemins d'acc√®s complets aux biblioth√®ques.  Un exemple: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#    "MyExecutable"  #  "JsonParser", "SocketFactory"  "BrowserInvoker": target_link_libraries(MyExecutable JsonParser SocketFactory BrowserInvoker)</span></span></code> </pre> <br><p>  Il convient de noter que les biblioth√®ques modulaires ne peuvent pas √™tre li√©es √† des fichiers ex√©cutables ou √† d'autres biblioth√®ques, car elles sont uniquement destin√©es au chargement par des techniques d'ex√©cution. </p><br><h1 id="rabota-s-celyami">  Travailler avec des objectifs </h1><br><p>  Comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mentionn√©</a> dans les commentaires, les cibles dans CMake sont √©galement sujettes √† une manipulation manuelle, mais tr√®s limit√©e. </p><br><p>  Il est possible de contr√¥ler les propri√©t√©s des cibles con√ßues pour d√©finir le processus d'assemblage du projet.  La commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>get_target_property</code></a> valeur de la propri√©t√© cible sur la variable fournie.  Cet exemple affiche la valeur de la propri√©t√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>C_STANDARD</code></a> de la cible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>C_STANDARD</code></a> √† l'√©cran: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#   "VALUE"   "C_STANDARD": get_target_property(VALUE MyTarget C_STANDARD) #      : message("'C_STANDARD' property is equal to [${VALUE}]")</span></span></code> </pre> <br><p>  La commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>set_target_properties</code></a> d√©finit les propri√©t√©s cibles sp√©cifi√©es sur les valeurs sp√©cifi√©es.  Cette commande accepte une liste d'objectifs pour lesquels des valeurs de propri√©t√© seront d√©finies, puis le mot-cl√© <code>PROPERTIES</code> , suivi d'une liste de la forme <code>&lt; &gt; &lt; &gt;</code> : </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#   'C_STANDARD'  "11", #   'C_STANDARD_REQUIRED'  "ON": set_target_properties(MyTarget PROPERTIES C_STANDARD 11 C_STANDARD_REQUIRED ON)</span></span></code> </pre> <br><p>  L'exemple ci-dessus d√©finit les propri√©t√©s des cibles <code>MyTarget</code> qui affectent le processus de compilation, √† savoir: lors de la compilation de la cible <code>MyTarget</code> CMake <code>MyTarget</code> compilateur d'utiliser la norme C11.  Tous les noms de propri√©t√© cible connus sont r√©pertori√©s sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cette page</a> . </p><br><p>  Il est √©galement possible de v√©rifier les cibles pr√©c√©demment d√©finies √† l'aide de la construction <code>if(TARGET &lt;TargetName&gt;)</code> : </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#  "The target was defined!"   "MyTarget"  , #    "The target was not defined!": if(TARGET MyTarget) message("The target was defined!") else() message("The target was not defined!") endif()</span></span></code> </pre> <br><h1 id="dobavlenie-podproektov">  Ajout de sous-projets </h1><br><p>  La commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>add_subdirectory</code></a> invite CMake √† traiter imm√©diatement le fichier de sous-projet sp√©cifi√©.  L'exemple ci-dessous illustre l'application du m√©canisme d√©crit: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#   "subLibrary"    , #       "subLibrary/build": add_subdirectory(subLibrary subLibrary/build)</span></span></code> </pre> <br><p>  Dans cet exemple, le premier argument de la commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>add_subdirectory</code></a> est le sous-projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>add_subdirectory</code></a> et le deuxi√®me argument est facultatif et informe CMake du dossier destin√© aux fichiers g√©n√©r√©s du sous-projet inclus (par exemple, <code>CMakeCache.txt</code> et <code>cmake_install.cmake</code> ). </p><br><p>  Il convient de noter que toutes les variables de la port√©e parent sont h√©rit√©es par le r√©pertoire ajout√©, et toutes les variables d√©finies et red√©finies dans ce r√©pertoire ne seront visibles que par lui (si le mot-cl√© <code>PARENT_SCOPE</code> pas <code>PARENT_SCOPE</code> sp√©cifi√© par l'argument de commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>set</code></a> ).  Cette fonctionnalit√© a √©t√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mentionn√©e</a> dans les commentaires de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article pr√©c√©dent</a> . </p><br><h1 id="poisk-paketov">  Recherche de package </h1><br><p>  La commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>find_package</code></a> recherche et charge les param√®tres d'un projet externe.  Dans la plupart des cas, il est utilis√© pour la liaison ult√©rieure de biblioth√®ques externes telles que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Boost</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GSL</a> .  Cet exemple appelle la commande d√©crite pour rechercher la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GSL</a> puis lier: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#     "GSL": find_package(GSL 2.5 REQUIRED) #      "GSL": target_link_libraries(MyExecutable GSL::gsl) #      "GSL": target_include_directories(MyExecutable ${GSL_INCLUDE_DIRS})</span></span></code> </pre> <br><p>  Dans l'exemple ci-dessus, la commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>find_package</code></a> accepte le nom du package comme premier argument, puis la version requise.  L'option <code>REQUIRED</code> n√©cessite l'impression d'une erreur fatale et la fermeture de CMake si le package requis n'est pas trouv√©.  L'oppos√© est l'option <code>QUIET</code> , obligeant CMake √† continuer son travail, m√™me si le paquet n'a pas √©t√© trouv√©. </p><br><p>  Ensuite, l' <code>MyExecutable</code> li√© √† la biblioth√®que GSL avec la commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>target_link_libraries</code></a> √† l'aide de la variable <code>GSL::gsl</code> , qui encapsule l'emplacement du GSL d√©j√† compil√©. </p><br><p>  √Ä la fin, la commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>target_include_directories</code></a> est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>target_include_directories</code></a> , informant le compilateur de l'emplacement des fichiers d'en-t√™te de biblioth√®que GSL.  Veuillez noter que la variable <code>GSL_INCLUDE_DIRS</code> est utilis√©e pour <code>GSL_INCLUDE_DIRS</code> emplacement des en-t√™tes que j'ai d√©crits (il s'agit d'un exemple de param√®tres de package import√©s). </p><br><p>  Vous souhaiterez probablement v√©rifier le r√©sultat d'une recherche de package si vous avez sp√©cifi√© l'option <code>QUIET</code> .  Cela peut √™tre fait en v√©rifiant la <code>&lt;PackageName&gt;_FOUND</code> , qui est automatiquement d√©termin√©e une fois la commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>find_package</code></a> .  Par exemple, si vous importez avec succ√®s les param√®tres GSL dans votre projet, la variable <code>GSL_FOUND</code> deviendra vraie. </p><br><p>  En g√©n√©ral, la commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>find_package</code></a> a deux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>find_package</code></a> de lancement: modulaire et configuration.  L'exemple ci-dessus a appliqu√© une forme modulaire.  Cela signifie que lorsque la commande est appel√©e, CMake recherche un fichier de script du formulaire <code>Find&lt;PackageName&gt;.cmake</code> dans le r√©pertoire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>CMAKE_MODULE_PATH</code></a> , puis le lance et importe tous les param√®tres n√©cessaires (dans ce cas, CMake a lanc√© le fichier <code>FindGSL.cmake</code> standard). </p><br><h1 id="sposoby-vklyucheniya-zagolovkov">  Fa√ßons d'inclure des en-t√™tes </h1><br><p>  Vous pouvez informer le compilateur de l'emplacement des en-t√™tes inclus en utilisant deux commandes: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>include_directories</code></a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>target_include_directories</code></a> .  Vous d√©cidez lequel utiliser, cependant, il convient de consid√©rer certaines diff√©rences entre eux (l'id√©e est sugg√©r√©e dans les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">commentaires</a> ). </p><br><p>  La commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>include_directories</code></a> affecte la port√©e du r√©pertoire.  Cela signifie que tous les r√©pertoires d'en-t√™te sp√©cifi√©s par cette commande seront utilis√©s pour toutes les fins du <code>CMakeLists.txt</code> actuel, ainsi que pour les sous-projets trait√©s (voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>add_subdirectory</code></a> ). </p><br><p>  La commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>target_include_directories</code></a> affecte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>target_include_directories</code></a> la cible sp√©cifi√©e par le premier argument et n'affecte pas les autres cibles.  L'exemple ci-dessous montre la diff√©rence entre les deux commandes: </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">add_executable</span></span>(RequestGenerator RequestGenerator.c) <span class="hljs-keyword"><span class="hljs-keyword">add_executable</span></span>(ResponseGenerator ResponseGenerator.c) <span class="hljs-comment"><span class="hljs-comment">#     "RequestGenerator": target_include_directories(RequestGenerator headers/specific) #    "RequestGenerator"  "ResponseGenerator": include_directories(headers)</span></span></code> </pre> <br><p>  Dans les commentaires, il est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mentionn√©</a> que dans les projets modernes, l'utilisation des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>link_libraries</code></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>include_directories</code></a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>link_libraries</code></a> n'est pas souhaitable.  Une alternative est les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>target_link_libraries</code></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>target_include_directories</code></a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>target_link_libraries</code></a> qui n'agissent que sur des objectifs sp√©cifiques, et non sur l'ensemble de la port√©e actuelle. </p><br><h1 id="ustanovka-proekta">  Installation du projet </h1><br><p>  La commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>install</code></a> g√©n√®re des r√®gles d'installation pour votre projet.  Cette commande est capable de travailler avec des objectifs, des fichiers, des dossiers, etc.  Tout d'abord, envisagez de fixer des objectifs. </p><br><p>  Pour d√©finir des objectifs, vous devez passer le mot cl√© <code>TARGETS</code> comme premier argument de la fonction d√©crite, suivi d'une liste des objectifs √† d√©finir, puis du mot cl√© <code>DESTINATION</code> avec l'emplacement du r√©pertoire dans lequel les objectifs sp√©cifi√©s seront d√©finis.  Cet exemple illustre une d√©finition d'objectif typique: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#   "TimePrinter"  "DataScanner"   "bin": install(TARGETS TimePrinter DataScanner DESTINATION bin)</span></span></code> </pre> <br><p>  Le processus de description de l'installation des fichiers est similaire, sauf que <code>TARGETS</code> devez sp√©cifier <code>FILES</code> au lieu du mot cl√© <code>TARGETS</code> .  Un exemple d√©montrant l'installation de fichiers: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#   "DataCache.txt"  "MessageLog.txt"   "~/": install(FILES DataCache.txt MessageLog.txt DESTINATION ~/)</span></span></code> </pre> <br><p>  Le processus de description de l'installation des dossiers est similaire, sauf que vous devez sp√©cifier <code>DIRECTORY</code> au lieu du mot-cl√© <code>FILES</code> .  Il est important de noter que lors de l'installation, tout le contenu du dossier sera copi√©, et pas seulement son nom.  Un exemple d'installation de dossiers est le suivant: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#   "MessageCollection"  "CoreFiles"   "~/": install(DIRECTORY MessageCollection CoreFiles DESTINATION ~/)</span></span></code> </pre> <br><p>  Apr√®s avoir termin√© le traitement CMake de tous vos fichiers, vous pouvez installer tous les objets d√©crits avec la <code>sudo checkinstall</code> (si CMake g√©n√®re un <code>Makefile</code> ), ou effectuer cette action avec l'environnement de d√©veloppement int√©gr√© qui prend en charge CMake. </p><br><h1 id="naglyadnyy-primer-proekta">  Exemple visuel du projet </h1><br><p>  Ce guide ne serait pas complet sans d√©montrer un exemple concret d'utilisation du syst√®me de construction CMake.  Consid√©rons un diagramme de projet simple utilisant CMake comme seul syst√®me de construction: </p><br><pre> <code class="plaintext hljs">+ MyProject - CMakeLists.txt - Defines.h - StartProgram.c + core - CMakeLists.txt - Core.h - ProcessInvoker.c - SystemManager.c</code> </pre> <br><p>  Le fichier d'assemblage principal <code>CMakeLists.txt</code> d√©crit la compilation de l'ensemble du programme: tout d'abord, la commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>add_executable</code></a> est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>add_executable</code></a> qui compile le fichier ex√©cutable, puis la commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>add_subdirectory</code></a> est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>add_subdirectory</code></a> , ce qui stimule le traitement du sous-projet, et enfin, le fichier ex√©cutable est li√© √† la biblioth√®que compil√©e: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#    CMake: cmake_minimum_required(VERSION 3.0) #   : project(MyProgram VERSION 1.0.0 LANGUAGES C) #      "MyProgram": add_executable(MyProgram StartProgram.c) #    "core/CMakeFiles.txt": add_subdirectory(core) #    "MyProgram"  #    "MyProgramCore": target_link_libraries(MyProgram MyProgramCore) #    "MyProgram"   "bin": install(TARGETS MyProgram DESTINATION bin)</span></span></code> </pre> <br><p>  Le fichier <code>core/CMakeLists.txt</code> est appel√© par le fichier d'assembly principal et compile la biblioth√®que statique <code>MyProgramCore</code> destin√©e √† la liaison avec le fichier ex√©cutable: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#    CMake: cmake_minimum_required(VERSION 3.0) #      "MyProgramCore": add_library(MyProgramCore STATIC ProcessInvoker.c SystemManager.c)</span></span></code> </pre> <br><p>  Apr√®s une s√©rie de commandes <code>cmake . &amp;&amp; make &amp;&amp; sudo checkinstall</code>  <code>cmake . &amp;&amp; make &amp;&amp; sudo checkinstall</code> syst√®me de build CMake se termine avec succ√®s.  La premi√®re commande commence √† traiter le fichier <code>CMakeLists.txt</code> dans le r√©pertoire racine du projet, la deuxi√®me commande compile enfin les fichiers binaires n√©cessaires et la troisi√®me commande installe l' <code>MyProgram</code> compil√© <code>MyProgram</code> dans le syst√®me. </p><br><h1 id="zaklyuchenie">  Conclusion </h1><br><p>  Vous pouvez maintenant √©crire les v√¥tres et comprendre les fichiers CMake d'autres personnes, et vous pouvez lire en d√©tail d'autres m√©canismes sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site officiel</a> . </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le prochain article de</a> ce guide se concentrera sur les tests et la cr√©ation de packages √† l'aide de CMake et sera publi√© dans une semaine.  A tr√®s bient√¥t! <br></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr432096/">https://habr.com/ru/post/fr432096/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr432086/index.html">Impression 3D √† l'√©cole internationale du nom de M.V. Lomonosov</a></li>
<li><a href="../fr432088/index.html">Haute disponibilit√© MySQL sur GitHub</a></li>
<li><a href="../fr432090/index.html">Magento Meetup Kharkiv No. 4 - rapports vid√©o</a></li>
<li><a href="../fr432092/index.html">Erreurs d√©sagr√©ables lors de l'√©criture des tests unitaires</a></li>
<li><a href="../fr432094/index.html">Hackathon en ligne conjoint d'OpenGift et de la plateforme Blockchain de cr√©dits</a></li>
<li><a href="../fr432098/index.html">Pilotes automatiques dans le transport routier, comment interagir avec les sp√©ciaux. en transport?</a></li>
<li><a href="../fr432100/index.html">Comment nous avons am√©lior√© la conversion de facturation</a></li>
<li><a href="../fr432102/index.html">Fonctionnalit√©s JavaScript explicites</a></li>
<li><a href="../fr432104/index.html">R√©capitulatif des √©v√©nements informatiques de d√©cembre (premi√®re partie)</a></li>
<li><a href="../fr432106/index.html">Food Design Digest, novembre 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>