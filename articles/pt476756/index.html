<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶Ç ü§≥üèø üíÖ Transformando FunC em funcional com Haskell: como a Serokell venceu a competi√ß√£o de blockchain por telegrama üöï üì§ üë©üèø‚Äçüíª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Voc√™ provavelmente j√° ouviu falar que o Telegram vai lan√ßar a plataforma blockchain Ton . Mas voc√™ poderia ter perdido a not√≠cia de que, h√° pouco temp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Transformando FunC em funcional com Haskell: como a Serokell venceu a competi√ß√£o de blockchain por telegrama</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476756/"><p>  Voc√™ provavelmente j√° ouviu falar que o Telegram <a href="https://vc.ru/finance/88457-telegram-predlozhil-investoram-podozhdat-zapuska-ton-do-aprelya-2020-goda-ili-vernut-77-ot-summy-vlozheniy-v-proekt">vai lan√ßar a plataforma blockchain Ton</a> .  Mas voc√™ poderia ter perdido a not√≠cia de que, h√° pouco tempo, o Telegram <a href="https://habr.com/ru/news/t/468755/">anunciou uma competi√ß√£o</a> pela implementa√ß√£o de um ou mais contratos inteligentes para esta plataforma. </p><br><p>  A equipe da Serokell, com vasta experi√™ncia no desenvolvimento de grandes projetos de blockchain, n√£o p√¥de ficar de fora.  Delegamos cinco funcion√°rios para o concurso e, duas semanas depois, eles ocuparam o primeiro lugar com o apelido aleat√≥rio modesto Sexy Chameleon.  Neste artigo, vou falar sobre como eles conseguiram.  Esperamos que, nos pr√≥ximos dez minutos, voc√™ leia pelo menos uma hist√≥ria interessante e, no m√°ximo, encontre algo √∫til que possa aplicar em seu trabalho. </p><br><p>  Mas vamos come√ßar com um pequeno mergulho no contexto. </p><a name="habracut"></a><br><h2 id="konkurs-i-ego-usloviya">  Concorr√™ncia e suas condi√ß√µes </h2><br><p>  Portanto, as principais tarefas dos participantes foram a implementa√ß√£o de um ou mais dos contratos inteligentes propostos, al√©m de apresentar propostas para melhorar o ecossistema de TON.  A competi√ß√£o foi realizada de 24 de setembro a 15 de outubro, e os resultados foram anunciados apenas em 15 de novembro.  Por um longo tempo, dado que, durante esse per√≠odo, o Telegram conseguiu conduzir e anunciar os resultados de concursos de design e desenvolvimento de aplicativos em C ++ para testar e avaliar a qualidade das chamadas VoIP no Telegram. </p><br><p>  Selecionamos dois contratos inteligentes da lista proposta pelos organizadores.  Para um deles, usamos ferramentas distribu√≠das com o TON e o segundo implementamos em um novo idioma desenvolvido por nossos engenheiros especificamente para o TON e incorporado ao Haskell. </p><br><p>  A escolha de uma linguagem de programa√ß√£o funcional n√£o √© acidental.  Em nosso <a href="https://serokell.io/blog">blog corporativo,</a> geralmente falamos sobre por que consideramos a complexidade das linguagens funcionais um grande exagero e por que geralmente preferimos que elas sejam orientadas a objetos.  A prop√≥sito, ele tamb√©m cont√©m o <a href="https://serokell.io/blog/ton-blockchain-competition">original deste artigo</a> . </p><br><h2 id="pochemu-my-voobsche-reshili-uchastvovat">  Por que decidimos participar </h2><br><p>  Em resumo, porque nossa especializa√ß√£o s√£o projetos n√£o padronizados e complexos que requerem habilidades especiais e geralmente t√™m valor cient√≠fico para a comunidade de TI.  Apoiamos calorosamente o desenvolvimento de c√≥digo aberto e estamos envolvidos em sua populariza√ß√£o, bem como cooperamos com as principais universidades da R√∫ssia no campo da ci√™ncia da computa√ß√£o e matem√°tica. </p><br><p>  As tarefas interessantes do concurso e o envolvimento no projeto Telegram, que tanto amamos, eram em si uma excelente motiva√ß√£o, mas o fundo do pr√™mio tornou-se um incentivo adicional.  :) </p><br><h2 id="issledovanie-blokcheyna-ton">  Pesquisa TON Blockchain </h2><br><p>  Monitoramos de perto novos desenvolvimentos no blockchain, intelig√™ncia artificial e aprendizado de m√°quina e tentamos n√£o perder um √∫nico release significativo em cada uma das √°reas em que trabalhamos.  Portanto, quando a competi√ß√£o come√ßou, nossa equipe j√° estava familiarizada com as id√©ias do <a href="https://test.ton.org/ton.pdf">white paper</a> da <a href="https://test.ton.org/ton.pdf">TON</a> .  No entanto, antes de iniciar o trabalho com a TON, n√£o analisamos a documenta√ß√£o t√©cnica e o c√≥digo fonte real da plataforma, portanto, o primeiro passo foi bastante √≥bvio - um estudo completo da documenta√ß√£o oficial no <a href="https://test.ton.org/">site</a> e no <a href="https://github.com/ton-blockchain/ton/tree/master/doc">reposit√≥rio do projeto</a> . </p><br><p>  No in√≠cio do concurso, o c√≥digo j√° havia sido publicado; portanto, para economizar tempo, decidimos procurar um guia ou aperto escrito pelos <em>usu√°rios</em> .  Infelizmente, isso n√£o deu resultado - al√©m das instru√ß√µes para a constru√ß√£o da plataforma no Ubuntu, n√£o encontramos outros materiais. </p><br><p>  A documenta√ß√£o em si foi completamente desenvolvida, mas foi dif√≠cil l√™-la em alguns momentos.  Muitas vezes, tivemos que voltar a certos pontos e passar de descri√ß√µes de alto n√≠vel de id√©ias abstratas para detalhes de implementa√ß√£o de baixo n√≠vel. </p><br><p>  Seria mais f√°cil se a especifica√ß√£o n√£o tivesse uma descri√ß√£o detalhada da implementa√ß√£o.  As informa√ß√µes sobre como a m√°quina virtual apresenta sua pilha s√£o mais perturbadoras para os desenvolvedores que criam contratos inteligentes para a plataforma TON do que para ajud√°-los. </p><br><h2 id="nix-sobiraem-proekt">  Nix: construindo um projeto </h2><br><p>  Na Serokell, somos grandes f√£s do <a href="https://nixos.org/nix">Nix</a> .  Coletamos nossos projetos para eles e os implantamos usando o <a href="https://nixos.org/nixops">NixOps</a> , e o <a href="https://nixos.org/">NixOS √©</a> instalado em todos os nossos servidores.  Gra√ßas a isso, todas as nossas compila√ß√µes s√£o reproduz√≠veis e funcionam em qualquer sistema operacional no qual o Nix possa ser instalado. </p><br><p>  Ent√£o come√ßamos criando <a href="">sobreposi√ß√£o Nix com uma express√£o para criar TON</a> .  Us√°-lo para compilar TON √© o mais simples poss√≠vel: </p><br><pre><code class="plaintext hljs">$ cd ~/.config/nixpkgs/overlays &amp;&amp; git clone https://github.com/serokell/ton.nix $ cd /path/to/ton/repo &amp;&amp; nix-shell [nix-shell]$ cmakeConfigurePhase &amp;&amp; make</code> </pre> <br><p>  Observe que voc√™ n√£o precisa instalar nenhuma depend√™ncia.  O Nix magicamente far√° tudo por voc√™, se voc√™ usa o NixOS, Ubuntu ou macOS. </p><br><h2 id="programmirovanie-dlya-ton">  Programa√ß√£o para TON </h2><br><p>  O c√≥digo do contrato inteligente da TON Network √© executado na TON Virtual Machine (TVM).  O TVM √© mais complicado que a maioria das outras m√°quinas virtuais e possui uma funcionalidade muito interessante, por exemplo, pode trabalhar com <em>continua√ß√µes</em> e <em>links para dados</em> . </p><br><p>  Al√©m disso, os caras da TON criaram tr√™s novas linguagens de programa√ß√£o: </p><br><p>  <strong>Fift</strong> √© uma linguagem de programa√ß√£o de pilha universal que lembra o <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25BE%25D1%2580%25D1%2582_(%25D1%258F%25D0%25B7%25D1%258B%25D0%25BA_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)">Forth</a> .  Sua super habilidade √© a capacidade de interagir com o TVM. </p><br><p>  <strong>FunC</strong> √© uma linguagem de programa√ß√£o de contrato inteligente, semelhante a <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8_(%25D1%258F%25D0%25B7%25D1%258B%25D0%25BA_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)">C</a> e compilada em outra linguagem - Fift Assembler. </p><br><p>  <strong>Fift Assembler</strong> - Biblioteca Fift para gerar c√≥digo execut√°vel bin√°rio para TVM.  O Fift Assembler n√£o possui um compilador.  √â uma <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B5%25D0%25B4%25D0%25BC%25D0%25B5%25D1%2582%25D0%25BD%25D0%25BE-%25D0%25BE%25D1%2580%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9_%25D1%258F%25D0%25B7%25D1%258B%25D0%25BA">linguagem espec√≠fica de dom√≠nio incorporada (eDSL)</a> . </p><br><h2 id="nashi-konkursnye-raboty">  Nossos trabalhos competitivos </h2><br><p>  Finalmente, √© hora de analisar os resultados de nossos esfor√ßos. </p><br><h3 id="asinhronnyy-platezhnyy-kanal">  <strong>Canal de pagamento ass√≠ncrono</strong> </h3><br><p>  Canal de pagamento - um contrato inteligente que permite que dois usu√°rios enviem pagamentos para fora do blockchain.  Como resultado, n√£o apenas dinheiro √© economizado (n√£o h√° comiss√£o), mas tamb√©m tempo (voc√™ n√£o precisa esperar at√© que o pr√≥ximo bloco seja processado).  Os pagamentos podem ser arbitrariamente pequenos e ocorrem quantas vezes forem necess√°rias.  Ao mesmo tempo, as partes n√£o precisam confiar umas nas outras, uma vez que a justi√ßa da liquida√ß√£o final √© garantida por um contrato inteligente. </p><br><p>  Encontramos uma solu√ß√£o bastante simples para o problema.  Duas partes podem trocar mensagens assinadas, cada uma contendo dois n√∫meros - o valor total pago por cada um dos participantes.  Esses dois n√∫meros funcionam como <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25B5%25D0%25BA%25D1%2582%25D0%25BE%25D1%2580%25D0%25BD%25D1%258B%25D0%25B5_%25D1%2587%25D0%25B0%25D1%2581%25D1%258B">rel√≥gios de vetor</a> em sistemas distribu√≠dos tradicionais e definem a ordem "aconteceu antes" nas transa√ß√µes.  Usando esses dados, o contrato poder√° resolver qualquer conflito poss√≠vel. </p><br><p>  De fato, para implementar essa id√©ia, basta um n√∫mero, mas deixamos os dois, pois conseguimos criar uma interface de usu√°rio mais conveniente.  Al√©m disso, decidimos incluir um valor de pagamento em cada mensagem.  Sem ela, se a mensagem for perdida por algum motivo, embora todos os valores e o c√°lculo final estejam corretos, o usu√°rio poder√° n√£o perceber a perda. </p><br><p>  Para testar nossa id√©ia, procuramos exemplos de como usar um protocolo de canal de pagamento simples e conciso.  Surpreendentemente, encontramos apenas dois: </p><br><ol><li>  <a href="https://medium.com/%40matthewdif/ethereum-payment-channel-in-50-lines-of-code-a94fad2704bc">Descri√ß√£o de uma</a> abordagem semelhante, apenas para o caso de um canal unidirecional. </li><li>  <a href="https://programtheblockchain.com/posts/2018/02/23/writing-a-simple-payment-channel/">Um tutorial</a> que descreve a mesma id√©ia que a nossa, mas sem explicar muitos detalhes importantes, como corre√ß√£o geral e o procedimento para resolver conflitos. </li></ol><br><p>  Tornou-se claro que faz sentido descrever nosso protocolo em detalhes, prestando aten√ß√£o especial √† sua corre√ß√£o.  Ap√≥s v√°rias itera√ß√µes, a especifica√ß√£o estava pronta e agora voc√™ tamb√©m pode v√™ <a href="">-la</a> . </p><br><p>  Implementamos um contrato para o FunC e criamos o utilit√°rio de linha de comando para interagir com nosso contrato no Fift, conforme recomendado pelos organizadores.  Poder√≠amos escolher qualquer outro idioma para nossa CLI, mas foi interessante experimentar o Fift para ver como ele se mostra em a√ß√£o. </p><br><p>  Honestamente, tendo trabalhado com o Fift, n√£o vimos boas raz√µes para preferir esse idioma a idiomas populares e usados ‚Äã‚Äãativamente com ferramentas e bibliotecas desenvolvidas.  Programar na linguagem da pilha √© bastante desagrad√°vel, porque voc√™ precisa ter sempre em mente o que est√° na pilha, e o compilador n√£o ajuda. </p><br><p>  Portanto, a √∫nica justificativa para a exist√™ncia do Fift √©, em nossa opini√£o, o seu papel como idioma de host do Fift Assembler.  Mas n√£o seria melhor incorporar o montador do TVM em um idioma existente e n√£o criar um novo para isso, essencialmente o √∫nico objetivo? </p><br><h3 id="tvm-haskell-edsl">  <strong>TVM Haskell eDSL</strong> </h3><br><p>  Agora √© hora de falar sobre o nosso segundo contrato inteligente.  Decidimos desenvolver uma carteira com v√°rias assinaturas, mas escrever outro contrato inteligente no FunC seria muito chato.  Quer√≠amos adicionar um pouco de entusiasmo, e ele se tornou nossa pr√≥pria linguagem de montagem para o TVM. </p><br><p>  Como o Fift Assembler, nossa nova linguagem √© incorpor√°vel, mas em vez do Fift, escolhemos Haskell como host, o que nos permitiu usar totalmente seu sistema de tipos avan√ßados.  Ao trabalhar com contratos inteligentes, onde o pre√ßo de um pequeno erro pode ser muito alto, a digita√ß√£o est√°tica, em nossa opini√£o, √© uma grande vantagem. </p><br><p>  Para demonstrar como √© o montador do TVM embutido no Haskell, implementamos uma carteira padr√£o nele.  Aqui est√£o algumas coisas a serem observadas: </p><br><ul><li>  Este contrato consiste em uma fun√ß√£o, mas voc√™ pode usar o quanto quiser.  Quando voc√™ define uma nova fun√ß√£o no idioma do host (ou seja, em Haskell), nosso eDSL permite que voc√™ escolha se deseja que ele se transforme em um subprograma separado no TVM ou apenas seja incorporado ao local da chamada. </li><li>  Como Haskell, fun√ß√µes t√™m tipos que s√£o verificados em tempo de compila√ß√£o.  Em nosso eDSL, o tipo de entrada da fun√ß√£o √© o tipo de pilha que a fun√ß√£o espera, e o tipo de resultado √© o tipo de pilha que ser√° obtida ap√≥s a chamada. </li><li>  O c√≥digo possui anota√ß√µes de tipo de pilha que descrevem o tipo esperado de pilha no ponto de discagem.  No contrato original da carteira, esses eram apenas coment√°rios, mas em nosso eDSL eles fazem parte do c√≥digo e s√£o verificados em tempo de compila√ß√£o.  Eles podem servir como documenta√ß√£o ou instru√ß√µes que ajudam o desenvolvedor a encontrar o problema se o tipo de pilha for alterado conforme o c√≥digo for alterado.  Obviamente, essas anota√ß√µes n√£o afetam o desempenho do tempo de execu√ß√£o, pois nenhum c√≥digo TVM √© gerado para elas. </li><li>  Este ainda √© um prot√≥tipo escrito em duas semanas, ainda resta muito trabalho a ser feito no projeto.  Por exemplo, todas as inst√¢ncias de classe que voc√™ v√™ no c√≥digo abaixo devem ser geradas automaticamente. </li></ul><br><p>  Veja como √© a implementa√ß√£o da carteira multisig em nosso eDSL: </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">main</span></span> :: <span class="hljs-type"><span class="hljs-type">IO</span></span> () main = putText $ pretty $ declProgram procedures methods <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> procedures = [ (<span class="hljs-string"><span class="hljs-string">"recv_external"</span></span>, decl recvExternal) , (<span class="hljs-string"><span class="hljs-string">"recv_internal"</span></span>, decl recvInternal) ] methods = [ (<span class="hljs-string"><span class="hljs-string">"seqno"</span></span>, declMethod getSeqno) ] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Storage</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Storage</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sCnt</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Word32</span></span></span><span class="hljs-class"> , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sPubKey</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PublicKey</span></span></span><span class="hljs-class"> } instance </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DecodeSlice</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Storage</span></span></span><span class="hljs-class"> where </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DecodeSliceFields</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Storage</span></span></span><span class="hljs-class"> = [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PublicKey</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Word32</span></span></span><span class="hljs-class">] decodeFromSliceImpl = do decodeFromSliceImpl @</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Word32</span></span></span><span class="hljs-class"> decodeFromSliceImpl @</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PublicKey</span></span></span><span class="hljs-class"> instance </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EncodeBuilder</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Storage</span></span></span><span class="hljs-class"> where encodeToBuilder = do encodeToBuilder @</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Word32</span></span></span><span class="hljs-class"> encodeToBuilder @</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PublicKey</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WalletError</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SeqNoMismatch</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SignatureMismatch</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">deriving</span></span></span><span class="hljs-class"> (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Eq</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Ord</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Show</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Generic</span></span></span><span class="hljs-class">) instance </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Exception</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WalletError</span></span></span><span class="hljs-class"> instance </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Enum</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WalletError</span></span></span><span class="hljs-class"> where toEnum 33 = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SeqNoMismatch</span></span></span><span class="hljs-class"> toEnum 34 = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SignatureMismatch</span></span></span><span class="hljs-class"> toEnum _ = error "</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Uknown</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MultiSigError</span></span></span><span class="hljs-class"> id" fromEnum </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SeqNoMismatch</span></span></span><span class="hljs-class"> = 33 fromEnum </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SignatureMismatch</span></span></span><span class="hljs-class"> = 34 recvInternal :: '[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Slice</span></span></span><span class="hljs-class">] :-&gt; '[] recvInternal = drop recvExternal :: '[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Slice</span></span></span><span class="hljs-class">] :-&gt; '[] recvExternal = do decodeFromSlice @</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Signature</span></span></span><span class="hljs-class"> dup preloadFromSlice @</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Word32</span></span></span><span class="hljs-class"> stacktype @[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Word32</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Slice</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Signature</span></span></span><span class="hljs-class">] </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">-- cnt cs sign pushRoot decodeFromCell @Storage stacktype @[PublicKey, Word32, Word32, Slice, Signature] -- pk cnt' cnt cs sign xcpu @1 @2 stacktype @[Word32, Word32, PublicKey, Word32, Slice, Signature] -- cnt cnt' pk cnt cs sign equalInt &gt;&gt; throwIfNot SeqNoMismatch push @2 sliceHash stacktype @[Hash Slice, PublicKey, Word32, Slice, Signature] -- hash pk cnt cs sign xc2pu @0 @4 @4 stacktype @[PublicKey, Signature, Hash Slice, Word32, Slice, PublicKey] -- pubk sign hash cnt cs pubk chkSignU stacktype @[Bool, Word32, Slice, PublicKey] -- ? cnt cs pubk throwIfNot SignatureMismatch accept swap decodeFromSlice @Word32 nip dup srefs @Word8 pushInt 0 if IsEq then ignore else do decodeFromSlice @Word8 decodeFromSlice @(Cell MessageObject) stacktype @[Slice, Cell MessageObject, Word8, Word32, PublicKey] xchg @2 sendRawMsg stacktype @[Slice, Word32, PublicKey] endS inc encodeToCell @Storage popRoot getSeqno :: '[] :-&gt; '[Word32] getSeqno = do pushRoot cToS preloadFromSlice @Word32</span></span></span></span></code> </pre> <br><p>  O c√≥digo fonte completo do nosso eDSL e o contrato de carteira com v√°rias assinaturas podem ser encontrados <a href="https://github.com/serokell/fift-asm-dsl">neste reposit√≥rio.</a>  E, com mais <a href="https://serokell.io/blog/parsing-typed-edsl">detalhes,</a> nosso colega George Agapov <a href="https://serokell.io/blog/parsing-typed-edsl">falou</a> sobre os idiomas internos. </p><br><h2 id="vyvody-o-konkurse-i-ton">  Conclus√µes sobre a competi√ß√£o e TON </h2><br><p>  No total, nosso trabalho levou 380 horas (juntamente com o conhecimento da documenta√ß√£o, reuni√µes e desenvolvimento).  Cinco desenvolvedores participaram da competi√ß√£o: STO, l√≠der da equipe, especialistas em plataformas blockchain e desenvolvedores de software Haskell. </p><br><p>  Encontramos os recursos para participar do concurso sem dificuldade, pois o esp√≠rito do hackathon, o trabalho em equipe pr√≥ximo, a necessidade de imers√£o r√°pida em aspectos das novas tecnologias s√£o sempre emocionantes.  Algumas noites sem dormir, a fim de alcan√ßar resultados m√°ximos em condi√ß√µes de recursos limitados, s√£o compensadas por uma experi√™ncia inestim√°vel e excelentes mem√≥rias.  Al√©m disso, o trabalho nessas tarefas √© sempre um bom teste para os processos da empresa, pois √© extremamente dif√≠cil obter resultados verdadeiramente decentes sem intera√ß√£o interna excelente. </p><br><p>  Al√©m da letra: ficamos impressionados com a quantidade de trabalho realizado pela equipe TON.  Eles conseguiram construir um sistema de trabalho complexo, bonito e o mais importante.  A TON provou ser uma plataforma com grande potencial.  No entanto, para que esse ecossistema se desenvolva, muito mais precisa ser feito, tanto em termos de seu uso em projetos de blockchain quanto em termos de melhoria das ferramentas de desenvolvimento.  Estamos orgulhosos de fazer parte desse processo agora. </p><br><p>  Se, depois de ler este artigo, voc√™ ainda tiver d√∫vidas ou id√©ias sobre como aplicar o TON para resolver seus problemas, <a href="https://serokell.io/">escreva-nos</a> - teremos o prazer de compartilhar nossa experi√™ncia. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt476756/">https://habr.com/ru/post/pt476756/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt476740/index.html">Explore a atividade de cibergrupos da equipe Donot</a></li>
<li><a href="../pt476742/index.html">Como mudamos o estado de "sempre em contato" para evitar desgaste profissional</a></li>
<li><a href="../pt476748/index.html">tecnologia aproximada: QATOK</a></li>
<li><a href="../pt476752/index.html">Como o futuro cen√°rio de TI ajudar√° a conectar consumidores, provedores de TI e T&D juntos</a></li>
<li><a href="../pt476754/index.html">Como enviar uma conta por usar os servi√ßos da API do Yandex Maps para um vizinho ou por que um gigante de TI precisa de controle de qualidade</a></li>
<li><a href="../pt476758/index.html">Como escolher o filamento de impress√£o 3D certo?</a></li>
<li><a href="../pt476760/index.html">Algumas palavras sobre os benef√≠cios da leitura</a></li>
<li><a href="../pt476770/index.html">"Oriole 2.0" - o trem no qual voc√™ viajar√° ao longo da WDC</a></li>
<li><a href="../pt476772/index.html">DeepPavlov para desenvolvedores: # 2 configura√ß√£o e implanta√ß√£o</a></li>
<li><a href="../pt476774/index.html">Revis√£o de Playme TAU DVR: Montagem magn√©tica, barata</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>