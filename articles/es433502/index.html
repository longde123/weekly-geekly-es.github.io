<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëäüèª üë®üèº üíÖüèº Tecnolog√≠a de audio inal√°mbrica Bluetooth: ¬øcu√°l es mejor? üí£ üåø üõ∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Con el desarrollo de la tecnolog√≠a, los tan conocidos auriculares anal√≥gicos "tube" pasan a la historia: son cada vez m√°s suplantados por sus hom√≥logo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tecnolog√≠a de audio inal√°mbrica Bluetooth: ¬øcu√°l es mejor?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433502/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/uz/_p/or/uz_por_7qlk9snfb7v_jg2x5iae.jpeg"></div><br>  Con el desarrollo de la tecnolog√≠a, los tan conocidos auriculares anal√≥gicos "tube" pasan a la historia: son cada vez m√°s suplantados por sus hom√≥logos inal√°mbricos Bluetooth. <br><br>  Los tel√©fonos inteligentes modernos se ven privados del conector habitual en aras de la protecci√≥n contra la humedad y el polvo. <br><br>  Los desarrolladores lanzan todas las nuevas versiones del protocolo Bluetooth y todas las nuevas versiones de c√≥decs, prometiendo "m√°s r√°pido, m√°s alto, m√°s fuerte" - menos demoras en la reproducci√≥n y mejor calidad. <br><br>  ¬øEst√° todo tan bien?  A ver <br><a name="habracut"></a><br><h2>  Introduccion </h2><br>  No profundizar√© en la implementaci√≥n t√©cnica de los protocolos, as√≠ como en las aburridas especificaciones.  Estimado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">ValdikSS</a> , quien en gran medida actu√≥ como inspiraci√≥n e incluso como consultor cient√≠fico en este art√≠culo, est√° preparando material completo sobre c√≥decs, y todo se presentar√° all√≠ con mucho m√°s detalle y t√©cnicamente correcto. <br><br>  Quiero contar m√°s sobre la experiencia personal.  Bueno, un poco entretenido (¬øaburrido?) Pr√°ctica. <br><br>  Hace un a√±o y medio, me entusiasm√≥ la idea de aptX.  S√≠, le√≠ muchas cr√≠ticas como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">esta</a> y cre√≠ en todos estos giros y vueltas t√©cnicos.  Naci√≥ un ni√±o, y realmente quer√≠a ver programas con auriculares por la noche con mi esposa, sin hacer ruido y sin despertar a nadie en la casa. <br><br>  ¬øEn qu√© result√≥? <br><br><h2>  Calidad </h2><br>  Comencemos con n√∫meros y hechos (¬°hola, Wikipedia!) <br><br>  <b>SBC</b> es un buen c√≥dec antiguo, que cumple con el est√°ndar A2DP.  El c√≥dec es el resultado del trabajo de Frans de Bont <i>(F. de Bont, M. Groenewegen y W. Oomen, "Un sistema de codificaci√≥n de audio de alta calidad a 128 kb / s", 98¬™ Convenci√≥n AES, 25-28 de febrero de 1995)</i> y uso Los algoritmos descritos en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">patente EP-0400755B1</a> .  Es de destacar que los autores de la patente permiten el uso gratuito de SBC solo en la aplicaci√≥n Bluetooth, sin embargo, la patente expir√≥ el 2 de junio de 2010.  Dado que el est√°ndar A2DP es muy com√∫n, es extremadamente dif√≠cil encontrar auriculares o altavoces que no sean compatibles con SBC. <br><br>  El c√≥dec proporciona una frecuencia de muestreo de 16, 32, 44.1, 48 kHz con una velocidad de flujo de 10-1500 kbit / s.  S√≠, escuchaste bien.  Hasta 1500 kbps.  Simplemente no hay l√≠mite de velocidad de bits en el c√≥dec.  Pero m√°s sobre eso m√°s tarde. <br><br>  El c√≥dec <b>aptX se</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">desarroll√≥ en 1988 en la Queen's University Belfast</a> .  S√≠, antes de Bluetooth todav√≠a hab√≠a alrededor de una docena de a√±os, por lo que el c√≥dec se us√≥ en equipos de audio profesionales.  Qualcomm actualmente posee los derechos y, por lo tanto, el uso requiere licencias y regal√≠as.  A partir de 2014, el costo es aproximadamente el siguiente: un pago √∫nico de $ 6,000 y ‚âà $ 1 por cada dispositivo lanzado para grupos de hasta 10,000 dispositivos.  Por esta raz√≥n, muchos dispositivos con Snapdragon 835, 845, 821, 820, 810, 805, 801, 800, 650, 615, 410 chips son bastante posibles y admiten aptX, pero no se activa all√≠, porque la licencia no se compr√≥.  Sobre eso, tambi√©n a continuaci√≥n. <br><br>  Con una profundidad de 16 bits y una frecuencia de muestreo de 48 kHz, el c√≥dec puede proporcionar una velocidad de bits de 384 kbit / s (doble canal). <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Lista de productos que admiten oficialmente aptX</a> .  Puede encontrar una gran cantidad de sistemas desconocidos con soporte aptX en Aliexpress, pero est√© preparado para el hecho de que, de hecho, habr√° el mismo SBC viejo y bueno, y nada m√°s. <br><br>  <b>aptX HD</b> : el mismo c√≥dec, pero con un perfil de codificaci√≥n diferente, tiene una velocidad de transmisi√≥n de 576 kbit / s, soporte para frecuencias de muestreo de hasta 48 kHz y profundidad de bits de hasta 24 bits.  Algunas personas llaman a este c√≥dec aptX Lossless, pero esto no tiene sentido, aunque solo sea porque en este momento es imposible alcanzar el valor de una secuencia que pueda transportar datos sin p√©rdidas.  Una ventaja particular de este c√≥dec es un retardo de codificaci√≥n ajustable, que puede reducirse a 1 ms a una frecuencia de muestreo de 48 kHz.  Adem√°s, el c√≥dec es extremadamente ventajoso desde el punto de vista de la carga del procesador, lo que expresa una ventaja en comparaci√≥n con MP3 y AAS. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Lista de productos que admiten oficialmente aptX HD</a> .  √âl es lo suficientemente peque√±o. <br><br>  <b>aptX Low latency</b> (o LL) es una versi√≥n especial del c√≥dec que le permite reducir el tiempo de retraso del sonido a menos de 40 ms.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Lista de productos que admiten oficialmente aptX LL</a> . <br><br><img src="https://habrastorage.org/webt/oz/nd/5q/oznd5qcoovjbj8f4xdtfydbl_ym.png" alt="imagen"><br><br>  Ah√≠ est√° ella.  Fue esta foto la que alguna vez me compr√≥ con menudillos.  Retrasos!  Despu√©s de todo, ¬øqui√©n quiere escuchar el sonido de una explosi√≥n en una pel√≠cula de acci√≥n, el grito de un monstruo en una pel√≠cula de terror o el rugido de una multitud en un partido de f√∫tbol cuando todo termina? <br><br>  ¬øPero es todo esto realmente as√≠? <br><br>  Por desgracia no. <br><br>  Como con cualquier material de marketing, los n√∫meros son exagerados.  El retraso depende en gran medida del almacenamiento en b√∫fer en el sistema y la implementaci√≥n del c√≥dec.  Por lo tanto, el retraso con SBC puede ser inferior a 40 ms, lo cual, dados los est√°ndares de transmisi√≥n de televisi√≥n (+40 ms ... ‚àí60 ms), es perfectamente aceptable. <br><br>  <u>En resumen:</u> <br><br><ol><li>  Ning√∫n c√≥dec existente puede ser mejor que la tecnolog√≠a cableada, ya que ning√∫n c√≥dec puede lograr una verdadera compresi√≥n sin p√©rdidas. </li><li>  El c√≥dec m√°s popular es SBC.  Es el m√°s flexible en entornos.  Y a pesar del hecho de que aptX se lanz√≥ antes, no pudo superar la popularidad de SBC, aparentemente debido a que este √∫ltimo es gratuito. </li><li>  La calidad del sonido depende en gran medida de la implementaci√≥n del c√≥dec, as√≠ como del rendimiento del hardware de los auriculares / altavoces en general: si el altavoz en s√≠ es d√©bil, ning√∫n c√≥dec puede mejorar la calidad.  Por lo tanto, en el futuro, comparando la calidad, hablaremos sobre reproducir el mismo contenido de la misma fuente en los mismos altavoces / auriculares, pero con diferentes c√≥decs. </li></ol><br><h2>  Resultados pr√°cticos y muy subjetivos. </h2><br><img src="https://habrastorage.org/webt/fj/uf/kj/fjufkjmv-sxcezemnqcz3ztyue4.jpeg"><br><br>  La informaci√≥n se basa en la experiencia de un a√±o y medio ya mencionada en la operaci√≥n, comparaci√≥n y atracci√≥n de oyentes externos. <br><br>  La experiencia se basa en escuchar sin p√©rdidas en el reproductor SONY Walkman NWZ-A17, donde se puede seleccionar el c√≥dec, as√≠ como en ver varios programas con salida de audio a trav√©s de Avantree Priva III. <br><br>  Hab√≠a tres auriculares: Sennheiser PMX 60, Koss Porta Pro y Koss UR-20. <br><br>  Se utilizaron Jabra BT3030 (SBC) y Avantree Clipper Pro (aptX) como receptores de se√±al inal√°mbrica. <br><br>  Tambi√©n se utilizaron un altavoz Voombox Outdoor (SBC) y auriculares de conducci√≥n √≥sea Aftershokz Trekz Titanium (aptX). <br><br>  Todos los ecualizadores y potenciadores se desactivaron, y esto es importante. <br><br>  <u>Total:</u> <br><br><ol><li>  La calidad del sonido que se reproduce con una conexi√≥n por cable siempre es mejor.  Esto es sin lugar a dudas. </li><li>  La diferencia entre SBC y aptX es extremadamente dif√≠cil de escuchar, y solo en el caso de algunos tipos de m√∫sica.  Por ejemplo, el autor del art√≠culo escuch√≥ claramente la diferencia en los solos de violonchelo en las composiciones cl√°sicas, mientras que para el viol√≠n y los instrumentos de baja frecuencia la diferencia era menos perceptible.  En los g√©neros modernos, pop, m√∫sica electr√≥nica y rock, la diferencia no se escucha.  En algunos casos, subjetivamente parec√≠a que SBC transmite el sonido mejor que aptX. </li><li>  El retraso entre SBC y aptX se puede ver solo si se conecta a la misma fuente e inserta diferentes receptores en diferentes o√≠dos (bueno, el canal izquierdo es SBC y el derecho es aptX, por ejemplo).  Es casi imposible ver el retraso con la imagen, pero porque la historia de que aptX est√° destinado a escenas din√°micas y contenido es un mito. </li><li>  La sorpresa fue causada por la calidad del sonido en el Voombox Outdoor bastante barato y "no famoso".  Aparentemente, esta es la implementaci√≥n exitosa de SBC, que se mencion√≥ anteriormente. </li><li>  La implementaci√≥n de aptX en auriculares con conducci√≥n √≥sea es completamente incomprensible: la tecnolog√≠a es muy espec√≠fica y, por lo tanto, la p√©rdida de calidad es significativa debido a la tecnolog√≠a en s√≠ misma.  Teniendo en cuenta el peque√±o rango del "rango" de la operaci√≥n del dispositivo, la implementaci√≥n extremadamente pobre del emparejamiento con dos dispositivos, puedo decir que Aftershokz es una compa√±√≠a que invierte m√°s en marketing que en desarrollo. </li></ol><br><br>  No estoy argumentando que si conecta todo tipo de analizadores espectrales, etc., puede y debe ver la diferencia.  Pero el o√≠do humano, y lo que es peor, el o√≠do humano promedio, no es un dispositivo espectral y, por lo tanto, no escucha todos estos matices. <br><br><h2>  Pr√°ctica: arreglar lo que se puede arreglar </h2><br><h3>  Parte 1. Encienda aptX </h3><br>  Como ya se mencion√≥, en algunos dispositivos el uso de aptX est√° desactivado, probablemente para evitar enjuiciamientos de patentes. <br><br>  Este problema se puede resolver simplemente deslizando el dispositivo de la biblioteca para implementar el c√≥dec y escribiendo la capacidad de trabajar con este c√≥dec en build.prop. <br><br>  En Internet hay una gran cantidad de soluciones de esta naturaleza.  Me tom√© la libertad de combinarlos en uno, y me di cuenta como un m√≥dulo para Magisk.  S√≠, realmente me gusta este proyecto y creo que implementar cambios en el sistema en forma de m√≥dulos Magisk es una soluci√≥n mejor y m√°s segura con la capacidad de guardar el sistema en su forma original y de una manera f√°cil de retroceder. <br><br>  El m√≥dulo se puede descargar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">desde aqu√≠</a> .  S√≠, s√© sobre github.  Y no, hasta que tenga tiempo de ponerlo all√≠. <br><br>  Las entradas en build.prop, incluidos aptX y, si es posible, aptX HD, ser√°n emuladas autom√°ticamente por el m√≥dulo. <br><br><img src="https://habrastorage.org/webt/vg/lc/gu/vglcguyqsbbyxptonmhdw-5ta3y.png"><br><br><h3>  Parte 2. Aumentar la tasa de bits de SBC </h3><br>  Como se inform√≥ anteriormente, el c√≥dec SBC b√°sicamente no tiene restricciones de velocidad de bits.  Sin embargo, los fabricantes suelen establecer un l√≠mite de 342 kbit / s para mono y 345 kbit / s para est√©reo para garantizar un funcionamiento confiable con todo tipo de dispositivos receptores. <br><br>  Al mismo tiempo, la especificaci√≥n A2DP v1.2, que estuvo activa de 2007 a 2015, requiere que todos los dispositivos de decodificaci√≥n funcionen correctamente con velocidades de bits de hasta 320 kbit / s para mono y 512 kbit / s en el caso de una se√±al est√©reo. <br><br>  En la nueva versi√≥n de la especificaci√≥n, no hay l√≠mite de velocidad de bits.  Se supone que los auriculares modernos lanzados despu√©s de 2015 y que admiten EDR pueden admitir velocidades de bits de hasta 730 kbps. <br><br>  De hecho, este ciertamente no es el caso.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">En un extenso estudio</a> realizado por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">ValdikSS</a> , se descubri√≥ que casi todos los dispositivos receptores funcionan de manera confiable con velocidades de bits de 454 kbit / s, y un n√∫mero bastante grande con una velocidad de bits de 507 kbit / s. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">En su investigaci√≥n,</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">ValdikSS</a> tambi√©n demostr√≥ que, contrariamente a la creencia popular sobre la calidad del c√≥dec aptX, puede producir peores resultados en algunos archivos que SBC con una velocidad de bits est√°ndar de 328 kbps, y cambiar a un SBC de alta velocidad de bits producir√° un sonido que a menudo excede aptX, en cualquier auricular. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">En base</a> a estos datos, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">ValdikSS</a> envi√≥ comentarios a los desarrolladores de Lineage OS y Google, pero hasta ahora no ha habido reacci√≥n. <br><br>  Por lo tanto, solo podemos realizar modificaciones manualmente en la pila Bluetooth. <br><br>  Necesitamos un IDA Pro con la capacidad de descompilar ARM, cualquier editor HEX (utilic√© WinHEX) y el archivo bluetooth.default.so de nuestro dispositivo.  Por lo general, se encuentra en la ruta / sistema / lib / hw y con menos frecuencia, tambi√©n en la ruta / sistema / lib64 / hw (definitivamente se necesita acceso a la ra√≠z). <br><br>  Entonces, abra el archivo bluetooth.default.so. Las operaciones y modificaciones que se describen a continuaci√≥n se aplican solo a la pila original de Android (bluedroid).  Si ve la l√≠nea "Biblioteca necesaria 'com.qualcomm.qti.bluetooth_audio@1.0.so'" o similar en IDA Pro, con alta probabilidad esta instrucci√≥n no lo ayudar√°. <br><br><img src="https://habrastorage.org/webt/cf/3l/jb/cf3ljbjgckew4pd9tbutsy-tyaw.png"><br><br>  Nuestra primera tarea es reemplazar Joint Stereo con Dual Channel en una configuraci√≥n est√°ndar. <br><br>  Trabajaremos con la <a href="">funci√≥n bta_av_build_src_cfg</a> . <br><br>  Para encontrar este procedimiento en la IDA, utilizaremos la b√∫squeda de <a href="">l√≠nea para un mensaje caracter√≠stico en el registro de depuraci√≥n "No se puede analizar src cap ret =% d"</a> : <br><br><img src="https://habrastorage.org/webt/wh/dk/ex/whdkexvibrxijvj7pqb-buzb0z8.png"><br><br><img src="https://habrastorage.org/webt/ea/2h/nh/ea2hnhbszbtyieokldywuch2qvi.png"><br><br>  Como resultado, encontramos r√°pidamente la funci√≥n en forma de c√≥digo: <br><br><img src="https://habrastorage.org/webt/mf/5_/_9/mf5__9yydhgwip0lvemgqwcwocw.png"><br><br>  Nuestra tarea es reemplazar la estructura original de los cheques <br><br><pre><code class="plaintext hljs">if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_JOINT) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_JOINT; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_STEREO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_STEREO; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_DUAL) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_DUAL; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_MONO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_MONO;&lt;/code&gt;  &lt;code&gt; if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_DUAL) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_DUAL; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_STEREO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_STEREO; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_DUAL) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_DUAL; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_MONO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_MONO;</code> </pre> <br>  Hay varias formas de hacer esto. <br><br>  El primero es el reemplazo de las instrucciones TST.W R0, # 1 con TST.W R0, # 4 y MOVS R0, # 1 con MOVS R0, # 4 en la secuencia de verificaciones: <br><br><img src="https://habrastorage.org/webt/6e/zu/so/6ezusojttx0gavinlppmqeroet8.png"><br><br>  En bytecode, este es el reemplazo de x01 a x04.  Es importante tener en cuenta la secuencia caracter√≠stica de bytes mediante la cual se puede encontrar este patr√≥n.  Sin profundizar en los detalles, dir√© que en esencia es una b√∫squeda de secuencia <br><br><pre> <code class="plaintext hljs">10 20 8D F8 04 00 9D F8 0D 00 10 F0 01 0F ?? ?? 10 F0 02 0F ?? ?? 10 F0 04 0F ?? ?? 10 F0 08 0F ?? ?? 08 20 ?? ?? 01 20 ?? ?? 02 20 ?? ?? 04 20</code> </pre> <br>  y su reemplazo por <br><br><pre> <code class="plaintext hljs">?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 04 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 04 ?? ?? ?? ?? ?? ?? ?? ?? ??</code> </pre> <br>  Sin embargo, este m√©todo tiene desventajas. <br><br>  Varios compiladores cambian la secuencia de ejecuci√≥n de comandos dependiendo de la optimizaci√≥n.  Y en este caso, no es posible encontrar el patr√≥n deseado, y a veces el mecanismo de verificaci√≥n en la estructura generalmente se introduce en el c√≥digo en l√≠nea.  Por lo tanto, es m√°s confiable cambiar la constante <a href="">btif_av_sbc_default_config</a> . <br><br>  Para empezar, encu√©ntrala.  Ella est√° al comienzo de nuestra funci√≥n, porque <br><br><pre> <code class="plaintext hljs">void bta_av_build_src_cfg (UINT8 *p_pref_cfg, UINT8 *p_src_cap) { tA2D_SBC_CIE src_cap; tA2D_SBC_CIE pref_cap; UINT8 status = 0; /* initialize it to default SBC configuration */ A2D_BldSbcInfo(AVDT_MEDIA_AUDIO, (tA2D_SBC_CIE *) &amp;btif_av_sbc_default_config, p_pref_cfg); /* now try to build a preferred one */ /* parse configuration */ if ((status = A2D_ParsSbcInfo(&amp;src_cap, p_src_cap, TRUE)) != 0) { APPL_TRACE_DEBUG(" Cant parse src cap ret = %d", status);</code> </pre> <br>  Y aqu√≠ est√° ella: <br><br><img src="https://habrastorage.org/webt/xi/j2/dt/xij2dtvma0evlnggxkxzqxkvdn4.png"><br><br><img src="https://habrastorage.org/webt/7a/z9/36/7az936re6naesontslfi1ogkd5c.png"><br><br>  Se puede ver que btif_av_sbc_default_config es una secuencia de bytes 20 01 10 04 01 35 02, mientras que el primer byte codifica la frecuencia de muestreo y puede ser 10 (48 kHz) y 20 (44 kHz), y por lo tanto no es espec√≠fico.  Por lo tanto, nuestra tarea es reemplazar la secuencia <br> <code>01 10 04 01 35 02</code> <br>  en <br> <code>04 ?? ?? ?? ?? ??</code> <br> <br>  Esto le permitir√° cambiar la l√≥gica de la estructura de manera similar, pero al mismo tiempo, la optimizaci√≥n del compilador no causar√° problemas. <br><br>  En algunos casos, los auriculares o altavoces inician la conexi√≥n.  En este caso, el modo est√° determinado por la funci√≥n <a href="">bta_av_co_audio_init</a> . <br><br>  La funci√≥n se <a href="">caracteriza por la l√≠nea "bta_av_co_audio_init:% d"</a> y se busca f√°cilmente en el c√≥digo: <br><img src="https://habrastorage.org/webt/fi/5o/ku/fi5okug9tbn6gvleetxo93uk9qg.png"><br><br>  La enumeraci√≥n de los posibles modos de conexi√≥n se realiza en el siguiente comando: <br><br><pre> <code class="plaintext hljs"> switch (index) { case BTIF_SV_AV_AA_SBC_INDEX: /* Set up for SBC codec for SRC*/ *p_codec_type = BTA_AV_CODEC_SBC; /* This should not fail because we are using constants for parameters */ A2D_BldSbcInfo(AVDT_MEDIA_AUDIO, (tA2D_SBC_CIE *) &amp;bta_av_co_sbc_caps, p_codec_info); /* Codec is valid */ return TRUE;</code> </pre> <br>  La <a href="">constante bta_av_co_sbc_caps tiene la siguiente estructura</a> : <br><br><pre> <code class="plaintext hljs">const tA2D_SBC_CIE bta_av_co_sbc_caps = { (A2D_SBC_IE_SAMP_FREQ_44), /* samp_freq */ (A2D_SBC_IE_CH_MD_MONO | A2D_SBC_IE_CH_MD_STEREO | A2D_SBC_IE_CH_MD_JOINT | A2D_SBC_IE_CH_MD_DUAL), /* ch_mode */ (A2D_SBC_IE_BLOCKS_16 | A2D_SBC_IE_BLOCKS_12 | A2D_SBC_IE_BLOCKS_8 | A2D_SBC_IE_BLOCKS_4), /* block_len */ (A2D_SBC_IE_SUBBAND_4 | A2D_SBC_IE_SUBBAND_8), /* num_subbands */ (A2D_SBC_IE_ALLOC_MD_L | A2D_SBC_IE_ALLOC_MD_S), /* alloc_mthd */ BTA_AV_CO_SBC_MAX_BITPOOL, /* max_bitpool */ A2D_SBC_IE_MIN_BITPOOL /* min_bitpool */ };</code> </pre> <br>  La constante se encuentra f√°cilmente en el c√≥digo, en mi caso es 20 0F F0 0C 03 35 02: <br><br><img src="https://habrastorage.org/webt/kj/hw/oi/kjhwoibpuk8brwa3kzvxiuxgeba.png"><br><br>  Preste atenci√≥n al byte <b>0F</b> : proporciona la capacidad de conectarse con cualquiera de los modos v√°lidos, ya que <br><br><pre> <code class="plaintext hljs">x0F = A2D_SBC_IE_CH_MD_MONO | A2D_SBC_IE_CH_MD_STEREO | A2D_SBC_IE_CH_MD_JOINT | A2D_SBC_IE_CH_MD_DUAL = x08 | x02 | x01 | x04</code> </pre> <br>  Nuestra tarea es cambiar este valor de la siguiente manera: <br><br><pre> <code class="plaintext hljs">x0F = A2D_SBC_IE_CH_MD_DUAL = x04</code> </pre> <br>  Por lo tanto, es necesario reemplazar <br><br> <code>?? 0F F0 0C 03 35 02</code> <br>  en <br> <code>?? 04 ?? ?? ?? ?? ??</code> <br> <br>  Entonces, hicimos que la pila se conectara en modo de doble canal tanto en el caso de iniciar una conexi√≥n por el dispositivo, como en el caso de iniciar una conexi√≥n por el lado receptor de la se√±al. <br><br>  Ahora necesita eliminar las restricciones en bitrate o aumentar su umbral superior. <br><br>  Necesita manejar <a href="">btif_media_task_get_sbc_rate</a> .  De manera similar, para buscar la <a href="">l√≠nea caracter√≠stica "se detect√≥ un sumidero a2dp no edr, restringir la tasa a% d", buscamos</a> la funci√≥n en el c√≥digo: <br><img src="https://habrastorage.org/webt/kp/go/j2/kpgoj2xsq6vt8kbnexy81jy6j6s.png"><br><br>  El l√≠mite de velocidad de bits se expresa en una cadena <br>  UINT16 rate = DEFAULT_SBC_BITRATE (que a su vez <a href="">es 328 kbps</a> ) <br><br>  En el c√≥digo, esto es as√≠: <br><br><img src="https://habrastorage.org/webt/tf/ba/bn/tfbabnrxfks3pejhzqzdegiwn04.png"><br><br>  Cambie este valor a 454 kbit / s: es m√°s alto que el est√°ndar y funciona con la gran mayor√≠a de los receptores.  Para hacer esto, reemplace los bytes <br><br> <code>B1 4F F4 A4 74 ?? E0</code> <br>  en <br> <code>?? ?? ?? E3 ?? ?? ??</code> <br> <br>  Tambi√©n debe buscar por patr√≥n. <br><br> <code>E0 4F F4 A4 74 ?? E0</code> <br>  y reemplazarlo con <br> <code>?? ?? ?? E3 ?? ?? ??</code> <br>  - Esto es necesario para varios dispositivos. <br><br>  El valor de E3 puede ser diferente dependiendo de la velocidad de bits m√°xima deseada: <br><br><ul><li>  E3 - 454 kbps </li><li>  F1 - 482 kbps </li><li>  F3 - 486 kbps </li><li>  10 - 576 kbps </li><li>  48 - sin l√≠mite </li></ul><br>  En general, esto est√° determinado por el c√≥digo de bytes de la operaci√≥n MOV.W R4, XXX. <br><br>  En la pr√°ctica, vale la pena experimentar y elegir el valor m√°ximo en el que todos sus dispositivos receptores reciben una recepci√≥n de se√±al estable, no hay grietas, interrupciones o distorsiones. <br><br>  En todos los receptores en mi experimento (los indiqu√© anteriormente), este valor era 576 kbps, el tel√©fono Xiaomi Redmi 4x MIUI10 Android 7.1 era la fuente de la se√±al. <br><br>  Seg√∫n las acciones descritas, se cre√≥ un parche gen√©rico que encuentra los patrones especificados en Bluetooth.default.so y los reemplaza.  incluido el modo forzado de doble canal y establecer el l√≠mite de velocidad de bits a 454 kbps.  Si es necesario, el valor l√≠mite puede cambiarse f√°cilmente en funci√≥n de la b√∫squeda y el reemplazo del byte correspondiente; un lector atento lo har√° sin dificultad. <br><br>  Destaco: el parche solo funciona en el caso de la pila de bluedroid y lo m√°s probable es que no tenga √©xito en el caso de la pila de fl√∫or y la versi√≥n de Android 8 y posteriores. <br><br>  El parche se puede descargar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">desde aqu√≠</a> . <br><br>  Se recomienda encarecidamente que reemplace el archivo original como m√≥dulos Magisk, por m√≠ mismo hice esto de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">siguiente manera</a> .  <b>Tenga en cuenta que</b> estos m√≥dulos fueron creados por m√≠ para el tel√©fono Xiaomi Redmi 4x 3/32 GB con el firmware MIUI 10 estable global actual en el momento de la escritura. En su caso, el archivo bluetooth.default.so tendr√° que ser reemplazado por el suyo, parcheado, como se describi√≥ anteriormente.  Tambi√©n es posible que el archivo deba duplicarse a lo largo de la ruta / system / lib64 / hw; depende del modelo y la versi√≥n de firmware de su tel√©fono. <br><br>  Este enfoque que utiliza m√≥dulos Magisk facilita el cambio de la tasa de bits m√°xima y, en general, deshabilita los cambios si resulta que algunos de los dispositivos receptores no son compatibles con Dual Channel. <br><br><h2>  Conclusi√≥n </h2><br>  En este momento, en la b√∫squeda de ventas, muchas compa√±√≠as est√°n presentando algunas innovaciones tecnol√≥gicas como justificaci√≥n para un precio m√°s alto. <br><br>  En la pr√°ctica, resulta que las tecnolog√≠as m√°s baratas existentes no est√°n completamente desarrolladas y las innovaciones tecnol√≥gicas no est√°n completamente implementadas, lo que afecta significativamente la calidad. <br><br>  Muy a menudo, los usuarios experimentan el "efecto placebo", convenci√©ndose de la perfecci√≥n de un producto solo porque se presenta m√°s nuevo o m√°s colorido.  De hecho, esta cualidad es imaginaria. <br><br>  A pesar del deterioro obvio en la calidad de la transmisi√≥n de audio inal√°mbrica en comparaci√≥n con la versi√≥n con cable, parece que los fabricantes de dispositivos modernos apuntan a una transici√≥n completa a las tecnolog√≠as inal√°mbricas.  Al mismo tiempo, los trucos de marketing se utilizan para justificar el aumento de precios: protecci√≥n contra la inmersi√≥n del tel√©fono en el agua (¬øc√≥mo se puede hablar bajo el agua? ¬øPor qu√© tirar el dispositivo al agua?), Uso de c√≥decs m√°s caros, etc.  Al mismo tiempo, el potencial del popular c√≥dec SBC existente no se utiliza por completo. <br><br>  No pudimos obtener ninguna aclaraci√≥n de Google con respecto al l√≠mite de velocidad de bits de 328 kbps, ni eliminar este l√≠mite y agregar la opci√≥n para habilitar Dual Channel en el men√∫ Bluetooth de los desarrolladores de Lineage OS. <br><br>  ¬°Gracias a todos los que leyeron hasta el final! <br><br>  Alguna continuaci√≥n causada por la discusi√≥n en los comentarios y un espacio con respecto al c√≥dec LDAC est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><img src="https://habrastorage.org/webt/ob/mr/cc/obmrccmcn21gzh8g1ca3g3ykfs4.jpeg"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es433502/">https://habr.com/ru/post/es433502/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es433490/index.html">Revisi√≥n de la impresora 3D Creality CR-X</a></li>
<li><a href="../es433494/index.html">10 modismos ingleses que nunca sabr√°s</a></li>
<li><a href="../es433496/index.html">Las empresas estatales obligan a cambiar a software nacional para 2022</a></li>
<li><a href="../es433498/index.html">Sberbank: tienes un "paquete" para m√≠, pero no lo tomar√© ...</a></li>
<li><a href="../es433500/index.html">El robot de mensajer√≠a Berkeley se quem√≥ debido a la falta de estado del sistema de monitoreo</a></li>
<li><a href="../es433504/index.html">C√≥mo dejar de escribir firmware para microcontroladores y comenzar a vivir</a></li>
<li><a href="../es433506/index.html">La UE busca el derecho a reparar electrodom√©sticos grandes</a></li>
<li><a href="../es433508/index.html">El propietario de la arquitectura MIPS tiene la intenci√≥n de abrir su conjunto de instrucciones (ISA) en 2019</a></li>
<li><a href="../es433510/index.html">Diferencia intercultural en juegos</a></li>
<li><a href="../es433512/index.html">Teor√≠a de la felicidad. El vertiginoso vuelo de un s√°ndwich con mantequilla</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>