<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>âœ¡ï¸ ğŸ‘¨â€ğŸ‘¨â€ğŸ‘¦ âœğŸ¾ åœ¨Unityä¸­åˆ›å»ºå¡”é˜²ï¼šæ•Œäºº ğŸ´ ğŸ§›ğŸ¾ ğŸ‘‰ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="[ ç¬¬ä¸€éƒ¨åˆ†ï¼šå¹³é“ºå¹¶æ‰¾åˆ°è·¯å¾„ ] 



- æ”¾ç½®æ•Œäººåˆ›é€ ç‚¹ã€‚ 
- æ•Œäººçš„å‡ºç°åŠå…¶åœ¨é‡å¤–çš„ç§»åŠ¨ã€‚ 
- ä»¥æ’å®šçš„é€Ÿåº¦äº§ç”Ÿå¹³ç¨³çš„è¿åŠ¨ã€‚ 
- æ›´æ”¹æ•Œäººçš„å¤§å°ï¼Œé€Ÿåº¦å’Œä½ç½®ã€‚ 
 è¿™æ˜¯ä¸€ä¸ªç®€å•çš„å¡”é˜²æ¸¸æˆæ•™ç¨‹çš„ç¬¬äºŒéƒ¨åˆ†ã€‚ å®ƒæ£€æŸ¥äº†åˆ›å»ºæ•Œäººçš„è¿‡ç¨‹åŠå…¶å‘æœ€è¿‘ç«¯ç‚¹çš„ç§»åŠ¨ã€‚ 

 æœ¬æ•™ç¨‹æ˜¯åœ¨Unity 2018....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åœ¨Unityä¸­åˆ›å»ºå¡”é˜²ï¼šæ•Œäºº</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452756/">  <i>[ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸€éƒ¨åˆ†ï¼šå¹³é“ºå¹¶æ‰¾åˆ°è·¯å¾„</a> ]</i> <br><br><ul><li> æ”¾ç½®æ•Œäººåˆ›é€ ç‚¹ã€‚ </li><li> æ•Œäººçš„å‡ºç°åŠå…¶åœ¨é‡å¤–çš„ç§»åŠ¨ã€‚ </li><li> ä»¥æ’å®šçš„é€Ÿåº¦äº§ç”Ÿå¹³ç¨³çš„è¿åŠ¨ã€‚ </li><li> æ›´æ”¹æ•Œäººçš„å¤§å°ï¼Œé€Ÿåº¦å’Œä½ç½®ã€‚ </li></ul><br> è¿™æ˜¯ä¸€ä¸ªç®€å•çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¡”é˜²</a>æ¸¸æˆæ•™ç¨‹çš„ç¬¬äºŒéƒ¨åˆ†ã€‚ å®ƒæ£€æŸ¥äº†åˆ›å»ºæ•Œäººçš„è¿‡ç¨‹åŠå…¶å‘æœ€è¿‘ç«¯ç‚¹çš„ç§»åŠ¨ã€‚ <br><br> æœ¬æ•™ç¨‹æ˜¯åœ¨Unity 2018.3.0f2ä¸­åˆ¶ä½œçš„ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2db/cf3/311/2dbcf331117740aa403cb12a757ae6fd.jpg" width="512" height="256"></div><br>  <i>åˆ°è¾¾ç»ˆç‚¹çš„è·¯ä¸Šçš„æ•Œäººã€‚</i> <br><a name="habracut"></a><br><h2> æ•Œäººåˆ›é€ ï¼ˆäº§åµï¼‰ç‚¹ </h2><br> åœ¨å¼€å§‹åˆ¶é€ æ•Œäººä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šå°†å®ƒä»¬æ”¾ç½®åœ¨åœºåœ°ä¸Šçš„ä½ç½®ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åˆ›å»ºæ´¾ç”Ÿç‚¹ã€‚ <br><br><h3> å¹³é“ºå†…å®¹ </h3><br> ç”Ÿæˆç‚¹æ˜¯åˆ‡ç‰‡å†…å®¹çš„å¦ä¸€ç§ç±»å‹ï¼Œå› æ­¤è¯·åœ¨<code>GameTileContentType</code>ä¸­<code>GameTileContentType</code>æ·»åŠ ä¸€ä¸ªæ¡ç›®ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> GameTileContentType { Empty, Destination, Wall, SpawnPoint }</code> </pre> <br> ç„¶ååˆ›å»ºä¸€ä¸ªé¢„åˆ¶ä»¶ä»¥å¯¹å…¶è¿›è¡Œå¯è§†åŒ–ã€‚ èµ·ç‚¹çš„é¢„åˆ¶ä»¶å‰¯æœ¬éå¸¸é€‚åˆæˆ‘ä»¬ï¼Œåªéœ€æ›´æ”¹å…¶å†…å®¹ç±»å‹å¹¶ä¸ºå…¶æä¾›å…¶ä»–ææ–™å³å¯ã€‚ æˆ‘æŠŠå®ƒå¼„æˆæ©™è‰²ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e39/522/28d/e3952228dacd6801a6f5d2fb53826cc2.png" width="320" height="104"></div><br>  <i>ç”Ÿæˆç‚¹é…ç½®ã€‚</i> <br><br> å‘å†…å®¹å·¥å‚æ·»åŠ ç”Ÿæˆç‚¹æ”¯æŒï¼Œå¹¶ä¸ºå…¶æä¾›åˆ°é¢„åˆ¶ä»¶çš„é“¾æ¥ã€‚ <br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">SerializeField</span></span>] GameTileContent spawnPointPrefab = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GameTileContent </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GameTileContentType type</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> GameTileContentType.Destination: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Get(destinationPrefab); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> GameTileContentType.Empty: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Get(emptyPrefab); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> GameTileContentType.Wall: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Get(wallPrefab); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> GameTileContentType.SpawnPoint: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Get(spawnPointPrefab); } Debug.Assert(<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"Unsupported type: "</span></span> + type); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/10f/036/a17/10f036a17ae271cf7b7f7c9694e01782.png" width="320" height="142"></div><br>  <i>å·¥å‚æ”¯æŒç”Ÿæˆç‚¹ã€‚</i> <br><br><h3> å¯ç”¨æˆ–ç¦ç”¨ç”Ÿæˆç‚¹ </h3><br> ä¸å…¶ä»–åˆ‡æ¢æ–¹æ³•ä¸€æ ·ï¼Œåˆ‡æ¢ç”Ÿæˆç‚¹çŠ¶æ€çš„æ–¹æ³•å°†æ·»åŠ åˆ°<code>GameBoard</code> ã€‚ ä½†æ˜¯ç”Ÿæˆç‚¹ä¸ä¼šå½±å“å¯¹è·¯å¾„çš„æœç´¢ï¼Œå› æ­¤æ›´æ”¹ä¹‹åï¼Œæˆ‘ä»¬æ— éœ€å¯»æ‰¾æ–°è·¯å¾„ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToggleSpawnPoint</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GameTile tile</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tile.Content.Type == GameTileContentType.SpawnPoint) { tile.Content = contentFactory.Get(GameTileContentType.Empty); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tile.Content.Type == GameTileContentType.Empty) { tile.Content = contentFactory.Get(GameTileContentType.SpawnPoint); } }</code> </pre> <br> åªæœ‰å½“æˆ‘ä»¬æœ‰æ•Œäººå¹¶ä¸”ä»–ä»¬éœ€è¦ç”Ÿæˆç‚¹æ—¶ï¼Œæ¸¸æˆæ‰æœ‰æ„ä¹‰ã€‚ å› æ­¤ï¼Œæ¸¸æˆåœºå¿…é¡»è‡³å°‘åŒ…å«ä¸€ä¸ªç”Ÿæˆç‚¹ã€‚ ä»¥åï¼Œå½“æˆ‘ä»¬æ·»åŠ æ•Œäººæ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®¿é—®ç”Ÿæˆç‚¹ï¼Œå› æ­¤è®©æˆ‘ä»¬ä½¿ç”¨åˆ—è¡¨æ¥è·Ÿè¸ªå…·æœ‰è¿™äº›ç‚¹çš„æ‰€æœ‰å›¾å—ã€‚ åˆ‡æ¢ç”Ÿæˆç‚¹çš„çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬å°†æ›´æ–°åˆ—è¡¨ï¼Œå¹¶é˜²æ­¢åˆ é™¤æœ€åä¸€ä¸ªç”Ÿæˆç‚¹ã€‚ <br><br><pre> <code class="cs hljs"> List&lt;GameTile&gt; spawnPoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;GameTile&gt;(); â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToggleSpawnPoint</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GameTile tile</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tile.Content.Type == GameTileContentType.SpawnPoint) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (spawnPoints.Count &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { spawnPoints.Remove(tile); tile.Content = contentFactory.Get(GameTileContentType.Empty); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tile.Content.Type == GameTileContentType.Empty) { tile.Content = contentFactory.Get(GameTileContentType.SpawnPoint); spawnPoints.Add(tile); } }</code> </pre> <br> ç°åœ¨ï¼Œ <code>Initialize</code>æ–¹æ³•åº”è¯¥è®¾ç½®ç”Ÿæˆç‚¹ä»¥åˆ›å»ºå­—æ®µçš„åˆå§‹æ­£ç¡®çŠ¶æ€ã€‚ è®©æˆ‘ä»¬ä»…åŒ…æ‹¬ç¬¬ä¸€ä¸ªå›¾å—ï¼Œå®ƒä½äºå·¦ä¸‹è§’ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector2Int size, GameTileContentFactory contentFactory </span></span></span><span class="hljs-function">)</span></span> { â€¦ ToggleDestination(tiles[tiles.Length / <span class="hljs-number"><span class="hljs-number">2</span></span>]); ToggleSpawnPoint(tiles[<span class="hljs-number"><span class="hljs-number">0</span></span>]); }</code> </pre> <br> ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿›è¡Œæ›¿ä»£è§¦æ‘¸ï¼Œä»¥åˆ‡æ¢ç”Ÿæˆç‚¹çš„çŠ¶æ€ï¼Œä½†æ˜¯å½“æ‚¨æŒ‰ä½å·¦Shifté”®ï¼ˆé€šè¿‡<code>Input.GetKey</code>æ–¹æ³•æ£€æŸ¥å‡»é”®ï¼‰æ—¶ï¼Œç«¯ç‚¹çš„çŠ¶æ€å°†åˆ‡æ¢ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleAlternativeTouch</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { GameTile tile = board.GetTile(TouchRay); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tile != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKey(KeyCode.LeftShift)) { board.ToggleDestination(tile); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { board.ToggleSpawnPoint(tile); } } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2f9/cd6/22b/2f9cd622bf1aa41023e5204e1f4caa9a.png" width="230" height="230"></div><br>  <i>å¸¦æœ‰ç”Ÿæˆç‚¹çš„å­—æ®µã€‚</i> <br><br><h3> å¯ä»¥è®¿é—®ç”Ÿæˆç‚¹ </h3><br> æˆ˜åœºå¤„ç†äº†æ‰€æœ‰çš„ç“·ç –ï¼Œä½†æ•Œäººä¸æ˜¯å®ƒçš„è´£ä»»ã€‚ æˆ‘ä»¬å°†å¯ä»¥é€šè¿‡å¸¦æœ‰ç´¢å¼•å‚æ•°çš„é€šç”¨<code>GetSpawnPoint</code>æ–¹æ³•è®¿é—®å…¶ç”Ÿæˆç‚¹ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GameTile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSpawnPoint</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> spawnPoints[index]; }</code> </pre> <br> ä¸ºäº†çŸ¥é“å“ªä¸ªç´¢å¼•æ˜¯æ­£ç¡®çš„ï¼Œéœ€è¦æœ‰å…³ç”Ÿæˆç‚¹æ•°çš„ä¿¡æ¯ï¼Œå› æ­¤æˆ‘ä»¬å°†ä½¿ç”¨é€šç”¨çš„getterå±æ€§ä½¿å…¶é€šç”¨ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SpawnPointCount =&gt; spawnPoints.Count;</code> </pre> <br><h2> æ•Œäººäº§ç”Ÿ </h2><br> ç”Ÿæˆæ•Œäººæœ‰ç‚¹ç±»ä¼¼äºåˆ›å»ºå›¾å—çš„å†…å®¹ã€‚ æˆ‘ä»¬é€šè¿‡å·¥å‚åˆ›å»ºä¸€ä¸ªé¢„åˆ¶å®ä¾‹ï¼Œç„¶åå°†å…¶æ”¾ç½®åœ¨ç°åœºã€‚ <br><br><h3> å·¥å‚å·¥å‚ </h3><br> æˆ‘ä»¬å°†ä¸ºæ•Œäººå»ºç«‹ä¸€ä¸ªå·¥å‚ï¼Œå°†å·¥å‚åˆ›é€ çš„ä¸€åˆ‡ç½®äºè‡ªå·±çš„èˆå°ä¸Šã€‚ æ­¤åŠŸèƒ½ä¸æˆ‘ä»¬å·²ç»æ‹¥æœ‰çš„å·¥å‚å¾ˆå¸¸è§ï¼Œå› æ­¤è®©æˆ‘ä»¬å°†å…¶ä»£ç æ”¾å…¥é€šç”¨åŸºç±»<code>GameObjectFactory</code> ã€‚ æˆ‘ä»¬å°†åªéœ€è¦ä¸€ä¸ªå¸¦æœ‰é€šç”¨é¢„åˆ¶å‚æ•°çš„<code>CreateGameObjectInstance</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä¸”è¿˜å¯ä»¥ç®¡ç†æ•´ä¸ªåœºæ™¯ã€‚ æˆ‘ä»¬åˆ›å»º<code>protected</code>æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»…å¯¹ç±»ä»¥åŠä»å…¶ç»§æ‰¿çš„æ‰€æœ‰ç±»å‹å¯ç”¨ã€‚ è¿™å°±æ˜¯è¯¥ç±»æ‰€åšçš„ä¸€åˆ‡ï¼›å®ƒä¸æ‰“ç®—ç”¨ä½œåŠŸèƒ½é½å…¨çš„å·¥å‚ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†å…¶æ ‡è®°ä¸º<code>abstract</code> ï¼Œè¿™å°†ä¸å…è®¸æˆ‘ä»¬åˆ›å»ºå…¶å¯¹è±¡çš„å®ä¾‹ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine.SceneManagement; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">GameObjectFactory</span></span> : <span class="hljs-title"><span class="hljs-title">ScriptableObject</span></span> { Scene scene; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> T CreateGameObjectInstance&lt;T&gt; (T prefab) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : MonoBehaviour { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!scene.isLoaded) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Application.isEditor) { scene = SceneManager.GetSceneByName(name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!scene.isLoaded) { scene = SceneManager.CreateScene(name); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { scene = SceneManager.CreateScene(name); } } T instance = Instantiate(prefab); SceneManager.MoveGameObjectToScene(instance.gameObject, scene); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance; } }</code> </pre> <br> æ›´æ”¹<code>GameTileContentFactory</code> ï¼Œä½¿å…¶<code>GameTileContentFactory</code>æ­¤ç±»å‹çš„å·¥å‚ï¼Œå¹¶åœ¨å…¶<code>Get</code>æ–¹æ³•ä¸­ä½¿ç”¨<code>CreateGameObjectInstance</code> ï¼Œç„¶åä»ä¸­åˆ é™¤åœºæ™¯æ§åˆ¶ä»£ç ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; [CreateAssetMenu] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">GameTileContentFactory</span></span> : <span class="hljs-title"><span class="hljs-title">GameObjectFactory</span></span> { â€¦ <span class="hljs-comment"><span class="hljs-comment">//Scene contentScene; â€¦ GameTileContent Get (GameTileContent prefab) { GameTileContent instance = CreateGameObjectInstance(prefab); instance.OriginFactory = this; //MoveToFactoryScene(instance.gameObject); return instance; } //void MoveToFactoryScene (GameObject o) { // â€¦ //} }</span></span></code> </pre> <br> ä¹‹åï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„<code>EnemyFactory</code>ç±»å‹ï¼Œè¯¥ç±»å‹ä½¿ç”¨<code>Get</code>æ–¹æ³•ä»¥åŠéšé™„çš„<code>Reclaim</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ª<code>Enemy</code>é¢„åˆ¶å®ä¾‹ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; [CreateAssetMenu] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EnemyFactory</span></span> : <span class="hljs-title"><span class="hljs-title">GameObjectFactory</span></span> { [SerializeField] Enemy prefab = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Enemy </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Enemy instance = CreateGameObjectInstance(prefab); instance.OriginFactory = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Reclaim</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Enemy enemy</span></span></span><span class="hljs-function">)</span></span> { Debug.Assert(enemy.OriginFactory == <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"Wrong factory reclaimed!"</span></span>); Destroy(enemy.gameObject); } }</code> </pre> <br> æ–°çš„<code>Enemy</code>ç±»å‹æœ€åˆåªéœ€è¦è·Ÿè¸ªå…¶åŸå§‹å·¥å‚ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Enemy</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { EnemyFactory originFactory; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> EnemyFactory OriginFactory { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> =&gt; originFactory; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { Debug.Assert(originFactory == <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"Redefined origin factory!"</span></span>); originFactory = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } }</code> </pre> <br><h3> é¢„åˆ¶ä»¶ </h3><br> æ•Œäººéœ€è¦å¯è§†åŒ–ï¼Œå¯è§†åŒ–å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿-æœºå™¨äººï¼Œèœ˜è››ï¼Œé¬¼é­‚ï¼Œæ›´ç®€å•çš„ä¸œè¥¿ï¼ˆä¾‹å¦‚ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ç«‹æ–¹ä½“ï¼‰ã€‚ ä½†æ€»çš„æ¥è¯´ï¼Œæ•Œäººæ‹¥æœ‰å¤æ‚çš„3Dæ¨¡å‹ã€‚ ä¸ºäº†ç¡®ä¿å…¶æ–¹ä¾¿çš„æ”¯æŒï¼Œæˆ‘ä»¬å°†å¯¹æ•Œäººçš„é¢„åˆ¶ç»“æ„ä½¿ç”¨æ ¹å¯¹è±¡ï¼Œä»…å°†<code>Enemy</code>ç»„ä»¶é™„åŠ åˆ°è¯¥æ ¹å¯¹è±¡ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7c6/348/428/7c6348428b50732e0a13efcdadfc9fff.png" width="320" height="160"></div><br>  <i>é¢„åˆ¶æ ¹</i> <br><br> è®©æˆ‘ä»¬ä¸ºè¯¥å¯¹è±¡åˆ›å»ºå”¯ä¸€çš„å­å…ƒç´ ï¼Œå®ƒå°†æˆä¸ºæ¨¡å‹çš„æ ¹ã€‚ å®ƒå¿…é¡»å…·æœ‰è½¬æ¢å•ä½å€¼ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ce7/691/330/ce7691330dd6c6813d2a64398c582c2a.png" width="320" height="120"></div><br>  <i>æ¨¡å‹çš„æ ¹ã€‚</i> <br><br> è¯¥æ¨¡å‹æ ¹çš„ä»»åŠ¡æ˜¯ç›¸å¯¹äºæ•Œäººåæ ‡çš„æœ¬åœ°åŸç‚¹å®šä½3Dæ¨¡å‹ï¼Œä»¥ä¾¿ä»–å°†å…¶è§†ä¸ºæ•Œäººç«™ç«‹æˆ–æ‚¬æŒ‚çš„å‚è€ƒç‚¹ã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæ¨¡å‹å°†æ˜¯æ ‡å‡†çš„åŠè§’ç«‹æ–¹ä½“ï¼Œæˆ‘å°†ä¸ºå…¶èµ‹äºˆæ·±è“è‰²ã€‚ æˆ‘ä»¬å°†å…¶è®¾ä¸ºæ¨¡å‹æ ¹çš„å­çº§ï¼Œå¹¶å°†Yä½ç½®è®¾ç½®ä¸º0.25ï¼Œä½¿å…¶ç«‹è¶³äºåœ°é¢ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/65b/7a3/808/65b7a3808f469e2723b344afccd94f8f.png" width="320" height="206"></div><br>  <i>ç«‹æ–¹ä½“æ¨¡å‹</i> <br><br> å› æ­¤ï¼Œæ•Œäººçš„é¢„åˆ¶ä»¶ç”±ä¸‰ä¸ªåµŒå¥—å¯¹è±¡ç»„æˆï¼šé¢„åˆ¶ä»¶æ ¹ï¼Œæ¨¡å‹æ ¹å’Œç«‹æ–¹ä½“ã€‚ å¯¹äºä¸€ä¸ªç®€å•çš„å¤šç»´æ•°æ®é›†æ¥è¯´ï¼Œå®ƒçœ‹èµ·æ¥åƒæ˜¯åŠèº«åƒï¼Œä½†æ˜¯è¿™æ ·çš„ç³»ç»Ÿå¯ä»¥è®©æ‚¨ç§»åŠ¨å¹¶ä¸ºä»»ä½•æ•Œäººè®¾ç½®åŠ¨ç”»ï¼Œè€Œæ— éœ€æ‹…å¿ƒå…¶åŠŸèƒ½ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/62a/0c9/abb/62a0c9abb59605150235ba6cec73eeb2.png" width="225" height="74"></div><br>  <i>æ•Œäººçš„é¢„åˆ¶ç­‰çº§ã€‚</i> <br><br> è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ•Œäººå·¥å‚å¹¶ä¸ºå…¶åˆ†é…ä¸€ä¸ªé¢„åˆ¶ä»¶ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ae3/ee2/345/ae3ee23456931ac6f989a763deb8b7b1.png" width="320" height="88"></div><br>  <i>èµ„äº§å·¥å‚ã€‚</i> <br><br><h3> å°†æ•Œäººæ”¾åœ¨é‡å¤– </h3><br> è¦å°†æ•Œäººæ”¾åˆ°åœºä¸Šï¼Œ <code>Game</code>å¿…é¡»è·å¾—æŒ‡å‘æ•Œäººå·¥å‚çš„é“¾æ¥ã€‚ ç”±äºæˆ‘ä»¬éœ€è¦å¤§é‡æ•Œäººï¼Œå› æ­¤æˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªé…ç½®é€‰é¡¹æ¥è°ƒæ•´ç”Ÿæˆé€Ÿåº¦ï¼Œä»¥æ¯ç§’çš„æ•Œäººæ•°é‡è¡¨ç¤ºã€‚ å¯æ¥å—çš„èŒƒå›´æ˜¯0.1â€“10ï¼Œé»˜è®¤å€¼ä¸º1ã€‚ <br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">SerializeField</span></span>] EnemyFactory enemyFactory = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; [SerializeField, Range(<span class="hljs-number"><span class="hljs-number">0.1f</span></span>, <span class="hljs-number"><span class="hljs-number">10f</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> spawnSpeed = <span class="hljs-number"><span class="hljs-number">1f</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/201/56b/338/20156b3384b45ab95d7aef5ed5397480.png" width="320" height="144"></div><br>  <i>ä¸æ•Œæ–¹å·¥å‚è¿›è¡Œæ¸¸æˆå¹¶äº§ç”Ÿé€Ÿåº¦4ã€‚</i> <br><br> æˆ‘ä»¬å°†åœ¨<code>Update</code>è·Ÿè¸ªç”Ÿæˆçš„è¿›åº¦ï¼Œä»¥é€Ÿåº¦ä¹˜ä»¥å¢é‡æ—¶é—´æ¥å¢åŠ å®ƒã€‚ å¦‚æœprggresså€¼è¶…è¿‡1ï¼Œåˆ™æˆ‘ä»¬å°†å…¶é€’å‡å¹¶ä½¿ç”¨æ–°çš„<code>SpawnEnemy</code>æ–¹æ³•ç”Ÿæˆæ•Œäººã€‚ å¦‚æœé€Ÿåº¦è¿‡é«˜ä¸”å¸§æ—¶é—´è¿‡é•¿ï¼Œä»¥è‡³äºæ— æ³•åŒæ—¶åˆ›å»ºå¤šä¸ªæ•Œäººï¼Œæˆ‘ä»¬å°†ç»§ç»­è¿™æ ·åšï¼Œç›´åˆ°è¿›åº¦è¶…è¿‡1ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> spawnProgress; â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ spawnProgress += spawnSpeed * Time.deltaTime; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (spawnProgress &gt;= <span class="hljs-number"><span class="hljs-number">1f</span></span>) { spawnProgress -= <span class="hljs-number"><span class="hljs-number">1f</span></span>; SpawnEnemy(); } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">ä¸éœ€è¦åœ¨FixedUpdateä¸­æ›´æ–°è¿›åº¦å—ï¼Ÿ</b> <div class="spoiler_text"> æ˜¯çš„ï¼Œæœ‰å¯èƒ½ï¼Œä½†æ˜¯å¡”é˜²æ¸¸æˆä¸éœ€è¦å¦‚æ­¤ç²¾ç¡®çš„æ—¶é—´ã€‚ æˆ‘ä»¬å°†ä»…åœ¨æ¯ä¸€å¸§æ›´æ–°æ¸¸æˆçŠ¶æ€ï¼Œå¹¶ä½¿å…¶åœ¨ä»»ä½•æ—¶é—´å¢é‡ä¸‹éƒ½èƒ½æ­£å¸¸è¿è¡Œã€‚ </div></div><br> è®©<code>SpawnEnemy</code>ä»å­—æ®µä¸­è·å¾—éšæœºçš„ç”Ÿæˆç‚¹ï¼Œå¹¶åœ¨æ­¤å›¾å—ä¸­åˆ›å»ºä¸€ä¸ªæ•Œäººã€‚ æˆ‘ä»¬å°†ä¸º<code>Enemy</code> <code>SpawnOn</code>æ–¹æ³•ä»¥æ­£ç¡®<code>SpawnOn</code>è‡ªèº«ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SpawnEnemy</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { GameTile spawnPoint = board.GetSpawnPoint(Random.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, board.SpawnPointCount)); Enemy enemy = enemyFactory.Get(); enemy.SpawnOn(spawnPoint); }</code> </pre> <br> ç›®å‰ï¼Œæ‰€æœ‰<code>SpawnOn</code>è¦åšçš„å°±æ˜¯å°†å…¶è‡ªå·±çš„ä½ç½®è®¾ç½®ä¸ºä¸å›¾å—çš„ä¸­å¿ƒç›¸ç­‰ã€‚ ç”±äºé¢„åˆ¶æ¨¡å‹çš„ä½ç½®æ­£ç¡®ï¼Œæ‰€ä»¥æ•Œæ–¹ç«‹æ–¹ä½“å°†ä½äºæ­¤å›¾å—çš„é¡¶éƒ¨ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SpawnOn</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GameTile tile</span></span></span><span class="hljs-function">)</span></span> { transform.localPosition = tile.transform.localPosition; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8b5/74a/ce9/8b574ace93bd2c7f7829d41f9208a138.png" width="230" height="230"></div><br>  <i>æ•Œäººå‡ºç°åœ¨äº§åµç‚¹ã€‚</i> <br><br><h2> ç§»åŠ¨æ•Œäºº </h2><br> æ•Œäººå‡ºç°åï¼Œä»–å¿…é¡»å¼€å§‹æ²¿è·¯å¾„ç§»åŠ¨åˆ°æœ€è¿‘çš„ç»ˆç‚¹ã€‚ ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦ä¸ºæ•Œäººè®¾ç½®åŠ¨ç”»ã€‚ æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„å¹³æ»‘æ»‘è¡Œå¼€å§‹ï¼Œåˆ°å¦ä¸€å—ç“·ç –ï¼Œç„¶åä½¿å®ƒä»¬çš„ç§»åŠ¨æ›´åŠ å›°éš¾ã€‚ <br><br><h3> æ”¶é›†æ•Œäºº </h3><br> ä¸ºäº†æ›´æ–°æ•Œäººçš„çŠ¶æ€ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯¹è±¡ç®¡ç†â€</a>ç³»åˆ—æ•™ç¨‹ä¸­ä½¿ç”¨çš„ç›¸åŒæ–¹æ³•ã€‚ æˆ‘ä»¬ä¸º<code>Enemy</code>æ·»åŠ <code>Enemy</code>é€šç”¨çš„<code>GameUpdate</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›æœ‰å…³ä»–æ˜¯å¦è¿˜æ´»ç€çš„ä¿¡æ¯ï¼Œåœ¨æ­¤é˜¶æ®µï¼Œè¯¥ä¿¡æ¯å°†å§‹ç»ˆä¸ºçœŸã€‚ ç°åœ¨ï¼Œåªæ˜¯è®©ä»–æ ¹æ®æ—¶é—´å˜åŒ–è€Œå‰è¿›ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GameUpdate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { transform.localPosition += Vector3.forward * Time.deltaTime; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br> æ­¤å¤–ï¼Œæˆ‘ä»¬éœ€è¦ç»´æŠ¤ä¸€ä¸ªæ´»ç€çš„æ•Œäººåˆ—è¡¨å¹¶æ›´æ–°æ‰€æœ‰æ•Œäººï¼Œå°†å®ƒä»¬ä»æ­»æ•Œåˆ—è¡¨ä¸­åˆ é™¤ã€‚ æˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰è¿™äº›ä»£ç æ”¾å…¥<code>Game</code> ï¼Œä½†å¯ä»¥å°†å…¶éš”ç¦»å¹¶åˆ›å»ºä¸€ä¸ª<code>EnemyCollection</code>ç±»å‹ã€‚ è¿™æ˜¯ä¸€ä¸ªå¯åºåˆ—åŒ–çš„ç±»ï¼Œä¸ç»§æ‰¿ä»»ä½•ä¸œè¥¿ã€‚ æˆ‘ä»¬ç»™ä»–ä¸€ä¸ªæ·»åŠ æ•Œäººçš„ä¸€èˆ¬æ–¹æ³•ï¼Œä»¥åŠå¦ä¸€ä¸ªæ›´æ–°æ•´ä¸ªé›†åˆçš„æ–¹æ³•ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; [System.Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EnemyCollection</span></span> { List&lt;Enemy&gt; enemies = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Enemy&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Enemy enemy</span></span></span><span class="hljs-function">)</span></span> { enemies.Add(enemy); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GameUpdate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; enemies.Count; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!enemies[i].GameUpdate()) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lastIndex = enemies.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>; enemies[i] = enemies[lastIndex]; enemies.RemoveAt(lastIndex); i -= <span class="hljs-number"><span class="hljs-number">1</span></span>; } } } }</code> </pre> <br> ç°åœ¨ï¼Œ <code>Game</code>å°±è¶³ä»¥åˆ›å»ºä¸€ä¸ªè¿™æ ·çš„é›†åˆï¼Œåœ¨æ¯ä¸€å¸§ä¸­å¯¹å…¶è¿›è¡Œæ›´æ–°å¹¶å‘å…¶ä¸­æ·»åŠ åˆ›å»ºçš„æ•Œäººã€‚ åœ¨å¯èƒ½äº§ç”Ÿæ–°æ•Œäººä¹‹åï¼Œæˆ‘ä»¬å°†ç«‹å³æ›´æ–°æ•Œäººï¼Œä»¥ä¾¿ç«‹å³è¿›è¡Œæ›´æ–°ã€‚ <br><br><pre> <code class="cs hljs"> EnemyCollection enemies = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EnemyCollection(); â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ enemies.GameUpdate(); } â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SpawnEnemy</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ enemies.Add(enemy); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/25f/eb8/dc6/25feb8dc6f0d3a5a66be43f311cd7818.png" width="230" height="230"></div><br>  <i>æ•Œäººæ­£åœ¨å‰è¿›ã€‚</i> <br><br><h3> ä¸€è·¯èµ°æ¥ </h3><br> æ•Œäººå·²ç»åœ¨ç§»åŠ¨ï¼Œä½†åˆ°ç›®å‰ä¸ºæ­¢è¿˜æ²¡æœ‰èµ°è¿™æ¡è·¯ã€‚ ä¸ºæ­¤ï¼Œä»–ä»¬éœ€è¦çŸ¥é“ä¸‹ä¸€æ­¥å»å“ªé‡Œã€‚ å› æ­¤ï¼Œè®©æˆ‘ä»¬ä¸º<code>GameTile</code>é€šç”¨çš„getterå±æ€§ï¼Œä»¥è·å–è·¯å¾„ä¸Šçš„ä¸‹ä¸€ä¸ªå›¾å—ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GameTile NextTileOnPath =&gt; nextOnPath;</code> </pre> <br> æ•ŒäººçŸ¥é“è¦é€€å‡ºçš„åœ°å—ä»¥åŠéœ€è¦è¿›å…¥çš„åœ°å—åï¼Œä¾¿å¯ä»¥ç¡®å®šç§»åŠ¨ä¸€ä¸ªåœ°å—çš„èµ·ç‚¹å’Œç»ˆç‚¹ã€‚ æ•Œäººå¯ä»¥åœ¨è¿™ä¸¤ç‚¹ä¹‹é—´æ’å…¥ä½ç½®ï¼Œä»¥è·Ÿè¸ªå…¶ç§»åŠ¨ã€‚ ç§»åŠ¨å®Œæˆåï¼Œå¯¹ä¸‹ä¸€ä¸ªå›¾å—é‡å¤æ­¤è¿‡ç¨‹ã€‚ ä½†æ˜¯è·¯å¾„å¯ä»¥éšæ—¶æ›´æ”¹ã€‚ æ— éœ€ç¡®å®šåœ¨ç§»åŠ¨è¿‡ç¨‹ä¸­è¿›ä¸€æ­¥ç§»åŠ¨çš„ä½ç½®ï¼Œæˆ‘ä»¬åªéœ€ç»§ç»­æ²¿ç€è®¡åˆ’çš„è·¯çº¿ç§»åŠ¨å¹¶æ£€æŸ¥å®ƒï¼Œåˆ°è¾¾ä¸‹ä¸€ä¸ªå›¾å—å³å¯ã€‚ <br><br> è®©<code>Enemy</code>è·Ÿè¸ªä¸¤ä¸ªå›¾å—ï¼Œä»¥ä½¿å…¶ä¸å—è·¯å¾„æ›´æ”¹çš„å½±å“ã€‚ ä»–è¿˜å°†è·Ÿè¸ªä½ç½®ï¼Œä»¥ä¾¿æˆ‘ä»¬ä¸å¿…åœ¨æ¯ä¸ªå¸§ä¸­éƒ½æ¥æ”¶å®ƒä»¬ï¼Œå¹¶è·Ÿè¸ªç§»åŠ¨è¿‡ç¨‹ã€‚ <br><br><pre> <code class="cs hljs"> GameTile tileFrom, tileTo; Vector3 positionFrom, positionTo; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> progress;</code> </pre> <br> åœ¨<code>SpawnOn</code>åˆå§‹åŒ–è¿™äº›å­—æ®µã€‚ ç¬¬ä¸€ä¸ªç‚¹æ˜¯æ•Œäººä»å…¶ç§»åŠ¨çš„å›¾å—ï¼Œç»ˆç‚¹æ˜¯è·¯å¾„ä¸Šçš„ä¸‹ä¸€ä¸ªå›¾å—ã€‚ è¿™å‡å®šå­˜åœ¨ä¸‹ä¸€ä¸ªå›¾å—ï¼Œé™¤éåœ¨ç«¯ç‚¹å¤„åˆ›å»ºäº†æ•Œäººï¼Œå¦åˆ™è¿™æ˜¯ä¸å¯èƒ½çš„ã€‚ ç„¶åï¼Œæˆ‘ä»¬ç¼“å­˜å›¾å—çš„ä½ç½®å¹¶é‡ç½®è¿›åº¦ã€‚ æˆ‘ä»¬ä¸éœ€è¦åœ¨è¿™é‡Œè®¾ç½®æ•Œäººçš„ä½ç½®ï¼Œå› ä¸ºä»–çš„<code>GameUpdate</code>æ–¹æ³•<code>GameUpdate</code>åœ¨åŒä¸€å¸§ä¸­è°ƒç”¨çš„ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SpawnOn</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GameTile tile</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//transform.localPosition = tile.transform.localPosition; Debug.Assert(tile.NextTileOnPath != null, "Nowhere to go!", this); tileFrom = tile; tileTo = tile.NextTileOnPath; positionFrom = tileFrom.transform.localPosition; positionTo = tileTo.transform.localPosition; progress = 0f; }</span></span></code> </pre> <br> è¿›åº¦å¢é‡å°†åœ¨<code>GameUpdate</code>æ‰§è¡Œã€‚ è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæ’å®šçš„æ—¶é—´å˜åŒ–é‡ï¼Œä»¥ä¾¿æ•Œäººä»¥æ¯ç§’ä¸€æ ¼çš„é€Ÿåº¦ç§»åŠ¨ã€‚ è¿›åº¦å®Œæˆåï¼Œæˆ‘ä»¬å°†ç§»åŠ¨æ•°æ®ï¼Œä»¥ä½¿<code>To</code>æˆä¸ºå€¼<code>From</code> ï¼Œè€Œæ–°çš„<code>To</code>æ˜¯è·¯å¾„ä¸Šçš„ä¸‹ä¸€ä¸ªå›¾å—ã€‚ ç„¶åæˆ‘ä»¬é€’å‡è¿›åº¦ã€‚ å½“æ•°æ®å˜å¾—æœ‰æ„ä¹‰æ—¶ï¼Œæˆ‘ä»¬åœ¨<code>From</code>å’Œ<code>To</code>ä¹‹é—´æ’å…¥æ•Œäººçš„ä½ç½®ã€‚ ç”±äºæ’å€¼å™¨æ˜¯è¿›æ­¥çš„ï¼Œå…¶å€¼å¿…é¡»åœ¨0åˆ°1çš„èŒƒå›´å†…ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨s <code>Vector3.LerpUnclamped</code> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GameUpdate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { progress += Time.deltaTime; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (progress &gt;= <span class="hljs-number"><span class="hljs-number">1f</span></span>) { tileFrom = tileTo; tileTo = tileTo.NextTileOnPath; positionFrom = positionTo; positionTo = tileTo.transform.localPosition; progress -= <span class="hljs-number"><span class="hljs-number">1f</span></span>; } transform.localPosition = Vector3.LerpUnclamped(positionFrom, positionTo, progress); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br> è¿™è¿«ä½¿æ•Œäººæ²¿ç€è¿™æ¡è·¯èµ°ï¼Œä½†åœ¨åˆ°è¾¾ç»ˆç‚¹æ—¶ä¸ä¼šè¡ŒåŠ¨ã€‚ å› æ­¤ï¼Œåœ¨æ›´æ”¹<code>From</code>å’Œ<code>To</code>çš„ä½ç½®ä¹‹å‰ï¼Œéœ€è¦å°†è·¯å¾„ä¸Šçš„ä¸‹ä¸€ä¸ªå›¾å—ä¸<code>null</code>è¿›è¡Œæ¯”è¾ƒã€‚ å¦‚æœæ˜¯è¿™æ ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å·²ç»åˆ°è¾¾ç»ˆç‚¹ï¼Œæ•Œäººå·²ç»å®Œæˆäº†è¡ŒåŠ¨ã€‚ æˆ‘ä»¬ä¸ºæ­¤æ‰§è¡ŒReclaimå¹¶è¿”å›<code>false</code> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (progress &gt;= <span class="hljs-number"><span class="hljs-number">1f</span></span>) { tileFrom = tileTo; tileTo = tileTo.NextTileOnPath; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tileTo == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { OriginFactory.Reclaim(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } positionFrom = positionTo; positionTo = tileTo.transform.localPosition; progress -= <span class="hljs-number"><span class="hljs-number">1f</span></span>; }</code> </pre> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>æ•Œäººèµ°çš„è·¯æœ€çŸ­ã€‚</i> <br><br> æ•Œäººç°åœ¨æ­£åœ¨ä»ä¸€ä¸ªç –å—çš„ä¸­å¿ƒç§»åŠ¨åˆ°å¦ä¸€ä¸ªç –å—çš„ä¸­å¿ƒã€‚ å€¼å¾—è€ƒè™‘çš„æ˜¯ï¼Œå®ƒä»¬ä»…åœ¨ç –å—çš„ä¸­å¿ƒæ”¹å˜å…¶è¿åŠ¨çŠ¶æ€ï¼Œå› æ­¤å®ƒä»¬æ— æ³•ç«‹å³å“åº”é‡å¤–å˜åŒ–ã€‚ è¿™æ„å‘³ç€æœ‰æ—¶æ•Œäººä¼šç©¿è¿‡åˆšè®¾ç½®çš„å¢™å£ã€‚ ä¸€æ—¦ä»–ä»¬å¼€å§‹å‘ç‰¢æˆ¿ç§»åŠ¨ï¼Œæ²¡æœ‰ä»€ä¹ˆå¯ä»¥é˜»æ­¢ä»–ä»¬ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¢™ä¹Ÿéœ€è¦çœŸå®çš„é“è·¯ã€‚ <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>æ•Œäººå¯¹å˜åŒ–çš„è·¯å¾„åšå‡ºååº”ã€‚</i> <br><br><h3> è¾¹åˆ°è¾¹è¿åŠ¨ </h3><br> ç“·ç –ä¸­å¿ƒä¹‹é—´çš„ç§»åŠ¨å’Œæ–¹å‘çš„æ€¥å‰§å˜åŒ–å¯¹äºæŠ½è±¡æ¸¸æˆæ¥è¯´æ˜¯æ­£å¸¸çš„ï¼Œåœ¨è¿™ç§æŠ½è±¡æ¸¸æˆä¸­ï¼Œæ•Œäººæ­£åœ¨ç§»åŠ¨ç«‹æ–¹ä½“ï¼Œä½†é€šå¸¸å¹³æ»‘çš„è¿åŠ¨çœ‹èµ·æ¥ä¼šæ›´æ¼‚äº®ã€‚ å®æ–½çš„ç¬¬ä¸€æ­¥ä¸æ˜¯æ²¿ä¸­å¿ƒç§»åŠ¨ï¼Œè€Œæ˜¯æ²¿å›¾å—çš„è¾¹ç¼˜ç§»åŠ¨ã€‚ <br><br> ç›¸é‚»ç“¦ç‰‡ä¹‹é—´çš„è¾¹ç¼˜ç‚¹å¯ä»¥é€šè¿‡å¹³å‡å…¶ä½ç½®æ¥æ‰¾åˆ°ã€‚ æˆ‘ä»¬ä»…åœ¨æ›´æ”¹<code>GameTile.GrowPathTo</code>çš„è·¯å¾„æ—¶æ‰å¯¹å®ƒè¿›è¡Œè®¡ç®—ï¼Œè€Œä¸æ˜¯å¯¹æ¯ä¸ªæ•Œäººéƒ½ä¸€æ­¥ä¸€æ­¥åœ°è®¡ç®—ã€‚ ä½¿ç”¨<code>ExitPoint</code>å±æ€§ä½¿å…¶å¯ç”¨ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 ExitPoint { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } â€¦ <span class="hljs-function"><span class="hljs-function">GameTile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GrowPathTo</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GameTile neighbor</span></span></span><span class="hljs-function">)</span></span> { â€¦ neighbor.ExitPoint = (neighbor.transform.localPosition + transform.localPosition) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> neighbor.Content.Type != GameTileContentType.Wall ? neighbor : <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br> å”¯ä¸€çš„ç‰¹æ®Šæƒ…å†µæ˜¯æœ€ç»ˆå•å…ƒæ ¼ï¼Œå…¶å‡ºå£ç‚¹å°†æ˜¯å…¶ä¸­å¿ƒã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BecomeDestination</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { distance = <span class="hljs-number"><span class="hljs-number">0</span></span>; nextOnPath = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; ExitPoint = transform.localPosition; }</code> </pre> <br> æ›´æ”¹<code>Enemy</code> ï¼Œä½¿å…¶ä½¿ç”¨å‡ºå£ç‚¹è€Œä¸æ˜¯å¹³é“ºä¸­å¿ƒã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GameUpdate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { progress += Time.deltaTime; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (progress &gt;= <span class="hljs-number"><span class="hljs-number">1f</span></span>) { â€¦ positionTo = tileFrom.ExitPoint; progress -= <span class="hljs-number"><span class="hljs-number">1f</span></span>; } transform.localPosition = Vector3.Lerp(positionFrom, positionTo, progress); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SpawnOn</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GameTile tile</span></span></span><span class="hljs-function">)</span></span> { â€¦ positionTo = tileFrom.ExitPoint; progress = <span class="hljs-number"><span class="hljs-number">0f</span></span>; }</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>æ•Œäººåœ¨è¾¹ç¼˜ä¹‹é—´ç§»åŠ¨ã€‚</i> <br><br> è¿™ç§å˜åŒ–çš„å‰¯ä½œç”¨æ˜¯ï¼Œå½“æ•Œäººç”±äºè·¯å¾„å˜åŒ–è€Œè½¬å¼¯æ—¶ï¼Œå®ƒä»¬ä¼šä¿æŒä¸€ç§’é’Ÿä¸åŠ¨ã€‚ <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>è½¬èº«æ—¶ï¼Œæ•Œäººä¼šåœæ­¢ã€‚</i> <br><br><h3> æ–¹å‘ </h3><br> å°½ç®¡æ•Œäººæ²¿ç€å°è·¯ç§»åŠ¨ï¼Œç›´åˆ°ä»–ä»¬æ”¹å˜æ–¹å‘ã€‚ ä¸ºäº†ä½¿ä»–ä»¬å¯ä»¥çœ‹å‘è¿åŠ¨æ–¹å‘ï¼Œä»–ä»¬éœ€è¦çŸ¥é“ä»–ä»¬æ‰€éµå¾ªçš„è·¯å¾„çš„æ–¹å‘ã€‚ æˆ‘ä»¬è¿˜å°†åœ¨å¯»æ‰¾æ–¹æ³•çš„è¿‡ç¨‹ä¸­ç¡®å®šè¿™ä¸€ç‚¹ï¼Œè¿™æ ·æ•Œäººå°±ä¸å¿…è¿™æ ·åšäº†ã€‚ <br><br> æˆ‘ä»¬æœ‰å››ä¸ªæ–¹å‘ï¼šåŒ—ï¼Œä¸œï¼Œå—å’Œè¥¿ã€‚ è®©æˆ‘ä»¬åˆ—ä¸¾ä¸€ä¸‹ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Direction { North, East, South, West }</code> </pre> <br> ç„¶åï¼Œæˆ‘ä»¬ç»™<code>GameTile</code>å±æ€§å­˜å‚¨å…¶è·¯å¾„çš„æ–¹å‘ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Direction PathDirection { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre> <br> å°†æ–¹å‘å‚æ•°æ·»åŠ åˆ°<code>GrowTo</code> ï¼Œä»¥è®¾ç½®å±æ€§ã€‚ ç”±äºæˆ‘ä»¬ä»å¤´åˆ°å°¾éƒ½åœ¨å‘å±•ä¸€æ¡é“è·¯ï¼Œå› æ­¤æ–¹å‘å°†ä¸æˆ‘ä»¬ä»é‚£å¼€å§‹çš„é“è·¯ç›¸åã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GameTile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GrowPathNorth</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; GrowPathTo(north, Direction.South); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GameTile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GrowPathEast</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; GrowPathTo(east, Direction.West); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GameTile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GrowPathSouth</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; GrowPathTo(south, Direction.North); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GameTile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GrowPathWest</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; GrowPathTo(west, Direction.East); <span class="hljs-function"><span class="hljs-function">GameTile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GrowPathTo</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GameTile neighbor, Direction direction</span></span></span><span class="hljs-function">)</span></span> { â€¦ neighbor.PathDirection = direction; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> neighbor.Content.Type != GameTileContentType.Wall ? neighbor : <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br> æˆ‘ä»¬éœ€è¦å°†æ–¹å‘è½¬æ¢ä¸ºä»¥å››å…ƒæ•°è¡¨ç¤ºçš„è½¬å¼¯ã€‚ å¦‚æœæˆ‘ä»¬å¯ä»¥åªè°ƒç”¨<code>GetRotation</code>ä½œä¸ºæ–¹å‘ï¼Œé‚£å°†å¾ˆæ–¹ä¾¿ï¼Œå› æ­¤è®©æˆ‘ä»¬é€šè¿‡åˆ›å»ºæ‰©å±•æ–¹æ³•æ¥å®ç°ã€‚ æ·»åŠ ä¸€èˆ¬çš„é™æ€æ–¹æ³•<code>DirectionExtensions</code> ï¼Œä¸ºå…¶æä¾›ä¸€ä¸ªæ•°ç»„ä»¥ç¼“å­˜å¿…è¦çš„å››å…ƒæ•°ï¼Œå¹¶æ·»åŠ <code>GetRotation</code>æ–¹æ³•ä»¥è¿”å›ç›¸åº”çš„æ–¹å‘å€¼ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†æ‰©å±•ç±»ä¸æšä¸¾ç±»å‹æ”¾åœ¨åŒä¸€æ–‡ä»¶ä¸­æ˜¯æœ‰æ„ä¹‰çš„ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Direction { North, East, South, West } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DirectionExtensions</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Quaternion[] rotations = { Quaternion.identity, Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">90f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">180f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">270f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Quaternion </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetRotation</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Direction direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rotations[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction]; } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">ä»€ä¹ˆæ˜¯æ‰©å±•æ–¹æ³•ï¼Ÿ</b> <div class="spoiler_text"> æ‰©å±•æ–¹æ³•æ˜¯é™æ€ç±»å†…éƒ¨çš„é™æ€æ–¹æ³•ï¼Œå…¶è¡Œä¸ºç±»ä¼¼äºæŸç§ç±»å‹çš„å®ä¾‹æ–¹æ³•ã€‚ æ­¤ç±»å‹å¯ä»¥æ˜¯ç±»ï¼Œæ¥å£ï¼Œç»“æ„ï¼ŒåŸå§‹å€¼æˆ–æšä¸¾ã€‚ æ‰©å±•æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»å…·æœ‰<code>this</code> ã€‚ å®ƒå®šä¹‰è¯¥æ–¹æ³•å°†ä½¿ç”¨çš„ç±»å‹å’Œå®ä¾‹çš„å€¼ã€‚ è¿™ç§æ–¹æ³•æ„å‘³ç€æ— æ³•æ‰©å±•å±æ€§ã€‚ <br><br> è¿™æ˜¯å¦å…è®¸æ‚¨å°†æ–¹æ³•æ·»åŠ åˆ°ä»»ä½•å†…å®¹ï¼Ÿ æ˜¯çš„ï¼Œå°±åƒæ‚¨å¯ä»¥ç¼–å†™ä»»ä½•å‚æ•°ä¸ºä»»ä½•ç±»å‹çš„é™æ€æ–¹æ³•ä¸€æ ·ã€‚ </div></div><br> ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç”Ÿæˆæ—¶ä»¥åŠæ¯æ¬¡è¾“å…¥æ–°çš„å›¾å—æ—¶æ—‹è½¬<code>Enemy</code> ã€‚ æ›´æ–°æ•°æ®åï¼Œâ€œ <code>From</code>ç£è´´ä¸ºæˆ‘ä»¬æä¾›äº†æ–¹å‘ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GameUpdate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { progress += Time.deltaTime; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (progress &gt;= <span class="hljs-number"><span class="hljs-number">1f</span></span>) { â€¦ transform.localRotation = tileFrom.PathDirection.GetRotation(); progress -= <span class="hljs-number"><span class="hljs-number">1f</span></span>; } transform.localPosition = Vector3.LerpUnclamped(positionFrom, positionTo, progress); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SpawnOn</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GameTile tile</span></span></span><span class="hljs-function">)</span></span> { â€¦ transform.localRotation = tileFrom.PathDirection.GetRotation(); progress = <span class="hljs-number"><span class="hljs-number">0f</span></span>; }</code> </pre> <br><h3> æ–¹å‘æ”¹å˜ </h3><br> ä¸å…¶ç«‹å³æ”¹å˜æ–¹å‘ï¼Œä¸å¦‚åœ¨è½¬å¼¯ä¹‹é—´æ’å€¼ï¼Œå°±åƒæˆ‘ä»¬åœ¨ä½ç½®ä¹‹é—´æ’å€¼ä¸€æ ·ã€‚ è¦ä»ä¸€ä¸ªæ–¹å‘è½¬åˆ°å¦ä¸€ä¸ªæ–¹å‘ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“éœ€è¦å®Œæˆçš„æ–¹å‘æ›´æ”¹ï¼šæ— éœ€è½¬å¼¯ï¼Œå³è½¬ï¼Œå·¦è½¬æˆ–åé€€ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªæšä¸¾ï¼Œè¯¥æšä¸¾åˆå¯ä»¥ä¸<code>Direction</code>æ”¾ç½®åœ¨åŒä¸€æ–‡ä»¶ä¸­ï¼Œå› ä¸ºå®ƒä»¬å¾ˆå°å¹¶ä¸”ç´§å¯†ç›¸å…³ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Direction { North, East, South, West } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> DirectionChange { None, TurnRight, TurnLeft, TurnAround }</code> </pre> <br> æ·»åŠ å¦ä¸€ä¸ªæ‰©å±•æ–¹æ³•ï¼Œè¿™ä¸€æ¬¡æ˜¯<code>GetDirectionChangeTo</code> ï¼Œå®ƒå°†è¿”å›ä»å½“å‰æ–¹å‘åˆ°ä¸‹ä¸€ä¸ªæ–¹å‘çš„æ–¹å‘æ›´æ”¹ã€‚ å¦‚æœæ–¹å‘ä¸€è‡´ï¼Œåˆ™æ²¡æœ‰ç§»åŠ¨ã€‚ å¦‚æœä¸‹ä¸€ä¸ªå¤§äºå½“å‰ï¼Œåˆ™å‘å³è½¬ã€‚ ä½†æ˜¯ç”±äºé‡å¤äº†è¿™äº›æŒ‡ç¤ºï¼Œå› æ­¤ä¸‹ä¸€ä¸ªæ¯”å½“å‰æŒ‡ç¤ºå°‘ä¸‰ä¸ªæ—¶ï¼Œæƒ…å†µç›¸åŒã€‚ å·¦è½¬å¼¯å°†æ˜¯ç›¸åŒçš„ï¼Œåªæœ‰åŠ æ³•å’Œå‡æ³•ä¼šåˆ‡æ¢ä½ç½®ã€‚<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å‰©ä¸‹çš„å”¯ä¸€æƒ…å†µæ˜¯è½¬èº«ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> DirectionChange </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDirectionChangeTo</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Direction current, Direction next </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current == next) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DirectionChange.None; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current + <span class="hljs-number"><span class="hljs-number">1</span></span> == next || current - <span class="hljs-number"><span class="hljs-number">3</span></span> == next) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DirectionChange.TurnRight; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current - <span class="hljs-number"><span class="hljs-number">1</span></span> == next || current + <span class="hljs-number"><span class="hljs-number">3</span></span> == next) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DirectionChange.TurnLeft; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DirectionChange.TurnAround; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä»…åœ¨ä¸€ä¸ªç»´åº¦ä¸Šæ—‹è½¬ï¼Œå› æ­¤è§’åº¦çš„çº¿æ€§æ’å€¼å¯¹æˆ‘ä»¬è€Œè¨€å·²è¶³å¤Ÿã€‚</font><font style="vertical-align: inherit;">æ·»åŠ å¦ä¸€ç§æ‰©å±•æ–¹æ³•ï¼Œä»¥åº¦ä¸ºå•ä½è·å–æ–¹å‘è§’ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAngle</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Direction direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)direction * <span class="hljs-number"><span class="hljs-number">90f</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæ‚¨å¿…é¡»</font></font><code>Enemy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è·Ÿè¸ªéœ€è¦è¿›è¡Œæ’å€¼çš„æ–¹å‘ï¼Œæ–¹å‘å˜åŒ–å’Œè§’åº¦ã€‚</font></font><br><br><pre> <code class="cs hljs"> Direction direction; DirectionChange directionChange; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> directionAngleFrom, directionAngleTo;</code> </pre> <br> <code>SpawnOn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å˜å¾—è¶Šæ¥è¶Šå›°éš¾ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å°†çŠ¶æ€å‡†å¤‡ä»£ç ç§»åˆ°å¦ä¸€ç§æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä¼šå°†æ•Œäººçš„åˆå§‹çŠ¶æ€æŒ‡å®šä¸ºå…¥é—¨çŠ¶æ€ï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶ç§°ä¸º</font></font><code>PrepareIntro</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼Œæ•Œäººä»ä¸­å¿ƒç§»åŠ¨åˆ°å…¶åˆå§‹å›¾å—çš„è¾¹ç¼˜ï¼Œå› æ­¤æ–¹å‘ä¸å˜ã€‚</font><font style="vertical-align: inherit;">è§’åº¦</font></font><code>From</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><code>To</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›¸åŒçš„ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SpawnOn</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GameTile tile</span></span></span><span class="hljs-function">)</span></span> { Debug.Assert(tile.NextTileOnPath != <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"Nowhere to go!"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); tileFrom = tile; tileTo = tile.NextTileOnPath; <span class="hljs-comment"><span class="hljs-comment">//positionFrom = tileFrom.transform.localPosition; //positionTo = tileFrom.ExitPoint; //transform.localRotation = tileFrom.PathDirection.GetRotation(); progress = 0f; PrepareIntro(); } void PrepareIntro () { positionFrom = tileFrom.transform.localPosition; positionTo = tileFrom.ExitPoint; direction = tileFrom.PathDirection; directionChange = DirectionChange.None; directionAngleFrom = directionAngleTo = direction.GetAngle(); transform.localRotation = direction.GetRotation(); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬åˆ›å»ºç±»ä¼¼å°å‹çŠ¶æ€æœºçš„ä¸œè¥¿ã€‚</font><font style="vertical-align: inherit;">ä¸ºç®€åŒ–èµ·è§</font></font><code>GameUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè¯·å°†çŠ¶æ€ä»£ç ç§»è‡³æ–°æ–¹æ³•</font></font><code>PrepareNextState</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä»…ä¿ç•™ç£è´´</font></font><code>From</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font><font style="vertical-align: inherit;">çš„æ›´æ”¹</font></font><code>To</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨æ­¤å¤„ä½¿ç”¨å®ƒä»¬æ¥æ£€æŸ¥æ•Œäººæ˜¯å¦å®Œæˆäº†è·¯å¾„ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GameUpdate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { progress += Time.deltaTime; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (progress &gt;= <span class="hljs-number"><span class="hljs-number">1f</span></span>) { â€¦ <span class="hljs-comment"><span class="hljs-comment">//positionFrom = positionTo; //positionTo = tileFrom.ExitPoint; //transform.localRotation = tileFrom.PathDirection.GetRotation(); progress -= 1f; PrepareNextState(); } â€¦ }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿‡æ¸¡åˆ°æ–°çŠ¶æ€æ—¶ï¼Œæ‚¨å§‹ç»ˆéœ€è¦æ›´æ”¹ä½ç½®ï¼ŒæŸ¥æ‰¾æ–¹å‘æ›´æ”¹ï¼Œæ›´æ–°å½“å‰æ–¹å‘å¹¶å°†è§’åº¦</font></font><code>To</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§»è‡³</font></font><code>From</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸å†è½¬å¼¯ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareNextState</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { positionFrom = positionTo; positionTo = tileFrom.ExitPoint; directionChange = direction.GetDirectionChangeTo(tileFrom.PathDirection); direction = tileFrom.PathDirection; directionAngleFrom = directionAngleTo; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¶ä»–åŠ¨ä½œå–å†³äºæ–¹å‘çš„æ”¹å˜ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä¸ºæ¯ä¸ªé€‰é¡¹æ·»åŠ ä¸€ä¸ªæ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬å‘å‰ç§»åŠ¨ï¼Œåˆ™è§’åº¦</font></font><code>To</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸å½“å‰å•å…ƒæ ¼è·¯å¾„çš„æ–¹å‘é‡åˆã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®æ—‹è½¬è§’åº¦ï¼Œä»¥ä½¿æ•Œäººç›´è§†å‰æ–¹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareForward</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { transform.localRotation = direction.GetRotation(); directionAngleTo = direction.GetAngle(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è½¬å¼¯çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸ä¼šç«‹å³è½¬å¼¯ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦æ’å€¼ä¸€ä¸ªä¸åŒçš„è§’åº¦ï¼šå‘å³è½¬90åº¦ï¼Œå‘å·¦è½¬90åº¦ï¼Œå‘åè½¬180Â°ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†é¿å…ç”±äºè§’åº¦å€¼ä»359Â°å˜ä¸º0Â°è€Œå¯¼è‡´è½¬å‘é”™è¯¯ï¼Œ</font></font><code>To</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åº”è¯¥ç›¸å¯¹äºå½“å‰æ–¹å‘æŒ‡ç¤º</font><font style="vertical-align: inherit;">è§’åº¦</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬æ— éœ€æ‹…å¿ƒè§’åº¦ä¼šå°äº0Â°æˆ–å¤§äº360Â°ï¼Œå› ä¸ºæˆ‘ä»¬</font></font><code>Quaternion.Euler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ä»¥å¤„ç†å®ƒã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareTurnRight</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { directionAngleTo = directionAngleFrom + <span class="hljs-number"><span class="hljs-number">90f</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareTurnLeft</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { directionAngleTo = directionAngleFrom - <span class="hljs-number"><span class="hljs-number">90f</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareTurnAround</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { directionAngleTo = directionAngleFrom + <span class="hljs-number"><span class="hljs-number">180f</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åï¼Œ</font></font><code>PrepareNextState</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨</font></font><code>switch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´æ”¹æ–¹å‘æ¥ç¡®å®šè¦è°ƒç”¨çš„å››ç§æ–¹æ³•ä¸­çš„å“ªä¸€ç§ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareNextState</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (directionChange) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> DirectionChange.None: PrepareForward(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> DirectionChange.TurnRight: PrepareTurnRight(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> DirectionChange.TurnLeft: PrepareTurnLeft(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: PrepareTurnAround(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æœ€åï¼Œ</font></font><code>GameUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦æ£€æŸ¥æ–¹å‘æ˜¯å¦å·²æ›´æ”¹ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ˜¯è¿™æ ·ï¼Œåˆ™åœ¨ä¸¤ä¸ªè§’ä¹‹é—´è¿›è¡Œæ’å€¼å¹¶è®¾ç½®æ—‹è½¬è§’åº¦ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GameUpdate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ transform.localPosition = Vector3.LerpUnclamped(positionFrom, positionTo, progress); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (directionChange != DirectionChange.None) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> angle = Mathf.LerpUnclamped( directionAngleFrom, directionAngleTo, progress ); transform.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, angle, <span class="hljs-number"><span class="hljs-number">0f</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•Œäººåœ¨è½¬ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ›²çº¿è¿åŠ¨ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿æ•Œäººåœ¨è½¬å¼¯æ—¶æ²¿ç€æ›²çº¿ç§»åŠ¨æ¥æ”¹å–„è¿åŠ¨ã€‚</font><font style="vertical-align: inherit;">è®©å®ƒä»¬èµ°å››åˆ†ä¹‹ä¸€åœˆè€Œä¸æ˜¯ä»ç –çš„è¾¹ç¼˜åˆ°è¾¹ç¼˜èµ°ã€‚</font><font style="vertical-align: inherit;">è¿™ä¸ªåœˆå­é‡Œçš„è°è¨€åœ¨è§’è½é‡Œå¸¸è§åˆ°ç –çš„ä¸­å¿ƒ</font></font><code>From</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><code>To</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œåœ¨åŒä¸€è¾¹ç¼˜ä¸Šçš„ç“·ç –è¿›å…¥äº†æ•Œäºº</font></font><code>From</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d7/8a6/3a5/1d78a63a58d34a1d8cc9ff56a0b23cc3.png" width="256" height="256"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å››åˆ†ä¹‹ä¸€åœˆæ—‹è½¬ä»¥å‘å³è½¬ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ä¸‰è§’å‡½æ•°æ²¿å¼§å½¢ç§»åŠ¨æ•Œäººï¼ŒåŒæ—¶æ—‹è½¬æ•Œäººæ¥å®ç°è¿™ä¸€ç‚¹ã€‚</font><font style="vertical-align: inherit;">ä½†è¿™å¯ä»¥é€šè¿‡ä»…æ—‹è½¬å°†æ•Œäººåæ ‡çš„æœ¬åœ°åŸç‚¹æš‚æ—¶ç§»åŠ¨åˆ°åœ†å¿ƒæ¥ç®€åŒ–ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ”¹æ•Œäººæ¨¡å‹çš„ä½ç½®ï¼Œå› æ­¤æˆ‘ä»¬å°†æä¾›</font></font><code>Enemy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤æ¨¡å‹</font><font style="vertical-align: inherit;">çš„</font><font style="vertical-align: inherit;">é“¾æ¥ï¼Œå¯é€šè¿‡é…ç½®å­—æ®µè®¿é—®</font><font style="vertical-align: inherit;">è¯¥</font><font style="vertical-align: inherit;">é“¾æ¥ã€‚</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">SerializeField</span></span>] Transform model = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/72b/13c/28e/72b13c28ed9d6a8d34f3e17536e964cd.png" width="320" height="56"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸æ¨¡å‹æœ‰å…³çš„æ•Œäººã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†å‡†å¤‡å‰è¿›æˆ–åé€€ï¼Œæ¨¡å‹åº”ç§»åŠ¨åˆ°æ ‡å‡†ä½ç½®ï¼Œå³æ•Œäººåæ ‡çš„æœ¬åœ°åŸç‚¹ã€‚</font><font style="vertical-align: inherit;">å¦åˆ™ï¼Œå¿…é¡»å°†æ¨¡å‹åç§»æµ‹é‡å•ä½çš„ä¸€åŠ-æ—‹è½¬åœ†çš„åŠå¾„ï¼Œè¿œç¦»è½¬æŠ˜ç‚¹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareForward</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { transform.localRotation = direction.GetRotation(); directionAngleTo = direction.GetAngle(); model.localPosition = Vector3.zero; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareTurnRight</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { directionAngleTo = directionAngleFrom + <span class="hljs-number"><span class="hljs-number">90f</span></span>; model.localPosition = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(<span class="hljs-number"><span class="hljs-number">-0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareTurnLeft</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { directionAngleTo = directionAngleFrom - <span class="hljs-number"><span class="hljs-number">90f</span></span>; model.localPosition = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareTurnAround</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { directionAngleTo = directionAngleFrom + <span class="hljs-number"><span class="hljs-number">180f</span></span>; model.localPosition = Vector3.zero; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæ•Œäººæœ¬äººéœ€è¦è½¬ç§»åˆ°è½¬æŠ˜ç‚¹ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œè¿˜å¿…é¡»å°†å…¶ç§»åŠ¨åŠä¸ªæµ‹é‡å•ä½ï¼Œä½†æ˜¯ç¡®åˆ‡çš„åç§»é‡å–å†³äºæ–¹å‘ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä¸ºå®ƒæ·»åŠ </font></font><code>Direction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€ä¸ªè¾…åŠ©æ‰©å±•æ–¹æ³•</font></font><code>GetHalfVector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Vector3[] halfVectors = { Vector3.forward * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>, Vector3.right * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>, Vector3.back * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>, Vector3.left * <span class="hljs-number"><span class="hljs-number">0.5f</span></span> }; â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHalfVector</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Direction direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> halfVectors[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction]; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å‘å³æˆ–å‘å·¦æ—‹è½¬æ—¶ï¼Œæ·»åŠ ç›¸åº”çš„å‘é‡ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareTurnRight</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { directionAngleTo = directionAngleFrom + <span class="hljs-number"><span class="hljs-number">90f</span></span>; model.localPosition = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(<span class="hljs-number"><span class="hljs-number">-0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); transform.localPosition = positionFrom + direction.GetHalfVector(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareTurnLeft</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { directionAngleTo = directionAngleFrom - <span class="hljs-number"><span class="hljs-number">90f</span></span>; model.localPosition = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); transform.localPosition = positionFrom + direction.GetHalfVector(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å½“å›å¤´æ—¶ï¼Œè¯¥ä½ç½®åº”ä¸ºé€šå¸¸çš„èµ·ç‚¹ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareTurnAround</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { directionAngleTo = directionAngleFrom + <span class="hljs-number"><span class="hljs-number">180f</span></span>; model.localPosition = Vector3.zero; transform.localPosition = positionFrom; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦å¤–ï¼Œåœ¨è®¡ç®—å‡ºå£ç‚¹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨</font></font><code>GameTile.GrowPathTo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘é‡çš„ä¸€åŠï¼Œè¿™æ ·å°±æ— éœ€è®¿é—®å›¾å—çš„ä¸¤ä¸ªä½ç½®ã€‚</font></font><br><br><pre> <code class="cs hljs"> neighbor.ExitPoint = neighbor.transform.localPosition + direction.GetHalfVector();</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œåœ¨æ›´æ”¹æ–¹å‘æ—¶ï¼Œæˆ‘ä»¬ä¸å¿…æ’å€¼ä¸­çš„ä½ç½®</font></font><code>Enemy.GameUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå› ä¸ºæ—‹è½¬å‚ä¸äº†è¿åŠ¨ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GameUpdate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (directionChange == DirectionChange.None) { transform.localPosition = Vector3.LerpUnclamped(positionFrom, positionTo, progress); } <span class="hljs-comment"><span class="hljs-comment">//if (directionChange != DirectionChange.None) { else { float angle = Mathf.LerpUnclamped( directionAngleFrom, directionAngleTo, progress ); transform.localRotation = Quaternion.Euler(0f, angle, 0f); } return true; }</span></span></code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•Œäººåœ¨æ‹è§’å¤„å¹³ç¨³å¼¯æ›²ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ’é€Ÿ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ•Œäººçš„é€Ÿåº¦å§‹ç»ˆç­‰äºæ¯ç§’1ä¸ªå›¾å—ï¼Œæ— è®ºå®ƒä»¬åœ¨å›¾å—å†…éƒ¨å¦‚ä½•ç§»åŠ¨ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯å®ƒä»¬è¦†ç›–çš„è·ç¦»å–å†³äºå…¶çŠ¶å†µï¼Œå› æ­¤å®ƒä»¬çš„é€Ÿåº¦ï¼ˆä»¥æ¯ç§’å•ä½è¡¨ç¤ºï¼‰ä¼šæœ‰æ‰€ä¸åŒã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ä½¿æ­¤é€Ÿåº¦æ’å®šï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®çŠ¶æ€æ›´æ”¹è¿›åº¦é€Ÿåº¦ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæ·»åŠ è¿›åº¦ä¹˜æ•°å­—æ®µå¹¶ä½¿ç”¨å®ƒæ¥ç¼©æ”¾ä¸­çš„å¢é‡</font></font><code>GameUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> progress, progressFactor; â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GameUpdate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { progress += Time.deltaTime * progressFactor; â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå¦‚æœè¿›åº¦æ ¹æ®çŠ¶æ€è€Œå˜åŒ–ï¼Œåˆ™å‰©ä½™çš„è¿›åº¦å€¼ä¸èƒ½ç›´æ¥ç”¨äºä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œåœ¨å‡†å¤‡æ–°çŠ¶æ€ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ ‡å‡†åŒ–è¿›åº¦å¹¶åœ¨æ–°çŠ¶æ€ä¸‹åº”ç”¨æ–°çš„ä¹˜æ•°ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GameUpdate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { progress += Time.deltaTime * progressFactor; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (progress &gt;= <span class="hljs-number"><span class="hljs-number">1f</span></span>) { â€¦ <span class="hljs-comment"><span class="hljs-comment">//progress -= 1f; progress = (progress - 1f) / progressFactor; PrepareNextState(); progress *= progressFactor; } â€¦ }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘å‰ç§»åŠ¨ä¸éœ€è¦æ›´æ”¹ï¼Œå› æ­¤å®ƒä½¿ç”¨çš„ç³»æ•°ä¸º1ã€‚å‘å³æˆ–å‘å·¦è½¬æ—¶ï¼Œæ•Œäººç»è¿‡äº†åŠå¾„ä¸ºÂ½çš„å››åˆ†ä¹‹ä¸€åœ†ï¼Œå› æ­¤è¦†ç›–çš„è·ç¦»ä¸ºÂ¼Ï€ã€‚</font></font><code>progress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç­‰äºä¸€é™¤ä»¥è¯¥å€¼ã€‚</font><font style="vertical-align: inherit;">å‘åè½¬å¼¯åº”è¯¥ä¸ä¼šèŠ±è´¹å¤ªå¤šæ—¶é—´ï¼Œå› æ­¤è¯·å°†è¿›åº¦åŠ å€ï¼Œä»¥ä¾¿åŠç§’é’Ÿã€‚</font><font style="vertical-align: inherit;">æœ€åï¼Œä»‹ç»æ€§è¿åŠ¨ä»…è¦†ç›–äº†ç“·ç –çš„ä¸€åŠï¼Œå› æ­¤ï¼Œè¦ä¿æŒæ’å®šçš„é€Ÿåº¦ï¼Œå…¶è¿›åº¦ä¹Ÿéœ€è¦åŠ å€ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareForward</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ progressFactor = <span class="hljs-number"><span class="hljs-number">1f</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareTurnRight</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ progressFactor = <span class="hljs-number"><span class="hljs-number">1f</span></span> / (Mathf.PI * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareTurnLeft</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ progressFactor = <span class="hljs-number"><span class="hljs-number">1f</span></span> / (Mathf.PI * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareTurnAround</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ progressFactor = <span class="hljs-number"><span class="hljs-number">2f</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareIntro</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ progressFactor = <span class="hljs-number"><span class="hljs-number">2f</span></span>; }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºä»€ä¹ˆè·ç¦»ç­‰äº1/4 * piï¼Ÿ</font></font></b> <div class="spoiler_text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘¨é•¿æ˜¯åŠå¾„çš„2Ï€å€ã€‚</font><font style="vertical-align: inherit;">å‘å³æˆ–å‘å·¦æ—‹è½¬ä»…è¦†ç›–æ­¤é•¿åº¦çš„å››åˆ†ä¹‹ä¸€ï¼ŒåŠå¾„ä¸ºÂ½ï¼Œå› æ­¤è·ç¦»ä¸ºÂ½Ï€Ã—Â½ã€‚</font></font></div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æœ€ç»ˆçŠ¶æ€ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬æœ‰ä¸€ä¸ªä»‹ç»æ€§çš„çŠ¶æ€ï¼Œè®©æˆ‘ä»¬æ·»åŠ æœ€åä¸€ä¸ªçŠ¶æ€ã€‚</font><font style="vertical-align: inherit;">ç›®å‰ï¼Œæ•Œäººåˆ°è¾¾ç«¯ç‚¹åä¼šç«‹å³æ¶ˆå¤±ï¼Œä½†è®©æˆ‘ä»¬å°†å®ƒä»¬çš„æ¶ˆå¤±æ¨è¿Ÿåˆ°åˆ°è¾¾æœ«ç«¯å›¾å—çš„ä¸­å¿ƒã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä¸ºæ­¤åˆ›å»ºä¸€ä¸ªæ–¹æ³•</font></font><code>PrepareOutro</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè®¾ç½®å‘å‰ç§»åŠ¨ï¼Œä½†ä»…å°†å…¶ç§»åŠ¨åˆ°å›¾å—çš„ä¸­å¿ƒï¼Œè¿›åº¦åŠ å€ä»¥ä¿æŒæ’å®šçš„é€Ÿåº¦ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareOutro</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { positionTo = tileFrom.transform.localPosition; directionChange = DirectionChange.None; directionAngleTo = direction.GetAngle(); model.localPosition = Vector3.zero; transform.localRotation = direction.GetRotation(); progressFactor = <span class="hljs-number"><span class="hljs-number">2f</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†</font></font><code>GameUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸åŠæ—©æ¶ˆç­æ•Œäººï¼Œæˆ‘ä»¬å°†å–æ¶ˆå…¶å¹³ç§»ã€‚</font><font style="vertical-align: inherit;">ä»–ç°åœ¨å°±åš</font></font><code>PrepareNextState</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œ</font><font style="vertical-align: inherit;">ä»…åœ¨æœ€ç»ˆçŠ¶æ€ç»“æŸä¹‹å</font><font style="vertical-align: inherit;">æ£€æŸ¥</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿”å›</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GameUpdate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { progress += Time.deltaTime * progressFactor; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (progress &gt;= <span class="hljs-number"><span class="hljs-number">1f</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//tileFrom = tileTo; //tileTo = tileTo.NextTileOnPath; if (tileTo == null) { OriginFactory.Reclaim(this); return false; } â€¦ } â€¦ }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éšç€</font></font><code>PrepareNextState</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¼€å§‹è½¬å‘ç“·ç –ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œåœ¨è®¾ç½®ä½ç½®ä¹‹å</font></font><code>From</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä½†åœ¨è®¾ç½®ä½ç½®ä¹‹å‰ï¼Œ</font></font><code>To</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†æ£€æŸ¥å›¾å—æ˜¯å¦ç­‰äº</font></font><code>To</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å€¼</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ˜¯è¿™æ ·ï¼Œåˆ™å‡†å¤‡æœ€ç»ˆçŠ¶æ€å¹¶è·³è¿‡å…¶ä½™æ–¹æ³•ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareNextState</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { tileFrom = tileTo; tileTo = tileTo.NextTileOnPath; positionFrom = positionTo; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tileTo == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { PrepareOutro(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } positionTo = tileFrom.ExitPoint; â€¦ }</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…·æœ‰æ’å®šé€Ÿåº¦å’Œæœ€ç»ˆçŠ¶æ€çš„æ•Œäººã€‚</font></font></i> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ•Œäººå˜å¼‚ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬æœ‰ä¸€è¿ä¸²çš„æ•Œäººï¼Œå®ƒä»¬éƒ½æ˜¯ç›¸åŒçš„ç«‹æ–¹ä½“ï¼Œä»¥ç›¸åŒçš„é€Ÿåº¦ç§»åŠ¨ã€‚</font><font style="vertical-align: inherit;">ç»“æœæ›´åƒæ˜¯ä¸€æ¡é•¿é•¿çš„è›‡ï¼Œè€Œä¸æ˜¯å•ä¸ªæ•Œäººã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬é€šè¿‡éšæœºåŒ–å®ƒä»¬çš„å¤§å°ï¼Œä½ç§»å’Œé€Ÿåº¦æ¥ä½¿å…¶ä¸ä¼—ä¸åŒã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æµ®ç‚¹å€¼èŒƒå›´ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†æ›´æ”¹æ•Œäººçš„å‚æ•°ï¼Œä»å€¼çš„èŒƒå›´å†…éšæœºé€‰æ‹©å…¶ç‰¹å¾ã€‚</font></font><code>FloatRange</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬åœ¨â€œ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹è±¡ç®¡ç†ï¼Œé…ç½®å½¢çŠ¶â€ä¸€</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä¸­åˆ›å»º</font><font style="vertical-align: inherit;">çš„ç»“æ„</font><font style="vertical-align: inherit;">åœ¨</font><font style="vertical-align: inherit;">è¿™é‡Œå¾ˆæœ‰ç”¨</font><font style="vertical-align: inherit;">ï¼Œå› æ­¤è®©æˆ‘ä»¬å¯¹å…¶è¿›è¡Œå¤åˆ¶ã€‚</font><font style="vertical-align: inherit;">å”¯ä¸€çš„å˜åŒ–æ˜¯ä½¿ç”¨ä¸€ä¸ªå‚æ•°æ·»åŠ äº†ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå¹¶ä½¿ç”¨readonly-propertiesæ‰“å¼€äº†å¯¹æœ€å°å€¼å’Œæœ€å¤§å€¼çš„è®¿é—®ï¼Œå› æ­¤é—´éš”æ˜¯ä¸å¯æ›´æ”¹çš„ã€‚</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; [System.Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> FloatRange { [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> min, max; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Min =&gt; min; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Max =&gt; max; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> RandomValueInRange { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Random.Range(min, max); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FloatRange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { min = max = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FloatRange</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> min, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> max</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.min = min; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.max = max &lt; min ? min : max; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬è¿˜å°†å±æ€§é›†å¤åˆ¶åˆ°è¯¥å±æ€§é›†ä»¥é™åˆ¶å…¶é—´éš”ã€‚ </font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FloatRangeSliderAttribute</span></span> : <span class="hljs-title"><span class="hljs-title">PropertyAttribute</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Min { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Max { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FloatRangeSliderAttribute</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> min, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> max</span></span></span><span class="hljs-function">)</span></span> { Min = min; Max = max &lt; min ? min : max; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä»…éœ€è¦æ»‘å—çš„å¯è§†åŒ–ï¼Œå› æ­¤å°†å…¶å¤åˆ¶</font></font><code>FloatRangeSliderDrawer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Editor</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶å¤¹</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEditor; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; [CustomPropertyDrawer(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(FloatRangeSliderAttribute))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FloatRangeSliderDrawer</span></span> : <span class="hljs-title"><span class="hljs-title">PropertyDrawer</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnGUI</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Rect position, SerializedProperty property, GUIContent label </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalIndentLevel = EditorGUI.indentLevel; EditorGUI.BeginProperty(position, label, property); position = EditorGUI.PrefixLabel( position, GUIUtility.GetControlID(FocusType.Passive), label ); EditorGUI.indentLevel = <span class="hljs-number"><span class="hljs-number">0</span></span>; SerializedProperty minProperty = property.FindPropertyRelative(<span class="hljs-string"><span class="hljs-string">"min"</span></span>); SerializedProperty maxProperty = property.FindPropertyRelative(<span class="hljs-string"><span class="hljs-string">"max"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> minValue = minProperty.floatValue; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> maxValue = maxProperty.floatValue; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> fieldWidth = position.width / <span class="hljs-number"><span class="hljs-number">4f</span></span> - <span class="hljs-number"><span class="hljs-number">4f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sliderWidth = position.width / <span class="hljs-number"><span class="hljs-number">2f</span></span>; position.width = fieldWidth; minValue = EditorGUI.FloatField(position, minValue); position.x += fieldWidth + <span class="hljs-number"><span class="hljs-number">4f</span></span>; position.width = sliderWidth; FloatRangeSliderAttribute limit = attribute <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> FloatRangeSliderAttribute; EditorGUI.MinMaxSlider( position, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> minValue, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> maxValue, limit.Min, limit.Max ); position.x += sliderWidth + <span class="hljs-number"><span class="hljs-number">4f</span></span>; position.width = fieldWidth; maxValue = EditorGUI.FloatField(position, maxValue); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (minValue &lt; limit.Min) { minValue = limit.Min; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maxValue &lt; minValue) { maxValue = minValue; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maxValue &gt; limit.Max) { maxValue = limit.Max; } minProperty.floatValue = minValue; maxProperty.floatValue = maxValue; EditorGUI.EndProperty(); EditorGUI.indentLevel = originalIndentLevel; } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ¨¡å‹è§„æ¨¡ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä»æ”¹å˜æ•Œäººçš„è§„æ¨¡å¼€å§‹ã€‚</font></font><code>EnemyFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†æ¯”ä¾‹è®¾ç½®</font><font style="vertical-align: inherit;">æ·»åŠ åˆ°è¯¥</font><font style="vertical-align: inherit;">é€‰é¡¹ã€‚</font><font style="vertical-align: inherit;">æ ‡åº¦é—´éš”ä¸åº”å¤ªå¤§ï¼Œä½†åº”è¶³ä»¥åˆ¶é€ å‡ºå¾®å‹è€Œåºå¤§çš„æ•Œäººã€‚</font><font style="vertical-align: inherit;">åœ¨0.5â€“2ä¹‹é—´ä¸”æ ‡å‡†å€¼ä¸º1çš„ä»»ä½•å€¼ã€‚æˆ‘ä»¬å°†åœ¨æ­¤é—´éš”ä¸­é€‰æ‹©ä¸€ä¸ªéšæœºæ ‡åº¦ï¼Œ</font></font><code>Get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç„¶åé€šè¿‡ä¸€ç§æ–°æ–¹æ³•å°†å…¶ä¼ é€’ç»™æ•Œäºº</font></font><code>Initialize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">SerializeField, FloatRangeSlider(0.5f, 2f)</span></span>] FloatRange scale = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FloatRange(<span class="hljs-number"><span class="hljs-number">1f</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Enemy </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Enemy instance = CreateGameObjectInstance(prefab); instance.OriginFactory = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; instance.Initialize(scale.RandomValueInRange); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¥æ–¹æ³•</font></font><code>Enemy.Initialize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åªæ˜¯å°†å…¶æ¨¡å‹çš„æ¯”ä¾‹å°ºè®¾ç½®ä¸ºåœ¨æ‰€æœ‰ç»´åº¦ä¸Šéƒ½ç›¸åŒã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> scale</span></span></span><span class="hljs-function">)</span></span> { model.localScale = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(scale, scale, scale); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1a7/cc3/f08/1a7cc3f082406d5c8672125ceb94913c.png" width="320" height="60" alt="æ£€æŸ¥å‘˜"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ffe/396/7cf/ffe3967cfcfb6391269a5a7691317c60.png" width="230" height="230" alt="åœºæ™¯"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ»åº¦èŒƒå›´æ˜¯0.5åˆ°1.5ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è·¯å¾„åç§» </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†è¿›ä¸€æ­¥ç ´åæ•ŒäººæµåŠ¨çš„å‡åŒ€æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ”¹æ•Œäººåœ¨åœ°ç –å†…çš„ç›¸å¯¹ä½ç½®ã€‚å®ƒä»¬å‘å‰ç§»åŠ¨ï¼Œå› æ­¤æ²¿è¯¥æ–¹å‘çš„ç§»åŠ¨åªä¼šæ”¹å˜å…¶è¿åŠ¨çš„æ—¶æœºï¼Œè¿™å¹¶ä¸æ˜¯å¾ˆæ˜æ˜¾ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¼šå°†å®ƒä»¬ç§»åˆ°ä¾§é¢ï¼Œè¿œç¦»é€šè¿‡ç“·ç –ä¸­å¿ƒçš„ç†æƒ³è·¯å¾„ã€‚å°†ä¸€ä¸ª</font></font><code>EnemyFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è·¯å¾„åç§»é‡</font><font style="vertical-align: inherit;">æ·»åŠ åˆ°è¯¥</font><font style="vertical-align: inherit;">é—´éš”ï¼Œå¹¶å°†éšæœºåç§»é‡ä¼ é€’ç»™è¯¥æ–¹æ³•</font></font><code>Initialize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚åç§»é‡å¯ä»¥æ˜¯è´Ÿæ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯æ­£æ•°ï¼Œä½†ä¸èƒ½è¶…è¿‡Â½ï¼Œå› ä¸ºè¿™ä¼šå°†æ•Œäººç§»åŠ¨åˆ°ç›¸é‚»çš„å›¾å—ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›æ•Œäººè¶…å‡ºå…¶è·Ÿéšçš„èŒƒå›´ï¼Œå› æ­¤å®é™…ä¸Šé—´éš”ä¼šæ›´çŸ­ï¼Œä¾‹å¦‚0.4ï¼Œä½†æ˜¯çœŸæ­£çš„é™åˆ¶å–å†³äºæ•Œäººçš„å¤§å°ã€‚</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">SerializeField, FloatRangeSlider(-0.4f, 0.4f)</span></span>] FloatRange pathOffset = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FloatRange(<span class="hljs-number"><span class="hljs-number">0f</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Enemy </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Enemy instance = CreateGameObjectInstance(prefab); instance.OriginFactory = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; instance.Initialize( scale.RandomValueInRange, pathOffset.RandomValueInRange ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºè·¯å¾„çš„ä½ç§»ä¼šå½±å“è¡Œè¿›çš„è·¯å¾„ï¼Œ</font></font><code>Enemy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤æœ‰å¿…è¦å¯¹å…¶è¿›è¡Œè·Ÿè¸ªã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pathOffset; â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> scale, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pathOffset</span></span></span><span class="hljs-function">)</span></span> { model.localScale = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(scale, scale, scale); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.pathOffset = pathOffset; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“å®Œå…¨ç¬”ç›´ç§»åŠ¨æ—¶ï¼ˆåœ¨ä»‹ç»æ€§ï¼Œæœ€ç»ˆæ€§æˆ–æ³•å‘å‘å‰ç§»åŠ¨æœŸé—´ï¼‰ï¼Œæˆ‘ä»¬åªéœ€å°†åç§»é‡ç›´æ¥åº”ç”¨äºæ¨¡å‹å³å¯ã€‚</font><font style="vertical-align: inherit;">å›å¤´æ—¶ä¹Ÿä¼šå‘ç”ŸåŒæ ·çš„äº‹æƒ…ã€‚</font><font style="vertical-align: inherit;">é€šè¿‡å³è½¬æˆ–å·¦è½¬ï¼Œæˆ‘ä»¬å·²ç»ç§»åŠ¨äº†æ¨¡å‹ï¼Œè¯¥æ¨¡å‹ç›¸å¯¹äºè·¯å¾„çš„ä½ç§»ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareForward</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { transform.localRotation = direction.GetRotation(); directionAngleTo = direction.GetAngle(); model.localPosition = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(pathOffset, <span class="hljs-number"><span class="hljs-number">0f</span></span>); progressFactor = <span class="hljs-number"><span class="hljs-number">1f</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareTurnRight</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { directionAngleTo = directionAngleFrom + <span class="hljs-number"><span class="hljs-number">90f</span></span>; model.localPosition = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(pathOffset - <span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); transform.localPosition = positionFrom + direction.GetHalfVector(); progressFactor = <span class="hljs-number"><span class="hljs-number">1f</span></span> / (Mathf.PI * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareTurnLeft</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { directionAngleTo = directionAngleFrom - <span class="hljs-number"><span class="hljs-number">90f</span></span>; model.localPosition = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(pathOffset + <span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); transform.localPosition = positionFrom + direction.GetHalfVector(); progressFactor = <span class="hljs-number"><span class="hljs-number">1f</span></span> / (Mathf.PI * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareTurnAround</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { directionAngleTo = directionAngleFrom + <span class="hljs-number"><span class="hljs-number">180f</span></span>; model.localPosition = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(pathOffset, <span class="hljs-number"><span class="hljs-number">0f</span></span>); transform.localPosition = positionFrom; progressFactor = <span class="hljs-number"><span class="hljs-number">2f</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareIntro</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ model.localPosition = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(pathOffset, <span class="hljs-number"><span class="hljs-number">0f</span></span>); transform.localRotation = direction.GetRotation(); progressFactor = <span class="hljs-number"><span class="hljs-number">2f</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareOutro</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ model.localPosition = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(pathOffset, <span class="hljs-number"><span class="hljs-number">0f</span></span>); transform.localRotation = direction.GetRotation(); progressFactor = <span class="hljs-number"><span class="hljs-number">2f</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºæ—‹è½¬è¿‡ç¨‹ä¸­è·¯å¾„çš„ä½ç§»ä¼šæ”¹å˜åŠå¾„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ›´æ”¹è¿›åº¦ä¹˜æ•°çš„è®¡ç®—è¿‡ç¨‹ã€‚</font><font style="vertical-align: inherit;">å¿…é¡»ä»Â½ä¸­å‡å»è·¯å¾„åç§»é‡ï¼Œä»¥ä½¿è½¬å¼¯åŠå¾„å‘å³ï¼Œå¹¶åœ¨å‘å·¦è½¬å¼¯çš„æƒ…å†µä¸‹å¢åŠ ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareTurnRight</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ progressFactor = <span class="hljs-number"><span class="hljs-number">1f</span></span> / (Mathf.PI * <span class="hljs-number"><span class="hljs-number">0.5f</span></span> * (<span class="hljs-number"><span class="hljs-number">0.5f</span></span> - pathOffset)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareTurnLeft</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ progressFactor = <span class="hljs-number"><span class="hljs-number">1f</span></span> / (Mathf.PI * <span class="hljs-number"><span class="hljs-number">0.5f</span></span> * (<span class="hljs-number"><span class="hljs-number">0.5f</span></span> + pathOffset)); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ—‹è½¬180Â°æ—¶ï¼Œæˆ‘ä»¬è¿˜è·å¾—äº†æ—‹è½¬åŠå¾„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç”¨åŠå¾„ç­‰äºè·¯å¾„åç§»çš„åŠå¾„è¦†ç›–äº†ä¸€åŠçš„åœ†ï¼Œå› æ­¤è·ç¦»æ˜¯åç§»çš„Ï€å€ã€‚ä½†æ˜¯ï¼Œå½“ä½ç§»ä¸ºé›¶æ—¶ï¼Œè¿™æ˜¯è¡Œä¸é€šçš„ï¼›åœ¨å°â€‹â€‹ä½ç§»ä¸‹ï¼Œè½¬å¼¯è¿‡å¿«ã€‚ä¸ºäº†é¿å…ç¬æ—¶è½¬å¼¯ï¼Œæˆ‘ä»¬å¯ä»¥å¼ºåˆ¶æœ€å°åŠå¾„æ¥è®¡ç®—é€Ÿåº¦ï¼Œä¾‹å¦‚0.2ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareTurnAround</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { directionAngleTo = directionAngleFrom + (pathOffset &lt; <span class="hljs-number"><span class="hljs-number">0f</span></span> ? <span class="hljs-number"><span class="hljs-number">180f</span></span> : <span class="hljs-number"><span class="hljs-number">-180f</span></span>); model.localPosition = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(pathOffset, <span class="hljs-number"><span class="hljs-number">0f</span></span>); transform.localPosition = positionFrom; progressFactor = <span class="hljs-number"><span class="hljs-number">1f</span></span> / (Mathf.PI * Mathf.Max(Mathf.Abs(pathOffset), <span class="hljs-number"><span class="hljs-number">0.2f</span></span>)); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1db/8b2/b16/1db8b2b164cba05ff6f8fe7ffa0eed71.png" width="320" height="40" alt="æ£€æŸ¥å‘˜"></div><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è·¯å¾„åç§»é‡åœ¨-0.25â€“0.25èŒƒå›´å†…ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯·æ³¨æ„ï¼Œç°åœ¨æ•Œäººå³ä½¿è½¬å¼¯ä¹Ÿä¸ä¼šæ”¹å˜å…¶ç›¸å¯¹è·¯å¾„ä½ç§»ã€‚å› æ­¤ï¼Œæ¯ä¸ªæ•Œäººçš„æ€»è·¯å¾„é•¿åº¦å„æœ‰ä¸åŒã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†é˜²æ­¢æ•Œäººåˆ°è¾¾é™„è¿‘çš„ç –å—ï¼Œè¿˜å¿…é¡»è€ƒè™‘å…¶æœ€å¤§å¯èƒ½çš„è§„æ¨¡ã€‚æˆ‘åªæ˜¯å°†å¤§å°é™åˆ¶ä¸ºæœ€å¤§å€¼1ï¼Œå› æ­¤å¤šç»´æ•°æ®é›†çš„æœ€å¤§å…è®¸åç§»ä¸º0.25ã€‚å¦‚æœæœ€å¤§å°ºå¯¸ä¸º1.5ï¼Œåˆ™æœ€å¤§ä½ç§»åº”å‡å°åˆ°0.125ã€‚</font></font><br><br><h3> é€Ÿåº¦ </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬éšæœºåŒ–çš„æœ€åä¸€ä»¶äº‹æ˜¯æ•Œäººçš„é€Ÿåº¦ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸ºå…¶æ·»åŠ ä¸€ä¸ªé—´éš”ï¼Œ</font></font><code>EnemyFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶å°†ä»·å€¼è½¬ç§»åˆ°åˆ›å»ºçš„æ•Œäººå‰¯æœ¬ä¸­ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å°†å…¶ä½œä¸ºmethodçš„ç¬¬äºŒä¸ªå‚æ•°</font></font><code>Initialize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æ•Œäººä¸è¦å¤ªæ…¢æˆ–å¤ªå¿«ï¼Œä»¥å…æ¸¸æˆå˜å¾—ç®€å•æˆ–ä¸å¯èƒ½ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å°†é—´éš”é™åˆ¶ä¸º0.2-5ã€‚</font><font style="vertical-align: inherit;">é€Ÿåº¦ä»¥æ¯ç§’å•ä½è¡¨ç¤ºï¼Œä»…åœ¨å‘å‰ç§»åŠ¨æ—¶æ‰å¯¹åº”äºæ¯ç§’ç“¦ç‰‡ã€‚</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">SerializeField, FloatRangeSlider(0.2f, 5f)</span></span>] FloatRange speed = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FloatRange(<span class="hljs-number"><span class="hljs-number">1f</span></span>); [SerializeField, FloatRangeSlider(<span class="hljs-number"><span class="hljs-number">-0.4f</span></span>, <span class="hljs-number"><span class="hljs-number">0.4f</span></span>)] FloatRange pathOffset = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FloatRange(<span class="hljs-number"><span class="hljs-number">0f</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Enemy </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Enemy instance = CreateGameObjectInstance(prefab); instance.OriginFactory = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; instance.Initialize( scale.RandomValueInRange, speed.RandomValueInRange, pathOffset.RandomValueInRange ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘</font></font><code>Enemy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¿…é¡»è·Ÿè¸ªå’ŒåŠ å¿«é€Ÿåº¦ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speed; â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> scale, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> speed, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pathOffset</span></span></span><span class="hljs-function">)</span></span> { model.localScale = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(scale, scale, scale); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.speed = speed; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.pathOffset = pathOffset; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å½“æˆ‘ä»¬æ²¡æœ‰æ˜ç¡®è®¾ç½®é€Ÿåº¦æ—¶ï¼Œæˆ‘ä»¬ä»…ä½¿ç”¨å€¼1ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ›å»ºè¿›åº¦ä¹˜æ•°å¯¹é€Ÿåº¦çš„ä¾èµ–å…³ç³»å³å¯ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareForward</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ progressFactor = speed; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareTurnRight</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ progressFactor = speed / (Mathf.PI * <span class="hljs-number"><span class="hljs-number">0.5f</span></span> * (<span class="hljs-number"><span class="hljs-number">0.5f</span></span> - pathOffset)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareTurnLeft</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ progressFactor = speed / (Mathf.PI * <span class="hljs-number"><span class="hljs-number">0.5f</span></span> * (<span class="hljs-number"><span class="hljs-number">0.5f</span></span> + pathOffset)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareTurnAround</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ progressFactor = speed / (Mathf.PI * Mathf.Max(Mathf.Abs(pathOffset), <span class="hljs-number"><span class="hljs-number">0.2f</span></span>)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareIntro</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ progressFactor = <span class="hljs-number"><span class="hljs-number">2f</span></span> * speed; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareOutro</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ progressFactor = <span class="hljs-number"><span class="hljs-number">2f</span></span> * speed; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0b8/e55/eeb/0b8e55eeb25d36349f606f0da60d3720.png" width="320" height="60"></div><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€Ÿåº¦èŒƒå›´ä¸º0.75-1.25ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬æœ‰è®¸å¤šæ•Œäººæµå‘ç»ˆç‚¹ã€‚</font><font style="vertical-align: inherit;">åœ¨ä¸‹ä¸€ä¸ªæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•å¤„ç†å®ƒä»¬ã€‚</font><font style="vertical-align: inherit;">æ˜¯å¦æƒ³çŸ¥é“ä½•æ—¶å‘å¸ƒï¼Ÿ</font><font style="vertical-align: inherit;">æŒ‰ç…§æˆ‘åœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patreon</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸Šçš„</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">é¡µé¢</font></a><font style="vertical-align: inherit;">ï¼</font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èµ„æ–™åº“</font></font></a> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PDFæ–‡ç« </font></font></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN452756/">https://habr.com/ru/post/zh-CN452756/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN452746/index.html">ã€Š R.æ²‰æµ¸åœ¨å¤§æ•°æ®ä¸­çš„ç¼–ç¨‹è‰ºæœ¯ã€‹ä¸€ä¹¦</a></li>
<li><a href="../zh-CN452748/index.html">NGINXå¼€å‘ç°ä»£åº”ç”¨ç¨‹åºçš„åŸç†ã€‚ ç¬¬ä¸€éƒ¨åˆ†</a></li>
<li><a href="../zh-CN452750/index.html">OpenLiteSpeedå†…éƒ¨å’Œå¤–éƒ¨çš„Nextcloudï¼šé…ç½®åå‘ä»£ç†</a></li>
<li><a href="../zh-CN452752/index.html">è‡ªåˆ¶BigDataã€‚ ç¬¬1éƒ¨åˆ†ã€‚AWSé›†ç¾¤ä¸Šçš„Sparkæµå®è·µ</a></li>
<li><a href="../zh-CN452754/index.html">19ï¼…çš„æœ€å—æ¬¢è¿çš„Dockeræ˜ åƒæ²¡æœ‰rootå¯†ç </a></li>
<li><a href="../zh-CN452760/index.html">ç»´ç”Ÿç´ Dã€‚å–è¿˜æ˜¯ä¸å–ï¼Œè¿™å°±æ˜¯é—®é¢˜æ‰€åœ¨ã€‚ ï¼ˆæˆ–å…³äºæˆ‘å¦‚ä½•é€šè¿‡äº†æœªæŒ‰è§„å®šè¿›è¡Œåˆ†æçš„æ•…äº‹ï¼‰</a></li>
<li><a href="../zh-CN452762/index.html">MVCC-7ã€‚ è‡ªåŠ¨æ¸…æ´</a></li>
<li><a href="../zh-CN452764/index.html">[Peter]ä¸Sergei Melnikovä¼šé¢JUG.ru-è¶…å…‰é€Ÿåˆ†æï¼šç†è®ºä¸å®è·µ</a></li>
<li><a href="../zh-CN452766/index.html">æ¸è¿›å¼æµæŠ€æœ¯ï¼Œæˆ–å¦‚ä½•é€šè¿‡ç½‘ç»œè§‚çœ‹4kè§†é¢‘è€Œä¸ä¼šæ„Ÿåˆ°çƒ¦æ¼</a></li>
<li><a href="../zh-CN452768/index.html">å¦‚æœæ‚¨å†³å®šè¿›å…¥å›½å¤–å¸‚åœºï¼Œå¦‚ä½•è®¾è®¡äº§å“</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>