<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💟 👩🏼‍🍳 🧕🏿 Neue KUBA-Karten 🤥 👈🏻 🤟🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Das Arbeiten mit Geodaten und Karten ist ein wesentlicher Bestandteil vieler Geschäftsanwendungen. Dies können städtische und regionale Informationssy...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Neue KUBA-Karten</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/464517/"><p><img src="https://habrastorage.org/getpro/habr/post_images/2b4/8ca/a70/2b48caa7053d14a2edd9cfaecc6b6fb8.png" alt="Karten"></p><br><p>  Das Arbeiten mit Geodaten und Karten ist ein wesentlicher Bestandteil vieler Geschäftsanwendungen.  Dies können städtische und regionale Informationssysteme, Anwendungen für die Öl- und Gasindustrie, Verkehrsinfrastruktur-Managementsysteme sowie Lieferservices und viele andere sein.  In unserer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CUBA-Plattform gibt es</a> zum Erstellen solcher Anwendungen zusätzlich zu den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">sofort einsatzbereiten</a> Grundfunktionen eine Reihe umfangreicher <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Add-Ons und Komponenten</a> .  Eines davon sind Diagramme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">und Karten</a> , mit denen Sie neben der Anzeige von Diagrammen auch Google Maps in den visuellen Teil der Anwendung integrieren können.  Im vergangenen Jahr hat Google die Nutzungsbedingungen seiner Kartendienste aktualisiert, was zu einem Anstieg der Kosten geführt hat, und die Bedingung für das obligatorische Vorhandensein eines Zahlungsprofils für die Verwendung der API eingeführt.  Diese Umstände veranlassten die meisten unserer Kunden, über alternative Kartenanbieter nachzudenken, und wir wurden aufgefordert, eine neue Kartenkomponente zu entwickeln. </p><a name="habracut"></a><br><p>  Jetzt freuen wir uns, Ihnen eine völlig neue Komponente vorstellen zu können - <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CUBA Maps</a></strong> .  CUBA Maps ergänzt die Anwendungsfunktionalität durch eine visuelle Darstellung und intuitive Tools zum Bearbeiten von Geodaten.  Die Komponente arbeitet sowohl mit Raster- als auch mit Vektordaten.  Sie können jeden Kartenanbieter verwenden, der mit dem Web Map Service-Protokoll kompatibel ist, oder Kacheln im XYZ-Format als Rasterdaten bereitstellen.  Für die Arbeit mit Vektordaten verwendet die Komponente geometrische Datentypen (Punkt, Polylinie, Polygon) aus der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">JTS Topology Suite (JTS)</a> -Bibliothek - der beliebtesten Java-Bibliothek für die Arbeit mit Geodaten.  Die Komponente bietet alle erforderlichen Tools zum Erstellen eines umfassenden geografischen Informationssystems auf der Basis von CUBA. </p><br><p>  In diesem Artikel werden wir über neue Funktionen der Kartenkomponente sprechen und diese auch mit unserer vorherigen Kartenkomponente vergleichen. </p><br><h2 id="struktura-osnovannaya-na-sloyah">  Schichtbasierte Struktur </h2><br><p>  Die Komponente unterstützt die traditionelle Mehrschichtstruktur, die in professionellen geografischen Informationssystemen weit verbreitet ist.  Ebenen werden hauptsächlich in Raster und Vektor unterteilt.  <em>Rasterebenen</em> bestehen aus Rasterbildern, während <em>Vektorebenen Vektorgeometrien</em> enthalten. </p><br><p>  Die Komponente unterstützt die folgenden Arten von Ebenen: </p><br><ul><li>  <em>Kachelebene</em> zeigt die von den Kacheldiensten bereitgestellten Kacheln im XYZ-Format an. </li><li>  <em>Auf der Ebene</em> des <em>Web Map Service (WMS)</em> werden die von den WMS-Diensten bereitgestellten Bilder angezeigt. </li><li>  <em>Die Vektorebene</em> enthält Geoobjekte (Objekte mit geometrischen Attributen). </li></ul><br><p>  Diese Ebenen sind Strukturelemente von Karten.  Beispielsweise kann die untere Schicht eine Basiskarte sein, die aus Kacheln besteht, die zweite Schicht kann Polygone enthalten, die Gebietseinheiten beschreiben, beispielsweise Regionen, und die obere Schicht kann geografische Punkte enthalten (Standort von Kunden, Geschäften usw.).  Wenn wir diese Ebenen übereinander legen, erhalten wir die endgültige Karte: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b16/3b2/5f7/b163b25f702af4f76363340b899139b4.png" alt="Schichten"></p><br><p>  Dank dieses Ansatzes können Sie klar strukturierte Karten mit beliebigen Inhalten erstellen. </p><br><p> CUBA Maps bietet eine neue visuelle Komponente - <code>GeoMap</code> .  Im XML-Deskriptor der Komponente können Sie die grundlegenden Parameter der Karte sowie eine Reihe angezeigter Layer festlegen.  Ein Beispiel für eine solche Konfiguration: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"600px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">center</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"37.615, 55.752"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">zoom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">selectedLayer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:tile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tiles"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tileProvider</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"maps_OpenStreetMap"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"territoryLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"territoryDc"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressDc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">editable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Mit diesem Ansatz können Sie mehr Flexibilität erreichen, die in <strong>Diagrammen und Karten</strong> fehlte: </p><br><ul><li>  <em>Schichtung.</em>  Mit dieser Struktur können Sie Karten mit beliebigen Inhalten erstellen, z. B. Kacheln kombinieren, die von verschiedenen Diensten bereitgestellt werden. </li><li>  <em>Ebenen bieten eine Abstraktion, die homogene Objekte zusammenbringt.</em>  In der Komponente " <strong>Diagramme und Karten"</strong> wurden alle Karteninhalte (z. B. Punkte, Polygone usw.) in einem gemeinsamen Heap in der UI-Komponente gespeichert.  Um diese Objekte irgendwie zu strukturieren, mussten die Projektteams zusätzliche Logik schreiben. </li><li>  <em>Eine deklarative Methode zur Beschreibung von Ebenen.</em>  Wie im obigen Beispiel gezeigt, können Sie die Kartenstruktur (Satz von Layern) im XML-Deskriptor vollständig angeben.  In vielen Fällen reicht dies aus, um keine zusätzliche Logik in der Bildschirmsteuerung zu implementieren.  Mit <strong>Diagrammen und Karten war</strong> es fast unmöglich, auf das Schreiben zusätzlicher Logik zu verzichten. </li></ul><br><p>  Durch die Verwendung von Kachelebenen oder WMS können Sie mit jedem bevorzugten Kartenanbieter arbeiten.  Sie sind nicht an einen bestimmten Anbieter gebunden, wie dies in <strong>Diagrammen und Karten der Fall war</strong> . </p><br><p>  Vektorebenen vereinfachen die Anzeige, interaktive Bearbeitung und Zeichnung von Geoobjekten auf der Karte erheblich. </p><br><p>  Es ist auch erwähnenswert, dass die visuelle Komponente von <code>GeoMap</code> standardmäßig eine spezielle Hilfsebene hat - <strong>Canvas</strong> .  Canvas bietet eine praktische API zum Anzeigen und Zeichnen von Geometrien (Punkte, Polylinien, Polygone) auf einer Karte.  Wir werden später in diesem Artikel Beispiele für die Verwendung von Canvas behandeln. </p><br><h2 id="geo-obekty">  Geo-Objekte </h2><br><p>  Angenommen, wir haben eine Entität, die ein der Geometrie zugeordnetes Attribut enthält (Punkt, Polylinie, Polygon).  Wir werden diese Entität ein <em>Geoobjekt</em> nennen.  Die Komponente vereinfacht die Arbeit mit Geoobjekten erheblich. </p><br><p>  Betrachten Sie beispielsweise das Geoobjekt <strong>Adresse</strong> : </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StandardEntity</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"LOCATION"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Geometry</span></span> <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(datatype = <span class="hljs-string"><span class="hljs-string">"GeoPoint"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Convert</span></span>(converter = CubaPointWKTConverter.class) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Point location; ... }</code> </pre> <br><p>  Es verfügt über ein <code>location</code> vom Typ <code>org.locationtech.jts.geom.Point</code> aus der JTS Topology Suite (JTS) -Bibliothek.  Die Komponente unterstützt die folgenden geometrischen Typen von JTS: </p><br><ul><li>  <code>org.locationtech.jts.geom.Point</code> - Zeitraum. </li><li>  <code>org.locationtech.jts.geom.LineString</code> - Polylinie. </li><li>  <code>org.locationtech.jts.geom.Polygon</code> - Polygon. </li></ul><br><p>  Das <code>location</code> ist mit der Annotation <code>@Geometry</code> .  Diese Anmerkung gibt an, dass der Wert dieses Attributs verwendet werden soll, wenn ein Geoobjekt auf der Karte angezeigt wird.  Das Attribut ist außerdem mit den folgenden Anmerkungen gekennzeichnet: </p><br><ul><li>  <code>@MetaProperty</code> - wird in diesem Fall verwendet, um das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Datentypattribut</a> anzugeben.  Die <code>Datatype</code> vom CUBA-Framework verwendet, um Werte in und aus einer Zeichenfolge zu konvertieren. </li><li>  <code>@Convert</code> - Definiert einen JPA-Konverter für ein dauerhaftes Attribut.  Der JPA-Konverter konvertiert Attributwerte zwischen seinen Darstellungen in der Datenbank und Java-Code.  Die Komponente bietet eine Reihe von räumlichen Datentypen und JPA-Konvertern.  Weitere Informationen finden Sie in der Komponentendokumentation.  Sie können auch eine eigene Implementierung des JPA-Konverters verwenden, mit der Sie mit verschiedenen Geodatenquellen (z. B. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PostGIS</a> ) arbeiten können. </li></ul><br><p>  Um eine Entität in ein Geoobjekt zu verwandeln, müssen Sie ein Attribut des JTS-Geometrietyps definieren und mit <code>@Geometry</code> .  Es gibt noch eine andere Option: Erstellen Sie ein nicht persistentes Attribut, indem Sie Getter / Setter-Methoden bereitstellen.  Dies kann nützlich sein, wenn Sie keine Änderungen am Datenmodell vornehmen und DDL-Skripte neu generieren möchten. </p><br><p>  Betrachten Sie beispielsweise die Entitätsadresse mit separaten Attributen für Längen- und Breitengrad: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.haulmont.addon.maps.gis.utils.GeometryUtils; ... <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StandardEntity</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"LATITUDE"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Double latitude; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"LONGITUDE"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Double longitude; ... <span class="hljs-meta"><span class="hljs-meta">@Geometry</span></span> <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(datatype = <span class="hljs-string"><span class="hljs-string">"GeoPoint"</span></span>, related = {<span class="hljs-string"><span class="hljs-string">"latitude"</span></span>, <span class="hljs-string"><span class="hljs-string">"longitude"</span></span>}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Point </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getLatitude() == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || getLongitude() == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GeometryUtils.createPoint(getLongitude(), getLatitude()); } <span class="hljs-meta"><span class="hljs-meta">@Geometry</span></span> <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(datatype = <span class="hljs-string"><span class="hljs-string">"GeoPoint"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Point point)</span></span></span><span class="hljs-function"> </span></span>{ Point prevValue = getLocation(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (point == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { setLatitude(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); setLongitude(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { setLatitude(point.getY()); setLongitude(point.getX()); } propertyChanged(<span class="hljs-string"><span class="hljs-string">"location"</span></span>, prevValue, point); } ... }</code> </pre> <br><p>  Wenn Sie sich für diesen Ansatz entscheiden, stellen Sie sicher, dass die <code>propertyChanged</code> Methode im Setter aufgerufen wird, da die Komponente auf dieses Ereignis reagiert, indem sie die Geometrie auf der Karte aktualisiert. </p><br><p>  Nachdem wir die Klasse unseres Geoobjekts vorbereitet haben, können wir der Vektorebene Instanzen dieser Klasse hinzufügen.  <em>Eine Vektorebene</em> ist im Wesentlichen ein Verbindungselement zwischen Daten (Geoobjekten) und einer Karte.  Um Geoobjekte mit einer Ebene zu verbinden, müssen Sie den Datencontainer oder bei veralteten Bildschirmen (bis Version 7 von CUBA) die Datenquelle auf die Vektorebene übertragen.  Dies kann in einem XML-Deskriptor erfolgen: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressesLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressesDc"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Infolgedessen werden die im <code>Address</code> Container enthaltenen Adressklasseninstanzen auf der Karte angezeigt. </p><br><p>  Betrachten wir eine elementare Aufgabe: Erstellen eines Bildschirms zum Bearbeiten eines Geoobjekts mit einer Karte, auf dem Sie die Geometrie des Objekts bearbeiten können.  Um das Problem zu lösen, müssen Sie die visuelle Komponente von <code>GeoMap</code> im XML-Deskriptor des Bearbeitungsbildschirms deklarieren und eine Vektorebene hinzufügen, die dem Container zugeordnet ist, der das bearbeitete Geoobjekt enthält: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"600px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">center</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"37.615, 55.752"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">zoom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">selectedLayer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:tile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span><span class="hljs-tag">"/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressDc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">editable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Wenn Sie die Vektorebene als bearbeitbar markieren, wird die interaktive Bearbeitung des Geoobjekts auf der Karte aktiviert.  Wenn die Geometrie des Objekts leer ist, wechselt die Karte automatisch in den Zeichenmodus.  Wie Sie sehen, reicht es zur Lösung des Problems aus, eine Vektorebene auf der Karte zu deklarieren und sie an den Datencontainer / die Datenquelle zu übergeben. </p><br><p>  Das ist alles.  Wenn wir <strong>Diagramme und Karten verwenden würden</strong> , um dasselbe Problem zu lösen, müssten wir ziemlich viel Code in den Bildschirmcontroller schreiben, um ähnliche Funktionen bereitzustellen.  Mit der neuen Komponente von <strong>Maps ist das</strong> Lösen solcher Probleme viel einfacher. </p><br><h2 id="canvas">  Leinwand </h2><br><p>  Es gibt Zeiten, in denen Sie nicht mit Entitäten arbeiten müssen.  Stattdessen möchten Sie, dass eine einfache API Geometrien zu einer Karte hinzufügt und zeichnet, wie dies in <strong>Diagrammen und Karten der</strong> Fall war.  Zu diesem <code>GeoMap</code> visuelle Komponente <code>GeoMap</code> über eine spezielle Ebene - <em>Canvas</em> .  Dies ist eine Hilfsebene, die sich standardmäßig auf der Karte befindet und eine einfache API zum Hinzufügen und Zeichnen von Geometrien auf der Karte bietet.  Sie können <code>map.getCanvas()</code> Map erhalten, indem Sie die <code>map.getCanvas()</code> -Methode aufrufen. </p><br><p>  Als nächstes werden wir uns einige einfache Aufgaben ansehen, wie sie in <strong>Diagrammen und Karten</strong> gelöst wurden und wie Sie dasselbe mit Canvas tun können. </p><br><h3 id="otobrazhenie-geometriy-na-karte">  Geometrien auf einer Karte anzeigen </h3><br><p>  In <strong>Diagrammen und Karten wurden</strong> Geometrieobjekte mithilfe der visuellen Komponente der Karte erstellt, als Factory verwendet und dann zur Karte hinzugefügt: </p><br><pre> <code class="java hljs">Marker marker = map.createMarker(); GeoPoint position = map.createGeoPoint(lat, lon); marker.setPosition(position); map.addMarker(marker);</code> </pre> <br><p>  Die neue <strong>Maps-</strong> Komponente arbeitet direkt mit Klassen aus der JTS-Bibliothek: </p><br><pre> <code class="java hljs">CanvasLayer canvasLayer = map.getCanvas(); Point point = address.getLocation(); canvasLayer.addPoint(point);</code> </pre> <br><h3 id="redaktirovanie-geometriy">  Geometrie bearbeiten </h3><br><p>  In <strong>Diagrammen und Karten können</strong> Sie Geometrie als bearbeitbar festlegen.  Wenn solche Geometrien über die Benutzeroberfläche geändert wurden, wurden die entsprechenden Ereignisse aufgerufen: </p><br><pre> <code class="java hljs">Marker marker = map.createMarker(); GeoPoint position = map.createGeoPoint(lat, lon); marker.setPosition(position); marker.setDraggable(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); map.addMarker(marker); map.addMarkerDragListener(event -&gt; { <span class="hljs-comment"><span class="hljs-comment">// do something });</span></span></code> </pre> <br><p>  In der <strong>Maps-</strong> Komponente gibt die entsprechende Methode beim Hinzufügen von JTS-Geometrie zu Canvas ein spezielles Objekt zurück, das diese Geometrie auf der Karte darstellt: <code>CanvasLayer.Point</code> , <code>CanvasLayer.Polyline</code> oder <code>CanvasLayer.Polygon</code> .  Dieses Objekt verfügt über eine fließende Oberfläche zum Festlegen verschiedener Geometrieparameter. Es kann auch zum Abonnieren von Ereignissen im Zusammenhang mit Geometrie oder zum Löschen von Geometrie aus einem Canvas verwendet werden. </p><br><pre> <code class="java hljs">CanvasLayer canvasLayer = map.getCanvas(); CanvasLayer.Point location = canvasLayer.addPoint(address.getLocation()); location.setEditable(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) .setPopupContent(address.getName()) .addModifiedListener(modifiedEvent -&gt; address.setLocation(modifiedEvent.getGeometry()));</code> </pre> <br><h3 id="risovanie-geometriy">  Geometriezeichnung </h3><br><p>  In den alten Add-On- <code>DrawingOptions</code> <strong>und Karten</strong> gab es eine Hilfskomponente - <code>DrawingOptions</code> .  Es wurde verwendet, um die Fähigkeit zum Zeichnen auf der Karte zu aktivieren.  Nachdem die Geometrie gezeichnet wurde, wurde das entsprechende Ereignis ausgelöst: </p><br><pre> <code class="java hljs">DrawingOptions options = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DrawingOptions(); PolygonOptions polygonOptions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PolygonOptions(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">"#993366"</span></span>, <span class="hljs-number"><span class="hljs-number">0.6</span></span>); ControlOptions controlOptions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ControlOptions( Position.TOP_CENTER, Arrays.asList(OverlayType.POLYGON)); options.setEnableDrawingControl(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); options.setPolygonOptions(polygonOptions); options.setDrawingControlOptions(controlOptions); options.setInitialDrawingMode(OverlayType.POLYGON); map.setDrawingOptions(options); map.addPolygonCompleteListener(event -&gt; { <span class="hljs-comment"><span class="hljs-comment">//do something });</span></span></code> </pre> <br><p>  Die Maps-Komponente erleichtert dies erheblich.  Der neue Kartenbereich enthält eine Reihe von Methoden zum Zeichnen von Geometrien.  Verwenden <code>canvas.drawPolygon()</code> zum Zeichnen eines Polygons beispielsweise die Methode <code>canvas.drawPolygon()</code> .  Nach dem Aufrufen dieser Methode wechselt die Karte in den Polygonzeichnungsmodus.  Die Methode akzeptiert die <code>Consumer&lt;CanvasLayer.Polygon&gt;</code> -Funktion, mit der Sie zusätzliche Aktionen mit dem gezeichneten Polygon ausführen können. </p><br><pre> <code class="java hljs">canvasLayer.drawPolygon(polygon -&gt; { territory.setPolygon(polygon.getGeometry()); });</code> </pre> <br><h2 id="instrumenty-dlya-geo-analiza">  Geoanalyse-Tools </h2><br><h3 id="klasterizaciya">  Clustering </h3><br><p>  Ein weiteres nützliches Tool in der neuen Maps-Komponente ist das Punktclustering.  Wenn die Ebene aus einer großen Anzahl von Punkten besteht, können Sie das Clustering aktivieren, um nahegelegene Punkte in Cluster zu gruppieren, damit die Karte übersichtlicher und besser wahrgenommen wird: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e6c/166/4d7/e6c1664d7e9092880dfcf13cc4dca58c.jpg" alt="Cluster"></p><br><p>  Das Clustering wird aktiviert, indem das <code>cluster</code> Tag innerhalb des <code>vector</code> Tags im XML-Deskriptor hinzugefügt wird: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"locations"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"locationsDc"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:cluster</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Sie können das Clustering auch basierend auf Punktgewichten aktivieren.  Das Gewicht des Punkts ist der Wert des Attributs, das im Parameter <code>weightProperty</code> angegeben ist. </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"orders"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ordersDc"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:cluster</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">weightProperty</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"amount"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3 id="teplovye-karty">  Heatmaps </h3><br><p>  Heatmaps sind eine visuelle Darstellung der Datendichte an mehreren geografischen Standorten.  Die visuelle Komponente von GeoMap enthält eine Methode zum Hinzufügen einer Heatmap: <code>addHeatMap(Map&lt;Point, Double&gt; intensityMap)</code> . </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/722/10b/289/72210b289dd04fcf41cc4ebec062c2d5.jpg" alt="Heatmap"></p><br><h2 id="zaklyuchenie">  Fazit </h2><br><p>  Die Verarbeitung, Analyse und Visualisierung von Geodaten ist ein wesentliches Element vieler Geschäftsanwendungen.  Die <strong>CUBA Maps-</strong> Komponente stellt Ihrer CUBA-Anwendung alle erforderlichen Tools zur Implementierung dieser Funktionalität zur Verfügung. </p><br><p>  Eine schichtenbasierte Struktur hilft beim Erstellen von Karten mit beliebigen Inhalten.  Mit Kachel- / WMS-Ebenen können Sie jeden Anbieter verwenden, den Sie als Basiskarte benötigen.  Mit Vektorebenen können Sie effektiv mit Gruppen homogener Geoobjekte arbeiten.  Canvas bietet eine einfache API zum Anzeigen und Zeichnen von Geometrien auf einer Karte. </p><br><p>  Die Komponente arbeitet mit räumlichen Typen aus der JTS-Bibliothek, wodurch sie mit vielen anderen Frameworks (z. B. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GeoTools</a> ) kompatibel ist, um eine Vielzahl von Aufgaben im Zusammenhang mit der Verarbeitung und Analyse geografischer Daten zu lösen. </p><br><p>  Wir hoffen, Ihnen gefällt die Komponente.  Warten auf Ihr Feedback! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de464517/">https://habr.com/ru/post/de464517/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de464503/index.html">Wi-Fi Passwort passend zu aircrack-ng</a></li>
<li><a href="../de464509/index.html">Das Buch "Grok Deep Learning"</a></li>
<li><a href="../de464511/index.html">So sammeln Sie Benutzerkohorten in Form von Grafiken in Grafana [+ Docker-Bild mit einem Beispiel]</a></li>
<li><a href="../de464513/index.html">Duffle: Transformator von XD Design</a></li>
<li><a href="../de464515/index.html">Wie man E-Mails erstellt und nicht durcheinander bringt: Praktische Tipps</a></li>
<li><a href="../de464523/index.html">Zahlungssysteme (PSP) für das IT-Geschäft: Wir spielen groß</a></li>
<li><a href="../de464525/index.html">Ihr eigener JSON-Konverter oder etwas mehr über ExpressionTrees</a></li>
<li><a href="../de464529/index.html">Für kontextbezogene Werbung mit den Namen von Wettbewerbern können jetzt 500.000 Rubel bestraft werden</a></li>
<li><a href="../de464535/index.html">Details zum Gerät und zu den Funktionen des KickScooter T60 Elektrorollers</a></li>
<li><a href="../de464537/index.html">Arduino DIY Dämonisches Karussell</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>