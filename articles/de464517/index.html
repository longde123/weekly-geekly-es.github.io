<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíü üë©üèº‚Äçüç≥ üßïüèø Neue KUBA-Karten ü§• üëàüèª ü§üüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Das Arbeiten mit Geodaten und Karten ist ein wesentlicher Bestandteil vieler Gesch√§ftsanwendungen. Dies k√∂nnen st√§dtische und regionale Informationssy...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Neue KUBA-Karten</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/464517/"><p><img src="https://habrastorage.org/getpro/habr/post_images/2b4/8ca/a70/2b48caa7053d14a2edd9cfaecc6b6fb8.png" alt="Karten"></p><br><p>  Das Arbeiten mit Geodaten und Karten ist ein wesentlicher Bestandteil vieler Gesch√§ftsanwendungen.  Dies k√∂nnen st√§dtische und regionale Informationssysteme, Anwendungen f√ºr die √ñl- und Gasindustrie, Verkehrsinfrastruktur-Managementsysteme sowie Lieferservices und viele andere sein.  In unserer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CUBA-Plattform gibt es</a> zum Erstellen solcher Anwendungen zus√§tzlich zu den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">sofort einsatzbereiten</a> Grundfunktionen eine Reihe umfangreicher <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Add-Ons und Komponenten</a> .  Eines davon sind Diagramme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">und Karten</a> , mit denen Sie neben der Anzeige von Diagrammen auch Google Maps in den visuellen Teil der Anwendung integrieren k√∂nnen.  Im vergangenen Jahr hat Google die Nutzungsbedingungen seiner Kartendienste aktualisiert, was zu einem Anstieg der Kosten gef√ºhrt hat, und die Bedingung f√ºr das obligatorische Vorhandensein eines Zahlungsprofils f√ºr die Verwendung der API eingef√ºhrt.  Diese Umst√§nde veranlassten die meisten unserer Kunden, √ºber alternative Kartenanbieter nachzudenken, und wir wurden aufgefordert, eine neue Kartenkomponente zu entwickeln. </p><a name="habracut"></a><br><p>  Jetzt freuen wir uns, Ihnen eine v√∂llig neue Komponente vorstellen zu k√∂nnen - <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CUBA Maps</a></strong> .  CUBA Maps erg√§nzt die Anwendungsfunktionalit√§t durch eine visuelle Darstellung und intuitive Tools zum Bearbeiten von Geodaten.  Die Komponente arbeitet sowohl mit Raster- als auch mit Vektordaten.  Sie k√∂nnen jeden Kartenanbieter verwenden, der mit dem Web Map Service-Protokoll kompatibel ist, oder Kacheln im XYZ-Format als Rasterdaten bereitstellen.  F√ºr die Arbeit mit Vektordaten verwendet die Komponente geometrische Datentypen (Punkt, Polylinie, Polygon) aus der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">JTS Topology Suite (JTS)</a> -Bibliothek - der beliebtesten Java-Bibliothek f√ºr die Arbeit mit Geodaten.  Die Komponente bietet alle erforderlichen Tools zum Erstellen eines umfassenden geografischen Informationssystems auf der Basis von CUBA. </p><br><p>  In diesem Artikel werden wir √ºber neue Funktionen der Kartenkomponente sprechen und diese auch mit unserer vorherigen Kartenkomponente vergleichen. </p><br><h2 id="struktura-osnovannaya-na-sloyah">  Schichtbasierte Struktur </h2><br><p>  Die Komponente unterst√ºtzt die traditionelle Mehrschichtstruktur, die in professionellen geografischen Informationssystemen weit verbreitet ist.  Ebenen werden haupts√§chlich in Raster und Vektor unterteilt.  <em>Rasterebenen</em> bestehen aus Rasterbildern, w√§hrend <em>Vektorebenen Vektorgeometrien</em> enthalten. </p><br><p>  Die Komponente unterst√ºtzt die folgenden Arten von Ebenen: </p><br><ul><li>  <em>Kachelebene</em> zeigt die von den Kacheldiensten bereitgestellten Kacheln im XYZ-Format an. </li><li>  <em>Auf der Ebene</em> des <em>Web Map Service (WMS)</em> werden die von den WMS-Diensten bereitgestellten Bilder angezeigt. </li><li>  <em>Die Vektorebene</em> enth√§lt Geoobjekte (Objekte mit geometrischen Attributen). </li></ul><br><p>  Diese Ebenen sind Strukturelemente von Karten.  Beispielsweise kann die untere Schicht eine Basiskarte sein, die aus Kacheln besteht, die zweite Schicht kann Polygone enthalten, die Gebietseinheiten beschreiben, beispielsweise Regionen, und die obere Schicht kann geografische Punkte enthalten (Standort von Kunden, Gesch√§ften usw.).  Wenn wir diese Ebenen √ºbereinander legen, erhalten wir die endg√ºltige Karte: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b16/3b2/5f7/b163b25f702af4f76363340b899139b4.png" alt="Schichten"></p><br><p>  Dank dieses Ansatzes k√∂nnen Sie klar strukturierte Karten mit beliebigen Inhalten erstellen. </p><br><p> CUBA Maps bietet eine neue visuelle Komponente - <code>GeoMap</code> .  Im XML-Deskriptor der Komponente k√∂nnen Sie die grundlegenden Parameter der Karte sowie eine Reihe angezeigter Layer festlegen.  Ein Beispiel f√ºr eine solche Konfiguration: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"600px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">center</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"37.615, 55.752"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">zoom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">selectedLayer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:tile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tiles"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tileProvider</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"maps_OpenStreetMap"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"territoryLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"territoryDc"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressDc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">editable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Mit diesem Ansatz k√∂nnen Sie mehr Flexibilit√§t erreichen, die in <strong>Diagrammen und Karten</strong> fehlte: </p><br><ul><li>  <em>Schichtung.</em>  Mit dieser Struktur k√∂nnen Sie Karten mit beliebigen Inhalten erstellen, z. B. Kacheln kombinieren, die von verschiedenen Diensten bereitgestellt werden. </li><li>  <em>Ebenen bieten eine Abstraktion, die homogene Objekte zusammenbringt.</em>  In der Komponente " <strong>Diagramme und Karten"</strong> wurden alle Karteninhalte (z. B. Punkte, Polygone usw.) in einem gemeinsamen Heap in der UI-Komponente gespeichert.  Um diese Objekte irgendwie zu strukturieren, mussten die Projektteams zus√§tzliche Logik schreiben. </li><li>  <em>Eine deklarative Methode zur Beschreibung von Ebenen.</em>  Wie im obigen Beispiel gezeigt, k√∂nnen Sie die Kartenstruktur (Satz von Layern) im XML-Deskriptor vollst√§ndig angeben.  In vielen F√§llen reicht dies aus, um keine zus√§tzliche Logik in der Bildschirmsteuerung zu implementieren.  Mit <strong>Diagrammen und Karten war</strong> es fast unm√∂glich, auf das Schreiben zus√§tzlicher Logik zu verzichten. </li></ul><br><p>  Durch die Verwendung von Kachelebenen oder WMS k√∂nnen Sie mit jedem bevorzugten Kartenanbieter arbeiten.  Sie sind nicht an einen bestimmten Anbieter gebunden, wie dies in <strong>Diagrammen und Karten der Fall war</strong> . </p><br><p>  Vektorebenen vereinfachen die Anzeige, interaktive Bearbeitung und Zeichnung von Geoobjekten auf der Karte erheblich. </p><br><p>  Es ist auch erw√§hnenswert, dass die visuelle Komponente von <code>GeoMap</code> standardm√§√üig eine spezielle Hilfsebene hat - <strong>Canvas</strong> .  Canvas bietet eine praktische API zum Anzeigen und Zeichnen von Geometrien (Punkte, Polylinien, Polygone) auf einer Karte.  Wir werden sp√§ter in diesem Artikel Beispiele f√ºr die Verwendung von Canvas behandeln. </p><br><h2 id="geo-obekty">  Geo-Objekte </h2><br><p>  Angenommen, wir haben eine Entit√§t, die ein der Geometrie zugeordnetes Attribut enth√§lt (Punkt, Polylinie, Polygon).  Wir werden diese Entit√§t ein <em>Geoobjekt</em> nennen.  Die Komponente vereinfacht die Arbeit mit Geoobjekten erheblich. </p><br><p>  Betrachten Sie beispielsweise das Geoobjekt <strong>Adresse</strong> : </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StandardEntity</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"LOCATION"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Geometry</span></span> <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(datatype = <span class="hljs-string"><span class="hljs-string">"GeoPoint"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Convert</span></span>(converter = CubaPointWKTConverter.class) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Point location; ... }</code> </pre> <br><p>  Es verf√ºgt √ºber ein <code>location</code> vom Typ <code>org.locationtech.jts.geom.Point</code> aus der JTS Topology Suite (JTS) -Bibliothek.  Die Komponente unterst√ºtzt die folgenden geometrischen Typen von JTS: </p><br><ul><li>  <code>org.locationtech.jts.geom.Point</code> - Zeitraum. </li><li>  <code>org.locationtech.jts.geom.LineString</code> - Polylinie. </li><li>  <code>org.locationtech.jts.geom.Polygon</code> - Polygon. </li></ul><br><p>  Das <code>location</code> ist mit der Annotation <code>@Geometry</code> .  Diese Anmerkung gibt an, dass der Wert dieses Attributs verwendet werden soll, wenn ein Geoobjekt auf der Karte angezeigt wird.  Das Attribut ist au√üerdem mit den folgenden Anmerkungen gekennzeichnet: </p><br><ul><li>  <code>@MetaProperty</code> - wird in diesem Fall verwendet, um das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Datentypattribut</a> anzugeben.  Die <code>Datatype</code> vom CUBA-Framework verwendet, um Werte in und aus einer Zeichenfolge zu konvertieren. </li><li>  <code>@Convert</code> - Definiert einen JPA-Konverter f√ºr ein dauerhaftes Attribut.  Der JPA-Konverter konvertiert Attributwerte zwischen seinen Darstellungen in der Datenbank und Java-Code.  Die Komponente bietet eine Reihe von r√§umlichen Datentypen und JPA-Konvertern.  Weitere Informationen finden Sie in der Komponentendokumentation.  Sie k√∂nnen auch eine eigene Implementierung des JPA-Konverters verwenden, mit der Sie mit verschiedenen Geodatenquellen (z. B. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PostGIS</a> ) arbeiten k√∂nnen. </li></ul><br><p>  Um eine Entit√§t in ein Geoobjekt zu verwandeln, m√ºssen Sie ein Attribut des JTS-Geometrietyps definieren und mit <code>@Geometry</code> .  Es gibt noch eine andere Option: Erstellen Sie ein nicht persistentes Attribut, indem Sie Getter / Setter-Methoden bereitstellen.  Dies kann n√ºtzlich sein, wenn Sie keine √Ñnderungen am Datenmodell vornehmen und DDL-Skripte neu generieren m√∂chten. </p><br><p>  Betrachten Sie beispielsweise die Entit√§tsadresse mit separaten Attributen f√ºr L√§ngen- und Breitengrad: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.haulmont.addon.maps.gis.utils.GeometryUtils; ... <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StandardEntity</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"LATITUDE"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Double latitude; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"LONGITUDE"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Double longitude; ... <span class="hljs-meta"><span class="hljs-meta">@Geometry</span></span> <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(datatype = <span class="hljs-string"><span class="hljs-string">"GeoPoint"</span></span>, related = {<span class="hljs-string"><span class="hljs-string">"latitude"</span></span>, <span class="hljs-string"><span class="hljs-string">"longitude"</span></span>}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Point </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getLatitude() == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || getLongitude() == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GeometryUtils.createPoint(getLongitude(), getLatitude()); } <span class="hljs-meta"><span class="hljs-meta">@Geometry</span></span> <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(datatype = <span class="hljs-string"><span class="hljs-string">"GeoPoint"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Point point)</span></span></span><span class="hljs-function"> </span></span>{ Point prevValue = getLocation(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (point == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { setLatitude(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); setLongitude(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { setLatitude(point.getY()); setLongitude(point.getX()); } propertyChanged(<span class="hljs-string"><span class="hljs-string">"location"</span></span>, prevValue, point); } ... }</code> </pre> <br><p>  Wenn Sie sich f√ºr diesen Ansatz entscheiden, stellen Sie sicher, dass die <code>propertyChanged</code> Methode im Setter aufgerufen wird, da die Komponente auf dieses Ereignis reagiert, indem sie die Geometrie auf der Karte aktualisiert. </p><br><p>  Nachdem wir die Klasse unseres Geoobjekts vorbereitet haben, k√∂nnen wir der Vektorebene Instanzen dieser Klasse hinzuf√ºgen.  <em>Eine Vektorebene</em> ist im Wesentlichen ein Verbindungselement zwischen Daten (Geoobjekten) und einer Karte.  Um Geoobjekte mit einer Ebene zu verbinden, m√ºssen Sie den Datencontainer oder bei veralteten Bildschirmen (bis Version 7 von CUBA) die Datenquelle auf die Vektorebene √ºbertragen.  Dies kann in einem XML-Deskriptor erfolgen: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressesLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressesDc"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Infolgedessen werden die im <code>Address</code> Container enthaltenen Adressklasseninstanzen auf der Karte angezeigt. </p><br><p>  Betrachten wir eine elementare Aufgabe: Erstellen eines Bildschirms zum Bearbeiten eines Geoobjekts mit einer Karte, auf dem Sie die Geometrie des Objekts bearbeiten k√∂nnen.  Um das Problem zu l√∂sen, m√ºssen Sie die visuelle Komponente von <code>GeoMap</code> im XML-Deskriptor des Bearbeitungsbildschirms deklarieren und eine Vektorebene hinzuf√ºgen, die dem Container zugeordnet ist, der das bearbeitete Geoobjekt enth√§lt: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"600px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">center</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"37.615, 55.752"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">zoom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">selectedLayer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:tile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span><span class="hljs-tag">"/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressDc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">editable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Wenn Sie die Vektorebene als bearbeitbar markieren, wird die interaktive Bearbeitung des Geoobjekts auf der Karte aktiviert.  Wenn die Geometrie des Objekts leer ist, wechselt die Karte automatisch in den Zeichenmodus.  Wie Sie sehen, reicht es zur L√∂sung des Problems aus, eine Vektorebene auf der Karte zu deklarieren und sie an den Datencontainer / die Datenquelle zu √ºbergeben. </p><br><p>  Das ist alles.  Wenn wir <strong>Diagramme und Karten verwenden w√ºrden</strong> , um dasselbe Problem zu l√∂sen, m√ºssten wir ziemlich viel Code in den Bildschirmcontroller schreiben, um √§hnliche Funktionen bereitzustellen.  Mit der neuen Komponente von <strong>Maps ist das</strong> L√∂sen solcher Probleme viel einfacher. </p><br><h2 id="canvas">  Leinwand </h2><br><p>  Es gibt Zeiten, in denen Sie nicht mit Entit√§ten arbeiten m√ºssen.  Stattdessen m√∂chten Sie, dass eine einfache API Geometrien zu einer Karte hinzuf√ºgt und zeichnet, wie dies in <strong>Diagrammen und Karten der</strong> Fall war.  Zu diesem <code>GeoMap</code> visuelle Komponente <code>GeoMap</code> √ºber eine spezielle Ebene - <em>Canvas</em> .  Dies ist eine Hilfsebene, die sich standardm√§√üig auf der Karte befindet und eine einfache API zum Hinzuf√ºgen und Zeichnen von Geometrien auf der Karte bietet.  Sie k√∂nnen <code>map.getCanvas()</code> Map erhalten, indem Sie die <code>map.getCanvas()</code> -Methode aufrufen. </p><br><p>  Als n√§chstes werden wir uns einige einfache Aufgaben ansehen, wie sie in <strong>Diagrammen und Karten</strong> gel√∂st wurden und wie Sie dasselbe mit Canvas tun k√∂nnen. </p><br><h3 id="otobrazhenie-geometriy-na-karte">  Geometrien auf einer Karte anzeigen </h3><br><p>  In <strong>Diagrammen und Karten wurden</strong> Geometrieobjekte mithilfe der visuellen Komponente der Karte erstellt, als Factory verwendet und dann zur Karte hinzugef√ºgt: </p><br><pre> <code class="java hljs">Marker marker = map.createMarker(); GeoPoint position = map.createGeoPoint(lat, lon); marker.setPosition(position); map.addMarker(marker);</code> </pre> <br><p>  Die neue <strong>Maps-</strong> Komponente arbeitet direkt mit Klassen aus der JTS-Bibliothek: </p><br><pre> <code class="java hljs">CanvasLayer canvasLayer = map.getCanvas(); Point point = address.getLocation(); canvasLayer.addPoint(point);</code> </pre> <br><h3 id="redaktirovanie-geometriy">  Geometrie bearbeiten </h3><br><p>  In <strong>Diagrammen und Karten k√∂nnen</strong> Sie Geometrie als bearbeitbar festlegen.  Wenn solche Geometrien √ºber die Benutzeroberfl√§che ge√§ndert wurden, wurden die entsprechenden Ereignisse aufgerufen: </p><br><pre> <code class="java hljs">Marker marker = map.createMarker(); GeoPoint position = map.createGeoPoint(lat, lon); marker.setPosition(position); marker.setDraggable(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); map.addMarker(marker); map.addMarkerDragListener(event -&gt; { <span class="hljs-comment"><span class="hljs-comment">// do something });</span></span></code> </pre> <br><p>  In der <strong>Maps-</strong> Komponente gibt die entsprechende Methode beim Hinzuf√ºgen von JTS-Geometrie zu Canvas ein spezielles Objekt zur√ºck, das diese Geometrie auf der Karte darstellt: <code>CanvasLayer.Point</code> , <code>CanvasLayer.Polyline</code> oder <code>CanvasLayer.Polygon</code> .  Dieses Objekt verf√ºgt √ºber eine flie√üende Oberfl√§che zum Festlegen verschiedener Geometrieparameter. Es kann auch zum Abonnieren von Ereignissen im Zusammenhang mit Geometrie oder zum L√∂schen von Geometrie aus einem Canvas verwendet werden. </p><br><pre> <code class="java hljs">CanvasLayer canvasLayer = map.getCanvas(); CanvasLayer.Point location = canvasLayer.addPoint(address.getLocation()); location.setEditable(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) .setPopupContent(address.getName()) .addModifiedListener(modifiedEvent -&gt; address.setLocation(modifiedEvent.getGeometry()));</code> </pre> <br><h3 id="risovanie-geometriy">  Geometriezeichnung </h3><br><p>  In den alten Add-On- <code>DrawingOptions</code> <strong>und Karten</strong> gab es eine Hilfskomponente - <code>DrawingOptions</code> .  Es wurde verwendet, um die F√§higkeit zum Zeichnen auf der Karte zu aktivieren.  Nachdem die Geometrie gezeichnet wurde, wurde das entsprechende Ereignis ausgel√∂st: </p><br><pre> <code class="java hljs">DrawingOptions options = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DrawingOptions(); PolygonOptions polygonOptions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PolygonOptions(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">"#993366"</span></span>, <span class="hljs-number"><span class="hljs-number">0.6</span></span>); ControlOptions controlOptions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ControlOptions( Position.TOP_CENTER, Arrays.asList(OverlayType.POLYGON)); options.setEnableDrawingControl(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); options.setPolygonOptions(polygonOptions); options.setDrawingControlOptions(controlOptions); options.setInitialDrawingMode(OverlayType.POLYGON); map.setDrawingOptions(options); map.addPolygonCompleteListener(event -&gt; { <span class="hljs-comment"><span class="hljs-comment">//do something });</span></span></code> </pre> <br><p>  Die Maps-Komponente erleichtert dies erheblich.  Der neue Kartenbereich enth√§lt eine Reihe von Methoden zum Zeichnen von Geometrien.  Verwenden <code>canvas.drawPolygon()</code> zum Zeichnen eines Polygons beispielsweise die Methode <code>canvas.drawPolygon()</code> .  Nach dem Aufrufen dieser Methode wechselt die Karte in den Polygonzeichnungsmodus.  Die Methode akzeptiert die <code>Consumer&lt;CanvasLayer.Polygon&gt;</code> -Funktion, mit der Sie zus√§tzliche Aktionen mit dem gezeichneten Polygon ausf√ºhren k√∂nnen. </p><br><pre> <code class="java hljs">canvasLayer.drawPolygon(polygon -&gt; { territory.setPolygon(polygon.getGeometry()); });</code> </pre> <br><h2 id="instrumenty-dlya-geo-analiza">  Geoanalyse-Tools </h2><br><h3 id="klasterizaciya">  Clustering </h3><br><p>  Ein weiteres n√ºtzliches Tool in der neuen Maps-Komponente ist das Punktclustering.  Wenn die Ebene aus einer gro√üen Anzahl von Punkten besteht, k√∂nnen Sie das Clustering aktivieren, um nahegelegene Punkte in Cluster zu gruppieren, damit die Karte √ºbersichtlicher und besser wahrgenommen wird: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e6c/166/4d7/e6c1664d7e9092880dfcf13cc4dca58c.jpg" alt="Cluster"></p><br><p>  Das Clustering wird aktiviert, indem das <code>cluster</code> Tag innerhalb des <code>vector</code> Tags im XML-Deskriptor hinzugef√ºgt wird: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"locations"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"locationsDc"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:cluster</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Sie k√∂nnen das Clustering auch basierend auf Punktgewichten aktivieren.  Das Gewicht des Punkts ist der Wert des Attributs, das im Parameter <code>weightProperty</code> angegeben ist. </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"orders"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ordersDc"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:cluster</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">weightProperty</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"amount"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3 id="teplovye-karty">  Heatmaps </h3><br><p>  Heatmaps sind eine visuelle Darstellung der Datendichte an mehreren geografischen Standorten.  Die visuelle Komponente von GeoMap enth√§lt eine Methode zum Hinzuf√ºgen einer Heatmap: <code>addHeatMap(Map&lt;Point, Double&gt; intensityMap)</code> . </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/722/10b/289/72210b289dd04fcf41cc4ebec062c2d5.jpg" alt="Heatmap"></p><br><h2 id="zaklyuchenie">  Fazit </h2><br><p>  Die Verarbeitung, Analyse und Visualisierung von Geodaten ist ein wesentliches Element vieler Gesch√§ftsanwendungen.  Die <strong>CUBA Maps-</strong> Komponente stellt Ihrer CUBA-Anwendung alle erforderlichen Tools zur Implementierung dieser Funktionalit√§t zur Verf√ºgung. </p><br><p>  Eine schichtenbasierte Struktur hilft beim Erstellen von Karten mit beliebigen Inhalten.  Mit Kachel- / WMS-Ebenen k√∂nnen Sie jeden Anbieter verwenden, den Sie als Basiskarte ben√∂tigen.  Mit Vektorebenen k√∂nnen Sie effektiv mit Gruppen homogener Geoobjekte arbeiten.  Canvas bietet eine einfache API zum Anzeigen und Zeichnen von Geometrien auf einer Karte. </p><br><p>  Die Komponente arbeitet mit r√§umlichen Typen aus der JTS-Bibliothek, wodurch sie mit vielen anderen Frameworks (z. B. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GeoTools</a> ) kompatibel ist, um eine Vielzahl von Aufgaben im Zusammenhang mit der Verarbeitung und Analyse geografischer Daten zu l√∂sen. </p><br><p>  Wir hoffen, Ihnen gef√§llt die Komponente.  Warten auf Ihr Feedback! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de464517/">https://habr.com/ru/post/de464517/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de464503/index.html">Wi-Fi Passwort passend zu aircrack-ng</a></li>
<li><a href="../de464509/index.html">Das Buch "Grok Deep Learning"</a></li>
<li><a href="../de464511/index.html">So sammeln Sie Benutzerkohorten in Form von Grafiken in Grafana [+ Docker-Bild mit einem Beispiel]</a></li>
<li><a href="../de464513/index.html">Duffle: Transformator von XD Design</a></li>
<li><a href="../de464515/index.html">Wie man E-Mails erstellt und nicht durcheinander bringt: Praktische Tipps</a></li>
<li><a href="../de464523/index.html">Zahlungssysteme (PSP) f√ºr das IT-Gesch√§ft: Wir spielen gro√ü</a></li>
<li><a href="../de464525/index.html">Ihr eigener JSON-Konverter oder etwas mehr √ºber ExpressionTrees</a></li>
<li><a href="../de464529/index.html">F√ºr kontextbezogene Werbung mit den Namen von Wettbewerbern k√∂nnen jetzt 500.000 Rubel bestraft werden</a></li>
<li><a href="../de464535/index.html">Details zum Ger√§t und zu den Funktionen des KickScooter T60 Elektrorollers</a></li>
<li><a href="../de464537/index.html">Arduino DIY D√§monisches Karussell</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>