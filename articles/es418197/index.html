<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöµüèΩ üè¨ üë©üèæ‚Äçü§ù‚Äçüë©üèº Curso MIT "Seguridad de sistemas inform√°ticos". Lecci√≥n 4: "Compartir privilegios", Parte 2 üôÇ üë®‚Äç‚ù§Ô∏è‚Äçüë® üóÑÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Instituto de Tecnolog√≠a de Massachusetts. Conferencia Curso # 6.858. "Seguridad de los sistemas inform√°ticos". Nikolai Zeldovich, James Mickens. A√±o 2...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Curso MIT "Seguridad de sistemas inform√°ticos". Lecci√≥n 4: "Compartir privilegios", Parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/418197/"><h3>  Instituto de Tecnolog√≠a de Massachusetts.  Conferencia Curso # 6.858.  "Seguridad de los sistemas inform√°ticos".  Nikolai Zeldovich, James Mickens.  A√±o 2014 </h3><br>  Computer Systems Security es un curso sobre el desarrollo e implementaci√≥n de sistemas inform√°ticos seguros.  Las conferencias cubren modelos de amenazas, ataques que comprometen la seguridad y t√©cnicas de seguridad basadas en trabajos cient√≠ficos recientes.  Los temas incluyen seguridad del sistema operativo (SO), caracter√≠sticas, gesti√≥n del flujo de informaci√≥n, seguridad del idioma, protocolos de red, seguridad de hardware y seguridad de aplicaciones web. <br><br>  Lecci√≥n 1: "Introducci√≥n: modelos de amenaza" <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 3</a> <br>  Lecci√≥n 2: "Control de ataques de hackers" <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 3</a> <br>  Lecci√≥n 3: ‚ÄúDesbordamientos del b√∫fer: exploits y protecci√≥n‚Äù <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 3</a> <br>  Lecci√≥n 4: ‚ÄúSeparaci√≥n de privilegios‚Äù <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 3</a> <a name="habracut"></a><br><br>  Entonces, ¬øqu√© m√°s ten√≠amos en esta lista?  Procesos  La memoria es algo que sucede simult√°neamente con el proceso.  Por lo tanto, si no est√° en este proceso, no puede acceder a su memoria.  La memoria virtual mejora perfectamente este aislamiento para nosotros.  Adem√°s, el mecanismo de depuraci√≥n le permite "aparecer" en la memoria de otro proceso, si tiene la misma ID de usuario <br><br>  A continuaci√≥n tenemos la red.  Las redes en <b>Unix</b> no se corresponden exactamente con el modelo descrito anteriormente, en parte debido al hecho de que el <b>sistema</b> operativo <b>Unix</b> se desarroll√≥ por primera vez, y luego apareci√≥ una red, que pronto se hizo popular.  Tiene un conjunto de reglas ligeramente diferente.  Por lo tanto, las operaciones de las que realmente debemos ocuparnos son conectar a alguien a la red si administra la red o escuchar alg√∫n puerto si act√∫a como servidor.  Es posible que deba leer o escribir datos en esta conexi√≥n, o enviar y recibir paquetes <b>sin</b> formato. <br><br><img src="https://habrastorage.org/webt/dw/gn/zv/dwgnzva6txwuj_esllvdnx3uexg.jpeg"><br><br>  Por lo tanto, las redes en <b>Unix no</b> est√°n relacionadas con el <b>ID</b> de <b>usuario</b> .  Las reglas son que cualquiera siempre puede conectarse a cualquier m√°quina o cualquier direcci√≥n IP o abrir una conexi√≥n.  Si desea escuchar en un puerto, entonces en este caso hay una diferencia, que es que la mayor√≠a de los usuarios tienen prohibido escuchar puertos con un n√∫mero inferior al "valor m√°gico" de 1024. En principio, puede escuchar dichos puertos, pero en este caso debe Sea un usuario especial llamado <b>"superusuario"</b> con <b>uid = 0</b> . <br><br>  En general, en Unix existe el concepto de administrador, o superusuario, que est√° representado por el identificador uid = 0, que puede omitir casi todas estas comprobaciones, por lo que si trabaja con derechos de root, puede leer y escribir archivos, cambiar los derechos de acceso a ellos.  El sistema operativo le permitir√° hacer esto porque cree que debe tener todos los privilegios.  Y realmente necesita esos privilegios para escuchar en los puertos con el n√∫mero &lt;1024. ¬øQu√© le parece una restricci√≥n tan extra√±a? <br><br>  <b>Audiencia:</b> identifica n√∫meros de puerto espec√≠ficos para conexiones espec√≠ficas, por ejemplo, para <b>http</b> en el puerto 80. <br><br>  <b>Profesor:</b> s√≠, por defecto, el <b>protocolo HTTP</b> usa el puerto 80. Por otro lado, otros servicios pueden usar puertos con un n√∫mero superior a 1024, ¬øpor qu√© es necesaria esta restricci√≥n?  ¬øCu√°l es el uso aqu√≠? <br><br>  <b>P√∫blico:</b> porque no desea que nadie escuche accidentalmente su <b>HTTP</b> . <br><br>  <b>Profesor:</b> si.  Creo que la raz√≥n de esto es que sol√≠a tener muchos usuarios en la misma m√°quina.  Iniciaron sesi√≥n con sus inicios de sesi√≥n, lanzaron sus aplicaciones, por lo que quer√≠an asegurarse de que alg√∫n usuario aleatorio, despu√©s de haber iniciado sesi√≥n en la computadora, no pudiera obtener el servidor web que se ejecuta en √©l.  Debido a que los usuarios que se conectan desde el exterior no saben qui√©n trabaja en este puerto, y simplemente se conectan al puerto 80. Si quiero ingresar a esta m√°quina e iniciar mi propio servidor web, simplemente transfiero todo el tr√°fico del servidor web a este auto  Probablemente este no sea un plan muy bueno, pero es la forma en que el subsistema de red Unix evita que usuarios aleatorios controlen servicios conocidos que se ejecutan en estos n√∫meros de puerto bajos.  Esa es la raz√≥n de tal limitaci√≥n. <br><br><img src="https://habrastorage.org/webt/ba/0o/qn/ba0oqn2qgabud4-_hmizsks086s.jpeg"><br><br>  Adem√°s, desde el punto de vista de leer y escribir datos de conexi√≥n, si tiene un archivo descriptor para un socket espec√≠fico, <b>Unix</b> le permitir√° leer y escribir cualquier dato en esta <b>conexi√≥n TCP</b> o <b>uTP</b> .  Al enviar paquetes sin <b>procesar</b> , <b>Unix se</b> comporta como un paranoico, por lo que no le permitir√° enviar paquetes arbitrarios a trav√©s de la red.  Esto debe estar dentro del contexto de la conexi√≥n especial, a menos que tenga <b>root, el</b> derecho y puede hacer lo que quiera. <br><br>  Entonces, una pregunta interesante que podr√≠as hacer es ¬øde d√≥nde vienen todos estos <b>ID de usuario</b> ? <br><br>  Estamos hablando de procesos que tienen <b>ID de usuario</b> o <b>ID de</b> <b>grupo</b> .  Cuando inicie <b>PS</b> en su computadora, definitivamente ver√° una serie de procesos con diferentes valores de <b>uid</b> .  ¬øDe d√≥nde vinieron? <br><br>  Necesitamos alg√∫n mecanismo para cargar todos estos valores de <b>ID</b> de <b>usuario</b> .  <b>Unix</b> tiene varias llamadas al sistema dise√±adas para esto.  Por lo tanto, para arrancar estos valores de identificador, hay una funci√≥n llamada <b>setuid (uid)</b> , por lo que puede asignar el n√∫mero <b>uid</b> de alg√∫n proceso actual a este valor.  Esta es en realidad una operaci√≥n peligrosa, como todo lo dem√°s en la tradici√≥n de <b>Unix</b> , porque solo puede hacer esto si su <b>uid = 0</b> .  En cualquier caso, deber√≠a ser as√≠. <br><br>  Por lo tanto, si es un usuario con derechos de root y tiene <b>uid = 0</b> , puede llamar a <b>setuid (uid)</b> y cambiar el usuario a cualquier proceso.  Hay un par de otras llamadas de sistema similares para inicializar <b>gid</b> relacionado con el proceso: estos son <b>setgid</b> y <b>setgroups</b> .  Por lo tanto, estas llamadas al sistema le permiten configurar privilegios de proceso. <br><br><img src="https://habrastorage.org/webt/qs/6m/bk/qs6mbkc520bn-n_vlpznivx1z0q.jpeg"><br><br>  El hecho de que sus procesos obtengan los derechos de acceso correctos cuando inicia sesi√≥n en la m√°quina <b>Unix</b> no sucede porque tiene la misma <b>ID</b> que los procesos, porque el sistema a√∫n no sabe qui√©n es usted.  En cambio, en <b>Unix,</b> hay alg√∫n tipo de procedimiento de inicio de sesi√≥n cuando el <b>protocolo de</b> shell seguro <b>SSH</b> inicia el proceso para cualquier persona que se conecte a la computadora e intente autenticar al usuario. <br><br>  Por lo tanto, inicialmente este proceso de inicio de sesi√≥n comienza con <b>uid = 0</b> como para un usuario con derechos de root, y luego, cuando recibe un nombre de usuario y contrase√±a espec√≠ficos, los verifica en su propia base de datos de cuentas.  Como regla general, en <b>Unix,</b> estos datos se almacenan en dos archivos: <b>/ etc / password</b> (por razones hist√≥ricas, las contrase√±as ya no se almacenan en este archivo), y en el <b>archivo / etc / shadow</b> , en el que se almacenan las contrase√±as.  Sin embargo, hay una tabla en el <b>archivo / etc / password</b> que muestra cada nombre de usuario en el sistema como un valor entero. <br><br>  Por lo tanto, su nombre de usuario se asigna a un entero espec√≠fico en este <b>archivo / etc / password</b> , y luego el proceso de inicio de sesi√≥n verifica si su contrase√±a es correcta de acuerdo con este archivo.  Si encuentra su n√∫mero entero <b>uid</b> , establece las funciones <b>setuid</b> en ese valor <b>uid</b> e inicia el shell con el comando <b>exec (/ bin / sh)</b> .  Ahora puede interactuar con el shell, pero funciona debajo de su <b>uid</b> , por lo que no podr√° causar da√±os accidentales a esta m√°quina. <br><br><img src="https://habrastorage.org/webt/oa/vi/t8/oavit8bjjn_skjz8-n1k5dhc6co.jpeg"><br><br>  <b>P√∫blico: ¬øes</b> posible comenzar un nuevo proceso con <b>uid = 0</b> si su <b>uid</b> no es realmente 0? <br><br>  <b>Profesor:</b> si tiene privilegios de root, puede limitarse a otro <b>uid</b> , disminuir su autoridad, pero en cualquier caso, puede crear un proceso con solo el mismo <b>uid</b> que el suyo.  Pero sucede que por varias razones desea aumentar sus privilegios.  Suponga que necesita instalar un paquete, para el cual necesita privilegios de <b>root</b> . <br><br>  Hay dos formas de establecer privilegios en <b>Unix</b> .  Uno que ya mencionamos es un descriptor de archivo.  Entonces, si realmente desea aumentar sus privilegios, puede hablar con alguien que trabaje bajo los derechos de root y pedirle que abra este archivo por usted.  O necesita instalar una nueva interfaz, entonces este asistente abre un archivo para usted y le devuelve un descriptor de archivo mediante la transferencia <b>fd</b> .  Esta es una forma de aumentar sus privilegios, pero es inconveniente porque en algunos casos hay procesos que se ejecutan con una gran cantidad de privilegios.  Para esto, <b>Unix</b> tiene un mecanismo inteligente pero al mismo tiempo problem√°tico llamado <b>"binarios setuid"</b> .  Este mecanismo son ejecutables regulares en un <b>sistema de</b> archivos <b>Unix</b> , excepto cuando ejecuta <b>exec</b> en el binario <b>setuid</b> , por ejemplo, <b>/ bin / su</b> en la mayor√≠a de las m√°quinas, o <b>sudo</b> , al inicio. <br><br>  Un <b>sistema</b> t√≠pico de <b>Unix</b> tiene un mont√≥n de binarios <b>setuid</b> .  La diferencia es que cuando ejecuta uno de estos binarios, en realidad cambia el <b>ID de usuario del</b> proceso al propietario de este binario.  Este mecanismo parece extra√±o cuando lo ves por primera vez.  Como regla general, las formas de usarlo son que este "binario" probablemente tenga un <b>uid de</b> propietario <b>de</b> 0, porque realmente desea restaurar muchos privilegios. <br><br><img src="https://habrastorage.org/webt/zt/s5/8d/zts58db83nchnbo1a6qqobpbpuw.jpeg"><br><br>  Desea restaurar los derechos de superusuario para poder ejecutar este comando <b>su</b> , y el n√∫cleo, cuando ejecute este binario, cambiar√° el <b>uid</b> del proceso a 0, de modo que este programa ahora realizar√° algunas cosas privilegiadas. <br><br>  <b>P√∫blico:</b> si tiene <b>uid = 0</b> y cambia el <b>uid de</b> todos estos binarios <b>setuid</b> a algo distinto de 0, ¬øpuede restaurar sus privilegios? <br><br>  <b>Profesor:</b> no, muchos procesos no podr√°n restaurar los privilegios al reducir el nivel de acceso, por lo que puede estar atrapado en este lugar.  Este mecanismo no est√° vinculado a <b>uid = 0</b> .  Al igual que cualquier usuario de un sistema <b>Unix</b> , puede crear cualquier archivo binario, construir un programa, compilarlo y establecer este bit <b>setuid</b> en el programa mismo.  Le pertenece a usted, el usuario, su ID de usuario.  Y eso significa que cualquiera que ejecute su programa ejecutar√° este c√≥digo con su ID de usuario.  ¬øHay alg√∫n problema con esto?  ¬øQu√© hay que hacer? <br><br>  <b>P√∫blico:</b> es decir, si hubo un error en su solicitud, ¬øpodr√≠a alguien hacer algo al respecto, actuando con sus privilegios? <br><br>  <b>Profesor:</b> claro, sucede si mi aplicaci√≥n tiene "errores" o si te permite ejecutar todo lo que quieras.  Supongamos que puedo copiar el shell del sistema y configurarlo para m√≠, pero luego cualquiera puede ejecutar este shell en mi cuenta.  Probablemente este no sea el mejor plan de acci√≥n.  Pero dicho mecanismo no crea un problema, porque la √∫nica persona que puede establecer el bit <b>setuid</b> en un archivo binario es el propietario de este archivo.  Usted, como propietario del archivo, tiene el privilegio <b>uid</b> , por lo que puede transferir su cuenta a otra persona, pero esta otra persona no podr√° crear el binario <b>setuid</b> con su <b>ID de usuario</b> . <br><br>  Este bit setuid se almacena junto a estos bits de permiso, es decir, en cada <b>inodo</b> tambi√©n hay un bit <b>setuid</b> que dice si este archivo ejecutable deber√≠a o si el programa cambi√≥ al <b>uid</b> del propietario durante la ejecuci√≥n. <br><br><img src="https://habrastorage.org/webt/4d/o0/cf/4do0cfauri7y6g94omunnrdyv14.jpeg"><br><br>  Resulta que este es un mecanismo muy complicado cuando se usa correctamente, y gracias a √©l, el n√∫cleo implementa el programa correctamente.  En realidad, esto es bastante f√°cil de hacer, porque solo se realiza una comprobaci√≥n: si existe este bit <b>setuid</b> , entonces el proceso cambia a <b>uid</b> .  Es bastante simple <br><br>  Pero usarlo de manera segura es bastante dif√≠cil porque, como se acaba de indicar, si este programa contiene errores o hace algo inesperado, entonces puede hacer cosas arbitrarias bajo <b>uid = 0</b> o bajo cualquier otro <b>uid</b> .  En <b>Unix,</b> cuando ejecuta un programa, hereda muchas cosas de su proceso principal. <br><br>  Por ejemplo, puede pasar variables de entorno a binarios <b>setuid</b> .  El hecho es que en <b>Unix</b> puede especificar qu√© biblioteca compartida usar para el proceso configurando la variable de entorno, y los binarios <b>setuid</b> no se preocupan por filtrar estas variables de entorno. <br><br>  Por ejemplo, puede ejecutar <b>bin / su</b> , pero usar bibliotecas compartidas para la funci√≥n <b>printf</b> , por lo que su <b>printf</b> se iniciar√° cuando <b>bin / su</b> imprima algo, y puede ejecutar el shell en lugar de <b>printf</b> . <br><br>  Hay muchas sutilezas que debe comprender correctamente con respecto a la desconfianza del programa a los datos que ingresa el usuario.  Debido a que generalmente conf√≠a en la entrada del usuario, <b>setuid</b> nunca ha sido la parte m√°s segura de un sistema <b>Unix</b> completo.  ¬øTienes preguntas sobre esto? <br><br>  <b>P√∫blico:</b> ¬ø <b>setuid</b> tambi√©n se aplica a grupos o solo al usuario? <br><br>  <b>Profesor:</b> hay un bit <b>setgid</b> sim√©trico al bit <b>setuid</b> , que tambi√©n puede configurar.  Si el archivo tiene un <b>gid</b> espec√≠fico y este bit <b>setgid</b> se establece cuando se inicia el programa, lo obtendr√°. <br><br>  <b>Setgid</b> no se usa particularmente, pero puede ser √∫til en los casos en que desea proporcionar privilegios muy espec√≠ficos.  Por ejemplo, <b>bin / su</b> probablemente necesita muchos privilegios, pero quiz√°s haya alg√∫n programa que necesite algunos privilegios adicionales, por ejemplo, para escribir algo en un archivo de registro especial.  Por lo tanto, es probable que desee proporcionarle un determinado grupo y crear un archivo de registro para ella que este grupo pueda escribir.  Entonces, incluso si el programa tiene "errores", entonces no perder√° nada m√°s que este grupo.  Esto es √∫til como un mecanismo que por alguna raz√≥n no se usa con demasiada frecuencia, porque despu√©s de todo, las personas deber√≠an usar m√°s los derechos de root. <br><br>  <b>Audiencia:</b> ¬øExisten restricciones sobre qui√©n puede cambiar el acceso? <br><br>  <b>Profesor:</b> si.  Las diferentes implementaciones de <b>Unix</b> tienen diferentes controles para esto.  La regla general es que solo la ra√≠z puede cambiar el propietario del archivo, porque no desea crear archivos que pertenezcan a otra persona y, por supuesto, no desea apropiarse de los archivos de otras personas.  Entonces, si su <b>uid</b> no <b>es</b> 0, entonces est√° atascado.  No puede cambiar la propiedad de ning√∫n archivo.  Si su <b>uid = 0</b> , tiene privilegios de root y puede cambiar el propietario a cualquiera.  Hay algunas complicaciones si tiene un <b>setuid</b> binario y cambia de un <b>uid</b> a otro, esto es bastante complicado, pero b√°sicamente no puede cambiar el propietario del archivo si no tiene privilegios de root. <br><br>  Por todas las cuentas, este es un sistema un poco desactualizado.  Probablemente podr√≠a imaginar muchas formas de simplificar los procesos descritos anteriormente, pero de hecho, los sistemas m√°s avanzados se ven as√≠ porque evolucionan con el tiempo.  Pero puede utilizar perfectamente estos mecanismos como "caja de arena". <br><br>  Estos son solo una especie de principios b√°sicos de <b>Unix</b> , que aparecen en casi todos los sistemas operativos tipo Unix: <b>Mac OS X</b> , <b>Linux</b> , <b>FreeBSD</b> , <b>Solaris</b> , si alguien m√°s lo usa, y as√≠ sucesivamente.  Pero cada uno de estos sistemas tiene mecanismos m√°s sofisticados que podr√≠a utilizar.  Por ejemplo, en <b>Linux</b> hay un conjunto de "sandbox" <b>COMP</b> , <b>Mac OS X</b> usa el cintur√≥n de <b>seguridad</b> "sandbox".  La pr√≥xima semana le dar√© ejemplos de sandboxes disponibles en todos los sistemas basados ‚Äã‚Äãen <b>Unix</b> . <br><br>  Entonces, uno de los √∫ltimos mecanismos, que consideraremos antes de sumergirnos en <b>OKWS</b> , explica c√≥mo debe lidiar con los binarios <b>setuid</b> y muestra c√≥mo puede protegerse de los agujeros de seguridad existentes.  El problema es que inevitablemente tendr√° algunos binarios <b>setuid</b> en su sistema, como <b>/ bin / su</b> , o <b>sudo</b> , o algo m√°s, y es probable que sus programas tengan errores.  Debido a esto, alguien podr√° ejecutar el binario <b>setuid</b> y el proceso podr√° obtener acceso a la <b>ra√≠z</b> , lo que no desea permitir. <br><br><img src="https://habrastorage.org/webt/gy/nt/aa/gyntaadl0kgyfcku6ncq8v334kg.jpeg"><br><br>  El mecanismo de <b>Unix</b> , que a menudo se usa para evitar la ejecuci√≥n de un proceso potencialmente malicioso usando binarios <b>setuid</b> , es usar el espacio de nombres del sistema de archivos para cambiarlo usando la llamada al sistema <b>chroot</b> , la operaci√≥n de cambiar el directorio ra√≠z.  <b>OKWS</b> , como servidor web especializado en la creaci√≥n de servicios web r√°pidos y seguros, lo utiliza ampliamente. <br><br><img src="https://habrastorage.org/webt/m3/x1/xr/m3x1xrg_tmht2b2l8rwd8kzzy7s.jpeg"><br><br>  Entonces, en <b>Unix,</b> puede ejecutar <b>chroot</b> en un directorio espec√≠fico, por lo que quiz√°s tambi√©n pueda ejecutar <b>chroot ("/ foo")</b> . <br><br>  Hay 2 explicaciones de lo que hace <b>chroot</b> .  El primero es simplemente intuitivo, significa que despu√©s de ejecutar <b>chroot</b> , el directorio ra√≠z o el directorio ubicado detr√°s de la barra es b√°sicamente equivalente a lo que <b>/ foo us√≥</b> antes de llamar a <b>chroot</b> .  Parece limitar el espacio de nombres debajo de tu <b>/ foo</b> .  Por lo tanto, si tiene un archivo que sol√≠a llamarse <b>/ foo / x</b> , luego de llamar a <b>chroot,</b> puede obtener este archivo simplemente abriendo <b>/ x</b> .  Tan solo limite su espacio de nombres a un subdirectorio.  Aqu√≠ est√° la versi√≥n intuitiva. <br><br><img src="https://habrastorage.org/webt/2w/58/wf/2w58wflgecku62k-urraxwggxcc.jpeg"><br><br>  Por supuesto, en seguridad, no es la versi√≥n intuitiva lo que importa, pero ¬øqu√© hace exactamente el n√∫cleo con esta llamada del sistema?  Y hace b√°sicamente dos cosas.  En primer lugar, cambia el valor de esta barra oblicua, por lo que cada vez que accede o cuando inicia el nombre del directorio con una barra oblicua, el n√∫cleo incluye cualquier archivo que proporcion√≥ con las operaciones <b>chroot</b> .  En nuestro ejemplo, este es el archivo <b>/ foo</b> antes de llamar a <b>chroot</b> , es decir, obtenemos ese <b>/ = / foo</b> . <br><br><img src="https://habrastorage.org/webt/gn/yx/-t/gnyx-tksd5brn4avys0dhppaw6c.jpeg"><br><br>  Lo siguiente que intentar√° hacer el n√∫cleo es protegerlo de poder "escapar" de su <b>/</b> si lo hace <b>/../</b> .  Porque en <b>Unix,</b> podr√≠a pedirte que me des, por ejemplo, <b>/../etc/password</b> .  Entonces, si acabo de complementar esta l√≠nea de esta manera: <b>/foo/../etc/password</b> , eso no ser√≠a bueno, porque podr√≠a simplemente salir <b>/ foo</b> y obtener <b>/ etc / contrase√±a</b> . <br><br>  La segunda cosa que hace el n√∫cleo con una llamada al sistema <b>Unix</b> es que cuando llama a <b>chroot</b> para este proceso en particular, cambia la forma en que <b>/../ se</b> eval√∫a en este directorio.  Por lo tanto, modifica <b>/../</b> para que <b>/ foo se</b> se√±ale a s√≠ mismo.  Por lo tanto, esto no le permite "escapar", y este cambio se aplica solo a este proceso y no afecta al resto.  ¬øQu√© ideas tiene sobre c√≥mo "escapar" del entorno <b>chroot</b> utilizando c√≥mo se implementa? <br><br>  Curiosamente, el kernel monitorea solo un directorio <b>chroot</b> , por lo que probablemente podr√≠a realizar la operaci√≥n <b>chroot = (/ foo)</b> , pero estar√≠a atascado en este lugar.  Entonces, ¬øquieres obtener <b>/ etc / contrase√±a</b> , pero c√≥mo hacerlo?  Puede abrir el directorio ra√≠z en este momento escribiendo <b>open (* / *)</b> .  Esto le dar√° un descriptor de archivo que describe qu√© es <b>/ foo</b> .  Luego puede llamar a <b>chroot</b> nuevamente y ejecutar <b>chroot (`/ bar)</b> . <br><br><img src="https://habrastorage.org/webt/er/ce/o6/erceo6xadygvj95nuy8fj-zn1bi.jpeg"><br><br> ,    : <b>root</b>   <b>/foo</b> ,  <b>/foo/bar</b>   <b>/../</b>     <b>/foo / bar/..</b> <br><br><img src="https://habrastorage.org/webt/gi/vb/zy/givbzygict7u1xirzzwneycl3sw.jpeg"><br><br>  ,          <b>/foo</b> .            <b>fchdir (fd)</b>     <b>(*/*)</b> ,      <b>chdir (..)</b> . <br><br><img src="https://habrastorage.org/webt/lb/qz/mx/lbqzmxnz8308avfwfyaxxprq7d8.jpeg"><br><br><img src="https://habrastorage.org/webt/gu/cn/kd/gucnkdez6q9ntda3zwtotnc4igg.jpeg"><br><br>       <b>/foo</b> ,     <b>/../</b> .     <b>/foo</b>        ,       <b>root</b> ,       . <br><br> ,    ,       .       .   <b>Unix</b>    root-   <b>chroot</b> ,  <b>chroot</b>     .  ,  <b>Unix</b>    <b>uid = 0</b>  ,      <b>chroot</b> .   .           ,         ,    <b>chroot</b> ,   <b>userid</b>   .   ,     <b>Unix</b> ,     ,    <b>root</b> ,    . <br><br>       ,  , ,     .      <b>chroot</b>       ‚Äî      .    . <br><br> <b>:</b>  ,       <b>inod</b> ,      ? <br><br> <b>:</b>    !              ,  , , : ¬´   <b>inode</b>  23¬ª,      -        <b>hroot</b> .  ,  <b>Unix</b>     <b>inode</b>   <b>inode</b> ,  , ,   root-. <br><br>  ,      ,  ,   <b>OKWS</b> .  ,      <b>OKWS</b> . <br><br>  ,     -,   ,      -  ,      .          , , <b>httpd</b> , ,  <b>Apache</b> . <br><br>        <b>userid</b>   <b>www</b>  <b>/etc/password</b> .     ,   ,     <b>SSL</b> ,      <b>PHP</b>   ,        .   ,       , , <b>MySQL</b> ,           .    <b>MySQL</b>     .      <b>MySQL</b> , , ,      . <br><br><img src="https://habrastorage.org/webt/sx/tx/gd/sxtxgdpf7q9jr3q_tfxyzi6zgdc.jpeg"><br><br> ,  ,    ,    <b>MySQL</b>    ,        ,             . <br><br>         ,       ,  ,         ,   .    ,      , ,     <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o tal vez en el c√≥digo de la aplicaci√≥n o en el int√©rprete de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Y dado que hay errores, puede usarlos para obtener todo el contenido de la aplicaci√≥n. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">52:30 min </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Continuaci√≥n:</font></font><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Curso MIT "Seguridad de sistemas inform√°ticos".</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lecci√≥n 4: "Compartir privilegios", Parte 2</font></font></a> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/dNl22h1kW1k" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La versi√≥n completa del curso est√° disponible </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br>  Gracias por quedarte con nosotros.  ¬øTe gustan nuestros art√≠culos?  ¬øQuieres ver m√°s materiales interesantes?  <b>Ap√≥yenos</b> haciendo un pedido o recomend√°ndolo a sus amigos, un <b>descuento del 30% para los usuarios de Habr en un an√°logo √∫nico de servidores de nivel de entrada que inventamos para usted:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">toda la verdad sobre VPS (KVM) E5-2650 v4 (6 n√∫cleos) 10GB DDR4 240GB SSD 1Gbps de $ 20 o c√≥mo dividir el servidor?</a>  (las opciones est√°n disponibles con RAID1 y RAID10, hasta 24 n√∫cleos y hasta 40GB DDR4). <br><br>  <b>Dell R730xd 2 veces m√°s barato?</b>  ¬°Solo tenemos <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2 x Intel Dodeca-Core Xeon E5-2650v4 128GB DDR4 6x480GB SSD 1Gbps 100 TV desde $ 249</a> en los Pa√≠ses Bajos y los Estados Unidos!</b>  Lea sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C√≥mo construir un edificio de infraestructura.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">clase utilizando servidores Dell R730xd E5-2650 v4 que cuestan 9,000 euros por un centavo?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es418197/">https://habr.com/ru/post/es418197/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es418187/index.html">En Estados Unidos, sugirieron reemplazar todas las bibliotecas con centros de Amazon. El p√∫blico est√° indignado.</a></li>
<li><a href="../es418189/index.html">Heredero de Zeus: por qu√© el troyano IcedID es peligroso para los clientes bancarios</a></li>
<li><a href="../es418191/index.html">An√°logos en Python y JavaScript. Parte tres</a></li>
<li><a href="../es418193/index.html">¬øQu√© se siente al crear un juego para Game Boy en 2017?</a></li>
<li><a href="../es418195/index.html">Curso MIT "Seguridad de sistemas inform√°ticos". Lecci√≥n 4: "Compartir privilegios", Parte 1</a></li>
<li><a href="../es418199/index.html">C√≥mo hacer una tarea t√©cnica simple y no perder dinero y nervios</a></li>
<li><a href="../es418201/index.html">¬øPodemos revivir Duck Hunt?</a></li>
<li><a href="../es418203/index.html">GraphQL API (CRUD) en marcha</a></li>
<li><a href="../es418205/index.html">Space Language Vol. 2: Bienvenido, GJ273b</a></li>
<li><a href="../es418207/index.html">Revisi√≥n de port√°tiles para juegos ASUS ROG Strix GL504GS SCAR II y ASUS ROG Strix GL504GM HERO II</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>