<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑🏿‍🤝‍🧑🏾 👖 🦗 Dans quelle mesure les données pour la formation sur modèle sont-elles (non) similaires à un échantillon de test? 🙅🏻 👩🏻‍🌾 🤟🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Considérez un scénario où votre modèle d'apprentissage automatique pourrait être sans valeur. 

 Il y a un dicton: "Ne comparez pas les pommes avec le...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dans quelle mesure les données pour la formation sur modèle sont-elles (non) similaires à un échantillon de test?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422185/">  Considérez un scénario où votre modèle d'apprentissage automatique pourrait être sans valeur. <br><br>  Il y a un dicton: <i>"Ne comparez pas les pommes avec les oranges"</i> .  Mais que se passe-t-il si vous devez comparer un ensemble de pommes avec des oranges avec un autre, mais la distribution des fruits dans les deux ensembles est différente?  Pouvez-vous travailler avec des données?  Et comment allez-vous le faire? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lt/0y/oi/lt0yoiaq5fua0l1gfpguoigfxfa.png"></div><a name="habracut"></a><br>  Dans les cas réels, cette situation est courante.  Lors du développement de modèles d'apprentissage automatique, nous sommes confrontés à une situation où notre modèle fonctionne bien avec un ensemble de formation, mais la qualité du modèle diminue fortement sur les données de test. <br><br>  Et il ne s'agit pas de se recycler.  Disons que nous avons construit un modèle qui donne un excellent résultat sur la validation croisée, mais montre un mauvais résultat sur le test.  Ainsi, dans l'échantillon de test, il y a des informations que nous ne prenons pas en compte. <br><br>  Imaginez une situation dans laquelle nous prédisons le comportement des clients dans un magasin.  Si les exemples de formation et de test ressemblent à l'image ci-dessous, c'est un problème clair: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vk/ki/j2/vkkij2n5rlshttroh8mqfse-zf4.png"></div><br>  <i>Dans cet exemple, le modèle est formé sur des données avec une valeur moyenne de l'attribut «âge du client» inférieure à la valeur moyenne d'un attribut similaire sur le test.</i>  <i>Dans le processus d'apprentissage, le modèle n'a jamais «vu» les valeurs plus importantes de l'attribut «âge».</i>  <i>Si l'âge est une caractéristique importante du modèle, il ne faut pas s'attendre à de bons résultats sur l'échantillon de test.</i> <br><br>  Dans ce texte, nous parlerons d'approches «naïves» qui nous permettent d'identifier de tels phénomènes et d'essayer de les éliminer. <br><br><h3>  Décalage covariant </h3><br>  Donnons une définition plus précise de ce concept.  <b>La covariance</b> fait référence aux valeurs des caractéristiques, et le <b>décalage covariant</b> fait référence à une situation où la distribution des valeurs des caractéristiques dans les échantillons d'apprentissage et d'essai a des caractéristiques (paramètres) différentes. <br><br>  Dans les problèmes du monde réel avec un grand nombre de variables, le décalage covariant est difficile à détecter.  L'article traite de la méthode d'identification et de prise en compte de la variation covariante des données. <br><br><img src="https://habrastorage.org/webt/no/ta/lj/notaljh1r3c8nimkt45_lp3yyco.png"><br><br><h3>  Idée principale </h3><br>  <i>S'il y a un changement dans les données, alors lors du mélange des deux échantillons, nous pouvons construire un classificateur qui peut déterminer si l'objet appartient à un échantillon d'apprentissage ou de test.</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pw/v-/42/pwv-42li1_tl9jqyghnph6czcsg.png"></div><br>  Voyons pourquoi il en est ainsi.  Revenons à l'exemple avec les clients, où l'âge était un signe «décalé» des échantillons de formation et de test.  Si nous prenons un classificateur (par exemple, basé sur une forêt aléatoire) et essayons de diviser l'échantillon mixte en formation et test, alors l'âge sera un signe très important pour une telle classification. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/j1/29/wf/j129wfqmbguam_2axs1h6liyt4e.png"></div><br><h3>  Implémentation </h3><br>  Essayons d'appliquer l'idée décrite à un ensemble de données réel.  Utilisez l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ensemble</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">données</a> du concours Kaggle. <br><br><h4>  Étape 1: préparation des données </h4><br>  Tout d'abord, nous suivrons une série d'étapes standard: nettoyer, remplir les blancs, effectuer le codage des étiquettes pour les signes catégoriels.  Aucune étape n'a été requise pour l'ensemble de données en question, alors ignorez sa description. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-comment"><span class="hljs-comment">#  train  test train = pd.read_csv('train.csv',low_memory=True) test = pd.read_csv('test.csv',low_memory=True)</span></span></code> </pre> <br><h4>  Étape 2: ajout d'un indicateur de source de données </h4><br>  Il est nécessaire d'ajouter un nouvel indicateur indicateur aux deux parties de l'ensemble de données - formation et test.  Pour l'échantillon d'apprentissage avec la valeur «1», pour le test, respectivement, «0». <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#    ,   test,   train test['is_train'] = 0 train['is_train'] = 1</span></span></code> </pre><br><h4>  Étape 3: Combinaison des échantillons d'apprentissage et de test </h4><br>  Vous devez maintenant combiner les deux jeux de données.  Étant donné que l'ensemble de données d'apprentissage contient une colonne de valeurs cibles «cible», qui ne se trouve pas dans l'ensemble de données de test, cette colonne doit être supprimée. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#  train, test df_combine = pd.concat([train, test], axis=0, ignore_index=True) #  target df_combine = df_combine.drop('target', axis =1) y = df_combine['is_train'].values #  x = df_combine.drop('is_train', axis=1).values #  tst, trn = test.values, train.values</span></span></code> </pre><br><h4>  Étape 4: construction et test du classificateur </h4><br>  À des fins de classification, nous utiliserons le classificateur de forêt aléatoire, que nous configurerons pour prédire les étiquettes de la source de données dans l'ensemble de données combiné.  Vous pouvez utiliser n'importe quel autre classificateur. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.ensemble <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RandomForestClassifier <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np rfc = RandomForestClassifier(n_jobs=<span class="hljs-number"><span class="hljs-number">-1</span></span>, max_depth=<span class="hljs-number"><span class="hljs-number">5</span></span>, min_samples_leaf = <span class="hljs-number"><span class="hljs-number">5</span></span>) predictions = np.zeros(y.shape) <span class="hljs-comment"><span class="hljs-comment">#    </span></span></code> </pre><br>  Nous utilisons une répartition aléatoire stratifiée de 4 plis.  De cette façon, nous conserverons le rapport des étiquettes «is_train» dans chaque pli comme dans l'échantillon combiné d'origine.  Pour chaque partition, nous formons le classificateur sur la majorité de la partition et prédisons l'étiquette de classe pour la plus petite partie différée. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.model_selection <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> StratifiedKFold, cross_val_score skf = StratifiedKFold(n_splits=<span class="hljs-number"><span class="hljs-number">4</span></span>, shuffle=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, random_state=<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> fold, (train_idx, test_idx) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(skf.split(x, y)): X_train, X_test = x[train_idx], x[test_idx] y_train, y_test = y[train_idx], y[test_idx] rfc.fit(X_train, y_train) probs = rfc.predict_proba(X_test)[:, <span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-comment"><span class="hljs-comment">#   predictions[test_idx] = probs</span></span></code> </pre><br><h4>  Étape 5: interpréter les résultats </h4><br>  Nous calculons la valeur de la métrique ROC AUC pour notre classificateur.  Sur la base de cette valeur, nous concluons à quel point notre classifieur révèle un changement covariant dans les données. <br><br>  <i>Si le classificateur c sépare bien les objets dans les ensembles de données d'apprentissage et de test, alors la valeur de la métrique ROC AUC devrait être significativement supérieure à 0,5, idéalement proche de 1. Cette image indique un fort changement covariant dans les données.</i> <br><br>  Trouvez la valeur de ROC AUC: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.metrics <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> roc_auc_score print(<span class="hljs-string"><span class="hljs-string">'ROC-AUC:'</span></span>, roc_auc_score(y_true=y, y_score=predictions)) <span class="hljs-comment"><span class="hljs-comment"># ROC-AUC: 0.49974692698385287</span></span></code> </pre><br>  La valeur résultante est proche de 0,5.  Et cela signifie que notre classificateur de qualité est le même qu'un prédicteur d'étiquette aléatoire.  Il n'y a aucune preuve d'un changement covariant dans les données. <br><br>  Étant donné que l'ensemble de données provient de Kaggle, le résultat est assez prévisible.  Comme dans les autres compétitions d'apprentissage automatique, les données sont soigneusement vérifiées pour s'assurer qu'il n'y a pas de changements. <br><br>  Mais cette approche peut être appliquée à d'autres problèmes de science des données pour vérifier la présence d'un décalage covariant juste avant le début de la solution. <br><br><h2>  Etapes supplémentaires </h2><br>  Donc, soit nous observons un décalage covariant ou non.  Que faire pour améliorer la qualité du modèle dans le test? <br><br><ol><li>  Supprimer les fonctionnalités biaisées </li><li>  Utiliser des poids d'importance d'objet basés sur des estimations de coefficient de densité </li></ol><br><h3>  Suppression des fonctionnalités biaisées: </h3><br>  <i><b>Remarque: la</b> méthode est applicable en cas de décalage covariant des données.</i> <br><br><ul><li>  Extrayez l'importance des attributs du Random Forest Classifier, que nous avons construit et formé plus tôt. </li><li>  Les signes les plus importants sont précisément ceux qui sont biaisés et provoquent un changement dans les données. </li><li>  En commençant par le plus important, supprimez sur une base, construisez le modèle cible et examinez sa qualité.  Recueillez tous les signes pour lesquels la qualité du modèle ne diminue pas. </li><li>  Ignorez les caractéristiques collectées des données et construisez le modèle final. </li></ul><br><img src="https://habrastorage.org/webt/oa/ga/08/oaga08t43dtyoazhcor8bk3mb8w.png"><br>  <i>Cet algorithme vous permet de supprimer les signes du panier rouge dans le diagramme.</i> <br><br><h3>  Utilisation de poids d'importance des objets basés sur des estimations de coefficient de densité </h3><br>  <i><b>Remarque: la</b> méthode est applicable qu'il y ait ou non un décalage covariant dans les données.</i> <br><br>  Regardons les prédictions que nous avons reçues dans la section précédente.  Pour chaque objet, la prédiction contient la probabilité que cet objet fasse partie de l'ensemble d'apprentissage pour notre classifieur. <br><br><pre> <code class="python hljs">predictions[:<span class="hljs-number"><span class="hljs-number">10</span></span>] <span class="hljs-comment"><span class="hljs-comment">#array([0.39743827 ...</span></span></code> </pre><br>  Par exemple, pour le premier objet, notre classificateur de forêt aléatoire pense qu'il appartient à l'ensemble d'apprentissage avec une probabilité de 0,397.  Appelez cette valeur <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mi>r</mi><mi>a</mi><mi>i</mi><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.87ex" height="2.66ex" viewBox="0 -832 3819 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-50" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMAIN-28" x="751" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-74" x="1141" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-72" x="1502" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-61" x="1954" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-69" x="2483" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-6E" x="2829" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMAIN-29" x="3429" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi><mo stretchy="false">(</mo><mi>t</mi><mi>r</mi><mi>a</mi><mi>i</mi><mi>n</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-1"> P (train) </script>  .  Ou nous pouvons dire que la probabilité d'appartenance aux données de test est de 0,603.  De même, nous appelons la probabilité <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mi>e</mi><mi>s</mi><mi>t</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.408ex" height="2.66ex" viewBox="0 -832 3189.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-50" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMAIN-28" x="751" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-74" x="1141" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-65" x="1502" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-73" x="1969" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-74" x="2438" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMAIN-29" x="2800" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi><mo stretchy="false">(</mo><mi>t</mi><mi>e</mi><mi>s</mi><mi>t</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-2"> P (test) </script>  . <br><br>  Maintenant une petite astuce: pour chaque objet du jeu de données d'apprentissage, nous calculons le coefficient <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>w</mi><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mi>e</mi><mi>s</mi><mi>t</mi><mo stretchy=&quot;false&quot;>)</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mi>r</mi><mi>a</mi><mi>i</mi><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="26.185ex" height="2.66ex" viewBox="0 -832 11274.1 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-77" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMAIN-3D" x="994" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-66" x="2300" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-72" x="2851" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-61" x="3302" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-63" x="3832" y="0"></use><g transform="translate(4265,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-50" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMAIN-28" x="751" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-74" x="1141" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-65" x="1502" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-73" x="1969" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-74" x="2438" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMAIN-29" x="2800" y="0"></use></g><g transform="translate(7455,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-50" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMAIN-28" x="751" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-74" x="1141" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-72" x="1502" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-61" x="1954" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-69" x="2483" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-6E" x="2829" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMAIN-29" x="3429" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>w</mi><mo>=</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>P</mi><mo stretchy="false">(</mo><mi>t</mi><mi>e</mi><mi>s</mi><mi>t</mi><mo stretchy="false">)</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi>P</mi><mo stretchy="false">(</mo><mi>t</mi><mi>r</mi><mi>a</mi><mi>i</mi><mi>n</mi><mo stretchy="false">)</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-3"> w = \ frac {P (test)} {P (train)} </script>  . <br><br>  Coefficient <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>w</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.664ex" height="1.455ex" viewBox="0 -520.7 716.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-77" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>w</mi></math></span></span><script type="math/tex" id="MathJax-Element-4"> w </script>  nous indique à quel point un objet de l'ensemble d'apprentissage est proche des données de test.  L'idée principale: <br><br>  <i>Nous pouvons utiliser</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>w</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.664ex" height="1.455ex" viewBox="0 -520.7 716.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-77" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>w</mi></math></span></span><script type="math/tex" id="MathJax-Element-5"> w </script></i>   <i>comme les poids dans l'un des modèles pour augmenter le poids des observations qui ressemblent à l'échantillon de test.</i>  <i>Intuitivement, cela a du sens, car notre modèle sera plus orienté données que dans une suite de tests.</i> <br><br>  Ces poids peuvent être calculés à l'aide du code: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> seaborn <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> sns <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> matplotlib.pyplot <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> plt plt.figure(figsize=(<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>)) predictions_train = predictions[:len(trn)] weights = (<span class="hljs-number"><span class="hljs-number">1.</span></span>/predictions_train) - <span class="hljs-number"><span class="hljs-number">1.</span></span> weights /= np.mean(weights) <span class="hljs-comment"><span class="hljs-comment">#  plt.xlabel('  w') plt.ylabel(' ') sns.distplot(weights, kde=False)</span></span></code> </pre><br>  Les coefficients obtenus peuvent être transférés au modèle, par exemple, comme suit: <br><br><pre> <code class="python hljs">rfc = RandomForestClassifier(n_jobs=<span class="hljs-number"><span class="hljs-number">-1</span></span>,max_depth=<span class="hljs-number"><span class="hljs-number">5</span></span>) m.fit(X_train, y_train, sample_weight=weights)</code> </pre><br><br><img src="https://habrastorage.org/webt/_z/nw/rn/_znwrn70amqpw4xosahu1hgj6oa.png"><br><br>  Quelques mots sur l'histogramme résultant: <br><br><ul><li>  Des valeurs de poids plus élevées correspondent à des observations plus similaires à l'échantillon d'essai. </li><li>  Près de 70% des objets de l'ensemble d'entraînement ont un poids proche de 1 et, par conséquent, se trouvent dans un sous-espace qui est également similaire à l'ensemble d'entraînement et à l'ensemble de test.  Cela correspond à la valeur ASC que nous avons calculée précédemment. </li></ul><br><h2>  Conclusion </h2><br>  Nous espérons que ce billet vous aidera à identifier le «changement covariant» dans les données et à le combattre. <br><br><h2>  Les références </h2><br>  [1] Shimodaira, H. (2000).  Amélioration de l'inférence prédictive sous décalage covariable en pondérant la fonction log-vraisemblance.  Journal of Statistical Planning and Inference, 90, 227-244. <br>  [2] Bickel, S. et al.  (2009).  Apprentissage discriminatoire sous décalage covariable.  Journal of Machine Learning Research, 10, 2137–2155 <br>  [3] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/erlendd/covariate-shift-adaption</a> <br>  [4] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien vers l'ensemble de données utilisé</a> <br><br>  PS L'ordinateur portable avec le code de l'article peut être consulté <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr422185/">https://habr.com/ru/post/fr422185/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr422175/index.html">La pollution de l'environnement réduit les capacités cognitives humaines</a></li>
<li><a href="../fr422177/index.html">Pourquoi Arduino est-il si lent et que peut-on faire pour y remédier</a></li>
<li><a href="../fr422179/index.html">Des nuages ​​à la terre: comment créer des Kubernetes de production dans n'importe quel environnement</a></li>
<li><a href="../fr422181/index.html">Comment collecter des services d'entreprise sur une seule plateforme en ligne: l'histoire de MegaFon.</a></li>
<li><a href="../fr422183/index.html">Et quoi, pourrait-il être moins cher?</a></li>
<li><a href="../fr422187/index.html">Sberseasons: comment j'ai passé cet été</a></li>
<li><a href="../fr422189/index.html">La vérité sur la mise en œuvre du portail intranet</a></li>
<li><a href="../fr422191/index.html">Comment j'ai créé une application de reconnaissance de texte Android rentable</a></li>
<li><a href="../fr422195/index.html">L'utilisation d'ACS dans les mines</a></li>
<li><a href="../fr422197/index.html">Nous disons un mot sur le relais</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>