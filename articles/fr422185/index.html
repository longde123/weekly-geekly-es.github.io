<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§‘ğŸ¿â€ğŸ¤â€ğŸ§‘ğŸ¾ ğŸ‘– ğŸ¦— Dans quelle mesure les donnÃ©es pour la formation sur modÃ¨le sont-elles (non) similaires Ã  un Ã©chantillon de test? ğŸ™…ğŸ» ğŸ‘©ğŸ»â€ğŸŒ¾ ğŸ¤ŸğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ConsidÃ©rez un scÃ©nario oÃ¹ votre modÃ¨le d'apprentissage automatique pourrait Ãªtre sans valeur. 

 Il y a un dicton: "Ne comparez pas les pommes avec le...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dans quelle mesure les donnÃ©es pour la formation sur modÃ¨le sont-elles (non) similaires Ã  un Ã©chantillon de test?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422185/">  ConsidÃ©rez un scÃ©nario oÃ¹ votre modÃ¨le d'apprentissage automatique pourrait Ãªtre sans valeur. <br><br>  Il y a un dicton: <i>"Ne comparez pas les pommes avec les oranges"</i> .  Mais que se passe-t-il si vous devez comparer un ensemble de pommes avec des oranges avec un autre, mais la distribution des fruits dans les deux ensembles est diffÃ©rente?  Pouvez-vous travailler avec des donnÃ©es?  Et comment allez-vous le faire? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lt/0y/oi/lt0yoiaq5fua0l1gfpguoigfxfa.png"></div><a name="habracut"></a><br>  Dans les cas rÃ©els, cette situation est courante.  Lors du dÃ©veloppement de modÃ¨les d'apprentissage automatique, nous sommes confrontÃ©s Ã  une situation oÃ¹ notre modÃ¨le fonctionne bien avec un ensemble de formation, mais la qualitÃ© du modÃ¨le diminue fortement sur les donnÃ©es de test. <br><br>  Et il ne s'agit pas de se recycler.  Disons que nous avons construit un modÃ¨le qui donne un excellent rÃ©sultat sur la validation croisÃ©e, mais montre un mauvais rÃ©sultat sur le test.  Ainsi, dans l'Ã©chantillon de test, il y a des informations que nous ne prenons pas en compte. <br><br>  Imaginez une situation dans laquelle nous prÃ©disons le comportement des clients dans un magasin.  Si les exemples de formation et de test ressemblent Ã  l'image ci-dessous, c'est un problÃ¨me clair: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vk/ki/j2/vkkij2n5rlshttroh8mqfse-zf4.png"></div><br>  <i>Dans cet exemple, le modÃ¨le est formÃ© sur des donnÃ©es avec une valeur moyenne de l'attribut Â«Ã¢ge du clientÂ» infÃ©rieure Ã  la valeur moyenne d'un attribut similaire sur le test.</i>  <i>Dans le processus d'apprentissage, le modÃ¨le n'a jamais Â«vuÂ» les valeurs plus importantes de l'attribut Â«Ã¢geÂ».</i>  <i>Si l'Ã¢ge est une caractÃ©ristique importante du modÃ¨le, il ne faut pas s'attendre Ã  de bons rÃ©sultats sur l'Ã©chantillon de test.</i> <br><br>  Dans ce texte, nous parlerons d'approches Â«naÃ¯vesÂ» qui nous permettent d'identifier de tels phÃ©nomÃ¨nes et d'essayer de les Ã©liminer. <br><br><h3>  DÃ©calage covariant </h3><br>  Donnons une dÃ©finition plus prÃ©cise de ce concept.  <b>La covariance</b> fait rÃ©fÃ©rence aux valeurs des caractÃ©ristiques, et le <b>dÃ©calage covariant</b> fait rÃ©fÃ©rence Ã  une situation oÃ¹ la distribution des valeurs des caractÃ©ristiques dans les Ã©chantillons d'apprentissage et d'essai a des caractÃ©ristiques (paramÃ¨tres) diffÃ©rentes. <br><br>  Dans les problÃ¨mes du monde rÃ©el avec un grand nombre de variables, le dÃ©calage covariant est difficile Ã  dÃ©tecter.  L'article traite de la mÃ©thode d'identification et de prise en compte de la variation covariante des donnÃ©es. <br><br><img src="https://habrastorage.org/webt/no/ta/lj/notaljh1r3c8nimkt45_lp3yyco.png"><br><br><h3>  IdÃ©e principale </h3><br>  <i>S'il y a un changement dans les donnÃ©es, alors lors du mÃ©lange des deux Ã©chantillons, nous pouvons construire un classificateur qui peut dÃ©terminer si l'objet appartient Ã  un Ã©chantillon d'apprentissage ou de test.</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pw/v-/42/pwv-42li1_tl9jqyghnph6czcsg.png"></div><br>  Voyons pourquoi il en est ainsi.  Revenons Ã  l'exemple avec les clients, oÃ¹ l'Ã¢ge Ã©tait un signe Â«dÃ©calÃ©Â» des Ã©chantillons de formation et de test.  Si nous prenons un classificateur (par exemple, basÃ© sur une forÃªt alÃ©atoire) et essayons de diviser l'Ã©chantillon mixte en formation et test, alors l'Ã¢ge sera un signe trÃ¨s important pour une telle classification. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/j1/29/wf/j129wfqmbguam_2axs1h6liyt4e.png"></div><br><h3>  ImplÃ©mentation </h3><br>  Essayons d'appliquer l'idÃ©e dÃ©crite Ã  un ensemble de donnÃ©es rÃ©el.  Utilisez l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ensemble</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">donnÃ©es</a> du concours Kaggle. <br><br><h4>  Ã‰tape 1: prÃ©paration des donnÃ©es </h4><br>  Tout d'abord, nous suivrons une sÃ©rie d'Ã©tapes standard: nettoyer, remplir les blancs, effectuer le codage des Ã©tiquettes pour les signes catÃ©goriels.  Aucune Ã©tape n'a Ã©tÃ© requise pour l'ensemble de donnÃ©es en question, alors ignorez sa description. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-comment"><span class="hljs-comment">#  train  test train = pd.read_csv('train.csv',low_memory=True) test = pd.read_csv('test.csv',low_memory=True)</span></span></code> </pre> <br><h4>  Ã‰tape 2: ajout d'un indicateur de source de donnÃ©es </h4><br>  Il est nÃ©cessaire d'ajouter un nouvel indicateur indicateur aux deux parties de l'ensemble de donnÃ©es - formation et test.  Pour l'Ã©chantillon d'apprentissage avec la valeur Â«1Â», pour le test, respectivement, Â«0Â». <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#    ,   test,   train test['is_train'] = 0 train['is_train'] = 1</span></span></code> </pre><br><h4>  Ã‰tape 3: Combinaison des Ã©chantillons d'apprentissage et de test </h4><br>  Vous devez maintenant combiner les deux jeux de donnÃ©es.  Ã‰tant donnÃ© que l'ensemble de donnÃ©es d'apprentissage contient une colonne de valeurs cibles Â«cibleÂ», qui ne se trouve pas dans l'ensemble de donnÃ©es de test, cette colonne doit Ãªtre supprimÃ©e. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#  train, test df_combine = pd.concat([train, test], axis=0, ignore_index=True) #  target df_combine = df_combine.drop('target', axis =1) y = df_combine['is_train'].values #  x = df_combine.drop('is_train', axis=1).values #  tst, trn = test.values, train.values</span></span></code> </pre><br><h4>  Ã‰tape 4: construction et test du classificateur </h4><br>  Ã€ des fins de classification, nous utiliserons le classificateur de forÃªt alÃ©atoire, que nous configurerons pour prÃ©dire les Ã©tiquettes de la source de donnÃ©es dans l'ensemble de donnÃ©es combinÃ©.  Vous pouvez utiliser n'importe quel autre classificateur. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.ensemble <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RandomForestClassifier <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np rfc = RandomForestClassifier(n_jobs=<span class="hljs-number"><span class="hljs-number">-1</span></span>, max_depth=<span class="hljs-number"><span class="hljs-number">5</span></span>, min_samples_leaf = <span class="hljs-number"><span class="hljs-number">5</span></span>) predictions = np.zeros(y.shape) <span class="hljs-comment"><span class="hljs-comment">#    </span></span></code> </pre><br>  Nous utilisons une rÃ©partition alÃ©atoire stratifiÃ©e de 4 plis.  De cette faÃ§on, nous conserverons le rapport des Ã©tiquettes Â«is_trainÂ» dans chaque pli comme dans l'Ã©chantillon combinÃ© d'origine.  Pour chaque partition, nous formons le classificateur sur la majoritÃ© de la partition et prÃ©disons l'Ã©tiquette de classe pour la plus petite partie diffÃ©rÃ©e. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.model_selection <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> StratifiedKFold, cross_val_score skf = StratifiedKFold(n_splits=<span class="hljs-number"><span class="hljs-number">4</span></span>, shuffle=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, random_state=<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> fold, (train_idx, test_idx) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(skf.split(x, y)): X_train, X_test = x[train_idx], x[test_idx] y_train, y_test = y[train_idx], y[test_idx] rfc.fit(X_train, y_train) probs = rfc.predict_proba(X_test)[:, <span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-comment"><span class="hljs-comment">#   predictions[test_idx] = probs</span></span></code> </pre><br><h4>  Ã‰tape 5: interprÃ©ter les rÃ©sultats </h4><br>  Nous calculons la valeur de la mÃ©trique ROC AUC pour notre classificateur.  Sur la base de cette valeur, nous concluons Ã  quel point notre classifieur rÃ©vÃ¨le un changement covariant dans les donnÃ©es. <br><br>  <i>Si le classificateur c sÃ©pare bien les objets dans les ensembles de donnÃ©es d'apprentissage et de test, alors la valeur de la mÃ©trique ROC AUC devrait Ãªtre significativement supÃ©rieure Ã  0,5, idÃ©alement proche de 1. Cette image indique un fort changement covariant dans les donnÃ©es.</i> <br><br>  Trouvez la valeur de ROC AUC: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.metrics <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> roc_auc_score print(<span class="hljs-string"><span class="hljs-string">'ROC-AUC:'</span></span>, roc_auc_score(y_true=y, y_score=predictions)) <span class="hljs-comment"><span class="hljs-comment"># ROC-AUC: 0.49974692698385287</span></span></code> </pre><br>  La valeur rÃ©sultante est proche de 0,5.  Et cela signifie que notre classificateur de qualitÃ© est le mÃªme qu'un prÃ©dicteur d'Ã©tiquette alÃ©atoire.  Il n'y a aucune preuve d'un changement covariant dans les donnÃ©es. <br><br>  Ã‰tant donnÃ© que l'ensemble de donnÃ©es provient de Kaggle, le rÃ©sultat est assez prÃ©visible.  Comme dans les autres compÃ©titions d'apprentissage automatique, les donnÃ©es sont soigneusement vÃ©rifiÃ©es pour s'assurer qu'il n'y a pas de changements. <br><br>  Mais cette approche peut Ãªtre appliquÃ©e Ã  d'autres problÃ¨mes de science des donnÃ©es pour vÃ©rifier la prÃ©sence d'un dÃ©calage covariant juste avant le dÃ©but de la solution. <br><br><h2>  Etapes supplÃ©mentaires </h2><br>  Donc, soit nous observons un dÃ©calage covariant ou non.  Que faire pour amÃ©liorer la qualitÃ© du modÃ¨le dans le test? <br><br><ol><li>  Supprimer les fonctionnalitÃ©s biaisÃ©es </li><li>  Utiliser des poids d'importance d'objet basÃ©s sur des estimations de coefficient de densitÃ© </li></ol><br><h3>  Suppression des fonctionnalitÃ©s biaisÃ©es: </h3><br>  <i><b>Remarque: la</b> mÃ©thode est applicable en cas de dÃ©calage covariant des donnÃ©es.</i> <br><br><ul><li>  Extrayez l'importance des attributs du Random Forest Classifier, que nous avons construit et formÃ© plus tÃ´t. </li><li>  Les signes les plus importants sont prÃ©cisÃ©ment ceux qui sont biaisÃ©s et provoquent un changement dans les donnÃ©es. </li><li>  En commenÃ§ant par le plus important, supprimez sur une base, construisez le modÃ¨le cible et examinez sa qualitÃ©.  Recueillez tous les signes pour lesquels la qualitÃ© du modÃ¨le ne diminue pas. </li><li>  Ignorez les caractÃ©ristiques collectÃ©es des donnÃ©es et construisez le modÃ¨le final. </li></ul><br><img src="https://habrastorage.org/webt/oa/ga/08/oaga08t43dtyoazhcor8bk3mb8w.png"><br>  <i>Cet algorithme vous permet de supprimer les signes du panier rouge dans le diagramme.</i> <br><br><h3>  Utilisation de poids d'importance des objets basÃ©s sur des estimations de coefficient de densitÃ© </h3><br>  <i><b>Remarque: la</b> mÃ©thode est applicable qu'il y ait ou non un dÃ©calage covariant dans les donnÃ©es.</i> <br><br>  Regardons les prÃ©dictions que nous avons reÃ§ues dans la section prÃ©cÃ©dente.  Pour chaque objet, la prÃ©diction contient la probabilitÃ© que cet objet fasse partie de l'ensemble d'apprentissage pour notre classifieur. <br><br><pre> <code class="python hljs">predictions[:<span class="hljs-number"><span class="hljs-number">10</span></span>] <span class="hljs-comment"><span class="hljs-comment">#array([0.39743827 ...</span></span></code> </pre><br>  Par exemple, pour le premier objet, notre classificateur de forÃªt alÃ©atoire pense qu'il appartient Ã  l'ensemble d'apprentissage avec une probabilitÃ© de 0,397.  Appelez cette valeur <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mi>r</mi><mi>a</mi><mi>i</mi><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.87ex" height="2.66ex" viewBox="0 -832 3819 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-50" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMAIN-28" x="751" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-74" x="1141" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-72" x="1502" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-61" x="1954" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-69" x="2483" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-6E" x="2829" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMAIN-29" x="3429" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi><mo stretchy="false">(</mo><mi>t</mi><mi>r</mi><mi>a</mi><mi>i</mi><mi>n</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-1"> P (train) </script>  .  Ou nous pouvons dire que la probabilitÃ© d'appartenance aux donnÃ©es de test est de 0,603.  De mÃªme, nous appelons la probabilitÃ© <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mi>e</mi><mi>s</mi><mi>t</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.408ex" height="2.66ex" viewBox="0 -832 3189.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-50" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMAIN-28" x="751" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-74" x="1141" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-65" x="1502" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-73" x="1969" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-74" x="2438" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMAIN-29" x="2800" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi><mo stretchy="false">(</mo><mi>t</mi><mi>e</mi><mi>s</mi><mi>t</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-2"> P (test) </script>  . <br><br>  Maintenant une petite astuce: pour chaque objet du jeu de donnÃ©es d'apprentissage, nous calculons le coefficient <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>w</mi><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mi>e</mi><mi>s</mi><mi>t</mi><mo stretchy=&quot;false&quot;>)</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mi>r</mi><mi>a</mi><mi>i</mi><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="26.185ex" height="2.66ex" viewBox="0 -832 11274.1 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-77" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMAIN-3D" x="994" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-66" x="2300" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-72" x="2851" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-61" x="3302" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-63" x="3832" y="0"></use><g transform="translate(4265,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-50" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMAIN-28" x="751" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-74" x="1141" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-65" x="1502" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-73" x="1969" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-74" x="2438" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMAIN-29" x="2800" y="0"></use></g><g transform="translate(7455,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-50" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMAIN-28" x="751" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-74" x="1141" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-72" x="1502" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-61" x="1954" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-69" x="2483" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-6E" x="2829" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMAIN-29" x="3429" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>w</mi><mo>=</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>P</mi><mo stretchy="false">(</mo><mi>t</mi><mi>e</mi><mi>s</mi><mi>t</mi><mo stretchy="false">)</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi>P</mi><mo stretchy="false">(</mo><mi>t</mi><mi>r</mi><mi>a</mi><mi>i</mi><mi>n</mi><mo stretchy="false">)</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-3"> w = \ frac {P (test)} {P (train)} </script>  . <br><br>  Coefficient <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>w</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.664ex" height="1.455ex" viewBox="0 -520.7 716.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-77" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>w</mi></math></span></span><script type="math/tex" id="MathJax-Element-4"> w </script>  nous indique Ã  quel point un objet de l'ensemble d'apprentissage est proche des donnÃ©es de test.  L'idÃ©e principale: <br><br>  <i>Nous pouvons utiliser</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>w</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.664ex" height="1.455ex" viewBox="0 -520.7 716.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhj9NvoOmPeo88uhC7CpkT6iqKBgmQ#MJMATHI-77" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>w</mi></math></span></span><script type="math/tex" id="MathJax-Element-5"> w </script></i>   <i>comme les poids dans l'un des modÃ¨les pour augmenter le poids des observations qui ressemblent Ã  l'Ã©chantillon de test.</i>  <i>Intuitivement, cela a du sens, car notre modÃ¨le sera plus orientÃ© donnÃ©es que dans une suite de tests.</i> <br><br>  Ces poids peuvent Ãªtre calculÃ©s Ã  l'aide du code: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> seaborn <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> sns <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> matplotlib.pyplot <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> plt plt.figure(figsize=(<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>)) predictions_train = predictions[:len(trn)] weights = (<span class="hljs-number"><span class="hljs-number">1.</span></span>/predictions_train) - <span class="hljs-number"><span class="hljs-number">1.</span></span> weights /= np.mean(weights) <span class="hljs-comment"><span class="hljs-comment">#  plt.xlabel('  w') plt.ylabel(' ') sns.distplot(weights, kde=False)</span></span></code> </pre><br>  Les coefficients obtenus peuvent Ãªtre transfÃ©rÃ©s au modÃ¨le, par exemple, comme suit: <br><br><pre> <code class="python hljs">rfc = RandomForestClassifier(n_jobs=<span class="hljs-number"><span class="hljs-number">-1</span></span>,max_depth=<span class="hljs-number"><span class="hljs-number">5</span></span>) m.fit(X_train, y_train, sample_weight=weights)</code> </pre><br><br><img src="https://habrastorage.org/webt/_z/nw/rn/_znwrn70amqpw4xosahu1hgj6oa.png"><br><br>  Quelques mots sur l'histogramme rÃ©sultant: <br><br><ul><li>  Des valeurs de poids plus Ã©levÃ©es correspondent Ã  des observations plus similaires Ã  l'Ã©chantillon d'essai. </li><li>  PrÃ¨s de 70% des objets de l'ensemble d'entraÃ®nement ont un poids proche de 1 et, par consÃ©quent, se trouvent dans un sous-espace qui est Ã©galement similaire Ã  l'ensemble d'entraÃ®nement et Ã  l'ensemble de test.  Cela correspond Ã  la valeur ASC que nous avons calculÃ©e prÃ©cÃ©demment. </li></ul><br><h2>  Conclusion </h2><br>  Nous espÃ©rons que ce billet vous aidera Ã  identifier le Â«changement covariantÂ» dans les donnÃ©es et Ã  le combattre. <br><br><h2>  Les rÃ©fÃ©rences </h2><br>  [1] Shimodaira, H. (2000).  AmÃ©lioration de l'infÃ©rence prÃ©dictive sous dÃ©calage covariable en pondÃ©rant la fonction log-vraisemblance.  Journal of Statistical Planning and Inference, 90, 227-244. <br>  [2] Bickel, S. et al.  (2009).  Apprentissage discriminatoire sous dÃ©calage covariable.  Journal of Machine Learning Research, 10, 2137â€“2155 <br>  [3] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/erlendd/covariate-shift-adaption</a> <br>  [4] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien vers l'ensemble de donnÃ©es utilisÃ©</a> <br><br>  PS L'ordinateur portable avec le code de l'article peut Ãªtre consultÃ© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr422185/">https://habr.com/ru/post/fr422185/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr422175/index.html">La pollution de l'environnement rÃ©duit les capacitÃ©s cognitives humaines</a></li>
<li><a href="../fr422177/index.html">Pourquoi Arduino est-il si lent et que peut-on faire pour y remÃ©dier</a></li>
<li><a href="../fr422179/index.html">Des nuages â€‹â€‹Ã  la terre: comment crÃ©er des Kubernetes de production dans n'importe quel environnement</a></li>
<li><a href="../fr422181/index.html">Comment collecter des services d'entreprise sur une seule plateforme en ligne: l'histoire de MegaFon.</a></li>
<li><a href="../fr422183/index.html">Et quoi, pourrait-il Ãªtre moins cher?</a></li>
<li><a href="../fr422187/index.html">Sberseasons: comment j'ai passÃ© cet Ã©tÃ©</a></li>
<li><a href="../fr422189/index.html">La vÃ©ritÃ© sur la mise en Å“uvre du portail intranet</a></li>
<li><a href="../fr422191/index.html">Comment j'ai crÃ©Ã© une application de reconnaissance de texte Android rentable</a></li>
<li><a href="../fr422195/index.html">L'utilisation d'ACS dans les mines</a></li>
<li><a href="../fr422197/index.html">Nous disons un mot sur le relais</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>