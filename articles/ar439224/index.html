<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤴🏻 🔧 🤙🏻 مرة أخرى حول المخططات فورونوي 🚶🏾 👠 ⚒️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="كما هو مكتوب في منشورات المدونة الحديثة ، كافحت للحصول على تفاصيل الخط الساحلي الصحيح في لعبة Dragons Abound . نشأت خيبة أملي أثناء تنفيذ الجزر الحاجز...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>مرة أخرى حول المخططات فورونوي</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439224/" style=";text-align:right;direction:rtl">  كما هو مكتوب في <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">منشورات</a> المدونة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الحديثة</a> ، كافحت للحصول على تفاصيل الخط الساحلي الصحيح في لعبة <b>Dragons Abound</b> .  نشأت خيبة أملي أثناء تنفيذ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الجزر الحاجزة</a> .  لإنشاء أضيق جزيرة ممكنة ، جعلتها موقعًا واحدًا واسعًا - في الشكل أدناه ، كل موقع مثلث Delaunay: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/5dc/cce/739/5dccce739bdcd3372876b7cff72b4f0e.png"></div><br>  كان هذا غير سارة إلى حد ما - سواء لأن الجزيرة كانت مكسورة للغاية ولأن حجم الأجزاء كان كبيرًا جدًا.  يبدو أنه مع زيادة كبيرة في عدد مثلثات Delaunay (أي ، مع انخفاض قوي في حجمها) ، سيتم حل هذه المشكلة - لكن كثافة المثلثات التي أحتاجها أدت إلى تعطل المتصفح. <br><a name="habracut"></a><br>  لقد قمت بحل هذه المشكلة عن طريق فصل معالم الأرض عن التمثيل الداخلي للمواقع.  هذا سمح لي برسم جزر من أي حجم أو شكل ، بغض النظر عن شبكة الموقع الأساسية: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/b2e/8a2/351/b2e8a235144cb7c07c9d374980be1782.png"></div><br>  لذلك تم حل المشكلة!  سمح لي ذلك برسم الجزر الحاجزة ، وبما أن الخط الساحلي لم يعد مطلوبًا لمتابعة الشبكة الأساسية ، إذا لزم الأمر ، يمكن إنشاء خط ساحلي أكثر تفصيلًا بالطريقة المعتادة ، ثم إضافة تفاصيل. <br><br>  لكن ... كيف نضيف التفاصيل إلى الساحل؟  الأمر ليس سهلاً كما تعتقد.  نظرًا لأنني أردت إنشاء خط ساحلي كسري ، فكرت في استخدام كسورية <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">لإضافة تفاصيل</a> إلى الخط الساحلي: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/5b3/f94/9fd/5b3f949fd2649767029f2768d55a8185.png"></div><br>  بعد تجربة الإعدادات ، تمكنت من إضافة الكثير من التفاصيل والأشياء المثيرة للاهتمام إلى الساحل.  ومع ذلك ، لا يمكن للنظام إنشاء شيء يشبه هذه الخريطة: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/0ed/03d/701/0ed03d701f34074236f314574162073f.png"></div><br>  <i>يمكن</i> لضوضاء بيرلين <i>أن</i> تخلق هذا النوع من التضاريس إذا كانت هناك شبكة أساسية مفصلة بما فيه الكفاية ، ولكن هل يمكن القيام بذلك <i>دون</i> تخزين ارتفاعات الارتفاع في الشبكة الأساسية بالدقة المطلوبة (بعد كل شيء ، أعرف أن هذا سيؤدي إلى كسر الشفرة الخاصة بي)؟  حتى اكتشفت كيفية القيام بذلك.  يعد الخط الساحلي أساسًا طريقًا عبر جميع النقاط التي يكون لقيمة ضوضاء Perlin فيها قيمة صفرية.  على الرغم من أننا يمكن أن نتعلم مباشرة من دالة Perlin الضوضاء القيمة في موقع معين (X ، Y) ، لا يمكننا العثور على (قل) "جميع المواقع التي لها قيمة صفرية".  بمعنى أنه من الصعب معرفة كيفية رسم محيط مرتفع بدون شبكة أساسية. <br><br>  والأسوأ من ذلك ، سألت <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">أميت عن</a> كيفية القيام بذلك ، كما أنه لم يكن يعرف الإجابة.  إنه شيء واحد عندما لا أستطيع أن أقول هذا ، لكن حتى عندما لا يستطيع هذا الشخص الذكي الإجابة ، أبدأ في التفكير في أنه لا يمكن القيام بذلك.  إنه لأمر محزن.  يمكنني إعطاء الخط الساحلي أي شكل أحتاج إليه ، لكن لا يمكنني الحصول على الأشكال التي أحتاجها دون شبكة أساسية مفصلة للغاية. <br><br>  فكيف أحصل على شبكة عالية الدقة دون كسر الشفرة؟ <br><br>  أحد الحلول التي تتبادر إلى ذهني يذكرني بما <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">فعله أزجار</a> في مولد <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">بطاقاته</a> - خلايا فورونوي المتغيرة الحجم.  الفكرة الرئيسية هي زيادة كثافة (وتقليل حجم) الشبكة الأساسية على طول الخطوط الساحلية والحفاظ على كثافة أقل في المحيطات وغيرها من المناطق التي لا تتطلب تفاصيل.  مع هذا الخيار ، سيكون لدي العديد من خلايا الشبكات فقط في المناطق التي تحتاج إلى تفاصيل.  سيكون هذا التغيير صعب التنفيذ في <b>Dragons Abound</b> ، لكنني أريد التفكير فيه.  من ناحية أخرى ، <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">لم يكن</a> Azgaar نفسه <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">مسرورًا جدًا بهذا النهج</a> ، لذلك يجب أيضًا مراعاة ذلك. <br><br>  في موازاة ذلك ، أردت التحقق من أسباب تعطل المتصفح عند معالجة كومة من المثلثات.  زودتني أدوات المطور في Chrome بمعلومات أداء مفصلة.  أنا لست خبيراً بأي حال من الأحوال في استخدام هذه الأدوات ، ولكن العديد من الوظائف بسيطة بما يكفي لكي يفهمها أي شخص.  في حالة الرغبة في معرفة إجمالي حجم الذاكرة المستخدمة في البرنامج ، تحتوي علامة التبويب "الذاكرة" على معلومات حول السعة المستخدمة الحالية: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/ccd/da9/c31/ccdda9c31c29814b1ffa88b0ae5eefce.png"></div><br>  في هذه الحالة ، فتحت صفحة الويب Azgaar ، وتستهلك ذاكرة متواضعة 20 ميغابايت.  يمكنك استخدام هذه الأداة لمعرفة مقدار الذاكرة التي يشغلها <b>Dragons Abound</b> ولتحديد وقت تعطل علامة التبويب. <br><br>  المعلمة الأساسية التي تتحكم في دقة الشبكة الأساسية في <b>Dragons</b> Abound تسمى بذكاء "npts" (عدد النقاط).  لكل مساحة وحدة للخريطة (خرائط المناطق التي عادةً ما استخدمها كأمثلة لها مساحة وحدة واحدة) ينشئ <b>Dragons Abound</b> عددًا <b>محددًا</b> من مواقع الشبكة الأساسية.  عادةً ما أستخدم 16 كيلو بايت (16384) ل npts ، مما يعني أن كل موقع شبكة يتوافق مع حوالي 70 بكسل مربع من الشاشة بمقياس تكبير قياسي. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/73d/0a7/6ca/73d0a76ca2e25bf5c5724ef2c446b25c.png"></div><br>  بالطبع ، يعتمد مقدار الذاكرة المستخدم بالضبط على البطاقة ، لكن بالنسبة للبطاقة الموضحة أعلاه والتي تحتوي على 16 كيلو نقطة ، تحتاج إلى 92 ميغابايت تقريبًا: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/82e/f8f/8c2/82ef8f8c28678bfb47a7a642761fe11e.png"></div><br>  هذا أقل مما كنت أتوقع ، ولكي أكون أمينًا ، شخصية متواضعة إلى حد ما. <br><br>  إذا قمت بمضاعفة عدد النقاط في الشبكة الأساسية ، فستزيد سعة الذاكرة إلى 138 ميغابايت: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/40d/beb/ad7/40dbebad7c52e1e833fef7372ac7d1d9.png"></div><br>  لم يتضاعف حجم الذاكرة المشغولة ، لأن جزءًا من هذه الذاكرة مشغولة بالموارد وبنية البيانات الأخرى التي لم يتغير حجمها.  16 كيلوبايت من النقاط الإضافية "تزن" حوالي 50 ميغابايت من الذاكرة ، أي ، تشغل كل نقطة كنتيجة تقريبًا 3 كيلوبايت من الذاكرة.  هذا أكثر مما كنت أتوقع ، ولكن بصفة عامة لا يزال حجم التداول متواضعًا جدًا.  على جهاز كمبيوتر يحتوي على ذاكرة 64 جيجابايت ، بالكاد يكون 150 ميجابايت ملحوظًا. <br><br>  بعد القيام ببعض الزوجي ، وجدت أن علامة التبويب مع <b>Dragons Abound</b> تعطل عادة عند حوالي 128 ألف نقطة.  إذا قبضنا عليها قبل أن تطير ونفحص الذاكرة ، فسنرى ما يلي: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/718/c57/d27/718c57d27a1bce96fa73943e53196b9a.png"></div><br>  افترضت أن علامة التبويب تعطل بسبب الذاكرة المحتلة ، ولكن عادة ما تكون المشكلة ليست في الذاكرة.  لماذا تعطل علامة التبويب؟  الدليل الوحيد هو أن علامة التبويب لا تتعطل إلى أن تكتمل الخريطة ، وربما يكون هذا مؤشرا على أن التعطل يحدث أثناء العرض. <br><br>  من المنطقي أن نفترض أن SVG I create overloader render render نظرًا لحجمه أو تعقيده.  للبدء ، يمكنني معرفة عدد عناصر SVG التي أقوم بإنشائها.  في D3 ، يمكنني الحصول على إجمالي عدد عناصر SVG التي تم إنشاؤها باستخدام <code>svg.selectAll('*').size()</code> . <br><br>  ركض من 16 كيلو نقطة والتحقق من عدد عناصر SVG أظهر لي ما يلي: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/14a/d15/77d/14ad1577d0e1f61b29e76bc36f57961f.png"></div><br>  تحتوي النقاط 32K على 65457 عنصرًا ، وتحتوي النقاط 128K على 258823. كل نقطة تضاف إلى الشبكة الأساسية تضيف عنصرين إلى الخريطة.  أعتقد أنني وجدت مصدرًا للحزن. <br><br>  تضيف كل نقطة شبكة عناصر SVG بسبب الطريقة التي <b>تجعل</b> بها <b>Dragons Abound</b> الأرض (والمياه).  يتم تقديم الأرض عن طريق جعل كل موقع أساسي كمضلع ممتلئ ، متبوعًا بطمس كل منهم.  يتيح هذا لـ <b>Dragons Abound</b> منح الأرض نموذجًا جميلًا أو استخدام ارتفاع الأرض لتقديم التظليل ثلاثي الأبعاد للأرض ، كما هو موضح هنا: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/294/b56/8c4/294b568c4939a297253b4fe4172eac0b.png"></div><br>  يمكنك إيقاف تشغيل تصور الأرض والمحيط للتحقق من عدد عناصر SVG التي تم إنشاؤها.  عند 256 ألف نقطة: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/ad7/e09/1e6/ad7e091e6c4c6de42207734830d508af.png"></div><br>  واو ، انخفض عدد عناصر SVG بشكل ملحوظ.  كما كنت آمل ، الآن يتم تقديم الخريطة دون تعطل!  وهذا هو ، إذا كنت تتجنب استخدام شبكة لجعل الأرض والمياه ، يمكنك إنشاء شبكة أكثر كثافة من ذي قبل. <br><br>  الآن لدي شبكة فورونوي الأكثر كثافة ، أريد أن أتحقق مما إذا كان ذلك يسمح لي بتوليد عناصر الإغاثة التي أحتاجها ، مثل الجزر الساحلية.  تخلق شبكة فورونوي الكثيفة مشاكل أخرى (خاصة مع الأنهار) ، لذلك سأطفئ كل شيء باستثناء الخطوط الساحلية لتسريع الاختبار والتركيز عليها.  في ما يلي العرض الأصلي لبعض الخط الساحلي عند 256 كيلو بكسل وبه ضوضاء قياسية: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/7c4/bad/0a0/7c4bad0a043f626a83d3edb071e5c77f.png"></div><br>  اتضح أن الخريطة تظهر جيدًا ، وأنها تخلق بالفعل ساحلًا أكثر جمالا. <br><br>  حتى بدون ضبط دقيق ، فإن النتيجة أفضل بكثير.  يخلق الضجيج أنواع السواحل الكسورية والجزر الساحلية التي أشرت إليها على الخريطة أعلاه. <br><br>  هنا الجزر مع زيادة قدرها 300 ٪: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/b70/32e/471/b7032e471d8ac9c0029781799a43af56.png"></div><br>  مع هذه الزيادة ، يمكنك أن تلاحظ القطع الأثرية للمثلثات من الشبكة الأساسية ، ولكن رغم ذلك ، يمكن للجزر إنشاء أشكال مثيرة للاهتمام.  يمكنك استخدام مكافحة التعرجات (كما أفعل في الإصدار الحالي من الخرائط) للتخلص من بعض التحف الأكثر شهرة في المثلثات.  عند التكبير القياسي ، يوفر هذا خطًا ساحليًا أقل وعرة ، ولكنه يلغي أيضًا بعض التفاصيل الصغيرة: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/c6f/783/120/c6f78312049d55db06e1776250ce520a.png"></div><br>  ربما يتعين عليك الاستماع للحصول على حل وسط. <br><br>  تستخدم معظم مولدات السوشي الإجرائية ضوضاء بيرلين لإنشاء خريطة ارتفاع.  نحتاج إلى العثور على معلمات الضوضاء المناسبة ، وتحديد بذرة ، ثم استخدام قيمة الضوضاء في كل موقع (س ، ص) لضبط كتلة الأرض.  يتمثل أحد الجوانب الملائمة لصنع الأرض في أنه إذا كنت بحاجة إلى مزيد من التفاصيل على الساحل ، فيمكنك ببساطة ضبط معلمات الضوضاء. <br><br>  ومع ذلك ، لا تنشئ <b>Dragons Abound</b> الأرض بهذه الطريقة.  (أو على الأقل يخلق أكثر من ذلك). يستخدم <b>Dragons Abound</b> العديد من الطرق المختلفة لإنشاء السوشي.  على الرغم من أنهم جميعا يستخدمون الضوضاء بدرجة أو بأخرى ، إلا أن قلة قليلة منهم تخلق الأرض مباشرة من الضوضاء.  على سبيل المثال ، تحتوي اللعبة على إجراء لإنشاء جزيرة ، والتي تنشئ قناعًا للجزيرة (عادة ما يكون القطع الناقص) ، وتستخدم الضوضاء لجعل القطع الناقص أكثر طبيعية ، ثم تطبق ضوضاء مختلفة لتقريب ملء القناع.  عادة ما يتم إنشاء كل خريطة معينة من خلال مجموعة من الإجراءات المختلفة.  لذلك ، لا تعد إضافة تفاصيل عن طريق ضبط معلمات الضوضاء لـ <b>Dragons Abound</b> مناسبة للغاية. <br><br>  لأغراضي ، من الأفضل التعامل مع المشكلة من زاوية مختلفة قليلاً.  إذا كان لدي خريطة ارتفاع محددة تحدد الكتل الأرضية ، فكيف يمكنني إضافة تفاصيل إلى حواف هذه الكتل الأرضية؟  قد يقودنا هذا إلى فكرة أننا بحاجة إلى التعرف على حواف الكتل الأرضية وإخفاء بقية الخريطة ، إلخ.  لكن ، من ناحية أخرى ، لست ضد إطلاقًا إضافة تفاصيل إضافية إلى بقية الخريطة.  إذا كانت الأرض غير مستوية قليلاً أو كان قاع المحيط أشد قليلاً ، فهذا طبيعي. <br><br>  ماذا تعني إضافة تفاصيل إلى الخط الساحلي؟  الخط الساحلي هو ببساطة خط كفاف فيه خريطة ارتفاع لها قيمة صفرية.  (القيمة تعسفية ، ولكن يتم استخدام مثل هذا المبدأ في كل مولد أرض إجرائي.) لجعل هذا الخط أكثر تفصيلاً ، تحتاج إلى تحريك الأرض قليلاً بجوار خط الكنتور هذا لأعلى ولأسفل قليلاً ، حتى تصبح الخطوط الساحلية البسيطة أكثر تعقيدًا ، وتبرز أجزاء من الأرض في المحيط وتصبح الجزر ، وهلم جرا.  ولكن هذا لا ينبغي أن يحدث عن طريق الصدفة ، أريد أن تبدو التغييرات طبيعية.  نلخص كل هذا ، ويبدو أنك تحتاج إلى إضافة مقدار صغير من الضوضاء إلى الخريطة بأكملها.  وفي الحقيقة هذا بالضبط ما فعلته في المثال الأصلي الموضح أعلاه. <br><br>  بالطبع ، يجب أن يتم ذلك بعناية حتى لا تمحو كتل الأرض التي تم إنشاؤها وخلق مشاكل أخرى.  في الأساس ، أحتاج إلى تكوين ثلاثة معلمات. <br><br>  الأول هو مقياس الضوضاء.  المقياس هو مجرد فاصل من القيم لهذه الضوضاء.  في حالتنا ، أريد خفض بعض المناطق لأسفل ، ورفع بعضها للأعلى ، لذلك يجب أن يكون نطاق القيم من سلبي إلى إيجابي.  ومع ذلك ، لا أريد إضافة جبال جديدة أو إنشاء محيط بعيد عن الخط الساحلي الحالي ، لذا سأجعل القيمة القصوى (المطلقة) للضوضاء جزءًا صغيرًا من ارتفاع الأرض القياسي. <br><br>  المعلمة الثانية هي التردد الرئيسي للضوضاء.  يحدد التردد مدى سرعة تغير الضوضاء داخل الموقع.  تتغير الضوضاء منخفضة التردد ببطء شديد ، لذلك (يمكن القول) أن المنطقة الإيجابية ذات الضوضاء المنخفضة يمكن أن تغطي الخريطة بأكملها.  تتغير الضوضاء عالية التردد بسرعة ، لذلك (يمكن القول) أن المنطقة الإيجابية ذات الضوضاء العالية يمكن أن يكون لها حجم جزيرة صغيرة.  في حالتنا ، يحدد تردد الضوضاء الرئيسي أكبر عناصر الإغاثة التي سنراها في الضوضاء.  هذا هو ، إذا كنت تريد أن تضيف الضوضاء (لنقل) جزر صغيرة (ولكن لا شيء أكبر منها) إلى الخريطة ، فأنا بحاجة إلى تحديد التكرار الرئيسي بحجم جزيرة صغيرة. <br><br>  قد تعتقد أن هذا أمر سهل (ما عليك سوى قياس جزيرة صغيرة وتعيين هذا الحجم للتردد الرئيسي).  ومع ذلك ، يتم قياس التردد في إحداثيات وظيفة الضوضاء ، وليس إحداثيات الخريطة!  يمكن أن تحتوي وظيفة الضوضاء النموذجية على فاصل زمني من 0 إلى 255 في كل إحداثي ، ويمكن أن تحتوي الخريطة على فاصل زمني من -1 إلى 1. في كل إحداثي ، والأسوأ من ذلك ، أنهارت إحداثيات الضوضاء ، ولا يدرك العديد من المستخدمين الذين يستخدمون الضوضاء ذلك.  تعتبر الترجمة من وحدة إلى أخرى وتحديد الترددات المناسبة أمرًا مربكًا ، لذلك يكون من الأسهل عادة فقط تجربة الفواصل الزمنية للتردد واختيار الوحدة التي تنشئ عناصر البطاقة بالحجم الصحيح. <br><br>  المعلمة الثالثة هي عدد أوكتافات الضوضاء.  أوكتافيس هي طبقات إضافية من الضوضاء.  كل طبقة تضاعف التردد وتقلل من نطاق الضوضاء إلى النصف.  أي أن كل طبقة جديدة تضيف عناصر الإغاثة أقل مرتين من الطبقة السابقة ، ولكن أيضًا أضعف مرتين.  وهذا يعني أنك تحتاج إلى تحديد عدد أوكتافات تعطي أصغر العناصر التي نحتاجها ، ولهذا قد تحتاج إلى ضبط مقياس الضوضاء ، لأنه لا يزال قوياً بما يكفي في أعلى أوكتاف لتظهر على الخريطة.  بما أنني قمت بذلك عن قصد لجعل الخطوط الساحلية معقدة للغاية ، فسأستخدم عددًا لا بأس به من أوكتافات الضوضاء. <br><br>  دعنا نبدأ مع الإعداد.  للبدء ، سوف أقوم بإنشاء خريطة مثال دون ضجيج إضافي: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/cf2/e89/ce9/cf2e89ce9f62d676f9659141be032e15.png"></div><br>  من الواضح أن هذا الخط الساحلي ممل مع خطوط ناعمة وعدة جزر كبيرة.  هذا هو نفس الخط الساحلي مع عينة الضوضاء الأصلية: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/035/e88/a62/035e88a62f7f2a79fd41e573016bb3aa.png"></div><br>  غير الضجيج بشكل كبير شكل الخريطة ، حيث حول شظايا كبيرة من الأرض إلى محيط ، والعكس بالعكس.  ظهرت العديد من الجزر ، بما في ذلك في البحر.  كل هذا يشير إلى أن مقياس الضوضاء كبير جدًا.  يجب أن تكون أكبر عناصر الإغاثة الفردية المضافة بواسطة الضوضاء هي حجم الجزر الصغيرة في الخريطة الأصلية.  ربما يكون هذا هو الحجم الأقصى الجديد للعناصر ، مما يثبت أن التردد الرئيسي للضوضاء يتم اختياره تقريبًا بشكل صحيح.  أخيرًا ، ظهرت الكثير من التفاصيل الصغيرة ، وصولًا إلى حدود حجم الشاشة ، وهذا يدل على وجود عدد كافٍ من الأوكتافات.  (ومع ذلك ، قد يكون عدد أوكتافات أكثر من اللازم. هذا لا يؤثر على مظهر البطاقة ، لكنه غير فعال.) يبدو أنك بحاجة إلى ضبط مقياس الضوضاء بشكل أساسي. <br><br>  يعد ضبط الضوضاء عملية معقدة إلى حد ما لأنني أريد أن تؤثر هذه الضوضاء بشكل أساسي على الأرض والمياه عند خط كفافي يبلغ ارتفاعه 0 درجة تقريبًا. وهذا يعني أنني بحاجة إلى نطاق صغير نسبيًا ، لكن ليس من الواضح كيفية اختيار الرقم الصحيح ، لأن في خرائط مختلفة ، يختلف توزيع المرتفعات.  الحل هو العثور على المقياس الصحيح أثناء الطيران.  يمكنك أخذ جميع القيم المطلقة للارتفاعات على الخريطة ، وفرزها ، والعثور على نقطة القطع التي تحدد (مثلا) 10 ٪ من المواقع حول الصفر.  تقع جميع هذه المواقع في الفاصل الزمني (على سبيل المثال) [-0.05 ، 0.05] ، وبعد ذلك يمكنني استخدام القيمة 0.05 لتحديد مقياس الضوضاء المضافة. <br><br>  (أكتب "تعريفات" لأنه لأسباب مختلفة لا يمكنك فقط استخدام 0.05. أولاً تحتاج إلى تحويل الأرض إلى ماء والعكس بالعكس. إضافة (قل) 0.002 إلى -0.05 لن تؤدي إلى أي تغييرات مرئية على الخريطة ، أي أن الفاصل الزمني يجب أن يكون أكثر من 0.05 إذا كنت أرغب في تحويل نسبة كبيرة من المواقع التي يبلغ ارتفاعها -0.05 من الماء إلى الأرض ، وثانيا ، لا يتم <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">توزيع</a> وظائف الضوضاء بشكل <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">متساوٍ</a> ، لذلك بمقياس 0.05 ، لن تعود وظيفة الضوضاء فعليًا إلى 0.05! يجب أن يكون الحجم أكبر بكثير  من أكبر القيم التي نريد أن نرى في كثير من الأحيان بما فيه الكفاية.) <br><br>  بعد أن جربت ذلك ، وجدت قيمة تضيف التعقيد إلى السواحل ، مع عدم تغييرها بشكل كبير ، وكذلك إنشاء عدد صغير من الجزر: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/3f9/2e5/19c/3f92e519c2370c7bbaa3338ef65a0944.png"></div><br>  كالمعتاد ، يمكن أن تأخذ هذه المعلمات في اللعبة فاصلًا من القيم ، لذلك يمكنني الحصول على مجموعة واسعة من البطاقات: من البطاقات ذات السواحل الناعمة إلى حد ما إلى البطاقات ذات البنوك المكسورة والمعقدة.  ترك البرنامج يختار القيم ، حصلت على النتيجة التالية: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/43f/275/649/43f2756497cf54b7f95aa6a8f9cd5618.png"></div><br>  تقع السواحل على الجانب الأكثر سلاسة ، لكن لا يزال هناك الكثير من التعقيد الإضافي في الحجم المتوسط ​​وعدد كافٍ من الجزر الجديدة. <br><br>  عند تنفيذ السواحل الكسورية ، أدركت القدرة على التحكم في مستوى التكسير باستخدام وظيفة الضوضاء ، لذلك سيكون لبعض المناطق سواحل سلسة ، بينما سيكون لسواحل أخرى مناطق معقدة.  اعتقدت أن هذا سيزيد من اهتمام الخريطة إلى حد كبير ، وسيبدو أقل "تم إنشاؤه" ، لذلك سأضيف هذه الميزة هنا.  الفكرة بسيطة للغاية - قبل إضافة ضوضاء الخط الساحلي إلى الخريطة ، قمت بضربها بإخراج وظيفة الضوضاء الثانية ، والتي تتراوح من صفر إلى 1. عندما تكون هذه الوظيفة صغيرة ، ستضاف التفاصيل الصغيرة إلى الخطوط الساحلية.  عند الاقتراب من 1 ، سيتم إضافة تفاصيل إضافية بالكامل.  عند تحديد مقياس وظيفة الضوضاء الثانية ، والتي تتباين ببطء على الخريطة ، سأحصل على بعض المناطق ذات الخطوط الساحلية المعقدة ، وبعضها مع خطوط بسيطة ، والانتقالات المنطقية بينها: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/095/4a0/350/0954a03506ed074216606083654ceb08.png"></div><br>  أنا هنا جعلت المعلمات الساحلية كبيرة ، بحيث يكون الفرق أكثر وضوحا.  نرى سواحل برية وعرة في الشمال الشرقي ، وشواطئ أكثر سلاسة في الغرب. <br><br>  لذلك ، قمنا بتحسين توليد السواحل بشكل كبير ، لكن لا يزال يتعذر علي إنشاء خريطة بها الكثير من مثلثات Delaunay.  لا أعرض سوى خرائط الخطوط العريضة لأن العديد من عناصر الخريطة الأخرى مقطوعة.  يجب أن تكون ثابتة. <br><br>  لا يعمل باقي البرنامج بشكل جيد مع العديد من مثلثات Delaunay (مع الإعدادات الحالية 256 كيلو بايت).  المشكلة الرئيسية هي أن <b>Dragons Abound يسحب</b> الأرض والمياه من خلال رسم كل المثلثات الفردية ، ويتسبب الكثير من عناصر SVG في تعطل المتصفح.  لذلك اضطررت إلى تعطيل تقديم السوشي بالكامل.  ربما هناك طريقة للتغلب على هذه المشكلة ، ولكن وجود مثلثات كثيرة يخلق مشاكل أخرى.  على سبيل المثال ، يجب أن تعالج بعض أجزاء البرنامج الخريطة بالكامل.  كل واحد منهم يصبح أبطأ 16 مرة في مواقع 256K من في 16K المواقع.  أيضا في الكود هناك أجزاء (على سبيل المثال ، نموذج هطول الأمطار جديد) التي تنقطع عند العمل مع العديد من المثلثات.  ومن إنشاء مثل هذه الشبكة التفصيلية للمواقع ، لا نكتسب أي شيء - بعد إنشاء الخط الساحلي ، لا شيء يتحسن من التعقيد الإضافي.  لذلك ، على الرغم من أنه يمكنني مراجعة البرنامج وإصلاح تلك المناطق التي يبطئ فيها عدد كبير من المواقع أو يكسر الكود أكثر من اللازم ، إلا أنه يبدو من الأسهل تقليل دقة شبكة الخريطة بعد إنشاء الخطوط الساحلية. <br><br>  كما ذكر أعلاه ، نفذت Azgaar بالفعل <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">العمل</a> لتغيير دقة شبكة Voronoi التي تقوم عليها الخريطة.  لقد أدرك إمكانية تغيير دقة الشبكة على الطاير في عملية التوليد ، أي أنه (على سبيل المثال) يمكنه زيادة كثافة المواقع على طول الساحل.  ومع ذلك ، فإن التغيير المحلي في الكثافة له عيوبه - على وجه الخصوص ، فإنه يخلق مثلثات غريبة على طول الحدود.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">اقترح</a> أزجار في وقت لاحق أن النظام معقد للغاية ولا يستحق الجهد المبذول.  يعرف أزجار عادة ما يتحدث عنه ، لذلك سوف أتحمل كلمته ولن أحاول إعادة تغليف الشبكة النهائية. <br><br>  بدلاً من ذلك ، قمت بإنشاء شبكة ثانية ذات الدقة المطلوبة (الأدنى) ، ثم قمت بنسخ خريطة الارتفاع إلى هذه الشبكة الجديدة.  (لا تنس أن <b>Dragons Abound تقوم</b> الآن بتخزين الخطوط الساحلية بشكل منفصل عن الشبكة ، لذلك بعد إنشائها ، لم تعد تعتمد على الملاءمة الدقيقة للشبكة. للقيام بذلك معقدة بعض الشيء. نظرًا لأن الشبكة الأصلية لديها دقة أعلى بكثير من الشبكة الجديدة ، فإن العديد من المواقع في الأصل سيتم تثبيت الشبكة على موقع واحد في الشبكة الجديدة. لكل موقع من مواقع المصدر ارتفاع مختلف على خريطة الارتفاع ، كيف يمكنني نسخها؟ استخدام المتوسط؟ أو الحد الأقصى (الحد الأدنى) الارتفاع؟ <br><br>  للبدء ، ما عليك سوى تحديد موقع عشوائي واحد لمعرفة ما إذا كانت الشبكة الجديدة تعمل مع بقية البرنامج: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/3d2/6c4/0d3/3d26c40d3b59d96dd54c98a550352dde.png"></div><br>  كل شيء تبين بشكل جيد بشكل مدهش.  يحدث خطأ بسيط عندما لا يتم وضع علامة على المواقع الجديدة بشكل صحيح على أنها أرض أو ساحل أو ماء ، ولكن بعد حل هذه المشكلة ، كان إنشاء الخريطة جيدًا.  تحتاج إلى تنظيف العيوب الطفيفة (على سبيل المثال ، علامة Palmanor التي خرجت على الماء) ، ولكن بشكل عام تبدو جيدة.  حتى الجزر الصغيرة تحولت إلى جميلة. <br><br>  في النهاية ، قررت أنه مع انخفاض دقة شبكة Voronoi ، سيكون كل موقع متوسط ​​المواقع الأساسية.  هذا يبدو قرارًا حكيمًا ، وإذا لزم الأمر يمكن تغييره دائمًا.  توضح هذه الصورة كيف تم فصل السواحل عن الشبكة النهائية: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/c40/859/805/c40859805e84a195276b4cbaeaaa0796.png"></div><br>  لتلخيص: في <b>Dragons</b> Abound ، يتم استخدام شبكة مثلثات Delone عالية الدقة عند إنشاء خريطة الارتفاع.  بعد اكتماله ، يقوم <b>Dragons Abound</b> بتعريف السواحل بتتبع التحولات من القيم السلبية إلى القيم الموجبة في خريطة الارتفاع.  ثم تقوم اللعبة بنسخ الشبكة عالية الدقة إلى شبكة ذات دقة أقل بكثير ، حيث يبلغ متوسط ​​المواقع التي تقع في مكان واحد في الشبكة الجديدة.  بعد ذلك ، يتم تجاهل الشبكة عالية الدقة ، ويستمر الجزء المتبقي من التوليد الإجرائي والتصور على الشبكة منخفضة الدقة.  سؤال مثير للاهتمام هو ما إذا كان استخدام شبكة Delaunay له أي قيمة في هذه المرحلة ؛  قد يكون الأمر يستحق النسخ إلى شبكة من السداسي أو شيء مشابه. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar439224/">https://habr.com/ru/post/ar439224/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar439210/index.html">جافا بعد الانفجار البركاني</a></li>
<li><a href="../ar439216/index.html">pudge 500 صف قاعدة بيانات قابلة للتضمين على golang</a></li>
<li><a href="../ar439218/index.html">VK روبوت على ركبته ، أو كيفية إرضاء الناس في 14 فبراير</a></li>
<li><a href="../ar439220/index.html">مدينة كبيرة للأجهزة المحمولة على الوحدة. خبرة في التطوير والتحسين</a></li>
<li><a href="../ar439222/index.html">ما هي إدارة API؟</a></li>
<li><a href="../ar439226/index.html">Scala + MXNet = Microservice مع neuron in prod</a></li>
<li><a href="../ar439232/index.html">JAMstack: كيفية إنشاء مدونتك الخاصة باستخدام Gatsby + Contentful + Netlify</a></li>
<li><a href="../ar439234/index.html">حياة مطور المصادر المفتوحة في صور GIF</a></li>
<li><a href="../ar439236/index.html">xenvman: بيئات اختبار الخدمة الدقيقة المرنة (والمزيد)</a></li>
<li><a href="../ar439238/index.html">يقبل Play Store الآن تطبيقات الويب التقدمية (PWA)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>