<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฉ๐ปโ๐ณ ๐๐ผ ๐ ุญุฌุฒ ุงูุซูุงุจุช ูุงูุณูุงููุฑ ุฌูุช ูู C # ๐๐ฟ ๐จโ๐งโ๐ฆ ๐ค</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุฏุนูู ุฃุฎุจุฑู ูุตุฉ. ุฐุงุช ูุฑุฉ ูุงู ููุงู ูุทูุฑูู: ุณุงู ูุจูุจ. ููุฏ ุนูููุง ูุนูุง ูู ูุดุฑูุน ูุงูุช ููู ูุงุนุฏุฉ ุจูุงูุงุช. ุนูุฏูุง ุฃุฑุงุฏ ุงููุทูุฑ ุฅุฌุฑุงุก ุชุบููุฑุงุช ุนููู ุ ูุงู ุนููู ุฅูุดุง...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุญุฌุฒ ุงูุซูุงุจุช ูุงูุณูุงููุฑ ุฌูุช ูู C #</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485218/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> ุฏุนูู ุฃุฎุจุฑู ูุตุฉ.  ุฐุงุช ูุฑุฉ ูุงู ููุงู ูุทูุฑูู: ุณุงู ูุจูุจ.  ููุฏ ุนูููุง ูุนูุง ูู ูุดุฑูุน ูุงูุช ููู ูุงุนุฏุฉ ุจูุงูุงุช.  ุนูุฏูุง ุฃุฑุงุฏ ุงููุทูุฑ ุฅุฌุฑุงุก ุชุบููุฑุงุช ุนููู ุ ูุงู ุนููู ุฅูุดุงุก ููู <code>stepNNN.sql</code> ุ ุญูุซ NNN ูู ุฑูู ูุนูู.  ูุชุฌูุจ ุชุนุงุฑุถ ูุฐู ุงูุฃุฑูุงู ุจูู ูุทูุฑูู ูุฎุชูููู ุ ุงุณุชุฎุฏููุง ุฎุฏูุฉ ููุจ ุจุณูุทุฉ.  ูุงู ุนูู ูู ูุทูุฑ ุ ูุจู ุงูุจุฏุก ูู ูุชุงุจุฉ ููู SQL ุ ุงูุงูุชูุงู ุฅูู ูุฐู ุงูุฎุฏูุฉ ูุญุฌุฒ ุฑูู ุฌุฏูุฏ ูููู ุงูุฎุทูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุฐู ุงููุฑุฉ ุ ูุญุชุงุฌ ูู ูู ุณุงู ูุจูุจ ุฅูู ุฅุฌุฑุงุก ุชุบููุฑุงุช ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.  ุฐูุจ ุณุงู ุจุทุงุนุฉ ุฅูู ุงูุฎุฏูุฉ ูุงุญุชูุธ ุจุงูุฑูู 333. ููุณู ุจูุจ ุงูููุงู ุจุฐูู.  ููุฏ ุงุณุชุฎุฏู 333 ููุท ูููู ุงูุฎุทูุฉ ุงูุฎุงุต ุจู.  ููุฏ ุญุฏุซ ุฃู ุจูุจ ูุฐู ุงููุฑุฉ ูุงู ุฃูู ูู ุญูู ุชุบููุฑุงุชู ุนูู ูุธุงู ุงูุชุญูู ูู ุงูุฅุตุฏุงุฑ.  ุนูุฏูุง ูุงู ุณุงู ูุณุชุนุฏูุง ููููุถุงู ุ ุงูุชุดู ุฃู ููู <code>step333.sql</code> ููุฌูุฏ ุจุงููุนู.  ุงุชุตู ุจุจูุจ ุ ูุฃูุถุญ ูู ุฃู ุงูุฑูู 333 ูุญุฌูุฒ ูู ูุทูุจ ููู ุญู ุงููุฒุงุน.  ููู ุจูุจ ุฃุฌุงุจ: </p><br><p style=";text-align:right;direction:rtl">  - ุงููุชุฃูู ุ ุงูููุฏ ุงูุฎุงุต ุจู ููุฌูุฏ ุจุงููุนู ูู "master" ุ ุญููุฉ ูู ุงููุทูุฑูู ูุณุชุฎุฏูููู ุจุงููุนู.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ููุฏ ุชู ุถุฎู ุจุงููุนู ุฅูู ุงูุฅูุชุงุฌ.  ูุฐูู ููุท ุฅุตูุงุญ ูู ูุง ุชุญุชุงุฌู ููุงู. </p><br><p style=";text-align:right;direction:rtl">  ุฃุชููู ุฃู ุชููู ูุฏ ูุงุญุธุช ูุง ุญุฏุซ.  ุชูุช ูุนุงูุจุฉ ุงูุดุฎุต ุงูุฐู ุงุชุจุน ุฌููุน ุงูููุงุนุฏ.  ูุงู ุนูู ุณุงู ุชุบููุฑ ูููุงุชู ูุชุนุฏูู ูุงุนุฏุฉ ุจูุงูุงุชู ุงููุญููุฉ ููุง ุฅูู ุฐูู.  ุดุฎุตูุง ุ ุฃูุง ุฃูุฑู ูุซู ูุฐู ุงูุญุงูุงุช.  ุฏุนููุง ูุฑู ููู ูููููุง ุชุฌูุจ ุฐูู. </p><a name="habracut"></a><br><h2 id="osnovnaya-ideya" style=";text-align:right;direction:rtl">  ุงูููุฑุฉ ุงูุฑุฆูุณูุฉ </h2><br><p style=";text-align:right;direction:rtl">  ููู ูุชุฌูุจ ูุซู ูุฐู ุงูุฃุดูุงุกุ  ูุงุฐุง ูู ูู ูุณุชุทุน ุจูุจ ููุก ููุฏู ุฅุฐุง ูู ูุญุชูุธ ุจุงูุฑูู ุงูููุงุธุฑ ุนูู ุฎุฏูุฉ ุงูููุจุ </p><br><p style=";text-align:right;direction:rtl">  ููููููุง ุชุญููู ุฐูู ุจุงููุนู.  ูููููุง ุงุณุชุฎุฏุงู ุงูุณูุงููุฑ Git ูุชูููุฐ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงููุฎุตุตุฉ ูุจู ูู ุงูุชุฒุงู.  ุณูู ูุชุญูู ูุฐุง ุงูุฑูุฒ ูู ุฌููุน ุงูุชุบููุฑุงุช ุงูุชู ุชู ุฏูุนูุง.  ุฅุฐุง ูุงูุช ุชุญุชูู ุนูู ููู ุฎุทูุฉ ุฌุฏูุฏ ุ ูุณูู ูุชุตู ุงูููุฏ ุจุฎุฏูุฉ ุงูููุจ ููุชุญูู ููุง ุฅุฐุง ูุงู ุฑูู ููู ุงูุฎุทูุฉ ูุญุฌูุฒูุง ูููุทูุฑ ุงูุญุงูู.  ูุฅุฐุง ูุงู ุงูุฑูู ุบูุฑ ูุญุฌูุฒ ุ ูุณูุญุธุฑ ุงูุฑูุฒ ุงูุชุนุจุฆุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุฐู ูู ุงูููุฑุฉ ุงูุฑุฆูุณูุฉ.  ุฏุนูุง ููุชูู ุฅูู ุงูุชูุงุตูู. </p><br><h2 id="git-hooki-na-c35" style=";text-align:right;direction:rtl">  ุงูุณูุงููุฑ ุจูุงุจุฉ ูู C # </h2><br><p style=";text-align:right;direction:rtl">  ุจูุงุจุฉ ูุง ูุญุฏู ูู ุงููุบุงุช ุงูุชู ูุฌุจ ุฃู ุชูุชุจ ุงูุณูุงููุฑ.  ููุทูุฑ C # ุ ุฃูุถู ุงุณุชุฎุฏุงู C # ุงููุฃููู ููุฐู ุงูุฃุบุฑุงุถ.  ูู ูููููู ูุนู ูุฐุงุ </p><br><p style=";text-align:right;direction:rtl">  ูุนู ุงุณุชุทูุน  ุฃุฎุฐุช ุงูููุฑุฉ ุงูุฃุณุงุณูุฉ ุจู ูู <a href="https://medium.com/%40max.hamulyak/using-c-code-in-your-git-hooks-66e507c01a0f" rel="nofollow">ูุฐุง ุงูููุงู ุงูุฐู</a> ูุชุจู ูุงูุณ ูุงููููุงู.  ูุชุทูุจ ููุง ุงุณุชุฎุฏุงู ุฃุฏุงุฉ <a href="https://github.com/filipw/dotnet-script" rel="nofollow">dotnet-script</a> ุงูุนุงูููุฉ.  ุชุชุทูุจ ูุฐู ุงูุฃุฏุงุฉ .NET Core 2.1 + SDK ุนูู ุฌูุงุฒ ุงููุทูุฑ.  ุฃุนุชูุฏ ุฃู ูุฐุง ูุทูุจ ูุนููู ูุฃููุฆู ุงููุดุงุฑููู ูู ุชุทููุฑ .NET.  ุชุซุจูุช <code>dotnet-script</code> ุจุณูุท ููุบุงูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">&gt; dotnet tool install -g dotnet-script</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ูููููุง ูุชุงุจุฉ ุงูุณูุงููุฑ ุฌูุช ูู C #.  ููููุงู ุจุฐูู ุ ุงูุชูู ุฅูู ุงููุฌูุฏ <code>.git\hooks</code> ุงูุฎุงุต <code>.git\hooks</code> ูุฅูุดุงุก ููู <code>pre-commit</code> (ุจุฏูู ุฃู ุงูุชุฏุงุฏ): </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#!/usr/bin/env dotnet-script Console.WriteLine("Git hook");</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงูุขู ูุตุงุนุฏูุง ุ ูููุง ูุนูุช ุฐูู ุ ุณุชุดุงูุฏ ูุต <code>Git hook</code> ูู ูุญุฏุฉ ุงูุชุญูู ุงูุฎุงุตุฉ ุจู. </p><br><h2 id="neskolko-obrabotchikov-na-odin-hook" style=";text-align:right;direction:rtl">  ูุนุงูุฌุงุช ูุชุนุฏุฏุฉ ููู ุฎุทุงู </h2><br><p style=";text-align:right;direction:rtl">  ุญุณูุง ุ ููุฏ ุชู ุงูุจุฏุก.  ุงูุขู ูููููุง ูุชุงุจุฉ ุฃู ุดูุก ูู ููู <code>pre-commit</code> .  ููููู ูุง ุฃุญุจ ูุฐู ุงูููุฑุฉ ุญููุง. </p><br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ุงูุนูู ูุน ููู ูุตู ููุณ ููุงุฆููุง ููุบุงูุฉ.  ุฃูุถู ุงุณุชุฎุฏุงู IDE ุงูููุถู ูุฏู ูุน ูู ููุฒุงุชู.  ูุฃูุฏ ุฃู ุฃููู ูุงุฏุฑุงู ุนูู ุชูุณูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงููุนูุฏุฉ ุฅูู ูููุงุช ูุชุนุฏุฏุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูููู ููุงู ุดูุก ุขุฎุฑ ูุง ุฃุญุจู.  ุชุฎูู ุงููููู ุงูุชุงูู.  ููุช ุจุฅูุดุงุก <code>pre-commit</code> ูุน ููุน ูู ุงูุดููุงุช.  ูููู ูู ููุช ูุงุญู ููุช ุจุญุงุฌุฉ ูุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงูุดููุงุช.  ุณูุชุนูู ุนููู ูุชุญ ุงูููู ูุชุญุฏูุฏ ููุงู ูุตู ุงูุดูุฑุฉ ูููููุฉ ุชูุงุนููุง ูุน ุงูุดูุฑุฉ ุงููุฏููุฉ ููุง ุฅูู ุฐูู.  ุฃูุง ุดุฎุตูุงู ุฃูุถู ุฃู ุฃูุชุจ ุฑูุฒูุง ุฌุฏูุฏูุง ุ ูููุณ ุงูุญูุฑ ูู ุงูููุฏ ุงููุฏูู. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนููุง ูุชุนุงูู ูุน ูุฐู ุงููุดุงูู ูุงุญุฏุฉ ูู ููุช ูุงุญุฏ. </p><br><h2 id="vyzov-vneshnego-koda" style=";text-align:right;direction:rtl">  ุงุชุตู ุจุงูุฑูุฒ ุงูุฎุงุฑุฌู </h2><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูู ูุง ุณููุนูู.  ูููู ุจุฅูุดุงุก ูุฌูุฏ ูููุตู (ูุซู <code>gitHookAssemblies</code> ).  ูู ูุฐุง ุงููุฌูุฏ ุ ุณุฃุถุน ูุฌููุนุฉ .NET Core (ูุซู <code>GitHooks</code> ).  ุณูููู ุงูุจุฑูุงูุฌ ุงููุตู ุงูุฎุงุต ุจู ูู ููู <code>pre-commit</code> ุจุงุณุชุฏุนุงุก ุทุฑููุฉ ูุง ูู ูุฐุง ุงูุชุฌููุน. </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RunHooks</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunPreCommitHook</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Git hook from assembly"</span></span>); } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููููู ุฅูุดุงุก ูุฐุง ุงูุชุฌููุน ูู IDE ุงูููุถู ูุฏู ูุงุณุชุฎุฏุงู ุฃู ุฃุฏูุงุช. </p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ูู ููู <code>pre-commit</code> ูููููู ุงููุชุงุจุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#!/usr/bin/env dotnet-script #r "../../gitHookAssemblies/GitHooks.dll" GitHooks.RunHooks.RunPreCommitHook();</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนุธูู ุ ุฃููุณ ูุฐูู!  ุงูุขู ูููููู ููุท ุฅุฌุฑุงุก ุชุบููุฑุงุช ูู ุจูุงุก <code>GitHooks</code> ุจู.  ูู ูุชุบูุฑ ุฑูุฒ ููู <code>pre-commit</code> .  ุนูุฏูุง ุฃุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ุจุนุถ ุงูุชุญูู ุ ุณุฃููู ุจุชุบููุฑ ุฑูุฒ ุงูุฃุณููุจ <code>RunPreCommitHook</code> ุ ูุฅุนุงุฏุฉ ุฅูุดุงุก ุงูุชุฌููุน ููุถุนู ูู ูุฌูุฏ <code>gitHookAssemblies</code> .  ููุฐุง ูู ุดูุก! </p><br><p style=";text-align:right;direction:rtl">  ุญุณูุง ุ ููุณ ุญูุง. </p><br><h2 id="borba-s-keshem" style=";text-align:right;direction:rtl">  ูุญุงุฑุจุฉ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช </h2><br><p style=";text-align:right;direction:rtl">  ุฏุนููุง ูุญุงูู ูุชุงุจุนุฉ ุนูููุชูุง.  ุชุบููุฑ ุงูุฑุณุงูุฉ ูู <code>Console.WriteLine</code> ุฅูู ุดูุก ุขุฎุฑ ุ ุฅุนุงุฏุฉ ุฅูุดุงุก ุงูุชุฌููุน ููุถุน ุงููุชูุฌุฉ ูู ูุฌูุฏ <code>gitHookAssemblies</code> .  ุจุนุฏ ุฐูู ุ ูุฏุนู <code>git commit</code> ูุฑุฉ ุฃุฎุฑู.  ูุงุฐุง ุณูู ูุฑูุ  ุงูููุตุจ ุงููุฏูู.  ุชุบููุฑุงุชูุง ูู ููุณู.  ููุงุฐุงุ </p><br><p style=";text-align:right;direction:rtl">  ุฏุนูุง ุ ุจุงูุชุฃููุฏ ุ ููุน <code>c:\project</code> ูุฌูุฏ <code>c:\project</code> .  ูุฐุง ูุนูู ุฃู ุงูุจุฑุงูุฌ ุงููุตูุฉ Git hook ููุฌูุฏุฉ ูู ุงููุฌูุฏ <code>c:\project\.git\hooks</code> .  ุงูุขู ุ ุฅุฐุง ููุช ุชุณุชุฎุฏู ูุธุงู ุงูุชุดุบูู Windows 10 ุ ูุงูุชูู ุฅูู ุงููุฌูุฏ <code>c:\Users\&lt;UserName&gt;\AppData\Local\Temp\scripts\c\project\.git\hooks\</code> .  ููุง <code>&lt;UserName&gt;</code> ูู ุงุณู ุงููุณุชุฎุฏู ุงูุญุงูู.  ูุงุฐุง ุณูุฑู ููุงุ  ุนูุฏูุง ูููู ุจุชุดุบูู ุงูุจุฑูุงูุฌ ุงููุตู <code>pre-commit</code> ุ ูุชู ุฅูุดุงุก ูุณุฎุฉ ูุชุฑุฌูุฉ ูู ูุฐุง ุงูุจุฑูุงูุฌ ุงููุตู ูู ูุฐุง ุงููุฌูุฏ.  ููุง ููููู ุงูุนุซูุฑ ุนูู ุฌููุน ุงูุชุฌููุนุงุช ุงููุดุงุฑ ุฅูููุง ุจูุงุณุทุฉ ุงูุจุฑูุงูุฌ ุงููุตู (ุจูุง ูู ุฐูู <code>GitHooks.dll</code> ).  ููู ูุฌูุฏ <code>execution-cache</code> ููููู ุงูุนุซูุฑ ุนูู ููู SHA256.  ูููููู ุงูุชุฑุงุถ ุฃูู ูุญุชูู ุนูู ุชุฌุฒุฆุฉ SHA256 ูููู <code>pre-commit</code> ุจูุง.  ุนูุฏ ุชุดุบูู ุงูุจุฑูุงูุฌ ุงููุตู ุ ููุงุฑู ููุช ุงูุชุดุบูู ุจูู ุงูุชุฌุฒุฆุฉ ุงูุญุงููุฉ ููููู ูุงูุชุฌุฒุฆุฉ ุงููุฎุฒูุฉ.  ุฅุฐุง ูุงูุช ูุชุณุงููุฉ ุ ูุณูุชู ุงุณุชุฎุฏุงู ุงูุฅุตุฏุงุฑ ุงููุญููุธ ูู ุงูุจุฑูุงูุฌ ุงููุตู ุงููุชุฑุฌู. </p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูุนูู ุฃูู ูุธุฑูุง ูุฃููุง ูู ูุบูุฑ ุฃุจุฏูุง ููู <code>pre-commit</code> ุ ููู ุชุตู ุงูุชุบููุฑุงุช ุฅูู <code>GitHooks.dll</code> ุฅูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ููู ูุชู ุงุณุชุฎุฏุงููุง ุฃุจุฏูุง. </p><br><p style=";text-align:right;direction:rtl">  ูุงุฐุง ูููููุง ุฃู ููุนู ูู ูุฐู ุงูุญุงูุฉุ  ุญุณูุง ุ ุณูู ูุณุงุนุฏูุง ุงูุชูููุฑ.  ุณุฃููู ุจุฅุนุงุฏุฉ ูุชุงุจุฉ ุงููุต ุงูุจุฑูุฌู <code>GitHooks</code> Reflection" ุจุฏูุงู ูู ุงูุฑุฌูุน ูุจุงุดุฑุฉ ุฅูู ูุฌููุนุฉ <code>GitHooks</code> .  ุฅููู ูุง ุณูุจุฏู ุนููู ููู <code>pre-commit</code> ุจูุง ุจุนุฏ ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#!/usr/bin/env dotnet-script #r "nuget: System.Runtime.Loader, 4.3.0" using System.IO; using System.Runtime.Loader; var hooksDirectory = Path.Combine(Environment.CurrentDirectory, "gitHookAssemblies"); var assemblyPath = Path.Combine(hooksDirectory, "GitHooks.dll"); var assembly = AssemblyLoadContext.Default.LoadFromAssemblyPath(assemblyPath); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(assembly == null) { Console.WriteLine($"Can't load assembly from '{assemblyPath}'."); } var collectorsType = assembly.GetType("GitHooks.RunHooks"); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(collectorsType == null) { Console.WriteLine("Can't find entry type."); } var method = collectorsType.GetMethod("RunPreCommitHook", System.Reflection.BindingFlags.Public | System.Reflection.BindingFlags.Static); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(method == null) { Console.WriteLine("Can't find method for pre-commit hooks."); } method.Invoke(null, new object[0]);</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ูููููุง ุชุญุฏูุซ <code>GitHook.dll</code> ูู ูุฌูุฏ <code>gitHookAssemblies</code> ูู ุฃู ููุช ุ ูุณูุชู ุงูุชูุงุท ุฌููุน ุงูุชุบููุฑุงุช ุจูุงุณุทุฉ ุงูุจุฑูุงูุฌ ุงููุตู ููุณู.  ุชุนุฏูู ุงูุจุฑูุงูุฌ ุงููุตู ููุณู ูู ูุนุฏ ุถุฑูุฑูุง. </p><br><p style=";text-align:right;direction:rtl">  ูู ูุฐุง ูุจุฏู ุฑุงุฆุนูุง ุ ูููู ููุงู ูุดููุฉ ุฃุฎุฑู ุชุญุชุงุฌ ุฅูู ุญู ูุจู ุงููุถู ูุฏููุง.  ุฃูุง ุฃุชุญุฏุซ ุนู ุงูุชุฌููุนุงุช ุงููุดุงุฑ ุฅูููุง ุจูุงุณุทุฉ ุงูููุฏ. </p><br><h2 id="ispolzuemye-sborki" style=";text-align:right;direction:rtl">  ุงููุฌุงูุณ ุงููุณุชุฎุฏูุฉ </h2><br><p style=";text-align:right;direction:rtl">  ูู ุดูุก ูุนูู ุจุดูู ุฌูุฏ ุ ุทุงููุง ุฃู ุงูุทุฑููุฉ ุงููุญูุฏุฉ ุงูุชู <code>RunHooks.RunPreCommitHook</code> ุทุฑููุฉ <code>RunHooks.RunPreCommitHook</code> ูู ุฅุฎุฑุงุฌ ุงูุณูุณูุฉ ุฅูู ูุญุฏุฉ ุงูุชุญูู.  ูููู ุ ุจุตุฑุงุญุฉ ุ ูุง ูุนุฏ ุนุฑุถ ุงููุต ุนูู ุงูุดุงุดุฉ ุฃูุฑูุง ููููุง.  ูุญู ุจุญุงุฌุฉ ุฅูู ุงูููุงู ุจุฃุดูุงุก ุฃูุซุฑ ุชุนููุฏูุง.  ูููุฐุง ูุญู ุจุญุงุฌุฉ ุฅูู ุงุณุชุฎุฏุงู ุงูุชุฌููุนุงุช ุงูุฃุฎุฑู ูุญุฒู NuGet.  ุฏุนููุง ูุฑู ููู ููุนู ูุฐุง. </p><br><p style=";text-align:right;direction:rtl">  ุณูู ุฃููู <code>RunHooks.RunPreCommitHook</code> ุจุญูุซ ูุณุชุฎุฏู ุญุฒูุฉ <code>LibGit2Sharp</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunPreCommitHook</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> repo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Repository(Environment.CurrentDirectory); Console.WriteLine(repo.Info.WorkingDirectory); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ุ ุฅุฐุง ููุช ุจุชูููุฐ <code>git commit</code> ุ ูุณูู ุฃุญุตู ุนูู ุฑุณุงูุฉ ุงูุฎุทุฃ ุงูุชุงููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">System.Reflection.TargetInvocationException: Exception has been thrown by the target of an invocation. ---&gt; System.IO.FileLoadException: Could not load file or assembly 'LibGit2Sharp, Version=0.26.0.0, Culture=neutral, PublicKeyToken=7cbde695407f0333'. General Exception (0x80131500)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงููุงุถุญ ุฃููุง ูุญุชุงุฌ ุฅูู ุทุฑููุฉ ูุถูุงู ุชุญููู ุงูุชุฌููุนุงุช ุงูุชู ูุดูุฑ ุฅูููุง.  ุงูููุฑุฉ ุงูุฃุณุงุณูุฉ ููุง ูู.  ุณูู ุฃุถุน ูู ุฑูุฒ ุงูุชุฌููุน ุงููุทููุจ ูุชูููุฐ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูู ูุฌูุฏ <code>gitHookAssemblies</code> ููุณู ูุน <code>GitHooks.dll</code> .  ููุญุตูู ุนูู ุฌููุน ุงูุชุฌููุนุงุช ุงููุทููุจุฉ ุ ููููู ุงุณุชุฎุฏุงู ุงูุฃูุฑ <code>dotnet publish</code> .  ูู ุญุงูุชูุง ุ ูุญุชุงุฌ ุฅูู ูุถุน <code>LibGit2Sharp.dll</code> ู <code>git2-7ce88e6.dll</code> ูู ูุฐุง ุงููุฌูุฏ. </p><br><p style=";text-align:right;direction:rtl">  ุนูููุง ุฃูุถุง ุฃู ูุบูุฑ <code>pre-commit</code> .  ุณูุถูู ุงูููุฏ ุงูุชุงูู ุฅูููุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#!/usr/bin/env dotnet-script #r "nuget: System.Runtime.Loader, 4.3.0" using System.IO; using System.Runtime.Loader; var hooksDirectory = Path.Combine(Environment.CurrentDirectory, "gitHookAssemblies"); var assemblyPath = Path.Combine(hooksDirectory, "GitHooks.dll"); AssemblyLoadContext.Default.Resolving += (context, assemblyName) =&gt; { var assemblyPath = Path.Combine(hooksDirectory, $"{assemblyName.Name}.dll"); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(File.Exists(assemblyPath)) { return AssemblyLoadContext.Default.LoadFromAssemblyPath(assemblyPath); } return null; }; ...</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุณูุญุงูู ูุฐุง ุงูุฑูุฒ ุชุญููู ุฌููุน ุงูุชุฌููุนุงุช ุงูุชู ุชุนุฐุฑ ุนูู ููุช ุงูุชุดุบูู ุงูุนุซูุฑ ุนูููุง ูู ูุฌูุฏ <code>gitHookAssemblies</code> . </p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ููููู ุชุดุบูู <code>git commit</code> ูุณูุชู ุชุดุบููู ุฏูู ูุดุงูู. </p><br><h2 id="uluchshenie-rasshiryaemosti" style=";text-align:right;direction:rtl">  ุชุญุณูู ุงููุงุจููุฉ ููุชูุณุนุฉ </h2><br><p style=";text-align:right;direction:rtl">  ููู <code>pre-commit</code> ุจูุง ูุงูู.  ูู ูุนุฏ ุจุญุงุฌุฉ ุฅูู ุชุบููุฑู.  ูููู ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ุฅุฌุฑุงุก ุชุบููุฑุงุช ุ ูุณูุชุนูู ุนูููุง ุชุบููุฑ ุงูุฃุณููุจ <code>RunHooks.RunPreCommitHook</code> .  ูุฐูู ูุญู ููุท ููู ุงููุดููุฉ ุฅูู ูุณุชูู ุขุฎุฑ.  ุดุฎุตูุง ุ ุฃูุง ุฃูุถู ุฃู ูููู ูุฏู ููุน ูู ูุธุงู ุงูุจุฑูุงูุฌ ุงููุณุงุนุฏ.  ูู ูู ูุฑุฉ ุฃุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ุจุนุถ ุงูุฅุฌุฑุงุกุงุช ุงูุชู ูุฌุจ ุชูููุฐูุง ูุจู ููุก ุงูุฑูุฒ ุ ุณุฃูุชุจ ููุท ูููููุง ุฅุถุงูููุง ุฌุฏูุฏูุง ููู ููุฒู ุชุบููุฑ ุฃู ุดูุก.  ูุง ูุฏู ุตุนูุจุฉ ุชุญููู ูุฐุงุ </p><br><p style=";text-align:right;direction:rtl">  ููุณ ูู ุงูุตุนุจ ุนูู ุงูุฅุทูุงู.  ุฏุนูุง ูุณุชุฎุฏู <a href="https://docs.microsoft.com/en-us/dotnet/framework/mef/" rel="nofollow">MEF</a> .  ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ูุนูู ุจูุง. </p><br><p style=";text-align:right;direction:rtl">  ูุญุชุงุฌ ุฃููุงู ุฅูู ุชุญุฏูุฏ ูุงุฌูุฉ ููุนุงูุฌุงุช ุงูุฎุทุงูุงุช ูุฏููุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IPreCommitHook</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IList&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; args</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ููู ูุนุงูุฌ ุชููู ุจุนุถ ูุณุงุฆุท ุงูุณูุณูุฉ ูู Git.  ุณูุชู ุชูุฑูุฑ ูุฐู ุงููุณุงุฆุท ูู ุฎูุงู ุงููุนููุฉ <code>args</code> .  ุณุชุนูุฏ ุทุฑููุฉ <code>Process</code> ุฅูู <code>true</code> ุฅุฐุง ุณูุญุช ุจุชุบููุฑุงุช ุงูุตุจ.  ูุฅูุง ุณูู ุชุนุงุฏ <code>false</code> . </p><br><p style=";text-align:right;direction:rtl">  ูููู ุชุนุฑูู ูุงุฌูุงุช ููุงุซูุฉ ูุฌููุน ุงูุณูุงููุฑ ุ ูููู ูู ูุฐู ุงูููุงูุฉ ุณูู ูุฑูุฒ ููุท ุนูู ุงูุงูุชุฒุงู ุงููุณุจู. </p><br><p style=";text-align:right;direction:rtl">  ุฃูุช ุงูุขู ุจุญุงุฌุฉ ุฅูู ูุชุงุจุฉ ุชุทุจูู ููุฐู ุงููุงุฌูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Export(typeof(IPreCommitHook))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MessageHook</span></span> : <span class="hljs-title"><span class="hljs-title">IPreCommitHook</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IList&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; args</span></span></span><span class="hljs-function">)</span></span> { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Message hook..."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(args != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Arguments are:"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arg <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> args) { Console.WriteLine(arg); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ุฅูุดุงุก ูุฐู ุงููุฆุงุช ูู ูุฌููุนุงุช ูุฎุชููุฉ ุฅุฐุง ููุช ุชุฑุบุจ ูู ุฐูู.  ูุง ุชูุฌุฏ ูููุฏ ุญุฑูููุง.  ูุชู ุฃุฎุฐ ุณูุฉ <code>Export</code> ูู ุญุฒูุฉ <code>System.ComponentModel.Composition</code> NuGet. </p><br><p style=";text-align:right;direction:rtl">  ุฃูุถูุง ุ ุฏุนูุง ููุดุฆ ุทุฑููุฉ ูุณุงุนุฏุฉ ูู ุดุฃููุง ุฃู ุชุฌูุน ูู <code>IPreCommitHook</code> ูุงุฌูุฉ <code>IPreCommitHook</code> <code>Export</code> ุ ููู ุจุชุดุบูููุง ุฌููุนูุง ูุฅุฑุฌุงุน ูุนูููุงุช ุญูู ูุง ุฅุฐุง ูุงูุช ุฌููุนูุง ูุฏ ุณูุญุช ุจุงูุชุนุจุฆุฉ.  ูุถุนุช <code>GitHooksCollector</code> ูู ูุฌููุนุฉ <code>GitHooksCollector</code> ูููุตูุฉ ุ ููู ูุฐุง ููุณ ููููุง ุฌุฏูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Collectors</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PreCommitHooks</span></span> { [ImportMany(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(IPreCommitHook))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IPreCommitHook[] Hooks { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunPreCommitHooks</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IList&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; args, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> directory</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> catalog = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DirectoryCatalog(directory, <span class="hljs-string"><span class="hljs-string">"*Hooks.dll"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> container = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CompositionContainer(catalog); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PreCommitHooks(); container.ComposeParts(obj); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> success = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hook <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> obj.Hooks) { success &amp;= hook.Process(args); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> success ? <span class="hljs-number"><span class="hljs-number">0</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>; } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุณุชุฎุฏู ูุฐุง ุงูุฑูุฒ ุฃูุถูุง ุญุฒูุฉ <code>System.ComponentModel.Composition</code> NuGet.  ุฃููุงู ุ ูููู ุฃููุง <code>*Hooks.dll</code> ุฌููุน ุงูุชุฌููุนุงุช ุงูุชู ูุทุงุจู <code>*Hooks.dll</code> ูุงูุจ <code>*Hooks.dll</code> ูู ูุฌูุฏ <code>directory</code> .  ููููู ุงุณุชุฎุฏุงู ุฃู ูุงูุจ ุชุฑูุฏู ููุง.  ุซู ูููู ุจุชุฌููุน ุฌููุน ุงูุชุทุจููุงุช ุงููุตุฏุฑุฉ ููุงุฌูุฉ <code>IPreCommitHook</code> ูู ูุงุฆู <code>PreCommitHooks</code> .  ูุฃุฎูุฑูุง ุ ูุจุฏุฃ ุฌููุน ูุนุงูุฌุงุช ุงูุฎุทุงูุงุช ููุฌูุน ูุชูุฌุฉ ุชูููุฐูุง. </p><br><p style=";text-align:right;direction:rtl">  ุขุฎุฑ ุดูุก ูุญุชุงุฌ ุฅูู ุงูููุงู ุจู ูู ุชุบููุฑ ุจุณูุท ูู ููู <code>pre-commit</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#!/usr/bin/env dotnet-script #r "nuget: System.Runtime.Loader, 4.3.0" using System.IO; using System.Runtime.Loader; var hooksDirectory = Path.Combine(Environment.CurrentDirectory, "gitHookAssemblies"); var assemblyPath = Path.Combine(hooksDirectory, "GitHooksCollector.dll"); AssemblyLoadContext.Default.Resolving += (context, assemblyName) =&gt; { var assemblyPath = Path.Combine(hooksDirectory, $"{assemblyName.Name}.dll"); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(File.Exists(assemblyPath)) { return AssemblyLoadContext.Default.LoadFromAssemblyPath(assemblyPath); } return null; }; var assembly = AssemblyLoadContext.Default.LoadFromAssemblyPath(assemblyPath); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(assembly == null) { Console.WriteLine($"Can't load assembly from '{assemblyPath}'."); } var collectorsType = assembly.GetType("GitHooksCollector.Collectors"); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(collectorsType == null) { Console.WriteLine("Can't find collector's type."); } var method = collectorsType.GetMethod("RunPreCommitHooks", System.Reflection.BindingFlags.Public | System.Reflection.BindingFlags.Static); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(method == null) { Console.WriteLine("Can't find collector's method for pre-commit hooks."); } int exitCode = (int) method.Invoke(null, new object[] { Args, hooksDirectory }); Environment.Exit(exitCode);</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ุชูุณู ุฃู ุชุถุน ูู ุงููุฌููุนุงุช ุงููุดุงุฑูุฉ ูู ูุฌูุฏ <code>gitHookAssemblies</code> . </p><br><p style=";text-align:right;direction:rtl">  ูุนู ุ ููุฏ ูุงูุช ููุฏูุฉ ุทูููุฉ.  ูููู ุงูุขู ูุฏููุง ุญู ููุซูู ุจู ุชูุงููุง ูุฅูุดุงุก ูุนุงูุฌุงุช ุฑุจุท Git ูู C #.  ูู ูุง ูู ูุทููุจ ููุง ูู ุชุบููุฑ ูุญุชููุงุช ูุฌูุฏ <code>gitHookAssemblies</code> .  ูููู ูุถุน ูุญุชููุงุชู ูู ูุธุงู ุงูุชุญูู ูู ุงูุฅุตุฏุงุฑ ุ ูุจุงูุชุงูู ุ ูููู ุชูุฒูุนู ุจูู ุฌููุน ุงููุทูุฑูู. </p><br><p style=";text-align:right;direction:rtl">  ูู ุฃู ุญุงู ุ ููุฏ ุญุงู ุงูููุช ููุนูุฏุฉ ุฅูู ูุดููุชูุง ุงูุฃุตููุฉ. </p><br><h2 id="web-servis-dlya-rezervirovaniya-konstant" style=";text-align:right;direction:rtl">  ุฎุฏูุฉ ุงูููุจ ููุญุฌุฒ ุงููุณุชูุฑ </h2><br><p style=";text-align:right;direction:rtl">  ุฃุฑุฏูุง ุงูุชุฃูุฏ ูู ุฃู ุงููุทูุฑูู ูู ูุชููููุง ูู ููุก ุจุนุถ ุงูุชุบููุฑุงุช ุฅุฐุง ูุณูุง ุญุฌุฒ ุงูุซุงุจุช ุงููุทุงุจู ุนูู ุฎุฏูุฉ ุงูููุจ.  ูููู ุจุฅูุดุงุก ุฎุฏูุฉ ููุจ ุจุณูุทุฉ ุญุชู ุชุชููู ูู ุงูุนูู ูุนูุง.  ุฃูุง ุฃุณุชุฎุฏู ุฎุฏูุฉ ASP.NET Core Web ูุน ูุตุงุฏูุฉ Windows.  ูููู ูู ุงููุงูุน ุ ููุงู ุฎูุงุฑุงุช ูุฎุชููุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.Authorization; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.Mvc; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ListsService.Controllers</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ListItem</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ListItem</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> owner</span></span></span><span class="hljs-function">)</span></span> { Value = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; Owner = owner; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Owner { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Lists</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> List&lt;ListItem&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;&gt; SqlVersions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ListItem&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;&gt; { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ListItem&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">@"DOMAIN\Iakimov"</span></span>) }; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, List&lt;ListItem&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;&gt;&gt; AllLists = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, List&lt;ListItem&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;&gt;&gt; { {<span class="hljs-number"><span class="hljs-number">1</span></span>, SqlVersions} }; } [Authorize] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ListsController</span></span> : <span class="hljs-title"><span class="hljs-title">Controller</span></span> { [Route(<span class="hljs-string"><span class="hljs-string">"/api/lists/{listId}/ownerOf/{itemId}"</span></span>)] [HttpGet] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetOwner</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> listId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> itemId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Lists.AllLists.ContainsKey(listId)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NotFound(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item = Lists.AllLists[listId].FirstOrDefault(li =&gt; li.Value == itemId); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(item == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NotFound(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Json(item.Owner); } } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ุ ูุฃุบุฑุงุถ ุงูุงุฎุชุจุงุฑ ุ ุงุณุชุฎุฏูุช ูุฆุฉ " <code>Lists</code> ุงูุซุงุจุชุฉ" ูุขููุฉ ูุชุฎุฒูู ุงูููุงุฆู.  ุณูููู ููู ูุงุฆูุฉ ูุนุฑู ุนุฏุฏ ุตุญูุญ.  ุณุชุญุชูู ูู ูุงุฆูุฉ ุนูู ููู ุตุญูุญุฉ ููุนูููุงุช ุญูู ุงูุฃุดุฎุงุต ุงูุฐูู ุชู ุญุฌุฒ ูุฐู ุงูููู ููู.  ุชุณูุญ ูู ุทุฑููุฉ <code>GetOwner</code> ููุฆุฉ <code>GetOwner</code> ุจุงูุญุตูู ุนูู ูุนุฑู ุงูุดุฎุต ุงููุญุฌูุฒ ูุนูุตุฑ ุงููุงุฆูุฉ ูุฐุง. </p><br><h2 id="proverka-sql-step-faylov" style=";text-align:right;direction:rtl">  ุงูุชุญูู ูู ุตุญุฉ ูููุงุช ุงูุฎุทูุฉ SQL </h2><br><p style=";text-align:right;direction:rtl">  ูุญู ุงูุขู ุนูู ุงุณุชุนุฏุงุฏ ููุชุญูู ููุง ุฅุฐุง ูุงู ุจุฅููุงููุง ุชุญููู ููู ุฎุทูุฉ ุฌุฏูุฏ ุฃู ูุง.  ููุชุฃูุฏ ูู ุตุญุชูุง ุ ุงูุชุฑุถ ุฃููุง ูููู ุจุชุฎุฒูู ูููุงุช ุงูุฎุทูุฉ ุนูู ุงููุญู ุงูุชุงูู.  ูุญุชูู ุงููุฌูุฏ ุงูุฌุฐุฑ <code>sql</code> ุฏููู <code>sql</code> .  ูู ุฐูู ุ ูููู ููู ูุทูุฑ ุฅูุดุงุก ูุฌูุฏ <code>verXXX</code> ุ ุญูุซ <code>XXX</code> ูู ุฑูู ูุนูู ูุฌุจ ุญุฌุฒู ูุณุจููุง ุนูู ุฎุฏูุฉ ุงูููุจ.  ุฏุงุฎู ุงูุฏููู <code>verXXX</code> ุ ูุฏ ูููู <code>verXXX</code> ููู <code>.sql</code> ูุงุญุฏ ุฃู ุฃูุซุฑ ูุญุชูู ุนูู ุฅุฑุดุงุฏุงุช ูุชุนุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.  ูู ููุงูุด ูุดููุฉ ุถูุงู ุชุฑุชูุจ ุชูููุฐ ูุฐู ุงููููุงุช <code>.sql</code> ููุง.  ูุฐุง ููุณ ูููุง ูููุงูุดุชูุง.  ูุฑูุฏ ููุท ุฃู ููุนู ูุง ููู.  ุฅุฐุง ูุงู ุฃุญุฏ ุงููุทูุฑูู ูุญุงูู ุชุญููู ููู ุฌุฏูุฏ ููุฌูุฏ ูู <code>sql/verXXX</code> ุ ููุฌุจ ุนูููุง ุงูุชุญูู ููุง ุฅุฐุง ูุงู <code>XXX</code> ุงูุซุงุจุช ูุญุฌูุฒูุง ููุฐุง ุงููุทูุฑ. </p><br><p style=";text-align:right;direction:rtl">  ุฅููู ูุง ูุจุฏู ุนููู ุฑูุฒ ูุนุงูุฌ ุฑุจุท Git ุงูููุงุจู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Export(typeof(IPreCommitHook))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SqlStepsHook</span></span> : <span class="hljs-title"><span class="hljs-title">IPreCommitHook</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Regex _expr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Regex(<span class="hljs-string"><span class="hljs-string">"\\bver(\\d+)\\b"</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IList&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> repo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Repository(Environment.CurrentDirectory); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items = repo.RetrieveStatus() .Where(i =&gt; !i.State.HasFlag(FileStatus.Ignored)) .Where(i =&gt; i.State.HasFlag(FileStatus.NewInIndex)) .Where(i =&gt; i.FilePath.StartsWith(<span class="hljs-string"><span class="hljs-string">@"sql"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> versions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;( items .Select(i =&gt; _expr.Match(i.FilePath)) .Where(m =&gt; m.Success) .Select(m =&gt; m.Groups[<span class="hljs-number"><span class="hljs-number">1</span></span>].Value) .Select(d =&gt; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.Parse(d)) ); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> version <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> versions) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ListItemOwnerChecker.DoesCurrentUserOwnListItem(<span class="hljs-number"><span class="hljs-number">1</span></span>, version)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญู ููุง ูุณุชุฎุฏู ูุฆุฉ <code>Repository</code> ูู ุจุงูุฉ <code>LibGit2Sharp</code> .  ุณูุญุชูู ูุชุบูุฑ <code>items</code> ุนูู ุฌููุน ุงููููุงุช ุงูุฌุฏูุฏุฉ ูู ููุฑุณ Git ุงูููุฌูุฏุฉ ุฏุงุฎู ูุฌูุฏ <code>sql</code> .  ููููู ุชุญุณูู ุฅุฌุฑุงุก ุงูุจุญุซ ุนู ูุฐู ุงููููุงุช ุฅุฐุง ููุช ุชุฑุบุจ ูู ุฐูู.  ูู ูุชุบูุฑ <code>versions</code> ูุฌูุน ุงูุซูุงุจุช ุงููุฎุชููุฉ <code>XXX</code> ูู ูุฌูุฏุงุช <code>verXXX</code> .  ุฃุฎูุฑูุง ุ ูุชุญูู ุฃุณููุจ <code>ListItemOwnerChecker.DoesCurrentUserOwnListItem</code> ููุนุฑูุฉ ูุง ุฅุฐุง ูุงูุช ูุฐู ุงูุฅุตุฏุงุฑุงุช ูุณุฌูุฉ ูุฏู ุงููุณุชุฎุฏู ุงูุญุงูู ูู ุฎุฏูุฉ ุงูููุจ ูู ุงููุงุฆูุฉ 1. </p><br><p style=";text-align:right;direction:rtl">  ุชุทุจูู <code>ListItemOwnerChecker.DoesCurrentUserOwnListItem</code> ุจุณูุท ุฌุฏูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ListItemOwnerChecker</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetListItemOwner</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> listId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> itemId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpClientHandler { UseDefaultCredentials = <span class="hljs-literal"><span class="hljs-literal">true</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpClient(handler); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> response = client.GetAsync(<span class="hljs-string"><span class="hljs-string">$"https://localhost:44389/api/lists/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{listId}</span></span></span><span class="hljs-string">/ownerOf/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{itemId}</span></span></span><span class="hljs-string">"</span></span>) .ConfigureAwait(<span class="hljs-literal"><span class="hljs-literal">false</span></span>) .GetAwaiter() .GetResult(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (response.StatusCode == System.Net.HttpStatusCode.NotFound) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> owner = response.Content .ReadAsStringAsync() .ConfigureAwait(<span class="hljs-literal"><span class="hljs-literal">false</span></span>) .GetAwaiter() .GetResult(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JsonConvert.DeserializeObject&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(owner); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoesCurrentUserOwnListItem</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> listId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> itemId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> owner = GetListItemOwner(listId, itemId); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (owner == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">$"There is no item '</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{itemId}</span></span></span><span class="hljs-string">' in the list '</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{listId}</span></span></span><span class="hljs-string">' registered on the lists service."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (owner != WindowsIdentity.GetCurrent().Name) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">$"Item '</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{itemId}</span></span></span><span class="hljs-string">' in the list '</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{listId}</span></span></span><span class="hljs-string">' registered by '</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{owner}</span></span></span><span class="hljs-string">' and you are '</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{WindowsIdentity.GetCurrent().Name}</span></span></span><span class="hljs-string">'."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุทูุจ ููุง ูู ุฎุฏูุฉ ุงูููุจ ูุนุฑู ุงููุณุชุฎุฏู ุงูุฐู ุณุฌู ุงูุซุงุจุช ุงููุญุฏุฏ (ุทุฑููุฉ <code>GetListItemOwner</code> ).  ุซู ุชุชู ููุงุฑูุฉ ุงููุชูุฌุฉ ูุน ุงุณู ูุณุชุฎุฏู Windows ุงูุญุงูู.  ูุฐู ูุฌุฑุฏ ูุงุญุฏุฉ ูู ุงูุนุฏูุฏ ูู ุงูุทุฑู ุงูููููุฉ ูุชูููุฐ ูุฐู ุงููุธููุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ููููู ุงุณุชุฎุฏุงู ุงุณู ุงููุณุชุฎุฏู ุฃู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูู ุชูููู Git. </p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูู ุดูุก.  ูุฌุฑุฏ ุชุฌููุน ุงูุชุฌููุน ุงูููุงุณุจ ููุถุนู ูู ูุฌูุฏ <code>gitHookAssemblies</code> ุฌูุจุง ุฅูู ุฌูุจ ูุน ุฌููุน ุงูุชุจุนูุงุช.  ููู ุดูุก ุณูู ูุนูู ุชููุงุฆูุง. </p><br><h2 id="proverka-znacheniy-enum" style=";text-align:right;direction:rtl">  ุงูุชุญูู ูู ููู ุงูุชุนุฏุงุฏ </h2><br><p style=";text-align:right;direction:rtl">  ูุฐุง ุฑุงุฆุน!  ูู ูุชููู ุฃู ุดุฎุต ุงูุขู ูู ุชุญููู ุงูุชุบููุฑุงุช ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฏูู ุงูุงุญุชูุงุธ ูุณุจููุง ูููุณู ุจุงูุซุจุงุช ุงูููุงุจู ูู ุฎุฏูุฉ ุงูููุจ.  ูููู ูููู ุงุณุชุฎุฏุงู ุทุฑููุฉ ููุงุซูุฉ ูู ุฃูุงูู ุฃุฎุฑู ุญูุซ ูุชุทูุจ ุงูุญุฌุฒ ุงูุฏุงุฆู. </p><br><p style=";text-align:right;direction:rtl">  ุนูู ุณุจูู ุงููุซุงู ุ ูู ููุงู ูุง ูู ุฑูุฒ ุงููุดุฑูุน ูุฏูู ุงูุชุนุฏุงุฏ.  ูููู ููู ูุทูุฑ ุฅุถุงูุฉ ุฃุนุถุงุก ุฌุฏุฏ ุฅููู ุจููู ุนุฏุฏ ุตุญูุญ ูุญุฏุฏ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Constants { Val1 = <span class="hljs-number"><span class="hljs-number">1</span></span>, Val2 = <span class="hljs-number"><span class="hljs-number">2</span></span>, Val3 = <span class="hljs-number"><span class="hljs-number">3</span></span> }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฑูุฏ ุชุฌูุจ ุงูุงุตุทุฏุงู ูู ุงูููู ูุฃุนุถุงุก ูุฐุง ุงูุชุนุฏุงุฏ.  ูุฐูู ุ ูุทูุจ ุญุฌุฒูุง ุฃููููุง ููุซูุงุจุช ุงูููุงุจูุฉ ุนูู ุฎุฏูุฉ ุงูููุจ.  ูุง ูุฏู ุตุนูุจุฉ ุชูููุฐ ุงูุชุญูู ูู ูุฐุง ุงูุชุญูุธุ </p><br><p style=";text-align:right;direction:rtl">  ููุง ูู ุฑูุฒ ูุนุงูุฌ ุฑุจุท Git ุงูุฌุฏูุฏ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Export(typeof(IPreCommitHook))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ConstantValuesHook</span></span> : <span class="hljs-title"><span class="hljs-title">IPreCommitHook</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IList&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> repo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Repository(Environment.CurrentDirectory); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> constantsItem = repo.RetrieveStatus() .Staged .FirstOrDefault(i =&gt; i.FilePath == <span class="hljs-string"><span class="hljs-string">@"src/GitInteraction/Constants.cs"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (constantsItem == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!constantsItem.State.HasFlag(FileStatus.NewInIndex) &amp;&amp; !constantsItem.State.HasFlag(FileStatus.ModifiedInIndex)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> initialContent = GetInitialContent(repo, constantsItem); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> indexContent = GetIndexContent(repo, constantsItem); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> initialConstantValues = GetConstantValues(initialContent); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> indexConstantValues = GetConstantValues(indexContent); indexConstantValues.ExceptWith(initialConstantValues); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (indexConstantValues.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> version <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> indexConstantValues) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ListItemOwnerChecker.DoesCurrentUserOwnListItem(<span class="hljs-number"><span class="hljs-number">2</span></span>, version)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } ... }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃููุงู ูุชุญูู ููุง ุฅุฐุง ูุงู ุงูููู ุงูุฐู ูุญุชูู ุนูู ุชุนุฏุงุฏูุง ูุฏ ุชู ุชุนุฏููู.  ุซู ูููู ุจุงุณุชุฎุฑุงุฌ ูุญุชููุงุช ูุฐุง ุงูููู ูู ุฃุญุฏุซ ุฅุตุฏุงุฑ ุชู ุชุญูููู ููู ููุฑุณ Git ุจุงุณุชุฎุฏุงู <code>GetIndexContent</code> ู <code>GetIndexContent</code> .  ููุง ูู ุชูููุฐูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetInitialContent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Repository repo, StatusEntry item</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> blob = repo.Head.Tip[item.FilePath]?.Target <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Blob; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (blob == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> content = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamReader(blob.GetContentStream(), Encoding.UTF8); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> content.ReadToEnd(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetIndexContent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Repository repo, StatusEntry item</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id = repo.Index[item.FilePath]?.Id; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (id == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> itemBlob = repo.Lookup&lt;Blob&gt;(id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (itemBlob == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> content = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamReader(itemBlob.GetContentStream(), Encoding.UTF8); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> content.ReadToEnd(); }</code> </pre> <br><p style=";text-align:right;direction:rtl">            .     <code>GetConstantValues</code> .   <a href="https://github.com/dotnet/roslyn" rel="nofollow"><code>Roslyn</code></a>    .      NuGet- <code>Microsoft.CodeAnalysis.CSharp</code> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> ISet&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetConstantValues</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileContent</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(fileContent)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tree = CSharpSyntaxTree.ParseText(fileContent); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> root = tree.GetCompilationUnitRoot(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> enumDeclaration = root .DescendantNodes() .OfType&lt;EnumDeclarationSyntax&gt;() .FirstOrDefault(e =&gt; e.Identifier.Text == <span class="hljs-string"><span class="hljs-string">"Constants"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(enumDeclaration == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> member <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumDeclaration.Members) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.TryParse(member.EqualsValue.Value.ToString(), <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)) { result.Add(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p style=";text-align:right;direction:rtl">   <code>Roslyn</code>     .   ,     ,    <code>Microsoft.CodeAnalysis.CSharp</code>  <code>3.4.0</code> .       <code>gitHookAssemblies</code> ,    ,        .      .  , <code>dotnet-script</code>    <code>Roslyn</code>   .  ,  -   <code>Microsoft.CodeAnalysis.CSharp</code>     .       <code>3.3.1</code> .           NuGet-,  . </p><br><p style=";text-align:right;direction:rtl"> , ,   <code>Process</code>   hook`,           Web-. </p><br><h2 id="napravleniya-dalneyshego-razvitiya" style=";text-align:right;direction:rtl">    </h2><br><p style=";text-align:right;direction:rtl">   .      .         ,     . </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">    <code>pre-commit</code> ,      ,      <code>.git\hooks</code>    .     <code>--template</code>  <code>git init</code> .   - : </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">git config init.templatedir git_template_dir git init</code> </pre> <br><p style=";text-align:right;direction:rtl">     <code>core.hooksPath</code>  Git,     Git 2.9   : </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">git config core.hooksPath git_template_dir</code> </pre> <br><p style=";text-align:right;direction:rtl">           . </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">        <code>dotnet-script</code> .              .NET Core,         . </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">       ,    .  ,       <code>gitHookAssemblies</code> ,    ,      . ,  <code>LibGit2Sharp</code>         .    <code>git2-7ce88e6.dll</code> ,   Win-x64.        ,     . </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">        Web-.    Windows-,      .   Web-    UI        . </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">   ,        Git hook'  .  ,      . </p><br></li></ol><br><h2 id="zaklyuchenie" style=";text-align:right;direction:rtl">  ุงุณุชูุชุงุฌ </h2><br><p style=";text-align:right;direction:rtl">            Git hook`   .NET.        ,            . </p><br><p style=";text-align:right;direction:rtl">  ,      .  ุญุธุง ุณุนูุฏุง </p><br><p style=";text-align:right;direction:rtl"> PS         <a href="https://github.com/yakimovim/csharp-git-hooks" rel="nofollow">GitHub</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar485218/">https://habr.com/ru/post/ar485218/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar485204/index.html">ุนูุฏุฉ ุฅูู ุงูุฃุนูู: ููุงุฐุง ุณุชุชุฌุงูุฒ ุงููููุฉ ุงูุณูููุฉ ููุฃูุงุฒูู ูุฑุฉ ุฃุฎุฑู ูุฑูุจูุง ุชุฑููููู ุฏููุงุฑ</a></li>
<li><a href="../ar485206/index.html">ููู ูุฎูุจ ูู Typescript ููู ูุณุชุญู ูู ูุฐุง ุงูุนูุงุกุ</a></li>
<li><a href="../ar485208/index.html">ุฅูุดุงุก ุจููุฉ ุชุญุชูุฉ ูุชูููููุฌูุง ุงููุนูููุงุช ุชุชุญูู ุงูุฃุฎุทุงุก. ุงูุฌุฒุก 2. ุชุซุจูุช ูุชูููู ูุชูุฉ 4.3 virt</a></li>
<li><a href="../ar485210/index.html">ูุทูู ุงููุงุฑ ุบูุจูุจุฉ ุจุณูุทุฉ ุนูู ุงููุญุฏุฉ</a></li>
<li><a href="../ar485214/index.html">CLRium # 7: ุนููู. ุงูุญููุฉ ุงูุฏุฑุงุณูุฉ ุ ูุงููุงุฌุจุงุช ุงูููุฒููุฉ ูุน ุงูุชุญูู ุ ูุงูุชูุฌูู</a></li>
<li><a href="../ar485220/index.html">ุชุทูุฑ ุฌุฏุงุฑ ุญูุงูุฉ ุชุทุจูู ุงูููุจ: ูู ุฌุฏุฑุงู ุงูุญูุงูุฉ ุฅูู ุฃูุธูุฉ ุงูุฃูุงู ุงููุณุชูุฏุฉ ุฅูู ูุฌููุนุฉ ุงููุธุฑุงุก</a></li>
<li><a href="../ar485222/index.html">ููู ุชุนูู ูุน ูุงุฏุฉ ุงูุฑุฃู ูู ุงูุตููุ ุฎูุณ ูุตุงุฆุญ ุนูููุฉ</a></li>
<li><a href="../ar485224/index.html">ููู ูุชู ุชุณููู ุงูุจุถุงุฆุน ุงูุชู ุชูุน ุถูู ุงูุญุฏูุฏ ุงูุฌูุฑููุฉ ุงุนุชุจุงุฑูุง ูู 1 ููุงูุฑ 2020</a></li>
<li><a href="../ar485226/index.html">ุชุทููุฑ ูุงุฌูุฉ ุงููุณุชุฎุฏู: ููู ุชุณุชูุน ุฅููู - ููุณู ุฃู ุงููุณุชุฎุฏูุ</a></li>
<li><a href="../ar485228/index.html">ูุง ูู ุงูุชุนูู ุงููุดุทุ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>