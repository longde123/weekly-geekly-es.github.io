<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ú≥Ô∏è ü§ûüèø üë®üèª‚Äçüíª Cr√©ez une application Android. T√¢che avec un ast√©risque üö¥üèΩ üèÇüèø üë©üèΩ‚Äçü§ù‚Äçüë®üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! En √©t√©, j'ai parl√© au Meetup Summer Droid avec un rapport sur la construction d'une application Android. La version vid√©o peut √™tre tro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cr√©ez une application Android. T√¢che avec un ast√©risque</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/funcorp/blog/469771/"><img src="https://habrastorage.org/webt/-b/02/yh/-b02yhihv1wljls_lzryoh__sbe.png"><br><br>  Bonjour, Habr!  En √©t√©, j'ai parl√© au Meetup Summer Droid avec un rapport sur la construction d'une application Android.  La version vid√©o peut √™tre trouv√©e ici: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr.com/ru/company/funcorp/blog/462825</a> .  Et pour ceux qui aiment en savoir plus, je viens d'√©crire cet article. <br><br>  Il s'agit de ce que c'est - une application Android.  Nous allons nous assembler de diff√©rentes mani√®res Bonjour tout le monde!: Commencez √† partir de la console et voyez ce qui se passe sous le capot des syst√®mes de construction, puis retournez dans le pass√©, souvenez-vous de Maven et d√©couvrez les solutions Bazel et Buck modernes.  Et enfin, tout cela est comparable. <br><a name="habracut"></a><br>  Nous avons pens√© √† un √©ventuel changement dans le syst√®me d'assemblage lorsque nous avons commenc√© un nouveau projet.  Il nous a sembl√© que c'√©tait une bonne occasion de chercher des alternatives √† Gradle.  De plus, il est plus facile de le faire au d√©but que de traduire un projet existant.  Les d√©fauts de Gradle suivants nous ont pouss√©s √† cette √©tape: <br><br><ul><li>  il a certainement des probl√®mes avec l'assemblage incr√©mental, bien qu'il puisse voir des progr√®s dans cette direction; </li><li>  il fait mal avec de tr√®s grands projets monolithiques; </li><li>  il arrive qu'un d√©mon commence depuis tr√®s longtemps; </li><li>  exigeant sur la machine sur laquelle il fonctionne. </li></ul><br><h2>  APK </h2><br>  Tout d'abord, rappelez-vous en quoi consiste l'application Android: code compil√©, ressources et AndroidManifest.xml. <br><br><img src="https://habrastorage.org/webt/pe/do/sm/pedosmtvfcqralxv1td9d4xcjg0.jpeg"><br><br>  Les sources se trouvent dans le fichier classes.dex (il peut y avoir plusieurs fichiers, selon la taille de l'application) dans un format dex sp√©cial avec lequel la machine virtuelle Android peut fonctionner.  Aujourd'hui, c'est ART, sur des appareils plus anciens - Dalvik.  De plus, vous pouvez trouver le dossier lib, o√π les sources natives sont organis√©es en sous-dossiers.  Ils seront nomm√©s en fonction de l'architecture du processeur cible, par exemple x86, arm, etc.  Si vous utilisez exoplayer, vous avez probablement lib.  Et le dossier aidl, qui contient des interfaces de communication interprocessus.  Ils vous seront utiles si vous devez acc√©der √† un service ex√©cut√© dans un autre processus.  Ces interfaces sont utilis√©es √† la fois dans Android lui-m√™me et dans GooglePlayServices. <br><br>  Diverses ressources non compil√©es comme des images se trouvent dans le dossier res.  Toutes les ressources compil√©es, telles que les styles, les lignes, etc., sont fusionn√©es dans un fichier resource.arsc.  Dans le dossier des ressources, en r√®gle g√©n√©rale, ils mettent tout ce qui ne tient pas dans les ressources, par exemple, les polices personnalis√©es. <br><br>  En plus de tout cela, l'APK contient AndroidManifest.xml.  Nous y d√©crivons divers composants de l'application, tels que l'activit√©, le service, diff√©rentes autorisations, etc.  Il se trouve sous forme binaire, et pour regarder √† l'int√©rieur, il devra d'abord √™tre converti en un fichier lisible par l'homme. <br><br><h2>  CONSOLE </h2><br>  Maintenant que nous savons en quoi consiste l'application, nous pouvons essayer de construire Hello, world!  √† partir de la console √† l'aide des outils fournis par le SDK Android.  Il s'agit d'une √©tape assez importante pour comprendre le fonctionnement des syst√®mes de g√©n√©ration, car ils d√©pendent tous de ces utilitaires √† un degr√© ou √† un autre.  Puisque le projet est √©crit en Kotlin, nous avons besoin de son compilateur pour la ligne de commande.  Il est facile de t√©l√©charger s√©par√©ment. <br><br>  L'assemblage de l'application peut √™tre divis√© en plusieurs √©tapes: <br><br><ul><li>  T√©l√©chargez et d√©compressez toutes les biblioth√®ques dont d√©pend le projet.  Dans mon cas, il s'agit de la biblioth√®que de compatibilit√© descendante appcompat, qui, √† son tour, d√©pend du noyau appcompat, nous la pompons donc √©galement; </li><li>  g√©n√©rer R.java.  Cette merveilleuse classe contient les identifiants de toutes les ressources de l'application et est utilis√©e pour y acc√©der en code; </li><li>  nous compilons les sources en bytecode et les traduisons en Dex, car la machine virtuelle Android ne sait pas comment travailler avec le bytecode habituel; </li><li>  nous emballons tout dans l'APK, mais alignons d'abord toutes les ressources incompressibles, telles que les images, par rapport au d√©but du fichier.  Cela permet au prix d'une augmentation compl√®tement insignifiante de la taille de l'APK d'acc√©l√©rer consid√©rablement son travail.  Ainsi, le syst√®me peut directement mapper les ressources √† la RAM en utilisant la fonction mmap (). </li><li>  signer la demande.  Cette proc√©dure prot√®ge l'int√©grit√© de l'APK et confirme la paternit√©.  Et gr√¢ce √† cela, par exemple, le Play Market peut v√©rifier que l'application a √©t√© cr√©√©e par vous. </li></ul><br><div class="spoiler">  <b class="spoiler_title">script de construction</b> <div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preparedir</span></span></span></span>() { rm -r -f <span class="hljs-variable"><span class="hljs-variable">$1</span></span> mkdir <span class="hljs-variable"><span class="hljs-variable">$1</span></span> } PROJ=<span class="hljs-string"><span class="hljs-string">"src/main"</span></span> LIBS=<span class="hljs-string"><span class="hljs-string">"libs"</span></span> LIBS_OUT_DIR=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$LIBS</span></span></span><span class="hljs-string">/out"</span></span> BUILD_TOOLS=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ANDROID_HOME</span></span></span><span class="hljs-string">/build-tools/28.0.3"</span></span> ANDROID_JAR=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ANDROID_HOME</span></span></span><span class="hljs-string">/platforms/android-28/android.jar"</span></span> DEBUG_KEYSTORE=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(echo ~)</span></span></span><span class="hljs-string">/.android/debug.keystore"</span></span> GEN_DIR=<span class="hljs-string"><span class="hljs-string">"build/generated"</span></span> KOTLIN_OUT_DIR=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$GEN_DIR</span></span></span><span class="hljs-string">/kotlin"</span></span> DEX_OUT_DIR=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$GEN_DIR</span></span></span><span class="hljs-string">/dex"</span></span> OUT_DIR=<span class="hljs-string"><span class="hljs-string">"out"</span></span> libs_res=<span class="hljs-string"><span class="hljs-string">""</span></span> libs_classes=<span class="hljs-string"><span class="hljs-string">""</span></span> preparedir <span class="hljs-variable"><span class="hljs-variable">$LIBS_OUT_DIR</span></span> aars=$(ls -p <span class="hljs-variable"><span class="hljs-variable">$LIBS</span></span> | grep -v /) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> filename <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-variable"><span class="hljs-variable">$aars</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> DESTINATION=<span class="hljs-variable"><span class="hljs-variable">$LIBS_OUT_DIR</span></span>/<span class="hljs-variable"><span class="hljs-variable">${filename%.*}</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"unpacking </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$filename</span></span></span><span class="hljs-string"> into </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DESTINATION</span></span></span><span class="hljs-string">"</span></span> unzip -o -q <span class="hljs-variable"><span class="hljs-variable">$LIBS</span></span>/<span class="hljs-variable"><span class="hljs-variable">$filename</span></span> -d <span class="hljs-variable"><span class="hljs-variable">$DESTINATION</span></span> libs_res=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$libs_res</span></span></span><span class="hljs-string"> -S </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DESTINATION</span></span></span><span class="hljs-string">/res"</span></span> libs_classes=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$libs_classes</span></span></span><span class="hljs-string">:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DESTINATION</span></span></span><span class="hljs-string">/classes.jar"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> preparedir <span class="hljs-variable"><span class="hljs-variable">$GEN_DIR</span></span> <span class="hljs-variable"><span class="hljs-variable">$BUILD_TOOLS</span></span>/aapt package -f -m \ -J <span class="hljs-variable"><span class="hljs-variable">$GEN_DIR</span></span> \ -M <span class="hljs-variable"><span class="hljs-variable">$PROJ</span></span>/AndroidManifest.xml \ -S <span class="hljs-variable"><span class="hljs-variable">$PROJ</span></span>/res \ <span class="hljs-variable"><span class="hljs-variable">$libs_res</span></span> \ -I <span class="hljs-variable"><span class="hljs-variable">$ANDROID_JAR</span></span> --auto-add-overlay preparedir <span class="hljs-variable"><span class="hljs-variable">$KOTLIN_OUT_DIR</span></span> compiledKotlin=<span class="hljs-variable"><span class="hljs-variable">$KOTLIN_OUT_DIR</span></span>/compiled.jar kotlinc <span class="hljs-variable"><span class="hljs-variable">$PROJ</span></span>/java <span class="hljs-variable"><span class="hljs-variable">$GEN_DIR</span></span> -include-runtime \ -cp <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ANDROID_JAR</span></span></span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$libs_classes</span></span></span><span class="hljs-string">"</span></span>\ -d <span class="hljs-variable"><span class="hljs-variable">$compiledKotlin</span></span> preparedir <span class="hljs-variable"><span class="hljs-variable">$DEX_OUT_DIR</span></span> dex=<span class="hljs-variable"><span class="hljs-variable">$DEX_OUT_DIR</span></span>/classes.dex <span class="hljs-variable"><span class="hljs-variable">$BUILD_TOOLS</span></span>/dx --dex --output=<span class="hljs-variable"><span class="hljs-variable">$dex</span></span> <span class="hljs-variable"><span class="hljs-variable">$compiledKotlin</span></span> preparedir <span class="hljs-variable"><span class="hljs-variable">$OUT_DIR</span></span> unaligned_apk=<span class="hljs-variable"><span class="hljs-variable">$OUT_DIR</span></span>/unaligned.apk <span class="hljs-variable"><span class="hljs-variable">$BUILD_TOOLS</span></span>/aapt package -f -m \ -F <span class="hljs-variable"><span class="hljs-variable">$unaligned_apk</span></span> \ -M <span class="hljs-variable"><span class="hljs-variable">$PROJ</span></span>/AndroidManifest.xml \ -S <span class="hljs-variable"><span class="hljs-variable">$PROJ</span></span>/res \ <span class="hljs-variable"><span class="hljs-variable">$libs_res</span></span> \ -I <span class="hljs-variable"><span class="hljs-variable">$ANDROID_JAR</span></span> --auto-add-overlay cp <span class="hljs-variable"><span class="hljs-variable">$dex</span></span> . <span class="hljs-variable"><span class="hljs-variable">$BUILD_TOOLS</span></span>/aapt add <span class="hljs-variable"><span class="hljs-variable">$unaligned_apk</span></span> classes.dex rm classes.dex aligned_apk=<span class="hljs-variable"><span class="hljs-variable">$OUT_DIR</span></span>/aligned.apk <span class="hljs-variable"><span class="hljs-variable">$BUILD_TOOLS</span></span>/zipalign -f 4 <span class="hljs-variable"><span class="hljs-variable">$unaligned_apk</span></span> <span class="hljs-variable"><span class="hljs-variable">$aligned_apk</span></span> <span class="hljs-variable"><span class="hljs-variable">$BUILD_TOOLS</span></span>/apksigner sign --ks <span class="hljs-variable"><span class="hljs-variable">$DEBUG_KEYSTORE</span></span> <span class="hljs-variable"><span class="hljs-variable">$aligned_apk</span></span></code> </pre> <br></div></div><br>  Selon les chiffres, il s'av√®re qu'un assemblage propre prend 7 secondes, et l'assemblage incr√©mentiel n'est pas en retard, car nous ne mettons rien en cache et nous reconstruisons tout √† chaque fois. <br><br><h2>  Maven </h2><br>  Il a √©t√© d√©velopp√© par les gars de l'Apache Software Foundation pour construire des projets Java.  Les configurations de build pour cela sont d√©crites en XML.  Les premi√®res r√©visions de Maven ont √©t√© collect√©es par Ant, et maintenant elles sont pass√©es √† la derni√®re version stable. <br><br>  Pour Maven: <br><br><ul><li>  Il prend en charge la mise en cache des artefacts d'assemblage, c'est-√†-dire  la construction incr√©mentielle doit √™tre plus rapide que propre; </li><li>  capable de r√©soudre les d√©pendances de tiers.  C'est-√†-dire  Lorsque vous sp√©cifiez une d√©pendance sur une biblioth√®que tierce dans la configuration Maven ou Gradle, vous n'avez pas √† vous soucier de ce dont elle d√©pend; </li><li>  Il y a beaucoup de documentation d√©taill√©e, car elle est sur le march√© depuis un certain temps. </li><li>  et cela peut √™tre un m√©canisme de construction familier si vous √™tes r√©cemment entr√© dans le monde du d√©veloppement Android depuis le backend. </li></ul><br>  Inconv√©nients de Maven: <br><br><ul><li>  D√©pend de la version de Java install√©e sur la machine sur laquelle l'assemblage a lieu; </li><li>  Le plugin Android est d√©sormais pris en charge par des d√©veloppeurs tiers: personnellement, je consid√®re cela comme un inconv√©nient tr√®s important, car un jour ils pourraient cesser de le faire; <br></li><li>  XML n'est pas tr√®s appropri√© pour d√©crire les configurations de construction en raison de sa redondance et de sa lourdeur; </li><li>  bien, et comme nous le verrons plus tard, il fonctionne plus lentement que Gradle, au moins sur un projet de test. </li></ul><br>  Pour construire, nous devons cr√©er pom.xml, qui contient une description de notre projet.  Dans l'en-t√™te, indiquez les informations de base sur l'artefact collect√©, ainsi que la version de Kotlin. <br><br><div class="spoiler">  <b class="spoiler_title">build config pom.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span>4.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.example<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>myapplication<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span>apk<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>My Application<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span>1.3.41<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>kotlin-stdlib<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${kotlin.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.google.android<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>android<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>4.1.1.4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>provided<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>kotlin-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${kotlin.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>process-sources<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.simpligility.maven.plugins<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>android-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sdk</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">platform</span></span></span><span class="hljs-tag">&gt;</span></span>28<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">platform</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">buildTools</span></span></span><span class="hljs-tag">&gt;</span></span>28.0.3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">buildTools</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sdk</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">failOnNonStandardStructure</span></span></span><span class="hljs-tag">&gt;</span></span>false<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">failOnNonStandardStructure</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  En termes de chiffres, tout n'est pas trop rose.  Un assemblage propre prend environ 12 secondes, tandis qu'un incr√©mentiel - 10. Cela signifie que Maven r√©utilise en quelque sorte les artefacts des assemblages pr√©c√©dents, ou, √† mon avis, il est plus probable que le plug-in pour la construction d'un projet Android l'emp√™che de le faire <br><br>  Maintenant, ils utilisent tout cela, je pense, tout d'abord, les cr√©ateurs du plugin sont les gars de la simplicit√©.  Des informations plus fiables sur ce probl√®me sont introuvables. <br><br><h2>  Bazel </h2><br>  Les ing√©nieurs dans les entrailles de Google ont invent√© Bazel pour construire leurs projets et l'ont r√©cemment transf√©r√© en open source.  Pour la description des build-configs Skylark ou Starlark de type python, les deux noms ont leur place.  Il est assembl√© √† l'aide de sa derni√®re version stable. <br><br>  Avantages de Bazel: <br><br><ul><li>  prise en charge de diff√©rents langages de programmation.  Si vous croyez √† la documentation, il sait comment collecter des projets pour iOs, Android ou m√™me un backend; </li><li>  Peut mettre en cache les artefacts pr√©c√©demment collect√©s </li><li>  capable de travailler avec les d√©pendances Maven; </li><li>  Bazel a, √† mon avis, un support tr√®s cool pour les projets distribu√©s.  Il peut sp√©cifier des r√©visions sp√©cifiques des r√©f√©rentiels git en tant que d√©pendances, et il les d√©chargera et les mettra en cache pendant le processus de construction.  Pour prendre en charge l'√©volutivit√©, Bazel peut, par exemple, distribuer diverses cibles sur des serveurs de build bas√©s sur le cloud, ce qui vous permet de cr√©er rapidement des projets volumineux. </li></ul><br>  Inconv√©nients de Bazel: <br><br><ul><li>  tout ce charme est tr√®s difficile √† maintenir, car les configurations de build sont tr√®s d√©taill√©es et d√©crivent le montage √† un niveau bas; </li><li>  entre autres, il semble que Bazel se d√©veloppe activement.  Pour cette raison, certains exemples ne sont pas collect√©s et ceux qui sont collect√©s peuvent utiliser la fonctionnalit√© obsol√®te, qui est marqu√©e comme obsol√®te; </li><li>  la documentation laisse d√©sormais beaucoup √† d√©sirer, surtout par rapport √† Gradle; </li><li>  sur les petits projets, l'√©chauffement et l'analyse des build-configs peuvent prendre plus de temps que l'assemblage lui-m√™me, ce qui n'est pas bon, √† mon avis. </li></ul><br>  Conceptuellement, la configuration de base de Bazel se compose de WORKSPACE, o√π nous d√©crivons toutes sortes de choses globales pour un projet, et BUILD, qui contient directement des cibles pour l'assemblage. <br>  D√©crivons WORKSPACE.  Puisque nous avons un projet Android, la premi√®re chose que nous configurons est le SDK Android.  De plus, une r√®gle de d√©chargement des configurations est import√©e ici.  Ensuite, puisque le projet est √©crit en Kotlin, il faut en pr√©ciser les r√®gles.  Ici, nous faisons cela, en faisant r√©f√©rence √† une r√©vision sp√©cifique directement √† partir du r√©f√©rentiel git. <br><br><div class="spoiler">  <b class="spoiler_title">ESPACE DE TRAVAIL</b> <div class="spoiler_text"><pre> <code class="python hljs">android_sdk_repository( name = <span class="hljs-string"><span class="hljs-string">"androidsdk"</span></span>, api_level = <span class="hljs-number"><span class="hljs-number">28</span></span>, build_tools_version = <span class="hljs-string"><span class="hljs-string">"28.0.3"</span></span> ) load(<span class="hljs-string"><span class="hljs-string">"@bazel_tools//tools/build_defs/repo:http.bzl"</span></span>, <span class="hljs-string"><span class="hljs-string">"http_archive"</span></span>) <span class="hljs-comment"><span class="hljs-comment"># # KOTLIN RULES # RULES_KOTLIN_VERSION = "990fcc53689c8b58b3229c7f628f843a60cb9f5c" http_archive( name = "io_bazel_rules_kotlin", url = "https://github.com/bazelbuild/rules_kotlin/archive/%s.zip" % RULES_KOTLIN_VERSION, strip_prefix = "rules_kotlin-%s" % RULES_KOTLIN_VERSION ) load("@io_bazel_rules_kotlin//kotlin:kotlin.bzl", "kotlin_repositories", "kt_register_toolchains") kotlin_repositories() kt_register_toolchains()</span></span></code> </pre><br></div></div><br>  Commen√ßons maintenant sur la CONSTRUCTION. <br><br>  Nous importons d'abord la r√®gle d'assemblage de Kotlin et d√©crivons ce que nous voulons collecter.  Dans notre cas, il s'agit d'une application Android, nous utilisons donc android_binary, o√π nous d√©finissons le manifeste, le SDK minimum, etc.  Notre application d√©pendra de la source, nous les mentionnons donc dans les d√©p√¥ts et passons √† ce qu'ils sont et o√π les trouver.  Le code d√©pendra √©galement des ressources et de la biblioth√®que compatible avec l'application.  Pour les ressources, nous utilisons la cible habituelle pour assembler les sources Android, mais nous ne lui attribuons que des ressources sans classes java.  Et nous d√©crivons quelques r√®gles qui importent des biblioth√®ques tierces.  Il mentionne √©galement appcompat_core, dont d√©pend appcompat. <br><br><div class="spoiler">  <b class="spoiler_title">CONSTRUIRE</b> <div class="spoiler_text"><pre> <code class="python hljs">load(<span class="hljs-string"><span class="hljs-string">"@io_bazel_rules_kotlin//kotlin:kotlin.bzl"</span></span>, <span class="hljs-string"><span class="hljs-string">"kt_android_library"</span></span>) android_binary( name = <span class="hljs-string"><span class="hljs-string">"app"</span></span>, custom_package = <span class="hljs-string"><span class="hljs-string">"com.example.myapplication"</span></span>, manifest = <span class="hljs-string"><span class="hljs-string">"src/main/AndroidManifest.xml"</span></span>, manifest_values = { <span class="hljs-string"><span class="hljs-string">"minSdkVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"15"</span></span>, }, deps = [ <span class="hljs-string"><span class="hljs-string">":lib"</span></span>, ], ) kt_android_library( name = <span class="hljs-string"><span class="hljs-string">"lib"</span></span>, srcs = glob([<span class="hljs-string"><span class="hljs-string">"src/main/java/**/*"</span></span>]), deps = [ <span class="hljs-string"><span class="hljs-string">":res"</span></span>, <span class="hljs-string"><span class="hljs-string">":appcompat"</span></span>, ], ) android_library( name = <span class="hljs-string"><span class="hljs-string">"res"</span></span>, resource_files = glob([<span class="hljs-string"><span class="hljs-string">"src/main/res/**/*"</span></span>]), manifest = <span class="hljs-string"><span class="hljs-string">"src/main/AndroidManifest.xml"</span></span>, custom_package = <span class="hljs-string"><span class="hljs-string">"com.example.myapplication"</span></span>, ) aar_import( name = <span class="hljs-string"><span class="hljs-string">"appcompat"</span></span>, aar = <span class="hljs-string"><span class="hljs-string">"libs/appcompat.aar"</span></span>, deps = [ <span class="hljs-string"><span class="hljs-string">":appcompat_core"</span></span>, ] ) aar_import( name = <span class="hljs-string"><span class="hljs-string">"appcompat_core"</span></span>, aar = <span class="hljs-string"><span class="hljs-string">"libs/core.aar"</span></span>, )</code> </pre><br></div></div><br>  En chiffres pour un si petit projet, tout semble triste.  Plus d'une demi-minute pour une construction propre Bonjour tout le monde!  - beaucoup.  Le temps de construction incr√©mentiel est √©galement loin d'√™tre parfait. <br><br>  Bazel est utilis√© par ses cr√©ateurs (Google) pour certains de leurs projets, y compris ceux de serveur, ainsi que Dropbox et Huawei, qui collectent des applications mobiles pour eux.  Et le fameux Dagger 2 va √©galement √† Bazel. <br><br><h2>  Buck </h2><br>  Il a √©t√© invent√© par des transfuges de Google vers Facebook.  Il a utilis√© Python pour d√©crire les configurations, puis a migr√© vers le Skylark mentionn√© aujourd'hui.  Il va, tout d'un coup, utiliser le syst√®me Ant. <br><br>  Buck Pros: <br><br><ul><li>  prend en charge diff√©rents langages de programmation et peut cr√©er √† la fois Andriod et iOS; </li><li>  Peut mettre en cache les artefacts pr√©c√©demment collect√©s </li><li>  Buck a cr√©√© sa propre impl√©mentation dex, qui fonctionne plus rapidement que celle standard et se bloque avec le d√©mon syst√®me.  Ils √©conomisent donc du temps sur l'initialisation dex.  Les ing√©nieurs ont vraiment beaucoup optimis√©.  Par exemple, Buck ne collecte pas le code qui d√©pend de la biblioth√®que si l'interface n'a pas chang√© lors du changement des internes de la biblioth√®que.  De m√™me pour les ressources: si les identifiants n'ont pas chang√©, alors lors du changement de ressources, le code n'est pas remont√©. </li><li>  il y a un plugin qui peut cacher Buck derri√®re la configuration de Gredlovsky.  C'est-√†-dire  vous obtenez quelque chose comme un projet Gradle normal, qui est en fait construit par Buck. </li></ul><br>  Contre Buck: <br><br><ul><li>  il est aussi difficile √† entretenir que Bazel.  C'est-√†-dire  ici, il est √©galement n√©cessaire de d√©crire des r√®gles de bas niveau qui d√©crivent clairement le processus d'assemblage; </li><li>  Entre autres choses, Buck ne peut pas r√©soudre seul les d√©pendances Maven. </li></ul><br>  Alors, qu'est-ce que la configuration d'assemblage pour Hello, world!  √† travers buck?  Nous d√©crivons ici un fichier de configuration, o√π nous indiquons que nous voulons construire un projet Android qui sera sign√© avec une cl√© de d√©bogage.  L'application d√©pendra √©galement de la source-lib dans le tableau deps.  Vient ensuite la cible avec les param√®tres de signature.  J'utilise une cl√© de d√©bit fournie avec le SDK Android.  Imm√©diatement apr√®s, il suit l'objectif, qui collectera les sources de Kotlin pour nous.  Comme Bazel, cela d√©pend des ressources et des biblioth√®ques de compatibilit√©. <br><br>  Nous les d√©crivons.  Il y a un objectif distinct pour les ressources dans Buck, donc les v√©los ne sont pas utiles.  Voici les r√®gles pour les biblioth√®ques tierces t√©l√©charg√©es. <br><br><div class="spoiler">  <b class="spoiler_title">CONSTRUIRE</b> <div class="spoiler_text"><pre> <code class="python hljs">android_binary( name = <span class="hljs-string"><span class="hljs-string">'app'</span></span>, manifest = <span class="hljs-string"><span class="hljs-string">'src/main/AndroidManifest.xml'</span></span>, manifest_entries = { <span class="hljs-string"><span class="hljs-string">'min_sdk_version'</span></span>: <span class="hljs-number"><span class="hljs-number">15</span></span>, }, keystore = <span class="hljs-string"><span class="hljs-string">':debug_keystore'</span></span>, deps = [ <span class="hljs-string"><span class="hljs-string">':lib'</span></span>, ], ) keystore( name = <span class="hljs-string"><span class="hljs-string">'debug_keystore'</span></span>, store = <span class="hljs-string"><span class="hljs-string">'debug.keystore'</span></span>, properties = <span class="hljs-string"><span class="hljs-string">'debug.keystore.properties'</span></span>, ) android_library( name = <span class="hljs-string"><span class="hljs-string">'lib'</span></span>, srcs = glob([<span class="hljs-string"><span class="hljs-string">'src/main/java/*.kt'</span></span>]), deps = [ <span class="hljs-string"><span class="hljs-string">':res'</span></span>, <span class="hljs-string"><span class="hljs-string">':compat'</span></span>, <span class="hljs-string"><span class="hljs-string">':compat_core'</span></span>, ], language = <span class="hljs-string"><span class="hljs-string">'kotlin'</span></span>, ) android_resource( name = <span class="hljs-string"><span class="hljs-string">'res'</span></span>, res = <span class="hljs-string"><span class="hljs-string">"src/main/res"</span></span>, package = <span class="hljs-string"><span class="hljs-string">'com.example.myapplication'</span></span>, ) android_prebuilt_aar( name = <span class="hljs-string"><span class="hljs-string">'compat'</span></span>, aar = <span class="hljs-string"><span class="hljs-string">"libs/appcompat.aar"</span></span>, ) android_prebuilt_aar( name = <span class="hljs-string"><span class="hljs-string">'compat_core'</span></span>, aar = <span class="hljs-string"><span class="hljs-string">"libs/core.aar"</span></span>, )</code> </pre><br></div></div><br>  Tout cela va tr√®s vite.  Un assemblage propre prend un peu plus de 7 secondes, tandis qu'un assemblage incr√©mental est compl√®tement invisible 200 millisecondes.  Je pense que c'est un tr√®s bon r√©sultat. <br><br>  C'est ce que fait Facebook.  En plus de leur application phare, ils r√©cup√®rent Facebook Messenger pour eux.  Et Uber, qui a fait le plugin pour Gradle et Airbnb avec Lyft. <br><br><h2>  Conclusions </h2><br>  Maintenant que nous avons parl√© de chaque syst√®me de construction, nous pouvons les comparer les uns aux autres en utilisant l'exemple Hello, world!  L'ensemble console pla√Æt par sa stabilit√©.  Le temps d'ex√©cution du script √† partir du terminal peut √™tre consid√©r√© comme la r√©f√©rence pour l'assemblage de builds propres, car les co√ªts tiers pour l'analyse des scripts sont minimes ici.  Dans ce cas, j'appellerais Maven un √©tranger √©vident pour une augmentation extr√™mement insignifiante de l'assemblage incr√©mentiel.  Bazel analyse les configurations pendant tr√®s longtemps et s'initialise: il y a une id√©e qu'il cache en quelque sorte les r√©sultats de l'initialisation, car la construction incr√©mentielle qu'il ex√©cute est beaucoup plus rapide que clean.  Buck est le leader incontest√© de cette collection.  Assemblage tr√®s rapide, propre et incr√©mental. <br><br><img src="https://habrastorage.org/webt/br/f3/_p/brf3_pzmfeixbecyexdghd5ivfs.jpeg"><br><br>  Comparez maintenant les avantages et les inconv√©nients.  Je n'inclurai pas Maven dans la comparaison, car il perd clairement face √† Gradle et n'est presque jamais utilis√© sur le march√©.  J'unis Buck et Bazel, car ils ont √† peu pr√®s les m√™mes avantages et inconv√©nients. <br><br>  Donc, √† propos de Gradle: <br><br><ul><li>  la premi√®re et, √† mon avis, la chose la plus importante est que c'est simple.  Tr√®s simple; </li><li>  pr√™t √† l'emploi, d√©charge et d√©charge les d√©pendances; </li><li>  pour lui, il y a beaucoup de formations et de documentation diff√©rentes; </li><li>  activement soutenu par Google et la communaut√©.  Grande int√©gration avec Android Studio, l'outil de d√©veloppement phare actuel.  Et toutes les nouvelles fonctionnalit√©s pour cr√©er une application Android apparaissent d'abord dans Gradle. </li></ul><br>  √Ä propos de Buck / Bazel: <br><br><ul><li>  peut certainement √™tre tr√®s rapide par rapport √† Gradle.  Je pense que cela est particuli√®rement visible sur les tr√®s grands projets </li><li>  Vous pouvez conserver un projet dans lequel il y aura des codes source √† la fois iOS et Android, et les assembler avec un syst√®me de construction.  Cela permet √† certaines parties de l'application de t√¢tonner entre les plates-formes.  Par exemple, c'est ainsi que va le chrome; </li><li>  forc√© de d√©crire les d√©pendances en d√©tail et ainsi obliger litt√©ralement le d√©veloppeur √† √™tre multi-modulaire. </li></ul><br>  N'oubliez pas les inconv√©nients. <br><br>  Gradle paie pour sa simplicit√© en √©tant lent et inefficace. <br>  Buck / Bazel, au contraire, en raison de sa vitesse, souffre de la n√©cessit√© de d√©crire plus en d√©tail le processus de construction dans les configurations.  Eh bien, √©tant donn√© qu'ils sont apparus sur le march√© relativement r√©cemment, il n'y a pas beaucoup de documentation et diverses feuilles de triche. <br><br><h2>  iFUNNY </h2><br>  Vous avez peut-√™tre une question sur la fa√ßon dont nous collectons iFunny.  Comme beaucoup - en utilisant Gradle.  Et il y a des raisons √† cela: <br><br><ol><li>  On ne sait pas encore quel type de gain en vitesse d'assemblage cela nous donnera.  Une version propre d'iFunny prend pr√®s de 3 minutes, et incr√©mentielle - environ une minute, ce qui n'est en fait pas tr√®s long. </li><li>  Les configurations de construction Buck ou Bazel sont plus difficiles √† maintenir.  Dans le cas de Buck, vous devez √©galement surveiller la pertinence des biblioth√®ques connect√©es et des biblioth√®ques dont elles d√©pendent. </li><li>  Il est banalement co√ªteux de transf√©rer un projet existant de Gradle √† Buck / Bazel, surtout dans des conditions de profit incompr√©hensible. </li></ol><br>  Si votre projet va prendre plus de 45 minutes et qu'il y a environ 20 personnes dans l'√©quipe de d√©veloppement Android, alors il est logique de penser √† changer le syst√®me de construction.  Si vous et votre ami sciez une startup, utilisez Gradle et laissez tomber ces pens√©es. <br><br><img src="https://habrastorage.org/webt/ah/po/1o/ahpo1oen8smqi1ks_fdqfqeydea.jpeg"><br><br>  Je serai heureux de discuter des perspectives d'alternatives √† Gradle dans les commentaires! <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien vers le projet</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr469771/">https://habr.com/ru/post/fr469771/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr469755/index.html">Comment √™tre un bon programmeur</a></li>
<li><a href="../fr469757/index.html">La technologie AR au service de la peinture</a></li>
<li><a href="../fr469761/index.html">Comment impl√©menter l'analytique et ne pas casser l'application?</a></li>
<li><a href="../fr469765/index.html">L'√©loge se d√©tend et la critique est offensante - comment √©valuer le travail de quelqu'un d'autre, pour que tout le monde soit bien</a></li>
<li><a href="../fr469767/index.html">Comment nous avons choisi ServiceDesk. Partie 1</a></li>
<li><a href="../fr469775/index.html">Dessinez un son</a></li>
<li><a href="../fr469779/index.html">Meetup Outdoor Future London Academy</a></li>
<li><a href="../fr469783/index.html">Pourquoi l'avenir de la livraison peut-√™tre encore derri√®re les dirigeables</a></li>
<li><a href="../fr469785/index.html">Intel's Use NUC - Win NUC Contest. R√©sultats et gagnants</a></li>
<li><a href="../fr469797/index.html">Solution Veeam PN et ses nouvelles fonctionnalit√©s en version 2.0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>