<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍💻 🤶🏽 🤾🏻 Script Java! = JavaScript. Cinq javas dans une classe. Nous écrivons pour nous souvenir pour toujours 📰 👸🏼 👩🏼‍✈️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cette semaine, le groupe JUG.ru devrait publier une annonce. Jusqu'à ce que je dis quoi. La participation à des projets secrets éveille la créativité,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Script Java! = JavaScript. Cinq javas dans une classe. Nous écrivons pour nous souvenir pour toujours</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/429670/"><iframe width="560" height="315" src="https://www.youtube.com/embed/7SCwk02RPA0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Cette semaine, le groupe JUG.ru devrait publier une annonce.  Jusqu'à ce que je dis quoi.  La participation à des projets secrets éveille la créativité, alors voici une autre vidéo de nuit sur Java. <br><br>  Des nouvelles incroyables: maintenant ce n'est plus une heure et demie, mais environ 20 minutes, et il y a même quelque chose à regarder.  Un peu moins que complètement, il s'agit d'un screencast.  Ceux qui ne supportent pas ces déchets vidéo et aiment consommer le décryptage de texte, ont dû couper beaucoup de texte après la coupe.  Welkam et que Java soit avec vous. <br><a name="habracut"></a><br>  Bientôt 12 java seront publiés, et beaucoup sont encore assis sur Semerochka et croient que s'ils se mettent à jour, ils ne verront rien de particulièrement nouveau ou intéressant.  Dans ce très court numéro, nous allons apprendre à transformer la vie de nos collègues en enfer à l'aide de Java scripté, et à quelques endroits, je vis de nouveaux gadgets.  Eh bien, les obscurantistes, bien sûr, ne seront pas sauvés du progrès. <br><br>  Dites-moi, pourquoi mettez-vous à jour votre idée?  De nouvelles fonctionnalités y apparaissent constamment, de nouveaux raccourcis, multipliant par dix votre productivité en tant que développeur.  Mais vous ne les connaissez pas.  Lisez-vous vraiment ces nouvelles?  Si vous êtes un utilisateur moyen, alors probablement pas.  En principe, vous n'en avez rien à foutre la plupart du temps.  Vous mettez à jour l'idée simplement parce que ... vous le pouvez.  Parce que les skins sont magnifiques, le thème sombre, la barre tactile du MacBook.  Mais une telle explication ne manque pas devant les autorités comme la réponse «pourquoi acheter l'idée». <br><br>  Au lieu de cela, nous pouvons dire que le 29 octobre, plus récemment, JetBrains a épinglé le support <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des lignes brutes</a> dans la version bêta d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Idea</a> .  L'idée est en version bêta, les lignes sont dans l'aperçu, mais ce n'est plus important pour personne.  Si vous êtes si têtu que vous mettez 12 java, alors vous avez des problèmes plus graves.  Je le sais par moi-même. <br><br>  Voyons à quoi cela ressemble dans la pratique.  Pour ce faire, essayez de résoudre une sorte de problème de démonstration.  Très souvent, il y a le problème de l'écriture de quelque chose.  Par exemple, dans les jeux informatiques, ce sont des quêtes, dans jenkins, ce sont des scripts de construction, etc.  Habituellement, Python ou Grooves sont utilisés pour cela, et prenons et utilisons Java nu!  Pourquoi, pourquoi?  Parce que nous pouvons, en trois lignes, et même sans hacks.  Cela ressemble à une excellente idée :-) <br><br><h1>  Où regarder </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tout est sur le github</a> . <br><br><h1>  Portée </h1><br>  Imaginez que nous ayons un fichier comme celui-ci: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> io.javawatch; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloHabrPrototype</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello Habr!"</span></span>; } };</code> </pre> <br>  Nous voulons qu'il soit exécuté non pas lors de la compilation de l'application entière, mais en tant que chaîne - après le lancement.  Comme un script, c'est. <br><br><h1>  Manuellement </h1><br>  Vous devez d'abord tout dépasser en une chaîne. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String SOURCE = <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" package io.javawatch;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" public class HelloHabr {\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" public String get() {\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" return \"Hello Habr!\";\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" }\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" };"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String CNAME = <span class="hljs-string"><span class="hljs-string">"io.javawatch.HelloHabr"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String CODE_CACHE_DIR = <span class="hljs-string"><span class="hljs-string">"C:/temp/codeCache"</span></span>;</code> </pre><br>  Tous ces "\ n" atouts et tirets semblent extrêmement misérables. <br><br>  Auparavant, tout ce que nous pouvions faire était de mettre le code dans un fichier et de le lire.  C'est probablement une bonne solution, mais elle n'est pas toujours adaptée.  Par exemple, vous êtes conférencier lors d'une conférence et montrez le code des diapositives.  Même la construction ci-dessus est bien meilleure qu'une simple référence non étayée que vous avez un code quelque part qui fait quelque chose là-bas.  Le changement de diapositives consomme du temps et l'attention du public.  Eh bien et ainsi de suite.  En bref, les cas, lorsque vous avez besoin du code exactement en ligne, vous pouvez trouver. <br><br>  Nous avons maintenant la possibilité de nous débarrasser des ordures à l'aide de chaînes brutes.  Nous nous levons avec le curseur sur le code, appuyez sur Alt + Entrée (ou tout ce qui s'exécute sur votre système d'exploitation Quck Fix dans l'idée).  Sélectionnez "convertir en chaîne littérale brute" et obtenez ce nyashka: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String SOURCE = ` <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> io.javawatch; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloHabr</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello Habr!"</span></span>; } };`; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String CNAME = <span class="hljs-string"><span class="hljs-string">"io.javawatch.HelloHabr"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String CODE_CACHE_DIR = <span class="hljs-string"><span class="hljs-string">"C:/temp/codeCache"</span></span>;</code> </pre><br>  À mon avis, pour cette fonctionnalité, il vaut déjà la peine d'exécuter JDK 12. <br><br>  Soit dit en passant, pour que la fonctionnalité fonctionne, vous devrez faire plusieurs choses: <br><br><ul><li>  Téléchargez JDK 12 et enregistrez-vous dans les paramètres du projet </li><li>  Dans les paramètres globaux de javac, définissez l'indicateur <code>--release</code> , la version 12 du bytecode, des indicateurs supplémentaires <code>--enable-preview</code> <code>-Xlint:preview</code> </li><li>  Maintenant, dans toute configuration d'exécution / débogage, vous devez ajouter l'indicateur VM <code>--enable-preview</code> </li></ul><br>  Si vous ne comprenez pas, comment cela se fait, consultez mon screencast de la rubrique post, tout est assez clair là-bas. <br><br>  Maintenant, pour commencer, vous devez effectuer trois étapes simples: transformer la chaîne en une représentation interne pratique de la source, la compiler et exécuter: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* 1 */</span></span> RuntimeSource file = RuntimeSource.create(); <span class="hljs-comment"><span class="hljs-comment">//SimpleJavaFileObject /* 2 */ compile(Collections.singletonList(file)); /* 3 */ String result = run(); /* 4 */ /* ??? */ /* 5 */ /* PROFIT! */ System.out.println(result); }</span></span></code> </pre><br>  Il existe une classe <code>SimpleJavaFileObject</code> pour la «représentation pratique», mais elle a une fonctionnalité intéressante.  C'est cruellement abstrait.  Autrement dit, sa méthode clé, que la source compilée doit renvoyer, lance toujours une exécution dans l'espoir que nous la sous-classerons: <br><br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * This implementation always throws {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@linkplain</span></span></span><span class="hljs-comment"> * UnsupportedOperationException}. Subclasses can change this * behavior as long as the contract of {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> FileObject} is * obeyed. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CharSequence </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCharContent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ignoreEncodingErrors)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UnsupportedOperationException(); }</code> </pre><br>  Vous devez donc écrire une partie de votre héritier.  Veuillez noter que le constructeur <code>SimpleJavaFileObject</code> origine veut un URI pour la classe compilée, mais où l'obtenons-nous?  Par conséquent, je suggère de simplement le coller de la manière la plus évidente, comme ici dans la fonction <code>buildURI</code> : <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RuntimeSource</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleJavaFileObject</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String contents = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CharSequence </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCharContent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ignoreEncodingErrors)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> contents; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> RuntimeSource </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeSource(CNAME, SOURCE); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RuntimeSource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String className, String contents)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(buildURI(className), Kind.SOURCE); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.contents = contents; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> URI </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildURI</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String className)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// io.javawatch.HelloHabr -&gt; // string:///io/javawatch/HelloHabr.java URI uri = URI.create("string:///" + className.replace('.', '/') + Kind.SOURCE.extension); System.out.println(uri); return uri; }</span></span></code> </pre><br>  Passons maintenant à la compilation: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;RuntimeSource&gt; files)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ File ccDir = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(CODE_CACHE_DIR); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ccDir.exists()) { FileUtils.deleteDirectory(ccDir); FileUtils.forceMkdir(ccDir); } JavaCompiler compiler = ToolProvider.getSystemJavaCompiler(); Logger c = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Logger(); StandardJavaFileManager fileManager = compiler.getStandardFileManager(c, Locale.ENGLISH, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); Iterable options = Arrays.asList(<span class="hljs-string"><span class="hljs-string">"-d"</span></span>, CODE_CACHE_DIR, <span class="hljs-string"><span class="hljs-string">"--release=12"</span></span>, <span class="hljs-string"><span class="hljs-string">"--enable-preview"</span></span>, <span class="hljs-string"><span class="hljs-string">"-Xlint:preview"</span></span>); JavaCompiler.CompilationTask task = compiler.getTask(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, fileManager, c, options, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, files); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (task.call()) { System.out.println(<span class="hljs-string"><span class="hljs-string">"compilation ok"</span></span>); } }</code> </pre><br>  Remarque: nous passons quatre drapeaux pour l'assemblage, dont trois sont chargés de prescrire exactement les mêmes options que nous avons faites avec la souris dans les paramètres javac de l'Idea. <br><br>  Et enfin, exécutez notre classe temporaire: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> ClassNotFoundException, IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException, MalformedURLException </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   File ccDir = new File(CODE_CACHE_DIR); ClassLoader loader = new URLClassLoader(new URL[]{ccDir.toURL()}); var clss = loader.loadClass("io.javawatch.HelloHabr"); // Java 10 //    Object instance = clss.getConstructor().newInstance(); // Java 9 // Object instance = clss.newInstance(); Method thisMethod = clss.getDeclaredMethod("get"); Object result = thisMethod.invoke(instance); return (String) result; }</span></span></code> </pre><br>  Veuillez noter que <code>var clss = loader.loadClass</code> plus pratique pour écrire que <code>Class&lt;?&gt; clss = loader.loadClass</code> , et n'introduit pas de nouveaux vorings.  Le mot-clé <code>var</code> est apparu dans le Top Ten. <br><br>  Notez également que <code>clss.newInstance()</code> proposé pour être coupé à partir de Neuf.  Il avale les exceptions, ce qui est mauvais.  The Nine suggère d'abord d'appeler <code>getConstructor</code> , qui est paramétré et lève les exceptions correctes. <br><br>  Veuillez également noter que j'ai appelé la variable le mot <code>class</code> , mais Java n'a pas juré.  Devoirs: vous pouvez le faire de plusieurs manières, vous devez comprendre laquelle est la plus intéressante et pourquoi. <br><br>  Eh bien, en général, c'est tout.  Ça marche. <br><br><h1>  Automatisation </h1><br>  Ici, le critique s'exclamera, tout est en noir ici, car il y a des bibliothèques dans le monde Java qui compilent tout pour vous en une seule ligne. <br><br>  OK, jetons un coup d'œil.  Voici le code sur la bibliothèque JOOR, située en haut de Google: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> io.javawatch; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.joor.Reflect; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.function.Supplier; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Automatic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Supplier&lt;String&gt; supplier = Reflect.compile( <span class="hljs-string"><span class="hljs-string">"io.javawatch.HelloHabr"</span></span>, ` <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> io.javawatch; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloHabr</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">util</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">function</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Supplier</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello Habr!"</span></span>; } };` ).create().get(); System.out.println(supplier.get()); } }</code> </pre><br>  Comme si tout allait bien.  En effet, sur une seule ligne, sauf que je devais faire glisser le saplayer. <br><br>  Mais il y a une nuance.  Essayez de retourner "Bonjour Habr!"  comme littéral de chaîne brute: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ``Hello Habr!``; }</code> </pre><br>  Tout se bloquera instantanément avec l'erreur "(utilisez --able-preview pour activer les littéraux de chaîne bruts)".  Mais l'avons-nous déjà allumé?  Oui, au diable avec deux.  Nous l'avons inclus dans l'Idée, et JOOR le construit avec un compilateur système!  Jetons un coup d'œil à ce qu'il y a à l'intérieur: <br><br><pre> <code class="java hljs">JavaCompiler compiler = ToolProvider.getSystemJavaCompiler(); ompiler.getTask(out, fileManager, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, files).call();</code> </pre><br>  Et qu'en est-il de nous quand nous appelions nous-mêmes le même JavaCompiler? <br><br><pre> <code class="java hljs"> Iterable options = Arrays.asList(<span class="hljs-string"><span class="hljs-string">"-d"</span></span>, CODE_CACHE_DIR, <span class="hljs-string"><span class="hljs-string">"--release=12"</span></span>, <span class="hljs-string"><span class="hljs-string">"--enable-preview"</span></span>, <span class="hljs-string"><span class="hljs-string">"-Xlint:preview"</span></span>); JavaCompiler.CompilationTask task = compiler.getTask(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, fileManager, c, options, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, files);</code> </pre><br>  Et dans JOOR, il y a juste un null nul au lieu d'options.  Ils ne peuvent même pas être passés à l'intérieur! <br><br>  C'est probablement une bonne idée de leur envoyer une telle pull request à Github dans JOOR.  Si je ne vais pas le faire moi-même, tu le fais, hein? <br><br>  Et la morale est simple, ayez peur des cadeaux open source.  Parfois, il est plus facile d'écrire un petit mur de texte, mais contrôlez-le. <br><br><h1>  Manière la plus simple </h1><br>  Il existe un moyen de ne pas écrire un mur de texte et de ne pas utiliser de bibliothèques suspectes.  À partir de Java 9, nous avons un shell interactif (similaire à celui de Python, Ruby et d'autres langages de script) qui peut exécuter des commandes Java.  Et bien sûr, il est écrit en Java lui-même et est disponible en tant que classe Java.  Vous pouvez en créer une instance et simplement effectuer directement l'affectation nécessaire: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shell</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jShell = JShell.create(); <span class="hljs-comment"><span class="hljs-comment">//Java 9 jShell.eval("String result;"); jShell.eval(`result = "Hello Habr!";`); //Java 12 var result = jShell.variables() //Streams: Java 8, var: Java 10 .filter((@Nullable var v) -&gt; v.name().equals("result")) //var+lambda: Java 11 .findAny() .get(); System.out.println(jShell.varValue(result)); } }</span></span></code> </pre><br>  Les flux sont apparus dans Java 8, et maintenant ils sont utilisés partout, et vous n'avez même plus besoin d'appeler <code>stream()</code> vous-même, d'autres l'appelleront pour vous.  Dans ce cas, l'appel de <code>variables()</code> renvoie exactement le flux, pas l'ArrayList, comme l'aurait fait quelqu'un d'une enfance difficile de sept ans.  Le résultat du flux peut être immédiatement versé dans <code>var</code> . <br><br>  Notez que vous pouvez maintenant écrire <code>var</code> également dans les paramètres lambda.  Cette fonctionnalité est présente depuis Java 11. <br><br>  En général, il s'agit d'une classe très importante.  Il utilise un tas de fonctionnalités de différentes générations de Java, et tout cela a un aspect holistique et harmonieux.  Je suis sûr que de telles choses seront utilisées par tout le monde et partout, donc le code de Java 12 sera directement différent visuellement de ce que nous avions en Java 7. <br><br><h1>  Pour résumer </h1><br>  Nous avons examiné quelques fonctionnalités: <br><br><ul><li>  8: Stream (pour ceux dans le réservoir) </li><li>  9: JShell et nouvelles méthodes obsolètes </li><li>  10: mot clé var </li><li>  11: Développement var pour les paramètres lambda </li><li>  12: Littéraux à cordes brutes et leur support dans IntelliJ IDEA </li></ul><br>  Un petit avertissement pour les débutants.  Si vous faites constamment cela dans des applications réelles sans signification particulière, vos collègues deviendront fous au début, essayant de comprendre ce que vous avez écrit, puis ils pourront vous battre très douloureusement.  Et je ne parle pas de nouvelles fonctionnalités Java maintenant, mais de la compilation en runtime, bien sûr. <br><br>  Si vous souhaitez en savoir plus sur Java en tant que langage, vous devriez, par exemple, consulter les rapports de Tagir Valeev.  Vous le connaissez en tant que mec du haut du hub Java à Habré, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">lany</a> .  Au Joker, il a parlé d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Amber</a> , et au JPoint - ses célèbres <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">puzzles</a> , et ainsi de suite.  Là, et sur le langage Java, et sur IntelliJ IDEA, tout y est.  Tout cela peut être <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">trouvé sur YouTube</a> .  En fait, par jalousie de Tagir, qui peut dire quelque chose sur la langue elle-même, mais je ne le fais pas, et ce message s'est avéré.  Il y aura également de nouveaux jokers et JPoint, mais nous en discuterons plus tard. <br><br>  J'ai rempli mon devoir moral, un devoir envers Java.  De mon côté, les balles ont volé.  Et vous là-bas, sur les sept, qui n'avez pas le douzième Java, restez ici, vous tout le meilleur, la bonne humeur et la santé.  Je vous remercie </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr429670/">https://habr.com/ru/post/fr429670/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr429654/index.html">Améliorer la gestion de projet</a></li>
<li><a href="../fr429656/index.html">L'intelligence artificielle se trompe également. Comme Amazon Go nous raccourcit aux États-Unis - un magasin du futur sans caissiers ni vendeurs</a></li>
<li><a href="../fr429658/index.html">Internet par satellite SpaceX Starlink - «Licence d'impression d'argent»</a></li>
<li><a href="../fr429662/index.html">Nous brisons la protection contre les bots</a></li>
<li><a href="../fr429668/index.html">Google PageSpeed ​​Insights a radicalement mis à jour, qu'est-ce qui va changer?</a></li>
<li><a href="../fr429676/index.html">Sauvegarde sur bande</a></li>
<li><a href="../fr429678/index.html">Comment nous avons traduit 10 millions de lignes de code C ++ au standard C ++ 14 (puis au C ++ 17)</a></li>
<li><a href="../fr429680/index.html">Cours MIT "Sécurité des systèmes informatiques". Conférence 17: Authentification des utilisateurs, partie 1</a></li>
<li><a href="../fr429682/index.html">Cours MIT "Sécurité des systèmes informatiques". Conférence 17: Authentification des utilisateurs, partie 2</a></li>
<li><a href="../fr429684/index.html">Firebase Summit 2018: brièvement sur l'essentiel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>