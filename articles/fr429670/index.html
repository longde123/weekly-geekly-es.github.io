<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçüíª ü§∂üèΩ ü§æüèª Script Java! = JavaScript. Cinq javas dans une classe. Nous √©crivons pour nous souvenir pour toujours üì∞ üë∏üèº üë©üèº‚Äç‚úàÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cette semaine, le groupe JUG.ru devrait publier une annonce. Jusqu'√† ce que je dis quoi. La participation √† des projets secrets √©veille la cr√©ativit√©,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Script Java! = JavaScript. Cinq javas dans une classe. Nous √©crivons pour nous souvenir pour toujours</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/429670/"><iframe width="560" height="315" src="https://www.youtube.com/embed/7SCwk02RPA0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Cette semaine, le groupe JUG.ru devrait publier une annonce.  Jusqu'√† ce que je dis quoi.  La participation √† des projets secrets √©veille la cr√©ativit√©, alors voici une autre vid√©o de nuit sur Java. <br><br>  Des nouvelles incroyables: maintenant ce n'est plus une heure et demie, mais environ 20 minutes, et il y a m√™me quelque chose √† regarder.  Un peu moins que compl√®tement, il s'agit d'un screencast.  Ceux qui ne supportent pas ces d√©chets vid√©o et aiment consommer le d√©cryptage de texte, ont d√ª couper beaucoup de texte apr√®s la coupe.  Welkam et que Java soit avec vous. <br><a name="habracut"></a><br>  Bient√¥t 12 java seront publi√©s, et beaucoup sont encore assis sur Semerochka et croient que s'ils se mettent √† jour, ils ne verront rien de particuli√®rement nouveau ou int√©ressant.  Dans ce tr√®s court num√©ro, nous allons apprendre √† transformer la vie de nos coll√®gues en enfer √† l'aide de Java script√©, et √† quelques endroits, je vis de nouveaux gadgets.  Eh bien, les obscurantistes, bien s√ªr, ne seront pas sauv√©s du progr√®s. <br><br>  Dites-moi, pourquoi mettez-vous √† jour votre id√©e?  De nouvelles fonctionnalit√©s y apparaissent constamment, de nouveaux raccourcis, multipliant par dix votre productivit√© en tant que d√©veloppeur.  Mais vous ne les connaissez pas.  Lisez-vous vraiment ces nouvelles?  Si vous √™tes un utilisateur moyen, alors probablement pas.  En principe, vous n'en avez rien √† foutre la plupart du temps.  Vous mettez √† jour l'id√©e simplement parce que ... vous le pouvez.  Parce que les skins sont magnifiques, le th√®me sombre, la barre tactile du MacBook.  Mais une telle explication ne manque pas devant les autorit√©s comme la r√©ponse ¬´pourquoi acheter l'id√©e¬ª. <br><br>  Au lieu de cela, nous pouvons dire que le 29 octobre, plus r√©cemment, JetBrains a √©pingl√© le support <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des lignes brutes</a> dans la version b√™ta d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Idea</a> .  L'id√©e est en version b√™ta, les lignes sont dans l'aper√ßu, mais ce n'est plus important pour personne.  Si vous √™tes si t√™tu que vous mettez 12 java, alors vous avez des probl√®mes plus graves.  Je le sais par moi-m√™me. <br><br>  Voyons √† quoi cela ressemble dans la pratique.  Pour ce faire, essayez de r√©soudre une sorte de probl√®me de d√©monstration.  Tr√®s souvent, il y a le probl√®me de l'√©criture de quelque chose.  Par exemple, dans les jeux informatiques, ce sont des qu√™tes, dans jenkins, ce sont des scripts de construction, etc.  Habituellement, Python ou Grooves sont utilis√©s pour cela, et prenons et utilisons Java nu!  Pourquoi, pourquoi?  Parce que nous pouvons, en trois lignes, et m√™me sans hacks.  Cela ressemble √† une excellente id√©e :-) <br><br><h1>  O√π regarder </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tout est sur le github</a> . <br><br><h1>  Port√©e </h1><br>  Imaginez que nous ayons un fichier comme celui-ci: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> io.javawatch; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloHabrPrototype</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello Habr!"</span></span>; } };</code> </pre> <br>  Nous voulons qu'il soit ex√©cut√© non pas lors de la compilation de l'application enti√®re, mais en tant que cha√Æne - apr√®s le lancement.  Comme un script, c'est. <br><br><h1>  Manuellement </h1><br>  Vous devez d'abord tout d√©passer en une cha√Æne. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String SOURCE = <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" package io.javawatch;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" public class HelloHabr {\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" public String get() {\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" return \"Hello Habr!\";\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" }\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" };"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String CNAME = <span class="hljs-string"><span class="hljs-string">"io.javawatch.HelloHabr"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String CODE_CACHE_DIR = <span class="hljs-string"><span class="hljs-string">"C:/temp/codeCache"</span></span>;</code> </pre><br>  Tous ces "\ n" atouts et tirets semblent extr√™mement mis√©rables. <br><br>  Auparavant, tout ce que nous pouvions faire √©tait de mettre le code dans un fichier et de le lire.  C'est probablement une bonne solution, mais elle n'est pas toujours adapt√©e.  Par exemple, vous √™tes conf√©rencier lors d'une conf√©rence et montrez le code des diapositives.  M√™me la construction ci-dessus est bien meilleure qu'une simple r√©f√©rence non √©tay√©e que vous avez un code quelque part qui fait quelque chose l√†-bas.  Le changement de diapositives consomme du temps et l'attention du public.  Eh bien et ainsi de suite.  En bref, les cas, lorsque vous avez besoin du code exactement en ligne, vous pouvez trouver. <br><br>  Nous avons maintenant la possibilit√© de nous d√©barrasser des ordures √† l'aide de cha√Ænes brutes.  Nous nous levons avec le curseur sur le code, appuyez sur Alt + Entr√©e (ou tout ce qui s'ex√©cute sur votre syst√®me d'exploitation Quck Fix dans l'id√©e).  S√©lectionnez "convertir en cha√Æne litt√©rale brute" et obtenez ce nyashka: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String SOURCE = ` <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> io.javawatch; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloHabr</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello Habr!"</span></span>; } };`; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String CNAME = <span class="hljs-string"><span class="hljs-string">"io.javawatch.HelloHabr"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String CODE_CACHE_DIR = <span class="hljs-string"><span class="hljs-string">"C:/temp/codeCache"</span></span>;</code> </pre><br>  √Ä mon avis, pour cette fonctionnalit√©, il vaut d√©j√† la peine d'ex√©cuter JDK 12. <br><br>  Soit dit en passant, pour que la fonctionnalit√© fonctionne, vous devrez faire plusieurs choses: <br><br><ul><li>  T√©l√©chargez JDK 12 et enregistrez-vous dans les param√®tres du projet </li><li>  Dans les param√®tres globaux de javac, d√©finissez l'indicateur <code>--release</code> , la version 12 du bytecode, des indicateurs suppl√©mentaires <code>--enable-preview</code> <code>-Xlint:preview</code> </li><li>  Maintenant, dans toute configuration d'ex√©cution / d√©bogage, vous devez ajouter l'indicateur VM <code>--enable-preview</code> </li></ul><br>  Si vous ne comprenez pas, comment cela se fait, consultez mon screencast de la rubrique post, tout est assez clair l√†-bas. <br><br>  Maintenant, pour commencer, vous devez effectuer trois √©tapes simples: transformer la cha√Æne en une repr√©sentation interne pratique de la source, la compiler et ex√©cuter: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* 1 */</span></span> RuntimeSource file = RuntimeSource.create(); <span class="hljs-comment"><span class="hljs-comment">//SimpleJavaFileObject /* 2 */ compile(Collections.singletonList(file)); /* 3 */ String result = run(); /* 4 */ /* ??? */ /* 5 */ /* PROFIT! */ System.out.println(result); }</span></span></code> </pre><br>  Il existe une classe <code>SimpleJavaFileObject</code> pour la ¬´repr√©sentation pratique¬ª, mais elle a une fonctionnalit√© int√©ressante.  C'est cruellement abstrait.  Autrement dit, sa m√©thode cl√©, que la source compil√©e doit renvoyer, lance toujours une ex√©cution dans l'espoir que nous la sous-classerons: <br><br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * This implementation always throws {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@linkplain</span></span></span><span class="hljs-comment"> * UnsupportedOperationException}. Subclasses can change this * behavior as long as the contract of {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> FileObject} is * obeyed. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CharSequence </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCharContent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ignoreEncodingErrors)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UnsupportedOperationException(); }</code> </pre><br>  Vous devez donc √©crire une partie de votre h√©ritier.  Veuillez noter que le constructeur <code>SimpleJavaFileObject</code> origine veut un URI pour la classe compil√©e, mais o√π l'obtenons-nous?  Par cons√©quent, je sugg√®re de simplement le coller de la mani√®re la plus √©vidente, comme ici dans la fonction <code>buildURI</code> : <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RuntimeSource</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleJavaFileObject</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String contents = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CharSequence </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCharContent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ignoreEncodingErrors)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> contents; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> RuntimeSource </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeSource(CNAME, SOURCE); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RuntimeSource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String className, String contents)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(buildURI(className), Kind.SOURCE); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.contents = contents; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> URI </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildURI</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String className)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// io.javawatch.HelloHabr -&gt; // string:///io/javawatch/HelloHabr.java URI uri = URI.create("string:///" + className.replace('.', '/') + Kind.SOURCE.extension); System.out.println(uri); return uri; }</span></span></code> </pre><br>  Passons maintenant √† la compilation: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;RuntimeSource&gt; files)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ File ccDir = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(CODE_CACHE_DIR); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ccDir.exists()) { FileUtils.deleteDirectory(ccDir); FileUtils.forceMkdir(ccDir); } JavaCompiler compiler = ToolProvider.getSystemJavaCompiler(); Logger c = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Logger(); StandardJavaFileManager fileManager = compiler.getStandardFileManager(c, Locale.ENGLISH, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); Iterable options = Arrays.asList(<span class="hljs-string"><span class="hljs-string">"-d"</span></span>, CODE_CACHE_DIR, <span class="hljs-string"><span class="hljs-string">"--release=12"</span></span>, <span class="hljs-string"><span class="hljs-string">"--enable-preview"</span></span>, <span class="hljs-string"><span class="hljs-string">"-Xlint:preview"</span></span>); JavaCompiler.CompilationTask task = compiler.getTask(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, fileManager, c, options, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, files); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (task.call()) { System.out.println(<span class="hljs-string"><span class="hljs-string">"compilation ok"</span></span>); } }</code> </pre><br>  Remarque: nous passons quatre drapeaux pour l'assemblage, dont trois sont charg√©s de prescrire exactement les m√™mes options que nous avons faites avec la souris dans les param√®tres javac de l'Idea. <br><br>  Et enfin, ex√©cutez notre classe temporaire: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> ClassNotFoundException, IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException, MalformedURLException </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   File ccDir = new File(CODE_CACHE_DIR); ClassLoader loader = new URLClassLoader(new URL[]{ccDir.toURL()}); var clss = loader.loadClass("io.javawatch.HelloHabr"); // Java 10 //    Object instance = clss.getConstructor().newInstance(); // Java 9 // Object instance = clss.newInstance(); Method thisMethod = clss.getDeclaredMethod("get"); Object result = thisMethod.invoke(instance); return (String) result; }</span></span></code> </pre><br>  Veuillez noter que <code>var clss = loader.loadClass</code> plus pratique pour √©crire que <code>Class&lt;?&gt; clss = loader.loadClass</code> , et n'introduit pas de nouveaux vorings.  Le mot-cl√© <code>var</code> est apparu dans le Top Ten. <br><br>  Notez √©galement que <code>clss.newInstance()</code> propos√© pour √™tre coup√© √† partir de Neuf.  Il avale les exceptions, ce qui est mauvais.  The Nine sugg√®re d'abord d'appeler <code>getConstructor</code> , qui est param√©tr√© et l√®ve les exceptions correctes. <br><br>  Veuillez √©galement noter que j'ai appel√© la variable le mot <code>class</code> , mais Java n'a pas jur√©.  Devoirs: vous pouvez le faire de plusieurs mani√®res, vous devez comprendre laquelle est la plus int√©ressante et pourquoi. <br><br>  Eh bien, en g√©n√©ral, c'est tout.  √áa marche. <br><br><h1>  Automatisation </h1><br>  Ici, le critique s'exclamera, tout est en noir ici, car il y a des biblioth√®ques dans le monde Java qui compilent tout pour vous en une seule ligne. <br><br>  OK, jetons un coup d'≈ìil.  Voici le code sur la biblioth√®que JOOR, situ√©e en haut de Google: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> io.javawatch; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.joor.Reflect; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.function.Supplier; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Automatic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Supplier&lt;String&gt; supplier = Reflect.compile( <span class="hljs-string"><span class="hljs-string">"io.javawatch.HelloHabr"</span></span>, ` <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> io.javawatch; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloHabr</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">util</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">function</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Supplier</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello Habr!"</span></span>; } };` ).create().get(); System.out.println(supplier.get()); } }</code> </pre><br>  Comme si tout allait bien.  En effet, sur une seule ligne, sauf que je devais faire glisser le saplayer. <br><br>  Mais il y a une nuance.  Essayez de retourner "Bonjour Habr!"  comme litt√©ral de cha√Æne brute: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ``Hello Habr!``; }</code> </pre><br>  Tout se bloquera instantan√©ment avec l'erreur "(utilisez --able-preview pour activer les litt√©raux de cha√Æne bruts)".  Mais l'avons-nous d√©j√† allum√©?  Oui, au diable avec deux.  Nous l'avons inclus dans l'Id√©e, et JOOR le construit avec un compilateur syst√®me!  Jetons un coup d'≈ìil √† ce qu'il y a √† l'int√©rieur: <br><br><pre> <code class="java hljs">JavaCompiler compiler = ToolProvider.getSystemJavaCompiler(); ompiler.getTask(out, fileManager, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, files).call();</code> </pre><br>  Et qu'en est-il de nous quand nous appelions nous-m√™mes le m√™me JavaCompiler? <br><br><pre> <code class="java hljs"> Iterable options = Arrays.asList(<span class="hljs-string"><span class="hljs-string">"-d"</span></span>, CODE_CACHE_DIR, <span class="hljs-string"><span class="hljs-string">"--release=12"</span></span>, <span class="hljs-string"><span class="hljs-string">"--enable-preview"</span></span>, <span class="hljs-string"><span class="hljs-string">"-Xlint:preview"</span></span>); JavaCompiler.CompilationTask task = compiler.getTask(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, fileManager, c, options, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, files);</code> </pre><br>  Et dans JOOR, il y a juste un null nul au lieu d'options.  Ils ne peuvent m√™me pas √™tre pass√©s √† l'int√©rieur! <br><br>  C'est probablement une bonne id√©e de leur envoyer une telle pull request √† Github dans JOOR.  Si je ne vais pas le faire moi-m√™me, tu le fais, hein? <br><br>  Et la morale est simple, ayez peur des cadeaux open source.  Parfois, il est plus facile d'√©crire un petit mur de texte, mais contr√¥lez-le. <br><br><h1>  Mani√®re la plus simple </h1><br>  Il existe un moyen de ne pas √©crire un mur de texte et de ne pas utiliser de biblioth√®ques suspectes.  √Ä partir de Java 9, nous avons un shell interactif (similaire √† celui de Python, Ruby et d'autres langages de script) qui peut ex√©cuter des commandes Java.  Et bien s√ªr, il est √©crit en Java lui-m√™me et est disponible en tant que classe Java.  Vous pouvez en cr√©er une instance et simplement effectuer directement l'affectation n√©cessaire: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shell</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jShell = JShell.create(); <span class="hljs-comment"><span class="hljs-comment">//Java 9 jShell.eval("String result;"); jShell.eval(`result = "Hello Habr!";`); //Java 12 var result = jShell.variables() //Streams: Java 8, var: Java 10 .filter((@Nullable var v) -&gt; v.name().equals("result")) //var+lambda: Java 11 .findAny() .get(); System.out.println(jShell.varValue(result)); } }</span></span></code> </pre><br>  Les flux sont apparus dans Java 8, et maintenant ils sont utilis√©s partout, et vous n'avez m√™me plus besoin d'appeler <code>stream()</code> vous-m√™me, d'autres l'appelleront pour vous.  Dans ce cas, l'appel de <code>variables()</code> renvoie exactement le flux, pas l'ArrayList, comme l'aurait fait quelqu'un d'une enfance difficile de sept ans.  Le r√©sultat du flux peut √™tre imm√©diatement vers√© dans <code>var</code> . <br><br>  Notez que vous pouvez maintenant √©crire <code>var</code> √©galement dans les param√®tres lambda.  Cette fonctionnalit√© est pr√©sente depuis Java 11. <br><br>  En g√©n√©ral, il s'agit d'une classe tr√®s importante.  Il utilise un tas de fonctionnalit√©s de diff√©rentes g√©n√©rations de Java, et tout cela a un aspect holistique et harmonieux.  Je suis s√ªr que de telles choses seront utilis√©es par tout le monde et partout, donc le code de Java 12 sera directement diff√©rent visuellement de ce que nous avions en Java 7. <br><br><h1>  Pour r√©sumer </h1><br>  Nous avons examin√© quelques fonctionnalit√©s: <br><br><ul><li>  8: Stream (pour ceux dans le r√©servoir) </li><li>  9: JShell et nouvelles m√©thodes obsol√®tes </li><li>  10: mot cl√© var </li><li>  11: D√©veloppement var pour les param√®tres lambda </li><li>  12: Litt√©raux √† cordes brutes et leur support dans IntelliJ IDEA </li></ul><br>  Un petit avertissement pour les d√©butants.  Si vous faites constamment cela dans des applications r√©elles sans signification particuli√®re, vos coll√®gues deviendront fous au d√©but, essayant de comprendre ce que vous avez √©crit, puis ils pourront vous battre tr√®s douloureusement.  Et je ne parle pas de nouvelles fonctionnalit√©s Java maintenant, mais de la compilation en runtime, bien s√ªr. <br><br>  Si vous souhaitez en savoir plus sur Java en tant que langage, vous devriez, par exemple, consulter les rapports de Tagir Valeev.  Vous le connaissez en tant que mec du haut du hub Java √† Habr√©, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">lany</a> .  Au Joker, il a parl√© d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Amber</a> , et au JPoint - ses c√©l√®bres <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">puzzles</a> , et ainsi de suite.  L√†, et sur le langage Java, et sur IntelliJ IDEA, tout y est.  Tout cela peut √™tre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">trouv√© sur YouTube</a> .  En fait, par jalousie de Tagir, qui peut dire quelque chose sur la langue elle-m√™me, mais je ne le fais pas, et ce message s'est av√©r√©.  Il y aura √©galement de nouveaux jokers et JPoint, mais nous en discuterons plus tard. <br><br>  J'ai rempli mon devoir moral, un devoir envers Java.  De mon c√¥t√©, les balles ont vol√©.  Et vous l√†-bas, sur les sept, qui n'avez pas le douzi√®me Java, restez ici, vous tout le meilleur, la bonne humeur et la sant√©.  Je vous remercie </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr429670/">https://habr.com/ru/post/fr429670/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr429654/index.html">Am√©liorer la gestion de projet</a></li>
<li><a href="../fr429656/index.html">L'intelligence artificielle se trompe √©galement. Comme Amazon Go nous raccourcit aux √âtats-Unis - un magasin du futur sans caissiers ni vendeurs</a></li>
<li><a href="../fr429658/index.html">Internet par satellite SpaceX Starlink - ¬´Licence d'impression d'argent¬ª</a></li>
<li><a href="../fr429662/index.html">Nous brisons la protection contre les bots</a></li>
<li><a href="../fr429668/index.html">Google PageSpeed ‚Äã‚ÄãInsights a radicalement mis √† jour, qu'est-ce qui va changer?</a></li>
<li><a href="../fr429676/index.html">Sauvegarde sur bande</a></li>
<li><a href="../fr429678/index.html">Comment nous avons traduit 10 millions de lignes de code C ++ au standard C ++ 14 (puis au C ++ 17)</a></li>
<li><a href="../fr429680/index.html">Cours MIT "S√©curit√© des syst√®mes informatiques". Conf√©rence 17: Authentification des utilisateurs, partie 1</a></li>
<li><a href="../fr429682/index.html">Cours MIT "S√©curit√© des syst√®mes informatiques". Conf√©rence 17: Authentification des utilisateurs, partie 2</a></li>
<li><a href="../fr429684/index.html">Firebase Summit 2018: bri√®vement sur l'essentiel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>