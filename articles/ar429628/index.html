<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฃ ๐๏ธ ๐๐ฟ ููููุฉ ุฅูุดุงุก ุฑูุจูุช ููุฏุฑุฏุดุฉ ุนูู ููููุชุงูุชู ุจุงุณุชุฎุฏุงู Python ู Django ู webhook ๐ฐ๏ธ ๐๐ฟ ๐ฉโ๐ซ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ููุงุฐุง ููุงู ุขุฎุฑ ุญูู ุฅูุดุงุก ุฑูุจูุช ููุฏุฑุฏุดุฉุ 
 ุฑุจูุง ุจุญุซุช ุจุดูู ุณูุฆ ุ ูููู ูู ุฃุฌุฏ ุฏูููุงู ููุตูุงู ุญูู ุฅูุดุงุก ุจูุช ุจูุซูู ุจุงุณุชุฎุฏุงู ุฅุทุงุฑ Django ูููุฌ webhook ุ ุงูุฐู ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ููููุฉ ุฅูุดุงุก ุฑูุจูุช ููุฏุฑุฏุดุฉ ุนูู ููููุชุงูุชู ุจุงุณุชุฎุฏุงู Python ู Django ู webhook</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429628/" style=";text-align:right;direction:rtl"><h3 style=";text-align:right;direction:rtl">  ููุงุฐุง ููุงู ุขุฎุฑ ุญูู ุฅูุดุงุก ุฑูุจูุช ููุฏุฑุฏุดุฉุ </h3><br>  ุฑุจูุง ุจุญุซุช ุจุดูู ุณูุฆ ุ ูููู ูู ุฃุฌุฏ ุฏูููุงู ููุตูุงู ุญูู ุฅูุดุงุก ุจูุช ุจูุซูู ุจุงุณุชุฎุฏุงู ุฅุทุงุฑ Django ูููุฌ webhook ุ ุงูุฐู ุชุณุชุถููู ุดุฑูุฉ ุฑูุณูุฉ.  ุชุชุญุฏุซ ูุนุธู ุงูููุงุฏ ุนู ุงุณุชุฎุฏุงู ุฅุทุงุฑ ุนูู ุงููุงุฑูุฑุฉ ูุงุณุชุฎุฏุงู ุงูุงุณุชุถุงูุฉ ุงููุฌุงููุฉ ููู ูู Heroku ู PythonAnywhere.  ุชุณุงุนุฏูู ุชุฌุฑุจุฉ ูุฌุชูุน ุญุจุฑ ุนูู ุงูุฎุฑูุฌ ุ ูุฐูู ูุฑุฑุช ุฃู ุฃูุถู ุจุนุถ ุงูููุช ููุชุงุจุฉ ูุฐุง ุงูููุงู ุจุงูุชูุงู.  ุณุฃุตู ุงูุชุฌุฑุจุฉ ุงูุนูููุฉ ุงูููุชุณุจุฉ ูุชูููู ูู ุดุฎุต ููุชู ุจูุฐุง ุงูุฃูุฑ ูู ุชูููุฑ ุงูููุช ูููู ุฃูุถู ูููููุฉ ุนูู ุฑูุจูุช ูู Python ุจุงุณุชุฎุฏุงู ุฅุทุงุฑ Django ุนูู ุงุณุชุถุงูุชูู ุจุงุณุชุฎุฏุงู ููุฌ ุงูุฑุฏ ุงูุชููุงุฆู ุนูู ุงูููุจ. <br><a name="habracut"></a><br><h3 style=";text-align:right;direction:rtl">  ููุงุฐุง ุงูุงุณุชุถุงูุฉ ุงููุฏููุนุฉุ </h3><br>  ูู ุฑุฃูู ุ ูุฅู ุงููุณุฎุฉ ุงููุงุจูุฉ ููุชุทุจูู ูู ุงูุจูุช ูู ุนูุฏูุง ุชููู ูุณุชููุฉ ุนู ุงูููุจููุชุฑ ุงููุญูู ุงูุฎุงุต ุจู ููุชุงุญุฉ ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ ุทูุงู ุฃูุงู ุงูุฃุณุจูุน.  ููููุงู ุจุฐูู ุ ุชุญุชุงุฌ ุฅูู ุงุณุชุถุงูุฉ ููุฌุฏ ุนูููุง: ุฎุงุฏู ููุจ ุ ููุธุงู ุฅุฏุงุฑุฉ ูุงุนุฏุฉ ุจูุงูุงุช (ูุชุทููุฑ ูุฏุฑุงุช ุงูุฑูุจูุช) ุ ูุชุณุฌูู ุงุณู ุงููุทุงู ุ ูุงูุญุตูู ุนูู ุดูุงุฏุฉ SSL ููุง ูุฏุนู ููู ููู ูุฐุง ุงูุงูุชุตุงุฏ.  ุชููู ูุฐู ุงูุฎุฏูุงุช ุงููุงู.  ุฃุฏูุน ุงุณุชุถุงูุฉ 138 ุฑูุจู ุดูุฑููุง ููุญูุงุธ ุนูู ุงูุจููุฉ ุงูุชุญุชูุฉ ููุจูุช ููุนูู: ุฏุนู Python + Django ุ MySQL DBMS 25 GB ุ ูุฏุนู SSH. <br>  ูู ูุนุธู ุงูุฏุฑูุณ ุฑุฃูุช ุฃู ุงูููุจููุชุฑ ุงูุดุฎุตู ูุณุชุฎุฏู ูุฎุงุฏู ุฃู ุงุณุชุถุงูุฉ ูุฌุงููุฉ ูุน ูููุฏ ุนูู ุณุงุนุงุช ุงูุนูู ุ ููุง ุฅูู ุฐูู. ูู ุงูุฃูุซูุฉ ุ ูููู ุงูุจูุช ุจุงุณุชุทูุงุน ุฎุงุฏู ุงููุฑุงุณูุฉ ุจุดูู ุฏูุฑู ููุฑุณุงุฆู ุงูุฌุฏูุฏุฉ ุงููุงุฑุฏุฉ ูู ุงููุณุชุฎุฏููู.  ูุฐุง ุญูู ุฅุถุงูู ุนูู ุฎูุงุฏู ุงููุฑุงุณูุฉ ุ ูุฐุง ูููู "ุญุธุฑ" ุงูุจูุช ููุชุฑุฉ.  ูู ูุฐุง ุ ูู ุฑุฃูู ุ ููุณ ุญูููุง ููุงุณุชุฎุฏุงู ุงูููุชุฌ.  ูููู ููุงุฎุชุจุงุฑ ูุงูุชุฏุฑูุจ ูููู ุฌุฏุง. <br><br><h3 style=";text-align:right;direction:rtl">  ูุง ูู ุงูุฑุฏ ุงูุชููุงุฆู ุนูู ุงูููุจ ูููุงุฐุงุ </h3><br>  ุจุงููุณุจุฉ ููููุชุฌ ุ ุฃุนุชุจุฑ ุงููุฑุงุฑ ุงูุตุญูุญ ูุงุณุชุฎุฏุงู ุงูุฑุฏ ุงูุชููุงุฆู ุนูู ุงูููุจ ุ ุฃู ุงูููุฌ ุงูุฐู ูุชููุน ููู ุจุฑูุงูุฌ ุงูุฑูุจูุช ูุฏููุง ุงูุฑุณุงุฆู ูู ุฎุงุฏู ุงููุฑุงุณูุฉ ููุง "ูุทุฑููุง" ูุน ุงูุทูุจุงุช ุงูุฏูุฑูุฉ: ูู ููุงู ุฑุณุงุฆู ุฌุฏูุฏุฉ ุฃู ูุง.  ุจุงุณุชุฎุฏุงู ุงูุฑุฏ ุงูุชููุงุฆู ุนูู ุงูููุจ ุ ุณูููู ุงูุฃูุฑ ุนูู ูุฐุง ุงููุญู: ูุชุจ ุงููุณุชุฎุฏู ุฑุณุงูุฉ ุ ูุฃุฑุณููุง ุฎุงุฏู ุงููุฑุงุณูุฉ ุฅูู ุจุฑูุงูุฌ ุงูุฑูุจูุช ุงูุฎุงุต ุจู ุ ูุชููู ุงูุฑุณุงูุฉ ุ ูุนุงูุฌูุง ูุฃุฌุงุจ. <br><br><h3 style=";text-align:right;direction:rtl">  ููุงุฐุง ุฌุงูุบู </h3><br>  ูุฑุฑุช ุนูู ุฑูุจูุช ูู ุงูุซุนุจุงู ุ ูุฐูู ููุช ุจุชูุตูู ุฏุนู ุงูุซุนุจุงู ุนูู ุงูุงุณุชุถุงูุฉ.  ููู ูู ููู ูุฏู ุฎูุงุฑ ุฅุทุงุฑ - ุงูุงุณุชุถุงูุฉ ูุฏููุง Django ููุท.  ูููููู ุฃูู ูุนูู Instagram ู Pinterest ู Bitbucket ู Mozilla.  ุฑุจูุง ูุฐุง ูู ุงูุณุจุจ ูู ุฃู ุงูุงุณุชุถุงูุฉ ุชูุฏูู. <br><br><h3 style=";text-align:right;direction:rtl">  ููุงุฐุง ููููุชุงูุชู ุ ูููุณ ุจุฑููุฉ ุฃู ูุงูุจุฑุ </h3><br>  ููุงูุชูุงู ูู ุงูุจุณูุท ุฅูู ุงููุนูุฏ ุ ูุงู ูู ุงูููู ุจุงููุณุจุฉ ูู ุฃู ุฃุฌุฏ ุงูุทุฑููุฉ ุงูุฃุณูู ูุงูุฃูุซุฑ ุจุฏูููุฉ ูุฅุนุฏุงุฏ ุงูุฑุฏ ุงูุชููุงุฆู ุนูู ุงูููุจ.  ุชุจูู ุฃู ููููุชุงูุชู ูู ุงูุฃูุซุฑ ููููุง ุจุงููุณุจุฉ ูู ุจุณุจุจ ุงููุณุงุนุฏุฉ ุงููุงุถุญุฉ ูุณูููุฉ ุฑุจุท ุงูุฑุฏ ุนูู ุงูููุจ ูู ููุญุฉ ุชุญูู ุงููุฌุชูุน ูู ูุณู "ุงูุฅุฏุงุฑุฉ - ุงูุนูู ูุน ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช".  ุณูููู ูุตู ููููุฉ ุชูููู ูู ุดูุก ูุชูุตููู ุฃูุซุฑ.  ูู ุงููุณุชูุจู ุ ุฃุฑูุฏ ุฃู ุฃุฌุนู ุจุฑูุงูุฌ ุงูุฑูุจูุช ุงูุฎุงุต ุจู ูุชุงุญูุง ูู ูุงูุจุฑ.  ูููู ูุน Telegram ุ ูุฅู ุงูุทุฑูู ููุณ ูู ุงูุทุฑูู ุ ูุฃู ุงุณุชุถุงูุชู ูู ุฑูุณูุง ุ ู Telegram ูุญุธูุฑ ูู ุฑูุณูุง.  ูุชุฌูุจ ุงููุดุงูู ูุน Telegram ุ ููููู ุดุฑุงุก ุงูุงุณุชุถุงูุฉ ูู ุงูุฎุงุฑุฌ. <br><br><h3 style=";text-align:right;direction:rtl">  ููููุฉ ุชุซุจูุช webhook ูู VK botุ </h3><br>  <strong>ุงุณู ุงููุฌุงู https: //</strong> .  ุชุญุชุงุฌ ุฃููุงู ุฅูู ุชุณุฌูู ุงุณู ุงููุฌุงู ูููููุน ูุงูุญุตูู ุนูู ุดูุงุฏุฉ SSL ูู. <br><br>  ูู ุฃูู ุฃุฑุบุจ ูู ุงุณุชุฎุฏุงู ุงููุทุงู ุงูุฌุฐุฑ ูุจุฑูุงูุฌ ุงูุฏุฑุฏุดุฉ ุงูุขูู ุ ูุฐูู ุจุนุฏ ุชุณุฌูู ุงููุทุงู ุ ููุช ุจุฅูุดุงุก ูุทุงู ูุฑุนู ูุญุตูุช ุนูู ุดูุงุฏุฉ SSL ูู. <br><br>  ููุฏ ููุช ุจูู ูุฐู ุงูุชูุงุนุจุงุช ุนูู ูููุน ุงูุงุณุชุถุงูุฉ ูู ุญุณุงุจู ุงูุดุฎุตู. <br>  ููุชูุฌุฉ ูุฐูู ุ ุชูููุช ุนููุงู ุงููููุน mybot.mysite.ru ูุดูุงุฏุฉ SSL ูุฐูู. <br><br>  <strong>ูุญุตู ุนูู ููุชุงุญ VK (ุงูุฑูุฒ ุงููููุฒ) ููุจูุช.</strong>  ุฃููุงู ุฃูุดุฃุช ูุฌููุนุฉ ูุบููุฉ ุ ุซู ุงูุชููุช ุฅูู "ุฅุฏุงุฑุฉ" ุงููุฌููุนุฉ ุ ูู ูุณู "ุงูุนูู ูุน ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช".  ูู ุนูุงูุฉ ุงูุชุจููุจ "Access Keys" ูู ุฑูุฒ ูููุฒ ุ ููู ุนูุงูุฉ ุงูุชุจููุจ "ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช Callback API". <br><br><img src="https://habrastorage.org/webt/in/46/po/in46po1vy4iq3vcdnezwpp5okg8.png"><br><br>  <strong>ุชุซุจูุช ูุชูููู Django</strong> .  ุฑุจูุง ูุง ุชุญุชุงุฌ ุฅูู ุฌุงูุบู ูุชุดุบูู ูุต ุจุงูุซูู ุงูุฎุงุต ุจู ุ ูููู ูุง ุฃุนุฑู ููู ูุญุฏุซ ุฐูู. <br><br>  ุจุงุณุชุฎุฏุงู PuTTY ุ ุงุชุตูุช ุจุงูุฎุงุฏู ุนุจุฑ SSH ุ ูููุช ุจุชูููู ูุชูุดูุท ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ. <br><br>  SSH: <br><pre style=";text-align:right;direction:rtl"><code class="bash hljs">virtualenv-2.7 virtualenv/myEnv . virtualenv/myEnv/bin/activate</code> </pre> <br>  ูููู ุงูุฃูุฑ ูู ุงูุณุทุฑ ุงูุฃูู ุจุฅูุดุงุก ุจูุฆุฉ ุงูุชุฑุงุถูุฉ ุ ููููู ุงูุฃูุฑ ูู ุงูุณุทุฑ ุงูุซุงูู ุจุชูุดูุทูุง (ูุงุญุธ ุงููุณุงูุฉ ุจุนุฏ ุงูููุทุฉ).  ุงูุฅุตุฏุงุฑ 2.7 ุชูููู ุงูุงุณุชุถุงูุฉ ููุฏ ุชุฎุชูู ูู ุญุงูุชู.  ูุฐูู ุ ุงูุฑุฃ ูุณุงุนุฏุฉ ุงูุงุณุชุถุงูุฉ. <br><br>  ุงูุชุงูู ุชุซุจูุช Django <br>  SSH: <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">pip install <span class="hljs-string"><span class="hljs-string">'django&lt;2'</span></span></code> </pre><br>  ููุฏ ููุช ุจุชุซุจูุช ุฅุตุฏุงุฑ Django ูู ููุนุฏ ูุง ูุชุฌุงูุฒ ุงูุซุงูู ุ ูุฃู python 2.7 ูุณุชุฎุฏู ูู ุงูุงุณุชุถุงูุฉ ุ ููุนูู ููุท ุฅุตุฏุงุฑ Django ุฃูู ูู 2 ูุนู. <br><br>  ูููุช ุจุชุซุจูุช ูุญุฏุฉ python ููุนูู ูุน VKontakte API <br>  SSH: <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">pip install vk</code> </pre><br><br>  FTP: <br>  ุฅูุดุงุก ูุฌูุฏ ููุดุงุฑูุน django ูู ุงูุฏููู ุงูุฌุฐุฑ ุนูู ุงูุงุณุชุถุงูุฉ.  ุฏุนุง ููุง ุฌุงูุบู. <br><br>  SSH: <br>  ุฅูุดุงุก ูุดุฑูุน ุฌุฏูุฏ. <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> django/ django-admin.py startproject mybot</code> </pre><br>  ูุชูุฌุฉ ูุฐูู ุ ุณูุชู ุฅูุดุงุก ูุฌูุฏ ุจุงุณู ุงููุดุฑูุน (ูู ุญุงูุชูุง ูู "mybot") ูู ุงููุฌูุฏ / django.  ุณูุญุชูู ุนูู ูููุงุช ุงููุดุฑูุน ุงูุฃูููุฉ ุงูุชู ุชู ุฅูุดุงุคูุง ุชููุงุฆููุง: <br>  / ุฌุงูุบู <br>  / mybot - ูุฌูุฏ ุงููุดุฑูุน <br>  / mybot - ูุญุฏุฉ ููุทูุฉ ูุน ุฅุนุฏุงุฏุงุช ูุดุฑูุนูุง <br>  __init__.py <br>  Settings.py <br>  urls.py <br>  wsgi.py <br>  ุฅุฏุงุฑุฉ <br><br>  ูุดุฑูุน ูู Django ูู ูุฌููุนุฉ ูู ุงูุชุทุจููุงุช.  ุชุทุจูู ูู Django ูู ุจุฑูุงูุฌ ูููู ุจุชูููุฐ ุงูุฅุฌุฑุงุกุงุช ุงูุชู ูุถุนูุง ุงููุทูุฑ. <br><br>  SSH: <br>  ุฅูุดุงุก ุชุทุจูู. <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> mybot python manage.py startapp vk_bot</code> </pre><br>  ุฐูุจุช ุฅูู <i>ูุฌูุฏ / django / mybot</i> ูููุช ุจุฅูุดุงุก ุชุทุจูู ุฌุฏูุฏ ูุณูู "vk_bot". <br>  ุชู ุฅูุดุงุก ูุฌูุฏ ุจุงุณู ุงูุชุทุจูู ูู ูุฌูุฏ ุงููุดุฑูุน ูุญุชูู ุนูู ูููุงุช ุงูุชุทุจูู ุงูุชู ุชู ุฅูุดุงุคูุง ุชููุงุฆููุง: <br><br>  / ุฌุงูุบู <br>  / mybot - ูุฌูุฏ ุงููุดุฑูุน <br>  / mybot - ูุญุฏุฉ ููุทูุฉ ูุน ุฅุนุฏุงุฏุงุช ูุดุฑูุนูุง <br>  __init__.py <br>  Settings.py <br>  urls.py <br>  wsgi.py <br>  ุฅุฏุงุฑุฉ <br>  / vk_bot - ูุฌูุฏ ุงูุชุทุจูู <br>  __init__.py <br>  admin.py <br>  apps.py <br>  models.py <br>  test.py <br>  views.py <br><br>  FTP: <br>  ููุช ุจุชูุฒูู ุฌููุน ูููุงุช ุงููุดุฑูุน ุนูู ุฌูุงุฒ ุงูููุจููุชุฑ ุงููุญููู ุงูุฎุงุต ุจู ููุนูู ูุน ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ. <br>  ููุนูู ูุน ูููุงุช ุงููุดุฑูุน ูุงูุจุฑูุฌุฉ ุ ุงุณุชุฎุฏูุช ุชุทุจูู Atom. <br><br>  ุงูุฐุฑุฉ: <br>  ุนุฏู ุฅุนุฏุงุฏุงุช ุงููุดุฑูุน ูู ุงูููู <i>/django/mybot/mybot/settings.py</i> <br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">... </span></span>DEBUG = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> ... ALLOWED_HOSTS = [ <span class="hljs-string"><span class="hljs-string">u'mybot.mysite.ru'</span></span>, ] ...</code> </pre><br>  ุงูุฐุฑุฉ: <br>  ุชู ุชุนุฏูู ุฅุนุฏุงุฏุงุช ุชูุฌูู <i>ุนูุงููู</i> URL ูู ุงูููู <i>/django/mybot/mybot/urls.py</i> <br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">... </span></span>urlpatterns = [ url(<span class="hljs-string"><span class="hljs-string">r'^vk_bot/'</span></span>, include(<span class="hljs-string"><span class="hljs-string">'vk_bot.urls'</span></span>)), ] ...</code> </pre><br>  FTP: <br>  ุฅูุดุงุก ููู <i>/django/mybot/vk_bot/urls.py</i> ุจุงููุญุชูู <i>ุงูุชุงูู</i> : <br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.conf.urls <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> url <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> views app_name = <span class="hljs-string"><span class="hljs-string">'vk_bot'</span></span> urlpatterns = [ url(<span class="hljs-string"><span class="hljs-string">r'^$'</span></span>, views.index, name=<span class="hljs-string"><span class="hljs-string">'index'</span></span>), ]</code> </pre><br>  ุงูุฐุฑุฉ: <br>  ุชู ุชุนุฏูู ุงูููู <i>/django/mybot/vk_bot/views.py</i> - ุชูุช ุฅุถุงูุฉ ูุธููุฉ ุชุณูู ุงูููุฑุณ ุฅูููุง ูุณูุชู ุชูููุฐูุง ุนูุฏ ุทูุจ ุงูุนููุงู ูู ุงููุชุตูุญ <br><pre style=";text-align:right;direction:rtl">  https://mybot.mysite.ru/vk_bot/ </pre><br><br>  views.py <br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- coding: utf-8 -*- from __future__ import unicode_literals from django.views.decorators.csrf import csrf_exempt from django.shortcuts import render from django.http import HttpResponse from bot_config import * # import token, confirmation_token and over constants from bot_config.py import json, vk # vk is library from VK """ Using VK Callback API version 5.5 For more ditalies visit https://vk.com/dev/callback_api """ """ From Django documentation (https://docs.djangoproject.com/en/1.11/ref/request-response/) When a page is requested, Django automatically creates an HttpRequest object that contains metadata about the request. Then Django loads the appropriate view, passing the HttpRequest as the first argument to the view function. This argiment is &lt;request&gt; in def index(request): Decorator &lt;@csrf_exempt&gt; marks a view as being exempt from the protection ensured by the Django middleware. For cross site request protection will be used secret key from VK """ @csrf_exempt #exempt index() function from built-in Django protection def index(request): #url: https://mybot.mysite.ru/vk_bot/ if (request.method == "POST"): data = json.loads(request.body)# take POST request from auto-generated variable &lt;request.body&gt; in json format if (data['secret'] == secret_key):# if json request contain secret key and it's equal my secret key if (data['type'] == 'confirmation'):# if VK server request confirmation """ For confirmation my server (webhook) it must return confirmation token, whitch issuing in administration web-panel your public group in vk.com. Using &lt;content_type="text/plain"&gt; in HttpResponse function allows you response only plain text, without any format symbols. Parametr &lt;status=200&gt; response to VK server as VK want. """ # confirmation_token from bot_config.py return HttpResponse(confirmation_token, content_type="text/plain", status=200) if (data['type'] == 'message_new'):# if VK server send a message session = vk.Session() api = vk.API(session, v=5.5) user_id = data['object']['user_id'] # token from bot_config.py api.messages.send(access_token = token, user_id = str(user_id), message = "Hello, I'm bot!") return HttpResponse('ok', content_type="text/plain", status=200) else: return HttpResponse('see you :)')</span></span></code> </pre><br>  ูู <i>view.py</i> script ุ ูู ูุธููุฉ <i>ุงูููุฑุณ (ุงูุทูุจ)</i> ุ ุงุถุทุฑุฑุช ุฅูู ุชุนุทูู ุงูุญูุงูุฉ ุงููุถููุฉ ูู Django CSRF ุ ูุฃู  ููุช ุฃุชููู ุงูุฎุทุฃ "403 ููููุน".  CSRF - ุงูุญูุงูุฉ ูู ุงูุชุฒููุฑ ูู ุทูุจ ุงูููุงูุน - ุงูุญูุงูุฉ ูู ุชุฒููุฑ ุงูุทูุจุงุช ุนุจุฑ ุงูููุงูุน.  ููู ูุนูู CSRF ููููู ุฃู ุชูุฑุฃ ูู ูุฐู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููุงูุฉ</a> . <br>  ูุชุนุทูู ุงูุญูุงูุฉ ุ ุงุณุชุฎุฏูุช <i>csrf_exempt</i> decorator.  ูููู ูู ุฃุฌู ุชูููุฑ ูุฐู ุงูุญูุงูุฉ ุนูู ุงูุฑุบู ูู ูู ุดูุก ุ ูููู ุจุทุฑููุฉ ุฃุจุณุท ุ ุงุณุชุฎุฏูุช ููุชุงุญูุง ุณุฑููุง ูุณุฌููุง ูู ูุณู ุฅุฏุงุฑุฉ ุงููุฌููุนุฉ ุนูู ูููุน VKontakte ุนูู ุงูููุจ. <br><br>  ูุฐุง ุงูุฌุฒุก ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูุณุคูู ุนู ูุนุงูุฌุฉ ุงูุทูุจุงุช ูู ุงูุฎุงุฏู ุงูุชู ุณูุฑุณููุง ูู ุฃุฌู ุฑุจุท ุงูุฑุฏ ุนูู ุงูููุจ ุงูุฎุงุต ุจูุง ููุนุงูุฌุฉ ุงูุฃุญุฏุงุซ.  ุฏุนูุง ูููู ููุท "ุชุฃููุฏ" ูู webhook ูุฏููุง. <br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data[<span class="hljs-string"><span class="hljs-string">'type'</span></span>] == <span class="hljs-string"><span class="hljs-string">'confirmation'</span></span>):<span class="hljs-comment"><span class="hljs-comment"># if VK server request confirmation """ For confirmation my server (webhook) it must return confirmation token, whitch issuing in administration web-panel your public group in vk.com. Using &lt;content_type="text/plain"&gt; in HttpResponse function allows you response only plain text, without any format symbols. Parametr &lt;status=200&gt; response to VK server as VK want. """ # confirmation_token from bot_config.py return HttpResponse(confirmation_token, content_type="text/plain", status=200)</span></span></code> </pre><br>  ูุฑุฌู ููุงุญุธุฉ ุฃููู ุงุญุชูุธ ุจุฌููุน ุฅุนุฏุงุฏุงุช ุงูุชููุฆุฉ ูู ููู ุชููุฆุฉ ุจูุช ูููุตู <i>bot_config.py</i> ูุจุงูุชุงูู ูู ุจุชูุตููู ูู ุจุฏุงูุฉ ุงูุจุฑูุงูุฌ ุงููุตู: <br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> bot_config <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-comment"><span class="hljs-comment"># import token, confirmation_token and over constants from bot_config.py</span></span></code> </pre><br>  bot_config.py <br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- coding: utf-8 -*- """ Configuration file for VK bot """ # token issued on the VK group web-administration page token = '...' # confirmation token issued on the VK group web-administration page in "Callback API" section confirmation_token = '...' # secret key for cross site request forgery protection. It will be in each VK server request secret_key = '...'</span></span></code> </pre><br>  ููู ูุฐุง ุงูุฌุฒุก ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุ ูุนุงูุฌ ุฑุณุงุฆู ุงููุณุชุฎุฏู: <br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data[<span class="hljs-string"><span class="hljs-string">'type'</span></span>] == <span class="hljs-string"><span class="hljs-string">'message_new'</span></span>):<span class="hljs-comment"><span class="hljs-comment"># if VK server send a message session = vk.Session() api = vk.API(session, v=5.5) user_id = data['object']['user_id'] # token from bot_config.py api.messages.send(access_token = token, user_id = str(user_id), message = "Hello, I'm bot!") return HttpResponse('ok', content_type="text/plain", status=200)</span></span></code> </pre><br>  ุฅุฐุง ูุงู ููุงู ุดูุก ุจุฏุง ุบูุฑ ููููู ุ ููููู ุฃูุถูุง ูุฑุงุกุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููุงูุฉ ุญูู ุฅุนุฏุงุฏ Django ุงูุฃูู</a> . <br><br>  <strong>ุณุญุฑ ุฎุงุฏู ุงูููุจ</strong> .  ูุชููุฆุฉ ูุนุงูุฌุฉ ุงูุทูุจุงุช ุฅูู ุฎุงุฏู ุงูููุจ ุ ุฐูุจุช ุฅูู ุงูุฎุงุฏู ูู ุงููุฌูุฏ ุงูุฐู ูุญุชูู ุนูู ูุทุงูุงุช ูู ุฎูุงู ุนููู FTP FileZilla ูููุช ุจุฅูุดุงุก ุงููุฌูุฏ " <i>mybot.mysite.ru</i> " ููุงู ุ ููุถุน ุซูุงุซุฉ ูููุงุช ููู ุ ุชู ุฃุฎุฐ ูุญุชููุงุชูุง ูู ุงููุณุงุนุฏุฉ ุนูู ุงูุงุณุชุถุงูุฉ: <br><br>  .htaccess <br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">AddHandler wsgi-script .wsgi RewriteEngine on RewriteCond %{REQUEST_FILENAME} !-f RewriteRule ^(.*)$ /django.wsgi/$<span class="hljs-number"><span class="hljs-number">1</span></span> [QSA,PT,L] RewriteCond %{HTTP:X-Forwarded-Protocol} !=https RewriteRule .* https://%{SERVER_NAME}%{REQUEST_URI} [R=<span class="hljs-number"><span class="hljs-number">301</span></span>,L]</code> </pre><br>  django.wsgi <br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os, sys virtual_env = os.path.expanduser(<span class="hljs-string"><span class="hljs-string">'~/virtualenv/myEnv'</span></span>) activate_this = os.path.join(virtual_env, <span class="hljs-string"><span class="hljs-string">'bin/activate_this.py'</span></span>) execfile(activate_this, dict(__file__=activate_this)) sys.path.insert(<span class="hljs-number"><span class="hljs-number">0</span></span>, os.path.join(os.path.expanduser(<span class="hljs-string"><span class="hljs-string">'~'</span></span>), <span class="hljs-string"><span class="hljs-string">'django/mybot'</span></span>)) os.environ[<span class="hljs-string"><span class="hljs-string">'DJANGO_SETTINGS_MODULE'</span></span>] = <span class="hljs-string"><span class="hljs-string">'mybot.settings'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.core.wsgi <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> get_wsgi_application application = get_wsgi_application()</code> </pre><br>  ููุง "myEnv" ูู ุงุณู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ ุงูุชู ููุช ุจุฅูุดุงุฆูุง ุ "django" ูู ุงููุฌูุฏ ุงูููุฌูุฏ ูู ุงููุณู ุงูุฌุฐุฑ ูู ูุธุงู ุงููููุงุช ุนูู ุงูุงุณุชุถุงูุฉ ุ "mybot" ูู ุงุณู ุงููุดุฑูุน ุงูุฐู ุฃูุดุฃูุงู ุจุงุณุชุฎุฏุงู Django. <br><br>  index.html <br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">  </code> </pre><br>  <strong>"ุฑุจุท" ุฑุจุท ุงูููุจ ุงูุฎุงุต ุจูุง ููุนุงูุฌุฉ ุงูุฑุณุงุฆู ูู ูุฌููุนุฉ VKontakte ุงูุชู ุชู ุฅูุดุงุคูุง.</strong> <br>  ููููุงู ุจุฐูู ุ ุณูุนูุฏ ุฅูู ูุณู ุฅุฏุงุฑุฉ ูุฌููุนุชูุง ุนูู ูููุน VKontakte ุนูู ุงูููุจ (ุงูุธุฑ ุงูุตูุฑุฉ ุฃุนูุงู).  ุณูููู ุจุฅุฏุฎุงู ุนููุงู webhook ูู ุญูู "ุงูุนููุงู" <pre style=";text-align:right;direction:rtl">  https://mybot.mysite.ru/vk_bot/ </pre>  ูุงููุฑ ุนูู ุฒุฑ "ุชุฃููุฏ".  ุฅุฐุง ูุงูุช ูุธููุฉ <i>ุงูููุฑุณ (ุทูุจ)</i> ุ ุงูููุชูุจุฉ ูู ููู <i>/django/mybot/vk_bot/views.py ุ</i> ุชุนูู ุจุดูู ุตุญูุญ ุ ุฃู ุฃููุง ูุง ุชุญุชูู ุนูู ุฃุฎุทุงุก ูุทุจุนูุฉ ูุฃุฎุทุงุก ุ ุณุชุธูุฑ ุนูุงูุฉ ุงุฎุชูุงุฑ ุฎุถุฑุงุก ุชุฑูุฒ ุฅูู ุฃู ูู ุดูุก ุนูู ูุง ูุฑุงู. <br><br>  ูู ุฃุฌู ุฃู ูุชููู webhook ูุฏููุง ุฑุณุงุฆู ูู ุฎุงุฏู VKontakte ุญูู ุฑุณุงุฆู ุงููุณุชุฎุฏู ุงูุฌุฏูุฏุฉ ุ ูู ูุณู ุฅุฏุงุฑุฉ ูุฌููุนุชูุง ุนูู ูููุน VKontakte ุนูู ุงูููุจ ุ ูู ุนูุงูุฉ ุงูุชุจููุจ "ุฃููุงุน ุงูุฃุญุฏุงุซ" ุ ุญุฏุฏ ูุฑุจุน "ุงูุฑุณุงุฆู ุงููุงุฑุฏุฉ". <br><br>  ูุชูุฌุฉ ูุฐูู ุ ุณูุชููู ุจุฑูุงูุฌูุง ุงููุตู ูุฐู ุงูุฑุณุงุฆู ุจุชูุณูู <i>json</i> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">{<span class="hljs-string"><span class="hljs-string">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"message_new"</span></span>,<span class="hljs-string"><span class="hljs-string">"object"</span></span>:{<span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">891</span></span>,<span class="hljs-string"><span class="hljs-string">"date"</span></span>:<span class="hljs-number"><span class="hljs-number">1541599508</span></span>,<span class="hljs-string"><span class="hljs-string">"out"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"user_id"</span></span>:<span class="hljs-number"><span class="hljs-number">1.</span></span>.<span class="hljs-number"><span class="hljs-number">.1</span></span>,<span class="hljs-string"><span class="hljs-string">"read_state"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"title"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-string"><span class="hljs-string">"body"</span></span>:<span class="hljs-string"><span class="hljs-string">"  "</span></span>},<span class="hljs-string"><span class="hljs-string">"group_id"</span></span>:<span class="hljs-number"><span class="hljs-number">1.</span></span>.<span class="hljs-number"><span class="hljs-number">.4</span></span>,<span class="hljs-string"><span class="hljs-string">"secret"</span></span>:<span class="hljs-string"><span class="hljs-string">"uxSBw"</span></span>}</code> </pre><br>  ูุฑุฌู ููุงุญุธุฉ ุฃู ููุงู ุญูู "ุณุฑู" ูู ุฑุณุงูุฉ <i>json</i> .  ูุฐุง ูู ููุณ ุงูููุชุงุญ ุงูุณุฑู ุงูุฐู ููุช ุจุชุณุฌููู ูู ูุณู ุฅุฏุงุฑุฉ ุงููุฌููุนุฉ ุนูู ูููุน VKontakte ุนูู ุงูููุจ ุ ุจุฏูุงู ูู ุงูุญูุงูุฉ ุงููุถููุฉ ูู Django CSRF ุ ูุงูุชู ุงุถุทุฑุฑุช ุฅูู ุชุนุทูููุง. <br><br><h3 style=";text-align:right;direction:rtl">  ููููุฉ ุฌุนู ุงูุฑูุจูุช ุฃูุซุฑ ุฐูุงุก ูุฃูุถูุ </h3><br>  ููููู ุฅูุดุงุก ูุงุนุฏุฉ ุจูุงูุงุช ุชุญุชูู ุนูู ุฅุฌุงุจุงุช ูููุณุชุฎุฏู ูุชุนููู ุงูุฑูุจูุช ูุงุฎุชูุงุฑ ุงูุฅุฌุงุจุฉ ุงูุฃูุฑุจ ููุนูู ุณุคุงู ุงููุณุชุฎุฏู.  ุณุฃุชุญุฏุซ ุนู ูุฐุง ูู ููุงู ูููุตู. <br>  ูู ุงููููู ูุงูุถุฑูุฑู ุจุฑูุฌุฉ ุณููุงุฑูููุงุช ุชูุงุนู ุงููุณุชุฎุฏู ุ ุฅุฐุง ุฌุงุฒ ุงูุชุนุจูุฑ ุ ููุญูุงุธ ุนูู ุงููุญุงุฏุซุฉ. <br><br>  ุญุธุง ุณุนูุฏุง ูู ุนููู ุงูุฅุจุฏุงุนู! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar429628/">https://habr.com/ru/post/ar429628/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar429618/index.html">ูุนุจุฉ ุฅููุชุฑูููุฉ XO</a></li>
<li><a href="../ar429620/index.html">ููู ุฃูุดุฃุช ุฎุฑุงุฆุท ูููุงุฑุงุช ููุนุจุฉ</a></li>
<li><a href="../ar429622/index.html">ุงุณุชุจุฏูุช ุงูุฑูุจูุชุงุช ุฃูุงุฒูู ุจู 20000 ุนุงูู</a></li>
<li><a href="../ar429624/index.html">ููู ุณุชุณุชุฎุฏู ููุงูุฉ ูุงุณุง ุงูุฑูุจูุชุงุช ูุฅูุชุงุฌ ูููุฏ ุงูุตูุงุฑูุฎ ูู ุชุฑุจุฉ ุงููุฑูุฎ</a></li>
<li><a href="../ar429626/index.html">ููุฏ ุฃุธูุฑุช ุงูููุฑูุนุงุช ุงูุฌูููููุฉ ุฃูู ูู ูููู ููุงู ุญูุถ ูููู ูุฌููู ุจุนุฏ ุงูุขู</a></li>
<li><a href="../ar429630/index.html">"ูุญูุด ูู ุงูุฃูุนุงุจ ุฃู ุชุฌุนู ุงูุฎูู ูุชููุนูุง"</a></li>
<li><a href="../ar429632/index.html">ุฃุณุจุงุจ ุงูุฑูุถ ูููุถูููู ุนูุฏ ุงูุฅุถุงูุฉ ุฅูู ุงูุฏูุงุฆู</a></li>
<li><a href="../ar429634/index.html">ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ูุนูู ุจูุง ุงูุจุญุซ ุนู ุงููุฑูุถ ูู ููุงูุญุฉ ุงูุงูุชุญุงู</a></li>
<li><a href="../ar429636/index.html">ูู ุจุชุซุจูุช 3CX PBX ูู Amazon Lightsail Cloud</a></li>
<li><a href="../ar429638/index.html">ุงูุฏุฑุฏุดุฉ ุ ุงุณุชุฎุฑุงุฌ: ููุฏุณุฉ ุฑูุจูุชุงุช ูุนูุฏุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>