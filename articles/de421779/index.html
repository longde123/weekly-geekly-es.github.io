<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑🏿‍🤝‍🧑🏿 👨🏽‍💼 🤦🏻 OceanLotus: neue Hintertür, alte Pläne 🎅🏻 🔉 🕥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die OceanLotus-Gruppe (auch bekannt als APT32 und APT-C-00) ist bekannt für ihre Angriffe in Ostasien. Im vergangenen Jahr wurde eine Reihe von Studie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>OceanLotus: neue Hintertür, alte Pläne</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/421779/">  Die OceanLotus-Gruppe (auch bekannt als APT32 und APT-C-00) ist bekannt für ihre Angriffe in Ostasien.  Im vergangenen Jahr wurde eine Reihe von Studien zur Arbeit der Gruppe veröffentlicht, darunter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CyberReason-</a> Dokumente, eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">FireEye-</a> Überprüfung und eine Beschreibung des Wasserlochangriffs von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Volexity</a> .  Wie wir sehen können, aktualisiert die Gruppe Backdoors, Infrastruktur und Infektionsvektoren. <br><br>  OceanLotus richtet sich weiterhin an Unternehmen und Regierungsbehörden in Ostasien.  Laut ESET-Telemetrie liegen die vorrangigen Ziele von OceanLotus in Vietnam, Laos, Kambodscha und auf den Philippinen. <br><br>  Vor einigen Monaten haben wir eine ihrer neuesten Hintertüren entdeckt und analysiert.  Es werden verschiedene Tools implementiert, die die Analyse erschweren und eine Erkennung vermeiden. Wir werden sie in einem Beitrag diskutieren. <br><br><img src="https://habrastorage.org/webt/4f/mf/dz/4fmfdzgqiqskqku5rz7eeprycti.jpeg"><br><br><a name="habracut"></a><h2>  Verteilung </h2><br>  Angreifer verwenden verschiedene Methoden, um das Opfer davon zu überzeugen, eine böswillige Pipette zu starten. <br><br><h3>  Doppelte Erweiterungen und gefälschte Anwendungssymbole (Word, PDF usw.) </h3><br>  Dropper verbreiten sich wahrscheinlich über E-Mail-Anhänge.  Wir haben die folgenden Dateinamen beobachtet: <br>  - <code>Mi17 Technical issues - Phonesack Grp.exe</code> (Mi-17 - Russisches Hubschraubermodell) <br>  - <code>Chi tiet don khieu nai gui saigontel.exe</code> (übersetzt aus dem Vietnamesischen - „Einzelheiten der an Saigontel gesendeten Forderung“, Saigontel - vietnamesisches Telekommunikationsunternehmen) <br>  - <code>Updated AF MOD contract - Jan 2018.exe</code> <br>  - <code>remove_pw_Reschedule of CISD Regular Meeting.exe</code> <br>  - <code>Sorchornor_with_PM_-_Sep_2017.exe</code> <br>  - <code>20170905-Evaluation Table.xls.exe</code> <br>  - <code>CV_LeHoangThing.doc.exe</code> (gefälschte Lebensläufe wurden auch in Kanada gefunden) <br><br>  Alle diese Dateien haben etwas gemeinsam - das Starten eines passwortgeschützten Köderdokuments.  Es ist unklar, ob das Passwort irgendwo in den Daten des übermittelten Briefes enthalten ist oder ob das Dokument nicht geöffnet werden soll. <br><br><h3>  Gefälschte Installer </h3><br>  In Wasserlochkampagnen wurden mehrere gefälschte Installateure entdeckt, die sich als Installateure oder Software-Updates ausgeben.  Ein Beispiel ist das von 360 Labs on <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Freebuf</a> (auf Chinesisch) beschriebene neu verpackte Firefox-Installationsprogramm. <br><br>  Ein weiteres Beispiel, das wir gesehen haben, hieß <code>RobototFontUpdate.exe</code> .  Es hat sich wahrscheinlich über kompromittierte Websites verbreitet, aber wir haben keine ausreichenden Beweise dafür. <br><br>  Alle beschriebenen Dateien, unabhängig davon, ob sie per E-Mail verteilt oder beim Besuch einer gefährdeten Site heruntergeladen wurden, lieferten dieselbe Backdoor-Komponente.  In einem Beitrag werden wir ein Beispiel von <code>RobototFontUpdate.exe</code> analysieren und zeigen, wie es gelingt, eine böswillige Nutzlast auf dem System auszuführen. <br><br><h2>  Technische Analyse </h2><br>  Der Installations- und Ausführungsprozess hängt von der mehrschichtigen Verschleierung ab, nämlich der Komponentenverschlüsselung, der Rekonstruktion von PE-Dateien, dem Laden von Shellcode und dem Laden von Seiten.  Letzteres wurde in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorherigen Korplug-Studie von</a> ESET beschrieben. <br><br><h3>  Fortschrittskontrolle </h3><br>  Der Angriff besteht aus zwei Teilen: einer Pipette und einer Trägerrakete.  Jeder Schritt jedes Teils des Prozesses wird im entsprechenden Abschnitt ausführlich erläutert.  Die beiden folgenden Diagramme geben einen kurzen Überblick über den Gesamtfortschritt der Malware. <br><br><img src="https://habrastorage.org/webt/yn/wa/jd/ynwajd8empdclmahz0mzaarmpxk.png"><br>  <i>Abbildung 1. Der Fortschritt der Pipette</i> <br><br><img src="https://habrastorage.org/webt/gv/ba/jb/gvbajbzaqzd6tmrjpj95nkov-j8.png"><br>  <i>Abbildung 2. Fortschritt der Hintertür</i> <br><br>  Fast alle diese Komponenten sind verschleiert.  Die Verschleierung basiert auf komplementären bedingten Paarübergangsbefehlen.  Für jede der Formen: JZ / JNZ, JP / JNP, JO / JNO usw. führt jedes Paar einen Übergang zum gleichen Ziel durch.  Die Sequenz ist mit Junk-Code durchsetzt, der den Stapelzeiger verwendet, aber den Wert des bedingten Flags nicht ändert.  Es stellt sich heraus, dass der Übergang innerhalb desselben Zweigs erfolgt.  Dies führt zu Problemen während des Dekompilierungsprozesses aufgrund der Verwendung positiver Stapelzeigerwerte. <br><br><img src="https://habrastorage.org/webt/lh/y6/an/lhy6anvm_1feplhj7depx1udiiu.png"><br>  <i>Abbildung 3. Komplementärer bedingter Übergang</i> <br><br>  Darüber hinaus fügen einige Grundelemente des Programms dem Stapel eine Adresse hinzu, wonach sie in JMP / CALL enden, während andere Grundelemente zwei Adressen hinzufügen und mit dem Befehl RET enden.  Die zweite Elementaddition ist die aufgerufene Funktion, und die erste ist die Adresse des nächsten Basisprogrammelements, in dem der Übergang erfolgen soll.  Somit werden die Grundelemente des Programms ohne übergeordnete Objekte erstellt. <br><br><img src="https://habrastorage.org/webt/jc/5j/dw/jc5jdw3rbtwezkp4ylemfursggw.png"><br>  <i>Abbildung 4. PUSH / JMP-Technik</i> <br><br>  Als Ergebnis einer Kombination von zwei Verschleierungstechniken werden "schöne" Graphen erhalten: <br><br><img src="https://habrastorage.org/webt/3l/pe/3x/3lpe3x_ccjdkh9rm0rpxyykztf0.png"><br>  <i>Abbildung 5. Verschleierung einer Laufsequenz</i> <br><br>  Junk-Code zu bemerken ist ziemlich einfach.  Es kann bei der Analyse von Proben ignoriert werden, wenn Sie das Anwendungsschema kennen. <br><br><h2>  Tropfer </h2><br><h3>  Schritt 1. Köderdokument </h3><br>  In den letzten Monaten hat OceanLotus mehrere Köder verwendet.  Eine davon ist eine gefälschte Software zum Aktualisieren der <code>Roboto Slab regular</code> TrueType-Schriftart von <code>Roboto Slab regular</code> .  Die Auswahl einer Schriftart erscheint etwas seltsam, da sie nicht viele ostasiatische Sprachen unterstützt. <br><br><img src="https://habrastorage.org/webt/2p/p8/sm/2pp8sm8gjt15kzqakmyooah1pk8.jpeg"><br>  <i>Abbildung 6. RobototFontUpdate-Symbol für die Aktualisierung von Schriftarten</i> <br><br>  Bei der Ausführung entschlüsselt die Binärdatei ihre Ressourcen (XOR, 128 Byte, fest codierter Schlüssel) und stellt die entschlüsselten Daten (LZMA) wieder her.  Legitime RobotoSlab-Regular.ttf-Datei <br><br>  (SHA1: <code>912895e6bb9e05af3a1e58a1da417e992a71a324</code> ) wird in den Ordner <code>%temp%</code> und mit der <code>ShellExecute</code> API- <code>ShellExecute</code> Funktion gestartet. <br><br>  Der aus den Ressourcen entschlüsselte Shell-Code wird ausgeführt.  Nach der Ausführung implementiert eine gefälschte Schriftartaktualisierung eine andere Anwendung, deren einziger Zweck darin besteht, die Pipette zu entfernen.  Diese Löschanwendung wird als <code>%temp%\[0-9].tmp.exe</code> . <br><br><h3>  Stufe 2. Shell-Code </h3><br>  In jeder Phase wird derselbe Shellcode verwendet. <br><br>  Der Shellcode ist ein benutzerdefinierter PE-Loader.  Es stellt die ausführbare Datei im Speicher wieder her - entschlüsselt alle Abschnitte und berechnet die erforderlichen Bewegungen und anderen Einrückungen.  Der <code>RtlMoveMemory</code> verwendet die drei Funktionen der Windows-API: <code>VirtualAlloc</code> , <code>RtlMoveMemory</code> und <code>RtlZeroMemory</code> . <br><br>  Die Funktion <code>RtlZeroMemory</code> verwendet, <code>RtlZeroMemory</code> Felder im PE-Header zu <code>RtlZeroMemory</code> .  Das Verlassen auf einen automatischen Speicherauszug schlägt fehl, da die MZ / PE-Header beschädigt sind. <br>  Der Shell-Code ruft die entschlüsselte PE-Anmeldefunktion und dann die <code>DLLEntry</code> Exportfunktion auf. <br><br><h3>  Stufe 3. Die echte Pipette </h3><br> <code>{103004A5-829C-418E-ACE9-A7615D30E125}.dll</code> <br>  Diese ausführbare Datei entschlüsselt Ressourcen mithilfe des AES-Algorithmus im CBC-Modus über die Windows-API.  Der fest codierte Schlüssel ist 256 Bit groß.  Nach der Entschlüsselung werden die komprimierten Daten dekomprimiert (LZMA-Algorithmus). <br><br>  Wenn der Prozess mit Administratorrechten gestartet wird, bietet Malware Persistenz, indem ein Dienst erstellt wird.  Andernfalls wird der klassische Registrierungsschlüssel "Ausführen" verwendet ( <code>HKCU\SOFTWARE\Microsoft\ Windows\CurrentVersion\Run;DeviceAssociationService;rastlsc.exe</code> ). <br><br>  Wenn der Dropper-Code mit Administratorrechten ausgeführt wird, versucht er, die unten aufgeführten Dateien in den Ordner <code>C:\Program Files\Symantec\Symantec Endpoint Protection\12.1.671.4971.104a\DeviceAssociationService\</code> . Wenn nicht, werden sie in den Ordner <code>%APPDATA%\Symantec\Symantec Endpoint Protection\12.1.671.4971.104a\DeviceAssociationService\</code> : <br><br>  - <code>rastlsc.exe</code> (SHA1: <code>2616da1697f7c764ee7fb558887a6a3279861fac</code> , Kopie der legitimen Anwendung Symantec Network Access Control, <code>dot1xtra.exe</code> ) <br>  - <code>SyLog.bin</code> (SHA1: <code>5689448b4b6260ec9c35f129df8b8f2622c66a45</code> , verschlüsselte Hintertür) <br>  - <code>rastls.dll</code> (SHA1: <code>82e579bd49d69845133c9aa8585f8bd26736437b</code> , eine bösartige DLL, die <code>rastlsc.exe</code> ) <br><br>  Der Pfad variiert von Sample zu Sample, aber das Layout ist ähnlich.  Abhängig von den Rechten speichert die Malware Dateien in <code>%ProgramFiles%</code> oder <code>%appdata%</code> .  Wir haben auch beobachtet: <br><br>  - <code>\Symantec\CNG Key Isolation\</code> <br>  - <code>\Symantec\Connected User Experiences and Telemetry\</code> <br>  - <code>\Symantec\DevQuery Background Discovery Broker Tasks\</code> <br><br>  Diese Pfade werden von verschiedenen Symantec-Produkten verwendet. <br><br>  Nach Erreichen der Persistenz und Implementierung der ausführbaren Datei eine legitime Datei, <br>  <code>rastlsc.exe</code> wird mit <code>CreateProcessW</code> . <br><br>  Wir haben auch eine Version ( <code>{BB7BDEC9-B59D-492E-A4AF-4C7B1C9E646B}.dll</code> ) beobachtet, die <code>rastlsc.exe</code> mit dem Parameter <code>krv</code> ausführt.  Wir werden weiter unten ausführlicher darauf eingehen. <br><br><h2>  Backdoor-Komponente: rastlsc.exe füllen </h2><br>  Das OceanLotus-Team verwendet eine alte und bekannte Technik in einer der ausführbaren Dateien des Symantec-Produkts.  Unter dem Strich wird der Vorgang des Ladens einer Bibliothek einer legitimen und signierten EXE-Datei verwendet, indem eine schädliche Bibliothek in denselben Ordner geschrieben wird.  Dadurch wird das böswillige Verhalten als legitim angesehen, da diese Aktionen ausgeführt werden, während die vertrauenswürdige ausführbare Datei ausgeführt wird. <br><br>  Wie oben erwähnt, wird die legitime Datei <code>rastlsc.exe</code> zurückgesetzt und ausgeführt. <br>  Es importiert die Datei <code>rastls.dll</code> , die in diesem Fall schädlichen Inhalt enthält. <br><br><img src="https://habrastorage.org/webt/jy/ga/ax/jygaaxccovxfilcmjrol9rmoklu.jpeg"><br>  <i>Abbildung 7. Digital signierte rastlsc.exe von Symantec</i> <br><br>  Wir haben auch eine Füllung mit anderen legitimen und signierten ausführbaren Dateien gesehen, einschließlich <code>mcoemcpy.exe</code> von McAfee, das <code>McUtil.dll</code> lädt.  Diese Technik wurde zuvor von PlugX verwendet, was die Aufmerksamkeit von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vietnam CERT</a> (auf Vietnamesisch) auf sich zog. <br><br><h3>  Stufe 1. Füllen der Bibliothek, rastls.dll </h3><br>  Der interne Name der DLL-Datei lautet <code>{7032F494-0562-4422-9C39-14230E095C52}.dll</code> , wir haben jedoch andere Versionen gesehen, z. B. <code>{5248F13C-85F0-42DF-860D-1723EEAA4F90}.dll</code> .  Alle exportierten Funktionen führen zur Ausführung derselben Funktion. <br><br><img src="https://habrastorage.org/webt/hg/1h/qm/hg1hqmssbsek8-kl8e7dkbzsotq.jpeg"><br>  <i>Abbildung 8. Alle Exporte von rasltls.dll führen zu einer einzigen Funktion</i> <br><br>  Export versucht, die <code>SyLog.bin</code> Datei zu lesen, die sich im selben Ordner befindet.  Andere Versionen haben versucht, die Datei <code>OUTLFLTR.DAT</code> zu öffnen.  Wenn die Datei vorhanden ist, wird sie mithilfe des AES-Algorithmus im CBC-Modus mit einem fest codierten 256-Bit-Schlüssel entschlüsselt. Anschließend werden die empfangenen komprimierten Daten dekomprimiert (LZMA-Komprimierung). <br><br>  Die Variante <code>McUtil.dll</code> verwendet eine andere Technik.  Auf den ersten Blick macht die Hauptfunktion nichts Bösartiges, sondern ersetzt tatsächlich den <code>.text</code> der legitimen Datei <code>mcoemcpy.exe</code> , einer Binärdatei.  Es wird ein Shellcode generiert, dessen Aufgabe darin besteht, eine Funktion zum Lesen des verschlüsselten Shellcodes der zweiten Stufe aus der Datei <code>mcscentr.adf</code> . <br><br>  Der folgende Pseudocode wird zum Erstellen von Shell-Code verwendet: <br><br> <code>x = False i = 0 <br> buff = genRandom() <br> opc1 = [0x58,0x59,0x5a,0x5b] <br> opc2 = [0x50,0x51,0x52,0x53,0x54,0x55,0x56,0x57] <br> opc3 = [0x90,0x40,0x41,0x42,0x43,0x44,0x45,0x46,0x47,0x48, <br> 0x49,0x4a,0x4b] <br> while i &lt; len(buff): <br> currentChar = buff[i] if currentChar &lt; 0xc8: <br> buff[i] = opc1[currentChar % len(opc1)] <br> else: <br> if x: <br> buff[i] = opc2[currentChar % len(opc2)] <br> else: <br> buff[i] = opc3[currentChar % len(opc3)] x = x == False <br> i+=1</code> <br> <br>  Unten in der Abbildung sehen Sie eine Auflistung des Ergebnisses des Assemblers: <br><br><img src="https://habrastorage.org/webt/i8/4y/gg/i84yggcraq46pahxx_g5gzha4_y.png"><br>  <i>Abbildung 9. Generierter Shellcode</i> <br><br><h3>  Schritte 2–4.  Wieder Shellcode, Launcher und Shellcode </h3><br>  Der <code>{E1E4CBED-5690-4749-819D-24FB660DF55F}.dll</code> entschlüsselt und lädt die <code>{E1E4CBED-5690-4749-819D-24FB660DF55F}.dll</code> Bibliothek <code>{E1E4CBED-5690-4749-819D-24FB660DF55F}.dll</code> herunter.  Die Bibliothek lädt Ressourcen und versucht, den DeviceAssociationService-Dienst zu starten.  Die entschlüsselten Informationen enthalten auch einen Shellcode.  Letzteres entschlüsselt die letzte Phase: eine Hintertür. <br><br>  Die Variante <code>{92BA1818-0119-4F79-874E-E3BF79C355B8}.dll</code> prüft, ob <code>rastlsc.exe</code> mit <code>krv</code> als erstem Parameter ausgeführt wurde.  In diesem <code>rastlsc.exe</code> wird eine Aufgabe erstellt und <code>rastlsc.exe</code> erneut ausgeführt, jedoch ohne diesen Parameter. <br><br><h3>  Stufe 5. Hintertür </h3><br> <code>{A96B020F-0000-466F-A96D-A91BBF8EAC96}.dll</code> <br> <br>  Zunächst versucht die Malware, ihre Ressourcen herunterzuladen und mithilfe des RC4-Algorithmus zu entschlüsseln.  Die resultierenden Ressourcen enthalten Daten, die zum Konfigurieren der Hintertür verwendet werden.  Das Konfigurationsformat ist nicht schwer zu finden.  Mit der Kaitai-Struktur und ihrem Strukturdämpfer erhalten wir Folgendes: <br><br><img src="https://habrastorage.org/webt/wv/sq/7r/wvsq7r5rn67px5msvrjogbnoelk.jpeg"><br>  <i>Abbildung 10. Konfigurationsstruktur</i> <br><br>  <b>Hinweis</b> : Mit Ausnahme der Zeile domain_encoding_str und der Bibliothek httpprov ändern sich die Daten von Beispiel zu Beispiel.  Die Registrierungsschlüssel sind fast identisch, haben jedoch ein ähnliches Schema: <code>\HKCU\SOFTWARE\Classes\AppX[a-f0-9]{32}</code> , nichts <code>\HKCU\SOFTWARE\Classes\AppX[a-f0-9]{32}</code> . <br><br>  Das Schadprogramm empfängt die ersten 10 Bytes des Benutzernamens (UTF-16), codiert sie mit der aus drei Buchstaben bestehenden Zeichenfolge <code>mutex_encoding_str</code> in UTF-16 und codiert sie hexadezimal.  Das Ergebnis wird als Name des Mutex verwendet.  Für einen Benutzer, dessen Name mit <code>abc</code> und einem Schlüssel in Form von <code>vwx</code> , <code>vwx</code> der Mutex beispielsweise <code>\Sessions\1\BaseNamedObjects\170015001b</code> . <br><br>  Die Hintertür enthält einen PE-Loader, der <code>HTTPProv.dll</code> Bibliothek <code>HTTPProv.dll</code> in den Speicher lädt, den Einstiegspunkt aufruft und dann die <code>CreateInstance</code> . <br><br><h3>  Kommunikation </h3><br>  Die Hintertür verwendet das Standard-TCP-Kommunikationsprotokoll über Port <code>25123</code> .  Um die Server-IP-Adresse zu erhalten, erstellt die Hintertür zunächst eine bestimmte DNS-Abfrage. <br><br>  Das Schadprogramm wählt eine von drei Domänen aus der Konfiguration aus und fügt eine spezielle Unterdomäne hinzu, die mit zwei Werten generiert wird.  Der erste Wert ist der Name des Computers innerhalb einer Länge von 16 Byte.  Die zweite ist eine 4-Byte-Versions-ID.  Der folgende Python 2-Code ist ein Codierungsalgorithmus: <br><br> <code>letters=domain_encoding_str # “ghijklmnop” hex_pc_name=pc_name.encode(“UTF-16LE”).encode(“hex”) s='' <br> for c in hex_pc_name: <br> if 0x2f &lt; ord(c) &lt; 0x3a: <br> s+=letters[ord(c) - 0x30] <br> else: <br> s+=c</code> <br> <br>  Wenn der Computername beispielsweise " <code>random-pc</code> lautet und die Versions-ID 0x0a841523 lautet, wird die folgende Domäne generiert: <br> <code>niggmhggmeggmkggmfggmdggidggngggmjgg.ijhlokga.dwarduong[.]com</code> <br> <br>  Der folgende reguläre Ausdruck kann verwendet werden, um den C &amp; C-Server dieser Hintertür zu kennzeichnen: <br> <code>[ghijklmnopabcdef]{4-60}\.[ghijklmnopabcdef]{8}\.[az]+\.[az]+</code> <br> <br>  Wenn die IP-Adresse zu einer bestimmten Domäne gehört, versucht die Malware, über Port <code>25123</code> eine TCP-Verbindung <code>25123</code> .  Jedes der Beispiele verfügt über drei verschiedene Domänennamen, mit denen der C &amp; C-Server gefunden wird. <br><br>  Der Kommunikationsprozess wird über RC4 verschlüsselt und mit LZMA komprimiert.  Es ist möglich, den Datenverkehr zu entschlüsseln, da der Schlüssel am Anfang der Pakete hinzugefügt wird.  Das Format ist wie folgt: <br> <code>[ RC4 (4 )][ ]</code> <br> <br>  Jedes Schlüsselbyte wird von der <code>rand</code> Funktion generiert.  Nach dem Entschlüsseln und Entpacken des Pakets haben die Daten das folgende Format: <br> <code>[dw:][dw:][dw: ][dw: ][dw:] [dw:]</code> <br> <br>  Wenn der Client zum ersten Mal eine Verbindung zum Server herstellt, wird die UUID übertragen, die als Sitzungskennung verwendet wird.  Letzteres wird im Registrierungsschlüssel als Binärdaten gespeichert: <code>HKCU\SOFTWARE\Classes\ AppXc52346ec40fb4061ad96be0e6cb7d16a\DefaultIcon</code> <br><br>  Wie bereits erwähnt, enthält die Hintertür auch eine Bibliothek namens <code>HTTPprov</code> .  Es wird als alternative Möglichkeit zur Kommunikation mit dem Server verwendet.  Die DLL-Datei sendet eine POST-Anforderung über HTTP.  Es unterstützt auch HTTPS und Proxys mit SOCKS5, SOCKS4a und SOCKS4.  Die Bibliothek ist statisch mit <code>libcurl</code> verknüpft. <br><br>  Nach der Initialisierung wird ein Registrierungseintrag erstellt - ein Befehl für die Backdoor zur weiteren Verwendung von HTTP für die Kommunikation mit dem Befehlsserver: <code>HKCU\SOFTWARE\Classes\ CLSID{E3517E26-8E93-458D-A6DF-8030BC80528B}</code> . <br><br>  Die Standard-Client-Anwendung wird verwendet: <code>Mozilla/4.0 ( ; MSIE 8.0; Windows NT 6.0; Trident/4.0)</code> . <br><br>  Das Hauptmerkmal dieser Bibliothek ist ein spezieller Verschlüsselungsalgorithmus für eine universelle Ressourcenkennung.  Der Ressourcenteil des URI wird mit dem folgenden Pseudocode erstellt: <br><br> <code>buffEnd = ((DWORD)genRand(4) % 20) + 10 + buff; while (buff &lt; buffEnd){ <br> b=genRand(16); <br> if (b[0] - 0x50 &gt; 0x50) <br> t=0; <br> else <br> *buf++= UPPER(vowels[b[1] % 5]); <br> v=consonants[b[1]%21]); if (!t) <br> v=UPPER(v); <br> *buff++= v; <br> if (v!='h' &amp;&amp; b[2] - 0x50 &lt; 0x50) <br> *buff++= 'h'; <br> *buff++= vowels[b[4] % 5]; <br> if (b[5] &lt; 0x60) <br> *buff++= vowels[b[6] % 5]; <br> *buff++= consonants[b[7] % 21]; <br> if (b[8] &lt; 0x50) <br> *buff++= vowels[b[9] % 5]; <br> *buff++= '-'; <br> }; <br> *buff='\0';</code> <br> <br>  <b>Hinweis</b> : Aus Gründen der Übersichtlichkeit wurde der Teil, der für die Überprüfung der Zeichenfolgenlänge verantwortlich ist, aus dem Code entfernt. <br><br>  Um den Bezeichner aus der generierten Zeichenfolge zu erhalten, werden zwei Zahlen mithilfe eines speziellen Summenüberprüfungsalgorithmus hinzugefügt: <br><br> <code>checksum=crc32(buff) <br> num2=(checksum &gt;&gt; 16) + (checksum &amp; 0xffff) * 2 <br> num1=(num2 ^ 1) &amp; 0xf <br> URL=GENERATED_DOMAIN+ “/” + num1 + “/” + num2 + “-” + buff</code> <br> <br>  Wenn Sie den URI-Generator der <code>HTTPprov</code> Bibliothek <code>HTTPprov</code> , erhalten Sie die folgende URL: <br> <code>hXXp://niggmhggmeggmkggmfggmdggidggngggmjgg.ijhlokga.aisicoin[.]com/ 13/139756-Ses-Ufali-L</code> <br> <br><h3>  Teams </h3><br>  Nach Erhalt der SESSIONID-Sitzungskennung erstellt die Hintertür einen Systemfingerabdruck.  Das Paket ist wie folgt aufgebaut (Einzug in der Paketbeschreibung): <br><br>  <i>0x000</i> - Bytes: Der Wert ändert sich in jeder Version <br>  <i>0x001</i> - 0x01: fest codiertes Byte <br>  <i>0x002</i> - bool: erhöhte Berechtigungen <br>  <i>0x003</i> - dword: Versions-ID <br>  <i>0x007</i> - Zeichenfolge (UTF-16), Computername (max. 0x20) <br>  <i>0x027</i> - Zeichenfolge (UTF-16), Benutzername <br>  <i>0x079</i> - das Ergebnis einer Registrierungsabfrage in den Werten <code>HKLM\SOFTWARE\Microsoft\Windows NT\ CurrentVersion</code> : <code>ProductName</code> , <code>CSDVersion</code> , <code>CurrentVersion</code> , <code>ReleaseId</code> , <code>CurrentBuildNumber</code> und das Ergebnis des Aufrufs von <code>IsWow64Process (x86|x64)</code> <br>  <i>0x179</i> - das nachfolgende Format der Zeichenfolge% s (% s);  ersetzt durch ( <code>GetVolumeInformationW:VolumeNameBuffer</code> ), <code>VolumePathNames</code> <br>  <i>0x279</i> - Physische Festplatte, E / A-Steuerung eines PhysicalDrive-GerätsIOControl 0x2D1400 (IOCTL_STORAGE_QUERY_ PROPERTY) (VolSerialNumber) <br>  <i>0x379</i> - wmi <code>SELECT SerialNumber FROM Win32_BaseBoard</code> <br>  <i>0x3f9</i> - <i>Ruft</i> das aktuelle Datum und die aktuelle Uhrzeit GetSystemTimeAsFileTime ab <br>  <i>0x400</i> - bool: unbekannt <br>  <i>0x401</i> - dword: Wird nach dem Entschlüsseln der Ressource empfangen <br><br>  Hier ist ein Beispiel für einen Systemfingerabdruck: <br><br><img src="https://habrastorage.org/webt/s5/kg/rj/s5kgrj1nop52oeuj-xgop8c7zsa.jpeg"><br>  <i>Abbildung 11. Systemfingerabdruck</i> <br><br>  Dies ist eine vollwertige Hintertür, die ihren Bedienern eine Reihe von Funktionen bietet: Bearbeiten der Datei, Registrierung und Prozesse, Herunterladen zusätzlicher Komponenten, Abrufen eines digitalen Fingerabdrucks des Systems.  Nachfolgend finden Sie die Nummern und Beschreibungen der unterstützten Befehle: <br><br>  0 - digitaler Fingerabdruck <br>  1 - Legt die Sitzungs-ID fest <br>  2 - Erstellen eines Prozesses und Erhalten eines Ergebnisses (Verwenden von Programmkanälen) <br>  3 - Setzt den Zähler für Verbindungsversuche <br>  4 - verschiebt die Abrufzeit <br>  5 - liest eine Datei oder einen Registrierungsschlüssel und berücksichtigt MD5 <br>  6 - Erstellen eines Prozesses <br>  7 - Erstellt eine Datei, einen Registrierungseintrag oder einen Stream im Speicher <br>  8 - schreibt in die Registrierung <br>  9 - fragt die Registrierung ab <br>  10 - sucht nach Dateien im System <br>  11 - überträgt Dateien in ein anderes Verzeichnis <br>  12 - Entfernt Dateien von der Festplatte <br>  13 - Abrufen einer Liste der im System mit der Funktion markierten Festplatten <br> <code>GetLogicalDriveStringW</code> <br>  14 - erstellt ein Verzeichnis <br>  15 - Entfernt das Verzeichnis <br>  16 - Liest die Datei vom Offset <br>  17 - ruft den PE-Loader auf (wechseln Sie zur Kommunikation über <code>HTTPprov</code> ) <br>  18 - [unbekannt] <br>  19 - 0: Abfragen des Werts in der Registrierung;  1: Programmdurchführung und -umsetzung <br>  20 - Setzt die Umgebungsvariable <br>  21 - Startet Shellcode in einem neuen Thread <br>  22 - gibt die Umgebungsvariable zurück <br>  23 in der neuen Version - Startet sich neu, wenn die APPL-Umgebungsvariable nicht vorhanden ist <br><br><h2>  Fazit </h2><br>  OceanLotus ist weiterhin sehr aktiv und aktualisiert das Toolkit weiterhin. <br>  Die Gruppe versucht, ihre Aktivitäten zu verbergen. Dazu wählen die Angreifer die Opfer sorgfältig aus, begrenzen die Verbreitung von Malware und verwenden mehrere Server, um nicht auf dieselbe Domain oder IP-Adresse aufmerksam zu machen.  Die Entschlüsselung der zu implementierenden Komponente und die Side-Loading-Technik ermöglichen es trotz ihrer weit verbreiteten Beliebtheit, eine Erkennung zu vermeiden, da die Arbeit von Angreifern in diesem Fall als legitime Anwendung getarnt ist. <br><br><h2>  Kompromissindikatoren (IoCs) </h2><br><h3>  Proben </h3><br><h4>  Tabelle 1: Tropfer </h4><br><img src="https://habrastorage.org/webt/4z/vz/kh/4zvzkhbbyci_fp6w6jyedbpn42i.png"><br><br><h4>  Tabelle 2: Bibliotheken </h4><br><img src="https://habrastorage.org/webt/0g/9i/2r/0g9i2rys-bufj_lmi9xqb7orl3g.png"><br><br><h3>  Netzwerk </h3><br><h4>  IP-Adressen </h4><br> <code>46.183.220.81 <br> 46.183.220.82 <br> 46.183.222.82 <br> 46.183.222.83 <br> 46.183.222.84 <br> 46.183.223.106 <br> 46.183.223.107 <br> 74.121.190.130 <br> 74.121.190.150 <br> 79.143.87.230</code> </div> </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de421779/">https://habr.com/ru/post/de421779/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de421765/index.html">Was ist eine Webanwendung in der Produktion?</a></li>
<li><a href="../de421767/index.html">Bergleuten wird angeboten, den Status eines Selbständigen anzugeben</a></li>
<li><a href="../de421769/index.html">Das Buch "Deep Learning on R"</a></li>
<li><a href="../de421773/index.html">Als ein Team von Technikfreaks ihre Firma gründete, Staffel 3 (endlich geflogen!)</a></li>
<li><a href="../de421775/index.html">Neuronales Netzwerk trainiert, um Depressionen durch willkürliche Sprache einer Person ohne Kontext zu erkennen</a></li>
<li><a href="../de421783/index.html">Fun State Management Huex Framework</a></li>
<li><a href="../de421785/index.html">Kalifornien steht kurz vor einer vollständigen Ablehnung von Kohlenstoff bei der Energieerzeugung</a></li>
<li><a href="../de421787/index.html">Projektarchitekturentwicklung, Schiffe und JavaScript</a></li>
<li><a href="../de421789/index.html">Machen Sie das Frontend wieder zum "Backend"</a></li>
<li><a href="../de421791/index.html">Ethische Fragen der künstlichen Intelligenz</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>