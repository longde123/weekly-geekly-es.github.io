<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äç‚öñÔ∏è üî± üê¨ Comme j'ai √©crit une crypto-monnaie centralis√©e en PHP. (Partie 1 - R√©sum√©s de base + D√©marrage rapide) üë®‚Äçüéì üë∂üèª üê∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√©face 
 Oui, pensez-y juste, une crypto-monnaie centralis√©e en PHP, ce n'est pas vrai. Mais mes limites sur les id√©es ont n√©anmoins fait leur chemin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comme j'ai √©crit une crypto-monnaie centralis√©e en PHP. (Partie 1 - R√©sum√©s de base + D√©marrage rapide)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481392/"><h1>  Pr√©face </h1><br>  Oui, pensez-y juste, une crypto-monnaie centralis√©e en PHP, ce n'est pas vrai.  Mais mes limites sur les id√©es ont n√©anmoins fait leur chemin, donc, comme vous l'avez peut-√™tre devin√©, j'ai d√©cid√© d'√©crire √† ce sujet.  Dans la toute premi√®re partie, nous vous dirons ce qu'est la crypto-monnaie, discuterons des notes initiales et cr√©erons un syst√®me de portefeuille.  Maintenant, commen√ßons. <br><a name="habracut"></a><br><h2>  √Ä quoi ressemble la crypto-monnaie? </h2><br>  <i>informations tir√©es de <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D1%2580%25D0%25B8%25D0%25BF%25D1%2582%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BB%25D1%258E%25D1%2582%25D0%25B0" rel="nofollow">Wikipedia</a></i> <br><br><img align="left" src="https://habrastorage.org/webt/tc/tm/td/tctmtd68gowbmixyb4syaphyxm4.jpeg" width="45%" height="50%">  La crypto-monnaie est un type de monnaie num√©rique, dont la comptabilit√© des unit√©s de r√®glement interne est fournie par un syst√®me de paiement d√©centralis√© (il n'y a pas d'administrateur interne ou externe ou tout analogue de celui-ci), fonctionnant en mode enti√®rement automatique. <br><br>  La crypto-monnaie elle-m√™me n'a pas de mat√©riel sp√©cial ou de forme √©lectronique - c'est juste un nombre indiquant la quantit√© de donn√©es des unit√©s de r√®glement, qui est √©crit √† la position correspondante du paquet d'informations du protocole de transfert de donn√©es et n'est souvent m√™me pas crypt√©, comme toutes les autres informations sur les transactions entre adresses syst√®me. <br><br>  En bref, la crypto-monnaie fonctionne comme ceci: <br><br><ol><li>  Un utilisateur du r√©seau, disposant d'un solde, envoie une transaction √† un autre utilisateur anonyme. </li><li>  La transaction entre dans le r√©seau. </li><li>  Les mineurs (ou les utilisateurs cr√©ant des blocs) r√©solvent un probl√®me g√©n√©r√© par un algorithme sp√©cial avec des conditions (par exemple, pour la pr√©sence des 10-30 z√©ros pr√©c√©dents dans le hachage, ou vice versa). </li><li>  Lorsqu'une condition (ou des conditions) est remplie dans un hachage, gr√¢ce √† elle, le mineur envoie un message au r√©seau l'informant de la cr√©ation d'un nouveau bloc et de la transaction. </li><li>  Le b√©n√©ficiaire re√ßoit les fonds et le mineur re√ßoit le montant de la r√©mun√©ration, sous la forme d'une commission calcul√©e lors de la pr√©paration de la t√¢che. </li></ol><br><h2>  Est-il judicieux d'√©crire une crypto-monnaie centralis√©e, et √©galement en PHP? </h2><br>  Je pense pas tr√®s.  Mais essayez √† nouveau comme il se doit. <br><br><h2>  Nous consid√©rons les notes avant le d√©veloppement </h2><br>  Nous utiliserons un syst√®me de v√©rification √† double hachage utilisant la preuve de travail.  Il est logique de v√©rifier les hachages au niveau des logiciels et des applications r√©seau.  Cela est d√ª au processus d'optimisation de la charge sur le serveur.  Parce que lorsque nous allons sur le serveur pour v√©rifier le hachage plusieurs fois, une telle charge appara√Æt.  Par cons√©quent, je propose de faire la m√©thode suivante: <br><br><ol><li>  Sur un mineur de logiciel, v√©rifiez localement le hachage pour satisfaire aux conditions. </li><li>  Lorsque les conditions sur le mineur logiciel co√Øncident avec les conditions n√©cessaires, nous effectuons une v√©rification au niveau du r√©seau d'application (au niveau du serveur). </li></ol><br>  √Ä mon avis, c'est la meilleure fa√ßon de r√©partir la charge.  Il est plus facile de v√©rifier plusieurs fois localement sur l'ordinateur que de spammer les demandes au serveur plusieurs fois. <br><br>  Le nom - j'ai trouv√© un nom simple et peut-√™tre m√©morable - FlyCoin avec un code de devise FLC √† trois chiffres. <br><br>  Base de donn√©es - J'utiliserai une option simple et pratique, PDO. <br><br>  Portefeuilles cryptographiques - seront g√©n√©r√©s √† l'aide du GUID et de mt_rand, et le temps POSIX sera utilis√© comme graine. <br><br>  √ätes-vous trop paresseux pour avoir une fonction de v√©rification du hachage?  - Oui, c'est pourquoi j'ai d√©cid√© de prendre le code d'un ancien mineur (open source) d'une telle crypto-monnaie (d√©j√† morte) Entropy, mon ami, Nikita. <br><br><div class="spoiler">  <b class="spoiler_title">Je ne peux pas croire qu'il ait cr√©√© une seule crypto-monnaie.</b>  <b class="spoiler_title">Y a-t-il autre chose?</b> <div class="spoiler_text">  En g√©n√©ral, toutes ses cr√©ations (que j'utilise parfois m√™me), vous pouvez les retrouver dans son groupe <a href="https://vk.com/hphp_convertation" rel="nofollow">VKontakte</a> .  J'esp√®re qu'ils seront utiles aussi. <br></div></div><br><h2>  C'est parti! </h2><br>  Commen√ßons par faire le cadre de notre futur syst√®me.  Commen√ßons par le d√©veloppement de l'API d'application pour notre crypto-monnaie.  Et le cadre semble si vide jusqu'√† pr√©sent. <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * The API for FlyCoin */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkHash</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($hash, $exp)</span></span></span><span class="hljs-function"> //  $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hash</span></span></span><span class="hljs-function"> -     ,  $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">exp</span></span></span><span class="hljs-function"> - .    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Entropy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Miner</span></span></span><span class="hljs-function">,   . </span></span>{ $sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    . $len = strlen ($hash); // C  . for ($i = 0; $i &lt; $len; ++$i) $sum += 2 * base_convert ($hash[$i], 16, 10); //        return $sum % 10 == 0 &amp;&amp; substr ($hash, -$exp) === str_repeat ('0', $exp); //  false       true,         . } class Block { public $id; // ID  public $prev_hash; //    public $from; //   public $to; //  public $ammount; //  public $difficult; //   } class API { protected $db; public function __construct () { $dsn = "mysql:host=localhost;dbname=flc"; // DSN   $this-&gt;db = new PDO ($dsn, $username, $password); //     try { return true; //  . } catch (PDOException $exception) { return false; //  . } } }</span></span></code> </pre> <br>  Le voici, le cadre de notre miracle.  Tout d'abord, nous impl√©mentons l'enregistrement et la g√©n√©ration de GUID pour nos portefeuilles.  J'ai imm√©diatement cr√©√© une d√©finition de fonction API vide et j'ai √©galement trouv√© une fonction de g√©n√©ration de GUID dans Google.  N'oubliez pas les graines.  Je viens de trouver une fonction pour obtenir des graines, pour obtenir un GUID unique. <br><br><pre> <code class="php hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_seed</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> //      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PHP</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> ($usec, $sec) = explode (<span class="hljs-string"><span class="hljs-string">' '</span></span>, microtime ()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $sec + $usec * <span class="hljs-number"><span class="hljs-number">1000000</span></span>; } mt_srand (make_seed ());</code> </pre><br>  Super.  Et la fonction pour g√©n√©rer le GUID pour le portefeuille ressemble √† ceci (ainsi que le talon lui-m√™me): <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">register</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> //    </span></span>{ } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">genGUID4</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> //  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Google</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sprintf (<span class="hljs-string"><span class="hljs-string">'%04x%04x-%04x-%04x-%04x-%04x%04x%04x'</span></span>, mt_rand (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0xffff</span></span>), mt_rand (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0xffff</span></span>), mt_rand (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0xffff</span></span>), mt_rand (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0fff</span></span>) | <span class="hljs-number"><span class="hljs-number">0x4000</span></span>, mt_rand (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0x3fff</span></span>) | <span class="hljs-number"><span class="hljs-number">0x8000</span></span>, mt_rand (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0xffff</span></span>), mt_rand (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0xffff</span></span>), mt_rand (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0xffff</span></span>)); <span class="hljs-comment"><span class="hljs-comment">//     ,   . }</span></span></code> </pre><br>  √âtant donn√© que nous faisons tout de mani√®re anonyme, nous ne stockons pas IP ou e-mail.  Pas de confirmation.  Nous suffirons.  En ~ 25 minutes, j'ai √©crit une fonction d'enregistrement.  Un seul mot de passe nous est demand√©.  La fonction API nous renverra le portefeuille. <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">register</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password)</span></span></span><span class="hljs-function"> //  $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">password</span></span></span><span class="hljs-function"> -    </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db) <span class="hljs-comment"><span class="hljs-comment">//    { $walletId = 'FLC@' . $this-&gt;genGUID4 (); //      $hash = crc32 ($walletId) . $walletId . hash_hmac ('sha512', str_rot13 ($password), 'FLC'); //     . $hash = hash_hmac ('sha512', $hash, 'FLC2'); //     . $newUser = $this-&gt;db-&gt;prepare (" INSERT INTO `wallets` (walletId, loginHash, balance) VALUES (:walletId, :hash, :startBalance) "); //    . $newUser-&gt;bindParam (':walletId', $walletId, PDO::PARAM_STR); //     $newUser-&gt;bindParam (':hash', $hash, PDO::PARAM_STR); //     $newUser-&gt;bindParam (':startBalance', 0, PDO::PARAM_INT); //    (   ,   0!)   $newUser-&gt;execute (); //  . return ['walletId' =&gt; $walletId]; //     ( ) } else return false; //      . }</span></span></code> </pre><br>  Ici, j'ai bri√®vement d√©crit ce que fait telle ou telle ligne. <br><br><div class="spoiler">  <b class="spoiler_title">Message juste pour les gens et les programmeurs justes.</b> <div class="spoiler_text">  Si vous avez laiss√© vos contacts sur le site (sur lequel, peut-√™tre, cette crypto-monnaie sera situ√©e), et ils vous √©crivent quelque chose comme ceci: <br><br>  "Bonjour, pouvez-vous aider?"  J'ai gard√© beaucoup de mani sur votre blockchain, et soudain j'ai perdu mon mot de passe, aidez-moi et vous serez bien ¬ª- n'h√©sitez pas √† rejeter cette offre.  L'essence de la crypto-monnaie est le stockage des num√©ros chiffr√©s en toute s√©curit√©.  Personne ne peut prouver qu'il poss√®de un compte.  Ainsi, n'importe quel attaquant peut m√™me voler les fonds d'autres personnes <b>m√™me sans la participation de la victime!</b>  Ce n'est pas grave, bien que cette personne soit vraiment le propri√©taire du compte, il vaut mieux refuser.  Si vous avez perdu de l'argent, cela signifie que vous n'avez pas correctement stock√© les donn√©es du compte.  Pour plus de s√©curit√©, nous n'impl√©menterons plus de r√©cup√©ration de mot de passe. <br></div></div><br>  La fonction de hachage pr√©sent√©e ici peut √™tre repr√©sent√©e comme suit: <br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>h</mi><mi>a</mi><mi>c</mi><mi>h</mi><mi>a</mi><mi>g</mi><mi>e</mi><mo stretchy=&quot;false&quot;>(</mo><mi>w</mi><mo>,</mo><mi>p</mi><mi>w</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mi>c</mi><mi>r</mi><mi>c</mi><mn>32</mn><mo stretchy=&quot;false&quot;>(</mo><mi>w</mi><mo stretchy=&quot;false&quot;>)</mo><mo>.</mo><mi>w</mi><mo>.</mo><mi>h</mi><mi>m</mi><mi>a</mi><mi>c</mi><mo stretchy=&quot;false&quot;>(</mo><mi>p</mi><mi>w</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="41.635ex" height="2.66ex" viewBox="0 -832 17926.1 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMATHI-68" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMATHI-61" x="576" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMATHI-63" x="1106" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMATHI-68" x="1539" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMATHI-61" x="2116" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMATHI-67" x="2645" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMATHI-65" x="3126" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMAIN-28" x="3592" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMATHI-77" x="3982" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMAIN-2C" x="4698" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMATHI-70" x="5143" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMATHI-77" x="5647" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMAIN-29" x="6363" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMAIN-3D" x="7030" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMATHI-63" x="8087" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMATHI-72" x="8520" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMATHI-63" x="8972" y="0"></use><g transform="translate(9405,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMAIN-32" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMAIN-28" x="10406" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMATHI-77" x="10796" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMAIN-29" x="11512" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMAIN-2E" x="11902" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMATHI-77" x="12347" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMAIN-2E" x="13063" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMATHI-68" x="13509" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMATHI-6D" x="14085" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMATHI-61" x="14964" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMATHI-63" x="15493" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMAIN-28" x="15927" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMATHI-70" x="16316" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMATHI-77" x="16820" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/481392/&amp;xid=17259,1500008,15700022,15700186,15700191,15700259,15700271&amp;usg=ALkJrhjX_z2eDkQ2oLOBcC-XRoJyE15BiQ#MJMAIN-29" x="17536" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>h</mi><mi>a</mi><mi>c</mi><mi>h</mi><mi>a</mi><mi>g</mi><mi>e</mi><mo stretchy="false">(</mo><mi>w</mi><mo>,</mo><mi>p</mi><mi>w</mi><mo stretchy="false">)</mo><mo>=</mo><mi>c</mi><mi>r</mi><mi>c</mi><mn>32</mn><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo><mo>.</mo><mi>w</mi><mo>.</mo><mi>h</mi><mi>m</mi><mi>a</mi><mi>c</mi><mo stretchy="false">(</mo><mi>p</mi><mi>w</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-1"> hachage (w, pw) = crc32 (w) .w.hmac (pw) </script><br><br>  La fonction fonctionne comme ceci: <br><br>  Un mot de passe est entr√©, on v√©rifie si la base de donn√©es est connect√©e: <br><br><div class="spoiler">  <b class="spoiler_title">Oui, connect√©.</b>  <b class="spoiler_title">(Faisons un mot de passe 12345)</b> <div class="spoiler_text">  Nous g√©n√©rons l'adresse du portefeuille et √©crivons dans $ walletId - nous obtenons quelque chose comme ceci: <b>FLC @ c1cbe61d-a19d-4c82-ba17-3a577df0aeb5</b> (ce GUID a √©t√© g√©n√©r√© par un autre site, j'ai ensuite ajout√© le pr√©fixe FLC @). <br><br>  Nous calculons le hachage en texte brut.  Dans la premi√®re s√©rie, nous obtenons les √©l√©ments <b>suivants: 0087196442FLC @ c1cbe61d-A19D-4c82</b> -ba17-3a577df0aeb59ee77779db5a44ef3f60044fcb0e1170218e642cb9adc0789ddd08871ad95c7e1d3b1391c6c79774d319b5141bd3b13b717c3d389206ede659cb280949feac66 ( beaucoup de lettres, ne soyez pas surpris). <br>  Au deuxi√®me tour, le hachage deviendra √† cent pour cent HMAC: <b>5e43cbb404c81efeb35162e5bba0766f20b340fbabcc66fd5f7a6a1993a8ccd43fc6384ac53f939acca4378681e2bb17912eacf6aaa6a6aa6</b> <br><br>  Nous √©crivons tout cela dans la base de donn√©es. <br><br>  En r√©ponse, nous √©crivons le num√©ro de portefeuille via lequel vous pouvez vous connecter. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Non, pas connect√©.</b> <div class="spoiler_text">  Dans ce cas, vous ne devez pas vous attendre √† quelque chose qui en vaille la peine, renvoyez FAUX. <br></div></div><br>  Voici √† quoi ressemble un syst√®me d'enregistrement sophistiqu√©.  En fait, cela semble tr√®s simple.  Et en termes de code - beaucoup plus compliqu√©. <br><br>  Nous passerons plus de temps et ferons l'autorisation.  Avec l'autorisation, la situation est plus simple.  Nous recherchons un compte et essayons de nous connecter, connaissant les algorithmes de g√©n√©ration de hachage de mot de passe familiers.  Ensuite, nous v√©rifions, et si les donn√©es sont correctes, nous donnons au client une ligne importante dans laquelle les donn√©es sont stock√©es pour la communication entre le serveur et le mineur. <br><br><div class="spoiler">  <b class="spoiler_title">De moi-m√™me.</b> <div class="spoiler_text">  On dirait que nous ne faisons pas de crypto-monnaie, mais un syst√®me d'autorisation entre PHP sur le serveur et PHP utilisant php.exe.  Dans la deuxi√®me partie, nous ajouterons un deuxi√®me g√¢teau √† notre ¬´g√¢teau¬ª, dans lequel nous verrons quelque chose li√© √† l'exploitation mini√®re, √† la blockchain et aux transactions. <br></div></div><br>  Apr√®s 15 √† 25 minutes suppl√©mentaires, la fonction d'autorisation √©tait pr√™te.  Voir ce code ci-dessous: <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">login</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($walletId, $password)</span></span></span><span class="hljs-function"> //  </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db) <span class="hljs-comment"><span class="hljs-comment">//    { $hash = crc32 ($walletId) . $walletId . hash_hmac ('sha512', str_rot13 ($password), 'FLC'); //     . $hash = hash_hmac ('sha512', $hash, 'FLC2'); //     . $newUser = $this-&gt;db-&gt;prepare (" SELECT * FROM `wallets` WHERE walletId = :walletId AND loginHash = :hash LIMIT 0, 1 "); //    . $newUser-&gt;bindParam (':walletId', $walletId, PDO::PARAM_STR); //     $newUser-&gt;bindParam (':hash', $hash, PDO::PARAM_STR); //     $newUser-&gt;execute (); //  . $object = $newUser-&gt;fetch_object (); //   ,     if ($object AND hash_equals ($object-&gt;hash, $hash)) //   ,   . { $loginString = new stdClass; //    stdClass $loginString-&gt;hash = $hash; //       . $loginString-&gt;wallet = $walletId; return ['token' =&gt; serialize ($loginString)]; //      ,   . } else return false; //   / . } else return false; //    }</span></span></code> </pre><br>  Ce code est presque un enregistrement, mais fonctionne dans l'algorithme inverse.  Le travail avec les utilisateurs a pris fin. <br><br><h2>  Postcondition </h2><br>  Pendant cette p√©riode int√©ressante de lecture de l'article, nous avons fait ce qui suit: <br><br><ul><li>  Nous avons bri√®vement fait connaissance avec la crypto-monnaie et comment la construire correctement. </li><li>  Ils ont bri√®vement r√©pondu √† la question "Est-il judicieux de cr√©er une crypto-monnaie centralis√©e, et √©galement en PHP?" </li><li>  Discut√© des notes avant d'effectuer cette t√¢che </li><li>  Impl√©mentation d'un syst√®me de comptes cryptographiques. </li></ul><br>  Et maintenant, vous pouvez lire ce qui √©tait derri√®re les stores: <br><br><div class="spoiler">  <b class="spoiler_title">Sous le rideau</b> <div class="spoiler_text">  Cet article a √©t√© √©crit environ 4-5 heures (tout le coucher du soleil et le soir).  Pendant ce temps, comme je l'ai √©crit, j'ai √©volu√©, mais quand il s'agit d'√©crire un article sur Habrahabr, mon d√©sir de r√©aliser mon r√™ve ne s'estompe pas.  En effet, en raison du concept simple de POO, il √©tait plus facile pour moi de l'utiliser que MySQLi, ou pire, les fonctions ordinaires avec le pr√©fixe mysql_, qui sont consid√©r√©es comme obsol√®tes et ne sont plus adapt√©es au d√©veloppement en PHP. <br></div></div><br>  Ce que nous ferons la prochaine fois: <br><br><ul><li>  Faisons l'exploitation mini√®re. </li><li>  Voyons comment les transactions et les blocs sont organis√©s. </li><li>  Nous ferons des transactions et nous donnerons un sens √† la classe Block inutilis√©e. </li></ul><br>  Merci d'avoir lu!  A bient√¥t!  Ceci est mon premier article - j'attends des critiques. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr481392/">https://habr.com/ru/post/fr481392/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr481378/index.html">Comment optimiser le d√©veloppement d'applications</a></li>
<li><a href="../fr481382/index.html">Applications natives Windows et Acronis Active Restore</a></li>
<li><a href="../fr481386/index.html">Tramage: signal bruyant pour l'am√©liorer</a></li>
<li><a href="../fr481388/index.html">Comment les √©changes de crypto-monnaies construisent leurs blockchains d√©fiant DeFi</a></li>
<li><a href="../fr481390/index.html">Nouvelles du monde d'OpenStreetMap n ¬∞ 490 (12/03/2019 - 09/12/2019)</a></li>
<li><a href="../fr481394/index.html">Recr√©er dans un nouveau jeu ce que nous aimions pour les anciens</a></li>
<li><a href="../fr481398/index.html">Commandes Linux de base pour les testeurs et plus</a></li>
<li><a href="../fr481402/index.html">Impl√©mentation paresseuse de la travers√©e d'un arbre d'enfants de la classe QObject</a></li>
<li><a href="../fr481406/index.html">Immersion profonde dans l'investissement d'Ilona Mask</a></li>
<li><a href="../fr481416/index.html">Annonce du deuxi√®me Meetup AWS √† Minsk (13/02/2020)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>