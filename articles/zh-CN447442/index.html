<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘€ ğŸŒ‹ ğŸ§•ğŸ¾ å¼•å…¥shellè¿ç®—ç¬¦ï¼šä½¿Kubernetesçš„è¿ç®—ç¬¦æ›´åŠ å®¹æ˜“ ğŸš€ ğŸ¦ ğŸ“¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘ä»¬çš„åšå®¢ä¸­å·²ç»æœ‰å…³äºKubernetesä¸­è¿ç®—ç¬¦åŠŸèƒ½ä»¥åŠå¦‚ä½•è‡ªå·±ç¼–å†™ç®€å•è¿ç®—ç¬¦çš„æ–‡ç«  ã€‚ è¿™æ¬¡ï¼Œæˆ‘ä»¬å¸Œæœ›å¼•èµ·æ‚¨çš„æ³¨æ„ï¼Œæˆ‘ä»¬çš„å¼€æºè§£å†³æ–¹æ¡ˆå°†æ“ä½œå‘˜çš„åˆ›å»ºå¸¦åˆ°äº†ä¸€ä¸ªéå¸¸å®¹æ˜“çš„ç¨‹åº¦-ç†Ÿæ‚‰shellæ“ä½œç¬¦ ï¼ 

 æ€ä¹ˆäº† 
 shellè¿ç®—ç¬¦çš„æƒ³æ³•éå¸¸ç®€å•ï¼šä»Kuberneteså¯¹è±¡è®¢é˜…äº‹ä»¶ï¼Œå¹¶åœ¨æ¥æ”¶åˆ°...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å¼•å…¥shellè¿ç®—ç¬¦ï¼šä½¿Kubernetesçš„è¿ç®—ç¬¦æ›´åŠ å®¹æ˜“</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/447442/"> æˆ‘ä»¬çš„åšå®¢ä¸­å·²ç»æœ‰å…³äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kubernetesä¸­è¿ç®—ç¬¦åŠŸèƒ½</a>ä»¥åŠå¦‚ä½•<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è‡ªå·±ç¼–å†™ç®€å•è¿ç®—ç¬¦çš„æ–‡ç« </a> ã€‚ è¿™æ¬¡ï¼Œæˆ‘ä»¬å¸Œæœ›å¼•èµ·æ‚¨çš„æ³¨æ„ï¼Œæˆ‘ä»¬çš„å¼€æºè§£å†³æ–¹æ¡ˆå°†æ“ä½œå‘˜çš„åˆ›å»ºå¸¦åˆ°äº†ä¸€ä¸ªéå¸¸å®¹æ˜“çš„ç¨‹åº¦-ç†Ÿæ‚‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">shellæ“ä½œç¬¦</a> ï¼ <br><br><h2> æ€ä¹ˆäº† </h2><br>  shellè¿ç®—ç¬¦çš„æƒ³æ³•éå¸¸ç®€å•ï¼šä»Kuberneteså¯¹è±¡è®¢é˜…äº‹ä»¶ï¼Œå¹¶åœ¨æ¥æ”¶åˆ°è¿™äº›äº‹ä»¶æ—¶å¯åŠ¨ä¸€ä¸ªå¤–éƒ¨ç¨‹åºï¼Œå¹¶ä¸ºå…¶æä¾›æœ‰å…³äº‹ä»¶çš„ä¿¡æ¯ï¼š <br><br><img src="https://habrastorage.org/webt/o6/13/83/o61383z0_6avp-0dbdjlr2fgfyq.png"><a name="habracut"></a><br><br> åœ¨é›†ç¾¤è¿è¡ŒæœŸé—´ï¼Œå½“æˆ‘ä»¬çœŸæ­£å¸Œæœ›ä»¥æ­£ç¡®çš„æ–¹å¼å®ç°è‡ªåŠ¨åŒ–çš„å°ä»»åŠ¡å¼€å§‹å‡ºç°æ—¶ï¼Œå¯¹æˆ‘ä»¬çš„éœ€æ±‚å°±éšä¹‹è€Œæ¥ã€‚ æ‰€æœ‰è¿™äº›æ¬¡è¦ä»»åŠ¡éƒ½æ˜¯é€šè¿‡ç®€å•çš„bashè„šæœ¬è§£å†³çš„ï¼Œå°½ç®¡æ‚¨çŸ¥é“ï¼Œæ“ä½œå‘˜æœ€å¥½ç”¨Golangç¼–å†™ã€‚ æ˜¾ç„¶ï¼Œä¸ºæ¯ä¸ªå¦‚æ­¤å°çš„ä»»åŠ¡æŠ•èµ„å…¨é¢çš„è¿è¥å•†å¼€å‘å°†æ˜¯ä½æ•ˆçš„ã€‚ <br><br><h2>  15åˆ†é’Ÿå†…å³å¯æ“ä½œ </h2><br> è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹å¯ä»¥åœ¨Kubernetesé›†ç¾¤ä¸­å®ç°è‡ªåŠ¨åŒ–ï¼Œä»¥åŠshellè¿ç®—ç¬¦å°†å¦‚ä½•æä¾›å¸®åŠ©ã€‚ ç¤ºä¾‹å¦‚ä¸‹ï¼šå¤åˆ¶å¯†é’¥ä»¥è®¿é—®Dockeræ³¨å†Œè¡¨ã€‚ <br><br> ä½¿ç”¨ç§æœ‰æ³¨å†Œè¡¨ä¸­çš„æ˜ åƒçš„Podå¿…é¡»åœ¨å…¶æ¸…å•ä¸­åŒ…å«æŒ‡å‘åŒ…å«è®¿é—®æ³¨å†Œè¡¨çš„æ•°æ®çš„ç§˜å¯†çš„é“¾æ¥ã€‚ åœ¨åˆ›å»ºPodä¹‹å‰ï¼Œå¿…é¡»åœ¨æ¯ä¸ªå‘½åç©ºé—´ä¸­åˆ›å»ºæ­¤ç§˜å¯†ã€‚ å®Œå…¨æœ‰å¯èƒ½æ‰‹åŠ¨æ‰§è¡Œæ­¤æ“ä½œï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬è®¾ç½®åŠ¨æ€ç¯å¢ƒï¼Œåˆ™ä¸€ä¸ªåº”ç”¨ç¨‹åºå°†æœ‰å¾ˆå¤šåç§°ç©ºé—´ã€‚ è€Œä¸”å¦‚æœåº”ç”¨ç¨‹åºä¹Ÿä¸æ˜¯2-3 ...ï¼Œé‚£ä¹ˆç§˜å¯†çš„æ•°é‡å°†å˜å¾—éå¸¸å¤§ã€‚ å…³äºæœºå¯†çš„å¦ä¸€ä»¶äº‹ï¼šæˆ‘æƒ³æ›´æ”¹å¯†é’¥ä»¥ä¸æ—¶è®¿é—®æ³¨å†Œè¡¨ã€‚ ç»“æœï¼Œ <b>æ‰‹åŠ¨æ“ä½œ</b>ä½œä¸ºè§£å†³æ–¹æ¡ˆæ˜¯<b>å®Œå…¨æ— æ•ˆçš„</b> -æ‚¨éœ€è¦è‡ªåŠ¨åˆ›å»ºå’Œæ›´æ–°æœºå¯†ã€‚ <br><br><h3> æ˜“äºè‡ªåŠ¨åŒ– </h3><br> æˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªShellè„šæœ¬ï¼Œè¯¥è„šæœ¬æ¯Nç§’è¿è¡Œä¸€æ¬¡ï¼Œå¹¶æ£€æŸ¥åç§°ç©ºé—´ä¸­çš„ç§˜å¯†ï¼Œå¦‚æœæ²¡æœ‰ç§˜å¯†ï¼Œåˆ™å°†åˆ›å»ºè¯¥ç§˜å¯†ã€‚ è¯¥è§£å†³æ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯ï¼Œå®ƒçœ‹èµ·æ¥åƒcronä¸­çš„shellè„šæœ¬-ä¸€ç§ç»å…¸ä¸”æ˜“äºç†è§£çš„æ–¹æ³•ã€‚ ç¼ºç‚¹æ˜¯ï¼Œåœ¨ä¸¤æ¬¡å¯åŠ¨ä¹‹é—´å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„å‘½åç©ºé—´ï¼Œå¹¶ä¸”åœ¨ä¸€æ®µæ—¶é—´å†…å®ƒå°†ä¿æŒç§˜å¯†çŠ¶æ€ï¼Œè¿™å°†å¯¼è‡´å¯åŠ¨Podæ—¶å‡ºé”™ã€‚ <br><br><h3> ä½¿ç”¨Shell-operatorè¿›è¡Œè‡ªåŠ¨åŒ– </h3><br> ä¸ºäº†ä½¿è„šæœ¬æ­£å¸¸å·¥ä½œï¼Œç»å…¸çš„cronå¯åŠ¨éœ€è¦æ›¿æ¢ä¸ºæ·»åŠ äº†äº‹ä»¶åç§°ç©ºé—´çš„å¯åŠ¨ï¼šåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥è®¾æ³•åœ¨ä½¿ç”¨ç§˜å¯†ä¹‹å‰åˆ›å»ºä¸€ä¸ªç§˜å¯†ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨shell-operatoræ¥å®ç°è¿™ä¸€ç‚¹ã€‚ <br><br> é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ†æè„šæœ¬ã€‚ ç”¨shell-operatorå‘½åçš„è„šæœ¬ç§°ä¸ºé’©å­ã€‚ å¯åŠ¨æ—¶æ¯ä¸ªå¸¦æœ‰<code>--config</code>æ ‡å¿—çš„é’©å­éƒ½ä¼šå‘Šè¯‰Shellæ“ä½œå‘˜æœ‰å…³å…¶ç»‘å®šçš„ä¿¡æ¯ï¼Œå³ é€šè¿‡ä»€ä¹ˆäº‹ä»¶éœ€è¦å¯åŠ¨å®ƒã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code>onKubernetesEvent</code> ï¼š <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash if [[ $1 == "--config" ]] ; then cat &lt;&lt;EOF { "onKubernetesEvent": [ { "kind": "namespace", "event":["add"] } ]} EOF fi</span></span></code> </pre> <br> è¿™é‡Œæè¿°çš„æ˜¯ï¼Œæˆ‘ä»¬å¯¹æ·»åŠ ï¼ˆ <code>add</code> ï¼‰ <code>namespace</code>ç±»å‹çš„å¯¹è±¡çš„äº‹ä»¶æ„Ÿå…´è¶£ã€‚ <br><br> ç°åœ¨ï¼Œæ‚¨éœ€è¦æ·»åŠ äº‹ä»¶å‘ç”Ÿæ—¶å°†æ‰§è¡Œçš„ä»£ç ï¼š <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash if [[ $1 == "--config" ]] ; then #  cat &lt;&lt;EOF { "onKubernetesEvent": [ { "kind": "namespace", "event":["add"] } ]} EOF else # : # ,  namespace  createdNamespace=$(jq -r '.[0].resourceName' $BINDING_CONTEXT_PATH) #      kubectl create -n ${createdNamespace} -f - &lt;&lt;EOF apiVersion: v1 kind: Secret metadata: ... data: ... EOF fi</span></span></code> </pre> <br> å¤ªå¥½äº†ï¼ ç»“æœæ˜¯ä¸€ä¸ªå°çš„ï¼Œæ¼‚äº®çš„è„šæœ¬ã€‚ è¦â€œæ¢å¤â€ï¼Œå‰©ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼šå‡†å¤‡æ˜ åƒå¹¶åœ¨é›†ç¾¤ä¸­è¿è¡Œã€‚ <br><br><h4> ç”¨æŒ‚é’©å‡†å¤‡å›¾åƒ </h4><br> å¦‚æœçœ‹ä¸€ä¸‹è„šæœ¬ï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†<code>kubectl</code>å’Œ<code>jq</code> ã€‚ è¿™æ„å‘³ç€è¯¥æ˜ åƒå¿…é¡»å…·æœ‰ä»¥ä¸‹å†…å®¹ï¼šæˆ‘ä»¬çš„é’©å­ï¼Œä¸€ä¸ªå°†ç›‘è§†äº‹ä»¶å¹¶å¯åŠ¨è¯¥é’©å­çš„shellè¿ç®—ç¬¦ï¼Œä»¥åŠè¯¥é’©å­ä½¿ç”¨çš„å‘½ä»¤ï¼ˆkubectlå’Œjqï¼‰ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Hub.docker.com</a>å·²ç»æœ‰ä¸€ä¸ªç°æˆçš„æ˜ åƒï¼Œå…¶ä¸­æ‰“åŒ…äº†shell-operatorï¼Œkubectlå’Œjqã€‚ ä»ç„¶å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„<code>Dockerfile</code>æ·»åŠ é’©å­ï¼š <br><br><pre> <code class="plaintext hljs">$ cat Dockerfile FROM flant/shell-operator:v1.0.0-beta.1-alpine3.9 ADD namespace-hook.sh /hooks $ docker build -t registry.example.com/my-operator:v1 . $ docker push registry.example.com/my-operator:v1</code> </pre> <br><h4> é›†ç¾¤å¯åŠ¨ </h4><br> å†æ¬¡è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æŒ‚é’©ï¼Œè¿™ä¸€æ¬¡å†™å‡ºé›†ç¾¤ä¸­å®ƒå°†æ‰§è¡Œå“ªäº›æ“ä½œä»¥åŠæ‰§è¡Œå“ªäº›å¯¹è±¡ï¼š <br><br><ol><li> è®¢é˜…åç§°ç©ºé—´äº‹ä»¶ </li><li> åœ¨è¿è¡Œä½ç½®ä»¥å¤–çš„åç§°ç©ºé—´ä¸­åˆ›å»ºä¸€ä¸ªæœºå¯†ã€‚ </li></ol><br> äº‹å®è¯æ˜ï¼Œå°†åœ¨å…¶ä¸­å¯åŠ¨æ˜ åƒçš„å®¹å™¨å¿…é¡»å…·æœ‰æ‰§è¡Œè¿™äº›æ“ä½œçš„æƒé™ã€‚ è¿™å¯ä»¥é€šè¿‡åˆ›å»ºè‡ªå·±çš„ServiceAccountæ¥å®Œæˆã€‚ å¿…é¡»ä»¥ClusterRoleå’ŒClusterRoleBindingçš„å½¢å¼è¿›è¡Œè®¸å¯ï¼Œå› ä¸º æˆ‘ä»¬å¯¹æ•´ä¸ªé›†ç¾¤ä¸­çš„å¯¹è±¡æ„Ÿå…´è¶£ã€‚ <br><br>  YAMLä¸­çš„æœ€ç»ˆæè¿°æ˜¯è¿™æ ·çš„ï¼š <br><br><pre> <code class="plaintext hljs">--- apiVersion: v1 kind: ServiceAccount metadata: name: monitor-namespaces-acc --- apiVersion: rbac.authorization.k8s.io/v1beta1 kind: ClusterRole metadata: name: monitor-namespaces rules: - apiGroups: [""] resources: ["namespaces"] verbs: ["get", "watch", "list"] - apiGroups: [""] resources: ["secrets"] verbs: ["get", "list", "create", "patch"] --- apiVersion: rbac.authorization.k8s.io/v1beta1 kind: ClusterRoleBinding metadata: name: monitor-namespaces roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: monitor-namespaces subjects: - kind: ServiceAccount name: monitor-namespaces-acc namespace: example-monitor-namespaces</code> </pre> <br> æ‚¨å¯ä»¥ä»¥ç®€å•çš„Deploymentå½¢å¼è¿è¡Œç»„è£…çš„æ˜ åƒï¼š <br><br><pre> <code class="plaintext hljs">apiVersion: extensions/v1beta1 kind: Deployment metadata: name: my-operator spec: template: spec: containers: - name: my-operator image: registry.example.com/my-operator:v1 serviceAccountName: monitor-namespaces-acc</code> </pre> <br><br> ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œåˆ›å»ºäº†ä¸€ä¸ªå•ç‹¬çš„åç§°ç©ºé—´ï¼Œå°†åœ¨è¯¥åç§°ç©ºé—´ä¸­å¯åŠ¨shellè¿ç®—ç¬¦å¹¶åº”ç”¨åˆ›å»ºçš„æ¸…å•ï¼š <br><br><pre> <code class="plaintext hljs">$ kubectl create ns example-monitor-namespaces $ kubectl -n example-monitor-namespaces apply -f rbac.yaml $ kubectl -n example-monitor-namespaces apply -f deployment.yaml</code> </pre><br><br> å°±æ˜¯è¿™æ ·ï¼šshellè¿ç®—ç¬¦å°†å¯åŠ¨ï¼Œè®¢é˜…åç§°ç©ºé—´åˆ›å»ºäº‹ä»¶å¹¶åœ¨å¿…è¦æ—¶å¯åŠ¨æŒ‚æ¥ã€‚ <br><br><img src="https://habrastorage.org/webt/km/wj/tz/kmwjtzvc6gcy3650i1xdta5apyk.png"><br><br> å› æ­¤ï¼Œä¸€ä¸ª<b>ç®€å•çš„shellè„šæœ¬å˜æˆäº†Kubernetesçš„å®é™…è¿ç®—ç¬¦ï¼Œ</b>å¹¶æˆä¸ºé›†ç¾¤çš„ç»„æˆéƒ¨åˆ†ã€‚ æ‰€æœ‰è¿™äº›-æ— éœ€åœ¨Golangä¸Šå¼€å‘è¿ç®—ç¬¦çš„å¤æ‚è¿‡ç¨‹ï¼š <br><br><img src="https://habrastorage.org/webt/e6/1o/gq/e61ogqseislsnug0nkfyr7apk1y.png"><br><br><div class="spoiler">  <b class="spoiler_title">å…³äºè¿™ä¸ªé—®é¢˜è¿˜æœ‰å¦ä¸€ä¸ªä¾‹è¯...</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/md/af/3s/mdaf3sq9bxbdtuue9oyigwiy63k.png"><br><br>  <i>æˆ‘ä»¬å°†åœ¨ä»¥ä¸‹å‡ºç‰ˆç‰©ä¹‹ä¸€ä¸­æ›´è¯¦ç»†åœ°æ­ç¤ºå…¶å«ä¹‰ã€‚</i>  <i><b>æ›´æ–°</b> ï¼ˆ2019å¹´5æœˆ1æ—¥ï¼‰ï¼šè¯·å‚é˜…â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ‰©å±•å’Œæ‰©å±•Kubernetesï¼ˆå®¡é˜…å’Œè§†é¢‘æŠ¥å‘Šï¼‰</a> â€ã€‚</i> </div></div><br><h2> ç­›é€‰ </h2><br> è·Ÿè¸ªå¯¹è±¡æ˜¯å¾ˆå¥½çš„æ–¹æ³•ï¼Œä½†æ˜¯é€šå¸¸éœ€è¦å¯¹<b>å¯¹è±¡æŸäº›å±æ€§çš„æ›´æ”¹</b>åšå‡ºå“åº”ï¼Œä¾‹å¦‚ï¼Œå¯¹Deploymentä¸­å‰¯æœ¬æ•°çš„æ›´æ”¹æˆ–å¯¹è±¡æ ‡ç­¾çš„æ›´æ”¹åšå‡ºå“åº”ã€‚ <br><br> å½“äº‹ä»¶åˆ°è¾¾æ—¶ï¼Œshellè¿ç®—ç¬¦å°†æ¥æ”¶å¯¹è±¡çš„JSONæ¸…å•ã€‚ æ‚¨å¯ä»¥åœ¨æ­¤JSONä¸­é€‰æ‹©æˆ‘ä»¬æ„Ÿå…´è¶£çš„å±æ€§ï¼Œå¹¶<b>ä»…</b>åœ¨å®ƒä»¬æ›´æ”¹æ—¶è¿è¡Œè¯¥æŒ‚é’©ã€‚ ä¸ºæ­¤ï¼Œæä¾›äº†<code>jqFilter</code>å­—æ®µï¼Œæ‚¨éœ€è¦åœ¨å…¶ä¸­æŒ‡å®šå°†åº”ç”¨äºJSONæ¸…å•çš„jqè¡¨è¾¾å¼ã€‚ <br><br> ä¾‹å¦‚ï¼Œè¦å“åº”Deploymentå¯¹è±¡ä¸Šçš„æ ‡ç­¾æ›´æ”¹ï¼Œæ‚¨éœ€è¦ä»<code>metadata</code>å­—æ®µä¸­è¿‡æ»¤<code>labels</code>å­—æ®µã€‚ é…ç½®å°†æ˜¯è¿™æ ·çš„ï¼š <br><br><pre> <code class="bash hljs">cat &lt;&lt;EOF { <span class="hljs-string"><span class="hljs-string">"onKubernetesEvent"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"kind"</span></span>: <span class="hljs-string"><span class="hljs-string">"deployment"</span></span>, <span class="hljs-string"><span class="hljs-string">"event"</span></span>:[<span class="hljs-string"><span class="hljs-string">"update"</span></span>], <span class="hljs-string"><span class="hljs-string">"jqFilter"</span></span>: <span class="hljs-string"><span class="hljs-string">".metadata.labels"</span></span> } ]} EOF</code> </pre> <br>  jqFilterä¸­çš„æ­¤è¡¨è¾¾å¼å°†Deploymentçš„é•¿JSONæ¸…å•è½¬æ¢ä¸ºå¸¦æœ‰æ ‡ç­¾çš„çŸ­JSONï¼š <br><br><img src="https://habrastorage.org/webt/pk/o7/hv/pko7hvuzfnn7nziubhfpuo0cas0.png"><br><br> ä»…å½“æ­¤ç®€çŸ­çš„JSONæ›´æ”¹å’Œå¯¹å…¶ä»–å±æ€§çš„æ›´æ”¹è¢«å¿½ç•¥æ—¶ï¼Œshellè¿ç®—ç¬¦æ‰ä¼šè§¦å‘é’©å­ã€‚ <br><br><h2> æŒ‚é’©å¯åŠ¨ä¸Šä¸‹æ–‡ </h2><br> é’©å­é…ç½®å…è®¸æ‚¨ä¸ºäº‹ä»¶æŒ‡å®šå‡ ä¸ªé€‰é¡¹-ä¾‹å¦‚ï¼Œæ¥è‡ªKubernetesçš„äº‹ä»¶çš„2ä¸ªé€‰é¡¹å’Œ2ä¸ªæ—¶é—´è¡¨ï¼š <br><br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"onKubernetesEvent"</span></span>:[ {<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"OnCreatePod"</span></span>, <span class="hljs-string"><span class="hljs-string">"kind"</span></span>: <span class="hljs-string"><span class="hljs-string">"pod"</span></span>, <span class="hljs-string"><span class="hljs-string">"event"</span></span>:[<span class="hljs-string"><span class="hljs-string">"add"</span></span>] }, {<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"OnModifiedNamespace"</span></span>, <span class="hljs-string"><span class="hljs-string">"kind"</span></span>: <span class="hljs-string"><span class="hljs-string">"namespace"</span></span>, <span class="hljs-string"><span class="hljs-string">"event"</span></span>:[<span class="hljs-string"><span class="hljs-string">"update"</span></span>], <span class="hljs-string"><span class="hljs-string">"jqFilter"</span></span>: <span class="hljs-string"><span class="hljs-string">".metadata.labels"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"schedule"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"every 10 min"</span></span>, <span class="hljs-string"><span class="hljs-string">"crontab"</span></span>:<span class="hljs-string"><span class="hljs-string">"0 */10 * * * *"</span></span> }, {<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"on Mondays at 12:10"</span></span>, <span class="hljs-string"><span class="hljs-string">"crontab"</span></span>: <span class="hljs-string"><span class="hljs-string">"0 10 12 * * 1"</span></span> ]}</code> </pre> <br>  <i>æœ‰ç‚¹é¢˜å¤–è¯ï¼šæ˜¯çš„ï¼Œshell-operatoræ”¯æŒ<b>è¿è¡Œcrontabæ ·å¼çš„è„šæœ¬</b> ã€‚</i>  <i>æ‚¨å¯ä»¥åœ¨<a href="">æ–‡æ¡£ä¸­</a>é˜…è¯»æ›´å¤š<a href="">å†…å®¹</a> ã€‚</i> <br><br> ä¸ºäº†åŒºåˆ†ä¸ºä»€ä¹ˆå¯åŠ¨é’©å­ï¼Œshellæ“ä½œå‘˜åˆ›å»ºäº†ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œå¹¶å°†å…¶è·¯å¾„ä¼ é€’ç»™<code>BINDING_CONTEXT_TYPE</code>å˜é‡ä¸­çš„<code>BINDING_CONTEXT_TYPE</code> ã€‚ è¯¥æ–‡ä»¶åŒ…å«æŒ‚é’©å¯åŠ¨åŸå› çš„JSONæè¿°ã€‚ ä¾‹å¦‚ï¼Œæ¯10åˆ†é’Ÿï¼Œä¸€ä¸ªé’©å­å°†ä»ä»¥ä¸‹å†…å®¹å¼€å§‹ï¼š <br><br><pre> <code class="plaintext hljs">[{ "binding": "every 10 min"}]</code> </pre> <br>  ...å¹¶åœ¨å‘¨ä¸€å¼€å§‹ï¼š <br><br><pre> <code class="plaintext hljs">[{ "binding": "every 10 min"}, { "binding": "on Mondays at 12:10"}]</code> </pre> <br> å¯¹äº<code>onKubernetesEvent</code>å°†æœ‰æ›´å¤šçš„JSONè§¦å‘ï¼Œå› ä¸º å®ƒåŒ…å«å¯¹è±¡çš„æè¿°ï¼š <br><br><pre> <code class="plaintext hljs">[ { "binding": "onCreatePod", "resourceEvent": "add", "resourceKind": "pod", "resourceName": "foo", "resourceNamespace": "bar" } ]</code> </pre> <br> å­—æ®µçš„å†…å®¹å¯ä»¥ä»å®ƒä»¬çš„åç§°ä¸­äº†è§£ï¼Œå¹¶ä¸”å¯ä»¥æ›´è¯¦ç»†åœ°é˜…è¯»<a href="">æ–‡æ¡£</a>ä¸­çš„<a href="">å†…å®¹</a> ã€‚ åœ¨å¤åˆ¶æœºå¯†çš„æŒ‚é’©ä¸­ï¼Œå·²ç»æ˜¾ç¤ºäº†ä½¿ç”¨jqä»<code>resourceName</code>å­—æ®µè·å–èµ„æºåç§°çš„ç¤ºä¾‹ï¼š <br><br><pre> <code class="bash hljs">jq -r <span class="hljs-string"><span class="hljs-string">'.[0].resourceName'</span></span> <span class="hljs-variable"><span class="hljs-variable">$BINDING_CONTEXT_PATH</span></span></code> </pre> <br> åŒæ ·ï¼Œæ‚¨å¯ä»¥è·å–å…¶ä½™å­—æ®µã€‚ <br><br><h2> æ¥ä¸‹æ¥æ˜¯ä»€ä¹ˆï¼Ÿ </h2><br> åœ¨é¡¹ç›®å­˜å‚¨åº“ä¸­<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çš„/ examplesç›®å½•ä¸­</a> ï¼Œæœ‰å¯ä»¥åœ¨ç¾¤é›†ä¸­è¿è¡Œçš„æŒ‚é’©ç¤ºä¾‹ã€‚ ç¼–å†™é’©å­æ—¶ï¼Œå¯ä»¥å°†å…¶ä½œä¸ºåŸºç¡€ã€‚ <br><br> æ”¯æŒä½¿ç”¨Prometheusæ”¶é›†æŒ‡æ ‡-å¯ç”¨çš„æŒ‡æ ‡å†™åœ¨<a href="">METRICS</a>éƒ¨åˆ†ä¸­ã€‚ <br><br> æ‚¨å¯èƒ½ä¼šçŒœåˆ°ï¼Œshellè¿ç®—ç¬¦æ˜¯ç”¨Goç¼–å†™çš„ï¼Œå¹¶åœ¨å¼€æ”¾æºä»£ç è®¸å¯ï¼ˆApache 2.0ï¼‰ä¸‹åˆ†å‘ã€‚ å¯¹äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨GitHub</a>ä¸Šå¼€å‘<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é¡¹ç›®çš„</a>ä»»ä½•å¸®åŠ©ï¼Œæˆ‘ä»¬å°†ä¸èƒœæ„Ÿæ¿€ï¼šæ˜Ÿå·ï¼Œé—®é¢˜å’Œè¯·æ±‚è¯·æ±‚ã€‚ <br><br> æ­å¼€ä¿å¯†çš„é¢çº±ï¼Œæˆ‘ä»¬è¿˜å‘ŠçŸ¥shellæ“ä½œç³»ç»Ÿä»…æ˜¯æˆ‘ä»¬ç³»ç»Ÿçš„ä¸€<b>å°</b>éƒ¨åˆ†ï¼Œå®ƒå¯ä»¥ä½¿Kubernetesé›†ç¾¤ä¸­å®‰è£…çš„é™„åŠ ç»„ä»¶ä¿æŒæœ€æ–°çŠ¶æ€ï¼Œå¹¶æ‰§è¡Œå„ç§è‡ªåŠ¨æ“ä½œã€‚ æˆ‘ä»¬åœ¨å‘¨ä¸€äºåœ£å½¼å¾—å ¡çš„HighLoad ++ 2019ä¸Šæ›´è¯¦ç»†åœ°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è®¨è®º</a>äº†è¯¥ç³»ç»Ÿ-è¯¥æŠ¥å‘Šçš„è§†é¢‘å’Œæˆç»©å•å°†å¾ˆå¿«å‘å¸ƒã€‚ <br><br> æˆ‘ä»¬è®¡åˆ’å¼€æ”¾è¯¥ç³»ç»Ÿçš„å…¶ä½™éƒ¨åˆ†ï¼šaddon-operatorä»¥åŠæˆ‘ä»¬çš„é’©å­å’Œæ¨¡å—é›†åˆã€‚ é¡ºä¾¿è¯´ä¸€å¥ï¼Œaddon-operatorå·²ç»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨GitHubä¸Šå¯ç”¨</a> ï¼Œä½†æ˜¯æœ‰å…³å®ƒçš„æ–‡æ¡£ä»åœ¨å¼€å‘ä¸­ã€‚ è®¡åˆ’åœ¨å¤å­£å‘å¸ƒæ¨¡å—é›†åˆã€‚ <br><br> æ•¬è¯·æœŸå¾…ï¼ <br><br><h2> èšè‹¯ä¹™çƒ¯ </h2><br> å¦è¯·å‚é˜…æˆ‘ä»¬çš„åšå®¢ï¼š <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‡†å¤‡Kubernetesé›†ç¾¤æ˜¯å¦ç®€å•æ–¹ä¾¿ï¼Ÿ</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®£å¸ƒæ’ä»¶æ“ä½œå‘˜</a> â€ï¼› </li><li>  â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ‰©å±•å’Œè¡¥å……Kubernetesï¼ˆå®¡æŸ¥å’Œè§†é¢‘æŠ¥å‘Šï¼‰</a> â€ï¼› </li><li>  â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kubernetesçš„æ“ä½œå‘˜ï¼šå¦‚ä½•è¿è¡Œæœ‰çŠ¶æ€çš„åº”ç”¨ç¨‹åº</a> â€ï¼› </li><li>  â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸ºGrafanaå¼•å…¥æ–°çš„æ’ä»¶-Statusmapé¢æ¿</a> â€ï¼› </li><li>  â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»‹ç»æ—¥å¿—ä»“åº“-ä¸€ä¸ªç”¨äºåœ¨Kubernetesä¸­å¤„ç†æ—¥å¿—çš„å¼€æºç³»ç»Ÿ</a> â€ï¼› </li><li>  â€œæˆ‘ä»¬<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­£å¼æ¨å‡ºäº†ç”¨äºç»´æŠ¤CI / CDçš„dapp-DevOpså®ç”¨ç¨‹åº</a> ã€‚â€ </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN447442/">https://habr.com/ru/post/zh-CN447442/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN447430/index.html">IntelliJ IDEA 2019.1ï¼šæ¥å£ä¸»é¢˜çš„è‡ªå®šä¹‰ï¼Œæ¥è‡ªJava 12çš„åˆ‡æ¢è¡¨è¾¾å¼ï¼Œåœ¨Dockerå®¹å™¨å†…è°ƒè¯•</a></li>
<li><a href="../zh-CN447434/index.html">å¾—ç›ŠäºStepikçš„çˆ±ï¼šHyperskillæ•™è‚²å¹³å°</a></li>
<li><a href="../zh-CN447436/index.html">ç½‘ç»œç ”è®¨ä¼šâ€œæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦æµ‹è¯•äººå‘˜ï¼Ÿâ€</a></li>
<li><a href="../zh-CN447438/index.html">å•å…ƒæµ‹è¯•å’ŒæŠ½è±¡æµ‹è¯•</a></li>
<li><a href="../zh-CN447440/index.html">æ·±å…¥äº†è§£RBKmoneyä»˜æ¬¾-ä»˜æ¬¾å¹³å°çš„é€»è¾‘</a></li>
<li><a href="../zh-CN447446/index.html">IBMç ”è®¨ä¼šï¼š2019å¹´æ˜¥å¤-äººå·¥æ™ºèƒ½ï¼Œäº‘å¼€å‘ï¼ŒèŠå¤©æœºå™¨äººï¼ŒåŒºå—é“¾å’Œå…¶ä»–æŠ€æœ¯</a></li>
<li><a href="../zh-CN447448/index.html">æ™ºåŠ›è¿›åŒ–ï¼šå¼€å§‹</a></li>
<li><a href="../zh-CN447450/index.html">ç”¨Ghidraæ‰“ç ´ç®€å•çš„â€œè£‚ç¼â€-ç¬¬1éƒ¨åˆ†</a></li>
<li><a href="../zh-CN447452/index.html">ä¾›åº”é“¾å®‰å…¨ï¼šâ€œå¦‚æœæˆ‘æ˜¯ä¸€ä¸ªæ°‘æ—å›½å®¶â€¦â€¦â€</a></li>
<li><a href="../zh-CN447454/index.html">FPGAä¸ƒæ®µæ˜¾ç¤ºæ§åˆ¶</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>