<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤶 🌒 🦕 Kubernetes软件包管理器实用介绍-Helm 👐 🥩 👊🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="这篇文章是我们最近关于Kubernetes- Helm的程序包管理器历史的出版物的合乎逻辑的延续。 这次，我们将再次解决当前Helm（ 2.x版 ）及其托管图表和存储库的设备和功能问题，之后我们将继续练习在Kubernetes集群中安装Helm并使用图表的实践。 

 参赛作品 
 Helm是一个图...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kubernetes软件包管理器实用介绍-Helm</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/420437/"><img src="https://habrastorage.org/webt/ff/1x/js/ff1xjsnvdlnfinirlwb-0p42tlo.png"><br><br> 这篇文章是我们<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">最近</a>关于Kubernetes- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b>Helm</b></a>的程序包管理器历史的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">出版物</a>的合乎逻辑的延续。 这次，我们将再次解决当前Helm（ <b>2.x版</b> ）及其托管图表和存储库的设备和功能问题，之后我们将继续练习在Kubernetes集群中安装Helm并使用图表的实践。 <a name="habracut"></a><br><br><h2> 参赛作品 </h2><br>  <b>Helm是一个图表管理工具。</b> <br><br>  <b>该图表</b>描述了在Kubernetes集群中实例化应用程序所需的数据集。 它可以具有嵌入式图表，并且既可以用来描述由许多相关资源组成的成熟服务，也可以用来描述各个独立的组件。 例如， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">稳定的/ gitlab-ce</a>图表<a href="">使用</a>独立的redis和postgresql图表描述了完整的解决方案。 <br><br> 可以在同一群集中无限次数地设置图表。 因此，在不同环境中的应用程序推出逻辑的描述可以并且应该存储在同一张图表上。 <br><br>  Helm的客户端负责创建图表，并将<b>Tiller</b>组件与用户参数一起传输到Kubernetes集群。 反过来，Tiller负责已发布图表实例发布的生命周期。  <i>（以防万一，让我提醒您，Helm的下一个重大更新-版本3-将不再具有Tiller。）</i> <br><br> 现在-首先是第一件事。 <br><br><h2> 安装与升级 </h2><br> 头盔需要Kubernetes才能工作。 您可以使用本地安装的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Minikube</a> <i>（另请参见“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用Minikube的Kubernetes入门</a> ”）</i>或任何其他可用群集。 <br><br> 让我们从安装客户端开始：选择<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">发行版</a> ，下载并解压缩系统的档案，传输可执行文件... <br><br><pre><code class="bash hljs">$ curl https://storage.googleapis.com/kubernetes-helm/helm-v2.10.0-linux-amd64.tar.gz | tar -zxv $ sudo mv linux-amd64/helm /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/helm</code> </pre> <br> 接下来，在群集中安装Tiller。 默认情况下，Tiller安装在<b><code>kube-system</code>命名空间</b>的<b><code>kubectl</code>上下文<code>kubectl</code></b> （ <code>kubectl config current-context</code> ）中，但是可以使用适当的选项和环境变量对其进行更改-它们在help（ <code>helm init --help</code> ）中进行了描述。 让我们完成安装并查看集群中创建的资源： <br><br><pre> <code class="bash hljs">$ helm init <span class="hljs-variable"><span class="hljs-variable">$HELM_HOME</span></span> has been configured at /home/habr/.helm. (Use --client-only to suppress this message, or --upgrade to upgrade Tiller to the current version.) Happy Helming! $ kubectl get all --selector=name=tiller --namespace kube-system NAME READY STATUS RESTARTS AGE po/tiller-deploy-df4fdf55d-h5mvh 0/1 Running 0 5s NAME CLUSTER-IP EXTERNAL-IP PORT(S) AGE svc/tiller-deploy 10.107.191.68 &lt;none&gt; 44134/TCP 5s NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE deploy/tiller-deploy 1 1 1 0 5s NAME DESIRED CURRENT READY AGE rs/tiller-deploy-df4fdf55d 1 1 0 5s</code> </pre><br> 现在，Tiller已安装在集群中，并且可以进行发布管理以及与Kubernetes API的交互。 <br><br>  <i><b>注意</b> ：在Tiller的安装和升级（选项<code>--upgrade</code> ）期间，您可以<b>指定特定的映像，</b>而不是默认使用最新的稳定版本。</i>  <i>任意图像的名称由<code>--tiller-image</code>选项确定，并且与<code>--canary-image</code>选项一起使用，当Tiller推出时，将使用<code>--canary-image</code> 。</i>  <i>Canary映像允许您使用Tiller，其代码版本对应于master分支。</i> <br><br> 服务数据存储在群集中的特殊资源<code>ConfigMaps</code> ，因此，卸载和重新安装Tiller不会导致以前安装的版本中的数据丢失。 <br><br><h2> 图表储存库 </h2><br> 图表存储库-用于存储和分发图表的HTTP服务器。 有关存储库中图表的信息存储在<code>index.yaml</code>文件中。 它还指示可以从何处加载每个图表。 大多数情况下，这些图表与<code>index.yaml</code>文件一起存储，但是没有什么阻止它们被放置在另一台服务器上的。 通常，文件结构可以归结为平面形式： <br><br><pre> <code class="bash hljs">. ├── index.yaml ├── artifactory-7.3.0.tgz ├── docker-registry-1.5.2.tgz ... └── wordpress-2.1.10.tgz</code> </pre><br> 默认情况下，Helm使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">官方Kubernetes图表存储库</a> 。 它包含精心设计的当前图表，用于解决许多应用问题。 该存储库称为<b>稳定</b>库： <br><br><pre> <code class="bash hljs">$ helm repo list NAME URL stable https://kubernetes-charts.storage.googleapis.com</code> </pre><br> 如有必要， <b>创建</b>自己的存储库不会有任何问题。 服务器要求最低，因此，像大多数公共图表存储库一样，它可以托管在GitHub Pages上。 您可以在<a href="">文档中</a>阅读有关工具的更多信息以及必要的步骤。 <br><br> 使用图表存储库时，可以添加和删除它们。 为了使图表版本为最新，您必须定期更新索引。 我将举一个公共<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">bitnami</a>存储库的示例，其中大多数图表在官方Helm存储库中使用： <br><br><pre> <code class="bash hljs">$ helm repo add bitnami https://charts.bitnami.com/bitnami <span class="hljs-string"><span class="hljs-string">"bitnami"</span></span> has been added to your repositories $ helm repo update Hang tight <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> we grab the latest from your chart repositories... ...Successfully got an update from the <span class="hljs-string"><span class="hljs-string">"bitnami"</span></span> chart repository ...Successfully got an update from the <span class="hljs-string"><span class="hljs-string">"stable"</span></span> chart repository Update Complete. Happy Helming! $ helm repo remove bitnami <span class="hljs-string"><span class="hljs-string">"bitnami"</span></span> has been removed from your repositories</code> </pre><br> 下一步- <b>搜索</b>存储库。 不带参数的<code>helm search</code>显示所有可用图表： <br><br><pre> <code class="bash hljs">$ helm search NAME CHART VERSION APP VERSION DESCRIPTION stable/acs-engine-autoscaler 2.2.0 2.1.1 Scales worker nodes within agent pools stable/aerospike 0.1.7 v3.14.1.2 A Helm chart <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Aerospike <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Kubernetes stable/anchore-engine 0.2.1 0.2.4 Anchore container analysis and policy evaluation engine s... stable/apm-server 0.1.0 6.2.4 The server receives data from the Elastic APM agents and ... stable/ark 1.2.1 0.9.1 A Helm chart <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ark stable/artifactory 7.3.0 6.1.0 Universal Repository Manager supporting all major packagi... ... stable/weave-cloud 0.2.2 0.2.0 Weave Cloud is a add-on to Kubernetes <span class="hljs-built_in"><span class="hljs-built_in">which</span></span> provides Cont... stable/weave-scope 0.9.3 1.6.5 A Helm chart <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the Weave Scope cluster visualizer. stable/wordpress 2.1.10 4.9.8 Web publishing platform <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> building blogs and websites. stable/xray 0.4.1 2.3.0 Universal component scan <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> security and license invento... stable/zeppelin 1.0.1 0.7.2 Web-based notebook that enables data-driven, interactive ... stable/zetcd 0.1.9 0.0.3 CoreOS zetcd Helm chart <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Kubernetes</code> </pre><br> 在<code>Chart.yaml</code>的可选<code>keywords</code>字段中<code>Chart.yaml</code>开发人员指定用于简化图表存储库中搜索的标记： <br><br><pre> <code class="bash hljs">$ helm search web NAME CHART VERSION APP VERSION DESCRIPTION stable/cerebro 0.3.1 0.8.1 A Helm chart <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Cerebro - a web admin tool that replaces... stable/chronograf 0.4.5 1.3 Open-source web application written <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Go and React.js th... stable/jasperreports 2.0.4 7.1.0 The JasperReports server can be used as a stand-alone or ... stable/joomla 2.0.9 3.8.12 PHP content management system (CMS) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> publishing web co... stable/kubernetes-dashboard 0.7.2 1.8.3 General-purpose web UI <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Kubernetes clusters stable/odoo 2.0.7 11.0.20180815 A suite of web based open <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> business apps. stable/phabricator 2.1.9 2018.34.0 Collection of open <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> web applications that <span class="hljs-built_in"><span class="hljs-built_in">help</span></span> soft... stable/redmine 4.1.0 3.4.6 A flexible project management web application. stable/rethinkdb 0.1.4 0.1.0 The open-source database <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the realtime web stable/schema-registry-ui 0.1.0 v0.9.4 This is a web tool <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the confluentinc/schema-registry i... stable/superset 0.1.2 0.24.0 Apache Superset (incubating) is a modern, enterprise-read... stable/testlink 2.0.3 1.9.17 Web-based <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> management system that facilitates softwar... stable/tomcat 0.1.0 7 Deploy a basic tomcat application server with sidecar as ... stable/wordpress 2.1.10 4.9.8 Web publishing platform <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> building blogs and websites. ... $ helm search cms blog NAME CHART VERSION APP VERSION DESCRIPTION stable/drupal 1.1.3 8.5.6 One of the most versatile open <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> content management ... stable/joomla 2.0.9 3.8.12 PHP content management system (CMS) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> publishing web co... stable/wordpress 2.1.10 4.9.8 Web publishing platform <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> building blogs and websites</code> </pre> <br>  <i><b>注意：</b>使用<code>helm search</code>命令时，可能会遇到几个过滤器的不稳定操作：结果的可用性取决于指示的顺序和过滤器的数量。</i> <br><br> 将搜索范围缩小到几个选项之后，您可以使用<code>helm inspect</code>命令对图表进行更详细的分析。 它显示图表文件<code>Chart.yaml</code> ， <code>values.yaml</code>和<code>README.md</code> 。 每个部分可以使用相应的参数分别显示： <code>chart</code> ， <code>values</code>和<code>readme</code> 。 <br><br> 在官方存储库中，图表记录精美，包含使用示例，有些图表甚至具有现成的生产配置。 例如， <a href="">稳定/ wordpress</a>提供了一个良好的<code>readme</code> <i>（有关其在控制台中的输出，请参见<code>helm inspect readme stable/wordpress</code> ）</i> 。 <br><br> 搜索是查找负担得起的包裹的好方法。 找到软件包后，可以使用它在群集中安装应用程序。 <br><br><h2> 首次申请 </h2><br> 例如，选择已经提到的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">稳定/ wordpress</a>图表。 <br><br> 它使用<code>values.yaml</code>文件中描述的参数。 您可以覆盖YAML文件中的参数，然后在安装过程中传输该文件（选项<code>-f</code> ，-- <code>--values</code> ）。 此外，可以在命令行上直接覆盖它们（选项<code>--set</code> ，-- <code>--set-string</code>和<code>--set-file</code> ）。 所有选项均可使用任意次数； 同时，在命令行上的覆盖优先于带有参数的文件。 <br><br> 设置图表时，可以使用<code>--name</code>选项设置发布名称，也可以使用Helm生成的随机名称。 <br><br> 设置<a href="">生产配置</a>图，更改博客名称，禁用将WordPress数据保存在<code>PersistentVolumeClaim</code> <i>（有关持久存储的更多信息，请参阅<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kubernetes文档</a> ）</i> ： <br><br><pre> <code class="bash hljs">$ curl https://raw.githubusercontent.com/helm/charts/master/stable/wordpress/values-production.yaml --output values-production.yaml $ helm install --name habr --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-string"><span class="hljs-string">"wordpressBlogName=Flant's Blog!"</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-string"><span class="hljs-string">"persistence.enabled=false"</span></span> -f values-production.yaml stable/wordpress NAME: habr LAST DEPLOYED: Fri Aug 31 15:17:57 2018 NAMESPACE: default STATUS: DEPLOYED RESOURCES: ==&gt; v1/Secret NAME TYPE DATA AGE habr-mariadb Opaque 2 0s habr-wordpress Opaque 2 0s ==&gt; v1/ConfigMap NAME DATA AGE habr-mariadb-init-scripts 1 0s habr-mariadb 1 0s habr-mariadb-tests 1 0s ==&gt; v1/Service NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE habr-mariadb ClusterIP 10.111.7.232 &lt;none&gt; 3306/TCP 0s habr-wordpress ClusterIP 10.106.129.88 &lt;none&gt; 80/TCP,443/TCP 0s ==&gt; v1beta1/Deployment NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE habr-wordpress 3 3 3 0 0s ==&gt; v1beta1/StatefulSet NAME DESIRED CURRENT AGE habr-mariadb 1 1 0s ==&gt; v1beta1/Ingress NAME HOSTS ADDRESS PORTS AGE wordpress.local-habr wordpress.local 80, 443 0s ==&gt; v1/Pod(related) NAME READY STATUS RESTARTS AGE habr-wordpress-7955b95fd-hh7b9 0/1 ContainerCreating 0 0s habr-wordpress-7955b95fd-tgsxk 0/1 ContainerCreating 0 0s habr-wordpress-7955b95fd-xjz74 0/1 ContainerCreating 0 0s habr-mariadb-0 0/1 ContainerCreating 0 0s NOTES: 1. Get the WordPress URL: You should be able to access your new WordPress installation through https://wordpress.local/admin 2. Login with the following credentials to see your blog <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Username: user <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Password: $(kubectl get secret --namespace default habr-wordpress -o jsonpath=<span class="hljs-string"><span class="hljs-string">"{.data.wordpress-password}"</span></span> | base64 --decode)</code> </pre><br> 如果使用成熟的集群，则可以遵循上述<i>NOTES</i>块中的建议。 如果您拥有Minikube，请按照以下步骤在浏览器中打开网站： <br><br><pre> <code class="bash hljs">$ minikube service habr-wordpress Waiting, endpoint <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> service is not ready yet... Opening kubernetes service default/habr-wordpress <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> default browser...</code> </pre> <br> 恭喜，该应用程序处于群集中！ <br><br><img src="https://habrastorage.org/webt/on/bg/ub/onbgubke7d2hntrso3asemt5teq.png"><br><br> 带有WordPress的详细图表出现在所有Helm版本的列表中： <br><br><pre> <code class="bash hljs">$ helm list NAME REVISION UPDATED STATUS CHART APP VERSION NAMESPACE habr 1 Fri Aug 31 15:17:57 2018 DEPLOYED wordpress-2.1.10 4.9.8 default</code> </pre><br> 下一步是更新我们的版本，并通过博客更改图像。 例如，将使用来自相同Docker存储库（ <code>4.9.8-ol-7</code> ）的另一个标签： <br><br><pre> <code class="bash hljs">$ helm upgrade habr --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-string"><span class="hljs-string">"image.tag=4.9.8-ol-7"</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-string"><span class="hljs-string">"wordpressBlogName=Flant's Blog!"</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-string"><span class="hljs-string">"persistence.enabled=false"</span></span> -f values-production.yaml stable/wordpress Release <span class="hljs-string"><span class="hljs-string">"habr"</span></span> has been upgraded. Happy Helming! LAST DEPLOYED: Fri Aug 31 15:21:08 2018 NAMESPACE: default STATUS: DEPLOYED RESOURCES: ==&gt; v1/Service NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE habr-mariadb ClusterIP 10.111.7.232 &lt;none&gt; 3306/TCP 3m habr-wordpress ClusterIP 10.106.129.88 &lt;none&gt; 80/TCP,443/TCP 3m ==&gt; v1beta1/Deployment NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE habr-wordpress 3 4 2 0 3m ==&gt; v1beta1/StatefulSet NAME DESIRED CURRENT AGE habr-mariadb 1 1 3m ==&gt; v1beta1/Ingress NAME HOSTS ADDRESS PORTS AGE wordpress.local-habr wordpress.local 80, 443 3m ==&gt; v1/Pod(related) NAME READY STATUS RESTARTS AGE habr-wordpress-66f4fd6b74-gqwhh 0/1 Pending 0 0s habr-wordpress-66f4fd6b74-mf6vj 0/1 Pending 0 0s habr-wordpress-7955b95fd-hh7b9 1/1 Running 2 3m habr-wordpress-7955b95fd-tgsxk 1/1 Running 2 3m habr-wordpress-7955b95fd-xjz74 0/1 Terminating 2 3m habr-mariadb-0 1/1 Running 0 3m ==&gt; v1/Secret NAME TYPE DATA AGE habr-mariadb Opaque 2 3m habr-wordpress Opaque 2 3m ==&gt; v1/ConfigMap NAME DATA AGE habr-mariadb-init-scripts 1 3m habr-mariadb 1 3m habr-mariadb-tests 1 3m NOTES: 1. Get the WordPress URL: You should be able to access your new WordPress installation through https://wordpress.local/admin 2. Login with the following credentials to see your blog <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Username: user <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Password: $(kubectl get secret --namespace default habr-wordpress -o jsonpath=<span class="hljs-string"><span class="hljs-string">"{.data.wordpress-password}"</span></span> | base64 --decode)</code> </pre><br> 请注意， <b>在更新</b> Tiller时，会将收到的图表与参数与最后保存的图表进行比较，并在Kubernetes API中执行相应的请求，并且<b>不会考虑发布资源</b>的<b>当前状态</b> 。 重要的是要了解此功能并且不要犯错误： <br><br><ul><li> 该更新与安装没有什么不同：Helm客户端将Tiller图表与参数一起发送，因此您需要小心并记住使用在安装过程中（或在上一次更新期间）设置的参数来指定参数和文件，这些参数和文件不应被忽略。 在上面的示例中，这是<code>--set "wordpressBlogName=Flant's Blog!" --set "persistence.enabled=false" -f values-production.yaml</code>  <code>--set "wordpressBlogName=Flant's Blog!" --set "persistence.enabled=false" -f values-production.yaml</code> 。 </li><li> 使用Helm推出的应用程序只能使用Helm进行维护：Helm将不考虑使用<code>kubectl</code>手动更改，并且可能导致不可逆转的后果。 </li></ul><br> 因此，逻辑上的结论是：该<b>过程应该是自动化的</b> ，并且应该仅通过提交到Git存储库，更改图表文件和CI配置文件来执行更改。 <br><br> 始终可以按以下方式检查集群中应用程序发布组件的状态： <br><br><pre> <code class="bash hljs">$ helm status habr LAST DEPLOYED: Fri Aug 31 15:21:08 2018 NAMESPACE: default STATUS: DEPLOYED RESOURCES: ==&gt; v1/Secret NAME TYPE DATA AGE habr-mariadb Opaque 2 4m habr-wordpress Opaque 2 4m ==&gt; v1/ConfigMap NAME DATA AGE habr-mariadb-init-scripts 1 4m habr-mariadb 1 4m habr-mariadb-tests 1 4m ==&gt; v1/Service NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE habr-mariadb ClusterIP 10.111.7.232 &lt;none&gt; 3306/TCP 4m habr-wordpress ClusterIP 10.106.129.88 &lt;none&gt; 80/TCP,443/TCP 4m ==&gt; v1beta1/Deployment NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE habr-wordpress 3 4 2 3 4m ==&gt; v1beta1/StatefulSet NAME DESIRED CURRENT AGE habr-mariadb 1 1 4m ==&gt; v1beta1/Ingress NAME HOSTS ADDRESS PORTS AGE wordpress.local-habr wordpress.local 80, 443 4m ==&gt; v1/Pod(related) NAME READY STATUS RESTARTS AGE habr-wordpress-66f4fd6b74-gqwhh 0/1 Pending 0 1m habr-wordpress-66f4fd6b74-mf6vj 1/1 Running 0 1m habr-wordpress-7955b95fd-hh7b9 1/1 Running 3 4m habr-wordpress-7955b95fd-tgsxk 1/1 Running 3 4m habr-mariadb-0 1/1 Running 1 4m NOTES: 1. Get the WordPress URL: You should be able to access your new WordPress installation through https://wordpress.local/admin 2. Login with the following credentials to see your blog <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Username: user <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Password: $(kubectl get secret --namespace default habr-wordpress -o jsonpath=<span class="hljs-string"><span class="hljs-string">"{.data.wordpress-password}"</span></span> | base64 --decode)</code> </pre><br>  Helm允许您<b>回滚到特定的发行版</b> 。 当前有两个修订： <br><br><pre> <code class="bash hljs">$ helm <span class="hljs-built_in"><span class="hljs-built_in">history</span></span> habr REVISION UPDATED STATUS CHART DESCRIPTION 1 Fri Aug 31 15:17:57 2018 SUPERSEDED wordpress-2.1.10 Install complete 2 Fri Aug 31 15:21:08 2018 DEPLOYED wordpress-2.1.10 Upgrade complete</code> </pre><br> 将应用程序还原到其原始状态： <br><br><pre> <code class="bash hljs">$ helm rollback habr 1 Rollback was a success! Happy Helming!</code> </pre><br> 现在，修订历史记录已补充了一条记录： <br><br><pre> <code class="plaintext hljs">$ helm history habr REVISION UPDATED STATUS CHART DESCRIPTION 1 Fri Aug 31 15:17:57 2018 SUPERSEDED wordpress-2.1.10 Install complete 2 Fri Aug 31 15:21:08 2018 SUPERSEDED wordpress-2.1.10 Upgrade complete 3 Fri Aug 31 15:25:06 2018 DEPLOYED wordpress-2.1.10 Rollback to 1</code> </pre><br> 文章即将结束，不再需要发布吗？ <br><br><pre> <code class="bash hljs">$ helm delete habr release <span class="hljs-string"><span class="hljs-string">"habr"</span></span> deleted</code> </pre><br> 真的删除了吗？ <br><br>  <b>该命令将删除与发行版关联的Kubernetes资源，但不会删除发行版本身</b> 。 有关该版本的所有信息仍然可用，包括其历史记录： <br><br><pre> <code class="bash hljs">$ helm list --all NAME REVISION UPDATED STATUS CHART APP VERSION NAMESPACE habr 3 Fri Aug 31 15:25:06 2018 DELETED wordpress-2.1.10 4.9.8 default</code> </pre><br><pre> <code class="bash hljs">$ helm <span class="hljs-built_in"><span class="hljs-built_in">history</span></span> habr REVISION UPDATED STATUS CHART DESCRIPTION 1 Fri Aug 31 15:17:57 2018 SUPERSEDED wordpress-2.1.10 Install complete 2 Fri Aug 31 15:21:08 2018 SUPERSEDED wordpress-2.1.10 Upgrade complete 3 Fri Aug 31 15:25:06 2018 DELETED wordpress-2.1.10 Deletion complete</code> </pre><br>  <i><b>注意</b> ：按计划，可以将远程发行版回滚到以前的版本，但是在最新版本中，此功能不起作用- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">有关</a>详细信息，请参见<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">问题＃3722</a> 。</i> <br><br> 要完全删除发行版，请使用<code>--purge</code>选项： <br><br><pre> <code class="bash hljs">$ helm delete --purge habr release <span class="hljs-string"><span class="hljs-string">"habr"</span></span> deleted</code> </pre><br><h2> 总结 </h2><br> 本文讨论了Helm 2的基本体系结构，其组件及其功能，以及基本的基元，图表，发行版和图表存储库。 我们在Kubernetes集群中安装了Helm，并了解了发行生命周期和使用它的基本命令。 <br><br> 本系列中的以下材料将专门讨论<b>创建自己的图表</b>的主题-在其中，我将讨论图表的结构，标准化和调试工具。  <b>更新</b> ： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此链接</a>提供了新的文章。 <br><br><h2> 聚苯乙烯 </h2><br><ul><li>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">为带有Helm的Kubernetes创建软件包：图表结构和模板</a> ”； </li><li>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kubernetes的程序包经理-Helm：过去，现在，将来</a> ”； </li><li>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">练习dapp。</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第2部分。使用Helm在Kubernetes中部署Docker映像</a> ”； </li><li>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用dapp和GitLab CI在Kubernetes中构建和安装应用程序</a> ”； </li><li>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用Kubernetes和GitLab的最佳CI / CD实践</a> ” <i>（审查和视频报告）</i> 。 </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN420437/">https://habr.com/ru/post/zh-CN420437/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN420425/index.html">使用HBase的理论与实践</a></li>
<li><a href="../zh-CN420429/index.html">USE，RED，PgBouncer，其设置和监视</a></li>
<li><a href="../zh-CN420431/index.html">火星 家庭主妇地形改造实用指南</a></li>
<li><a href="../zh-CN420433/index.html">“星期五格式”：音乐之路-它是什么以及为什么不在俄罗斯</a></li>
<li><a href="../zh-CN420435/index.html">ARM Mbed快速入门：面向初学者的现代微控制器开发</a></li>
<li><a href="../zh-CN420439/index.html">金融科技摘要：对金融科技的投资达到570亿美元，交易速度不断提高，成本不断下降</a></li>
<li><a href="../zh-CN420441/index.html">Python中最常见的10个安全错误以及如何避免这些错误</a></li>
<li><a href="../zh-CN420443/index.html">网络安全专家创建了一个撇渣器-SkimReaper</a></li>
<li><a href="../zh-CN420447/index.html">计算机历史博物馆-记录IT的地方</a></li>
<li><a href="../zh-CN420451/index.html">云中的服务器：准备启动</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>