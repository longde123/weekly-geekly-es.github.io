<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ˜‘ ğŸ‘©ğŸ¾â€ğŸ­ ğŸ‘©ğŸ¼â€ğŸš’ ä½¿ç”¨Java 8æ–¹æ³•å‚è€ƒæ¨¡æ‹Ÿå±æ€§æ–‡å­— ğŸ‘©ğŸ»â€ğŸ« ğŸŒ¿ ğŸ§£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è¯‘è€…çš„è¯ï¼šJavaä¸­ç¼ºå°‘nameOfè¿ç®—ç¬¦çš„å†’çŠ¯ä¿ƒä½¿æˆ‘ç¿»è¯‘è¿™ç¯‡æ–‡ç« ã€‚ å¯¹äºä¸è€çƒ¦çš„äºº-åœ¨æ–‡ç« ç»“å°¾ï¼Œåœ¨æºä»£ç å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¸­éƒ½æœ‰ä¸€ä¸ªç°æˆçš„å®ç°ã€‚ 

 Javaåº“å¼€å‘äººå‘˜ç»å¸¸ç¼ºå°‘çš„ä¸€ä»¶äº‹æ˜¯å±æ€§æ–‡å­—ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†å±•ç¤ºå¦‚ä½•åˆ›é€ æ€§åœ°ä½¿ç”¨Java 8ä¸­çš„æ–¹æ³•å‚è€ƒæ¥é€šè¿‡å­—èŠ‚ç ç”Ÿæˆæ¥æ¨¡æ‹Ÿå±æ€§æ–‡å­—ã€‚ 

 ç±»ä¼¼äº...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨Java 8æ–¹æ³•å‚è€ƒæ¨¡æ‹Ÿå±æ€§æ–‡å­—</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420533/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/rx/cy/ut/rxcyutfwkaqvjicfkhp78xtv_ts.png"></div><br>  <i>è¯‘è€…çš„è¯ï¼šJavaä¸­ç¼ºå°‘nameOfè¿ç®—ç¬¦çš„å†’çŠ¯ä¿ƒä½¿æˆ‘ç¿»è¯‘è¿™ç¯‡æ–‡ç« ã€‚</i>  <i>å¯¹äºä¸è€çƒ¦çš„äºº-åœ¨æ–‡ç« ç»“å°¾ï¼Œåœ¨æºä»£ç å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¸­éƒ½æœ‰ä¸€ä¸ªç°æˆçš„å®ç°ã€‚</i> <br><br>  Javaåº“å¼€å‘äººå‘˜ç»å¸¸ç¼ºå°‘çš„ä¸€ä»¶äº‹æ˜¯å±æ€§æ–‡å­—ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†å±•ç¤ºå¦‚ä½•åˆ›é€ æ€§åœ°ä½¿ç”¨Java 8ä¸­çš„æ–¹æ³•å‚è€ƒæ¥é€šè¿‡å­—èŠ‚ç ç”Ÿæˆæ¥æ¨¡æ‹Ÿå±æ€§æ–‡å­—ã€‚ <br><br> ç±»ä¼¼äºç±»æ–‡å­—ï¼ˆä¾‹å¦‚<code>Customer.class</code> ï¼‰ï¼Œå±æ€§æ–‡å­—ä½¿å¼•ç”¨ç±»å‹å®‰å…¨çš„Beanç±»çš„å±æ€§æˆä¸ºå¯èƒ½ã€‚ è¿™å¯¹äºè®¾è®¡éœ€è¦å¯¹å±æ€§æ‰§è¡Œæ“ä½œæˆ–ä»¥æŸç§æ–¹å¼é…ç½®å®ƒä»¬çš„APIå¾ˆæœ‰ç”¨ã€‚ <br><br>  <i>æ¥è‡ªè¯‘è€…ï¼šåœ¨å‰Šå‡çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬åˆ†æäº†å¦‚ä½•é€šè¿‡å³å…´æ‰‹æ®µå®ç°è¿™ä¸€ç›®æ ‡ã€‚</i> <br><a name="habracut"></a><br> ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸‹Hibernate Searchä¸­çš„ç´¢å¼•æ˜ å°„é…ç½®APIï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SearchMapping().entity(Address.class) .indexed() .property(<span class="hljs-string"><span class="hljs-string">"city"</span></span>, ElementType.METHOD) .field();</code> </pre><br> æˆ–BeanéªŒè¯APIä¸­çš„<code>validateValue()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä½¿æ‚¨å¯ä»¥å¯¹ç…§å±æ€§é™åˆ¶æ£€æŸ¥å€¼ï¼š <br><br><pre> <code class="java hljs">Set&lt;ConstraintViolation&lt;Address&gt;&gt; violations = validator.validateValue(Address.class, <span class="hljs-string"><span class="hljs-string">"city"</span></span>, <span class="hljs-string"><span class="hljs-string">"Purbeck"</span></span> );</code> </pre><br> åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œéƒ½ä½¿ç”¨<code>String</code>ç±»å‹æ¥å¼•ç”¨<code>Address</code>å¯¹è±¡çš„<code>city</code>å±æ€§ã€‚ <br><br> è¿™å¯èƒ½å¯¼è‡´é”™è¯¯ï¼š <br><ul><li> åœ°å€ç±»å¯èƒ½æ ¹æœ¬æ²¡æœ‰<code>city</code>å±æ€§ã€‚ æˆ–è€…ï¼Œæœ‰äººåœ¨é‡æ„æ—¶é‡å‘½åget / setæ–¹æ³•åå¯èƒ½ä¼šå¿˜è®°æ›´æ–°å±æ€§çš„å­—ç¬¦ä¸²åç§°ã€‚ </li><li> å¯¹äº<code>validateValue()</code> ï¼Œæˆ‘ä»¬æ— æ³•éªŒè¯ä¼ é€’çš„å€¼çš„ç±»å‹ä¸å±æ€§çš„ç±»å‹åŒ¹é…ã€‚ </li></ul><br> ä½¿ç”¨æ­¤APIçš„ç”¨æˆ·åªèƒ½é€šè¿‡å¯åŠ¨åº”ç”¨ç¨‹åºæ¥äº†è§£è¿™äº›é—®é¢˜ã€‚ å¦‚æœç¼–è¯‘å™¨å’Œç±»å‹ç³»ç»Ÿä»ä¸€å¼€å§‹å°±ç¦æ­¢è¿™ç§ç”¨æ³•ï¼Œé‚£ä¼šå¾ˆé…·å—ï¼Ÿ å¦‚æœJavaå…·æœ‰å±æ€§æ–‡å­—ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼ˆæ­¤ä»£ç æ— æ³•ç¼–è¯‘ï¼‰ï¼š <br><br><pre> <code class="java hljs">mapping.entity(Address.class) .indexed() .property(Address::city, ElementType.METHOD ) .field();</code> </pre><br> å¹¶ä¸”ï¼š <br><br><pre> <code class="java hljs">validator.validateValue(Address.class, Address::city, <span class="hljs-string"><span class="hljs-string">"Purbeck"</span></span>);</code> </pre><br> æˆ‘ä»¬å¯ä»¥é¿å…ä¸Šé¢æåˆ°çš„é—®é¢˜ï¼šå±æ€§åç§°ä¸­çš„ä»»ä½•é”™å­—éƒ½ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ï¼Œå¯ä»¥åœ¨æ‚¨çš„IDEä¸­ç›´æ¥æ³¨æ„åˆ°è¯¥é”™è¯¯ã€‚ è¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿè®¾è®¡Hibernate Searché…ç½®APIï¼Œä»¥ä¾¿åœ¨é…ç½®Addresså®ä½“æ—¶ï¼Œå®ƒä»…æ¥å—Addressç±»çš„å±æ€§ã€‚ å¯¹äºBean Validation <code>validateValue()</code>å±æ€§æ–‡å­—å°†æœ‰åŠ©äºç¡®ä¿æˆ‘ä»¬ä¼ é€’çš„æ˜¯æ­£ç¡®ç±»å‹çš„å€¼ã€‚ <br><br><h2>  Java 8æ–¹æ³•å‚è€ƒ </h2><br>  Java 8ä¸æ”¯æŒå±æ€§æ–‡å­—ï¼ˆåœ¨Java 11ä¸­ä¸æ‰“ç®—æ”¯æŒå®ƒä»¬ï¼‰ï¼Œä½†æ˜¯åŒæ—¶ï¼Œå®ƒæä¾›äº†ä¸€ç§æœ‰è¶£çš„æ–¹å¼æ¥æ¨¡æ‹Ÿå®ƒä»¬ï¼šæ–¹æ³•å‚è€ƒï¼ˆæ–¹æ³•å‚è€ƒï¼‰ã€‚ æœ€åˆï¼Œæ·»åŠ äº†æ–¹æ³•å‚è€ƒä»¥ç®€åŒ–lambdaè¡¨è¾¾å¼çš„ä½¿ç”¨ï¼Œä½†æ˜¯å®ƒä»¬å¯ä»¥ç”¨ä½œç©·äººçš„å±æ€§æ–‡å­—ã€‚ <br><br> è€ƒè™‘ä½¿ç”¨å¯¹getteræ–¹æ³•çš„å¼•ç”¨ä½œä¸ºå±æ€§æ–‡å­—çš„æƒ³æ³•ï¼š <br><br><pre> <code class="java hljs">validator.validateValue(Address.class, Address::getCity, <span class="hljs-string"><span class="hljs-string">"Purbeck"</span></span>);</code> </pre><br> æ˜¾ç„¶ï¼Œè¿™åªæœ‰åœ¨æœ‰å¸æ°”å‰‚çš„æƒ…å†µä¸‹æ‰æœ‰æ•ˆã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ‚¨çš„ç±»å·²ç»éµå¾ªJavaBeansçº¦å®šï¼ˆé€šå¸¸æ˜¯è¿™ç§æƒ…å†µï¼‰ï¼Œé‚£å¾ˆå¥½ã€‚ <br><br>  <code>validateValue()</code>æ–¹æ³•çš„å£°æ˜æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ å…³é”®æ˜¯æ–°<code>Function</code>ç±»å‹çš„ä½¿ç”¨ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;T, P&gt; Set&lt;ConstraintViolation&lt;T&gt;&gt; validateValue( Class&lt;T&gt; type, Function&lt;? <span class="hljs-keyword"><span class="hljs-keyword">super</span></span> T, P&gt; property, P value);</code> </pre><br> ä½¿ç”¨ä¸¤ä¸ªé”®å…¥å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥éªŒè¯binç±»å‹ï¼Œå±æ€§å’Œä¼ é€’çš„å€¼æ­£ç¡®ã€‚ ä»APIçš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬æ»¡è¶³äº†æˆ‘ä»¬çš„éœ€æ±‚ï¼šä½¿ç”¨å®‰å…¨ï¼ŒIDEç”šè‡³ä¼šè‡ªåŠ¨è¡¥å……ä»¥<code>Address::</code>å¼€å¤´çš„æ–¹æ³•åç§°ã€‚ ä½†æ˜¯ï¼Œå¦‚ä½•åœ¨<code>validateValue()</code>æ–¹æ³•çš„å®ç°ä¸­ä»<code>Function</code>å¯¹è±¡æ´¾ç”Ÿå±æ€§åç§°ï¼Ÿ <br><br> ç„¶åï¼Œæœ‰è¶£çš„äº‹æƒ…å¼€å§‹äº†ï¼Œå› ä¸ºFunctionåŠŸèƒ½æ¥å£ä»…å£°æ˜äº†ä¸€ä¸ªæ–¹æ³•<code>apply()</code> ï¼Œè¯¥æ–¹æ³•ä¸ºä¼ é€’çš„<code>T</code>å®ä¾‹æ‰§è¡ŒåŠŸèƒ½ä»£ç ã€‚ è¿™ä¼¼ä¹ä¸æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ã€‚ <br><br><h2>  ByteBuddyè¿›è¡Œæ•‘æ´ </h2><br> äº‹å®è¯æ˜ï¼Œè¯€çªåœ¨äºåº”ç”¨è¯¥åŠŸèƒ½ï¼ é€šè¿‡åˆ›å»ºç±»å‹Tçš„ä»£ç†å®ä¾‹ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è°ƒç”¨è¯¥æ–¹æ³•å¹¶åœ¨Proxyè°ƒç”¨å¤„ç†ç¨‹åºä¸­è·å–å…¶åç§°ã€‚  ï¼ˆæ¥è‡ªç¿»è¯‘è€…ï¼šä»¥ä¸‹æˆ‘ä»¬è°ˆè®ºåŠ¨æ€Javaä»£ç†-java.lang.reflect.Proxyï¼‰ã€‚ <br><br>  Javaå¼€ç®±å³ç”¨åœ°æ”¯æŒåŠ¨æ€ä»£ç†ï¼Œä½†æ˜¯è¿™ç§æ”¯æŒä»…é™äºæ¥å£ã€‚ ç”±äºæˆ‘ä»¬çš„APIåº”è¯¥å¯ä»¥ä¸ä»»ä½•beanï¼ˆåŒ…æ‹¬å®é™…ç±»ï¼‰ä¸€èµ·ä½¿ç”¨ï¼Œå› æ­¤æˆ‘å°†ä½¿ç”¨ä¸€ä¸ªå¾ˆæ£’çš„å·¥å…·ByteBuddyä»£æ›¿Proxyã€‚  ByteBuddyæä¾›äº†ä¸€ä¸ªç®€å•çš„DSLï¼Œå¯ä»¥å¿«é€Ÿåˆ›å»ºç±»ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ã€‚ <br><br> è®©æˆ‘ä»¬ä»å®šä¹‰ä¸€ä¸ªæ¥å£å¼€å§‹ï¼Œè¯¥æ¥å£å…è®¸æˆ‘ä»¬å­˜å‚¨å’Œæ£€ç´¢ä»â€œæ–¹æ³•å‚è€ƒâ€ä¸­æå–çš„å±æ€§åç§°ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PropertyNameCapturer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPropertyName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPropertyName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String propertyName)</span></span></span></span>; }</code> </pre> <br> ç°åœ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ByteBuddyä»¥ç¼–ç¨‹æ–¹å¼åˆ›å»ºä¸æˆ‘ä»¬æ„Ÿå…´è¶£çš„ç±»å‹å…¼å®¹çš„ä»£ç†ç±»ï¼ˆä¾‹å¦‚ï¼šAddressï¼‰ï¼Œå¹¶å®ç°<code>PropertyNameCapturer</code> ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;T&gt; T <span class="hljs-comment"><span class="hljs-comment">/* &amp; PropertyNameCapturer */</span></span> getPropertyNameCapturer(Class&lt;T&gt; type) { DynamicType.Builder&lt;?&gt; builder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteBuddy() (<span class="hljs-number"><span class="hljs-number">1</span></span>) .subclass( type.isInterface() ? Object.class : type ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (type.isInterface()) { (<span class="hljs-number"><span class="hljs-number">2</span></span>) builder = builder.implement(type); } Class&lt;?&gt; proxyType = builder .implement(PropertyNameCapturer.class) (<span class="hljs-number"><span class="hljs-number">3</span></span>) .defineField(<span class="hljs-string"><span class="hljs-string">"propertyName"</span></span>, String.class, Visibility.PRIVATE) .method( ElementMatchers.any()) (<span class="hljs-number"><span class="hljs-number">4</span></span>) .intercept(MethodDelegation.to( PropertyNameCapturingInterceptor.class )) .method(named(<span class="hljs-string"><span class="hljs-string">"setPropertyName"</span></span>).or(named(<span class="hljs-string"><span class="hljs-string">"getPropertyName"</span></span>))) (<span class="hljs-number"><span class="hljs-number">5</span></span>) .intercept(FieldAccessor.ofBeanProperty()) .make() .load( (<span class="hljs-number"><span class="hljs-number">6</span></span>) PropertyNameCapturer.class.getClassLoader(), ClassLoadingStrategy.Default.WRAPPER ) .getLoaded(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-meta"><span class="hljs-meta">@SuppressWarnings</span></span>(<span class="hljs-string"><span class="hljs-string">"unchecked"</span></span>) Class&lt;T&gt; typed = (Class&lt;T&gt;) proxyType; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> typed.newInstance(); (<span class="hljs-number"><span class="hljs-number">7</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (InstantiationException | IllegalAccessException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HibernateException( <span class="hljs-string"><span class="hljs-string">"Couldn't instantiate proxy for method name retrieval"</span></span>, e ); } }</code> </pre><br> è¯¥ä»£ç å¯èƒ½çœ‹èµ·æ¥æœ‰äº›æ··ä¹±ï¼Œæ‰€ä»¥è®©æˆ‘è§£é‡Šä¸€ä¸‹ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬è·å¾—ByteBuddyï¼ˆ1ï¼‰çš„å®ä¾‹ï¼Œå®ƒæ˜¯DSLçš„å…¥å£ç‚¹ã€‚ å®ƒç”¨äºåˆ›å»ºæ‰©å±•æ‰€éœ€ç±»å‹ï¼ˆå¦‚æœæ˜¯ç±»ï¼‰æˆ–ç»§æ‰¿Objectå¹¶å®ç°æ‰€éœ€ç±»å‹ï¼ˆå¦‚æœæ˜¯æ¥å£ï¼‰çš„åŠ¨æ€ç±»å‹ï¼ˆ2ï¼‰ã€‚ <br><br> ç„¶åï¼Œæˆ‘ä»¬æŒ‡ç¤ºè¯¥ç±»å‹å®ç°äº†PropertyNameCaptureræ¥å£ï¼Œå¹¶æ·»åŠ äº†ä¸€ä¸ªå­—æ®µæ¥å­˜å‚¨æ‰€éœ€å±æ€§çš„åç§°ï¼ˆ3ï¼‰ã€‚ ç„¶åï¼Œæˆ‘ä»¬è¯´å¯¹æ‰€æœ‰æ–¹æ³•çš„è°ƒç”¨åº”ç”±PropertyNameCapturingInterceptorï¼ˆ4ï¼‰æ‹¦æˆªã€‚ åªæœ‰setPropertyNameï¼ˆï¼‰å’ŒgetPropertyNameï¼ˆï¼‰ï¼ˆæ¥è‡ªPropertyNameCaptureræ¥å£ï¼‰æ‰èƒ½è®¿é—®ä¹‹å‰åˆ›å»ºçš„å®é™…å±æ€§ï¼ˆ5ï¼‰ã€‚ æœ€åï¼Œåˆ›å»ºï¼ŒåŠ è½½ï¼ˆ6ï¼‰å’Œå®ä¾‹åŒ–ï¼ˆ7ï¼‰è¯¥ç±»ã€‚ <br><br> è¿™å°±æ˜¯åˆ›å»ºä»£ç†ç±»å‹æ‰€éœ€è¦çš„å…¨éƒ¨ï¼Œæ„Ÿè°¢ByteBuddyï¼Œè¿™å¯ä»¥é€šè¿‡å‡ è¡Œä»£ç æ¥å®Œæˆã€‚ ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å‘¼å«æ‹¦æˆªå™¨ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PropertyNameCapturingInterceptor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@RuntimeType</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">intercept</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@This PropertyNameCapturer capturer, @Origin Method method)</span></span></span><span class="hljs-function"> </span></span>{ (<span class="hljs-number"><span class="hljs-number">1</span></span>) capturer.setPropertyName(getPropertyName(method)); (<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (method.getReturnType() == <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>.class) { (<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ... ) { } <span class="hljs-comment"><span class="hljs-comment">// ... handle all primitve types // ... } else { return null; } } private static String getPropertyName(Method method) { (4) final boolean hasGetterSignature = method.getParameterTypes().length == 0 &amp;&amp; method.getReturnType() != null; String name = method.getName(); String propName = null; if (hasGetterSignature) { if (name.startsWith("get") &amp;&amp; hasGetterSignature) { propName = name.substring(3, 4).toLowerCase() + name.substring(4); } else if (name.startsWith("is") &amp;&amp; hasGetterSignature) { propName = name.substring(2, 3).toLowerCase() + name.substring(3); } } else { throw new HibernateException( "Only property getter methods are expected to be passed"); (5) } return propName; } }</span></span></code> </pre><br>  Interceptï¼ˆï¼‰æ–¹æ³•æ¥å—è¢«è°ƒç”¨çš„Methodå’Œè¯¥è°ƒç”¨çš„ç›®æ ‡ï¼ˆ1ï¼‰ã€‚  <code>@Origin</code>å’Œ<code>@This</code>ç”¨äºæŒ‡å®šé€‚å½“çš„å‚æ•°ï¼Œä»¥ä¾¿ByteBuddyå¯ä»¥åœ¨åŠ¨æ€ä»£ç†ä¸­ç”Ÿæˆæ­£ç¡®çš„interceptï¼ˆï¼‰è°ƒç”¨ã€‚ <br><br> è¯·æ³¨æ„ï¼Œç”±äºByteBuddyä»…ç”¨äºåˆ›å»ºåŠ¨æ€ä»£ç†ï¼Œè€Œä¸ç”¨äºåˆ›å»ºåŠ¨æ€ä»£ç†ï¼Œå› æ­¤å¯¹ByteBuddyç±»å‹æ²¡æœ‰ä¸¥æ ¼çš„ä¾èµ–å…³ç³»ã€‚ <br><br> é€šè¿‡è°ƒç”¨<code>getPropertyName()</code> ï¼ˆ4ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—ä¸ä¼ é€’çš„æ–¹æ³•å¼•ç”¨ç›¸å¯¹åº”çš„å±æ€§åç§°ï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨<code>PropertyNameCapturer</code> ï¼ˆ2ï¼‰ä¸­ã€‚ å¦‚æœè¯¥æ–¹æ³•ä¸æ˜¯è·å–æ–¹æ³•ï¼Œåˆ™ä»£ç å°†å¼•å‘å¼‚å¸¸ï¼ˆ5ï¼‰ã€‚  getterçš„è¿”å›ç±»å‹æ— å…³ç´§è¦ï¼Œå› æ­¤è€ƒè™‘åˆ°å±æ€§ï¼ˆ3ï¼‰çš„ç±»å‹ï¼Œæˆ‘ä»¬è¿”å›nullã€‚ <br><br> ç°åœ¨æˆ‘ä»¬å‡†å¤‡åœ¨<code>validateValue()</code>æ–¹æ³•ä¸­è·å–å±æ€§åç§°ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;T, P&gt; Set&lt;ConstraintViolation&lt;T&gt;&gt; validateValue( Class&lt;T&gt; type, Function&lt;? <span class="hljs-keyword"><span class="hljs-keyword">super</span></span> T, P&gt; property, P value) { T capturer = getPropertyNameCapturer(type); property.apply(capturer); String propertyName = ((PropertyLiteralCapturer) capturer).getPropertyName(); <span class="hljs-comment"><span class="hljs-comment">//      }</span></span></code> </pre><br> å°†å‡½æ•°åº”ç”¨äºåˆ›å»ºçš„ä»£ç†åï¼Œæˆ‘ä»¬å°†ç±»å‹è½¬æ¢ä¸ºPropertyNameCapturerå¹¶ä»Methodä¸­è·å–åç§°ã€‚ <br><br> å› æ­¤ï¼Œä½¿ç”¨ä¸€äº›ç”Ÿæˆå­—èŠ‚ç çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†Java 8ä¸­çš„â€œæ–¹æ³•å‚è€ƒâ€æ¥æ¨¡æ‹Ÿå±æ€§æ–‡å­—ã€‚ <br><br> å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è¯­è¨€ä¸­ä½¿ç”¨ä¸åŠ¨äº§å­—é¢é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰€æœ‰äººéƒ½ä¼šè¿‡å¾—æ›´å¥½ã€‚ æˆ‘ä»€è‡³å…è®¸ä½¿ç”¨ç§æœ‰å±æ€§ï¼Œå¹¶ä¸”å¯èƒ½å¯ä»¥ä»æ‰¹æ³¨ä¸­å¼•ç”¨å±æ€§ã€‚ ä¸åŠ¨äº§å­—é¢é‡ä¼šæ¯”è¾ƒæ•´æ´ï¼ˆä¸å¸¦â€œ getâ€å‰ç¼€ï¼‰ï¼Œå¹¶ä¸”çœ‹èµ·æ¥ä¸ä¼šåƒé»‘å®¢ä¸€æ ·ã€‚ <br><br><h2> æ¥è‡ªç¿»è¯‘ </h2><br> å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå…¶ä»–å¥½çš„è¯­è¨€å·²ç»æ”¯æŒï¼ˆæˆ–å‡ ä¹ï¼‰ç±»ä¼¼çš„æœºåˆ¶ï¼š <br><br><ul><li>  Cï¼ƒ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-nameOfè¯­å¥</a> </li><li>  Groovyå’ŒScala-æœ‰è‘—åçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å…ƒç¼–ç¨‹æŠ€å·§å’Œå®</a> </li><li>  <code>User::login.name</code>è¯­æ³•ä¸º<code>User::login.name</code> </li></ul><br> å¦‚æœæ‚¨çªç„¶å°†Lomboké¡¹ç›®ä¸Javaä¸€èµ·ä½¿ç”¨ï¼Œåˆ™ä¼šä¸ºå…¶ç¼–å†™ä¸€ä¸ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å­—èŠ‚ç ç¼–è¯‘æ—¶é—´ç”Ÿæˆå™¨</a> ã€‚ <br><br> å—åˆ°æœ¬æ–‡æ‰€è¿°æ–¹æ³•çš„å¯å‘ï¼Œè°¦è™šçš„ä»†äººå°†ä¸€ä¸ªå°å‹åº“æ”¾åœ¨ä¸€èµ·ï¼Œè¯¥åº“å®ç°äº†Java 8çš„nameOfPropertyï¼ˆï¼‰ï¼š <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æºä»£ç </a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äºŒè¿›åˆ¶æ–‡ä»¶</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN420533/">https://habr.com/ru/post/zh-CN420533/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN420521/index.html">ç°åœ¨æ­£å¼å‘å¸ƒï¼šTLS 1.3è¢«è®¤å¯ä¸ºæ ‡å‡†</a></li>
<li><a href="../zh-CN420523/index.html">äºŒå…ƒæœŸæƒå›¾è¡¨åˆ†ææˆ–æˆ‘å†æ¬¡å‘è‡ªå·±è¯æ˜å…è´¹èµ å“ä¸å­˜åœ¨</a></li>
<li><a href="../zh-CN420525/index.html">ç½‘ç»œæœ€è€ç»ƒã€‚ ç¬¬åäº”éƒ¨åˆ†ã€‚ æœåŠ¡è´¨é‡</a></li>
<li><a href="../zh-CN420527/index.html">å¯ä»¥å‘å‡ºå¾®ç¬‘å¹¶å…·æœ‰æ„ŸæŸ“åŠ›</a></li>
<li><a href="../zh-CN420529/index.html">æå‰ä½¿ç”¨Geetaè¿˜æ˜¯å…­ä¸ªæœˆå‰å¦‚ä½•é€€ä¼‘ï¼Ÿ</a></li>
<li><a href="../zh-CN420537/index.html">å…³äºæ‰©éŸ³å™¨å¦‚ä½•ç›¸å¯¹è¯šå®åœ°èµšé’±çš„å¦ä¸€ä¸ªæ•…äº‹</a></li>
<li><a href="../zh-CN420539/index.html">ç”¨äºè§„èŒƒåŒ–å’Œé‡ç½®æ ·å¼çš„è‡ªå®šä¹‰æ–¹æ³•ï¼ˆcustom-reset.cssï¼‰</a></li>
<li><a href="../zh-CN420541/index.html">å¡å†…åŸºÂ·æ¢…éš†å¤§å­¦çš„ç ”ç©¶äººå‘˜åˆ›é€ äº†æœ€å¯ä¿¡çš„â€œ deepfakesâ€</a></li>
<li><a href="../zh-CN420547/index.html">å½“æˆ‘ä»é›¶å¼€å§‹æ’°å†™å’Œæå«1Cä¸­çš„DEVOPSå’Œå·¥ç¨‹å®è·µæ–‡å‡­æ—¶</a></li>
<li><a href="../zh-CN420549/index.html">FreeMarkeræ¨¡æ¿</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>