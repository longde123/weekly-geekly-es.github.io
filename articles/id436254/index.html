<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏗️ 💧 🖌️ Bot untuk Starcraft di Rust, C atau bahasa lainnya 🕢 🛌🏻 👼🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="StarCraft: Brood War . Game ini sangat berarti bagi saya! Dan bagi banyak dari Anda, saya kira. Begitu banyak, sehingga saya bertanya-tanya apakah say...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bot untuk Starcraft di Rust, C atau bahasa lainnya</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436254/"><img src="https://habrastorage.org/webt/qv/fa/ex/qvfaexsnkzmckmwrt_spqmc7nr4.png" align="left"><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">StarCraft: Brood War</a> .  Game ini sangat berarti bagi saya!  Dan bagi banyak dari Anda, saya kira.  Begitu banyak, sehingga saya bertanya-tanya apakah saya harus memberikan tautan ke halamannya di Wikipedia atau tidak. </p><br><p>  Suatu hari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">Hentikan</a> mengirimi saya PM dan menawarkan untuk belajar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Rust</a> .  Seperti orang biasa, kami memutuskan untuk memulai <del>  halo dunia </del>  menulis perpustakaan dinamis untuk Windows yang dapat dimuat ke ruang alamat StarCraft dan mengelola unit. </p><br><p>  Artikel berikut akan menjelaskan proses menemukan solusi dan menggunakan teknologi dan teknik yang memungkinkan Anda mempelajari hal-hal baru tentang Rust dan ekosistemnya.  Anda juga mungkin terinspirasi untuk mengimplementasikan bot menggunakan bahasa favorit Anda, apakah itu C, C ++, Ruby, Python, dll. </p><a name="habracut"></a><br><p>  Sangat layak untuk mendengarkan nyanyian pujian dari Korea Selatan saat membaca artikel ini: </p><br><div class="spoiler">  <b class="spoiler_title">OST Starcraft</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/pNt0iVG2VOA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><br><h2 id="bwapi">  Bwapi </h2><br><p>  Game ini sudah hampir 20 tahun.  Dan itu masih <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">populer</a> ;  Kejuaraan menarik banyak orang di AS bahkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pada tahun 2017 di</a> mana pertempuran grand master Jaedong vs Bisu terjadi.  Selain pemain manusia, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mesin tanpa jiwa</a> juga mengambil bagian dalam pertempuran SC!  Dan ini dimungkinkan karena <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">BWAPI</a> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tautan yang</a> lebih bermanfaat. </p><br><p>  Selama lebih dari satu dekade sekarang, telah ada komunitas pengembang bot di sekitar game ini.  Penggemar menciptakan bot dan berpartisipasi dalam berbagai kejuaraan.  Banyak dari mereka mempelajari AI dan pembelajaran mesin.  BWAPI digunakan oleh universitas untuk melatih siswa mereka.  Bahkan ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">saluran kedutan yang</a> menyiarkan pertandingan semacam itu. </p><br><p>  Jadi, tim penggemar membalikkan Starcraft back-end beberapa tahun yang lalu dan mengembangkan API di C ++, yang memungkinkan Anda membuat bot, melakukan injeksi dalam proses permainan dan mendominasi manusia yang sengsara. </p><br><p>  Seperti yang sering terjadi, sebelumnya <del>  membangun rumah, perlu menambang bijih, menempa alat </del>  membuat bot, Anda perlu menerapkan API.  Apa yang ditawarkan Rust? </p><br><h2 id="ffi">  Ffi </h2><br><p>  Cukup mudah untuk bekerja dengan bahasa lain dari Rust.  Ada <abbr title="Antarmuka fungsi asing">FFI</abbr> untuk ini.  Biarkan saya memberi Anda kutipan singkat dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi</a> . </p><br><p>  Bayangkan kita memiliki pustaka <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tajam</a> , yang memiliki file header <a href="">snappy-ch</a> , yang berisi deklarasi fungsi. </p><br><p>  Mari kita buat proyek menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kargo</a> . </p><br><pre><code class="bash hljs">$ cargo new --bin snappy Created binary (application) `snappy` project $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> snappy snappy$ tree . ├── Cargo.toml └── src └── main.rs 1 directory, 2 files</code> </pre> <br><p>  Cargo telah membuat struktur file standar untuk proyek tersebut. </p><br><p>  Di <code>Cargo.toml</code> kami menentukan ketergantungan ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">libc</a> : </p><br><pre> <code class="plaintext hljs">[dependencies] libc = "0.2"</code> </pre> <br><p>  File <code>src/main.rs</code> akan terlihat seperti ini: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">crate</span></span> libc; <span class="hljs-comment"><span class="hljs-comment">// To import C types, in our case for size_t use libc::size_t; #[link(name = "snappy")] // Specify the name of the library for linking the function extern { // We write the declaration of the function which we want to import // in C the declaration looks like this: // size_t snappy_max_compressed_length(size_t source_length); fn snappy_max_compressed_length(source_length: size_t) -&gt; size_t; } fn main() { let x = unsafe { snappy_max_compressed_length(100) }; println!("max compressed length of a 100 byte buffer: {}", x); }</span></span></code> </pre> <br><p>  Mari kita membangun dan menjalankan proyek: </p><br><pre> <code class="bash hljs">snappy$ cargo build ... snappy$ cargo run Finished dev [unoptimized + debuginfo] target(s) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 0.02s Running `target/debug/snappy` max compressed length of a 100 byte buffer: 148</code> </pre> <br><p>  Anda bisa memanggil <code>cargo run</code> saja, yang memanggil <code>cargo build</code> sebelum lari.  Pilihan lain adalah membangun proyek dan memanggil biner secara langsung: </p><br><pre> <code class="bash hljs">snappy$ ./target/debug/snappy max compressed length of a 100 byte buffer: 148</code> </pre> <br><p>  Jika snappy library terinstal kode akan dikompilasi (untuk Ubuntu Anda harus menginstal paket libsnappy-dev). </p><br><pre> <code class="bash hljs">snappy$ ldd target/debug/snappy ... libsnappy.so.1 =&gt; /usr/lib/x86_64-linux-gnu/libsnappy.so.1 (0x00007f8de07cf000)</code> </pre> <br><p>  Seperti yang Anda lihat, biner kami ditautkan ke pustaka bersama libsnappy.  Dan panggilan ke <code>snappy_max_compressed_length</code> dalam kode kami adalah panggilan fungsi dari perpustakaan ini. </p><br><h2 id="rust-bindgen">  karat-bindgen </h2><br><p>  Alangkah baiknya jika kita dapat secara otomatis menghasilkan FFI kita.  Untungnya, ada sebuah utilitas yang disebut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">rust-bindgen</a> di kotak peralatan Rust addict.  Ia mampu menghasilkan binding FFI ke pustaka C (dan beberapa C ++). </p><br><p>  Instalasi: </p><br><pre> <code class="bash hljs">$ cargo install bindgen</code> </pre> <br><p>  Seperti apa bentuk <strong>karat-bindgen</strong> ?  Kami mengambil file header C / C ++, kami mengarahkan utilitas <strong>bindgen</strong> padanya, dan output yang kami dapatkan dihasilkan kode Rust dengan deklarasi yang tepat untuk membiarkan kami menggunakan struktur dan fungsi C.  Inilah yang <code>bindgen</code> hasilkan untuk tajam: </p><br><pre> <code class="rust hljs">$ bindgen /usr/include/snappy-ch | grep -C <span class="hljs-number"><span class="hljs-number">1</span></span> snappy_max_compressed_length <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">snappy_max_compressed_length</span></span></span></span>(source_length: <span class="hljs-built_in"><span class="hljs-built_in">usize</span></span>) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">usize</span></span>; }</code> </pre> <br><p>  Ternyata bindgen tidak dapat mengatasi header BWAPI, menghasilkan banyak kode yang tidak dapat digunakan (karena fungsi anggota virtual, std :: string dalam API publik, dll.).  Masalahnya adalah bahwa BWAPI ditulis dalam C ++.  C ++ umumnya sulit digunakan bahkan dari proyek C ++.  Setelah pustaka dirakit, lebih baik untuk menautkannya dengan linker yang sama (versi yang sama), file header harus diurai dengan kompiler yang sama (versi yang sama).  Semua faktor ini dapat mempengaruhi hasilnya.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mangling</a> misalnya, yang masih <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tidak dapat diimplementasikan tanpa kesalahan</a> di GNU GCC.  Faktor-faktor ini sangat signifikan sehingga bahkan <abbr title="Kerangka uji C ++ Google">gtest</abbr> tidak dapat mengatasinya.  Dan dalam <a href="">dokumentasi</a> itu tertulis: Anda sebaiknya membangun gtest sebagai bagian dari proyek oleh kompiler yang sama dan tautan yang sama. </p><br><h2 id="bwapi-c">  Bwapi-c </h2><br><p>  C adalah lingua franca dari rekayasa perangkat lunak.  Jika rust-bindgen bekerja dengan baik untuk bahasa C, mengapa tidak mengimplementasikan BWAPI untuk C, dan kemudian gunakan API-nya?  Ide bagus! </p><br><p>  Ya, itu ide yang bagus sampai Anda melihat bagian dalam BWAPI dan melihat jumlah kelas dan metode yang harus Anda terapkan.  Terutama semua susunan memori ini, kode asm, penambalan memori dan "kengerian" lainnya yang tidak sempat kita miliki.  Perlu untuk menggunakan solusi yang ada sepenuhnya. </p><br><p>  Tetapi kita perlu entah bagaimana mengalahkan fungsi mangling, kode C ++, inheritance dan anggota virtual. </p><br><p>  Dalam C ++, ada dua alat kuat yang akan kita gunakan untuk menyelesaikan masalah kita: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pointer buram</a> dan <code>extern "C"</code> . </p><br><p>  <code>extern "C" {}</code> memungkinkan kode C ++ untuk "menutupi" sendiri di bawah C. Hal ini memungkinkan untuk membuat nama fungsi tanpa mangling. </p><br><p>  Pointer buram memungkinkan kita untuk menghapus jenis dan membuat pointer ke "beberapa jenis" tanpa menyediakan implementasinya.  Karena ini hanya deklarasi dari beberapa jenis, tidak mungkin untuk menggunakan jenis ini berdasarkan nilai, Anda dapat menggunakannya hanya dengan pointer. </p><br><p>  Bayangkan kita memiliki kode C ++ ini: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> cpp { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bar; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;bar; } }; } <span class="hljs-comment"><span class="hljs-comment">// namespace cpp</span></span></code> </pre> <br><p>  Kita bisa mengubahnya menjadi header C: </p><br><pre> <code class="plaintext hljs">extern "C" { typedef struct Foo_ Foo; // Opaque pointer to Foo // call cpp::Foo::get_bar int Foo_get_bar(Foo* self); }</code> </pre> <br><p>  Dan di sini adalah bagian C ++ yang akan menjadi tautan antara header C dan implementasi C ++: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Foo_get_bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Foo* self)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// cast the opaque pointer to the certain cpp::Foo and call the method ::get_bar return reinterpret_cast&lt;cpp::Foo*&gt;(self)-&gt;get_bar(); }</span></span></code> </pre> <br><p>  Tidak semua metode kelas harus diproses dengan cara ini.  Di BWAPI, ada kelas yang bisa Anda implementasikan sendiri menggunakan bidang struktur ini, misalnya <code>typedef struct Position { int x; int y; } Position;</code> <code>typedef struct Position { int x; int y; } Position;</code>  dan metode seperti <code>Position::get_distance</code> . </p><br><p>  Ada kelas-kelas yang harus saya perlakukan dengan cara khusus.  Sebagai contoh, AIModule harus menjadi pointer ke kelas C ++ dengan serangkaian fungsi anggota virtual tertentu.  Namun demikian, ini adalah <a href="">tajuk</a> dan <a href="">implementasi</a> . </p><br><p>  Jadi, setelah beberapa bulan kerja keras, <strong>554</strong> metode dan selusin kelas, perpustakaan lintas platform <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">BWAPI-C</a> lahir, yang memungkinkan Anda <a href="">membuat bot di C.</a>  Produk sampingan adalah kemungkinan kompilasi silang dan kemampuan untuk mengimplementasikan API dalam bahasa lain yang mendukung FFI dan konvensi panggilan cdecl. </p><br><p>  Jika Anda menulis perpustakaan, silakan, tulis API-nya di C. </p><br><p>  Fitur terpenting dari BWAPI-C adalah integrasi seluas mungkin dengan bahasa pemrograman lain.  <code>Python</code> , <code>Ruby</code> , <code>Rust</code> , <code>PHP</code> , <code>Java</code> , dan banyak lagi yang lain dapat bekerja dengan C, jadi jika Anda menyelesaikan masalah dan menerapkan pembungkus sendiri, Anda juga dapat menulis bot dengan bantuan mereka. </p><br><h2 id="writing-a-bot-in-c">  Menulis bot di C </h2><br><p>  Bagian ini menjelaskan prinsip-prinsip umum organisasi internal modul Starcraft. </p><br><p>  Ada 2 jenis bot: modul dan klien.  Mari kita lihat contoh penulisan modul. </p><br><p>  Modul ini adalah perpustakaan yang dinamis.  Prinsip umum memuat pustaka dinamis dapat dilihat di <a href="">sini</a> .  Modul harus mengekspor 2 fungsi: <code>newAIModule</code> dan <code>gameInit</code> . </p><br><p>  <code>gameInit</code> mudah.  Fungsi ini dipanggil untuk meneruskan pointer ke gim saat ini.  Pointer ini sangat penting, karena ada variabel statis global di belantara BWAPI, yang digunakan di beberapa bagian kode.  Mari kita gambarkan <code>gameInit</code> : </p><br><pre> <code class="plaintext hljs">DLLEXPORT void gameInit(void* game) { BWAPIC_setGame(game); }</code> </pre> <br><p>  <code>newAIModule</code> sedikit lebih rumit.  Seharusnya mengembalikan pointer ke kelas C ++, yang memiliki tabel metode virtual dengan nama-nama seperti <strong>onXXXXX</strong> yang dipanggil pada acara permainan tertentu.  Mari kita mendeklarasikan struktur modul: </p><br><pre> <code class="plaintext hljs">typedef struct ExampleAIModule { const AIModule_vtable* vtable_; const char* name; } ExampleAIModule;</code> </pre> <br><p>  Bidang pertama harus menjadi pointer ke tabel metode (ini semacam sihir).  Berikut ini adalah fungsi baru <code>newAIModule</code> : </p><br><pre> <code class="plaintext hljs">DLLEXPORT void* newAIModule() { ExampleAIModule* const module = (ExampleAIModule*) malloc( sizeof(ExampleAIModule) ); module-&gt;name = "ExampleAIModule"; module-&gt;vtable_ = &amp;module_vtable; return createAIModuleWrapper( (AIModule*) module ); }</code> </pre> <br><p>  <code>createAIModuleWrapper</code> adalah trik sulap lain yang mengubah pointer C menjadi pointer ke kelas C ++ <del>  metode virtual </del>  fungsi anggota. </p><br><p>  <code>module_vtable</code> adalah variabel statis pada tabel metode, nilai metode diisi dengan pointer ke fungsi global: </p><br><pre> <code class="plaintext hljs">static AIModule_vtable module_vtable = { onStart, onEnd, onFrame, onSendText, onReceiveText, onPlayerLeft, onNukeDetect, onUnitDiscover, onUnitEvade, onUnitShow, onUnitHide, onUnitCreate, onUnitDestroy, onUnitMorph, onUnitRenegade, onSaveGame, onUnitComplete }; void onEnd(AIModule* module, bool isWinner) { } void onFrame(AIModule* module) {} void onSendText(AIModule* module, const char* text) {} void onReceiveText(AIModule* module, Player* player, const char* text) {} void onPlayerLeft(AIModule* module, Player* player) {} void onNukeDetect(AIModule* module, Position target) {} void onUnitDiscover(AIModule* module, Unit* unit) {} void onUnitEvade(AIModule* module, Unit* unit) {} void onUnitShow(AIModule* module, Unit* unit) {} void onUnitHide(AIModule* module, Unit* unit) {} void onUnitCreate(AIModule* module, Unit* unit) {} void onUnitDestroy(AIModule* module, Unit* unit) {} void onUnitMorph(AIModule* module, Unit* unit) {} void onUnitRenegade(AIModule* module, Unit* unit) {} void onSaveGame(AIModule* module, const char* gameName) {} void onUnitComplete(AIModule* module, Unit* unit) {}</code> </pre> <br><p>  Jika Anda melihat nama fungsi dan tanda tangannya, jelas dalam kondisi apa dan dengan argumen apa mereka perlu dipanggil.  Sebagai <a href="">contoh,</a> saya membuat semua fungsi kosong, kecuali </p><br><pre> <code class="plaintext hljs">void onStart(AIModule* module) { ExampleAIModule* self = (ExampleAIModule*) module; Game* game = BWAPIC_getGame(); Game_sendText(game, "Hello from bwapi-c!"); Game_sendText(game, "My name is %s", self-&gt;name); }</code> </pre> <br><p>  Fungsi ini dipanggil saat game berjalan.  Argumennya adalah pointer ke modul saat ini.  <code>BWAPIC_getGame</code> mengembalikan pointer global ke game, yang kami atur menggunakan panggilan ke <code>BWAPIC_setGame</code> .  Jadi, mari kita tunjukkan contoh kerja modul cross-compiling: </p><br><pre> <code class="bash hljs">bwapi-c/example$ tree . ├── BWAPIC.dll └── Dll.c 0 directories, 2 files bwapi-c/example$ i686-w64-mingw32-gcc -mabi=ms -shared -o Dll.dll Dll.c -I../include -L. -lBWAPIC bwapi-c/example$ cp Dll.dll ~/Starcraft/bwapi-data/ bwapi-c/example$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Starcraft/bwapi-data/ Starcraft$ wine bwheadless.exe -e StarCraft.exe -l bwapi-data/BWAPI.dll --headful ... ... ...</code> </pre> <br><p>  Tekan tombol dan jalankan game.  Informasi lebih lanjut tentang kompilasi dan eksekusi dapat ditemukan di situs web <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">BWAPI</a> dan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">BWAPI-C</a> . </p><br><p>  Hasil modul: </p><br><p><img src="https://habrastorage.org/webt/cw/a-/41/cwa-41ihsyva-pj2stpef1xjn2g.png" alt="gambar"></p><br><p>  Anda dapat menemukan contoh modul yang sedikit lebih rumit yang menunjukkan cara bekerja dengan iterator, manajemen unit, pencarian mineral, dan output statistik di <a href="">bwapi-c / example / Dll.c.</a> </p><br><h2 id="bwapi-sys">  bwapi-sys </h2><br><p>  Dalam ekosistem Rust ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">cara tertentu untuk</a> menamai paket yang menautkan ke perpustakaan asli.  Setiap paket foo-sys menjalankan dua fungsi penting: </p><br><ul><li>  tautan dengan libfoo perpustakaan asli; </li><li>  menyediakan deklarasi ke fungsi-fungsi dari libfoo library.  Tapi deklarasi saja!  Abstraksi tingkat tinggi tidak disediakan dalam peti * -sys. </li></ul><br><p>  Agar paket * -sys dapat terhubung dengan sukses, Anda harus memberi tahu kargo <a href="">untuk mencari</a> perpustakaan asli dan / atau untuk <a href="">membangun</a> perpustakaan dari sumber. </p><br><p>  Agar paket * -sys memberikan deklarasi, Anda harus menulisnya sendiri atau membuatnya menggunakan bindgen.  Lagi bindgen.  Percobaan nomor dua =) </p><br><p>  Generasi binding sangat mudah: </p><br><pre> <code class="bash hljs">bindgen BWAPI.h -o lib.rs \ --opaque-type <span class="hljs-string"><span class="hljs-string">".+_"</span></span> \ --blacklist-type <span class="hljs-string"><span class="hljs-string">"std.*|__.+|.+_$|Game_v(Send|Print|Draw).*|va_list|.+_t$"</span></span> \ --no-layout-tests \ --no-derive-debug \ --raw-line <span class="hljs-string"><span class="hljs-string">"#![allow(improper_ctypes, non_snake_case)]"</span></span> \ -- -I../submodules/bwapi-c/include sed -i -r -- <span class="hljs-string"><span class="hljs-string">'s/.+\s+(.+)_;/pub struct \1;/'</span></span> lib.rs</code> </pre> <br><p>  <code>BWAPI.h</code> adalah file dengan semua header C dari BWAPI-C. </p><br><p>  Sebagai contoh, bindgen telah menghasilkan deklarasi untuk fungsi-fungsi di atas: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> { <span class="hljs-comment"><span class="hljs-comment">/// BWAPIC_setGame must be called from gameInit to initialize BWAPI::BroodwarPtr pub fn BWAPIC_setGame(game: *mut Game); } extern "C" { pub fn BWAPIC_getGame() -&gt; *mut Game; }</span></span></code> </pre> <br><p>  Ada dua strategi: menyimpan kode yang dihasilkan dalam repositori, dan membuat kode dengan cepat selama proses pembuatan.  Kedua pendekatan memiliki kelebihan dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kekurangan</a> . </p><br><p>  Senang bertemu Anda <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bwapi-sys</a> ;  satu langkah kecil lagi ke tujuan kita. </p><br><p>  Apakah Anda ingat bahwa sebelumnya saya berbicara tentang cross-platform?  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">nlinker</a> bergabung dengan proyek dan menerapkan strategi yang licik.  Jika host target adalah Windows, unduh BWAPIC yang sudah dirakit dari GitHub.  Dan untuk target yang tersisa, kami mengumpulkan BWAPI-C dari sumber-sumber untuk OpenBW (saya akan memberi tahu Anda tentangnya nanti). </p><br><h2 id="bwapi-rs">  bwapi-rs </h2><br><p>  Sekarang kita memiliki ikatan dan kita dapat mendefinisikan abstraksi tingkat tinggi.  Kami memiliki dua jenis untuk dikerjakan: nilai murni dan pointer buram. </p><br><p>  Semuanya sederhana dengan nilai-nilai murni.  Mari kita ambil warna sebagai contoh.  Kita perlu membuatnya mudah digunakan dari kode Rust untuk menggunakan warna dengan cara yang nyaman dan alami: </p><br><pre> <code class="rust hljs">game.draw_line(CoordinateType::Screen, (<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>), (<span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>), Color::Red); ^^^</code> </pre> <br><p>  Jadi, untuk penggunaan yang mudah perlu mendefinisikan enumerasi dengan <a href="">konstanta</a> C ++ tetapi juga idiomatis untuk Rust, dan mendefinisikan metode untuk mengubahnya dalam bwapi_sys :: Color using std :: convert :: From: </p><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// FFI version #[repr(C)] #[derive(Copy, Clone)] pub struct Color { pub color: ::std::os::raw::c_int, } // Idiomatic version #[derive(PartialEq, PartialOrd, Copy, Clone)] pub enum Color { Black = 0, Brown = 19, ...</span></span></code> </pre> <br><p>  Untuk kenyamanan Anda, Anda dapat menggunakan kotak <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">enum-primitive-</a> derive. </p><br><p>  Juga mudah digunakan pointer buram.  Mari kita gunakan pola <a href="">Newtype</a> : </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Player</span></span></span></span>(*<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> sys::Player);</code> </pre> <br><p>  Ini berarti bahwa Player adalah sejenis struktur dengan bidang pribadi - sebuah pointer buram mentah dari C. Dan inilah cara Anda dapat mendefinisikan Player :: color: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> Player { <span class="hljs-comment"><span class="hljs-comment">// so the method is declared Player::getColor in bwapi-sys //extern "C" { // pub fn Player_getColor(self_: *mut Player) -&gt; Color; //} pub fn color(&amp;self) -&gt; Color { // bwapi_sys::Player_getColor - wrapper function from BWAPI-C // self.0 - opaque pointer let color = unsafe { bwapi_sys::Player_getColor(self.0) }; color.into() // cast bwapi_sys::Color -&gt; Color } }</span></span></code> </pre> <br><p>  Sekarang kita bisa menulis bot pertama kita di Rust! </p><br><h2 id="creating-a-bot-in-rust">  Membuat bot di Rust </h2><br><p>  Sebagai bukti konsep, bot akan serupa dengan countru yang terkenal: seluruh tugasnya adalah untuk merekrut pekerja dan mengumpulkan mineral. </p><br><p><img src="https://habrastorage.org/webt/hx/r_/jm/hxr_jmj2fbsitx-tfw96p2pa2tu.png" alt="Korea utara"></p><br><p><img src="https://habrastorage.org/webt/ww/gf/lr/wwgflrekcnxtv75thaurrwcm0g8.png" alt="Korea selatan"></p><br><p>  Mari kita mulai dengan fungsi yang diperlukan <code>gameInit</code> dan <code>newAIModule</code> : </p><br><pre> <code class="rust hljs"><span class="hljs-meta"><span class="hljs-meta">#[no_mangle]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsafe</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gameInit</span></span></span></span>(game: *<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> void) { bwapi_sys::BWAPIC_setGame(game <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> bwapi_sys::Game); } <span class="hljs-meta"><span class="hljs-meta">#[no_mangle]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsafe</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newAIModule</span></span></span></span>() -&gt; *<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> void { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> module = ExampleAIModule { name: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>::from(<span class="hljs-string"><span class="hljs-string">"ExampleAIModule"</span></span>) }; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> result = wrap_handler(<span class="hljs-built_in"><span class="hljs-built_in">Box</span></span>::new(module)); result }</code> </pre> <br><p>  <code>#[no_mangle]</code> melakukan fungsi yang sama dengan <code>extern "C"</code> di C ++.  Di dalam <code>wrap_handler</code> semua keajaiban terjadi, dengan substitusi dari tabel fungsi virtual dan "masking" kelas C ++. </p><br><p>  Definisi struktur modul lebih sederhana dan lebih menarik daripada di C: </p><br><pre> <code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExampleAIModule</span></span></span></span> { name: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, }</code> </pre> <br><p>  Mari kita tambahkan beberapa metode untuk menyajikan statistik dan memberikan pesanan: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> ExampleAIModule { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">draw_stat</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> game = Game::get(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> message = <span class="hljs-built_in"><span class="hljs-built_in">format!</span></span>(<span class="hljs-string"><span class="hljs-string">"Frame {}"</span></span>, game.frame_count()); game.draw_text(CoordinateType::Screen, (<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), &amp;message); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">give_orders</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> player = Game::get().self_player(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> unit <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> player.units() { <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> unit.get_type() { UnitType::Terran_SCV | UnitType::Zerg_Drone | UnitType::Protoss_Probe =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !unit.is_idle() { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> unit.is_carrying_gas() || unit.is_carrying_minerals() { unit.return_cargo(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-literal"><span class="hljs-literal">Some</span></span>(mineral) = Game::get() .minerals() .min_by_key(|m| unit.distance_to(m)) { <span class="hljs-comment"><span class="hljs-comment">// WE REQUIRE MORE MINERALS unit.right_click(&amp;mineral, false); } } UnitType::Terran_Command_Center =&gt; { unit.train(UnitType::Terran_SCV); } UnitType::Protoss_Nexus =&gt; { unit.train(UnitType::Protoss_Probe); } UnitType::Zerg_Hatchery | UnitType::Zerg_Lair | UnitType::Zerg_Hive =&gt; { unit.train(UnitType::Zerg_Drone); } _ =&gt; {} }; } } }</span></span></code> </pre> <br><p>  Untuk mengubah tipe ExampleAIModule menjadi modul nyata, Anda harus membuatnya merespons peristiwa <strong>onXXXX</strong> .  Untuk melakukannya, Anda perlu mengimplementasikan tipe EventHandler, yang merupakan analog dari tabel virtual AIModule_vtable dari C: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> EventHandler <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ExampleAIModule { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_start</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { Game::get().send_text(&amp;<span class="hljs-built_in"><span class="hljs-built_in">format!</span></span>(<span class="hljs-string"><span class="hljs-string">"Hello from Rust! My name is {}"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.name)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_end</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _is_winner: <span class="hljs-built_in"><span class="hljs-built_in">bool</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_frame</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.draw_stat(); <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.give_orders(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_send_text</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _text: &amp;<span class="hljs-built_in"><span class="hljs-built_in">str</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_receive_text</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _player: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Player, _text: &amp;<span class="hljs-built_in"><span class="hljs-built_in">str</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_player_left</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _player: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Player) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_nuke_detect</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _target: Position) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_discover</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_evade</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_show</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_hide</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_create</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_destroy</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_morph</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_renegade</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_save_game</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _game_name: &amp;<span class="hljs-built_in"><span class="hljs-built_in">str</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_complete</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} }</code> </pre> <br><p>  Membangun dan menjalankan modul sesederhana untuk C: </p><br><pre> <code class="bash hljs">bwapi-rs$ cargo build --example dll --target=i686-pc-windows-gnu bwapi-rs$ cp ./target/i686-pc-windows-gnu/debug/examples/dll.dll ~/Starcraft/bwapi-data/Dll.dll bwapi-rs$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Starcraft/bwapi-data/ Starcraft$ wine bwheadless.exe -e StarCraft.exe -l bwapi-data/BWAPI.dll --headful ... ... ...</code> </pre> <br><p>  Dan video hasil kerjanya: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/rACbnWpI01M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="openbw">  Openbw </h2><br><p>  Orang-orang ini bahkan melangkah lebih jauh.  Mereka memutuskan untuk menulis versi open-source SC: BW!  Dan mereka bagus dalam hal itu.  Salah satu tujuan mereka adalah untuk mengimplementasikan gambar HD, tetapi SC: Remastered ada di depan mereka = (Pada saat ini, Anda dapat menggunakan API mereka untuk menulis bot (ya, juga di C ++), tetapi fitur yang paling menakjubkan adalah kemampuan untuk melihat replay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">langsung di browser Anda</a> . </p><br><h2 id="conclusion">  Kesimpulan </h2><br><p>  Ada masalah yang belum terpecahkan dengan implementasi: kami tidak mengontrol referensi menjadi unik, sehingga keberadaan <code>&amp;mut</code> dan <code>&amp;</code> ke wilayah yang sama akan menghasilkan perilaku yang tidak terdefinisi saat objek diubah.  Agak masalah.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">Halt</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">berusaha</a> menerapkan ikatan idiomatik, tetapi ia tidak berhasil menemukan solusi.  Juga jika Anda ingin menyelesaikan tugas ini, Anda harus hati-hati "menyekop" API C ++ dan menempatkan kualifikasi <code>const</code> dengan benar. </p><br><p>  Saya benar-benar menikmati mengerjakan proyek ini, saya menonton tayangan ulang 하루 deeply dan tenggelam dalam suasana.  Game ini membuat penyok di alam semesta.  Tidak ada permainan yang dapat 비교할 수 없다 berdasarkan popularitas dengan SC: BW, dan dampaknya pada 대한민국 정치 에게 tidak terpikirkan.  Pro-gamer di Korea 아마도 sama populernya dengan 드라마 주연 배우 dor siaran dorams Korea di jam tayang utama.  또한, 한국 에서 프로 게이머 라면 군대 의 특별한 육군 에 입대 입대 할 수 수. </p><br><p>  StarCraft live yang panjang! </p><br><h2 id="links">  Tautan </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">reddit</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bwapi-rs</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bwapi-sys</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bwapi-c</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bwapi</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">openbw</a> </li></ul><br><hr><br><p>  Terima kasih banyak kepada Steve Klabnik karena membantu saya meninjau artikel ini. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id436254/">https://habr.com/ru/post/id436254/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id436242/index.html">YOLO dan metodologi longgar lainnya</a></li>
<li><a href="../id436244/index.html">Otak Baru Profesor Lawrence</a></li>
<li><a href="../id436246/index.html">Teknik Otomotif Modern - 02. Sangat Tesis Tentang OS</a></li>
<li><a href="../id436248/index.html">Filter Kalman</a></li>
<li><a href="../id436250/index.html">Atasan Pengisap Darah Keluar dari Konteks atau Mengapa Mereka Selalu Gagal</a></li>
<li><a href="../id436256/index.html">Mendapatkan pekerjaan di Jerman akan lebih mudah</a></li>
<li><a href="../id436260/index.html">Kesalahan dan perangkap Startups dalam mematenkan IP mereka</a></li>
<li><a href="../id436262/index.html">* Pembaruan Ethereum "Constantinople" ditunda karena kerentanan potensial ditemukan pada saat terakhir</a></li>
<li><a href="../id436264/index.html">Mono-repositori: tolong jangan (bagian 2)</a></li>
<li><a href="../id436266/index.html">Penskalaan Ekstrim di Alibaba JDK</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>