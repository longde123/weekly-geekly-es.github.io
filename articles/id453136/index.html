<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍊 🍔 👩🏼‍💻 Menulis API - mematahkan XML (dua) 🧛🏼 💶 🥡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="API MyStore pertama muncul 10 tahun yang lalu. Selama ini kami sedang mengerjakan versi API yang ada dan mengembangkan yang baru. Dan beberapa versi A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Menulis API - mematahkan XML (dua)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/moysklad/blog/453136/">  API MyStore pertama muncul 10 tahun yang lalu.  Selama ini kami sedang mengerjakan versi API yang ada dan mengembangkan yang baru.  Dan beberapa versi API sudah terkubur. <br><br>  Artikel ini akan memiliki banyak hal: cara membuat API, mengapa layanan cloud membutuhkannya, apa yang memberi pengguna rake apa yang kami kelola dan apa yang ingin kami lakukan selanjutnya. <br><a name="habracut"></a><br>  Nama saya Oleg Alekseev <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">oalexeev</a> , saya adalah direktur teknis dan salah satu pendiri MySklad. <br><br><h2>  Mengapa membuat API untuk layanan </h2><br>  Pelanggan kami, yang merupakan puluhan ribu pengusaha, aktif menggunakan solusi cloud: perbankan, toko online, akuntansi produk, CRM.  Terhubung ke satu - dan sudah sulit untuk berhenti.  Dan sekarang layanan kelima, kedelapan, kesepuluh membuat pekerjaan wirausahawan lebih mudah, tetapi pengguna mentransfer data di antara layanan cloud ini secara manual.  Pekerjaan berubah menjadi mimpi buruk. <br><br>  Solusi yang jelas adalah memberi pengguna kemampuan untuk mentransfer data antara layanan cloud.  Misalnya, impor dan ekspor data sebagai file, yang kemudian dapat diunduh ke layanan yang diinginkan.  File biasanya diubah ke format setiap layanan.  Ini lebih atau kurang pekerjaan manual yang sederhana, tetapi dengan meningkatnya jumlah layanan ini, menjadi lebih sulit untuk melakukannya. <br><br>  Karena itu, langkah selanjutnya adalah API.  Dengannya, layanan cloud mendapat manfaat dari menghubungkan beberapa layanan pada satu titik.  Munculnya ekosistem seperti itu menarik pelanggan baru karena peluang tambahan.  Produk dengan fungsi baru menjadi lebih menguntungkan dan bermanfaat. <br><br>  Jika Anda membuat antarmuka program Anda sendiri, itu menarik penjual pihak ketiga dalam bentuk programmer yang tahu tentang produk Anda berkat API.  Mereka mulai membangun solusi berdasarkan API yang diusulkan dan mendapatkan uang dengan mengotomatiskan tugas-tugas pelanggan mereka. <br><br>  Sistem akuntansi MyStore dibangun di atas proses sederhana.  Hal utama adalah bekerja dengan dokumen primer, kemampuan untuk menerima dan mengirimkan barang, dan menerima laporan bisnis berdasarkan primer.  Ada juga transfer data, misalnya, ke cloud accounting, dan penerimaannya dari sistem perbankan atau outlet ritel.  Kami juga bekerja dengan toko online: kami menerima informasi tentang barang dan mengirim data tentang saldo. <br><br><img src="https://habrastorage.org/webt/bu/cm/xx/bucmxx8qzy9efcgtznvyncdprje.png" alt="Siklus data di sekitar toko online di MyStore"><br><br><h2>  API MyStore Pertama </h2><br>  Lebih dari 10 tahun MyStore bekerja dengan API, kami telah memperoleh semua jenis integrasi yang memungkinkan Anda untuk bertukar data, bekerja dengan bank, membayar dan menggunakan telepon eksternal. <br><br>  Pada tahun pertama, kami memungkinkan untuk mengunggah data apa pun dalam format XML.  Maka itu jauh lebih dimengerti dan akrab bagi pengguna untuk menyimpan data offline, dan tidak di semacam cloud di sana, dan kami memberi mereka ini.  Bongkar dimulai dengan ekspor manual dari antarmuka.  Artinya, API belum dapat dipanggil. <br><br>  Kemudian kami mulai bekerja sama dengan Rusagro - mereka sudah menggunakan ERP "dewasa" untuk merencanakan produksi dan penjualan, tetapi pemuatan mobil di pabrik otomatis di MySklad.  Jadi kami mendapatkan dasar pertama dari API ini: pertukaran antara layanan kami dan ERP terjadi dengan mengirimkan file besar dengan data untuk semua jenis dokumen. <br><br>  Ini adalah pilihan yang baik untuk pertukaran data batch, tetapi bersama dengan dokumen mereka harus mentransfer dependensi mereka: informasi tentang barang, kontraktor dan gudang.  Tempat pembuangan seperti itu tidak begitu sulit untuk dihasilkan selama ekspor, tetapi agak sulit untuk dibongkar selama impor, karena semua informasi datang dalam satu paket: baik tentang dokumen baru dan tentang yang sudah ada. <br><br>  XML API pertama tidak bertahan lama - dua tahun kemudian, kami mulai membangunnya kembali.  Bahkan pada awal karyanya, kami membuat beberapa kesalahan ketika membangun antarmuka perangkat lunak. <br><br><img src="https://habrastorage.org/storage2/51d/0be/dca/51d0bedca4dcedbabf6cf125e2acc93a.jpg" alt="Bagaimana XML API dibuat: ilustrasi dari salah satu arsitek kami. Ngomong-ngomong, tunggu artikelnya."><br>  <i>Bagaimana XML API dibuat: ilustrasi dari salah satu arsitek kami.</i>  <i>Ngomong-ngomong, tunggu artikelnya.</i> <br><br>  Inilah kesalahan utama kami: <br><br><ol><li>  Markup JAXB dilakukan langsung pada kacang entitas.  Kami menggunakan Hibernate untuk berkomunikasi dengan database, dan markup JAXB dibuat pada kacang yang sama.  Kesalahan ini segera muncul: setiap pembaruan pada struktur data mengarah pada kebutuhan untuk segera memberi tahu siapa pun yang menggunakan API, atau untuk membangun kruk yang akan memastikan kompatibilitas dengan struktur data sebelumnya. </li><li>  API tumbuh sebagai tambahan, dan pada awalnya kami tidak menentukan bagian produk apa yang dibuatnya.  Kami bahkan tidak memikirkan apakah API itu sesuatu yang penting, apakah perlu mempertahankan kompatibilitas ke belakang untuk pelanggan pertama.  Pada titik tertentu, jumlah pengguna API adalah sekitar 5% dari total jumlah kecil, dan tidak ada perhatian diberikan kepada mereka.  Pemfilteran universal yang dibuat pada waktunya telah menyebabkan kami menjadi digunakan sebagai backend.  Pemfilteran ini sama sekali bukan GraphQL, tetapi sesuatu seperti itu - itu berfungsi melalui banyak parameter string kueri.  Dengan alat yang sangat kuat, sulit bagi pengguna untuk menolak, dan permintaan dikirim kepada kami sehingga mereka dikirim langsung dari UI toko online mereka.  Situasi ini merupakan kejutan yang tidak menyenangkan, karena penyediaan layanan seperti itu harus memerlukan penagihan berbeda dan pemahaman yang berbeda tentang API itu sendiri sebagai produk. </li><li>  Karena fakta bahwa API tidak berkembang sebagai produk utama, dokumentasi API diproduksi dan diterbitkan sesuai dengan prinsip residu - melalui rekayasa balik.  Cara ini tampaknya cukup sederhana dan nyaman, tetapi bertentangan dengan pekerjaan kontrak.  Ini terjadi ketika ada komponen tertentu dengan skema kerja yang telah ditentukan.  Pengembang mengimplementasikannya sesuai dengan skema dan tugas ini, komponen diuji, klien menerima produk yang cocok dengan ide analis.  Reverse engineering, di sisi lain, melempar produk yang hanya ada: dengan kruk, solusi aneh dan sepeda alih-alih fungsionalitas yang diperlukan. </li><li>  Seluruh aliran permintaan yang datang melalui API dapat dianalisis tidak lebih dari log Nginx atau server aplikasi.  Ini tidak memungkinkan kami untuk mengisolasi area subjek, kecuali mungkin membaginya dengan pengguna dan pelanggan.  Jika tidak mungkin untuk mengatur pendaftaran aplikasi atau klien, menjadi tidak mungkin untuk menganalisis situasi.  Masalah ini memiliki dampak paling kecil pada pengembangan API, lebih pada memahami relevansi dan fungsionalitasnya. </li></ol><br><h2>  Percobaan nomor dua: REST API </h2><br>  Pada 2010, kami mencoba membangun sistem pertukaran dengan akuntansi online - BukhSoft.  Tidak lepas landas.  Tetapi dalam proses integrasi, API lengkap muncul: layanan pertukaran REST, di mana tidak ada kebebasan seperti panggilan ke operasi dalam bentuk panggilan RPC.  Semua komunikasi dengan API dibawa ke mode standar untuk istirahat: string kueri berisi nama entitas, dan operasi yang dilakukan dengannya diatur menggunakan metode http.  Kami menambahkan pemfilteran pada saat memperbarui entitas, dan pengguna sekarang memiliki kesempatan untuk membangun replikasi dengan sistem mereka. <br><br>  Pada tahun yang sama, sebuah API muncul untuk menurunkan saldo gudang dan komoditas.  Bagian paling berharga dari sistem menjadi tersedia bagi pengguna melalui API - pertukaran dokumen utama dan perkiraan data tentang saldo dan biaya barang. <br><br>  Pada bulan Desember 2015, RetailCRM menerbitkan perpustakaan pihak ketiga pertama untuk mengakses API kami.  Mereka mulai menggunakannya dengan cukup aktif, sementara popularitas layanan secara keseluruhan tumbuh, beban pada API tumbuh lebih cepat daripada beban pada antarmuka web.  Sekali, pertumbuhan berubah menjadi lompatan dalam beban. <br><br><img src="https://habrastorage.org/webt/8h/1p/no/8h1pnokzk8grz6kcs3ok0b1txua.png" alt="Di sini jatuhnya Black Hawk. Atau menyapu yang kami lalui."><br><br><img src="https://habrastorage.org/webt/2n/ry/4h/2nry4hnfml6miv4axqp_cxrgthy.png" alt="Solusinya sederhana - berikan semua orang sumber daya yang sama."><br><br>  Dan lompatan ini, yang diperlihatkan oleh panah di sebelah kiri, menyebabkan kekaguman server yang melayani API kami.  Selama satu minggu kami memahami apa yang sebenarnya dihasilkan oleh beban ini.  Ternyata inilah permintaan yang disiarkan ke API kami dari depan klien.  Sekitar 50 pelanggan memakan semuanya.  Saat itulah kami menyadari salah satu kesalahan kami - tidak adanya batasan. <br><br>  Sebagai hasilnya, kami memperkenalkan batasan jumlah permintaan simultan.  Dari satu akun menjadi mungkin untuk secara bersamaan membuka tidak lebih dari dua permintaan.  Ini cukup untuk bekerja dalam mode replikasi untuk bertukar data dalam mode batch.  Dan mereka yang ingin menggunakan kami sebagai backend, sejak saat itu dipaksa untuk lebih mematuhi tarif, karena mereka memperkenalkan pekerjaan pada beberapa akun ke dalam perangkat lunak mereka. <br><br><h2>  Rapikan </h2><br>  Sejak 2014, permintaan untuk API yang ada telah menjadi bagian penting dari bisnis, dan API itu sendiri menghasilkan jumlah data terbesar dalam pertukaran data dengan pelanggan.  Pada 2015, kami meluncurkan proyek untuk membersihkan API.  Kami memilih JSON alih-alih XML sebagai format dan mulai membangunnya berdasarkan fitur yang diungkapkan selama implementasi versi sebelumnya: <br><br><ol><li>  Kemampuan mengelola versi.  Versi memungkinkan Anda untuk mengembangkan versi baru tanpa mempengaruhi aplikasi yang ada dan tanpa mengganggu pengguna. </li><li>  Kemampuan bagi pengguna untuk melihat metadata dalam respons yang ia terima. </li><li>  Kemampuan untuk bertukar dokumen besar.  Jika kami memproses dokumen dengan jumlah posisi lebih dari 4-5 ribu, ini menjadi masalah bagi server: transaksi panjang, permintaan http panjang.  Kami membangun mekanisme khusus yang memungkinkan Anda untuk memperbarui dokumen di bagian-bagian dan mengelola posisi masing-masing dokumen ini dengan mengirimkannya ke server. </li><li>  Alat untuk replikasi - ada di versi sebelumnya. </li><li>  Batas beban seperti warisan rake yang telah diinjak di versi sebelumnya.  Batas yang diperkenalkan pada jumlah permintaan dalam periode waktu, jumlah permintaan dan permintaan bersamaan dari satu alamat ip. </li></ol><br>  Sejak saat itu, kami merilis dua versi minor API dan meluncurkan beberapa API khusus, tetapi secara umum pendekatannya tetap tidak berubah.  Format pertukaran yang diperbarui dan arsitektur baru telah memungkinkan untuk memperbaiki kekurangan di API lebih cepat. <br><br><h2>  API MyStore hari ini </h2><br>  Hari ini API MyStore memecahkan banyak masalah: <br><br><ul><li>  pertukaran data dengan toko online, sistem akuntansi, bank; </li><li>  menerima data penyelesaian, laporan; </li><li>  gunakan sebagai backend untuk aplikasi klien - aplikasi seluler dan meja kas desktop kami berfungsi melalui API </li><li>  mengirim pemberitahuan tentang perubahan data di MyStore - webhooks; </li><li>  telepon; </li><li>  sistem loyalitas. </li></ul><br>  Berdasarkan API, CEO kami, Askar Rakhimberdiev, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">badak</a> dalam waktu empat jam menulis bot telegram yang memuat sisanya melalui API: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github.com/arahimberdiev/com-lognex-telegram-moysklad-stock</a> <br><br>  Sekarang angka kering. <br><br>  Berikut statistik kami untuk API REST lama: <br><br><ul><li>  400 perusahaan; </li><li>  600 pengguna; </li><li>  2 juta permintaan per hari; </li><li>  200 Gb / hari lalu lintas keluar. </li></ul><br>  Dan inilah yang kami sadari dengan semua MyStore API: <br><br><ul><li>  lebih dari 70 integrasi (beberapa di antaranya dapat ditemukan di sini <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">www.moysklad.ru/integratsii</a> ); </li><li>  8500 perusahaan; </li><li>  12.000 pengguna; </li><li>  46 juta permintaan per hari; </li><li>  2 Tb / hari untuk lalu lintas keluar. </li></ul><br><h2>  Apa selanjutnya </h2><br>  Rencana pengembangan API sedang dalam diskusi aktif.  Kami mencoba mempertimbangkan pengalaman pengoperasian yang diberikan pengguna kepada kami.  Tidak selalu dan tidak semuanya ternyata dilakukan segera, tetapi tidak jauh adalah versi baru dari API dengan metadata yang lebih nyaman dan struktur yang lebih ringan, OAuth untuk otentikasi, API untuk aplikasi yang dibangun ke dalam antarmuka. <br><br>  Anda dapat mengikuti berita di situs khusus untuk pengembang integrasi dengan MySklad: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dev.moysklad.ru</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id453136/">https://habr.com/ru/post/id453136/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id453120/index.html">Cara melindungi 5G dari peretasan: menjelajahi arsitektur keamanan</a></li>
<li><a href="../id453122/index.html">Kontes Pemrograman Pahlawan Kotlin</a></li>
<li><a href="../id453126/index.html">Penampilan UIA tidak sesederhana itu</a></li>
<li><a href="../id453128/index.html">Intisari telekomunikasi: 15 materi ahli tentang IPv6, IS, standar dan undang-undang di bidang TI</a></li>
<li><a href="../id453130/index.html">Kode korektif sistematis. Kode Grup Linier</a></li>
<li><a href="../id453138/index.html">Seni dan sains: proyek VITAE - banyak sidik jari di bunga bulan</a></li>
<li><a href="../id453140/index.html">Siapa yang mencuri waktu CPU virtual?</a></li>
<li><a href="../id453146/index.html">Cara memanfaatkan konferensi secara maksimal</a></li>
<li><a href="../id453148/index.html">AirBnb mengabaikan akunnya</a></li>
<li><a href="../id453154/index.html">Sejarah Internet: Meningkatkan Interaktivitas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>