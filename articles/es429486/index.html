<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>げ   JunOS: Prevenci贸n de sesiones de reinicio de MP-BGP   </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Al configurar MP-BGP, en el hardware de Juniper, puede surgir una situaci贸n de restablecimiento del vecindario (no) obvia. La raz贸n se describe en det...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>JunOS: Prevenci贸n de sesiones de reinicio de MP-BGP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429486/"><p>  Al configurar MP-BGP, en el hardware de Juniper, puede surgir una situaci贸n de restablecimiento del vecindario (no) obvia.  La raz贸n se describe en detalle en la base de conocimiento <strong>Junuper KB20870</strong> , aqu铆 hay un breve recuento con mis comentarios. <a name="habracut"></a></p><br><p>  Como sabes, cuando trabajas con VPN, se utilizan varias tablas de enrutamiento.  Estaremos interesados en 2 principales: <em>vrf.inet.0</em> y <em>bgp.l3vpn.0</em> (en adelante, se describe la situaci贸n con L3VPN, pero esto tambi茅n es cierto para otros servicios donde BGP es un protocolo de se帽alizaci贸n). </p><br><p>  La tabla <em>bgp.l3vpn.0</em> contiene todas las rutas recibidas de los vecinos BGP. </p><br><p>  Las rutas directas / est谩ticas de un enrutador PE espec铆fico se colocan en la tabla <em>vrf.inet.0</em> , as铆 como las rutas entrantes de los vecinos de la tabla <em>bgp.l3vpn.0</em> que satisfacen la pol铆tica de importaci贸n (si est谩 configurada). <br>  Al mismo tiempo, no se exporta desde <em>vrf.inet.0</em> a <em>bgp.l3vpn.0</em> , y las rutas se anuncian directamente a los vecinos. </p><br><p> Si el enrutador act煤a como un reflector de ruta, o si hay vecinos MP eBGP, las rutas se colocan tanto en la tabla <em>vrf.inet.0</em> como en <em>bgp.l3vpn</em> .  En este caso, se realiza una comparaci贸n con las rutas locales y (si es necesario) se selecciona la mejor ruta. </p><br><p>  Por lo tanto, el enrutador puede funcionar en uno de los dos modos definidos: </p><br><ul><li>  no hay reflector de enrutador configurado en el enrutador y no hay vecinos eBGP; </li><li>  el enrutador es un reflector de ruta y / o hay vecinos eBGP en 茅l. </li></ul><br><p>  Cambiar los modos implica reiniciar las sesiones MP-BGP.  Claramente, esto se puede ver en la siguiente topolog铆a: </p><br><p><img src="https://habrastorage.org/webt/-r/mb/q8/-rmbq8refiwmktfmgwpqs8dgtcg.png"></p><br><p>  En la primera versi贸n (Fig. 1), se presenta el esquema cl谩sico iBGP de malla completa.  Ahora imagine que necesitamos agregar el enrutador R4.  Por una raz贸n u otra, decidimos hacer esto configurando R1 como reflector de ruta para R4 (Fig. 2).  Realizar la configuraci贸n del reflector de ruta en R1 implicar谩 la reinstalaci贸n de todas las sesiones MP-BGP (con enrutadores R2 y R3), lo que implicar谩 un tiempo de inactividad en la prestaci贸n de servicios. </p><br><p>  Para evitar esto, se propone transferir firmemente el enrutador al segundo modo de operaci贸n.  Una forma es crear un grupo ficticio eBGP.  Por ejemplo: </p><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">group</span></span> fake-vpn { <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">external</span></span>; description "## Preventing mpbgp sessions flap ##"; passive; <span class="hljs-keyword"><span class="hljs-keyword">family</span></span> <span class="hljs-type"><span class="hljs-type">inet</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">any</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">family</span></span> <span class="hljs-type"><span class="hljs-type">inet</span></span>-vpn { <span class="hljs-keyword"><span class="hljs-keyword">any</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">family</span></span> iso-vpn { unicast; <span class="hljs-keyword"><span class="hljs-keyword">family</span></span> l2vpn { signaling; <span class="hljs-keyword"><span class="hljs-keyword">family</span></span> evpn { signaling; <span class="hljs-keyword"><span class="hljs-keyword">family</span></span> <span class="hljs-type"><span class="hljs-type">inet</span></span>-mvpn { signaling; <span class="hljs-keyword"><span class="hljs-keyword">family</span></span> <span class="hljs-type"><span class="hljs-type">inet</span></span>-mdt { signaling; neighbor <span class="hljs-number"><span class="hljs-number">192.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> { peer-<span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-number"><span class="hljs-number">65536</span></span>; }</code> </pre> <br><p>  AS: 65536 e IP: 192.0.2.1 pueden ser absolutamente cualquier cosa, y el modo pasivo le permite evitar intentos innecesarios de establecer una sesi贸n inexistente desde el enrutador. </p><br><p>  Cuando puede ser 煤til: </p><br><ul><li>  No hay reflectores de ruta dedicados en la red.  El papel de RR son los enrutadores principales de la red.  Al mismo tiempo, existe la posibilidad de un cambio en su funci贸n (por ejemplo, de un enrutador P a un P / RR o viceversa); </li><li>  existe la posibilidad de que aparezca una interfaz eBGP con la familia MP-BGP, por ejemplo, Inter-AS. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es429486/">https://habr.com/ru/post/es429486/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es429472/index.html">Docker Compose + Consul + Spring Boot + FeignClient</a></li>
<li><a href="../es429474/index.html">El resumen de materiales interesantes para el desarrollador m贸vil # 274 (del 5 al 11 de noviembre)</a></li>
<li><a href="../es429478/index.html">Dise帽o del juego: un nuevo enfoque para los niveles de dificultad</a></li>
<li><a href="../es429482/index.html">Problemas de acceso a datos personales en nombre de todos los participantes en el proceso.</a></li>
<li><a href="../es429484/index.html">Nuevamente sobre las entrevistas, pero en pa铆ses extranjeros.</a></li>
<li><a href="../es429488/index.html">Supercomputadora de placa 煤nica NanoPi Fire3 de 96 n煤cleos</a></li>
<li><a href="../es429490/index.html">Gesti贸n del tiempo sin horarios estrictos, experiencia en el desarrollo de una aplicaci贸n m贸vil.</a></li>
<li><a href="../es429494/index.html">Dagaz: detalles</a></li>
<li><a href="../es429496/index.html">L谩ser de sable de luz casero: c贸mo fue. Parte 2</a></li>
<li><a href="../es429498/index.html">4 razones para la dilaci贸n (texto)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>