<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè¢ üõÄüèΩ üìó Kit de d√©marrage des tests de s√©curit√© Web üë®üèæ‚Äçüî¨ üèéÔ∏è üë´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous! 

 Je m'appelle Andrey. Depuis 10 ans, je recherche des vuln√©rabilit√©s dans divers services Web. et pr√™t √† partager mes connaissances ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kit de d√©marrage des tests de s√©curit√© Web</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/semrush/blog/441966/"> Bonjour √† tous! <br><br>  Je m'appelle Andrey.  Depuis 10 ans, je recherche des vuln√©rabilit√©s dans divers services Web.  et pr√™t √† partager mes connaissances avec vous.  En mai dernier, j'ai fait un rapport √† ce sujet lors de la conf√©rence de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Heisenbug</a> , et maintenant je suis pr√™t √† partager mes connaissances ici aussi, dans les espaces ouverts de Habr.  Commen√ßons donc. <br><br>  Une fois, j'ai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">trouv√© une vuln√©rabilit√©</a> sur les serveurs de la c√©l√®bre soci√©t√© Facebook.  Les gars ont oubli√© de mettre √† jour ImageMagick (la biblioth√®que pour le traitement d'image) et l'ont pay√© :) Avec cet exemple, je voulais montrer que nous sommes tous des gens et que nous pouvons tous faire des erreurs, peu importe dans quelles entreprises et dans quelles positions nous travaillons.  Le seul probl√®me est que ces erreurs peuvent entra√Æner toutes sortes de risques. <br>  Plus votre application / site Web / outil est compliqu√©, plus il est probable que quelque chose tourne mal. <br>  Vous devez v√©rifier les vuln√©rabilit√©s.  Il est stupide de ne pas le faire du tout. <br><a name="habracut"></a><br>  Les √©l√©ments suivants peuvent √™tre des √©tapes de v√©rification des applications Web: <br><ul><li>  Pr√©paration: <ul><li>  D√©finissez les points d'entr√©e - en fait, d'o√π les donn√©es peuvent provenir dans l'application; </li><li>  Identifier le stock technologique; </li><li>  D√©terminez quelles vuln√©rabilit√©s il est logique de v√©rifier; </li></ul></li><li>  V√©rification  Vous devez v√©rifier toutes les vuln√©rabilit√©s qui s'appliquent √† l'√©tendue de la technologie de votre application Web; </li><li>  Analyse de code.  Ne soyez pas paresseux, ne sautez pas cet article.  Dans certains cas, sans acc√®s au code, il est difficile de trouver des vuln√©rabilit√©s, ce qui vous permet √©galement de contourner le filtrage qui peut √™tre int√©gr√© dans votre application. </li></ul><br>  Je vais parler de tout cela en d√©tail. <br><br>  Alors, pr√©paration.  Je ne me concentrerai pas sur tous les types de vuln√©rabilit√©s, sinon la quantit√© de texte dans l'article d√©passera toutes les tailles imaginables et inconcevables.  Je vous conseille de commencer √† apprendre √† partir de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">liste des dix meilleurs projets OWASP</a> .  Toutes les quelques ann√©es, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le consortium OWASP</a> forme une liste des vuln√©rabilit√©s les plus pertinentes √† l'heure actuelle.  Nous en examinerons quelques-unes en d√©tail. <br><br><h2>  Xss </h2><br>  <i>XSS (cross-site scripting)</i> est une attaque contre un utilisateur qui permet √† un attaquant d'ex√©cuter un script arbitraire dans le contexte du navigateur de sa victime.  Le plus souvent, cela implique la mise en place de balises <i>HTML</i> et de scripts <i>JS</i> . <br>  Exemple: √† un moment donn√©, un tel service existait sur <i>Yahoo!</i>  <i>Ad Exchange</i>  Le formulaire de r√©cup√©ration de mot de passe avait un param√®tre " <i>URL de retour</i> ".  Il pourrait indiquer √† quelle page retourner apr√®s le processus de r√©initialisation du mot de passe.  Si vous y ins√©rez l'un ou l'autre vecteur conduisant √† l'ex√©cution du code <i>JS</i> , vous pouvez obtenir tous les <i>cookies de</i> l'utilisateur.  Nous analyserons comment cela se produit et pourquoi. <br><img src="https://habrastorage.org/webt/0m/uz/t0/0muzt08lkueaenx2gle8ydaidce.png"><br><br>  Voici le vecteur lui-m√™me.  Tout √† la fois: <br><img src="https://habrastorage.org/webt/ua/ko/8l/uako8l_hpqr4bov7qmzhm97xwj4.png"><br>  Pour faire une injection, vous devez sortir du contexte de la variable dans laquelle nous nous trouvions par d√©faut (par d√©faut - c'est ce que le programmeur a suppos√© quand il a √©crit le code). <br>  Voici la valeur d'origine.  Ceci est un comportement valide. <br><img src="https://habrastorage.org/webt/v4/rm/l7/v4rml7dzf1rqpkyvgq8yxdnl3oi.png"><br>  Nous voyons que returnURL = / login.jsp <br>  Cela tombe dans la valeur de la <i>balise &lt;input&gt;</i> . <br>  Si nous ajoutons un guillemet apr√®s <i>jsp</i> , nous verrons que la syntaxe <i>HTML</i> a coul√©.  Heureusement, le langage <i>HTML</i> n'est pas strict, l'analyseur va sauter et il n'y aura aucun probl√®me: <br><img src="https://habrastorage.org/webt/3o/s6/z1/3os6z130clrrtkshbktmqgkguto.png"><br>  Ajoutez un autre caract√®re.  Ici, nous sommes compl√®tement hors du contexte de la <i>balise &lt;input&gt;</i> : <br><img src="https://habrastorage.org/webt/lg/x9/av/lgx9avfst6nskdlowyzx0uasgyy.png"><br>  Maintenant, nous ajoutons l'ouverture de la <i>balise &lt;svg&gt;</i> , et nous obtenons deux balises valides en termes de syntaxe: <br><img src="https://habrastorage.org/webt/u8/pe/tg/u8petg6ghf1gajt49dvsvtfnzn0.png"><br>  Ensuite, ajoutez le vecteur d'attaque entier: <br><img src="https://habrastorage.org/webt/o2/t5/n8/o2t5n8-li9jpdao1cbzghum-mhe.png"><br>  Dans ce cas, l'image <i>svg</i> est dessin√©e.  En utilisant le gestionnaire <i>JavaScript</i> " <i>onload</i> ", nous ex√©cutons une alerte avec les <i>cookies du</i> document.  C‚Äôest tout!  L'attaquant a re√ßu vos <i>cookies</i> . <br>  Si dans la preuve nous ne montrons que l'alerte elle-m√™me, il ne sera pas difficile pour un attaquant d'envoyer des cookies √† un serveur qu'il contr√¥le et, dans le pire des cas, de saisir votre compte.  Voyons √† quoi √ßa ressemble √† nouveau: <br><img src="https://habrastorage.org/webt/0m/uz/t0/0muzt08lkueaenx2gle8ydaidce.png"><br><br>  Il existe √©galement plus de vecteurs d'attaque sur le client.  Je vais donner quelques exemples avec une br√®ve description.  Mais vous devez d'abord comprendre comment sortir de son contexte: <br><ul><li>  Hors contexte.  Ces 6 caract√®res aideront √† sortir non seulement du contexte de la valeur du param√®tre HTML, mais aussi de beaucoup d'autres: <br>  -&gt; '"&gt; <br></li></ul><br>  Eh bien, en fait, les deux vecteurs d'attaque les plus simples: <br><ul><li>  Ins√©rez des liens en particulier.  Mais dans le cas g√©n√©ral - changer l'apparence de la page.  Par exemple, ils peuvent incorporer du code html dans votre page et afficher une fausse fen√™tre demandant des donn√©es: <br><img src="https://habrastorage.org/webt/dt/-p/yz/dt-pyzv0wcrhgxqihw3iuoccbnc.png"><br>  La cha√Æne " <i>aaaa</i> " pointe vers <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">google.com</a> .  Vous pouvez voir que le lien est rendu sur la page, mais vous ne pouvez pas le voir, mais cela n'annule pas sa pr√©sence dans le code.  Dans les deux cas, le dossier peut √™tre consid√©r√© comme termin√©; </li><li>  Ex√©cution de script, par exemple, interception de <i>cookies</i> utilisateur: <br><img src="https://habrastorage.org/webt/w8/yd/yb/w8ydybkf9oucxuawq_vumapupda.png"><br></li></ul><br><br><h3>  O√π et comment rechercher XSS? </h3><br>  Tout d'abord, recherchez les fonctions de sortie des informations / donn√©es sur la page.  Analyser quelles donn√©es y parviennent?  Voici le concept d'une <i>source non fiable</i> .  Et tel est tout d'abord <i>votre utilisateur</i> .  Les vecteurs d'attaque peuvent √™tre contenus dans n'importe quelle autre source: flux RSS, autres services, externes et internes. <br>  Voici un exemple concret: je travaille pour SEMrush IT.  Nous d√©veloppons une plateforme en ligne, qui est un outil universel pour les sp√©cialistes du marketing en ligne.  Donc, un service a enregistr√© des donn√©es pour nous, l'autre en a d√©duit, chacune des √©quipes s'est appuy√©e les unes sur les autres, il s'est av√©r√© que sur le deuxi√®me service, <i>XSS</i> est survenu en raison du manque de traitement appropri√© des donn√©es de sortie, et la premi√®re commande n'a pas jug√© n√©cessaire de filtrer les donn√©es entrantes en aucune fa√ßon et les a gard√©s " <i>tels</i> quels".  Conclusion: si vous ne savez pas comment telle ou telle donn√©e est stock√©e, elles doivent √™tre consid√©r√©es comme non fiables.  Ou convenez √† l'avance de qui stocke et comment, filtre, affiche les donn√©es. <br><br>  Si vous disposez d√©j√† de donn√©es provenant de sources non fiables, je recommande: <br><ul><li>  Etudier le filtrage des donn√©es entrantes; </li><li>  Examinez le contexte de la sortie.  Dans tous les cas, <i>XSS</i> ne peut pas √™tre ex√©cut√©, m√™me en l'absence de filtrage.  Par exemple, si le <i>type de contenu de la</i> r√©ponse est: <i>text / plain;</i> </li><li>  Ne vous fiez pas au filtrage des cadres des syst√®mes de s√©curit√© int√©gr√©s. </li></ul><br><br><h2>  Injection SQL </h2><br><img src="https://habrastorage.org/webt/do/b8/ry/dob8ryjj2vifp3w1th18oroewis.png"><br><br>  <i>Impl√©mentation du code SQL (injection SQL anglaise)</i> - l'introduction dans la requ√™te de la base de donn√©es d'instructions qui n'y √©taient pas impliqu√©es. <br><br>  Exemple (pas de la vie, mais aussi bon): <br>  Nous voyons un script qui affiche une table utilisateur.  Dans ce cas, il peut effectuer une recherche par nom d'utilisateur. <br>  Sur la droite est montr√© √† quoi ressemble la requ√™te vers la base de donn√©es, et sur la gauche est le r√©sultat du script dans le navigateur. <br><img src="https://habrastorage.org/webt/ng/u2/ou/ngu2ouq8da3jtb18gkjj2amzxss.png"><br>  De plus, afin de tester et d'obtenir au moins un r√©sultat primaire, nous ins√©rons deux guillemets dans la valeur du param√®tre name.  Simple et double: <br><img src="https://habrastorage.org/webt/0a/fd/ck/0afdckohg1xuacw-7olxyrzifha.png"><br>  On voit que du point de vue de la sortie, tout s'est effondr√©, le tableau a compl√®tement disparu.  La demande obtient √©galement les 2 guillemets suppl√©mentaires.  Toute la syntaxe de la requ√™te <i>SQL</i> est viol√©e. <br>  Si nous prenons et ajoutons une telle construction √† la valeur du param√®tre ( <i>√©d .: regardez dans la bo√Æte jaune</i> ), nous obtenons une demande absolument valide.  La sortie de la page est compl√®tement identique √† la premi√®re requ√™te, qui ne comprenait pas d'injection: <br><img src="https://habrastorage.org/webt/nh/9q/gu/nh9qguk8d0unxfz1bsxlfb0n8vo.png"><br>  Afin de v√©rifier pleinement qu'il existe une vuln√©rabilit√©, nous ajoutons un deuce au lieu de l'unit√©: <br><img src="https://habrastorage.org/webt/lx/je/a6/lxjea6hv3hebohiv96gpauuo4o0.png"><br>  Il s'av√®re que la demande devient fausse, du point de vue de la logique bool√©enne et, par cons√©quent, ne contient pas de donn√©es.  Cependant, contrairement au moment o√π nous avons eu une erreur, nous avons la sortie de la table elle-m√™me. <br><br>  Afin de ne pas r√©pertorier tout ce qui peut se trouver dans diff√©rents moteurs de base de donn√©es et requ√™tes de diff√©rents types, j'ai tout r√©duit √† une seule ligne: <br><img src="https://habrastorage.org/webt/xz/ok/mn/xzokmnhyzqdepnyax-n1bzd8siq.png"><br>  C'est quelque chose que vous pouvez essayer d'entrer dans le param√®tre, puis, selon les diff√©rences dans les r√©ponses, essayer de comprendre ce qui se passe, y a-t-il une vuln√©rabilit√© ou non?  Environ 80% des cas que vous pouvez couvrir avec cette manipulation. <br>  Il reste 20% de situations difficiles dans lesquelles il ne vous donnera aucune information, par exemple: requ√™tes imbriqu√©es / filtrage et ainsi de suite.  Dans ma pratique, je n'ai rencontr√© un semblable qu'une seule fois.  Ensuite, j'ai d√ª contourner le filtrage c√¥t√© service. <br><br>  Quel est le danger en SQL? <br><ul><li>  De l'√©vidence - <i>fuite d'informations</i> .  Si un attaquant a pu g√©n√©rer des requ√™tes vers vos bases de donn√©es, il peut d'une mani√®re ou d'une autre obtenir des valeurs qui n'√©taient pas destin√©es √† la sortie (hachages de mot de passe, adresses client, etc.); </li><li>  <i>Changement de donn√©es</i> .  Maintenant, de nombreux d√©veloppeurs utilisent des bases de donn√©es via des syst√®mes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ORM</a> .  Ces syst√®mes eux-m√™mes, par d√©faut, vous permettent de faire plusieurs requ√™tes √† la fois, la syntaxe SQL vous permet √©galement de le faire.  S'il y a une vuln√©rabilit√©, tout peut se tourner non seulement vers la s√©lection des donn√©es, mais aussi vers leur modification (jusqu'√† la suppression des tables, la modification de la structure de la base de donn√©es, etc.). <br>  Dans la m√™me situation, une augmentation des privil√®ges utilisateur est possible.  Modifiez les champs de certaines tables (par exemple, mettez <i>is_admins = true</i> dans la base de donn√©es des <i>utilisateurs</i> ) et augmentez ainsi vos droits √† l'administrateur; </li><li>  <i>DoS</i> .  Dans certains cas, une injection peut entra√Æner un d√©ni de service.  Plusieurs requ√™tes lourdes vers la base de donn√©es sont g√©n√©r√©es, lanc√©es dans plusieurs threads et votre service peut cesser de fonctionner pendant un certain temps; </li><li>  <i>La lecture des fichiers syst√®me</i> est un autre d√©sastre que l'injection SQL peut apporter.  L'occurrence de ce risque d√©pend du syst√®me de base de donn√©es que vous utilisez, ainsi que de l'utilisateur qui travaille avec (privil√©gi√© ou non); </li><li>  <i>RCE (Remote Code Execution)</i> est l'ex√©cution de code.  Cela d√©pend directement du type de base de donn√©es utilis√© (auparavant, cela √©tait possible par d√©faut, avec les param√®tres de base de donn√©es par d√©faut, dans MSSQL). </li></ul><br>  Le tableau ci-dessous montre les vuln√©rabilit√©s de la requ√™te <i>SQL</i> .  Bien s√ªr, vous n'avez pas besoin de le m√©moriser.  De plus, ce ne sont pas toutes les options possibles, mais simplement des exemples.  Faites juste attention au fait que les endroits o√π l'injection dans la requ√™te <i>SQL</i> peut se produire si des donn√©es brutes y arrivent sont surlign√©s en rouge.  Un attaquant exp√©riment√© peut trouver un moyen d'exploiter cela.  Soyez prudent et attentif. <br><img src="https://habrastorage.org/webt/gz/bt/xh/gzbtxhbbrkng9axlc2av07rax9o.png"><br><br><h2>  SSRF (falsification de requ√™te c√¥t√© serveur) </h2><br>  Traduction litt√©rale - fausses requ√™tes c√¥t√© serveur.  C'est-√†-dire, une attaque qui vous permet de manipuler les donn√©es que vous envoyez √† l'application, vous for√ßant √† faire la demande pour ne pas o√π la logique m√©tier initialement pr√©vue. <br>  Le fonctionnement de <i>SSRF est</i> illustr√© dans l'image ci-dessous: <br><img src="https://habrastorage.org/webt/cn/3m/xc/cn3mxclin9jb7tr5fdg6zcowez8.png"><br>  Il y a un attaquant, il y a votre serveur, qui est ferm√© par le <i>pare</i> - <i>feu</i> , mais en m√™me temps il y a une fonctionnalit√© qui vous permet de faire plus de requ√™tes au nom du serveur. <br>  Si cette fonctionnalit√© n'est pas correctement prot√©g√©e et / ou incorrectement, comme cela arrive g√©n√©ralement :), traite les donn√©es entrantes, l'attaquant peut se tourner vers <i>Memcached</i> , <i>Redis</i> ou acc√©der √† toutes les ressources internes de la victime. <br><br>  Pour un exemple plus illustratif, consid√©rons le stand que SEMrush utilise pour la formation interne des employ√©s. <br>  Il est important de faire attention √† la signification de "l' <i>URL de l'avatar</i> ": <br><img src="https://habrastorage.org/webt/yi/yp/fr/yiypfrzdsu-pqg0adlbup1ziqgk.png"><br>  Ici, nous pr√™tons attention √† 2 points: <br><ul><li>  URL de l'avatar elle-m√™me </li><li>  et la possibilit√© de le t√©l√©charger √† l'aide d'un fichier. </li></ul><br>  Veuillez noter que le champ " <i>URL de l'avatar</i> " est un champ de texte pour la saisie, ce qui signifie que nous pouvons manipuler cette valeur.  Essayons de mettre l'avatar, peut-√™tre, l'image la plus c√©l√®bre sur Internet - Googlebot de la page d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">erreur 404</a> . <br>  Faites-le une fois: <br><img src="https://habrastorage.org/webt/hg/8d/oa/hg8doavbzbji9apfewlydlpxhyq.png"><br>  Faites deux - cliquez sur " <i>Enregistrer</i> ".  Nous obtenons un robot √† la place de ma photo: <br><img src="https://habrastorage.org/webt/kf/4x/lr/kf4xlr2atwvebex_dmsiqlxvmbi.png"><br>  Ici, il convient de pr√™ter attention au fait que la valeur de "l' <i>URL de l'avatar</i> " a chang√©, en un chemin local - apparemment, l'application a demand√© une image, l'a enregistr√©e sur le serveur et a substitu√© une nouvelle valeur. <br><br>  Nous continuons.  Dans le champ " <i>URL avatar</i> ", entrez le <i>fichier de</i> valeur <i>: /// etc / passwd</i> .  Cette conception vous permet d'acc√©der √† la structure du fichier.  Dans certaines biblioth√®ques qui fonctionnaient avec <i>HTTP</i> , par d√©faut, la structure de fichiers est activ√©e et re√ßoit des donn√©es des serveurs sur lesquels elles ont √©t√© lanc√©es: <br><img src="https://habrastorage.org/webt/_j/2i/jb/_j2ijbofjimkfmd2tjxmoegkh4k.png"><br>  Que se passe-t-il apr√®s avoir cliqu√© sur le bouton " <i>Enregistrer</i> "? .. <br>  Premi√®rement, l'image est devenue ¬´ <i>chauve-souris</i> ¬ª et, deuxi√®mement, le chemin d'acc√®s au fichier a chang√©. <br><img src="https://habrastorage.org/webt/bn/ro/d5/bnrod5bxckue0avxxbvvktglimg.png"><br>  Si nous essayons de demander cette image dans le navigateur, ils ne nous montreront rien (le fichier est ¬´ <i>cass√©</i> ¬ª).  Mais nous ne sommes pas le premier jour de la s√©curit√© de l'information, nous savons quoi faire :) Par de simples manipulations nous obtenons le contenu du fichier sur notre ordinateur: <br><img src="https://habrastorage.org/webt/vd/sw/97/vdsw97u1ce8abtqa2aqcp_zb2ac.png"><br>  Ainsi, √† l'aide de cette vuln√©rabilit√©, en tant qu'attaquant, je peux obtenir tous les codes source de votre service et d'autres donn√©es disponibles pour lecture √† l'utilisateur qui ex√©cute le service Web. <br>  Regardons les dangers de SSRF: <br><ul><li>  Balayage de port.  Pour un r√©seau externe, votre service est un point d'entr√©e et 2 ports (http et https).  En scannant les ports depuis l'int√©rieur de votre infrastructure, un attaquant peut d√©tecter les ports ouverts; </li><li>  Contournez l'authentification bas√©e sur l'h√¥te.  √Ä quoi √ßa sert?  Il est possible qu'au sein de votre structure, il existe des services qui ne sont disponibles que pour certaines ressources (lire: liste blanche IP).  Donc, si votre serveur vuln√©rable est dans la liste blanche, vous avez acc√®s aux services qui lui sont disponibles et, par cons√©quent, vous pouvez les manipuler; </li><li>  En poursuivant le d√©veloppement de l'attaque susmentionn√©e, vous pouvez continuer √† exploiter les programmes vuln√©rables s'ex√©cutant sur l'intranet ou sur le serveur local.  Tr√®s souvent, il existe des situations o√π l'infrastructure interne, inaccessible de l'ext√©rieur, est mal surveill√©e (les versions / correctifs de s√©curit√©, etc. ne sont pas toujours mis √† jour).  Cela peut √©galement entra√Æner des attaques et des vols de donn√©es; </li><li>  Lecture des donn√©es locales.  Je l'ai montr√© ci-dessus avec un exemple.  Vos configurations peuvent √™tre lues et accessibles, jetons et mots de passe. </li></ul><br><br><h3>  O√π chercher SSRF? </h3><br>  Ce n'est pas une vuln√©rabilit√© standard.  Il peut √™tre trouv√© dans diff√©rents endroits, souvent dans les endroits les plus inattendus.  Dans cette situation, la technique ¬´regardez ici, mais vous ne pouvez m√™me pas regarder ici¬ª ne fonctionne pas. <br>  Signes d'un √©ventuel <i>SSRF</i> : <br><ul><li>  <i>Webhook</i> .  S'ils sont mal configur√©s, si le pare-feu est mal configur√© sur les serveurs √† partir desquels les Webhooks effectuent des requ√™tes, une vuln√©rabilit√© peut √™tre obtenue; </li><li>  <i>Conversion HTML</i> .  Essayez d'incorporer une construction d' <i>URL</i> <i>&lt;iframe&gt;</i> , <i>&lt;img&gt;</i> , <i>&lt;base&gt;</i> , <i>&lt;script&gt;</i> ou <i>CSS</i> qui pointe vers un service interne; </li><li>  <i>T√©l√©chargez les fichiers supprim√©s</i> .  Rappelez-vous l'exemple d'avatar?  Lorsqu'un utilisateur a la possibilit√© de t√©l√©charger des donn√©es par URL sur le serveur, cela pose de gros probl√®mes.  Essayez d'envoyer l'URL avec le port et voyez quel contenu est t√©l√©charg√©. </li></ul><br><br><h3>  Comment rechercher SSRF? </h3><br><ul><li>  Relevez le serveur et ex√©cutez l' <i>√©couteur</i> : <br><pre><code class="bash hljs">user$ nc -1 -n -vv -p 8080 -k</code> </pre> <br>  De cette fa√ßon, vous verrez toutes les demandes qui parviennent √† votre serveur sur le port <i>8080</i> .  D'une part, c'est un port non allou√© par vos serveurs Web, et d'autre part, c'est un port qui n'est souvent pas filtr√© par le <i>pare-feu</i> .  On pense qu'il est utilis√© pour le protocole <i>http</i> et l'interdire semble √™tre facultatif; </li><li>  Dans l'application √† l'√©tude, trouvez le param√®tre auquel vous pouvez passer le chemin pour demander des donn√©es √† notre h√¥te (√† notre <i>auditeur</i> ); </li><li>  Examinez la sortie <i>du listeur</i> ou la r√©ponse renvoy√©e. </li></ul><br><br><h2>  XXE (entit√© externe XML) </h2><br>  Je vais commencer l'histoire, comme toujours avec un exemple, pour que ce soit plus clair: <br>  Dans le service SEMrush susmentionn√©, il existe un tel outil qui traite de l'analyse de contenu.  L'utilisateur introduit l'URL de son site ou d'un site concurrent et avant de l'analyser, le service t√©l√©charge ce contenu m√™me.  Regardez comment cela se produit sur la vid√©o: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/WS3pJoyWwto" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Pour t√©l√©charger, le service acc√®de au site sp√©cifi√© et le robot t√©l√©charge le fichier <i>sitemap.xml</i> .  Et c'est le <i>XML m√™me</i> dont nous parlons dans ce bloc. <br>  Dans la vid√©o, nous pouvons observer comment le site attaquant a ajout√© une d√©finition de l'entit√© externe <i>XXE</i> √† <i>sitemap.xml</i> , qui pointe vers " <i>file: /// etc / hosts</i> ".  Sur les syst√®mes Linux, il s'agit d'un fichier qui d√©crit quelle adresse IP correspond aux h√¥tes s'il n'y a pas d'enregistrements <i>DNS</i> pour eux. <br>  Ensuite, l'attaquant indique dans la <i>balise &lt;loc&gt; l'</i> expansion de cette variable.  Apr√®s avoir analys√© le <i>XML,</i> apr√®s avoir trait√© tout le <i>XML</i> dans le compartiment, il ins√©rera la valeur qui √©tait dans " <i>file: /// etc / hosts</i> " dans la variable d' <i>emplacement</i> (surlign√©e en rouge dans la vid√©o). <br>  L'attaquant lance le lancement de notre analyseur, va dans les journaux, et ici une ligne appara√Æt, surlign√©e en blanc sur la vid√©o.  Il s'agit du contenu du fichier " <i>file: /// etc / hosts</i> " obtenu dans la requ√™te <i>GET</i> dans les journaux d'un serveur contr√¥l√© par celui-ci. <br>  Et ensuite?  L'attaquant v√©rifiera qu'il avait raison.  Il changera le nom du fichier en " <i>fichier: /// etc / fstab</i> ", r√©ex√©cutera l'analyseur et obtiendra des statistiques sur les processus en cours d'ex√©cution. <br><br>  Et enfin: " <i>file: /// etc / hostname</i> ", d√©marrez l'analyseur, acc√©dez aux journaux et obtenez le <i>nom d'h√¥te de la</i> machine sur laquelle nous sommes. <br>  Il s'agit d'un vrai bug d√©couvert par une personne r√©elle qui n'est pas li√©e √† notre entreprise.  J'ai d√ª saupoudrer de la cendre sur ma t√™te et payer de l'argent :) <br><br>  Un autre exemple de <i>XXE</i> : <br><img src="https://habrastorage.org/webt/3t/va/i9/3tvai98kmgwwmpjwh0wjjuzodk0.png"><br>  Supposons que nous ayons un certain <i>point final</i> , il s'appelle - <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">example.com/xxe</a></i> . <br>  Nous lui envoyons la structure <i>XML</i> ‚Üí en <i>XML nous</i> d√©clarons l'entit√© <i></i> ‚Üí l'entit√© <i> se</i> r√©f√®re au fichier syst√®me <i>/ etc / passwd</i> et s'ouvre plus loin dans le corps de la r√©ponse ‚Üí nous obtenons le contenu de ce fichier en r√©ponse. <br>  Il convient de noter que cela ne se produit pas aussi souvent que nous le souhaiterions. <br><br><h3>  Pourquoi √ßa marche? </h3><br>  <i>Les</i> documents <i>XML</i> sont un format de donn√©es structur√© qui, entre autres, vous permet de d√©crire les types de donn√©es qu'il peut contenir √† l'aide d'une balise <i>DOCTYPE</i> sp√©ciale. <br>  <i>D√©finition du type de donn√©es (DTD)</i> - La d√©finition des types de donn√©es √† l'int√©rieur de ce document <i>XML</i> .  Il existe trois options sur la fa√ßon dont cela peut √™tre fait: <br><ul><li>  Si le document prend en charge la <i>DTD</i> .  L'exemple ci-dessous montre du <i>XML</i> dans lequel il y a une structure de commande, il y a un √©l√©ment de <i>produit</i> et un √©l√©ment de <i>comptage</i> (probablement: le num√©ro d'inventaire du produit et le nombre d'articles dans la commande).  <i>L'ordre</i> est le parent de ces deux √©l√©ments: <br><img src="https://habrastorage.org/webt/ft/to/kb/fttokbp3vkqsknatvo8yql9p5h4.png"></li><li>  DTD externes sur le serveur local. <br>  Nous faisons la m√™me chose que dans le premier mode de r√©alisation, mais nous faisons toutes les d√©finitions dans un fichier s√©par√©, qui se trouve sur le serveur local: <br><img src="https://habrastorage.org/webt/qy/re/3m/qyre3m2bfjatzni4bdq6t-3opko.png"><br></li><li>  DTD externes sur un serveur tiers: <br><img src="https://habrastorage.org/webt/wf/dj/tp/wfdjtpme3bh_lnhgiyr56m-p5si.png"></li></ul><br>  Si vous √™tes un lecteur attentif, vous avez probablement corr√©l√© le fait que la possibilit√© de faire de telles demandes sur votre service et de demander des sch√©mas <i>DTD</i> externes est une vuln√©rabilit√© en soi, dont nous avons parl√© ci-dessus, √† savoir la vuln√©rabilit√© <i>SSRF</i> . <br>  Un √©v√©nement courant: les d√©veloppeurs corrigent la vuln√©rabilit√© <i>XXE</i> , mais oublient d'interdire le traitement des <i>DTD</i> externes et d'obtenir <i>SSRF</i> .  Des cons√©quences fatales n'en d√©couleront pas, mais vous ne devez pas l'oublier. <br><br><h3>  Que sont les entit√©s en XML? </h3><br>  <i>Entit√©s</i> en <i>XML</i> .  Qu'est ce que c'est  C'est l'occasion de d√©finir certaines valeurs et de les transformer en variables.  Les entit√©s ont trois types diff√©rents: <br><img src="https://habrastorage.org/webt/er/lb/h7/erlbh7l8z_adl4nla3ll_tir1rm.png"><br>  <i>Pr√©d√©fini</i> - pr√©d√©fini.  Semblable au code <i>HTML</i> , permet d'utiliser les caract√®res qui font partie de la syntaxe de la langue, comme structure de texte.  Ici, ils sont donn√©s √† titre d'exemple, afin que vous compreniez ce que c'est.  Oui, dans la plupart des attaques, ils ne sont pas utilis√©s, mais peuvent √™tre n√©cessaires dans certains cas exceptionnels. <br>  <i>G√©n√©ral</i> et <i>param√®tre</i> .  C'est la m√™me chose, seule la syntaxe de leur d√©claration change et comment ils peuvent √™tre appel√©s apr√®s la d√©claration <br><br><h3>  O√π chercher <i>XXE</i> ? </h3><br>  Plusieurs options: <br><ul><li>  Traitement <i>XML</i> dans n'importe quelle manifestation: <br><ul><li>  <i>SVG;</i> </li><li>  <i>plan du site;</i> </li></ul></li><li>  Convertissez <i>HTML en</i> d'autres formats; </li><li>  Gestion des formats <i>docx</i> , <i>xlsx</i> et similaires. </li></ul><br><br><h3>  Comment les chercher? </h3><br><img src="https://habrastorage.org/webt/eo/ce/tl/eocetlpzyfdgocqc2qwv1hbxnhe.png"><br>  L'image montre juste un exemple √† partir duquel commencer.  Ce n'est pas une cl√© universelle.  Il doit √™tre optimis√© pour les formats que vous utilisez dans le service √† l'√©tude. <br><br>  La premi√®re chose que nous faisons: d√©clarer une certaine entit√© <i>Z</i> , qui acc√®de √† l'h√¥te contr√¥l√© par l'h√¥te attaquant, la d√©veloppe dans le corps du document <i>XML</i> . <br>  Ici, la deuxi√®me option est possible - juste l'essence de <i>Parameter</i> .  Diff√®re de la premi√®re annonce (signe <i>%</i> ).  Et pour revenir √† cette essence, le corps du document n'est plus n√©cessaire.  Nous pouvons y acc√©der directement dans la structure <i>DOCTYPE</i> et exposer cette entit√©: <br><img src="https://habrastorage.org/webt/3-/hc/xo/3-hcxohtjre3dee0mbed39vlfzq.png"><br>  Le troisi√®me sc√©nario consiste √† voir si la possibilit√© de demander <i>DOCTYPE</i> √† des services externes est activ√©e ou d√©sactiv√©e: <br><img src="https://habrastorage.org/webt/xn/yo/nj/xnyonjotk9gmb4l1ba-d818g3k4.png"><br>  Ensuite, nous regardons la sortie d'un serveur que nous contr√¥lons.  Si nous voyons un appel √† <i>URL</i> <i>/ v√©rification √†</i> partir de diverses adresses <i>IP</i> , cela signifie qu'avec une grande probabilit√©, la vuln√©rabilit√© est pass√©e, et nous avons juste besoin de trouver comment obtenir des donn√©es plus int√©ressantes pour nous. <br><img src="https://habrastorage.org/webt/xl/7d/oz/xl7dozt94jtm9zf3c_zfr39kacq.png"><br>  Quel est le danger de <i>XXE</i> ?  J'√©crirai bri√®vement et point par point: <br><ul><li>  Lecture de fichiers locaux; </li><li>  Acc√®s aux ressources locales; </li><li>  Analyse de port / h√¥te </li><li>  <i>Wrappers de texte brut</i> .  C'est l'occasion d'acc√©der √† vos services qui fonctionnent sur le protocole texte brut; </li><li>  <i>Ex√©cution de code √† distance</i> (pas souvent).  Il est d√©sactiv√© par d√©faut; </li><li>  <i>DoS</i> .  Du fait que les entit√©s peuvent √™tre concat√©n√©es, il est possible d'obtenir facilement une augmentation exponentielle de la quantit√© de m√©moire occup√©e par ces param√®tres.  Le r√©sultat est une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">attaque de milliards de rires</a> .  En d'autres termes, vous surchargez simplement la m√©moire du serveur attaqu√©. </li></ul><br>  En conclusion, je dirai que tout cela (l'article et toute connaissance que vous avez acquise) n'a pas de sens sans application pratique.  Par cons√©quent, je vais vous poser des questions sur une vraie bagatelle: pensez √† l'application que vous avez √©crite / test√©e hier et essayez de v√©rifier les vuln√©rabilit√©s.  Existe-t-il des formulaires de saisie ou <i>un</i> traitement <i>XML</i> ?  Cette application est-elle prot√©g√©e?  Le filtrage est-il ajout√© et la <i>DTD est-elle</i> d√©sactiv√©e? <br>  Ouvrez le manuel <i>SQLmap</i> et d√©couvrez comment v√©rifier votre application avec.  S'il ne trouve rien, prenez un autre outil et examinez-le, puis testez votre application pour d√©tecter d'autres vuln√©rabilit√©s.  Comme je l'ai dit au d√©but, l'article examine seulement quelques vuln√©rabilit√©s, mais des <i>milliers d'entre elles</i> . <br>  Je ne pense pas que vous puissiez √©crire du code absolument s√ªr.  Il y a toujours des vuln√©rabilit√©s, vous ne les avez tout simplement <i><u>pas encore trouv√©es</u></i> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr441966/">https://habr.com/ru/post/fr441966/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr441952/index.html">Choisir un syst√®me de stockage de fichiers pour le travail d'√©quipe</a></li>
<li><a href="../fr441954/index.html">R√©compense utilisateur aux auteurs de Habr</a></li>
<li><a href="../fr441956/index.html">Gestion des erreurs unifi√©e (option C ++ pour microcontr√¥leurs)</a></li>
<li><a href="../fr441962/index.html">Index dans PostgreSQL - 1</a></li>
<li><a href="../fr441964/index.html">Trucs et astuces Kubernetes: d√©placement des ressources de cluster vers Helm 2</a></li>
<li><a href="../fr441968/index.html">D√©veloppement d'une nouvelle branche produit: comment se d√©barrasser de l'impraticable et rester utile</a></li>
<li><a href="../fr441970/index.html">Analyse FinFisher Butkit</a></li>
<li><a href="../fr441972/index.html">Invidious - Frontend YouTube alternatif</a></li>
<li><a href="../fr441974/index.html">Le chemin de l'historien des programmeurs RH aux programmeurs Java: un peu de chance et de pers√©v√©rance</a></li>
<li><a href="../fr441976/index.html">Avec vous FizTech.Science: nous recherchons des param√®tres cach√©s et plongons dans le merveilleux monde quantique</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>