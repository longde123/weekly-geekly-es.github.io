<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏢 🛀🏽 📗 Kit de démarrage des tests de sécurité Web 👨🏾‍🔬 🏎️ 👫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour à tous! 

 Je m'appelle Andrey. Depuis 10 ans, je recherche des vulnérabilités dans divers services Web. et prêt à partager mes connaissances ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kit de démarrage des tests de sécurité Web</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/semrush/blog/441966/"> Bonjour à tous! <br><br>  Je m'appelle Andrey.  Depuis 10 ans, je recherche des vulnérabilités dans divers services Web.  et prêt à partager mes connaissances avec vous.  En mai dernier, j'ai fait un rapport à ce sujet lors de la conférence de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Heisenbug</a> , et maintenant je suis prêt à partager mes connaissances ici aussi, dans les espaces ouverts de Habr.  Commençons donc. <br><br>  Une fois, j'ai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">trouvé une vulnérabilité</a> sur les serveurs de la célèbre société Facebook.  Les gars ont oublié de mettre à jour ImageMagick (la bibliothèque pour le traitement d'image) et l'ont payé :) Avec cet exemple, je voulais montrer que nous sommes tous des gens et que nous pouvons tous faire des erreurs, peu importe dans quelles entreprises et dans quelles positions nous travaillons.  Le seul problème est que ces erreurs peuvent entraîner toutes sortes de risques. <br>  Plus votre application / site Web / outil est compliqué, plus il est probable que quelque chose tourne mal. <br>  Vous devez vérifier les vulnérabilités.  Il est stupide de ne pas le faire du tout. <br><a name="habracut"></a><br>  Les éléments suivants peuvent être des étapes de vérification des applications Web: <br><ul><li>  Préparation: <ul><li>  Définissez les points d'entrée - en fait, d'où les données peuvent provenir dans l'application; </li><li>  Identifier le stock technologique; </li><li>  Déterminez quelles vulnérabilités il est logique de vérifier; </li></ul></li><li>  Vérification  Vous devez vérifier toutes les vulnérabilités qui s'appliquent à l'étendue de la technologie de votre application Web; </li><li>  Analyse de code.  Ne soyez pas paresseux, ne sautez pas cet article.  Dans certains cas, sans accès au code, il est difficile de trouver des vulnérabilités, ce qui vous permet également de contourner le filtrage qui peut être intégré dans votre application. </li></ul><br>  Je vais parler de tout cela en détail. <br><br>  Alors, préparation.  Je ne me concentrerai pas sur tous les types de vulnérabilités, sinon la quantité de texte dans l'article dépassera toutes les tailles imaginables et inconcevables.  Je vous conseille de commencer à apprendre à partir de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">liste des dix meilleurs projets OWASP</a> .  Toutes les quelques années, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le consortium OWASP</a> forme une liste des vulnérabilités les plus pertinentes à l'heure actuelle.  Nous en examinerons quelques-unes en détail. <br><br><h2>  Xss </h2><br>  <i>XSS (cross-site scripting)</i> est une attaque contre un utilisateur qui permet à un attaquant d'exécuter un script arbitraire dans le contexte du navigateur de sa victime.  Le plus souvent, cela implique la mise en place de balises <i>HTML</i> et de scripts <i>JS</i> . <br>  Exemple: à un moment donné, un tel service existait sur <i>Yahoo!</i>  <i>Ad Exchange</i>  Le formulaire de récupération de mot de passe avait un paramètre " <i>URL de retour</i> ".  Il pourrait indiquer à quelle page retourner après le processus de réinitialisation du mot de passe.  Si vous y insérez l'un ou l'autre vecteur conduisant à l'exécution du code <i>JS</i> , vous pouvez obtenir tous les <i>cookies de</i> l'utilisateur.  Nous analyserons comment cela se produit et pourquoi. <br><img src="https://habrastorage.org/webt/0m/uz/t0/0muzt08lkueaenx2gle8ydaidce.png"><br><br>  Voici le vecteur lui-même.  Tout à la fois: <br><img src="https://habrastorage.org/webt/ua/ko/8l/uako8l_hpqr4bov7qmzhm97xwj4.png"><br>  Pour faire une injection, vous devez sortir du contexte de la variable dans laquelle nous nous trouvions par défaut (par défaut - c'est ce que le programmeur a supposé quand il a écrit le code). <br>  Voici la valeur d'origine.  Ceci est un comportement valide. <br><img src="https://habrastorage.org/webt/v4/rm/l7/v4rml7dzf1rqpkyvgq8yxdnl3oi.png"><br>  Nous voyons que returnURL = / login.jsp <br>  Cela tombe dans la valeur de la <i>balise &lt;input&gt;</i> . <br>  Si nous ajoutons un guillemet après <i>jsp</i> , nous verrons que la syntaxe <i>HTML</i> a coulé.  Heureusement, le langage <i>HTML</i> n'est pas strict, l'analyseur va sauter et il n'y aura aucun problème: <br><img src="https://habrastorage.org/webt/3o/s6/z1/3os6z130clrrtkshbktmqgkguto.png"><br>  Ajoutez un autre caractère.  Ici, nous sommes complètement hors du contexte de la <i>balise &lt;input&gt;</i> : <br><img src="https://habrastorage.org/webt/lg/x9/av/lgx9avfst6nskdlowyzx0uasgyy.png"><br>  Maintenant, nous ajoutons l'ouverture de la <i>balise &lt;svg&gt;</i> , et nous obtenons deux balises valides en termes de syntaxe: <br><img src="https://habrastorage.org/webt/u8/pe/tg/u8petg6ghf1gajt49dvsvtfnzn0.png"><br>  Ensuite, ajoutez le vecteur d'attaque entier: <br><img src="https://habrastorage.org/webt/o2/t5/n8/o2t5n8-li9jpdao1cbzghum-mhe.png"><br>  Dans ce cas, l'image <i>svg</i> est dessinée.  En utilisant le gestionnaire <i>JavaScript</i> " <i>onload</i> ", nous exécutons une alerte avec les <i>cookies du</i> document.  C’est tout!  L'attaquant a reçu vos <i>cookies</i> . <br>  Si dans la preuve nous ne montrons que l'alerte elle-même, il ne sera pas difficile pour un attaquant d'envoyer des cookies à un serveur qu'il contrôle et, dans le pire des cas, de saisir votre compte.  Voyons à quoi ça ressemble à nouveau: <br><img src="https://habrastorage.org/webt/0m/uz/t0/0muzt08lkueaenx2gle8ydaidce.png"><br><br>  Il existe également plus de vecteurs d'attaque sur le client.  Je vais donner quelques exemples avec une brève description.  Mais vous devez d'abord comprendre comment sortir de son contexte: <br><ul><li>  Hors contexte.  Ces 6 caractères aideront à sortir non seulement du contexte de la valeur du paramètre HTML, mais aussi de beaucoup d'autres: <br>  -&gt; '"&gt; <br></li></ul><br>  Eh bien, en fait, les deux vecteurs d'attaque les plus simples: <br><ul><li>  Insérez des liens en particulier.  Mais dans le cas général - changer l'apparence de la page.  Par exemple, ils peuvent incorporer du code html dans votre page et afficher une fausse fenêtre demandant des données: <br><img src="https://habrastorage.org/webt/dt/-p/yz/dt-pyzv0wcrhgxqihw3iuoccbnc.png"><br>  La chaîne " <i>aaaa</i> " pointe vers <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">google.com</a> .  Vous pouvez voir que le lien est rendu sur la page, mais vous ne pouvez pas le voir, mais cela n'annule pas sa présence dans le code.  Dans les deux cas, le dossier peut être considéré comme terminé; </li><li>  Exécution de script, par exemple, interception de <i>cookies</i> utilisateur: <br><img src="https://habrastorage.org/webt/w8/yd/yb/w8ydybkf9oucxuawq_vumapupda.png"><br></li></ul><br><br><h3>  Où et comment rechercher XSS? </h3><br>  Tout d'abord, recherchez les fonctions de sortie des informations / données sur la page.  Analyser quelles données y parviennent?  Voici le concept d'une <i>source non fiable</i> .  Et tel est tout d'abord <i>votre utilisateur</i> .  Les vecteurs d'attaque peuvent être contenus dans n'importe quelle autre source: flux RSS, autres services, externes et internes. <br>  Voici un exemple concret: je travaille pour SEMrush IT.  Nous développons une plateforme en ligne, qui est un outil universel pour les spécialistes du marketing en ligne.  Donc, un service a enregistré des données pour nous, l'autre en a déduit, chacune des équipes s'est appuyée les unes sur les autres, il s'est avéré que sur le deuxième service, <i>XSS</i> est survenu en raison du manque de traitement approprié des données de sortie, et la première commande n'a pas jugé nécessaire de filtrer les données entrantes en aucune façon et les a gardés " <i>tels</i> quels".  Conclusion: si vous ne savez pas comment telle ou telle donnée est stockée, elles doivent être considérées comme non fiables.  Ou convenez à l'avance de qui stocke et comment, filtre, affiche les données. <br><br>  Si vous disposez déjà de données provenant de sources non fiables, je recommande: <br><ul><li>  Etudier le filtrage des données entrantes; </li><li>  Examinez le contexte de la sortie.  Dans tous les cas, <i>XSS</i> ne peut pas être exécuté, même en l'absence de filtrage.  Par exemple, si le <i>type de contenu de la</i> réponse est: <i>text / plain;</i> </li><li>  Ne vous fiez pas au filtrage des cadres des systèmes de sécurité intégrés. </li></ul><br><br><h2>  Injection SQL </h2><br><img src="https://habrastorage.org/webt/do/b8/ry/dob8ryjj2vifp3w1th18oroewis.png"><br><br>  <i>Implémentation du code SQL (injection SQL anglaise)</i> - l'introduction dans la requête de la base de données d'instructions qui n'y étaient pas impliquées. <br><br>  Exemple (pas de la vie, mais aussi bon): <br>  Nous voyons un script qui affiche une table utilisateur.  Dans ce cas, il peut effectuer une recherche par nom d'utilisateur. <br>  Sur la droite est montré à quoi ressemble la requête vers la base de données, et sur la gauche est le résultat du script dans le navigateur. <br><img src="https://habrastorage.org/webt/ng/u2/ou/ngu2ouq8da3jtb18gkjj2amzxss.png"><br>  De plus, afin de tester et d'obtenir au moins un résultat primaire, nous insérons deux guillemets dans la valeur du paramètre name.  Simple et double: <br><img src="https://habrastorage.org/webt/0a/fd/ck/0afdckohg1xuacw-7olxyrzifha.png"><br>  On voit que du point de vue de la sortie, tout s'est effondré, le tableau a complètement disparu.  La demande obtient également les 2 guillemets supplémentaires.  Toute la syntaxe de la requête <i>SQL</i> est violée. <br>  Si nous prenons et ajoutons une telle construction à la valeur du paramètre ( <i>éd .: regardez dans la boîte jaune</i> ), nous obtenons une demande absolument valide.  La sortie de la page est complètement identique à la première requête, qui ne comprenait pas d'injection: <br><img src="https://habrastorage.org/webt/nh/9q/gu/nh9qguk8d0unxfz1bsxlfb0n8vo.png"><br>  Afin de vérifier pleinement qu'il existe une vulnérabilité, nous ajoutons un deuce au lieu de l'unité: <br><img src="https://habrastorage.org/webt/lx/je/a6/lxjea6hv3hebohiv96gpauuo4o0.png"><br>  Il s'avère que la demande devient fausse, du point de vue de la logique booléenne et, par conséquent, ne contient pas de données.  Cependant, contrairement au moment où nous avons eu une erreur, nous avons la sortie de la table elle-même. <br><br>  Afin de ne pas répertorier tout ce qui peut se trouver dans différents moteurs de base de données et requêtes de différents types, j'ai tout réduit à une seule ligne: <br><img src="https://habrastorage.org/webt/xz/ok/mn/xzokmnhyzqdepnyax-n1bzd8siq.png"><br>  C'est quelque chose que vous pouvez essayer d'entrer dans le paramètre, puis, selon les différences dans les réponses, essayer de comprendre ce qui se passe, y a-t-il une vulnérabilité ou non?  Environ 80% des cas que vous pouvez couvrir avec cette manipulation. <br>  Il reste 20% de situations difficiles dans lesquelles il ne vous donnera aucune information, par exemple: requêtes imbriquées / filtrage et ainsi de suite.  Dans ma pratique, je n'ai rencontré un semblable qu'une seule fois.  Ensuite, j'ai dû contourner le filtrage côté service. <br><br>  Quel est le danger en SQL? <br><ul><li>  De l'évidence - <i>fuite d'informations</i> .  Si un attaquant a pu générer des requêtes vers vos bases de données, il peut d'une manière ou d'une autre obtenir des valeurs qui n'étaient pas destinées à la sortie (hachages de mot de passe, adresses client, etc.); </li><li>  <i>Changement de données</i> .  Maintenant, de nombreux développeurs utilisent des bases de données via des systèmes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ORM</a> .  Ces systèmes eux-mêmes, par défaut, vous permettent de faire plusieurs requêtes à la fois, la syntaxe SQL vous permet également de le faire.  S'il y a une vulnérabilité, tout peut se tourner non seulement vers la sélection des données, mais aussi vers leur modification (jusqu'à la suppression des tables, la modification de la structure de la base de données, etc.). <br>  Dans la même situation, une augmentation des privilèges utilisateur est possible.  Modifiez les champs de certaines tables (par exemple, mettez <i>is_admins = true</i> dans la base de données des <i>utilisateurs</i> ) et augmentez ainsi vos droits à l'administrateur; </li><li>  <i>DoS</i> .  Dans certains cas, une injection peut entraîner un déni de service.  Plusieurs requêtes lourdes vers la base de données sont générées, lancées dans plusieurs threads et votre service peut cesser de fonctionner pendant un certain temps; </li><li>  <i>La lecture des fichiers système</i> est un autre désastre que l'injection SQL peut apporter.  L'occurrence de ce risque dépend du système de base de données que vous utilisez, ainsi que de l'utilisateur qui travaille avec (privilégié ou non); </li><li>  <i>RCE (Remote Code Execution)</i> est l'exécution de code.  Cela dépend directement du type de base de données utilisé (auparavant, cela était possible par défaut, avec les paramètres de base de données par défaut, dans MSSQL). </li></ul><br>  Le tableau ci-dessous montre les vulnérabilités de la requête <i>SQL</i> .  Bien sûr, vous n'avez pas besoin de le mémoriser.  De plus, ce ne sont pas toutes les options possibles, mais simplement des exemples.  Faites juste attention au fait que les endroits où l'injection dans la requête <i>SQL</i> peut se produire si des données brutes y arrivent sont surlignés en rouge.  Un attaquant expérimenté peut trouver un moyen d'exploiter cela.  Soyez prudent et attentif. <br><img src="https://habrastorage.org/webt/gz/bt/xh/gzbtxhbbrkng9axlc2av07rax9o.png"><br><br><h2>  SSRF (falsification de requête côté serveur) </h2><br>  Traduction littérale - fausses requêtes côté serveur.  C'est-à-dire, une attaque qui vous permet de manipuler les données que vous envoyez à l'application, vous forçant à faire la demande pour ne pas où la logique métier initialement prévue. <br>  Le fonctionnement de <i>SSRF est</i> illustré dans l'image ci-dessous: <br><img src="https://habrastorage.org/webt/cn/3m/xc/cn3mxclin9jb7tr5fdg6zcowez8.png"><br>  Il y a un attaquant, il y a votre serveur, qui est fermé par le <i>pare</i> - <i>feu</i> , mais en même temps il y a une fonctionnalité qui vous permet de faire plus de requêtes au nom du serveur. <br>  Si cette fonctionnalité n'est pas correctement protégée et / ou incorrectement, comme cela arrive généralement :), traite les données entrantes, l'attaquant peut se tourner vers <i>Memcached</i> , <i>Redis</i> ou accéder à toutes les ressources internes de la victime. <br><br>  Pour un exemple plus illustratif, considérons le stand que SEMrush utilise pour la formation interne des employés. <br>  Il est important de faire attention à la signification de "l' <i>URL de l'avatar</i> ": <br><img src="https://habrastorage.org/webt/yi/yp/fr/yiypfrzdsu-pqg0adlbup1ziqgk.png"><br>  Ici, nous prêtons attention à 2 points: <br><ul><li>  URL de l'avatar elle-même </li><li>  et la possibilité de le télécharger à l'aide d'un fichier. </li></ul><br>  Veuillez noter que le champ " <i>URL de l'avatar</i> " est un champ de texte pour la saisie, ce qui signifie que nous pouvons manipuler cette valeur.  Essayons de mettre l'avatar, peut-être, l'image la plus célèbre sur Internet - Googlebot de la page d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">erreur 404</a> . <br>  Faites-le une fois: <br><img src="https://habrastorage.org/webt/hg/8d/oa/hg8doavbzbji9apfewlydlpxhyq.png"><br>  Faites deux - cliquez sur " <i>Enregistrer</i> ".  Nous obtenons un robot à la place de ma photo: <br><img src="https://habrastorage.org/webt/kf/4x/lr/kf4xlr2atwvebex_dmsiqlxvmbi.png"><br>  Ici, il convient de prêter attention au fait que la valeur de "l' <i>URL de l'avatar</i> " a changé, en un chemin local - apparemment, l'application a demandé une image, l'a enregistrée sur le serveur et a substitué une nouvelle valeur. <br><br>  Nous continuons.  Dans le champ " <i>URL avatar</i> ", entrez le <i>fichier de</i> valeur <i>: /// etc / passwd</i> .  Cette conception vous permet d'accéder à la structure du fichier.  Dans certaines bibliothèques qui fonctionnaient avec <i>HTTP</i> , par défaut, la structure de fichiers est activée et reçoit des données des serveurs sur lesquels elles ont été lancées: <br><img src="https://habrastorage.org/webt/_j/2i/jb/_j2ijbofjimkfmd2tjxmoegkh4k.png"><br>  Que se passe-t-il après avoir cliqué sur le bouton " <i>Enregistrer</i> "? .. <br>  Premièrement, l'image est devenue « <i>chauve-souris</i> » et, deuxièmement, le chemin d'accès au fichier a changé. <br><img src="https://habrastorage.org/webt/bn/ro/d5/bnrod5bxckue0avxxbvvktglimg.png"><br>  Si nous essayons de demander cette image dans le navigateur, ils ne nous montreront rien (le fichier est « <i>cassé</i> »).  Mais nous ne sommes pas le premier jour de la sécurité de l'information, nous savons quoi faire :) Par de simples manipulations nous obtenons le contenu du fichier sur notre ordinateur: <br><img src="https://habrastorage.org/webt/vd/sw/97/vdsw97u1ce8abtqa2aqcp_zb2ac.png"><br>  Ainsi, à l'aide de cette vulnérabilité, en tant qu'attaquant, je peux obtenir tous les codes source de votre service et d'autres données disponibles pour lecture à l'utilisateur qui exécute le service Web. <br>  Regardons les dangers de SSRF: <br><ul><li>  Balayage de port.  Pour un réseau externe, votre service est un point d'entrée et 2 ports (http et https).  En scannant les ports depuis l'intérieur de votre infrastructure, un attaquant peut détecter les ports ouverts; </li><li>  Contournez l'authentification basée sur l'hôte.  À quoi ça sert?  Il est possible qu'au sein de votre structure, il existe des services qui ne sont disponibles que pour certaines ressources (lire: liste blanche IP).  Donc, si votre serveur vulnérable est dans la liste blanche, vous avez accès aux services qui lui sont disponibles et, par conséquent, vous pouvez les manipuler; </li><li>  En poursuivant le développement de l'attaque susmentionnée, vous pouvez continuer à exploiter les programmes vulnérables s'exécutant sur l'intranet ou sur le serveur local.  Très souvent, il existe des situations où l'infrastructure interne, inaccessible de l'extérieur, est mal surveillée (les versions / correctifs de sécurité, etc. ne sont pas toujours mis à jour).  Cela peut également entraîner des attaques et des vols de données; </li><li>  Lecture des données locales.  Je l'ai montré ci-dessus avec un exemple.  Vos configurations peuvent être lues et accessibles, jetons et mots de passe. </li></ul><br><br><h3>  Où chercher SSRF? </h3><br>  Ce n'est pas une vulnérabilité standard.  Il peut être trouvé dans différents endroits, souvent dans les endroits les plus inattendus.  Dans cette situation, la technique «regardez ici, mais vous ne pouvez même pas regarder ici» ne fonctionne pas. <br>  Signes d'un éventuel <i>SSRF</i> : <br><ul><li>  <i>Webhook</i> .  S'ils sont mal configurés, si le pare-feu est mal configuré sur les serveurs à partir desquels les Webhooks effectuent des requêtes, une vulnérabilité peut être obtenue; </li><li>  <i>Conversion HTML</i> .  Essayez d'incorporer une construction d' <i>URL</i> <i>&lt;iframe&gt;</i> , <i>&lt;img&gt;</i> , <i>&lt;base&gt;</i> , <i>&lt;script&gt;</i> ou <i>CSS</i> qui pointe vers un service interne; </li><li>  <i>Téléchargez les fichiers supprimés</i> .  Rappelez-vous l'exemple d'avatar?  Lorsqu'un utilisateur a la possibilité de télécharger des données par URL sur le serveur, cela pose de gros problèmes.  Essayez d'envoyer l'URL avec le port et voyez quel contenu est téléchargé. </li></ul><br><br><h3>  Comment rechercher SSRF? </h3><br><ul><li>  Relevez le serveur et exécutez l' <i>écouteur</i> : <br><pre><code class="bash hljs">user$ nc -1 -n -vv -p 8080 -k</code> </pre> <br>  De cette façon, vous verrez toutes les demandes qui parviennent à votre serveur sur le port <i>8080</i> .  D'une part, c'est un port non alloué par vos serveurs Web, et d'autre part, c'est un port qui n'est souvent pas filtré par le <i>pare-feu</i> .  On pense qu'il est utilisé pour le protocole <i>http</i> et l'interdire semble être facultatif; </li><li>  Dans l'application à l'étude, trouvez le paramètre auquel vous pouvez passer le chemin pour demander des données à notre hôte (à notre <i>auditeur</i> ); </li><li>  Examinez la sortie <i>du listeur</i> ou la réponse renvoyée. </li></ul><br><br><h2>  XXE (entité externe XML) </h2><br>  Je vais commencer l'histoire, comme toujours avec un exemple, pour que ce soit plus clair: <br>  Dans le service SEMrush susmentionné, il existe un tel outil qui traite de l'analyse de contenu.  L'utilisateur introduit l'URL de son site ou d'un site concurrent et avant de l'analyser, le service télécharge ce contenu même.  Regardez comment cela se produit sur la vidéo: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/WS3pJoyWwto" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Pour télécharger, le service accède au site spécifié et le robot télécharge le fichier <i>sitemap.xml</i> .  Et c'est le <i>XML même</i> dont nous parlons dans ce bloc. <br>  Dans la vidéo, nous pouvons observer comment le site attaquant a ajouté une définition de l'entité externe <i>XXE</i> à <i>sitemap.xml</i> , qui pointe vers " <i>file: /// etc / hosts</i> ".  Sur les systèmes Linux, il s'agit d'un fichier qui décrit quelle adresse IP correspond aux hôtes s'il n'y a pas d'enregistrements <i>DNS</i> pour eux. <br>  Ensuite, l'attaquant indique dans la <i>balise &lt;loc&gt; l'</i> expansion de cette variable.  Après avoir analysé le <i>XML,</i> après avoir traité tout le <i>XML</i> dans le compartiment, il insérera la valeur qui était dans " <i>file: /// etc / hosts</i> " dans la variable d' <i>emplacement</i> (surlignée en rouge dans la vidéo). <br>  L'attaquant lance le lancement de notre analyseur, va dans les journaux, et ici une ligne apparaît, surlignée en blanc sur la vidéo.  Il s'agit du contenu du fichier " <i>file: /// etc / hosts</i> " obtenu dans la requête <i>GET</i> dans les journaux d'un serveur contrôlé par celui-ci. <br>  Et ensuite?  L'attaquant vérifiera qu'il avait raison.  Il changera le nom du fichier en " <i>fichier: /// etc / fstab</i> ", réexécutera l'analyseur et obtiendra des statistiques sur les processus en cours d'exécution. <br><br>  Et enfin: " <i>file: /// etc / hostname</i> ", démarrez l'analyseur, accédez aux journaux et obtenez le <i>nom d'hôte de la</i> machine sur laquelle nous sommes. <br>  Il s'agit d'un vrai bug découvert par une personne réelle qui n'est pas liée à notre entreprise.  J'ai dû saupoudrer de la cendre sur ma tête et payer de l'argent :) <br><br>  Un autre exemple de <i>XXE</i> : <br><img src="https://habrastorage.org/webt/3t/va/i9/3tvai98kmgwwmpjwh0wjjuzodk0.png"><br>  Supposons que nous ayons un certain <i>point final</i> , il s'appelle - <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">example.com/xxe</a></i> . <br>  Nous lui envoyons la structure <i>XML</i> → en <i>XML nous</i> déclarons l'entité <i></i> → l'entité <i> se</i> réfère au fichier système <i>/ etc / passwd</i> et s'ouvre plus loin dans le corps de la réponse → nous obtenons le contenu de ce fichier en réponse. <br>  Il convient de noter que cela ne se produit pas aussi souvent que nous le souhaiterions. <br><br><h3>  Pourquoi ça marche? </h3><br>  <i>Les</i> documents <i>XML</i> sont un format de données structuré qui, entre autres, vous permet de décrire les types de données qu'il peut contenir à l'aide d'une balise <i>DOCTYPE</i> spéciale. <br>  <i>Définition du type de données (DTD)</i> - La définition des types de données à l'intérieur de ce document <i>XML</i> .  Il existe trois options sur la façon dont cela peut être fait: <br><ul><li>  Si le document prend en charge la <i>DTD</i> .  L'exemple ci-dessous montre du <i>XML</i> dans lequel il y a une structure de commande, il y a un élément de <i>produit</i> et un élément de <i>comptage</i> (probablement: le numéro d'inventaire du produit et le nombre d'articles dans la commande).  <i>L'ordre</i> est le parent de ces deux éléments: <br><img src="https://habrastorage.org/webt/ft/to/kb/fttokbp3vkqsknatvo8yql9p5h4.png"></li><li>  DTD externes sur le serveur local. <br>  Nous faisons la même chose que dans le premier mode de réalisation, mais nous faisons toutes les définitions dans un fichier séparé, qui se trouve sur le serveur local: <br><img src="https://habrastorage.org/webt/qy/re/3m/qyre3m2bfjatzni4bdq6t-3opko.png"><br></li><li>  DTD externes sur un serveur tiers: <br><img src="https://habrastorage.org/webt/wf/dj/tp/wfdjtpme3bh_lnhgiyr56m-p5si.png"></li></ul><br>  Si vous êtes un lecteur attentif, vous avez probablement corrélé le fait que la possibilité de faire de telles demandes sur votre service et de demander des schémas <i>DTD</i> externes est une vulnérabilité en soi, dont nous avons parlé ci-dessus, à savoir la vulnérabilité <i>SSRF</i> . <br>  Un événement courant: les développeurs corrigent la vulnérabilité <i>XXE</i> , mais oublient d'interdire le traitement des <i>DTD</i> externes et d'obtenir <i>SSRF</i> .  Des conséquences fatales n'en découleront pas, mais vous ne devez pas l'oublier. <br><br><h3>  Que sont les entités en XML? </h3><br>  <i>Entités</i> en <i>XML</i> .  Qu'est ce que c'est  C'est l'occasion de définir certaines valeurs et de les transformer en variables.  Les entités ont trois types différents: <br><img src="https://habrastorage.org/webt/er/lb/h7/erlbh7l8z_adl4nla3ll_tir1rm.png"><br>  <i>Prédéfini</i> - prédéfini.  Semblable au code <i>HTML</i> , permet d'utiliser les caractères qui font partie de la syntaxe de la langue, comme structure de texte.  Ici, ils sont donnés à titre d'exemple, afin que vous compreniez ce que c'est.  Oui, dans la plupart des attaques, ils ne sont pas utilisés, mais peuvent être nécessaires dans certains cas exceptionnels. <br>  <i>Général</i> et <i>paramètre</i> .  C'est la même chose, seule la syntaxe de leur déclaration change et comment ils peuvent être appelés après la déclaration <br><br><h3>  Où chercher <i>XXE</i> ? </h3><br>  Plusieurs options: <br><ul><li>  Traitement <i>XML</i> dans n'importe quelle manifestation: <br><ul><li>  <i>SVG;</i> </li><li>  <i>plan du site;</i> </li></ul></li><li>  Convertissez <i>HTML en</i> d'autres formats; </li><li>  Gestion des formats <i>docx</i> , <i>xlsx</i> et similaires. </li></ul><br><br><h3>  Comment les chercher? </h3><br><img src="https://habrastorage.org/webt/eo/ce/tl/eocetlpzyfdgocqc2qwv1hbxnhe.png"><br>  L'image montre juste un exemple à partir duquel commencer.  Ce n'est pas une clé universelle.  Il doit être optimisé pour les formats que vous utilisez dans le service à l'étude. <br><br>  La première chose que nous faisons: déclarer une certaine entité <i>Z</i> , qui accède à l'hôte contrôlé par l'hôte attaquant, la développe dans le corps du document <i>XML</i> . <br>  Ici, la deuxième option est possible - juste l'essence de <i>Parameter</i> .  Diffère de la première annonce (signe <i>%</i> ).  Et pour revenir à cette essence, le corps du document n'est plus nécessaire.  Nous pouvons y accéder directement dans la structure <i>DOCTYPE</i> et exposer cette entité: <br><img src="https://habrastorage.org/webt/3-/hc/xo/3-hcxohtjre3dee0mbed39vlfzq.png"><br>  Le troisième scénario consiste à voir si la possibilité de demander <i>DOCTYPE</i> à des services externes est activée ou désactivée: <br><img src="https://habrastorage.org/webt/xn/yo/nj/xnyonjotk9gmb4l1ba-d818g3k4.png"><br>  Ensuite, nous regardons la sortie d'un serveur que nous contrôlons.  Si nous voyons un appel à <i>URL</i> <i>/ vérification à</i> partir de diverses adresses <i>IP</i> , cela signifie qu'avec une grande probabilité, la vulnérabilité est passée, et nous avons juste besoin de trouver comment obtenir des données plus intéressantes pour nous. <br><img src="https://habrastorage.org/webt/xl/7d/oz/xl7dozt94jtm9zf3c_zfr39kacq.png"><br>  Quel est le danger de <i>XXE</i> ?  J'écrirai brièvement et point par point: <br><ul><li>  Lecture de fichiers locaux; </li><li>  Accès aux ressources locales; </li><li>  Analyse de port / hôte </li><li>  <i>Wrappers de texte brut</i> .  C'est l'occasion d'accéder à vos services qui fonctionnent sur le protocole texte brut; </li><li>  <i>Exécution de code à distance</i> (pas souvent).  Il est désactivé par défaut; </li><li>  <i>DoS</i> .  Du fait que les entités peuvent être concaténées, il est possible d'obtenir facilement une augmentation exponentielle de la quantité de mémoire occupée par ces paramètres.  Le résultat est une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">attaque de milliards de rires</a> .  En d'autres termes, vous surchargez simplement la mémoire du serveur attaqué. </li></ul><br>  En conclusion, je dirai que tout cela (l'article et toute connaissance que vous avez acquise) n'a pas de sens sans application pratique.  Par conséquent, je vais vous poser des questions sur une vraie bagatelle: pensez à l'application que vous avez écrite / testée hier et essayez de vérifier les vulnérabilités.  Existe-t-il des formulaires de saisie ou <i>un</i> traitement <i>XML</i> ?  Cette application est-elle protégée?  Le filtrage est-il ajouté et la <i>DTD est-elle</i> désactivée? <br>  Ouvrez le manuel <i>SQLmap</i> et découvrez comment vérifier votre application avec.  S'il ne trouve rien, prenez un autre outil et examinez-le, puis testez votre application pour détecter d'autres vulnérabilités.  Comme je l'ai dit au début, l'article examine seulement quelques vulnérabilités, mais des <i>milliers d'entre elles</i> . <br>  Je ne pense pas que vous puissiez écrire du code absolument sûr.  Il y a toujours des vulnérabilités, vous ne les avez tout simplement <i><u>pas encore trouvées</u></i> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr441966/">https://habr.com/ru/post/fr441966/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr441952/index.html">Choisir un système de stockage de fichiers pour le travail d'équipe</a></li>
<li><a href="../fr441954/index.html">Récompense utilisateur aux auteurs de Habr</a></li>
<li><a href="../fr441956/index.html">Gestion des erreurs unifiée (option C ++ pour microcontrôleurs)</a></li>
<li><a href="../fr441962/index.html">Index dans PostgreSQL - 1</a></li>
<li><a href="../fr441964/index.html">Trucs et astuces Kubernetes: déplacement des ressources de cluster vers Helm 2</a></li>
<li><a href="../fr441968/index.html">Développement d'une nouvelle branche produit: comment se débarrasser de l'impraticable et rester utile</a></li>
<li><a href="../fr441970/index.html">Analyse FinFisher Butkit</a></li>
<li><a href="../fr441972/index.html">Invidious - Frontend YouTube alternatif</a></li>
<li><a href="../fr441974/index.html">Le chemin de l'historien des programmeurs RH aux programmeurs Java: un peu de chance et de persévérance</a></li>
<li><a href="../fr441976/index.html">Avec vous FizTech.Science: nous recherchons des paramètres cachés et plongons dans le merveilleux monde quantique</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>