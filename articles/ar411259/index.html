<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฐ๏ธ ๐จ ๐ฒ๐ฝ ูุฑุจุท ุนุฏุงุฏ ุงูููุงู ุจููุฒู ุฐูู ๐ฟ๏ธ ๐ ๐น</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุฑุฉ ูุงุญุฏุฉ ูุงูุช ุฃูุธูุฉ ุงูุชุดุบูู ุงูุขูู ููููุฒู ุ ุฃู ููุง ูุทูู ุนูููุง ูู ูุซูุฑ ูู ุงูุฃุญูุงู "ุงูููุฒู ุงูุฐูู" ุ ูุงูุช ุจุงูุธุฉ ุงูุซูู ููุบุงูุฉ ูุงูุฃุบููุงุก ููุท ูููู ุฃู ุชุญูููุง...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูุฑุจุท ุนุฏุงุฏ ุงูููุงู ุจููุฒู ุฐูู</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/411259/" style=";text-align:right;direction:rtl">  ูุฑุฉ ูุงุญุฏุฉ ูุงูุช ุฃูุธูุฉ ุงูุชุดุบูู ุงูุขูู ููููุฒู ุ ุฃู ููุง ูุทูู ุนูููุง ูู ูุซูุฑ ูู ุงูุฃุญูุงู "ุงูููุฒู ุงูุฐูู" ุ ูุงูุช ุจุงูุธุฉ ุงูุซูู ููุบุงูุฉ ูุงูุฃุบููุงุก ููุท ูููู ุฃู ุชุญูููุง.  ุงูููู ูู ุงูุณูู ุ ููููู ุงูุนุซูุฑ ุนูู ูุฌููุนุงุช ุฑุฎูุตุฉ ุงูุซูู ุชูุงููุง ูุน ุฃุฌูุฒุฉ ุงุณุชุดุนุงุฑ ูุฃุฒุฑุงุฑ / ููุงุชูุญ ููุดุบูุงุช ููุชุญูู ูู ุงูุฅุถุงุกุฉ ูุงูููุงุจุณ ูุงูุชูููุฉ ูุฅูุฏุงุฏุงุช ุงูููุงู ูุงููุณุชููููู ุงูุขุฎุฑูู.  ูุญุชู <s>ุฃูุซุฑ krivoruky</s> DIY-shnik ูููู ุฃู ููุถู ุฅูู ุงูุฃุฌูุฒุฉ ุงูุฌูููุฉ ููุฌูุนูุง ูููุฒู ุฐูู ูุบูุฑ ูููู. <br><br><img src="https://habrastorage.org/webt/-a/k2/x6/-ak2x6li6an5gyqbrg2ett_-_au.jpeg"><br><br>  ููุงุนุฏุฉ ุ ุชููู ุงูุฃุฌูุฒุฉ ุงูููุชุฑุญุฉ ุฅูุง ุฃุฌูุฒุฉ ุงุณุชุดุนุงุฑ ุฃู ูุดุบูุงุช.  ุฅููุง ุชุฌุนู ูู ุงูุณูู ุชูููุฐ ุณููุงุฑูููุงุช ูุซู "ุชุดุบูู ุงูุถูุก ุนูุฏ ุชุดุบูู ูุณุชุดุนุฑ ุงูุญุฑูุฉ" ุฃู "ุงูููุชุงุญ ุนูุฏ ุงููุฎุฑุฌ ูุทูุฆ ุงูุถูุก ูู ุฌููุน ุฃูุญุงุก ุงูุดูุฉ".  ููู ุงูููุงุณ ุนู ุจุนุฏ ุจุทุฑููุฉ ูุง ูู ููุฌุญ.  ูู ุฃูุถู ุงูุฃุญูุงู ุ ูุฐุง ุฑุณู ุจูุงูู ูุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ ูุงูุฑุทูุจุฉ ุ ุฃู ุงูุทุงูุฉ ุงูุขููุฉ ูู ูููุฐ ูุนูู. <br><br>  ููุฏ ููุช ูุคุฎุฑูุง ุจุชุซุจูุช ุนุฏุงุฏ ููุงู ุจุฅุฎุฑุงุฌ ูุจุถู.  ูุชู ุชุดุบูู ููุชุงุญ ุงููุตุจ ูู ุฎูุงู ูู ูุชุฑ ูู ุฎูุงู ุงูุนุฏุงุฏ ููุบูู ุงูุงุชุตุงู.  ุงูุดูุก ุงููุญูุฏ ุงููุชุจูู ูู ุงูุชูุณู ุจุงูุฃุณูุงู ููุญุงููุฉ ุงูุงุณุชูุงุฏุฉ ูููุง.  ุนูู ุณุจูู ุงููุซุงู ุ ูู ุจุชุญููู ุงุณุชููุงู ุงูููุงู ุจุณุงุนุฉ ูููู ุงูุฃุณุจูุน.  ุญุณููุง ุ ุฅุฐุง ูุงู ููุงู ุนุฏุฉ ุฑุงูุนุงุช ููููุงู ูู ุงูุดูุฉ ุ ููู ุงูููุงุฆู ุฑุคูุฉ ุฌููุน ุงููุคุดุฑุงุช ุงูุญุงููุฉ ุนูู ุดุงุดุฉ ูุงุญุฏุฉ ูู ุชุณูู ููุงูุฐ ูุตุนุจ ุงููุตูู ุฅูููุง ุจุงุณุชุฎุฏุงู ูุตุจุงุญ ูุฏูู. <br><br>  ุชุญุช ุงููุทุน ุ ุชุนุชูุฏ ุฅุตุฏุงุฑู ููุฌูุงุฒ ุนูู ESP8266 ุ ุงูุฐู ูุญุณุจ ุงููุจุถุงุช ูู ุนุฏุงุฏุงุช ุงูููุงู ููุฑุณู ุงููุฑุงุกุงุช ุฅูู ุฎุงุฏู ุงูููุฒู ุงูุฐูู ุนุจุฑ MQTT.  ุณูุจุฑูุฌ ูู ูููุฑูุจูุซูู ุจุงุณุชุฎุฏุงู ููุชุจุฉ uasyncio.  ุนูุฏ ุฅูุดุงุก ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ ุ ุตุงุฏูุช ุงูุนุฏูุฏ ูู ุงูุตุนูุจุงุช ุงููุซูุฑุฉ ููุงูุชูุงู ุ ูุงูุชู ุณุฃูุงูุดูุง ุฃูุถูุง ูู ูุฐู ุงูููุงูุฉ.  ุฏุนูุง ูุฐูุจ! <br><a name="habracut"></a><br><h3 style=";text-align:right;direction:rtl">  ูุฎุทุท </h3><br><img src="https://habrastorage.org/webt/i-/w2/o7/i-w2o7b8mfsommteri_mss88oa8.png"><br><br>  ููุจ ุงูุฏุงุฆุฑุฉ ุจุฃููููุง ูู ุงููุญุฏุฉ ุงูููุทูุฉ ุนูู ูุชุญูู ESP8266.  ูุงู ESP-12 ูุฎุทุทูุง ูู ุงูุฃุตู ุ ููู ุชุจูู ูู ุฃูู ูุนูุจ.  ูุงู ุนูู ุฃู ุฃููู ุฑุงุถููุง ุนู ูุญุฏุฉ ESP-07 ุ ุงูุชู ูุงูุช ูุชุงุญุฉ.  ูุญุณู ุงูุญุธ ุ ูุฅูููุง ูุชูุงุซูุงู ูู ุงูุงุณุชูุชุงุฌุงุช ูุงููุธููุฉ ุ ูุงููุฑู ูู ููุท ูู ุงูููุงุฆู - ูุญุชูู ESP-12 ุนูู ูุฏูุฌ ุ ู ESP-07 ุนูู ูุงุญุฏ ุฎุงุฑุฌู.  ููุน ุฐูู ุ ุญุชู ุจุฏูู ููุงุฆู WiFi ุ ูุชู ุงูุชูุงุท ุงูุฅุดุงุฑุฉ ูู ุญูุงูู ุจุดูู ุทุจูุนู. <br><br>  ุฑุจุท ุงููุญุฏุฉ ููุงุณู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฒุฑ ุฅุนุงุฏุฉ ุงูุถุจุท ูุน ุญูุงูุฉ ูููุซู (ุนูู ุงูุฑุบู ูู ูุฌูุฏููุง ุจุงููุนู ุฏุงุฎู ุงููุญุฏุฉ) </li><li style=";text-align:right;direction:rtl">  ุณุญุจ ุฅุดุงุฑุฉ ุชูููู (CH_PD) ุฅูู ุงูุทุงูุฉ </li><li style=";text-align:right;direction:rtl">  ุงูุณุญุจ GPIO15 ุนูู ุงูุฃุฑุถ.  ูุฐุง ุถุฑูุฑู ููุท ูู ุงูุจุฏุงูุฉ ุ ูููู ูุง ูุฒุงู ูุฏู ุดูุก ููุชุดุจุซ ุจูุฐู ุงูุณุงู ุจุนุฏ ุงูุขู </li></ul><br>  ููุถุน ุงููุญุฏุฉ ูู ูุถุน ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ ุ ุชุญุชุงุฌ ุฅูู ุฅุบูุงู GPIO2 ุนูู ุงูุฃุฑุถ ุ ููุฌุนููุง ุฃูุซุฑ ููุงุกูุฉ ุ ููุช ุจุชูููุฑ ุฒุฑ ุงูุชูููุฏ.  ูู ุงูุญุงูุฉ ุงูุนุงุฏูุฉ ุ ูุชู ุณุญุจ ูุฐุง ุงูุฏุจูุณ ุฅูู ุงูุทุงูุฉ. <br><br>  ูุชู ุงูุชุญูู ูู ุญุงูุฉ ุฎุท GPIO2 ููุท ูู ุจุฏุงูุฉ ุงูุนูู - ุนูุฏ ุชุทุจูู ุงูุทุงูุฉ ุฃู ูุจุงุดุฑุฉ ุจุนุฏ ุฅุนุงุฏุฉ ุงูุชุนููู.  ูุฐูู ูุชู ุชุญููู ุงููุญุฏุฉ ุฅูุง ูุงููุนุชุงุฏ ุ ุฃู ุชุฐูุจ ุฅูู ูุถุน ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ.  ุจุนุฏ ุงูุชุญููู ุ ูููู ุงุณุชุฎุฏุงู ูุฐุง ุงูุฅุฎุฑุงุฌ ุจุงุนุชุจุงุฑู GPIO ุนุงุฏู.  ุญุณููุง ุ ูุธุฑูุง ููุฌูุฏ ุฒุฑ ุจุงููุนู ููุงู ุ ููููู ูุถุน ุจุนุถ ุงููุธุงุฆู ุงููููุฏุฉ ุนููู. <br><br>  ููุจุฑูุฌุฉ ูุงูุชุตุญูุญ ุ ุณุฃุณุชุฎุฏู UART ุ ุงูุฐู ุชู ุฅุญุถุงุฑู ุฅูู ุงููุดุท.  ุนูุฏ ุงูุถุฑูุฑุฉ - ุฃููู ููุท ุจุชูุตูู ูุญูู USB-UART.  ุชุญุชุงุฌ ููุท ุฅูู ุชุฐูุฑ ุฃู ุงููุญุฏุฉ ุชุนูู ุจุงูุทุงูุฉ 3.3V.  ุฅุฐุง ูุณูุช ุชุจุฏูู ุงููุญูู ุฅูู ูุฐุง ุงูุฌูุฏ ูุชุทุจูู 5V ุ ููู ุงููุฑุฌุญ ุฃู ุชุญุชุฑู ุงููุญุฏุฉ. <br><br>  ููุณ ูุฏู ุฃู ูุดุงูู ูู ุงูููุฑุจุงุก ูู ุงูุญูุงู - ููุน ุงููููุฐ ุนูู ุจุนุฏ ูุชุฑ ูู ุงูุฃูุชุงุฑ ุ ูุฐูู ุณุฃููู ุจุชุดุบููู ูู 220 ูููุช.  ููุตุฏุฑ ููุทุงูุฉ ุ ุณุฃุนูู ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุชูุฉ</a> ุตุบูุฑุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู HLK-PM03</a> ูู ุชููุณุชุงุฑ ุฑูุจูุช.  ุฃูุง ุดุฎุตูุงู ูุญูู ูู ุงูุชุนุงูู ูุน ุงูุฅููุชุฑูููุงุช ุงูุชูุงุธุฑูุฉ ูุงูููุฑุจุงุฆูุฉ ุ ูููู ููุง ูุตุฏุฑ ุทุงูุฉ ููุชูู ูู ุญุงูุฉ ุตุบูุฑุฉ. <br><br>  ููุฅุดุงุฑุฉ ุฅูู ุฃูุถุงุน ุงูุชุดุบูู ุ ููุช ุจุชูููุฑ LED ูุชุตู ุจู GPIO2.  ููุน ุฐูู ุ ูู ุฃุจุฏุฃ ูู ูุญุงููุง ุ ูุฃู  ุชุญุชูู ูุญุฏุฉ ESP-07 ุจุงููุนู ุนูู LED ุ ุนูุงูุฉ ุนูู ุฐูู ุ ูุชุตู ุจููุณ GPIO2.  ูููู ุฏุนูุง ุชููู ุนูู ุงูููุญุฉ - ูุฌุฃุฉ ุฃุฑูุฏ ุฃู ุฃุญูู ูุฐุง LED ุฅูู ุงูุนูุจุฉ. <br><br>  ููุชูู ุฅูู ุงูุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู.  ุนุฏุงุฏุงุช ุงูููุงู ููุณ ููุง ููุทู ุ ูุง ูููู ุฃู ูุทูุจ ูููุง ุงููุฑุงุกุงุช ุงูุญุงููุฉ.  ุงูุดูุก ุงููุญูุฏ ุงููุชุงุญ ููุง ูู ุงูุจููู - ุฅุบูุงู ุฌูุงุช ุงุชุตุงู ููุชุงุญ ุงููุตุจ ูู ูุชุฑ.  ูุชู ูุถุน ุงุณุชูุชุงุฌุงุช ููุงุชูุญ ุงููุตุจ ูู GPIO12 / GPIO13.  ุณุฃููู ุจุชุดุบูู ุงูููุงูู ููุณุญุจ ุจุฑูุฌููุง ุฏุงุฎู ุงููุญุฏุฉ ุงูููุทูุฉ. <br><br>  ูู ุงูุจุฏุงูุฉ ุ ูุณูุช ุชูุฏูู ููุงููุงุช R8 ู R9 ุ ููู ูุณุฎุชู ูู ุงูููุญุฉ ููุณุช ูุฐูู.  ูููู ุจูุง ุฃููู ุฃููู ุจุงููุนู ุจุนุฑุถ ุงููุฎุทุท ุนูู ุงูููุฃ ุ ููู ุงูุฌุฏูุฑ ุชุตุญูุญ ูุฐุง ุงูุฅุดุฑุงู.  ููุงู ุญุงุฌุฉ ุฅูู ููุงููุงุช ุญุชู ูุง ุชุญุฑู ุงููููุฐ ุฅุฐุง ูุงูุช ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ ูู ุนุฑุจุงุช ุงูุชู ุชุฌุฑูุง ุงูุฏูุงุจ ูุชุถุน ุงููุญุฏุฉ ุนูู ุงูุฏุจูุณ ุ ููุญูู ููุชุงุญ ุงููุตุจ ูุฐุง ุงูุฎุท ุฅูู ุงูุฃุฑุถ (ุจุญุฏ ุฃูุตู 3.3 ูููุช / 1000 ุฃูู = 3.3 ูููู ุฃูุจูุฑ ูุชุฏูู ูุน ุงูููุงูู). <br><br>  ุญุงู ุงูููุช ููุชูููุฑ ูู ูุง ูุฌุจ ูุนูู ุฅุฐุง ุงููุทุนุช ุงูููุฑุจุงุก.  ุงูุฎูุงุฑ ุงูุฃูู ูู ุฃู ุชุทูุจ ูู ุงูุฎุงุฏู ุงูุนุฏุงุฏุงุช ุงูุฃูููุฉ ูู ุงูุจุฏุงูุฉ.  ููู ูุฐุง ูุชุทูุจ ุชุนููุฏูุง ูุจูุฑูุง ูุจุฑูุชูููู ุงูุชุจุงุฏู.  ุนูุงูุฉ ุนูู ุฐูู ุ ูุนุชูุฏ ุชุดุบูู ุงูุฌูุงุฒ ูู ูุฐู ุงูุญุงูุฉ ุนูู ุญุงูุฉ ุงูุฎุงุฏู.  ุฅุฐุง ุ ุจุนุฏ ุฅููุงู ุชุดุบูู ุงูุถูุก ุ ูู ูุจุฏุฃ ุงูุฎุงุฏู (ุฃู ุจุฏุฃ ูู ููุช ูุงุญู) ุ ููู ูุชููู ุนุฏุงุฏ ุงูููุงู ูู ุทูุจ ุงูููู ุงูุฃูููุฉ ูุณูุนูู ุจุดูู ุบูุฑ ุตุญูุญ. <br><br>  ูุฐูู ุ ูุฑุฑุช ุชูููุฐ ุชุฎุฒูู ููู ุงูุนุฏุงุฏ ูู ุดุฑูุญุฉ ุฐุงูุฑุฉ ูุชุตูุฉ ุนุจุฑ I2C.  ููุณ ูุฏู ุฃู ูุชุทูุจุงุช ุฎุงุตุฉ ูุญุฌู ุฐุงูุฑุฉ ุงูููุงุด - ุฃุญุชุงุฌ ุฅูู ุญูุธ ุฑูููู ููุท (ุนุฏุฏ ุงููุชุฑุงุช ุจูุงุณุทุฉ ุนุฏุงุฏุงุช ุงูููุงู ุงูุณุงุฎูุฉ ูุงูุจุงุฑุฏุฉ).  ุญุชู ุฃุตุบุฑ ูุญุฏุฉ ุณุชูุนู.  ูููู ูู ุนุฏุฏ ุฏูุฑุงุช ุงูุชุณุฌูู ุ ุนููู ุงูุงูุชุจุงู.  ุจุงููุณุจุฉ ููุนุธู ุงููุญุฏุงุช ุ ูุฐุง ูู 100 ุฃูู ุฏูุฑุฉ ุ ูุจุนุถูุง ูุตู ุฅูู ููููู. <br><br>  ูุจุฏู ุฃู ุงูููููู ูุซูุฑ.  ูููู ููุฏุฉ 4 ุณููุงุช ูู ุงูุนูุด ูู ุดูุชู ุ ุงุณุชูููุช ุฃูุซุฑ ูู 500 ูุชุฑ ููุนุจ ูู ุงููุงุก ุ ุฃู 500 ุฃูู ูุชุฑ!  ู 500 ุฃูู ูุฏุฎู ูู ุงูููุงุด.  ููุฐู ููุงู ุจุงุฑุฏุฉ ููุท.  ููููู ุจุงูุทุจุน ูุญุงู ุงูุดุฑูุญุฉ ูู ุนุงููู ุ ูููู ุงุชุถุญ ุฃู ููุงู ุฑูุงุฆู FRAM.  ูู ูุฌูุฉ ูุธุฑ ุงูุจุฑูุฌุฉ ุ ูุฐุง ูู ููุณ I2C EEPROM ุ ูููู ูุน ุนุฏุฏ ูุจูุฑ ุฌุฏูุง ูู ุฏูุฑุงุช ุฅุนุงุฏุฉ ุงููุชุงุจุฉ (ูุฆุงุช ุงูููุงููู).  ูุฐุง ููุท ุญุชู ูุตู ูู ุดูุก ุฅูู ุงููุชุฌุฑ ุจูุซู ูุฐู ุงูุฑูุงุฆู ุจุฃู ุดูู ูู ุงูุฃุดูุงู ุ ูุฐูู ูู ุงูููุช ุงูุญุงูู ุณููู 24LC512 ุงููุนุชุงุฏ. <br><br><h3 style=";text-align:right;direction:rtl">  ููุญุฉ ุงูุฏูุงุฆุฑ </h3><br>  ูู ุงูุจุฏุงูุฉ ุ ุฎุทุทุช ูุฑุณู ุฑุณู ูู ุงูููุฒู.  ูุฐูู ุ ุชู ุชุตููู ุงูููุญุฉ ูุฌุงูุจ ูุงุญุฏ.  ูููู ุจุนุฏ ุณุงุนุฉ ุทูููุฉ ุจูููุงุฉ ุงูููุฒุฑ ูููุงุน ุงููุญุงู (ุจุฏูููุง ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู) ุ ูุง ุฒูุช ูุฑุฑุช ุทูุจ ุฃููุงุญ ูู ุงูุตููููู. <br><br><img src="https://habrastorage.org/webt/en/si/rz/ensirzhmczp3bs9n7a6a8plmzl4.png"><br><br>  ูุจู ุทูุจ ุงูููุญุฉ ุชูุฑูุจูุง ุ ุฃุฏุฑูุช ุฃูู ุจุงูุฅุถุงูุฉ ุฅูู ุดุฑูุญุฉ ุงูุฐุงูุฑุฉ ุงููุญูููุฉ ุนูู ูุงูู I2C ุ ููููู ุงูุชูุงุท ุดูุก ุขุฎุฑ ูููุฏ ุ ูุซู ุดุงุดุฉ ุงูุนุฑุถ.  ูุง ูุฌุจ ุฃู ูุฎุฑุฌ ุฅููู ุจุงูุถุจุท ูุง ุฒุงู ุณุคุงููุง ุ ูููู ุชุญุชุงุฌ ุฅูู ุงูุชูุงุซุฑ ุนูู ุงูุณุจูุฑุฉ.  ุญุณููุง ุ ูุธุฑูุง ูุฃููู ููุช ุณุฃุทูุจ ุงูุฃููุงุญ ูู ุงููุตูุน ุ ููุง ูุนูู ููุตุฑ ููุณู ุนูู ููุญุฉ ุฃุญุงุฏูุฉ ุงูุฌุงูุจ ุ ูุฐุง ูุฅู ุงูุฎุทูุท ุงูููุฌูุฏุฉ ุนูู I2C ูู ุงูุฎุทูุท ุงููุญูุฏุฉ ุนูู ุธูุฑ ุงูููุญุฉ. <br><br>  ุงุฑุชุจุทุช ุฏุนุงูุฉ ูุงุญุฏุฉ ูุจูุฑุฉ ุฃูุถูุง ุจุงูุฃุณูุงู ูู ุฌุงูุจ ูุงุญุฏ.  ูุฃู  ุชู ุฑุณู ุงูููุญุฉ ุนูู ุฌุงูุจ ูุงุญุฏ ุ ูุชู ุงูุชุฎุทูุท ููุถุน ุงููุณุงุฑุงุช ูููููุงุช SMD ุนูู ุฌุงูุจ ูุงุญุฏ ุ ูููููุงุช ุงูุฅุฎุฑุงุฌ ูุงูููุตูุงุช ูุฅูุฏุงุฏุงุช ุงูุทุงูุฉ ูู ุฌูุฉ ุฃุฎุฑู.  ุนูุฏูุง ุงุณุชููุช ุงูููุญุงุช ูู ุดูุฑ ุ ูุณูุช ุงูุฎุทุฉ ุงูุฃูููุฉ ููู ุถุบุท ุฌููุน ุงูููููุงุช ุนูู ุงูุฌุงูุจ ุงูุฃูุงูู.  ูููุท ุนูุฏูุง ูุชุนูู ุงูุฃูุฑ ุจูุญุงู ูุตุฏุฑ ุงูุทุงูุฉ ุ ุงุชุถุญ ุฃู ุงูุทุฑุญ ุฒุงุฆุฏ ููุงูุต ุชู ูุตูููุง ุนูู ุงูุนูุณ.  ุงุถุทุฑุฑุช ุฅูู ุงููุฒุงุฑุน ุงูุฌูุงุนูุฉ ูุน ูุงุนุจุง.  ูู ุงูุตูุฑุฉ ุฃุนูุงู ุ ููุช ุจุงููุนู ุจุชุบููุฑ ุงูุฃุณูุงู ุ ูููู ูุชู ุทุฑุญ ุงูุฃุฑุถ ูู ุฌุฒุก ูู ุงูููุญุฉ ุฅูู ุงูุฌุฒุก ุงูุขุฎุฑ ูู ุฎูุงู ูุฎุฑุฌุงุช ุฒุฑ ุงูุชูููุฏ (ุนูู ุงูุฑุบู ูู ุฃูู ูู ุงููููู ุฑุณู ูุณุงุฑ ุนูู ุงูุทุจูุฉ ุงูุซุงููุฉ). <br><br>  ุงุชุถุญ ูุซู ูุฐุง <br><br><img src="https://habrastorage.org/webt/au/-d/cs/au-dcsvpehh9p5g9iqyob5hjslu.jpeg"><br><br><h3 style=";text-align:right;direction:rtl">  ุงูุฅุณูุงู </h3><br>  ุงูุฎุทูุฉ ุงูุชุงููุฉ ูู ุงูุณูู.  ูุน ุทุงุจุนุฉ ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ ุ ูุฐู ููุณุช ูุดููุฉ.  ูู ุฃุฒุนุฌูู ูุซูุฑูุง - ููุฏ ููุช ุจุฑุณู ุตูุฏูู ุจุงูุญุฌู ุงูุตุญูุญ ูููุช ุจุนูู ููุงุทุน ูู ุงูุฃูุงูู ุงูููุงุณุจุฉ.  ูุชู ุฅุฑูุงู ุงูุบุทุงุก ุจุงูุฌุณู ุนูู ูุณุงููุฑ ุตุบูุฑุฉ. <br><br><img src="https://habrastorage.org/webt/qq/lu/zp/qqluzptanq4d24dsv4jdlb9uif8.png"><br><br>  ููุฏ ุฐูุฑุช ุจุงููุนู ุฃูู ูููู ุงุณุชุฎุฏุงู ุฒุฑ ุงูุชูููุฏ ูุฒุฑ ููุฃุบุฑุงุถ ุงูุนุงูุฉ - ููุง ูุฃุชู ุจู ุฅูู ุงูููุญุฉ ุงูุฃูุงููุฉ.  ููููุงู ุจุฐูู ุ ูุฌูุช "ุจุฆุฑ" ุฎุงุต ุญูุซ ููุฌุฏ ุงูุฒุฑ. <br><br><img src="https://habrastorage.org/webt/dv/xg/gn/dvxggnexv-fiqy0jqtptpdk1dvy.png"><br><br>  ููุฌุฏ ุฏุงุฎู ุงูุนูุจุฉ ุฃูุถูุง ุฌุฐูุน ูุชู ุชุซุจูุช ุงูููุญุฉ ุนูููุง ูุชุซุจูุชูุง ุจูุณูุงุฑ M3 ูุงุญุฏ (ูู ูุนุฏ ููุงู ูุณุงุญุฉ ุนูู ุงูููุญุฉ) <br><br>  ุชู ุงุฎุชูุงุฑ ุงูุดุงุดุฉ ุนูุฏูุง ุทุจุนุช ุฃูู ูุณุฎุฉ ููุงุณุจุฉ ูู ุงูุนูุจุฉ.  ูู ูุชูุงุณุจ ุงูุฎุทุงู ุงูููุงุณูุงู ูู ูุฐู ุงูุญุงูุฉ ุ ูููู ุชู ุงูุนุซูุฑ ุนูู ุดุงุดุฉ OLED SSD1306 128x32 ูู ุงูุงูุญุฑุงู.  ุฅูู ุตุบูุฑ ุ ูููู ูุณุช ูุถุทุฑูุง ูุฃู ุฃููู ูุธุฑุฉ ุนููู ูู ููู - ุณุชุณูุฑ. <br><br>  ูุชูุฏูุฑ ูู ูู ุงูุทุฑููุฉ ูููู ุณูุชู ูุถุน ุงูุฃุณูุงู ููู ุ ูุฑุฑุช ุงูุชูุณู ุจุงูุดุงุดุฉ ูู ููุชุตู ุงูุนูุจุฉ.  ุจูุฆุฉ ุงูุนูู ุ ุจุงูุทุจุน ุ ุชุญุช ุงูููุญ - ุฒุฑ ูู ุงูุฃุนูู ุ ุดุงุดุฉ ูู ุงูุฃุณูู.  ููููู ููุช ุจุงููุนู ุฃู ููุฑุฉ ุดุฏ ุงูุดุงุดุฉ ุฌุงุกุช ูุชุฃุฎุฑุฉ ุฌุฏูุง ููุงู ูู ุงููุณู ุฌุฏูุง ุฅุนุงุฏุฉ ุชุฑุชูุจ ุงูููุญุฉ ูุชุญุฑูู ุงูุฒุฑ. <br><br>  ุงูุฌูุงุฒ ููุชูู.  ูุชู ูุตู ูุญุฏุฉ ุงูุนุฑุถ ุนูู ูููุงุช ุชุฐูุจ ุงูุณุงุฎูุฉ <br><br><img src="https://habrastorage.org/webt/sn/qr/xf/snqrxfyyihzqwiwwwf-1yly545m.jpeg"><br><br><img src="https://habrastorage.org/webt/ow/bh/2o/owbh2oguwv4tiez2basnv11hgvw.jpeg"><br><br>  ูููู ุฑุคูุฉ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ ุนูู KDPV <br><br><h3 style=";text-align:right;direction:rtl">  ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ </h3><br>  ุฏุนูุง ููุชูู ุฅูู ุฌุฒุก ุงูุจุฑูุงูุฌ.  ุจุงููุณุจุฉ ููุซู ูุฐู ุงูุญุฑู ุงูุตุบูุฑุฉ ุ ุฃุญุจ ุญููุง ุงุณุชุฎุฏุงู ูุบุฉ Python ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">micropython</a> ) - ุงูุฑูุฒ ูุถุบูุท ููุบุงูุฉ ูููููู.  ูุญุณู ุงูุญุธ ุ ููุณุช ููุงู ุญุงุฌุฉ ููุฐูุงุจ ุฅูู ูุณุชูู ุงูุณุฌูุงุช ูู ุฃุฌู ุงูุถุบุท ุนูู ุงููููุฑูุซุงููุฉ - ูู ุดูุก ูููู ุงูููุงู ุจู ูู ุงูุซุนุจุงู. <br><br>  ูุจุฏู ุฃู ุงูุฃูุฑ ููู ุจุณูุท ุ ูููู ููุณ ููุบุงูุฉ - ูุชู ุชุญุฏูุฏ ุงูุนุฏูุฏ ูู ุงููุธุงุฆู ุงููุณุชููุฉ ูู ุงูุฌูุงุฒ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุถุบุท ุงููุณุชุฎุฏู ุนูู ุฒุฑ ูููุธุฑ ุฅูู ุงูุดุงุดุฉ </li><li style=";text-align:right;direction:rtl">  ูุถุน ุนูุงูุฉ ูุชุฑ ูุชุญุฏูุซ ุงูููู ูู ุฐุงูุฑุฉ ููุงุด </li><li style=";text-align:right;direction:rtl">  ุชููู ุงููุญุฏุฉ ุจูุฑุงูุจุฉ ุฅุดุงุฑุฉ WiFi ูุฅุนุงุฏุฉ ุงูุงุชุตุงู ุฅุฐุง ูุฒู ุงูุฃูุฑ </li><li style=";text-align:right;direction:rtl">  ุญุณููุง ุ ุจุฏูู ุถูุก ูุงูุถ ุ ูุง ููููู ูุนู ุฐูู ุนูู ุงูุฅุทูุงู </li></ul><br>  ูู ุงููุณุชุญูู ุงูุชุฑุงุถ ุฃู ุฅุญุฏู ุงููุธุงุฆู ูู ุชูุฌุญ ุฅุฐุง ูุงูุช ุงูุฃุฎุฑู ุบุจูุฉ ูุณุจุจ ูุง.  ููุฏ ุฃููุช ุจุงููุนู ุงูุตุจุงุฑ ูู ูุดุงุฑูุน ุฃุฎุฑู ุ ูุงูุขู ุฃุฑู ุฎูููุง ูู ุฃุณููุจ "ูุงุชู ูุชุฑ ุขุฎุฑ ุ ูุฃูู ูู ูุฐู ุงููุญุธุฉ ุชู ุชุญุฏูุซ ุงูุดุงุดุฉ" ุฃู "ูุง ูููู ูููุณุชุฎุฏู ุงูููุงู ุจุฃู ุดูุก ุฃุซูุงุก ุงุชุตุงู ุงููุญุฏุฉ ุจุดุจูุฉ WiFi".  ุจุงูุทุจุน ุ ูููู ุงูููุงู ุจุจุนุถ ุงูุฃุดูุงุก ูู ุฎูุงู ุงูููุงุทุนุงุช ุ ูููู ููููู ุฃู ุชูุงุฌู ูููุฏูุง ุนูู ุงููุฏุฉ ุฃู ุชุนุดูุด ุงูููุงููุงุช ุฃู ุงูุชุบููุฑ ุบูุฑ ุงูุฐุฑู ูููุชุบูุฑุงุช.  ุญุณููุง ุ ุงูุดูุฑุฉ ุงูุชู ุชูุนู ูู ุดูุก ูุชุชุญูู ููุฑูุง ุฅูู ููุถู. <br><br>  ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุดุฑูุน ุ</a> ุงุณุชุฎุฏูุช ุชุนุฏุฏ ุงูููุงู ุงูููุงุฆู ุงูููุงุณููู ู FreeRTOS ุจุดูู ุฃูุซุฑ ุฌุฏูุฉ ุ ูููู ูู ูุฐู ุงูุญุงูุฉ ุชุจูู ุฃู ูููุฐุฌ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Coroutines ูููุชุจุฉ uasync</a> ุฃูุซุฑ ููุงุกูุฉ.  ุนูุงูุฉ ุนูู ุฐูู ุ ูุฅู ุชูููุฐ Pitonovskiy ููููุฑูุชูู ูู ูุฌุฑุฏ ููุจูุฉ - ุจุงููุณุจุฉ ูููุจุฑูุฌ ุ ุชู ุนูู ูู ุดูุก ุจุจุณุงุทุฉ ูุณูููุฉ.  ููุท ุงูุชุจ ููุทูู ุงูุฎุงุต ุ ููุท ุฃุฎุจุฑูู ูู ุงูุฃูุงูู ุงูุชู ููููู ุงูุชุจุฏูู ูููุง ุจูู ุงูููุงุถูุน. <br><br>  ุฃูุชุฑุญ ุงุณุชูุดุงู ุงูุงุฎุชูุงูุงุช ุจูู ุงูุชุฒุงุญู ูุชุนุฏุฏ ุงูููุงู ุงูุชูุงูุณูุฉ ุจุดูู ุงุฎุชูุงุฑู.  ุงูุขู ุ ุฏุนูุง ููุชูู ุฃุฎูุฑูุง ุฅูู ุงูุฑูุฒ. <br><br><pre style=";text-align:right;direction:rtl"><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">##################################### # Counter class - implements a single water counter on specified pin ##################################### class Counter(): debounce_ms = const(25) def __init__(self, pin_num, value_storage): self._value_storage = value_storage self._value = self._value_storage.read() self._value_changed = False self._pin = Pin(pin_num, Pin.IN, Pin.PULL_UP) loop = asyncio.get_event_loop() loop.create_task(self._switchcheck()) # Thread runs forever</span></span></code> </pre> <br>  ุชุชู ูุนุงูุฌุฉ ูู ุนุฏุงุฏ ุจูุซูู ูู ูุฆุฉ ุงูุนุฏุงุฏ.  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ูุชู ุทุฑุญ ุงููููุฉ ุงูุฃูููุฉ ููุนุฏุงุฏ ูู EEPROM (value_storage) - ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ูุชู ุจูุง ุชูููุฐ ุงูุงุณุชุฑุฏุงุฏ ูู ุงููุทุงุน ุงูุชูุงุฑ ุงูููุฑุจุงุฆู. <br><br>  ูุชู ุชููุฆุฉ ุงูุฏุจูุณ ุจุณุญุจ ูุฏูุฌ ุฅูู ุงูุทุงูุฉ: ุฅุฐุง ุชู ุฅุบูุงู ููุชุงุญ ุงููุตุจ ุ ูุฅูู ูููู ุตูุฑูุง ุนูู ุงูุฎุท ุ ุฅุฐุง ูุงู ุงูุฎุท ููุชูุญูุง ุ ูุชู ุณุญุจ ุงูุฎุท ุฅูู ุงูุทุงูุฉ ููุฑุงุกุฉ ูุญุฏุฉ ุงูุชุญูู ูุงุญุฏุฉ. <br><br>  ุฃูุถุง ุ ุชู ุฅุทูุงู ูููุฉ ูููุตูุฉ ููุง ุ ูุงูุชู ุณุชุณุชุทูุน ุงูุฏุจูุณ.  ุณูููู ูู ุนุฏุงุฏ ุจุชุดุบูู ูููุชู ุงูุฎุงุตุฉ.  ูุง ูู ุฑูุฒูุง <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-string"><span class="hljs-string">""" Poll pin and advance value when another litre passed """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_switchcheck</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> last_checked_pin_state = self._pin.value() <span class="hljs-comment"><span class="hljs-comment"># Get initial state # Poll for a pin change while True: state = self._pin.value() if state != last_checked_pin_state: # State has changed: act on it now. last_checked_pin_state = state if state == 0: self._another_litre_passed() # Ignore further state changes until switch has settled await asyncio.sleep_ms(Counter.debounce_ms)</span></span></code> </pre> <br>  ููุงู ุญุงุฌุฉ ุฅูู ุชุฃุฎูุฑ 25 ูููู ุซุงููุฉ ูุชุตููุฉ ุงุฑุชุฏุงุฏ ุฌูุงุช ุงูุงุชุตุงู ุ ููู ููุณ ุงูููุช ููุธู ุนุฏุฏ ูุฑุงุช ุงุณุชููุงุธ ุงููููุฉ (ุฃุซูุงุก ุงูููู ุ ุชุนูู ููุงู ุฃุฎุฑู).  ุชุณุชููุธ ุงููุธููุฉ ูู 25 ูููู ุซุงููุฉ ุ ูุชุชุญูู ูู ุงูุฏุจูุณ ูุฅุฐุง ูุงูุช ุฌูุงุช ุงุชุตุงู ููุชุงุญ ุงููุตุจ ูุบููุฉ ุ ูุฅู ูุชุฑูุง ุขุฎุฑ ููุฑ ุนุจุฑ ุงูุนุฏุงุฏ ููุฐุง ูุญุชุงุฌ ุฅูู ุงููุนุงูุฌุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_another_litre_passed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self._value += <span class="hljs-number"><span class="hljs-number">1</span></span> self._value_changed = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self._value_storage.write(self._value)</code> </pre> <br>  ูุนุงูุฌุฉ ุงููุชุฑ ุงูุชุงูู ุฃูุฑ ุชุงูู - ุงูุนุฏุงุฏ ุจุจุณุงุทุฉ ูุฒูุฏ.  ุญุณููุง ุ ุณูููู ูู ุงูุฌูุฏ ุงููุชุงุจุฉ ุฅูู ูุญุฑู ุฃูุฑุงุต ูุญููู ูููุฉ ุฌุฏูุฏุฉ. <br><br>  ูุณูููุฉ ุงูุงุณุชุฎุฏุงู ุ ูุชู ุชูููุฑ "ุงูููุตูุงุช". <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">value</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self._value_changed = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._value <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set_value</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, value)</span></span></span><span class="hljs-function">:</span></span> self._value = value self._value_changed = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre> <br>  ุญุณููุง ุ ุณูุณุชุบู ุงูุขู ููุฐุงุช ุงูุซุนุจุงู ูููุชุจุฉ uasync ููุฌุนู ุงููุงุฆู ุงููุถุงุฏ ูุงุจููุง ููุงูุชุธุงุฑ (ููู ูููู ุชุฑุฌูุชู ุฅูู ุงููุบุฉ ุงูุฑูุณูุฉุ ูุง ูููู ุชููุนูุ) <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__await__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self._value_changed: <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> asyncio.sleep(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.value() __iter__ = __await__</code> </pre> <br>  ูุฐู ูุธููุฉ ููุงุณุจุฉ ุชูุชุธุฑ ุญุชู ูุชู ุชุญุฏูุซ ูููุฉ ุงูุนุฏุงุฏ - ุชุณุชููุธ ุงููุธููุฉ ูู ููุช ูุขุฎุฑ ูุชุชุญูู ูู ุนูุงูุฉ _value_changed.  ููุชุฉ ูุฐู ุงููุธููุฉ ูู ุฃู ุฑูุฒ ุงูุงุชุตุงู ูููู ุฃู ููุงู ุนูู ุงุณุชุฏุนุงุก ููุฐู ุงููุธููุฉ ูุงูููู ุญุชู ูุชู ุชููู ูููุฉ ุฌุฏูุฏุฉ. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูููู ูุงุฐุง ุนู ุงูููุงุทุนุงุชุ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl">  ูุนู ุ ูู ูุฐุง ุงูููุงู ุ ููููู ุงูุชุตูุฏ ุจู ุ ูุงุฆูุงู ุฅูู ูู ููุณู ูุงู ุนู ุงูุงููุทุงุนุงุช ุ ููููู ูู ุงููุงูุน ุฑุชุจ ุงุณุชุทูุงุนูุง ุบุจููุง ููุฏุจูุณ.  ูู ุงููุงูุน ุ ุงูููุงุทุนุงุช ูู ุฃูู ุดูุก ุฌุฑุจุชู.  ูู ESP8266 ุ ููููู ุชูุธูู ููุงุทุนุฉ ุนูู ุงูุญุงูุฉ ุ ูุญุชู ูุชุงุจุฉ ูุนุงูุฌ ููุฐู ุงูููุงุทุนุฉ ูู ุงูุซุนุจุงู.  ูู ูุฐู ุงูููุงุทุนุฉ ุ ููููู ุชุญุฏูุซ ูููุฉ ูุชุบูุฑ.  ุนูู ุงูุฃุฑุฌุญ ุ ุณูููู ูุฐุง ูุงูููุง ุฅุฐุง ูุงู ุงูุนุฏุงุฏ ุฌูุงุฒูุง ุชุงุจุนูุง - ุฌูุงุฒ ููุชุธุฑ ุญุชู ููุทูุจ ููู ูุฐู ุงููููุฉ. <br><br>  ูุณูุก ุงูุญุธ (ุฃู ูุญุณู ุงูุญุธุ) ุฌูุงุฒู ูุดุท ุ ูุฌุจ ุนููู ุฅุฑุณุงู ุฑุณุงุฆู ุจุงุณุชุฎุฏุงู ุจุฑูุชูููู MQTT ููุชุงุจุฉ ุงูุจูุงูุงุช ุฅูู EEPROM.  ูููุง ุชุฃุชู ุงููููุฏ ุจุงููุนู - ูุง ููููู ุชุฎุตูุต ุฐุงูุฑุฉ ูุงุณุชุฎุฏุงู ูุฌููุนุฉ ูุจูุฑุฉ ูู ุงูููุงุทุนุงุช ุ ููุง ูุนูู ุฃูู ููููู ูุณูุงู ุฅุฑุณุงู ุงูุฑุณุงุฆู ุนุจุฑ ุงูุดุจูุฉ.  ููุงู ูุนูุงุช ูุซู micropython.schedule () ุงูุชู ุชุณูุญ ูู ุจุชุดุบูู ููุน ูู ุงููุธุงุฆู "ุจูุฌุฑุฏ ุญุฏูุซูุง ุนูู ุงูููุฑ" ุ ูููู ุงูุณุคุงู ูู "ูุง ูู ุงูููุทุฉุ".  ูุฌุฃุฉ ูุฑุณู ููุนูุง ูู ุงูุฑุณุงุฆู ูู ุงูููุช ุงูุญุงูู ุ ูููุง ุชููุทุน ุงูุฃูุชุงุฏ ูุชูุณุฏ ููู ุงููุชุบูุฑุงุช.  ุฃู ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุตูุช ูููุฉ ุนุฏุงุฏ ุฌุฏูุฏุฉ ูู ุงูุฎุงุฏู ุจูููุง ูุง ุฒููุง ูู ููุชุจ ุงููููุฉ ุงููุฏููุฉ.  ุจุดูู ุนุงู ุ ุชุญุชุงุฌ ุฅูู ุณูุงุฌ ุงููุฒุงููุฉ ุฃู ุงูุฎุฑูุฌ ุจุทุฑููุฉ ูุฎุชููุฉ. <br><br>  ููู ููุช ูุขุฎุฑ ุ ูุชุนุทู RuntimeError: ุฌุฏูู ุงูููุฏุณ ููุชูุฆ ููู ูุฏุฑู ููุงุฐุงุ <br><br>  ูุน ุงุณุชุทูุงุน ูุงุถุญ ู uasync ุ ูู ูุฐู ุงูุญุงูุฉ ุฃูุซุฑ ุฌูุงูุง ูุฃูุซุฑ ููุซูููุฉ ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู. <br></div></div><br>  ููุฏ ุนููุช ูุน EEPROM ูู ูุตู ุตุบูุฑ <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EEPROM</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">:</span></span> i2c_addr = const(<span class="hljs-number"><span class="hljs-number">80</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, i2c)</span></span></span><span class="hljs-function">:</span></span> self.i2c = i2c self.i2c_buf = bytearray(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-comment"><span class="hljs-comment"># Avoid creation/destruction of the buffer on each call def read(self, eeprom_addr): self.i2c.readfrom_mem_into(self.i2c_addr, eeprom_addr, self.i2c_buf, addrsize=16) return ustruct.unpack_from("&lt;I", self.i2c_buf)[0] def write(self, eeprom_addr, value): ustruct.pack_into("&lt;I", self.i2c_buf, 0, value) self.i2c.writeto_mem(self.i2c_addr, eeprom_addr, self.i2c_buf, addrsize=16)</span></span></code> </pre> <br>  ูู ุจุงูุซูู ุ ูู ุงูุตุนุจ ุงูุนูู ูุน ูุญุฏุงุช ุงูุจุงูุช ูุจุงุดุฑุฉู ุ ูููู ูุญุฏุงุช ุงูุจุงูุช ุงูููุชูุจุฉ ุนูู ุงูุฐุงูุฑุฉ.  ุงุถุทุฑุฑุช ุฅูู ุฅุตูุงุญ ุงูุชุญููู ุจูู ุงูุนุฏุฏ ุงูุตุญูุญ ูุงูุจุงูุช ุจุงุณุชุฎุฏุงู ููุชุจุฉ ustruct. <br><br>  ูู ุฃุฌู ุนุฏู ููู ูุงุฆู I2C ูุนููุงู ุฎููุฉ ุงูุฐุงูุฑุฉ ูู ูู ูุฑุฉ ุ ููุช ุจุชุบููููุง ุจุงููุงูู ูู ููุงุณููู ุตุบูุฑ ููุฑูุญ <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EEPROMValue</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, i2c, eeprom_addr)</span></span></span><span class="hljs-function">:</span></span> self._eeprom = EEPROM(i2c) self._eeprom_addr = eeprom_addr <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._eeprom.read(self._eeprom_addr) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, value)</span></span></span><span class="hljs-function">:</span></span> self._eeprom.write(self._eeprom_addr, value)</code> </pre> <br>  ูุชู ุฅูุดุงุก ูุงุฆู I2C ููุณู ุจูุซู ูุฐู ุงููุนููุงุช <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">i2c = I2C(freq=<span class="hljs-number"><span class="hljs-number">400000</span></span>, scl=Pin(<span class="hljs-number"><span class="hljs-number">5</span></span>), sda=Pin(<span class="hljs-number"><span class="hljs-number">4</span></span>))</code> </pre> <br>  ููุชุฑุจ ูู ุงูุดูุก ุงูุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู - ุชูููุฐ ุงูุชูุงุตู ูุน ุงูุฎุงุฏู ุนุจุฑ MQTT.  ุญุณููุง ุ ูุง ูุญุชุงุฌ ุงูุจุฑูุชูููู ููุณู ุฅูู ุงูุชูููุฐ - ุชู ุงูุนุซูุฑ ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชูููุฐ ุบูุฑ ูุชุฒุงูู ุฌุงูุฒ</a> ุนูู ุงูุฅูุชุฑูุช.  ููุง ุณูู ูุณุชุฎุฏููุง. <br><br>  ูุชู ุฌูุน ูู ุงูุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู ูู ูุฆุฉ CounterMQTTClient ุ ูุงูุชู ุชุนุชูุฏ ุนูู ููุชุจุฉ MQTTClient.  ููุจุฏุฃ ูู ุงููุญูุท <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">##################################### # Class handles both counters and sends their status to MQTT ##################################### class CounterMQTTClient(MQTTClient): blue_led = Pin(2, Pin.OUT, value = 1) button = Pin(0, Pin.IN) hot_counter = Counter(12, EEPROMValue(i2c, EEPROM_ADDR_HOT_VALUE)) cold_counter = Counter(13, EEPROMValue(i2c, EEPROM_ADDR_COLD_VALUE))</span></span></code> </pre> <br>  ููุง ุ ูุชู ุฅูุดุงุก ุฏุจุงุจูุณ ุงููุตุงุจูุญ ุงูููุฑุจุงุฆูุฉ ูุงูุฃุฒุฑุงุฑ ูุชูููููุง ุ ุจุงูุฅุถุงูุฉ ุฅูู ุฃุดูุงุก ูู ุนุฏุงุฏุงุช ุงูููุงู ุงูุจุงุฑุฏุฉ ูุงูุณุงุฎูุฉ. <br><br>  ูุน ุงูุชููุฆุฉ ุ ููุณ ูู ุดูุก ุชุงูููุง <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.internet_outage = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.internet_outages = <span class="hljs-number"><span class="hljs-number">0</span></span> self.internet_outage_start = ticks_ms() <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">"config.txt"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> config_file: config[<span class="hljs-string"><span class="hljs-string">'ssid'</span></span>] = config_file.readline().rstrip() config[<span class="hljs-string"><span class="hljs-string">'wifi_pw'</span></span>] = config_file.readline().rstrip() config[<span class="hljs-string"><span class="hljs-string">'server'</span></span>] = config_file.readline().rstrip() config[<span class="hljs-string"><span class="hljs-string">'client_id'</span></span>] = config_file.readline().rstrip() self._mqtt_cold_water_theme = config_file.readline().rstrip() self._mqtt_hot_water_theme = config_file.readline().rstrip() self._mqtt_debug_water_theme = config_file.readline().rstrip() config[<span class="hljs-string"><span class="hljs-string">'subs_cb'</span></span>] = self.mqtt_msg_handler config[<span class="hljs-string"><span class="hljs-string">'wifi_coro'</span></span>] = self.wifi_connection_handler config[<span class="hljs-string"><span class="hljs-string">'connect_coro'</span></span>] = self.mqtt_connection_handler config[<span class="hljs-string"><span class="hljs-string">'clean'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> config[<span class="hljs-string"><span class="hljs-string">'clean_init'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> super().__init__(config) loop = asyncio.get_event_loop() loop.create_task(self._heartbeat()) loop.create_task(self._counter_coro(self.cold_counter, self._mqtt_cold_water_theme)) loop.create_task(self._counter_coro(self.hot_counter, self._mqtt_hot_water_theme)) loop.create_task(self._display_coro())</code> </pre> <br>  ูุชุนููู ูุนููุงุช ููุชุจุฉ mqtt_as ุ ูุชู ุงุณุชุฎุฏุงู ูุงููุณ ูุจูุฑ ููุฅุนุฏุงุฏุงุช ุงููุฎุชููุฉ - ุงูุชูููู.  ุชูุงุณุจูุง ูุนุธู ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ ุ ูููู ูุฌุจ ุถุจุท ุงูุนุฏูุฏ ูู ุงูุฅุนุฏุงุฏุงุช ุจุดูู ุตุฑูุญ.  ูู ุฃุฌู ุนุฏู ุชุณุฌูู ุงูุฅุนุฏุงุฏุงุช ูุจุงุดุฑุฉ ูู ุงูุฑูุฒ ุ ุฃููู ุจุชุฎุฒูููุง ูู ููู config.txt.  ูุฐุง ูุณูุญ ูู ุจุชุบููุฑ ุงูุฑูุฒ ุจุบุถ ุงููุธุฑ ุนู ุงูุฅุนุฏุงุฏุงุช ุ ููุฐูู ุชุซุจูุช ุงูุนุฏูุฏ ูู ุงูุฃุฌูุฒุฉ ุงููุชุทุงุจูุฉ ูุน ูุนููุงุช ูุฎุชููุฉ. <br><br>  ุชููู ุงููุชูุฉ ุงูุฃุฎูุฑุฉ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุจุชุดุบูู ุงูุนุฏูุฏ ูู coroutines ูุฎุฏูุฉ ูุธุงุฆู ูุฎุชููุฉ ูููุธุงู.  ูููุง ููู ูุซุงู ุนูู coroutine ุงูุฐู ูุฎุฏู ุงูุนุฏุงุฏุงุช <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_counter_coro</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, counter, topic)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># Publish initial value value = counter.value() await self.publish(topic, str(value)) # Publish each new value while True: value = await counter await self.publish_msg(topic, str(value))</span></span></code> </pre> <br>  ูู ุงูุฏูุฑุฉ ุ ููุชุธุฑ Corutin ูููุฉ ุนุฏุงุฏ ุฌุฏูุฏุฉ ูุจูุฌุฑุฏ ุธููุฑูุง ุ ูุฑุณู ุฑุณุงูุฉ ุจุงุณุชุฎุฏุงู ุจุฑูุชูููู MQTT.  ูุฑุณู ุงูุฌุฒุก ุงูุฃูู ูู ุงูุฑูุฒ ุงููููุฉ ุงูุฃูููุฉ ุญุชู ูู ูู ูุชุฏูู ุงููุงุก ุนุจุฑ ุงูุนุฏุงุฏ. <br><br>  ุชุฎุฏู ุงููุฆุฉ ุงูุฃุณุงุณูุฉ MQTTClient ููุณูุง ุ ูุชุจุฏุฃ ุงุชุตุงู WiFi ูุชุนุงูุฏ ุงูุงุชุตุงู ุนูุฏ ููุฏ ุงูุงุชุตุงู.  ุนูุฏูุง ุชุชุบูุฑ ุญุงูุฉ ุงุชุตุงู WiFi ุ ุชุฎุจุฑูุง ุงูููุชุจุฉ ุนู ุทุฑูู ุงูุงุชุตุงู ุจู wifi_connection_handler <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wifi_connection_handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, state)</span></span></span><span class="hljs-function">:</span></span> self.internet_outage = <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> state <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> state: self.dprint(<span class="hljs-string"><span class="hljs-string">'WiFi is up.'</span></span>) duration = ticks_diff(ticks_ms(), self.internet_outage_start) // <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> self.publish_debug_msg(<span class="hljs-string"><span class="hljs-string">'ReconnectedAfter'</span></span>, duration) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.internet_outages += <span class="hljs-number"><span class="hljs-number">1</span></span> self.internet_outage_start = ticks_ms() self.dprint(<span class="hljs-string"><span class="hljs-string">'WiFi is down.'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.sleep(<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br>  ุงููุธููุฉ ุชูุนู ุจุตุฏู ูู ุงูุฃูุซูุฉ.  ูู ูุฐู ุงูุญุงูุฉ ุ ูุนุชุจุฑ ุนุฏุฏ ุนูููุงุช ูุทุน ุงูุงุชุตุงู (internet_outages) ููุฏุชูุง.  ุนูุฏ ุงุณุชุนุงุฏุฉ ุงูุงุชุตุงู ุ ูุชู ุฅุฑุณุงู ููุช ุงูุชููู ุฅูู ุงูุฎุงุฏู. <br><br>  ุจุงูููุงุณุจุฉ ุ ููุงู ุญุงุฌุฉ ุฅูู ุงูููู ุงูุฃุฎูุฑ ููุท ุญุชู ุชุตุจุญ ุงููุธููุฉ ุบูุฑ ูุชุฒุงููุฉ - ูู ุงูููุชุจุฉ ูุชู ุงุณุชุฏุนุงุคูุง ุนุจุฑ ุงูุงูุชุธุงุฑ ุ ููููู ููุท ุงุณุชุฏุนุงุก ุงููุธุงุฆู ุงูููุฌูุฏุฉ ูู ุงูุฌุณู ุงูุชู ููุฌุฏ ุจูุง ุงูุชุธุงุฑ ุขุฎุฑ. <br><br>  ุจุงูุฅุถุงูุฉ ุฅูู ุงูุงุชุตุงู ุจุดุจูุฉ WiFi ุ ุชุญุชุงุฌ ุฃูุถูุง ุฅูู ุฅูุดุงุก ุงุชุตุงู ูุน ูุณูุท MQTT (ุงูุฎุงุฏู).  ุชููู ุงูููุชุจุฉ ุจุฐูู ุฃูุถูุง ุ ูููู ูุชู ููุญูุง ุงููุฑุตุฉ ููููุงู ุจุดูุก ูููุฏ ุนูุฏ ุฅูุดุงุก ุงูุงุชุตุงู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mqtt_connection_handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, client)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> client.subscribe(self._mqtt_cold_water_theme) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> client.subscribe(self._mqtt_hot_water_theme)</code> </pre> <br>  ูุดุชุฑู ููุง ูู ุงูุนุฏูุฏ ูู ุงูุฑุณุงุฆู - ุงูุฎุงุฏู ูุฏูู ุงูุขู ุงููุฏุฑุฉ ุนูู ุชุนููู ููู ุงูุนุฏุงุฏ ุงูุญุงููุฉ ุนู ุทุฑูู ุฅุฑุณุงู ุงูุฑุณุงูุฉ ุงูููุงุณุจุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mqtt_msg_handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, topic, msg)</span></span></span><span class="hljs-function">:</span></span> topicstr = str(topic, <span class="hljs-string"><span class="hljs-string">'utf8'</span></span>) self.dprint(<span class="hljs-string"><span class="hljs-string">"Received MQTT message topic={}, msg={}"</span></span>.format(topicstr, msg)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> topicstr == self._mqtt_cold_water_theme: self.cold_counter.set_value(int(msg)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> topicstr == self._mqtt_hot_water_theme: self.hot_counter.set_value(int(msg))</code> </pre> <br>  ุชููู ูุฐู ุงููุธููุฉ ุจูุนุงูุฌุฉ ุงูุฑุณุงุฆู ุงููุงุฑุฏุฉ ุ ูุงุนุชูุงุฏูุง ุนูู ุงูููุถูุน (ุงุณู ุงูุฑุณุงูุฉ) ุ ูุชู ุชุญุฏูุซ ููู ุฃุญุฏ ุงูุนุฏุงุฏุงุช <br><br>  ุฒูุฌ ูู ุงููุธุงุฆู ุงููุณุงุนุฏุฉ <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-comment"><span class="hljs-comment"># Publish a message if WiFi and broker is up, else discard async def publish_msg(self, topic, msg): self.dprint("Publishing message on topic {}: {}".format(topic, msg)) if not self.internet_outage: await self.publish(topic, msg) else: self.dprint("Message was not published - no internet connection")</span></span></code> </pre> <br>  ุชุฑุณู ูุฐู ุงููุธููุฉ ุฑุณุงุฆู ุฅุฐุง ุชู ุฅูุดุงุก ุงุชุตุงู.  ุฅุฐุง ูู ููู ููุงู ุงุชุตุงู ุ ูุชู ุชุฌุงูู ุงูุฑุณุงูุฉ. <br><br>  ููุฐู ูุฌุฑุฏ ูุธููุฉ ููุงุณุจุฉ ุชููู ุจุฅูุดุงุก ุฑุณุงุฆู ุชุตุญูุญ ุงูุฃุฎุทุงุก ูุฅุฑุณุงููุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">publish_debug_msg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, subtopic, msg)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> self.publish_msg(<span class="hljs-string"><span class="hljs-string">"{}/{}"</span></span>.format(self._mqtt_debug_water_theme, subtopic), str(msg))</code> </pre><br>  ุงููุซูุฑ ูู ุงููุต ุ ููููุง ูู ูููุถ ุถูุก LED.  ููุง <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-comment"><span class="hljs-comment"># Blink flash LED if WiFi down async def _heartbeat(self): while True: if self.internet_outage: self.blue_led(not self.blue_led()) # Fast blinking if no connection await asyncio.sleep_ms(200) else: self.blue_led(0) # Rare blinking when connected await asyncio.sleep_ms(50) self.blue_led(1) await asyncio.sleep_ms(5000)</span></span></code> </pre> <br>  ููุฏ ูุฏูุช ูุถุนู ูููุถ.  ุฅุฐุง ูููุฏ ุงูุงุชุตุงู (ุฃู ูุชู ุฅูุดุงุคู ููุชู) ุ ูุณูููุถ ุงูุฌูุงุฒ ุจุณุฑุนุฉ.  ุฅุฐุง ุชู ุชุฃุณูุณ ุงูุงุชุตุงู ุ ูููุถ ุงูุฌูุงุฒ ูุฑุฉ ูู 5 ุซูุงูู.  ุฅุฐุง ูุฒู ุงูุฃูุฑ ุ ููููู ููุง ุชูููุฐ ุฃูุถุงุน ูุงูุถุฉ ุฃุฎุฑู. <br><br>  ููู LED ูุฏููุฉ ููุบุงูุฉ.  ูุง ุฒููุง ูููุญ ุนูู ุงูุดุงุดุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_display_coro</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> display = SSD1306_I2C(<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">32</span></span>, i2c) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: display.poweron() display.fill(<span class="hljs-number"><span class="hljs-number">0</span></span>) display.text(<span class="hljs-string"><span class="hljs-string">"COLD: {:.3f}"</span></span>.format(self.cold_counter.value() / <span class="hljs-number"><span class="hljs-number">1000</span></span>), <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>) display.text(<span class="hljs-string"><span class="hljs-string">"HOT: {:.3f}"</span></span>.format(self.hot_counter.value() / <span class="hljs-number"><span class="hljs-number">1000</span></span>), <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>) display.show() <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.sleep(<span class="hljs-number"><span class="hljs-number">3</span></span>) display.poweroff() <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> self.button(): <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.sleep_ms(<span class="hljs-number"><span class="hljs-number">20</span></span>)</code> </pre> <br>  ูุฐุง ูุง ุชุญุฏุซุช ุนูู - ูู ูู ุจุณูุท ููุฑูุญ ูุน coroutines.  ุชุตู ูุฐู ุงููุธููุฉ ุงูุตุบูุฑุฉ ุชูุงุนู ุงููุณุชุฎุฏู ุจุงููุงูู.  ููุชุธุฑ Corutin ููุท ุฒุฑูุง ููุถุบุท ูุชุดุบูู ุงูุดุงุดุฉ ููุฏุฉ 3 ุซูุงูู.  ุชุนุฑุถ ุงูุดุงุดุฉ ูุฑุงุกุงุช ุงูุนุฏุงุฏุงุช ุงูุญุงููุฉ. <br><br>  ูุง ูุฒุงู ููุงู ุจุถุนุฉ ุฃุดูุงุก ุตุบูุฑุฉ.  ููุง ูู ุงููุธููุฉ ุงูุชู ุชุฏูุฑ ุงููุฒุฑุนุฉ ุจุฃููููุง (ุฅุนุงุฏุฉ).  ุชุชูุงูู ุงูุฏูุฑุฉ ุงูุฑุฆูุณูุฉ ููุท ุฅุฑุณุงู ูุนูููุงุช ูุชููุนุฉ ูุชุตุญูุญ ุงูุฃุฎุทุงุก ูุฑุฉ ูุงุญุฏุฉ ูู ุงูุฏูููุฉ.  ุจุดูู ุนุงู ุ ุฃูุชุจุณ ููุง ูู - ุฃุนุชูุฏ ุฃู ุงูุชุนููู ุจุดูู ุฎุงุต ููุณ ุถุฑูุฑููุง <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> self._connect_to_WiFi() <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> self._run_main_loop() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> e: self.dprint(<span class="hljs-string"><span class="hljs-string">'Global communication failure: '</span></span>, e) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.sleep(<span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_connect_to_WiFi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.dprint(<span class="hljs-string"><span class="hljs-string">'Connecting to WiFi and MQTT'</span></span>) sta_if = network.WLAN(network.STA_IF) sta_if.connect(config[<span class="hljs-string"><span class="hljs-string">'ssid'</span></span>], config[<span class="hljs-string"><span class="hljs-string">'wifi_pw'</span></span>]) conn = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> conn: <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> self.connect() conn = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.dprint(<span class="hljs-string"><span class="hljs-string">'Connected!'</span></span>) self.internet_outage = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_run_main_loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># Loop forever mins = 0 while True: gc.collect() # For RAM stats. mem_free = gc.mem_free() mem_alloc = gc.mem_alloc() try: await self.publish_debug_msg("Uptime", mins) await self.publish_debug_msg("Repubs", self.REPUB_COUNT) await self.publish_debug_msg("Outages", self.internet_outages) await self.publish_debug_msg("MemFree", mem_free) await self.publish_debug_msg("MemAlloc", mem_alloc) except Exception as e: self.dprint("Exception occurred: ", e) mins += 1 await asyncio.sleep(60)</span></span></code> </pre> <br>  ุญุณููุง ุ ููุงู ุงููุฒูุฏ ูู ุงูุฅุนุฏุงุฏุงุช ูุงูุซูุงุจุช ูุฅููุงู ุงููุตู <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">##################################### # Constants and configuration ##################################### config['keepalive'] = 60 config['clean'] = False config['will'] = ('/ESP/Wemos/Water/LastWill', 'Goodbye cruel world!', False, 0) MQTTClient.DEBUG = True EEPROM_ADDR_HOT_VALUE = const(0) EEPROM_ADDR_COLD_VALUE = const(4)</span></span></code> </pre> <br>  ูุจุฏุฃ ูู ูุฐุง ุงูุทุฑูู <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">client = CounterMQTTClient() loop = asyncio.get_event_loop() loop.run_until_complete(client.main())</code> </pre> <br><br><h3 style=";text-align:right;direction:rtl">  ุดูุก ูุน ุฐุงูุฑุชู ุฃุตุจุญ </h3><br>  ูุฐุง ุ ูู ุงูููุฏ ููุฌูุฏ.  ููุฏ ููุช ุจุชุญููู ุงููููุงุช ุจุงุณุชุฎุฏุงู ุฃุฏุงุฉ ampy - ููู ุชุชูุญ ุชุญููููุง ุนูู ูุญุฑู ุงูุฃูุฑุงุต ุงููุญููู ุงูุฏุงุฎูู (ุงูููุฌูุฏ ูู ESP-07) ุซู ุงููุตูู ุฅูููุง ูู ุงูุจุฑูุงูุฌ ููููุงุช ุนุงุฏูุฉ.  ููุงู ููุช ุจุชุญููู ููุชุจุงุช mqtt_as ู uasyncio ู ssd1306 ูุงููุฌููุนุงุช (ุงููุณุชุฎุฏูุฉ ุฏุงุฎู mqtt_as) ุงูุชู ุฃุณุชุฎุฏููุง. <br><br>  ูุจุฏุฃ ู ... ูุชููู MemoryError.  ุนูุงูุฉ ุนูู ุฐูู ุ ูููุง ุญุงููุช ุฃู ุฃููู ุจุงูุถุจุท ุฃูู ูุงูุช ุงูุฐุงูุฑุฉ ุชุชุณุฑุจ ุ ูููุง ููุช ุจุชุฑุชูุจ ุชุตุญูุญ ุงููุทุจูุนุงุช ุ ุญุฏุซ ูุฐุง ุงูุฎุทุฃ ูุจูุฑูุง.  ูุงุฏูู ุบูุบูููุฒ ูุตูุฑ ุฅูู ููู ุฃูู ุ ูู ุญูุซ ุงููุจุฏุฃ ุ ูุง ุชุญุชูู ูุญุฏุฉ ุงูุชุญูู ุงูุฏูููุฉ ุฅูุง ุนูู 30 ููููุจุงูุช ูู ุงูุฐุงูุฑุฉ ุงูุชู ูุง ูุชูุงุณุจ ูููุง 65 ููููุจุงูุช ูู ุงูููุฏ (ูุน ุงูููุชุจุงุช) ุจุฃู ุดูู ูู ุงูุฃุดูุงู. <br><br>  ููู ููุงู ุทุฑูู  ุงุชุถุญ ุฃู ูููุฑูุจูุซูู ูุง ูููู ุจุชูููุฐ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูุจุงุดุฑุฉ ูู ููู .py - ูุชู ุชุฌููุน ูุฐุง ุงูููู ุฃููุงู.  ููุชู ุชุฌููุนู ูุจุงุดุฑุฉ ุนูู ูุญุฏุฉ ุงูุชุญูู ุงูุฏูููุฉ ุ ููุชุญูู ุฅูู ุฑูุฒ ุซุงููู ุ ูุชู ุชุฎุฒููู ุจุนุฏ ุฐูู ูู ุงูุฐุงูุฑุฉ.  ุญุณููุง ุ ููู ูุนูู ุงููุชุฑุฌู ุ ุชุญุชุงุฌ ุฃูุถูุง ุฅูู ูุฏุฑ ูุนูู ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู. <br><br>  ุงูุญููุฉ ูู ุฅููุงุฐ ุงููููุฑููููุชุฑููุฑ ูู ุงูุชุฌููุน ุงูููุซู ููููุงุฑุฏ.  ููููู ุชุฌููุน ุงููููุงุช ุนูู ุฌูุงุฒ ููุจููุชุฑ ูุจูุฑ ุ ูุชุนุจุฆุฉ ุงูุฑูุฒ ุงูุจุงูุช ุงูููุงุฆู ูู ูุญุฏุฉ ุงูุชุญูู ุงูุฏูููุฉ.  ููููุงู ุจุฐูู ุ ูู ุจุชูุฒูู ุงูุจุฑูุงูุฌ ุงูุซุงุจุช micropython ููู ุจุฅูุดุงุก <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ mpy-cross</a> . <br><br>  ูู ุฃูุชุจ ููู Makefile ุ ููููู ูุฑุฑุช ูุฏูููุง ูุฌูุนุช ุฌููุน ุงููููุงุช ุงูุถุฑูุฑูุฉ (ุจูุง ูู ุฐูู ุงูููุชุจุงุช) ูุซู ูุฐุง <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">mpy-cross water_counter.py</code> </pre> <br>  ูุจูู ููุท ูุชุญููู ุงููููุงุช ุฐุงุช ุงูุงูุชุฏุงุฏ .mpy ุ ูุน ุนุฏู ูุณูุงู ุญุฐู .py ุงููุทุงุจู ุฃููุงู ูู ูุธุงู ุงููููุงุช ุงูุฎุงุต ุจุงูุฌูุงุฒ. <br><br>  ุฃุฌุฑูุช ูู ุงูุชุทููุฑ ูู ุงูุจุฑูุงูุฌ (IDEุ) ESPlorer.  ูุณูุญ ูู ุจุชุญููู ุงูุจุฑุงูุฌ ุงููุตูุฉ ุฅูู ูุญุฏุฉ ุงูุชุญูู ุงูุฏูููุฉ ูุชูููุฐูุง ุนูู ุงูููุฑ.  ูู ุญุงูุชู ุ ููุน ูู ููุทู ูุฅูุดุงุก ุฌููุน ุงููุงุฆูุงุช ูู ููู water_counter.py (.mpy).  ูููู ููู ูุจุฏุฃ ูู ูุฐุง ุชููุงุฆููุง ุ ูู ุงูุจุฏุงูุฉ ูุฌุจ ุฃู ูููู ููุงู ููู ุขุฎุฑ ูุณูู main.py.  ููุฌุจ ุฃู ูููู ุจุงูุถุจุท .py ุ ูููุณ pmp.  ููุง ูู ูุญุชูุงู ุงูุชุงูู <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> water_counter</code> </pre> <br>  ูุจุฏุฃ - ูู ุดูุก ูุนูู.  ูููู ููุงู ุงููููู ูู ุงูุฐุงูุฑุฉ ุงูุฎุงููุฉ ุจุดูู ุฎุทูุฑ - ุญูุงูู 1 ููููุจุงูุช.  ูุง ูุฒุงู ูุฏู ุฎุทุท ูุชูุณูุน ูุธุงุฆู ุงูุฌูุงุฒ ุ ููู ุงููุงุถุญ ุฃู ูุฐุง ุงูููููุจุงูุช ูู ูููู ูุงููุงู ุจุงููุณุจุฉ ูู.  ูููู ุงุชุถุญ ุฃู ููุงู ูุฎุฑุฌูุง ููุฐู ุงูุญุงูุฉ. <br><br>  ูุฐุง ูู ุงูุดูุก.  ุนูู ุงูุฑุบู ูู ุฃู ุงููููุงุช ูุชู ุชุฌููุนูุง ูู ููุฏ ุซุงููู ูุชูุน ุนูู ูุธุงู ุงููููุงุช ุงูุฏุงุฎูู ุ ุฅูุง ุฃููุง ูู ุงููุงูุน ูุง ุชุฒุงู ูุชู ุชุญููููุง ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ูุชูููุฐูุง ูู ููุงู.  ูููู ุงุชุถุญ ุฃู ูููุฑูุจูุซูู ูุงุฏุฑ ุนูู ุชูููุฐ ุงูุจุงูุช ููุฏ ูุจุงุดุฑุฉ ูู ุฐุงูุฑุฉ ููุงุด ุ ูููู ููุฐุง ุชุญุชุงุฌ ุฅูู ุชุถูููู ูุจุงุดุฑุฉ ูู ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ.  ูุฐุง ููุณ ุตุนุจูุง ุ ุนูู ุงูุฑุบู ูู ุฃูู ุงุณุชุบุฑู ูุฏุฑูุง ูุจูุฑูุง ูู ุงูููุช ุนูู ูุชุจููู (ููุงู ููุท ุญุตูุช ุนูู ููููุณ). <br><br>  ุงูุฎูุงุฑุฒููุฉ ูู ููุง ููู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู ุจุชูุฒูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ESP Open SDK</a> ูุชุซุจูุชู.  ูููู ูุฐุง ุงูุดูุก ุจุจูุงุก ูุชุฑุฌู ูููุชุจุงุช ููุจุฑุงูุฌ ุชุญุช ESP8266.  ูุชู ุชุฌููุนู ููููุง ููุชุนูููุงุช ุงููุงุฑุฏุฉ ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ูููุดุฑูุน (ุงุฎุชุฑุช ุงูุฅุนุฏุงุฏ STANDALONE = ูุนู) </li><li style=";text-align:right;direction:rtl">  ุชูุฒูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฃููุงุน Micropython</a> </li><li style=";text-align:right;direction:rtl">  ูู ุจุฅุณูุงุท ุงูููุชุจุงุช ุงูุถุฑูุฑูุฉ ูู ุงูููุงูุฐ / esp8266 / ุงููุญุฏุงุช ุฏุงุฎู ุดุฌุฑุฉ ุงููููุฑูุจูุซูู </li><li style=";text-align:right;direction:rtl">  ูููู ุจุชุฌููุน ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ ููููุง ููุชุนูููุงุช ุงููุงุฑุฏุฉ ูู ููู <a href="">ุงูููุงูุฐ / esp8266 / README.md</a> </li><li style=";text-align:right;direction:rtl">  ูู ุจุตุจ ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ ูู ูุญุฏุฉ ุงูุชุญูู ุงูุฏูููุฉ (ุฃููู ุจูุฐุง ุนูู Windows ุจุงุณุชุฎุฏุงู ุจุฑุงูุฌ ESP8266Flasher ุฃู Python esptool) </li></ul><br>  ูุฐุง ูู ุดูุก ุ ุงูุขู ุณุชููู ุนูููุฉ ุงูุงุณุชูุฑุงุฏ ssd1306 ุจุฑูุน ุงูุดูุฑุฉ ูุจุงุดุฑุฉ ูู ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ ููู ูุชู ุฅููุงู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ููุฐุง ุงูุบุฑุถ.  ุจูุฐู ุงูุฎุฏุนุฉ ุ ููุช ุจุชูุฒูู ุฑูุฒ ุงูููุชุจุฉ ููุท ูู ุงูุจุฑูุงูุฌ ุงูุซุงุจุช ุ ุจูููุง ูุชู ุชูููุฐ ุฑูุฒ ุงูุจุฑูุงูุฌ ุงูุฑุฆูุณู ูู ูุธุงู ุงููููุงุช.  ูุฐุง ูุณูุญ ูู ุจุชุนุฏูู ุงูุจุฑูุงูุฌ ุจุณูููุฉ ุฏูู ุฅุนุงุฏุฉ ุชุฌููุน ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ.  ูู ุงูููุช ุงูุญุงูู ูุฏู ุญูุงูู 8.5 ูููู ุจุงูุช ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู.  ุณูุณูุญ ูุฐุง ุจุชูููุฐ ุงููุซูุฑ ูู ุงููุธุงุฆู ุงููููุฏุฉ ุงููุฎุชููุฉ ูู ุงููุณุชูุจู.  ุญุณููุง ุ ุฅุฐุง ูู ุชูู ููุงู ุฐุงูุฑุฉ ูุงููุฉ ุนูู ุงูุฅุทูุงู ุ ูููููู ุฃูุถูุง ุฏูุน ุงูุจุฑูุงูุฌ ุงูุฑุฆูุณู ุฅูู ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  ููุงุฐุง ุชูุนู ุจู ุงูุขูุ </h3><br>  ุญุณููุง ุ ุงูุฌูุงุฒ ููุญูู ุ ุงูุจุฑูุงูุฌ ุงูุซุงุจุช ููุชูุจ ุ ุงูุตูุฏูู ูุทุจูุน ุ ุงูุฌูุงุฒ ุนุงูู ูู ุงูุญุงุฆุท ููููุถ ุจุณุนุงุฏุฉ ุจูุตุจุงุญ ููุฑุจุงุฆู.  ูููู ูู ุญูู ุฃู ูุฐุง ููู ุนุจุงุฑุฉ ุนู ุตูุฏูู ุฃุณูุฏ (ุจุงููุนูู ุงูุญุฑูู ูุงููุฌุงุฒู) ููุง ุฒุงู ูุนูุงู ุบูุฑ ูุงูู.  ุญุงู ุงูููุช ููููุงู ุจุดูุก ูุน ุฑุณุงุฆู MQTT ุงูุชู ูุชู ุฅุฑุณุงููุง ุฅูู ุงูุฎุงุฏู. <br><br>  ุจูุชู ุงูุฐูู ูุฏูุฑ ุญูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุธุงู ูุงุฌูุฑุฏููู</a> .  ูุญุฏุฉ MQTT ุฅูุง ุฎุงุฑุฌ ุงูุตูุฏูู ุ ุฃู ูููู ุชุซุจูุชูุง ุจุณูููุฉ ูู ุณูู ุงูุฅุถุงูุงุช - ูู ุฃุนุฏ ุฃุชุฐูุฑ ูุตุฏุฑูุง.  ุงูุดูุก MQTT ููุณ ุงูุงูุชูุงุก ุงูุฐุงุชู - ูุง ูุณูู ุจ  ูุณูุท - ุฎุงุฏู ูููู ุจุงุณุชูุงู ููุฑุฒ ูุฅุนุงุฏุฉ ุชูุฌูู ุฑุณุงุฆู MQTT ุฅูู ุงูุนููุงุก.  ุฃุณุชุฎุฏู ุงูุจุนูุถ ุ ุงูุฐู (ูุซู ูุงุฌูุฑุฏููู) ูุนูู ุนูู ููุณ ุงููุช ุจูู. <br><br>  ุจุนุฏ ุฃู ูุฑุณู ุงูุฌูุงุฒ ุฑุณุงูุฉ ูุฑุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู ุ ุณุชุธูุฑ ุงููููุฉ ุนูู ุงูููุฑ ูู ุงููุงุฆูุฉ. <br><br><img src="https://habrastorage.org/webt/hf/ip/db/hfipdb1coxh_lsaaz600mi-39y0.png"><br><br>  ูููู ุงูุขู ุฑุจุท ูุฐู ุงูููู ุจูุงุฆูุงุช ุงููุธุงู ุ ููููู ุงุณุชุฎุฏุงููุง ูู ุงูุจุฑุงูุฌ ุงููุตูุฉ ููุฃุชูุชุฉ ูุฅุฎุถุงุนูุง ูุชุญููู ูุฎุชูู - ูู ูุฐุง ุฎุงุฑุฌ ูุทุงู ูุฐู ุงูููุงูุฉ.  ูู ููุชู ุจูุธุงู ูุงุฌูุฑุฏููู ุ ูููููู ุฃู ุฃูุตู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุจููุงุฉ Electronics In Lens</a> - ูููู ุตุฏูู ุฃูุถูุง ุจุจูุงุก ููุฒู ุฐูู ููุชุญุฏุซ ุจุดูู ุฐูู ุนู ุฅุนุฏุงุฏ ุงููุธุงู. <br><br>  ุณูู ุฃุนุฑุถ ููุท ุจุนุถ ุงูุฑุณูู ุงูุจูุงููุฉ.  ูุฐุง ุฑุณู ุจูุงูู ุจุณูุท ููููู ุงูููููุฉ. <br><br><img src="https://habrastorage.org/webt/km/hw/xr/kmhwxruql1fk0kmykb1gpcpci_0.png"><br>  ูููู ููุงุญุธุฉ ุฃูู ูู ูุณุชุฎุฏู ุฃุญุฏ ุงููุงุก ุชูุฑูุจูุง ูู ุงูููู.  ุจุถุน ูุฑุงุช ุฐูุจ ุดุฎุต ูุง ุฅูู ุงููุฑุญุงุถ ุ ููุจุฏู ุฃู ูุฑุดุญ ุงูุชูุงุถุญ ุงูุนูุณู ููุชุต ุจุถุน ูุชุฑุงุช ูู ุงููููุฉ.  ูู ุงูุตุจุงุญ ุ ูุฒูุฏ ุงูุงุณุชููุงู ุจุดูู ููุญูุธ.  ุนุงุฏุฉู ูุง ุฃุณุชุฎุฏู ุงููุงุก ูู ุบูุงูุฉ ุ ูููู ุจุนุฏ ุฐูู ุฃุฑุฏุช ุฃู ุฃุณุชุญู ูุงูุชูู ูุคูุชูุง ุฅูู ุงููุงุก ุงูุณุงุฎู ูู ุงููุฏููุฉ - ููุฐุง ุฃูุถูุง ูุฑุฆู ุจูุถูุญ ุนูู ุงูุฑุณู ุงูุจูุงูู ุงูุณููู. <br><br>  ูู ูุฐุง ุงูุฌุฏูู ุ ุนููุช ุฃู ุงูุฐูุงุจ ุฅูู ุงููุฑุญุงุถ ูู 6-7 ูุชุฑุงุช ูู ุงููุงุก ุ ูุงูุงุณุชุญูุงู - 20-30 ูุชุฑูุง ุ ูุบุณู ุงูุฃุทุจุงู ุญูุงูู 20 ูุชุฑูุง ุ ูููุญูุงู ุ ุชุญุชุงุฌ ุฅูู 160 ูุชุฑูุง.  ูููู ูุงุญุฏ ุ ุชุณุชููู ุนุงุฆูุชู ุญูุงูู 500-600 ูุชุฑ. <br><br>  ุจุงููุณุจุฉ ุฅูู ุงูุฃูุซุฑ ูุถูููุง ุ ููููู ุฅููุงุก ูุธุฑุฉ ุนูู ุงูุฅุฏุฎุงูุงุช ููู ูููุฉ ูุฑุฏูุฉ <br><br><img src="https://habrastorage.org/webt/8l/8i/su/8l8isu_aiaswajdeeuexytpwffi.png"><br><br>  ูู ููุง ุนููุช ุฃูู ูุน ูุชุญ ุงูุตูุจูุฑ ุ ูุชุฏูู ุงููุงุก ุจุณุฑุนุฉ ุญูุงูู 1 ูุชุฑ ูู 5 ุซูุงูู. <br><br>  ูููู ูู ูุฐุง ุงูุดูู ุ ุฑุจูุง ูุง ุชููู ุงูุฅุญุตุงุฆูุงุช ููุงุฆูุฉ ูููุดุงูุฏุฉ.  ูู majordomo ูุง ุชุฒุงู ููุงู ูุฑุตุฉ ูุฑุคูุฉ ูุฎุทุทุงุช ุงูุงุณุชููุงู ุญุณุจ ุงูููู ูุงูุฃุณุจูุน ูุงูุดูุฑ.  ุนูู ุณุจูู ุงููุซุงู ุ ุฑุณู ุจูุงูู ููุงุณุชููุงู ูู ุงูุฃุนูุฏุฉ <br><br><img src="https://habrastorage.org/webt/m3/wa/sf/m3wasfzbvxb2tz1yhemod2ewwdy.png"><br><br>  ุญุชู ุงูุขู ูุฏู ุจูุงูุงุช ููุฏุฉ ุฃุณุจูุน ููุท.  ูู ุบุถูู ุดูุฑ ุ ุณูููู ูุฐุง ุงูุฑุณู ุงูุจูุงูู ุฃูุซุฑ ุฏูุงูุฉ - ุณูุชูุงูู ุนููุฏ ูููุตู ูุน ูู ููู.  ุงูุชุนุฏููุงุช ุงูุชู ุฃุฏุฎูุชูุง ุนูู ุงูููู ุงูุชู ุชูุณุฏูุง ูุฏููุงู ุชูุณุฏ ุงูุตูุฑุฉ ููููุงู (ุงูุนููุฏ ุงูุฃูุจุฑ).  ูููุณ ูู ุงููุงุถุญ ุญุชู ุงูุขู ูุง ุฅุฐุง ููุช ูุฏ ุญุฏุฏุช ุงูููู ุงูุฃููู ุจุดูู ุบูุฑ ุตุญูุญ ุชูุฑูุจูุง ููุนุจูุง ุฃูู ุชูุฑูุจูุง ุ ุฃู ูุง ุฅุฐุง ูุงู ูุฐุง ุฎุทุฃ ูู ุงูุจุฑูุงูุฌ ุงูุซุงุจุช ููู ุชุฐูุจ ุฌููุน ุงููุชุฑุงุช ุฅูู ุงูููุงุตุฉ.  ูุณุชุบุฑู ุงููุฒูุฏ ูู ุงูููุช. <br><br>  ูุง ูุฒุงู ูู ุงูุถุฑูุฑู ุงุณุชุญุถุงุฑ ุงูุฑุณูู ุงูุจูุงููุฉ ููุณูุง ุ ุชุจููุถ ุงูููู.  ุฑุจูุง ุณุฃุจูู ุฃูุถูุง ุฑุณููุง ุจูุงูููุง ูุงุณุชููุงู ุงูุฐุงูุฑุฉ ูุฃุบุฑุงุถ ุงูุชุตุญูุญ - ูุฌุฃุฉ ุญุฏุซ ุชุณุฑุจ ูุดูุก ูุง.  ุฑุจูุง ุณุฃุนุฑุถ ูุชุฑุงุช ุจุทุฑููุฉ ูุง ุนูุฏูุง ูู ููู ุงูุฅูุชุฑูุช ูุชุงุญูุง.  ูู ุญูู ุฃู ูู ูุฐุง ูุฏูุฑ ุนูู ูุณุชูู ุงูุฃููุงุฑ. <br><br><h3 style=";text-align:right;direction:rtl">  ุงูุฎูุงุตุฉ </h3><br>  ุงูููู ุ ุฃุตุจุญุช ุดูุชู ุฃูุซุฑ ุฐูุงุกู ููููุงู.  ูุน ูุฐุง ุงูุฌูุงุฒ ุงูุตุบูุฑ ุ ุณูููู ูู ุงูุฃูุณุจ ุจุงููุณุจุฉ ูู ูุฑุงูุจุฉ ุงุณุชููุงู ุงูููุงู ูู ุงูููุฒู.  ุฅุฐุง ููุช ูู ููุช ุณุงุจู ุณุงุฎุทูุง "ูุฑุฉ ุฃุฎุฑู ุงุณุชููููุง ุงููุซูุฑ ูู ุงููุงุก ูู ุดูุฑ ูุงุญุฏ" ุ ูููููู ุงูุขู ุงูุนุซูุฑ ุนูู ูุตุฏุฑ ูุฐุง ุงูุงุณุชููุงู. <br><br>  ูุฏ ูุจุฏู ุบุฑูุจุงู ุฃู ูุดุงูุฏ ุฃุญุฏ ุงููุฑุงุกุงุช ุนูู ุงูุดุงุดุฉ ุฅุฐุง ูุงู ุนูู ุจุนุฏ ูุชุฑ ูู ุฌูุงุฒ ุงูููุงุณ ููุณู.  ูููู ูู ุงููุณุชูุจู ุบูุฑ ุงูุจุนูุฏ ุ ุฃุฎุทุท ููุงูุชูุงู ุฅูู ุดูุฉ ุฃุฎุฑู ุ ุญูุซ ุณูููู ููุงู ุงูุนุฏูุฏ ูู ุงููุตุงุนุฏ ุ ููู ุงููุฑุฌุญ ุฃู ุชููู ุงูุนุฏุงุฏุงุช ููุณูุง ุนูุฏ ุงููุจูุท.  ูุฐุง ุณูููู ุฌูุงุฒ ุงููุฑุงุกุฉ ุนู ุจุนุฏ ูููุฏูุง ุฌุฏูุง. <br><br>  ุฃุฎุทุท ุฃูุถูุง ูุชูุณูุน ูุธุงุฆู ุงูุฌูุงุฒ.  ุฃูุง ุจุงููุนู ุฃูุธุฑ ุฅูู ุงูุตูุงูุงุช ุงูุขููุฉ.  ุงูุขู ูุชุญููู ููุงู ูุฏููุฉ ุงูุบูุงูุฉ ุ ุฃุญุชุงุฌ ุฅูู ุชุญููู 3 ุตูุงุจูุฑ ูู ููุงู ูุง ูููู ุงููุตูู ุฅููู.  ุณูููู ุฃูุซุฑ ููุงุกูุฉ ููููุงู ุจุฐูู ูุน ุฒุฑ ูุงุญุฏ ูุน ุงูุฅุดุงุฑุฉ ุงูููุงุณุจุฉ.  ุญุณููุง ุ ุจุงูุทุจุน ุ ูู ุงููููุฏ ุชูููุฐ ุงูุญูุงูุฉ ุถุฏ ุงูุชุณุฑูุจุงุช. <br><br>  ูู ุงูููุงูุฉ ุฃุฎุจุฑุช ุฅุตุฏุงุฑู ูู ุงูุฌูุงุฒ ุจูุงุกู ุนูู ESP8266.  ูู ุฑุฃูู ุ ุญุตูุช ุนูู ูุณุฎุฉ ูุซูุฑุฉ ููุงูุชูุงู ููุบุงูุฉ ูู ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ micropython ุจุงุณุชุฎุฏุงู coroutine - ุจุณูุทุฉ ูุฌูููุฉ.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุงููุช ุฃู ุฃุตู ุงูุนุฏูุฏ ูู ุงููุฑูู ุงูุฏูููุฉ ูุงููุฏุงุฑุณ ุงูุชู ูุงุฌูุชูุง ูุน ุงูุญููุฉ. </font><font style="vertical-align: inherit;">ุฑุจูุง ูุตูุช ูู ุดูุก ุจุชูุงุตูู ุฃูุซุฑ ูู ุงููุงุฒู ุ ุจุงููุณุจุฉ ูู ุดุฎุตููุง ุ ููุงุฑุฆ ุ ูู ุงูุณูู ุชุจุฏูุฏ ุงููุซูุฑ ูู ุงูููุช ููุชูููุฑ ูู ูุง ูู ูููุงู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงูุนุงุฏุฉ ุ ุฃูุง ูููุชุญ ุนูู ุงูููุฏ ุงูุจูุงุก. </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">ุฏุงุฆุฑุฉ </font></a></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑูุฒ ุงููุตุฏุฑ </font></font></a> <font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">ููููุฐุฌ ุญุงูุฉ ุงูููุญุฉ</font></a></font><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"></font></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar411259/">https://habr.com/ru/post/ar411259/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar411249/index.html">ููู ุตูุนุช Yandex.Transport ูุน ุฌุฏุงูู ุฒูููุฉ ูุญุงููุงุช</a></li>
<li><a href="../ar411251/index.html">ูุณุชุงุก ุงููุณุชุฎุฏููู ูู ูุณุญ ูููุงุช Chrome ุนูู ูุญุฑู ุงูุฃูุฑุงุต ุงููุญูู</a></li>
<li><a href="../ar411253/index.html">ุฃุฏู ุงูุฏูุงุฌ ุงููุฌูู ุงููููุชุฑูููุฉ ุฅูู ุฅููุงุก ุจุฏุงุฆู ุงููุงุฏุฉ ุงููุธููุฉ ูุงูุทุงูุฉ ุงููุธููุฉ</a></li>
<li><a href="../ar411255/index.html">ุชุทุจููุงุช ูุงูุฑูุฒูุฉ ูููุงููู ุงููุณุชุฎุฏููู ุนูู Ethereum</a></li>
<li><a href="../ar411257/index.html">ูู ุงูููุงูุงุช ุงููุชุญุฏุฉ ุ ูููููู ุจุฅูุดุงุก ูุธุงู ููุฒุฑ ูุฎูู ุงูุนุฏู ุจุงูุตูุช</a></li>
<li><a href="../ar411261/index.html">ุงุณุชุฌุงุจุฉ ุงูุงูุชุฒุงุฒ ูู ุงูุฃุทุฑุงู ุงูุงุตุทูุงุนูุฉ: ุทุฑููุฉ ุฌุฏูุฏุฉ ูุชุญุณูู ุงูุชุญูู ูู ุงูุฃุทุฑุงู ุงูุฅููุชุฑูููุฉ</a></li>
<li><a href="../ar411263/index.html">ุฒุฑ ุณุญุฑู ู LED ุนูู ATtiny4</a></li>
<li><a href="../ar411265/index.html">ุญุงูุงุช ุงูุชุฌุณุณ (ุงูุฌุฒุก 3)</a></li>
<li><a href="../ar411267/index.html">ูู ููู ูุฑุงุก ุงูููุงุชู ุงูุฐููุฉ ุงูุฌุฏูุฏุฉ ุงูุชู ุชุญูู ุนูุงูุฉ ููููุง ุงูุชุฌุงุฑูุฉุ</a></li>
<li><a href="../ar411269/index.html">ููููุงุช "LOAD" ุงูุซูุงุซุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>