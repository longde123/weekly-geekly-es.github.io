<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>#⃣ ☀️ 🤳🏼 无服务器方法，用于快速开发有效的视频服务 🎽 🥜 🔎</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="我从事外包工作，主要原则可以用短语“卖很多，快点做”来描述。 我们做得越快，我们就越赚钱。 并且，希望一切都不会在拐杖和鼻涕上起作用，而是具有可接受的质量水平。 我将在短时间内需要开发促销服务时讲述我的经验。 

 假定： AWS上的root帐户，对技术堆栈的选择，一个后端和一个月的开发没有任何限制...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>无服务器方法，用于快速开发有效的视频服务</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448974/"><img src="https://habrastorage.org/webt/pj/so/-j/pjso-jhdtkpxng25sduokkoohfw.png" alt="AWS Elemental"><br><br> 我从事外包工作，主要原则可以用短语“卖很多，快点做”来描述。 我们做得越快，我们就越赚钱。 并且，希望一切都不会在拐杖和鼻涕上起作用，而是具有可接受的质量水平。 我将在短时间内需要开发促销服务时讲述我的经验。 <br><br>  <b>假定：</b> AWS上的root帐户，对技术堆栈的选择，一个后端和一个月的开发没有任何限制。 <br><br>  <b>目标：</b>实施促销服务，用户上传一到四个持续一到四秒钟的视频，然后将其嵌入到原始视频序列中。 也就是说，我们用自定义视频替换了原始视频的片段（系列屏幕保护程序）。 杀手级功能-能够发送您的姓名，该姓名以精美文字的形式覆盖相应的视频片段。 此外，用户可以上传4到30秒长的视频，而在服务端，视频会被裁剪为4秒。 <br><a name="habracut"></a><br><br><h2> 解决方案 </h2><br> 在如此紧迫的时间内编写自行车服务是一个主意。 此外，为了使服务能够应付负载以及每个想要接收令人垂涎的视频的人，都将需要基础结构。 而且最好不要带飞机上的价格标签。 因此，我们立即将重点放在最小化定制的现成解决方案上。 <br><br> 用于处理视频的标准解决方案是FFmpeg，这是一种跨平台的控制台实用程序，可通过自变量来分割和叠加声音。 小事情是写一个包装并将其付诸实践。 我们正在编写一个将两个视频粘贴在一起的原型，然后……乐趣开始了。  .NET Core 2上的库应在任何虚拟机上旋转，因此我们采用了AWS EC2实例，一切正常 <br><br><div class="spoiler">  <b class="spoiler_title">隐藏文字</b> <div class="spoiler_text"> 不，这行不通 <br></div></div><br>  FFmpeg虽然简化了任务，但是对于真正可行的解决方案，您需要创建EC2实例，为此为其设计网络基础结构，包括负载均衡器。 从头开始部署的简单任务“有点”复杂，基础架构立即开始要求资金-运行时间的金额每小时从客户帐户中提取。 <br><br> 我们的服务不涉及长期运行的流程，不需要庞大而大胆的关系数据库，并且通过一系列微服务调用而完全适合事件架构。 该解决方案表明了自己-我们可以放弃EC2并实现真正的无服务器应用程序，例如基于AWS Lambda的标准Image Resizer。 <br><br> 顺便说一下，尽管明显不喜欢AWS开发人员使用.NET，但他们支持.NET Core 2.1作为运行时，这提供了广泛的开发机会。 <br><br> 锦上添花-AWS提供了单独的服务来处理视频文件-AWS Elemental MediaConvert。 <br><br> 工作的本质非常简单：我们通过AWS控制台，.NET SDK或仅通过JSON，将S3链接链接到传出视频，然后编写我们想对视频进行的处理并调用该服务。 他本人实现了用于处理传入请求的队列，他在S3中卸载了结果，最重要的是，为每个状态更改生成了CloudWatch Event。 这使我们可以实现lambda触发器来完成视频处理。 <br><br><img src="https://habrastorage.org/webt/er/4k/48/er4k48mrtrw_tjxtytp8aoitpp8.png" alt="图片"><br>  <i>最终版本的架构看起来像这样</i> <br><br> 整个后端放置在两个lambda中。 另一个是旋转垂直视频，因为这样的工作不能一次性完成。 <br><br> 文本叠加是通过根据视频分辨率动态渲染透明图像来完成的。  SixLabors.ImageSharp库非常适合此目的，并且内存泄漏问题很好地绕过了lambda生命周期。 <br><br> 以JS编写并通过pug编译的SPA应用程序形式的前端将放置在公共S3篮子中。 要自己下载视频，我们不需要任何服务器代码-只需打开S3为我们提供的REST端点即可。 唯一的事情-不要忘记配置策略和CORS。 <br><br><h2> 陷阱 </h2><br><ul><li> 由于某些未知原因，AWS MediaConvert仅将声音单独施加在每个视频片段上，因此我们需要整个屏幕保护程序中的狂热歌曲。 </li><li> 垂直视频需要单独处理。  AWS不喜欢黑色条纹，而是将滚筒置于90°。 </li></ul><br><br><h2> 简易溜冰场 </h2><br> 尽管Stateless有很多优点，但您仍需要跟踪视频的处理方式：在已完成的视频序列上粘贴或叠加声音。 幸运的是，MediaConvert支持通过其Job进行元数据的传输，我们始终可以应用一个简单的标志，例如“ isMasterSoundJob”，在任何阶段都可以解析该元数据。 <br><br>  Serverless使NoOps正常工作-这种方法假定需要一个单独的团队来负责项目基础结构。 因此，这是一个小问题-我们在没有任何系统管理员参与的情况下在AWS上部署解决方案。 <br> 为了加快速度，我们尽可能将部署脚本自动化到AWS CloudFormation，允许您直接从VS部署一个按钮。 结果，具有200行代码的文件使您可以推出现成的解决方案，尽管CloudFormation语法可能会令人讨厌。 <br><br><h2> 合计 </h2><br> 无服务器不是万灵药。 但这将极大地便利以下三个方面的生活：“有限的资源-时间短-钱少”。 <br><br>  <b>适用于无服务器的应用程序的特征</b> <br><br><ul><li> 没有长时间运行的流程。 硬限制API网关-29秒，硬限制lambda-15分钟； </li><li> 由事件驱动架构描述； </li><li> 按SOA类型分解为松散耦合的组件； </li><li> 在他的情况下不需要很多工作； </li><li> 用.NET Core编写。 要使用.NET Framework，您仍然至少需要具有适当运行时的Docker。 </li></ul><br>  <b>无服务器方法的好处</b> <br><br><ul><li> 降低基础设施成本； </li><li> 降低交付解决方案的成本； </li><li> 自动扩展 </li><li> 发展处于技术进步的最前沿。 </li></ul><br>  <b>缺点，举一个具体的例子</b> <br><br><ul><li> 分布式跟踪和日志记录-通过AWS X-Ray和AWS CloudWatch部分解决; </li><li> 调试不便； </li><li> 空载冷启动； </li><li>  AWS用户敌对接口是一个普遍问题：) </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN448974/">https://habr.com/ru/post/zh-CN448974/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN448962/index.html">营销渠道AARRR的有效性</a></li>
<li><a href="../zh-CN448964/index.html">烤面包机赋予用户更多权利</a></li>
<li><a href="../zh-CN448966/index.html">内存中的Android应用。 Yandex.Luncher的优化报告</a></li>
<li><a href="../zh-CN448968/index.html">异步PHP。 怎么了</a></li>
<li><a href="../zh-CN448970/index.html">SSH的两因素身份验证</a></li>
<li><a href="../zh-CN448976/index.html">HSE的Gamedev春季活动</a></li>
<li><a href="../zh-CN448980/index.html">我们在一起的第一顿午餐：为什么以及如何度过考试日</a></li>
<li><a href="../zh-CN448982/index.html">无头CMS。 我为什么写我的</a></li>
<li><a href="../zh-CN448986/index.html">具有3D扫描的3D逆向工程</a></li>
<li><a href="../zh-CN448988/index.html">金士顿固态硬盘变得更加强大，保持几乎相同的成本-我们满足A400-R系列</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>