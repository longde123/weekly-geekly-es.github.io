<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äçüé® üë©üèø‚Äçüé§ üìâ Resolver crucigramas japoneses con PÃ∂yÃ∂tÃ∂hÃ∂oÃ∂Ã∂nÃ∂ Rust y WebAssembly üìº üç´ ‚û°Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="C√≥mo hacer un solucionador de nonogramas para Python, vuelva a escribirlo en Rust para ejecutarlo directamente en el navegador a trav√©s de WebAssembly...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Resolver crucigramas japoneses con PÃ∂yÃ∂tÃ∂hÃ∂oÃ∂Ã∂nÃ∂ Rust y WebAssembly</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454586/"><p><img src="https://habrastorage.org/webt/sy/k0/va/syk0va4uczwmji3lwzhq2nqq2hy.png" alt="Logotipo de √≥xido como nonograma"></p><br><p>  C√≥mo hacer un solucionador de nonogramas para Python, vuelva a escribirlo en Rust para ejecutarlo directamente en el navegador a trav√©s de WebAssembly. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">TL; DR</a> </p><a name="habracut"></a><br><h2 id="nachalo">  Inicio </h2><br><p>  Sobre los crucigramas japoneses (nonogramas) en el Habr√© ya hab√≠a varias publicaciones.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ejemplo</a> <br>  y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">uno mas</a> </p><br><blockquote>  Las im√°genes se cifran con n√∫meros ubicados a la izquierda de las filas, as√≠ como arriba de las columnas.  El n√∫mero de n√∫meros muestra cu√°ntos grupos de celdas negras (o su color, para crucigramas de color) hay en la fila o columna correspondiente, y los n√∫meros mismos: cu√°ntas celdas combinadas contiene cada uno de estos grupos (por ejemplo, un conjunto de tres n√∫meros: 4, 1 y 3 significa que en esta fila hay tres grupos: el primero, de cuatro, el segundo, de uno, el tercero, de tres celdas negras).  En un crucigrama en blanco y negro, los grupos deben estar separados por al menos una celda vac√≠a; en el crucigrama de color, esta regla se aplica solo a grupos de un color, y los grupos de varios colores pueden estar muy separados (las celdas vac√≠as tambi√©n pueden estar a lo largo de los bordes de las filas).  Es necesario determinar la ubicaci√≥n de los grupos celulares. </blockquote><p>  Uno de los puntos de vista m√°s generalmente aceptados es que los crucigramas "correctos" solo pueden llamarse aquellos que se resuelven de manera "l√≥gica".  Esto generalmente se llama el m√©todo de soluci√≥n, en el que las dependencias entre diferentes filas y / o columnas no se tienen en cuenta.  En otras palabras, una soluci√≥n es una secuencia de decisiones <strong>independientes</strong> de filas o columnas individuales hasta que se llenen todas las celdas (m√°s sobre el algoritmo a continuaci√≥n).  Por ejemplo, solo dichos nonogramas se pueden encontrar en el sitio web <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://nonograms.org/</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://nonograms.ru/</a> ).  Los nonogramas de este sitio ya se han citado como ejemplo en el art√≠culo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Resolver crucigramas japoneses a la velocidad de la luz</a> .  Para fines de comparaci√≥n y verificaci√≥n, mi solucionador tambi√©n agreg√≥ soporte para descargar y analizar crucigramas de este sitio (gracias a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">KyberPrizrak</a> por el permiso para usar materiales de su sitio). </p><br><p>  Sin embargo, el concepto de nonogramas puede extenderse a un problema m√°s general, cuando el m√©todo "l√≥gico" habitual conduce a un callej√≥n sin salida.  En tales casos, uno debe hacer una suposici√≥n sobre el color de una celda y, despu√©s de probar que este color conduce a una contradicci√≥n, marcar el color opuesto para esta celda.  La secuencia de tales pasos puede (si tiene paciencia) darnos todas las soluciones.  Este art√≠culo tratar√° principalmente de resolver un caso tan general de crucigramas. </p><br><h2 id="python">  Pit√≥n </h2><br><p>  Hace aproximadamente un a√±o y medio, accidentalmente me top√© con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un art√≠culo</a> que describ√≠a un m√©todo para resolver una sola l√≠nea (como result√≥ m√°s tarde, el m√©todo fue bastante lento). </p><br><p>  Cuando implement√© este m√©todo en Python (mi lenguaje de trabajo principal) y agregu√© una actualizaci√≥n secuencial de todas las l√≠neas, vi que todo esto no se estaba resolviendo muy r√°pidamente.  Despu√©s de estudiar el material, result√≥ que en este tema hay muchos trabajos e implementaciones que ofrecen diferentes enfoques para esta tarea. </p><br><p>  Me pareci√≥ que el trabajo m√°s ambicioso sobre el an√°lisis de varias implementaciones de solucionador fue realizado por Jan Wolter, que public√≥ en su sitio (que, hasta donde yo s√©, sigue siendo el mayor repositorio p√∫blico de nonogramas en Internet), un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">estudio detallado que</a> contiene una gran cantidad de informaci√≥n y enlaces que pueden ayudar en creando tu propio solucionador. </p><br><p>  Al estudiar numerosas fuentes (estar√°n al final del art√≠culo), gradualmente mejor√© la velocidad y la funcionalidad de mi solucionador.  Como resultado, era adicto y estaba involucrado en la implementaci√≥n, refactorizaci√≥n y depuraci√≥n de algoritmos durante aproximadamente 10 meses en un tiempo libre del trabajo. </p><br><h3 id="osnovnye-algoritmy">  Algoritmos centrales </h3><br><p>  El solucionador resultante se puede representar en forma de cuatro niveles de decisi√≥n: </p><br><ul><li><p>  ( <strong>l√≠nea</strong> ) solucionador lineal: en la entrada, una l√≠nea de celdas y una l√≠nea descriptiva (pistas), en la salida, una l√≠nea parcialmente resuelta.  En la soluci√≥n de Python, implement√© 4 algoritmos diferentes (3 de ellos est√°n adaptados para crucigramas en color).  El m√°s r√°pido result√≥ ser el algoritmo BguSolver, llamado as√≠ por la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">fuente original</a> .  Este es un m√©todo muy efectivo y pr√°cticamente est√°ndar para resolver cadenas de nonogramas utilizando programaci√≥n din√°mica.  El pseudoc√≥digo de este m√©todo se puede encontrar, por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en este art√≠culo</a> . </p><br></li><li><p>  ( <strong>propagaci√≥n</strong> ) colocamos todas las filas y columnas en una cola, la revisamos con un solucionador lineal, cuando recibimos nueva informaci√≥n al resolver una fila (columna), actualizamos la cola, respectivamente, con nuevas columnas (filas).  Contin√∫e hasta que la l√≠nea est√© vac√≠a. </p><br><div class="spoiler">  <b class="spoiler_title">Ejemplo y c√≥digo</b> <div class="spoiler_text"><p> Tomamos la siguiente tarea para resolver desde la cola.  Sea una cadena vac√≠a (no resuelta) de longitud 7 (la denotamos como <code>???????</code> ) con una descripci√≥n de los bloques <code>[2, 3]</code> .  El solucionador lineal producir√° una cadena parcialmente resuelta <code>?X??XX?</code>  donde <code>X</code> es la celda llena.  Al actualizar la fila, vemos que las columnas con los n√∫meros 1, 4, 5 han cambiado (la indexaci√≥n comienza en 0).  Esto significa que ha aparecido nueva informaci√≥n en las columnas indicadas y que pueden devolverse al solucionador "lineal".  Ponemos estas columnas en la cola de tareas con mayor prioridad (para luego darlas al solucionador lineal). </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">propagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(board)</span></span></span><span class="hljs-function">:</span></span> line_jobs = PriorityDict() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> row_index <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(board.height): new_job = (<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, row_index) line_jobs[new_job] = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> column_index <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(board.width): new_job = (<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, column_index) line_jobs[new_job] = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (is_column, index), priority <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> line_jobs.sorted_iter(): new_jobs = solve_and_update(board, index, is_column) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> new_job <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> new_jobs: <span class="hljs-comment"><span class="hljs-comment"># upgrade priority new_priority = priority - 1 line_jobs[new_job] = new_priority def solve_and_update(board, index, is_column): if is_column: row_desc = board.columns_descriptions[index] row = tuple(board.get_column(index)) else: row_desc = board.rows_descriptions[index] row = tuple(board.get_row(index)) updated = line_solver(row_desc, row) if row != updated: for i, (pre, post) in enumerate(zip(row, updated)): if _is_pixel_updated(pre, post): yield (not is_column, i) if is_column: board.set_column(index, updated) else: board.set_row(index, updated)</span></span></code> </pre> <br></div></div><br></li></ul><br><ul><li><p>  ( <strong>sondeo</strong> ) para cada celda no resuelta, clasificamos todas las opciones de color e intentamos la propagaci√≥n con esta nueva informaci√≥n.  Si obtenemos una contradicci√≥n, descartamos este color de las opciones de color para la celda e intentamos beneficiarnos nuevamente utilizando la propagaci√≥n.  Si se resuelve hasta el final, agregamos la soluci√≥n a la lista de soluciones, pero continuamos experimentando con otros colores (puede haber varias soluciones).  Si llegamos a una situaci√≥n en la que es imposible resolverlo m√°s, simplemente ignoramos y repetimos el procedimiento con un color / celda diferente. </p><br><div class="spoiler">  <b class="spoiler_title">C√≥digo</b> <div class="spoiler_text"><p>  Devuelve True si se recibe una contradicci√≥n como resultado de la muestra. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">probe</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, cell_state)</span></span></span><span class="hljs-function">:</span></span> board = self.board pos, assumption = cell_state.position, cell_state.color <span class="hljs-comment"><span class="hljs-comment"># already solved if board.is_cell_solved(pos): return False if assumption not in board.cell_colors(pos): LOG.warning("The probe is useless: color '%s' already unset", assumption) return False save = board.make_snapshot() try: board.set_color(cell_state) propagation( board, row_indexes=(cell_state.row_index,), column_indexes=(cell_state.column_index,)) except NonogramError: LOG.debug('Contradiction', exc_info=True) # rollback solved cells board.restore(save) else: if board.is_solved_full: self._add_solution() board.restore(save) return False LOG.info('Found contradiction at (%i, %i)', *pos) try: board.unset_color(cell_state) except ValueError as ex: raise NonogramError(str(ex)) propagation( board, row_indexes=(pos.row_index,), column_indexes=(pos.column_index,)) return True</span></span></code> </pre> <br></div></div><br></li></ul><br><ul><li><p>  ( <strong>retroceso</strong> ) si durante el sondeo no ignora un rompecabezas parcialmente resuelto, pero contin√∫a invocando recursivamente el mismo procedimiento, obtenemos un retroceso (en otras palabras, una caminata completa en la profundidad del √°rbol de decisi√≥n potencial).  Aqu√≠, comienza a jugar un papel importante, cu√°l de las c√©lulas se elegir√° como la pr√≥xima extensi√≥n de la soluci√≥n potencial.  Buena investigaci√≥n sobre este tema se encuentra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en esta publicaci√≥n</a> . </p><br><div class="spoiler">  <b class="spoiler_title">C√≥digo</b> <div class="spoiler_text"><p>  Retroceder es bastante complicado conmigo, pero estas dos funciones describen aproximadamente lo que sucede durante una b√∫squeda recursiva </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">search</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, search_directions, path=</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Return False if the given path is a dead end (no solutions can be found) """</span></span> board = self.board depth = len(path) save = board.make_snapshot() <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> search_directions: state = search_directions.popleft() assumption, pos = state.color, state.position cell_colors = board.cell_colors(pos) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> assumption <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> cell_colors: LOG.warning(<span class="hljs-string"><span class="hljs-string">"The assumption '%s' is already expired. "</span></span> <span class="hljs-string"><span class="hljs-string">"Possible colors for %s are %s"</span></span>, assumption, pos, cell_colors) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(cell_colors) == <span class="hljs-number"><span class="hljs-number">1</span></span>: LOG.warning(<span class="hljs-string"><span class="hljs-string">'Only one color for cell %r left: %s. Solve it unconditionally'</span></span>, pos, assumption) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: self._solve_without_search() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> NonogramError: LOG.warning( <span class="hljs-string"><span class="hljs-string">"The last possible color '%s' for the cell '%s' "</span></span> <span class="hljs-string"><span class="hljs-string">"lead to the contradiction. "</span></span> <span class="hljs-string"><span class="hljs-string">"The path %s is invalid"</span></span>, assumption, pos, path) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> board.is_solved_full: self._add_solution() LOG.warning( <span class="hljs-string"><span class="hljs-string">"The only color '%s' for the cell '%s' lead to full solution. "</span></span> <span class="hljs-string"><span class="hljs-string">"No need to traverse the path %s anymore"</span></span>, assumption, pos, path) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> rate = board.solution_rate guess_save = board.make_snapshot() <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: LOG.warning(<span class="hljs-string"><span class="hljs-string">'Trying state: %s (depth=%d, rate=%.4f, previous=%s)'</span></span>, state, depth, rate, path) success = self._try_state(state, path) <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span>: board.restore(guess_save) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> success: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: LOG.warning( <span class="hljs-string"><span class="hljs-string">"Unset the color %s for cell '%s'. Solve it unconditionally"</span></span>, assumption, pos) board.unset_color(state) self._solve_without_search() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ValueError: LOG.warning( <span class="hljs-string"><span class="hljs-string">"The last possible color '%s' for the cell '%s' "</span></span> <span class="hljs-string"><span class="hljs-string">"lead to the contradiction. "</span></span> <span class="hljs-string"><span class="hljs-string">"The whole branch (depth=%d) is invalid. "</span></span>, assumption, pos, depth) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> board.is_solved_full: self._add_solution() LOG.warning( <span class="hljs-string"><span class="hljs-string">"The negation of color '%s' for the cell '%s' lead to full solution. "</span></span> <span class="hljs-string"><span class="hljs-string">"No need to traverse the path %s anymore"</span></span>, assumption, pos, path) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span>: <span class="hljs-comment"><span class="hljs-comment"># do not restore the solved cells on a root path - they are really solved! if path: board.restore(save) return True def _try_state(self, state, path): board = self.board full_path = path + (state,) probe_jobs = self._get_all_unsolved_jobs(board) try: # update with more prioritized cells for new_job, priority in self._set_guess(state): probe_jobs[new_job] = priority __, best_candidates = self._solve_jobs(probe_jobs) except NonogramError as ex: LOG.warning('Dead end found (%s): %s', full_path[-1], str(ex)) return False rate = board.solution_rate LOG.info('Reached rate %.4f on %s path', rate, full_path) if rate == 1: return True cells_left = round((1 - rate) * board.width * board.height) LOG.info('Unsolved cells left: %d', cells_left) if best_candidates: return self.search(best_candidates, path=full_path) return True</span></span></code> </pre> <br></div></div><br></li></ul><br><p>  Entonces, comenzamos a resolver nuestro crucigrama desde el segundo nivel (el primero solo es adecuado para el caso degenerado, cuando en todo el crucigrama solo hay una fila o columna) y gradualmente subimos los niveles.  Como puede suponer, cada nivel causa el nivel subyacente varias veces, por lo que para una soluci√≥n efectiva es imperativo tener un primer y segundo nivel r√°pidos, que se pueden invocar millones de veces para acertijos complejos. </p><br><p>  En esta etapa, resulta (bastante esperado) que Python no es la herramienta adecuada para el m√°ximo rendimiento en una tarea tan intensiva de CPU: todos los c√°lculos son extremadamente ineficientes en comparaci√≥n con los lenguajes de nivel inferior.  Por ejemplo, el solucionador BGU m√°s cerrado algor√≠tmicamente (en Java), seg√∫n los resultados de las mediciones, result√≥ ser 7-17 (a veces hasta 27) veces m√°s r√°pido en una variedad de tareas. </p><br><div class="spoiler">  <b class="spoiler_title">M√°s detalles</b> <div class="spoiler_text"><pre>         pynogram_my BGU_my speedup
 Bailarina 0.976 0.141 6.921986      
 Gato 1.064 0.110 9.672727      
 Pat√≠n 1.084 0.101 10.732673     
 D√≥lares 1.116 0.118 9.457627      
 Borde 1.208 0.094 12.851064     
 Humo 1.464 0.120 12.200000     
 Nudo 1.332 0.140 9.514286      
 Swing 1.784 0.138 12.927536     
 Mam√° 2.108 0.147 14.340136     
 DiCap 2.076 0.176 11.795455     
 Tr√°gico 2.368 0.265 8.935849      
 Merka 2.084 0.196 10.632653     
 Petro 2.948 0.219 13.461187     
 M&amp;M 3.588 0.375 9.568000      
 Firmado 4.068 0.242 16.809917     
 Luz 3.848 0.488 7.885246      
 Por siempre 111.000 13.570 8.179808  
 Centro 5.700 0.327 17.431193     
 Caliente 3.150 0.278 11.330935     
 Karate 2.500 0.219 11.415525     
 9-Dom 510.000 70.416 7.242672      
 Bandera 149.000 5.628 26.474769     
 Le√≥n 71.000 2.895 24.525043     
 Marley 12.108 4.405 2.748695      
 Cosa 321.000 46.166 6.953169      
 Nature inf 433.138 inf     
 Sierp inf inf NaN      
 Gettys inf inf NaN      
</pre><br><p>  Las mediciones se realizaron en mi autom√≥vil, los rompecabezas se toman del conjunto est√°ndar que Jan Wolter us√≥ en su <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">comparaci√≥n</a> </p></div></div><br><p>  ¬°Y esto ya es despu√©s de que comenc√© a usar PyPy, y en CPython est√°ndar el tiempo de c√°lculo fue m√°s largo que en PyPy 4-5 veces!  Podemos decir que el rendimiento de un solucionador de Java similar result√≥ ser 28-85 veces mayor que el c√≥digo CPython. </p><br><p>  Los intentos de mejorar el rendimiento de mi solucionador mediante la creaci√≥n de perfiles (cProfile, SnakeViz, line_profiler) condujeron a cierta aceleraci√≥n, pero, por supuesto, no dieron un resultado sorprendente. </p><br><h3 id="itogihttpsgithubcomtsionyxpynogram">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Resumen</a> : </h3><br><p>  <strong>+</strong> solucionador puede resolver todos los rompecabezas de los sitios <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://webpbn.com</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://nonograms.org</a> y su propio formato (basado en ini) </p><br><p>  <strong>+</strong> resuelve nonogramas en blanco y negro y en color con cualquier n√∫mero de colores (el n√∫mero m√°ximo de colores que se reunieron es 10) </p><br><p>  <strong>+</strong> resuelve acertijos con bloques faltantes (borrados).  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Un ejemplo de tal rompecabezas</a> . </p><br><p>  <strong>+</strong> puede hacer rompecabezas a la consola / a las maldiciones / ventana en el navegador (al instalar la opci√≥n <em>web-pynogram</em> adicional).  Para todos los modos, se admite la visualizaci√≥n del progreso de la soluci√≥n en tiempo real. </p><br><p>  <strong>-</strong> c√°lculos lentos (en comparaci√≥n con las implementaciones descritas en la comparaci√≥n de art√≠culos de solucionadores, ver <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tabla</a> ). </p><br><p>  <strong>-</strong> retroceso ineficiente: algunos acertijos se pueden resolver durante horas (cuando el √°rbol de decisi√≥n es muy grande). </p><br><h2 id="rust">  Herrumbre </h2><br><p>  A principios de a√±o, comenc√© a estudiar Rust.  Comenc√©, como siempre, con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">The Book</a> , aprend√≠ sobre WASM, revis√© el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tutorial propuesto</a> .  Sin embargo, quer√≠a una tarea real en la que pueda participar en las fortalezas del lenguaje (principalmente su s√∫per rendimiento), y no algunos ejemplos inventados por alguien.  Entonces volv√≠ a los nonogramas.  Pero ahora ya ten√≠a una versi√≥n funcional de todos los algoritmos en Python, se dej√≥ "reescribir". </p><br><p>  La buena noticia me esperaba desde el principio: result√≥ que Rust, con su sistema de tipos, describe perfectamente las estructuras de datos para mi tarea.  Por ejemplo, una de las correspondencias b√°sicas <em>BinaryColor + BinaryBlock</em> / <em>MultiColor + ColoredBlock le</em> permite separar permanentemente nonogramas en blanco y negro y en color.  Si en alg√∫n lugar del c√≥digo tratamos de resolver una cadena de color utilizando bloques de descripci√≥n binaria ordinarios, obtenemos un error de compilaci√≥n sobre la falta de coincidencia de tipos. </p><br><div class="spoiler">  <b class="spoiler_title">Los tipos b√°sicos se parecen a esto</b> <div class="spoiler_text"><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Color</span></span></span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">blank</span></span></span></span>() -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Self</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_solved</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">bool</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solution_rate</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">f64</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_updated_with</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, new: &amp;<span class="hljs-keyword"><span class="hljs-keyword">Self</span></span>) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Result</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">bool</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>&gt;; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">variants</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">Self</span></span>&gt;; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as_color_id</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Option</span></span>&lt;ColorId&gt;; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">from_color_ids</span></span></span></span>(ids: &amp;[ColorId]) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Self</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Block</span></span></span></span> { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Color</span></span></span></span>: Color; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">from_str_and_color</span></span></span></span>(s: &amp;<span class="hljs-built_in"><span class="hljs-built_in">str</span></span>, color: <span class="hljs-built_in"><span class="hljs-built_in">Option</span></span>&lt;ColorId&gt;) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Self</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> size = s.parse::&lt;<span class="hljs-built_in"><span class="hljs-built_in">usize</span></span>&gt;().expect(<span class="hljs-string"><span class="hljs-string">"Non-integer block size given"</span></span>); Self::from_size_and_color(size, color) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">from_size_and_color</span></span></span></span>(size: <span class="hljs-built_in"><span class="hljs-built_in">usize</span></span>, color: <span class="hljs-built_in"><span class="hljs-built_in">Option</span></span>&lt;ColorId&gt;) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Self</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">usize</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) -&gt; Self::Color; } <span class="hljs-meta"><span class="hljs-meta">#[derive(Debug, PartialEq, Eq, Hash, Clone)]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Description</span></span></span></span>&lt;T: Block&gt; <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T: Block, { <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> vec: <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>&lt;T&gt;, } <span class="hljs-comment"><span class="hljs-comment">// for black-and-white puzzles #[derive(Debug, PartialEq, Eq, Hash, Copy, Clone, PartialOrd)] pub enum BinaryColor { Undefined, White, Black, BlackOrWhite, } impl Color for BinaryColor { // omitted } #[derive(Debug, PartialEq, Eq, Hash, Default, Clone)] pub struct BinaryBlock(pub usize); impl Block for BinaryBlock { type Color = BinaryColor; // omitted } // for multicolor puzzles #[derive(Debug, PartialEq, Eq, Hash, Default, Copy, Clone, PartialOrd, Ord)] pub struct MultiColor(pub ColorId); impl Color for MultiColor { // omitted } #[derive(Debug, PartialEq, Eq, Hash, Default, Clone)] pub struct ColoredBlock { size: usize, color: ColorId, } impl Block for ColoredBlock { type Color = MultiColor; // omitted }</span></span></code> </pre> </div></div><br><p>  Al portar el c√≥digo, algunos puntos indican claramente que un lenguaje est√°ticamente escrito como Rust (bueno, o, por ejemplo, C ++) es m√°s adecuado para esta tarea.  M√°s precisamente, los gen√©ricos y los rasgos describen un dominio mejor que las jerarqu√≠as de clase.  Entonces, en el c√≥digo Python, tuve dos clases para un <code>BguSolver</code> lineal, <code>BguSolver</code> y <code>BguColoredSolver</code> que resolvieron una l√≠nea en blanco y negro y una l√≠nea de color, respectivamente.  En el c√≥digo Rust, todav√≠a tengo la √∫nica <code>struct DynamicSolver&lt;B: Block, S = &lt;B as Block&gt;::Color&gt;</code> gen√©rica <code>struct DynamicSolver&lt;B: Block, S = &lt;B as Block&gt;::Color&gt;</code> , que puede resolver ambos tipos de tareas, dependiendo del tipo pasado durante la creaci√≥n ( <code>DynamicSolver&lt;BinaryBlock&gt;, DynamicSolver&lt;ColoredBlock&gt;</code> ).  Esto, por supuesto, no significa que no se pueda hacer algo similar en Python, solo en Rust, el sistema de tipos me indic√≥ claramente que si no segu√≠as este camino, tendr√≠as que escribir una tonelada de c√≥digo repetido. </p><br><p>  Adem√°s, cualquiera que haya intentado escribir en Rust, sin duda not√≥ el efecto de "confianza" en el compilador, cuando el proceso de escribir c√≥digo se reduce al siguiente algoritmo pseudo-meta: </p><br><pre> escribir_c√≥digo_inicial
 while (compiler_hints = $ (carga check))! = 0;  hacer
     fix_errors (compiler_hints)
 fin
</pre><br><p>  Cuando el compilador deja de emitir errores y advertencias, su c√≥digo ser√° coherente con el sistema de tipos y el verificador de pr√©stamos y le avisar√° con anticipaci√≥n de un mont√≥n de posibles errores (por supuesto, siempre que los tipos de datos est√©n cuidadosamente dise√±ados). </p><br><p>  Dar√© un par de ejemplos de funciones que muestran cu√°n conciso puede ser el c√≥digo Rust (en comparaci√≥n con las contrapartes de Python). </p><br><div class="spoiler">  <b class="spoiler_title">unsighved_neighbours</b> <div class="spoiler_text"><p>  Da una lista de "vecinos" no resueltos para un punto dado (x, y) </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unsolved_neighbours</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, position)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> pos <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.neighbours(position): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.is_cell_solved(*pos): <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> pos</code> </pre> <br><pre> <code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unsolved_neighbours</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, point: &amp;Point) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Iterator</span></span>&lt;Item = Point&gt; + <span class="hljs-symbol"><span class="hljs-symbol">'_</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.neighbours(&amp;point) .into_iter() .filter(<span class="hljs-keyword"><span class="hljs-keyword">move</span></span> |n| !<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.cell(n).is_solved()) }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">sumas parciales</b> <div class="spoiler_text"><p>  Para un conjunto de bloques que describe una l√≠nea, d√© sumas parciales (teniendo en cuenta los espacios requeridos entre los bloques). Los √≠ndices resultantes indicar√°n la posici√≥n m√≠nima en la que puede terminar el bloque (esta informaci√≥n se usa m√°s adelante para un solucionador lineal). </p><br><p>  Por ejemplo, para tal conjunto de bloques <code>[2, 3, 1]</code> tenemos en la salida <code>[2, 6, 8]</code> , lo que significa que el primer bloque se puede desplazar al m√°ximo hacia la izquierda para que su borde derecho ocupe la segunda celda, de manera similar para el resto bloques: </p><br><pre>             1 2 3 4 5 6 7 8 9 
             _ _ _ _ _ _ _ _ _ _
      2 3 1 | _ | _ | _ | _ | _ | _ | _ | _ | _ | 
               ^ ^ ^
               El |  El |  El |
 final de 1 bloque |  El |  El | 
 final del bloque 2 -------- |
 final del bloque 3 ------------
</pre><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@expand_generator def partial_sums(blocks): if not blocks: return sum_so_far = blocks[0] yield sum_so_far for block in blocks[1:]: sum_so_far += block + 1 yield sum_so_far</span></span></code> </pre> <br><pre> <code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">partial_sums</span></span></span></span>(desc: &amp;[<span class="hljs-keyword"><span class="hljs-keyword">Self</span></span>]) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">usize</span></span>&gt; { desc.iter() .scan(<span class="hljs-literal"><span class="hljs-literal">None</span></span>, |prev, block| { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> current = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-literal"><span class="hljs-literal">Some</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> prev_size) = prev { prev_size + block.<span class="hljs-number"><span class="hljs-number">0</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { block.<span class="hljs-number"><span class="hljs-number">0</span></span> }; *prev = <span class="hljs-literal"><span class="hljs-literal">Some</span></span>(current); *prev }) .collect() }</code> </pre> </div></div><br><p>  Al portar, hice varios cambios </p><br><ul><li>  El n√∫cleo del solucionador (algoritmos) sufri√≥ cambios menores (principalmente para admitir tipos gen√©ricos para celdas y bloques) </li><li>  dej√≥ el √∫nico algoritmo (m√°s r√°pido) para el solucionador lineal </li><li>  en lugar del formato ini, introdujo un formato TOML ligeramente modificado </li><li>  no agreg√≥ soporte para crucigramas borrados, porque, estrictamente hablando, esta es una clase diferente de tareas </li><li><p>  dej√≥ la √∫nica forma de salida, solo a la consola, pero ahora las celdas de colores en la consola se dibujan realmente de colores (gracias a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">esta caja</a> ) </p><br><div class="spoiler">  <b class="spoiler_title">asi</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/xm/fd/ez/xmfdezlfahkoksuj3h0djom3p9k.png" alt="Jack Sparrow"></p><br></div></div><br></li></ul><br><h3 id="poleznye-instrumenty">  Herramientas utiles </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Clippy</a> es un analizador est√°tico est√°ndar que a veces incluso puede dar consejos que aumentan ligeramente el rendimiento del c√≥digo. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">valgrind</a> es una herramienta para el an√°lisis din√°mico de aplicaciones.  Lo utilic√© como generador de perfiles para buscar botneks ( <code>valrgind --tool=callgrind</code> ) y particularmente secciones de c√≥digo con <code>valrgind --tool=massif</code> ( <code>valrgind --tool=massif</code> ).  Consejo: establezca <em>[profile.release] debug = true</em> en Cargo.toml antes de iniciar el generador de perfiles.  Esto dejar√° caracteres de depuraci√≥n en el ejecutable. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">kcachegrind</a> para ver archivos callgrind.  Una herramienta muy √∫til para encontrar los lugares m√°s problem√°ticos en t√©rminos de rendimiento. </li></ul><br><h3 id="proizvoditelnost">  Rendimiento </h3><br><p>  Eso por lo que se inici√≥ la reescritura en Rust.  Tomamos los crucigramas de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tabla de comparaci√≥n</a> ya mencionada y los ejecutamos a trav√©s de los mejores solucionadores descritos en el art√≠culo original.  Resultados y descripci√≥n de las ejecuciones <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  Tomamos el <a href="">archivo</a> resultante y construimos un par de gr√°ficos sobre √©l. Dado que el tiempo de soluci√≥n var√≠a de milisegundos a decenas de minutos, el gr√°fico se hace con una escala logar√≠tmica. </p><br><div class="spoiler">  <b class="spoiler_title">correr en la computadora port√°til jupyter</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> matplotlib.pyplot <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> plt %matplotlib inline <span class="hljs-comment"><span class="hljs-comment"># strip the spaces df = pd.read_csv('perf.csv', skipinitialspace=True) df.columns = df.columns.str.strip() df['name'] = df['name'].str.strip() # convert to numeric df = df.replace('\+\ *', np.inf, regex=True) ALL_SOLVERS = list(df.columns[3:]) df.loc[:,ALL_SOLVERS] = df.loc[:,ALL_SOLVERS].apply(pd.to_numeric) # it cannot be a total zero df = df.replace(0, 0.001) #df.set_index('name', inplace=True) SURVEY_SOLVERS = [s for s in ALL_SOLVERS if not s.endswith('_my')] MY_MACHINE_SOLVERS = [s for s in ALL_SOLVERS if s.endswith('_my') and s[:-3] in SURVEY_SOLVERS] MY_SOLVERS = [s for s in ALL_SOLVERS if s.endswith('_my') and s[:-3] not in SURVEY_SOLVERS] bar_width = 0.17 df_compare = df.replace(np.inf, 10000, regex=True) plt.rcParams.update({'font.size': 20}) def compare(first, others): bars = [first] + list(others) index = np.arange(len(df)) fig, ax = plt.subplots(figsize=(30,10)) df_compare.sort_values(first, inplace=True) for i, column in enumerate(bars): ax.bar(index + bar_width*i, df_compare[column], bar_width, label=column[:-3]) ax.set_xlabel("puzzles") ax.set_ylabel("Time, s (log)") ax.set_title("Compare '{}' with others (lower is better)".format(first[:-3])) ax.set_xticks(index + bar_width / 2) ax.set_xticklabels("#" + df_compare['ID'].astype(str) + ": " + df_compare['name'].astype(str)) ax.legend() plt.yscale('log') plt.xticks(rotation=90) plt.show() fig.savefig(first[:-3] + '.png', bbox_inches='tight') for my in MY_SOLVERS: compare(my, MY_MACHINE_SOLVERS) compare(MY_SOLVERS[0], MY_SOLVERS[1:])</span></span></code> </pre> </div></div><br><h5 id="python-solver">  solucionador de python </h5><br><p> <a href=""><img src="https://habrastorage.org/webt/si/qb/5o/siqb5ohxk_bjjaulmkohy1uhzkw.png" alt="rendimiento de pirograma"><br></a> <br>  ( <em>se puede hacer clic en</em> la <em>imagen</em> ) </p><br><p>  Vemos que el <em>pynogram</em> aqu√≠ es m√°s lento que todos los solucionadores presentados.  La √∫nica excepci√≥n a esta regla es el solucionador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tamura / Copris</a> basado en SAT, que resuelve los acertijos m√°s simples (la parte izquierda del gr√°fico) por m√°s tiempo que el nuestro.  Sin embargo, esta es una caracter√≠stica de los solucionadores de SAT: est√°n dise√±ados para crucigramas s√∫per complejos en los que un solucionador regular se atasca en el retroceso durante mucho tiempo.  Esto es claramente visible en el lado derecho del gr√°fico, donde <em>Tamura / Copris</em> resuelve los acertijos m√°s dif√≠ciles decenas y cientos de veces m√°s r√°pido que todos los dem√°s. </p><br><h5 id="rust-solver">  solucionador de √≥xido </h5><br><p> <a href=""><img src="https://habrastorage.org/webt/bh/be/cb/bhbecb0ccinpwfhysauyjkrcx24.png" alt="rendimiento sin rejilla"><br></a> <br>  ( <em>se puede hacer clic en</em> la <em>imagen</em> ) </p><br><p>  Este gr√°fico muestra que la no <em>cuadr√≠cula</em> en tareas simples tambi√©n hace frente o es un poco peor que los solucionadores de alto rendimiento escritos en C y C ++ ( <em>Wolter</em> y <em>Syromolotov</em> ).  Con la complicaci√≥n de las tareas, nuestro solucionador repite aproximadamente la trayectoria del solucionador <em>BGU</em> (Java), pero casi siempre por delante en un orden de magnitud.  En las tareas m√°s dif√≠ciles, <em>Tamura / Copris</em> siempre est√° por delante de todos. </p><br><h5 id="rust-vs-python">  √≥xido vs pit√≥n </h5><br><p> <a href=""><img src="https://habrastorage.org/webt/ih/0b/2r/ih0b2rnmyk5o_rpgckz_5hkkifc.png" alt="Py-vs-rust-performance"><br></a> <br>  ( <em>se puede hacer clic en</em> la <em>imagen</em> ) </p><br><p>  Y finalmente, una comparaci√≥n de nuestros dos solucionadores descritos aqu√≠.  Se puede ver que el solucionador de √≥xido casi siempre tiene 1-3 √≥rdenes de magnitud por delante del solucionador de pit√≥n. </p><br><h3 id="itogihttpsgithubcomtsionyxnonogrid">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Resumen</a> : </h3><br><p>  <strong>+</strong> solucionador puede resolver todos los rompecabezas de los sitios <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://webpbn.com</a> (excepto los borrados, con tama√±os de bloque parcialmente ocultos), <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://nonograms.org</a> y su propio formato (basado en TOML) </p><br><p>  <strong>+</strong> resuelve nonogramas en blanco y negro y en color con cualquier cantidad de colores </p><br><p>  <strong>+</strong> puede hacer rompecabezas en la consola (color c webpbn.com dibuja color real) </p><br><p>  <strong>+</strong> funciona r√°pido (en comparaci√≥n con las implementaciones descritas en la comparaci√≥n de art√≠culos de solucionadores, ver tabla). </p><br><p>  <strong>- el</strong> retroceso ha permanecido ineficaz, como en la soluci√≥n de Python: algunos acertijos (por ejemplo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">, un inofensivo 20x20</a> ) se pueden resolver durante horas (cuando el √°rbol de decisi√≥n es muy grande).  Quiz√°s en lugar de retroceder vale la pena usar los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">solucionadores SAT</a> ya mencionados en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el hub</a>  Es cierto que el √∫nico <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">solucionador de SAT</a> que encontr√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en Rust</a> a primera vista parece inacabado y abandonado. </p><br><h2 id="webassembly">  Montaje web </h2><br><p>  Por lo tanto, reescribir el c√≥digo en Rust ha valido la pena: el solucionador se ha vuelto mucho m√°s r√°pido.  Sin embargo, Rust nos ofrece otra caracter√≠stica incre√≠blemente genial: compilaci√≥n en WebAssembly y la capacidad de ejecutar su c√≥digo directamente en el navegador. </p><br><p>  Para implementar esta funci√≥n, hay una herramienta especial para Rust que proporciona los aglutinantes necesarios y genera una plantilla repetitiva para que pueda ejecutar sin problemas las funciones de Rust en el c√≥digo JS: este <em>paquete</em> <em>wasm</em> (+ <em>wasm-bindgen</em> ).  La mayor parte del trabajo con √©l y otras herramientas importantes ya se describen en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tutorial Rust and WebAssembly</a> .  Sin embargo, hay un par de puntos que tuve que resolver por mi cuenta: </p><br><ul><li><p>  cuando lee, crea la sensaci√≥n de que el tutorial est√° escrito principalmente para un desarrollador de JS que quiere acelerar su c√≥digo con Rust.  Bueno, o al menos para alguien familiarizado con <em>npm</em> .  Para m√≠, como persona lejos del front-end, fue sorprendente encontrar que incluso el ejemplo est√°ndar del libro no quiere trabajar con un servidor web de terceros que sea diferente de <code>npm run start</code> . </p><br><p>  Afortunadamente, wasm-pack tiene un modo que le permite generar c√≥digo JS regular (que no es un m√≥dulo npm).  <code>wasm-pack build --target no-modules --no-typescript</code> en la salida solo generar√° dos archivos: <em>project-name.wasm</em> - el binario del c√≥digo Rust compilado en WebAssembly y <em>project-name.js</em> .  El √∫ltimo archivo se puede agregar a cualquier p√°gina HTML <code>&lt;script src="project-name.js"&gt;&lt;/script&gt;</code> y usar funciones WASM sin molestarse con npm, webpack, ES6, m√≥dulos y otras alegr√≠as del desarrollador JS moderno.  El modo <code>no-modules</code> es ideal para desarrolladores que no son front-end durante el desarrollo de una aplicaci√≥n WASM, as√≠ como para ejemplos y demostraciones, ya que no requiere ninguna infraestructura front-end adicional. </p><br></li><li><p>  WebAssembly es bueno para tareas que son demasiado pesadas para JavaScript.  En primer lugar, estas son tareas que realizan muchos c√°lculos.  Y si es as√≠, dicha tarea se puede realizar durante mucho tiempo incluso con WebAssembly y, por lo tanto, viola el principio asincr√≥nico de la web moderna.  Estoy hablando de todo tipo de <em>Advertencia: secuencia de comandos</em> que no <em>responde</em> que observ√© cuando mi solucionador funcionaba.  Para resolver este problema, puede utilizar el mecanismo de <em>trabajo web</em> .  En este caso, el esquema para trabajar con funciones WASM "pesadas" puede verse as√≠: </p><br><ol><li>  desde el script principal para un evento (por ejemplo, al hacer clic en un bot√≥n), env√≠e un mensaje al trabajador con la tarea de iniciar una funci√≥n pesada. </li><li>   ,        . </li><li>      -   () </li></ol><br></li></ul><br><p>   WASM-         JS,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  WASM</a> .      -   (       ),     <code>HashMap</code>       ,     .    ( JS)    ,          /   . </p><br><p>       ,  <a href="">  Mutex</a> ,        thread-safe.       smart-    .   thread-safe     <em>Rc</em>  <em>Arc</em>  <em>RefCell</em>  <em>RwLock</em> .         :         30%.         <code>--features=threaded</code>      thread-safe ,     WASM-. </p><br><p>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">6574</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">8098</a>    (     10 ): </p><br><div class="scrollable-table"><table><thead><tr><th> id </th><th> non-thread-safe </th><th> thread-safe </th><th> web-interface </th></tr></thead><tbody><tr><td> 6574 </td><td> 5.4 </td><td> 7.4 </td><td> 9.2 </td></tr><tr><td> 8098 </td><td> 21.5 </td><td> 28.4 </td><td> 29.9 </td></tr></tbody></table></div><br><p> ,   -    40..70% ,       ,      (32..37%)      thread-safe  ( <code>cargo build --release --features=threaded</code> ). </p><br><p>    Firefox 67.0  Chromium 74.0. </p><br><p> WASM-   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> ).            <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://webpbn.com/</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://www.nonograms.org/</a> </p><br><h3 id="todo"> TODO </h3><br><ul><li><p> ""  /,  /    . </p><br></li><li><p>     ,     .      "" ,    ,        .      . </p><br></li><li><p>     (    ,      3600 ).  WASM     ,     (  ,   (!) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> ,   ,     WASM). ,  , -  ,       nonogrid  . </p><br></li><li><p>   .      : ,       ,      WASM   .    ,         ( )    ,    JS  ,      . </p><br></li><li><p>     JS.         backtrace,       . </p><br></li><li><p>        (     <a href="">TOML-</a> ) </p><br></li></ul><br><h2 id="itogi">  Resumen </h2><br><ul><li><p>           ,    (, , etc). </p><br></li><li><p>   Rust  1-3     PyPy       1.5-2  (  ). </p><br></li><li><p>    Python  Rust  ,            Python (, , comprehensions),      Rust-. </p><br></li><li><p>   Rust  WebAssembly   .     Rust ,   WASM,      (     1.5  ). </p><br></li></ul><br><h2 id="osnovnye-istochniki">   </h2><br><ol><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">The 'pbnsolve' Paint-by-Number Puzzle Solver by Jan Wolter</a> and the <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">survey</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">The BGU Nonograms Project</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Solving Nonograms by combining relaxations</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">An Efficient Approach to Solving Nonograms</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">      </a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Color and black and white Japanese crosswords on-line</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">      </a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">'Nonolib' library by Dr. Steven Simpson</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Rust and WebAssembly</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/454586/">https://habr.com/ru/post/454586/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../454574/index.html">Aprendizaje autom√°tico en microfinanzas: construyendo un modelo de puntuaci√≥n para clientes con un historial de cr√©dito vac√≠o</a></li>
<li><a href="../454576/index.html">Los autores de GandCrab dejan de funcionar: afirman haber robado lo suficiente</a></li>
<li><a href="../454578/index.html">C√≥mo conectar la galer√≠a PhotoSwipe en la vista web de Android</a></li>
<li><a href="../454582/index.html">¬øSe debe almacenar la longitud de la matriz en una variable local en C #?</a></li>
<li><a href="../454584/index.html">Escuela de desarrollo de interfaz: an√°lisis de tareas para Minsk y un nuevo conjunto en Mosc√∫</a></li>
<li><a href="../454588/index.html">Gazprom Neft te invita a visitar: GPN Data Science Meetup</a></li>
<li><a href="../454590/index.html">Zimbra Collaboration Suite y control m√≥vil con ABQ</a></li>
<li><a href="../454592/index.html">WAF a trav√©s de los ojos de los hackers</a></li>
<li><a href="../454596/index.html">Modelos mentales en seguridad de la informaci√≥n.</a></li>
<li><a href="../454598/index.html">Arquitectura sin servidor y microservicios: ¬øla combinaci√≥n perfecta?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>