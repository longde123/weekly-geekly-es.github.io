<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëçüèº üë®‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë® üëÑ Proyecto de almacenamiento en MS SQL Server, integraci√≥n con 1C 7.7 y automatizaci√≥n del desarrollo en SSDT üïé üëáüèæ ü§Ωüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El tiempo se acaba y pronto no quedar√° casi nada de este desarrollo, pero todav√≠a no tuve tiempo para describirlo. 



 Se tratar√° de una empresa a ni...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Proyecto de almacenamiento en MS SQL Server, integraci√≥n con 1C 7.7 y automatizaci√≥n del desarrollo en SSDT</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423205/">  El tiempo se acaba y pronto no quedar√° casi nada de este desarrollo, pero todav√≠a no tuve tiempo para describirlo. <br><br><img src="https://habrastorage.org/webt/fi/5s/if/fi5siftwc5fvceqqsjgxfnqubum.png"><br><br>  Se tratar√° de una empresa a nivel federal con una gran cantidad de sucursales y sub-sucursales.  Pero, como de costumbre, todo comenz√≥ hace mucho tiempo con una peque√±a tienda.  Con los a√±os, se produjo un desarrollo bastante r√°pido y espont√°neo, aparecieron sucursales, divisiones y otras oficinas, y la infraestructura de TI no recibi√≥ la debida atenci√≥n en esos d√≠as, y esto tambi√©n es un hecho frecuente.  Por supuesto, el 1C77 se us√≥ en todas partes, sin ninguna reserva para ninguna replicaci√≥n y escala, por lo tanto, al final llegamos a la conclusi√≥n de que un Sprut-Frankenstein se gener√≥ con tent√°culos atados con cinta aislante: en cada rama hab√≠a un mutante aut√≥nomo que se intercambiaba con la base central. en el modo "hasta la rodilla", solo unos pocos libros de referencia, sin los cuales, bueno, era imposible en absoluto, y el resto es aut√≥nomo.  Durante alg√∫n tiempo se contentaron con copias (¬°docenas de ellas!) De bases de sucursales en la oficina central, pero los datos en ellas se retrasaron durante varios d√≠as. <br><br>  La realidad, sin embargo, requiere obtener informaci√≥n de manera m√°s r√°pida y flexible, y hay que hacer algo m√°s con esto.  La transferencia de un sistema contable a otro a tal escala sigue siendo un pantano.  Por lo tanto, se decidi√≥ crear un almac√©n de datos (DX), en el que la informaci√≥n fluir√≠a desde diferentes bases de datos, para que luego otros servicios y el sistema anal√≠tico en forma de cubos, informes SSRS y fugas pudieran recibir datos de este CD. <br><br>  Mirando hacia el futuro, dir√© que la transici√≥n a un nuevo sistema de contabilidad casi ha sucedido y que la mayor parte del proyecto descrito aqu√≠ se cortar√° en un futuro pr√≥ximo como innecesario.  Lo siento, por supuesto, pero no se puede hacer nada. <br><br>  El siguiente es un art√≠culo largo, pero antes de comenzar a leer, perm√≠tanme se√±alar que en ning√∫n caso apruebo esta decisi√≥n como est√°ndar, pero tal vez alguien encuentre algo √∫til en ella. <br><a name="habracut"></a><br>  Comenzar√© con un enfoque general del proyecto, para el cual se eligi√≥ SSDT como entorno de desarrollo, con la posterior publicaci√≥n del proyecto en Git.  Creo que hoy hay suficientes art√≠culos y tutoriales que describen los puntos fuertes de esta herramienta.  Pero hay algunos puntos cuyo problema se encuentra fuera de este entorno. <br><br><h4>  Almacenamiento de enumeraciones y versiones de bases de datos. </h4><br>  En cuanto a las versiones y enumeraciones, los requisitos para el proyecto significaban: <br><br><ul><li>  Conveniencia de editar y rastrear cambios en la versi√≥n de la base de datos dentro del proyecto </li><li>  Conveniencia de ver la versi√≥n de la base de datos a trav√©s de SSMS para administradores </li><li>  Guardar el historial de cambios de versi√≥n en la base de datos (qui√©n y cu√°ndo realiz√≥ la implementaci√≥n) </li><li>  Almacenar enumeraciones en un proyecto </li><li>  Facilidad de edici√≥n y seguimiento de cambios en transferencias </li><li>  Bloqueo de implementaci√≥n de base de datos encima de uno existente si no hubiera una versi√≥n incremental </li><li>  La instalaci√≥n de una nueva versi√≥n, el historial de grabaci√≥n, las transferencias y la reestructuraci√≥n deben realizarse en una transacci√≥n y revertirse por completo en caso de falla en cualquier etapa </li></ul><br>  Porque  las transferencias a menudo contienen l√≥gica y son valores b√°sicos, sin los cuales es imposible agregar registros a otras tablas (debido a las claves externas FK), en esencia son parte de la estructura de la base de datos, junto con los metadatos.  Por lo tanto, un cambio en cualquier elemento de enumeraci√≥n conduce a un incremento de la versi√≥n de la base de datos y, junto con esta versi√≥n, se debe garantizar que los registros se actualicen durante la implementaci√≥n. <br><br>  Creo que todas las ventajas de bloquear la implementaci√≥n sin incrementar la versi√≥n son obvias, una de las cuales es la imposibilidad de volver a ejecutar el script de publicaci√≥n si ya se ha ejecutado con √©xito anteriormente. <br><br>  Aunque a menudo se propone que la red para bases de datos use solo la versi√≥n principal (sin fracciones), decidimos usar versiones en el formato XY, donde Y es el parche cuando se corrigi√≥ un error tipogr√°fico en la descripci√≥n de la tabla, columna, nombre del elemento de la lista, o algo m√°s peque√±o, como agregar un comentario a un procedimiento almacenado, etc.  En todos los dem√°s casos, la versi√≥n principal se acumula. <br><br>  Quiz√°s para alguien no hay nada de <i>eso</i> y todo es obvio.  Pero, a su debido tiempo, tom√© bastantes nervios y energ√≠a en disputas internas sobre c√≥mo almacenar transferencias en el proyecto de base de datos, de modo que era feng shui ( <i>de acuerdo con mi idea</i> ) y que era conveniente trabajar con ellos, mientras minimiza la probabilidad de errores. <br><br>  Con las transferencias, en general, todo es simple: creamos un archivo PostDeploy en el proyecto y escribimos c√≥digo para llenar las tablas.  Con fusiones o trankates: as√≠ es como te gusta.  Preferimos parpadear, verificando previamente si el n√∫mero de registros en la tabla de destino excede el n√∫mero de registros que est√°n en la fuente (proyecto).  Si excede, entonces se lanza una excepci√≥n para llamar la atenci√≥n, porque es extra√±o.  ¬øPor qu√© hay menos registros en la fuente?  ¬øPorque uno es superfluo?  ¬øPor qu√© de repente?  ¬øY si la base de datos ya tiene enlaces?  Aunque utilizamos claves externas (FK), que no le permitir√°n eliminar el registro, si hay enlaces a √©l, a√∫n preferimos dejar esta opci√≥n.  Como resultado, PostDeploy se convirti√≥ en una hoja ilegible, porque para cada tabla que se debe completar, adem√°s de los valores en s√≠, tambi√©n hay un c√≥digo de verificaci√≥n, una fusi√≥n, etc. <br><br>  Sin embargo, si usa PostDeploy en modo SQLCMD, es posible extraer bloques de c√≥digo en archivos separados, como resultado, solo queda una lista estructurada de nombres de archivos para completar las enumeraciones en PostDeploy. <br><br>  Hay algunos matices con las versiones de la base de datos.  Internet ha estado debatiendo durante mucho tiempo sobre d√≥nde almacenar la versi√≥n de la base de datos, c√≥mo deber√≠a verse y, en general, si necesita almacenarse en alg√∫n lugar.  Supongamos que decidimos que lo necesitamos, ¬øen qu√© lugar del proyecto almacenarlo?  ¬øEn alg√∫n lugar en la naturaleza de un script PostDeploy, o ponerlo en una variable que se declara en la primera l√≠nea del script? <br><br>  En mi opini√≥n, ni lo uno ni lo otro.  Es m√°s conveniente cuando se almacena en un archivo separado y no hay nada m√°s all√≠. <br><br>  Alguien dir√°: hay dacpac en las propiedades del proyecto y puede configurar la versi√≥n en √©l.  Por supuesto, incluso puede incluir esta versi√≥n en su script, como se describe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> , pero esto es un inconveniente: para cambiar la versi√≥n de la base de datos, debe ir a alg√∫n lugar lejos, hacer clic en un grupo de botones.  No entiendo la l√≥gica de Microsoft: la escondieron en una esquina lejana, junto con par√°metros de la base de datos como clasificaci√≥n, nivel de compatibilidad, etc., porque la versi√≥n de la base de datos cambia tan "a menudo" como los par√°metros de clasificaci√≥n, ¬øverdad?  Cuando hay un desarrollo constante, la versi√≥n se acumula con cada nueva implementaci√≥n, y la conveniencia de realizar un seguimiento de los cambios tambi√©n juega un papel importante, porque cuando se enciende un archivo modificado con un nombre descriptivo, esto es una cosa, y cuando se enciende el archivo de proyecto .sqlproj, en el que hay muchas l√≠neas en formato XML , y entre ellos, en alg√∫n lugar del centro de la l√≠nea, se resalta un d√≠gito modificado, de alguna manera no muy. <br><br><img src="https://habrastorage.org/webt/bg/i3/48/bgi3485rgezdefuaami2weappqy.png"><br><br>  Eso es mejor <br><br><img src="https://habrastorage.org/webt/ro/9y/ld/ro9yldaaeoqcmubpi42adq-so50.png"><br><br>  Sin embargo, tal vez estas son solo mis cucarachas y no debes prestarles atenci√≥n. <br><br>  Ahora la pregunta es: d√≥nde almacenar esta versi√≥n ya en la base de datos desplegada.  Nuevamente, parece que dacpac lo hace maravillosamente: escribe todo en las placas del sistema, pero para ver la versi√≥n, debe ejecutar la solicitud (¬øo puede ser de otra manera, pero no s√© c√≥mo cocinarlos? Parece que en versiones anteriores de SSMS hab√≠a una interfaz para esto, y ahora no) <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> msdb.dbo.sysdac_instances_internal</code> </pre> <br>  para el administrador (y no solo) no es muy conveniente.  Es mucho m√°s l√≥gico que la versi√≥n se muestre directamente en las propiedades de la base de datos. <br><br><img src="https://habrastorage.org/webt/ed/ax/le/edaxle3ic1lfwvaeuhhhphmrulo.png"><br><br>  O no? <br><br>  Para hacer esto, debe agregar un archivo al proyecto, incluido en la compilaci√≥n, que describa las propiedades avanzadas <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> sp_addextendedproperty @<span class="hljs-keyword"><span class="hljs-keyword">name</span></span> = N<span class="hljs-string"><span class="hljs-string">'DeployerName'</span></span>, @<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = <span class="hljs-string"><span class="hljs-string">''</span></span>; GO <span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> sp_addextendedproperty @<span class="hljs-keyword"><span class="hljs-keyword">name</span></span> = N<span class="hljs-string"><span class="hljs-string">'DeploymentDate'</span></span>, @<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = <span class="hljs-string"><span class="hljs-string">''</span></span>; GO <span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> sp_addextendedproperty @<span class="hljs-keyword"><span class="hljs-keyword">name</span></span> = N<span class="hljs-string"><span class="hljs-string">'DBVersion'</span></span>, @<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = <span class="hljs-string"><span class="hljs-string">''</span></span>;</code> </pre> <br>  S√≠, est√°n vac√≠os y se ve feo en un script de publicaci√≥n, pero no puedes prescindir de ellos.  Si no se describen en el proyecto y estar√°n en la base de datos, el estudio intentar√° eliminarlos cada vez que se implemente.  (Ha habido muchos intentos de solucionar esto de manera sucinta y sin opciones de implementaci√≥n innecesarias, pero fue en vano) <br><br>  Estableceremos los valores para ellos en el script PostDeploy. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @username <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">256</span></span>) = suser_sname() ,@curdatetime <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">format</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">getdate</span></span>(),<span class="hljs-string"><span class="hljs-string">'dd.MM.yyyy HH:mm:ss'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> sp_updateextendedproperty @<span class="hljs-keyword"><span class="hljs-keyword">name</span></span> = N<span class="hljs-string"><span class="hljs-string">'DeployerName'</span></span>, @<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = @username; <span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> sp_updateextendedproperty @<span class="hljs-keyword"><span class="hljs-keyword">name</span></span> = N<span class="hljs-string"><span class="hljs-string">'DBVersion'</span></span>, @<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = [$(DBVersion)]; <span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> sp_updateextendedproperty @<span class="hljs-keyword"><span class="hljs-keyword">name</span></span> = N<span class="hljs-string"><span class="hljs-string">'DeploymentDate'</span></span>, @<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = @curdatetime;</code> </pre> <br>  <code>sp_updateextendedproperty</code> sin ninguna comprobaci√≥n, porque para cuando se inici√≥ el bloque desde PostDeploy, todas las propiedades ya se hab√≠an creado si no estaban all√≠. <br><br>  Bueno, ser√≠a bueno mantener el historial, sobre el tema de qui√©n y cu√°ndo despleg√≥ la base de datos. <br><br>  La implementaci√≥n de los cambios de metadatos se puede realizar en la transacci√≥n utilizando herramientas est√°ndar marcando la casilla <b>Habilitar scripts de transacci√≥n</b> en la ventana <b>Opciones de publicaci√≥n avanzadas</b> .  Pero este indicador no afecta a la implementaci√≥n de scripts (Pre / Post) y contin√∫an ejecut√°ndose sin una transacci√≥n.  Por supuesto, nada impide que la transacci√≥n comience al comienzo del script PostDeploy, pero ser√° una transacci√≥n separada de los metadatos, y tenemos la tarea de revertir los cambios de metadatos si se produjo una excepci√≥n en PostDeploy. <br><br>  La soluci√≥n es simple: inicie la transacci√≥n en PreDeploy, y conf√≠rmela en PostDeploy, y no use ninguna marca de verificaci√≥n en la configuraci√≥n de publicaci√≥n para estos fines. <br><br>  Para almacenar convenientemente la versi√≥n de la base de datos en el proyecto y registrarla en los lugares deseados durante la implementaci√≥n, puede recurrir a las variables SQLCMD.  Sin embargo, no quiero almacenar la versi√≥n en alg√∫n lugar del c√≥digo, quiero que est√© en la superficie. <br><br><img src="https://habrastorage.org/webt/yg/qm/o9/ygqmo9wf5pnwnyx7kfnumsflps8.png"><br><br>  Para colocar la versi√≥n de la base de datos en un archivo separado y administrar la versi√≥n desde all√≠ a nivel de proyecto, agregamos el siguiente bloque a .sqlproj: <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Target</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"BeforeBuild"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ReadLinesFromFile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">File</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(ProjectDir)\Properties\DBVersion"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Output</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">TaskParameter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Lines"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">PropertyName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ExtDBVersion"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ReadLinesFromFile</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WriteLinesToFile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">File</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(ProjectDir)\\SetPreDepVarsTmp.sql"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Lines</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">":setvar DBVersion $(ExtDBVersion)"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Overwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Target</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Target</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Esta es una instrucci√≥n para que MSBuild lea una l√≠nea de un archivo antes de compilar y crear un archivo temporal basado en los datos le√≠dos.  MSBuild crear√° un archivo temporal <code>SetPreDepVarsTmp.sql</code> , que <code>:setvar DBVersion $(ExtDBVersion)</code> l√≠nea <code>:setvar DBVersion $(ExtDBVersion)</code> , donde <code>$(ExtDBVersion)</code> es el valor le√≠do de nuestro archivo que almacena la versi√≥n de la base de datos. <br><br>  Despu√©s de tales manipulaciones, puede consultar este archivo temporal desde el script PreDeploy e iniciar la transacci√≥n global en √©l: <br><br><pre> <code class="sql hljs">:r .\SetPreDepVarsTmp.sql go :r ".\BeginTransaction.sql"</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Versi√≥n intermedia</b> <div class="spoiler_text">  Inicialmente, al archivo ExtendedProperties.sql no se le asignaron valores vac√≠os, sino valores de variables <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> sp_addextendedproperty @<span class="hljs-keyword"><span class="hljs-keyword">name</span></span> = N<span class="hljs-string"><span class="hljs-string">'DeployerName'</span></span>, @<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = [$(DeployerName)]; GO <span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> sp_addextendedproperty @<span class="hljs-keyword"><span class="hljs-keyword">name</span></span> = N<span class="hljs-string"><span class="hljs-string">'DeploymentDate'</span></span>, @<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = [$(DeploymentDate)]; GO <span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> sp_addextendedproperty @<span class="hljs-keyword"><span class="hljs-keyword">name</span></span> = N<span class="hljs-string"><span class="hljs-string">'DBVersion'</span></span>, @<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = [$(DBVersion)];</code> </pre> <br>  Las variables, a su vez, fueron registradas en el archivo SetPreDepVarsTmp.sql autom√°ticamente por MSBuild as√≠: <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CurrentDateTime</span></span></span><span class="hljs-tag">&gt;</span></span>$([System.DateTime]::Now.ToString(dd.MM.yyyy HH:mm:ss))<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CurrentDateTime</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NewLine</span></span></span><span class="hljs-tag">&gt;</span></span> -- <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NewLine</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Target</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"BeforeBuild"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ReadLinesFromFile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">File</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(ProjectDir)\DBVersion"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Output</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">TaskParameter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Lines"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">PropertyName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ExtDBVersion"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ReadLinesFromFile</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WriteLinesToFile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">File</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(ProjectDir)\SetPreDepVarsTmp.sql"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Lines</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">":setvar DBVersion $(ExtDBVersion)$(NewLine):setvar DeploymentDate "</span></span></span><span class="hljs-tag">$(</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">CurrentDateTime</span></span></span><span class="hljs-tag">)"$(</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">NewLine</span></span></span><span class="hljs-tag">)</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:setvar</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">DeploymentUser</span></span></span><span class="hljs-tag"> $(</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">UserDomain</span></span></span><span class="hljs-tag">)\$(</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">UserName</span></span></span><span class="hljs-tag">)" </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Overwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Target</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Con este enfoque, no necesita reinstalar estas propiedades en PostDeploy, pero el problema es que SetPreDepVarsTmp.sql conten√≠a valores est√°ticos y si el script de publicaci√≥n se gener√≥ ahora, pero se implement√≥ despu√©s de una hora, o peor a√∫n, al d√≠a siguiente (el desarrollador lo comprob√≥ durante mucho tiempo) visualmente, por ejemplo), la fecha de publicaci√≥n especificada en las propiedades diferir√° de la fecha de publicaci√≥n real y no coincidir√° con la fecha en el historial. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Contenido del archivo BeginTransaction.sql</b> <div class="spoiler_text">  En esencia, esto es solo copiar y pegar desde el bloque de inicio de transacci√≥n est√°ndar que el estudio genera cuando la casilla de verificaci√≥n <b>Habilitar scripts de transacci√≥n</b> est√° <b>seleccionada</b> , pero la usamos a nuestra manera.  En el script, solo se ha cambiado el nombre de la tabla temporal de <code>#tmpErrors</code> a <code>#tmpErrorsManual</code> para que no haya conflicto de nombres si alguien activa la casilla de verificaci√≥n. <br><br><pre> <code class="sql hljs">IF (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> OBJECT_ID(<span class="hljs-string"><span class="hljs-string">'tempdb..#tmpErrors'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-comment"><span class="hljs-comment">#tmpErrorsManual GO CREATE TABLE #tmpErrorsManual (Error int) GO SET XACT_ABORT ON GO SET TRANSACTION ISOLATION LEVEL READ COMMITTED GO BEGIN TRANSACTION GO</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Script PostDeploy</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @TableName <span class="hljs-built_in"><span class="hljs-built_in">VarChar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-comment"><span class="hljs-comment">--        if $(SkipEnumDeploy) = 0 begin PRINT N' ...' :r ..\\EnumTable1.sql end --   PRINT N'  ...'; declare @username varchar(256) = suser_sname() , @curdatetime varchar(20) = format(getdate(),'dd.MM.yyyy HH:mm:ss') if $(DBVersion) &gt; (select isnull( MAX( DBVersion),0) from zDBVersionHistory) begin insert into zDBVersionHistory( DBVersion, DeploymentDate, DeployerName) values ($(DBVersion),@curdatetime,@username) EXECUTE sp_updateextendedproperty @name = N'DeployerName', @value = @username; EXECUTE sp_updateextendedproperty @name = N'DBVersion', @value = [$(DBVersion)]; EXECUTE sp_updateextendedproperty @name = N'DeploymentDate', @value = @curdatetime; end else begin RaisError ( N':          ,  .      ,        DBVersion          .' , 16 , 1 ) WITH SETERROR; end GO :r ".\CaptureTransactionError.sql" :r ".\CommitTransaction.sql"</span></span></code> </pre> <br>  La variable SkipEnumDeploy, como ya ha quedado clara, le permite omitir la etapa de actualizaci√≥n de las listas; esto puede ser √∫til para cambios cosm√©ticos menores.  Aunque, desde el punto de vista de la religi√≥n, esto puede no ser cierto, sin embargo, definitivamente es √∫til en la etapa de desarrollo. <br></div></div><br>  Los <code>CaptureTransactionError.sql</code> y <code>CommitTransaction.sql</code> tambi√©n se copian y pegan (con peque√±os cambios) del algoritmo de transacci√≥n est√°ndar que el estudio genera cuando se establece el indicador anterior, y que ahora jugamos por nuestra cuenta. <br><br><div class="spoiler">  <b class="spoiler_title">Content CaptureTransactionError.sql</b> <div class="spoiler_text"><pre> <code class="sql hljs">IF @@ERROR &lt;&gt; 0 AND @@TRANCOUNT &gt; 0 <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROLLBACK</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> @@TRANCOUNT = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-comment"><span class="hljs-comment">#tmpErrorsManual (Error) VALUES (1); BEGIN TRANSACTION; END</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Contenido CommitTransaction.sql</b> <div class="spoiler_text"><pre> <code class="sql hljs">IF EXISTS (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-comment"><span class="hljs-comment">#tmpErrorsManual) ROLLBACK TRANSACTION GO DROP TABLE #tmpErrorsManual GO IF @@TRANCOUNT&gt;0 BEGIN PRINT N'     .' COMMIT TRANSACTION END ELSE RaisError ( N'    .' , 16 , 1 );</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Contenido EnumTable1.sql</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @TableName = N<span class="hljs-string"><span class="hljs-string">'Table1'</span></span> PRINT N<span class="hljs-string"><span class="hljs-string">'  '</span></span>+@TableName+<span class="hljs-string"><span class="hljs-string">'...'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> try <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> nocount <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-keyword"><span class="hljs-keyword">drop</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> <span class="hljs-comment"><span class="hljs-comment">#tmpEnums; select * into #tmpEnums from (values ( 0, ' 1') , ( 1, ' 2') , ( 2, ' 3') ) as tmp ( Id , Title ) set nocount off --         If ((select count(*) from Table1) &gt; (select count(*) from #tmpEnums)) begin RaisError ( N':      ,   .' , 0 , 1 ) WITH SETERROR; end set Identity_insert Table1 on Merge Table1 as target Using ( select * from #tmpEnums except select * from dbo.Table1 ) as source on target.Id = source.Id when matched then update set target.Title = source.Title when not matched by target then insert ( Id , Title ) values ( source.Id , source.Title ); set Identity_insert Table1 off drop table if exists #tmpEnums; END TRY begin catch IF @@trancount &gt; 0 ROLLBACK TRANSACTION set @Error_Message = Error_Message(); RaisError ( N': %s.' , 0 , 1 , @Error_Message ) WITH SETERROR; end catch :r "..\\CaptureTransactionError.sql"</span></span></code> </pre> <br></div></div><br>  Al implementar <code>Publish</code> script tendr√° la siguiente estructura <br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- PreDeploy ----:setvar DBVersion "10.6" --   ,     DBVersion ----   --    ,           -- PostDeploy ----  ----   ----  </span></span></code> </pre> <br><br>  Idealmente, por supuesto, me gustar√≠a que la versi√≥n se muestre al momento de la publicaci√≥n <br><img src="https://habrastorage.org/webt/8a/9w/o2/8a9wo2o5lemfglm1ru1kt5yntdm.png"><br><br>  Pero no puede extraer el valor del archivo en esta ventana, aunque MSBuild lo lee y lo coloca en la propiedad ExtDBVersion con la ayuda de instrucciones adicionales en el archivo .sqlproj, como en el ejemplo anterior, pero la construcci√≥n <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SqlCmdVariable</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DBVersion"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DefaultValue</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DefaultValue</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Value</span></span></span><span class="hljs-tag">&gt;</span></span>$(ExtDBVersion)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SqlCmdVariable</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  no rueda <br><br>  Los desarrolladores de secuelas en su <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">diario web</a> escriben c√≥mo se hace esto.  Seg√∫n su versi√≥n, la magia reside en la instrucci√≥n <code>SqlCommandVariableOverride</code> , que es simple: agregue un par de l√≠neas al archivo de proyecto .sqlproj <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SqlCommandVariableOverride</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DBVersion=$(ExtDBVersion)"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  y listo  Buen intento, pero no.  Tal vez cuando se public√≥ esta publicaci√≥n de blog, todo funcion√≥, pero desde entonces en estos Estados Unidos ha tenido tres elecciones presidenciales y nadie sabe qu√© instrucciones pueden dejar de funcionar ma√±ana. <br><br><img src="https://habrastorage.org/webt/xv/d9/li/xvd9liiwyjicnv5icr9d1utjnxs.jpeg"><br><br>  Y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> un compa√±ero prob√≥ todas las opciones, pero ninguna de ellas despeg√≥. <br><br>  Por lo tanto, tome la versi√≥n de dacpac o almac√©nela en PostDeploy, o en un archivo separado, o _________ (ingrese su versi√≥n). <br><br><h4>  Integraci√≥n con 1C </h4><br>  El primer problema fue que 1C77 no tiene un servidor de aplicaciones u otro demonio que le permita interactuar con √©l sin iniciar la plataforma.  Quienes trabajaron con 1C77 saben que ella no tiene un modo de consola completa.  Puede ejecutar la plataforma con par√°metros e incluso hacer algo basado en ellos, pero hay muy pocos par√°metros de consola y su prop√≥sito era diferente.  Pero incluso con su ayuda, puede nakolkhozit una cosechadora completa.  Sin embargo, puede volar de manera impredecible, puede mostrar una ventana modal y esperar a que alguien haga clic en Aceptar y otros encantos.  Y, tal vez, el mayor problema: la velocidad de la plataforma deja mucho que desear ... Por lo tanto, solo hay una soluci√≥n: consultas directas a la base de datos 1C.  Dada la estructura, no puede simplemente tomar y escribir estas consultas, sino que el beneficio es que hay una comunidad entera que en un momento desarroll√≥ una herramienta maravillosa: 1C ++ (1cpp.dll), lo cual es incre√≠ble para ellos. ¬°GRACIAS!  La biblioteca le permite escribir consultas en t√©rminos de 1C, que luego se convierten en nombres reales de tablas y campos.  Si alguien no lo sabe, la solicitud se puede escribir utilizando un seud√≥nimo y se ver√° as√≠ <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span>  <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> $.</code> </pre> <br>  Dicha solicitud es comprensible para los humanos, pero no existe tal tabla y campo en el servidor, hay otros nombres, por lo que 1C ++ lo convertir√° en <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> SP5278 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> SC2235</code> </pre> <br>  y tal solicitud ya es entendida por el servidor.  Todos est√°n felices, nadie jura, ni una persona ni un servidor.  Aqu√≠, al parecer, el problema ha sido resuelto. <br><br>  El segundo problema radica en el plano de las configuraciones: una configuraci√≥n se us√≥ en las sucursales, otra en la oficina central y la tercera en las sucursales.  Clase? !! 1 Yo tambi√©n lo creo.  Adem√°s, no son patrimonio t√≠pico ni siquiera t√≠pico, sino que est√°n completamente escritos desde cero durante los vikingos y, desafortunadamente, no los mejores arquitectos sentaron las bases de estas conf ... La implementaci√≥n de documentos, por ejemplo, en cada configuraci√≥n tiene un conjunto diferente de detalles.  Pero no solo difieren los nombres de algunos campos, lo que es mucho m√°s divertido cuando los nombres de los detalles son los mismos, sino que el significado de los datos almacenados en ellos es DIFERENTE. <br><br><img src="https://habrastorage.org/webt/hs/jx/sv/hsjxsv_f7qy4xlgpwjiw7uir0ko.jpeg"><br><br>  En las configuraciones casi no se utilizan registros, todo se basa en las complejidades de los documentos.  Por lo tanto, a veces ten√≠a que escribir una hoja completa en una transacci√≥n limpia, con un mont√≥n de casos y combinaciones, para repetir la l√≥gica de alg√∫n procedimiento desde la configuraci√≥n, que muestra informaci√≥n en el campo de texto del formulario. <br><br>  Debemos rendir homenaje al equipo de desarrollo, que durante todos estos a√±os apoy√≥ lo que heredaron de los "implementadores", es un trabajo enorme: apoyar esto e incluso optimizar algo.  Hasta que vea, no comprende, yo mismo no cre√≠a al principio que todo podr√≠a ser tan complicado.  Pregunte: ¬øpor qu√© no reescribir desde cero?  Falta banal de recursos.  La compa√±√≠a se estaba desarrollando tan r√°pido que, a pesar de un gran equipo de programadores, simplemente no pod√≠an mantenerse al d√≠a con las necesidades del negocio, sin mencionar la reescritura de todo el concepto. <br><br>  Continuamos la historia de las solicitudes.  Obviamente, todos los bloques para la extracci√≥n de datos se convirtieron en almacenamientos para que luego se pudieran lanzar en el lado del servidor sin pasar por la plataforma 1C.  La regla era esta: un almacenamiento es responsable de recuperar una entidad.  Porque  La lista de deseos en la etapa de inicio ya se ha acumulado mucho, porque se ha vuelto doloroso a lo largo de los a√±os, y luego han resultado docenas de archivos de almacenamiento. <br><br>  El tercer problema es c√≥mo aumentar la velocidad y la calidad del desarrollo, y c√≥mo apoyar a todo este monstruo.  ¬øEscribir una solicitud para 1C ++ y copiar y pegar el resultado de su conversi√≥n a un almacenamiento?  Es muy inconveniente y tedioso, adem√°s, hay una alta probabilidad de errores: copie el incorrecto o el incorrecto o no seleccione la √∫ltima l√≠nea de la consulta y copie sin ella.  Esto es especialmente cierto cuando se trata de consultas directas 1C, porque no hay un <i>seud√≥nimo</i> como <i>Directorio,</i> Nomenclatura, Art√≠culo, solo nombres reales <i>SC2235.SP5278</i> y, por lo tanto, copiar una solicitud del directorio de productos a una tienda que recupera clientes es muy simple.  Por supuesto, la solicitud probablemente caer√° debido a la falta de coincidencia de tipos y n√∫mero de campos en la tabla de destino, pero hay placas id√©nticas, como enumeraciones, donde solo dos columnas son ID y Nombre.  En general, solo queda aplicar alg√∫n tipo de automatizaci√≥n.  Bueno, suficientes letras, ¬°vamos al grano! <br><br>  Quer√≠a que el proceso de desarrollo del almacenamiento se redujera a algo como esto: <br><br><ol><li>  Arreglamos la consulta SQL con pseudonombres y la guardamos </li><li>  Presionamos un <b>bot√≥n m√°gico</b> y a la salida recibimos el procedimiento almacenado corregido en el SQL convertido, lo borramos al servidor </li></ol><br><h4>  Algunos detalles </h4><br>  Para resolver el tercer problema, se escribi√≥ el procesamiento externo (.ert).  Hay una serie de procedimientos en el procesamiento, cada uno de los cuales contiene el texto de la consulta para extraer una entidad utilizando un pseudonombre, como <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> $.</code> </pre> <br>  En el formulario de procesamiento, hay un campo para mostrar el resultado de un procedimiento particular, es decir,  solicitud convertida a un formulario que sea comprensible para el servidor para que pueda probarlo r√°pidamente.  Adem√°s, siempre se agrega un <b>bloque de depuraci√≥n</b> a esta solicitud, con la declaraci√≥n de variables, los nombres de bases de datos de prueba, servidores y m√°s.  Solo queda copiar y pegar en SSMS y presionar F5.  Por supuesto, puede ejecutar esta solicitud desde el procesamiento en s√≠, pero el plan de solicitud y todo eso, bueno, usted comprende ... En general, as√≠ es como se realiza la depuraci√≥n.  Porque  Hay varias configuraciones; en el procesamiento, es posible convertir los mismos textos de consulta con seud√≥nimos de objetos en consultas finales para diferentes configuraciones.  De hecho, en una confe Nomenclatura, la referencia es SC123, y en otra, SC321.  Pero 1C ++ le permite cargar diferentes configuraciones en tiempo de ejecuci√≥n y generar una salida individual para cada una de ellas de acuerdo con el diccionario. <br><br>  A continuaci√≥n, se agreg√≥ el modo de ejecuci√≥n por lotes al procesamiento, cuando inicia autom√°ticamente cada uno de los procedimientos para cada configuraci√≥n, y la salida de cada uno de ellos se escribe en archivos .sql (en adelante, los archivos b√°sicos).  Por lo tanto, obtenemos un mont√≥n de combinaciones de archivos b√°sicos, que posteriormente deber√≠an convertirse autom√°ticamente en procedimientos almacenados usando VS.  Vale la pena se√±alar que los archivos base incluyen <b>un bloque de depuraci√≥n</b> . <br><br>  Parecer√≠a, ¬øpor qu√© no hacer una conclusi√≥n inmediata a los archivos finales de los procedimientos almacenados y mantener todo en este procesamiento?  El hecho es que para algunas pruebas es necesario ejecutar versiones de depuraci√≥n de consultas en lotes en los que se declaran todas las variables, adem√°s quer√≠a que los nombres de los procedimientos almacenados se administraran desde VS, sin pasar por 1C, porque esto es l√≥gico, ¬øno? <br><br>  Por cierto, los archivos b√°sicos tambi√©n se almacenan en el proyecto, bueno, los archivos de los procedimientos almacenados ya preparados, por supuesto.  En cualquier momento, sin iniciar 1C, puede abrir el archivo base en SSMS y ejecutarlo sin molestarse con declaraciones variables. <br><br>  En el procesamiento, todos los procedimientos con solicitudes tambi√©n son plantillas, que tienen el mismo conjunto de par√°metros, pero en este o aquel procedimiento solo se utilizan los par√°metros necesarios.  En algunos, todo est√° involucrado, y en algunos, dos son suficientes.  Por lo tanto, agregar un nuevo procedimiento se reduce a copiar la plantilla y completar los par√°metros con las consultas mismas. <br><br>  El c√≥digo de uno de los procedimientos de procesamiento, que luego se convertir√° en un procedimiento almacenado <br><img src="https://habrastorage.org/webt/ci/ev/sb/cievsb9urq5miainrvoqu9mkig0.png"><br><br>  La consulta final va m√°s o menos as√≠: <br><pre> <code class="1c hljs">++<span class="hljs-string"><span class="hljs-string">"("</span></span>+OPENQUERY()+<span class="hljs-string"><span class="hljs-string">")"</span></span>+ </code> </pre> <br>  Apariencia del procesamiento <br><img src="https://habrastorage.org/webt/yv/n4/in/yvn4injz09-m8ljnqhbediqvmqy.png"><br><br>  Al cambiar las configuraciones, la lista de elementos disponibles (necesarios) para descargar elementos en la lista de datos cambia.  Si es posible, el c√≥digo de procedimiento en 1C fue lo m√°s unificado posible.  Si se extraen las contrapartes y estos directorios son inconsistentes en diferentes configuraciones, entonces dentro del procedimiento de generaci√≥n hay diferentes casos, tales como: este bloque se repara para todos, este se agrega a la solicitud final solo para dicha configuraci√≥n, y hay uno para el otro.  Resulta que en los procedimientos almacenados para una entidad pero las configuraciones diferentes pueden diferir no solo por los nombres de las tablas, sino tambi√©n por bloques enteros de combinaciones presentes en una y ausentes en otra.  El conjunto de campos de salida, por supuesto, es el mismo y corresponde a la tabla del receptor o al contenedor del paquete SSIS, algunos campos est√°n obstruidos con stubs para configuraciones en las que estos detalles no son, en principio. <br><br>  <b>Bot√≥n m√°gico</b> <br><br>  Visual Studio tiene herramientas como MSbuild y las impresionantes plantillas T4.  Por lo tanto, como bot√≥n m√°gico, se escribi√≥ un script en C # para T4, que: <br><br><ol><li>  Registra una configuraci√≥n vac√≠a en el registro (de lo contrario, 1C mostrar√° una ventana modal con una sugerencia para registrar una conf y esperar las acciones del usuario) </li><li>  Crea una base de datos vac√≠a para este konf en el servidor SQL, porque sin ella 1C dar√° un error </li><li>  Lanza 1C y a trav√©s de OLE le dice que ejecute el procesamiento (el mismo .ert), tambi√©n transfiere un GUID √∫nico a 1C </li><li>  El resultado es una serie de archivos con solicitudes ya hechas (convertidas) y un archivo marcador, en el que se escribe el GUID recibido al inicio </li><li>  El registro de la conf se elimina del registro y una base de datos vac√≠a temporal se elimina del servidor </li><li>  Comprueba el contenido del archivo de token.  Si el archivo de marcador contiene el GUID que pasamos a 1C cuando se inici√≥, significa que funcion√≥ hasta el final, no se bloque√≥, etc., vaya al siguiente paso o mostraremos un error </li><li>  Creamos almacenes. </li><li>  Descompilamos el archivo .ert con gcomp para obtener los textos del m√≥dulo y los formularios de procesamiento, bueno, lo convertimos a Unicode, para su posterior env√≠o a Git y mostrarlo correctamente all√≠.  Para aquellos que no trabajaron con 1C: el archivo .ert es binario y el estudio, junto con el git, dice que el archivo .ert ha cambiado, pero no est√° claro qu√© ha cambiado exactamente, tal vez alguien movi√≥ el bot√≥n un p√≠xel a la izquierda (que inaceptable sin justificaci√≥n) </li></ol><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antes de crear almacenamientos, el script T4 extrae textos de consulta de los archivos base regularmente para excluir piezas de depuraci√≥n (se enfoca en una etiqueta especial que marca el final del bloque de depuraci√≥n) y lo envuelve en una √∫nica plantilla unificada para el procedimiento almacenado. Todos los almacenamientos tienen el mismo conjunto de par√°metros, pero en este o aquel procedimiento solo se utilizan los par√°metros necesarios. La lista de comparaci√≥n de los nombres de los archivos b√°sicos y los nombres de los procedimientos almacenados en los que deber√≠an convertirse se realiza en el proyecto como un archivo separado, por lo que ser√≠a conveniente trabajar con esto sin buscar la l√≠nea necesaria en el pa√±o y nuevamente, evitando el lanzamiento de 1C.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambi√©n quer√≠a que el desarrollador que se uni√≥ al proyecto pudiera escribir solicitudes y convertirlas sin ning√∫n problema, sin molestarse en registrar una configuraci√≥n vac√≠a, implementar una base de datos vac√≠a y otros detalles desagradables y tediosos. </font><font style="vertical-align: inherit;">Por lo tanto, todo se almacena en el proyecto: las configuraciones necesarias de 1C, los scripts para el correcto funcionamiento de 1C, el convertidor de procesamiento en s√≠ y otros archivos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como resultado, el escenario de las acciones del desarrollador es: ¬øNecesita un nuevo almacenamiento o necesita reparar el existente?</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Escribimos un nuevo procedimiento en el procesamiento / corregimos el anterior; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Agregue una l√≠nea en el proyecto VS al archivo de configuraci√≥n para las asignaciones si se ha agregado un nuevo procedimiento; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ejecute el script T4; </font></font></li><li> <s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ganancia</font></font></s>  Listo </li></ol><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pista?</font></font></b> <div class="spoiler_text">  Porque<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> los archivos b√°sicos se presentan proces√°ndolos en una carpeta espec√≠fica y el proyecto no sabe nada acerca de los archivos nuevos, por lo que aparecer√°n autom√°ticamente en el proyecto; debe ajustar el archivo .sqlproj y reemplazarlo. </font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">None</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" \1.sql"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">None</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" \2.sql"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">None</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" \3.sql"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> En </font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Content</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" \*.sql"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>       ¬´     ¬ª.   ,  ,   ,     :) <br><br>     , ,    (, )     .           ( ),         , -   - -       ,             . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En la salida, obtenemos el archivo del m√≥dulo modificado y los formularios de procesamiento, el nuevo archivo base y el almacenamiento en s√≠. El estudio destaca perfectamente todas las l√≠neas cambiadas. Por supuesto, tom√≥ mucho tiempo para todas estas bellezas para que el procesamiento no recreara los archivos b√°sicos, si nada ha cambiado en el c√≥digo de procesamiento, de lo contrario brillar√≠an como cambiados (porque la fecha del archivo ha cambiado), pero no hay diferencia con la comparaci√≥n l√≠nea por l√≠nea. Por cierto, se escribe un comentario en el archivo base (en la parte que posteriormente ir√° al procedimiento almacenado) con informaci√≥n sobre la fecha y hora en que se gener√≥ el archivo, la versi√≥n de la configuraci√≥n en funci√≥n de la cual se cre√≥ y qui√©n lo realiz√≥. Por lo tanto, en cualquier procedimiento almacenado, siempre puede ver qui√©n gener√≥ el c√≥digo ubicado en √©l. El procesamiento, antes de sobrescribir un archivo base existente, compara su texto √∫til conque est√° previsto que se escriba en √©l, si no hay diferencias, el archivo permanece intacto (todo esto para evitar el resaltado falso de los cambios al cambiar la configuraci√≥n 1C, por ejemplo, cuando la versi√≥n del archivo MD ha cambiado).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambi√©n tuve que atormentarme con los textos de consulta, porque se ejecutan en servidores remotos a trav√©s de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OPENQUERY</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , y los nombres de la base de datos 1C en las ramas son diferentes, al igual que los nombres de los servidores, por lo que el texto de la consulta se recopila din√°micamente de la cadena, con la sustituci√≥n de estos valores de los par√°metros de almacenamiento, colocados en variable y se lanza al final a trav√©s de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXEC</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OPENQUERY</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se agudiz√≥ originalmente para ejecutar una cadena, por lo que ya obtenemos una cadena en una cadena, una comilla entre comillas, escape y m√°s.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y 177 (en la versi√≥n b√°sica) opera en SQL2000, y all√≠ varchar (max) no funciona, varchar m√°ximo (8000), y el texto de consulta general es 9k, por ejemplo ... Entonces, necesitamos definir dos variables y ejecutarlas en EXEC (@ SQL1 + @ SQL2). </font><font style="vertical-align: inherit;">A pesar de que los procedimientos se almacenan y ejecutan en SQL2016, sus partes se verificaron en SQL2000. </font><font style="vertical-align: inherit;">Las manos no quer√≠an determinar las variables, quer√≠a minimizar la cantidad de gestos innecesarios, para que todo fuera autom√°tico.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el procesamiento, el texto de la consulta se ve as√≠</font></font></b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> @<span class="hljs-number"><span class="hljs-number">1</span></span>CDBName.dbo.$. <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> @<span class="hljs-number"><span class="hljs-number">1</span></span>CDBName.dbo.$. <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> xxx = <span class="hljs-string"><span class="hljs-string">'hello!'</span></span> ^<span class="hljs-comment"><span class="hljs-comment">--       8 , ,        ,       ,   .          ,             .. ... join ... ) join ...</span></span></code> </pre> </div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y el texto del almacenamiento es el siguiente</font></font></b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> [dbo].[SP1] @LinkedServerName <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">24</span></span>) ,@<span class="hljs-number"><span class="hljs-number">1</span></span>CDBName <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">24</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Declare</span></span> @TSQL0 <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">8000</span></span>), @TSQL1 <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">8000</span></span>), @TSQL2 <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">8000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @TSQL0=<span class="hljs-string"><span class="hljs-string">' select ... from OPENQUERY('</span></span>+@LinkedName+<span class="hljs-string"><span class="hljs-string">','' select ... from '</span></span>+@<span class="hljs-number"><span class="hljs-number">1</span></span>CDBName+<span class="hljs-string"><span class="hljs-string">'.dbo.DH123. join '</span></span>+@<span class="hljs-number"><span class="hljs-number">1</span></span>CDBName+<span class="hljs-string"><span class="hljs-string">'.SC123. ... where '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @TSQL1=<span class="hljs-string"><span class="hljs-string">' xxx = ''''hello!'''' join ... join ... )'' join ... '''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @TSQL2=<span class="hljs-string"><span class="hljs-string">' ... EXEC(@TSQL0+@TSQL1+@TSQL2) END</span></span></code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como puede ver en el c√≥digo, el procedimiento almacenado no tiene formato. </font><font style="vertical-align: inherit;">Al crear un archivo base, se elimina todo el formato (espacios, pesta√±as) a la izquierda y a la derecha, que estaban en la solicitud original con pseudonombres, porque al servidor no le importa el formateo, y tiene sentido directo guardar, porque puede generar cualquier n√∫mero de variables, y OPENQUERY tiene un l√≠mite de 8k personajes </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El procesamiento de .ert determina la duraci√≥n de la solicitud final, teniendo en cuenta el formato remoto, y calcula el n√∫mero de variables en las que debe encajar todo esto, etc. </font><font style="vertical-align: inherit;">En general, este tratamiento bebi√≥ mucha sangre. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manualmente, nunca se realizan cambios en los procedimientos almacenados, solo a trav√©s de las correcciones de procesamiento.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ETL </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quiz√°s, en esta parte no hay nada especial (en mi opini√≥n). El esquema cl√°sico con una base de datos intermedia (Stage). Solo se puede notar que ETL se implementa utilizando paquetes SSIS, que, a su vez, realizan los mismos procedimientos almacenados que se discutieron en la secci√≥n anterior. Hay un paquete principal y varios ni√±os. Para permitir la ejecuci√≥n de subprocesos m√∫ltiples, el paquete principal lanza simult√°neamente varias instancias del mismo paquete secundario con diferentes par√°metros (para diferentes ramas), como resultado, es posible obtener datos de servidores vinculados en el menor tiempo posible.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si en el proceso de recibir datos, una o m√°s instancias del paquete secundario no pudieron conectarse a los servidores remotos, entonces se recuerda la lista de dichos servidores (con un intento de conexi√≥n fallido), y despu√©s de que finaliza la ejecuci√≥n de todos los flujos de los paquetes secundarios (es decir, despu√©s de unos minutos) , el paquete principal inicia nuevamente los flujos de los servidores de la lista con un intento fallido, tratando de alcanzarlo y a veces lo consigue. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si no fue posible obtener datos de una o varias sucursales, entonces este no es un error cr√≠tico, el sistema funcionar√° sin ellos. Por supuesto, el paquete le notifica de tales situaciones. En nuestro caso, a trav√©s de zabbix. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todos los datos recibidos se vuelcan en una base de datos intermedia desde la cual ya se vierte en la principal.</font></font><br><br>  Porque<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En las configuraciones de 1C utilizadas, no existen mecanismos para registrar los cambios, y ni siquiera debe recordar acerca de la integraci√≥n de eventos, cada vez que tiene que volver a consultar datos de todas las bases de datos en los √∫ltimos meses. </font><font style="vertical-align: inherit;">Para no perder tiempo eliminando, se utiliza el particionamiento de tablas, que permite la ejecuci√≥n </font></font><code>truncate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de la secci√≥n. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por supuesto, con el tiempo, el paquete principal comenz√≥ a crecer (cubierto de paquetes secundarios) y se le agregaron interacciones con servicios web, varias bases de datos "no 1C" y otras fuentes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Controle el flujo de uno de los paquetes SSIS </font></font><br><br><img src="https://habrastorage.org/webt/al/nl/u_/alnlu_3yriilaxfcwlhq_mcf_ce.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uno de los flujos de datos de paquetes</font></font><br><br><img src="https://habrastorage.org/webt/rh/eh/c8/rhehc8b9jtn6qf6polrfqjiduuk.png"><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Algunos consejos si puedes </font></font></h4><br>         SSIS     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> SQL Server</a> (SQL Server Destination),     ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> OLE DB</a> (OLE DB Destination). <br><br>      ,       ,     ,             .    ,        ,   . (,     ) <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nunca corrija manualmente los datos en la base de datos. Solo guiones y aseg√∫rese de guardar cada uno de ellos con un nombre adecuado, fecha y comentarios en el interior, de lo que debe quedar claro qui√©n, cu√°ndo y sobre qu√© base lo hizo (error / servicio, etc.). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Realice una comprobaci√≥n de bloques de la versi√≥n de la base de datos dentro de dichos scripts y no permita la ejecuci√≥n en caso de desajuste de versi√≥n en el script y en la base de datos de destino. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y tambi√©n recomendar√≠a que tenga una tabla especial en la base de datos que almacene el historial de lanzamientos de dichos scripts (del p√°rrafo anterior).</font></font> Es decir<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el script no solo realiza cambios en los datos, sino que tambi√©n registra el hecho de su lanzamiento en el registro. Tiene sentido no solo registrar el lanzamiento, sino tambi√©n bloquear su reinicio en caso de que el registro ya contenga informaci√≥n sobre la ejecuci√≥n anterior. Y si por alguna raz√≥n necesita ejecutar el mismo script nuevamente, haga una copia y as√≠gnele una nueva fecha y n√∫mero. Esto facilitar√° enormemente la vida y eliminar√° reclamos innecesarios durante la sesi√≥n informativa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Establezca las cadenas y rutas de conexi√≥n que no sean rutas productivas y nombres como la configuraci√≥n predeterminada para la implementaci√≥n, de modo que para las publicaciones en el producto haya tenido que elegir a prop√≥sito (es decir, conscientemente) una configuraci√≥n espec√≠fica.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> No seas perezoso para hacer todo tipo de protecci√≥n contra los tontos, nunca son superfluos, sin importar cu√°n altamente calificados y responsables sean los desarrolladores. </font></font><br><br><h4>  PS </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No pretendo ser cierto, todos deciden por s√≠ mismos, en funci√≥n de su experiencia y preferencias, si todo lo que se ha descrito es √∫til. </font><font style="vertical-align: inherit;">Todos los ejemplos son solo ejemplos r√°pidos. </font><font style="vertical-align: inherit;">El art√≠culo fue escrito durante varios meses con docenas de enfoques e intervalos largos debido a la falta de tiempo, por lo que puede haber algunas inconsistencias en el texto, no se ofenda.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es423205/">https://habr.com/ru/post/es423205/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es423191/index.html">Lanzamiento de los elementos de plataformas offshore. Parte 1</a></li>
<li><a href="../es423193/index.html">Configure las Notificaciones Web Push usando pywebpush paso a paso</a></li>
<li><a href="../es423195/index.html">Qu√© hay de nuevo en JPA 2.2</a></li>
<li><a href="../es423197/index.html">LOLWUT: una obra de arte en un equipo de db</a></li>
<li><a href="../es423203/index.html">El l√≠der del equipo ser√° responsable del servicio.</a></li>
<li><a href="../es423207/index.html">C√≥mo hacer una actualizaci√≥n autom√°tica de un cliente de juego en l√≠nea</a></li>
<li><a href="../es423209/index.html">Killer Form 2? Descripci√≥n general de la impresora 3D Dental MoonRay S100</a></li>
<li><a href="../es423211/index.html">Comit√© Estatal de la Duma: los Me gusta y los reenv√≠os seguir√°n siendo penalmente responsables</a></li>
<li><a href="../es423213/index.html">Como en ruso antiguo habr√° "esto es una prueba"</a></li>
<li><a href="../es423215/index.html">¬øD√≥nde est√° mi dinero, hombre?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>